
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 114, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-conformance_testing_test.cc</h3>
            <pre><code>1  #include "absl/types/internal/conformance_testing.h"
2  #include <new>
3  #include <type_traits>
4  #include <utility>
5  #include "gtest/gtest.h"
6  #include "absl/meta/type_traits.h"
7  #include "absl/types/internal/conformance_aliases.h"
8  #include "absl/types/internal/conformance_profile.h"
9  namespace {
10  namespace ti = absl::types_internal;
11  template <class T>
12  using DefaultConstructibleWithNewImpl = decltype(::new (std::nothrow) T);
13  template <class T>
14  using DefaultConstructibleWithNew =
15      absl::type_traits_internal::is_detected<DefaultConstructibleWithNewImpl, T>;
16  template <class T>
17  using MoveConstructibleWithNewImpl =
18      decltype(::new (std::nothrow) T(std::declval<T>()));
19  template <class T>
20  using MoveConstructibleWithNew =
21      absl::type_traits_internal::is_detected<MoveConstructibleWithNewImpl, T>;
22  template <class T>
23  using CopyConstructibleWithNewImpl =
24      decltype(::new (std::nothrow) T(std::declval<const T&>()));
25  template <class T>
26  using CopyConstructibleWithNew =
27      absl::type_traits_internal::is_detected<CopyConstructibleWithNewImpl, T>;
28  template <class T,
29            class Result =
30                std::integral_constant<bool, noexcept(::new (std::nothrow) T)>>
31  using NothrowDefaultConstructibleWithNewImpl =
32      typename std::enable_if<Result::value>::type;
33  template <class T>
34  using NothrowDefaultConstructibleWithNew =
35      absl::type_traits_internal::is_detected<
36          NothrowDefaultConstructibleWithNewImpl, T>;
37  template <class T,
38            class Result = std::integral_constant<
39                bool, noexcept(::new (std::nothrow) T(std::declval<T>()))>>
40  using NothrowMoveConstructibleWithNewImpl =
41      typename std::enable_if<Result::value>::type;
42  template <class T>
43  using NothrowMoveConstructibleWithNew =
44      absl::type_traits_internal::is_detected<NothrowMoveConstructibleWithNewImpl,
45                                              T>;
46  template <class T,
47            class Result = std::integral_constant<
48                bool, noexcept(::new (std::nothrow) T(std::declval<const T&>()))>>
49  using NothrowCopyConstructibleWithNewImpl =
50      typename std::enable_if<Result::value>::type;
51  template <class T>
52  using NothrowCopyConstructibleWithNew =
53      absl::type_traits_internal::is_detected<NothrowCopyConstructibleWithNewImpl,
54                                              T>;
55  #define ABSL_INTERNAL_COMPARISON_OP_EXPR(op) \
56    ((std::declval<const T&>() op std::declval<const T&>()) ? true : true)
57  #define ABSL_INTERNAL_COMPARISON_OP_TRAIT(name, op)                         \
58    template <class T>                                                        \
59    using name##Impl = decltype(ABSL_INTERNAL_COMPARISON_OP_EXPR(op));        \
60                                                                              \
61    template <class T>                                                        \
62    using name = absl::type_traits_internal::is_detected<name##Impl, T>;      \
63                                                                              \
64    template <class T,                                                        \
65              class Result = std::integral_constant<                          \
66                  bool, noexcept(ABSL_INTERNAL_COMPARISON_OP_EXPR(op))>>      \
67    using Nothrow##name##Impl = typename std::enable_if<Result::value>::type; \
68                                                                              \
69    template <class T>                                                        \
70    using Nothrow##name =                                                     \
71        absl::type_traits_internal::is_detected<Nothrow##name##Impl, T>
72  ABSL_INTERNAL_COMPARISON_OP_TRAIT(EqualityComparable, ==);
73  ABSL_INTERNAL_COMPARISON_OP_TRAIT(InequalityComparable, !=);
74  ABSL_INTERNAL_COMPARISON_OP_TRAIT(LessThanComparable, <);
75  ABSL_INTERNAL_COMPARISON_OP_TRAIT(LessEqualComparable, <=);
76  ABSL_INTERNAL_COMPARISON_OP_TRAIT(GreaterEqualComparable, >=);
77  ABSL_INTERNAL_COMPARISON_OP_TRAIT(GreaterThanComparable, >);
78  #undef ABSL_INTERNAL_COMPARISON_OP_TRAIT
79  template <class T>
80  class ProfileTest : public ::testing::Test {};
81  TYPED_TEST_SUITE_P(ProfileTest);
82  TYPED_TEST_P(ProfileTest, HasAppropriateConstructionProperties) {
83    using profile = typename TypeParam::profile;
84    using arch = typename TypeParam::arch;
85    using expected_profile = typename TypeParam::expected_profile;
86    using props = ti::PropertiesOfT<profile>;
87    using arch_props = ti::PropertiesOfArchetypeT<arch>;
88    using expected_props = ti::PropertiesOfT<expected_profile>;
89    EXPECT_TRUE((std::is_same<props, arch_props>::value));
90    EXPECT_TRUE((std::is_same<props, expected_props>::value));
91    EXPECT_TRUE((std::is_same<arch_props, expected_props>::value));
92    EXPECT_EQ(props::default_constructible_support,
93              expected_props::default_constructible_support);
94    EXPECT_EQ(props::move_constructible_support,
95              expected_props::move_constructible_support);
96    EXPECT_EQ(props::copy_constructible_support,
97              expected_props::copy_constructible_support);
98    EXPECT_EQ(props::destructible_support, expected_props::destructible_support);
99    if (!std::is_same<props, arch_props>::value) {
100      EXPECT_EQ(arch_props::default_constructible_support,
101                expected_props::default_constructible_support);
102      EXPECT_EQ(arch_props::move_constructible_support,
103                expected_props::move_constructible_support);
104      EXPECT_EQ(arch_props::copy_constructible_support,
105                expected_props::copy_constructible_support);
106      EXPECT_EQ(arch_props::destructible_support,
107                expected_props::destructible_support);
108    }
109    EXPECT_EQ(props::default_constructible_support,
110              expected_props::default_constructible_support);
111    switch (expected_props::default_constructible_support) {
112      case ti::default_constructible::maybe:
113        EXPECT_FALSE(DefaultConstructibleWithNew<arch>::value);
114        EXPECT_FALSE(NothrowDefaultConstructibleWithNew<arch>::value);
115        if (std::is_destructible<arch>::value) {
116          EXPECT_FALSE(std::is_default_constructible<arch>::value);
117          EXPECT_FALSE(std::is_nothrow_default_constructible<arch>::value);
118          EXPECT_FALSE(absl::is_trivially_default_constructible<arch>::value);
119        }
120        break;
121      case ti::default_constructible::yes:
122        EXPECT_TRUE(DefaultConstructibleWithNew<arch>::value);
123        EXPECT_FALSE(NothrowDefaultConstructibleWithNew<arch>::value);
124        if (std::is_destructible<arch>::value) {
125          EXPECT_TRUE(std::is_default_constructible<arch>::value);
126          EXPECT_FALSE(std::is_nothrow_default_constructible<arch>::value);
127          EXPECT_FALSE(absl::is_trivially_default_constructible<arch>::value);
128        }
129        break;
130      case ti::default_constructible::nothrow:
131        EXPECT_TRUE(DefaultConstructibleWithNew<arch>::value);
132        EXPECT_TRUE(NothrowDefaultConstructibleWithNew<arch>::value);
133        if (std::is_destructible<arch>::value) {
134          EXPECT_TRUE(std::is_default_constructible<arch>::value);
135          EXPECT_TRUE(std::is_nothrow_default_constructible<arch>::value);
136          EXPECT_FALSE(absl::is_trivially_default_constructible<arch>::value);
137          if (std::is_nothrow_destructible<arch>::value) {
138            EXPECT_TRUE(std::is_nothrow_default_constructible<arch>::value);
139          }
140        }
141        break;
142      case ti::default_constructible::trivial:
143        EXPECT_TRUE(DefaultConstructibleWithNew<arch>::value);
144        EXPECT_TRUE(NothrowDefaultConstructibleWithNew<arch>::value);
145        if (std::is_destructible<arch>::value) {
146          EXPECT_TRUE(std::is_default_constructible<arch>::value);
147          EXPECT_TRUE(std::is_nothrow_default_constructible<arch>::value);
148          if (absl::is_trivially_destructible<arch>::value) {
149            EXPECT_TRUE(absl::is_trivially_default_constructible<arch>::value);
150          }
151        }
152        break;
153    }
154    EXPECT_EQ(props::move_constructible_support,
155              expected_props::move_constructible_support);
156    switch (expected_props::move_constructible_support) {
157      case ti::move_constructible::maybe:
158        EXPECT_FALSE(MoveConstructibleWithNew<arch>::value);
159        EXPECT_FALSE(NothrowMoveConstructibleWithNew<arch>::value);
160        if (std::is_destructible<arch>::value) {
161          EXPECT_FALSE(std::is_move_constructible<arch>::value);
162          EXPECT_FALSE(std::is_nothrow_move_constructible<arch>::value);
163          EXPECT_FALSE(absl::is_trivially_move_constructible<arch>::value);
164        }
165        break;
166      case ti::move_constructible::yes:
167        EXPECT_TRUE(MoveConstructibleWithNew<arch>::value);
168        EXPECT_FALSE(NothrowMoveConstructibleWithNew<arch>::value);
169        if (std::is_destructible<arch>::value) {
170          EXPECT_TRUE(std::is_move_constructible<arch>::value);
171          EXPECT_FALSE(std::is_nothrow_move_constructible<arch>::value);
172          EXPECT_FALSE(absl::is_trivially_move_constructible<arch>::value);
173        }
174        break;
175      case ti::move_constructible::nothrow:
176        EXPECT_TRUE(MoveConstructibleWithNew<arch>::value);
177        EXPECT_TRUE(NothrowMoveConstructibleWithNew<arch>::value);
178        if (std::is_destructible<arch>::value) {
179          EXPECT_TRUE(std::is_move_constructible<arch>::value);
180          EXPECT_TRUE(std::is_nothrow_move_constructible<arch>::value);
181          EXPECT_FALSE(absl::is_trivially_move_constructible<arch>::value);
182          if (std::is_nothrow_destructible<arch>::value) {
183            EXPECT_TRUE(std::is_nothrow_move_constructible<arch>::value);
184          }
185        }
186        break;
187      case ti::move_constructible::trivial:
188        EXPECT_TRUE(MoveConstructibleWithNew<arch>::value);
189        EXPECT_TRUE(NothrowMoveConstructibleWithNew<arch>::value);
190        if (std::is_destructible<arch>::value) {
191          EXPECT_TRUE(std::is_move_constructible<arch>::value);
192          EXPECT_TRUE(std::is_nothrow_move_constructible<arch>::value);
193          if (absl::is_trivially_destructible<arch>::value) {
194            EXPECT_TRUE(absl::is_trivially_move_constructible<arch>::value);
195          }
196        }
197        break;
198    }
199    EXPECT_EQ(props::copy_constructible_support,
200              expected_props::copy_constructible_support);
201    switch (expected_props::copy_constructible_support) {
202      case ti::copy_constructible::maybe:
203        EXPECT_FALSE(CopyConstructibleWithNew<arch>::value);
204        EXPECT_FALSE(NothrowCopyConstructibleWithNew<arch>::value);
205        if (std::is_destructible<arch>::value) {
206          EXPECT_FALSE(std::is_copy_constructible<arch>::value);
207          EXPECT_FALSE(std::is_nothrow_copy_constructible<arch>::value);
208          EXPECT_FALSE(absl::is_trivially_copy_constructible<arch>::value);
209        }
210        break;
211      case ti::copy_constructible::yes:
212        EXPECT_TRUE(CopyConstructibleWithNew<arch>::value);
213        EXPECT_FALSE(NothrowCopyConstructibleWithNew<arch>::value);
214        if (std::is_destructible<arch>::value) {
215          EXPECT_TRUE(std::is_copy_constructible<arch>::value);
216          EXPECT_FALSE(std::is_nothrow_copy_constructible<arch>::value);
217          EXPECT_FALSE(absl::is_trivially_copy_constructible<arch>::value);
218        }
219        break;
220      case ti::copy_constructible::nothrow:
221        EXPECT_TRUE(CopyConstructibleWithNew<arch>::value);
222        EXPECT_TRUE(NothrowCopyConstructibleWithNew<arch>::value);
223        if (std::is_destructible<arch>::value) {
224          EXPECT_TRUE(std::is_copy_constructible<arch>::value);
225          EXPECT_TRUE(std::is_nothrow_copy_constructible<arch>::value);
226          EXPECT_FALSE(absl::is_trivially_copy_constructible<arch>::value);
227          if (std::is_nothrow_destructible<arch>::value) {
228            EXPECT_TRUE(std::is_nothrow_copy_constructible<arch>::value);
229          }
230        }
231        break;
232      case ti::copy_constructible::trivial:
233        EXPECT_TRUE(CopyConstructibleWithNew<arch>::value);
234        EXPECT_TRUE(NothrowCopyConstructibleWithNew<arch>::value);
235        if (std::is_destructible<arch>::value) {
236          EXPECT_TRUE(std::is_copy_constructible<arch>::value);
237          EXPECT_TRUE(std::is_nothrow_copy_constructible<arch>::value);
238          if (absl::is_trivially_destructible<arch>::value) {
239            EXPECT_TRUE(absl::is_trivially_copy_constructible<arch>::value);
240          }
241        }
242        break;
243    }
244    EXPECT_EQ(props::destructible_support, expected_props::destructible_support);
245    switch (expected_props::destructible_support) {
246      case ti::destructible::maybe:
247        EXPECT_FALSE(std::is_destructible<arch>::value);
248        EXPECT_FALSE(std::is_nothrow_destructible<arch>::value);
249        EXPECT_FALSE(absl::is_trivially_destructible<arch>::value);
250        break;
251      case ti::destructible::yes:
252        EXPECT_TRUE(std::is_destructible<arch>::value);
253        EXPECT_FALSE(std::is_nothrow_destructible<arch>::value);
254        EXPECT_FALSE(absl::is_trivially_destructible<arch>::value);
255        break;
256      case ti::destructible::nothrow:
257        EXPECT_TRUE(std::is_destructible<arch>::value);
258        EXPECT_TRUE(std::is_nothrow_destructible<arch>::value);
259        EXPECT_FALSE(absl::is_trivially_destructible<arch>::value);
260        break;
261      case ti::destructible::trivial:
262        EXPECT_TRUE(std::is_destructible<arch>::value);
263        EXPECT_TRUE(std::is_nothrow_destructible<arch>::value);
264        EXPECT_TRUE(absl::is_trivially_destructible<arch>::value);
265        break;
266    }
267  }
268  TYPED_TEST_P(ProfileTest, HasAppropriateAssignmentProperties) {
269    using profile = typename TypeParam::profile;
270    using arch = typename TypeParam::arch;
271    using expected_profile = typename TypeParam::expected_profile;
272    using props = ti::PropertiesOfT<profile>;
273    using arch_props = ti::PropertiesOfArchetypeT<arch>;
274    using expected_props = ti::PropertiesOfT<expected_profile>;
275    EXPECT_TRUE((std::is_same<props, arch_props>::value));
276    EXPECT_TRUE((std::is_same<props, expected_props>::value));
277    EXPECT_TRUE((std::is_same<arch_props, expected_props>::value));
278    EXPECT_EQ(props::move_assignable_support,
279              expected_props::move_assignable_support);
280    EXPECT_EQ(props::copy_assignable_support,
281              expected_props::copy_assignable_support);
282    if (!std::is_same<props, arch_props>::value) {
283      EXPECT_EQ(arch_props::move_assignable_support,
284                expected_props::move_assignable_support);
285      EXPECT_EQ(arch_props::copy_assignable_support,
286                expected_props::copy_assignable_support);
287    }
288    EXPECT_EQ(props::move_assignable_support,
289              expected_props::move_assignable_support);
290    switch (expected_props::move_assignable_support) {
291      case ti::move_assignable::maybe:
292        EXPECT_FALSE(std::is_move_assignable<arch>::value);
293        EXPECT_FALSE(std::is_nothrow_move_assignable<arch>::value);
294        EXPECT_FALSE(absl::is_trivially_move_assignable<arch>::value);
295        break;
296      case ti::move_assignable::yes:
297        EXPECT_TRUE(std::is_move_assignable<arch>::value);
298        EXPECT_FALSE(std::is_nothrow_move_assignable<arch>::value);
299        EXPECT_FALSE(absl::is_trivially_move_assignable<arch>::value);
300        break;
301      case ti::move_assignable::nothrow:
302        EXPECT_TRUE(std::is_move_assignable<arch>::value);
303        EXPECT_TRUE(std::is_nothrow_move_assignable<arch>::value);
304        EXPECT_FALSE(absl::is_trivially_move_assignable<arch>::value);
305        break;
306      case ti::move_assignable::trivial:
307        EXPECT_TRUE(std::is_move_assignable<arch>::value);
308        EXPECT_TRUE(std::is_nothrow_move_assignable<arch>::value);
309        EXPECT_TRUE(absl::is_trivially_move_assignable<arch>::value);
310        break;
311    }
312    EXPECT_EQ(props::copy_assignable_support,
313              expected_props::copy_assignable_support);
314    switch (expected_props::copy_assignable_support) {
315      case ti::copy_assignable::maybe:
316        EXPECT_FALSE(std::is_copy_assignable<arch>::value);
317        EXPECT_FALSE(std::is_nothrow_copy_assignable<arch>::value);
318        EXPECT_FALSE(absl::is_trivially_copy_assignable<arch>::value);
319        break;
320      case ti::copy_assignable::yes:
321        EXPECT_TRUE(std::is_copy_assignable<arch>::value);
322        EXPECT_FALSE(std::is_nothrow_copy_assignable<arch>::value);
323        EXPECT_FALSE(absl::is_trivially_copy_assignable<arch>::value);
324        break;
325      case ti::copy_assignable::nothrow:
326        EXPECT_TRUE(std::is_copy_assignable<arch>::value);
327        EXPECT_TRUE(std::is_nothrow_copy_assignable<arch>::value);
328        EXPECT_FALSE(absl::is_trivially_copy_assignable<arch>::value);
329        break;
330      case ti::copy_assignable::trivial:
331        EXPECT_TRUE(std::is_copy_assignable<arch>::value);
332        EXPECT_TRUE(std::is_nothrow_copy_assignable<arch>::value);
333        EXPECT_TRUE(absl::is_trivially_copy_assignable<arch>::value);
334        break;
335    }
336  }
337  TYPED_TEST_P(ProfileTest, HasAppropriateComparisonProperties) {
338    using profile = typename TypeParam::profile;
339    using arch = typename TypeParam::arch;
340    using expected_profile = typename TypeParam::expected_profile;
341    using props = ti::PropertiesOfT<profile>;
342    using arch_props = ti::PropertiesOfArchetypeT<arch>;
343    using expected_props = ti::PropertiesOfT<expected_profile>;
344    EXPECT_TRUE((std::is_same<props, arch_props>::value));
345    EXPECT_TRUE((std::is_same<props, expected_props>::value));
346    EXPECT_TRUE((std::is_same<arch_props, expected_props>::value));
347    EXPECT_EQ(props::equality_comparable_support,
348              expected_props::equality_comparable_support);
349    EXPECT_EQ(props::inequality_comparable_support,
350              expected_props::inequality_comparable_support);
351    EXPECT_EQ(props::less_than_comparable_support,
352              expected_props::less_than_comparable_support);
353    EXPECT_EQ(props::less_equal_comparable_support,
354              expected_props::less_equal_comparable_support);
355    EXPECT_EQ(props::greater_equal_comparable_support,
356              expected_props::greater_equal_comparable_support);
357    EXPECT_EQ(props::greater_than_comparable_support,
358              expected_props::greater_than_comparable_support);
359    if (!std::is_same<props, arch_props>::value) {
360      EXPECT_EQ(arch_props::equality_comparable_support,
361                expected_props::equality_comparable_support);
362      EXPECT_EQ(arch_props::inequality_comparable_support,
363                expected_props::inequality_comparable_support);
364      EXPECT_EQ(arch_props::less_than_comparable_support,
365                expected_props::less_than_comparable_support);
366      EXPECT_EQ(arch_props::less_equal_comparable_support,
367                expected_props::less_equal_comparable_support);
368      EXPECT_EQ(arch_props::greater_equal_comparable_support,
369                expected_props::greater_equal_comparable_support);
370      EXPECT_EQ(arch_props::greater_than_comparable_support,
371                expected_props::greater_than_comparable_support);
372    }
373    switch (expected_props::equality_comparable_support) {
374      case ti::equality_comparable::maybe:
375        EXPECT_FALSE(EqualityComparable<arch>::value);
376        EXPECT_FALSE(NothrowEqualityComparable<arch>::value);
377        break;
378      case ti::equality_comparable::yes:
379        EXPECT_TRUE(EqualityComparable<arch>::value);
380        EXPECT_FALSE(NothrowEqualityComparable<arch>::value);
381        break;
382      case ti::equality_comparable::nothrow:
383        EXPECT_TRUE(EqualityComparable<arch>::value);
384        EXPECT_TRUE(NothrowEqualityComparable<arch>::value);
385        break;
386    }
387    switch (expected_props::inequality_comparable_support) {
388      case ti::inequality_comparable::maybe:
389        EXPECT_FALSE(InequalityComparable<arch>::value);
390        EXPECT_FALSE(NothrowInequalityComparable<arch>::value);
391        break;
392      case ti::inequality_comparable::yes:
393        EXPECT_TRUE(InequalityComparable<arch>::value);
394        EXPECT_FALSE(NothrowInequalityComparable<arch>::value);
395        break;
396      case ti::inequality_comparable::nothrow:
397        EXPECT_TRUE(InequalityComparable<arch>::value);
398        EXPECT_TRUE(NothrowInequalityComparable<arch>::value);
399        break;
400    }
401    switch (expected_props::less_than_comparable_support) {
402      case ti::less_than_comparable::maybe:
403        EXPECT_FALSE(LessThanComparable<arch>::value);
404        EXPECT_FALSE(NothrowLessThanComparable<arch>::value);
405        break;
406      case ti::less_than_comparable::yes:
407        EXPECT_TRUE(LessThanComparable<arch>::value);
408        EXPECT_FALSE(NothrowLessThanComparable<arch>::value);
409        break;
410      case ti::less_than_comparable::nothrow:
411        EXPECT_TRUE(LessThanComparable<arch>::value);
412        EXPECT_TRUE(NothrowLessThanComparable<arch>::value);
413        break;
414    }
415    switch (expected_props::less_equal_comparable_support) {
416      case ti::less_equal_comparable::maybe:
417        EXPECT_FALSE(LessEqualComparable<arch>::value);
418        EXPECT_FALSE(NothrowLessEqualComparable<arch>::value);
419        break;
420      case ti::less_equal_comparable::yes:
421        EXPECT_TRUE(LessEqualComparable<arch>::value);
422        EXPECT_FALSE(NothrowLessEqualComparable<arch>::value);
423        break;
424      case ti::less_equal_comparable::nothrow:
425        EXPECT_TRUE(LessEqualComparable<arch>::value);
426        EXPECT_TRUE(NothrowLessEqualComparable<arch>::value);
427        break;
428    }
429    switch (expected_props::greater_equal_comparable_support) {
430      case ti::greater_equal_comparable::maybe:
431        EXPECT_FALSE(GreaterEqualComparable<arch>::value);
432        EXPECT_FALSE(NothrowGreaterEqualComparable<arch>::value);
433        break;
434      case ti::greater_equal_comparable::yes:
435        EXPECT_TRUE(GreaterEqualComparable<arch>::value);
436        EXPECT_FALSE(NothrowGreaterEqualComparable<arch>::value);
437        break;
438      case ti::greater_equal_comparable::nothrow:
439        EXPECT_TRUE(GreaterEqualComparable<arch>::value);
440        EXPECT_TRUE(NothrowGreaterEqualComparable<arch>::value);
441        break;
442    }
443    switch (expected_props::greater_than_comparable_support) {
444      case ti::greater_than_comparable::maybe:
445        EXPECT_FALSE(GreaterThanComparable<arch>::value);
446        EXPECT_FALSE(NothrowGreaterThanComparable<arch>::value);
447        break;
448      case ti::greater_than_comparable::yes:
449        EXPECT_TRUE(GreaterThanComparable<arch>::value);
450        EXPECT_FALSE(NothrowGreaterThanComparable<arch>::value);
451        break;
452      case ti::greater_than_comparable::nothrow:
453        EXPECT_TRUE(GreaterThanComparable<arch>::value);
454        EXPECT_TRUE(NothrowGreaterThanComparable<arch>::value);
455        break;
456    }
457  }
458  TYPED_TEST_P(ProfileTest, HasAppropriateAuxilliaryProperties) {
459    using profile = typename TypeParam::profile;
460    using arch = typename TypeParam::arch;
461    using expected_profile = typename TypeParam::expected_profile;
462    using props = ti::PropertiesOfT<profile>;
463    using arch_props = ti::PropertiesOfArchetypeT<arch>;
464    using expected_props = ti::PropertiesOfT<expected_profile>;
465    EXPECT_TRUE((std::is_same<props, arch_props>::value));
466    EXPECT_TRUE((std::is_same<props, expected_props>::value));
467    EXPECT_TRUE((std::is_same<arch_props, expected_props>::value));
468    EXPECT_EQ(props::swappable_support, expected_props::swappable_support);
469    EXPECT_EQ(props::hashable_support, expected_props::hashable_support);
470    if (!std::is_same<props, arch_props>::value) {
471      EXPECT_EQ(arch_props::swappable_support, expected_props::swappable_support);
472      EXPECT_EQ(arch_props::hashable_support, expected_props::hashable_support);
473    }
474    switch (expected_props::swappable_support) {
475      case ti::swappable::maybe:
476        EXPECT_FALSE(absl::type_traits_internal::IsSwappable<arch>::value);
477        EXPECT_FALSE(absl::type_traits_internal::IsNothrowSwappable<arch>::value);
478        break;
479      case ti::swappable::yes:
480        EXPECT_TRUE(absl::type_traits_internal::IsSwappable<arch>::value);
481        EXPECT_FALSE(absl::type_traits_internal::IsNothrowSwappable<arch>::value);
482        break;
483      case ti::swappable::nothrow:
484        EXPECT_TRUE(absl::type_traits_internal::IsSwappable<arch>::value);
485        EXPECT_TRUE(absl::type_traits_internal::IsNothrowSwappable<arch>::value);
486        break;
487    }
488    switch (expected_props::hashable_support) {
489      case ti::hashable::maybe:
490  #if ABSL_META_INTERNAL_STD_HASH_SFINAE_FRIENDLY_
491        EXPECT_FALSE(absl::type_traits_internal::IsHashable<arch>::value);
492  #endif  
493        break;
494      case ti::hashable::yes:
495        EXPECT_TRUE(absl::type_traits_internal::IsHashable<arch>::value);
496        break;
497    }
498  }
499  REGISTER_TYPED_TEST_SUITE_P(ProfileTest, HasAppropriateConstructionProperties,
500                              HasAppropriateAssignmentProperties,
501                              HasAppropriateComparisonProperties,
502                              HasAppropriateAuxilliaryProperties);
503  template <class Profile, class Arch, class ExpectedProfile>
504  struct ProfileAndExpectation {
505    using profile = Profile;
506    using arch = Arch;
507    using expected_profile = ExpectedProfile;
508  };
509  using CoreProfilesToTest = ::testing::Types<
510      ProfileAndExpectation<ti::CombineProfiles<>,
511                            ti::Archetype<ti::CombineProfiles<>>,
512                            ti::ConformanceProfile<>>,
513      ProfileAndExpectation<
514          ti::HasDefaultConstructorProfile, ti::HasDefaultConstructorArchetype,
515          ti::ConformanceProfile<ti::default_constructible::yes>>,
516      ProfileAndExpectation<
517          ti::HasNothrowDefaultConstructorProfile,
518          ti::HasNothrowDefaultConstructorArchetype,
519          ti::ConformanceProfile<ti::default_constructible::nothrow>>,
520      ProfileAndExpectation<
521          ti::HasTrivialDefaultConstructorProfile,
522          ti::HasTrivialDefaultConstructorArchetype,
523          ti::ConformanceProfile<ti::default_constructible::trivial>>,
524      ProfileAndExpectation<
525          ti::HasMoveConstructorProfile, ti::HasMoveConstructorArchetype,
526          ti::ConformanceProfile<ti::default_constructible::maybe,
527                                 ti::move_constructible::yes>>,
528      ProfileAndExpectation<
529          ti::HasNothrowMoveConstructorProfile,
530          ti::HasNothrowMoveConstructorArchetype,
531          ti::ConformanceProfile<ti::default_constructible::maybe,
532                                 ti::move_constructible::nothrow>>,
533      ProfileAndExpectation<
534          ti::HasTrivialMoveConstructorProfile,
535          ti::HasTrivialMoveConstructorArchetype,
536          ti::ConformanceProfile<ti::default_constructible::maybe,
537                                 ti::move_constructible::trivial>>,
538      ProfileAndExpectation<
539          ti::HasCopyConstructorProfile, ti::HasCopyConstructorArchetype,
540          ti::ConformanceProfile<ti::default_constructible::maybe,
541                                 ti::move_constructible::maybe,
542                                 ti::copy_constructible::yes>>,
543      ProfileAndExpectation<
544          ti::HasNothrowCopyConstructorProfile,
545          ti::HasNothrowCopyConstructorArchetype,
546          ti::ConformanceProfile<ti::default_constructible::maybe,
547                                 ti::move_constructible::maybe,
548                                 ti::copy_constructible::nothrow>>,
549      ProfileAndExpectation<
550          ti::HasTrivialCopyConstructorProfile,
551          ti::HasTrivialCopyConstructorArchetype,
552          ti::ConformanceProfile<ti::default_constructible::maybe,
553                                 ti::move_constructible::maybe,
554                                 ti::copy_constructible::trivial>>,
555      ProfileAndExpectation<
556          ti::HasMoveAssignProfile, ti::HasMoveAssignArchetype,
557          ti::ConformanceProfile<
558              ti::default_constructible::maybe, ti::move_constructible::maybe,
559              ti::copy_constructible::maybe, ti::move_assignable::yes>>,
560      ProfileAndExpectation<
561          ti::HasNothrowMoveAssignProfile, ti::HasNothrowMoveAssignArchetype,
562          ti::ConformanceProfile<
563              ti::default_constructible::maybe, ti::move_constructible::maybe,
564              ti::copy_constructible::maybe, ti::move_assignable::nothrow>>,
565      ProfileAndExpectation<
566          ti::HasTrivialMoveAssignProfile, ti::HasTrivialMoveAssignArchetype,
567          ti::ConformanceProfile<
568              ti::default_constructible::maybe, ti::move_constructible::maybe,
569              ti::copy_constructible::maybe, ti::move_assignable::trivial>>,
570      ProfileAndExpectation<
571          ti::HasCopyAssignProfile, ti::HasCopyAssignArchetype,
572          ti::ConformanceProfile<
573              ti::default_constructible::maybe, ti::move_constructible::maybe,
574              ti::copy_constructible::maybe, ti::move_assignable::maybe,
575              ti::copy_assignable::yes>>,
576      ProfileAndExpectation<
577          ti::HasNothrowCopyAssignProfile, ti::HasNothrowCopyAssignArchetype,
578          ti::ConformanceProfile<
579              ti::default_constructible::maybe, ti::move_constructible::maybe,
580              ti::copy_constructible::maybe, ti::move_assignable::maybe,
581              ti::copy_assignable::nothrow>>,
582      ProfileAndExpectation<
583          ti::HasTrivialCopyAssignProfile, ti::HasTrivialCopyAssignArchetype,
584          ti::ConformanceProfile<
585              ti::default_constructible::maybe, ti::move_constructible::maybe,
586              ti::copy_constructible::maybe, ti::move_assignable::maybe,
587              ti::copy_assignable::trivial>>,
588      ProfileAndExpectation<
589          ti::HasDestructorProfile, ti::HasDestructorArchetype,
590          ti::ConformanceProfile<
591              ti::default_constructible::maybe, ti::move_constructible::maybe,
592              ti::copy_constructible::maybe, ti::move_assignable::maybe,
593              ti::copy_assignable::maybe, ti::destructible::yes>>,
594      ProfileAndExpectation<
595          ti::HasNothrowDestructorProfile, ti::HasNothrowDestructorArchetype,
596          ti::ConformanceProfile<
597              ti::default_constructible::maybe, ti::move_constructible::maybe,
598              ti::copy_constructible::maybe, ti::move_assignable::maybe,
599              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
600      ProfileAndExpectation<
601          ti::HasTrivialDestructorProfile, ti::HasTrivialDestructorArchetype,
602          ti::ConformanceProfile<
603              ti::default_constructible::maybe, ti::move_constructible::maybe,
604              ti::copy_constructible::maybe, ti::move_assignable::maybe,
605              ti::copy_assignable::maybe, ti::destructible::trivial>>,
606      ProfileAndExpectation<
607          ti::HasEqualityProfile, ti::HasEqualityArchetype,
608          ti::ConformanceProfile<
609              ti::default_constructible::maybe, ti::move_constructible::maybe,
610              ti::copy_constructible::maybe, ti::move_assignable::maybe,
611              ti::copy_assignable::maybe, ti::destructible::maybe,
612              ti::equality_comparable::yes>>,
613      ProfileAndExpectation<
614          ti::HasNothrowEqualityProfile, ti::HasNothrowEqualityArchetype,
615          ti::ConformanceProfile<
616              ti::default_constructible::maybe, ti::move_constructible::maybe,
617              ti::copy_constructible::maybe, ti::move_assignable::maybe,
618              ti::copy_assignable::maybe, ti::destructible::maybe,
619              ti::equality_comparable::nothrow>>,
620      ProfileAndExpectation<
621          ti::HasInequalityProfile, ti::HasInequalityArchetype,
622          ti::ConformanceProfile<
623              ti::default_constructible::maybe, ti::move_constructible::maybe,
624              ti::copy_constructible::maybe, ti::move_assignable::maybe,
625              ti::copy_assignable::maybe, ti::destructible::maybe,
626              ti::equality_comparable::maybe, ti::inequality_comparable::yes>>,
627      ProfileAndExpectation<
628          ti::HasNothrowInequalityProfile, ti::HasNothrowInequalityArchetype,
629          ti::ConformanceProfile<
630              ti::default_constructible::maybe, ti::move_constructible::maybe,
631              ti::copy_constructible::maybe, ti::move_assignable::maybe,
632              ti::copy_assignable::maybe, ti::destructible::maybe,
633              ti::equality_comparable::maybe,
634              ti::inequality_comparable::nothrow>>,
635      ProfileAndExpectation<
636          ti::HasLessThanProfile, ti::HasLessThanArchetype,
637          ti::ConformanceProfile<
638              ti::default_constructible::maybe, ti::move_constructible::maybe,
639              ti::copy_constructible::maybe, ti::move_assignable::maybe,
640              ti::copy_assignable::maybe, ti::destructible::maybe,
641              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
642              ti::less_than_comparable::yes>>,
643      ProfileAndExpectation<
644          ti::HasNothrowLessThanProfile, ti::HasNothrowLessThanArchetype,
645          ti::ConformanceProfile<
646              ti::default_constructible::maybe, ti::move_constructible::maybe,
647              ti::copy_constructible::maybe, ti::move_assignable::maybe,
648              ti::copy_assignable::maybe, ti::destructible::maybe,
649              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
650              ti::less_than_comparable::nothrow>>,
651      ProfileAndExpectation<
652          ti::HasLessEqualProfile, ti::HasLessEqualArchetype,
653          ti::ConformanceProfile<
654              ti::default_constructible::maybe, ti::move_constructible::maybe,
655              ti::copy_constructible::maybe, ti::move_assignable::maybe,
656              ti::copy_assignable::maybe, ti::destructible::maybe,
657              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
658              ti::less_than_comparable::maybe, ti::less_equal_comparable::yes>>,
659      ProfileAndExpectation<
660          ti::HasNothrowLessEqualProfile, ti::HasNothrowLessEqualArchetype,
661          ti::ConformanceProfile<
662              ti::default_constructible::maybe, ti::move_constructible::maybe,
663              ti::copy_constructible::maybe, ti::move_assignable::maybe,
664              ti::copy_assignable::maybe, ti::destructible::maybe,
665              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
666              ti::less_than_comparable::maybe,
667              ti::less_equal_comparable::nothrow>>,
668      ProfileAndExpectation<
669          ti::HasGreaterEqualProfile, ti::HasGreaterEqualArchetype,
670          ti::ConformanceProfile<
671              ti::default_constructible::maybe, ti::move_constructible::maybe,
672              ti::copy_constructible::maybe, ti::move_assignable::maybe,
673              ti::copy_assignable::maybe, ti::destructible::maybe,
674              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
675              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
676              ti::greater_equal_comparable::yes>>,
677      ProfileAndExpectation<
678          ti::HasNothrowGreaterEqualProfile, ti::HasNothrowGreaterEqualArchetype,
679          ti::ConformanceProfile<
680              ti::default_constructible::maybe, ti::move_constructible::maybe,
681              ti::copy_constructible::maybe, ti::move_assignable::maybe,
682              ti::copy_assignable::maybe, ti::destructible::maybe,
683              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
684              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
685              ti::greater_equal_comparable::nothrow>>,
686      ProfileAndExpectation<
687          ti::HasGreaterThanProfile, ti::HasGreaterThanArchetype,
688          ti::ConformanceProfile<
689              ti::default_constructible::maybe, ti::move_constructible::maybe,
690              ti::copy_constructible::maybe, ti::move_assignable::maybe,
691              ti::copy_assignable::maybe, ti::destructible::maybe,
692              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
693              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
694              ti::greater_equal_comparable::maybe,
695              ti::greater_than_comparable::yes>>,
696      ProfileAndExpectation<
697          ti::HasNothrowGreaterThanProfile, ti::HasNothrowGreaterThanArchetype,
698          ti::ConformanceProfile<
699              ti::default_constructible::maybe, ti::move_constructible::maybe,
700              ti::copy_constructible::maybe, ti::move_assignable::maybe,
701              ti::copy_assignable::maybe, ti::destructible::maybe,
702              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
703              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
704              ti::greater_equal_comparable::maybe,
705              ti::greater_than_comparable::nothrow>>,
706      ProfileAndExpectation<
707          ti::HasSwapProfile, ti::HasSwapArchetype,
708          ti::ConformanceProfile<
709              ti::default_constructible::maybe, ti::move_constructible::maybe,
710              ti::copy_constructible::maybe, ti::move_assignable::maybe,
711              ti::copy_assignable::maybe, ti::destructible::maybe,
712              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
713              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
714              ti::greater_equal_comparable::maybe,
715              ti::greater_than_comparable::maybe, ti::swappable::yes>>,
716      ProfileAndExpectation<
717          ti::HasNothrowSwapProfile, ti::HasNothrowSwapArchetype,
718          ti::ConformanceProfile<
719              ti::default_constructible::maybe, ti::move_constructible::maybe,
720              ti::copy_constructible::maybe, ti::move_assignable::maybe,
721              ti::copy_assignable::maybe, ti::destructible::maybe,
722              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
723              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
724              ti::greater_equal_comparable::maybe,
725              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
726      ProfileAndExpectation<
727          ti::HasStdHashSpecializationProfile,
728          ti::HasStdHashSpecializationArchetype,
729          ti::ConformanceProfile<
730              ti::default_constructible::maybe, ti::move_constructible::maybe,
731              ti::copy_constructible::maybe, ti::move_assignable::maybe,
732              ti::copy_assignable::maybe, ti::destructible::maybe,
733              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
734              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
735              ti::greater_equal_comparable::maybe,
736              ti::greater_than_comparable::maybe, ti::swappable::maybe,
737              ti::hashable::yes>>>;
738  using CommonProfilesToTest = ::testing::Types<
739      ProfileAndExpectation<
740          ti::NothrowMoveConstructibleProfile,
741          ti::NothrowMoveConstructibleArchetype,
742          ti::ConformanceProfile<
743              ti::default_constructible::maybe, ti::move_constructible::nothrow,
744              ti::copy_constructible::maybe, ti::move_assignable::maybe,
745              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
746      ProfileAndExpectation<
747          ti::CopyConstructibleProfile, ti::CopyConstructibleArchetype,
748          ti::ConformanceProfile<
749              ti::default_constructible::maybe, ti::move_constructible::nothrow,
750              ti::copy_constructible::yes, ti::move_assignable::maybe,
751              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
752      ProfileAndExpectation<
753          ti::NothrowMovableProfile, ti::NothrowMovableArchetype,
754          ti::ConformanceProfile<
755              ti::default_constructible::maybe, ti::move_constructible::nothrow,
756              ti::copy_constructible::maybe, ti::move_assignable::nothrow,
757              ti::copy_assignable::maybe, ti::destructible::nothrow,
758              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
759              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
760              ti::greater_equal_comparable::maybe,
761              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
762      ProfileAndExpectation<
763          ti::ValueProfile, ti::ValueArchetype,
764          ti::ConformanceProfile<
765              ti::default_constructible::maybe, ti::move_constructible::nothrow,
766              ti::copy_constructible::yes, ti::move_assignable::nothrow,
767              ti::copy_assignable::yes, ti::destructible::nothrow,
768              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
769              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
770              ti::greater_equal_comparable::maybe,
771              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
772      ProfileAndExpectation<
773          ti::DefaultConstructibleNothrowMoveConstructibleProfile,
774          ti::DefaultConstructibleNothrowMoveConstructibleArchetype,
775          ti::ConformanceProfile<
776              ti::default_constructible::yes, ti::move_constructible::nothrow,
777              ti::copy_constructible::maybe, ti::move_assignable::maybe,
778              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
779      ProfileAndExpectation<
780          ti::DefaultConstructibleCopyConstructibleProfile,
781          ti::DefaultConstructibleCopyConstructibleArchetype,
782          ti::ConformanceProfile<
783              ti::default_constructible::yes, ti::move_constructible::nothrow,
784              ti::copy_constructible::yes, ti::move_assignable::maybe,
785              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
786      ProfileAndExpectation<
787          ti::DefaultConstructibleNothrowMovableProfile,
788          ti::DefaultConstructibleNothrowMovableArchetype,
789          ti::ConformanceProfile<
790              ti::default_constructible::yes, ti::move_constructible::nothrow,
791              ti::copy_constructible::maybe, ti::move_assignable::nothrow,
792              ti::copy_assignable::maybe, ti::destructible::nothrow,
793              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
794              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
795              ti::greater_equal_comparable::maybe,
796              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
797      ProfileAndExpectation<
798          ti::DefaultConstructibleValueProfile,
799          ti::DefaultConstructibleValueArchetype,
800          ti::ConformanceProfile<
801              ti::default_constructible::yes, ti::move_constructible::nothrow,
802              ti::copy_constructible::yes, ti::move_assignable::nothrow,
803              ti::copy_assignable::yes, ti::destructible::nothrow,
804              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
805              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
806              ti::greater_equal_comparable::maybe,
807              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>>;
808  using ComparableHelpersProfilesToTest = ::testing::Types<
809      ProfileAndExpectation<
810          ti::EquatableProfile, ti::EquatableArchetype,
811          ti::ConformanceProfile<
812              ti::default_constructible::maybe, ti::move_constructible::maybe,
813              ti::copy_constructible::maybe, ti::move_assignable::maybe,
814              ti::copy_assignable::maybe, ti::destructible::maybe,
815              ti::equality_comparable::yes, ti::inequality_comparable::yes>>,
816      ProfileAndExpectation<
817          ti::ComparableProfile, ti::ComparableArchetype,
818          ti::ConformanceProfile<
819              ti::default_constructible::maybe, ti::move_constructible::maybe,
820              ti::copy_constructible::maybe, ti::move_assignable::maybe,
821              ti::copy_assignable::maybe, ti::destructible::maybe,
822              ti::equality_comparable::yes, ti::inequality_comparable::yes,
823              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
824              ti::greater_equal_comparable::yes,
825              ti::greater_than_comparable::yes>>,
826      ProfileAndExpectation<
827          ti::NothrowEquatableProfile, ti::NothrowEquatableArchetype,
828          ti::ConformanceProfile<
829              ti::default_constructible::maybe, ti::move_constructible::maybe,
830              ti::copy_constructible::maybe, ti::move_assignable::maybe,
831              ti::copy_assignable::maybe, ti::destructible::maybe,
832              ti::equality_comparable::nothrow,
833              ti::inequality_comparable::nothrow>>,
834      ProfileAndExpectation<
835          ti::NothrowComparableProfile, ti::NothrowComparableArchetype,
836          ti::ConformanceProfile<
837              ti::default_constructible::maybe, ti::move_constructible::maybe,
838              ti::copy_constructible::maybe, ti::move_assignable::maybe,
839              ti::copy_assignable::maybe, ti::destructible::maybe,
840              ti::equality_comparable::nothrow,
841              ti::inequality_comparable::nothrow,
842              ti::less_than_comparable::nothrow,
843              ti::less_equal_comparable::nothrow,
844              ti::greater_equal_comparable::nothrow,
845              ti::greater_than_comparable::nothrow>>>;
846  using CommonComparableProfilesToTest = ::testing::Types<
847      ProfileAndExpectation<
848          ti::ComparableNothrowMoveConstructibleProfile,
849          ti::ComparableNothrowMoveConstructibleArchetype,
850          ti::ConformanceProfile<
851              ti::default_constructible::maybe, ti::move_constructible::nothrow,
852              ti::copy_constructible::maybe, ti::move_assignable::maybe,
853              ti::copy_assignable::maybe, ti::destructible::nothrow,
854              ti::equality_comparable::yes, ti::inequality_comparable::yes,
855              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
856              ti::greater_equal_comparable::yes,
857              ti::greater_than_comparable::yes>>,
858      ProfileAndExpectation<
859          ti::ComparableCopyConstructibleProfile,
860          ti::ComparableCopyConstructibleArchetype,
861          ti::ConformanceProfile<
862              ti::default_constructible::maybe, ti::move_constructible::nothrow,
863              ti::copy_constructible::yes, ti::move_assignable::maybe,
864              ti::copy_assignable::maybe, ti::destructible::nothrow,
865              ti::equality_comparable::yes, ti::inequality_comparable::yes,
866              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
867              ti::greater_equal_comparable::yes,
868              ti::greater_than_comparable::yes>>,
869      ProfileAndExpectation<
870          ti::ComparableNothrowMovableProfile,
871          ti::ComparableNothrowMovableArchetype,
872          ti::ConformanceProfile<
873              ti::default_constructible::maybe, ti::move_constructible::nothrow,
874              ti::copy_constructible::maybe, ti::move_assignable::nothrow,
875              ti::copy_assignable::maybe, ti::destructible::nothrow,
876              ti::equality_comparable::yes, ti::inequality_comparable::yes,
877              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
878              ti::greater_equal_comparable::yes, ti::greater_than_comparable::yes,
879              ti::swappable::nothrow>>,
880      ProfileAndExpectation<
881          ti::ComparableValueProfile, ti::ComparableValueArchetype,
882          ti::ConformanceProfile<
883              ti::default_constructible::maybe, ti::move_constructible::nothrow,
884              ti::copy_constructible::yes, ti::move_assignable::nothrow,
885              ti::copy_assignable::yes, ti::destructible::nothrow,
886              ti::equality_comparable::yes, ti::inequality_comparable::yes,
887              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
888              ti::greater_equal_comparable::yes, ti::greater_than_comparable::yes,
889              ti::swappable::nothrow>>>;
890  using TrivialProfilesToTest = ::testing::Types<
891      ProfileAndExpectation<
892          ti::TrivialSpecialMemberFunctionsProfile,
893          ti::TrivialSpecialMemberFunctionsArchetype,
894          ti::ConformanceProfile<
895              ti::default_constructible::trivial, ti::move_constructible::trivial,
896              ti::copy_constructible::trivial, ti::move_assignable::trivial,
897              ti::copy_assignable::trivial, ti::destructible::trivial,
898              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
899              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
900              ti::greater_equal_comparable::maybe,
901              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
902      ProfileAndExpectation<
903          ti::TriviallyCompleteProfile, ti::TriviallyCompleteArchetype,
904          ti::ConformanceProfile<
905              ti::default_constructible::trivial, ti::move_constructible::trivial,
906              ti::copy_constructible::trivial, ti::move_assignable::trivial,
907              ti::copy_assignable::trivial, ti::destructible::trivial,
908              ti::equality_comparable::yes, ti::inequality_comparable::yes,
909              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
910              ti::greater_equal_comparable::yes, ti::greater_than_comparable::yes,
911              ti::swappable::nothrow, ti::hashable::yes>>>;
912  INSTANTIATE_TYPED_TEST_SUITE_P(Core, ProfileTest, CoreProfilesToTest);
913  INSTANTIATE_TYPED_TEST_SUITE_P(Common, ProfileTest, CommonProfilesToTest);
914  INSTANTIATE_TYPED_TEST_SUITE_P(ComparableHelpers, ProfileTest,
915                                 ComparableHelpersProfilesToTest);
916  INSTANTIATE_TYPED_TEST_SUITE_P(CommonComparable, ProfileTest,
917                                 CommonComparableProfilesToTest);
918  INSTANTIATE_TYPED_TEST_SUITE_P(Trivial, ProfileTest, TrivialProfilesToTest);
919  TEST(ConformanceTestingTest, Basic) {
920    using profile = ti::CombineProfiles<ti::TriviallyCompleteProfile,
921                                        ti::NothrowComparableProfile>;
922    using lim = std::numeric_limits<float>;
923    ABSL_INTERNAL_ASSERT_CONFORMANCE_OF(float)
924        .INITIALIZER(-lim::infinity())
925        .INITIALIZER(lim::lowest())
926        .INITIALIZER(-1.f)
927        .INITIALIZER(-lim::min())
928        .EQUIVALENCE_CLASS(INITIALIZER(-0.f), INITIALIZER(0.f))
929        .INITIALIZER(lim::min())
930        .INITIALIZER(1.f)
931        .INITIALIZER(lim::max())
932        .INITIALIZER(lim::infinity())
933        .WITH_STRICT_PROFILE(absl::types_internal::RegularityDomain, profile);
934  }
935  struct BadMoveConstruct {
936    BadMoveConstruct() = default;
937    BadMoveConstruct(BadMoveConstruct&& other) noexcept
938        : value(other.value + 1) {}
939    BadMoveConstruct& operator=(BadMoveConstruct&& other) noexcept = default;
940    int value = 0;
941    friend bool operator==(BadMoveConstruct const& lhs,
942                           BadMoveConstruct const& rhs) {
943      return lhs.value == rhs.value;
944    }
945    friend bool operator!=(BadMoveConstruct const& lhs,
946                           BadMoveConstruct const& rhs) {
947      return lhs.value != rhs.value;
948    }
949  };
950  struct BadMoveAssign {
951    BadMoveAssign() = default;
952    BadMoveAssign(BadMoveAssign&& other) noexcept = default;
953    BadMoveAssign& operator=(BadMoveAssign&& other) noexcept {
954      int new_value = other.value + 1;
955      value = new_value;
956      return *this;
957    }
958    int value = 0;
959    friend bool operator==(BadMoveAssign const& lhs, BadMoveAssign const& rhs) {
960      return lhs.value == rhs.value;
961    }
962    friend bool operator!=(BadMoveAssign const& lhs, BadMoveAssign const& rhs) {
963      return lhs.value != rhs.value;
964    }
965  };
966  enum class WhichCompIsBad { eq, ne, lt, le, ge, gt };
967  template <WhichCompIsBad Which>
968  struct BadCompare {
969    int value;
970    friend bool operator==(BadCompare const& lhs, BadCompare const& rhs) {
971      return Which == WhichCompIsBad::eq ? lhs.value != rhs.value
972                                         : lhs.value == rhs.value;
973    }
974    friend bool operator!=(BadCompare const& lhs, BadCompare const& rhs) {
975      return Which == WhichCompIsBad::ne ? lhs.value == rhs.value
976                                         : lhs.value != rhs.value;
977    }
978    friend bool operator<(BadCompare const& lhs, BadCompare const& rhs) {
979      return Which == WhichCompIsBad::lt ? lhs.value >= rhs.value
980                                         : lhs.value < rhs.value;
981    }
982    friend bool operator<=(BadCompare const& lhs, BadCompare const& rhs) {
983      return Which == WhichCompIsBad::le ? lhs.value > rhs.value
984                                         : lhs.value <= rhs.value;
985    }
986    friend bool operator>=(BadCompare const& lhs, BadCompare const& rhs) {
987      return Which == WhichCompIsBad::ge ? lhs.value < rhs.value
988                                         : lhs.value >= rhs.value;
989    }
990    friend bool operator>(BadCompare const& lhs, BadCompare const& rhs) {
991      return Which == WhichCompIsBad::gt ? lhs.value <= rhs.value
992                                         : lhs.value > rhs.value;
993    }
994  };
995  TEST(ConformanceTestingDeathTest, Failures) {
996    {
997      using profile = ti::CombineProfiles<ti::TriviallyCompleteProfile,
998                                          ti::NothrowComparableProfile>;
999      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(float)
1000          .INITIALIZER(1.f)
1001          .INITIALIZER(0.f)
1002          .WITH_LOOSE_PROFILE(profile);
1003    }
1004    {
1005      using profile =
1006          ti::CombineProfiles<ti::NothrowMovableProfile, ti::EquatableProfile>;
1007      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadMoveConstruct)
1008          .DUE_TO("Move construction")
1009          .INITIALIZER(BadMoveConstruct())
1010          .WITH_LOOSE_PROFILE(profile);
1011    }
1012    {
1013      using profile =
1014          ti::CombineProfiles<ti::NothrowMovableProfile, ti::EquatableProfile>;
1015      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadMoveAssign)
1016          .DUE_TO("Move assignment")
1017          .INITIALIZER(BadMoveAssign())
1018          .WITH_LOOSE_PROFILE(profile);
1019    }
1020  }
1021  TEST(ConformanceTestingDeathTest, CompFailures) {
1022    using profile = ti::ComparableProfile;
1023    {
1024      using BadComp = BadCompare<WhichCompIsBad::eq>;
1025      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1026          .DUE_TO("Comparison")
1027          .INITIALIZER(BadComp{0})
1028          .INITIALIZER(BadComp{1})
1029          .WITH_LOOSE_PROFILE(profile);
1030    }
1031    {
1032      using BadComp = BadCompare<WhichCompIsBad::ne>;
1033      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1034          .DUE_TO("Comparison")
1035          .INITIALIZER(BadComp{0})
1036          .INITIALIZER(BadComp{1})
1037          .WITH_LOOSE_PROFILE(profile);
1038    }
1039    {
1040      using BadComp = BadCompare<WhichCompIsBad::lt>;
1041      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1042          .DUE_TO("Comparison")
1043          .INITIALIZER(BadComp{0})
1044          .INITIALIZER(BadComp{1})
1045          .WITH_LOOSE_PROFILE(profile);
1046    }
1047    {
1048      using BadComp = BadCompare<WhichCompIsBad::le>;
1049      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1050          .DUE_TO("Comparison")
1051          .INITIALIZER(BadComp{0})
1052          .INITIALIZER(BadComp{1})
1053          .WITH_LOOSE_PROFILE(profile);
1054    }
1055    {
1056      using BadComp = BadCompare<WhichCompIsBad::ge>;
1057      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1058          .DUE_TO("Comparison")
1059          .INITIALIZER(BadComp{0})
1060          .INITIALIZER(BadComp{1})
1061          .WITH_LOOSE_PROFILE(profile);
1062    }
1063    {
1064      using BadComp = BadCompare<WhichCompIsBad::gt>;
1065      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1066          .DUE_TO("Comparison")
1067          .INITIALIZER(BadComp{0})
1068          .INITIALIZER(BadComp{1})
1069          .WITH_LOOSE_PROFILE(profile);
1070    }
1071  }
1072  struct BadSelfMove {
1073    BadSelfMove() = default;
1074    BadSelfMove(BadSelfMove&&) = default;
1075    BadSelfMove& operator=(BadSelfMove&& other) noexcept {
1076      if (this == &other) {
<span onclick='openModal()' class='match'>1077        broken_state = true;
1078      }
1079      return *this;
1080    }
1081    friend bool operator==(const BadSelfMove& lhs, const BadSelfMove& rhs) {
1082      return !(lhs.broken_state || rhs.broken_state);
1083    }
1084    friend bool operator!=(const BadSelfMove& lhs, const BadSelfMove& rhs) {
1085      return lhs.broken_state || rhs.broken_state;
1086    }
1087    bool broken_state = false;
1088  };
1089  TEST(ConformanceTestingDeathTest, SelfMoveFailure) {
1090    using profile = ti::EquatableNothrowMovableProfile;
1091    {
1092      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadSelfMove)
1093          .DUE_TO("Move assignment")
1094          .INITIALIZER(BadSelfMove())
1095          .WITH_LOOSE_PROFILE(profile);
1096    }
1097  }
1098  struct BadSelfCopy {
1099    BadSelfCopy() = default;
</span>1100    BadSelfCopy(BadSelfCopy&&) = default;
1101    BadSelfCopy(const BadSelfCopy&) = default;
1102    BadSelfCopy& operator=(BadSelfCopy&&) = default;
1103    BadSelfCopy& operator=(BadSelfCopy const& other) {
1104      if (this == &other) {
1105        broken_state = true;
1106      }
1107      return *this;
1108    }
1109    friend bool operator==(const BadSelfCopy& lhs, const BadSelfCopy& rhs) {
1110      return !(lhs.broken_state || rhs.broken_state);
1111    }
1112    friend bool operator!=(const BadSelfCopy& lhs, const BadSelfCopy& rhs) {
1113      return lhs.broken_state || rhs.broken_state;
1114    }
1115    bool broken_state = false;
1116  };
1117  TEST(ConformanceTestingDeathTest, SelfCopyFailure) {
1118    using profile = ti::EquatableValueProfile;
1119    {
1120      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadSelfCopy)
1121          .DUE_TO("Copy assignment")
1122          .INITIALIZER(BadSelfCopy())
1123          .WITH_LOOSE_PROFILE(profile);
1124    }
1125  }
1126  struct BadSelfSwap {
1127    friend void swap(BadSelfSwap& lhs, BadSelfSwap& rhs) noexcept {
1128      if (&lhs == &rhs) lhs.broken_state = true;
1129    }
1130    friend bool operator==(const BadSelfSwap& lhs, const BadSelfSwap& rhs) {
1131      return !(lhs.broken_state || rhs.broken_state);
1132    }
1133    friend bool operator!=(const BadSelfSwap& lhs, const BadSelfSwap& rhs) {
1134      return lhs.broken_state || rhs.broken_state;
1135    }
1136    bool broken_state = false;
1137  };
1138  TEST(ConformanceTestingDeathTest, SelfSwapFailure) {
1139    using profile = ti::EquatableNothrowMovableProfile;
1140    {
1141      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadSelfSwap)
1142          .DUE_TO("Swap")
1143          .INITIALIZER(BadSelfSwap())
1144          .WITH_LOOSE_PROFILE(profile);
1145    }
1146  }
1147  struct BadDefaultInitializedMoveAssign {
1148    BadDefaultInitializedMoveAssign() : default_initialized(true) {}
1149    explicit BadDefaultInitializedMoveAssign(int v) : value(v) {}
1150    BadDefaultInitializedMoveAssign(
1151        BadDefaultInitializedMoveAssign&& other) noexcept
1152        : value(other.value) {}
1153    BadDefaultInitializedMoveAssign& operator=(
1154        BadDefaultInitializedMoveAssign&& other) noexcept {
1155      value = other.value;
1156      if (default_initialized) ++value;  
1157      return *this;
1158    }
1159    friend bool operator==(const BadDefaultInitializedMoveAssign& lhs,
1160                           const BadDefaultInitializedMoveAssign& rhs) {
1161      return lhs.value == rhs.value;
1162    }
1163    friend bool operator!=(const BadDefaultInitializedMoveAssign& lhs,
1164                           const BadDefaultInitializedMoveAssign& rhs) {
1165      return lhs.value != rhs.value;
1166    }
1167    bool default_initialized = false;
1168    int value = 0;
1169  };
1170  TEST(ConformanceTestingDeathTest, DefaultInitializedMoveAssignFailure) {
1171    using profile =
1172        ti::CombineProfiles<ti::DefaultConstructibleNothrowMovableProfile,
1173                            ti::EquatableProfile>;
1174    {
1175      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadDefaultInitializedMoveAssign)
1176          .DUE_TO("move assignment")
1177          .INITIALIZER(BadDefaultInitializedMoveAssign(0))
1178          .WITH_LOOSE_PROFILE(profile);
1179    }
1180  }
1181  struct BadDefaultInitializedCopyAssign {
1182    BadDefaultInitializedCopyAssign() : default_initialized(true) {}
1183    explicit BadDefaultInitializedCopyAssign(int v) : value(v) {}
1184    BadDefaultInitializedCopyAssign(
1185        BadDefaultInitializedCopyAssign&& other) noexcept
1186        : value(other.value) {}
1187    BadDefaultInitializedCopyAssign(const BadDefaultInitializedCopyAssign& other)
1188        : value(other.value) {}
1189    BadDefaultInitializedCopyAssign& operator=(
1190        BadDefaultInitializedCopyAssign&& other) noexcept {
1191      value = other.value;
1192      return *this;
1193    }
1194    BadDefaultInitializedCopyAssign& operator=(
1195        const BadDefaultInitializedCopyAssign& other) {
1196      value = other.value;
1197      if (default_initialized) ++value;  
1198      return *this;
1199    }
1200    friend bool operator==(const BadDefaultInitializedCopyAssign& lhs,
1201                           const BadDefaultInitializedCopyAssign& rhs) {
1202      return lhs.value == rhs.value;
1203    }
1204    friend bool operator!=(const BadDefaultInitializedCopyAssign& lhs,
1205                           const BadDefaultInitializedCopyAssign& rhs) {
1206      return lhs.value != rhs.value;
1207    }
1208    bool default_initialized = false;
1209    int value = 0;
1210  };
1211  TEST(ConformanceTestingDeathTest, DefaultInitializedAssignFailure) {
1212    using profile = ti::CombineProfiles<ti::DefaultConstructibleValueProfile,
1213                                        ti::EquatableProfile>;
1214    {
1215      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadDefaultInitializedCopyAssign)
1216          .DUE_TO("copy assignment")
1217          .INITIALIZER(BadDefaultInitializedCopyAssign(0))
1218          .WITH_LOOSE_PROFILE(profile);
1219    }
1220  }
1221  }  
</code></pre>
        </div>
        <div class="column">
            <h3>abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-conformance_testing_test.cc</h3>
            <pre><code>1  #include "absl/types/internal/conformance_testing.h"
2  #include <new>
3  #include <type_traits>
4  #include <utility>
5  #include "gtest/gtest.h"
6  #include "absl/meta/type_traits.h"
7  #include "absl/types/internal/conformance_aliases.h"
8  #include "absl/types/internal/conformance_profile.h"
9  namespace {
10  namespace ti = absl::types_internal;
11  template <class T>
12  using DefaultConstructibleWithNewImpl = decltype(::new (std::nothrow) T);
13  template <class T>
14  using DefaultConstructibleWithNew =
15      absl::type_traits_internal::is_detected<DefaultConstructibleWithNewImpl, T>;
16  template <class T>
17  using MoveConstructibleWithNewImpl =
18      decltype(::new (std::nothrow) T(std::declval<T>()));
19  template <class T>
20  using MoveConstructibleWithNew =
21      absl::type_traits_internal::is_detected<MoveConstructibleWithNewImpl, T>;
22  template <class T>
23  using CopyConstructibleWithNewImpl =
24      decltype(::new (std::nothrow) T(std::declval<const T&>()));
25  template <class T>
26  using CopyConstructibleWithNew =
27      absl::type_traits_internal::is_detected<CopyConstructibleWithNewImpl, T>;
28  template <class T,
29            class Result =
30                std::integral_constant<bool, noexcept(::new (std::nothrow) T)>>
31  using NothrowDefaultConstructibleWithNewImpl =
32      typename std::enable_if<Result::value>::type;
33  template <class T>
34  using NothrowDefaultConstructibleWithNew =
35      absl::type_traits_internal::is_detected<
36          NothrowDefaultConstructibleWithNewImpl, T>;
37  template <class T,
38            class Result = std::integral_constant<
39                bool, noexcept(::new (std::nothrow) T(std::declval<T>()))>>
40  using NothrowMoveConstructibleWithNewImpl =
41      typename std::enable_if<Result::value>::type;
42  template <class T>
43  using NothrowMoveConstructibleWithNew =
44      absl::type_traits_internal::is_detected<NothrowMoveConstructibleWithNewImpl,
45                                              T>;
46  template <class T,
47            class Result = std::integral_constant<
48                bool, noexcept(::new (std::nothrow) T(std::declval<const T&>()))>>
49  using NothrowCopyConstructibleWithNewImpl =
50      typename std::enable_if<Result::value>::type;
51  template <class T>
52  using NothrowCopyConstructibleWithNew =
53      absl::type_traits_internal::is_detected<NothrowCopyConstructibleWithNewImpl,
54                                              T>;
55  #define ABSL_INTERNAL_COMPARISON_OP_EXPR(op) \
56    ((std::declval<const T&>() op std::declval<const T&>()) ? true : true)
57  #define ABSL_INTERNAL_COMPARISON_OP_TRAIT(name, op)                         \
58    template <class T>                                                        \
59    using name##Impl = decltype(ABSL_INTERNAL_COMPARISON_OP_EXPR(op));        \
60                                                                              \
61    template <class T>                                                        \
62    using name = absl::type_traits_internal::is_detected<name##Impl, T>;      \
63                                                                              \
64    template <class T,                                                        \
65              class Result = std::integral_constant<                          \
66                  bool, noexcept(ABSL_INTERNAL_COMPARISON_OP_EXPR(op))>>      \
67    using Nothrow##name##Impl = typename std::enable_if<Result::value>::type; \
68                                                                              \
69    template <class T>                                                        \
70    using Nothrow##name =                                                     \
71        absl::type_traits_internal::is_detected<Nothrow##name##Impl, T>
72  ABSL_INTERNAL_COMPARISON_OP_TRAIT(EqualityComparable, ==);
73  ABSL_INTERNAL_COMPARISON_OP_TRAIT(InequalityComparable, !=);
74  ABSL_INTERNAL_COMPARISON_OP_TRAIT(LessThanComparable, <);
75  ABSL_INTERNAL_COMPARISON_OP_TRAIT(LessEqualComparable, <=);
76  ABSL_INTERNAL_COMPARISON_OP_TRAIT(GreaterEqualComparable, >=);
77  ABSL_INTERNAL_COMPARISON_OP_TRAIT(GreaterThanComparable, >);
78  #undef ABSL_INTERNAL_COMPARISON_OP_TRAIT
79  template <class T>
80  class ProfileTest : public ::testing::Test {};
81  TYPED_TEST_SUITE_P(ProfileTest);
82  TYPED_TEST_P(ProfileTest, HasAppropriateConstructionProperties) {
83    using profile = typename TypeParam::profile;
84    using arch = typename TypeParam::arch;
85    using expected_profile = typename TypeParam::expected_profile;
86    using props = ti::PropertiesOfT<profile>;
87    using arch_props = ti::PropertiesOfArchetypeT<arch>;
88    using expected_props = ti::PropertiesOfT<expected_profile>;
89    EXPECT_TRUE((std::is_same<props, arch_props>::value));
90    EXPECT_TRUE((std::is_same<props, expected_props>::value));
91    EXPECT_TRUE((std::is_same<arch_props, expected_props>::value));
92    EXPECT_EQ(props::default_constructible_support,
93              expected_props::default_constructible_support);
94    EXPECT_EQ(props::move_constructible_support,
95              expected_props::move_constructible_support);
96    EXPECT_EQ(props::copy_constructible_support,
97              expected_props::copy_constructible_support);
98    EXPECT_EQ(props::destructible_support, expected_props::destructible_support);
99    if (!std::is_same<props, arch_props>::value) {
100      EXPECT_EQ(arch_props::default_constructible_support,
101                expected_props::default_constructible_support);
102      EXPECT_EQ(arch_props::move_constructible_support,
103                expected_props::move_constructible_support);
104      EXPECT_EQ(arch_props::copy_constructible_support,
105                expected_props::copy_constructible_support);
106      EXPECT_EQ(arch_props::destructible_support,
107                expected_props::destructible_support);
108    }
109    EXPECT_EQ(props::default_constructible_support,
110              expected_props::default_constructible_support);
111    switch (expected_props::default_constructible_support) {
112      case ti::default_constructible::maybe:
113        EXPECT_FALSE(DefaultConstructibleWithNew<arch>::value);
114        EXPECT_FALSE(NothrowDefaultConstructibleWithNew<arch>::value);
115        if (std::is_destructible<arch>::value) {
116          EXPECT_FALSE(std::is_default_constructible<arch>::value);
117          EXPECT_FALSE(std::is_nothrow_default_constructible<arch>::value);
118          EXPECT_FALSE(absl::is_trivially_default_constructible<arch>::value);
119        }
120        break;
121      case ti::default_constructible::yes:
122        EXPECT_TRUE(DefaultConstructibleWithNew<arch>::value);
123        EXPECT_FALSE(NothrowDefaultConstructibleWithNew<arch>::value);
124        if (std::is_destructible<arch>::value) {
125          EXPECT_TRUE(std::is_default_constructible<arch>::value);
126          EXPECT_FALSE(std::is_nothrow_default_constructible<arch>::value);
127          EXPECT_FALSE(absl::is_trivially_default_constructible<arch>::value);
128        }
129        break;
130      case ti::default_constructible::nothrow:
131        EXPECT_TRUE(DefaultConstructibleWithNew<arch>::value);
132        EXPECT_TRUE(NothrowDefaultConstructibleWithNew<arch>::value);
133        if (std::is_destructible<arch>::value) {
134          EXPECT_TRUE(std::is_default_constructible<arch>::value);
135          EXPECT_TRUE(std::is_nothrow_default_constructible<arch>::value);
136          EXPECT_FALSE(absl::is_trivially_default_constructible<arch>::value);
137          if (std::is_nothrow_destructible<arch>::value) {
138            EXPECT_TRUE(std::is_nothrow_default_constructible<arch>::value);
139          }
140        }
141        break;
142      case ti::default_constructible::trivial:
143        EXPECT_TRUE(DefaultConstructibleWithNew<arch>::value);
144        EXPECT_TRUE(NothrowDefaultConstructibleWithNew<arch>::value);
145        if (std::is_destructible<arch>::value) {
146          EXPECT_TRUE(std::is_default_constructible<arch>::value);
147          EXPECT_TRUE(std::is_nothrow_default_constructible<arch>::value);
148          if (absl::is_trivially_destructible<arch>::value) {
149            EXPECT_TRUE(absl::is_trivially_default_constructible<arch>::value);
150          }
151        }
152        break;
153    }
154    EXPECT_EQ(props::move_constructible_support,
155              expected_props::move_constructible_support);
156    switch (expected_props::move_constructible_support) {
157      case ti::move_constructible::maybe:
158        EXPECT_FALSE(MoveConstructibleWithNew<arch>::value);
159        EXPECT_FALSE(NothrowMoveConstructibleWithNew<arch>::value);
160        if (std::is_destructible<arch>::value) {
161          EXPECT_FALSE(std::is_move_constructible<arch>::value);
162          EXPECT_FALSE(std::is_nothrow_move_constructible<arch>::value);
163          EXPECT_FALSE(absl::is_trivially_move_constructible<arch>::value);
164        }
165        break;
166      case ti::move_constructible::yes:
167        EXPECT_TRUE(MoveConstructibleWithNew<arch>::value);
168        EXPECT_FALSE(NothrowMoveConstructibleWithNew<arch>::value);
169        if (std::is_destructible<arch>::value) {
170          EXPECT_TRUE(std::is_move_constructible<arch>::value);
171          EXPECT_FALSE(std::is_nothrow_move_constructible<arch>::value);
172          EXPECT_FALSE(absl::is_trivially_move_constructible<arch>::value);
173        }
174        break;
175      case ti::move_constructible::nothrow:
176        EXPECT_TRUE(MoveConstructibleWithNew<arch>::value);
177        EXPECT_TRUE(NothrowMoveConstructibleWithNew<arch>::value);
178        if (std::is_destructible<arch>::value) {
179          EXPECT_TRUE(std::is_move_constructible<arch>::value);
180          EXPECT_TRUE(std::is_nothrow_move_constructible<arch>::value);
181          EXPECT_FALSE(absl::is_trivially_move_constructible<arch>::value);
182          if (std::is_nothrow_destructible<arch>::value) {
183            EXPECT_TRUE(std::is_nothrow_move_constructible<arch>::value);
184          }
185        }
186        break;
187      case ti::move_constructible::trivial:
188        EXPECT_TRUE(MoveConstructibleWithNew<arch>::value);
189        EXPECT_TRUE(NothrowMoveConstructibleWithNew<arch>::value);
190        if (std::is_destructible<arch>::value) {
191          EXPECT_TRUE(std::is_move_constructible<arch>::value);
192          EXPECT_TRUE(std::is_nothrow_move_constructible<arch>::value);
193          if (absl::is_trivially_destructible<arch>::value) {
194            EXPECT_TRUE(absl::is_trivially_move_constructible<arch>::value);
195          }
196        }
197        break;
198    }
199    EXPECT_EQ(props::copy_constructible_support,
200              expected_props::copy_constructible_support);
201    switch (expected_props::copy_constructible_support) {
202      case ti::copy_constructible::maybe:
203        EXPECT_FALSE(CopyConstructibleWithNew<arch>::value);
204        EXPECT_FALSE(NothrowCopyConstructibleWithNew<arch>::value);
205        if (std::is_destructible<arch>::value) {
206          EXPECT_FALSE(std::is_copy_constructible<arch>::value);
207          EXPECT_FALSE(std::is_nothrow_copy_constructible<arch>::value);
208          EXPECT_FALSE(absl::is_trivially_copy_constructible<arch>::value);
209        }
210        break;
211      case ti::copy_constructible::yes:
212        EXPECT_TRUE(CopyConstructibleWithNew<arch>::value);
213        EXPECT_FALSE(NothrowCopyConstructibleWithNew<arch>::value);
214        if (std::is_destructible<arch>::value) {
215          EXPECT_TRUE(std::is_copy_constructible<arch>::value);
216          EXPECT_FALSE(std::is_nothrow_copy_constructible<arch>::value);
217          EXPECT_FALSE(absl::is_trivially_copy_constructible<arch>::value);
218        }
219        break;
220      case ti::copy_constructible::nothrow:
221        EXPECT_TRUE(CopyConstructibleWithNew<arch>::value);
222        EXPECT_TRUE(NothrowCopyConstructibleWithNew<arch>::value);
223        if (std::is_destructible<arch>::value) {
224          EXPECT_TRUE(std::is_copy_constructible<arch>::value);
225          EXPECT_TRUE(std::is_nothrow_copy_constructible<arch>::value);
226          EXPECT_FALSE(absl::is_trivially_copy_constructible<arch>::value);
227          if (std::is_nothrow_destructible<arch>::value) {
228            EXPECT_TRUE(std::is_nothrow_copy_constructible<arch>::value);
229          }
230        }
231        break;
232      case ti::copy_constructible::trivial:
233        EXPECT_TRUE(CopyConstructibleWithNew<arch>::value);
234        EXPECT_TRUE(NothrowCopyConstructibleWithNew<arch>::value);
235        if (std::is_destructible<arch>::value) {
236          EXPECT_TRUE(std::is_copy_constructible<arch>::value);
237          EXPECT_TRUE(std::is_nothrow_copy_constructible<arch>::value);
238          if (absl::is_trivially_destructible<arch>::value) {
239            EXPECT_TRUE(absl::is_trivially_copy_constructible<arch>::value);
240          }
241        }
242        break;
243    }
244    EXPECT_EQ(props::destructible_support, expected_props::destructible_support);
245    switch (expected_props::destructible_support) {
246      case ti::destructible::maybe:
247        EXPECT_FALSE(std::is_destructible<arch>::value);
248        EXPECT_FALSE(std::is_nothrow_destructible<arch>::value);
249        EXPECT_FALSE(absl::is_trivially_destructible<arch>::value);
250        break;
251      case ti::destructible::yes:
252        EXPECT_TRUE(std::is_destructible<arch>::value);
253        EXPECT_FALSE(std::is_nothrow_destructible<arch>::value);
254        EXPECT_FALSE(absl::is_trivially_destructible<arch>::value);
255        break;
256      case ti::destructible::nothrow:
257        EXPECT_TRUE(std::is_destructible<arch>::value);
258        EXPECT_TRUE(std::is_nothrow_destructible<arch>::value);
259        EXPECT_FALSE(absl::is_trivially_destructible<arch>::value);
260        break;
261      case ti::destructible::trivial:
262        EXPECT_TRUE(std::is_destructible<arch>::value);
263        EXPECT_TRUE(std::is_nothrow_destructible<arch>::value);
264        EXPECT_TRUE(absl::is_trivially_destructible<arch>::value);
265        break;
266    }
267  }
268  TYPED_TEST_P(ProfileTest, HasAppropriateAssignmentProperties) {
269    using profile = typename TypeParam::profile;
270    using arch = typename TypeParam::arch;
271    using expected_profile = typename TypeParam::expected_profile;
272    using props = ti::PropertiesOfT<profile>;
273    using arch_props = ti::PropertiesOfArchetypeT<arch>;
274    using expected_props = ti::PropertiesOfT<expected_profile>;
275    EXPECT_TRUE((std::is_same<props, arch_props>::value));
276    EXPECT_TRUE((std::is_same<props, expected_props>::value));
277    EXPECT_TRUE((std::is_same<arch_props, expected_props>::value));
278    EXPECT_EQ(props::move_assignable_support,
279              expected_props::move_assignable_support);
280    EXPECT_EQ(props::copy_assignable_support,
281              expected_props::copy_assignable_support);
282    if (!std::is_same<props, arch_props>::value) {
283      EXPECT_EQ(arch_props::move_assignable_support,
284                expected_props::move_assignable_support);
285      EXPECT_EQ(arch_props::copy_assignable_support,
286                expected_props::copy_assignable_support);
287    }
288    EXPECT_EQ(props::move_assignable_support,
289              expected_props::move_assignable_support);
290    switch (expected_props::move_assignable_support) {
291      case ti::move_assignable::maybe:
292        EXPECT_FALSE(std::is_move_assignable<arch>::value);
293        EXPECT_FALSE(std::is_nothrow_move_assignable<arch>::value);
294        EXPECT_FALSE(absl::is_trivially_move_assignable<arch>::value);
295        break;
296      case ti::move_assignable::yes:
297        EXPECT_TRUE(std::is_move_assignable<arch>::value);
298        EXPECT_FALSE(std::is_nothrow_move_assignable<arch>::value);
299        EXPECT_FALSE(absl::is_trivially_move_assignable<arch>::value);
300        break;
301      case ti::move_assignable::nothrow:
302        EXPECT_TRUE(std::is_move_assignable<arch>::value);
303        EXPECT_TRUE(std::is_nothrow_move_assignable<arch>::value);
304        EXPECT_FALSE(absl::is_trivially_move_assignable<arch>::value);
305        break;
306      case ti::move_assignable::trivial:
307        EXPECT_TRUE(std::is_move_assignable<arch>::value);
308        EXPECT_TRUE(std::is_nothrow_move_assignable<arch>::value);
309        EXPECT_TRUE(absl::is_trivially_move_assignable<arch>::value);
310        break;
311    }
312    EXPECT_EQ(props::copy_assignable_support,
313              expected_props::copy_assignable_support);
314    switch (expected_props::copy_assignable_support) {
315      case ti::copy_assignable::maybe:
316        EXPECT_FALSE(std::is_copy_assignable<arch>::value);
317        EXPECT_FALSE(std::is_nothrow_copy_assignable<arch>::value);
318        EXPECT_FALSE(absl::is_trivially_copy_assignable<arch>::value);
319        break;
320      case ti::copy_assignable::yes:
321        EXPECT_TRUE(std::is_copy_assignable<arch>::value);
322        EXPECT_FALSE(std::is_nothrow_copy_assignable<arch>::value);
323        EXPECT_FALSE(absl::is_trivially_copy_assignable<arch>::value);
324        break;
325      case ti::copy_assignable::nothrow:
326        EXPECT_TRUE(std::is_copy_assignable<arch>::value);
327        EXPECT_TRUE(std::is_nothrow_copy_assignable<arch>::value);
328        EXPECT_FALSE(absl::is_trivially_copy_assignable<arch>::value);
329        break;
330      case ti::copy_assignable::trivial:
331        EXPECT_TRUE(std::is_copy_assignable<arch>::value);
332        EXPECT_TRUE(std::is_nothrow_copy_assignable<arch>::value);
333        EXPECT_TRUE(absl::is_trivially_copy_assignable<arch>::value);
334        break;
335    }
336  }
337  TYPED_TEST_P(ProfileTest, HasAppropriateComparisonProperties) {
338    using profile = typename TypeParam::profile;
339    using arch = typename TypeParam::arch;
340    using expected_profile = typename TypeParam::expected_profile;
341    using props = ti::PropertiesOfT<profile>;
342    using arch_props = ti::PropertiesOfArchetypeT<arch>;
343    using expected_props = ti::PropertiesOfT<expected_profile>;
344    EXPECT_TRUE((std::is_same<props, arch_props>::value));
345    EXPECT_TRUE((std::is_same<props, expected_props>::value));
346    EXPECT_TRUE((std::is_same<arch_props, expected_props>::value));
347    EXPECT_EQ(props::equality_comparable_support,
348              expected_props::equality_comparable_support);
349    EXPECT_EQ(props::inequality_comparable_support,
350              expected_props::inequality_comparable_support);
351    EXPECT_EQ(props::less_than_comparable_support,
352              expected_props::less_than_comparable_support);
353    EXPECT_EQ(props::less_equal_comparable_support,
354              expected_props::less_equal_comparable_support);
355    EXPECT_EQ(props::greater_equal_comparable_support,
356              expected_props::greater_equal_comparable_support);
357    EXPECT_EQ(props::greater_than_comparable_support,
358              expected_props::greater_than_comparable_support);
359    if (!std::is_same<props, arch_props>::value) {
360      EXPECT_EQ(arch_props::equality_comparable_support,
361                expected_props::equality_comparable_support);
362      EXPECT_EQ(arch_props::inequality_comparable_support,
363                expected_props::inequality_comparable_support);
364      EXPECT_EQ(arch_props::less_than_comparable_support,
365                expected_props::less_than_comparable_support);
366      EXPECT_EQ(arch_props::less_equal_comparable_support,
367                expected_props::less_equal_comparable_support);
368      EXPECT_EQ(arch_props::greater_equal_comparable_support,
369                expected_props::greater_equal_comparable_support);
370      EXPECT_EQ(arch_props::greater_than_comparable_support,
371                expected_props::greater_than_comparable_support);
372    }
373    switch (expected_props::equality_comparable_support) {
374      case ti::equality_comparable::maybe:
375        EXPECT_FALSE(EqualityComparable<arch>::value);
376        EXPECT_FALSE(NothrowEqualityComparable<arch>::value);
377        break;
378      case ti::equality_comparable::yes:
379        EXPECT_TRUE(EqualityComparable<arch>::value);
380        EXPECT_FALSE(NothrowEqualityComparable<arch>::value);
381        break;
382      case ti::equality_comparable::nothrow:
383        EXPECT_TRUE(EqualityComparable<arch>::value);
384        EXPECT_TRUE(NothrowEqualityComparable<arch>::value);
385        break;
386    }
387    switch (expected_props::inequality_comparable_support) {
388      case ti::inequality_comparable::maybe:
389        EXPECT_FALSE(InequalityComparable<arch>::value);
390        EXPECT_FALSE(NothrowInequalityComparable<arch>::value);
391        break;
392      case ti::inequality_comparable::yes:
393        EXPECT_TRUE(InequalityComparable<arch>::value);
394        EXPECT_FALSE(NothrowInequalityComparable<arch>::value);
395        break;
396      case ti::inequality_comparable::nothrow:
397        EXPECT_TRUE(InequalityComparable<arch>::value);
398        EXPECT_TRUE(NothrowInequalityComparable<arch>::value);
399        break;
400    }
401    switch (expected_props::less_than_comparable_support) {
402      case ti::less_than_comparable::maybe:
403        EXPECT_FALSE(LessThanComparable<arch>::value);
404        EXPECT_FALSE(NothrowLessThanComparable<arch>::value);
405        break;
406      case ti::less_than_comparable::yes:
407        EXPECT_TRUE(LessThanComparable<arch>::value);
408        EXPECT_FALSE(NothrowLessThanComparable<arch>::value);
409        break;
410      case ti::less_than_comparable::nothrow:
411        EXPECT_TRUE(LessThanComparable<arch>::value);
412        EXPECT_TRUE(NothrowLessThanComparable<arch>::value);
413        break;
414    }
415    switch (expected_props::less_equal_comparable_support) {
416      case ti::less_equal_comparable::maybe:
417        EXPECT_FALSE(LessEqualComparable<arch>::value);
418        EXPECT_FALSE(NothrowLessEqualComparable<arch>::value);
419        break;
420      case ti::less_equal_comparable::yes:
421        EXPECT_TRUE(LessEqualComparable<arch>::value);
422        EXPECT_FALSE(NothrowLessEqualComparable<arch>::value);
423        break;
424      case ti::less_equal_comparable::nothrow:
425        EXPECT_TRUE(LessEqualComparable<arch>::value);
426        EXPECT_TRUE(NothrowLessEqualComparable<arch>::value);
427        break;
428    }
429    switch (expected_props::greater_equal_comparable_support) {
430      case ti::greater_equal_comparable::maybe:
431        EXPECT_FALSE(GreaterEqualComparable<arch>::value);
432        EXPECT_FALSE(NothrowGreaterEqualComparable<arch>::value);
433        break;
434      case ti::greater_equal_comparable::yes:
435        EXPECT_TRUE(GreaterEqualComparable<arch>::value);
436        EXPECT_FALSE(NothrowGreaterEqualComparable<arch>::value);
437        break;
438      case ti::greater_equal_comparable::nothrow:
439        EXPECT_TRUE(GreaterEqualComparable<arch>::value);
440        EXPECT_TRUE(NothrowGreaterEqualComparable<arch>::value);
441        break;
442    }
443    switch (expected_props::greater_than_comparable_support) {
444      case ti::greater_than_comparable::maybe:
445        EXPECT_FALSE(GreaterThanComparable<arch>::value);
446        EXPECT_FALSE(NothrowGreaterThanComparable<arch>::value);
447        break;
448      case ti::greater_than_comparable::yes:
449        EXPECT_TRUE(GreaterThanComparable<arch>::value);
450        EXPECT_FALSE(NothrowGreaterThanComparable<arch>::value);
451        break;
452      case ti::greater_than_comparable::nothrow:
453        EXPECT_TRUE(GreaterThanComparable<arch>::value);
454        EXPECT_TRUE(NothrowGreaterThanComparable<arch>::value);
455        break;
456    }
457  }
458  TYPED_TEST_P(ProfileTest, HasAppropriateAuxilliaryProperties) {
459    using profile = typename TypeParam::profile;
460    using arch = typename TypeParam::arch;
461    using expected_profile = typename TypeParam::expected_profile;
462    using props = ti::PropertiesOfT<profile>;
463    using arch_props = ti::PropertiesOfArchetypeT<arch>;
464    using expected_props = ti::PropertiesOfT<expected_profile>;
465    EXPECT_TRUE((std::is_same<props, arch_props>::value));
466    EXPECT_TRUE((std::is_same<props, expected_props>::value));
467    EXPECT_TRUE((std::is_same<arch_props, expected_props>::value));
468    EXPECT_EQ(props::swappable_support, expected_props::swappable_support);
469    EXPECT_EQ(props::hashable_support, expected_props::hashable_support);
470    if (!std::is_same<props, arch_props>::value) {
471      EXPECT_EQ(arch_props::swappable_support, expected_props::swappable_support);
472      EXPECT_EQ(arch_props::hashable_support, expected_props::hashable_support);
473    }
474    switch (expected_props::swappable_support) {
475      case ti::swappable::maybe:
476        EXPECT_FALSE(absl::type_traits_internal::IsSwappable<arch>::value);
477        EXPECT_FALSE(absl::type_traits_internal::IsNothrowSwappable<arch>::value);
478        break;
479      case ti::swappable::yes:
480        EXPECT_TRUE(absl::type_traits_internal::IsSwappable<arch>::value);
481        EXPECT_FALSE(absl::type_traits_internal::IsNothrowSwappable<arch>::value);
482        break;
483      case ti::swappable::nothrow:
484        EXPECT_TRUE(absl::type_traits_internal::IsSwappable<arch>::value);
485        EXPECT_TRUE(absl::type_traits_internal::IsNothrowSwappable<arch>::value);
486        break;
487    }
488    switch (expected_props::hashable_support) {
489      case ti::hashable::maybe:
490  #if ABSL_META_INTERNAL_STD_HASH_SFINAE_FRIENDLY_
491        EXPECT_FALSE(absl::type_traits_internal::IsHashable<arch>::value);
492  #endif  
493        break;
494      case ti::hashable::yes:
495        EXPECT_TRUE(absl::type_traits_internal::IsHashable<arch>::value);
496        break;
497    }
498  }
499  REGISTER_TYPED_TEST_SUITE_P(ProfileTest, HasAppropriateConstructionProperties,
500                              HasAppropriateAssignmentProperties,
501                              HasAppropriateComparisonProperties,
502                              HasAppropriateAuxilliaryProperties);
503  template <class Profile, class Arch, class ExpectedProfile>
504  struct ProfileAndExpectation {
505    using profile = Profile;
506    using arch = Arch;
507    using expected_profile = ExpectedProfile;
508  };
509  using CoreProfilesToTest = ::testing::Types<
510      ProfileAndExpectation<ti::CombineProfiles<>,
511                            ti::Archetype<ti::CombineProfiles<>>,
512                            ti::ConformanceProfile<>>,
513      ProfileAndExpectation<
514          ti::HasDefaultConstructorProfile, ti::HasDefaultConstructorArchetype,
515          ti::ConformanceProfile<ti::default_constructible::yes>>,
516      ProfileAndExpectation<
517          ti::HasNothrowDefaultConstructorProfile,
518          ti::HasNothrowDefaultConstructorArchetype,
519          ti::ConformanceProfile<ti::default_constructible::nothrow>>,
520      ProfileAndExpectation<
521          ti::HasTrivialDefaultConstructorProfile,
522          ti::HasTrivialDefaultConstructorArchetype,
523          ti::ConformanceProfile<ti::default_constructible::trivial>>,
524      ProfileAndExpectation<
525          ti::HasMoveConstructorProfile, ti::HasMoveConstructorArchetype,
526          ti::ConformanceProfile<ti::default_constructible::maybe,
527                                 ti::move_constructible::yes>>,
528      ProfileAndExpectation<
529          ti::HasNothrowMoveConstructorProfile,
530          ti::HasNothrowMoveConstructorArchetype,
531          ti::ConformanceProfile<ti::default_constructible::maybe,
532                                 ti::move_constructible::nothrow>>,
533      ProfileAndExpectation<
534          ti::HasTrivialMoveConstructorProfile,
535          ti::HasTrivialMoveConstructorArchetype,
536          ti::ConformanceProfile<ti::default_constructible::maybe,
537                                 ti::move_constructible::trivial>>,
538      ProfileAndExpectation<
539          ti::HasCopyConstructorProfile, ti::HasCopyConstructorArchetype,
540          ti::ConformanceProfile<ti::default_constructible::maybe,
541                                 ti::move_constructible::maybe,
542                                 ti::copy_constructible::yes>>,
543      ProfileAndExpectation<
544          ti::HasNothrowCopyConstructorProfile,
545          ti::HasNothrowCopyConstructorArchetype,
546          ti::ConformanceProfile<ti::default_constructible::maybe,
547                                 ti::move_constructible::maybe,
548                                 ti::copy_constructible::nothrow>>,
549      ProfileAndExpectation<
550          ti::HasTrivialCopyConstructorProfile,
551          ti::HasTrivialCopyConstructorArchetype,
552          ti::ConformanceProfile<ti::default_constructible::maybe,
553                                 ti::move_constructible::maybe,
554                                 ti::copy_constructible::trivial>>,
555      ProfileAndExpectation<
556          ti::HasMoveAssignProfile, ti::HasMoveAssignArchetype,
557          ti::ConformanceProfile<
558              ti::default_constructible::maybe, ti::move_constructible::maybe,
559              ti::copy_constructible::maybe, ti::move_assignable::yes>>,
560      ProfileAndExpectation<
561          ti::HasNothrowMoveAssignProfile, ti::HasNothrowMoveAssignArchetype,
562          ti::ConformanceProfile<
563              ti::default_constructible::maybe, ti::move_constructible::maybe,
564              ti::copy_constructible::maybe, ti::move_assignable::nothrow>>,
565      ProfileAndExpectation<
566          ti::HasTrivialMoveAssignProfile, ti::HasTrivialMoveAssignArchetype,
567          ti::ConformanceProfile<
568              ti::default_constructible::maybe, ti::move_constructible::maybe,
569              ti::copy_constructible::maybe, ti::move_assignable::trivial>>,
570      ProfileAndExpectation<
571          ti::HasCopyAssignProfile, ti::HasCopyAssignArchetype,
572          ti::ConformanceProfile<
573              ti::default_constructible::maybe, ti::move_constructible::maybe,
574              ti::copy_constructible::maybe, ti::move_assignable::maybe,
575              ti::copy_assignable::yes>>,
576      ProfileAndExpectation<
577          ti::HasNothrowCopyAssignProfile, ti::HasNothrowCopyAssignArchetype,
578          ti::ConformanceProfile<
579              ti::default_constructible::maybe, ti::move_constructible::maybe,
580              ti::copy_constructible::maybe, ti::move_assignable::maybe,
581              ti::copy_assignable::nothrow>>,
582      ProfileAndExpectation<
583          ti::HasTrivialCopyAssignProfile, ti::HasTrivialCopyAssignArchetype,
584          ti::ConformanceProfile<
585              ti::default_constructible::maybe, ti::move_constructible::maybe,
586              ti::copy_constructible::maybe, ti::move_assignable::maybe,
587              ti::copy_assignable::trivial>>,
588      ProfileAndExpectation<
589          ti::HasDestructorProfile, ti::HasDestructorArchetype,
590          ti::ConformanceProfile<
591              ti::default_constructible::maybe, ti::move_constructible::maybe,
592              ti::copy_constructible::maybe, ti::move_assignable::maybe,
593              ti::copy_assignable::maybe, ti::destructible::yes>>,
594      ProfileAndExpectation<
595          ti::HasNothrowDestructorProfile, ti::HasNothrowDestructorArchetype,
596          ti::ConformanceProfile<
597              ti::default_constructible::maybe, ti::move_constructible::maybe,
598              ti::copy_constructible::maybe, ti::move_assignable::maybe,
599              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
600      ProfileAndExpectation<
601          ti::HasTrivialDestructorProfile, ti::HasTrivialDestructorArchetype,
602          ti::ConformanceProfile<
603              ti::default_constructible::maybe, ti::move_constructible::maybe,
604              ti::copy_constructible::maybe, ti::move_assignable::maybe,
605              ti::copy_assignable::maybe, ti::destructible::trivial>>,
606      ProfileAndExpectation<
607          ti::HasEqualityProfile, ti::HasEqualityArchetype,
608          ti::ConformanceProfile<
609              ti::default_constructible::maybe, ti::move_constructible::maybe,
610              ti::copy_constructible::maybe, ti::move_assignable::maybe,
611              ti::copy_assignable::maybe, ti::destructible::maybe,
612              ti::equality_comparable::yes>>,
613      ProfileAndExpectation<
614          ti::HasNothrowEqualityProfile, ti::HasNothrowEqualityArchetype,
615          ti::ConformanceProfile<
616              ti::default_constructible::maybe, ti::move_constructible::maybe,
617              ti::copy_constructible::maybe, ti::move_assignable::maybe,
618              ti::copy_assignable::maybe, ti::destructible::maybe,
619              ti::equality_comparable::nothrow>>,
620      ProfileAndExpectation<
621          ti::HasInequalityProfile, ti::HasInequalityArchetype,
622          ti::ConformanceProfile<
623              ti::default_constructible::maybe, ti::move_constructible::maybe,
624              ti::copy_constructible::maybe, ti::move_assignable::maybe,
625              ti::copy_assignable::maybe, ti::destructible::maybe,
626              ti::equality_comparable::maybe, ti::inequality_comparable::yes>>,
627      ProfileAndExpectation<
628          ti::HasNothrowInequalityProfile, ti::HasNothrowInequalityArchetype,
629          ti::ConformanceProfile<
630              ti::default_constructible::maybe, ti::move_constructible::maybe,
631              ti::copy_constructible::maybe, ti::move_assignable::maybe,
632              ti::copy_assignable::maybe, ti::destructible::maybe,
633              ti::equality_comparable::maybe,
634              ti::inequality_comparable::nothrow>>,
635      ProfileAndExpectation<
636          ti::HasLessThanProfile, ti::HasLessThanArchetype,
637          ti::ConformanceProfile<
638              ti::default_constructible::maybe, ti::move_constructible::maybe,
639              ti::copy_constructible::maybe, ti::move_assignable::maybe,
640              ti::copy_assignable::maybe, ti::destructible::maybe,
641              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
642              ti::less_than_comparable::yes>>,
643      ProfileAndExpectation<
644          ti::HasNothrowLessThanProfile, ti::HasNothrowLessThanArchetype,
645          ti::ConformanceProfile<
646              ti::default_constructible::maybe, ti::move_constructible::maybe,
647              ti::copy_constructible::maybe, ti::move_assignable::maybe,
648              ti::copy_assignable::maybe, ti::destructible::maybe,
649              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
650              ti::less_than_comparable::nothrow>>,
651      ProfileAndExpectation<
652          ti::HasLessEqualProfile, ti::HasLessEqualArchetype,
653          ti::ConformanceProfile<
654              ti::default_constructible::maybe, ti::move_constructible::maybe,
655              ti::copy_constructible::maybe, ti::move_assignable::maybe,
656              ti::copy_assignable::maybe, ti::destructible::maybe,
657              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
658              ti::less_than_comparable::maybe, ti::less_equal_comparable::yes>>,
659      ProfileAndExpectation<
660          ti::HasNothrowLessEqualProfile, ti::HasNothrowLessEqualArchetype,
661          ti::ConformanceProfile<
662              ti::default_constructible::maybe, ti::move_constructible::maybe,
663              ti::copy_constructible::maybe, ti::move_assignable::maybe,
664              ti::copy_assignable::maybe, ti::destructible::maybe,
665              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
666              ti::less_than_comparable::maybe,
667              ti::less_equal_comparable::nothrow>>,
668      ProfileAndExpectation<
669          ti::HasGreaterEqualProfile, ti::HasGreaterEqualArchetype,
670          ti::ConformanceProfile<
671              ti::default_constructible::maybe, ti::move_constructible::maybe,
672              ti::copy_constructible::maybe, ti::move_assignable::maybe,
673              ti::copy_assignable::maybe, ti::destructible::maybe,
674              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
675              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
676              ti::greater_equal_comparable::yes>>,
677      ProfileAndExpectation<
678          ti::HasNothrowGreaterEqualProfile, ti::HasNothrowGreaterEqualArchetype,
679          ti::ConformanceProfile<
680              ti::default_constructible::maybe, ti::move_constructible::maybe,
681              ti::copy_constructible::maybe, ti::move_assignable::maybe,
682              ti::copy_assignable::maybe, ti::destructible::maybe,
683              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
684              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
685              ti::greater_equal_comparable::nothrow>>,
686      ProfileAndExpectation<
687          ti::HasGreaterThanProfile, ti::HasGreaterThanArchetype,
688          ti::ConformanceProfile<
689              ti::default_constructible::maybe, ti::move_constructible::maybe,
690              ti::copy_constructible::maybe, ti::move_assignable::maybe,
691              ti::copy_assignable::maybe, ti::destructible::maybe,
692              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
693              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
694              ti::greater_equal_comparable::maybe,
695              ti::greater_than_comparable::yes>>,
696      ProfileAndExpectation<
697          ti::HasNothrowGreaterThanProfile, ti::HasNothrowGreaterThanArchetype,
698          ti::ConformanceProfile<
699              ti::default_constructible::maybe, ti::move_constructible::maybe,
700              ti::copy_constructible::maybe, ti::move_assignable::maybe,
701              ti::copy_assignable::maybe, ti::destructible::maybe,
702              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
703              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
704              ti::greater_equal_comparable::maybe,
705              ti::greater_than_comparable::nothrow>>,
706      ProfileAndExpectation<
707          ti::HasSwapProfile, ti::HasSwapArchetype,
708          ti::ConformanceProfile<
709              ti::default_constructible::maybe, ti::move_constructible::maybe,
710              ti::copy_constructible::maybe, ti::move_assignable::maybe,
711              ti::copy_assignable::maybe, ti::destructible::maybe,
712              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
713              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
714              ti::greater_equal_comparable::maybe,
715              ti::greater_than_comparable::maybe, ti::swappable::yes>>,
716      ProfileAndExpectation<
717          ti::HasNothrowSwapProfile, ti::HasNothrowSwapArchetype,
718          ti::ConformanceProfile<
719              ti::default_constructible::maybe, ti::move_constructible::maybe,
720              ti::copy_constructible::maybe, ti::move_assignable::maybe,
721              ti::copy_assignable::maybe, ti::destructible::maybe,
722              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
723              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
724              ti::greater_equal_comparable::maybe,
725              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
726      ProfileAndExpectation<
727          ti::HasStdHashSpecializationProfile,
728          ti::HasStdHashSpecializationArchetype,
729          ti::ConformanceProfile<
730              ti::default_constructible::maybe, ti::move_constructible::maybe,
731              ti::copy_constructible::maybe, ti::move_assignable::maybe,
732              ti::copy_assignable::maybe, ti::destructible::maybe,
733              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
734              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
735              ti::greater_equal_comparable::maybe,
736              ti::greater_than_comparable::maybe, ti::swappable::maybe,
737              ti::hashable::yes>>>;
738  using CommonProfilesToTest = ::testing::Types<
739      ProfileAndExpectation<
740          ti::NothrowMoveConstructibleProfile,
741          ti::NothrowMoveConstructibleArchetype,
742          ti::ConformanceProfile<
743              ti::default_constructible::maybe, ti::move_constructible::nothrow,
744              ti::copy_constructible::maybe, ti::move_assignable::maybe,
745              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
746      ProfileAndExpectation<
747          ti::CopyConstructibleProfile, ti::CopyConstructibleArchetype,
748          ti::ConformanceProfile<
749              ti::default_constructible::maybe, ti::move_constructible::nothrow,
750              ti::copy_constructible::yes, ti::move_assignable::maybe,
751              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
752      ProfileAndExpectation<
753          ti::NothrowMovableProfile, ti::NothrowMovableArchetype,
754          ti::ConformanceProfile<
755              ti::default_constructible::maybe, ti::move_constructible::nothrow,
756              ti::copy_constructible::maybe, ti::move_assignable::nothrow,
757              ti::copy_assignable::maybe, ti::destructible::nothrow,
758              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
759              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
760              ti::greater_equal_comparable::maybe,
761              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
762      ProfileAndExpectation<
763          ti::ValueProfile, ti::ValueArchetype,
764          ti::ConformanceProfile<
765              ti::default_constructible::maybe, ti::move_constructible::nothrow,
766              ti::copy_constructible::yes, ti::move_assignable::nothrow,
767              ti::copy_assignable::yes, ti::destructible::nothrow,
768              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
769              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
770              ti::greater_equal_comparable::maybe,
771              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
772      ProfileAndExpectation<
773          ti::DefaultConstructibleNothrowMoveConstructibleProfile,
774          ti::DefaultConstructibleNothrowMoveConstructibleArchetype,
775          ti::ConformanceProfile<
776              ti::default_constructible::yes, ti::move_constructible::nothrow,
777              ti::copy_constructible::maybe, ti::move_assignable::maybe,
778              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
779      ProfileAndExpectation<
780          ti::DefaultConstructibleCopyConstructibleProfile,
781          ti::DefaultConstructibleCopyConstructibleArchetype,
782          ti::ConformanceProfile<
783              ti::default_constructible::yes, ti::move_constructible::nothrow,
784              ti::copy_constructible::yes, ti::move_assignable::maybe,
785              ti::copy_assignable::maybe, ti::destructible::nothrow>>,
786      ProfileAndExpectation<
787          ti::DefaultConstructibleNothrowMovableProfile,
788          ti::DefaultConstructibleNothrowMovableArchetype,
789          ti::ConformanceProfile<
790              ti::default_constructible::yes, ti::move_constructible::nothrow,
791              ti::copy_constructible::maybe, ti::move_assignable::nothrow,
792              ti::copy_assignable::maybe, ti::destructible::nothrow,
793              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
794              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
795              ti::greater_equal_comparable::maybe,
796              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
797      ProfileAndExpectation<
798          ti::DefaultConstructibleValueProfile,
799          ti::DefaultConstructibleValueArchetype,
800          ti::ConformanceProfile<
801              ti::default_constructible::yes, ti::move_constructible::nothrow,
802              ti::copy_constructible::yes, ti::move_assignable::nothrow,
803              ti::copy_assignable::yes, ti::destructible::nothrow,
804              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
805              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
806              ti::greater_equal_comparable::maybe,
807              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>>;
808  using ComparableHelpersProfilesToTest = ::testing::Types<
809      ProfileAndExpectation<
810          ti::EquatableProfile, ti::EquatableArchetype,
811          ti::ConformanceProfile<
812              ti::default_constructible::maybe, ti::move_constructible::maybe,
813              ti::copy_constructible::maybe, ti::move_assignable::maybe,
814              ti::copy_assignable::maybe, ti::destructible::maybe,
815              ti::equality_comparable::yes, ti::inequality_comparable::yes>>,
816      ProfileAndExpectation<
817          ti::ComparableProfile, ti::ComparableArchetype,
818          ti::ConformanceProfile<
819              ti::default_constructible::maybe, ti::move_constructible::maybe,
820              ti::copy_constructible::maybe, ti::move_assignable::maybe,
821              ti::copy_assignable::maybe, ti::destructible::maybe,
822              ti::equality_comparable::yes, ti::inequality_comparable::yes,
823              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
824              ti::greater_equal_comparable::yes,
825              ti::greater_than_comparable::yes>>,
826      ProfileAndExpectation<
827          ti::NothrowEquatableProfile, ti::NothrowEquatableArchetype,
828          ti::ConformanceProfile<
829              ti::default_constructible::maybe, ti::move_constructible::maybe,
830              ti::copy_constructible::maybe, ti::move_assignable::maybe,
831              ti::copy_assignable::maybe, ti::destructible::maybe,
832              ti::equality_comparable::nothrow,
833              ti::inequality_comparable::nothrow>>,
834      ProfileAndExpectation<
835          ti::NothrowComparableProfile, ti::NothrowComparableArchetype,
836          ti::ConformanceProfile<
837              ti::default_constructible::maybe, ti::move_constructible::maybe,
838              ti::copy_constructible::maybe, ti::move_assignable::maybe,
839              ti::copy_assignable::maybe, ti::destructible::maybe,
840              ti::equality_comparable::nothrow,
841              ti::inequality_comparable::nothrow,
842              ti::less_than_comparable::nothrow,
843              ti::less_equal_comparable::nothrow,
844              ti::greater_equal_comparable::nothrow,
845              ti::greater_than_comparable::nothrow>>>;
846  using CommonComparableProfilesToTest = ::testing::Types<
847      ProfileAndExpectation<
848          ti::ComparableNothrowMoveConstructibleProfile,
849          ti::ComparableNothrowMoveConstructibleArchetype,
850          ti::ConformanceProfile<
851              ti::default_constructible::maybe, ti::move_constructible::nothrow,
852              ti::copy_constructible::maybe, ti::move_assignable::maybe,
853              ti::copy_assignable::maybe, ti::destructible::nothrow,
854              ti::equality_comparable::yes, ti::inequality_comparable::yes,
855              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
856              ti::greater_equal_comparable::yes,
857              ti::greater_than_comparable::yes>>,
858      ProfileAndExpectation<
859          ti::ComparableCopyConstructibleProfile,
860          ti::ComparableCopyConstructibleArchetype,
861          ti::ConformanceProfile<
862              ti::default_constructible::maybe, ti::move_constructible::nothrow,
863              ti::copy_constructible::yes, ti::move_assignable::maybe,
864              ti::copy_assignable::maybe, ti::destructible::nothrow,
865              ti::equality_comparable::yes, ti::inequality_comparable::yes,
866              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
867              ti::greater_equal_comparable::yes,
868              ti::greater_than_comparable::yes>>,
869      ProfileAndExpectation<
870          ti::ComparableNothrowMovableProfile,
871          ti::ComparableNothrowMovableArchetype,
872          ti::ConformanceProfile<
873              ti::default_constructible::maybe, ti::move_constructible::nothrow,
874              ti::copy_constructible::maybe, ti::move_assignable::nothrow,
875              ti::copy_assignable::maybe, ti::destructible::nothrow,
876              ti::equality_comparable::yes, ti::inequality_comparable::yes,
877              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
878              ti::greater_equal_comparable::yes, ti::greater_than_comparable::yes,
879              ti::swappable::nothrow>>,
880      ProfileAndExpectation<
881          ti::ComparableValueProfile, ti::ComparableValueArchetype,
882          ti::ConformanceProfile<
883              ti::default_constructible::maybe, ti::move_constructible::nothrow,
884              ti::copy_constructible::yes, ti::move_assignable::nothrow,
885              ti::copy_assignable::yes, ti::destructible::nothrow,
886              ti::equality_comparable::yes, ti::inequality_comparable::yes,
887              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
888              ti::greater_equal_comparable::yes, ti::greater_than_comparable::yes,
889              ti::swappable::nothrow>>>;
890  using TrivialProfilesToTest = ::testing::Types<
891      ProfileAndExpectation<
892          ti::TrivialSpecialMemberFunctionsProfile,
893          ti::TrivialSpecialMemberFunctionsArchetype,
894          ti::ConformanceProfile<
895              ti::default_constructible::trivial, ti::move_constructible::trivial,
896              ti::copy_constructible::trivial, ti::move_assignable::trivial,
897              ti::copy_assignable::trivial, ti::destructible::trivial,
898              ti::equality_comparable::maybe, ti::inequality_comparable::maybe,
899              ti::less_than_comparable::maybe, ti::less_equal_comparable::maybe,
900              ti::greater_equal_comparable::maybe,
901              ti::greater_than_comparable::maybe, ti::swappable::nothrow>>,
902      ProfileAndExpectation<
903          ti::TriviallyCompleteProfile, ti::TriviallyCompleteArchetype,
904          ti::ConformanceProfile<
905              ti::default_constructible::trivial, ti::move_constructible::trivial,
906              ti::copy_constructible::trivial, ti::move_assignable::trivial,
907              ti::copy_assignable::trivial, ti::destructible::trivial,
908              ti::equality_comparable::yes, ti::inequality_comparable::yes,
909              ti::less_than_comparable::yes, ti::less_equal_comparable::yes,
910              ti::greater_equal_comparable::yes, ti::greater_than_comparable::yes,
911              ti::swappable::nothrow, ti::hashable::yes>>>;
912  INSTANTIATE_TYPED_TEST_SUITE_P(Core, ProfileTest, CoreProfilesToTest);
913  INSTANTIATE_TYPED_TEST_SUITE_P(Common, ProfileTest, CommonProfilesToTest);
914  INSTANTIATE_TYPED_TEST_SUITE_P(ComparableHelpers, ProfileTest,
915                                 ComparableHelpersProfilesToTest);
916  INSTANTIATE_TYPED_TEST_SUITE_P(CommonComparable, ProfileTest,
917                                 CommonComparableProfilesToTest);
918  INSTANTIATE_TYPED_TEST_SUITE_P(Trivial, ProfileTest, TrivialProfilesToTest);
919  TEST(ConformanceTestingTest, Basic) {
920    using profile = ti::CombineProfiles<ti::TriviallyCompleteProfile,
921                                        ti::NothrowComparableProfile>;
922    using lim = std::numeric_limits<float>;
923    ABSL_INTERNAL_ASSERT_CONFORMANCE_OF(float)
924        .INITIALIZER(-lim::infinity())
925        .INITIALIZER(lim::lowest())
926        .INITIALIZER(-1.f)
927        .INITIALIZER(-lim::min())
928        .EQUIVALENCE_CLASS(INITIALIZER(-0.f), INITIALIZER(0.f))
929        .INITIALIZER(lim::min())
930        .INITIALIZER(1.f)
931        .INITIALIZER(lim::max())
932        .INITIALIZER(lim::infinity())
933        .WITH_STRICT_PROFILE(absl::types_internal::RegularityDomain, profile);
934  }
935  struct BadMoveConstruct {
936    BadMoveConstruct() = default;
937    BadMoveConstruct(BadMoveConstruct&& other) noexcept
938        : value(other.value + 1) {}
939    BadMoveConstruct& operator=(BadMoveConstruct&& other) noexcept = default;
940    int value = 0;
941    friend bool operator==(BadMoveConstruct const& lhs,
942                           BadMoveConstruct const& rhs) {
943      return lhs.value == rhs.value;
944    }
945    friend bool operator!=(BadMoveConstruct const& lhs,
946                           BadMoveConstruct const& rhs) {
947      return lhs.value != rhs.value;
948    }
949  };
950  struct BadMoveAssign {
951    BadMoveAssign() = default;
952    BadMoveAssign(BadMoveAssign&& other) noexcept = default;
953    BadMoveAssign& operator=(BadMoveAssign&& other) noexcept {
954      int new_value = other.value + 1;
955      value = new_value;
956      return *this;
957    }
958    int value = 0;
959    friend bool operator==(BadMoveAssign const& lhs, BadMoveAssign const& rhs) {
960      return lhs.value == rhs.value;
961    }
962    friend bool operator!=(BadMoveAssign const& lhs, BadMoveAssign const& rhs) {
963      return lhs.value != rhs.value;
964    }
965  };
966  enum class WhichCompIsBad { eq, ne, lt, le, ge, gt };
967  template <WhichCompIsBad Which>
968  struct BadCompare {
969    int value;
970    friend bool operator==(BadCompare const& lhs, BadCompare const& rhs) {
971      return Which == WhichCompIsBad::eq ? lhs.value != rhs.value
972                                         : lhs.value == rhs.value;
973    }
974    friend bool operator!=(BadCompare const& lhs, BadCompare const& rhs) {
975      return Which == WhichCompIsBad::ne ? lhs.value == rhs.value
976                                         : lhs.value != rhs.value;
977    }
978    friend bool operator<(BadCompare const& lhs, BadCompare const& rhs) {
979      return Which == WhichCompIsBad::lt ? lhs.value >= rhs.value
980                                         : lhs.value < rhs.value;
981    }
982    friend bool operator<=(BadCompare const& lhs, BadCompare const& rhs) {
983      return Which == WhichCompIsBad::le ? lhs.value > rhs.value
984                                         : lhs.value <= rhs.value;
985    }
986    friend bool operator>=(BadCompare const& lhs, BadCompare const& rhs) {
987      return Which == WhichCompIsBad::ge ? lhs.value < rhs.value
988                                         : lhs.value >= rhs.value;
989    }
990    friend bool operator>(BadCompare const& lhs, BadCompare const& rhs) {
991      return Which == WhichCompIsBad::gt ? lhs.value <= rhs.value
992                                         : lhs.value > rhs.value;
993    }
994  };
995  TEST(ConformanceTestingDeathTest, Failures) {
996    {
997      using profile = ti::CombineProfiles<ti::TriviallyCompleteProfile,
998                                          ti::NothrowComparableProfile>;
999      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(float)
1000          .INITIALIZER(1.f)
1001          .INITIALIZER(0.f)
1002          .WITH_LOOSE_PROFILE(profile);
1003    }
1004    {
1005      using profile =
1006          ti::CombineProfiles<ti::NothrowMovableProfile, ti::EquatableProfile>;
1007      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadMoveConstruct)
1008          .DUE_TO("Move construction")
1009          .INITIALIZER(BadMoveConstruct())
1010          .WITH_LOOSE_PROFILE(profile);
1011    }
1012    {
1013      using profile =
1014          ti::CombineProfiles<ti::NothrowMovableProfile, ti::EquatableProfile>;
1015      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadMoveAssign)
1016          .DUE_TO("Move assignment")
1017          .INITIALIZER(BadMoveAssign())
1018          .WITH_LOOSE_PROFILE(profile);
1019    }
1020  }
1021  TEST(ConformanceTestingDeathTest, CompFailures) {
1022    using profile = ti::ComparableProfile;
1023    {
1024      using BadComp = BadCompare<WhichCompIsBad::eq>;
1025      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1026          .DUE_TO("Comparison")
1027          .INITIALIZER(BadComp{0})
1028          .INITIALIZER(BadComp{1})
1029          .WITH_LOOSE_PROFILE(profile);
1030    }
1031    {
1032      using BadComp = BadCompare<WhichCompIsBad::ne>;
1033      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1034          .DUE_TO("Comparison")
1035          .INITIALIZER(BadComp{0})
1036          .INITIALIZER(BadComp{1})
1037          .WITH_LOOSE_PROFILE(profile);
1038    }
1039    {
1040      using BadComp = BadCompare<WhichCompIsBad::lt>;
1041      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1042          .DUE_TO("Comparison")
1043          .INITIALIZER(BadComp{0})
1044          .INITIALIZER(BadComp{1})
1045          .WITH_LOOSE_PROFILE(profile);
1046    }
1047    {
1048      using BadComp = BadCompare<WhichCompIsBad::le>;
1049      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1050          .DUE_TO("Comparison")
1051          .INITIALIZER(BadComp{0})
1052          .INITIALIZER(BadComp{1})
1053          .WITH_LOOSE_PROFILE(profile);
1054    }
1055    {
1056      using BadComp = BadCompare<WhichCompIsBad::ge>;
1057      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1058          .DUE_TO("Comparison")
1059          .INITIALIZER(BadComp{0})
1060          .INITIALIZER(BadComp{1})
1061          .WITH_LOOSE_PROFILE(profile);
1062    }
1063    {
1064      using BadComp = BadCompare<WhichCompIsBad::gt>;
1065      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadComp)
1066          .DUE_TO("Comparison")
1067          .INITIALIZER(BadComp{0})
1068          .INITIALIZER(BadComp{1})
1069          .WITH_LOOSE_PROFILE(profile);
1070    }
1071  }
1072  struct BadSelfMove {
1073    BadSelfMove() = default;
1074    BadSelfMove(BadSelfMove&&) = default;
1075    BadSelfMove& operator=(BadSelfMove&& other) noexcept {
1076      if (this == &other) {
1077        broken_state = true;
1078      }
1079      return *this;
1080    }
1081    friend bool operator==(const BadSelfMove& lhs, const BadSelfMove& rhs) {
1082      return !(lhs.broken_state || rhs.broken_state);
1083    }
1084    friend bool operator!=(const BadSelfMove& lhs, const BadSelfMove& rhs) {
1085      return lhs.broken_state || rhs.broken_state;
1086    }
1087    bool broken_state = false;
1088  };
1089  TEST(ConformanceTestingDeathTest, SelfMoveFailure) {
1090    using profile = ti::EquatableNothrowMovableProfile;
1091    {
1092      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadSelfMove)
1093          .DUE_TO("Move assignment")
1094          .INITIALIZER(BadSelfMove())
1095          .WITH_LOOSE_PROFILE(profile);
1096    }
1097  }
1098  struct BadSelfCopy {
1099    BadSelfCopy() = default;
1100    BadSelfCopy(BadSelfCopy&&) = default;
1101    BadSelfCopy(const BadSelfCopy&) = default;
1102    BadSelfCopy& operator=(BadSelfCopy&&) = default;
1103    BadSelfCopy& operator=(BadSelfCopy const& other) {
1104      if (this == &other) {
<span onclick='openModal()' class='match'>1105        broken_state = true;
1106      }
1107      return *this;
1108    }
1109    friend bool operator==(const BadSelfCopy& lhs, const BadSelfCopy& rhs) {
1110      return !(lhs.broken_state || rhs.broken_state);
1111    }
1112    friend bool operator!=(const BadSelfCopy& lhs, const BadSelfCopy& rhs) {
1113      return lhs.broken_state || rhs.broken_state;
1114    }
1115    bool broken_state = false;
1116  };
1117  TEST(ConformanceTestingDeathTest, SelfCopyFailure) {
1118    using profile = ti::EquatableValueProfile;
1119    {
1120      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadSelfCopy)
1121          .DUE_TO("Copy assignment")
1122          .INITIALIZER(BadSelfCopy())
1123          .WITH_LOOSE_PROFILE(profile);
1124    }
1125  }
1126  struct BadSelfSwap {
1127    friend void swap(BadSelfSwap& lhs, BadSelfSwap& rhs) noexcept {
</span>1128      if (&lhs == &rhs) lhs.broken_state = true;
1129    }
1130    friend bool operator==(const BadSelfSwap& lhs, const BadSelfSwap& rhs) {
1131      return !(lhs.broken_state || rhs.broken_state);
1132    }
1133    friend bool operator!=(const BadSelfSwap& lhs, const BadSelfSwap& rhs) {
1134      return lhs.broken_state || rhs.broken_state;
1135    }
1136    bool broken_state = false;
1137  };
1138  TEST(ConformanceTestingDeathTest, SelfSwapFailure) {
1139    using profile = ti::EquatableNothrowMovableProfile;
1140    {
1141      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadSelfSwap)
1142          .DUE_TO("Swap")
1143          .INITIALIZER(BadSelfSwap())
1144          .WITH_LOOSE_PROFILE(profile);
1145    }
1146  }
1147  struct BadDefaultInitializedMoveAssign {
1148    BadDefaultInitializedMoveAssign() : default_initialized(true) {}
1149    explicit BadDefaultInitializedMoveAssign(int v) : value(v) {}
1150    BadDefaultInitializedMoveAssign(
1151        BadDefaultInitializedMoveAssign&& other) noexcept
1152        : value(other.value) {}
1153    BadDefaultInitializedMoveAssign& operator=(
1154        BadDefaultInitializedMoveAssign&& other) noexcept {
1155      value = other.value;
1156      if (default_initialized) ++value;  
1157      return *this;
1158    }
1159    friend bool operator==(const BadDefaultInitializedMoveAssign& lhs,
1160                           const BadDefaultInitializedMoveAssign& rhs) {
1161      return lhs.value == rhs.value;
1162    }
1163    friend bool operator!=(const BadDefaultInitializedMoveAssign& lhs,
1164                           const BadDefaultInitializedMoveAssign& rhs) {
1165      return lhs.value != rhs.value;
1166    }
1167    bool default_initialized = false;
1168    int value = 0;
1169  };
1170  TEST(ConformanceTestingDeathTest, DefaultInitializedMoveAssignFailure) {
1171    using profile =
1172        ti::CombineProfiles<ti::DefaultConstructibleNothrowMovableProfile,
1173                            ti::EquatableProfile>;
1174    {
1175      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadDefaultInitializedMoveAssign)
1176          .DUE_TO("move assignment")
1177          .INITIALIZER(BadDefaultInitializedMoveAssign(0))
1178          .WITH_LOOSE_PROFILE(profile);
1179    }
1180  }
1181  struct BadDefaultInitializedCopyAssign {
1182    BadDefaultInitializedCopyAssign() : default_initialized(true) {}
1183    explicit BadDefaultInitializedCopyAssign(int v) : value(v) {}
1184    BadDefaultInitializedCopyAssign(
1185        BadDefaultInitializedCopyAssign&& other) noexcept
1186        : value(other.value) {}
1187    BadDefaultInitializedCopyAssign(const BadDefaultInitializedCopyAssign& other)
1188        : value(other.value) {}
1189    BadDefaultInitializedCopyAssign& operator=(
1190        BadDefaultInitializedCopyAssign&& other) noexcept {
1191      value = other.value;
1192      return *this;
1193    }
1194    BadDefaultInitializedCopyAssign& operator=(
1195        const BadDefaultInitializedCopyAssign& other) {
1196      value = other.value;
1197      if (default_initialized) ++value;  
1198      return *this;
1199    }
1200    friend bool operator==(const BadDefaultInitializedCopyAssign& lhs,
1201                           const BadDefaultInitializedCopyAssign& rhs) {
1202      return lhs.value == rhs.value;
1203    }
1204    friend bool operator!=(const BadDefaultInitializedCopyAssign& lhs,
1205                           const BadDefaultInitializedCopyAssign& rhs) {
1206      return lhs.value != rhs.value;
1207    }
1208    bool default_initialized = false;
1209    int value = 0;
1210  };
1211  TEST(ConformanceTestingDeathTest, DefaultInitializedAssignFailure) {
1212    using profile = ti::CombineProfiles<ti::DefaultConstructibleValueProfile,
1213                                        ti::EquatableProfile>;
1214    {
1215      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadDefaultInitializedCopyAssign)
1216          .DUE_TO("copy assignment")
1217          .INITIALIZER(BadDefaultInitializedCopyAssign(0))
1218          .WITH_LOOSE_PROFILE(profile);
1219    }
1220  }
1221  }  
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-conformance_testing_test.cc</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-conformance_testing_test.cc</div>
                </div>
                <div class="column column_space"><pre><code>1077        broken_state = true;
1078      }
1079      return *this;
1080    }
1081    friend bool operator==(const BadSelfMove& lhs, const BadSelfMove& rhs) {
1082      return !(lhs.broken_state || rhs.broken_state);
1083    }
1084    friend bool operator!=(const BadSelfMove& lhs, const BadSelfMove& rhs) {
1085      return lhs.broken_state || rhs.broken_state;
1086    }
1087    bool broken_state = false;
1088  };
1089  TEST(ConformanceTestingDeathTest, SelfMoveFailure) {
1090    using profile = ti::EquatableNothrowMovableProfile;
1091    {
1092      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadSelfMove)
1093          .DUE_TO("Move assignment")
1094          .INITIALIZER(BadSelfMove())
1095          .WITH_LOOSE_PROFILE(profile);
1096    }
1097  }
1098  struct BadSelfCopy {
1099    BadSelfCopy() = default;
</pre></code></div>
                <div class="column column_space"><pre><code>1105        broken_state = true;
1106      }
1107      return *this;
1108    }
1109    friend bool operator==(const BadSelfCopy& lhs, const BadSelfCopy& rhs) {
1110      return !(lhs.broken_state || rhs.broken_state);
1111    }
1112    friend bool operator!=(const BadSelfCopy& lhs, const BadSelfCopy& rhs) {
1113      return lhs.broken_state || rhs.broken_state;
1114    }
1115    bool broken_state = false;
1116  };
1117  TEST(ConformanceTestingDeathTest, SelfCopyFailure) {
1118    using profile = ti::EquatableValueProfile;
1119    {
1120      ABSL_INTERNAL_ASSERT_NONCONFORMANCE_OF(BadSelfCopy)
1121          .DUE_TO("Copy assignment")
1122          .INITIALIZER(BadSelfCopy())
1123          .WITH_LOOSE_PROFILE(profile);
1124    }
1125  }
1126  struct BadSelfSwap {
1127    friend void swap(BadSelfSwap& lhs, BadSelfSwap& rhs) noexcept {
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    