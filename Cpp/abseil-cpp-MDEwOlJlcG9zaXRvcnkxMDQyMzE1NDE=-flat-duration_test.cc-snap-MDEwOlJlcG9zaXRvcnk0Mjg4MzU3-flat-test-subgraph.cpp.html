
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 7.889793362554791%, Tokens: 10</h2>
        <div class="column">
            <h3>abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-duration_test.cc</h3>
            <pre><code>1  #if defined(_MSC_VER)
2  #include <winsock2.h>  
3  #endif
4  #include <array>
5  #include <cfloat>
6  #include <chrono>  
7  #include <cmath>
8  #include <cstdint>
9  #include <ctime>
10  #include <iomanip>
11  #include <limits>
12  #include <random>
13  #include <string>
14  #include "gmock/gmock.h"
15  #include "gtest/gtest.h"
16  #include "absl/strings/str_format.h"
17  #include "absl/time/time.h"
18  namespace {
19  constexpr int64_t kint64max = std::numeric_limits<int64_t>::max();
20  constexpr int64_t kint64min = std::numeric_limits<int64_t>::min();
21  absl::Duration ApproxYears(int64_t n) { return absl::Hours(n) * 365 * 24; }
22  MATCHER_P(TimespecMatcher, ts, "") {
23    if (ts.tv_sec == arg.tv_sec && ts.tv_nsec == arg.tv_nsec)
24      return true;
25    *result_listener << "expected: {" << ts.tv_sec << ", " << ts.tv_nsec << "} ";
26    *result_listener << "actual: {" << arg.tv_sec << ", " << arg.tv_nsec << "}";
27    return false;
28  }
29  MATCHER_P(TimevalMatcher, tv, "") {
30    if (tv.tv_sec == arg.tv_sec && tv.tv_usec == arg.tv_usec)
31      return true;
32    *result_listener << "expected: {" << tv.tv_sec << ", " << tv.tv_usec << "} ";
33    *result_listener << "actual: {" << arg.tv_sec << ", " << arg.tv_usec << "}";
34    return false;
35  }
36  TEST(Duration, ConstExpr) {
37    constexpr absl::Duration d0 = absl::ZeroDuration();
38    static_assert(d0 == absl::ZeroDuration(), "ZeroDuration()");
39    constexpr absl::Duration d1 = absl::Seconds(1);
40    static_assert(d1 == absl::Seconds(1), "Seconds(1)");
41    static_assert(d1 != absl::ZeroDuration(), "Seconds(1)");
42    constexpr absl::Duration d2 = absl::InfiniteDuration();
43    static_assert(d2 == absl::InfiniteDuration(), "InfiniteDuration()");
44    static_assert(d2 != absl::ZeroDuration(), "InfiniteDuration()");
45  }
46  TEST(Duration, ValueSemantics) {
47    constexpr absl::Duration a;      
48    constexpr absl::Duration b = a;  
49    constexpr absl::Duration c(b);   
50    absl::Duration d;
51    d = c;  
52  }
53  TEST(Duration, Factories) {
54    constexpr absl::Duration zero = absl::ZeroDuration();
55    constexpr absl::Duration nano = absl::Nanoseconds(1);
56    constexpr absl::Duration micro = absl::Microseconds(1);
57    constexpr absl::Duration milli = absl::Milliseconds(1);
58    constexpr absl::Duration sec = absl::Seconds(1);
59    constexpr absl::Duration min = absl::Minutes(1);
60    constexpr absl::Duration hour = absl::Hours(1);
61    EXPECT_EQ(zero, absl::Duration());
62    EXPECT_EQ(zero, absl::Seconds(0));
63    EXPECT_EQ(nano, absl::Nanoseconds(1));
64    EXPECT_EQ(micro, absl::Nanoseconds(1000));
65    EXPECT_EQ(milli, absl::Microseconds(1000));
66    EXPECT_EQ(sec, absl::Milliseconds(1000));
67    EXPECT_EQ(min, absl::Seconds(60));
68    EXPECT_EQ(hour, absl::Minutes(60));
69    const absl::Duration inf = absl::InfiniteDuration();
70    EXPECT_GT(inf, absl::Seconds(kint64max));
71    EXPECT_LT(-inf, absl::Seconds(kint64min));
72    EXPECT_LT(-inf, absl::Seconds(-kint64max));
73    EXPECT_EQ(inf, absl::Minutes(kint64max));
74    EXPECT_EQ(-inf, absl::Minutes(kint64min));
75    EXPECT_EQ(-inf, absl::Minutes(-kint64max));
76    EXPECT_GT(inf, absl::Minutes(kint64max / 60));
77    EXPECT_LT(-inf, absl::Minutes(kint64min / 60));
78    EXPECT_LT(-inf, absl::Minutes(-kint64max / 60));
79    EXPECT_EQ(inf, absl::Hours(kint64max));
80    EXPECT_EQ(-inf, absl::Hours(kint64min));
81    EXPECT_EQ(-inf, absl::Hours(-kint64max));
82    EXPECT_GT(inf, absl::Hours(kint64max / 3600));
83    EXPECT_LT(-inf, absl::Hours(kint64min / 3600));
84    EXPECT_LT(-inf, absl::Hours(-kint64max / 3600));
85  }
86  TEST(Duration, ToConversion) {
87  #define TEST_DURATION_CONVERSION(UNIT)                                  \
88    do {                                                                  \
89      const absl::Duration d = absl::UNIT(1.5);                           \
90      constexpr absl::Duration z = absl::ZeroDuration();                  \
91      constexpr absl::Duration inf = absl::InfiniteDuration();            \
92      constexpr double dbl_inf = std::numeric_limits<double>::infinity(); \
93      EXPECT_EQ(kint64min, absl::ToInt64##UNIT(-inf));                    \
94      EXPECT_EQ(-1, absl::ToInt64##UNIT(-d));                             \
95      EXPECT_EQ(0, absl::ToInt64##UNIT(z));                               \
96      EXPECT_EQ(1, absl::ToInt64##UNIT(d));                               \
97      EXPECT_EQ(kint64max, absl::ToInt64##UNIT(inf));                     \
98      EXPECT_EQ(-dbl_inf, absl::ToDouble##UNIT(-inf));                    \
99      EXPECT_EQ(-1.5, absl::ToDouble##UNIT(-d));                          \
100      EXPECT_EQ(0, absl::ToDouble##UNIT(z));                              \
101      EXPECT_EQ(1.5, absl::ToDouble##UNIT(d));                            \
102      EXPECT_EQ(dbl_inf, absl::ToDouble##UNIT(inf));                      \
103    } while (0)
104    TEST_DURATION_CONVERSION(Nanoseconds);
105    TEST_DURATION_CONVERSION(Microseconds);
106    TEST_DURATION_CONVERSION(Milliseconds);
107    TEST_DURATION_CONVERSION(Seconds);
108    TEST_DURATION_CONVERSION(Minutes);
109    TEST_DURATION_CONVERSION(Hours);
110  #undef TEST_DURATION_CONVERSION
111  }
112  template <int64_t N>
113  void TestToConversion() {
114    constexpr absl::Duration nano = absl::Nanoseconds(N);
115    EXPECT_EQ(N, absl::ToInt64Nanoseconds(nano));
116    EXPECT_EQ(0, absl::ToInt64Microseconds(nano));
117    EXPECT_EQ(0, absl::ToInt64Milliseconds(nano));
118    EXPECT_EQ(0, absl::ToInt64Seconds(nano));
119    EXPECT_EQ(0, absl::ToInt64Minutes(nano));
120    EXPECT_EQ(0, absl::ToInt64Hours(nano));
121    const absl::Duration micro = absl::Microseconds(N);
122    EXPECT_EQ(N * 1000, absl::ToInt64Nanoseconds(micro));
123    EXPECT_EQ(N, absl::ToInt64Microseconds(micro));
124    EXPECT_EQ(0, absl::ToInt64Milliseconds(micro));
125    EXPECT_EQ(0, absl::ToInt64Seconds(micro));
126    EXPECT_EQ(0, absl::ToInt64Minutes(micro));
127    EXPECT_EQ(0, absl::ToInt64Hours(micro));
128    const absl::Duration milli = absl::Milliseconds(N);
129    EXPECT_EQ(N * 1000 * 1000, absl::ToInt64Nanoseconds(milli));
130    EXPECT_EQ(N * 1000, absl::ToInt64Microseconds(milli));
131    EXPECT_EQ(N, absl::ToInt64Milliseconds(milli));
132    EXPECT_EQ(0, absl::ToInt64Seconds(milli));
133    EXPECT_EQ(0, absl::ToInt64Minutes(milli));
134    EXPECT_EQ(0, absl::ToInt64Hours(milli));
135    const absl::Duration sec = absl::Seconds(N);
136    EXPECT_EQ(N * 1000 * 1000 * 1000, absl::ToInt64Nanoseconds(sec));
137    EXPECT_EQ(N * 1000 * 1000, absl::ToInt64Microseconds(sec));
138    EXPECT_EQ(N * 1000, absl::ToInt64Milliseconds(sec));
139    EXPECT_EQ(N, absl::ToInt64Seconds(sec));
140    EXPECT_EQ(0, absl::ToInt64Minutes(sec));
141    EXPECT_EQ(0, absl::ToInt64Hours(sec));
142    const absl::Duration min = absl::Minutes(N);
143    EXPECT_EQ(N * 60 * 1000 * 1000 * 1000, absl::ToInt64Nanoseconds(min));
144    EXPECT_EQ(N * 60 * 1000 * 1000, absl::ToInt64Microseconds(min));
145    EXPECT_EQ(N * 60 * 1000, absl::ToInt64Milliseconds(min));
146    EXPECT_EQ(N * 60, absl::ToInt64Seconds(min));
147    EXPECT_EQ(N, absl::ToInt64Minutes(min));
148    EXPECT_EQ(0, absl::ToInt64Hours(min));
149    const absl::Duration hour = absl::Hours(N);
150    EXPECT_EQ(N * 60 * 60 * 1000 * 1000 * 1000, absl::ToInt64Nanoseconds(hour));
151    EXPECT_EQ(N * 60 * 60 * 1000 * 1000, absl::ToInt64Microseconds(hour));
152    EXPECT_EQ(N * 60 * 60 * 1000, absl::ToInt64Milliseconds(hour));
153    EXPECT_EQ(N * 60 * 60, absl::ToInt64Seconds(hour));
154    EXPECT_EQ(N * 60, absl::ToInt64Minutes(hour));
155    EXPECT_EQ(N, absl::ToInt64Hours(hour));
156  }
157  TEST(Duration, ToConversionDeprecated) {
158    TestToConversion<43>();
159    TestToConversion<1>();
160    TestToConversion<0>();
161    TestToConversion<-1>();
162    TestToConversion<-43>();
163  }
164  template <int64_t N>
165  void TestFromChronoBasicEquality() {
166    using std::chrono::nanoseconds;
167    using std::chrono::microseconds;
168    using std::chrono::milliseconds;
169    using std::chrono::seconds;
170    using std::chrono::minutes;
171    using std::chrono::hours;
172    static_assert(absl::Nanoseconds(N) == absl::FromChrono(nanoseconds(N)), "");
173    static_assert(absl::Microseconds(N) == absl::FromChrono(microseconds(N)), "");
174    static_assert(absl::Milliseconds(N) == absl::FromChrono(milliseconds(N)), "");
175    static_assert(absl::Seconds(N) == absl::FromChrono(seconds(N)), "");
176    static_assert(absl::Minutes(N) == absl::FromChrono(minutes(N)), "");
177    static_assert(absl::Hours(N) == absl::FromChrono(hours(N)), "");
178  }
179  TEST(Duration, FromChrono) {
180    TestFromChronoBasicEquality<-123>();
181    TestFromChronoBasicEquality<-1>();
182    TestFromChronoBasicEquality<0>();
183    TestFromChronoBasicEquality<1>();
184    TestFromChronoBasicEquality<123>();
185    const auto chrono_minutes_max = std::chrono::minutes::max();
186    const auto minutes_max = absl::FromChrono(chrono_minutes_max);
187    const int64_t minutes_max_count = chrono_minutes_max.count();
188    if (minutes_max_count > kint64max / 60) {
189      EXPECT_EQ(absl::InfiniteDuration(), minutes_max);
190    } else {
191      EXPECT_EQ(absl::Minutes(minutes_max_count), minutes_max);
192    }
193    const auto chrono_minutes_min = std::chrono::minutes::min();
194    const auto minutes_min = absl::FromChrono(chrono_minutes_min);
195    const int64_t minutes_min_count = chrono_minutes_min.count();
196    if (minutes_min_count < kint64min / 60) {
197      EXPECT_EQ(-absl::InfiniteDuration(), minutes_min);
198    } else {
199      EXPECT_EQ(absl::Minutes(minutes_min_count), minutes_min);
200    }
201    const auto chrono_hours_max = std::chrono::hours::max();
202    const auto hours_max = absl::FromChrono(chrono_hours_max);
203    const int64_t hours_max_count = chrono_hours_max.count();
204    if (hours_max_count > kint64max / 3600) {
205      EXPECT_EQ(absl::InfiniteDuration(), hours_max);
206    } else {
207      EXPECT_EQ(absl::Hours(hours_max_count), hours_max);
208    }
209    const auto chrono_hours_min = std::chrono::hours::min();
210    const auto hours_min = absl::FromChrono(chrono_hours_min);
211    const int64_t hours_min_count = chrono_hours_min.count();
212    if (hours_min_count < kint64min / 3600) {
213      EXPECT_EQ(-absl::InfiniteDuration(), hours_min);
214    } else {
215      EXPECT_EQ(absl::Hours(hours_min_count), hours_min);
216    }
217  }
218  template <int64_t N>
219  void TestToChrono() {
220    using std::chrono::nanoseconds;
221    using std::chrono::microseconds;
222    using std::chrono::milliseconds;
223    using std::chrono::seconds;
224    using std::chrono::minutes;
225    using std::chrono::hours;
226    EXPECT_EQ(nanoseconds(N), absl::ToChronoNanoseconds(absl::Nanoseconds(N)));
227    EXPECT_EQ(microseconds(N), absl::ToChronoMicroseconds(absl::Microseconds(N)));
228    EXPECT_EQ(milliseconds(N), absl::ToChronoMilliseconds(absl::Milliseconds(N)));
229    EXPECT_EQ(seconds(N), absl::ToChronoSeconds(absl::Seconds(N)));
230    constexpr auto absl_minutes = absl::Minutes(N);
231    auto chrono_minutes = minutes(N);
232    if (absl_minutes == -absl::InfiniteDuration()) {
233      chrono_minutes = minutes::min();
234    } else if (absl_minutes == absl::InfiniteDuration()) {
235      chrono_minutes = minutes::max();
236    }
237    EXPECT_EQ(chrono_minutes, absl::ToChronoMinutes(absl_minutes));
238    constexpr auto absl_hours = absl::Hours(N);
239    auto chrono_hours = hours(N);
240    if (absl_hours == -absl::InfiniteDuration()) {
241      chrono_hours = hours::min();
242    } else if (absl_hours == absl::InfiniteDuration()) {
243      chrono_hours = hours::max();
244    }
245    EXPECT_EQ(chrono_hours, absl::ToChronoHours(absl_hours));
246  }
247  TEST(Duration, ToChrono) {
248    using std::chrono::nanoseconds;
249    using std::chrono::microseconds;
250    using std::chrono::milliseconds;
251    using std::chrono::seconds;
252    using std::chrono::minutes;
253    using std::chrono::hours;
254    TestToChrono<kint64min>();
255    TestToChrono<-1>();
256    TestToChrono<0>();
257    TestToChrono<1>();
258    TestToChrono<kint64max>();
259    const auto tick = absl::Nanoseconds(1) / 4;
260    EXPECT_EQ(nanoseconds(0), absl::ToChronoNanoseconds(tick));
261    EXPECT_EQ(nanoseconds(0), absl::ToChronoNanoseconds(-tick));
262    EXPECT_EQ(microseconds(0), absl::ToChronoMicroseconds(tick));
263    EXPECT_EQ(microseconds(0), absl::ToChronoMicroseconds(-tick));
264    EXPECT_EQ(milliseconds(0), absl::ToChronoMilliseconds(tick));
265    EXPECT_EQ(milliseconds(0), absl::ToChronoMilliseconds(-tick));
266    EXPECT_EQ(seconds(0), absl::ToChronoSeconds(tick));
267    EXPECT_EQ(seconds(0), absl::ToChronoSeconds(-tick));
268    EXPECT_EQ(minutes(0), absl::ToChronoMinutes(tick));
269    EXPECT_EQ(minutes(0), absl::ToChronoMinutes(-tick));
270    EXPECT_EQ(hours(0), absl::ToChronoHours(tick));
271    EXPECT_EQ(hours(0), absl::ToChronoHours(-tick));
272    constexpr auto inf = absl::InfiniteDuration();
273    EXPECT_EQ(nanoseconds::min(), absl::ToChronoNanoseconds(-inf));
274    EXPECT_EQ(nanoseconds::max(), absl::ToChronoNanoseconds(inf));
275    EXPECT_EQ(microseconds::min(), absl::ToChronoMicroseconds(-inf));
276    EXPECT_EQ(microseconds::max(), absl::ToChronoMicroseconds(inf));
277    EXPECT_EQ(milliseconds::min(), absl::ToChronoMilliseconds(-inf));
278    EXPECT_EQ(milliseconds::max(), absl::ToChronoMilliseconds(inf));
279    EXPECT_EQ(seconds::min(), absl::ToChronoSeconds(-inf));
280    EXPECT_EQ(seconds::max(), absl::ToChronoSeconds(inf));
281    EXPECT_EQ(minutes::min(), absl::ToChronoMinutes(-inf));
282    EXPECT_EQ(minutes::max(), absl::ToChronoMinutes(inf));
283    EXPECT_EQ(hours::min(), absl::ToChronoHours(-inf));
284    EXPECT_EQ(hours::max(), absl::ToChronoHours(inf));
285  }
286  TEST(Duration, FactoryOverloads) {
287    enum E { kOne = 1 };
288  #define TEST_FACTORY_OVERLOADS(NAME)                                          \
289    EXPECT_EQ(1, NAME(kOne) / NAME(kOne));                                      \
290    EXPECT_EQ(1, NAME(static_cast<int8_t>(1)) / NAME(1));                       \
291    EXPECT_EQ(1, NAME(static_cast<int16_t>(1)) / NAME(1));                      \
292    EXPECT_EQ(1, NAME(static_cast<int32_t>(1)) / NAME(1));                      \
293    EXPECT_EQ(1, NAME(static_cast<int64_t>(1)) / NAME(1));                      \
294    EXPECT_EQ(1, NAME(static_cast<uint8_t>(1)) / NAME(1));                      \
295    EXPECT_EQ(1, NAME(static_cast<uint16_t>(1)) / NAME(1));                     \
296    EXPECT_EQ(1, NAME(static_cast<uint32_t>(1)) / NAME(1));                     \
297    EXPECT_EQ(1, NAME(static_cast<uint64_t>(1)) / NAME(1));                     \
298    EXPECT_EQ(NAME(1) / 2, NAME(static_cast<float>(0.5)));                      \
299    EXPECT_EQ(NAME(1) / 2, NAME(static_cast<double>(0.5)));                     \
300    EXPECT_EQ(1.5, absl::FDivDuration(NAME(static_cast<float>(1.5)), NAME(1))); \
301    EXPECT_EQ(1.5, absl::FDivDuration(NAME(static_cast<double>(1.5)), NAME(1)));
302    TEST_FACTORY_OVERLOADS(absl::Nanoseconds);
303    TEST_FACTORY_OVERLOADS(absl::Microseconds);
304    TEST_FACTORY_OVERLOADS(absl::Milliseconds);
305    TEST_FACTORY_OVERLOADS(absl::Seconds);
306    TEST_FACTORY_OVERLOADS(absl::Minutes);
307    TEST_FACTORY_OVERLOADS(absl::Hours);
308  #undef TEST_FACTORY_OVERLOADS
309    EXPECT_EQ(absl::Milliseconds(1500), absl::Seconds(1.5));
310    EXPECT_LT(absl::Nanoseconds(1), absl::Nanoseconds(1.5));
311    EXPECT_GT(absl::Nanoseconds(2), absl::Nanoseconds(1.5));
312    const double dbl_inf = std::numeric_limits<double>::infinity();
313    EXPECT_EQ(absl::InfiniteDuration(), absl::Nanoseconds(dbl_inf));
314    EXPECT_EQ(absl::InfiniteDuration(), absl::Microseconds(dbl_inf));
315    EXPECT_EQ(absl::InfiniteDuration(), absl::Milliseconds(dbl_inf));
316    EXPECT_EQ(absl::InfiniteDuration(), absl::Seconds(dbl_inf));
317    EXPECT_EQ(absl::InfiniteDuration(), absl::Minutes(dbl_inf));
318    EXPECT_EQ(absl::InfiniteDuration(), absl::Hours(dbl_inf));
319    EXPECT_EQ(-absl::InfiniteDuration(), absl::Nanoseconds(-dbl_inf));
320    EXPECT_EQ(-absl::InfiniteDuration(), absl::Microseconds(-dbl_inf));
321    EXPECT_EQ(-absl::InfiniteDuration(), absl::Milliseconds(-dbl_inf));
322    EXPECT_EQ(-absl::InfiniteDuration(), absl::Seconds(-dbl_inf));
323    EXPECT_EQ(-absl::InfiniteDuration(), absl::Minutes(-dbl_inf));
324    EXPECT_EQ(-absl::InfiniteDuration(), absl::Hours(-dbl_inf));
325  }
326  TEST(Duration, InfinityExamples) {
327    constexpr absl::Duration inf = absl::InfiniteDuration();
328    constexpr absl::Duration d = absl::Seconds(1);  
329    EXPECT_TRUE(inf == inf + inf);
330    EXPECT_TRUE(inf == inf + d);
331    EXPECT_TRUE(inf == inf - inf);
332    EXPECT_TRUE(-inf == d - inf);
333    EXPECT_TRUE(inf == d * 1e100);
334    EXPECT_TRUE(0 == d / inf);  
335    EXPECT_TRUE(inf == d / 0);
336    EXPECT_TRUE(kint64max == d / absl::ZeroDuration());
337  }
338  TEST(Duration, InfinityComparison) {
339    const absl::Duration inf = absl::InfiniteDuration();
340    const absl::Duration any_dur = absl::Seconds(1);
341    EXPECT_EQ(inf, inf);
342    EXPECT_EQ(-inf, -inf);
343    EXPECT_NE(inf, -inf);
344    EXPECT_NE(any_dur, inf);
345    EXPECT_NE(any_dur, -inf);
346    EXPECT_GT(inf, any_dur);
347    EXPECT_LT(-inf, any_dur);
348    EXPECT_LT(-inf, inf);
349    EXPECT_GT(inf, -inf);
350  }
351  TEST(Duration, InfinityAddition) {
352    const absl::Duration sec_max = absl::Seconds(kint64max);
353    const absl::Duration sec_min = absl::Seconds(kint64min);
354    const absl::Duration any_dur = absl::Seconds(1);
355    const absl::Duration inf = absl::InfiniteDuration();
356    EXPECT_EQ(inf, inf + inf);
357    EXPECT_EQ(inf, inf + -inf);
358    EXPECT_EQ(-inf, -inf + inf);
359    EXPECT_EQ(-inf, -inf + -inf);
360    EXPECT_EQ(inf, inf + any_dur);
361    EXPECT_EQ(inf, any_dur + inf);
362    EXPECT_EQ(-inf, -inf + any_dur);
363    EXPECT_EQ(-inf, any_dur + -inf);
364    absl::Duration almost_inf = sec_max + absl::Nanoseconds(999999999);
365    EXPECT_GT(inf, almost_inf);
366    almost_inf += -absl::Nanoseconds(999999999);
367    EXPECT_GT(inf, almost_inf);
368    EXPECT_EQ(inf, sec_max + absl::Seconds(1));
369    EXPECT_EQ(inf, sec_max + sec_max);
370    EXPECT_EQ(-inf, sec_min + -absl::Seconds(1));
371    EXPECT_EQ(-inf, sec_min + -sec_max);
372    const double dbl_inf = std::numeric_limits<double>::infinity();
373    EXPECT_TRUE(std::isinf(dbl_inf + dbl_inf));
374    EXPECT_TRUE(std::isnan(dbl_inf + -dbl_inf));  
375    EXPECT_TRUE(std::isnan(-dbl_inf + dbl_inf));  
376    EXPECT_TRUE(std::isinf(-dbl_inf + -dbl_inf));
377  }
378  TEST(Duration, InfinitySubtraction) {
379    const absl::Duration sec_max = absl::Seconds(kint64max);
380    const absl::Duration sec_min = absl::Seconds(kint64min);
381    const absl::Duration any_dur = absl::Seconds(1);
382    const absl::Duration inf = absl::InfiniteDuration();
383    EXPECT_EQ(inf, inf - inf);
384    EXPECT_EQ(inf, inf - -inf);
385    EXPECT_EQ(-inf, -inf - inf);
386    EXPECT_EQ(-inf, -inf - -inf);
387    EXPECT_EQ(inf, inf - any_dur);
388    EXPECT_EQ(-inf, any_dur - inf);
389    EXPECT_EQ(-inf, -inf - any_dur);
390    EXPECT_EQ(inf, any_dur - -inf);
391    EXPECT_EQ(inf, sec_max - -absl::Seconds(1));
392    EXPECT_EQ(inf, sec_max - -sec_max);
393    EXPECT_EQ(-inf, sec_min - absl::Seconds(1));
394    EXPECT_EQ(-inf, sec_min - sec_max);
395    absl::Duration almost_neg_inf = sec_min;
396    EXPECT_LT(-inf, almost_neg_inf);
397    almost_neg_inf -= -absl::Nanoseconds(1);
398    EXPECT_LT(-inf, almost_neg_inf);
399    const double dbl_inf = std::numeric_limits<double>::infinity();
400    EXPECT_TRUE(std::isnan(dbl_inf - dbl_inf));  
401    EXPECT_TRUE(std::isinf(dbl_inf - -dbl_inf));
402    EXPECT_TRUE(std::isinf(-dbl_inf - dbl_inf));
403    EXPECT_TRUE(std::isnan(-dbl_inf - -dbl_inf));  
404  }
405  TEST(Duration, InfinityMultiplication) {
406    const absl::Duration sec_max = absl::Seconds(kint64max);
407    const absl::Duration sec_min = absl::Seconds(kint64min);
408    const absl::Duration inf = absl::InfiniteDuration();
409  #define TEST_INF_MUL_WITH_TYPE(T)                                     \
410    EXPECT_EQ(inf, inf * static_cast<T>(2));                            \
411    EXPECT_EQ(-inf, inf * static_cast<T>(-2));                          \
412    EXPECT_EQ(-inf, -inf * static_cast<T>(2));                          \
413    EXPECT_EQ(inf, -inf * static_cast<T>(-2));                          \
414    EXPECT_EQ(inf, inf * static_cast<T>(0));                            \
415    EXPECT_EQ(-inf, -inf * static_cast<T>(0));                          \
416    EXPECT_EQ(inf, sec_max * static_cast<T>(2));                        \
417    EXPECT_EQ(inf, sec_min * static_cast<T>(-2));                       \
418    EXPECT_EQ(inf, (sec_max / static_cast<T>(2)) * static_cast<T>(3));  \
419    EXPECT_EQ(-inf, sec_max * static_cast<T>(-2));                      \
420    EXPECT_EQ(-inf, sec_min * static_cast<T>(2));                       \
421    EXPECT_EQ(-inf, (sec_min / static_cast<T>(2)) * static_cast<T>(3));
422    TEST_INF_MUL_WITH_TYPE(int64_t);  
423    TEST_INF_MUL_WITH_TYPE(double);   
424  #undef TEST_INF_MUL_WITH_TYPE
425    const double dbl_inf = std::numeric_limits<double>::infinity();
426    EXPECT_EQ(inf, inf * dbl_inf);
427    EXPECT_EQ(-inf, -inf * dbl_inf);
428    EXPECT_EQ(-inf, inf * -dbl_inf);
429    EXPECT_EQ(inf, -inf * -dbl_inf);
430    const absl::Duration any_dur = absl::Seconds(1);
431    EXPECT_EQ(inf, any_dur * dbl_inf);
432    EXPECT_EQ(-inf, -any_dur * dbl_inf);
433    EXPECT_EQ(-inf, any_dur * -dbl_inf);
434    EXPECT_EQ(inf, -any_dur * -dbl_inf);
435    EXPECT_NE(absl::InfiniteDuration(), absl::Seconds(1) * kint64max);
436    EXPECT_EQ(inf, absl::Seconds(1) * static_cast<double>(kint64max));
437    EXPECT_NE(-absl::InfiniteDuration(), absl::Seconds(1) * kint64min);
438    EXPECT_EQ(-inf, absl::Seconds(1) * static_cast<double>(kint64min));
439    EXPECT_NE(inf, sec_max);
440    EXPECT_NE(inf, sec_max / 1);
441    EXPECT_EQ(inf, sec_max / 1.0);
442    EXPECT_NE(inf, sec_max * 1);
443    EXPECT_EQ(inf, sec_max * 1.0);
444  }
445  TEST(Duration, InfinityDivision) {
446    const absl::Duration sec_max = absl::Seconds(kint64max);
447    const absl::Duration sec_min = absl::Seconds(kint64min);
448    const absl::Duration inf = absl::InfiniteDuration();
449  #define TEST_INF_DIV_WITH_TYPE(T)            \
450    EXPECT_EQ(inf, inf / static_cast<T>(2));   \
451    EXPECT_EQ(-inf, inf / static_cast<T>(-2)); \
452    EXPECT_EQ(-inf, -inf / static_cast<T>(2)); \
453    EXPECT_EQ(inf, -inf / static_cast<T>(-2));
454    TEST_INF_DIV_WITH_TYPE(int64_t);  
455    TEST_INF_DIV_WITH_TYPE(double);   
456  #undef TEST_INF_DIV_WITH_TYPE
457    EXPECT_EQ(inf, sec_max / 0.5);
458    EXPECT_EQ(inf, sec_min / -0.5);
459    EXPECT_EQ(inf, ((sec_max / 0.5) + absl::Seconds(1)) / 0.5);
460    EXPECT_EQ(-inf, sec_max / -0.5);
461    EXPECT_EQ(-inf, sec_min / 0.5);
462    EXPECT_EQ(-inf, ((sec_min / 0.5) - absl::Seconds(1)) / 0.5);
463    const double dbl_inf = std::numeric_limits<double>::infinity();
464    EXPECT_EQ(inf, inf / dbl_inf);
465    EXPECT_EQ(-inf, inf / -dbl_inf);
466    EXPECT_EQ(-inf, -inf / dbl_inf);
467    EXPECT_EQ(inf, -inf / -dbl_inf);
468    const absl::Duration any_dur = absl::Seconds(1);
469    EXPECT_EQ(absl::ZeroDuration(), any_dur / dbl_inf);
470    EXPECT_EQ(absl::ZeroDuration(), any_dur / -dbl_inf);
471    EXPECT_EQ(absl::ZeroDuration(), -any_dur / dbl_inf);
472    EXPECT_EQ(absl::ZeroDuration(), -any_dur / -dbl_inf);
473  }
474  TEST(Duration, InfinityModulus) {
475    const absl::Duration sec_max = absl::Seconds(kint64max);
476    const absl::Duration any_dur = absl::Seconds(1);
477    const absl::Duration inf = absl::InfiniteDuration();
478    EXPECT_EQ(inf, inf % inf);
479    EXPECT_EQ(inf, inf % -inf);
480    EXPECT_EQ(-inf, -inf % -inf);
481    EXPECT_EQ(-inf, -inf % inf);
482    EXPECT_EQ(any_dur, any_dur % inf);
483    EXPECT_EQ(any_dur, any_dur % -inf);
484    EXPECT_EQ(-any_dur, -any_dur % inf);
485    EXPECT_EQ(-any_dur, -any_dur % -inf);
486    EXPECT_EQ(inf, inf % -any_dur);
487    EXPECT_EQ(inf, inf % any_dur);
488    EXPECT_EQ(-inf, -inf % -any_dur);
489    EXPECT_EQ(-inf, -inf % any_dur);
490    EXPECT_EQ(absl::ZeroDuration(), sec_max % absl::Seconds(1));
491    EXPECT_EQ(absl::ZeroDuration(), sec_max % absl::Milliseconds(1));
492    EXPECT_EQ(absl::ZeroDuration(), sec_max % absl::Microseconds(1));
493    EXPECT_EQ(absl::ZeroDuration(), sec_max % absl::Nanoseconds(1));
494    EXPECT_EQ(absl::ZeroDuration(), sec_max % absl::Nanoseconds(1) / 4);
495  }
496  TEST(Duration, InfinityIDiv) {
497    const absl::Duration sec_max = absl::Seconds(kint64max);
498    const absl::Duration any_dur = absl::Seconds(1);
499    const absl::Duration inf = absl::InfiniteDuration();
500    const double dbl_inf = std::numeric_limits<double>::infinity();
501    absl::Duration rem = absl::ZeroDuration();
502    EXPECT_EQ(kint64max, absl::IDivDuration(inf, inf, &rem));
503    EXPECT_EQ(inf, rem);
504    rem = absl::ZeroDuration();
505    EXPECT_EQ(kint64max, absl::IDivDuration(-inf, -inf, &rem));
506    EXPECT_EQ(-inf, rem);
507    rem = absl::ZeroDuration();
508    EXPECT_EQ(kint64max, absl::IDivDuration(inf, any_dur, &rem));
509    EXPECT_EQ(inf, rem);
510    rem = absl::ZeroDuration();
511    EXPECT_EQ(0, absl::IDivDuration(any_dur, inf, &rem));
512    EXPECT_EQ(any_dur, rem);
513    rem = absl::ZeroDuration();
514    EXPECT_EQ(kint64max, absl::IDivDuration(-inf, -any_dur, &rem));
515    EXPECT_EQ(-inf, rem);
516    rem = absl::ZeroDuration();
517    EXPECT_EQ(0, absl::IDivDuration(-any_dur, -inf, &rem));
518    EXPECT_EQ(-any_dur, rem);
519    rem = absl::ZeroDuration();
520    EXPECT_EQ(kint64min, absl::IDivDuration(-inf, inf, &rem));
521    EXPECT_EQ(-inf, rem);
522    rem = absl::ZeroDuration();
523    EXPECT_EQ(kint64min, absl::IDivDuration(inf, -inf, &rem));
524    EXPECT_EQ(inf, rem);
525    rem = absl::ZeroDuration();
526    EXPECT_EQ(kint64min, absl::IDivDuration(-inf, any_dur, &rem));
527    EXPECT_EQ(-inf, rem);
528    rem = absl::ZeroDuration();
529    EXPECT_EQ(0, absl::IDivDuration(-any_dur, inf, &rem));
530    EXPECT_EQ(-any_dur, rem);
531    rem = absl::ZeroDuration();
532    EXPECT_EQ(kint64min, absl::IDivDuration(inf, -any_dur, &rem));
533    EXPECT_EQ(inf, rem);
534    rem = absl::ZeroDuration();
535    EXPECT_EQ(0, absl::IDivDuration(any_dur, -inf, &rem));
536    EXPECT_EQ(any_dur, rem);
537    rem = any_dur;
538    EXPECT_EQ(kint64max,
539              absl::IDivDuration(sec_max, absl::Nanoseconds(1) / 4, &rem));
540    EXPECT_EQ(sec_max - absl::Nanoseconds(kint64max) / 4, rem);
541    rem = any_dur;
542    EXPECT_EQ(kint64max,
543              absl::IDivDuration(sec_max, absl::Milliseconds(1), &rem));
544    EXPECT_EQ(sec_max - absl::Milliseconds(kint64max), rem);
545    rem = any_dur;
546    EXPECT_EQ(kint64max,
547              absl::IDivDuration(-sec_max, -absl::Milliseconds(1), &rem));
548    EXPECT_EQ(-sec_max + absl::Milliseconds(kint64max), rem);
549    rem = any_dur;
550    EXPECT_EQ(kint64min,
551              absl::IDivDuration(-sec_max, absl::Milliseconds(1), &rem));
552    EXPECT_EQ(-sec_max - absl::Milliseconds(kint64min), rem);
553    rem = any_dur;
554    EXPECT_EQ(kint64min,
555              absl::IDivDuration(sec_max, -absl::Milliseconds(1), &rem));
556    EXPECT_EQ(sec_max + absl::Milliseconds(kint64min), rem);
557    EXPECT_TRUE(std::isnan(dbl_inf / dbl_inf));
558    EXPECT_EQ(kint64max, inf / inf);
559    EXPECT_EQ(kint64max, -inf / -inf);
560    EXPECT_EQ(kint64min, -inf / inf);
561    EXPECT_EQ(kint64min, inf / -inf);
562    EXPECT_TRUE(std::isinf(dbl_inf / 2.0));
563    EXPECT_EQ(kint64max, inf / any_dur);
564    EXPECT_EQ(kint64max, -inf / -any_dur);
565    EXPECT_EQ(kint64min, -inf / any_dur);
566    EXPECT_EQ(kint64min, inf / -any_dur);
567    EXPECT_EQ(0.0, 2.0 / dbl_inf);
568    EXPECT_EQ(0, any_dur / inf);
569    EXPECT_EQ(0, any_dur / -inf);
570    EXPECT_EQ(0, -any_dur / inf);
571    EXPECT_EQ(0, -any_dur / -inf);
572    EXPECT_EQ(0, absl::ZeroDuration() / inf);
573    EXPECT_EQ(kint64max, sec_max / absl::Milliseconds(1));
574    EXPECT_EQ(kint64max, -sec_max / -absl::Milliseconds(1));
575    EXPECT_EQ(kint64min, -sec_max / absl::Milliseconds(1));
576    EXPECT_EQ(kint64min, sec_max / -absl::Milliseconds(1));
577  }
578  TEST(Duration, InfinityFDiv) {
579    const absl::Duration any_dur = absl::Seconds(1);
580    const absl::Duration inf = absl::InfiniteDuration();
581    const double dbl_inf = std::numeric_limits<double>::infinity();
582    EXPECT_EQ(dbl_inf, absl::FDivDuration(inf, inf));
583    EXPECT_EQ(dbl_inf, absl::FDivDuration(-inf, -inf));
584    EXPECT_EQ(dbl_inf, absl::FDivDuration(inf, any_dur));
585    EXPECT_EQ(0.0, absl::FDivDuration(any_dur, inf));
586    EXPECT_EQ(dbl_inf, absl::FDivDuration(-inf, -any_dur));
587    EXPECT_EQ(0.0, absl::FDivDuration(-any_dur, -inf));
588    EXPECT_EQ(-dbl_inf, absl::FDivDuration(-inf, inf));
589    EXPECT_EQ(-dbl_inf, absl::FDivDuration(inf, -inf));
590    EXPECT_EQ(-dbl_inf, absl::FDivDuration(-inf, any_dur));
591    EXPECT_EQ(0.0, absl::FDivDuration(-any_dur, inf));
592    EXPECT_EQ(-dbl_inf, absl::FDivDuration(inf, -any_dur));
593    EXPECT_EQ(0.0, absl::FDivDuration(any_dur, -inf));
594  }
595  TEST(Duration, DivisionByZero) {
596    const absl::Duration zero = absl::ZeroDuration();
597    const absl::Duration inf = absl::InfiniteDuration();
598    const absl::Duration any_dur = absl::Seconds(1);
599    const double dbl_inf = std::numeric_limits<double>::infinity();
600    const double dbl_denorm = std::numeric_limits<double>::denorm_min();
601    EXPECT_EQ(inf, zero / 0.0);
602    EXPECT_EQ(-inf, zero / -0.0);
603    EXPECT_EQ(inf, any_dur / 0.0);
604    EXPECT_EQ(-inf, any_dur / -0.0);
605    EXPECT_EQ(-inf, -any_dur / 0.0);
606    EXPECT_EQ(inf, -any_dur / -0.0);
607    EXPECT_EQ(zero, zero / dbl_denorm);
608    EXPECT_EQ(zero, zero / -dbl_denorm);
609    EXPECT_EQ(inf, any_dur / dbl_denorm);
610    EXPECT_EQ(-inf, any_dur / -dbl_denorm);
611    EXPECT_EQ(-inf, -any_dur / dbl_denorm);
612    EXPECT_EQ(inf, -any_dur / -dbl_denorm);
613    absl::Duration rem = zero;
614    EXPECT_EQ(kint64max, absl::IDivDuration(zero, zero, &rem));
615    EXPECT_EQ(inf, rem);
616    rem = zero;
617    EXPECT_EQ(kint64max, absl::IDivDuration(any_dur, zero, &rem));
618    EXPECT_EQ(inf, rem);
619    rem = zero;
620    EXPECT_EQ(kint64min, absl::IDivDuration(-any_dur, zero, &rem));
621    EXPECT_EQ(-inf, rem);
622    EXPECT_EQ(kint64max, zero / zero);
623    EXPECT_EQ(kint64max, any_dur / zero);
624    EXPECT_EQ(kint64min, -any_dur / zero);
625    EXPECT_EQ(dbl_inf, absl::FDivDuration(zero, zero));
626    EXPECT_EQ(dbl_inf, absl::FDivDuration(any_dur, zero));
627    EXPECT_EQ(-dbl_inf, absl::FDivDuration(-any_dur, zero));
628  }
629  TEST(Duration, NaN) {
630  #define TEST_NAN_HANDLING(NAME, NAN)           \
631    do {                                         \
632      const auto inf = absl::InfiniteDuration(); \
633      auto x = NAME(NAN);                        \
634      EXPECT_TRUE(x == inf || x == -inf);        \
635      auto y = NAME(42);                         \
636      y *= NAN;                                  \
637      EXPECT_TRUE(y == inf || y == -inf);        \
638      auto z = NAME(42);                         \
639      z /= NAN;                                  \
640      EXPECT_TRUE(z == inf || z == -inf);        \
641    } while (0)
642    const double nan = std::numeric_limits<double>::quiet_NaN();
643    TEST_NAN_HANDLING(absl::Nanoseconds, nan);
644    TEST_NAN_HANDLING(absl::Microseconds, nan);
645    TEST_NAN_HANDLING(absl::Milliseconds, nan);
646    TEST_NAN_HANDLING(absl::Seconds, nan);
647    TEST_NAN_HANDLING(absl::Minutes, nan);
648    TEST_NAN_HANDLING(absl::Hours, nan);
649    TEST_NAN_HANDLING(absl::Nanoseconds, -nan);
650    TEST_NAN_HANDLING(absl::Microseconds, -nan);
651    TEST_NAN_HANDLING(absl::Milliseconds, -nan);
652    TEST_NAN_HANDLING(absl::Seconds, -nan);
653    TEST_NAN_HANDLING(absl::Minutes, -nan);
654    TEST_NAN_HANDLING(absl::Hours, -nan);
655  #undef TEST_NAN_HANDLING
656  }
657  TEST(Duration, Range) {
658    const absl::Duration range = ApproxYears(100 * 1e9);
659    const absl::Duration range_future = range;
660    const absl::Duration range_past = -range;
661    EXPECT_LT(range_future, absl::InfiniteDuration());
662    EXPECT_GT(range_past, -absl::InfiniteDuration());
663    const absl::Duration full_range = range_future - range_past;
664    EXPECT_GT(full_range, absl::ZeroDuration());
665    EXPECT_LT(full_range, absl::InfiniteDuration());
666    const absl::Duration neg_full_range = range_past - range_future;
667    EXPECT_LT(neg_full_range, absl::ZeroDuration());
668    EXPECT_GT(neg_full_range, -absl::InfiniteDuration());
669    EXPECT_LT(neg_full_range, full_range);
670    EXPECT_EQ(neg_full_range, -full_range);
671  }
672  TEST(Duration, RelationalOperators) {
673  #define TEST_REL_OPS(UNIT)               \
674    static_assert(UNIT(2) == UNIT(2), ""); \
675    static_assert(UNIT(1) != UNIT(2), ""); \
676    static_assert(UNIT(1) < UNIT(2), "");  \
677    static_assert(UNIT(3) > UNIT(2), "");  \
678    static_assert(UNIT(1) <= UNIT(2), ""); \
679    static_assert(UNIT(2) <= UNIT(2), ""); \
680    static_assert(UNIT(3) >= UNIT(2), ""); \
681    static_assert(UNIT(2) >= UNIT(2), "");
682    TEST_REL_OPS(absl::Nanoseconds);
683    TEST_REL_OPS(absl::Microseconds);
684    TEST_REL_OPS(absl::Milliseconds);
685    TEST_REL_OPS(absl::Seconds);
686    TEST_REL_OPS(absl::Minutes);
687    TEST_REL_OPS(absl::Hours);
688  #undef TEST_REL_OPS
689  }
690  TEST(Duration, Addition) {
691  #define TEST_ADD_OPS(UNIT)                  \
692    do {                                      \
693      EXPECT_EQ(UNIT(2), UNIT(1) + UNIT(1));  \
694      EXPECT_EQ(UNIT(1), UNIT(2) - UNIT(1));  \
695      EXPECT_EQ(UNIT(0), UNIT(2) - UNIT(2));  \
696      EXPECT_EQ(UNIT(-1), UNIT(1) - UNIT(2)); \
697      EXPECT_EQ(UNIT(-2), UNIT(0) - UNIT(2)); \
698      EXPECT_EQ(UNIT(-2), UNIT(1) - UNIT(3)); \
699      absl::Duration a = UNIT(1);             \
700      a += UNIT(1);                           \
701      EXPECT_EQ(UNIT(2), a);                  \
702      a -= UNIT(1);                           \
703      EXPECT_EQ(UNIT(1), a);                  \
704    } while (0)
705    TEST_ADD_OPS(absl::Nanoseconds);
706    TEST_ADD_OPS(absl::Microseconds);
707    TEST_ADD_OPS(absl::Milliseconds);
708    TEST_ADD_OPS(absl::Seconds);
709    TEST_ADD_OPS(absl::Minutes);
710    TEST_ADD_OPS(absl::Hours);
711  #undef TEST_ADD_OPS
712    EXPECT_EQ(absl::Seconds(2), absl::Seconds(3) - 2 * absl::Milliseconds(500));
713    EXPECT_EQ(absl::Seconds(2) + absl::Milliseconds(500),
714              absl::Seconds(3) - absl::Milliseconds(500));
715    EXPECT_EQ(absl::Seconds(1) + absl::Milliseconds(998),
716              absl::Milliseconds(999) + absl::Milliseconds(999));
717    EXPECT_EQ(absl::Milliseconds(-1),
718              absl::Milliseconds(998) - absl::Milliseconds(999));
719    EXPECT_GT(absl::Nanoseconds(1), absl::Nanoseconds(1) / 2);
720    EXPECT_EQ(absl::Nanoseconds(1),
721              absl::Nanoseconds(1) / 2 + absl::Nanoseconds(1) / 2);
722    EXPECT_GT(absl::Nanoseconds(1) / 4, absl::Nanoseconds(0));
723    EXPECT_EQ(absl::Nanoseconds(1) / 8, absl::Nanoseconds(0));
724    absl::Duration d_7_5 = absl::Seconds(7) + absl::Milliseconds(500);
725    absl::Duration d_3_7 = absl::Seconds(3) + absl::Milliseconds(700);
726    absl::Duration ans_3_8 = absl::Seconds(3) + absl::Milliseconds(800);
727    EXPECT_EQ(ans_3_8, d_7_5 - d_3_7);
728    absl::Duration min_dur = absl::Seconds(kint64min);
729    EXPECT_EQ(absl::Seconds(0), min_dur - min_dur);
730    EXPECT_EQ(absl::Seconds(kint64max), absl::Seconds(-1) - min_dur);
731  }
732  TEST(Duration, Negation) {
733    constexpr absl::Duration negated_zero_duration = -absl::ZeroDuration();
734    EXPECT_EQ(negated_zero_duration, absl::ZeroDuration());
735    constexpr absl::Duration negated_infinite_duration =
736        -absl::InfiniteDuration();
737    EXPECT_NE(negated_infinite_duration, absl::InfiniteDuration());
738    EXPECT_EQ(-negated_infinite_duration, absl::InfiniteDuration());
739    EXPECT_TRUE(
740        absl::time_internal::IsInfiniteDuration(negated_infinite_duration));
741    constexpr absl::Duration max_duration = absl::time_internal::MakeDuration(
742        kint64max, absl::time_internal::kTicksPerSecond - 1);
743    constexpr absl::Duration negated_max_duration = -max_duration;
<span onclick='openModal()' class='match'>744    constexpr absl::Duration nearly_min_duration =
745        absl::time_internal::MakeDuration(kint64min, int64_t{1});
746    constexpr absl::Duration negated_nearly_min_duration = -nearly_min_duration;
747    EXPECT_EQ(negated_max_duration, nearly_min_duration);
748    EXPECT_EQ(negated_nearly_min_duration, max_duration);
749    EXPECT_EQ(-(-max_duration), max_duration);
750    constexpr absl::Duration min_duration =
751        absl::time_internal::MakeDuration(kint64min);
752    constexpr absl::Duration negated_min_duration = -min_duration;
753    EXPECT_EQ(negated_min_duration, absl::InfiniteDuration());
754  }
755  TEST(Duration, AbsoluteValue) {
756    EXPECT_EQ(absl::ZeroDuration(), AbsDuration(absl::ZeroDuration()));
757    EXPECT_EQ(absl::Seconds(1), AbsDuration(absl::Seconds(1)));
758    EXPECT_EQ(absl::Seconds(1), AbsDuration(absl::Seconds(-1)));
759    EXPECT_EQ(absl::InfiniteDuration(), AbsDuration(absl::InfiniteDuration()));
760    EXPECT_EQ(absl::InfiniteDuration(), AbsDuration(-absl::InfiniteDuration()));
761    absl::Duration max_dur =
762        absl::Seconds(kint64max) + (absl::Seconds(1) - absl::Nanoseconds(1) / 4);
763    EXPECT_EQ(max_dur, AbsDuration(max_dur));
764    absl::Duration min_dur = absl::Seconds(kint64min);
</span>765    EXPECT_EQ(absl::InfiniteDuration(), AbsDuration(min_dur));
766    EXPECT_EQ(max_dur, AbsDuration(min_dur + absl::Nanoseconds(1) / 4));
767  }
768  TEST(Duration, Multiplication) {
769  #define TEST_MUL_OPS(UNIT)                                    \
770    do {                                                        \
771      EXPECT_EQ(UNIT(5), UNIT(2) * 2.5);                        \
772      EXPECT_EQ(UNIT(2), UNIT(5) / 2.5);                        \
773      EXPECT_EQ(UNIT(-5), UNIT(-2) * 2.5);                      \
774      EXPECT_EQ(UNIT(-5), -UNIT(2) * 2.5);                      \
775      EXPECT_EQ(UNIT(-5), UNIT(2) * -2.5);                      \
776      EXPECT_EQ(UNIT(-2), UNIT(-5) / 2.5);                      \
777      EXPECT_EQ(UNIT(-2), -UNIT(5) / 2.5);                      \
778      EXPECT_EQ(UNIT(-2), UNIT(5) / -2.5);                      \
779      EXPECT_EQ(UNIT(2), UNIT(11) % UNIT(3));                   \
780      absl::Duration a = UNIT(2);                               \
781      a *= 2.5;                                                 \
782      EXPECT_EQ(UNIT(5), a);                                    \
783      a /= 2.5;                                                 \
784      EXPECT_EQ(UNIT(2), a);                                    \
785      a %= UNIT(1);                                             \
786      EXPECT_EQ(UNIT(0), a);                                    \
787      absl::Duration big = UNIT(1000000000);                    \
788      big *= 3;                                                 \
789      big /= 3;                                                 \
790      EXPECT_EQ(UNIT(1000000000), big);                         \
791      EXPECT_EQ(-UNIT(2), -UNIT(2));                            \
792      EXPECT_EQ(-UNIT(2), UNIT(2) * -1);                        \
793      EXPECT_EQ(-UNIT(2), -1 * UNIT(2));                        \
794      EXPECT_EQ(-UNIT(-2), UNIT(2));                            \
795      EXPECT_EQ(2, UNIT(2) / UNIT(1));                          \
796      absl::Duration rem;                                       \
797      EXPECT_EQ(2, absl::IDivDuration(UNIT(2), UNIT(1), &rem)); \
798      EXPECT_EQ(2.0, absl::FDivDuration(UNIT(2), UNIT(1)));     \
799    } while (0)
800    TEST_MUL_OPS(absl::Nanoseconds);
801    TEST_MUL_OPS(absl::Microseconds);
802    TEST_MUL_OPS(absl::Milliseconds);
803    TEST_MUL_OPS(absl::Seconds);
804    TEST_MUL_OPS(absl::Minutes);
805    TEST_MUL_OPS(absl::Hours);
806  #undef TEST_MUL_OPS
807    absl::Duration max_dur =
808        absl::Seconds(kint64max) + (absl::Seconds(1) - absl::Nanoseconds(1) / 4);
809    absl::Duration min_dur = absl::Seconds(kint64min);
810    EXPECT_EQ(max_dur, max_dur * 1);
811    EXPECT_EQ(max_dur, max_dur / 1);
812    EXPECT_EQ(min_dur, min_dur * 1);
813    EXPECT_EQ(min_dur, min_dur / 1);
814    absl::Duration sigfigs = absl::Seconds(2000000000) + absl::Nanoseconds(3);
815    EXPECT_EQ(absl::Seconds(666666666) + absl::Nanoseconds(666666667) +
816                  absl::Nanoseconds(1) / 2,
817              sigfigs / 3);
818    sigfigs = absl::Seconds(int64_t{7000000000});
819    EXPECT_EQ(absl::Seconds(2333333333) + absl::Nanoseconds(333333333) +
820                  absl::Nanoseconds(1) / 4,
821              sigfigs / 3);
822    EXPECT_EQ(absl::Seconds(7) + absl::Milliseconds(500), absl::Seconds(3) * 2.5);
823    EXPECT_EQ(absl::Seconds(8) * -1 + absl::Milliseconds(300),
824              (absl::Seconds(2) + absl::Milliseconds(200)) * -3.5);
825    EXPECT_EQ(-absl::Seconds(8) + absl::Milliseconds(300),
826              (absl::Seconds(2) + absl::Milliseconds(200)) * -3.5);
827    EXPECT_EQ(absl::Seconds(1) + absl::Milliseconds(875),
828              (absl::Seconds(7) + absl::Milliseconds(500)) / 4);
829    EXPECT_EQ(absl::Seconds(30),
830              (absl::Seconds(7) + absl::Milliseconds(500)) / 0.25);
831    EXPECT_EQ(absl::Seconds(3),
832              (absl::Seconds(7) + absl::Milliseconds(500)) / 2.5);
833    EXPECT_EQ(absl::Nanoseconds(0), absl::Nanoseconds(7) % absl::Nanoseconds(1));
834    EXPECT_EQ(absl::Nanoseconds(0), absl::Nanoseconds(0) % absl::Nanoseconds(10));
835    EXPECT_EQ(absl::Nanoseconds(2), absl::Nanoseconds(7) % absl::Nanoseconds(5));
836    EXPECT_EQ(absl::Nanoseconds(2), absl::Nanoseconds(2) % absl::Nanoseconds(5));
837    EXPECT_EQ(absl::Nanoseconds(1), absl::Nanoseconds(10) % absl::Nanoseconds(3));
838    EXPECT_EQ(absl::Nanoseconds(1),
839              absl::Nanoseconds(10) % absl::Nanoseconds(-3));
840    EXPECT_EQ(absl::Nanoseconds(-1),
841              absl::Nanoseconds(-10) % absl::Nanoseconds(3));
842    EXPECT_EQ(absl::Nanoseconds(-1),
843              absl::Nanoseconds(-10) % absl::Nanoseconds(-3));
844    EXPECT_EQ(absl::Milliseconds(100),
845              absl::Seconds(1) % absl::Milliseconds(300));
846    EXPECT_EQ(
847        absl::Milliseconds(300),
848        (absl::Seconds(3) + absl::Milliseconds(800)) % absl::Milliseconds(500));
849    EXPECT_EQ(absl::Nanoseconds(1), absl::Nanoseconds(1) % absl::Seconds(1));
850    EXPECT_EQ(absl::Nanoseconds(-1), absl::Nanoseconds(-1) % absl::Seconds(1));
851    EXPECT_EQ(0, absl::Nanoseconds(-1) / absl::Seconds(1));  
852  #define TEST_MOD_IDENTITY(a, b) \
853    EXPECT_EQ((a), ((a) / (b))*(b) + ((a)%(b)))
854    TEST_MOD_IDENTITY(absl::Seconds(0), absl::Seconds(2));
855    TEST_MOD_IDENTITY(absl::Seconds(1), absl::Seconds(1));
856    TEST_MOD_IDENTITY(absl::Seconds(1), absl::Seconds(2));
857    TEST_MOD_IDENTITY(absl::Seconds(2), absl::Seconds(1));
858    TEST_MOD_IDENTITY(absl::Seconds(-2), absl::Seconds(1));
859    TEST_MOD_IDENTITY(absl::Seconds(2), absl::Seconds(-1));
860    TEST_MOD_IDENTITY(absl::Seconds(-2), absl::Seconds(-1));
861    TEST_MOD_IDENTITY(absl::Nanoseconds(0), absl::Nanoseconds(2));
862    TEST_MOD_IDENTITY(absl::Nanoseconds(1), absl::Nanoseconds(1));
863    TEST_MOD_IDENTITY(absl::Nanoseconds(1), absl::Nanoseconds(2));
864    TEST_MOD_IDENTITY(absl::Nanoseconds(2), absl::Nanoseconds(1));
865    TEST_MOD_IDENTITY(absl::Nanoseconds(-2), absl::Nanoseconds(1));
866    TEST_MOD_IDENTITY(absl::Nanoseconds(2), absl::Nanoseconds(-1));
867    TEST_MOD_IDENTITY(absl::Nanoseconds(-2), absl::Nanoseconds(-1));
868    absl::Duration mixed_a = absl::Seconds(1) + absl::Nanoseconds(2);
869    absl::Duration mixed_b = absl::Seconds(1) + absl::Nanoseconds(3);
870    TEST_MOD_IDENTITY(absl::Seconds(0), mixed_a);
871    TEST_MOD_IDENTITY(mixed_a, mixed_a);
872    TEST_MOD_IDENTITY(mixed_a, mixed_b);
873    TEST_MOD_IDENTITY(mixed_b, mixed_a);
874    TEST_MOD_IDENTITY(-mixed_a, mixed_b);
875    TEST_MOD_IDENTITY(mixed_a, -mixed_b);
876    TEST_MOD_IDENTITY(-mixed_a, -mixed_b);
877  #undef TEST_MOD_IDENTITY
878  }
879  TEST(Duration, Truncation) {
880    const absl::Duration d = absl::Nanoseconds(1234567890);
881    const absl::Duration inf = absl::InfiniteDuration();
882    for (int unit_sign : {1, -1}) {  
883      EXPECT_EQ(absl::Nanoseconds(1234567890),
884                Trunc(d, unit_sign * absl::Nanoseconds(1)));
885      EXPECT_EQ(absl::Microseconds(1234567),
886                Trunc(d, unit_sign * absl::Microseconds(1)));
887      EXPECT_EQ(absl::Milliseconds(1234),
888                Trunc(d, unit_sign * absl::Milliseconds(1)));
889      EXPECT_EQ(absl::Seconds(1), Trunc(d, unit_sign * absl::Seconds(1)));
890      EXPECT_EQ(inf, Trunc(inf, unit_sign * absl::Seconds(1)));
891      EXPECT_EQ(absl::Nanoseconds(-1234567890),
892                Trunc(-d, unit_sign * absl::Nanoseconds(1)));
893      EXPECT_EQ(absl::Microseconds(-1234567),
894                Trunc(-d, unit_sign * absl::Microseconds(1)));
895      EXPECT_EQ(absl::Milliseconds(-1234),
896                Trunc(-d, unit_sign * absl::Milliseconds(1)));
897      EXPECT_EQ(absl::Seconds(-1), Trunc(-d, unit_sign * absl::Seconds(1)));
898      EXPECT_EQ(-inf, Trunc(-inf, unit_sign * absl::Seconds(1)));
899    }
900  }
901  TEST(Duration, Flooring) {
902    const absl::Duration d = absl::Nanoseconds(1234567890);
903    const absl::Duration inf = absl::InfiniteDuration();
904    for (int unit_sign : {1, -1}) {  
905      EXPECT_EQ(absl::Nanoseconds(1234567890),
906                absl::Floor(d, unit_sign * absl::Nanoseconds(1)));
907      EXPECT_EQ(absl::Microseconds(1234567),
908                absl::Floor(d, unit_sign * absl::Microseconds(1)));
909      EXPECT_EQ(absl::Milliseconds(1234),
910                absl::Floor(d, unit_sign * absl::Milliseconds(1)));
911      EXPECT_EQ(absl::Seconds(1), absl::Floor(d, unit_sign * absl::Seconds(1)));
912      EXPECT_EQ(inf, absl::Floor(inf, unit_sign * absl::Seconds(1)));
913      EXPECT_EQ(absl::Nanoseconds(-1234567890),
914                absl::Floor(-d, unit_sign * absl::Nanoseconds(1)));
915      EXPECT_EQ(absl::Microseconds(-1234568),
916                absl::Floor(-d, unit_sign * absl::Microseconds(1)));
917      EXPECT_EQ(absl::Milliseconds(-1235),
918                absl::Floor(-d, unit_sign * absl::Milliseconds(1)));
919      EXPECT_EQ(absl::Seconds(-2), absl::Floor(-d, unit_sign * absl::Seconds(1)));
920      EXPECT_EQ(-inf, absl::Floor(-inf, unit_sign * absl::Seconds(1)));
921    }
922  }
923  TEST(Duration, Ceiling) {
924    const absl::Duration d = absl::Nanoseconds(1234567890);
925    const absl::Duration inf = absl::InfiniteDuration();
926    for (int unit_sign : {1, -1}) {  
927      EXPECT_EQ(absl::Nanoseconds(1234567890),
928                absl::Ceil(d, unit_sign * absl::Nanoseconds(1)));
929      EXPECT_EQ(absl::Microseconds(1234568),
930                absl::Ceil(d, unit_sign * absl::Microseconds(1)));
931      EXPECT_EQ(absl::Milliseconds(1235),
932                absl::Ceil(d, unit_sign * absl::Milliseconds(1)));
933      EXPECT_EQ(absl::Seconds(2), absl::Ceil(d, unit_sign * absl::Seconds(1)));
934      EXPECT_EQ(inf, absl::Ceil(inf, unit_sign * absl::Seconds(1)));
935      EXPECT_EQ(absl::Nanoseconds(-1234567890),
936                absl::Ceil(-d, unit_sign * absl::Nanoseconds(1)));
937      EXPECT_EQ(absl::Microseconds(-1234567),
938                absl::Ceil(-d, unit_sign * absl::Microseconds(1)));
939      EXPECT_EQ(absl::Milliseconds(-1234),
940                absl::Ceil(-d, unit_sign * absl::Milliseconds(1)));
941      EXPECT_EQ(absl::Seconds(-1), absl::Ceil(-d, unit_sign * absl::Seconds(1)));
942      EXPECT_EQ(-inf, absl::Ceil(-inf, unit_sign * absl::Seconds(1)));
943    }
944  }
945  TEST(Duration, RoundTripUnits) {
946    const int kRange = 100000;
947  #define ROUND_TRIP_UNIT(U, LOW, HIGH)          \
948    do {                                         \
949      for (int64_t i = LOW; i < HIGH; ++i) {     \
950        absl::Duration d = absl::U(i);           \
951        if (d == absl::InfiniteDuration())       \
952          EXPECT_EQ(kint64max, d / absl::U(1));  \
953        else if (d == -absl::InfiniteDuration()) \
954          EXPECT_EQ(kint64min, d / absl::U(1));  \
955        else                                     \
956          EXPECT_EQ(i, absl::U(i) / absl::U(1)); \
957      }                                          \
958    } while (0)
959    ROUND_TRIP_UNIT(Nanoseconds, kint64min, kint64min + kRange);
960    ROUND_TRIP_UNIT(Nanoseconds, -kRange, kRange);
961    ROUND_TRIP_UNIT(Nanoseconds, kint64max - kRange, kint64max);
962    ROUND_TRIP_UNIT(Microseconds, kint64min, kint64min + kRange);
963    ROUND_TRIP_UNIT(Microseconds, -kRange, kRange);
964    ROUND_TRIP_UNIT(Microseconds, kint64max - kRange, kint64max);
965    ROUND_TRIP_UNIT(Milliseconds, kint64min, kint64min + kRange);
966    ROUND_TRIP_UNIT(Milliseconds, -kRange, kRange);
967    ROUND_TRIP_UNIT(Milliseconds, kint64max - kRange, kint64max);
968    ROUND_TRIP_UNIT(Seconds, kint64min, kint64min + kRange);
969    ROUND_TRIP_UNIT(Seconds, -kRange, kRange);
970    ROUND_TRIP_UNIT(Seconds, kint64max - kRange, kint64max);
971    ROUND_TRIP_UNIT(Minutes, kint64min / 60, kint64min / 60 + kRange);
972    ROUND_TRIP_UNIT(Minutes, -kRange, kRange);
973    ROUND_TRIP_UNIT(Minutes, kint64max / 60 - kRange, kint64max / 60);
974    ROUND_TRIP_UNIT(Hours, kint64min / 3600, kint64min / 3600 + kRange);
975    ROUND_TRIP_UNIT(Hours, -kRange, kRange);
976    ROUND_TRIP_UNIT(Hours, kint64max / 3600 - kRange, kint64max / 3600);
977  #undef ROUND_TRIP_UNIT
978  }
979  TEST(Duration, TruncConversions) {
980    const struct {
981      absl::Duration d;
982      timespec ts;
983    } to_ts[] = {
984        {absl::Seconds(1) + absl::Nanoseconds(1), {1, 1}},
985        {absl::Seconds(1) + absl::Nanoseconds(1) / 2, {1, 0}},
986        {absl::Seconds(1) + absl::Nanoseconds(0), {1, 0}},
987        {absl::Seconds(0) + absl::Nanoseconds(0), {0, 0}},
988        {absl::Seconds(0) - absl::Nanoseconds(1) / 2, {0, 0}},
989        {absl::Seconds(0) - absl::Nanoseconds(1), {-1, 999999999}},
990        {absl::Seconds(-1) + absl::Nanoseconds(1), {-1, 1}},
991        {absl::Seconds(-1) + absl::Nanoseconds(1) / 2, {-1, 1}},
992        {absl::Seconds(-1) + absl::Nanoseconds(0), {-1, 0}},
993        {absl::Seconds(-1) - absl::Nanoseconds(1) / 2, {-1, 0}},
994    };
995    for (const auto& test : to_ts) {
996      EXPECT_THAT(absl::ToTimespec(test.d), TimespecMatcher(test.ts));
997    }
998    const struct {
999      timespec ts;
1000      absl::Duration d;
1001    } from_ts[] = {
1002        {{1, 1}, absl::Seconds(1) + absl::Nanoseconds(1)},
1003        {{1, 0}, absl::Seconds(1) + absl::Nanoseconds(0)},
1004        {{0, 0}, absl::Seconds(0) + absl::Nanoseconds(0)},
1005        {{0, -1}, absl::Seconds(0) - absl::Nanoseconds(1)},
1006        {{-1, 999999999}, absl::Seconds(0) - absl::Nanoseconds(1)},
1007        {{-1, 1}, absl::Seconds(-1) + absl::Nanoseconds(1)},
1008        {{-1, 0}, absl::Seconds(-1) + absl::Nanoseconds(0)},
1009        {{-1, -1}, absl::Seconds(-1) - absl::Nanoseconds(1)},
1010        {{-2, 999999999}, absl::Seconds(-1) - absl::Nanoseconds(1)},
1011    };
1012    for (const auto& test : from_ts) {
1013      EXPECT_EQ(test.d, absl::DurationFromTimespec(test.ts));
1014    }
1015    const struct {
1016      absl::Duration d;
1017      timeval tv;
1018    } to_tv[] = {
1019        {absl::Seconds(1) + absl::Microseconds(1), {1, 1}},
1020        {absl::Seconds(1) + absl::Microseconds(1) / 2, {1, 0}},
1021        {absl::Seconds(1) + absl::Microseconds(0), {1, 0}},
1022        {absl::Seconds(0) + absl::Microseconds(0), {0, 0}},
1023        {absl::Seconds(0) - absl::Microseconds(1) / 2, {0, 0}},
1024        {absl::Seconds(0) - absl::Microseconds(1), {-1, 999999}},
1025        {absl::Seconds(-1) + absl::Microseconds(1), {-1, 1}},
1026        {absl::Seconds(-1) + absl::Microseconds(1) / 2, {-1, 1}},
1027        {absl::Seconds(-1) + absl::Microseconds(0), {-1, 0}},
1028        {absl::Seconds(-1) - absl::Microseconds(1) / 2, {-1, 0}},
1029    };
1030    for (const auto& test : to_tv) {
1031      EXPECT_THAT(absl::ToTimeval(test.d), TimevalMatcher(test.tv));
1032    }
1033    const struct {
1034      timeval tv;
1035      absl::Duration d;
1036    } from_tv[] = {
1037        {{1, 1}, absl::Seconds(1) + absl::Microseconds(1)},
1038        {{1, 0}, absl::Seconds(1) + absl::Microseconds(0)},
1039        {{0, 0}, absl::Seconds(0) + absl::Microseconds(0)},
1040        {{0, -1}, absl::Seconds(0) - absl::Microseconds(1)},
1041        {{-1, 999999}, absl::Seconds(0) - absl::Microseconds(1)},
1042        {{-1, 1}, absl::Seconds(-1) + absl::Microseconds(1)},
1043        {{-1, 0}, absl::Seconds(-1) + absl::Microseconds(0)},
1044        {{-1, -1}, absl::Seconds(-1) - absl::Microseconds(1)},
1045        {{-2, 999999}, absl::Seconds(-1) - absl::Microseconds(1)},
1046    };
1047    for (const auto& test : from_tv) {
1048      EXPECT_EQ(test.d, absl::DurationFromTimeval(test.tv));
1049    }
1050  }
1051  TEST(Duration, SmallConversions) {
1052    EXPECT_EQ(absl::ZeroDuration(), absl::Seconds(0));
1053    EXPECT_EQ(absl::ZeroDuration(), absl::Seconds(std::nextafter(0.125e-9, 0)));
1054    EXPECT_EQ(absl::Nanoseconds(1) / 4, absl::Seconds(0.125e-9));
1055    EXPECT_EQ(absl::Nanoseconds(1) / 4, absl::Seconds(0.250e-9));
1056    EXPECT_EQ(absl::Nanoseconds(1) / 2, absl::Seconds(0.375e-9));
1057    EXPECT_EQ(absl::Nanoseconds(1) / 2, absl::Seconds(0.500e-9));
1058    EXPECT_EQ(absl::Nanoseconds(3) / 4, absl::Seconds(0.625e-9));
1059    EXPECT_EQ(absl::Nanoseconds(3) / 4, absl::Seconds(0.750e-9));
1060    EXPECT_EQ(absl::Nanoseconds(1), absl::Seconds(0.875e-9));
1061    EXPECT_EQ(absl::Nanoseconds(1), absl::Seconds(1.000e-9));
1062    EXPECT_EQ(absl::ZeroDuration(), absl::Seconds(std::nextafter(-0.125e-9, 0)));
1063    EXPECT_EQ(-absl::Nanoseconds(1) / 4, absl::Seconds(-0.125e-9));
1064    EXPECT_EQ(-absl::Nanoseconds(1) / 4, absl::Seconds(-0.250e-9));
1065    EXPECT_EQ(-absl::Nanoseconds(1) / 2, absl::Seconds(-0.375e-9));
1066    EXPECT_EQ(-absl::Nanoseconds(1) / 2, absl::Seconds(-0.500e-9));
1067    EXPECT_EQ(-absl::Nanoseconds(3) / 4, absl::Seconds(-0.625e-9));
1068    EXPECT_EQ(-absl::Nanoseconds(3) / 4, absl::Seconds(-0.750e-9));
1069    EXPECT_EQ(-absl::Nanoseconds(1), absl::Seconds(-0.875e-9));
1070    EXPECT_EQ(-absl::Nanoseconds(1), absl::Seconds(-1.000e-9));
1071    timespec ts;
1072    ts.tv_sec = 0;
1073    ts.tv_nsec = 0;
1074    EXPECT_THAT(ToTimespec(absl::Nanoseconds(0)), TimespecMatcher(ts));
1075    EXPECT_THAT(ToTimespec(absl::Nanoseconds(1) / 4), TimespecMatcher(ts));
1076    EXPECT_THAT(ToTimespec(absl::Nanoseconds(2) / 4), TimespecMatcher(ts));
1077    EXPECT_THAT(ToTimespec(absl::Nanoseconds(3) / 4), TimespecMatcher(ts));
1078    ts.tv_nsec = 1;
1079    EXPECT_THAT(ToTimespec(absl::Nanoseconds(4) / 4), TimespecMatcher(ts));
1080    EXPECT_THAT(ToTimespec(absl::Nanoseconds(5) / 4), TimespecMatcher(ts));
1081    EXPECT_THAT(ToTimespec(absl::Nanoseconds(6) / 4), TimespecMatcher(ts));
1082    EXPECT_THAT(ToTimespec(absl::Nanoseconds(7) / 4), TimespecMatcher(ts));
1083    ts.tv_nsec = 2;
1084    EXPECT_THAT(ToTimespec(absl::Nanoseconds(8) / 4), TimespecMatcher(ts));
1085    timeval tv;
1086    tv.tv_sec = 0;
1087    tv.tv_usec = 0;
1088    EXPECT_THAT(ToTimeval(absl::Nanoseconds(0)), TimevalMatcher(tv));
1089    EXPECT_THAT(ToTimeval(absl::Nanoseconds(999)), TimevalMatcher(tv));
1090    tv.tv_usec = 1;
1091    EXPECT_THAT(ToTimeval(absl::Nanoseconds(1000)), TimevalMatcher(tv));
1092    EXPECT_THAT(ToTimeval(absl::Nanoseconds(1999)), TimevalMatcher(tv));
1093    tv.tv_usec = 2;
1094    EXPECT_THAT(ToTimeval(absl::Nanoseconds(2000)), TimevalMatcher(tv));
1095  }
1096  void VerifyApproxSameAsMul(double time_as_seconds, int* const misses) {
1097    auto direct_seconds = absl::Seconds(time_as_seconds);
1098    auto mul_by_one_second = time_as_seconds * absl::Seconds(1);
1099    if (absl::AbsDuration(direct_seconds - mul_by_one_second) >
1100        absl::time_internal::MakeDuration(0, 1u)) {
1101      if (*misses > 10) return;
1102      ASSERT_LE(++(*misses), 10) << "Too many errors, not reporting more.";
1103      EXPECT_EQ(direct_seconds, mul_by_one_second)
1104          << "given double time_as_seconds = " << std::setprecision(17)
1105          << time_as_seconds;
1106    }
1107  }
1108  TEST(Duration, ToDoubleSecondsCheckEdgeCases) {
1109  #if (defined(__i386__) || defined(_M_IX86)) && FLT_EVAL_METHOD != 0
1110    GTEST_SKIP()
1111        << "Skipping the test because we detected x87 floating-point semantics";
1112  #endif
1113    constexpr uint32_t kTicksPerSecond = absl::time_internal::kTicksPerSecond;
1114    constexpr auto duration_tick = absl::time_internal::MakeDuration(0, 1u);
1115    int misses = 0;
1116    for (int64_t seconds = 0; seconds < 99; ++seconds) {
1117      uint32_t tick_vals[] = {0, +999, +999999, +999999999, kTicksPerSecond - 1,
1118                              0, 1000, 1000000, 1000000000, kTicksPerSecond,
1119                              1, 1001, 1000001, 1000000001, kTicksPerSecond + 1,
1120                              2, 1002, 1000002, 1000000002, kTicksPerSecond + 2,
1121                              3, 1003, 1000003, 1000000003, kTicksPerSecond + 3,
1122                              4, 1004, 1000004, 1000000004, kTicksPerSecond + 4,
1123                              5, 6,    7,       8,          9};
1124      for (uint32_t ticks : tick_vals) {
1125        absl::Duration s_plus_t = absl::Seconds(seconds) + ticks * duration_tick;
1126        for (absl::Duration d : {s_plus_t, -s_plus_t}) {
1127          absl::Duration after_d = d + duration_tick;
1128          EXPECT_NE(d, after_d);
1129          EXPECT_EQ(after_d - d, duration_tick);
1130          double low_edge = ToDoubleSeconds(d);
1131          EXPECT_EQ(d, absl::Seconds(low_edge));
1132          double high_edge = ToDoubleSeconds(after_d);
1133          EXPECT_EQ(after_d, absl::Seconds(high_edge));
1134          for (;;) {
1135            double midpoint = low_edge + (high_edge - low_edge) / 2;
1136            if (midpoint == low_edge || midpoint == high_edge) break;
1137            absl::Duration mid_duration = absl::Seconds(midpoint);
1138            if (mid_duration == d) {
1139              low_edge = midpoint;
1140            } else {
1141              EXPECT_EQ(mid_duration, after_d);
1142              high_edge = midpoint;
1143            }
1144          }
1145          VerifyApproxSameAsMul(low_edge, &misses);
1146          VerifyApproxSameAsMul(high_edge, &misses);
1147        }
1148      }
1149    }
1150  }
1151  TEST(Duration, ToDoubleSecondsCheckRandom) {
1152    std::random_device rd;
1153    std::seed_seq seed({rd(), rd(), rd(), rd(), rd(), rd(), rd(), rd()});
1154    std::mt19937_64 gen(seed);
1155    std::uniform_real_distribution<double> uniform(std::log(0.125e-9),
1156                                                   std::log(9.223377e+18));
1157    int misses = 0;
1158    for (int i = 0; i < 1000000; ++i) {
1159      double d = std::exp(uniform(gen));
1160      VerifyApproxSameAsMul(d, &misses);
1161      VerifyApproxSameAsMul(-d, &misses);
1162    }
1163  }
1164  TEST(Duration, ConversionSaturation) {
1165    absl::Duration d;
1166    const auto max_timeval_sec =
1167        std::numeric_limits<decltype(timeval::tv_sec)>::max();
1168    const auto min_timeval_sec =
1169        std::numeric_limits<decltype(timeval::tv_sec)>::min();
1170    timeval tv;
1171    tv.tv_sec = max_timeval_sec;
1172    tv.tv_usec = 999998;
1173    d = absl::DurationFromTimeval(tv);
1174    tv = ToTimeval(d);
1175    EXPECT_EQ(max_timeval_sec, tv.tv_sec);
1176    EXPECT_EQ(999998, tv.tv_usec);
1177    d += absl::Microseconds(1);
1178    tv = ToTimeval(d);
1179    EXPECT_EQ(max_timeval_sec, tv.tv_sec);
1180    EXPECT_EQ(999999, tv.tv_usec);
1181    d += absl::Microseconds(1);  
1182    tv = ToTimeval(d);
1183    EXPECT_EQ(max_timeval_sec, tv.tv_sec);
1184    EXPECT_EQ(999999, tv.tv_usec);
1185    tv.tv_sec = min_timeval_sec;
1186    tv.tv_usec = 1;
1187    d = absl::DurationFromTimeval(tv);
1188    tv = ToTimeval(d);
1189    EXPECT_EQ(min_timeval_sec, tv.tv_sec);
1190    EXPECT_EQ(1, tv.tv_usec);
1191    d -= absl::Microseconds(1);
1192    tv = ToTimeval(d);
1193    EXPECT_EQ(min_timeval_sec, tv.tv_sec);
1194    EXPECT_EQ(0, tv.tv_usec);
1195    d -= absl::Microseconds(1);  
1196    tv = ToTimeval(d);
1197    EXPECT_EQ(min_timeval_sec, tv.tv_sec);
1198    EXPECT_EQ(0, tv.tv_usec);
1199    const auto max_timespec_sec =
1200        std::numeric_limits<decltype(timespec::tv_sec)>::max();
1201    const auto min_timespec_sec =
1202        std::numeric_limits<decltype(timespec::tv_sec)>::min();
1203    timespec ts;
1204    ts.tv_sec = max_timespec_sec;
1205    ts.tv_nsec = 999999998;
1206    d = absl::DurationFromTimespec(ts);
1207    ts = absl::ToTimespec(d);
1208    EXPECT_EQ(max_timespec_sec, ts.tv_sec);
1209    EXPECT_EQ(999999998, ts.tv_nsec);
1210    d += absl::Nanoseconds(1);
1211    ts = absl::ToTimespec(d);
1212    EXPECT_EQ(max_timespec_sec, ts.tv_sec);
1213    EXPECT_EQ(999999999, ts.tv_nsec);
1214    d += absl::Nanoseconds(1);  
1215    ts = absl::ToTimespec(d);
1216    EXPECT_EQ(max_timespec_sec, ts.tv_sec);
1217    EXPECT_EQ(999999999, ts.tv_nsec);
1218    ts.tv_sec = min_timespec_sec;
1219    ts.tv_nsec = 1;
1220    d = absl::DurationFromTimespec(ts);
1221    ts = absl::ToTimespec(d);
1222    EXPECT_EQ(min_timespec_sec, ts.tv_sec);
1223    EXPECT_EQ(1, ts.tv_nsec);
1224    d -= absl::Nanoseconds(1);
1225    ts = absl::ToTimespec(d);
1226    EXPECT_EQ(min_timespec_sec, ts.tv_sec);
1227    EXPECT_EQ(0, ts.tv_nsec);
1228    d -= absl::Nanoseconds(1);  
1229    ts = absl::ToTimespec(d);
1230    EXPECT_EQ(min_timespec_sec, ts.tv_sec);
1231    EXPECT_EQ(0, ts.tv_nsec);
1232  }
1233  TEST(Duration, FormatDuration) {
1234    EXPECT_EQ("72h3m0.5s",
1235              absl::FormatDuration(absl::Hours(72) + absl::Minutes(3) +
1236                                   absl::Milliseconds(500)));
1237    EXPECT_EQ("2540400h10m10s",
1238              absl::FormatDuration(absl::Hours(2540400) + absl::Minutes(10) +
1239                                   absl::Seconds(10)));
1240    EXPECT_EQ("0", absl::FormatDuration(absl::ZeroDuration()));
1241    EXPECT_EQ("0", absl::FormatDuration(absl::Seconds(0)));
1242    EXPECT_EQ("0", absl::FormatDuration(absl::Nanoseconds(0)));
1243    EXPECT_EQ("1ns", absl::FormatDuration(absl::Nanoseconds(1)));
1244    EXPECT_EQ("1us", absl::FormatDuration(absl::Microseconds(1)));
1245    EXPECT_EQ("1ms", absl::FormatDuration(absl::Milliseconds(1)));
1246    EXPECT_EQ("1s", absl::FormatDuration(absl::Seconds(1)));
1247    EXPECT_EQ("1m", absl::FormatDuration(absl::Minutes(1)));
1248    EXPECT_EQ("1h", absl::FormatDuration(absl::Hours(1)));
1249    EXPECT_EQ("1h1m", absl::FormatDuration(absl::Hours(1) + absl::Minutes(1)));
1250    EXPECT_EQ("1h1s", absl::FormatDuration(absl::Hours(1) + absl::Seconds(1)));
1251    EXPECT_EQ("1m1s", absl::FormatDuration(absl::Minutes(1) + absl::Seconds(1)));
1252    EXPECT_EQ("1h0.25s",
1253              absl::FormatDuration(absl::Hours(1) + absl::Milliseconds(250)));
1254    EXPECT_EQ("1m0.25s",
1255              absl::FormatDuration(absl::Minutes(1) + absl::Milliseconds(250)));
1256    EXPECT_EQ("1h1m0.25s",
1257              absl::FormatDuration(absl::Hours(1) + absl::Minutes(1) +
1258                                   absl::Milliseconds(250)));
1259    EXPECT_EQ("1h0.0005s",
1260              absl::FormatDuration(absl::Hours(1) + absl::Microseconds(500)));
1261    EXPECT_EQ("1h0.0000005s",
1262              absl::FormatDuration(absl::Hours(1) + absl::Nanoseconds(500)));
1263    EXPECT_EQ("1.5ns", absl::FormatDuration(absl::Nanoseconds(1) +
1264                                            absl::Nanoseconds(1) / 2));
1265    EXPECT_EQ("1.25ns", absl::FormatDuration(absl::Nanoseconds(1) +
1266                                             absl::Nanoseconds(1) / 4));
1267    EXPECT_EQ("1ns", absl::FormatDuration(absl::Nanoseconds(1) +
1268                                          absl::Nanoseconds(1) / 9));
1269    EXPECT_EQ("1.2us", absl::FormatDuration(absl::Microseconds(1) +
1270                                            absl::Nanoseconds(200)));
1271    EXPECT_EQ("1.2ms", absl::FormatDuration(absl::Milliseconds(1) +
1272                                            absl::Microseconds(200)));
1273    EXPECT_EQ("1.0002ms", absl::FormatDuration(absl::Milliseconds(1) +
1274                                               absl::Nanoseconds(200)));
1275    EXPECT_EQ("1.00001ms", absl::FormatDuration(absl::Milliseconds(1) +
1276                                                absl::Nanoseconds(10)));
1277    EXPECT_EQ("1.000001ms",
1278              absl::FormatDuration(absl::Milliseconds(1) + absl::Nanoseconds(1)));
1279    EXPECT_EQ("-1ns", absl::FormatDuration(absl::Nanoseconds(-1)));
1280    EXPECT_EQ("-1us", absl::FormatDuration(absl::Microseconds(-1)));
1281    EXPECT_EQ("-1ms", absl::FormatDuration(absl::Milliseconds(-1)));
1282    EXPECT_EQ("-1s", absl::FormatDuration(absl::Seconds(-1)));
1283    EXPECT_EQ("-1m", absl::FormatDuration(absl::Minutes(-1)));
1284    EXPECT_EQ("-1h", absl::FormatDuration(absl::Hours(-1)));
1285    EXPECT_EQ("-1h1m",
1286              absl::FormatDuration(-(absl::Hours(1) + absl::Minutes(1))));
1287    EXPECT_EQ("-1h1s",
1288              absl::FormatDuration(-(absl::Hours(1) + absl::Seconds(1))));
1289    EXPECT_EQ("-1m1s",
1290              absl::FormatDuration(-(absl::Minutes(1) + absl::Seconds(1))));
1291    EXPECT_EQ("-1ns", absl::FormatDuration(absl::Nanoseconds(-1)));
1292    EXPECT_EQ("-1.2us", absl::FormatDuration(
1293                            -(absl::Microseconds(1) + absl::Nanoseconds(200))));
1294    EXPECT_EQ("-1.2ms", absl::FormatDuration(
1295                            -(absl::Milliseconds(1) + absl::Microseconds(200))));
1296    EXPECT_EQ("-1.0002ms", absl::FormatDuration(-(absl::Milliseconds(1) +
1297                                                  absl::Nanoseconds(200))));
1298    EXPECT_EQ("-1.00001ms", absl::FormatDuration(-(absl::Milliseconds(1) +
1299                                                   absl::Nanoseconds(10))));
1300    EXPECT_EQ("-1.000001ms", absl::FormatDuration(-(absl::Milliseconds(1) +
1301                                                    absl::Nanoseconds(1))));
1302    const absl::Duration qns = absl::Nanoseconds(1) / 4;
1303    const absl::Duration max_dur =
1304        absl::Seconds(kint64max) + (absl::Seconds(1) - qns);
1305    const absl::Duration min_dur = absl::Seconds(kint64min);
1306    EXPECT_EQ("0.25ns", absl::FormatDuration(qns));
1307    EXPECT_EQ("-0.25ns", absl::FormatDuration(-qns));
1308    EXPECT_EQ("2562047788015215h30m7.99999999975s",
1309              absl::FormatDuration(max_dur));
1310    EXPECT_EQ("-2562047788015215h30m8s", absl::FormatDuration(min_dur));
1311    EXPECT_EQ("55.00000000025s", absl::FormatDuration(absl::Seconds(55) + qns));
1312    EXPECT_EQ("55.00000025ms",
1313              absl::FormatDuration(absl::Milliseconds(55) + qns));
1314    EXPECT_EQ("55.00025us", absl::FormatDuration(absl::Microseconds(55) + qns));
1315    EXPECT_EQ("55.25ns", absl::FormatDuration(absl::Nanoseconds(55) + qns));
1316    EXPECT_EQ("inf", absl::FormatDuration(absl::InfiniteDuration()));
1317    EXPECT_EQ("-inf", absl::FormatDuration(-absl::InfiniteDuration()));
1318    const absl::Duration huge_range = ApproxYears(100000000000);
1319    EXPECT_EQ("876000000000000h", absl::FormatDuration(huge_range));
1320    EXPECT_EQ("-876000000000000h", absl::FormatDuration(-huge_range));
1321    EXPECT_EQ("876000000000000h0.999999999s",
1322              absl::FormatDuration(huge_range +
1323                                   (absl::Seconds(1) - absl::Nanoseconds(1))));
1324    EXPECT_EQ("876000000000000h0.9999999995s",
1325              absl::FormatDuration(
1326                  huge_range + (absl::Seconds(1) - absl::Nanoseconds(1) / 2)));
1327    EXPECT_EQ("876000000000000h0.99999999975s",
1328              absl::FormatDuration(
1329                  huge_range + (absl::Seconds(1) - absl::Nanoseconds(1) / 4)));
1330    EXPECT_EQ("-876000000000000h0.999999999s",
1331              absl::FormatDuration(-huge_range -
1332                                   (absl::Seconds(1) - absl::Nanoseconds(1))));
1333    EXPECT_EQ("-876000000000000h0.9999999995s",
1334              absl::FormatDuration(
1335                  -huge_range - (absl::Seconds(1) - absl::Nanoseconds(1) / 2)));
1336    EXPECT_EQ("-876000000000000h0.99999999975s",
1337              absl::FormatDuration(
1338                  -huge_range - (absl::Seconds(1) - absl::Nanoseconds(1) / 4)));
1339  }
1340  TEST(Duration, ParseDuration) {
1341    absl::Duration d;
1342    EXPECT_TRUE(absl::ParseDuration("0", &d));
1343    EXPECT_EQ(absl::ZeroDuration(), d);
1344    EXPECT_TRUE(absl::ParseDuration("+0", &d));
1345    EXPECT_EQ(absl::ZeroDuration(), d);
1346    EXPECT_TRUE(absl::ParseDuration("-0", &d));
1347    EXPECT_EQ(absl::ZeroDuration(), d);
1348    EXPECT_TRUE(absl::ParseDuration("inf", &d));
1349    EXPECT_EQ(absl::InfiniteDuration(), d);
1350    EXPECT_TRUE(absl::ParseDuration("+inf", &d));
1351    EXPECT_EQ(absl::InfiniteDuration(), d);
1352    EXPECT_TRUE(absl::ParseDuration("-inf", &d));
1353    EXPECT_EQ(-absl::InfiniteDuration(), d);
1354    EXPECT_FALSE(absl::ParseDuration("infBlah", &d));
1355    EXPECT_FALSE(absl::ParseDuration("", &d));
1356    EXPECT_FALSE(absl::ParseDuration("0.0", &d));
1357    EXPECT_FALSE(absl::ParseDuration(".0", &d));
1358    EXPECT_FALSE(absl::ParseDuration(".", &d));
1359    EXPECT_FALSE(absl::ParseDuration("01", &d));
1360    EXPECT_FALSE(absl::ParseDuration("1", &d));
1361    EXPECT_FALSE(absl::ParseDuration("-1", &d));
1362    EXPECT_FALSE(absl::ParseDuration("2", &d));
1363    EXPECT_FALSE(absl::ParseDuration("2 s", &d));
1364    EXPECT_FALSE(absl::ParseDuration(".s", &d));
1365    EXPECT_FALSE(absl::ParseDuration("-.s", &d));
1366    EXPECT_FALSE(absl::ParseDuration("s", &d));
1367    EXPECT_FALSE(absl::ParseDuration(" 2s", &d));
1368    EXPECT_FALSE(absl::ParseDuration("2s ", &d));
1369    EXPECT_FALSE(absl::ParseDuration(" 2s ", &d));
1370    EXPECT_FALSE(absl::ParseDuration("2mt", &d));
1371    EXPECT_FALSE(absl::ParseDuration("1e3s", &d));
1372    EXPECT_TRUE(absl::ParseDuration("1ns", &d));
1373    EXPECT_EQ(absl::Nanoseconds(1), d);
1374    EXPECT_TRUE(absl::ParseDuration("1us", &d));
1375    EXPECT_EQ(absl::Microseconds(1), d);
1376    EXPECT_TRUE(absl::ParseDuration("1ms", &d));
1377    EXPECT_EQ(absl::Milliseconds(1), d);
1378    EXPECT_TRUE(absl::ParseDuration("1s", &d));
1379    EXPECT_EQ(absl::Seconds(1), d);
1380    EXPECT_TRUE(absl::ParseDuration("2m", &d));
1381    EXPECT_EQ(absl::Minutes(2), d);
1382    EXPECT_TRUE(absl::ParseDuration("2h", &d));
1383    EXPECT_EQ(absl::Hours(2), d);
1384    EXPECT_TRUE(absl::ParseDuration("9223372036854775807us", &d));
1385    EXPECT_EQ(absl::Microseconds(9223372036854775807), d);
1386    EXPECT_TRUE(absl::ParseDuration("-9223372036854775807us", &d));
1387    EXPECT_EQ(absl::Microseconds(-9223372036854775807), d);
1388    EXPECT_TRUE(absl::ParseDuration("2h3m4s", &d));
1389    EXPECT_EQ(absl::Hours(2) + absl::Minutes(3) + absl::Seconds(4), d);
1390    EXPECT_TRUE(absl::ParseDuration("3m4s5us", &d));
1391    EXPECT_EQ(absl::Minutes(3) + absl::Seconds(4) + absl::Microseconds(5), d);
1392    EXPECT_TRUE(absl::ParseDuration("2h3m4s5ms6us7ns", &d));
1393    EXPECT_EQ(absl::Hours(2) + absl::Minutes(3) + absl::Seconds(4) +
1394                  absl::Milliseconds(5) + absl::Microseconds(6) +
1395                  absl::Nanoseconds(7),
1396              d);
1397    EXPECT_TRUE(absl::ParseDuration("2us3m4s5h", &d));
1398    EXPECT_EQ(absl::Hours(5) + absl::Minutes(3) + absl::Seconds(4) +
1399                  absl::Microseconds(2),
1400              d);
1401    EXPECT_TRUE(absl::ParseDuration("1.5ns", &d));
1402    EXPECT_EQ(1.5 * absl::Nanoseconds(1), d);
1403    EXPECT_TRUE(absl::ParseDuration("1.5us", &d));
1404    EXPECT_EQ(1.5 * absl::Microseconds(1), d);
1405    EXPECT_TRUE(absl::ParseDuration("1.5ms", &d));
1406    EXPECT_EQ(1.5 * absl::Milliseconds(1), d);
1407    EXPECT_TRUE(absl::ParseDuration("1.5s", &d));
1408    EXPECT_EQ(1.5 * absl::Seconds(1), d);
1409    EXPECT_TRUE(absl::ParseDuration("1.5m", &d));
1410    EXPECT_EQ(1.5 * absl::Minutes(1), d);
1411    EXPECT_TRUE(absl::ParseDuration("1.5h", &d));
1412    EXPECT_EQ(1.5 * absl::Hours(1), d);
1413    EXPECT_TRUE(absl::ParseDuration("0.4294967295s", &d));
1414    EXPECT_EQ(absl::Nanoseconds(429496729) + absl::Nanoseconds(1) / 2, d);
1415    EXPECT_TRUE(absl::ParseDuration("0.429496729501234567890123456789s", &d));
1416    EXPECT_EQ(absl::Nanoseconds(429496729) + absl::Nanoseconds(1) / 2, d);
1417    EXPECT_TRUE(absl::ParseDuration("-1s", &d));
1418    EXPECT_EQ(absl::Seconds(-1), d);
1419    EXPECT_TRUE(absl::ParseDuration("-1m", &d));
1420    EXPECT_EQ(absl::Minutes(-1), d);
1421    EXPECT_TRUE(absl::ParseDuration("-1h", &d));
1422    EXPECT_EQ(absl::Hours(-1), d);
1423    EXPECT_TRUE(absl::ParseDuration("-1h2s", &d));
1424    EXPECT_EQ(-(absl::Hours(1) + absl::Seconds(2)), d);
1425    EXPECT_FALSE(absl::ParseDuration("1h-2s", &d));
1426    EXPECT_FALSE(absl::ParseDuration("-1h-2s", &d));
1427    EXPECT_FALSE(absl::ParseDuration("-1h -2s", &d));
1428  }
1429  TEST(Duration, FormatParseRoundTrip) {
1430  #define TEST_PARSE_ROUNDTRIP(d)                \
1431    do {                                         \
1432      std::string s = absl::FormatDuration(d);   \
1433      absl::Duration dur;                        \
1434      EXPECT_TRUE(absl::ParseDuration(s, &dur)); \
1435      EXPECT_EQ(d, dur);                         \
1436    } while (0)
1437    TEST_PARSE_ROUNDTRIP(absl::Nanoseconds(1));
1438    TEST_PARSE_ROUNDTRIP(absl::Microseconds(1));
1439    TEST_PARSE_ROUNDTRIP(absl::Milliseconds(1));
1440    TEST_PARSE_ROUNDTRIP(absl::Seconds(1));
1441    TEST_PARSE_ROUNDTRIP(absl::Minutes(1));
1442    TEST_PARSE_ROUNDTRIP(absl::Hours(1));
1443    TEST_PARSE_ROUNDTRIP(absl::Hours(1) + absl::Nanoseconds(2));
1444    TEST_PARSE_ROUNDTRIP(absl::Nanoseconds(-1));
1445    TEST_PARSE_ROUNDTRIP(absl::Microseconds(-1));
1446    TEST_PARSE_ROUNDTRIP(absl::Milliseconds(-1));
1447    TEST_PARSE_ROUNDTRIP(absl::Seconds(-1));
1448    TEST_PARSE_ROUNDTRIP(absl::Minutes(-1));
1449    TEST_PARSE_ROUNDTRIP(absl::Hours(-1));
1450    TEST_PARSE_ROUNDTRIP(absl::Hours(-1) + absl::Nanoseconds(2));
1451    TEST_PARSE_ROUNDTRIP(absl::Hours(1) + absl::Nanoseconds(-2));
1452    TEST_PARSE_ROUNDTRIP(absl::Hours(-1) + absl::Nanoseconds(-2));
1453    TEST_PARSE_ROUNDTRIP(absl::Nanoseconds(1) +
1454                         absl::Nanoseconds(1) / 4);  
1455    const absl::Duration huge_range = ApproxYears(100000000000);
1456    TEST_PARSE_ROUNDTRIP(huge_range);
1457    TEST_PARSE_ROUNDTRIP(huge_range + (absl::Seconds(1) - absl::Nanoseconds(1)));
1458  #undef TEST_PARSE_ROUNDTRIP
1459  }
1460  TEST(Duration, AbslStringify) {
1461    absl::Duration d = absl::Seconds(1);
1462    EXPECT_EQ(absl::StrFormat("%v", d), absl::FormatDuration(d));
1463  }
1464  TEST(Duration, NoPadding) {
1465    using NoPadding = std::array<uint32_t, 3>;
1466    EXPECT_EQ(sizeof(NoPadding), sizeof(absl::Duration));
1467    EXPECT_EQ(alignof(NoPadding), alignof(absl::Duration));
1468  }
1469  }  
</code></pre>
        </div>
        <div class="column">
            <h3>snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-test-subgraph.cpp</h3>
            <pre><code>1  #include <gtest/gtest.h>
2  #include "Snap.h"
3  PUNGraph GetTestTUNGraph();
4  PNGraph GetTestTNGraph();
5  PNEGraph GetTestTNEGraph();
6  PNEANet GetTestTNEANet();
7  PUNGraph GetUPetersen();
8  PNGraph GetDPetersen();
9  TPt <TNodeEDatNet<TInt, TInt> > GetTestTNodeEDatNet();
10  TPt <TNodeEdgeNet<TInt, TInt> > GetTestTNodeEdgeNet();
11  TEST(subgraph, TestSubTUNGraphs) {
12    PUNGraph Graph;
13    PUNGraph Graph1;
14    PUNGraph Graph2;
15    PUNGraph Graph3;
16    PUNGraph Graph4;
17    int i;
18    TIntV NIdV;
19    TIntV NIdV1;
20    Graph = GetTestTUNGraph();
21    EXPECT_EQ(20,Graph->GetNodes());
22    EXPECT_EQ(60,Graph->GetEdges());
23    for (i = 10; i < 15; i++) {
24      NIdV.Add(i);
25    }
26    Graph1 = TSnap::GetSubGraph(Graph, NIdV);
27    EXPECT_EQ(5,Graph1->GetNodes());
28    EXPECT_EQ(9,Graph1->GetEdges());
29    Graph2 = TSnap::GetSubGraph(Graph, NIdV, true);
30    EXPECT_EQ(5,Graph2->GetNodes());
31    EXPECT_EQ(9,Graph2->GetEdges());
32    for (i = 0; i < 20; i += 2) {
33      NIdV1.Add(i);
34    }
35    Graph3 = TSnap::GetSubGraph(Graph, NIdV1, true);
36    EXPECT_EQ(10,Graph3->GetNodes());
37    EXPECT_EQ(10,Graph3->GetEdges());
38    Graph4 = TSnap::GetSubGraphRenumber(Graph, NIdV1);
39    EXPECT_EQ(10,Graph4->GetNodes());
40    EXPECT_EQ(10,Graph4->GetEdges());
41  }
42  TEST(subgraph, TestSubTNGraphs) {
43    PNGraph Graph;
44    PNGraph Graph1;
45    PNGraph Graph2;
46    PNGraph Graph3;
47    PNGraph Graph4;
48    int i;
49    TIntV NIdV;
50    TIntV NIdV1;
51    Graph = GetTestTNGraph();
52    EXPECT_EQ(20,Graph->GetNodes());
53    EXPECT_EQ(60,Graph->GetEdges());
54    for (i = 10; i < 15; i++) {
55      NIdV.Add(i);
56    }
57    Graph1 = TSnap::GetSubGraph(Graph, NIdV);
58    EXPECT_EQ(5,Graph1->GetNodes());
59    EXPECT_EQ(9,Graph1->GetEdges());
60    Graph2 = TSnap::GetSubGraph(Graph, NIdV, true);
61    EXPECT_EQ(5,Graph2->GetNodes());
62    EXPECT_EQ(9,Graph2->GetEdges());
63    for (i = 0; i < 20; i += 2) {
64      NIdV1.Add(i);
65    }
66    Graph3 = TSnap::GetSubGraph(Graph, NIdV1, true);
67    EXPECT_EQ(10,Graph3->GetNodes());
68    EXPECT_EQ(10,Graph3->GetEdges());
69    Graph4 = TSnap::GetSubGraphRenumber(Graph, NIdV1);
70    EXPECT_EQ(10,Graph4->GetNodes());
71    EXPECT_EQ(10,Graph4->GetEdges());
72  }
73  TEST(subgraph, TestSubTNEGraphs) {
74    PNEGraph Graph;
75    PNEGraph Graph1;
76    PNEGraph Graph2;
77    PNEGraph Graph3;
78    int i;
79    TIntV NIdV;
80    TIntV NIdV1;
81    TIntV EIdV;
82    Graph = GetTestTNEGraph();
83    EXPECT_EQ(20,Graph->GetNodes());
84    EXPECT_EQ(120,Graph->GetEdges());
85    for (i = 10; i < 15; i++) {
86      NIdV.Add(i);
87    }
88    Graph1 = TSnap::GetSubGraph(Graph, NIdV);
89    EXPECT_EQ(5,Graph1->GetNodes());
90    EXPECT_EQ(18,Graph1->GetEdges());
91    for (i = 0; i < 20; i += 2) {
92      NIdV1.Add(i);
93    }
94    Graph2 = TSnap::GetSubGraph(Graph, NIdV1);
95    EXPECT_EQ(10,Graph2->GetNodes());
96    EXPECT_EQ(20,Graph2->GetEdges());
97    for (i = 0; i < 120; i += 2) {
98      EIdV.Add(i);
99    }
100    Graph3 = TSnap::GetESubGraph(Graph, EIdV);
101    EXPECT_EQ(20,Graph3->GetNodes());
102    EXPECT_EQ(60,Graph3->GetEdges());
103  }
104  TEST(subgraph, TestEDatSubNets) {
105    TPt <TNodeEDatNet<TInt, TInt> > Net;
106    TPt <TNodeEDatNet<TInt, TInt> > Net1;
107    TPt <TNodeEDatNet<TInt, TInt> > Net2;
108    TPt <TNodeEDatNet<TInt, TInt> > Net3;
109    TPt <TNodeEDatNet<TInt, TInt> > Net4;
110    int i;
111    TIntV NIdV;
112    TIntV NIdV1;
113    Net = GetTestTNodeEDatNet();
114    EXPECT_EQ(20,Net->GetNodes());
115    EXPECT_EQ(60,Net->GetEdges());
116    for (i = 10; i < 15; i++) {
117      NIdV.Add(i);
118    }
119    Net1 = TSnap::GetSubGraph(Net, NIdV);
120    EXPECT_EQ(5,Net1->GetNodes());
121    EXPECT_EQ(9,Net1->GetEdges());
122    for (i = 0; i < 20; i += 2) {
123      NIdV1.Add(i);
124    }
125    Net2 = TSnap::GetSubGraph(Net, NIdV1);
126    EXPECT_EQ(10,Net2->GetNodes());
127    EXPECT_EQ(10,Net2->GetEdges());
128    Net3 = TSnap::GetEDatSubGraph(Net, 1, 0);
129    EXPECT_EQ(20,Net3->GetNodes());
130    EXPECT_EQ(15,Net3->GetEdges());
131    Net4 = TSnap::GetEDatSubGraph(Net, 2, -1);
132    EXPECT_EQ(20,Net4->GetNodes());
133    EXPECT_EQ(30,Net4->GetEdges());
134  }
135  TEST(subgraph, TestEdgeSubNets) {
136    TPt <TNodeEdgeNet<TInt, TInt> > Net;
137    TPt <TNodeEdgeNet<TInt, TInt> > Net1;
138    TPt <TNodeEdgeNet<TInt, TInt> > Net2;
139    TPt <TNodeEdgeNet<TInt, TInt> > Net3;
140    TPt <TNodeEdgeNet<TInt, TInt> > Net4;
141    int i;
142    TIntV NIdV;
143    TIntV NIdV1;
144    Net = GetTestTNodeEdgeNet();
145    EXPECT_EQ(20,Net->GetNodes());
146    EXPECT_EQ(120,Net->GetEdges());
147    for (i = 10; i < 15; i++) {
148      NIdV.Add(i);
149    }
150    Net1 = TSnap::GetSubGraph(Net, NIdV);
151    EXPECT_EQ(5,Net1->GetNodes());
152    EXPECT_EQ(18,Net1->GetEdges());
<span onclick='openModal()' class='match'>153    for (i = 0; i < 20; i += 2) {
154      NIdV1.Add(i);
155    }
156    Net2 = TSnap::GetSubGraph(Net, NIdV1);
157    EXPECT_EQ(10,Net2->GetNodes());
158    EXPECT_EQ(20,Net2->GetEdges());
159    Net3 = TSnap::GetEDatSubGraph(Net, 1, 0);
160    EXPECT_EQ(20,Net3->GetNodes());
161    EXPECT_EQ(30,Net3->GetEdges());
162    Net4 = TSnap::GetEDatSubGraph(Net, 2, -1);
163    EXPECT_EQ(20,Net4->GetNodes());
164    EXPECT_EQ(60,Net4->GetEdges());
165  }
166  TEST(subgraph, TestConvertGraphs) {
167    PNGraph NGraph;
168    PUNGraph UNGraph;
169    NGraph = GetTestTNGraph();
170    EXPECT_EQ(20,NGraph->GetNodes());
171    EXPECT_EQ(60,NGraph->GetEdges());
172    UNGraph = TSnap::ConvertGraph<PUNGraph>(NGraph);
</span>173    EXPECT_EQ(20,UNGraph->GetNodes());
174    EXPECT_EQ(60,UNGraph->GetEdges());
175    NGraph = TSnap::ConvertGraph<PNGraph>(UNGraph);
176    EXPECT_EQ(20,NGraph->GetNodes());
177    EXPECT_EQ(120,NGraph->GetEdges());
178  }
179  TEST(subgraph, TestConvertSubGraphs) {
180    PNGraph NGraph;
181    PUNGraph UNGraph;
182    TIntV NIdV;
183    int i;
184    NGraph = GetTestTNGraph();
185    EXPECT_EQ(20,NGraph->GetNodes());
186    EXPECT_EQ(60,NGraph->GetEdges());
187    for (i = 0; i < 20; i += 2) {
188      NIdV.Add(i);
189    }
190    UNGraph = TSnap::ConvertSubGraph<PUNGraph>(NGraph, NIdV);
191    EXPECT_EQ(10,UNGraph->GetNodes());
192    EXPECT_EQ(10,UNGraph->GetEdges());
193    NGraph = TSnap::ConvertSubGraph<PNGraph>(UNGraph, NIdV);
194    EXPECT_EQ(10,NGraph->GetNodes());
195    EXPECT_EQ(20,NGraph->GetEdges());
196  }
197  TEST(subgraph, TestConvertESubGraphs) {
198    PNEGraph NEGraph;
199    PNGraph NGraph;
200    TIntV NIdV;
201    TIntV EIdV;
202    int i;
203    NGraph = GetTestTNGraph();
204    EXPECT_EQ(20,NGraph->GetNodes());
205    EXPECT_EQ(60,NGraph->GetEdges());
206    for (i = 0; i < 20; i += 2) {
207      NIdV.Add(i);
208    }
209    NEGraph = TSnap::ConvertGraph<PNEGraph>(NGraph);
210    EXPECT_EQ(20,NEGraph->GetNodes());
211    EXPECT_EQ(60,NEGraph->GetEdges());
212    i = 0;
213    for (TNEGraph::TEdgeI EI = NEGraph->BegEI(); EI < NEGraph->EndEI(); EI++) {
214      if (i == 0) {
215        EIdV.Add(EI.GetId());
216      }
217      i = (i + 1) % 2;
218    }
219    NGraph = TSnap::ConvertESubGraph<PNGraph>(NEGraph, EIdV);
220    EXPECT_EQ(20,NGraph->GetNodes());
221    EXPECT_EQ(30,NGraph->GetEdges());
222  }
223  TEST(subgraph, TestGetRndGraphs) {
224    PUNGraph UNGraph1, UNGraph2, UNGraph3;
225    PNGraph NGraph1, NGraph2, NGraph3;
226    PNEGraph NEGraph1, NEGraph2, NEGraph3;
227    UNGraph1 = GetTestTUNGraph();
228    EXPECT_EQ(20,UNGraph1->GetNodes());
229    EXPECT_EQ(60,UNGraph1->GetEdges());
230    UNGraph2 = TSnap::GetRndSubGraph(UNGraph1,10);
231    EXPECT_EQ(10,UNGraph2->GetNodes());
232    UNGraph3 = TSnap::GetRndESubGraph(UNGraph1,10);
233    EXPECT_EQ(10,UNGraph3->GetEdges());
234    NGraph1 = GetTestTNGraph();
235    EXPECT_EQ(20,NGraph1->GetNodes());
236    EXPECT_EQ(60,NGraph1->GetEdges());
237    NGraph2 = TSnap::GetRndSubGraph(NGraph1,10);
238    EXPECT_EQ(10,NGraph2->GetNodes());
239    NGraph3 = TSnap::GetRndESubGraph(NGraph1,10);
240    EXPECT_EQ(10,NGraph3->GetEdges());
241  }
242  TEST(subgraph, TestGetEgonet) {
243    PUNGraph UGraph = GetUPetersen();
244    for (int i = 0; i < 10; i++) {
245      int Edges;
246      PUNGraph Ego = TSnap::GetEgonet(UGraph, i, Edges);
247      EXPECT_EQ(4, Ego->GetNodes());
248      EXPECT_EQ(3, Ego->GetEdges());
249      EXPECT_EQ(6, Edges);
250    }
251    PNGraph Graph = GetDPetersen();
252    for (int i = 0; i < 10; i++) {
253      int EdgesIn, EdgesOut;
254      PNGraph Ego = TSnap::GetEgonet(Graph, i, EdgesIn, EdgesOut);
255      EXPECT_EQ(4, Ego->GetNodes());
256      EXPECT_EQ(3, Ego->GetEdges());
257      if (i < 5) {
258        EXPECT_EQ(2, EdgesIn);
259        EXPECT_EQ(4, EdgesOut);
260      } else {
261        EXPECT_EQ(4, EdgesIn);
262        EXPECT_EQ(2, EdgesOut);
263      }
264    }
265  }
266  TEST(subgraph, TestGetInEgonetHopTNGraph) {
267    PNGraph Small = TNGraph::GetSmallGraph();
268    PNGraph ego1 = TSnap::GetInEgonetHop<PNGraph>(Small, 4, 1);
269    EXPECT_EQ(2, ego1->GetNodes());
270    EXPECT_EQ(1, ego1->GetEdges());
271    PNGraph ego2 = TSnap::GetInEgonetHop<PNGraph>(Small, 4, 2);
272    EXPECT_EQ(4, ego2->GetNodes());
273    EXPECT_EQ(4, ego2->GetEdges());
274    PNGraph ego3 = TSnap::GetInEgonetHop<PNGraph>(Small, 4, 3);
275    EXPECT_EQ(5, ego3->GetNodes());
276    EXPECT_EQ(6, ego3->GetEdges());
277    PNGraph Middle = TNGraph::New();
278    for (int i = 0; i < 6; i++) {
279      Middle->AddNode(i);
280    }
281    for (int i = 0; i < 6; i++) {
282      Middle->AddEdge(i, (i + 1) % 6);
283      Middle->AddEdge(i, (i + 2) % 6);
284    }
285    EXPECT_EQ(12, Middle->GetEdges());
286    PNGraph midego2 = TSnap::GetInEgonetHop<PNGraph>(Middle, 0, 2);
287    EXPECT_EQ(5, midego2->GetNodes());
288    EXPECT_EQ(8, midego2->GetEdges());
289    PNGraph midego3 = TSnap::GetInEgonetHop<PNGraph>(Middle, 0, 3);
290    EXPECT_EQ(6, midego3->GetNodes());
291    EXPECT_EQ(12, midego3->GetEdges());
292    PNGraph Graph;
293    PNGraph Graph0;
294    PNGraph Graph1;
295    PNGraph Graph2;
296    PNGraph Graph3;
297    PNGraph Graph4;
298    PNGraph Graph5;
299    PNGraph Graph6;
300    PNGraph Graph7;
301    Graph = GetTestTNGraph();
302    EXPECT_EQ(20, Graph->GetNodes());
303    EXPECT_EQ(60, Graph->GetEdges());
304    Graph0 = TSnap::GetInEgonetHop<PNGraph>(Graph, 0, 0);
305    EXPECT_EQ(1, Graph0->GetNodes());
306    EXPECT_EQ(0, Graph0->GetEdges());
307    Graph1 = TSnap::GetInEgonetHop<PNGraph>(Graph, 3, 1);
308    EXPECT_EQ(4, Graph1->GetNodes());
309    EXPECT_EQ(6, Graph1->GetEdges());
310    Graph2 = TSnap::GetInEgonetHop<PNGraph>(Graph, 6, 2);
311    EXPECT_EQ(7, Graph2->GetNodes());
312    EXPECT_EQ(15, Graph2->GetEdges());
313    Graph3 = TSnap::GetInEgonetHop<PNGraph>(Graph, 9, 3);
314    EXPECT_EQ(10, Graph3->GetNodes());
315    EXPECT_EQ(24, Graph3->GetEdges());
316    Graph4 = TSnap::GetInEgonetHop<PNGraph>(Graph, 12, 4);
317    EXPECT_EQ(13, Graph4->GetNodes());
318    EXPECT_EQ(33, Graph4->GetEdges());
319    Graph5 = TSnap::GetInEgonetHop<PNGraph>(Graph, 15, 5);
320    EXPECT_EQ(16, Graph5->GetNodes());
321    EXPECT_EQ(42, Graph5->GetEdges());
322    Graph6 = TSnap::GetInEgonetHop<PNGraph>(Graph, 18, 6);
323    EXPECT_EQ(19, Graph6->GetNodes());
324    EXPECT_EQ(54, Graph6->GetEdges());
325    Graph7 = TSnap::GetInEgonetHop<PNGraph>(Graph, 1, 7);
326    EXPECT_EQ(20, Graph7->GetNodes());
327    EXPECT_EQ(60, Graph7->GetEdges());
328  }
329  TEST(subgraph, TestGetInEgonetHopTUNGraph) {
330    PUNGraph Graph;
331    PUNGraph Graph0;
332    PUNGraph Graph1;
333    PUNGraph Graph2;
334    PUNGraph Graph3;
335    PUNGraph Graph4;
336    Graph = GetTestTUNGraph();
337    EXPECT_EQ(20, Graph->GetNodes());
338    EXPECT_EQ(60, Graph->GetEdges());
339    Graph0 = TSnap::GetInEgonetHop<PUNGraph>(Graph, 3, 0);
340    EXPECT_EQ(1, Graph0->GetNodes());
341    EXPECT_EQ(0, Graph0->GetEdges());
342    Graph1 = TSnap::GetInEgonetHop<PUNGraph>(Graph, 0, 1);
343    EXPECT_EQ(7, Graph1->GetNodes());
344    EXPECT_EQ(15, Graph1->GetEdges());
345    Graph2 = TSnap::GetInEgonetHop<PUNGraph>(Graph, 7, 2);
346    EXPECT_EQ(13, Graph2->GetNodes());
347    EXPECT_EQ(33, Graph2->GetEdges());
348    Graph3 = TSnap::GetInEgonetHop<PUNGraph>(Graph, 19, 3);
349    EXPECT_EQ(19, Graph3->GetNodes());
350    EXPECT_EQ(54, Graph3->GetEdges());
351    Graph4 = TSnap::GetInEgonetHop<PUNGraph>(Graph, 8, 4);
352    EXPECT_EQ(20, Graph4->GetNodes());
353    EXPECT_EQ(60, Graph4->GetEdges());
354  }
355  TEST(subgraph, TestGetInEgonetsAttr) {
356    PNEANet Graph;
357    PNEANet Graph0;
358    PNEANet Graph1;
359    PNEANet Graph2;
360    PNEANet Graph3;
361    PNEANet Graph4;
362    PNEANet Graph5;
363    PNEANet Graph6;
364    PNEANet Graph7;
365    const TStr s = "id";
366    Graph = GetTestTNEANet();
367    EXPECT_EQ(20, Graph->GetNodes());
368    EXPECT_EQ(60, Graph->GetEdges());
369    Graph0 = TSnap::GetInEgonetAttr(Graph, 0, 0);
370    EXPECT_EQ(1, Graph0->GetNodes());
371    EXPECT_EQ(0, Graph0->GetEdges());
372    for (TNEANet::TNodeI NI = Graph0->BegNI(); NI < Graph0->EndNI(); NI++) {
373      EXPECT_EQ(NI.GetId(), Graph0->GetIntAttrDatN(NI.GetId(), s));
374    }
375    for (TNEANet::TEdgeI EI = Graph0->BegEI(); EI < Graph0->EndEI(); EI++) {
376      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph0->GetIntAttrDatE(EI.GetId(), s));
377    }
378    Graph1 = TSnap::GetInEgonetAttr(Graph, 3, 1);
379    EXPECT_EQ(4, Graph1->GetNodes());
380    EXPECT_EQ(6, Graph1->GetEdges());
381    for (TNEANet::TNodeI NI = Graph1->BegNI(); NI < Graph1->EndNI(); NI++) {
382      EXPECT_EQ(NI.GetId(), Graph1->GetIntAttrDatN(NI.GetId(), s));
383    }
384    for (TNEANet::TEdgeI EI = Graph1->BegEI(); EI < Graph1->EndEI(); EI++) {
385      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph1->GetIntAttrDatE(EI.GetId(), s));
386    }
387    Graph2 = TSnap::GetInEgonetAttr(Graph, 6, 2);
388    EXPECT_EQ(7, Graph2->GetNodes());
389    EXPECT_EQ(15, Graph2->GetEdges());
390    for (TNEANet::TNodeI NI = Graph2->BegNI(); NI < Graph2->EndNI(); NI++) {
391      EXPECT_EQ(NI.GetId(), Graph2->GetIntAttrDatN(NI.GetId(), s));
392    }
393    for (TNEANet::TEdgeI EI = Graph2->BegEI(); EI < Graph2->EndEI(); EI++) {
394      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph2->GetIntAttrDatE(EI.GetId(), s));
395    }
396    Graph3 = TSnap::GetInEgonetAttr(Graph, 9, 3);
397    EXPECT_EQ(10, Graph3->GetNodes());
398    EXPECT_EQ(24, Graph3->GetEdges());
399    for (TNEANet::TNodeI NI = Graph3->BegNI(); NI < Graph3->EndNI(); NI++) {
400      EXPECT_EQ(NI.GetId(), Graph3->GetIntAttrDatN(NI.GetId(), s));
401    }
402    for (TNEANet::TEdgeI EI = Graph3->BegEI(); EI < Graph3->EndEI(); EI++) {
403      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph3->GetIntAttrDatE(EI.GetId(), s));
404    }
405    Graph4 = TSnap::GetInEgonetAttr(Graph, 12, 4);
406    EXPECT_EQ(13, Graph4->GetNodes());
407    EXPECT_EQ(33, Graph4->GetEdges());
408    for (TNEANet::TNodeI NI = Graph4->BegNI(); NI < Graph4->EndNI(); NI++) {
409      EXPECT_EQ(NI.GetId(), Graph4->GetIntAttrDatN(NI.GetId(), s));
410    }
411    for (TNEANet::TEdgeI EI = Graph4->BegEI(); EI < Graph4->EndEI(); EI++) {
412      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph4->GetIntAttrDatE(EI.GetId(), s));
413    }
414    Graph5 = TSnap::GetInEgonetAttr(Graph, 15, 5);
415    EXPECT_EQ(16, Graph5->GetNodes());
416    EXPECT_EQ(42, Graph5->GetEdges());
417    for (TNEANet::TNodeI NI = Graph5->BegNI(); NI < Graph5->EndNI(); NI++) {
418      EXPECT_EQ(NI.GetId(), Graph5->GetIntAttrDatN(NI.GetId(), s));
419    }
420    for (TNEANet::TEdgeI EI = Graph5->BegEI(); EI < Graph5->EndEI(); EI++) {
421      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph5->GetIntAttrDatE(EI.GetId(), s));
422    }
423    Graph6 = TSnap::GetInEgonetAttr(Graph, 18, 6);
424    EXPECT_EQ(19, Graph6->GetNodes());
425    EXPECT_EQ(54, Graph6->GetEdges());
426    for (TNEANet::TNodeI NI = Graph6->BegNI(); NI < Graph6->EndNI(); NI++) {
427      EXPECT_EQ(NI.GetId(), Graph6->GetIntAttrDatN(NI.GetId(), s));
428    }
429    for (TNEANet::TEdgeI EI = Graph6->BegEI(); EI < Graph6->EndEI(); EI++) {
430      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph6->GetIntAttrDatE(EI.GetId(), s));
431    }
432    Graph7 = TSnap::GetInEgonetAttr(Graph, 1, 7);
433    EXPECT_EQ(20, Graph7->GetNodes());
434    EXPECT_EQ(60, Graph7->GetEdges());
435    for (TNEANet::TNodeI NI = Graph7->BegNI(); NI < Graph7->EndNI(); NI++) {
436      EXPECT_EQ(NI.GetId(), Graph7->GetIntAttrDatN(NI.GetId(), s));
437    }
438    for (TNEANet::TEdgeI EI = Graph7->BegEI(); EI < Graph7->EndEI(); EI++) {
439      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph7->GetIntAttrDatE(EI.GetId(), s));
440    }
441  }
442  TEST(subgraph, TestGetInEgonetSubTUNGraph) {
443    PUNGraph Graph;
444    PUNGraph Graph0;
445    PUNGraph Graph1;
446    PUNGraph Graph2;
447    Graph = GetTestTUNGraph();
448    EXPECT_EQ(20, Graph->GetNodes());
449    EXPECT_EQ(60, Graph->GetEdges());
450    Graph0 = TSnap::GetInEgonetSub<PUNGraph>(Graph, 3, 0, 2, 1.0);
451    EXPECT_EQ(1, Graph0->GetNodes());
452    EXPECT_EQ(0, Graph0->GetEdges());
453    Graph1 = TSnap::GetInEgonetSub<PUNGraph>(Graph, 0, 1, 3, -1.0);
454    EXPECT_EQ(4, Graph1->GetNodes());
455    EXPECT_LE(4, Graph1->GetEdges());
456    EXPECT_GE(6, Graph1->GetEdges());
457    Graph2 = TSnap::GetInEgonetSub<PUNGraph>(Graph, 0, 1, 0, 0.9);
458    EXPECT_EQ(6, Graph2->GetNodes());
459    EXPECT_LE(10, Graph2->GetEdges());
460    EXPECT_GE(12, Graph2->GetEdges());
461  }
462  TEST(subgraph, TestGetInEgonetSubTNGraph) {
463    PNGraph Graph;
464    PNGraph Graph0;
465    PNGraph Graph1;
466    PNGraph Graph2;
467    Graph = GetTestTNGraph();
468    EXPECT_EQ(20, Graph->GetNodes());
469    EXPECT_EQ(60, Graph->GetEdges());
470    Graph0 = TSnap::GetInEgonetSub<PNGraph>(Graph, 3, 0, 2, 1.0);
471    EXPECT_EQ(1, Graph0->GetNodes());
472    EXPECT_EQ(0, Graph0->GetEdges());
473    Graph1 = TSnap::GetInEgonetSub<PNGraph>(Graph, 0, 1, 2, -1.0);
474    EXPECT_EQ(3, Graph1->GetNodes());
475    EXPECT_EQ(3, Graph1->GetEdges());
476    Graph2 = TSnap::GetInEgonetSub<PNGraph>(Graph, 0, 1, 0, 0.9);
477    EXPECT_EQ(3, Graph2->GetNodes());
478    EXPECT_EQ(3, Graph2->GetEdges());
479  }
480  TEST(subgraph, TestGetInEgonetSubTNEANet) {
481    PNEANet Graph;
482    PNEANet Graph0;
483    PNEANet Graph1;
484    PNEANet Graph2;
485    Graph = GetTestTNEANet();
486    EXPECT_EQ(20, Graph->GetNodes());
487    EXPECT_EQ(60, Graph->GetEdges());
488    Graph0 = TSnap::GetInEgonetSub<PNEANet>(Graph, 3, 0, 2, 1.0);
489    EXPECT_EQ(1, Graph0->GetNodes());
490    EXPECT_EQ(0, Graph0->GetEdges());
491    Graph1 = TSnap::GetInEgonetSub<PNEANet>(Graph, 0, 1, 2, -1.0);
492    EXPECT_EQ(3, Graph1->GetNodes());
493    EXPECT_EQ(3, Graph1->GetEdges());
494    Graph2 = TSnap::GetInEgonetSub<PNEANet>(Graph, 0, 1, 0, 0.9);
495    EXPECT_EQ(3, Graph2->GetNodes());
496    EXPECT_EQ(3, Graph2->GetEdges());
497  }
498  TEST(subgraph, TestGetEgonetAttr) {
499    PNEANet Graph;
500    PNEANet Graph0;
501    PNEANet Graph1;
502    PNEANet Graph2;
503    const TStr s = "id";
504    Graph = GetTestTNEANet();
505    EXPECT_EQ(20, Graph->GetNodes());
506    EXPECT_EQ(60, Graph->GetEdges());
507    Graph0 = TSnap::GetEgonetAttr(Graph, 3, 0);
508    EXPECT_EQ(1, Graph0->GetNodes());
509    EXPECT_EQ(0, Graph0->GetEdges());
510    for (TNEANet::TNodeI NI = Graph0->BegNI(); NI < Graph0->EndNI(); NI++) {
511      EXPECT_EQ(NI.GetId(), Graph0->GetIntAttrDatN(NI.GetId(), s));
512    }
513    for (TNEANet::TEdgeI EI = Graph0->BegEI(); EI < Graph0->EndEI(); EI++) {
514      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph0->GetIntAttrDatE(EI.GetId(), s));
515    }
516    Graph1 = TSnap::GetEgonetAttr(Graph, 4, 1);
517    EXPECT_EQ(7, Graph1->GetNodes());
518    EXPECT_EQ(15, Graph1->GetEdges());
519    for (TNEANet::TNodeI NI = Graph1->BegNI(); NI < Graph1->EndNI(); NI++) {
520      EXPECT_EQ(NI.GetId(), Graph1->GetIntAttrDatN(NI.GetId(), s));
521    }
522    for (TNEANet::TEdgeI EI = Graph1->BegEI(); EI < Graph1->EndEI(); EI++) {
523      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph1->GetIntAttrDatE(EI.GetId(), s));
524    }
525    Graph2 = TSnap::GetEgonetAttr(Graph, 4, 2);
526    EXPECT_EQ(13, Graph2->GetNodes());
527    EXPECT_EQ(33, Graph2->GetEdges());
528    for (TNEANet::TNodeI NI = Graph2->BegNI(); NI < Graph2->EndNI(); NI++) {
529      EXPECT_EQ(NI.GetId(), Graph2->GetIntAttrDatN(NI.GetId(), s));
530    }
531    for (TNEANet::TEdgeI EI = Graph2->BegEI(); EI < Graph2->EndEI(); EI++) {
532      EXPECT_EQ(EI.GetSrcNId() + EI.GetDstNId(), Graph2->GetIntAttrDatE(EI.GetId(), s));
533    }
534  }
535  TEST(subgraph, TestGetInEgonetAttr) {
536    PNEANet Graph;
537    PNEANet Graph0;
538    PNEANet Graph1;
539    PNEANet Graph2;
540    const TStr s = "id";
541    Graph = GetTestTNEANet();
542    EXPECT_EQ(20, Graph->GetNodes());
543    EXPECT_EQ(60, Graph->GetEdges());
544    Graph0 = TSnap::GetInEgonetAttr(Graph, 3, 0);
545    EXPECT_EQ(1, Graph0->GetNodes());
546    EXPECT_EQ(0, Graph0->GetEdges());
547    for (TNEANet::TNodeI NI = Graph0->BegNI(); NI < Graph0->EndNI(); NI++) {
548      EXPECT_EQ(NI.GetId(), Graph0->GetIntAttrDatN(NI.GetId(), s));
549    }
550    Graph1 = TSnap::GetInEgonetAttr(Graph, 4, 1);
551    EXPECT_EQ(4, Graph1->GetNodes());
552    EXPECT_EQ(6, Graph1->GetEdges());
553    for (TNEANet::TNodeI NI = Graph1->BegNI(); NI < Graph1->EndNI(); NI++) {
554      EXPECT_EQ(NI.GetId(), Graph1->GetIntAttrDatN(NI.GetId(), s));
555    }
556    Graph2 = TSnap::GetInEgonetAttr(Graph, 4, 2);
557    EXPECT_EQ(7, Graph2->GetNodes());
558    EXPECT_EQ(15, Graph2->GetEdges());
559    for (TNEANet::TNodeI NI = Graph2->BegNI(); NI < Graph2->EndNI(); NI++) {
560      EXPECT_EQ(NI.GetId(), Graph2->GetIntAttrDatN(NI.GetId(), s));
561    }
562  }
563  TEST(subgraph, TestGetOutEgonetAttr) {
564    PNEANet Graph;
565    PNEANet Graph0;
566    PNEANet Graph1;
567    PNEANet Graph2;
568    const TStr s = "id";
569    Graph = GetTestTNEANet();
570    EXPECT_EQ(20, Graph->GetNodes());
571    EXPECT_EQ(60, Graph->GetEdges());
572    Graph0 = TSnap::GetOutEgonetAttr(Graph, 3, 0);
573    EXPECT_EQ(1, Graph0->GetNodes());
574    EXPECT_EQ(0, Graph0->GetEdges());
575    for (TNEANet::TNodeI NI = Graph0->BegNI(); NI < Graph0->EndNI(); NI++) {
576      EXPECT_EQ(NI.GetId(), Graph0->GetIntAttrDatN(NI.GetId(), s));
577    }
578    Graph1 = TSnap::GetOutEgonetAttr(Graph, 4, 1);
579    EXPECT_EQ(4, Graph1->GetNodes());
580    EXPECT_EQ(6, Graph1->GetEdges());
581    for (TNEANet::TNodeI NI = Graph1->BegNI(); NI < Graph1->EndNI(); NI++) {
582      EXPECT_EQ(NI.GetId(), Graph1->GetIntAttrDatN(NI.GetId(), s));
583    }
584    Graph2 = TSnap::GetOutEgonetAttr(Graph, 4, 2);
585    EXPECT_EQ(7, Graph2->GetNodes());
586    EXPECT_EQ(15, Graph2->GetEdges());
587    for (TNEANet::TNodeI NI = Graph2->BegNI(); NI < Graph2->EndNI(); NI++) {
588      EXPECT_EQ(NI.GetId(), Graph2->GetIntAttrDatN(NI.GetId(), s));
589    }
590  }
591  TEST(subgraph, TestGetInEgonetSubAttr) {
592    PNEANet Graph;
593    PNEANet Graph0;
594    PNEANet Graph1;
595    PNEANet Graph2;
596    const TStr s = "id";
597    Graph = GetTestTNEANet();
598    EXPECT_EQ(20, Graph->GetNodes());
599    EXPECT_EQ(60, Graph->GetEdges());
600    Graph0 = TSnap::GetInEgonetSubAttr(Graph, 3, 0, 2, 1.0);
601    EXPECT_EQ(1, Graph0->GetNodes());
602    EXPECT_EQ(0, Graph0->GetEdges());
603    for (TNEANet::TNodeI NI = Graph0->BegNI(); NI < Graph0->EndNI(); NI++) {
604      EXPECT_EQ(NI.GetId(), Graph0->GetIntAttrDatN(NI.GetId(), s));
605    }
606    Graph1 = TSnap::GetInEgonetSubAttr(Graph, 0, 1, 2, -1.0);
607    EXPECT_EQ(3, Graph1->GetNodes());
608    EXPECT_EQ(3, Graph1->GetEdges());
609    for (TNEANet::TNodeI NI = Graph1->BegNI(); NI < Graph1->EndNI(); NI++) {
610      EXPECT_EQ(NI.GetId(), Graph1->GetIntAttrDatN(NI.GetId(), s));
611    }
612    Graph2 = TSnap::GetInEgonetSubAttr(Graph, 0, 1, 0, 0.9);
613    EXPECT_EQ(3, Graph2->GetNodes());
614    EXPECT_EQ(3, Graph2->GetEdges());
615    for (TNEANet::TNodeI NI = Graph2->BegNI(); NI < Graph2->EndNI(); NI++) {
616      EXPECT_EQ(NI.GetId(), Graph2->GetIntAttrDatN(NI.GetId(), s));
617    }
618  }
619  TEST(subgraph, TestGetGraphUnion) {
620    PUNGraph Graph = TUNGraph::New();
621    PUNGraph Graph0 = TUNGraph::New();
622    for (int i = 0; i < 5; i++) {
623      Graph->AddNode(i);
624    }
625    for (int i = 0; i < 5; i++) {
626      Graph->AddEdge(i,(i+1) % 5);
627      Graph->AddEdge(i,(i+2) % 5);
628    }
629    for (int i = 3; i < 8; i++) {
630      Graph0->AddNode(i);
631    }
632    for (int i = 0; i < 5; i++) {
633      Graph0->AddEdge(i + 3,((i+1) % 5) + 3);
634    }
635    TSnap::GetGraphUnion(Graph, Graph0);
636    EXPECT_EQ(8, Graph->GetNodes());
637    EXPECT_EQ(14, Graph->GetEdges());
638    PNGraph Graph1 = TNGraph::New();
639    PNGraph Graph2 = TNGraph::New();
640    for (int i = 0; i < 4; i++) {
641      Graph1->AddNode(i);
642    }
643    for (int i = 1; i < 5; i++) {
644      Graph2->AddNode(i);
645    }
646    Graph1->AddEdge(0, 1);
647    Graph1->AddEdge(1, 2);
648    Graph2->AddEdge(1, 2);
649    Graph2->AddEdge(2, 1);
650    Graph1->AddEdge(2, 3);
651    Graph2->AddEdge(2, 3);
652    Graph1->AddEdge(3, 2);
653    Graph2->AddEdge(3, 4);
654    Graph2->AddEdge(1, 4);
655    TSnap::GetGraphUnion(Graph1, Graph2);
656    EXPECT_EQ(5, Graph1->GetNodes());
657    EXPECT_EQ(7, Graph1->GetEdges());
658    PNEANet Graph3 = TNEANet::New();
659    PNEANet Graph4 = TNEANet::New();
660    int EId = 0;
661    for (int i = 0; i < 4; i++) {
662      Graph3->AddNode(i);
663    }
664    for (int i = 1; i < 5; i++) {
665      Graph4->AddNode(i);
666    }
667    Graph3->AddEdge(0, 1, EId++);
668    Graph3->AddEdge(1, 2, EId++);
669    Graph4->AddEdge(1, 2, EId++);
670    Graph4->AddEdge(2, 1, EId++);
671    Graph3->AddEdge(2, 3, EId);
672    Graph4->AddEdge(2, 3, EId++);
673    Graph3->AddEdge(3, 2, EId++);
674    Graph4->AddEdge(3, 4, EId++);
675    Graph4->AddEdge(1, 4, EId++);
676    TSnap::GetGraphUnion(Graph3, Graph4);
677    EXPECT_EQ(5, Graph3->GetNodes());
678    EXPECT_EQ(7, Graph3->GetEdges());
679  }
680  TEST(subgraph, TestGetGraphUnionAttr) {
681    PNEANet Graph = PNEANet::New();
682    PNEANet Graph0 = PNEANet::New();
683    TStr s = "id";
684    int EId;
685    for (int i = 0; i < 6; i++) {
686      Graph->AddNode(i);
687      Graph->AddIntAttrDatN(i, i, s);
688    }
689    for (int i = 3; i < 9; i++) {
690      Graph0->AddNode(i);
691      Graph0->AddIntAttrDatN(i, i, s);
692    }
693    for (int i = 0; i < 6; i++) {
694      EId = Graph->AddEdge(i, (i + 2) % 6);
695      Graph->AddIntAttrDatE(EId, (i + 2) % 6, s);
696      EId = Graph->AddEdge(i, (i + 5) % 6);
697      Graph->AddIntAttrDatE(EId, (i + 5) % 6, s);
698    }
699    for (int i = 0; i < 6; i++) {
700      EId = Graph0->AddEdge(i + 3, ((i + 3) % 6) + 3);
701      Graph0->AddIntAttrDatE(EId, ((i + 3) % 6) + 3, s);
702      EId = Graph0->AddEdge(i + 3, ((i + 4) % 6) + 3);
703      Graph0->AddIntAttrDatE(EId, ((i + 4) % 6) + 3, s);
704    }
705    TSnap::GetGraphUnionAttr(Graph, Graph0);
706    EXPECT_EQ(9, Graph->GetNodes());
707    EXPECT_EQ(24, Graph->GetEdges());
708  }
709  TEST(subgraph, TestGetGraphIntersection) {
710    PUNGraph Graph = TUNGraph::New();
711    PUNGraph Graph0 = TUNGraph::New();
712    for (int i = 0; i < 5; i++) {
713      Graph->AddNode(i);
714    }
715    for (int i = 0; i < 5; i++) {
716      Graph->AddEdge(i,(i + 1) % 5);
717      Graph->AddEdge(i,(i + 2) % 5);
718    }
719    for (int i = 2; i < 6; i++) {
720      Graph0->AddNode(i);
721    }
722    for (int i = 0; i < 4; i++) {
723      Graph0->AddEdge(i + 2, ((i + 1) % 4) + 2);
724      Graph0->AddEdge(i + 2, ((i + 2) % 4) + 2);
725    }
726    PUNGraph IntersectionGraph = TSnap::GetGraphIntersection(Graph, Graph0);
727    EXPECT_EQ(3, IntersectionGraph->GetNodes());
728    EXPECT_EQ(3, IntersectionGraph->GetEdges());
729    PNGraph Graph1 = TNGraph::New();
730    PNGraph Graph2 = TNGraph::New();
731    for (int i = 0; i < 8; i++) {
732      Graph1->AddNode(i);
733    }
734    for (int i = 0; i < 8; i++) {
735      Graph1->AddEdge(i, (i + 1) % 8);
736      Graph1->AddEdge((i + 1) % 8, i);
737    }
738    for (int i = 2; i < 6; i++) {
739      Graph2->AddNode(i);
740    }
741    for (int i = 0; i < 4; i++) {
742      Graph2->AddEdge(i + 2, ((i + 1) % 4) + 2);
743      Graph2->AddEdge(i + 2, ((i + 2) % 4) + 2);
744    }
745    PNGraph IntersectionGraph0 = TSnap::GetGraphIntersection(Graph1, Graph2);
746    EXPECT_EQ(4, IntersectionGraph0->GetNodes());
747    EXPECT_EQ(3, IntersectionGraph0->GetEdges());
748    PNEANet Graph3 = TNEANet::New();
749    PNEANet Graph4 = TNEANet::New();
750    int EId3 = 0;
751    int EId4 = 1;
752    for (int i = 0; i < 4; i++) {
753      Graph3->AddNode(i);
754    }
755    for (int i = 0; i < 3; i++) {
756      Graph3->AddEdge(i, i + 1, EId3++);
757    }
758    Graph3->AddEdge(1, 0, EId3++);
759    Graph3->AddEdge(1, 2, EId3++);
760    Graph3->AddEdge(3, 2, EId3++);
761    for (int i = 1; i < 5; i++) {
762      Graph4->AddNode(i);
763    }
764    for (int i = 1; i < 4; i++) {
765      Graph4->AddEdge(i + 1, i, EId4 + 3);
766      Graph4->AddEdge(i, i + 1, EId4++);
767    }
768    PNEANet IntersectionGraph1 = TSnap::GetGraphIntersection(Graph3, Graph4);
769    EXPECT_EQ(3, IntersectionGraph1->GetNodes());
770    EXPECT_EQ(3, IntersectionGraph1->GetEdges());
771  }
772  TEST(subgraph, TestGetGraphIntersectionAttr) {
773    PNEANet Graph = PNEANet::New();
774    PNEANet Graph0 = PNEANet::New();
775    TStr s = "id";
776    int EId;
777    for (int i = 0; i < 7; i++) {
778      Graph->AddNode(i);
779      Graph->AddIntAttrDatN(i, i, s);
780    }
781    for (int i = 2; i < 9; i++) {
782      Graph0->AddNode(i);
783      Graph0->AddIntAttrDatN(i, i, s);
784    }
785    for (int i = 0; i < 7; i++) {
786      EId = Graph->AddEdge(i, (i + 2) % 7);
787      Graph->AddIntAttrDatE(EId, (i + 2) % 7, s);
788      EId = Graph->AddEdge(i, (i + 3) % 7);
789      Graph->AddIntAttrDatE(EId, (i + 3) % 7, s);
790    }
791    for (int i = 0; i < 7; i++) {
792      EId = Graph0->AddEdge(i + 2, ((i + 3) % 7) + 2);
793      Graph0->AddIntAttrDatE(EId, ((i + 3) % 7) + 2, s);
794    }
795    PNEANet IntersectionGraph = TSnap::GetGraphIntersectionAttr(Graph, Graph0);
796    EXPECT_EQ(5, IntersectionGraph->GetNodes());
797    EXPECT_EQ(3, IntersectionGraph->GetEdges());
798  }
799  PUNGraph GetTestTUNGraph() {
800    PUNGraph Graph = TUNGraph::New();
801    for (int i = 0; i < 20; i++) {
802      Graph->AddNode(i);
803    }
804    for (int i = 0; i < 20; i++) {
805      Graph->AddEdge(i,(i+1) % 20);
806      Graph->AddEdge(i,(i+2) % 20);
807      Graph->AddEdge(i,(i+3) % 20);
808    }
809    return Graph;
810  }
811  PNGraph GetTestTNGraph() {
812    PNGraph Graph = TNGraph::New();
813    for (int i = 0; i < 20; i++) {
814      Graph->AddNode(i);
815    }
816    for (int i = 0; i < 20; i++) {
817      Graph->AddEdge(i,(i+1) % 20);
818      Graph->AddEdge(i,(i+2) % 20);
819      Graph->AddEdge(i,(i+3) % 20);
820    }
821    return Graph;
822  }
823  PNEANet GetTestTNEANet() {
824    PNEANet Graph = PNEANet::New();
825    TStr s = "id";
826    int EId;
827    for (int i = 0; i < 20; i++) {
828      Graph->AddNode(i);
829      Graph->AddIntAttrDatN(i, i, s);
830    }
831    for (int i = 0; i < 20; i++) {
832      EId = Graph->AddEdge(i, (i + 1) % 20);
833      Graph->AddIntAttrDatE(EId, i + (i + 1) % 20, s);
834      EId = Graph->AddEdge(i, (i + 2) % 20);
835      Graph->AddIntAttrDatE(EId, i + (i + 2) % 20, s);
836      EId = Graph->AddEdge(i, (i + 3) % 20);
837      Graph->AddIntAttrDatE(EId, i + (i + 3) % 20, s);
838    }
839    return Graph;
840  }
841  PNEGraph GetTestTNEGraph() {
842    PNEGraph Graph = TNEGraph::New();
843    for (int i = 0; i < 20; i++) {
844      Graph->AddNode(i);
845    }
846    for (int i = 0; i < 20; i++) {
847      Graph->AddEdge(i,(i+1) % 20);
848      Graph->AddEdge(i,(i+2) % 20);
849      Graph->AddEdge(i,(i+3) % 20);
850      Graph->AddEdge(i,(i+1) % 20);
851      Graph->AddEdge(i,(i+2) % 20);
852      Graph->AddEdge(i,(i+3) % 20);
853    }
854    return Graph;
855  }
856  PUNGraph GetUPetersen() {
857    PUNGraph Graph = TUNGraph::New();
858    for (int i = 0; i < 10; i++) {
859      Graph->AddNode(i);
860    }
861    for (int i = 0; i < 5; i++) {
862      Graph->AddEdge(i,(i+1) % 5);
863    }
864    for (int i = 0; i < 5; i++) {
865      Graph->AddEdge(i + 5,(i+2) % 5 + 5);
866    }
867    for (int i = 0; i < 5; i++) {
868      Graph->AddEdge(i,i + 5);
869    }
870    return Graph;
871  }
872  PNGraph GetDPetersen() {
873    PNGraph Graph = TNGraph::New();
874    for (int i = 0; i < 10; i++) {
875      Graph->AddNode(i);
876    }
877    for (int i = 0; i < 5; i++) {
878      Graph->AddEdge(i,(i+1) % 5);
879    }
880    for (int i = 0; i < 5; i++) {
881      Graph->AddEdge(i + 5,(i+2) % 5 + 5);
882    }
883    for (int i = 0; i < 5; i++) {
884      Graph->AddEdge(i,i + 5);
885    }
886    return Graph;
887  }
888  TPt <TNodeEDatNet<TInt, TInt> > GetTestTNodeEDatNet() {
889    TPt <TNodeEDatNet<TInt, TInt> > Net;
890    TPt <TNodeEDatNet<TInt, TInt> > Net1;
891    TPt <TNodeEDatNet<TInt, TInt> > Net2;
892    int n;
893    Net = TNodeEDatNet<TInt, TInt>::New();
894    for (int i = 0; i < 20; i++) {
895      Net->AddNode(i);
896    }
897    for (int i = 0; i < 20; i++) {
898      Net->AddEdge(i,(i+1) % 20);
899      Net->AddEdge(i,(i+2) % 20);
900      Net->AddEdge(i,(i+3) % 20);
901    }
902    n = 0;
903    for (TNodeEDatNet<TInt, TInt>::TEdgeI EI = Net->BegEI(); EI < Net->EndEI(); EI++) {
904      Net->SetEDat(EI.GetSrcNId(),EI.GetDstNId(),n);
905      n = (n+1) % 4;
906    }
907    return Net;
908  }
909  TPt <TNodeEdgeNet<TInt, TInt> > GetTestTNodeEdgeNet() {
910    TPt <TNodeEdgeNet<TInt, TInt> > Net;
911    TPt <TNodeEdgeNet<TInt, TInt> > Net1;
912    TPt <TNodeEdgeNet<TInt, TInt> > Net2;
913    int n;
914    Net = TNodeEdgeNet<TInt, TInt>::New();
915    for (int i = 0; i < 20; i++) {
916      Net->AddNode(i);
917    }
918    for (int i = 0; i < 20; i++) {
919      Net->AddEdge(i,(i+1) % 20);
920      Net->AddEdge(i,(i+2) % 20);
921      Net->AddEdge(i,(i+3) % 20);
922      Net->AddEdge(i,(i+1) % 20);
923      Net->AddEdge(i,(i+2) % 20);
924      Net->AddEdge(i,(i+3) % 20);
925    }
926    n = 0;
927    for (TNodeEdgeNet<TInt, TInt>::TEdgeI EI = Net->BegEI(); EI < Net->EndEI(); EI++) {
928      Net->SetEDat(EI.GetId(),n);
929      n = (n+1) % 4;
930    }
931    return Net;
932  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-duration_test.cc</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-test-subgraph.cpp</div>
                <div class="column column_space"><pre><code>744    constexpr absl::Duration nearly_min_duration =
745        absl::time_internal::MakeDuration(kint64min, int64_t{1});
746    constexpr absl::Duration negated_nearly_min_duration = -nearly_min_duration;
747    EXPECT_EQ(negated_max_duration, nearly_min_duration);
748    EXPECT_EQ(negated_nearly_min_duration, max_duration);
749    EXPECT_EQ(-(-max_duration), max_duration);
750    constexpr absl::Duration min_duration =
751        absl::time_internal::MakeDuration(kint64min);
752    constexpr absl::Duration negated_min_duration = -min_duration;
753    EXPECT_EQ(negated_min_duration, absl::InfiniteDuration());
754  }
755  TEST(Duration, AbsoluteValue) {
756    EXPECT_EQ(absl::ZeroDuration(), AbsDuration(absl::ZeroDuration()));
757    EXPECT_EQ(absl::Seconds(1), AbsDuration(absl::Seconds(1)));
758    EXPECT_EQ(absl::Seconds(1), AbsDuration(absl::Seconds(-1)));
759    EXPECT_EQ(absl::InfiniteDuration(), AbsDuration(absl::InfiniteDuration()));
760    EXPECT_EQ(absl::InfiniteDuration(), AbsDuration(-absl::InfiniteDuration()));
761    absl::Duration max_dur =
762        absl::Seconds(kint64max) + (absl::Seconds(1) - absl::Nanoseconds(1) / 4);
763    EXPECT_EQ(max_dur, AbsDuration(max_dur));
764    absl::Duration min_dur = absl::Seconds(kint64min);
</pre></code></div>
                <div class="column column_space"><pre><code>153    for (i = 0; i < 20; i += 2) {
154      NIdV1.Add(i);
155    }
156    Net2 = TSnap::GetSubGraph(Net, NIdV1);
157    EXPECT_EQ(10,Net2->GetNodes());
158    EXPECT_EQ(20,Net2->GetEdges());
159    Net3 = TSnap::GetEDatSubGraph(Net, 1, 0);
160    EXPECT_EQ(20,Net3->GetNodes());
161    EXPECT_EQ(30,Net3->GetEdges());
162    Net4 = TSnap::GetEDatSubGraph(Net, 2, -1);
163    EXPECT_EQ(20,Net4->GetNodes());
164    EXPECT_EQ(60,Net4->GetEdges());
165  }
166  TEST(subgraph, TestConvertGraphs) {
167    PNGraph NGraph;
168    PUNGraph UNGraph;
169    NGraph = GetTestTNGraph();
170    EXPECT_EQ(20,NGraph->GetNodes());
171    EXPECT_EQ(60,NGraph->GetEdges());
172    UNGraph = TSnap::ConvertGraph<PUNGraph>(NGraph);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    