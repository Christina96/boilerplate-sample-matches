<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for rib-module.t.cpp &amp; lp-reliability.t.cpp</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for rib-module.t.cpp &amp; lp-reliability.t.cpp
      </h3>
<h1 align="center">
        6.3%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>rib-module.t.cpp (6.4267354%)<th>lp-reliability.t.cpp (6.281407%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(47-64)<td><a href="#" name="0">(310-326)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(588-598)<td><a href="#" name="1">(541-627)</a><td align="center"><font color="#eb0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>rib-module.t.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 #include "nfdc/rib-module.hpp"
2 #include "execute-command-fixture.hpp"
3 #include "status-fixture.hpp"
4 namespace nfd {
5 namespace tools {
6 namespace nfdc {
7 namespace tests {
8 BOOST_AUTO_TEST_SUITE(Nfdc)
9 BOOST_FIXTURE_TEST_SUITE(TestRibModule, StatusFixture&lt;RibModule&gt;)
10 class RouteListFixture : public ExecuteCommandFixture
11 {
12 protected:
13   bool
14   respondRibDataset(const Interest&amp; interest)
15 <a name="0"></a>  {
16     if (!Name("/localhost/nfd/rib/list").isPrefixOf(interest.getName())) {
17       return false;
18 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>    }
19     RibEntry entry1;
20     entry1.setName("/5BBmTevRJ");
21     entry1.addRoute(Route()
22                       .setFaceId(6720)
23                       .setOrigin(ndn::nfd::ROUTE_ORIGIN_CLIENT)
24                       .setCost(2956)
25                       .setFlags(ndn::nfd::ROUTE_FLAG_CHILD_INHERIT | ndn::nfd::ROUTE_FLAG_CAPTURE)
26                       .setExpirationPeriod(29950035_ms));
27     entry1.addRoute(Route()
28                       .setFaceId(6720)
29                       .setOrigin(ndn::nfd::ROUTE_ORIGIN_STATIC)
30                       .setCost(425)
31                       .setFlags(ndn::nfd::ROUTE_FLAGS_NONE));
32     entry1.addRoute(Route()
33                       .setFaceId(8599)
34                       .setOrigin(ndn::nfd::ROUTE_ORIGIN_STATIC)</b></font>
35                       .setCost(9140)
36                       .setFlags(ndn::nfd::ROUTE_FLAG_CHILD_INHERIT));
37     RibEntry entry2;
38     entry2.setName("/aDPTKCio");
39     entry2.addRoute(Route()
40                       .setFaceId(31066)
41                       .setOrigin(ndn::nfd::ROUTE_ORIGIN_CLIENT)
42                       .setCost(4617)
43                       .setFlags(ndn::nfd::ROUTE_FLAG_CAPTURE));
44     this-&gt;sendDataset(interest.getName(), entry1, entry2);
45     return true;
46   }
47 };
48 BOOST_FIXTURE_TEST_SUITE(ListShowCommand, RouteListFixture)
49 const std::string NOFILTER_OUTPUT = std::string(R"TEXT(
50 prefix=/5BBmTevRJ nexthop=6720 origin=client cost=2956 flags=child-inherit|capture expires=29950s
51 prefix=/5BBmTevRJ nexthop=6720 origin=static cost=425 flags=none expires=never
52 prefix=/5BBmTevRJ nexthop=8599 origin=static cost=9140 flags=child-inherit expires=never
53 prefix=/aDPTKCio nexthop=31066 origin=client cost=4617 flags=capture expires=never
54 )TEXT").substr(1);
55 BOOST_AUTO_TEST_CASE(ListNoFilter)
56 {
57   this-&gt;processInterest = [this] (const Interest&amp; interest) {
58     BOOST_CHECK(this-&gt;respondRibDataset(interest));
59   };
60   this-&gt;execute("route");
61   BOOST_CHECK_EQUAL(exitCode, 0);
62   BOOST_CHECK(out.is_equal(NOFILTER_OUTPUT));
63   BOOST_CHECK(err.is_empty());
64 }
65 const std::string NEXTHOP_OUTPUT = std::string(R"TEXT(
66 prefix=/5BBmTevRJ nexthop=6720 origin=client cost=2956 flags=child-inherit|capture expires=29950s
67 prefix=/5BBmTevRJ nexthop=6720 origin=static cost=425 flags=none expires=never
68 prefix=/aDPTKCio nexthop=31066 origin=client cost=4617 flags=capture expires=never
69 )TEXT").substr(1);
70 BOOST_AUTO_TEST_CASE(ListByNexthop)
71 {
72   this-&gt;processInterest = [this] (const Interest&amp; interest) {
73     BOOST_CHECK(this-&gt;respondFaceQuery(interest) || this-&gt;respondRibDataset(interest));
74   };
75   this-&gt;execute("route list udp4://225.131.75.231:56363");
76   BOOST_CHECK_EQUAL(exitCode, 0);
77   BOOST_CHECK(out.is_equal(NEXTHOP_OUTPUT));
78   BOOST_CHECK(err.is_empty());
79 }
80 const std::string ORIGIN_OUTPUT = std::string(R"TEXT(
81 prefix=/5BBmTevRJ nexthop=6720 origin=static cost=425 flags=none expires=never
82 prefix=/5BBmTevRJ nexthop=8599 origin=static cost=9140 flags=child-inherit expires=never
83 )TEXT").substr(1);
84 BOOST_AUTO_TEST_CASE(ListByOriginNumeric)
85 {
86   this-&gt;processInterest = [this] (const Interest&amp; interest) {
87     BOOST_CHECK(this-&gt;respondRibDataset(interest));
88   };
89   this-&gt;execute("route list origin 255");
90   BOOST_CHECK_EQUAL(exitCode, 0);
91   BOOST_CHECK(out.is_equal(ORIGIN_OUTPUT));
92   BOOST_CHECK(err.is_empty());
93 }
94 BOOST_AUTO_TEST_CASE(ListByOriginString)
95 {
96   this-&gt;processInterest = [this] (const Interest&amp; interest) {
97     BOOST_CHECK(this-&gt;respondRibDataset(interest));
98   };
99   this-&gt;execute("route list origin static");
100   BOOST_CHECK_EQUAL(exitCode, 0);
101   BOOST_CHECK(out.is_equal(ORIGIN_OUTPUT));
102   BOOST_CHECK(err.is_empty());
103 }
104 const std::string PREFIX_OUTPUT = std::string(R"TEXT(
105 prefix=/5BBmTevRJ nexthop=6720 origin=client cost=2956 flags=child-inherit|capture expires=29950s
106 prefix=/5BBmTevRJ nexthop=6720 origin=static cost=425 flags=none expires=never
107 prefix=/5BBmTevRJ nexthop=8599 origin=static cost=9140 flags=child-inherit expires=never
108 )TEXT").substr(1);
109 BOOST_AUTO_TEST_CASE(ShowByPrefix)
110 {
111   this-&gt;processInterest = [this] (const Interest&amp; interest) {
112     BOOST_CHECK(this-&gt;respondRibDataset(interest));
113   };
114   this-&gt;execute("route show 5BBmTevRJ");
115   BOOST_CHECK_EQUAL(exitCode, 0);
116   BOOST_CHECK(out.is_equal(PREFIX_OUTPUT));
117   BOOST_CHECK(err.is_empty());
118 }
119 BOOST_AUTO_TEST_CASE(FaceNotExist)
120 {
121   this-&gt;processInterest = [this] (const Interest&amp; interest) {
122     BOOST_CHECK(this-&gt;respondFaceQuery(interest));
123   };
124   this-&gt;execute("route list 23728");
125   BOOST_CHECK_EQUAL(exitCode, 3);
126   BOOST_CHECK(out.is_empty());
127   BOOST_CHECK(err.is_equal("Face not found\n"));
128 }
129 BOOST_AUTO_TEST_CASE(RouteNotExist)
130 {
131   this-&gt;processInterest = [this] (const Interest&amp; interest) {
132     BOOST_CHECK(this-&gt;respondFaceQuery(interest) || this-&gt;respondRibDataset(interest));
133   };
134   this-&gt;execute("route list 10156");
135   BOOST_CHECK_EQUAL(exitCode, 6);
136   BOOST_CHECK(out.is_empty());
137   BOOST_CHECK(err.is_equal("Route not found\n"));
138 }
139 BOOST_AUTO_TEST_CASE(ErrorDataset)
140 {
141   this-&gt;processInterest = nullptr; 
142   this-&gt;execute("route list");
143   BOOST_CHECK_EQUAL(exitCode, 1);
144   BOOST_CHECK(out.is_empty());
145   BOOST_CHECK(err.is_equal("Error 10060 when fetching RIB dataset: Timeout exceeded\n"));
146 }
147 BOOST_AUTO_TEST_SUITE_END() 
148 BOOST_FIXTURE_TEST_SUITE(AddCommand, ExecuteCommandFixture)
149 BOOST_AUTO_TEST_CASE(NormalByFaceId)
150 {
151   this-&gt;processInterest = [this] (const Interest&amp; interest) {
152     if (this-&gt;respondFaceQuery(interest)) {
153       return;
154     }
155     ControlParameters req = MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/rib/register");
156     ndn::nfd::RibRegisterCommand cmd;
157     cmd.validateRequest(req);
158     cmd.applyDefaultsToRequest(req);
159     BOOST_CHECK_EQUAL(req.getName(), "/vxXoEaWeDB");
160     BOOST_CHECK_EQUAL(req.getFaceId(), 10156);
161     BOOST_CHECK_EQUAL(req.getOrigin(), ndn::nfd::ROUTE_ORIGIN_STATIC);
162     BOOST_CHECK_EQUAL(req.getCost(), 0);
163     BOOST_CHECK_EQUAL(req.getFlags(), ndn::nfd::ROUTE_FLAGS_NONE);
164     BOOST_CHECK_EQUAL(req.hasExpirationPeriod(), false);
165     this-&gt;succeedCommand(interest, req);
166   };
167   this-&gt;execute("route add /vxXoEaWeDB 10156 no-inherit");
168   BOOST_CHECK_EQUAL(exitCode, 0);
169   BOOST_CHECK(out.is_equal("route-add-accepted prefix=/vxXoEaWeDB nexthop=10156 origin=static "
170                            "cost=0 flags=none expires=never\n"));
171   BOOST_CHECK(err.is_empty());
172 }
173 BOOST_AUTO_TEST_CASE(NormalByFaceUri)
174 {
175   this-&gt;processInterest = [this] (const Interest&amp; interest) {
176     if (this-&gt;respondFaceQuery(interest)) {
177       return;
178     }
179     ControlParameters req = MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/rib/register");
180     ndn::nfd::RibRegisterCommand cmd;
181     cmd.validateRequest(req);
182     cmd.applyDefaultsToRequest(req);
183     BOOST_CHECK_EQUAL(req.getName(), "/FLQAsaYnYf");
184     BOOST_CHECK_EQUAL(req.getFaceId(), 2249);
185     BOOST_CHECK_EQUAL(req.getOrigin(), 17591);
186     BOOST_CHECK_EQUAL(req.getCost(), 702);
187     BOOST_CHECK_EQUAL(req.getFlags(), ndn::nfd::ROUTE_FLAG_CHILD_INHERIT |
188                                       ndn::nfd::ROUTE_FLAG_CAPTURE);
189     BOOST_REQUIRE_EQUAL(req.hasExpirationPeriod(), true);
190     BOOST_REQUIRE_EQUAL(req.getExpirationPeriod(), 727411987_ms);
191     ControlParameters resp = req;
192     resp.setExpirationPeriod(727411154_ms);     this-&gt;succeedCommand(interest, resp);
193   };
194   this-&gt;execute("route add /FLQAsaYnYf tcp4://32.121.182.82:6363 "
195                 "origin 17591 cost 702 capture expires 727411987");
196   BOOST_CHECK_EQUAL(exitCode, 0);
197   BOOST_CHECK(out.is_equal("route-add-accepted prefix=/FLQAsaYnYf nexthop=2249 origin=17591 "
198                            "cost=702 flags=child-inherit|capture expires=727411154ms\n"));
199   BOOST_CHECK(err.is_empty());
200 }
201 BOOST_AUTO_TEST_CASE(FaceNotExistFaceId)
202 {
203   this-&gt;processInterest = [this] (const Interest&amp; interest) {
204     BOOST_CHECK(this-&gt;respondFaceQuery(interest));
205   };
206   this-&gt;execute("route add /GJiKDus5i 23728");
207   BOOST_CHECK_EQUAL(exitCode, 3);
208   BOOST_CHECK(out.is_empty());
209   BOOST_CHECK(err.is_equal("Face not found\n"));
210 }
211 BOOST_AUTO_TEST_CASE(FaceNotExistFaceUri)
212 {
213   this-&gt;processInterest = [this] (const Interest&amp; interest) {
214     if (Name("/localhost/nfd/faces/query").isPrefixOf(interest.getName())) {
215       this-&gt;respondFaceQuery(interest);
216     }
217     else if (Name("/localhost/nfd/faces/create").isPrefixOf(interest.getName())) {
218       ControlParameters req = MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/faces/create");
219       ndn::nfd::FaceCreateCommand cmd;
220       cmd.validateRequest(req);
221       cmd.applyDefaultsToRequest(req);
222       BOOST_CHECK_EQUAL(req.getUri(), "udp4://202.83.168.28:6363");
223       ControlParameters resp = req;
224       resp.setFaceId(255);
225       resp.setLocalUri("udp4://32.121.182.82:50000");
226       resp.setFacePersistency(FacePersistency::FACE_PERSISTENCY_PERSISTENT);
227       resp.setBaseCongestionMarkingInterval(100_ms);
228       resp.setDefaultCongestionThreshold(65536);
229       resp.setMtu(8800);
230       resp.setFlags(0);
231       this-&gt;succeedCommand(interest, resp);
232     }
233     else if (Name("/localhost/nfd/rib/register").isPrefixOf(interest.getName())) {
234       ControlParameters req = MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/rib/register");
235       ndn::nfd::RibRegisterCommand cmd;
236       cmd.validateRequest(req);
237       cmd.applyDefaultsToRequest(req);
238       BOOST_CHECK_EQUAL(req.getName(), "/634jfAfdf");
239       BOOST_CHECK_EQUAL(req.getFaceId(), 255);
240       BOOST_CHECK_EQUAL(req.getOrigin(), 17591);
241       BOOST_CHECK_EQUAL(req.getCost(), 702);
242       BOOST_CHECK_EQUAL(req.getFlags(), ndn::nfd::ROUTE_FLAG_CHILD_INHERIT |
243                                         ndn::nfd::ROUTE_FLAG_CAPTURE);
244       BOOST_REQUIRE_EQUAL(req.hasExpirationPeriod(), true);
245       BOOST_REQUIRE_EQUAL(req.getExpirationPeriod(), 727411987_ms);
246       ControlParameters resp = req;
247       resp.setExpirationPeriod(727411154_ms);       this-&gt;succeedCommand(interest, resp);
248     }
249   };
250   this-&gt;execute("route add /634jfAfdf udp4://202.83.168.28:6363 "
251                 "origin 17591 cost 702 capture expires 727411987");
252   BOOST_CHECK(out.is_equal("face-created id=255 local=udp4://32.121.182.82:50000 "
253                            "remote=udp4://202.83.168.28:6363 persistency=persistent "
254                            "reliability=off congestion-marking=off "
255                            "congestion-marking-interval=100ms default-congestion-threshold=65536B "
256                            "mtu=8800\n"
257                            "route-add-accepted prefix=/634jfAfdf nexthop=255 origin=17591 "
258                            "cost=702 flags=child-inherit|capture expires=727411154ms\n"));
259   BOOST_CHECK(err.is_empty());
260   BOOST_CHECK_EQUAL(exitCode, 0);
261 }
262 BOOST_AUTO_TEST_CASE(FaceNotExistNotCanonizable)
263 {
264   this-&gt;processInterest = [this] (const Interest&amp; interest) {
265     BOOST_CHECK(this-&gt;respondFaceQuery(interest));
266   };
267   this-&gt;execute("route add /634jfAfdf udp6://202.83.168.28:6363 "
268                 "origin 17591 cost 702 capture expires 727411987");
269   BOOST_CHECK(out.is_empty());
270   BOOST_CHECK(err.is_equal("Error during canonization of 'udp6://202.83.168.28:6363': "
271                            "IPv4/v6 mismatch\n"));
272   BOOST_CHECK_EQUAL(exitCode, 4);
273 }
274 BOOST_AUTO_TEST_CASE(Ambiguous)
275 {
276   this-&gt;processInterest = [this] (const Interest&amp; interest) {
277     BOOST_CHECK(this-&gt;respondFaceQuery(interest));
278   };
279   this-&gt;execute("route add /BQqjjnVsz udp4://225.131.75.231:56363");
280   BOOST_CHECK_EQUAL(exitCode, 5);
281   BOOST_CHECK(out.is_empty());
282   BOOST_CHECK(err.is_equal("Multiple faces match specified remote FaceUri. "
283                            "Re-run the command with a FaceId: "
284                            "6720 (local=udp4://202.83.168.28:56363), "
285                            "31066 (local=udp4://25.90.26.32:56363)\n"));
286 }
287 BOOST_AUTO_TEST_CASE(ErrorCanonization)
288 {
289   this-&gt;execute("route add /bxJfGsVtDt udp6://32.38.164.64:10445");
290   BOOST_CHECK_EQUAL(exitCode, 4);
291   BOOST_CHECK(out.is_empty());
292   BOOST_CHECK(err.is_equal("Error during canonization of 'udp6://32.38.164.64:10445': "
293                            "IPv4/v6 mismatch\n"));
294 }
295 BOOST_AUTO_TEST_CASE(ErrorDataset)
296 {
297   this-&gt;processInterest = nullptr; 
298   this-&gt;execute("route add /q1Qf7go7 udp://159.242.33.78");
299   BOOST_CHECK_EQUAL(exitCode, 1);
300   BOOST_CHECK(out.is_empty());
301   BOOST_CHECK(err.is_equal("Error 10060 when querying face: Timeout exceeded\n"));
302 }
303 BOOST_AUTO_TEST_CASE(ErrorCommand)
304 {
305   this-&gt;processInterest = [this] (const Interest&amp; interest) {
306     if (this-&gt;respondFaceQuery(interest)) {
307       return;
308     }
309     MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/rib/register");
310   };
311   this-&gt;execute("route add /bYiMbEuE 10156");
312   BOOST_CHECK_EQUAL(exitCode, 1);
313   BOOST_CHECK(out.is_empty());
314   BOOST_CHECK(err.is_equal("Error 10060 when adding route: request timed out\n"));
315 }
316 BOOST_AUTO_TEST_SUITE_END() 
317 BOOST_FIXTURE_TEST_SUITE(RemoveCommand, ExecuteCommandFixture)
318 BOOST_AUTO_TEST_CASE(NormalByFaceId)
319 {
320   this-&gt;processInterest = [this] (const Interest&amp; interest) {
321     if (this-&gt;respondFaceQuery(interest)) {
322       return;
323     }
324     ControlParameters req = MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/rib/unregister");
325     ndn::nfd::RibUnregisterCommand cmd;
326     cmd.validateRequest(req);
327     cmd.applyDefaultsToRequest(req);
328     BOOST_CHECK_EQUAL(req.getName(), "/2B5NUGjpt");
329     BOOST_CHECK_EQUAL(req.getFaceId(), 10156);
330     BOOST_CHECK_EQUAL(req.getOrigin(), ndn::nfd::ROUTE_ORIGIN_STATIC);
331     this-&gt;succeedCommand(interest, req);
332   };
333   this-&gt;execute("route remove /2B5NUGjpt 10156");
334   BOOST_CHECK_EQUAL(exitCode, 0);
335   BOOST_CHECK(out.is_equal("route-removed prefix=/2B5NUGjpt nexthop=10156 origin=static\n"));
336   BOOST_CHECK(err.is_empty());
337 }
338 BOOST_AUTO_TEST_CASE(NormalByFaceUri)
339 {
340   this-&gt;processInterest = [this] (const Interest&amp; interest) {
341     if (this-&gt;respondFaceQuery(interest)) {
342       return;
343     }
344     ControlParameters req = MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/rib/unregister");
345     ndn::nfd::RibUnregisterCommand cmd;
346     cmd.validateRequest(req);
347     cmd.applyDefaultsToRequest(req);
348     BOOST_CHECK_EQUAL(req.getName(), "/wHdNn0BtUF");
349     BOOST_CHECK_EQUAL(req.getFaceId(), 2249);
350     BOOST_CHECK_EQUAL(req.getOrigin(), 15246);
351     this-&gt;succeedCommand(interest, req);
352   };
353   this-&gt;execute("route remove /wHdNn0BtUF tcp4://32.121.182.82:6363 origin 15246");
354   BOOST_CHECK_EQUAL(exitCode, 0);
355   BOOST_CHECK(out.is_equal("route-removed prefix=/wHdNn0BtUF nexthop=2249 origin=15246\n"));
356   BOOST_CHECK(err.is_empty());
357 }
358 BOOST_AUTO_TEST_CASE(MultipleFaces)
359 {
360   std::set&lt;uint64_t&gt; faceIds{6720, 31066};
361   this-&gt;processInterest = [this, &amp;faceIds] (const Interest&amp; interest) {
362     if (this-&gt;respondFaceQuery(interest)) {
363       return;
364     }
365     ControlParameters req = MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/rib/unregister");
366     ndn::nfd::RibUnregisterCommand cmd;
367     cmd.validateRequest(req);
368     cmd.applyDefaultsToRequest(req);
369     BOOST_CHECK_EQUAL(req.getName(), "/nm5y8X8b2");
370     BOOST_CHECK_MESSAGE(faceIds.erase(req.getFaceId()), "expected face " + to_string(req.getFaceId()));
371     BOOST_CHECK_EQUAL(req.getOrigin(), ndn::nfd::ROUTE_ORIGIN_STATIC);
372     this-&gt;succeedCommand(interest, req);
373   };
374   this-&gt;execute("route remove /nm5y8X8b2 udp4://225.131.75.231:56363");
375   BOOST_CHECK(faceIds.empty());
376   BOOST_CHECK_EQUAL(exitCode, 0);
377   BOOST_CHECK(out.is_equal("route-removed prefix=/nm5y8X8b2 nexthop=6720 origin=static\n"
378                            "route-removed prefix=/nm5y8X8b2 nexthop=31066 origin=static\n"));
379   BOOST_CHECK(err.is_empty());
380 }
381 BOOST_AUTO_TEST_CASE(FaceNotExist)
382 {
383   this-&gt;processInterest = [this] (const Interest&amp; interest) {
384     BOOST_CHECK(this-&gt;respondFaceQuery(interest));
385   };
386   this-&gt;execute("route remove /HeGRjzwFM 23728");
387   BOOST_CHECK_EQUAL(exitCode, 3);
388   BOOST_CHECK(out.is_empty());
389   BOOST_CHECK(err.is_equal("Face not found\n"));
390 }
391 BOOST_AUTO_TEST_CASE(ErrorDataset)
392 {
393   this-&gt;processInterest = nullptr; 
394   this-&gt;execute("route remove /YX4xQQN3v5 udp://26.97.248.3");
395   BOOST_CHECK_EQUAL(exitCode, 1);
396   BOOST_CHECK(out.is_empty());
397   BOOST_CHECK(err.is_equal("Error 10060 when querying face: Timeout exceeded\n"));
398 }
399 BOOST_AUTO_TEST_CASE(ErrorCommand)
400 {
401   this-&gt;processInterest = [this] (const Interest&amp; interest) {
402     if (this-&gt;respondFaceQuery(interest)) {
403       return;
404     }
405     MOCK_NFD_MGMT_REQUIRE_COMMAND_IS("/localhost/nfd/rib/unregister");
406   };
407   this-&gt;execute("route remove /mvGRoxD2 10156");
408   BOOST_CHECK_EQUAL(exitCode, 1);
409   BOOST_CHECK(out.is_empty());
410   BOOST_CHECK(err.is_equal("Error 10060 when removing route: request timed out\n"));
411 }
412 BOOST_AUTO_TEST_SUITE_END() 
413 const std::string STATUS_XML = stripXmlSpaces(R"XML(
414   &lt;rib&gt;
415     &lt;ribEntry&gt;
416       &lt;prefix&gt;/&lt;/prefix&gt;
417       &lt;routes&gt;
418         &lt;route&gt;
419           &lt;faceId&gt;262&lt;/faceId&gt;
420           &lt;origin&gt;static&lt;/origin&gt;
421           &lt;cost&gt;9&lt;/cost&gt;
422           &lt;flags&gt;
423             &lt;ribCapture/&gt;
424           &lt;/flags&gt;
425         &lt;/route&gt;
426         &lt;route&gt;
427           &lt;faceId&gt;272&lt;/faceId&gt;
428           &lt;origin&gt;static&lt;/origin&gt;
429           &lt;cost&gt;50&lt;/cost&gt;
430           &lt;flags/&gt;
431         &lt;/route&gt;
432         &lt;route&gt;
433           &lt;faceId&gt;274&lt;/faceId&gt;
434           &lt;origin&gt;static&lt;/origin&gt;
435           &lt;cost&gt;78&lt;/cost&gt;
436           &lt;flags&gt;
437             &lt;childInherit/&gt;
438             &lt;ribCapture/&gt;
439           &lt;/flags&gt;
440         &lt;/route&gt;
441         &lt;route&gt;
442           &lt;faceId&gt;276&lt;/faceId&gt;
443           &lt;origin&gt;static&lt;/origin&gt;
444           &lt;cost&gt;79&lt;/cost&gt;
445           &lt;flags&gt;
446             &lt;childInherit/&gt;
447           &lt;/flags&gt;
448           &lt;expirationPeriod&gt;PT47S&lt;/expirationPeriod&gt;
449         &lt;/route&gt;
450       &lt;/routes&gt;
451     &lt;/ribEntry&gt;
452     &lt;ribEntry&gt;
453       &lt;prefix&gt;/localhost/nfd&lt;/prefix&gt;
454       &lt;routes&gt;
455         &lt;route&gt;
456           &lt;faceId&gt;258&lt;/faceId&gt;
457           &lt;origin&gt;app&lt;/origin&gt;
458           &lt;cost&gt;0&lt;/cost&gt;
459           &lt;flags&gt;
460             &lt;childInherit/&gt;
461           &lt;/flags&gt;
462         &lt;/route&gt;
463       &lt;/routes&gt;
464     &lt;/ribEntry&gt;
465   &lt;/rib&gt;
466 )XML");
467 const std::string STATUS_TEXT =
468   "RIB:\n"
469   "  / routes={nexthop=262 origin=static cost=9 flags=capture expires=never, "
470               "nexthop=272 origin=static cost=50 flags=none expires=never, "
471               "nexthop=274 origin=static cost=78 flags=child-inherit|capture expires=never, "
472               "nexthop=276 origin=static cost=79 flags=child-inherit expires=47s}\n"
473   "  /localhost/nfd routes={nexthop=258 origin=app cost=0 flags=child-inherit expires=never}\n";
474 BOOST_AUTO_TEST_CASE(Status)
475 {
476   this-&gt;fetchStatus();
477 <a name="1"></a>  RibEntry payload1;
478   payload1.setName("/")
479           .addRoute(Route().setFaceId(262)
480 <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>                           .setOrigin(ndn::nfd::ROUTE_ORIGIN_STATIC)
481                            .setCost(9)
482                            .setFlags(ndn::nfd::ROUTE_FLAG_CAPTURE))
483           .addRoute(Route().setFaceId(272)
484                            .setOrigin(ndn::nfd::ROUTE_ORIGIN_STATIC)
485                            .setCost(50)
486                            .setFlags(ndn::nfd::ROUTE_FLAGS_NONE))
487           .addRoute(Route().setFaceId(274)
488                            .setOrigin(ndn::nfd::ROUTE_ORIGIN_STATIC)
489                            .setCost(78)
490                            .setFlags(ndn::nfd::ROUTE_FLAG_CHILD_INHERIT | ndn::nfd::ROUTE_FLAG_CAPTURE))</b></font>
491           .addRoute(Route().setFaceId(276)
492                            .setOrigin(ndn::nfd::ROUTE_ORIGIN_STATIC)
493                            .setCost(79)
494                            .setFlags(ndn::nfd::ROUTE_FLAG_CHILD_INHERIT)
495                            .setExpirationPeriod(47292_ms));
496   RibEntry payload2;
497   payload2.setName("/localhost/nfd")
498           .addRoute(Route().setFaceId(258)
499                            .setOrigin(ndn::nfd::ROUTE_ORIGIN_APP)
500                            .setCost(0)
501                            .setFlags(ndn::nfd::ROUTE_FLAG_CHILD_INHERIT));
502   this-&gt;sendDataset("/localhost/nfd/rib/list", payload1, payload2);
503   this-&gt;prepareStatusOutput();
504   BOOST_CHECK(statusXml.is_equal(STATUS_XML));
505   BOOST_CHECK(statusText.is_equal(STATUS_TEXT));
506 }
507 BOOST_AUTO_TEST_SUITE_END() BOOST_AUTO_TEST_SUITE_END() 
} } } } </pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>lp-reliability.t.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 #include "face/lp-reliability.hpp"
2 #include "face/face.hpp"
3 #include "face/generic-link-service.hpp"
4 #include "tests/test-common.hpp"
5 #include "tests/daemon/global-io-fixture.hpp"
6 #include "dummy-face.hpp"
7 #include "dummy-transport.hpp"
8 #include &lt;cstring&gt;
9 namespace nfd {
10 namespace face {
11 namespace tests {
12 using namespace nfd::tests;
13 class DummyLpReliabilityLinkService : public GenericLinkService
14 {
15 public:
16   LpReliability*
17   getLpReliability()
18   {
19     return &amp;m_reliability;
20   }
21   void
22   sendLpPackets(std::vector&lt;lp::Packet&gt; frags)
23   {
24     if (frags.front().has&lt;lp::FragmentField&gt;()) {
25       Interest interest("/test/prefix");
26       lp::Packet pkt;
27       pkt.add&lt;lp::FragmentField&gt;({interest.wireEncode().begin(), interest.wireEncode().end()});
28       assignSequences(frags);
29       m_reliability.handleOutgoing(frags, std::move(pkt), true);
30     }
31     for (auto frag : frags) {
32       this-&gt;sendLpPacket(std::move(frag));
33     }
34   }
35 private:
36   void
37   doSendInterest(const Interest&amp;) final
38   {
39     BOOST_FAIL("unexpected doSendInterest");
40   }
41   void
42   doSendData(const Data&amp;) final
43   {
44     BOOST_FAIL("unexpected doSendData");
45   }
46   void
47   doSendNack(const lp::Nack&amp;) final
48   {
49     BOOST_FAIL("unexpected doSendNack");
50   }
51   void
52   doReceivePacket(const Block&amp;, const EndpointId&amp;) final
53   {
54     BOOST_FAIL("unexpected doReceivePacket");
55   }
56 };
57 class LpReliabilityFixture : public GlobalIoTimeFixture
58 {
59 public:
60   LpReliabilityFixture()
61     : linkService(make_unique&lt;DummyLpReliabilityLinkService&gt;())
62     , transport(make_unique&lt;DummyTransport&gt;())
63     , face(make_unique&lt;DummyFace&gt;())
64   {
65     linkService-&gt;setFaceAndTransport(*face, *transport);
66     transport-&gt;setFaceAndLinkService(*face, *linkService);
67     GenericLinkService::Options options;
68     options.reliabilityOptions.isEnabled = true;
69     linkService-&gt;setOptions(options);
70     reliability = linkService-&gt;getLpReliability();
71     reliability-&gt;m_lastTxSeqNo = 1;
72   }
73   static bool
74   netPktHasUnackedFrag(const shared_ptr&lt;LpReliability::NetPkt&gt;&amp; netPkt, lp::Sequence txSeq)
75   {
76     return std::any_of(netPkt-&gt;unackedFrags.begin(), netPkt-&gt;unackedFrags.end(),
77                        [txSeq] (auto fragIt) { return fragIt-&gt;first == txSeq; });
78   }
79   static lp::Packet
80   makeFrag(uint32_t pktNum, size_t payloadSize = 4)
81   {
82     BOOST_ASSERT(payloadSize &gt;= 4 &amp;&amp; payloadSize &lt;= 255);
83     lp::Packet pkt;
84     ndn::Buffer buf(payloadSize);
85     std::memcpy(buf.data(), &amp;pktNum, sizeof(pktNum));
86     pkt.set&lt;lp::FragmentField&gt;({buf.cbegin(), buf.cend()});
87     return pkt;
88   }
89   static uint32_t
90   getPktNum(const lp::Packet&amp; pkt)
91   {
92     BOOST_REQUIRE(pkt.has&lt;lp::FragmentField&gt;());
93     ndn::Buffer::const_iterator begin, end;
94     std::tie(begin, end) = pkt.get&lt;lp::FragmentField&gt;();
95     if (std::distance(begin, end) &lt; 4) {
96       return 0;
97     }
98     uint32_t value = 0;
99     std::memcpy(&amp;value, &amp;*begin, sizeof(value));
100     return value;
101   }
102 protected:
103   unique_ptr&lt;DummyLpReliabilityLinkService&gt; linkService;
104   unique_ptr&lt;DummyTransport&gt; transport;
105   unique_ptr&lt;DummyFace&gt; face;
106   LpReliability* reliability;
107 };
108 BOOST_AUTO_TEST_SUITE(Face)
109 BOOST_FIXTURE_TEST_SUITE(TestLpReliability, LpReliabilityFixture)
110 BOOST_AUTO_TEST_CASE(SendNoFragmentField)
111 {
112   lp::Packet pkt;
113   linkService-&gt;sendLpPackets({pkt});
114   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 0);
115   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
116   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
117   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
118   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
119   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
120 }
121 BOOST_AUTO_TEST_CASE(SendUnfragmentedRetx)
122 {
123   lp::Packet pkt1 = makeFrag(1024, 50);
124   lp::Packet pkt2 = makeFrag(3000, 30);
125   linkService-&gt;sendLpPackets({pkt1});
126   BOOST_REQUIRE_EQUAL(transport-&gt;sentPackets.size(), 1);
127   lp::Packet cached1(transport-&gt;sentPackets.front());
128   BOOST_REQUIRE(cached1.has&lt;lp::TxSequenceField&gt;());
129   BOOST_CHECK(cached1.has&lt;lp::SequenceField&gt;());
130   lp::Sequence firstTxSeq = cached1.get&lt;lp::TxSequenceField&gt;();
131   BOOST_CHECK_EQUAL(firstTxSeq, 2);
132   BOOST_CHECK_EQUAL(getPktNum(cached1), 1024);
133   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
134   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
135   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
136   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
137   advanceClocks(1_ms, 500);
138   linkService-&gt;sendLpPackets({pkt2});
139   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 2);
140   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 2);
141   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq), 1);
142   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 1), 1);
143   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(firstTxSeq).netPkt);
144   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(firstTxSeq + 1).netPkt);
145   BOOST_CHECK_NE(reliability-&gt;m_unackedFrags.at(firstTxSeq).netPkt,
146                  reliability-&gt;m_unackedFrags.at(firstTxSeq + 1).netPkt);
147   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq).retxCount, 0);
148   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 1).retxCount, 0);
149   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, firstTxSeq);
150   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
151   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
152   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
153   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
154   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
155   advanceClocks(1_ms, 750);
156   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 2);
157   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq), 0);
158   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 2), 1);
159   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 2).retxCount, 1);
160   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 1), 1);
161   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 1).retxCount, 0);
162   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, firstTxSeq + 1);
163   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 3);
164   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
165   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
166   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
167   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
168   advanceClocks(1_ms, 1000);
169   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 2);
170   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 1), 0);
171   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 2), 0);
172   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 4), 1);
173   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 4).retxCount, 2);
174   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 3), 1);
175   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 3).retxCount, 1);
176   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, firstTxSeq + 3);
177   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 5);
178   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
179   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
180   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
181   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
182   advanceClocks(1_ms, 1000);
183   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 2);
184   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 3), 0);
185   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 4), 0);
186   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 6), 1);
187   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 6).retxCount, 3);
188   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 5), 1);
189   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 5).retxCount, 2);
190   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, firstTxSeq + 5);
191   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 7);
192   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
193   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
194   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
195   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
196   advanceClocks(1_ms, 1000);
197   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 1);
198   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 5), 0);
199   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 6), 0);
200   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(firstTxSeq + 7), 1);
201   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 7).retxCount, 3);
202   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, firstTxSeq + 7);
203   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 8);
204   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
205   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
206   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 1);
207   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 1);
208   advanceClocks(1_ms, 1000);
209   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 0);
210   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
211   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 8);
212   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
213   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
214   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 2);
215   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 2);
216 }
217 BOOST_AUTO_TEST_CASE(SendFragmentedRetx)
218 {
219   lp::Packet pkt1 = makeFrag(2048, 30);
220 <a name="0"></a>  lp::Packet pkt2 = makeFrag(2049, 30);
221   lp::Packet pkt3 = makeFrag(2050, 10);
222 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>  linkService-&gt;sendLpPackets({pkt1, pkt2, pkt3});
223   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 3);
224   lp::Packet cached1(transport-&gt;sentPackets.at(0));
225   BOOST_REQUIRE(cached1.has&lt;lp::TxSequenceField&gt;());
226   BOOST_CHECK_EQUAL(cached1.get&lt;lp::TxSequenceField&gt;(), 2);
227   BOOST_CHECK(cached1.has&lt;lp::SequenceField&gt;());
228   BOOST_CHECK_EQUAL(getPktNum(cached1), 2048);
229   lp::Packet cached2(transport-&gt;sentPackets.at(1));
230   BOOST_REQUIRE(cached2.has&lt;lp::TxSequenceField&gt;());
231   BOOST_CHECK_EQUAL(cached2.get&lt;lp::TxSequenceField&gt;(), 3);
232   BOOST_CHECK(cached2.has&lt;lp::SequenceField&gt;());
233   BOOST_CHECK_EQUAL(getPktNum(cached2), 2049);
234   lp::Packet cached3(transport-&gt;sentPackets.at(2));
235   BOOST_REQUIRE(cached3.has&lt;lp::TxSequenceField&gt;());
236   BOOST_CHECK_EQUAL(cached3.get&lt;lp::TxSequenceField&gt;(), 4);
237   BOOST_CHECK(cached3.has&lt;lp::SequenceField&gt;());</b></font>
238   BOOST_CHECK_EQUAL(getPktNum(cached3), 2050);
239   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
240   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
241   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
242   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
243   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 1);
244   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(3), 1);
245   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(4), 1);
246   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(2).pkt), 2048);
247   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(3).pkt), 2049);
248   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(4).pkt), 2050);
249   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).retxCount, 0);
250   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(2).netPkt);
251   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).retxCount, 0);
252   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(3).netPkt);
253   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(4).retxCount, 0);
254   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(4).netPkt);
255   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt, reliability-&gt;m_unackedFrags.at(3).netPkt);
256   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt, reliability-&gt;m_unackedFrags.at(4).netPkt);
257   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt-&gt;unackedFrags.size(), 3);
258   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 2));
259   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 3));
260   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 4));
261   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 2);
262   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
263   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 3);
264   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
265   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
266   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
267   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
268   advanceClocks(1_ms, 250);
269   reliability-&gt;onLpPacketLost(3, true);
270   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 1);
271   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(3), 0);
272   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(5), 1);
273   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(4), 1);
274   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(2).pkt), 2048);
275   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(5).pkt), 2049);
276   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(4).pkt), 2050);
277   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).retxCount, 0);
278   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(2).netPkt);
279   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(5).retxCount, 1);
280   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(5).netPkt);
281   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(4).retxCount, 0);
282   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(4).netPkt);
283   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt, reliability-&gt;m_unackedFrags.at(5).netPkt);
284   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt, reliability-&gt;m_unackedFrags.at(4).netPkt);
285   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt-&gt;unackedFrags.size(), 3);
286   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 2));
287   BOOST_CHECK(!netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 3));
288   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 5));
289   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 4));
290   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 2);
291   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 4);
292   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
293   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
294   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
295   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
296   advanceClocks(1_ms, 250);
297   reliability-&gt;onLpPacketLost(5, true);
298   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 1);
299   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(5), 0);
300   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(6), 1);
301   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(4), 1);
302   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(2).pkt), 2048);
303   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(6).pkt), 2049);
304   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(4).pkt), 2050);
305   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).retxCount, 0);
306   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(2).netPkt);
307   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(6).retxCount, 2);
308   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(6).netPkt);
309   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(4).retxCount, 0);
310   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(4).netPkt);
311   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt, reliability-&gt;m_unackedFrags.at(6).netPkt);
312   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt, reliability-&gt;m_unackedFrags.at(4).netPkt);
313   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt-&gt;unackedFrags.size(), 3);
314   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 2));
315   BOOST_CHECK(!netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 5));
316   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 6));
317   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 4));
318   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 2);
319   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 5);
320   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
321   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
322   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
323   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
324   advanceClocks(1_ms, 250);
325   reliability-&gt;onLpPacketLost(6, true);
326   BOOST_REQUIRE_EQUAL(reliability-&gt;m_unackedFrags.count(2), 1);
327   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(6), 0);
328   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(7), 1);
329   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(4), 1);
330   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(2).pkt), 2048);
331   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(7).pkt), 2049);
332   BOOST_CHECK_EQUAL(getPktNum(reliability-&gt;m_unackedFrags.at(4).pkt), 2050);
333   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).retxCount, 0);
334   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(2).netPkt);
335   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(7).retxCount, 3);
336   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(7).netPkt);
337   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(4).retxCount, 0);
338   BOOST_REQUIRE(reliability-&gt;m_unackedFrags.at(4).netPkt);
339   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt, reliability-&gt;m_unackedFrags.at(7).netPkt);
340   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt, reliability-&gt;m_unackedFrags.at(4).netPkt);
341   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).netPkt-&gt;unackedFrags.size(), 3);
342   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 2));
343   BOOST_CHECK(!netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 6));
344   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 7));
345   BOOST_CHECK(netPktHasUnackedFrag(reliability-&gt;m_unackedFrags.at(2).netPkt, 4));
346   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 2);
347   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 6);
348   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
349   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
350   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
351   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
352   advanceClocks(1_ms, 100);
353   reliability-&gt;onLpPacketLost(7, true);
354   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 0);
355   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
356   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
357   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
358   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 1);
359   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 1);
360 }
361 BOOST_AUTO_TEST_CASE(AckUnknownTxSeq)
362 {
363   linkService-&gt;sendLpPackets({makeFrag(1, 50)});
364   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 1);
365   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 1);
366   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(2).netPkt);
367   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 2);
368   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 1);
369   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
370   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
371   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
372   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
373   lp::Packet ackPkt;
374   ackPkt.add&lt;lp::AckField&gt;(10101010);
375   BOOST_CHECK(reliability-&gt;processIncomingPacket(ackPkt));
376   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 1);
377   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 1);
378   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(2).netPkt);
379   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 2);
380   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 1);
381   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
382   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
383   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
384   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
385 }
386 BOOST_AUTO_TEST_CASE(LossByGreaterAcks)
387 {
388   reliability-&gt;m_lastTxSeqNo = 0xFFFFFFFFFFFFFFFE;
389   linkService-&gt;sendLpPackets({makeFrag(1, 50)});
390   linkService-&gt;sendLpPackets({makeFrag(2, 50)});
391   linkService-&gt;sendLpPackets({makeFrag(3, 50)});
392   linkService-&gt;sendLpPackets({makeFrag(4, 50)});
393   linkService-&gt;sendLpPackets({makeFrag(5, 50)});
394   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 5);
395   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0xFFFFFFFFFFFFFFFF), 1);   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(0xFFFFFFFFFFFFFFFF).netPkt);
396   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0), 1);   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(0).netPkt);
397   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(1), 1);   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(1).netPkt);
398   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 1);   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(2).netPkt);
399   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(3), 1);   BOOST_CHECK(reliability-&gt;m_unackedFrags.at(3).netPkt);
400   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 0xFFFFFFFFFFFFFFFF);
401   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 0);
402   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
403 <a name="1"></a>  BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
404   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
405 <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>  lp::Packet ackPkt1;
406   ackPkt1.add&lt;lp::AckField&gt;(0);
407   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 5);
408   BOOST_CHECK(reliability-&gt;processIncomingPacket(ackPkt1));
409   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 4);
410   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0xFFFFFFFFFFFFFFFF), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(0xFFFFFFFFFFFFFFFF).retxCount, 0);
411   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(0xFFFFFFFFFFFFFFFF).nGreaterSeqAcks, 1);
412   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(1), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(1).retxCount, 0);
413   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(1).nGreaterSeqAcks, 0);
414   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).retxCount, 0);
415   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(2).nGreaterSeqAcks, 0);
416   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(3), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).retxCount, 0);
417   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).nGreaterSeqAcks, 0);
418   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 0xFFFFFFFFFFFFFFFF);
419   BOOST_REQUIRE_EQUAL(transport-&gt;sentPackets.size(), 5);
420   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 1);
421   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
422   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
423   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
424   lp::Packet ackPkt2;
425   ackPkt2.add&lt;lp::AckField&gt;(2);
426   ackPkt1.add&lt;lp::AckField&gt;(101010); 
427   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 5);
428   BOOST_CHECK(reliability-&gt;processIncomingPacket(ackPkt2));
429   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 3);
430   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0xFFFFFFFFFFFFFFFF), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(0xFFFFFFFFFFFFFFFF).retxCount, 0);
431   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(0xFFFFFFFFFFFFFFFF).nGreaterSeqAcks, 2);
432   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(1), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(1).retxCount, 0);
433   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(1).nGreaterSeqAcks, 1);
434   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(3), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).retxCount, 0);
435   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).nGreaterSeqAcks, 0);
436   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(101010), 0);
437   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 0xFFFFFFFFFFFFFFFF);
438   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 5);
439   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 2);
440   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
441   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
442   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
443   lp::Packet ackPkt3;
444   ackPkt3.add&lt;lp::AckField&gt;(1);
445   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 5);
446   BOOST_CHECK(reliability-&gt;processIncomingPacket(ackPkt3));
447   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 2);
448   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0xFFFFFFFFFFFFFFFF), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(1), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(3), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).retxCount, 0);
449   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).nGreaterSeqAcks, 0);
450   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(4), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(4).retxCount, 1);
451   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(4).nGreaterSeqAcks, 0);
452   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 3);
453   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 6);
454   lp::Packet sentRetxPkt(transport-&gt;sentPackets.back());
455   BOOST_REQUIRE(sentRetxPkt.has&lt;lp::TxSequenceField&gt;());
456   BOOST_CHECK_EQUAL(sentRetxPkt.get&lt;lp::TxSequenceField&gt;(), 4);
457   BOOST_CHECK_EQUAL(getPktNum(sentRetxPkt), 1);
458   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 3);
459   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
460   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
461   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
462   lp::Packet ackPkt4;
463   ackPkt4.add&lt;lp::AckField&gt;(4);</b></font>
464   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 6);
465   BOOST_CHECK(reliability-&gt;processIncomingPacket(ackPkt4));
466   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 1);
467   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0xFFFFFFFFFFFFFFFF), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(0), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(1), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(2), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(3), 1);   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).retxCount, 0);
468   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(3).nGreaterSeqAcks, 1);
469   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.count(4), 0);   BOOST_CHECK_EQUAL(reliability-&gt;m_firstUnackedFrag-&gt;first, 3);
470   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 6);
471   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 3);
472   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 1);
473   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
474   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
475 }
476 BOOST_AUTO_TEST_CASE(SkipFragmentsRemovedInRtt)
477 {
478   auto opts = linkService-&gt;getOptions();
479   opts.reliabilityOptions.maxRetx = 0;   opts.reliabilityOptions.seqNumLossThreshold = 3;
480   linkService-&gt;setOptions(opts);
481   lp::Packet frag1 = makeFrag(5001);
482   lp::Packet frag2 = makeFrag(5002);
483   linkService-&gt;sendLpPackets({frag1, frag2});   linkService-&gt;sendLpPackets({makeFrag(5003)});
484   linkService-&gt;sendLpPackets({makeFrag(5004)});
485   linkService-&gt;sendLpPackets({makeFrag(5005)});
486   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 5);
487   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 5);
488   lp::Sequence firstTxSeq = reliability-&gt;m_firstUnackedFrag-&gt;first;
489   lp::Packet ackPkt1;
490   ackPkt1.add&lt;lp::AckField&gt;(firstTxSeq + 4);
491   ackPkt1.add&lt;lp::AckField&gt;(firstTxSeq + 3);
492   BOOST_CHECK(reliability-&gt;processIncomingPacket(ackPkt1));
493   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 3);
494   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq).nGreaterSeqAcks, 2);
495   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.at(firstTxSeq + 1).nGreaterSeqAcks, 2);
496   lp::Packet ackPkt2;
497   ackPkt2.add&lt;lp::AckField&gt;(firstTxSeq + 2);
498   BOOST_CHECK(reliability-&gt;processIncomingPacket(ackPkt2)); 
499   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 0);
500 }
501 BOOST_AUTO_TEST_CASE(CancelLossNotificationOnAck)
502 {
503   reliability-&gt;onDroppedInterest.connect([] (const Interest&amp;) {
504     BOOST_FAIL("Packet loss timeout should be cancelled when packet acknowledged");
505   });
506   reliability-&gt;m_lastTxSeqNo = 0;
507   linkService-&gt;sendLpPackets({makeFrag(1, 50)});
508   advanceClocks(1_ms, 500);
509   lp::Packet ackPkt;
510   ackPkt.add&lt;lp::AckField&gt;(1);
511   BOOST_CHECK(reliability-&gt;processIncomingPacket(ackPkt));
512   advanceClocks(1_ms, 1000);
513   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nAcknowledged, 1);
514   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetransmitted, 0);
515   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nRetxExhausted, 0);
516   BOOST_CHECK_EQUAL(linkService-&gt;getCounters().nInterestsExceededRetx, 0);
517 }
518 BOOST_AUTO_TEST_CASE(ProcessIncomingPacket)
519 {
520   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
521   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
522   lp::Packet pkt1 = makeFrag(100, 40);
523   pkt1.add&lt;lp::SequenceField&gt;(123456);
524   pkt1.add&lt;lp::TxSequenceField&gt;(765432);
525   BOOST_CHECK(reliability-&gt;processIncomingPacket(pkt1));
526   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
527   BOOST_REQUIRE_EQUAL(reliability-&gt;m_ackQueue.size(), 1);
528   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.front(), 765432);
529   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 1);
530   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(123456), 1);
531   lp::Packet pkt2 = makeFrag(276, 40);
532   pkt2.add&lt;lp::SequenceField&gt;(654321);
533   pkt2.add&lt;lp::TxSequenceField&gt;(234567);
534   BOOST_CHECK(reliability-&gt;processIncomingPacket(pkt2));
535   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
536   BOOST_REQUIRE_EQUAL(reliability-&gt;m_ackQueue.size(), 2);
537   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.front(), 765432);
538   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.back(), 234567);
539   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 2);
540   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(123456), 1);
541   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(654321), 1);
542   advanceClocks(1_ms, 5);
543   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
544 }
545 BOOST_AUTO_TEST_CASE(PiggybackAcks)
546 {
547   reliability-&gt;m_ackQueue.push(256);
548   reliability-&gt;m_ackQueue.push(257);
549   reliability-&gt;m_ackQueue.push(10);
550   lp::Packet pkt;
551   linkService-&gt;sendLpPackets({pkt});
552   BOOST_REQUIRE_EQUAL(transport-&gt;sentPackets.size(), 1);
553   lp::Packet sentPkt(transport-&gt;sentPackets.front());
554   BOOST_REQUIRE_EQUAL(sentPkt.count&lt;lp::AckField&gt;(), 3);
555   BOOST_CHECK_EQUAL(sentPkt.get&lt;lp::AckField&gt;(0), 256);
556   BOOST_CHECK_EQUAL(sentPkt.get&lt;lp::AckField&gt;(1), 257);
557   BOOST_CHECK_EQUAL(sentPkt.get&lt;lp::AckField&gt;(2), 10);
558   BOOST_CHECK(!sentPkt.has&lt;lp::TxSequenceField&gt;());
559   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
560 }
561 BOOST_AUTO_TEST_CASE(PiggybackAcksMtu)
562 {
563   transport-&gt;setMtu(1500);
564   std::unordered_set&lt;lp::Sequence&gt; expectedAcks;
565   for (lp::Sequence i = 1000; i &lt; 2000; i++) {
566     reliability-&gt;m_ackQueue.push(i);
567     expectedAcks.insert(i);
568   }
569   for (uint32_t i = 1; i &lt;= 9; i++) {
570     lp::Packet pkt = makeFrag(i, 60);
571     linkService-&gt;sendLpPackets({pkt});
572     BOOST_REQUIRE_EQUAL(transport-&gt;sentPackets.size(), i);
573     lp::Packet sentPkt(transport-&gt;sentPackets.back());
574     BOOST_CHECK_EQUAL(getPktNum(sentPkt), i);
575     BOOST_CHECK(sentPkt.has&lt;lp::AckField&gt;());
576     for (lp::Sequence ack : sentPkt.list&lt;lp::AckField&gt;()) {
577       BOOST_CHECK_EQUAL(expectedAcks.erase(ack), 1);
578     }
579   }
580   BOOST_CHECK(reliability-&gt;m_ackQueue.empty());
581   BOOST_CHECK(expectedAcks.empty());
582 }
583 BOOST_AUTO_TEST_CASE(PiggybackAcksMtuNoSpace)
584 {
585   transport-&gt;setMtu(MIN_MTU);
586   for (lp::Sequence i = 1000; i &lt; 1100; i++) {
587     reliability-&gt;m_ackQueue.push(i);
588   }
589   lp::Packet pkt = makeFrag(1, 34);
590   linkService-&gt;sendLpPackets({pkt});
591   BOOST_REQUIRE_EQUAL(transport-&gt;sentPackets.size(), 1);
592   lp::Packet sentPkt(transport-&gt;sentPackets.back());
593   BOOST_CHECK_EQUAL(getPktNum(sentPkt), 1);
594   BOOST_CHECK(!sentPkt.has&lt;lp::AckField&gt;());
595   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 100);
596 }
597 BOOST_AUTO_TEST_CASE(StartIdleAckTimer)
598 {
599   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
600   lp::Packet pkt1 = makeFrag(1, 100);
601   pkt1.add&lt;lp::SequenceField&gt;(1);
602   pkt1.add&lt;lp::TxSequenceField&gt;(12);
603   BOOST_CHECK(reliability-&gt;processIncomingPacket({pkt1}));
604   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
605   advanceClocks(1_ms, 1);
606   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
607   lp::Packet pkt2 = makeFrag(2, 100);
608   pkt2.add&lt;lp::SequenceField&gt;(2);
609   pkt2.add&lt;lp::TxSequenceField&gt;(13);
610   BOOST_CHECK(reliability-&gt;processIncomingPacket({pkt2}));
611   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
612   advanceClocks(1_ms, 4);
613   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
614   lp::Packet pkt3 = makeFrag(3, 100);
615   pkt3.add&lt;lp::SequenceField&gt;(3);
616   pkt3.add&lt;lp::TxSequenceField&gt;(15);
617   BOOST_CHECK(reliability-&gt;processIncomingPacket({pkt3}));
618   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
619   advanceClocks(1_ms, 4);
620   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
621   advanceClocks(1_ms, 1);
622   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
623 }
624 BOOST_AUTO_TEST_CASE(IdleAckTimer)
625 {
626   std::unordered_set&lt;lp::Sequence&gt; expectedAcks;
627   for (lp::Sequence i = 1000; i &lt; 1500; i++) {
628     reliability-&gt;m_ackQueue.push(i);
629     expectedAcks.insert(i);
630   }
631   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
632   reliability-&gt;startIdleAckTimer();
633   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
634   advanceClocks(1_ms, 4);
635   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
636   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 500);
637   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.front(), 1000);
638   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.back(), 1499);
639   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 0);
640   advanceClocks(1_ms, 1);
641   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
642   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
643   BOOST_REQUIRE_EQUAL(transport-&gt;sentPackets.size(), 1);
644   lp::Packet sentPkt(transport-&gt;sentPackets.back());
645   BOOST_CHECK(!sentPkt.has&lt;lp::TxSequenceField&gt;());
646   for (lp::Sequence ack : sentPkt.list&lt;lp::AckField&gt;()) {
647     BOOST_CHECK_EQUAL(expectedAcks.erase(ack), 1);
648   }
649   BOOST_CHECK(expectedAcks.empty());
650 }
651 BOOST_AUTO_TEST_CASE(IdleAckTimerMtu)
652 {
653   transport-&gt;setMtu(1500);
654   std::unordered_set&lt;lp::Sequence&gt; expectedAcks;
655   for (lp::Sequence i = 1000; i &lt; 1500; i++) {
656     reliability-&gt;m_ackQueue.push(i);
657     expectedAcks.insert(i);
658   }
659   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
660   reliability-&gt;startIdleAckTimer();
661   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
662   advanceClocks(1_ms, 4);
663   BOOST_CHECK(reliability-&gt;m_idleAckTimer);
664   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 500);
665   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.front(), 1000);
666   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.back(), 1499);
667   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 0);
668   advanceClocks(1_ms, 1);
669   BOOST_CHECK(!reliability-&gt;m_idleAckTimer);
670   BOOST_CHECK_EQUAL(reliability-&gt;m_ackQueue.size(), 0);
671   BOOST_REQUIRE_EQUAL(transport-&gt;sentPackets.size(), 5);
672   for (size_t i = 0; i &lt; 5; i++) {
673     lp::Packet sentPkt(transport-&gt;sentPackets[i]);
674     BOOST_CHECK(!sentPkt.has&lt;lp::TxSequenceField&gt;());
675     BOOST_CHECK_EQUAL(sentPkt.count&lt;lp::AckField&gt;(), i == 4 ? 4 : 124);
676     for (lp::Sequence ack : sentPkt.list&lt;lp::AckField&gt;()) {
677       BOOST_CHECK_EQUAL(expectedAcks.erase(ack), 1);
678     }
679   }
680   BOOST_CHECK(expectedAcks.empty());
681 }
682 BOOST_AUTO_TEST_CASE(TrackRecentReceivedLpPackets)
683 {
684   lp::Packet pkt1 = makeFrag(1, 100);
685   pkt1.add&lt;lp::SequenceField&gt;(7);
686   pkt1.add&lt;lp::TxSequenceField&gt;(12);
687   BOOST_CHECK(reliability-&gt;processIncomingPacket({pkt1}));
688   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqsQueue.size(), 1);
689   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqsQueue.front(), 7);
690   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 1);
691   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(7), 1);
692   advanceClocks(500_ms, 1);
693   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 1);
694   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(7), 1);
695   lp::Packet pkt2 = makeFrag(1, 100);
696   pkt2.add&lt;lp::SequenceField&gt;(23);
697   pkt2.add&lt;lp::TxSequenceField&gt;(13);
698   BOOST_CHECK(reliability-&gt;processIncomingPacket({pkt2}));
699   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqsQueue.size(), 2);
700   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqsQueue.front(), 7);
701   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 2);
702   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(7), 1);
703   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(23), 1);
704   advanceClocks(750_ms, 1);
705   lp::Packet pkt3 = makeFrag(1, 100);
706   pkt3.add&lt;lp::SequenceField&gt;(24);
707   pkt3.add&lt;lp::TxSequenceField&gt;(14);
708   BOOST_CHECK(reliability-&gt;processIncomingPacket({pkt3}));
709   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqsQueue.size(), 2);
710   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqsQueue.front(), 23);
711   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 2);
712   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(23), 1);
713   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(24), 1);
714   advanceClocks(500_ms, 1);
715   lp::Packet pkt4 = makeFrag(1, 100);
716   pkt4.add&lt;lp::SequenceField&gt;(25);
717   pkt4.add&lt;lp::TxSequenceField&gt;(15);
718   BOOST_CHECK(reliability-&gt;processIncomingPacket({pkt4}));
719   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqsQueue.size(), 2);
720   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqsQueue.front(), 24);
721   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 2);
722   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(24), 1);
723   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(25), 1);
724 }
725 BOOST_AUTO_TEST_CASE(DropDuplicateReceivedSequence)
726 {
727   Interest interest("/test/prefix");
728   lp::Packet pkt1;
729   pkt1.add&lt;lp::FragmentField&gt;({interest.wireEncode().begin(), interest.wireEncode().end()});
730   pkt1.add&lt;lp::SequenceField&gt;(7);
731   pkt1.add&lt;lp::TxSequenceField&gt;(12);
732   BOOST_CHECK(reliability-&gt;processIncomingPacket({pkt1}));
733   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 1);
734   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(7), 1);
735   lp::Packet pkt2;
736   pkt2.add&lt;lp::FragmentField&gt;({interest.wireEncode().begin(), interest.wireEncode().end()});
737   pkt2.add&lt;lp::SequenceField&gt;(7);
738   pkt2.add&lt;lp::TxSequenceField&gt;(13);
739   BOOST_CHECK(!reliability-&gt;processIncomingPacket({pkt2}));
740   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.size(), 1);
741   BOOST_CHECK_EQUAL(reliability-&gt;m_recentRecvSeqs.count(7), 1);
742 }
743 BOOST_AUTO_TEST_CASE(DropDuplicateAckForRetx)
744 {
745   lp::Packet pkt1 = makeFrag(1024, 50);
746   linkService-&gt;sendLpPackets({pkt1});
747   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 1);
748   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 1);
749   lp::Sequence firstTxSeq = reliability-&gt;m_firstUnackedFrag-&gt;first;
750   advanceClocks(1250_ms, 1);
751   BOOST_CHECK_EQUAL(transport-&gt;sentPackets.size(), 2);
752   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 1);
753   lp::Packet ackPkt1;
754   ackPkt1.add&lt;lp::AckField&gt;(firstTxSeq);
755   reliability-&gt;processIncomingPacket(ackPkt1);
756   BOOST_REQUIRE_EQUAL(reliability-&gt;m_unackedFrags.size(), 1); 
757   lp::Packet ackPkt2;
758   ackPkt2.add&lt;lp::AckField&gt;(reliability-&gt;m_firstUnackedFrag-&gt;first);
759   reliability-&gt;processIncomingPacket(ackPkt2);
760   BOOST_CHECK_EQUAL(reliability-&gt;m_unackedFrags.size(), 0);
761 }
762 BOOST_AUTO_TEST_SUITE_END() BOOST_AUTO_TEST_SUITE_END() 
} } } </pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
