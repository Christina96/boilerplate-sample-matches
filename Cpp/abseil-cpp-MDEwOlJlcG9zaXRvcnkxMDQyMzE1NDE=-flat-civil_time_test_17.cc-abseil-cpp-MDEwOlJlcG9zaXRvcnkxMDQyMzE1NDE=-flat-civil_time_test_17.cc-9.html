
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 30, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-civil_time_test_17.cc</h3>
            <pre><code>1  #include &quot;absl/time/internal/cctz/include/cctz/civil_time.h&quot;
2  #include &lt;iomanip&gt;
3  #include &lt;limits&gt;
4  #include &lt;sstream&gt;
5  #include &lt;string&gt;
6  #include &lt;type_traits&gt;
7  #include &quot;gtest/gtest.h&quot;
8  #include &quot;absl/base/config.h&quot;
9  namespace absl {
10  ABSL_NAMESPACE_BEGIN
11  namespace time_internal {
12  namespace cctz {
13  namespace {
14  template &lt;typename T&gt;
15  std::string Format(const T&amp; t) {
16    std::stringstream ss;
17    ss &lt;&lt; t;
18    return ss.str();
19  }
20  }  
21  #if __cpp_constexpr &gt;= 201304 || (defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1910)
22  TEST(CivilTime, Normal) {
23    constexpr civil_second css(2016, 1, 28, 17, 14, 12);
24    static_assert(css.second() == 12, &quot;Normal.second&quot;);
25    constexpr civil_minute cmm(2016, 1, 28, 17, 14);
26    static_assert(cmm.minute() == 14, &quot;Normal.minute&quot;);
27    constexpr civil_hour chh(2016, 1, 28, 17);
28    static_assert(chh.hour() == 17, &quot;Normal.hour&quot;);
29    constexpr civil_day cd(2016, 1, 28);
30    static_assert(cd.day() == 28, &quot;Normal.day&quot;);
31    constexpr civil_month cm(2016, 1);
32    static_assert(cm.month() == 1, &quot;Normal.month&quot;);
33    constexpr civil_year cy(2016);
34    static_assert(cy.year() == 2016, &quot;Normal.year&quot;);
35  }
36  TEST(CivilTime, Conversion) {
37    constexpr civil_year cy(2016);
38    static_assert(cy.year() == 2016, &quot;Conversion.year&quot;);
39    constexpr civil_month cm(cy);
40    static_assert(cm.month() == 1, &quot;Conversion.month&quot;);
41    constexpr civil_day cd(cm);
42    static_assert(cd.day() == 1, &quot;Conversion.day&quot;);
43    constexpr civil_hour chh(cd);
44    static_assert(chh.hour() == 0, &quot;Conversion.hour&quot;);
45    constexpr civil_minute cmm(chh);
46    static_assert(cmm.minute() == 0, &quot;Conversion.minute&quot;);
47    constexpr civil_second css(cmm);
48    static_assert(css.second() == 0, &quot;Conversion.second&quot;);
49  }
50  TEST(CivilTime, Normalized) {
51    constexpr civil_second cs(2016, 1, 28, 17, 14, 12);
52    static_assert(cs.year() == 2016, &quot;Normalized.year&quot;);
53    static_assert(cs.month() == 1, &quot;Normalized.month&quot;);
54    static_assert(cs.day() == 28, &quot;Normalized.day&quot;);
55    static_assert(cs.hour() == 17, &quot;Normalized.hour&quot;);
56    static_assert(cs.minute() == 14, &quot;Normalized.minute&quot;);
57    static_assert(cs.second() == 12, &quot;Normalized.second&quot;);
58  }
59  TEST(CivilTime, SecondOverflow) {
60    constexpr civil_second cs(2016, 1, 28, 17, 14, 121);
61    static_assert(cs.year() == 2016, &quot;SecondOverflow.year&quot;);
62    static_assert(cs.month() == 1, &quot;SecondOverflow.month&quot;);
63    static_assert(cs.day() == 28, &quot;SecondOverflow.day&quot;);
64    static_assert(cs.hour() == 17, &quot;SecondOverflow.hour&quot;);
65    static_assert(cs.minute() == 16, &quot;SecondOverflow.minute&quot;);
66    static_assert(cs.second() == 1, &quot;SecondOverflow.second&quot;);
67  }
68  TEST(CivilTime, SecondUnderflow) {
69    constexpr civil_second cs(2016, 1, 28, 17, 14, -121);
70    static_assert(cs.year() == 2016, &quot;SecondUnderflow.year&quot;);
71    static_assert(cs.month() == 1, &quot;SecondUnderflow.month&quot;);
72    static_assert(cs.day() == 28, &quot;SecondUnderflow.day&quot;);
73    static_assert(cs.hour() == 17, &quot;SecondUnderflow.hour&quot;);
74    static_assert(cs.minute() == 11, &quot;SecondUnderflow.minute&quot;);
75    static_assert(cs.second() == 59, &quot;SecondUnderflow.second&quot;);
76  }
77  TEST(CivilTime, MinuteOverflow) {
78    constexpr civil_second cs(2016, 1, 28, 17, 121, 12);
79    static_assert(cs.year() == 2016, &quot;MinuteOverflow.year&quot;);
80    static_assert(cs.month() == 1, &quot;MinuteOverflow.month&quot;);
81    static_assert(cs.day() == 28, &quot;MinuteOverflow.day&quot;);
82    static_assert(cs.hour() == 19, &quot;MinuteOverflow.hour&quot;);
83    static_assert(cs.minute() == 1, &quot;MinuteOverflow.minute&quot;);
84    static_assert(cs.second() == 12, &quot;MinuteOverflow.second&quot;);
85  }
86  TEST(CivilTime, MinuteUnderflow) {
87    constexpr civil_second cs(2016, 1, 28, 17, -121, 12);
88    static_assert(cs.year() == 2016, &quot;MinuteUnderflow.year&quot;);
89    static_assert(cs.month() == 1, &quot;MinuteUnderflow.month&quot;);
90    static_assert(cs.day() == 28, &quot;MinuteUnderflow.day&quot;);
91    static_assert(cs.hour() == 14, &quot;MinuteUnderflow.hour&quot;);
92    static_assert(cs.minute() == 59, &quot;MinuteUnderflow.minute&quot;);
93    static_assert(cs.second() == 12, &quot;MinuteUnderflow.second&quot;);
94  }
95  TEST(CivilTime, HourOverflow) {
96    constexpr civil_second cs(2016, 1, 28, 49, 14, 12);
97    static_assert(cs.year() == 2016, &quot;HourOverflow.year&quot;);
98    static_assert(cs.month() == 1, &quot;HourOverflow.month&quot;);
99    static_assert(cs.day() == 30, &quot;HourOverflow.day&quot;);
100    static_assert(cs.hour() == 1, &quot;HourOverflow.hour&quot;);
101    static_assert(cs.minute() == 14, &quot;HourOverflow.minute&quot;);
102    static_assert(cs.second() == 12, &quot;HourOverflow.second&quot;);
103  }
104  TEST(CivilTime, HourUnderflow) {
105    constexpr civil_second cs(2016, 1, 28, -49, 14, 12);
106    static_assert(cs.year() == 2016, &quot;HourUnderflow.year&quot;);
107    static_assert(cs.month() == 1, &quot;HourUnderflow.month&quot;);
108    static_assert(cs.day() == 25, &quot;HourUnderflow.day&quot;);
109    static_assert(cs.hour() == 23, &quot;HourUnderflow.hour&quot;);
110    static_assert(cs.minute() == 14, &quot;HourUnderflow.minute&quot;);
111    static_assert(cs.second() == 12, &quot;HourUnderflow.second&quot;);
112  }
113  TEST(CivilTime, MonthOverflow) {
114    constexpr civil_second cs(2016, 25, 28, 17, 14, 12);
115    static_assert(cs.year() == 2018, &quot;MonthOverflow.year&quot;);
116    static_assert(cs.month() == 1, &quot;MonthOverflow.month&quot;);
117    static_assert(cs.day() == 28, &quot;MonthOverflow.day&quot;);
118    static_assert(cs.hour() == 17, &quot;MonthOverflow.hour&quot;);
119    static_assert(cs.minute() == 14, &quot;MonthOverflow.minute&quot;);
120    static_assert(cs.second() == 12, &quot;MonthOverflow.second&quot;);
121  }
122  TEST(CivilTime, MonthUnderflow) {
123    constexpr civil_second cs(2016, -25, 28, 17, 14, 12);
124    static_assert(cs.year() == 2013, &quot;MonthUnderflow.year&quot;);
125    static_assert(cs.month() == 11, &quot;MonthUnderflow.month&quot;);
126    static_assert(cs.day() == 28, &quot;MonthUnderflow.day&quot;);
127    static_assert(cs.hour() == 17, &quot;MonthUnderflow.hour&quot;);
128    static_assert(cs.minute() == 14, &quot;MonthUnderflow.minute&quot;);
129    static_assert(cs.second() == 12, &quot;MonthUnderflow.second&quot;);
130  }
131  TEST(CivilTime, C4Overflow) {
132    constexpr civil_second cs(2016, 1, 292195, 17, 14, 12);
133    static_assert(cs.year() == 2816, &quot;C4Overflow.year&quot;);
134    static_assert(cs.month() == 1, &quot;C4Overflow.month&quot;);
135    static_assert(cs.day() == 1, &quot;C4Overflow.day&quot;);
136    static_assert(cs.hour() == 17, &quot;C4Overflow.hour&quot;);
137    static_assert(cs.minute() == 14, &quot;C4Overflow.minute&quot;);
138    static_assert(cs.second() == 12, &quot;C4Overflow.second&quot;);
139  }
140  TEST(CivilTime, C4Underflow) {
141    constexpr civil_second cs(2016, 1, -292195, 17, 14, 12);
142    static_assert(cs.year() == 1215, &quot;C4Underflow.year&quot;);
143    static_assert(cs.month() == 12, &quot;C4Underflow.month&quot;);
144    static_assert(cs.day() == 30, &quot;C4Underflow.day&quot;);
145    static_assert(cs.hour() == 17, &quot;C4Underflow.hour&quot;);
146    static_assert(cs.minute() == 14, &quot;C4Underflow.minute&quot;);
147    static_assert(cs.second() == 12, &quot;C4Underflow.second&quot;);
148  }
149  TEST(CivilTime, MixedNormalization) {
150    constexpr civil_second cs(2016, -42, 122, 99, -147, 4949);
151    static_assert(cs.year() == 2012, &quot;MixedNormalization.year&quot;);
152    static_assert(cs.month() == 10, &quot;MixedNormalization.month&quot;);
153    static_assert(cs.day() == 4, &quot;MixedNormalization.day&quot;);
154    static_assert(cs.hour() == 1, &quot;MixedNormalization.hour&quot;);
155    static_assert(cs.minute() == 55, &quot;MixedNormalization.minute&quot;);
156    static_assert(cs.second() == 29, &quot;MixedNormalization.second&quot;);
157  }
158  TEST(CivilTime, Less) {
159    constexpr civil_second cs1(2016, 1, 28, 17, 14, 12);
160    constexpr civil_second cs2(2016, 1, 28, 17, 14, 13);
161    constexpr bool less = cs1 &lt; cs2;
162    static_assert(less, &quot;Less&quot;);
163  }
164  TEST(CivilTime, Addition) {
165    constexpr civil_second cs1(2016, 1, 28, 17, 14, 12);
166    constexpr civil_second cs2 = cs1 + 50;
167    static_assert(cs2.year() == 2016, &quot;Addition.year&quot;);
168    static_assert(cs2.month() == 1, &quot;Addition.month&quot;);
169    static_assert(cs2.day() == 28, &quot;Addition.day&quot;);
170    static_assert(cs2.hour() == 17, &quot;Addition.hour&quot;);
171    static_assert(cs2.minute() == 15, &quot;Addition.minute&quot;);
172    static_assert(cs2.second() == 2, &quot;Addition.second&quot;);
173  }
174  TEST(CivilTime, Subtraction) {
175    constexpr civil_second cs1(2016, 1, 28, 17, 14, 12);
176    constexpr civil_second cs2 = cs1 - 50;
177    static_assert(cs2.year() == 2016, &quot;Subtraction.year&quot;);
178    static_assert(cs2.month() == 1, &quot;Subtraction.month&quot;);
179    static_assert(cs2.day() == 28, &quot;Subtraction.day&quot;);
180    static_assert(cs2.hour() == 17, &quot;Subtraction.hour&quot;);
181    static_assert(cs2.minute() == 13, &quot;Subtraction.minute&quot;);
182    static_assert(cs2.second() == 22, &quot;Subtraction.second&quot;);
183  }
184  TEST(CivilTime, Difference) {
185    constexpr civil_day cd1(2016, 1, 28);
186    constexpr civil_day cd2(2015, 1, 28);
187    constexpr int diff = cd1 - cd2;
188    static_assert(diff == 365, &quot;Difference&quot;);
189  }
190  TEST(CivilTime, ConstructionWithHugeYear) {
191    constexpr civil_hour h(-9223372036854775807, 1, 1, -1);
192    static_assert(h.year() == -9223372036854775807 - 1,
193                  &quot;ConstructionWithHugeYear&quot;);
194    static_assert(h.month() == 12, &quot;ConstructionWithHugeYear&quot;);
195    static_assert(h.day() == 31, &quot;ConstructionWithHugeYear&quot;);
196    static_assert(h.hour() == 23, &quot;ConstructionWithHugeYear&quot;);
197  }
198  TEST(CivilTime, DifferenceWithHugeYear) {
199    {
200      constexpr civil_day d1(9223372036854775807, 1, 1);
201      constexpr civil_day d2(9223372036854775807, 12, 31);
202      static_assert(d2 - d1 == 364, &quot;DifferenceWithHugeYear&quot;);
203    }
204    {
205      constexpr civil_day d1(-9223372036854775807 - 1, 1, 1);
206      constexpr civil_day d2(-9223372036854775807 - 1, 12, 31);
207      static_assert(d2 - d1 == 365, &quot;DifferenceWithHugeYear&quot;);
208    }
209    {
210      constexpr civil_day d1(9223372036854775807, 1, 1);
211      constexpr civil_day d2(9198119301927009252, 6, 6);
212      static_assert(d1 - d2 == 9223372036854775807, &quot;DifferenceWithHugeYear&quot;);
213      static_assert((d2 - 1) - d1 == -9223372036854775807 - 1,
214                    &quot;DifferenceWithHugeYear&quot;);
215    }
216    {
217      constexpr civil_day d1(-9223372036854775807 - 1, 1, 1);
218      constexpr civil_day d2(-9198119301927009254, 7, 28);
219      static_assert(d2 - d1 == 9223372036854775807, &quot;DifferenceWithHugeYear&quot;);
220      static_assert(d1 - (d2 + 1) == -9223372036854775807 - 1,
221                    &quot;DifferenceWithHugeYear&quot;);
222    }
223    {
224      constexpr civil_day d1(-12626367463883278, 9, 3);
225      constexpr civil_day d2(12626367463883277, 3, 28);
226      static_assert(d2 - d1 == 9223372036854775807, &quot;DifferenceWithHugeYear&quot;);
227      static_assert(d1 - (d2 + 1) == -9223372036854775807 - 1,
228                    &quot;DifferenceWithHugeYear&quot;);
229    }
230  }
231  TEST(CivilTime, DifferenceNoIntermediateOverflow) {
232    {
233      constexpr civil_second s1(-292277022657, 1, 27, 8, 29 - 1, 52);
234      constexpr civil_second s2(1970, 1, 1, 0, 0 - 1, 0);
235      static_assert(s1 - s2 == -9223372036854775807 - 1,
236                    &quot;DifferenceNoIntermediateOverflow&quot;);
237    }
238    {
239      constexpr civil_second s1(292277026596, 12, 4, 15, 30, 7 - 7);
240      constexpr civil_second s2(1970, 1, 1, 0, 0, 0 - 7);
241      static_assert(s1 - s2 == 9223372036854775807,
242                    &quot;DifferenceNoIntermediateOverflow&quot;);
243    }
244  }
245  TEST(CivilTime, WeekDay) {
246    constexpr civil_day cd(2016, 1, 28);
247    constexpr weekday wd = get_weekday(cd);
248    static_assert(wd == weekday::thursday, &quot;Weekday&quot;);
249  }
250  TEST(CivilTime, NextWeekDay) {
251    constexpr civil_day cd(2016, 1, 28);
252    constexpr civil_day next = next_weekday(cd, weekday::thursday);
253    static_assert(next.year() == 2016, &quot;NextWeekDay.year&quot;);
254    static_assert(next.month() == 2, &quot;NextWeekDay.month&quot;);
255    static_assert(next.day() == 4, &quot;NextWeekDay.day&quot;);
256  }
257  TEST(CivilTime, PrevWeekDay) {
258    constexpr civil_day cd(2016, 1, 28);
259    constexpr civil_day prev = prev_weekday(cd, weekday::thursday);
260    static_assert(prev.year() == 2016, &quot;PrevWeekDay.year&quot;);
261    static_assert(prev.month() == 1, &quot;PrevWeekDay.month&quot;);
262    static_assert(prev.day() == 21, &quot;PrevWeekDay.day&quot;);
263  }
264  TEST(CivilTime, YearDay) {
265    constexpr civil_day cd(2016, 1, 28);
266    constexpr int yd = get_yearday(cd);
267    static_assert(yd == 28, &quot;YearDay&quot;);
268  }
269  #endif  
270  TEST(CivilTime, DefaultConstruction) {
271    civil_second ss;
272    EXPECT_EQ(&quot;1970-01-01T00:00:00&quot;, Format(ss));
273    civil_minute mm;
274    EXPECT_EQ(&quot;1970-01-01T00:00&quot;, Format(mm));
275    civil_hour hh;
276    EXPECT_EQ(&quot;1970-01-01T00&quot;, Format(hh));
277    civil_day d;
278    EXPECT_EQ(&quot;1970-01-01&quot;, Format(d));
279    civil_month m;
280    EXPECT_EQ(&quot;1970-01&quot;, Format(m));
281    civil_year y;
282    EXPECT_EQ(&quot;1970&quot;, Format(y));
283  }
284  TEST(CivilTime, StructMember) {
285    struct S {
286      civil_day day;
287    };
288    S s = {};
289    EXPECT_EQ(civil_day{}, s.day);
290  }
291  TEST(CivilTime, FieldsConstruction) {
292    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(civil_second(2015, 1, 2, 3, 4, 5)));
293    EXPECT_EQ(&quot;2015-01-02T03:04:00&quot;, Format(civil_second(2015, 1, 2, 3, 4)));
294    EXPECT_EQ(&quot;2015-01-02T03:00:00&quot;, Format(civil_second(2015, 1, 2, 3)));
295    EXPECT_EQ(&quot;2015-01-02T00:00:00&quot;, Format(civil_second(2015, 1, 2)));
296    EXPECT_EQ(&quot;2015-01-01T00:00:00&quot;, Format(civil_second(2015, 1)));
297    EXPECT_EQ(&quot;2015-01-01T00:00:00&quot;, Format(civil_second(2015)));
298    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(civil_minute(2015, 1, 2, 3, 4, 5)));
299    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(civil_minute(2015, 1, 2, 3, 4)));
300    EXPECT_EQ(&quot;2015-01-02T03:00&quot;, Format(civil_minute(2015, 1, 2, 3)));
301    EXPECT_EQ(&quot;2015-01-02T00:00&quot;, Format(civil_minute(2015, 1, 2)));
302    EXPECT_EQ(&quot;2015-01-01T00:00&quot;, Format(civil_minute(2015, 1)));
303    EXPECT_EQ(&quot;2015-01-01T00:00&quot;, Format(civil_minute(2015)));
304    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(civil_hour(2015, 1, 2, 3, 4, 5)));
305    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(civil_hour(2015, 1, 2, 3, 4)));
306    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(civil_hour(2015, 1, 2, 3)));
307    EXPECT_EQ(&quot;2015-01-02T00&quot;, Format(civil_hour(2015, 1, 2)));
308    EXPECT_EQ(&quot;2015-01-01T00&quot;, Format(civil_hour(2015, 1)));
309    EXPECT_EQ(&quot;2015-01-01T00&quot;, Format(civil_hour(2015)));
310    EXPECT_EQ(&quot;2015-01-02&quot;, Format(civil_day(2015, 1, 2, 3, 4, 5)));
311    EXPECT_EQ(&quot;2015-01-02&quot;, Format(civil_day(2015, 1, 2, 3, 4)));
312    EXPECT_EQ(&quot;2015-01-02&quot;, Format(civil_day(2015, 1, 2, 3)));
313    EXPECT_EQ(&quot;2015-01-02&quot;, Format(civil_day(2015, 1, 2)));
314    EXPECT_EQ(&quot;2015-01-01&quot;, Format(civil_day(2015, 1)));
315    EXPECT_EQ(&quot;2015-01-01&quot;, Format(civil_day(2015)));
316    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1, 2, 3, 4, 5)));
317    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1, 2, 3, 4)));
318    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1, 2, 3)));
319    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1, 2)));
320    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1)));
321    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015)));
322    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1, 2, 3, 4, 5)));
323    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1, 2, 3, 4)));
324    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1, 2, 3)));
325    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1, 2)));
326    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1)));
327    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015)));
328  }
329  TEST(CivilTime, FieldsConstructionLimits) {
330    const int kIntMax = std::numeric_limits&lt;int&gt;::max();
331    EXPECT_EQ(&quot;2038-01-19T03:14:07&quot;,
332              Format(civil_second(1970, 1, 1, 0, 0, kIntMax)));
333    EXPECT_EQ(&quot;6121-02-11T05:21:07&quot;,
334              Format(civil_second(1970, 1, 1, 0, kIntMax, kIntMax)));
335    EXPECT_EQ(&quot;251104-11-20T12:21:07&quot;,
336              Format(civil_second(1970, 1, 1, kIntMax, kIntMax, kIntMax)));
337    EXPECT_EQ(&quot;6130715-05-30T12:21:07&quot;,
338              Format(civil_second(1970, 1, kIntMax, kIntMax, kIntMax, kIntMax)));
339    EXPECT_EQ(
340        &quot;185087685-11-26T12:21:07&quot;,
341        Format(civil_second(1970, kIntMax, kIntMax, kIntMax, kIntMax, kIntMax)));
342    const int kIntMin = std::numeric_limits&lt;int&gt;::min();
343    EXPECT_EQ(&quot;1901-12-13T20:45:52&quot;,
344              Format(civil_second(1970, 1, 1, 0, 0, kIntMin)));
345    EXPECT_EQ(&quot;-2182-11-20T18:37:52&quot;,
346              Format(civil_second(1970, 1, 1, 0, kIntMin, kIntMin)));
347    EXPECT_EQ(&quot;-247165-02-11T10:37:52&quot;,
348              Format(civil_second(1970, 1, 1, kIntMin, kIntMin, kIntMin)));
349    EXPECT_EQ(&quot;-6126776-08-01T10:37:52&quot;,
350              Format(civil_second(1970, 1, kIntMin, kIntMin, kIntMin, kIntMin)));
351    EXPECT_EQ(
352        &quot;-185083747-10-31T10:37:52&quot;,
353        Format(civil_second(1970, kIntMin, kIntMin, kIntMin, kIntMin, kIntMin)));
354  }
355  TEST(CivilTime, ImplicitCrossAlignment) {
356    civil_year year(2015);
357    civil_month month = year;
358    civil_day day = month;
359    civil_hour hour = day;
360    civil_minute minute = hour;
361    civil_second second = minute;
362    second = year;
363    EXPECT_EQ(second, year);
364    second = month;
365    EXPECT_EQ(second, month);
366    second = day;
367    EXPECT_EQ(second, day);
368    second = hour;
369    EXPECT_EQ(second, hour);
370    second = minute;
371    EXPECT_EQ(second, minute);
372    minute = year;
373    EXPECT_EQ(minute, year);
374    minute = month;
375    EXPECT_EQ(minute, month);
376    minute = day;
377    EXPECT_EQ(minute, day);
378    minute = hour;
379    EXPECT_EQ(minute, hour);
380    hour = year;
381    EXPECT_EQ(hour, year);
382    hour = month;
383    EXPECT_EQ(hour, month);
384    hour = day;
385    EXPECT_EQ(hour, day);
386    day = year;
387    EXPECT_EQ(day, year);
388    day = month;
389    EXPECT_EQ(day, month);
390    month = year;
391    EXPECT_EQ(month, year);
392    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_minute&gt;::value));
393    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_hour&gt;::value));
394    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_day&gt;::value));
395    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_month&gt;::value));
396    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_year&gt;::value));
397    EXPECT_FALSE((std::is_convertible&lt;civil_minute, civil_hour&gt;::value));
398    EXPECT_FALSE((std::is_convertible&lt;civil_minute, civil_day&gt;::value));
399    EXPECT_FALSE((std::is_convertible&lt;civil_minute, civil_month&gt;::value));
400    EXPECT_FALSE((std::is_convertible&lt;civil_minute, civil_year&gt;::value));
401    EXPECT_FALSE((std::is_convertible&lt;civil_hour, civil_day&gt;::value));
402    EXPECT_FALSE((std::is_convertible&lt;civil_hour, civil_month&gt;::value));
403    EXPECT_FALSE((std::is_convertible&lt;civil_hour, civil_year&gt;::value));
404    EXPECT_FALSE((std::is_convertible&lt;civil_day, civil_month&gt;::value));
405    EXPECT_FALSE((std::is_convertible&lt;civil_day, civil_year&gt;::value));
406    EXPECT_FALSE((std::is_convertible&lt;civil_month, civil_year&gt;::value));
407  }
408  TEST(CivilTime, ExplicitCrossAlignment) {
409    civil_second second(2015, 1, 2, 3, 4, 5);
410    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(second));
411    civil_minute minute(second);
412    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(minute));
413    civil_hour hour(minute);
414    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(hour));
415    civil_day day(hour);
416    EXPECT_EQ(&quot;2015-01-02&quot;, Format(day));
417    civil_month month(day);
418    EXPECT_EQ(&quot;2015-01&quot;, Format(month));
419    civil_year year(month);
420    EXPECT_EQ(&quot;2015&quot;, Format(year));
421    month = civil_month(year);
422    EXPECT_EQ(&quot;2015-01&quot;, Format(month));
423    day = civil_day(month);
424    EXPECT_EQ(&quot;2015-01-01&quot;, Format(day));
425    hour = civil_hour(day);
426    EXPECT_EQ(&quot;2015-01-01T00&quot;, Format(hour));
427    minute = civil_minute(hour);
428    EXPECT_EQ(&quot;2015-01-01T00:00&quot;, Format(minute));
429    second = civil_second(minute);
430    EXPECT_EQ(&quot;2015-01-01T00:00:00&quot;, Format(second));
431  }
432  template &lt;typename T1, typename T2&gt;
433  struct HasDifference {
434    template &lt;typename U1, typename U2&gt;
435    static std::false_type test(...);
436    template &lt;typename U1, typename U2&gt;
437    static std::true_type test(decltype(std::declval&lt;U1&gt;() - std::declval&lt;U2&gt;()));
438    static constexpr bool value = decltype(test&lt;T1, T2&gt;(0))::value;
439  };
440  TEST(CivilTime, DisallowCrossAlignedDifference) {
441    static_assert(HasDifference&lt;civil_second, civil_second&gt;::value, &quot;&quot;);
442    static_assert(HasDifference&lt;civil_minute, civil_minute&gt;::value, &quot;&quot;);
443    static_assert(HasDifference&lt;civil_hour, civil_hour&gt;::value, &quot;&quot;);
444    static_assert(HasDifference&lt;civil_day, civil_day&gt;::value, &quot;&quot;);
445    static_assert(HasDifference&lt;civil_month, civil_month&gt;::value, &quot;&quot;);
446    static_assert(HasDifference&lt;civil_year, civil_year&gt;::value, &quot;&quot;);
447    static_assert(!HasDifference&lt;civil_second, civil_minute&gt;::value, &quot;&quot;);
448    static_assert(!HasDifference&lt;civil_second, civil_hour&gt;::value, &quot;&quot;);
449    static_assert(!HasDifference&lt;civil_second, civil_day&gt;::value, &quot;&quot;);
450    static_assert(!HasDifference&lt;civil_second, civil_month&gt;::value, &quot;&quot;);
451    static_assert(!HasDifference&lt;civil_second, civil_year&gt;::value, &quot;&quot;);
452    static_assert(!HasDifference&lt;civil_minute, civil_hour&gt;::value, &quot;&quot;);
453    static_assert(!HasDifference&lt;civil_minute, civil_day&gt;::value, &quot;&quot;);
454    static_assert(!HasDifference&lt;civil_minute, civil_month&gt;::value, &quot;&quot;);
455    static_assert(!HasDifference&lt;civil_minute, civil_year&gt;::value, &quot;&quot;);
456    static_assert(!HasDifference&lt;civil_hour, civil_day&gt;::value, &quot;&quot;);
457    static_assert(!HasDifference&lt;civil_hour, civil_month&gt;::value, &quot;&quot;);
458    static_assert(!HasDifference&lt;civil_hour, civil_year&gt;::value, &quot;&quot;);
459    static_assert(!HasDifference&lt;civil_day, civil_month&gt;::value, &quot;&quot;);
460    static_assert(!HasDifference&lt;civil_day, civil_year&gt;::value, &quot;&quot;);
461    static_assert(!HasDifference&lt;civil_month, civil_year&gt;::value, &quot;&quot;);
462  }
463  TEST(CivilTime, ValueSemantics) {
464    const civil_hour a(2015, 1, 2, 3);
465    const civil_hour b = a;
466    const civil_hour c(b);
467    civil_hour d;
468    d = c;
469    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(d));
470  }
471  TEST(CivilTime, Relational) {
472    const civil_year year(2014);
473    const civil_month month(year);
474    EXPECT_EQ(year, month);
475  #define TEST_RELATIONAL(OLDER, YOUNGER) \
476    do {                                  \
477      EXPECT_FALSE(OLDER &lt; OLDER);        \
478      EXPECT_FALSE(OLDER &gt; OLDER);        \
479      EXPECT_TRUE(OLDER &gt;= OLDER);        \
480      EXPECT_TRUE(OLDER &lt;= OLDER);        \
481      EXPECT_FALSE(YOUNGER &lt; YOUNGER);    \
482      EXPECT_FALSE(YOUNGER &gt; YOUNGER);    \
483      EXPECT_TRUE(YOUNGER &gt;= YOUNGER);    \
484      EXPECT_TRUE(YOUNGER &lt;= YOUNGER);    \
485      EXPECT_EQ(OLDER, OLDER);            \
486      EXPECT_NE(OLDER, YOUNGER);          \
487      EXPECT_LT(OLDER, YOUNGER);          \
488      EXPECT_LE(OLDER, YOUNGER);          \
489      EXPECT_GT(YOUNGER, OLDER);          \
490      EXPECT_GE(YOUNGER, OLDER);          \
491    } while (0)
492    TEST_RELATIONAL(civil_second(2014, 1, 1, 0, 0, 0),
493                    civil_second(2015, 1, 1, 0, 0, 0));
494    TEST_RELATIONAL(civil_second(2014, 1, 1, 0, 0, 0),
495                    civil_second(2014, 2, 1, 0, 0, 0));
496    TEST_RELATIONAL(civil_second(2014, 1, 1, 0, 0, 0),
497                    civil_second(2014, 1, 2, 0, 0, 0));
498    TEST_RELATIONAL(civil_second(2014, 1, 1, 0, 0, 0),
499                    civil_second(2014, 1, 1, 1, 0, 0));
500    TEST_RELATIONAL(civil_second(2014, 1, 1, 1, 0, 0),
501                    civil_second(2014, 1, 1, 1, 1, 0));
502    TEST_RELATIONAL(civil_second(2014, 1, 1, 1, 1, 0),
503                    civil_second(2014, 1, 1, 1, 1, 1));
504    TEST_RELATIONAL(civil_day(2014, 1, 1), civil_minute(2014, 1, 1, 1, 1));
505    TEST_RELATIONAL(civil_day(2014, 1, 1), civil_month(2014, 2));
506  #undef TEST_RELATIONAL
507  }
508  TEST(CivilTime, Arithmetic) {
509    civil_second second(2015, 1, 2, 3, 4, 5);
510    EXPECT_EQ(&quot;2015-01-02T03:04:06&quot;, Format(second += 1));
511    EXPECT_EQ(&quot;2015-01-02T03:04:07&quot;, Format(second + 1));
512    EXPECT_EQ(&quot;2015-01-02T03:04:08&quot;, Format(2 + second));
513    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(second - 1));
514    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(second -= 1));
515    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(second++));
516    EXPECT_EQ(&quot;2015-01-02T03:04:07&quot;, Format(++second));
517    EXPECT_EQ(&quot;2015-01-02T03:04:07&quot;, Format(second--));
518    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(--second));
519    civil_minute minute(2015, 1, 2, 3, 4);
520    EXPECT_EQ(&quot;2015-01-02T03:05&quot;, Format(minute += 1));
521    EXPECT_EQ(&quot;2015-01-02T03:06&quot;, Format(minute + 1));
522    EXPECT_EQ(&quot;2015-01-02T03:07&quot;, Format(2 + minute));
523    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(minute - 1));
524    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(minute -= 1));
525    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(minute++));
526    EXPECT_EQ(&quot;2015-01-02T03:06&quot;, Format(++minute));
527    EXPECT_EQ(&quot;2015-01-02T03:06&quot;, Format(minute--));
528    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(--minute));
529    civil_hour hour(2015, 1, 2, 3);
530    EXPECT_EQ(&quot;2015-01-02T04&quot;, Format(hour += 1));
531    EXPECT_EQ(&quot;2015-01-02T05&quot;, Format(hour + 1));
532    EXPECT_EQ(&quot;2015-01-02T06&quot;, Format(2 + hour));
533    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(hour - 1));
534    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(hour -= 1));
535    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(hour++));
536    EXPECT_EQ(&quot;2015-01-02T05&quot;, Format(++hour));
537    EXPECT_EQ(&quot;2015-01-02T05&quot;, Format(hour--));
538    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(--hour));
539    civil_day day(2015, 1, 2);
540    EXPECT_EQ(&quot;2015-01-03&quot;, Format(day += 1));
541    EXPECT_EQ(&quot;2015-01-04&quot;, Format(day + 1));
542    EXPECT_EQ(&quot;2015-01-05&quot;, Format(2 + day));
543    EXPECT_EQ(&quot;2015-01-02&quot;, Format(day - 1));
544    EXPECT_EQ(&quot;2015-01-02&quot;, Format(day -= 1));
545    EXPECT_EQ(&quot;2015-01-02&quot;, Format(day++));
546    EXPECT_EQ(&quot;2015-01-04&quot;, Format(++day));
547    EXPECT_EQ(&quot;2015-01-04&quot;, Format(day--));
548    EXPECT_EQ(&quot;2015-01-02&quot;, Format(--day));
549    civil_month month(2015, 1);
550    EXPECT_EQ(&quot;2015-02&quot;, Format(month += 1));
551    EXPECT_EQ(&quot;2015-03&quot;, Format(month + 1));
552    EXPECT_EQ(&quot;2015-04&quot;, Format(2 + month));
553    EXPECT_EQ(&quot;2015-01&quot;, Format(month - 1));
554    EXPECT_EQ(&quot;2015-01&quot;, Format(month -= 1));
555    EXPECT_EQ(&quot;2015-01&quot;, Format(month++));
556    EXPECT_EQ(&quot;2015-03&quot;, Format(++month));
557    EXPECT_EQ(&quot;2015-03&quot;, Format(month--));
558    EXPECT_EQ(&quot;2015-01&quot;, Format(--month));
559    civil_year year(2015);
560    EXPECT_EQ(&quot;2016&quot;, Format(year += 1));
561    EXPECT_EQ(&quot;2017&quot;, Format(year + 1));
562    EXPECT_EQ(&quot;2018&quot;, Format(2 + year));
563    EXPECT_EQ(&quot;2015&quot;, Format(year - 1));
564    EXPECT_EQ(&quot;2015&quot;, Format(year -= 1));
565    EXPECT_EQ(&quot;2015&quot;, Format(year++));
566    EXPECT_EQ(&quot;2017&quot;, Format(++year));
567    EXPECT_EQ(&quot;2017&quot;, Format(year--));
568    EXPECT_EQ(&quot;2015&quot;, Format(--year));
569  }
570  TEST(CivilTime, ArithmeticLimits) {
571    const int kIntMax = std::numeric_limits&lt;int&gt;::max();
572    const int kIntMin = std::numeric_limits&lt;int&gt;::min();
573    civil_second second(1970, 1, 1, 0, 0, 0);
574    second += kIntMax;
575    EXPECT_EQ(&quot;2038-01-19T03:14:07&quot;, Format(second));
576    second -= kIntMax;
577    EXPECT_EQ(&quot;1970-01-01T00:00:00&quot;, Format(second));
578    second += kIntMin;
579    EXPECT_EQ(&quot;1901-12-13T20:45:52&quot;, Format(second));
580    second -= kIntMin;
581    EXPECT_EQ(&quot;1970-01-01T00:00:00&quot;, Format(second));
582    civil_minute minute(1970, 1, 1, 0, 0);
583    minute += kIntMax;
584    EXPECT_EQ(&quot;6053-01-23T02:07&quot;, Format(minute));
585    minute -= kIntMax;
586    EXPECT_EQ(&quot;1970-01-01T00:00&quot;, Format(minute));
587    minute += kIntMin;
588    EXPECT_EQ(&quot;-2114-12-08T21:52&quot;, Format(minute));
589    minute -= kIntMin;
590    EXPECT_EQ(&quot;1970-01-01T00:00&quot;, Format(minute));
591    civil_hour hour(1970, 1, 1, 0);
592    hour += kIntMax;
593    EXPECT_EQ(&quot;246953-10-09T07&quot;, Format(hour));
594    hour -= kIntMax;
595    EXPECT_EQ(&quot;1970-01-01T00&quot;, Format(hour));
596    hour += kIntMin;
597    EXPECT_EQ(&quot;-243014-03-24T16&quot;, Format(hour));
598    hour -= kIntMin;
599    EXPECT_EQ(&quot;1970-01-01T00&quot;, Format(hour));
600    civil_day day(1970, 1, 1);
601    day += kIntMax;
602    EXPECT_EQ(&quot;5881580-07-11&quot;, Format(day));
603    day -= kIntMax;
604    EXPECT_EQ(&quot;1970-01-01&quot;, Format(day));
605    day += kIntMin;
606    EXPECT_EQ(&quot;-5877641-06-23&quot;, Format(day));
607    day -= kIntMin;
608    EXPECT_EQ(&quot;1970-01-01&quot;, Format(day));
609    civil_month month(1970, 1);
610    month += kIntMax;
611    EXPECT_EQ(&quot;178958940-08&quot;, Format(month));
612    month -= kIntMax;
613    EXPECT_EQ(&quot;1970-01&quot;, Format(month));
614    month += kIntMin;
615    EXPECT_EQ(&quot;-178955001-05&quot;, Format(month));
616    month -= kIntMin;
617    EXPECT_EQ(&quot;1970-01&quot;, Format(month));
618    civil_year year(0);
619    year += kIntMax;
620    EXPECT_EQ(&quot;2147483647&quot;, Format(year));
621    year -= kIntMax;
622    EXPECT_EQ(&quot;0&quot;, Format(year));
623    year += kIntMin;
624    EXPECT_EQ(&quot;-2147483648&quot;, Format(year));
625    year -= kIntMin;
626    EXPECT_EQ(&quot;0&quot;, Format(year));
627  }
628  TEST(CivilTime, ArithmeticDifference) {
629    civil_second second(2015, 1, 2, 3, 4, 5);
630    EXPECT_EQ(0, second - second);
631    EXPECT_EQ(10, (second + 10) - second);
632    EXPECT_EQ(-10, (second - 10) - second);
633    civil_minute minute(2015, 1, 2, 3, 4);
634    EXPECT_EQ(0, minute - minute);
635    EXPECT_EQ(10, (minute + 10) - minute);
636    EXPECT_EQ(-10, (minute - 10) - minute);
637    civil_hour hour(2015, 1, 2, 3);
638    EXPECT_EQ(0, hour - hour);
639    EXPECT_EQ(10, (hour + 10) - hour);
640    EXPECT_EQ(-10, (hour - 10) - hour);
641    civil_day day(2015, 1, 2);
642    EXPECT_EQ(0, day - day);
643    EXPECT_EQ(10, (day + 10) - day);
644    EXPECT_EQ(-10, (day - 10) - day);
645    civil_month month(2015, 1);
646    EXPECT_EQ(0, month - month);
647    EXPECT_EQ(10, (month + 10) - month);
648    EXPECT_EQ(-10, (month - 10) - month);
649    civil_year year(2015);
650    EXPECT_EQ(0, year - year);
651    EXPECT_EQ(10, (year + 10) - year);
652    EXPECT_EQ(-10, (year - 10) - year);
653  }
654  TEST(CivilTime, DifferenceLimits) {
655    const int kIntMax = std::numeric_limits&lt;int&gt;::max();
656    const int kIntMin = std::numeric_limits&lt;int&gt;::min();
657    const civil_day max_day(kIntMax, 12, 31);
658    EXPECT_EQ(1, max_day - (max_day - 1));
659    EXPECT_EQ(-1, (max_day - 1) - max_day);
660    const civil_day min_day(kIntMin, 1, 1);
661    EXPECT_EQ(1, (min_day + 1) - min_day);
662    EXPECT_EQ(-1, min_day - (min_day + 1));
663    const civil_day d1(1970, 1, 1);
664    const civil_day d2(5881580, 7, 11);
665    EXPECT_EQ(kIntMax, d2 - d1);
666    EXPECT_EQ(kIntMin, d1 - (d2 + 1));
667  }
668  TEST(CivilTime, Properties) {
669    civil_second ss(2015, 2, 3, 4, 5, 6);
670    EXPECT_EQ(2015, ss.year());
671    EXPECT_EQ(2, ss.month());
672    EXPECT_EQ(3, ss.day());
673    EXPECT_EQ(4, ss.hour());
674    EXPECT_EQ(5, ss.minute());
675    EXPECT_EQ(6, ss.second());
676    EXPECT_EQ(weekday::tuesday, get_weekday(ss));
677    EXPECT_EQ(34, get_yearday(ss));
678    civil_minute mm(2015, 2, 3, 4, 5, 6);
679    EXPECT_EQ(2015, mm.year());
680    EXPECT_EQ(2, mm.month());
681    EXPECT_EQ(3, mm.day());
682    EXPECT_EQ(4, mm.hour());
683    EXPECT_EQ(5, mm.minute());
684    EXPECT_EQ(0, mm.second());
685    EXPECT_EQ(weekday::tuesday, get_weekday(mm));
686    EXPECT_EQ(34, get_yearday(mm));
687    civil_hour hh(2015, 2, 3, 4, 5, 6);
688    EXPECT_EQ(2015, hh.year());
689    EXPECT_EQ(2, hh.month());
690    EXPECT_EQ(3, hh.day());
691    EXPECT_EQ(4, hh.hour());
692    EXPECT_EQ(0, hh.minute());
693    EXPECT_EQ(0, hh.second());
694    EXPECT_EQ(weekday::tuesday, get_weekday(hh));
695    EXPECT_EQ(34, get_yearday(hh));
696    civil_day d(2015, 2, 3, 4, 5, 6);
697    EXPECT_EQ(2015, d.year());
698    EXPECT_EQ(2, d.month());
699    EXPECT_EQ(3, d.day());
700    EXPECT_EQ(0, d.hour());
701    EXPECT_EQ(0, d.minute());
702    EXPECT_EQ(0, d.second());
703    EXPECT_EQ(weekday::tuesday, get_weekday(d));
704    EXPECT_EQ(34, get_yearday(d));
705    civil_month m(2015, 2, 3, 4, 5, 6);
706    EXPECT_EQ(2015, m.year());
707    EXPECT_EQ(2, m.month());
708    EXPECT_EQ(1, m.day());
709    EXPECT_EQ(0, m.hour());
710    EXPECT_EQ(0, m.minute());
711    EXPECT_EQ(0, m.second());
712    EXPECT_EQ(weekday::sunday, get_weekday(m));
713    EXPECT_EQ(32, get_yearday(m));
714    civil_year y(2015, 2, 3, 4, 5, 6);
715    EXPECT_EQ(2015, y.year());
716    EXPECT_EQ(1, y.month());
717    EXPECT_EQ(1, y.day());
718    EXPECT_EQ(0, y.hour());
719    EXPECT_EQ(0, y.minute());
720    EXPECT_EQ(0, y.second());
721    EXPECT_EQ(weekday::thursday, get_weekday(y));
722    EXPECT_EQ(1, get_yearday(y));
723  }
724  TEST(CivilTime, OutputStream) {
725    EXPECT_EQ(&quot;2016&quot;, Format(civil_year(2016)));
726    EXPECT_EQ(&quot;123&quot;, Format(civil_year(123)));
727    EXPECT_EQ(&quot;0&quot;, Format(civil_year(0)));
728    EXPECT_EQ(&quot;-1&quot;, Format(civil_year(-1)));
729    EXPECT_EQ(&quot;2016-02&quot;, Format(civil_month(2016, 2)));
730    EXPECT_EQ(&quot;2016-02-03&quot;, Format(civil_day(2016, 2, 3)));
731    EXPECT_EQ(&quot;2016-02-03T04&quot;, Format(civil_hour(2016, 2, 3, 4)));
732    EXPECT_EQ(&quot;2016-02-03T04:05&quot;, Format(civil_minute(2016, 2, 3, 4, 5)));
733    EXPECT_EQ(&quot;2016-02-03T04:05:06&quot;, Format(civil_second(2016, 2, 3, 4, 5, 6)));
734    EXPECT_EQ(&quot;Monday&quot;, Format(weekday::monday));
735    EXPECT_EQ(&quot;Tuesday&quot;, Format(weekday::tuesday));
736    EXPECT_EQ(&quot;Wednesday&quot;, Format(weekday::wednesday));
737    EXPECT_EQ(&quot;Thursday&quot;, Format(weekday::thursday));
738    EXPECT_EQ(&quot;Friday&quot;, Format(weekday::friday));
739    EXPECT_EQ(&quot;Saturday&quot;, Format(weekday::saturday));
740    EXPECT_EQ(&quot;Sunday&quot;, Format(weekday::sunday));
741  }
742  TEST(CivilTime, OutputStreamLeftFillWidth) {
743    civil_second cs(2016, 2, 3, 4, 5, 6);
744    {
745      std::stringstream ss;
746      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
747      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
748      ss &lt;&lt; std::setw(21) &lt;&lt; civil_year(cs);
749      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
750      EXPECT_EQ(&quot;X..2016.................X..&quot;, ss.str());
751    }
752    {
753      std::stringstream ss;
754      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
755      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
756      ss &lt;&lt; std::setw(21) &lt;&lt; civil_month(cs);
757      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
758      EXPECT_EQ(&quot;X..2016-02..............X..&quot;, ss.str());
759    }
760    {
761      std::stringstream ss;
762      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
763      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
764      ss &lt;&lt; std::setw(21) &lt;&lt; civil_day(cs);
765      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
766      EXPECT_EQ(&quot;X..2016-02-03...........X..&quot;, ss.str());
767    }
768    {
769      std::stringstream ss;
770      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
771      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
772      ss &lt;&lt; std::setw(21) &lt;&lt; civil_hour(cs);
773      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
774      EXPECT_EQ(&quot;X..2016-02-03T04........X..&quot;, ss.str());
775    }
776    {
777      std::stringstream ss;
778      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
779      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
780      ss &lt;&lt; std::setw(21) &lt;&lt; civil_minute(cs);
781      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
782      EXPECT_EQ(&quot;X..2016-02-03T04:05.....X..&quot;, ss.str());
783    }
784    {
785      std::stringstream ss;
786      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
787      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
788      ss &lt;&lt; std::setw(21) &lt;&lt; civil_second(cs);
789      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
790      EXPECT_EQ(&quot;X..2016-02-03T04:05:06..X..&quot;, ss.str());
791    }
792  }
793  TEST(CivilTime, NextPrevWeekday) {
794    const civil_day thursday(1970, 1, 1);
795    EXPECT_EQ(weekday::thursday, get_weekday(thursday));
796    civil_day d = next_weekday(thursday, weekday::thursday);
797    EXPECT_EQ(7, d - thursday) &lt;&lt; Format(d);
798    EXPECT_EQ(d - 14, prev_weekday(thursday, weekday::thursday));
799    d = next_weekday(thursday, weekday::friday);
800    EXPECT_EQ(1, d - thursday) &lt;&lt; Format(d);
801    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::friday));
802    d = next_weekday(thursday, weekday::saturday);
803    EXPECT_EQ(2, d - thursday) &lt;&lt; Format(d);
804    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::saturday));
805    d = next_weekday(thursday, weekday::sunday);
806    EXPECT_EQ(3, d - thursday) &lt;&lt; Format(d);
807    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::sunday));
808    d = next_weekday(thursday, weekday::monday);
<span onclick='openModal()' class='match'>809    EXPECT_EQ(4, d - thursday) &lt;&lt; Format(d);
810    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::monday));
811    d = next_weekday(thursday, weekday::tuesday);
</span>812    EXPECT_EQ(5, d - thursday) &lt;&lt; Format(d);
813    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::tuesday));
814    d = next_weekday(thursday, weekday::wednesday);
815    EXPECT_EQ(6, d - thursday) &lt;&lt; Format(d);
816    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::wednesday));
817  }
818  TEST(CivilTime, NormalizeWithHugeYear) {
819    civil_month c(9223372036854775807, 1);
820    EXPECT_EQ(&quot;9223372036854775807-01&quot;, Format(c));
821    c = c - 1;  
822    EXPECT_EQ(&quot;9223372036854775806-12&quot;, Format(c));
823    c = civil_month(-9223372036854775807 - 1, 1);
824    EXPECT_EQ(&quot;-9223372036854775808-01&quot;, Format(c));
825    c = c + 12;  
826    EXPECT_EQ(&quot;-9223372036854775807-01&quot;, Format(c));
827  }
828  TEST(CivilTime, LeapYears) {
829    const struct {
830      int year;
831      int days;
832      struct {
833        int month;
834        int day;
835      } leap_day;  
836    } kLeapYearTable[]{
837        {1900, 365, {3, 1}},  {1999, 365, {3, 1}},
838        {2000, 366, {2, 29}},  
839        {2001, 365, {3, 1}},  {2002, 365, {3, 1}},
840        {2003, 365, {3, 1}},  {2004, 366, {2, 29}},  
841        {2005, 365, {3, 1}},  {2006, 365, {3, 1}},
842        {2007, 365, {3, 1}},  {2008, 366, {2, 29}},  
843        {2009, 365, {3, 1}},  {2100, 365, {3, 1}},
844    };
845    for (const auto&amp; e : kLeapYearTable) {
846      const civil_day feb28(e.year, 2, 28);
847      const civil_day next_day = feb28 + 1;
848      EXPECT_EQ(e.leap_day.month, next_day.month());
849      EXPECT_EQ(e.leap_day.day, next_day.day());
850      const civil_year year(feb28);
851      const civil_year next_year = year + 1;
852      EXPECT_EQ(e.days, civil_day(next_year) - civil_day(year));
853    }
854  }
855  TEST(CivilTime, FirstThursdayInMonth) {
856    const civil_day nov1(2014, 11, 1);
857    const civil_day thursday = next_weekday(nov1 - 1, weekday::thursday);
858    EXPECT_EQ(&quot;2014-11-06&quot;, Format(thursday));
859    const civil_day thanksgiving = thursday + 7 * 3;
860    EXPECT_EQ(&quot;2014-11-27&quot;, Format(thanksgiving));
861  }
862  }  
863  }  
864  ABSL_NAMESPACE_END
865  }  
</code></pre>
        </div>
        <div class="column">
            <h3>abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-civil_time_test_17.cc</h3>
            <pre><code>1  #include &quot;absl/time/internal/cctz/include/cctz/civil_time.h&quot;
2  #include &lt;iomanip&gt;
3  #include &lt;limits&gt;
4  #include &lt;sstream&gt;
5  #include &lt;string&gt;
6  #include &lt;type_traits&gt;
7  #include &quot;gtest/gtest.h&quot;
8  #include &quot;absl/base/config.h&quot;
9  namespace absl {
10  ABSL_NAMESPACE_BEGIN
11  namespace time_internal {
12  namespace cctz {
13  namespace {
14  template &lt;typename T&gt;
15  std::string Format(const T&amp; t) {
16    std::stringstream ss;
17    ss &lt;&lt; t;
18    return ss.str();
19  }
20  }  
21  #if __cpp_constexpr &gt;= 201304 || (defined(_MSC_VER) &amp;&amp; _MSC_VER &gt;= 1910)
22  TEST(CivilTime, Normal) {
23    constexpr civil_second css(2016, 1, 28, 17, 14, 12);
24    static_assert(css.second() == 12, &quot;Normal.second&quot;);
25    constexpr civil_minute cmm(2016, 1, 28, 17, 14);
26    static_assert(cmm.minute() == 14, &quot;Normal.minute&quot;);
27    constexpr civil_hour chh(2016, 1, 28, 17);
28    static_assert(chh.hour() == 17, &quot;Normal.hour&quot;);
29    constexpr civil_day cd(2016, 1, 28);
30    static_assert(cd.day() == 28, &quot;Normal.day&quot;);
31    constexpr civil_month cm(2016, 1);
32    static_assert(cm.month() == 1, &quot;Normal.month&quot;);
33    constexpr civil_year cy(2016);
34    static_assert(cy.year() == 2016, &quot;Normal.year&quot;);
35  }
36  TEST(CivilTime, Conversion) {
37    constexpr civil_year cy(2016);
38    static_assert(cy.year() == 2016, &quot;Conversion.year&quot;);
39    constexpr civil_month cm(cy);
40    static_assert(cm.month() == 1, &quot;Conversion.month&quot;);
41    constexpr civil_day cd(cm);
42    static_assert(cd.day() == 1, &quot;Conversion.day&quot;);
43    constexpr civil_hour chh(cd);
44    static_assert(chh.hour() == 0, &quot;Conversion.hour&quot;);
45    constexpr civil_minute cmm(chh);
46    static_assert(cmm.minute() == 0, &quot;Conversion.minute&quot;);
47    constexpr civil_second css(cmm);
48    static_assert(css.second() == 0, &quot;Conversion.second&quot;);
49  }
50  TEST(CivilTime, Normalized) {
51    constexpr civil_second cs(2016, 1, 28, 17, 14, 12);
52    static_assert(cs.year() == 2016, &quot;Normalized.year&quot;);
53    static_assert(cs.month() == 1, &quot;Normalized.month&quot;);
54    static_assert(cs.day() == 28, &quot;Normalized.day&quot;);
55    static_assert(cs.hour() == 17, &quot;Normalized.hour&quot;);
56    static_assert(cs.minute() == 14, &quot;Normalized.minute&quot;);
57    static_assert(cs.second() == 12, &quot;Normalized.second&quot;);
58  }
59  TEST(CivilTime, SecondOverflow) {
60    constexpr civil_second cs(2016, 1, 28, 17, 14, 121);
61    static_assert(cs.year() == 2016, &quot;SecondOverflow.year&quot;);
62    static_assert(cs.month() == 1, &quot;SecondOverflow.month&quot;);
63    static_assert(cs.day() == 28, &quot;SecondOverflow.day&quot;);
64    static_assert(cs.hour() == 17, &quot;SecondOverflow.hour&quot;);
65    static_assert(cs.minute() == 16, &quot;SecondOverflow.minute&quot;);
66    static_assert(cs.second() == 1, &quot;SecondOverflow.second&quot;);
67  }
68  TEST(CivilTime, SecondUnderflow) {
69    constexpr civil_second cs(2016, 1, 28, 17, 14, -121);
70    static_assert(cs.year() == 2016, &quot;SecondUnderflow.year&quot;);
71    static_assert(cs.month() == 1, &quot;SecondUnderflow.month&quot;);
72    static_assert(cs.day() == 28, &quot;SecondUnderflow.day&quot;);
73    static_assert(cs.hour() == 17, &quot;SecondUnderflow.hour&quot;);
74    static_assert(cs.minute() == 11, &quot;SecondUnderflow.minute&quot;);
75    static_assert(cs.second() == 59, &quot;SecondUnderflow.second&quot;);
76  }
77  TEST(CivilTime, MinuteOverflow) {
78    constexpr civil_second cs(2016, 1, 28, 17, 121, 12);
79    static_assert(cs.year() == 2016, &quot;MinuteOverflow.year&quot;);
80    static_assert(cs.month() == 1, &quot;MinuteOverflow.month&quot;);
81    static_assert(cs.day() == 28, &quot;MinuteOverflow.day&quot;);
82    static_assert(cs.hour() == 19, &quot;MinuteOverflow.hour&quot;);
83    static_assert(cs.minute() == 1, &quot;MinuteOverflow.minute&quot;);
84    static_assert(cs.second() == 12, &quot;MinuteOverflow.second&quot;);
85  }
86  TEST(CivilTime, MinuteUnderflow) {
87    constexpr civil_second cs(2016, 1, 28, 17, -121, 12);
88    static_assert(cs.year() == 2016, &quot;MinuteUnderflow.year&quot;);
89    static_assert(cs.month() == 1, &quot;MinuteUnderflow.month&quot;);
90    static_assert(cs.day() == 28, &quot;MinuteUnderflow.day&quot;);
91    static_assert(cs.hour() == 14, &quot;MinuteUnderflow.hour&quot;);
92    static_assert(cs.minute() == 59, &quot;MinuteUnderflow.minute&quot;);
93    static_assert(cs.second() == 12, &quot;MinuteUnderflow.second&quot;);
94  }
95  TEST(CivilTime, HourOverflow) {
96    constexpr civil_second cs(2016, 1, 28, 49, 14, 12);
97    static_assert(cs.year() == 2016, &quot;HourOverflow.year&quot;);
98    static_assert(cs.month() == 1, &quot;HourOverflow.month&quot;);
99    static_assert(cs.day() == 30, &quot;HourOverflow.day&quot;);
100    static_assert(cs.hour() == 1, &quot;HourOverflow.hour&quot;);
101    static_assert(cs.minute() == 14, &quot;HourOverflow.minute&quot;);
102    static_assert(cs.second() == 12, &quot;HourOverflow.second&quot;);
103  }
104  TEST(CivilTime, HourUnderflow) {
105    constexpr civil_second cs(2016, 1, 28, -49, 14, 12);
106    static_assert(cs.year() == 2016, &quot;HourUnderflow.year&quot;);
107    static_assert(cs.month() == 1, &quot;HourUnderflow.month&quot;);
108    static_assert(cs.day() == 25, &quot;HourUnderflow.day&quot;);
109    static_assert(cs.hour() == 23, &quot;HourUnderflow.hour&quot;);
110    static_assert(cs.minute() == 14, &quot;HourUnderflow.minute&quot;);
111    static_assert(cs.second() == 12, &quot;HourUnderflow.second&quot;);
112  }
113  TEST(CivilTime, MonthOverflow) {
114    constexpr civil_second cs(2016, 25, 28, 17, 14, 12);
115    static_assert(cs.year() == 2018, &quot;MonthOverflow.year&quot;);
116    static_assert(cs.month() == 1, &quot;MonthOverflow.month&quot;);
117    static_assert(cs.day() == 28, &quot;MonthOverflow.day&quot;);
118    static_assert(cs.hour() == 17, &quot;MonthOverflow.hour&quot;);
119    static_assert(cs.minute() == 14, &quot;MonthOverflow.minute&quot;);
120    static_assert(cs.second() == 12, &quot;MonthOverflow.second&quot;);
121  }
122  TEST(CivilTime, MonthUnderflow) {
123    constexpr civil_second cs(2016, -25, 28, 17, 14, 12);
124    static_assert(cs.year() == 2013, &quot;MonthUnderflow.year&quot;);
125    static_assert(cs.month() == 11, &quot;MonthUnderflow.month&quot;);
126    static_assert(cs.day() == 28, &quot;MonthUnderflow.day&quot;);
127    static_assert(cs.hour() == 17, &quot;MonthUnderflow.hour&quot;);
128    static_assert(cs.minute() == 14, &quot;MonthUnderflow.minute&quot;);
129    static_assert(cs.second() == 12, &quot;MonthUnderflow.second&quot;);
130  }
131  TEST(CivilTime, C4Overflow) {
132    constexpr civil_second cs(2016, 1, 292195, 17, 14, 12);
133    static_assert(cs.year() == 2816, &quot;C4Overflow.year&quot;);
134    static_assert(cs.month() == 1, &quot;C4Overflow.month&quot;);
135    static_assert(cs.day() == 1, &quot;C4Overflow.day&quot;);
136    static_assert(cs.hour() == 17, &quot;C4Overflow.hour&quot;);
137    static_assert(cs.minute() == 14, &quot;C4Overflow.minute&quot;);
138    static_assert(cs.second() == 12, &quot;C4Overflow.second&quot;);
139  }
140  TEST(CivilTime, C4Underflow) {
141    constexpr civil_second cs(2016, 1, -292195, 17, 14, 12);
142    static_assert(cs.year() == 1215, &quot;C4Underflow.year&quot;);
143    static_assert(cs.month() == 12, &quot;C4Underflow.month&quot;);
144    static_assert(cs.day() == 30, &quot;C4Underflow.day&quot;);
145    static_assert(cs.hour() == 17, &quot;C4Underflow.hour&quot;);
146    static_assert(cs.minute() == 14, &quot;C4Underflow.minute&quot;);
147    static_assert(cs.second() == 12, &quot;C4Underflow.second&quot;);
148  }
149  TEST(CivilTime, MixedNormalization) {
150    constexpr civil_second cs(2016, -42, 122, 99, -147, 4949);
151    static_assert(cs.year() == 2012, &quot;MixedNormalization.year&quot;);
152    static_assert(cs.month() == 10, &quot;MixedNormalization.month&quot;);
153    static_assert(cs.day() == 4, &quot;MixedNormalization.day&quot;);
154    static_assert(cs.hour() == 1, &quot;MixedNormalization.hour&quot;);
155    static_assert(cs.minute() == 55, &quot;MixedNormalization.minute&quot;);
156    static_assert(cs.second() == 29, &quot;MixedNormalization.second&quot;);
157  }
158  TEST(CivilTime, Less) {
159    constexpr civil_second cs1(2016, 1, 28, 17, 14, 12);
160    constexpr civil_second cs2(2016, 1, 28, 17, 14, 13);
161    constexpr bool less = cs1 &lt; cs2;
162    static_assert(less, &quot;Less&quot;);
163  }
164  TEST(CivilTime, Addition) {
165    constexpr civil_second cs1(2016, 1, 28, 17, 14, 12);
166    constexpr civil_second cs2 = cs1 + 50;
167    static_assert(cs2.year() == 2016, &quot;Addition.year&quot;);
168    static_assert(cs2.month() == 1, &quot;Addition.month&quot;);
169    static_assert(cs2.day() == 28, &quot;Addition.day&quot;);
170    static_assert(cs2.hour() == 17, &quot;Addition.hour&quot;);
171    static_assert(cs2.minute() == 15, &quot;Addition.minute&quot;);
172    static_assert(cs2.second() == 2, &quot;Addition.second&quot;);
173  }
174  TEST(CivilTime, Subtraction) {
175    constexpr civil_second cs1(2016, 1, 28, 17, 14, 12);
176    constexpr civil_second cs2 = cs1 - 50;
177    static_assert(cs2.year() == 2016, &quot;Subtraction.year&quot;);
178    static_assert(cs2.month() == 1, &quot;Subtraction.month&quot;);
179    static_assert(cs2.day() == 28, &quot;Subtraction.day&quot;);
180    static_assert(cs2.hour() == 17, &quot;Subtraction.hour&quot;);
181    static_assert(cs2.minute() == 13, &quot;Subtraction.minute&quot;);
182    static_assert(cs2.second() == 22, &quot;Subtraction.second&quot;);
183  }
184  TEST(CivilTime, Difference) {
185    constexpr civil_day cd1(2016, 1, 28);
186    constexpr civil_day cd2(2015, 1, 28);
187    constexpr int diff = cd1 - cd2;
188    static_assert(diff == 365, &quot;Difference&quot;);
189  }
190  TEST(CivilTime, ConstructionWithHugeYear) {
191    constexpr civil_hour h(-9223372036854775807, 1, 1, -1);
192    static_assert(h.year() == -9223372036854775807 - 1,
193                  &quot;ConstructionWithHugeYear&quot;);
194    static_assert(h.month() == 12, &quot;ConstructionWithHugeYear&quot;);
195    static_assert(h.day() == 31, &quot;ConstructionWithHugeYear&quot;);
196    static_assert(h.hour() == 23, &quot;ConstructionWithHugeYear&quot;);
197  }
198  TEST(CivilTime, DifferenceWithHugeYear) {
199    {
200      constexpr civil_day d1(9223372036854775807, 1, 1);
201      constexpr civil_day d2(9223372036854775807, 12, 31);
202      static_assert(d2 - d1 == 364, &quot;DifferenceWithHugeYear&quot;);
203    }
204    {
205      constexpr civil_day d1(-9223372036854775807 - 1, 1, 1);
206      constexpr civil_day d2(-9223372036854775807 - 1, 12, 31);
207      static_assert(d2 - d1 == 365, &quot;DifferenceWithHugeYear&quot;);
208    }
209    {
210      constexpr civil_day d1(9223372036854775807, 1, 1);
211      constexpr civil_day d2(9198119301927009252, 6, 6);
212      static_assert(d1 - d2 == 9223372036854775807, &quot;DifferenceWithHugeYear&quot;);
213      static_assert((d2 - 1) - d1 == -9223372036854775807 - 1,
214                    &quot;DifferenceWithHugeYear&quot;);
215    }
216    {
217      constexpr civil_day d1(-9223372036854775807 - 1, 1, 1);
218      constexpr civil_day d2(-9198119301927009254, 7, 28);
219      static_assert(d2 - d1 == 9223372036854775807, &quot;DifferenceWithHugeYear&quot;);
220      static_assert(d1 - (d2 + 1) == -9223372036854775807 - 1,
221                    &quot;DifferenceWithHugeYear&quot;);
222    }
223    {
224      constexpr civil_day d1(-12626367463883278, 9, 3);
225      constexpr civil_day d2(12626367463883277, 3, 28);
226      static_assert(d2 - d1 == 9223372036854775807, &quot;DifferenceWithHugeYear&quot;);
227      static_assert(d1 - (d2 + 1) == -9223372036854775807 - 1,
228                    &quot;DifferenceWithHugeYear&quot;);
229    }
230  }
231  TEST(CivilTime, DifferenceNoIntermediateOverflow) {
232    {
233      constexpr civil_second s1(-292277022657, 1, 27, 8, 29 - 1, 52);
234      constexpr civil_second s2(1970, 1, 1, 0, 0 - 1, 0);
235      static_assert(s1 - s2 == -9223372036854775807 - 1,
236                    &quot;DifferenceNoIntermediateOverflow&quot;);
237    }
238    {
239      constexpr civil_second s1(292277026596, 12, 4, 15, 30, 7 - 7);
240      constexpr civil_second s2(1970, 1, 1, 0, 0, 0 - 7);
241      static_assert(s1 - s2 == 9223372036854775807,
242                    &quot;DifferenceNoIntermediateOverflow&quot;);
243    }
244  }
245  TEST(CivilTime, WeekDay) {
246    constexpr civil_day cd(2016, 1, 28);
247    constexpr weekday wd = get_weekday(cd);
248    static_assert(wd == weekday::thursday, &quot;Weekday&quot;);
249  }
250  TEST(CivilTime, NextWeekDay) {
251    constexpr civil_day cd(2016, 1, 28);
252    constexpr civil_day next = next_weekday(cd, weekday::thursday);
253    static_assert(next.year() == 2016, &quot;NextWeekDay.year&quot;);
254    static_assert(next.month() == 2, &quot;NextWeekDay.month&quot;);
255    static_assert(next.day() == 4, &quot;NextWeekDay.day&quot;);
256  }
257  TEST(CivilTime, PrevWeekDay) {
258    constexpr civil_day cd(2016, 1, 28);
259    constexpr civil_day prev = prev_weekday(cd, weekday::thursday);
260    static_assert(prev.year() == 2016, &quot;PrevWeekDay.year&quot;);
261    static_assert(prev.month() == 1, &quot;PrevWeekDay.month&quot;);
262    static_assert(prev.day() == 21, &quot;PrevWeekDay.day&quot;);
263  }
264  TEST(CivilTime, YearDay) {
265    constexpr civil_day cd(2016, 1, 28);
266    constexpr int yd = get_yearday(cd);
267    static_assert(yd == 28, &quot;YearDay&quot;);
268  }
269  #endif  
270  TEST(CivilTime, DefaultConstruction) {
271    civil_second ss;
272    EXPECT_EQ(&quot;1970-01-01T00:00:00&quot;, Format(ss));
273    civil_minute mm;
274    EXPECT_EQ(&quot;1970-01-01T00:00&quot;, Format(mm));
275    civil_hour hh;
276    EXPECT_EQ(&quot;1970-01-01T00&quot;, Format(hh));
277    civil_day d;
278    EXPECT_EQ(&quot;1970-01-01&quot;, Format(d));
279    civil_month m;
280    EXPECT_EQ(&quot;1970-01&quot;, Format(m));
281    civil_year y;
282    EXPECT_EQ(&quot;1970&quot;, Format(y));
283  }
284  TEST(CivilTime, StructMember) {
285    struct S {
286      civil_day day;
287    };
288    S s = {};
289    EXPECT_EQ(civil_day{}, s.day);
290  }
291  TEST(CivilTime, FieldsConstruction) {
292    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(civil_second(2015, 1, 2, 3, 4, 5)));
293    EXPECT_EQ(&quot;2015-01-02T03:04:00&quot;, Format(civil_second(2015, 1, 2, 3, 4)));
294    EXPECT_EQ(&quot;2015-01-02T03:00:00&quot;, Format(civil_second(2015, 1, 2, 3)));
295    EXPECT_EQ(&quot;2015-01-02T00:00:00&quot;, Format(civil_second(2015, 1, 2)));
296    EXPECT_EQ(&quot;2015-01-01T00:00:00&quot;, Format(civil_second(2015, 1)));
297    EXPECT_EQ(&quot;2015-01-01T00:00:00&quot;, Format(civil_second(2015)));
298    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(civil_minute(2015, 1, 2, 3, 4, 5)));
299    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(civil_minute(2015, 1, 2, 3, 4)));
300    EXPECT_EQ(&quot;2015-01-02T03:00&quot;, Format(civil_minute(2015, 1, 2, 3)));
301    EXPECT_EQ(&quot;2015-01-02T00:00&quot;, Format(civil_minute(2015, 1, 2)));
302    EXPECT_EQ(&quot;2015-01-01T00:00&quot;, Format(civil_minute(2015, 1)));
303    EXPECT_EQ(&quot;2015-01-01T00:00&quot;, Format(civil_minute(2015)));
304    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(civil_hour(2015, 1, 2, 3, 4, 5)));
305    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(civil_hour(2015, 1, 2, 3, 4)));
306    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(civil_hour(2015, 1, 2, 3)));
307    EXPECT_EQ(&quot;2015-01-02T00&quot;, Format(civil_hour(2015, 1, 2)));
308    EXPECT_EQ(&quot;2015-01-01T00&quot;, Format(civil_hour(2015, 1)));
309    EXPECT_EQ(&quot;2015-01-01T00&quot;, Format(civil_hour(2015)));
310    EXPECT_EQ(&quot;2015-01-02&quot;, Format(civil_day(2015, 1, 2, 3, 4, 5)));
311    EXPECT_EQ(&quot;2015-01-02&quot;, Format(civil_day(2015, 1, 2, 3, 4)));
312    EXPECT_EQ(&quot;2015-01-02&quot;, Format(civil_day(2015, 1, 2, 3)));
313    EXPECT_EQ(&quot;2015-01-02&quot;, Format(civil_day(2015, 1, 2)));
314    EXPECT_EQ(&quot;2015-01-01&quot;, Format(civil_day(2015, 1)));
315    EXPECT_EQ(&quot;2015-01-01&quot;, Format(civil_day(2015)));
316    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1, 2, 3, 4, 5)));
317    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1, 2, 3, 4)));
318    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1, 2, 3)));
319    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1, 2)));
320    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015, 1)));
321    EXPECT_EQ(&quot;2015-01&quot;, Format(civil_month(2015)));
322    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1, 2, 3, 4, 5)));
323    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1, 2, 3, 4)));
324    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1, 2, 3)));
325    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1, 2)));
326    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015, 1)));
327    EXPECT_EQ(&quot;2015&quot;, Format(civil_year(2015)));
328  }
329  TEST(CivilTime, FieldsConstructionLimits) {
330    const int kIntMax = std::numeric_limits&lt;int&gt;::max();
331    EXPECT_EQ(&quot;2038-01-19T03:14:07&quot;,
332              Format(civil_second(1970, 1, 1, 0, 0, kIntMax)));
333    EXPECT_EQ(&quot;6121-02-11T05:21:07&quot;,
334              Format(civil_second(1970, 1, 1, 0, kIntMax, kIntMax)));
335    EXPECT_EQ(&quot;251104-11-20T12:21:07&quot;,
336              Format(civil_second(1970, 1, 1, kIntMax, kIntMax, kIntMax)));
337    EXPECT_EQ(&quot;6130715-05-30T12:21:07&quot;,
338              Format(civil_second(1970, 1, kIntMax, kIntMax, kIntMax, kIntMax)));
339    EXPECT_EQ(
340        &quot;185087685-11-26T12:21:07&quot;,
341        Format(civil_second(1970, kIntMax, kIntMax, kIntMax, kIntMax, kIntMax)));
342    const int kIntMin = std::numeric_limits&lt;int&gt;::min();
343    EXPECT_EQ(&quot;1901-12-13T20:45:52&quot;,
344              Format(civil_second(1970, 1, 1, 0, 0, kIntMin)));
345    EXPECT_EQ(&quot;-2182-11-20T18:37:52&quot;,
346              Format(civil_second(1970, 1, 1, 0, kIntMin, kIntMin)));
347    EXPECT_EQ(&quot;-247165-02-11T10:37:52&quot;,
348              Format(civil_second(1970, 1, 1, kIntMin, kIntMin, kIntMin)));
349    EXPECT_EQ(&quot;-6126776-08-01T10:37:52&quot;,
350              Format(civil_second(1970, 1, kIntMin, kIntMin, kIntMin, kIntMin)));
351    EXPECT_EQ(
352        &quot;-185083747-10-31T10:37:52&quot;,
353        Format(civil_second(1970, kIntMin, kIntMin, kIntMin, kIntMin, kIntMin)));
354  }
355  TEST(CivilTime, ImplicitCrossAlignment) {
356    civil_year year(2015);
357    civil_month month = year;
358    civil_day day = month;
359    civil_hour hour = day;
360    civil_minute minute = hour;
361    civil_second second = minute;
362    second = year;
363    EXPECT_EQ(second, year);
364    second = month;
365    EXPECT_EQ(second, month);
366    second = day;
367    EXPECT_EQ(second, day);
368    second = hour;
369    EXPECT_EQ(second, hour);
370    second = minute;
371    EXPECT_EQ(second, minute);
372    minute = year;
373    EXPECT_EQ(minute, year);
374    minute = month;
375    EXPECT_EQ(minute, month);
376    minute = day;
377    EXPECT_EQ(minute, day);
378    minute = hour;
379    EXPECT_EQ(minute, hour);
380    hour = year;
381    EXPECT_EQ(hour, year);
382    hour = month;
383    EXPECT_EQ(hour, month);
384    hour = day;
385    EXPECT_EQ(hour, day);
386    day = year;
387    EXPECT_EQ(day, year);
388    day = month;
389    EXPECT_EQ(day, month);
390    month = year;
391    EXPECT_EQ(month, year);
392    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_minute&gt;::value));
393    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_hour&gt;::value));
394    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_day&gt;::value));
395    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_month&gt;::value));
396    EXPECT_FALSE((std::is_convertible&lt;civil_second, civil_year&gt;::value));
397    EXPECT_FALSE((std::is_convertible&lt;civil_minute, civil_hour&gt;::value));
398    EXPECT_FALSE((std::is_convertible&lt;civil_minute, civil_day&gt;::value));
399    EXPECT_FALSE((std::is_convertible&lt;civil_minute, civil_month&gt;::value));
400    EXPECT_FALSE((std::is_convertible&lt;civil_minute, civil_year&gt;::value));
401    EXPECT_FALSE((std::is_convertible&lt;civil_hour, civil_day&gt;::value));
402    EXPECT_FALSE((std::is_convertible&lt;civil_hour, civil_month&gt;::value));
403    EXPECT_FALSE((std::is_convertible&lt;civil_hour, civil_year&gt;::value));
404    EXPECT_FALSE((std::is_convertible&lt;civil_day, civil_month&gt;::value));
405    EXPECT_FALSE((std::is_convertible&lt;civil_day, civil_year&gt;::value));
406    EXPECT_FALSE((std::is_convertible&lt;civil_month, civil_year&gt;::value));
407  }
408  TEST(CivilTime, ExplicitCrossAlignment) {
409    civil_second second(2015, 1, 2, 3, 4, 5);
410    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(second));
411    civil_minute minute(second);
412    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(minute));
413    civil_hour hour(minute);
414    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(hour));
415    civil_day day(hour);
416    EXPECT_EQ(&quot;2015-01-02&quot;, Format(day));
417    civil_month month(day);
418    EXPECT_EQ(&quot;2015-01&quot;, Format(month));
419    civil_year year(month);
420    EXPECT_EQ(&quot;2015&quot;, Format(year));
421    month = civil_month(year);
422    EXPECT_EQ(&quot;2015-01&quot;, Format(month));
423    day = civil_day(month);
424    EXPECT_EQ(&quot;2015-01-01&quot;, Format(day));
425    hour = civil_hour(day);
426    EXPECT_EQ(&quot;2015-01-01T00&quot;, Format(hour));
427    minute = civil_minute(hour);
428    EXPECT_EQ(&quot;2015-01-01T00:00&quot;, Format(minute));
429    second = civil_second(minute);
430    EXPECT_EQ(&quot;2015-01-01T00:00:00&quot;, Format(second));
431  }
432  template &lt;typename T1, typename T2&gt;
433  struct HasDifference {
434    template &lt;typename U1, typename U2&gt;
435    static std::false_type test(...);
436    template &lt;typename U1, typename U2&gt;
437    static std::true_type test(decltype(std::declval&lt;U1&gt;() - std::declval&lt;U2&gt;()));
438    static constexpr bool value = decltype(test&lt;T1, T2&gt;(0))::value;
439  };
440  TEST(CivilTime, DisallowCrossAlignedDifference) {
441    static_assert(HasDifference&lt;civil_second, civil_second&gt;::value, &quot;&quot;);
442    static_assert(HasDifference&lt;civil_minute, civil_minute&gt;::value, &quot;&quot;);
443    static_assert(HasDifference&lt;civil_hour, civil_hour&gt;::value, &quot;&quot;);
444    static_assert(HasDifference&lt;civil_day, civil_day&gt;::value, &quot;&quot;);
445    static_assert(HasDifference&lt;civil_month, civil_month&gt;::value, &quot;&quot;);
446    static_assert(HasDifference&lt;civil_year, civil_year&gt;::value, &quot;&quot;);
447    static_assert(!HasDifference&lt;civil_second, civil_minute&gt;::value, &quot;&quot;);
448    static_assert(!HasDifference&lt;civil_second, civil_hour&gt;::value, &quot;&quot;);
449    static_assert(!HasDifference&lt;civil_second, civil_day&gt;::value, &quot;&quot;);
450    static_assert(!HasDifference&lt;civil_second, civil_month&gt;::value, &quot;&quot;);
451    static_assert(!HasDifference&lt;civil_second, civil_year&gt;::value, &quot;&quot;);
452    static_assert(!HasDifference&lt;civil_minute, civil_hour&gt;::value, &quot;&quot;);
453    static_assert(!HasDifference&lt;civil_minute, civil_day&gt;::value, &quot;&quot;);
454    static_assert(!HasDifference&lt;civil_minute, civil_month&gt;::value, &quot;&quot;);
455    static_assert(!HasDifference&lt;civil_minute, civil_year&gt;::value, &quot;&quot;);
456    static_assert(!HasDifference&lt;civil_hour, civil_day&gt;::value, &quot;&quot;);
457    static_assert(!HasDifference&lt;civil_hour, civil_month&gt;::value, &quot;&quot;);
458    static_assert(!HasDifference&lt;civil_hour, civil_year&gt;::value, &quot;&quot;);
459    static_assert(!HasDifference&lt;civil_day, civil_month&gt;::value, &quot;&quot;);
460    static_assert(!HasDifference&lt;civil_day, civil_year&gt;::value, &quot;&quot;);
461    static_assert(!HasDifference&lt;civil_month, civil_year&gt;::value, &quot;&quot;);
462  }
463  TEST(CivilTime, ValueSemantics) {
464    const civil_hour a(2015, 1, 2, 3);
465    const civil_hour b = a;
466    const civil_hour c(b);
467    civil_hour d;
468    d = c;
469    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(d));
470  }
471  TEST(CivilTime, Relational) {
472    const civil_year year(2014);
473    const civil_month month(year);
474    EXPECT_EQ(year, month);
475  #define TEST_RELATIONAL(OLDER, YOUNGER) \
476    do {                                  \
477      EXPECT_FALSE(OLDER &lt; OLDER);        \
478      EXPECT_FALSE(OLDER &gt; OLDER);        \
479      EXPECT_TRUE(OLDER &gt;= OLDER);        \
480      EXPECT_TRUE(OLDER &lt;= OLDER);        \
481      EXPECT_FALSE(YOUNGER &lt; YOUNGER);    \
482      EXPECT_FALSE(YOUNGER &gt; YOUNGER);    \
483      EXPECT_TRUE(YOUNGER &gt;= YOUNGER);    \
484      EXPECT_TRUE(YOUNGER &lt;= YOUNGER);    \
485      EXPECT_EQ(OLDER, OLDER);            \
486      EXPECT_NE(OLDER, YOUNGER);          \
487      EXPECT_LT(OLDER, YOUNGER);          \
488      EXPECT_LE(OLDER, YOUNGER);          \
489      EXPECT_GT(YOUNGER, OLDER);          \
490      EXPECT_GE(YOUNGER, OLDER);          \
491    } while (0)
492    TEST_RELATIONAL(civil_second(2014, 1, 1, 0, 0, 0),
493                    civil_second(2015, 1, 1, 0, 0, 0));
494    TEST_RELATIONAL(civil_second(2014, 1, 1, 0, 0, 0),
495                    civil_second(2014, 2, 1, 0, 0, 0));
496    TEST_RELATIONAL(civil_second(2014, 1, 1, 0, 0, 0),
497                    civil_second(2014, 1, 2, 0, 0, 0));
498    TEST_RELATIONAL(civil_second(2014, 1, 1, 0, 0, 0),
499                    civil_second(2014, 1, 1, 1, 0, 0));
500    TEST_RELATIONAL(civil_second(2014, 1, 1, 1, 0, 0),
501                    civil_second(2014, 1, 1, 1, 1, 0));
502    TEST_RELATIONAL(civil_second(2014, 1, 1, 1, 1, 0),
503                    civil_second(2014, 1, 1, 1, 1, 1));
504    TEST_RELATIONAL(civil_day(2014, 1, 1), civil_minute(2014, 1, 1, 1, 1));
505    TEST_RELATIONAL(civil_day(2014, 1, 1), civil_month(2014, 2));
506  #undef TEST_RELATIONAL
507  }
508  TEST(CivilTime, Arithmetic) {
509    civil_second second(2015, 1, 2, 3, 4, 5);
510    EXPECT_EQ(&quot;2015-01-02T03:04:06&quot;, Format(second += 1));
511    EXPECT_EQ(&quot;2015-01-02T03:04:07&quot;, Format(second + 1));
512    EXPECT_EQ(&quot;2015-01-02T03:04:08&quot;, Format(2 + second));
513    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(second - 1));
514    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(second -= 1));
515    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(second++));
516    EXPECT_EQ(&quot;2015-01-02T03:04:07&quot;, Format(++second));
517    EXPECT_EQ(&quot;2015-01-02T03:04:07&quot;, Format(second--));
518    EXPECT_EQ(&quot;2015-01-02T03:04:05&quot;, Format(--second));
519    civil_minute minute(2015, 1, 2, 3, 4);
520    EXPECT_EQ(&quot;2015-01-02T03:05&quot;, Format(minute += 1));
521    EXPECT_EQ(&quot;2015-01-02T03:06&quot;, Format(minute + 1));
522    EXPECT_EQ(&quot;2015-01-02T03:07&quot;, Format(2 + minute));
523    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(minute - 1));
524    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(minute -= 1));
525    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(minute++));
526    EXPECT_EQ(&quot;2015-01-02T03:06&quot;, Format(++minute));
527    EXPECT_EQ(&quot;2015-01-02T03:06&quot;, Format(minute--));
528    EXPECT_EQ(&quot;2015-01-02T03:04&quot;, Format(--minute));
529    civil_hour hour(2015, 1, 2, 3);
530    EXPECT_EQ(&quot;2015-01-02T04&quot;, Format(hour += 1));
531    EXPECT_EQ(&quot;2015-01-02T05&quot;, Format(hour + 1));
532    EXPECT_EQ(&quot;2015-01-02T06&quot;, Format(2 + hour));
533    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(hour - 1));
534    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(hour -= 1));
535    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(hour++));
536    EXPECT_EQ(&quot;2015-01-02T05&quot;, Format(++hour));
537    EXPECT_EQ(&quot;2015-01-02T05&quot;, Format(hour--));
538    EXPECT_EQ(&quot;2015-01-02T03&quot;, Format(--hour));
539    civil_day day(2015, 1, 2);
540    EXPECT_EQ(&quot;2015-01-03&quot;, Format(day += 1));
541    EXPECT_EQ(&quot;2015-01-04&quot;, Format(day + 1));
542    EXPECT_EQ(&quot;2015-01-05&quot;, Format(2 + day));
543    EXPECT_EQ(&quot;2015-01-02&quot;, Format(day - 1));
544    EXPECT_EQ(&quot;2015-01-02&quot;, Format(day -= 1));
545    EXPECT_EQ(&quot;2015-01-02&quot;, Format(day++));
546    EXPECT_EQ(&quot;2015-01-04&quot;, Format(++day));
547    EXPECT_EQ(&quot;2015-01-04&quot;, Format(day--));
548    EXPECT_EQ(&quot;2015-01-02&quot;, Format(--day));
549    civil_month month(2015, 1);
550    EXPECT_EQ(&quot;2015-02&quot;, Format(month += 1));
551    EXPECT_EQ(&quot;2015-03&quot;, Format(month + 1));
552    EXPECT_EQ(&quot;2015-04&quot;, Format(2 + month));
553    EXPECT_EQ(&quot;2015-01&quot;, Format(month - 1));
554    EXPECT_EQ(&quot;2015-01&quot;, Format(month -= 1));
555    EXPECT_EQ(&quot;2015-01&quot;, Format(month++));
556    EXPECT_EQ(&quot;2015-03&quot;, Format(++month));
557    EXPECT_EQ(&quot;2015-03&quot;, Format(month--));
558    EXPECT_EQ(&quot;2015-01&quot;, Format(--month));
559    civil_year year(2015);
560    EXPECT_EQ(&quot;2016&quot;, Format(year += 1));
561    EXPECT_EQ(&quot;2017&quot;, Format(year + 1));
562    EXPECT_EQ(&quot;2018&quot;, Format(2 + year));
563    EXPECT_EQ(&quot;2015&quot;, Format(year - 1));
564    EXPECT_EQ(&quot;2015&quot;, Format(year -= 1));
565    EXPECT_EQ(&quot;2015&quot;, Format(year++));
566    EXPECT_EQ(&quot;2017&quot;, Format(++year));
567    EXPECT_EQ(&quot;2017&quot;, Format(year--));
568    EXPECT_EQ(&quot;2015&quot;, Format(--year));
569  }
570  TEST(CivilTime, ArithmeticLimits) {
571    const int kIntMax = std::numeric_limits&lt;int&gt;::max();
572    const int kIntMin = std::numeric_limits&lt;int&gt;::min();
573    civil_second second(1970, 1, 1, 0, 0, 0);
574    second += kIntMax;
575    EXPECT_EQ(&quot;2038-01-19T03:14:07&quot;, Format(second));
576    second -= kIntMax;
577    EXPECT_EQ(&quot;1970-01-01T00:00:00&quot;, Format(second));
578    second += kIntMin;
579    EXPECT_EQ(&quot;1901-12-13T20:45:52&quot;, Format(second));
580    second -= kIntMin;
581    EXPECT_EQ(&quot;1970-01-01T00:00:00&quot;, Format(second));
582    civil_minute minute(1970, 1, 1, 0, 0);
583    minute += kIntMax;
584    EXPECT_EQ(&quot;6053-01-23T02:07&quot;, Format(minute));
585    minute -= kIntMax;
586    EXPECT_EQ(&quot;1970-01-01T00:00&quot;, Format(minute));
587    minute += kIntMin;
588    EXPECT_EQ(&quot;-2114-12-08T21:52&quot;, Format(minute));
589    minute -= kIntMin;
590    EXPECT_EQ(&quot;1970-01-01T00:00&quot;, Format(minute));
591    civil_hour hour(1970, 1, 1, 0);
592    hour += kIntMax;
593    EXPECT_EQ(&quot;246953-10-09T07&quot;, Format(hour));
594    hour -= kIntMax;
595    EXPECT_EQ(&quot;1970-01-01T00&quot;, Format(hour));
596    hour += kIntMin;
597    EXPECT_EQ(&quot;-243014-03-24T16&quot;, Format(hour));
598    hour -= kIntMin;
599    EXPECT_EQ(&quot;1970-01-01T00&quot;, Format(hour));
600    civil_day day(1970, 1, 1);
601    day += kIntMax;
602    EXPECT_EQ(&quot;5881580-07-11&quot;, Format(day));
603    day -= kIntMax;
604    EXPECT_EQ(&quot;1970-01-01&quot;, Format(day));
605    day += kIntMin;
606    EXPECT_EQ(&quot;-5877641-06-23&quot;, Format(day));
607    day -= kIntMin;
608    EXPECT_EQ(&quot;1970-01-01&quot;, Format(day));
609    civil_month month(1970, 1);
610    month += kIntMax;
611    EXPECT_EQ(&quot;178958940-08&quot;, Format(month));
612    month -= kIntMax;
613    EXPECT_EQ(&quot;1970-01&quot;, Format(month));
614    month += kIntMin;
615    EXPECT_EQ(&quot;-178955001-05&quot;, Format(month));
616    month -= kIntMin;
617    EXPECT_EQ(&quot;1970-01&quot;, Format(month));
618    civil_year year(0);
619    year += kIntMax;
620    EXPECT_EQ(&quot;2147483647&quot;, Format(year));
621    year -= kIntMax;
622    EXPECT_EQ(&quot;0&quot;, Format(year));
623    year += kIntMin;
624    EXPECT_EQ(&quot;-2147483648&quot;, Format(year));
625    year -= kIntMin;
626    EXPECT_EQ(&quot;0&quot;, Format(year));
627  }
628  TEST(CivilTime, ArithmeticDifference) {
629    civil_second second(2015, 1, 2, 3, 4, 5);
630    EXPECT_EQ(0, second - second);
631    EXPECT_EQ(10, (second + 10) - second);
632    EXPECT_EQ(-10, (second - 10) - second);
633    civil_minute minute(2015, 1, 2, 3, 4);
634    EXPECT_EQ(0, minute - minute);
635    EXPECT_EQ(10, (minute + 10) - minute);
636    EXPECT_EQ(-10, (minute - 10) - minute);
637    civil_hour hour(2015, 1, 2, 3);
638    EXPECT_EQ(0, hour - hour);
639    EXPECT_EQ(10, (hour + 10) - hour);
640    EXPECT_EQ(-10, (hour - 10) - hour);
641    civil_day day(2015, 1, 2);
642    EXPECT_EQ(0, day - day);
643    EXPECT_EQ(10, (day + 10) - day);
644    EXPECT_EQ(-10, (day - 10) - day);
645    civil_month month(2015, 1);
646    EXPECT_EQ(0, month - month);
647    EXPECT_EQ(10, (month + 10) - month);
648    EXPECT_EQ(-10, (month - 10) - month);
649    civil_year year(2015);
650    EXPECT_EQ(0, year - year);
651    EXPECT_EQ(10, (year + 10) - year);
652    EXPECT_EQ(-10, (year - 10) - year);
653  }
654  TEST(CivilTime, DifferenceLimits) {
655    const int kIntMax = std::numeric_limits&lt;int&gt;::max();
656    const int kIntMin = std::numeric_limits&lt;int&gt;::min();
657    const civil_day max_day(kIntMax, 12, 31);
658    EXPECT_EQ(1, max_day - (max_day - 1));
659    EXPECT_EQ(-1, (max_day - 1) - max_day);
660    const civil_day min_day(kIntMin, 1, 1);
661    EXPECT_EQ(1, (min_day + 1) - min_day);
662    EXPECT_EQ(-1, min_day - (min_day + 1));
663    const civil_day d1(1970, 1, 1);
664    const civil_day d2(5881580, 7, 11);
665    EXPECT_EQ(kIntMax, d2 - d1);
666    EXPECT_EQ(kIntMin, d1 - (d2 + 1));
667  }
668  TEST(CivilTime, Properties) {
669    civil_second ss(2015, 2, 3, 4, 5, 6);
670    EXPECT_EQ(2015, ss.year());
671    EXPECT_EQ(2, ss.month());
672    EXPECT_EQ(3, ss.day());
673    EXPECT_EQ(4, ss.hour());
674    EXPECT_EQ(5, ss.minute());
675    EXPECT_EQ(6, ss.second());
676    EXPECT_EQ(weekday::tuesday, get_weekday(ss));
677    EXPECT_EQ(34, get_yearday(ss));
678    civil_minute mm(2015, 2, 3, 4, 5, 6);
679    EXPECT_EQ(2015, mm.year());
680    EXPECT_EQ(2, mm.month());
681    EXPECT_EQ(3, mm.day());
682    EXPECT_EQ(4, mm.hour());
683    EXPECT_EQ(5, mm.minute());
684    EXPECT_EQ(0, mm.second());
685    EXPECT_EQ(weekday::tuesday, get_weekday(mm));
686    EXPECT_EQ(34, get_yearday(mm));
687    civil_hour hh(2015, 2, 3, 4, 5, 6);
688    EXPECT_EQ(2015, hh.year());
689    EXPECT_EQ(2, hh.month());
690    EXPECT_EQ(3, hh.day());
691    EXPECT_EQ(4, hh.hour());
692    EXPECT_EQ(0, hh.minute());
693    EXPECT_EQ(0, hh.second());
694    EXPECT_EQ(weekday::tuesday, get_weekday(hh));
695    EXPECT_EQ(34, get_yearday(hh));
696    civil_day d(2015, 2, 3, 4, 5, 6);
697    EXPECT_EQ(2015, d.year());
698    EXPECT_EQ(2, d.month());
699    EXPECT_EQ(3, d.day());
700    EXPECT_EQ(0, d.hour());
701    EXPECT_EQ(0, d.minute());
702    EXPECT_EQ(0, d.second());
703    EXPECT_EQ(weekday::tuesday, get_weekday(d));
704    EXPECT_EQ(34, get_yearday(d));
705    civil_month m(2015, 2, 3, 4, 5, 6);
706    EXPECT_EQ(2015, m.year());
707    EXPECT_EQ(2, m.month());
708    EXPECT_EQ(1, m.day());
709    EXPECT_EQ(0, m.hour());
710    EXPECT_EQ(0, m.minute());
711    EXPECT_EQ(0, m.second());
712    EXPECT_EQ(weekday::sunday, get_weekday(m));
713    EXPECT_EQ(32, get_yearday(m));
714    civil_year y(2015, 2, 3, 4, 5, 6);
715    EXPECT_EQ(2015, y.year());
716    EXPECT_EQ(1, y.month());
717    EXPECT_EQ(1, y.day());
718    EXPECT_EQ(0, y.hour());
719    EXPECT_EQ(0, y.minute());
720    EXPECT_EQ(0, y.second());
721    EXPECT_EQ(weekday::thursday, get_weekday(y));
722    EXPECT_EQ(1, get_yearday(y));
723  }
724  TEST(CivilTime, OutputStream) {
725    EXPECT_EQ(&quot;2016&quot;, Format(civil_year(2016)));
726    EXPECT_EQ(&quot;123&quot;, Format(civil_year(123)));
727    EXPECT_EQ(&quot;0&quot;, Format(civil_year(0)));
728    EXPECT_EQ(&quot;-1&quot;, Format(civil_year(-1)));
729    EXPECT_EQ(&quot;2016-02&quot;, Format(civil_month(2016, 2)));
730    EXPECT_EQ(&quot;2016-02-03&quot;, Format(civil_day(2016, 2, 3)));
731    EXPECT_EQ(&quot;2016-02-03T04&quot;, Format(civil_hour(2016, 2, 3, 4)));
732    EXPECT_EQ(&quot;2016-02-03T04:05&quot;, Format(civil_minute(2016, 2, 3, 4, 5)));
733    EXPECT_EQ(&quot;2016-02-03T04:05:06&quot;, Format(civil_second(2016, 2, 3, 4, 5, 6)));
734    EXPECT_EQ(&quot;Monday&quot;, Format(weekday::monday));
735    EXPECT_EQ(&quot;Tuesday&quot;, Format(weekday::tuesday));
736    EXPECT_EQ(&quot;Wednesday&quot;, Format(weekday::wednesday));
737    EXPECT_EQ(&quot;Thursday&quot;, Format(weekday::thursday));
738    EXPECT_EQ(&quot;Friday&quot;, Format(weekday::friday));
739    EXPECT_EQ(&quot;Saturday&quot;, Format(weekday::saturday));
740    EXPECT_EQ(&quot;Sunday&quot;, Format(weekday::sunday));
741  }
742  TEST(CivilTime, OutputStreamLeftFillWidth) {
743    civil_second cs(2016, 2, 3, 4, 5, 6);
744    {
745      std::stringstream ss;
746      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
747      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
748      ss &lt;&lt; std::setw(21) &lt;&lt; civil_year(cs);
749      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
750      EXPECT_EQ(&quot;X..2016.................X..&quot;, ss.str());
751    }
752    {
753      std::stringstream ss;
754      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
755      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
756      ss &lt;&lt; std::setw(21) &lt;&lt; civil_month(cs);
757      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
758      EXPECT_EQ(&quot;X..2016-02..............X..&quot;, ss.str());
759    }
760    {
761      std::stringstream ss;
762      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
763      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
764      ss &lt;&lt; std::setw(21) &lt;&lt; civil_day(cs);
765      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
766      EXPECT_EQ(&quot;X..2016-02-03...........X..&quot;, ss.str());
767    }
768    {
769      std::stringstream ss;
770      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
771      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
772      ss &lt;&lt; std::setw(21) &lt;&lt; civil_hour(cs);
773      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
774      EXPECT_EQ(&quot;X..2016-02-03T04........X..&quot;, ss.str());
775    }
776    {
777      std::stringstream ss;
778      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
779      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
780      ss &lt;&lt; std::setw(21) &lt;&lt; civil_minute(cs);
781      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
782      EXPECT_EQ(&quot;X..2016-02-03T04:05.....X..&quot;, ss.str());
783    }
784    {
785      std::stringstream ss;
786      ss &lt;&lt; std::left &lt;&lt; std::setfill(&#x27;.&#x27;);
787      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
788      ss &lt;&lt; std::setw(21) &lt;&lt; civil_second(cs);
789      ss &lt;&lt; std::setw(3) &lt;&lt; &#x27;X&#x27;;
790      EXPECT_EQ(&quot;X..2016-02-03T04:05:06..X..&quot;, ss.str());
791    }
792  }
793  TEST(CivilTime, NextPrevWeekday) {
794    const civil_day thursday(1970, 1, 1);
795    EXPECT_EQ(weekday::thursday, get_weekday(thursday));
796    civil_day d = next_weekday(thursday, weekday::thursday);
797    EXPECT_EQ(7, d - thursday) &lt;&lt; Format(d);
798    EXPECT_EQ(d - 14, prev_weekday(thursday, weekday::thursday));
799    d = next_weekday(thursday, weekday::friday);
800    EXPECT_EQ(1, d - thursday) &lt;&lt; Format(d);
801    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::friday));
802    d = next_weekday(thursday, weekday::saturday);
803    EXPECT_EQ(2, d - thursday) &lt;&lt; Format(d);
804    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::saturday));
805    d = next_weekday(thursday, weekday::sunday);
<span onclick='openModal()' class='match'>806    EXPECT_EQ(3, d - thursday) &lt;&lt; Format(d);
807    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::sunday));
808    d = next_weekday(thursday, weekday::monday);
</span>809    EXPECT_EQ(4, d - thursday) &lt;&lt; Format(d);
810    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::monday));
811    d = next_weekday(thursday, weekday::tuesday);
812    EXPECT_EQ(5, d - thursday) &lt;&lt; Format(d);
813    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::tuesday));
814    d = next_weekday(thursday, weekday::wednesday);
815    EXPECT_EQ(6, d - thursday) &lt;&lt; Format(d);
816    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::wednesday));
817  }
818  TEST(CivilTime, NormalizeWithHugeYear) {
819    civil_month c(9223372036854775807, 1);
820    EXPECT_EQ(&quot;9223372036854775807-01&quot;, Format(c));
821    c = c - 1;  
822    EXPECT_EQ(&quot;9223372036854775806-12&quot;, Format(c));
823    c = civil_month(-9223372036854775807 - 1, 1);
824    EXPECT_EQ(&quot;-9223372036854775808-01&quot;, Format(c));
825    c = c + 12;  
826    EXPECT_EQ(&quot;-9223372036854775807-01&quot;, Format(c));
827  }
828  TEST(CivilTime, LeapYears) {
829    const struct {
830      int year;
831      int days;
832      struct {
833        int month;
834        int day;
835      } leap_day;  
836    } kLeapYearTable[]{
837        {1900, 365, {3, 1}},  {1999, 365, {3, 1}},
838        {2000, 366, {2, 29}},  
839        {2001, 365, {3, 1}},  {2002, 365, {3, 1}},
840        {2003, 365, {3, 1}},  {2004, 366, {2, 29}},  
841        {2005, 365, {3, 1}},  {2006, 365, {3, 1}},
842        {2007, 365, {3, 1}},  {2008, 366, {2, 29}},  
843        {2009, 365, {3, 1}},  {2100, 365, {3, 1}},
844    };
845    for (const auto&amp; e : kLeapYearTable) {
846      const civil_day feb28(e.year, 2, 28);
847      const civil_day next_day = feb28 + 1;
848      EXPECT_EQ(e.leap_day.month, next_day.month());
849      EXPECT_EQ(e.leap_day.day, next_day.day());
850      const civil_year year(feb28);
851      const civil_year next_year = year + 1;
852      EXPECT_EQ(e.days, civil_day(next_year) - civil_day(year));
853    }
854  }
855  TEST(CivilTime, FirstThursdayInMonth) {
856    const civil_day nov1(2014, 11, 1);
857    const civil_day thursday = next_weekday(nov1 - 1, weekday::thursday);
858    EXPECT_EQ(&quot;2014-11-06&quot;, Format(thursday));
859    const civil_day thanksgiving = thursday + 7 * 3;
860    EXPECT_EQ(&quot;2014-11-27&quot;, Format(thanksgiving));
861  }
862  }  
863  }  
864  ABSL_NAMESPACE_END
865  }  
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-civil_time_test_17.cc</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-civil_time_test_17.cc</div>
                </div>
                <div class="column column_space"><pre><code>809    EXPECT_EQ(4, d - thursday) &lt;&lt; Format(d);
810    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::monday));
811    d = next_weekday(thursday, weekday::tuesday);
</pre></code></div>
                <div class="column column_space"><pre><code>806    EXPECT_EQ(3, d - thursday) &lt;&lt; Format(d);
807    EXPECT_EQ(d - 7, prev_weekday(thursday, weekday::sunday));
808    d = next_weekday(thursday, weekday::monday);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    