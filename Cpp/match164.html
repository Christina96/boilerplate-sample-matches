<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_api_stream_cipher_salsa20.cpp & test_api_authenticated_symmetric_cipher_eax.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_api_stream_cipher_salsa20.cpp & test_api_authenticated_symmetric_cipher_eax.cpp
      </h3>
      <h1 align="center">
        20.5%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_api_stream_cipher_salsa20.cpp (24.34457%)<TH>test_api_authenticated_symmetric_cipher_eax.cpp (17.759563%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match164-0.html#0',2,'match164-1.html#0',3)" NAME="0">(345-385)<TD><A HREF="javascript:ZweiFrames('match164-0.html#0',2,'match164-1.html#0',3)" NAME="0">(464-500)</A><TD ALIGN=center><FONT COLOR="#ff0000">19</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match164-0.html#1',2,'match164-1.html#1',3)" NAME="1">(430-452)<TD><A HREF="javascript:ZweiFrames('match164-0.html#1',2,'match164-1.html#1',3)" NAME="1">(538-562)</A><TD ALIGN=center><FONT COLOR="#e40000">17</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match164-0.html#2',2,'match164-1.html#2',3)" NAME="2">(386-413)<TD><A HREF="javascript:ZweiFrames('match164-0.html#2',2,'match164-1.html#2',3)" NAME="2">(138-167)</A><TD ALIGN=center><FONT COLOR="#c90000">15</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match164-0.html#3',2,'match164-1.html#3',3)" NAME="3">(115-136)<TD><A HREF="javascript:ZweiFrames('match164-0.html#3',2,'match164-1.html#3',3)" NAME="3">(436-456)</A><TD ALIGN=center><FONT COLOR="#bb0000">14</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_api_stream_cipher_salsa20.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * This file is part of cryptopp-bindings-api.
 *
 * (c) Stephen Berquet &lt;stephen.berquet@gmail.com&gt;
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

#include &quot;src/exception/api_exception.h&quot;
#include &quot;src/symmetric/cipher/stream/api_stream_cipher_salsa20.h&quot;
#include &quot;src/utils/api_hex_utils.h&quot;
#include &quot;tests/test_api_assertions.h&quot;
#include &lt;gtest/gtest.h&gt;

TEST(StreamCipherSalsa20Test, inheritance) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::SymmetricCipherInterface*&gt;(&amp;cipher));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::SymmetricTransformationInterface*&gt;(&amp;cipher));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::StreamCipherInterface*&gt;(&amp;cipher));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::StreamCipherAbstract*&gt;(&amp;cipher));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::SymmetricKeyAbstract*&gt;(&amp;cipher));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::SymmetricIvAbstract*&gt;(&amp;cipher));
}

TEST(StreamCipherSalsa20Test, infos) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    EXPECT_STREQ(&quot;salsa20&quot;, cipher.getName());
    EXPECT_EQ(1, cipher.getBlockSize());
}

TEST(StreamCipherSalsa20Test, isValidKeyLength) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    EXPECT_TRUE(cipher.isValidKeyLength(16));
    EXPECT_TRUE(cipher.isValidKeyLength(32));
    EXPECT_FALSE(cipher.isValidKeyLength(9));
    EXPECT_FALSE(cipher.isValidKeyLength(0));
    EXPECT_FALSE(cipher.isValidKeyLength(33));
}

TEST(StreamCipherSalsa20Test, isValidIvLength) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    EXPECT_TRUE(cipher.isValidIvLength(8));
    EXPECT_FALSE(cipher.isValidIvLength(16));
    EXPECT_FALSE(cipher.isValidIvLength(17));
}

TEST(StreamCipherSalsa20Test, setGetKey) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    // build keys
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0102030405060708090a0b0c0d0e0f10&quot;, 32, &amp;key, keyLength);

    // set/get keys
    size_t key0Length = cipher.getKeyLength();

    cipher.setKey(key, keyLength);
    size_t keyGetLength = cipher.getKeyLength();
    byte keyGet[keyGetLength];
    cipher.getKey(keyGet);

    // test keys
    EXPECT_EQ(0, key0Length);
    EXPECT_BYTE_ARRAY_EQ(key, keyLength, keyGet, keyGetLength);

    delete[] key;
}

TEST(StreamCipherSalsa20Test, setGetIv) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    // build iv
    byte *iv;
    size_t ivLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0102030405060708&quot;, 16, &amp;iv, ivLength);

    // set/get iv
    size_t iv0Length = cipher.getIvLength();

    cipher.setIv(iv, ivLength);
    size_t ivGetLength = cipher.getIvLength();
    byte ivGet[ivGetLength];
    cipher.getIv(ivGet);

    // test ivs
    EXPECT_EQ(0, iv0Length);
    EXPECT_BYTE_ARRAY_EQ(iv, ivLength, ivGet, ivGetLength);

    delete[] iv;
}

TEST(StreamCipherSalsa20Test, encrypt) {
    CryptoppApi::StreamCipherSalsa20 cipher;
    size_t dataSize = 16;

    byte output1[dataSize];
    byte output2[dataSize];
    byte *expected1;
    byte *expected2;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;a7c083feb7aabbff1122334455667788&quot;, 32, &amp;key, keyLength);

<A NAME="3"></A>    // build iv
    byte *iv;
    size_t ivLength = 0;
<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match164-1.html#3',3,'match164-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    CryptoppApi::HexUtils::hex2bin(&quot;0011223344556677&quot;, 16, &amp;iv, ivLength);

    // build block
    byte *block;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;00000000000000000000000000000000&quot;, 32, &amp;block, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;03ad21c7d699f686d0039c12603242bf&quot;, 32, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;a566b2365dfb197b61a549b299e2149a&quot;, 32, &amp;expected2, dummyLength);
    cipher.setKey(key, keyLength);
    cipher.setIv(iv, ivLength);
    cipher.encrypt(block, output1, dataSize);
    cipher.encrypt(block, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected1, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected2, dataSize, output2, dataSize);

    delete[] expected1;
    delete[] expected2;
    delete[] key;
    delete[] iv;
    delete[] block;</B></FONT>
}

TEST(StreamCipherSalsa20Test, decrypt) {
    CryptoppApi::StreamCipherSalsa20 cipher;
    size_t dataSize = 16;

    byte output1[dataSize];
    byte output2[dataSize];
    byte *block1;
    byte *block2;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;a7c083feb7aabbff1122334455667788&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0011223344556677&quot;, 16, &amp;iv, ivLength);

    // build expected data
    byte *expected;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;00000000000000000000000000000000&quot;, 32, &amp;expected, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;03ad21c7d699f686d0039c12603242bf&quot;, 32, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;a566b2365dfb197b61a549b299e2149a&quot;, 32, &amp;block2, dummyLength);
    cipher.setKey(key, keyLength);
    cipher.setIv(iv, ivLength);
    cipher.decrypt(block1, output1, dataSize);
    cipher.decrypt(block2, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected, dataSize, output2, dataSize);

    delete[] block1;
    delete[] block2;
    delete[] key;
    delete[] iv;
    delete[] expected;
}

TEST(StreamCipherSalsa20Test, encrypt12Rounds) {
    CryptoppApi::StreamCipherSalsa20 cipher(12);
    size_t dataSize = 16;

    byte output1[dataSize];
    byte output2[dataSize];
    byte *expected1;
    byte *expected2;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;a7c083feb7aabbff1122334455667788&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0011223344556677&quot;, 16, &amp;iv, ivLength);

    // build block
    byte *block;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;00000000000000000000000000000000&quot;, 32, &amp;block, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;c7619d385ff57fad9c9ab9e7d2fa6334&quot;, 32, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;9067a70e21e095f254c482f8e0fc2161&quot;, 32, &amp;expected2, dummyLength);
    cipher.setKey(key, keyLength);
    cipher.setIv(iv, ivLength);
    cipher.encrypt(block, output1, dataSize);
    cipher.encrypt(block, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected1, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected2, dataSize, output2, dataSize);

    delete[] expected1;
    delete[] expected2;
    delete[] key;
    delete[] iv;
    delete[] block;
}

TEST(StreamCipherSalsa20Test, decrypt12Rounds) {
    CryptoppApi::StreamCipherSalsa20 cipher(12);
    size_t dataSize = 16;

    byte output1[dataSize];
    byte output2[dataSize];
    byte *block1;
    byte *block2;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;a7c083feb7aabbff1122334455667788&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0011223344556677&quot;, 16, &amp;iv, ivLength);

    // build expected data
    byte *expected;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;00000000000000000000000000000000&quot;, 32, &amp;expected, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;c7619d385ff57fad9c9ab9e7d2fa6334&quot;, 32, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;9067a70e21e095f254c482f8e0fc2161&quot;, 32, &amp;block2, dummyLength);
    cipher.setKey(key, keyLength);
    cipher.setIv(iv, ivLength);
    cipher.decrypt(block1, output1, dataSize);
    cipher.decrypt(block2, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected, dataSize, output2, dataSize);

    delete[] block1;
    delete[] block2;
    delete[] key;
    delete[] iv;
    delete[] expected;
}

TEST(StreamCipherSalsa20Test, encrypt8Rounds) {
    CryptoppApi::StreamCipherSalsa20 cipher(8);
    size_t dataSize = 16;

    byte output1[dataSize];
    byte output2[dataSize];
    byte *expected1;
    byte *expected2;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;a7c083feb7aabbff1122334455667788&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0011223344556677&quot;, 16, &amp;iv, ivLength);

    // build block
    byte *block;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;00000000000000000000000000000000&quot;, 32, &amp;block, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;4e26530489778baff97e6c8c6f650e3f&quot;, 32, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;f9e95b4282bac9253d552bad7f7890a6&quot;, 32, &amp;expected2, dummyLength);
    cipher.setKey(key, keyLength);
    cipher.setIv(iv, ivLength);
    cipher.encrypt(block, output1, dataSize);
    cipher.encrypt(block, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected1, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected2, dataSize, output2, dataSize);

    delete[] expected1;
    delete[] expected2;
    delete[] key;
    delete[] iv;
    delete[] block;
}

TEST(StreamCipherSalsa20Test, decrypt8Rounds) {
    CryptoppApi::StreamCipherSalsa20 cipher(8);
    size_t dataSize = 16;

    byte output1[dataSize];
    byte output2[dataSize];
    byte *block1;
    byte *block2;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;a7c083feb7aabbff1122334455667788&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0011223344556677&quot;, 16, &amp;iv, ivLength);

    // build expected data
    byte *expected;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;00000000000000000000000000000000&quot;, 32, &amp;expected, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;4e26530489778baff97e6c8c6f650e3f&quot;, 32, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;f9e95b4282bac9253d552bad7f7890a6&quot;, 32, &amp;block2, dummyLength);
    cipher.setKey(key, keyLength);
    cipher.setIv(iv, ivLength);
    cipher.decrypt(block1, output1, dataSize);
    cipher.decrypt(block2, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected, dataSize, output2, dataSize);

    delete[] block1;
    delete[] block2;
    delete[] key;
    delete[] iv;
    delete[] expected;
<A NAME="0"></A>}

TEST(StreamCipherSalsa20Test, restartEncryption) {
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match164-1.html#0',3,'match164-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    CryptoppApi::StreamCipherSalsa20 cipher;
    size_t dataSize = 16;

    byte output1[dataSize];
    byte output2[dataSize];
    byte *expected;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;a7c083feb7aabbff1122334455667788&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;0011223344556677&quot;, 16, &amp;iv, ivLength);
    cipher.setIv(iv, ivLength);

    // build blocks
    byte *block;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;00000000000000000000000000000000&quot;, 32, &amp;block, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;03ad21c7d699f686d0039c12603242bf&quot;, 32, &amp;expected, dummyLength);
    cipher.setKey(key, keyLength);
    cipher.encrypt(block, output1, dataSize);
    cipher.restart();
    cipher.encrypt(block, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected, dataSize, output2, dataSize);


    delete[] key;
    delete[] iv;
    delete[] block;
    delete[] expected;
}
<A NAME="2"></A>
TEST(StreamCipherSalsa20Test, restartDecryption) {
    CryptoppApi::StreamCipherSalsa20 cipher;</B></FONT>
<FONT color="#980517"><A HREF="javascript:ZweiFrames('match164-1.html#2',3,'match164-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    size_t dataSize = 16;

    byte output1[dataSize];
    byte output2[dataSize];
    byte *expected1;
    byte *expected2;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;a7c083feb7aabbff1122334455667788&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;0011223344556677&quot;, 16, &amp;iv, ivLength);
    cipher.setIv(iv, ivLength);

    // build blocks
    byte *block1;
    byte *block2;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;03ad21c7d699f686d0039c12603242bf&quot;, 32, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;a566b2365dfb197b61a549b299e2149a&quot;, 32, &amp;block2, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;00000000000000000000000000000000&quot;, 32, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;a6cb93f18b62effdb1a6d5a0f9d05625&quot;, 32, &amp;expected2, dummyLength);</B></FONT>
    cipher.setKey(key, keyLength);
    cipher.decrypt(block1, output1, dataSize);
    cipher.restart();
    cipher.decrypt(block2, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected1, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected2, dataSize, output2, dataSize);

    delete[] key;
    delete[] iv;
    delete[] block1;
    delete[] block2;
    delete[] expected1;
    delete[] expected2;
<A NAME="1"></A>}

TEST(StreamCipherSalsa20Test, largeData) {
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match164-1.html#1',3,'match164-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    CryptoppApi::StreamCipherSalsa20 cipher;

    std::string key(&quot;1234567890123456&quot;);
    std::string iv(&quot;12345678&quot;);
    cipher.setKey(reinterpret_cast&lt;const byte*&gt;(key.c_str()), key.length());
    cipher.setIv(reinterpret_cast&lt;const byte*&gt;(iv.c_str()), iv.length());

    size_t dataSize = 10485760;
    byte *input     = new byte[dataSize];
    byte *output    = new byte[dataSize];
    memset(input, 125, dataSize);
    cipher.encrypt(input, output, dataSize);
    cipher.decrypt(input, output, dataSize);

    delete[] input;
    delete[] output;
}

TEST(StreamCipherSalsa20Test, isStream) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    std::string key(&quot;1234567890123456&quot;);
    std::string iv(&quot;12345678&quot;);</B></FONT>
    cipher.setKey(reinterpret_cast&lt;const byte*&gt;(key.c_str()), key.length());
    cipher.setIv(reinterpret_cast&lt;const byte*&gt;(iv.c_str()), iv.length());

    std::string dataStr(&quot;12345678901234567&quot;);
    const byte *data    = reinterpret_cast&lt;const byte*&gt;(dataStr.c_str());
    size_t dataLength   = dataStr.length();
    byte output[dataLength];

    cipher.encrypt(data, output, dataLength);
    cipher.decrypt(data, output, dataLength);
}

TEST(StreamCipherSalsa20Test, invalidKey) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    byte key1[33];
    byte key2[0];
    memset(key1, 0, 33);

    EXPECT_THROW_MSG(cipher.setKey(key1, 33), CryptoppApi::Exception, &quot;33 is not a valid key length&quot;);
    EXPECT_THROW_MSG(cipher.setKey(key2, 0), CryptoppApi::Exception, &quot;a key is required&quot;);
}

TEST(StreamCipherSalsa20Test, invalidIv) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    byte iv1[] = {45, 12, 14};
    byte iv2[0];

    EXPECT_THROW_MSG(cipher.setIv(iv1, 3), CryptoppApi::Exception, &quot;3 is not a valid initialization vector length&quot;);
    EXPECT_THROW_MSG(cipher.setIv(iv2, 0), CryptoppApi::Exception, &quot;an initialization vector is required&quot;);
}

TEST(StreamCipherSalsa20Test, cryptWithoutKey) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    size_t inputLength = cipher.getBlockSize();
    byte input[inputLength];
    byte output[inputLength];

    EXPECT_THROW_MSG(cipher.encrypt(input, output, inputLength), CryptoppApi::Exception, &quot;a key is required&quot;);
    EXPECT_THROW_MSG(cipher.decrypt(input, output, inputLength), CryptoppApi::Exception, &quot;a key is required&quot;);
}

TEST(StreamCipherSalsa20Test, cryptWithoutIv) {
    CryptoppApi::StreamCipherSalsa20 cipher;

    std::string key(&quot;1234567890123456&quot;);
    cipher.setKey(reinterpret_cast&lt;const byte*&gt;(key.c_str()), key.length());

    size_t inputLength = cipher.getBlockSize();
    byte input[inputLength];
    byte output[inputLength];

    EXPECT_THROW_MSG(cipher.encrypt(input, output, inputLength), CryptoppApi::Exception, &quot;an initialization vector is required&quot;);
    EXPECT_THROW_MSG(cipher.decrypt(input, output, inputLength), CryptoppApi::Exception, &quot;an initialization vector is required&quot;);
}

TEST(StreamCipherSalsa20Test, invalidRoundNumber) {
    CryptoppApi::StreamCipherSalsa20 cipher;
    EXPECT_THROW_MSG(cipher.setRounds(5), CryptoppApi::Exception, &quot;number of rounds must be one of 8, 12 or 20&quot;);
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_api_authenticated_symmetric_cipher_eax.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * This file is part of cryptopp-bindings-api.
 *
 * (c) Stephen Berquet &lt;stephen.berquet@gmail.com&gt;
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

#include &quot;src/exception/api_exception.h&quot;
#include &quot;src/symmetric/cipher/authenticated/api_authenticated_symmetric_cipher_eax.h&quot;
#include &quot;src/symmetric/cipher/block/api_block_cipher_aes.h&quot;
#include &quot;src/utils/api_hex_utils.h&quot;
#include &quot;tests/test_api_assertions.h&quot;
#include &lt;gtest/gtest.h&gt;

TEST(AuthenticatedSymmetricCipherEaxTest, inheritance) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::SymmetricCipherInterface*&gt;(&amp;mode));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::SymmetricTransformationInterface*&gt;(&amp;mode));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::AuthenticatedSymmetricCipherInterface*&gt;(&amp;mode));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::AuthenticatedSymmetricCipherAbstract*&gt;(&amp;mode));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::SymmetricKeyAbstract*&gt;(&amp;mode));
    EXPECT_TRUE(0 != dynamic_cast&lt;CryptoppApi::SymmetricIvAbstract*&gt;(&amp;mode));
}

TEST(AuthenticatedSymmetricCipherEaxTest, infos) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    EXPECT_STREQ(&quot;eax(aes)&quot;, mode.getName());
    EXPECT_EQ(1, mode.getBlockSize());
    EXPECT_EQ(16, mode.getDigestSize());
}

TEST(AuthenticatedSymmetricCipherEaxTest, isValidKeyLength) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    EXPECT_TRUE(mode.isValidKeyLength(16));
    EXPECT_FALSE(mode.isValidKeyLength(15));
    EXPECT_FALSE(mode.isValidKeyLength(17));

    EXPECT_TRUE(mode.isValidKeyLength(24));
    EXPECT_FALSE(mode.isValidKeyLength(23));
    EXPECT_FALSE(mode.isValidKeyLength(25));

    EXPECT_TRUE(mode.isValidKeyLength(32));
    EXPECT_FALSE(mode.isValidKeyLength(31));
    EXPECT_FALSE(mode.isValidKeyLength(33));
}

TEST(AuthenticatedSymmetricCipherEaxTest, isValidIvLength) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    EXPECT_TRUE(mode.isValidIvLength(0));
    EXPECT_TRUE(mode.isValidIvLength(2));
    EXPECT_TRUE(mode.isValidIvLength(4));
    EXPECT_TRUE(mode.isValidIvLength(56));
    EXPECT_TRUE(mode.isValidIvLength(1256));
}

TEST(AuthenticatedSymmetricCipherEaxTest, setGetKey) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    // build keys
    byte *key128;
    byte *key192;
    byte *key256;
    size_t key128Length = 0;
    size_t key192Length = 0;
    size_t key256Length = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0102030405060708090a0b0c0d0e0f10&quot;, 32, &amp;key128, key128Length);
    CryptoppApi::HexUtils::hex2bin(&quot;0102030405060708090a0b0c0d0e0f101112131415161718&quot;, 48, &amp;key192, key192Length);
    CryptoppApi::HexUtils::hex2bin(&quot;0102030405060708090a0b0c0d0e0f1011121314151617181901020304050607&quot;, 64, &amp;key256, key256Length);

    // set/get keys
    size_t key0Length = mode.getKeyLength();

    mode.setKey(key128, key128Length);
    size_t key128GetLength = mode.getKeyLength();
    byte key128Get[key128GetLength];
    mode.getKey(key128Get);

    mode.setKey(key192, key192Length);
    size_t key192GetLength = mode.getKeyLength();
    byte key192Get[key192GetLength];
    mode.getKey(key192Get);

    mode.setKey(key256, key256Length);
    size_t key256GetLength = mode.getKeyLength();
    byte key256Get[key256GetLength];
    mode.getKey(key256Get);

    // test keys
    EXPECT_EQ(0, key0Length);
    EXPECT_BYTE_ARRAY_EQ(key128, key128Length, key128Get, key128GetLength);
    EXPECT_BYTE_ARRAY_EQ(key192, key192Length, key192Get, key192GetLength);
    EXPECT_BYTE_ARRAY_EQ(key256, key256Length, key256Get, key256GetLength);

    delete[] key128;
    delete[] key192;
    delete[] key256;
}

TEST(AuthenticatedSymmetricCipherEaxTest, setGetIv) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    // build iv
    byte *iv;
    size_t ivLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;0102030405060708090a0b0c0d0e0f10&quot;, 32, &amp;iv, ivLength);

    // set/get iv
    size_t iv0Length = mode.getIvLength();

    mode.setIv(iv, ivLength);
    size_t ivGetLength = mode.getIvLength();
    byte ivGet[ivGetLength];
    mode.getIv(ivGet);

    // test ivs
    EXPECT_EQ(0, iv0Length);
    EXPECT_BYTE_ARRAY_EQ(iv, ivLength, ivGet, ivGetLength);

    delete[] iv;
}

TEST(AuthenticatedSymmetricCipherEaxTest, encrypt) {
<A NAME="2"></A>    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);
    size_t dataSize     = 32;
<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match164-0.html#2',2,'match164-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    size_t digestSize   = mode.getDigestSize();

    byte output1[dataSize];
    byte output2[dataSize];
    byte output3[digestSize];
    byte *expected1;
    byte *expected2;
    byte *expected3;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;feffe9928665731c6d6a8f9467308308&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;cafebabefacedbaddecaf888&quot;, 24, &amp;iv, ivLength);
    mode.setIv(iv, ivLength);

    // build blocks
    byte *block1;
    byte *block2;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;d9313225f88406e5a55909c5aff5269a86a7a9531534f7da2e4c303d8a318a72&quot;, 64, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;1c3c0c95956809532fcf0e2449a6b525b16aedf5aa0de657ba637b391aafd255&quot;, 64, &amp;block2, dummyLength);

    // aes128
    CryptoppApi::HexUtils::hex2bin(&quot;206760741b9e5b75eaa69c401709f41b67b9b92d559953f31a892d17619f14ee&quot;, 64, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;8ca8c56d81522be3831d4503b1903302079b7863c7e4d8869196996e6061c60a&quot;, 64, &amp;expected2, dummyLength);</B></FONT>
    CryptoppApi::HexUtils::hex2bin(&quot;8480cf5fd94501ad47d870eafd4acdf4&quot;, 32, &amp;expected3, dummyLength);
    mode.setKey(key, keyLength);
    mode.encrypt(block1, output1, dataSize);
    mode.encrypt(block2, output2, dataSize);
    mode.finalizeEncryption(output3);
    EXPECT_BYTE_ARRAY_EQ(expected1, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected2, dataSize, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected3, digestSize, output3, digestSize);

    delete[] expected1;
    delete[] expected2;
    delete[] expected3;
    delete[] iv;
    delete[] key;
    delete[] block1;
    delete[] block2;
}

TEST(AuthenticatedSymmetricCipherEaxTest, decrypt) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);
    size_t dataSize     = 32;
    size_t digestSize   = mode.getDigestSize();

    byte output1[dataSize];
    byte output2[dataSize];
    byte output3[digestSize];
    byte *block1;
    byte *block2;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;feffe9928665731c6d6a8f9467308308&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;cafebabefacedbaddecaf888&quot;, 24, &amp;iv, ivLength);
    mode.setIv(iv, ivLength);

    // build expected data
    byte *expected1;
    byte *expected2;
    byte *expected3;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;d9313225f88406e5a55909c5aff5269a86a7a9531534f7da2e4c303d8a318a72&quot;, 64, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;1c3c0c95956809532fcf0e2449a6b525b16aedf5aa0de657ba637b391aafd255&quot;, 64, &amp;expected2, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;8480cf5fd94501ad47d870eafd4acdf4&quot;, 32, &amp;expected3, dummyLength);

    // aes128
    CryptoppApi::HexUtils::hex2bin(&quot;206760741b9e5b75eaa69c401709f41b67b9b92d559953f31a892d17619f14ee&quot;, 64, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;8ca8c56d81522be3831d4503b1903302079b7863c7e4d8869196996e6061c60a&quot;, 64, &amp;block2, dummyLength);
    mode.setKey(key, keyLength);
    mode.decrypt(block1, output1, dataSize);
    mode.decrypt(block2, output2, dataSize);
    mode.finalizeDecryption(output3);
    EXPECT_BYTE_ARRAY_EQ(expected1, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected2, dataSize, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected3, digestSize, output3, digestSize);

    delete[] block1;
    delete[] block2;
    delete[] iv;
    delete[] key;
    delete[] expected1;
    delete[] expected2;
    delete[] expected3;
}

TEST(AuthenticatedSymmetricCipherEaxTest, restartEncryption) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);
    size_t dataSize     = 32;
    size_t digestSize   = mode.getDigestSize();

    byte output1[dataSize];
    byte output2[dataSize];
    byte output3[digestSize];
    byte *expected1;
    byte *expected2;
    byte *expected3;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;feffe9928665731c6d6a8f9467308308&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;cafebabefacedbaddecaf888&quot;, 24, &amp;iv, ivLength);
    mode.setIv(iv, ivLength);

    // build blocks
    byte *block1;
    byte *block2;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;d9313225f88406e5a55909c5aff5269a86a7a9531534f7da2e4c303d8a318a72&quot;, 64, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;d9313225f88406e5a55909c5aff5269a86a7a9531534f7da2e4c303d8a318a72&quot;, 64, &amp;block2, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;206760741b9e5b75eaa69c401709f41b67b9b92d559953f31a892d17619f14ee&quot;, 64, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;206760741b9e5b75eaa69c401709f41b67b9b92d559953f31a892d17619f14ee&quot;, 64, &amp;expected2, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;c465d44f42020a050abb97ca55c83fc0&quot;, 32, &amp;expected3, dummyLength);
    mode.setKey(key, keyLength);
    mode.encrypt(block1, output1, dataSize);
    mode.restart();
    mode.encrypt(block2, output2, dataSize);
    mode.finalizeEncryption(output3);
    EXPECT_BYTE_ARRAY_EQ(expected1, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected2, dataSize, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected3, digestSize, output3, digestSize);

    delete[] expected1;
    delete[] expected2;
    delete[] expected3;
    delete[] key;
    delete[] iv;
    delete[] block1;
    delete[] block2;
}

TEST(AuthenticatedSymmetricCipherEaxTest, restartDecryption) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);
    size_t dataSize     = 32;
    size_t digestSize   = mode.getDigestSize();

    byte output1[dataSize];
    byte output2[dataSize];
    byte output3[digestSize];
    byte *expected1;
    byte *expected2;
    byte *expected3;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;feffe9928665731c6d6a8f9467308308&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;cafebabefacedbaddecaf888&quot;, 24, &amp;iv, ivLength);
    mode.setIv(iv, ivLength);

    // build blocks
    byte *block1;
    byte *block2;
    size_t dummyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;206760741b9e5b75eaa69c401709f41b67b9b92d559953f31a892d17619f14ee&quot;, 64, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;206760741b9e5b75eaa69c401709f41b67b9b92d559953f31a892d17619f14ee&quot;, 64, &amp;block2, dummyLength);

    // calculate actual data
    CryptoppApi::HexUtils::hex2bin(&quot;d9313225f88406e5a55909c5aff5269a86a7a9531534f7da2e4c303d8a318a72&quot;, 64, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;d9313225f88406e5a55909c5aff5269a86a7a9531534f7da2e4c303d8a318a72&quot;, 64, &amp;expected2, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;c465d44f42020a050abb97ca55c83fc0&quot;, 32, &amp;expected3, dummyLength);
    mode.setKey(key, keyLength);
    mode.decrypt(block1, output1, dataSize);
    mode.restart();
    mode.decrypt(block2, output2, dataSize);
    mode.finalizeDecryption(output3);
    EXPECT_BYTE_ARRAY_EQ(expected1, dataSize, output1, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected2, dataSize, output2, dataSize);
    EXPECT_BYTE_ARRAY_EQ(expected3, digestSize, output3, digestSize);

    delete[] expected1;
    delete[] expected2;
    delete[] expected3;
    delete[] key;
    delete[] iv;
    delete[] block1;
    delete[] block2;
}

TEST(AuthenticatedSymmetricCipherEaxTest, encryptWithAad) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);
    size_t dataSize     = 32;
    size_t digestSize   = mode.getDigestSize();

    byte output1[dataSize];
    byte output2[dataSize];
    byte output3[digestSize];
    byte *expected1;
    byte *expected2;
    byte *expected3;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;feffe9928665731c6d6a8f9467308308&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;cafebabefacedbaddecaf888&quot;, 24, &amp;iv, ivLength);
    mode.setIv(iv, ivLength);

    // build blocks
    byte *block1;
    byte *block2;
    byte *aad;
    size_t dummyLength  = 0;
    size_t block1Length = 0;
    size_t block2Length = 0;
    size_t aadLength    = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;d9313225f88406e5a55909c5aff5269a86a7a9531534f7da2e4c303d8a318a72&quot;, 64, &amp;block1, block1Length);
    CryptoppApi::HexUtils::hex2bin(&quot;1c3c0c95956809532fcf0e2449a6b525b16aedf5aa0de657ba637b39&quot;, 56, &amp;block2, block2Length);
    CryptoppApi::HexUtils::hex2bin(&quot;feedfacedeadbeeffeedfacedeadbeefabaddad2&quot;, 40, &amp;aad, aadLength);

    // aes128
    CryptoppApi::HexUtils::hex2bin(&quot;206760741b9e5b75eaa69c401709f41b67b9b92d559953f31a892d17619f14ee&quot;, 64, &amp;expected1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;8ca8c56d81522be3831d4503b1903302079b7863c7e4d8869196996e6061c60a&quot;, 56, &amp;expected2, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;86465458445f4cd43787dadcebb8ce97&quot;, 32, &amp;expected3, dummyLength);
    mode.setKey(key, keyLength);
    mode.addEncryptionAdditionalData(aad, aadLength);
    mode.encrypt(block1, output1, block1Length);
    mode.encrypt(block2, output2, block2Length);
    mode.finalizeEncryption(output3);
    EXPECT_BYTE_ARRAY_EQ(expected1, block1Length, output1, block1Length);
    EXPECT_BYTE_ARRAY_EQ(expected2, block2Length, output2, block2Length);
    EXPECT_BYTE_ARRAY_EQ(expected3, digestSize, output3, digestSize);

    delete[] expected1;
    delete[] expected2;
    delete[] expected3;
    delete[] iv;
    delete[] key;
    delete[] block1;
    delete[] block2;
    delete[] aad;
}

TEST(AuthenticatedSymmetricCipherEaxTest, decryptWithAad) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);
    size_t dataSize     = 32;
    size_t digestSize   = mode.getDigestSize();

    byte output1[dataSize];
    byte output2[dataSize];
    byte output3[digestSize];
    byte *block1;
    byte *block2;
    byte *aad;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;feffe9928665731c6d6a8f9467308308&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;cafebabefacedbaddecaf888&quot;, 24, &amp;iv, ivLength);
    mode.setIv(iv, ivLength);

    // build expected data
    byte *expected1;
    byte *expected2;
    byte *expected3;
    size_t dummyLength      = 0;
    size_t expected1Length  = 0;
<A NAME="3"></A>    size_t expected2Length  = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;d9313225f88406e5a55909c5aff5269a86a7a9531534f7da2e4c303d8a318a72&quot;, 64, &amp;expected1, expected1Length);
    CryptoppApi::HexUtils::hex2bin(&quot;1c3c0c95956809532fcf0e2449a6b525b16aedf5aa0de657ba637b39&quot;, 56, &amp;expected2, expected2Length);
<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match164-0.html#3',2,'match164-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    CryptoppApi::HexUtils::hex2bin(&quot;86465458445f4cd43787dadcebb8ce97&quot;, 32, &amp;expected3, dummyLength);

    // aes128
    size_t aadLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;206760741b9e5b75eaa69c401709f41b67b9b92d559953f31a892d17619f14ee&quot;, 64, &amp;block1, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;8ca8c56d81522be3831d4503b1903302079b7863c7e4d8869196996e6061c60a&quot;, 56, &amp;block2, dummyLength);
    CryptoppApi::HexUtils::hex2bin(&quot;feedfacedeadbeeffeedfacedeadbeefabaddad2&quot;, 40, &amp;aad, aadLength);
    mode.setKey(key, keyLength);
    mode.addDecryptionAdditionalData(aad, aadLength);
    mode.decrypt(block1, output1, expected1Length);
    mode.decrypt(block2, output2, expected2Length);
    mode.finalizeDecryption(output3);
    EXPECT_BYTE_ARRAY_EQ(expected1, expected1Length, output1, expected1Length);
    EXPECT_BYTE_ARRAY_EQ(expected2, expected2Length, output2, expected2Length);
    EXPECT_BYTE_ARRAY_EQ(expected3, digestSize, output3, digestSize);

    delete[] block1;
    delete[] block2;
    delete[] aad;
    delete[] iv;
    delete[] key;</B></FONT>
    delete[] expected1;
    delete[] expected2;
    delete[] expected3;
}
<A NAME="0"></A>
TEST(AuthenticatedSymmetricCipherEaxTest, encryptAadOnly) {
    CryptoppApi::BlockCipherAes cipher;
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match164-0.html#0',2,'match164-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);
    size_t digestSize = mode.getDigestSize();

    byte output[digestSize];
    byte *expected;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;77be63708971c4e240d1cb79e8d77feb&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;e0e00f19fed7ba0136a797f3&quot;, 24, &amp;iv, ivLength);
    mode.setIv(iv, ivLength);

    // build aad
    byte *aad;
    size_t aadLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;7a43ec1d9c0a5a78a0b16533a6213cab&quot;, 32, &amp;aad, aadLength);

    // aes128
    CryptoppApi::HexUtils::hex2bin(&quot;315156e3ff92aba9ea818d18c08e6edc&quot;, 32, &amp;expected, digestSize);
    mode.setKey(key, keyLength);
    mode.addEncryptionAdditionalData(aad, aadLength);
    mode.finalizeEncryption(output);
    EXPECT_BYTE_ARRAY_EQ(expected, digestSize, output, digestSize);

    delete[] expected;
    delete[] iv;
    delete[] key;
    delete[] aad;
}

TEST(AuthenticatedSymmetricCipherEaxTest, decryptAadOnly) {
    CryptoppApi::BlockCipherAes cipher;</B></FONT>
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);
    size_t digestSize = mode.getDigestSize();

    byte output[digestSize];
    byte *expected;

    // build key
    byte *key;
    size_t keyLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;77be63708971c4e240d1cb79e8d77feb&quot;, 32, &amp;key, keyLength);

    // build iv
    byte *iv;
    size_t ivLength;
    CryptoppApi::HexUtils::hex2bin(&quot;e0e00f19fed7ba0136a797f3&quot;, 24, &amp;iv, ivLength);
    mode.setIv(iv, ivLength);

    // build aad
    byte *aad;
    size_t aadLength = 0;
    CryptoppApi::HexUtils::hex2bin(&quot;7a43ec1d9c0a5a78a0b16533a6213cab&quot;, 32, &amp;aad, aadLength);

    // aes128
    CryptoppApi::HexUtils::hex2bin(&quot;315156e3ff92aba9ea818d18c08e6edc&quot;, 32, &amp;expected, digestSize);
    mode.setKey(key, keyLength);
    mode.addDecryptionAdditionalData(aad, aadLength);
    mode.finalizeDecryption(output);
    EXPECT_BYTE_ARRAY_EQ(expected, digestSize, output, digestSize);

    delete[] expected;
    delete[] iv;
    delete[] key;
    delete[] aad;
}
<A NAME="1"></A>
TEST(AuthenticatedSymmetricCipherEaxTest, largeData) {
    CryptoppApi::BlockCipherAes cipher;
<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match164-0.html#1',2,'match164-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    std::string key(&quot;1234567890123456&quot;);
    std::string iv(&quot;1234567890123456&quot;);
    mode.setKey(reinterpret_cast&lt;const byte*&gt;(key.c_str()), key.length());
    mode.setIv(reinterpret_cast&lt;const byte*&gt;(iv.c_str()), iv.length());

    size_t dataSize = 10485760;
    byte *input     = new byte[dataSize];
    byte *output    = new byte[dataSize];
    memset(input, 125, dataSize);
    mode.addEncryptionAdditionalData(input, dataSize);
    mode.addDecryptionAdditionalData(input, dataSize);
    mode.encrypt(input, output, dataSize);
    mode.decrypt(input, output, dataSize);

    delete[] input;
    delete[] output;
}

TEST(AuthenticatedSymmetricCipherEaxTest, isStream) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    std::string key(&quot;1234567890123456&quot;);</B></FONT>
    std::string iv(&quot;1234567890123456&quot;);
    mode.setKey(reinterpret_cast&lt;const byte*&gt;(key.c_str()), key.length());
    mode.setIv(reinterpret_cast&lt;const byte*&gt;(iv.c_str()), iv.length());

    std::string dataStr(&quot;12345678901234567&quot;);
    const byte *data    = reinterpret_cast&lt;const byte*&gt;(dataStr.c_str());
    size_t dataLength   = dataStr.length();
    byte output[dataLength];

    mode.encrypt(data, output, dataLength);
    mode.decrypt(data, output, dataLength);
}

TEST(AuthenticatedSymmetricCipherEaxTest, invalidKey) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    byte key1[] = {45, 12, 14};
    byte key2[0];

    EXPECT_THROW_MSG(mode.setKey(key1, 3), CryptoppApi::Exception, &quot;3 is not a valid key length&quot;);
    EXPECT_THROW_MSG(mode.setKey(key2, 0), CryptoppApi::Exception, &quot;a key is required&quot;);
}

TEST(AuthenticatedSymmetricCipherEaxTest, cryptWithoutKey) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    size_t inputLength = mode.getBlockSize();
    byte input[inputLength];
    byte output[inputLength];

    EXPECT_THROW_MSG(mode.encrypt(input, output, inputLength), CryptoppApi::Exception, &quot;a key is required&quot;);
    EXPECT_THROW_MSG(mode.decrypt(input, output, inputLength), CryptoppApi::Exception, &quot;a key is required&quot;);
}

TEST(AuthenticatedSymmetricCipherEaxTest, cryptWithoutIv) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    std::string key(&quot;1234567890123456&quot;);
    mode.setKey(reinterpret_cast&lt;const byte*&gt;(key.c_str()), key.length());

    size_t inputLength = mode.getBlockSize();
    byte input[inputLength];
    byte output[inputLength];

    mode.encrypt(input, output, inputLength);
    mode.decrypt(input, output, inputLength);
}

TEST(AuthenticatedSymmetricCipherEaxTest, cryptAadWithoutKey) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    byte input[10];

    EXPECT_THROW_MSG(mode.addEncryptionAdditionalData(input, 10), CryptoppApi::Exception, &quot;a key is required&quot;);
    EXPECT_THROW_MSG(mode.addDecryptionAdditionalData(input, 10), CryptoppApi::Exception, &quot;a key is required&quot;);
}

TEST(AuthenticatedSymmetricCipherEaxTest, finalizeWithoutKey) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    byte output[mode.getDigestSize()];

    EXPECT_THROW_MSG(mode.finalizeEncryption(output), CryptoppApi::Exception, &quot;a key is required&quot;);
    EXPECT_THROW_MSG(mode.finalizeDecryption(output), CryptoppApi::Exception, &quot;a key is required&quot;);
}

TEST(AuthenticatedSymmetricCipherEaxTest, cryptBeforeAad) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode(&amp;cipher);

    std::string key(&quot;1234567890123456&quot;);
    std::string iv(&quot;1234567890123456&quot;);
    mode.setKey(reinterpret_cast&lt;const byte*&gt;(key.c_str()), key.length());
    mode.setIv(reinterpret_cast&lt;const byte*&gt;(iv.c_str()), iv.length());

    size_t inputLength = mode.getBlockSize();
    byte input[inputLength];
    byte output[inputLength];

    mode.encrypt(input, output, inputLength);
    mode.decrypt(input, output, inputLength);

    EXPECT_THROW_MSG(mode.addEncryptionAdditionalData(input, inputLength), CryptoppApi::Exception, &quot;additional authenticated data must be added before any encryption&quot;);
    EXPECT_THROW_MSG(mode.addDecryptionAdditionalData(input, inputLength), CryptoppApi::Exception, &quot;additional authenticated data must be added before any decryption&quot;);
}

TEST(AuthenticatedSymmetricCipherEaxTest, keyNotMatchingUnderlyingOne) {
    CryptoppApi::BlockCipherAes cipher;
    CryptoppApi::AuthenticatedSymmetricCipherEax mode1(&amp;cipher);
    CryptoppApi::AuthenticatedSymmetricCipherEax mode2(&amp;cipher);

    std::string iv(&quot;1234567890123456&quot;);
    mode1.setIv(reinterpret_cast&lt;const byte*&gt;(iv.c_str()), iv.length());

    std::string key1(&quot;1234567890123456&quot;);
    std::string key2(&quot;azertyuiopqwerty&quot;);
    std::string key3(&quot;wxcvbnqsdfghjklm&quot;);
    mode1.setKey(reinterpret_cast&lt;const byte*&gt;(key1.c_str()), key1.length());

    size_t inputLength = mode1.getBlockSize();
    byte input[inputLength];
    byte output[inputLength];

    mode2.setKey(reinterpret_cast&lt;const byte*&gt;(key2.c_str()), key2.length());
    EXPECT_THROW_MSG(mode1.encrypt(input, output, inputLength), CryptoppApi::Exception, &quot;key is not matching the one owned by the underlying cipher object&quot;);

    cipher.setKey(reinterpret_cast&lt;const byte*&gt;(key3.c_str()), key3.length());
    EXPECT_THROW_MSG(mode1.encrypt(input, output, inputLength), CryptoppApi::Exception, &quot;key is not matching the one owned by the underlying cipher object&quot;);
}
</PRE>
</div>
  </div>
</body>
</html>
