
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 61, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-euproj.cpp</h3>
            <pre><code>1  #include &quot;euproj.h&quot;
2  #include &quot;graph.h&quot;
3  TStr TEpOrg::GetMultiLnOrgNm(
4   const TStr&amp; OrgNm, const int&amp; MnLnLen, const char&amp; NewLnCh){
5    TChA OrgNmChA=OrgNm;
6    TChA MultiLnOrgNmChA; int LnLen=0;
7    for (int ChN=0; ChN&lt;OrgNmChA.Len(); ChN++){
8      if ((LnLen&gt;MnLnLen)&amp;&amp;(OrgNmChA[ChN]==&#x27; &#x27;)){
9        MultiLnOrgNmChA+=NewLnCh; LnLen=0;
10      } else {
11        MultiLnOrgNmChA+=OrgNmChA[ChN]; LnLen++;
12      }
13    }
14    return MultiLnOrgNmChA;
15  }
16  TStr TEpOrg::GetClbOrgNm(const int&amp; ClbOrgN, const TEpBs* EpBs) const {
17    int ClbOrgId=ClbOrgIdToFqH.GetKey(ClbOrgN);
18    return EpBs-&gt;GetOrg(ClbOrgId)-&gt;GetOrgNm();
19  }
20  int TEpOrg::GetClbOrgFq(const TStr&amp; ClbOrgNm, const TEpBs* EpBs) const {
21    int ClbOrgId=EpBs-&gt;GetOrgId(ClbOrgNm);
22    if (ClbOrgIdToFqH.IsKey(ClbOrgId)){
23      return ClbOrgIdToFqH.GetDat(ClbOrgId);}
24    else {return 0;}
25  }
26  void TEpOrg::GetClbOrgProjNmV(
27   const TStr&amp; ClbOrgNm, TStrV&amp; ProjNmV, const TEpBs* EpBs) const {
28    int ClbOrgId=EpBs-&gt;GetOrgId(ClbOrgNm);
29    ProjNmV=ClbOrgIdToProjNmVH.GetDat(ClbOrgId);
30  }
31  void TEpOrg::AddClbOrg(
32   const TStr&amp; ClbOrgNm, const TStr&amp; ProjNm, const TEpBs* EpBs){
33    int ClbOrgId=EpBs-&gt;GetOrgId(ClbOrgNm);
34    ClbOrgIdToFqH.AddDat(ClbOrgId)++;
35    ClbOrgIdToProjNmVH.AddDat(ClbOrgId).AddSorted(ProjNm);
36    SumClbOrgFq++;
37  }
38  void TEpCountry::AddOrg(const TStr&amp; OrgNm, const TEpBs* EpBs){
39    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
40    OrgIdToFqH.AddDat(OrgId)++;
41  }
42  TStr TEpCountry::GetOrgNm(const int&amp; OrgN, const TEpBs* EpBs) const {
43    int OrgId=OrgIdToFqH.GetKey(OrgN);
44    return EpBs-&gt;GetOrg(OrgId)-&gt;GetOrgNm();
45  }
46  void TEpOfficer::AddOrg(const TStr&amp; OrgNm, const TEpBs* EpBs){
47    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
48    OrgIdToFqH.AddDat(OrgId)++;
49  }
50  void TEpProj::AddOrgNmRole(
51   const TStr&amp; OrgNm, const TStr&amp; OrgRoleNm, const TEpBs* EpBs){
52    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
53    OrgIdRoleKdV.AddMerged(TIntStrKd(OrgId, OrgRoleNm));
54  }
55  TStr TEpProj::GetRole(const TStr&amp; OrgNm, const TEpBs* EpBs) const {
56    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
57    return OrgIdRoleKdV.GetDat(TIntStrKd(OrgId)).Dat;
58  }
59  TStr TEpProj::GetOrgNm(const int&amp; OrgN, const TEpBs* EpBs) const {
60    int OrgId=OrgIdRoleKdV[OrgN].Key;
61    return EpBs-&gt;GetOrg(OrgId)-&gt;GetOrgNm();
62  }
63  void TEpDomain::AddOrg(const TStr&amp; OrgNm, const TEpBs* EpBs){
64    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
65    OrgIdToFqH.AddDat(OrgId)++;
66  }
67  TStr TEpDomain::GetOrgNm(const int&amp; OrgN, const TEpBs* EpBs) const {
68    int OrgId=OrgIdToFqH.GetKey(OrgN);
69    return EpBs-&gt;GetOrg(OrgId)-&gt;GetOrgNm();
70  }
71  bool TEpDomain::IsOrg(const TStr&amp; OrgNm, TInt&amp; OrgFq, const TEpBs* EpBs) const {
72    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
73    return OrgIdToFqH.IsKeyGetDat(OrgId, OrgFq);
74  }
75  void TEpUnit::AddOrg(const TStr&amp; OrgNm, const TEpBs* EpBs){
76    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
77    OrgIdToFqH.AddDat(OrgId)++;
78  }
79  TStr TEpUnit::GetOrgNm(const int&amp; OrgN, const TEpBs* EpBs) const {
80    int OrgId=OrgIdToFqH.GetKey(OrgN);
81    return EpBs-&gt;GetOrg(OrgId)-&gt;GetOrgNm();
82  }
83  bool TEpUnit::IsOrg(const TStr&amp; OrgNm, TInt&amp; OrgFq, const TEpBs* EpBs) const {
84    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
85    return OrgIdToFqH.IsKeyGetDat(OrgId, OrgFq);
86  }
87  TStr TEpBs::GetUnitDNm(const TStr&amp; UnitNm){
88    if (UnitNm==&quot;B1&quot;){return &quot;Health-Applications&quot;;}
89    if (UnitNm==&quot;B2&quot;){return &quot;Handicapped&amp;Eldely&quot;;}
90    if (UnitNm==&quot;B3&quot;){return &quot;eGovernment&quot;;}
91    if (UnitNm==&quot;B4&quot;){return &quot;Environment&quot;;}
92    if (UnitNm==&quot;B5&quot;){return &quot;Transport&amp;Tourism&quot;;}
93    if (UnitNm==&quot;C1&quot;){return &quot;eWork&quot;;}
94    if (UnitNm==&quot;C2&quot;){return &quot;eBusiness&quot;;}
95    if (UnitNm==&quot;C3&quot;){return &quot;eCommerce&quot;;}
96    if (UnitNm==&quot;C4&quot;){return &quot;Trust&amp;Security&quot;;}
97    if (UnitNm==&quot;D1&quot;){return &quot;ePublishing&quot;;}
98    if (UnitNm==&quot;D2&quot;){return &quot;Cultural-Heritage&quot;;}
99    if (UnitNm==&quot;D3&quot;){return &quot;eLearning&quot;;}
100    if (UnitNm==&quot;D4&quot;){return &quot;Linguistics&quot;;}
101    if (UnitNm==&quot;E1&quot;){return &quot;Networks&quot;;}
102    if (UnitNm==&quot;E2&quot;){return &quot;Software&quot;;}
103    if (UnitNm==&quot;E3&quot;){return &quot;Multimedia&amp;Displays&quot;;}
104    if (UnitNm==&quot;E4&quot;){return &quot;Mobile-Communications&quot;;}
105    if (UnitNm==&quot;E5&quot;){return &quot;Peripherals&amp;Microsystems&quot;;}
106    if (UnitNm==&quot;E6&quot;){return &quot;Microelectronics&quot;;}
107    if (UnitNm==&quot;F1&quot;){return &quot;Future&amp;Emerging-Technologies&quot;;}
108    if (UnitNm==&quot;F2&quot;){return &quot;Research-Networks&quot;;}
109    return UnitNm;
110  }
111  void TEpBs::GetOrgIdSetV(const int&amp; OrgId,
112   const int&amp; Depth, TBoolV&amp; OrgIdSetV, int&amp; OrgIdSetVTrues) const {
113    int Orgs=GetOrgs();
114    OrgIdSetV.Gen(Orgs);
115    if (Depth==-1){return;}
116    if (!OrgIdSetV[OrgId]){
117      OrgIdSetV[OrgId]=true; OrgIdSetVTrues++;}
118    if (Depth&gt;0){
119      PEpOrg Org=GetOrg(OrgId);
120      int ClbOrgs=Org-&gt;GetClbOrgs();
121      for (int ClbOrgN=0; ClbOrgN&lt;ClbOrgs; ClbOrgN++){
122        int ClbOrgId=Org-&gt;GetClbOrgId(ClbOrgN);
123        TBoolV SubOrgIdSetV;
124        GetOrgIdSetV(ClbOrgId, Depth-1, SubOrgIdSetV, OrgIdSetVTrues);
125        for (int SubOrgId=0; SubOrgId&lt;Orgs; SubOrgId++){
126          OrgIdSetV[SubOrgId]=OrgIdSetV[SubOrgId]||SubOrgIdSetV[SubOrgId];
127        }
128      }
129    }
130  }
131  PMom TEpBs::GetDistMom(const int&amp; StartOrgId) const {
132    PMom DistMom=TMom::New();
133    TIntV OrgDistV(GetOrgs()); OrgDistV.PutAll(-1);
134    TIntPrQ OpenOrgIdQ; OpenOrgIdQ.Push(TIntPr(StartOrgId, 0));
135    OrgDistV[StartOrgId]=0;
136    while (!OpenOrgIdQ.Empty()){
137      int OrgId=OpenOrgIdQ.Top().Val1;
138      int OrgDist=OpenOrgIdQ.Top().Val2;
139      OpenOrgIdQ.Pop();
140      IAssert(OrgDistV[OrgId]==OrgDist);
141      PEpOrg Org=GetOrg(OrgId);
142      int ClbOrgs=Org-&gt;GetClbOrgs();
143      for (int ClbOrgN=0; ClbOrgN&lt;ClbOrgs; ClbOrgN++){
144        int ClbOrgId=Org-&gt;GetClbOrgId(ClbOrgN);
145        if (OrgDistV[ClbOrgId]==-1){
146          OpenOrgIdQ.Push(TIntPr(ClbOrgId, OrgDist+1));
147          OrgDistV[ClbOrgId]=OrgDist+1;
148          DistMom-&gt;Add(OrgDist+1);
149        }
150      }
151    }
152    DistMom-&gt;Def();
153    return DistMom;
154  }
155  PEpBs TEpBs::GetSelEpBs(const PSs&amp; Ss,
156   const TStrV&amp; SelOrgTypeNmV, const TStrV&amp; SelCountryNmV,
157   const TStrV&amp; SelDomainNmV, const TStrV&amp; SelUnitNmV,
158   const TStrV&amp; SelOfficerNmV, const TStrV&amp; SelProjNmV){
159    int ProjRefFldN=Ss-&gt;GetFldX(&quot;Project Ref&quot;);
160    int ProjNmFldN=Ss-&gt;GetFldX(&quot;Acronym&quot;);
161    int DomainFldN=Ss-&gt;GetFldX(&quot;Domain / Key Action&quot;);
162    int UnitFldN=Ss-&gt;GetFldX(&quot;Unit&quot;);
163    int OfficerFldN=Ss-&gt;GetFldX(&quot;PO&quot;);
164    int OrgNmFldN=Ss-&gt;GetFldX(&quot;Legal Name&quot;);
165    int OrgCountryFldN=Ss-&gt;GetFldX(&quot;Legal Country&quot;);
166    int OrgTypeFldN=Ss-&gt;GetFldX(&quot;Type of organisation&quot;);
167    int OrgRoleFldN=Ss-&gt;GetFldX(&quot;Participant role&quot;);
168    PEpBs EpBs=TEpBs::New(Ss);
169    int PPRecs=Ss-&gt;GetYLen();
170    for (int PPRecN=1; PPRecN&lt;PPRecs; PPRecN++){
171      if (PPRecN%100==0){printf(&quot;%d/%d\r&quot;, PPRecN, PPRecs);}
172      TStr ProjRef=Ss-&gt;GetVal(ProjRefFldN, PPRecN);
173      TStr ProjNm=Ss-&gt;GetVal(ProjNmFldN, PPRecN).GetTrunc();
174      TStr DomainNm=Ss-&gt;GetVal(DomainFldN, PPRecN);
175      TStr UnitNm=Ss-&gt;GetVal(UnitFldN, PPRecN);
176      TStr OfficerNm=Ss-&gt;GetVal(OfficerFldN, PPRecN);
177      TStr OrgNm=Ss-&gt;GetVal(OrgNmFldN, PPRecN);
178      TStr CountryNm=Ss-&gt;GetVal(OrgCountryFldN, PPRecN);
179      TStr OrgTypeNm=Ss-&gt;GetVal(OrgTypeFldN, PPRecN);
180      TStr OrgRoleNm=Ss-&gt;GetVal(OrgRoleFldN, PPRecN);
181      if ((!SelOrgTypeNmV.Empty())&amp;&amp;(!SelOrgTypeNmV.IsIn(OrgTypeNm))){continue;}
182      if ((!SelCountryNmV.Empty())&amp;&amp;(!SelCountryNmV.IsIn(CountryNm))){continue;}
183      if ((!SelDomainNmV.Empty())&amp;&amp;(!SelDomainNmV.IsIn(DomainNm))){continue;}
184      if ((!SelUnitNmV.Empty())&amp;&amp;(!SelUnitNmV.IsIn(UnitNm))){continue;}
185      if ((!SelOfficerNmV.Empty())&amp;&amp;(!SelOfficerNmV.IsIn(OfficerNm))){continue;}
186      if ((!SelProjNmV.Empty())&amp;&amp;(!SelProjNmV.IsIn(ProjNm))){continue;}
187      PEpOrg Org;
188      if (!EpBs-&gt;IsOrg(OrgNm, Org)){
189        Org=TEpOrg::New(OrgNm, OrgTypeNm, CountryNm); EpBs-&gt;AddOrg(Org);}
190      Org-&gt;AddProj(ProjNm);
191      PEpCountry Country;
192      if (!EpBs-&gt;IsCountry(CountryNm, Country)){
193        Country=TEpCountry::New(CountryNm); EpBs-&gt;AddCountry(Country);}
194      Country-&gt;AddOrg(OrgNm, EpBs());
195      Country-&gt;AddOrgType(OrgTypeNm);
196      Country-&gt;AddProj(ProjNm);
197      PEpOfficer Officer;
198      if (!EpBs-&gt;IsOfficer(OfficerNm, Officer)){
199        Officer=TEpOfficer::New(OfficerNm); EpBs-&gt;AddOfficer(Officer);}
200      Officer-&gt;AddOrg(OrgNm, EpBs());
201      Officer-&gt;AddProj(ProjNm);
202      Officer-&gt;AddCountry(CountryNm);
203      PEpProj Proj;
204      if (!EpBs-&gt;IsProj(ProjNm, Proj)){
205        Proj=TEpProj::New(ProjNm, ProjRef, DomainNm, UnitNm, OfficerNm);
206        EpBs-&gt;AddProj(Proj);}
207      Proj-&gt;AddOrgNmRole(OrgNm, OrgRoleNm, EpBs());
208      PEpDomain Domain;
209      if (!EpBs-&gt;IsDomain(DomainNm, Domain)){
210        Domain=TEpDomain::New(DomainNm); EpBs-&gt;AddDomain(Domain);}
211      Domain-&gt;AddOrg(OrgNm, EpBs());
212      Domain-&gt;AddProj(ProjNm);
213      Domain-&gt;AddCountry(CountryNm);
214      PEpUnit Unit;
215      if (!EpBs-&gt;IsUnit(UnitNm, Unit)){
216        Unit=TEpUnit::New(UnitNm); EpBs-&gt;AddUnit(Unit);}
217      Unit-&gt;AddOrg(OrgNm, EpBs());
218      Unit-&gt;AddProj(ProjNm);
219      Unit-&gt;AddCountry(CountryNm);
220    }
221    printf(&quot;\n&quot;);
222    int Projs=EpBs-&gt;GetProjs();
223    for (int ProjN=0; ProjN&lt;Projs; ProjN++){
224      if (ProjN%1==0){printf(&quot;%d/%d\r&quot;, ProjN, Projs);}
225      PEpProj Proj=EpBs-&gt;GetProj(ProjN);
226      for (int MainOrgN=0; MainOrgN&lt;Proj-&gt;GetOrgs(); MainOrgN++){
227        TStr MainOrgNm=Proj-&gt;GetOrgNm(MainOrgN, EpBs());
228        PEpOrg MainOrg=EpBs-&gt;GetOrg(MainOrgNm);
229        TStr MainCountryNm=MainOrg-&gt;GetCountryNm();
230        PEpCountry MainCountry=EpBs-&gt;GetCountry(MainCountryNm);
231        for (int ClbOrgN=0; ClbOrgN&lt;Proj-&gt;GetOrgs(); ClbOrgN++){
232          if (MainOrgN==ClbOrgN){continue;}
233          TStr ClbOrgNm=Proj-&gt;GetOrgNm(ClbOrgN, EpBs());
234          PEpOrg ClbOrg=EpBs-&gt;GetOrg(ClbOrgNm);
235          TStr ClbCountryNm=ClbOrg-&gt;GetCountryNm();
236          MainOrg-&gt;AddClbOrg(ClbOrgNm, Proj-&gt;GetProjNm(), EpBs());
237          MainCountry-&gt;AddClbCountry(ClbCountryNm);
238        }
239      }
240    }
241    printf(&quot;\n&quot;);
242    return EpBs;
243  }
244  PEpBs TEpBs::GetSelEpBs(
245   const TStr&amp; SelOrgTypeNm, const TStr&amp; SelCountryNm,
246   const TStr&amp; SelDomainNm, const TStr&amp; SelUnitNm,
247   const TStr&amp; SelOfficerNm, const TStr&amp; SelProjNm) const {
248    TStrV SelOrgTypeNmV; TStrV SelCountryNmV; TStrV SelDomainNmV;
249    TStrV SelUnitNmV; TStrV SelOfficerNmV; TStrV SelProjNmV;
250    if (!SelOrgTypeNm.Empty()){SelOrgTypeNmV.Add(SelOrgTypeNm);}
251    if (!SelCountryNm.Empty()){SelCountryNmV.Add(SelCountryNm);}
252    if (!SelDomainNm.Empty()){SelDomainNmV.Add(SelDomainNm);}
253    if (!SelUnitNm.Empty()){SelUnitNmV.Add(SelUnitNm);}
254    if (!SelOfficerNm.Empty()){SelOfficerNmV.Add(SelOfficerNm);}
255    if (!SelProjNm.Empty()){SelProjNmV.Add(SelProjNm);}
256    return TEpBs::GetSelEpBs(Ss,
257     SelOrgTypeNmV, SelCountryNmV, SelDomainNmV,
258     SelUnitNmV, SelOfficerNmV, SelProjNmV);
259  }
260  PEpBs TEpBs::GetSelEpBs(
261   const TStrV&amp; SelOrgTypeNmV, const TStrV&amp; SelCountryNmV,
262   const TStrV&amp; SelDomainNmV, const TStrV&amp; SelUnitNmV,
263   const TStrV&amp; SelOfficerNmV, const TStrV&amp; SelProjNmV) const {
264    return TEpBs::GetSelEpBs(
265     Ss, SelOrgTypeNmV, SelCountryNmV,
266     SelDomainNmV, SelUnitNmV,
267     SelOfficerNmV, SelProjNmV);
268  }
269  PEpBs TEpBs::LoadTxt(const TStr&amp; FNm){
270    PSs Ss=TSs::LoadTxt(ssfTabSep, FNm);
271    PEpBs EpBs=EpBs-&gt;GetSelEpBs(Ss,
272     TStrV(), TStrV(),
273     TStrV(), TStrV(),
274     TStrV(), TStrV());
275    return EpBs;
276  }
277  PEpBs TEpBs::LoadBinOrTxt(const TStr&amp; BinFNm, const TStr&amp; TxtFNm){
278    printf(&quot;Loading files ...\n&quot;);
279    PEpBs EpBs;
280    if (TFile::Exists(BinFNm)){
281      EpBs=TEpBs::LoadBin(BinFNm);
282    } else {
283      EpBs=LoadTxt(TxtFNm);
284      EpBs-&gt;SaveBin(BinFNm);
285    }
286    printf(&quot;Done.\n&quot;);
287    return EpBs;
288  }
289  void TEpBs::LoadBriefOrgNm(const TStr&amp; FNm) const {
290    if (!TFile::Exists(FNm)){
291      printf(&quot;Brief-Organization-Names file doesn&#x27;t exist (%s)\n&quot;, FNm.CStr());
292      return;
293    }
294    PSIn SIn=TFIn::New(FNm);
295    TILx Lx(SIn, TFSet()|iloRetEoln);
296    Lx.GetSym(syQStr, syEoln, syEof);
297    while (Lx.Sym!=syEof){
298      if (Lx.Sym!=syEoln){
299        TStr BriefOrgNm=Lx.Str;
300        TStr OrgNm=Lx.GetQStr();
301        Lx.GetSym(syEoln);
302        PEpOrg Org;
303        if (IsOrg(OrgNm, Org)){
304          Org-&gt;PutBriefOrgNm(BriefOrgNm);
305        }
306      }
307      Lx.GetSym(syQStr, syEoln, syEof);
308    }
309  }
310  void TEpBs::SaveTxtXmlGraph(const TStr&amp; TxtFNm, const TStr&amp; XmlFNm) const {
311    printf(&quot;Save Txt/Xml Graph to %s/%s ...\n&quot;, TxtFNm.CStr(), XmlFNm.CStr());
312    TFOut TxtFOut(TxtFNm); FILE* fTxt=TxtFOut.GetFileId();
313    TFOut XmlFOut(XmlFNm); FILE* fXml=XmlFOut.GetFileId();
314    fprintf(fXml, &quot;&lt;CollaborationGraph&gt;\n&quot;);
315    fprintf(fTxt, &quot;*organizations\t%d\n&quot;, GetOrgs());
316    for (int OrgId=0; OrgId&lt;GetOrgs(); OrgId++){
317      PEpOrg Org=GetOrg(OrgId);
318      fprintf(fTxt, &quot;%d&quot;, OrgId);
319      fprintf(fTxt, &quot;\t%s&quot;, Org-&gt;GetOrgNm().CStr());
320      fprintf(fTxt, &quot;\t%s&quot;, Org-&gt;GetCountryNm().CStr());
321      fprintf(fTxt, &quot;\t%s\n&quot;, Org-&gt;GetOrgTypeNm().CStr());
322      fprintf(fXml, &quot;&lt;Org&gt;&quot;);
323      fprintf(fXml, &quot; &lt;Id&gt;%d&lt;/Id&gt;&quot;, OrgId);
324      fprintf(fXml, &quot; &lt;Name&gt;%s&lt;/Name&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(Org-&gt;GetOrgNm()).CStr());
325      fprintf(fXml, &quot; &lt;Country&gt;%s&lt;/Country&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(Org-&gt;GetCountryNm()).CStr());
326      fprintf(fXml, &quot; &lt;Type&gt;%s&lt;/Type&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(Org-&gt;GetOrgTypeNm()).CStr());
327      fprintf(fXml, &quot; &lt;/Org&gt;\n&quot;);
328    }
329    int Clbs=0;
330    for (int SrcOrgId=0; SrcOrgId&lt;GetOrgs(); SrcOrgId++){
331      PEpOrg SrcOrg=GetOrg(SrcOrgId);
332      for (int ProjN=0; ProjN&lt;SrcOrg-&gt;GetProjs(); ProjN++){
333        TStr ProjNm=SrcOrg-&gt;GetProjNm(ProjN);
334        PEpProj Proj=GetProj(ProjNm);
335        for (int DstOrgN=0; DstOrgN&lt;Proj-&gt;GetOrgs(); DstOrgN++){
336          int DstOrgId=Proj-&gt;GetOrgId(DstOrgN);
337          if (SrcOrgId&gt;=DstOrgId){continue;}
338          Clbs++;
339        }
340      }
341    }
342    fprintf(fTxt, &quot;*collaborations\t%d\n&quot;, Clbs);
343    {for (int SrcOrgId=0; SrcOrgId&lt;GetOrgs(); SrcOrgId++){
344      PEpOrg SrcOrg=GetOrg(SrcOrgId);
345      for (int ProjN=0; ProjN&lt;SrcOrg-&gt;GetProjs(); ProjN++){
346        TStr ProjNm=SrcOrg-&gt;GetProjNm(ProjN);
347        PEpProj Proj=GetProj(ProjNm);
348        TStr DomainNm=GetProj(ProjNm)-&gt;GetDomainNm();
349        TStr UnitNm=GetProj(ProjNm)-&gt;GetUnitNm();
350        for (int DstOrgN=0; DstOrgN&lt;Proj-&gt;GetOrgs(); DstOrgN++){
351          int DstOrgId=Proj-&gt;GetOrgId(DstOrgN);
352          if (SrcOrgId&gt;=DstOrgId){continue;}
353          fprintf(fTxt, &quot;%d&quot;, SrcOrgId);
354          fprintf(fTxt, &quot;\t%d&quot;, DstOrgId);
355          fprintf(fTxt, &quot;\t%s&quot;, ProjNm.CStr());
356          fprintf(fTxt, &quot;\t%s&quot;, DomainNm.CStr());
357          fprintf(fTxt, &quot;\t%s\n&quot;, UnitNm.CStr());
358          fprintf(fXml, &quot;&lt;Clb&gt;&quot;);
359          fprintf(fXml, &quot; &lt;SrcId&gt;%d&lt;/SrcId&gt;&quot;, SrcOrgId);
360          fprintf(fXml, &quot; &lt;DstId&gt;%d&lt;/DstId&gt;&quot;, DstOrgId);
361          fprintf(fXml, &quot; &lt;Proj&gt;%s&lt;/Proj&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(ProjNm).CStr());
362          fprintf(fXml, &quot; &lt;Domain&gt;%s&lt;/Domain&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(DomainNm).CStr());
363          fprintf(fXml, &quot; &lt;Unit&gt;%s&lt;/Unit&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(UnitNm).CStr());
364          fprintf(fXml, &quot; &lt;/Clb&gt;\n&quot;);
365        }
366      }
367    }}
368    fprintf(fXml, &quot;&lt;/CollaborationGraph&gt;\n&quot;);
369    printf(&quot;Done.\n&quot;);
370  }
371  void TEpBs::SaveTxtCountryClb(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm) const {
372    printf(&quot;Save Country Collaboration to %s/%s ...\n&quot;, TxtFNm.CStr(), GraphFNm.CStr());
373    typedef TPair&lt;TInt, PEpCountry&gt; TFqCountryPr;
374    TVec&lt;TFqCountryPr&gt; FqCountryPrV;
375    TStrPrIntH CountryPrFqH;
376    for (int CountryN=0; CountryN&lt;GetCountries(); CountryN++){
377      PEpCountry Country=GetCountry(CountryN);
378      TStr CountryNm=Country-&gt;GetCountryNm();
379      FqCountryPrV.Add(TFqCountryPr(Country-&gt;GetSumClbCountriesFq(), Country));
380      for (int ClbCountryN=0; ClbCountryN&lt;Country-&gt;GetClbCountries(); ClbCountryN++){
381        TStr ClbCountryNm=Country-&gt;GetClbCountryNm(ClbCountryN);
382        int ClbCountryFq=Country-&gt;GetClbCountryFq(ClbCountryN);
383        CountryPrFqH.AddDat(TStrPr(CountryNm, ClbCountryNm))+=ClbCountryFq;
384      }
385    }
386    TFOut FOut(TxtFNm); FILE* fTxtOut=FOut.GetFileId();
387    TIntStrPrPrV FqCountryPrPrV; CountryPrFqH.GetDatKeyPrV(FqCountryPrPrV);
388    FqCountryPrPrV.Sort(false);
389    fprintf(fTxtOut, &quot;*** All Countries Collaborations:\n&quot;);
390    for (int CountryPrN=0; CountryPrN&lt;FqCountryPrPrV.Len(); CountryPrN++){
391      TStr CountryNm1=FqCountryPrPrV[CountryPrN].Val2.Val1;
392      TStr CountryNm2=FqCountryPrPrV[CountryPrN].Val2.Val2;
393      int Fq=FqCountryPrPrV[CountryPrN].Val1;
394      if ((CountryNm1&gt;CountryNm2)||(Fq&lt;5)){continue;}
395      fprintf(fTxtOut, &quot;%6d: %s - %s\n&quot;, Fq, CountryNm1.CStr(), CountryNm2.CStr());
396    }
397    fprintf(fTxtOut, &quot;\n&quot;);
398    FqCountryPrV.Sort(false);
399    {for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
400      PEpCountry Country=FqCountryPrV[CountryN].Val2;
401      TIntStrPrV FqClbCountryNmPrV;
402      Country-&gt;GetFqClbCountryNmPrV(FqClbCountryNmPrV);
403      FqClbCountryNmPrV.Sort(false);
404      fprintf(fTxtOut, &quot;*** %s (%d collaborations) (rank %d/%d):\n&quot;,
405       Country-&gt;GetCountryNm().CStr(), Country-&gt;GetSumClbCountriesFq(),
406       1+CountryN, FqCountryPrV.Len());
407      for (int SubCountryN=0; SubCountryN&lt;FqClbCountryNmPrV.Len(); SubCountryN++){
408        int Fq=FqClbCountryNmPrV[SubCountryN].Val1;
409        double FqPrc=double(Fq)/Country-&gt;GetSumClbCountriesFq();
410        TStr SubCountryNm=FqClbCountryNmPrV[SubCountryN].Val2;
411        if (FqPrc&lt;0.001){continue;}
412        fprintf(fTxtOut, &quot;   %2d. %s (%.2f%% / %d)\n&quot;,
413         1+SubCountryN, SubCountryNm.CStr(), 100*FqPrc, Fq);
414      }
415      fprintf(fTxtOut, &quot;\n&quot;);
416    }}
417    PGraph Graph=TGraph::New();
418    TStrH CountryNmH;
419    {for (int CountryPrN=0; CountryPrN&lt;FqCountryPrPrV.Len(); CountryPrN++){
420      if (CountryNmH.Len()&gt;11){break;}
421      TStr CountryNm1=FqCountryPrPrV[CountryPrN].Val2.Val1;
422      TStr CountryNm2=FqCountryPrPrV[CountryPrN].Val2.Val2;
423      int Fq=FqCountryPrPrV[CountryPrN].Val1;
424      if (CountryNm1&lt;=CountryNm2){continue;}
425      if (!CountryNmH.IsKey(CountryNm1)){
426        PEpCountry Country1=GetCountry(CountryNm1);
427        int CountryN1=GetCountryN(CountryNm1);
428        CountryNmH.AddKey(CountryNm1);
429        TStr VNm=CountryNm1+&quot;\n(&quot;+TInt::GetStr(Country1-&gt;GetProjs())+&quot;proj.)&quot;;
430        Graph-&gt;AddVrtx(TGVrtx::New(CountryN1, VNm));
431      }
432      if (!CountryNmH.IsKey(CountryNm2)){
433        PEpCountry Country2=GetCountry(CountryNm2);
434        int CountryN2=GetCountryN(CountryNm2);
435        CountryNmH.AddKey(CountryNm2);
436        TStr VNm=CountryNm2+&quot;\n(&quot;+TInt::GetStr(Country2-&gt;GetProjs())+&quot;proj.)&quot;;
437        Graph-&gt;AddVrtx(TGVrtx::New(CountryN2, VNm));
438      }
439      PVrtx Vrtx1=Graph-&gt;GetVrtx(GetCountryN(CountryNm1));
440      PVrtx Vrtx2=Graph-&gt;GetVrtx(GetCountryN(CountryNm2));
441      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TInt::GetStr(Fq), false);
442      Edge-&gt;PutWgt(1+log(Fq));
443      Graph-&gt;AddEdge(Edge);
444    }}
445    Graph-&gt;SetEdgeWidth(5);
446    Graph-&gt;SaveTxt(GraphFNm);
447    printf(&quot;Done.\n&quot;);
448  }
449  void TEpBs::SaveCountryClbTree(const TStr&amp; CountryNm, const TStr&amp; GraphFNm){
450    PGraph Graph=TGraph::New();
451    int RootCountryId=GetCountryN(CountryNm);
452    Graph-&gt;AddVrtx(TGVrtx::New(RootCountryId, CountryNm));
453    TIntV CountryDistV(GetCountries()); CountryDistV.PutAll(-1);
454    CountryDistV[RootCountryId]=0;
455    TIntPrQ OpenCountryIdDistPrQ; OpenCountryIdDistPrQ.Push(TIntPr(RootCountryId, 0));
456    while (!OpenCountryIdDistPrQ.Empty()){
457      int CountryId=OpenCountryIdDistPrQ.Top().Val1;
458      int CountryDist=OpenCountryIdDistPrQ.Top().Val2;
459      OpenCountryIdDistPrQ.Pop();
460      IAssert(CountryDistV[CountryId]==CountryDist);
461      PEpCountry Country=GetCountry(CountryId);
462      TStr CountryNm=Country-&gt;GetCountryNm();
463      printf(&quot;[%s:%d] &quot;, CountryNm.CStr(), CountryDist);
464      if (CountryDist&gt;0){continue;}
465      PVrtx SrcVrtx=Graph-&gt;GetVrtx(CountryId);
466      TIntStrPrV FqClbCountryNmPrV;
467      Country-&gt;GetFqClbCountryNmPrV(FqClbCountryNmPrV);
468      FqClbCountryNmPrV.Sort(false);
469      int SubCountries=FqClbCountryNmPrV.Len();
470      int CreatedSubCountries=0;
471      for (int SubCountryN=0; SubCountryN&lt;SubCountries; SubCountryN++){
472        int SubCountryFq=FqClbCountryNmPrV[SubCountryN].Val1;
473        TStr SubCountryNm=FqClbCountryNmPrV[SubCountryN].Val2;
474        int SubCountryId=GetCountryN(SubCountryNm);
475        if ((CountryDistV[SubCountryId]==-1)&amp;&amp;(!SubCountryNm.IsStrIn(&quot;EMPTY&quot;))){
476          int MxCreatedSubCountries=0;
477          switch (CountryDist){
478            case 0: MxCreatedSubCountries=70; break;
479            case 1: MxCreatedSubCountries=4; break;
480            case 2: MxCreatedSubCountries=2; break;
481            case 3: MxCreatedSubCountries=1; break;
482            case 4: MxCreatedSubCountries=1; break;
483            default: MxCreatedSubCountries=0; break;
484          }
485          CreatedSubCountries++;
486          if (CreatedSubCountries&gt;MxCreatedSubCountries){break;}
487          OpenCountryIdDistPrQ.Push(TIntPr(SubCountryId, CountryDist+1));
488          CountryDistV[SubCountryId]=CountryDist+1;
489          TStr VNm=SubCountryNm;
490          PVrtx DstVrtx=TGVrtx::New(SubCountryId, VNm);
491          Graph-&gt;AddVrtx(DstVrtx);
492          TStr ENm=TInt::GetStr(SubCountryFq);
493          PEdge Edge=TGEdge::New(SrcVrtx, DstVrtx, ENm);
494          Edge-&gt;PutWgt(1+log(SubCountryFq));
495          Graph-&gt;AddEdge(Edge);
496        }
497      }
498    }
499    Graph-&gt;SetEdgeWidth(5);
500    Graph-&gt;SaveTxt(GraphFNm);
501  }
502  void TEpBs::SaveTxtCountryClbPerCap(
503   const TStr&amp; TxtFNm, const TStr&amp; GraphFNm, const PCiaWFBBs&amp; CiaWFBBs) const {
504    printf(&quot;Save Country Collaboration Per Capita to %s/%s ...\n&quot;,
505     TxtFNm.CStr(), GraphFNm.CStr());
506    typedef TPair&lt;TFlt, PEpCountry&gt; TWgtCountryPr;
507    TVec&lt;TWgtCountryPr&gt; WgtCountryPrV;
508    TStrPrFltH CountryPrWgtH;
509    TStrPrIntH CountryPrFqH;
510    for (int CountryN=0; CountryN&lt;GetCountries(); CountryN++){
511      PEpCountry Country=GetCountry(CountryN);
512      TStr CountryNm=Country-&gt;GetCountryNm();
513      PCiaWFBCountry CiaWFBCountry;
514      if (CiaWFBBs-&gt;IsCountry(CountryNm, CiaWFBCountry)){
515        double Population=CiaWFBCountry-&gt;GetFldValNum(&quot;Population&quot;);
516        for (int ClbCountryN=0; ClbCountryN&lt;Country-&gt;GetClbCountries(); ClbCountryN++){
517          TStr ClbCountryNm=Country-&gt;GetClbCountryNm(ClbCountryN);
518          PCiaWFBCountry ClbCiaWFBCountry;
519          if (CiaWFBBs-&gt;IsCountry(ClbCountryNm, ClbCiaWFBCountry)){
520            double ClbPopulation=ClbCiaWFBCountry-&gt;GetFldValNum(&quot;Population&quot;);
521            int ClbCountryFq=Country-&gt;GetClbCountryFq(ClbCountryN);
522            double ClbCountryWgt;
523            if (CountryNm==ClbCountryNm){ClbCountryWgt=ClbCountryFq/ClbPopulation;}
524            else {ClbCountryWgt=ClbCountryFq/(ClbPopulation+Population);}
525            CountryPrWgtH.AddDat(TStrPr(CountryNm, ClbCountryNm))+=ClbCountryWgt;
526            CountryPrFqH.AddDat(TStrPr(CountryNm, ClbCountryNm))+=ClbCountryFq;
527          }
528        }
529      }
530    }
531    TFOut FOut(TxtFNm); FILE* fTxtOut=FOut.GetFileId();
532    TFltStrPrPrV WgtCountryPrPrV; CountryPrWgtH.GetDatKeyPrV(WgtCountryPrPrV);
533    WgtCountryPrPrV.Sort(false);
534    fprintf(fTxtOut, &quot;*** All Countries Collaborations Per Capita:\n&quot;);
535    fprintf(fTxtOut, &quot;[Rank] [Population-Per-Collaboration] [Collaborations] [Country-Country] [Population]\n&quot;);
536    {int RankN=0;
537    for (int CountryPrN=0; CountryPrN&lt;WgtCountryPrPrV.Len(); CountryPrN++){
538      TStr CountryNm1=WgtCountryPrPrV[CountryPrN].Val2.Val1;
539      TStr CountryNm2=WgtCountryPrPrV[CountryPrN].Val2.Val2;
540      double Wgt=WgtCountryPrPrV[CountryPrN].Val1;
541      int Fq=CountryPrFqH.GetDat(TStrPr(CountryNm1, CountryNm2));
542      double Population1=CiaWFBBs-&gt;GetCountry(CountryNm1)-&gt;GetFldValNum(&quot;Population&quot;);
543      double Population2=CiaWFBBs-&gt;GetCountry(CountryNm2)-&gt;GetFldValNum(&quot;Population&quot;);
544      if ((CountryNm1&gt;CountryNm2)||(Wgt&lt;0)){continue;}
545      if (CountryNm1==CountryNm2){
546        Wgt=Population1/Fq;
547        fprintf(fTxtOut, &quot;%3d. %6.0f ppc (%5d colab.): %s - %s   (pop.: %.0f)\n&quot;,
548         ++RankN, Wgt, Fq, CountryNm1.CStr(), CountryNm2.CStr(), Population1);
549      } else {
550        Wgt=(Population1+Population2)/Fq;
551        fprintf(fTxtOut, &quot;%3d. %6.0f ppc (%5d colab.): %s - %s   (pop.: %.0f=%.0f+%.0f)\n&quot;,
552         ++RankN, Wgt, Fq, CountryNm1.CStr(), CountryNm2.CStr(),
553         Population1+Population2, Population1, Population2);
554      }
555    }}
556    fprintf(fTxtOut, &quot;\n&quot;);
557    PGraph Graph=TGraph::New();
558    TStrH CountryNmH;
559    for (int CountryPrN=0; CountryPrN&lt;WgtCountryPrPrV.Len(); CountryPrN++){
560      if (CountryNmH.Len()&gt;12){break;}
561      TStr CountryNm1=WgtCountryPrPrV[CountryPrN].Val2.Val1;
562      TStr CountryNm2=WgtCountryPrPrV[CountryPrN].Val2.Val2;
563      double Wgt=WgtCountryPrPrV[CountryPrN].Val1;
564      if (CountryNm1&lt;=CountryNm2){continue;}
565      if (!CountryNmH.IsKey(CountryNm1)){
566        PEpCountry Country1=GetCountry(CountryNm1);
567        int CountryN1=GetCountryN(CountryNm1);
568        CountryNmH.AddKey(CountryNm1);
569        TStr VNm=CountryNm1+&quot;\n(&quot;+TInt::GetStr(Country1-&gt;GetProjs())+&quot;proj.)&quot;;
570        Graph-&gt;AddVrtx(TGVrtx::New(CountryN1, VNm));
571      }
572      if (!CountryNmH.IsKey(CountryNm2)){
573        PEpCountry Country2=GetCountry(CountryNm2);
574        int CountryN2=GetCountryN(CountryNm2);
575        CountryNmH.AddKey(CountryNm2);
576        TStr VNm=CountryNm2+&quot;\n(&quot;+TInt::GetStr(Country2-&gt;GetProjs())+&quot;proj.)&quot;;
577        Graph-&gt;AddVrtx(TGVrtx::New(CountryN2, VNm));
578      }
579      int Fq=CountryPrFqH.GetDat(TStrPr(CountryNm1, CountryNm2));
580      double Population1=CiaWFBBs-&gt;GetCountry(CountryNm1)-&gt;GetFldValNum(&quot;Population&quot;);
581      double Population2=CiaWFBBs-&gt;GetCountry(CountryNm2)-&gt;GetFldValNum(&quot;Population&quot;);
582      double PPCWgt=(Population1+Population2)/Fq;
583      PVrtx Vrtx1=Graph-&gt;GetVrtx(GetCountryN(CountryNm1));
584      PVrtx Vrtx2=Graph-&gt;GetVrtx(GetCountryN(CountryNm2));
585      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(PPCWgt, &quot;%0.fppc&quot;), false);
586      Edge-&gt;PutWgt(1+log(Wgt));
587      Graph-&gt;AddEdge(Edge);
588    }
589    Graph-&gt;SetEdgeWidth(5);
590    Graph-&gt;SaveTxt(GraphFNm);
591    printf(&quot;Done.\n&quot;);
592  }
593  void TEpBs::SaveTxtOrgClb(const TStr&amp; FNm) const {
594    printf(&quot;Save Organization Collaboration to %s ...\n&quot;, FNm.CStr());
595    typedef TPair&lt;TInt, PEpOrg&gt; TFqOrgPr;
596    TVec&lt;TFqOrgPr&gt; FqOrgPrV;
597    TStrPrIntH OrgPrFqH;
598    for (int OrgN=0; OrgN&lt;GetOrgs(); OrgN++){
599      PEpOrg Org=GetOrg(OrgN);
600      TStr OrgNm=Org-&gt;GetOrgNm();
601      FqOrgPrV.Add(TFqOrgPr(Org-&gt;GetSumClbOrgsFq(), Org));
602      for (int ClbOrgN=0; ClbOrgN&lt;Org-&gt;GetClbOrgs(); ClbOrgN++){
603        TStr ClbOrgNm=Org-&gt;GetClbOrgNm(ClbOrgN, this);
604        int ClbOrgFq=Org-&gt;GetClbOrgFq(ClbOrgN);
605        OrgPrFqH.AddDat(TStrPr(OrgNm, ClbOrgNm))+=ClbOrgFq;
606      }
607    }
608    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
609    TIntStrPrPrV FqOrgPrPrV; OrgPrFqH.GetDatKeyPrV(FqOrgPrPrV);
610    FqOrgPrPrV.Sort(false);
611    fprintf(fOut, &quot;*** All Organizations Collaborations:\n&quot;);
612    for (int OrgPrN=0; OrgPrN&lt;FqOrgPrPrV.Len(); OrgPrN++){
613      TStr OrgNm1=FqOrgPrPrV[OrgPrN].Val2.Val1;
614      TStr OrgNm2=FqOrgPrPrV[OrgPrN].Val2.Val2;
615      int Fq=FqOrgPrPrV[OrgPrN].Val1;
616      if ((OrgNm1&gt;OrgNm2)||(Fq&lt;3)){continue;}
617      fprintf(fOut, &quot;%6d: &#x27;%s&#x27; - &#x27;%s&#x27;\n&quot;, Fq, OrgNm1.CStr(), OrgNm2.CStr());
618    }
619    fprintf(fOut, &quot;\n&quot;);
620    FqOrgPrV.Sort(false);
621    {for (int OrgN=0; OrgN&lt;FqOrgPrV.Len(); OrgN++){
622      PEpOrg Org=FqOrgPrV[OrgN].Val2;
623      TIntPrV FqClbOrgIdPrV;
624      Org-&gt;GetFqClbOrgIdPrV(FqClbOrgIdPrV);
625      FqClbOrgIdPrV.Sort(false);
626      fprintf(fOut, &quot;*** %s/%s (%d collaborations) (rank: %d/%d):\n&quot;,
627       Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr(), Org-&gt;GetSumClbOrgsFq(),
628       1+OrgN, FqOrgPrV.Len());
629      if (FqClbOrgIdPrV.Len()==0){
630        fprintf(fOut, &quot;   Projects: [&quot;);
631        for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
632          TStr DomainNm=GetProj(Org-&gt;GetProjNm(ProjN))-&gt;GetDomainNm();
633          TStr UnitNm=GetProj(Org-&gt;GetProjNm(ProjN))-&gt;GetUnitNm();
634          fprintf(fOut, &quot;&#x27;%s&#x27;/%s-%s &quot;, Org-&gt;GetProjNm(ProjN).CStr(), DomainNm.CStr(), UnitNm.CStr());
635        }
636        fprintf(fOut, &quot;]\n&quot;);
637      } else {
638        for (int ClbOrgN=0; ClbOrgN&lt;FqClbOrgIdPrV.Len(); ClbOrgN++){
639          int ClbOrgId=FqClbOrgIdPrV[ClbOrgN].Val2;
640          TStr ClbOrgNm=GetOrg(ClbOrgId)-&gt;GetOrgNm();
641          TStr ClbCountryNm=GetOrg(ClbOrgNm)-&gt;GetCountryNm();
642          int Fq=Org-&gt;GetClbOrgFq(ClbOrgNm, this);
643          double FqPrc=double(Fq)/Org-&gt;GetSumClbOrgsFq();
644          TStrV ProjNmV; Org-&gt;GetClbOrgProjNmV(ClbOrgNm, ProjNmV, this);
645          fprintf(fOut, &quot;   %2d. %s/%s (%.2f%% / %d)     [&quot;,
646           1+ClbOrgN, ClbOrgNm.CStr(), ClbCountryNm.CStr(), 100*FqPrc, Fq);
647          for (int ProjN=0; ProjN&lt;ProjNmV.Len(); ProjN++){
648            TStr DomainNm=GetProj(ProjNmV[ProjN])-&gt;GetDomainNm();
649            TStr UnitNm=GetProj(ProjNmV[ProjN])-&gt;GetUnitNm();
650            fprintf(fOut, &quot;&#x27;%s&#x27;/%s-%s &quot;, ProjNmV[ProjN].CStr(), DomainNm.CStr(), UnitNm.CStr());
651          }
652          fprintf(fOut, &quot;]\n&quot;);
653        }
654      }
655      fprintf(fOut, &quot;\n&quot;);
656    }}
657    printf(&quot;Done.\n&quot;);
658  }
659  void TEpBs::SaveTxtDomainClb(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm) const {
660    printf(&quot;Save Domain Collaboration to %s/%s ...\n&quot;, TxtFNm.CStr(), GraphFNm.CStr());
661    TStrPrFltH DomainPrToWgtH;
662    TStrPrFltH DomainPrToOrgsH;
663    for (int DomainN=0; DomainN&lt;GetDomains(); DomainN++){
664      PEpDomain Domain=GetDomain(DomainN);
665      TStr DomainNm=Domain-&gt;GetDomainNm();
666      if (DomainNm==&quot;#EMPTY&quot;){continue;}
667      for (int OrgN=0; OrgN&lt;Domain-&gt;GetOrgs(); OrgN++){
668        TStr OrgNm=Domain-&gt;GetOrgNm(OrgN, this);
669        int OrgFq=Domain-&gt;GetOrgFq(OrgN);
670        if (OrgNm==&quot;#EMPTY&quot;){continue;}
671        for (int SubDomainN=0; SubDomainN&lt;GetDomains(); SubDomainN++){
672          PEpDomain SubDomain=GetDomain(SubDomainN);
673          TStr SubDomainNm=SubDomain-&gt;GetDomainNm();
674          if (SubDomainNm==&quot;#EMPTY&quot;){continue;}
675          TInt SubOrgFq;
676          if (SubDomain-&gt;IsOrg(OrgNm, SubOrgFq, this)){
677            if (DomainNm==SubDomainNm){SubOrgFq--;}
678            double ClbWgt=(OrgFq*SubOrgFq);
679            if (ClbWgt&gt;0){
680              DomainPrToWgtH.AddDat(TStrPr(DomainNm, SubDomainNm))+=ClbWgt;}
681            DomainPrToOrgsH.AddDat(TStrPr(DomainNm, SubDomainNm))++;
682          }
683        }
684      }
685    }
686    TFOut TxtFOut(TxtFNm); FILE* fTxtOut=TxtFOut.GetFileId();
687    TFltStrPrPrV OrgsDomainPrPrV;
688    DomainPrToOrgsH.GetDatKeyPrV(OrgsDomainPrPrV);
689    OrgsDomainPrPrV.Sort(false);
690    fprintf(fTxtOut, &quot;*** Number Of Organizations In Two Domains\n&quot;);
691    int OrgsDomainRank=0;
692    {for (int DomainPrN=0; DomainPrN&lt;OrgsDomainPrPrV.Len(); DomainPrN++){
693      TStr DomainNm1=OrgsDomainPrPrV[DomainPrN].Val2.Val1;
694      TStr DomainNm2=OrgsDomainPrPrV[DomainPrN].Val2.Val2;
695      double ClbOrgs=OrgsDomainPrPrV[DomainPrN].Val1;
696      if (DomainNm1&lt;DomainNm2){continue;}
697      OrgsDomainRank++;
698      fprintf(fTxtOut, &quot;%3d. %6.0f: %s - %s\n&quot;,
699       OrgsDomainRank, ClbOrgs, DomainNm1.CStr(), DomainNm2.CStr());
700    }}
701    fprintf(fTxtOut, &quot;\n&quot;);
702    TFltStrPrPrV WgtDomainPrPrV;
703    DomainPrToWgtH.GetDatKeyPrV(WgtDomainPrPrV);
704    WgtDomainPrPrV.Sort(false);
705    fprintf(fTxtOut, &quot;*** Weighted Number Of Organizations In Two Domains\n&quot;);
706    int WgtDomainRank=0;
707    {for (int DomainPrN=0; DomainPrN&lt;WgtDomainPrPrV.Len(); DomainPrN++){
708      TStr DomainNm1=WgtDomainPrPrV[DomainPrN].Val2.Val1;
709      TStr DomainNm2=WgtDomainPrPrV[DomainPrN].Val2.Val2;
710      double ClbWgt=WgtDomainPrPrV[DomainPrN].Val1;
711      if (DomainNm1&lt;DomainNm2){continue;}
712      WgtDomainRank++;
713      fprintf(fTxtOut, &quot;%3d. %6.0f: %s - %s\n&quot;,
714       WgtDomainRank, ClbWgt, DomainNm1.CStr(), DomainNm2.CStr());
715    }}
716    fprintf(fTxtOut, &quot;\n&quot;);
717    PGraph Graph=TGraph::New();
718    {for (int DomainN=0; DomainN&lt;GetDomains(); DomainN++){
719      TStr DomainNm=GetDomain(DomainN)-&gt;GetDomainNm();
720      if (DomainNm==&quot;#EMPTY&quot;){continue;}
721      Graph-&gt;AddVrtx(TGVrtx::New(DomainN, DomainNm));
722    }}
723    double SumGraphClbOrgs=0;
724    {for (int DomainPrN=0; DomainPrN&lt;OrgsDomainPrPrV.Len(); DomainPrN++){
725      TStr DomainNm1=OrgsDomainPrPrV[DomainPrN].Val2.Val1;
726      TStr DomainNm2=OrgsDomainPrPrV[DomainPrN].Val2.Val2;
727      double ClbOrgs=OrgsDomainPrPrV[DomainPrN].Val1;
728      if (DomainNm1&lt;=DomainNm2){continue;}
729      SumGraphClbOrgs+=ClbOrgs;
730    }}
731    double MnGraphClbOrgs=TFlt::Mx; double MxGraphClbOrgs=TFlt::Mn;
732    double SumGraphClbOrgsSF=0; int MxDomainPrN=0;
733    {for (int DomainPrN=0; DomainPrN&lt;OrgsDomainPrPrV.Len(); DomainPrN++){
734      TStr DomainNm1=OrgsDomainPrPrV[DomainPrN].Val2.Val1;
735      TStr DomainNm2=OrgsDomainPrPrV[DomainPrN].Val2.Val2;
736      double ClbOrgs=OrgsDomainPrPrV[DomainPrN].Val1;
737      if (DomainNm1&lt;=DomainNm2){continue;}
738      SumGraphClbOrgsSF+=ClbOrgs;
739      if (SumGraphClbOrgsSF&gt;SumGraphClbOrgs*0.75){break;}
740      MnGraphClbOrgs=TFlt::GetMn(MnGraphClbOrgs, ClbOrgs);
741      MxGraphClbOrgs=TFlt::GetMx(MxGraphClbOrgs, ClbOrgs);
742      MxDomainPrN=DomainPrN;
743    }}
744    {for (int DomainPrN=0; DomainPrN&lt;=MxDomainPrN; DomainPrN++){
745      TStr DomainNm1=OrgsDomainPrPrV[DomainPrN].Val2.Val1;
746      TStr DomainNm2=OrgsDomainPrPrV[DomainPrN].Val2.Val2;
747      double ClbOrgs=OrgsDomainPrPrV[DomainPrN].Val1;
748      if (DomainNm1&lt;=DomainNm2){continue;}
749      PVrtx Vrtx1=Graph-&gt;GetVrtx(DomainNm1);
750      PVrtx Vrtx2=Graph-&gt;GetVrtx(DomainNm2);
751      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(ClbOrgs, &quot;%.0f&quot;), false);
752      Edge-&gt;PutWgt(ClbOrgs);
753      int Width=1+10*((ClbOrgs-MnGraphClbOrgs)/(MxGraphClbOrgs-MnGraphClbOrgs+1));
754      Edge-&gt;PutWidth(Width);
755      Graph-&gt;AddEdge(Edge);
756    }}
757    Graph-&gt;SaveTxt(GraphFNm);
758    printf(&quot;Done.\n&quot;);
759  }
760  void TEpBs::SaveTxtUnitClb(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm) const {
761    printf(&quot;Save Unit Collaboration to %s/%s ...\n&quot;, TxtFNm.CStr(), GraphFNm.CStr());
762    int Units=GetUnits();
763    TStrPrFltH UnitPrToWgtH;
764    TStrPrFltH UnitPrToOrgsH;
765    for (int UnitN=0; UnitN&lt;Units; UnitN++){
766      PEpUnit Unit=GetUnit(UnitN);
767      TStr UnitNm=Unit-&gt;GetUnitNm();
768      for (int OrgN=0; OrgN&lt;Unit-&gt;GetOrgs(); OrgN++){
769        TStr OrgNm=Unit-&gt;GetOrgNm(OrgN, this);
770        int OrgFq=Unit-&gt;GetOrgFq(OrgN);
771        for (int SubUnitN=0; SubUnitN&lt;Units; SubUnitN++){
772          PEpUnit SubUnit=GetUnit(SubUnitN);
773          TStr SubUnitNm=SubUnit-&gt;GetUnitNm();
774          TInt SubOrgFq;
775          if (SubUnit-&gt;IsOrg(OrgNm, SubOrgFq, this)){
776            if (UnitNm==SubUnitNm){SubOrgFq--;}
777            double ClbWgt=(OrgFq*SubOrgFq);
778            if (ClbWgt&gt;0){
779              UnitPrToWgtH.AddDat(TStrPr(UnitNm, SubUnitNm))+=ClbWgt;}
780            UnitPrToOrgsH.AddDat(TStrPr(UnitNm, SubUnitNm))++;
781          }
782        }
783      }
784    }
785    TFOut TxtFOut(TxtFNm); FILE* fTxtOut=TxtFOut.GetFileId();
786    TFltStrPrPrV OrgsUnitPrPrV;
787    UnitPrToOrgsH.GetDatKeyPrV(OrgsUnitPrPrV);
788    OrgsUnitPrPrV.Sort(false);
789    fprintf(fTxtOut, &quot;*** Number Of Organizations In Two Units\n&quot;);
790    {for (int UnitPrN=0; UnitPrN&lt;OrgsUnitPrPrV.Len(); UnitPrN++){
791      TStr UnitNm1=OrgsUnitPrPrV[UnitPrN].Val2.Val1;
792      TStr UnitNm2=OrgsUnitPrPrV[UnitPrN].Val2.Val2;
793      double ClbOrgs=OrgsUnitPrPrV[UnitPrN].Val1;
794      if (UnitNm1&lt;=UnitNm2){continue;}
795      fprintf(fTxtOut, &quot;%6.0f: %s - %s (%s - %s)\n&quot;, ClbOrgs,
796       UnitNm1.CStr(), UnitNm2.CStr(),
797       GetUnitDNm(UnitNm1).CStr(), GetUnitDNm(UnitNm2).CStr());
798    }}
799    fprintf(fTxtOut, &quot;\n&quot;);
800    TFltStrPrPrV WgtUnitPrPrV;
801    UnitPrToWgtH.GetDatKeyPrV(WgtUnitPrPrV);
802    WgtUnitPrPrV.Sort(false);
803    fprintf(fTxtOut, &quot;*** Weighted-Number Of Organizations In Two Units\n&quot;);
804    {for (int UnitPrN=0; UnitPrN&lt;WgtUnitPrPrV.Len(); UnitPrN++){
805      TStr UnitNm1=WgtUnitPrPrV[UnitPrN].Val2.Val1;
806      TStr UnitNm2=WgtUnitPrPrV[UnitPrN].Val2.Val2;
807      double ClbWgt=WgtUnitPrPrV[UnitPrN].Val1;
808      if (UnitNm1&lt;=UnitNm2){continue;}
809      fprintf(fTxtOut, &quot;%6.0f: %s - %s (%s - %s)\n&quot;, ClbWgt,
810       UnitNm1.CStr(), UnitNm2.CStr(),
811       GetUnitDNm(UnitNm1).CStr(), GetUnitDNm(UnitNm2).CStr());
812    }}
813    fprintf(fTxtOut, &quot;\n&quot;);
814    PGraph Graph=TGraph::New();
815    {for (int UnitN=0; UnitN&lt;GetUnits(); UnitN++){
816      TStr UnitNm=GetUnit(UnitN)-&gt;GetUnitNm();
817      Graph-&gt;AddVrtx(TGVrtx::New(UnitN, UnitNm+&quot;/&quot;+GetUnitDNm(UnitNm)));
818    }}
819    double SumGraphClbOrgs=0;
820    {for (int UnitPrN=0; UnitPrN&lt;OrgsUnitPrPrV.Len(); UnitPrN++){
821      TStr UnitNm1=OrgsUnitPrPrV[UnitPrN].Val2.Val1;
822      TStr UnitNm2=OrgsUnitPrPrV[UnitPrN].Val2.Val2;
823      double ClbOrgs=OrgsUnitPrPrV[UnitPrN].Val1;
824      if (UnitNm1&lt;=UnitNm2){continue;}
825      SumGraphClbOrgs+=ClbOrgs;
826    }}
827    double MnGraphClbOrgs=TFlt::Mx; double MxGraphClbOrgs=TFlt::Mn;
828    double SumGraphClbOrgsSF=0; int MxUnitPrN=0;
829    {for (int UnitPrN=0; UnitPrN&lt;OrgsUnitPrPrV.Len(); UnitPrN++){
830      TStr UnitNm1=OrgsUnitPrPrV[UnitPrN].Val2.Val1;
831      TStr UnitNm2=OrgsUnitPrPrV[UnitPrN].Val2.Val2;
832      double ClbOrgs=OrgsUnitPrPrV[UnitPrN].Val1;
833      if (UnitNm1&lt;=UnitNm2){continue;}
834      SumGraphClbOrgsSF+=ClbOrgs;
835      if (SumGraphClbOrgsSF&gt;SumGraphClbOrgs*0.2){break;}
836      MnGraphClbOrgs=TFlt::GetMn(MnGraphClbOrgs, ClbOrgs);
837      MxGraphClbOrgs=TFlt::GetMx(MxGraphClbOrgs, ClbOrgs);
838      MxUnitPrN=UnitPrN;
839    }}
840    for (int UnitPrN=0; UnitPrN&lt;=MxUnitPrN; UnitPrN++){
841      TStr UnitNm1=OrgsUnitPrPrV[UnitPrN].Val2.Val1;
842      TStr UnitNm2=OrgsUnitPrPrV[UnitPrN].Val2.Val2;
843      double ClbOrgs=OrgsUnitPrPrV[UnitPrN].Val1;
844      if (UnitNm1&lt;=UnitNm2){continue;}
845      PVrtx Vrtx1=Graph-&gt;GetVrtx(UnitNm1+&quot;/&quot;+GetUnitDNm(UnitNm1));
846      PVrtx Vrtx2=Graph-&gt;GetVrtx(UnitNm2+&quot;/&quot;+GetUnitDNm(UnitNm2));
847      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(ClbOrgs, &quot;%.0f&quot;), false);
848      Edge-&gt;PutWgt(ClbOrgs);
849      int Width=1+10*((ClbOrgs-MnGraphClbOrgs)/(MxGraphClbOrgs-MnGraphClbOrgs+1));
850      Edge-&gt;PutWidth(Width);
851      Graph-&gt;AddEdge(Edge);
852    }
853    Graph-&gt;SaveTxt(GraphFNm);
854    printf(&quot;Done.\n&quot;);
855  }
856  void TEpBs::SaveTxtOrgHub(const TStr&amp; CountryHubFNm, const TStr&amp; DomainHubFNm,
857   const TStr&amp; UnitHubFNm) const {
858    printf(&quot;Save Organization Hubs to %s/%s/%s ...\n&quot;,
859     CountryHubFNm.CStr(), DomainHubFNm.CStr(), UnitHubFNm.CStr());
860    TStrStrIntKdVH OrgNmToCountryFqKdVH;
861    TStrStrIntKdVH OrgNmToDomainFqKdVH;
862    TStrStrIntKdVH OrgNmToUnitFqKdVH;
863    for (int OrgN=0; OrgN&lt;GetOrgs(); OrgN++){
864      PEpOrg Org=GetOrg(OrgN);
865      TStr OrgNm=Org-&gt;GetOrgNm();
866      for (int ClbOrgN=0; ClbOrgN&lt;Org-&gt;GetClbOrgs(); ClbOrgN++){
867        TStr ClbOrgNm=Org-&gt;GetClbOrgNm(ClbOrgN, this);
868        int ClbOrgFq=Org-&gt;GetClbOrgFq(ClbOrgN);
869        TStr ClbCountryNm=GetOrg(ClbOrgNm)-&gt;GetCountryNm();
870        TStrIntKdV&amp; CountryFqKdV=OrgNmToCountryFqKdVH.AddDat(OrgNm);
871        CountryFqKdV.GetAddDat(TStrIntKd(ClbCountryNm)).Dat+=ClbOrgFq;
872      }
873      for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
874        TStr ProjNm=Org-&gt;GetProjNm(ProjN);
875        PEpProj Proj=GetProj(ProjNm);
876        TStr DomainNm=Proj-&gt;GetDomainNm();
877        TStrIntKdV&amp; DomainFqKdV=OrgNmToDomainFqKdVH.AddDat(OrgNm);
878        DomainFqKdV.GetAddDat(TStrIntKd(DomainNm)).Dat++;
879        TStr UnitNm=Proj-&gt;GetUnitNm();
880        TStrIntKdV&amp; UnitFqKdV=OrgNmToUnitFqKdVH.AddDat(OrgNm);
881        UnitFqKdV.GetAddDat(TStrIntKd(UnitNm)).Dat++;
882      }
883    }
884    TFltStrPrV CountryWgtOrgPrV;
885    TFltStrPrV DomainWgtOrgPrV;
886    TFltStrPrV UnitWgtOrgPrV;
887    {for (int OrgN=0; OrgN&lt;GetOrgs(); OrgN++){
888      PEpOrg Org=GetOrg(OrgN);
889      TStr OrgNm=Org-&gt;GetOrgNm();
890      if (OrgNmToCountryFqKdVH.IsKey(OrgNm)){
891        TStrIntKdV&amp; CountryFqKdV=OrgNmToCountryFqKdVH.GetDat(OrgNm);
892        double Wgt=0;
893        for (int CountryN=0; CountryN&lt;CountryFqKdV.Len(); CountryN++){
894          int Fq=CountryFqKdV[CountryN].Dat;
895          if (Fq&gt;0){Wgt+=1+log(Fq);}
896        }
897        CountryWgtOrgPrV.Add(TFltStrPr(Wgt, OrgNm));
898      }
899      if (OrgNmToDomainFqKdVH.IsKey(OrgNm)){
900        TStrIntKdV&amp; DomainFqKdV=OrgNmToDomainFqKdVH.GetDat(OrgNm);
901        double Wgt=0;
902        for (int DomainN=0; DomainN&lt;DomainFqKdV.Len(); DomainN++){
903          int Fq=DomainFqKdV[DomainN].Dat;
904          if (Fq&gt;0){Wgt+=1+log(Fq);}
905        }
906        DomainWgtOrgPrV.Add(TFltStrPr(Wgt, OrgNm));
907      }
908      if (OrgNmToUnitFqKdVH.IsKey(OrgNm)){
909        TStrIntKdV&amp; UnitFqKdV=OrgNmToUnitFqKdVH.GetDat(OrgNm);
910        double Wgt=0;
911        for (int UnitN=0; UnitN&lt;UnitFqKdV.Len(); UnitN++){
912          int Fq=UnitFqKdV[UnitN].Dat;
913          if (Fq&gt;0){Wgt+=1+log(Fq);}
914        }
915        UnitWgtOrgPrV.Add(TFltStrPr(Wgt, OrgNm));
916      }
917    }}
918    CountryWgtOrgPrV.Sort(false);
919    DomainWgtOrgPrV.Sort(false);
920    UnitWgtOrgPrV.Sort(false);
921    {TFOut FOut(CountryHubFNm); FILE* fOut=FOut.GetFileId();
922    fprintf(fOut, &quot;*** Country Hubs\n&quot;);
923    fprintf(fOut, &quot;[Rank] [Score] [#Countries] [Organization] [Distribution]\n&quot;);
924    for (int OrgN=0; OrgN&lt;CountryWgtOrgPrV.Len(); OrgN++){
925      double Wgt=CountryWgtOrgPrV[OrgN].Val1;
926      TStr OrgNm=CountryWgtOrgPrV[OrgN].Val2;
927      PEpOrg Org=GetOrg(OrgNm);
928      TStrIntKdV&amp; CountryFqKdV=OrgNmToCountryFqKdVH.GetDat(OrgNm);
929      fprintf(fOut, &quot;%5d. %6.2f (%2d): &#x27;%s&#x27;/%s   [&quot;,
930       1+OrgN, Wgt, CountryFqKdV.Len(), OrgNm.CStr(), Org-&gt;GetCountryNm().CStr());
931      TIntStrPrV FqCountryPrV;
932      for (int CountryN=0; CountryN&lt;CountryFqKdV.Len(); CountryN++){
933        FqCountryPrV.Add(TIntStrPr(CountryFqKdV[CountryN].Dat, CountryFqKdV[CountryN].Key));}
934      FqCountryPrV.Sort(false);
935      {for (int CountryN=0; CountryN&lt;CountryFqKdV.Len(); CountryN++){
936        TStr CountryNm=FqCountryPrV[CountryN].Val2;
937        int Fq=FqCountryPrV[CountryN].Val1;
938        fprintf(fOut, &quot;&#x27;%s&#x27;:%d &quot;, CountryNm.CStr(), Fq);
939      }}
940      fprintf(fOut, &quot;]\n&quot;);
941    }}
942    {TFOut FOut(DomainHubFNm); FILE* fOut=FOut.GetFileId();
943    fprintf(fOut, &quot;*** Domain Hubs\n&quot;);
944    fprintf(fOut, &quot;[Rank] [Score] [#Domains] [Organization] [Distribution]\n&quot;);
945    for (int OrgN=0; OrgN&lt;DomainWgtOrgPrV.Len(); OrgN++){
946      double Wgt=DomainWgtOrgPrV[OrgN].Val1;
947      TStr OrgNm=DomainWgtOrgPrV[OrgN].Val2;
948      PEpOrg Org=GetOrg(OrgNm);
949      TStrIntKdV&amp; DomainFqKdV=OrgNmToDomainFqKdVH.GetDat(OrgNm);
950      fprintf(fOut, &quot;%5d. %6.2f (%2d): &#x27;%s&#x27;/%s   [&quot;,
951       1+OrgN, Wgt, DomainFqKdV.Len(), OrgNm.CStr(), Org-&gt;GetCountryNm().CStr());
952      TIntStrPrV FqDomainPrV;
953      for (int DomainN=0; DomainN&lt;DomainFqKdV.Len(); DomainN++){
954        FqDomainPrV.Add(TIntStrPr(DomainFqKdV[DomainN].Dat, DomainFqKdV[DomainN].Key));}
955      FqDomainPrV.Sort(false);
956      {for (int DomainN=0; DomainN&lt;DomainFqKdV.Len(); DomainN++){
957        TStr DomainNm=FqDomainPrV[DomainN].Val2;
958        int Fq=FqDomainPrV[DomainN].Val1;
959        fprintf(fOut, &quot;&#x27;%s&#x27;:%d &quot;, DomainNm.CStr(), Fq);
960      }}
961      fprintf(fOut, &quot;]\n&quot;);
962    }}
963    {TFOut FOut(UnitHubFNm); FILE* fOut=FOut.GetFileId();
964    fprintf(fOut, &quot;*** Unit Hubs\n&quot;);
965    fprintf(fOut, &quot;[Rank] [Score] [#Units] [Organization] [Distribution]\n&quot;);
966    for (int OrgN=0; OrgN&lt;UnitWgtOrgPrV.Len(); OrgN++){
967      double Wgt=UnitWgtOrgPrV[OrgN].Val1;
968      TStr OrgNm=UnitWgtOrgPrV[OrgN].Val2;
969      PEpOrg Org=GetOrg(OrgNm);
970      TStrIntKdV&amp; UnitFqKdV=OrgNmToUnitFqKdVH.GetDat(OrgNm);
971      fprintf(fOut, &quot;%5d. %6.2f (%2d): &#x27;%s&#x27;/%s   [&quot;,
972       1+OrgN, Wgt, UnitFqKdV.Len(), OrgNm.CStr(), Org-&gt;GetCountryNm().CStr());
973      TIntStrPrV FqUnitPrV;
974      for (int UnitN=0; UnitN&lt;UnitFqKdV.Len(); UnitN++){
975        FqUnitPrV.Add(TIntStrPr(UnitFqKdV[UnitN].Dat, UnitFqKdV[UnitN].Key));}
976      FqUnitPrV.Sort(false);
977      {for (int UnitN=0; UnitN&lt;UnitFqKdV.Len(); UnitN++){
978        TStr UnitNm=FqUnitPrV[UnitN].Val2;
979        int Fq=FqUnitPrV[UnitN].Val1;
980        fprintf(fOut, &quot;&#x27;%s&#x27;(%s):%d &quot;,
981         UnitNm.CStr(), TEpBs::GetUnitDNm(UnitNm).CStr(), Fq);
982      }}
983      fprintf(fOut, &quot;]\n&quot;);
984    }}
985    printf(&quot;Done.\n&quot;);
986  }
987  void TEpBs::SaveOrgConnectivity(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm,
988   const int&amp; MnClbOrgFq) const {
989    int Orgs=GetOrgs();
990    printf(&quot;Save Organization Connectivity %s/%s ...\n&quot;, TxtFNm.CStr(), GraphFNm.CStr());
991    TIntV OrgMarkV(Orgs); OrgMarkV.PutAll(-1);
992    int ConnComps=0; int NonSingleConnComps=0; TIntV ConnCompLenV;
993    forever{
994      int StartOrgId=OrgMarkV.SearchForw(-1);
995      if (StartOrgId==-1){break;}
996      int ConnCompN=ConnComps; ConnComps++; ConnCompLenV.Add(0);
997      TIntQ OpenOrgIdQ; OpenOrgIdQ.Push(StartOrgId);
998      while (!OpenOrgIdQ.Empty()){
999        int OrgId=OpenOrgIdQ.Top(); OpenOrgIdQ.Pop();
1000        PEpOrg Org=GetOrg(OrgId);
1001        IAssert((OrgMarkV[OrgId]==-1)||(OrgMarkV[OrgId]==ConnCompN));
1002        if (OrgMarkV[OrgId]==-1){
1003          OrgMarkV[OrgId]=ConnCompN;
1004          ConnCompLenV[ConnCompN]++;
1005          int ClbOrgs=Org-&gt;GetClbOrgs();
1006          for (int ClbOrgN=0; ClbOrgN&lt;ClbOrgs; ClbOrgN++){
1007            TStr ClbOrgNm=Org-&gt;GetClbOrgNm(ClbOrgN, this);
1008            int ClbOrgFq=Org-&gt;GetClbOrgFq(ClbOrgN);
1009            int ClbOrgId=GetOrgId(ClbOrgNm);
1010            if (ClbOrgFq&gt;=MnClbOrgFq){
1011              IAssert((OrgMarkV[ClbOrgId]==-1)||(OrgMarkV[ClbOrgId]==ConnCompN));
1012              if (OrgMarkV[ClbOrgId]==-1){
1013                OpenOrgIdQ.Push(ClbOrgId);
1014              }
1015            }
1016          }
1017        }
1018      }
1019      if (ConnCompLenV[ConnCompN]&gt;1){
1020        NonSingleConnComps++;}
1021    }
1022    TIntStrVH ConnCompNToOrgNmVH;
1023    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1024      int ConnCompN=OrgMarkV[OrgId];
1025      int ConnCompLen=ConnCompLenV[ConnCompN];
1026      if (ConnCompLen&gt;1){
1027        PEpOrg Org=GetOrg(OrgId);
1028        ConnCompNToOrgNmVH.AddDat(ConnCompN).Add(Org-&gt;GetOrgNm());}
1029    }
1030    TFOut FOut(TxtFNm); FILE* fOut=FOut.GetFileId();
1031    fprintf(fOut, &quot;*** All Connected-Components: %d\n&quot;, ConnComps);
1032    fprintf(fOut, &quot;*** Non-Single Connected-Components: %d\n&quot;, NonSingleConnComps);
1033    fprintf(fOut, &quot;*** Minimal Collaboration-Frequency: %d\n&quot;, MnClbOrgFq);
1034    fprintf(fOut, &quot;\n&quot;);
1035    for (int ConnCompP=0; ConnCompP&lt;ConnCompNToOrgNmVH.Len(); ConnCompP++){
1036      int ConnCompN=ConnCompNToOrgNmVH.GetKey(ConnCompP);
1037      int ConnCompLen=ConnCompLenV[ConnCompN];
1038      TStrV&amp; OrgNmV=ConnCompNToOrgNmVH[ConnCompP];
1039      OrgNmV.Sort();
1040      fprintf(fOut, &quot;*** Connected component %d (%d organizations)\n&quot;,
1041       1+ConnCompP, ConnCompLen);
1042      for (int OrgNmN=0; OrgNmN&lt;OrgNmV.Len(); OrgNmN++){
1043        PEpOrg Org=GetOrg(OrgNmV[OrgNmN]);
1044        fprintf(fOut, &quot;&#x27;%s&#x27;/%s\n&quot;,
1045         Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr());
1046      }
1047      fprintf(fOut, &quot;\n&quot;);
1048    }
1049    PGraph Graph=TGraph::New();
1050    TIntV VrtxOrgIdV;
1051    int Vrtxs=0;
1052    {for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1053      int ConnCompN=OrgMarkV[OrgId];
1054      int ConnCompLen=ConnCompLenV[ConnCompN];
1055      if (ConnCompLen&gt;1){
1056        PEpOrg Org=GetOrg(OrgId);
1057        TStr MLOrgNm=TEpOrg::GetMultiLnOrgNm(Org-&gt;GetOrgNm());
1058        VrtxOrgIdV.Add(OrgId);
1059        Graph-&gt;AddVrtx(TGVrtx::New(OrgId, MLOrgNm));
1060        Vrtxs++;
1061      }
1062    }}
1063    int Edges=0;
1064    for (int OrgIdN1=0; OrgIdN1&lt;VrtxOrgIdV.Len(); OrgIdN1++){
1065      int OrgId1=VrtxOrgIdV[OrgIdN1];
1066      PEpOrg Org1=GetOrg(OrgId1);
1067      for (int OrgIdN2=OrgIdN1+1; OrgIdN2&lt;VrtxOrgIdV.Len(); OrgIdN2++){
1068        int OrgId2=VrtxOrgIdV[OrgIdN2];
1069        PEpOrg Org2=GetOrg(OrgId2);
1070        int ClbFq=Org1-&gt;GetClbOrgFq(Org2-&gt;GetOrgNm(), this);
1071        if (ClbFq&gt;=MnClbOrgFq){
1072          PVrtx Vrtx1=Graph-&gt;GetVrtx(OrgId1);
1073          PVrtx Vrtx2=Graph-&gt;GetVrtx(OrgId2);
1074          PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TInt::GetStr(ClbFq), false);
1075          Edge-&gt;PutWidth(ClbFq-MnClbOrgFq+1);
1076          Graph-&gt;AddEdge(Edge);
1077          Edges++;
1078        }
1079      }
1080    }
1081    if (Edges&gt;0){
1082      Graph-&gt;SaveTxt(GraphFNm);}
1083    printf(&quot;Done.\n&quot;);
1084  }
1085  void TEpBs::SaveOrgConnectivity(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm,
1086   const int&amp; MnClbOrgFq, const int&amp; MxClbOrgFq) const {
1087    for (int ClbOrgFq=MnClbOrgFq; ClbOrgFq&lt;=MxClbOrgFq; ClbOrgFq++){
1088      TStr SubTxtFNm=TxtFNm.GetFPath()+
1089       TxtFNm.GetFMid()+TInt::GetStr(ClbOrgFq)+TxtFNm.GetFExt();
1090      TStr SubGraphFNm=GraphFNm.GetFPath()+
1091       GraphFNm.GetFMid()+TInt::GetStr(ClbOrgFq)+GraphFNm.GetFExt();
1092      SaveOrgConnectivity(SubTxtFNm, SubGraphFNm, ClbOrgFq);
1093    }
1094  }
1095  void TEpBs::SaveOrgSmallWorld(const TStr&amp; TxtFNm, const TStr&amp; TreeFNm) const {
1096    printf(&quot;Save Organization Small World to %s/%s ...\n&quot;, TxtFNm.CStr(), TreeFNm.CStr());
1097    int Orgs=GetOrgs();
1098    typedef TTriple&lt;PMom, TFlt, TInt&gt; TMomDistOrgIdTr;
1099    TVec&lt;TMomDistOrgIdTr&gt; MomDistOrgIdV(Orgs, 0);
1100    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1101      printf(&quot;%d/%d\r&quot;, 1+OrgId, Orgs);
1102      PEpOrg Org=GetOrg(OrgId);
1103      PMom OrgDistMom=GetDistMom(OrgId);
1104      double OrgDistMean=OrgDistMom-&gt;GetMean();
1105      MomDistOrgIdV.Add(TMomDistOrgIdTr(OrgDistMom, -OrgDistMean, OrgId));
1106    }
1107    printf(&quot;\n&quot;);
1108    MomDistOrgIdV.Sort(false);
1109    TFOut TxtFOut(TxtFNm); FILE* fTxtOut=TxtFOut.GetFileId();
1110    fprintf(fTxtOut, &quot;*** Organizations by average distance to the rest of the graph\n&quot;);
1111    for (int OrgIdN=0; OrgIdN&lt;MomDistOrgIdV.Len(); OrgIdN++){
1112      PMom OrgDistMom=MomDistOrgIdV[OrgIdN].Val1;
1113      double OrgMeanDist=-MomDistOrgIdV[OrgIdN].Val2;
1114      int OrgId=MomDistOrgIdV[OrgIdN].Val3;
1115      PEpOrg Org=GetOrg(OrgId);
1116      fprintf(fTxtOut, &quot;%4d. %4.2f avg.dist. &#x27;%s&#x27;/%s (%d projects)\n&quot;,
1117       1+OrgIdN, OrgMeanDist, Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr(),
1118       Org-&gt;GetProjs());
1119    }
1120    fprintf(fTxtOut, &quot;\n&quot;);
1121    fprintf(fTxtOut, &quot;*** Full listing\n&quot;);
1122    {for (int OrgIdN=0; OrgIdN&lt;MomDistOrgIdV.Len(); OrgIdN++){
1123      PMom OrgDistMom=MomDistOrgIdV[OrgIdN].Val1;
1124      double OrgMeanDist=-MomDistOrgIdV[OrgIdN].Val2;
1125      int OrgId=MomDistOrgIdV[OrgIdN].Val3;
1126      PEpOrg Org=GetOrg(OrgId);
1127      fprintf(fTxtOut, &quot;%4d. %4.2f avg.dist. &#x27;%s&#x27;/%s (%d projects):\n\t%s\n&quot;,
1128       1+OrgIdN, OrgMeanDist, Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr(),
1129       Org-&gt;GetProjs(), OrgDistMom-&gt;GetStr(&#x27; &#x27;, &#x27;:&#x27;, true, &quot;%.2f&quot;).CStr());
1130    }}
1131    fprintf(fTxtOut, &quot;\n&quot;);
1132    if (MomDistOrgIdV.Len()&gt;0){
1133      int BestOrgId=MomDistOrgIdV[0].Val3;
1134      PEpOrg BestOrg=GetOrg(BestOrgId);
1135      SaveOrgDistTree(TreeFNm, BestOrg-&gt;GetOrgNm());
1136    }
1137    printf(&quot;Done.\n&quot;);
1138  }
1139  void TEpBs::SaveOfficerStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1140    printf(&quot;Save Officer Statistics to %s ...\n&quot;, FNm.CStr());
1141    int Offs=GetOfficers();
1142    TIntKdV FqOffIdKdV(Offs, 0);
1143    for (int OffId=0; OffId&lt;Offs; OffId++){
1144      PEpOfficer Officer=GetOfficer(OffId);
1145      FqOffIdKdV.Add(TIntKd(Officer-&gt;GetProjs(), OffId));
1146    }
1147    FqOffIdKdV.Sort(false);
1148    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1149    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1150    for (int OffIdN=0; OffIdN&lt;FqOffIdKdV.Len(); OffIdN++){
1151      int OffId=FqOffIdKdV[OffIdN].Dat;
1152      PEpOfficer Officer=GetOfficer(OffId);
1153      TStrIntH OrgNmToFqH;
1154      for (int ProjN=0; ProjN&lt;Officer-&gt;GetProjs(); ProjN++){
1155        TStr ProjNm=Officer-&gt;GetProjNm(ProjN);
1156        PEpProj Proj=GetProj(ProjNm);
1157        for (int OrgN=0; OrgN&lt;Proj-&gt;GetOrgs(); OrgN++){
1158          TStr OrgNm=Proj-&gt;GetOrgNm(OrgN, this);
1159          OrgNmToFqH.AddDat(OrgNm)++;
1160        }
1161      }
1162      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27; (%d projects):\n&quot;,
1163       1+OffIdN, Officer-&gt;GetOfficerNm().CStr(), Officer-&gt;GetProjs());
1164      fprintf(fOut, &quot;Projects(%d):&quot;, Officer-&gt;GetProjs());
1165      {for (int ProjN=0; ProjN&lt;Officer-&gt;GetProjs(); ProjN++){
1166        if ((ProjN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1167        TStr ProjNm=Officer-&gt;GetProjNm(ProjN);
1168        PEpProj Proj=GetProj(ProjNm);
1169        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Proj-&gt;GetProjNm().CStr());
1170      }}
1171      fprintf(fOut, &quot;\n&quot;);
1172      TIntStrPrV FqCountryPrV; Officer-&gt;GetFqCountryPrV(FqCountryPrV);
1173      FqCountryPrV.Sort(false);
1174      fprintf(fOut, &quot;Countries(all:%d)\n&quot;, FqCountryPrV.Len());
1175      int SumOrgFq=0;
1176      for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1177        SumOrgFq+=FqCountryPrV[CountryN].Val1;}
1178      fprintf(fOut, &quot;Organizations-Per-Country(all:%d):&quot;, SumOrgFq);
1179      {for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1180        int Fq=FqCountryPrV[CountryN].Val1;
1181        TStr CountryNm=FqCountryPrV[CountryN].Val2;
1182        if ((CountryN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1183        fprintf(fOut, &quot; %s(%.1f%%/%d)&quot;,
1184         CountryNm.CStr(), 100*Fq/double(SumOrgFq), Fq);
1185      }}
1186      fprintf(fOut, &quot;\n&quot;);
1187      TIntStrPrV FqOrgNmPrV; OrgNmToFqH.GetDatKeyPrV(FqOrgNmPrV);
1188      FqOrgNmPrV.Sort(false);
1189      fprintf(fOut, &quot;Organizations(all:%d):\n&quot;, FqOrgNmPrV.Len());
1190      for (int OrgN=0; OrgN&lt;FqOrgNmPrV.Len(); OrgN++){
1191        int Fq=FqOrgNmPrV[OrgN].Val1;
1192        TStr OrgNm=FqOrgNmPrV[OrgN].Val2;
1193        if (Fq&gt;2){fprintf(fOut, &quot;   &#x27;%s&#x27;:%d\n&quot;, OrgNm.CStr(), Fq);}
1194        else {break;}
1195      }
1196      TIntV DIdV; int DId;
1197      {for (int ProjN=0; ProjN&lt;Officer-&gt;GetProjs(); ProjN++){
1198        TStr ProjNm=Officer-&gt;GetProjNm(ProjN);
1199        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1200      }}
1201      PBowSpV ConceptSpV;
1202      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1203      TStrFltPrV WordStrWgtPrV;
1204      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 25, 0.66, WordStrWgtPrV);
1205      fprintf(fOut, &quot;Keywords:&quot;);
1206      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1207        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1208        double WordWgt=WordStrWgtPrV[WordN].Val2;
1209        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1210        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1211      }
1212      fprintf(fOut, &quot;\n&quot;);
1213      fprintf(fOut, &quot;\n&quot;);
1214    }
1215    printf(&quot;Done.\n&quot;);
1216  }
1217  void TEpBs::SaveOrgStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1218    printf(&quot;Save Organization Statistics to %s ...\n&quot;, FNm.CStr());
1219    int Orgs=GetOrgs();
1220    TIntKdV FqOrgIdKdV(Orgs, 0);
1221    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1222      PEpOrg Org=GetOrg(OrgId);
1223      FqOrgIdKdV.Add(TIntKd(Org-&gt;GetProjs(), OrgId));
1224    }
1225    FqOrgIdKdV.Sort(false);
1226    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1227    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1228    for (int OrgIdN=0; OrgIdN&lt;FqOrgIdKdV.Len(); OrgIdN++){
1229      printf(&quot;%d/%d\r&quot;, OrgIdN, FqOrgIdKdV.Len());
1230      int OrgId=FqOrgIdKdV[OrgIdN].Dat;
1231      PEpOrg Org=GetOrg(OrgId);
1232      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27;/%s (%d projects):\n&quot;,
1233       1+OrgIdN, Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr(),
1234       Org-&gt;GetProjs());
1235      fprintf(fOut, &quot;Projects(%d):&quot;, Org-&gt;GetProjs());
1236      for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
1237        if ((ProjN)%5==0){fprintf(fOut, &quot;\n  &quot;);}
1238        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Org-&gt;GetProjNm(ProjN).CStr());
1239      }
1240      fprintf(fOut, &quot;\n&quot;);
1241      TStrIntH RoleNmToFqH;
1242      {for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
1243        PEpProj Proj=GetProj(Org-&gt;GetProjNm(ProjN));
1244        TStr RoleNm=Proj-&gt;GetRole(Org-&gt;GetOrgNm(), this);
1245        RoleNmToFqH.AddDat(RoleNm)++;
1246      }}
1247      TIntStrPrV FqRoleNmPrV; RoleNmToFqH.GetDatKeyPrV(FqRoleNmPrV);
1248      FqRoleNmPrV.Sort(false);
1249      fprintf(fOut, &quot;Project-Roles:\n&quot;);
1250      for (int RoleN=0; RoleN&lt;FqRoleNmPrV.Len(); RoleN++){
1251        int RoleFq=FqRoleNmPrV[RoleN].Val1;
1252        TStr RoleNm=FqRoleNmPrV[RoleN].Val2;
1253        fprintf(fOut, &quot; &#x27;%s&#x27;:%.2f%% (%d/%d)&quot;, RoleNm.CStr(),
1254         100*RoleFq/double(Org-&gt;GetProjs()), RoleFq, Org-&gt;GetProjs());
1255      }
1256      fprintf(fOut, &quot;\n&quot;);
1257      TIntV DIdV; int DId;
1258      {for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
1259        TStr ProjNm=Org-&gt;GetProjNm(ProjN);
1260        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1261      }}
1262      PBowSpV ConceptSpV;
1263      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1264      TStrFltPrV WordStrWgtPrV;
1265      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 25, 0.66, WordStrWgtPrV);
1266      fprintf(fOut, &quot;Keywords:&quot;);
1267      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1268        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1269        double WordWgt=WordStrWgtPrV[WordN].Val2;
1270        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1271        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1272      }
1273      fprintf(fOut, &quot;\n&quot;);
1274      fprintf(fOut, &quot;\n&quot;);
1275    }
1276    printf(&quot;\nDone.\n&quot;);
1277  }
1278  void TEpBs::SaveDomainStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1279    printf(&quot;Save Domain Statistics to %s ...\n&quot;, FNm.CStr());
1280    TIntKdV FqDomainIdKdV(GetDomains(), 0);
1281    for (int DomainId=0; DomainId&lt;GetDomains(); DomainId++){
1282      PEpDomain Domain=GetDomain(DomainId);
1283      FqDomainIdKdV.Add(TIntKd(Domain-&gt;GetProjs(), DomainId));
1284    }
1285    FqDomainIdKdV.Sort(false);
1286    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1287    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1288    for (int DomainIdN=0; DomainIdN&lt;FqDomainIdKdV.Len(); DomainIdN++){
1289      int DomainId=FqDomainIdKdV[DomainIdN].Dat;
1290      PEpDomain Domain=GetDomain(DomainId);
1291      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27; (%d projects):\n&quot;,
1292       1+DomainIdN, Domain-&gt;GetDomainNm().CStr(), Domain-&gt;GetProjs());
1293      TStrIntH OrgTypeToFqH; TStrIntH CountryToFqH; int OrgFqSum=0;
1294      for (int OrgN=0; OrgN&lt;Domain-&gt;GetOrgs(); OrgN++){
1295        int OrgId=Domain-&gt;GetOrgId(OrgN);
1296        int OrgFq=Domain-&gt;GetOrgFq(OrgN);
1297        PEpOrg Org=GetOrg(OrgId);
1298        OrgTypeToFqH.AddDat(Org-&gt;GetOrgTypeNm())+=OrgFq;
1299        CountryToFqH.AddDat(Org-&gt;GetCountryNm())+=OrgFq;
1300        OrgFqSum+=OrgFq;
1301      }
1302      TIntStrPrV FqOrgTypePrV; OrgTypeToFqH.GetDatKeyPrV(FqOrgTypePrV);
1303      TIntStrPrV FqCountryPrV; CountryToFqH.GetDatKeyPrV(FqCountryPrV);
1304      FqOrgTypePrV.Sort(false); FqCountryPrV.Sort(false);
1305      fprintf(fOut, &quot;Organization-Types:\n&quot;);
1306      for (int OrgTypeN=0; OrgTypeN&lt;FqOrgTypePrV.Len(); OrgTypeN++){
1307        int OrgTypeFq=FqOrgTypePrV[OrgTypeN].Val1;
1308        TStr OrgTypeNm=FqOrgTypePrV[OrgTypeN].Val2;
1309        fprintf(fOut, &quot;   &#x27;%s&#x27;: %.0f%% (%d/%d)\n&quot;, OrgTypeNm.CStr(),
<span onclick='openModal()' class='match'>1310         100*OrgTypeFq/double(OrgFqSum), OrgTypeFq, OrgFqSum);
1311      }
1312      fprintf(fOut, &quot;Countries:&quot;);
1313      for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1314        int CountryFq=FqCountryPrV[CountryN].Val1;
1315        double CountryPrc=CountryFq/double(OrgFqSum);
1316        if (CountryPrc&lt;0.05){break;}
</span>1317        TStr CountryNm=FqCountryPrV[CountryN].Val2;
1318        if ((CountryN)%2==0){fprintf(fOut, &quot;\n  &quot;);}
1319        fprintf(fOut, &quot; [&#x27;%s&#x27; %.0f%% (%d/%d)]&quot;, CountryNm.CStr(),
1320         100*CountryPrc, CountryFq, OrgFqSum);
1321      }
1322      fprintf(fOut, &quot;\n&quot;);
1323      TIntV DIdV; int DId;
1324      {for (int ProjN=0; ProjN&lt;Domain-&gt;GetProjs(); ProjN++){
1325        TStr ProjNm=Domain-&gt;GetProjNm(ProjN);
1326        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1327      }}
1328      PBowSpV ConceptSpV;
1329      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1330      TStrFltPrV WordStrWgtPrV;
1331      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 50, 0.5, WordStrWgtPrV);
1332      fprintf(fOut, &quot;Keywords:&quot;);
1333      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1334        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1335        double WordWgt=WordStrWgtPrV[WordN].Val2;
1336        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1337        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1338      }
1339      fprintf(fOut, &quot;\n&quot;);
1340      fprintf(fOut, &quot;Projects(%d):&quot;, Domain-&gt;GetProjs());
1341      for (int ProjN=0; ProjN&lt;Domain-&gt;GetProjs(); ProjN++){
1342        if ((ProjN)%5==0){fprintf(fOut, &quot;\n  &quot;);}
1343        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Domain-&gt;GetProjNm(ProjN).CStr());
1344      }
1345      fprintf(fOut, &quot;\n&quot;);
1346      fprintf(fOut, &quot;\n&quot;);
1347    }
1348    printf(&quot;Done.\n&quot;);
1349  }
1350  void TEpBs::SaveUnitStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1351    printf(&quot;Save Unit Statistics to %s ...\n&quot;, FNm.CStr());
1352    int Units=GetUnits();
1353    TIntKdV FqUnitIdKdV(Units, 0);
1354    for (int UnitId=0; UnitId&lt;Units; UnitId++){
1355      PEpUnit Unit=GetUnit(UnitId);
1356      FqUnitIdKdV.Add(TIntKd(Unit-&gt;GetProjs(), UnitId));
1357    }
1358    FqUnitIdKdV.Sort(false);
1359    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1360    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1361    for (int UnitIdN=0; UnitIdN&lt;FqUnitIdKdV.Len(); UnitIdN++){
1362      int UnitId=FqUnitIdKdV[UnitIdN].Dat;
1363      PEpUnit Unit=GetUnit(UnitId);
1364      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27; [%s] (%d projects):\n&quot;,
1365       1+UnitIdN, Unit-&gt;GetUnitNm().CStr(), GetUnitDNm(Unit-&gt;GetUnitNm()).CStr(),
1366       Unit-&gt;GetProjs());
1367      TStrIntH OrgTypeToFqH; TStrIntH CountryToFqH; int OrgFqSum=0;
1368      for (int OrgN=0; OrgN&lt;Unit-&gt;GetOrgs(); OrgN++){
1369        int OrgId=Unit-&gt;GetOrgId(OrgN);
1370        int OrgFq=Unit-&gt;GetOrgFq(OrgN);
1371        PEpOrg Org=GetOrg(OrgId);
1372        OrgTypeToFqH.AddDat(Org-&gt;GetOrgTypeNm())+=OrgFq;
1373        CountryToFqH.AddDat(Org-&gt;GetCountryNm())+=OrgFq;
1374        OrgFqSum+=OrgFq;
1375      }
1376      TIntStrPrV FqOrgTypePrV; OrgTypeToFqH.GetDatKeyPrV(FqOrgTypePrV);
1377      TIntStrPrV FqCountryPrV; CountryToFqH.GetDatKeyPrV(FqCountryPrV);
1378      FqOrgTypePrV.Sort(false); FqCountryPrV.Sort(false);
1379      fprintf(fOut, &quot;Organization-Types:\n&quot;);
1380      for (int OrgTypeN=0; OrgTypeN&lt;FqOrgTypePrV.Len(); OrgTypeN++){
1381        int OrgTypeFq=FqOrgTypePrV[OrgTypeN].Val1;
1382        TStr OrgTypeNm=FqOrgTypePrV[OrgTypeN].Val2;
1383        fprintf(fOut, &quot;   &#x27;%s&#x27;: %.0f%% (%d/%d)\n&quot;, OrgTypeNm.CStr(),
1384         100*OrgTypeFq/double(OrgFqSum), OrgTypeFq, OrgFqSum);
1385      }
1386      fprintf(fOut, &quot;Countries:&quot;);
1387      for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1388        int CountryFq=FqCountryPrV[CountryN].Val1;
1389        double CountryPrc=CountryFq/double(OrgFqSum);
1390        if (CountryPrc&lt;0.03){break;}
1391        TStr CountryNm=FqCountryPrV[CountryN].Val2;
1392        if ((CountryN)%2==0){fprintf(fOut, &quot;\n  &quot;);}
1393        fprintf(fOut, &quot; [&#x27;%s&#x27; %.0f%% (%d/%d)]&quot;, CountryNm.CStr(),
1394         100*CountryPrc, CountryFq, OrgFqSum);
1395      }
1396      fprintf(fOut, &quot;\n&quot;);
1397      TIntV DIdV; int DId;
1398      {for (int ProjN=0; ProjN&lt;Unit-&gt;GetProjs(); ProjN++){
1399        TStr ProjNm=Unit-&gt;GetProjNm(ProjN);
1400        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1401      }}
1402      PBowSpV ConceptSpV;
1403      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1404      TStrFltPrV WordStrWgtPrV;
1405      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 50, 0.5, WordStrWgtPrV);
1406      fprintf(fOut, &quot;Keywords:&quot;);
1407      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1408        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1409        double WordWgt=WordStrWgtPrV[WordN].Val2;
1410        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1411        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1412      }
1413      fprintf(fOut, &quot;\n&quot;);
1414      fprintf(fOut, &quot;Projects(%d):&quot;, Unit-&gt;GetProjs());
1415      for (int ProjN=0; ProjN&lt;Unit-&gt;GetProjs(); ProjN++){
1416        if ((ProjN)%5==0){fprintf(fOut, &quot;\n  &quot;);}
1417        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Unit-&gt;GetProjNm(ProjN).CStr());
1418      }
1419      fprintf(fOut, &quot;\n&quot;);
1420      fprintf(fOut, &quot;\n&quot;);
1421    }
1422    printf(&quot;Done.\n&quot;);
1423  }
1424  void TEpBs::SaveCountryStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1425    printf(&quot;Save Country Statistics to %s ...\n&quot;, FNm.CStr());
1426    int Countries=GetCountries();
1427    TIntKdV FqCountryIdKdV(Countries, 0);
1428    for (int CountryId=0; CountryId&lt;Countries; CountryId++){
1429      PEpCountry Country=GetCountry(CountryId);
1430      FqCountryIdKdV.Add(TIntKd(Country-&gt;GetProjs(), CountryId));
1431    }
1432    FqCountryIdKdV.Sort(false);
1433    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1434    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1435    for (int CountryIdN=0; CountryIdN&lt;FqCountryIdKdV.Len(); CountryIdN++){
1436      int CountryId=FqCountryIdKdV[CountryIdN].Dat;
1437      PEpCountry Country=GetCountry(CountryId);
1438      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27;:\n&quot;, 1+CountryIdN, Country-&gt;GetCountryNm().CStr());
1439      fprintf(fOut, &quot;Projects: %d\n&quot;, Country-&gt;GetProjs());
1440      fprintf(fOut, &quot;Organizations: %d\n&quot;, Country-&gt;GetOrgs());
1441      fprintf(fOut, &quot;Project-Participations: %d\n&quot;, Country-&gt;GetOrgFqSum());
1442      TStrIntH OrgTypeToFqH; TStrIntH OrgToFqH; int OrgFqSum=0;
1443      for (int OrgN=0; OrgN&lt;Country-&gt;GetOrgs(); OrgN++){
1444        int OrgId=Country-&gt;GetOrgId(OrgN);
1445        int OrgFq=Country-&gt;GetOrgFq(OrgN);
1446        PEpOrg Org=GetOrg(OrgId);
1447        OrgTypeToFqH.AddDat(Org-&gt;GetOrgTypeNm())+=OrgFq;
1448        OrgToFqH.AddDat(Org-&gt;GetOrgNm())+=OrgFq;
1449        OrgFqSum+=OrgFq;
1450      }
1451      TIntStrPrV FqOrgTypePrV; OrgTypeToFqH.GetDatKeyPrV(FqOrgTypePrV);
1452      TIntStrPrV FqOrgPrV; OrgToFqH.GetDatKeyPrV(FqOrgPrV);
1453      FqOrgTypePrV.Sort(false); FqOrgPrV.Sort(false);
1454      fprintf(fOut, &quot;Organization-Types:\n&quot;);
1455      for (int OrgTypeN=0; OrgTypeN&lt;FqOrgTypePrV.Len(); OrgTypeN++){
1456        int OrgTypeFq=FqOrgTypePrV[OrgTypeN].Val1;
1457        TStr OrgTypeNm=FqOrgTypePrV[OrgTypeN].Val2;
1458        fprintf(fOut, &quot;   &#x27;%s&#x27;: %.0f%% (%d/%d)\n&quot;, OrgTypeNm.CStr(),
1459         100*OrgTypeFq/double(OrgFqSum), OrgTypeFq, OrgFqSum);
1460      }
1461      fprintf(fOut, &quot;Projects Participations Per Organization:\n&quot;);
1462      for (int CountryN=0; CountryN&lt;FqOrgPrV.Len(); CountryN++){
1463        int OrgFq=FqOrgPrV[CountryN].Val1;
1464        double OrgPrc=OrgFq/double(OrgFqSum);
1465        if (CountryN&gt;=10){break;}
1466        TStr OrgNm=FqOrgPrV[CountryN].Val2;
1467        fprintf(fOut, &quot;   %2d. %5.2f%% (%d/%d) &#x27;%s&#x27;\n&quot;,
1468         1+CountryN, 100*OrgPrc, OrgFq, OrgFqSum, OrgNm.CStr());
1469      }
1470      TIntV DIdV; int DId;
1471      {for (int ProjN=0; ProjN&lt;Country-&gt;GetProjs(); ProjN++){
1472        TStr ProjNm=Country-&gt;GetProjNm(ProjN);
1473        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1474      }}
1475      PBowSpV ConceptSpV;
1476      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1477      TStrFltPrV WordStrWgtPrV;
1478      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 50, 0.5, WordStrWgtPrV);
1479      fprintf(fOut, &quot;Keywords:&quot;);
1480      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1481        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1482        double WordWgt=WordStrWgtPrV[WordN].Val2;
1483        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1484        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1485      }
1486      fprintf(fOut, &quot;\n&quot;);
1487      fprintf(fOut, &quot;Projects(%d):&quot;, Country-&gt;GetProjs());
1488      for (int ProjN=0; ProjN&lt;Country-&gt;GetProjs(); ProjN++){
1489        if ((ProjN)%5==0){fprintf(fOut, &quot;\n  &quot;);}
1490        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Country-&gt;GetProjNm(ProjN).CStr());
1491      }
1492      fprintf(fOut, &quot;\n&quot;);
1493      fprintf(fOut, &quot;\n&quot;);
1494    }
1495    printf(&quot;Done.\n&quot;);
1496  }
1497  void TEpBs::SaveOrgDistTree(const TStr&amp; FNm, const TStr&amp; OrgNmWc) const {
1498    printf(&quot;Save Organization Distance Graph to %s ...\n&quot;, FNm.CStr());
1499    int Orgs=GetOrgs();
1500    int StartOrgId=-1;
1501    TIntKdV FqOrgIdKdV(Orgs, 0);
1502    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1503      PEpOrg Org=GetOrg(OrgId);
1504      TStr OrgNm=Org-&gt;GetOrgNm();
1505      if ((!OrgNmWc.Empty())&amp;&amp;(OrgNm.IsWcMatch(OrgNmWc))){
1506        StartOrgId=OrgId;}
1507      FqOrgIdKdV.Add(TIntKd(Org-&gt;GetProjs(), OrgId));
1508    }
1509    FqOrgIdKdV.Sort(false);
1510    int MnFullOrgNmProjs;
1511    if (FqOrgIdKdV.Len()&lt;15){MnFullOrgNmProjs=FqOrgIdKdV.Last().Key;}
1512    else {MnFullOrgNmProjs=FqOrgIdKdV[15].Key;}
1513    if (OrgNmWc.Empty()){
1514      StartOrgId=FqOrgIdKdV[0].Dat;
1515    } else
1516    if (StartOrgId==-1){
1517      printf(&quot;No match for wild-card &#x27;%s&#x27;.\n&quot;, OrgNmWc.CStr());
1518      return;
1519    }
1520    PEpOrg StartOrg=GetOrg(StartOrgId);
1521    TStr StartOrgNm=StartOrg-&gt;GetOrgNm();
1522    printf(&quot;Creating distance graph for organization &#x27;%s&#x27;.\n&quot;, StartOrgNm.CStr());
1523    PGraph Graph=TGraph::New();
1524    Graph-&gt;AddVrtx(TGVrtx::New(StartOrgId, TEpOrg::GetMultiLnOrgNm(
1525     StartOrgNm+&quot;(&quot;+TInt::GetStr(StartOrg-&gt;GetProjs())+&quot;)&quot;)));
1526    TIntV OrgDistV(GetOrgs()); OrgDistV.PutAll(-1);
1527    TIntPrQ OpenOrgIdQ; OpenOrgIdQ.Push(TIntPr(StartOrgId, 0));
1528    OrgDistV[StartOrgId]=0;
1529    while (!OpenOrgIdQ.Empty()){
1530      int OrgId=OpenOrgIdQ.Top().Val1;
1531      int OrgDist=OpenOrgIdQ.Top().Val2;
1532      OpenOrgIdQ.Pop();
1533      IAssert(OrgDistV[OrgId]==OrgDist);
1534      PEpOrg Org=GetOrg(OrgId);
1535      TStr OrgNm=Org-&gt;GetOrgNm();
1536      PVrtx SrcVrtx=Graph-&gt;GetVrtx(OrgId);
1537      int ClbOrgs=Org-&gt;GetClbOrgs();
1538      for (int ClbOrgN=0; ClbOrgN&lt;ClbOrgs; ClbOrgN++){
1539        TStr ClbOrgNm=Org-&gt;GetClbOrgNm(ClbOrgN, this);
1540        int ClbOrgId=GetOrgId(ClbOrgNm);
1541        PEpOrg ClbOrg=GetOrg(ClbOrgId);
1542        if (OrgDistV[ClbOrgId]==-1){
1543          OpenOrgIdQ.Push(TIntPr(ClbOrgId, OrgDist+1));
1544          OrgDistV[ClbOrgId]=OrgDist+1;
1545          TStr VNm=ClbOrg-&gt;GetBriefOrgNm();
1546          if (ClbOrg-&gt;GetProjs()&lt;=MnFullOrgNmProjs){VNm=TStr(&quot;_&quot;)+VNm;}
1547          VNm=VNm+&quot;(&quot;+TInt::GetStr(ClbOrg-&gt;GetProjs())+&quot;)&quot;;
1548          VNm=TEpOrg::GetMultiLnOrgNm(VNm);
1549          PVrtx DstVrtx=TGVrtx::New(ClbOrgId, VNm);
1550          Graph-&gt;AddVrtx(DstVrtx);
1551          TStr ENm=TInt::GetStr(OrgId)+&quot;-&quot;+TInt::GetStr(ClbOrgId);
1552          PEdge Edge=TGEdge::New(SrcVrtx, DstVrtx, TStr(&quot;_&quot;)+ENm);
1553          Graph-&gt;AddEdge(Edge);
1554        }
1555      }
1556    }
1557    Graph-&gt;SaveTxt(FNm);
1558    printf(&quot;Done.\n&quot;);
1559  }
1560  void TEpBs::SaveDomainSim(
1561   const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs,
1562   const double&amp; SimSumPrc, const int&amp; MxKws) const {
1563    printf(&quot;Save Domain Graph to %s ...\n&quot;, FNm.CStr());
1564    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1565    TStrStrH DomainNmToDescH;
1566    THash&lt;TStr, PBowSpV&gt; DomainNmToConceptSpV;
1567    for (int DomainId=0; DomainId&lt;GetDomains(); DomainId++){
1568      PEpDomain Domain=GetDomain(DomainId);
1569      TStr DomainNm=Domain-&gt;GetDomainNm();
1570      if (DomainNm==&quot;#EMPTY&quot;){continue;}
1571      TIntV DIdV; int DId;
1572      for (int ProjN=0; ProjN&lt;Domain-&gt;GetProjs(); ProjN++){
1573        TStr ProjNm=Domain-&gt;GetProjNm(ProjN);
1574        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1575      }
1576      PBowSpV ConceptSpV;
1577      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1578      TStrFltPrV WordStrWgtPrV;
1579      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, MxKws, 0.5, WordStrWgtPrV);
1580      DomainNmToConceptSpV.AddDat(DomainNm, ConceptSpV);
1581      TChA DomainDescChA;
1582      DomainDescChA+=TStr(&quot;*** &quot;)+DomainNm+&quot; ***&quot;;
1583      DomainDescChA+=TStr(&quot;\\&quot;)+TInt::GetStr(Domain-&gt;GetProjs())+ &quot; projects&quot;;
1584      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1585        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1586        double WordWgt=WordStrWgtPrV[WordN].Val2;
1587        DomainDescChA+=TStr(&quot;\\&quot;)+WordStr+&quot;:&quot;+TFlt::GetStr(WordWgt, &quot;%.2f&quot;);
1588      }
1589      DomainNmToDescH.AddDat(DomainNm, DomainDescChA);
1590    }
1591    PBowSim BowSim=TBowSim::New(bstCos); 
1592    TFltVV DomainSimVV;
1593    double SimSum=0; TFltIntIntTrV SimN1N2TrV;
1594    for (int DomainN1=0; DomainN1&lt;DomainNmToConceptSpV.Len(); DomainN1++){
1595      PBowSpV ConceptSpV1=DomainNmToConceptSpV[DomainN1];
1596      for (int DomainN2=DomainN1+1; DomainN2&lt;DomainNmToConceptSpV.Len(); DomainN2++){
1597        PBowSpV ConceptSpV2=DomainNmToConceptSpV[DomainN2];
1598        double Sim=BowSim-&gt;GetSim(ConceptSpV1, ConceptSpV2);
1599        SimSum+=Sim;
1600        SimN1N2TrV.Add(TFltIntIntTr(Sim, DomainN1, DomainN2));
1601      }
1602    }
1603    SimN1N2TrV.Sort(false);
1604    PGraph Graph=TGraph::New();
1605    for (int DomainN=0; DomainN&lt;DomainNmToConceptSpV.Len(); DomainN++){
1606      TStr DomainNm=DomainNmToConceptSpV.GetKey(DomainN);
1607      TStr DomainDescStr=DomainNmToDescH.GetDat(DomainNm);
1608      Graph-&gt;AddVrtx(TGVrtx::New(DomainN, DomainDescStr));
1609    }
1610    double SimSumSF=0;
1611    for (int SimTrN=0; SimTrN&lt;SimN1N2TrV.Len(); SimTrN++){
1612      double Sim=SimN1N2TrV[SimTrN].Val1;
1613      double DomainN1=SimN1N2TrV[SimTrN].Val2;
1614      double DomainN2=SimN1N2TrV[SimTrN].Val3;
1615      if (SimSumSF&gt;SimSumPrc*SimSum){continue;}
1616      PVrtx Vrtx1=Graph-&gt;GetVrtx(DomainN1);
1617      PVrtx Vrtx2=Graph-&gt;GetVrtx(DomainN2);
1618      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(Sim, &quot;%.2f&quot;), false);
1619      Edge-&gt;PutWgt(Sim);
1620      Graph-&gt;AddEdge(Edge);
1621      SimSumSF+=Sim;
1622    }
1623    Graph-&gt;SetEdgeWidth(5);
1624    Graph-&gt;SaveTxt(FNm);
1625    printf(&quot;Done.\n&quot;);
1626  }
1627  void TEpBs::SaveUnitSim(
1628   const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs,
1629   const double&amp; SimSumPrc, const int&amp; MxKws) const {
1630    printf(&quot;Save Unit Graph to %s ...\n&quot;, FNm.CStr());
1631    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1632    TStrStrH UnitNmToDescH;
1633    THash&lt;TStr, PBowSpV&gt; UnitNmToConceptSpV;
1634    for (int UnitId=0; UnitId&lt;GetUnits(); UnitId++){
1635      PEpUnit Unit=GetUnit(UnitId);
1636      TStr UnitNm=Unit-&gt;GetUnitNm();
1637      if (UnitNm==&quot;#EMPTY&quot;){continue;}
1638      TIntV DIdV; int DId;
1639      for (int ProjN=0; ProjN&lt;Unit-&gt;GetProjs(); ProjN++){
1640        TStr ProjNm=Unit-&gt;GetProjNm(ProjN);
1641        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1642      }
1643      PBowSpV ConceptSpV;
1644      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1645      TStrFltPrV WordStrWgtPrV;
1646      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, MxKws, 0.5, WordStrWgtPrV);
1647      UnitNmToConceptSpV.AddDat(UnitNm, ConceptSpV);
1648      TChA UnitDescChA;
1649      if (UnitNm==TEpBs::GetUnitDNm(UnitNm)){
1650        UnitDescChA+=UnitNm+&quot;(&quot;+TInt::GetStr(Unit-&gt;GetProjs())+&quot;)&quot;;
1651      } else {
1652        UnitDescChA+=UnitNm+&quot;/&quot;+TEpBs::GetUnitDNm(UnitNm)+&quot;(&quot;+TInt::GetStr(Unit-&gt;GetProjs())+&quot;)&quot;;
1653      }
1654      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1655        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1656        double WordWgt=WordStrWgtPrV[WordN].Val2;
1657        UnitDescChA+=TStr(&quot;\\&quot;)+WordStr+&quot;:&quot;+TFlt::GetStr(WordWgt, &quot;%.2f&quot;);
1658      }
1659      UnitNmToDescH.AddDat(UnitNm, UnitDescChA);
1660    }
1661    PBowSim BowSim=TBowSim::New(bstCos); 
1662    TFltVV UnitSimVV;
1663    double SimSum=0; TFltIntIntTrV SimN1N2TrV;
1664    for (int UnitN1=0; UnitN1&lt;UnitNmToConceptSpV.Len(); UnitN1++){
1665      PBowSpV ConceptSpV1=UnitNmToConceptSpV[UnitN1];
1666      for (int UnitN2=UnitN1+1; UnitN2&lt;UnitNmToConceptSpV.Len(); UnitN2++){
1667        PBowSpV ConceptSpV2=UnitNmToConceptSpV[UnitN2];
1668        double Sim=BowSim-&gt;GetSim(ConceptSpV1, ConceptSpV2);
1669        SimSum+=Sim;
1670        SimN1N2TrV.Add(TFltIntIntTr(Sim, UnitN1, UnitN2));
1671      }
1672    }
1673    SimN1N2TrV.Sort(false);
1674    PGraph Graph=TGraph::New();
1675    for (int UnitN=0; UnitN&lt;UnitNmToConceptSpV.Len(); UnitN++){
1676      TStr UnitNm=UnitNmToConceptSpV.GetKey(UnitN);
1677      TStr UnitDescStr=UnitNmToDescH.GetDat(UnitNm);
1678      Graph-&gt;AddVrtx(TGVrtx::New(UnitN, UnitDescStr));
1679    }
1680    double SimSumSF=0;
1681    for (int SimTrN=0; SimTrN&lt;SimN1N2TrV.Len(); SimTrN++){
1682      double Sim=SimN1N2TrV[SimTrN].Val1;
1683      double UnitN1=SimN1N2TrV[SimTrN].Val2;
1684      double UnitN2=SimN1N2TrV[SimTrN].Val3;
1685      if (SimSumSF&gt;SimSumPrc*SimSum){continue;}
1686      PVrtx Vrtx1=Graph-&gt;GetVrtx(UnitN1);
1687      PVrtx Vrtx2=Graph-&gt;GetVrtx(UnitN2);
1688      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(Sim, &quot;%.2f&quot;), false);
1689      Edge-&gt;PutWgt(Sim);
1690      Graph-&gt;AddEdge(Edge);
1691      SimSumSF+=Sim;
1692    }
1693    Graph-&gt;SetEdgeWidth(5);
1694    Graph-&gt;SaveTxt(FNm);
1695    printf(&quot;Done.\n&quot;);
1696  }
1697  void TEpBs::SaveOfficerSim(
1698   const TStr&amp; GraphFNm, const PBowDocBs&amp; EpBowDocBs,
1699   const double&amp; SimSumPrc, const int&amp; MxKws) const {
1700    printf(&quot;Save Officer Graph to %s ...\n&quot;, GraphFNm.CStr());
1701    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1702    TStrStrH OfficerNmToDescH;
1703    THash&lt;TStr, PBowSpV&gt; OfficerNmToConceptSpV;
1704    for (int OfficerId=0; OfficerId&lt;GetOfficers(); OfficerId++){
1705      PEpOfficer Officer=GetOfficer(OfficerId);
1706      TStr OfficerNm=Officer-&gt;GetOfficerNm();
1707      if (OfficerNm==&quot;#EMPTY&quot;){continue;}
1708      if (OfficerNm.GetTrunc().Empty()){continue;}
1709      TIntV DIdV; int DId;
1710      for (int ProjN=0; ProjN&lt;Officer-&gt;GetProjs(); ProjN++){
1711        TStr ProjNm=Officer-&gt;GetProjNm(ProjN);
1712        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1713      }
1714      PBowSpV ConceptSpV;
1715      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1716      TStrFltPrV WordStrWgtPrV;
1717      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, MxKws, 0.5, WordStrWgtPrV);
1718      OfficerNmToConceptSpV.AddDat(OfficerNm, ConceptSpV);
1719      TChA OfficerDescChA;
1720      OfficerDescChA+=OfficerNm+&quot;(&quot;+TInt::GetStr(Officer-&gt;GetProjs())+&quot;)&quot;;
1721      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1722        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1723        double WordWgt=WordStrWgtPrV[WordN].Val2;
1724        OfficerDescChA+=TStr(&quot;\\&quot;)+WordStr+&quot;:&quot;+TFlt::GetStr(WordWgt, &quot;%.2f&quot;);
1725      }
1726      OfficerNmToDescH.AddDat(OfficerNm, OfficerDescChA);
1727    }
1728    PBowSim BowSim=TBowSim::New(bstCos); 
1729    TFltVV OfficerSimVV;
1730    double SimSum=0; TFltIntIntTrV SimN1N2TrV;
1731    for (int OfficerN1=0; OfficerN1&lt;OfficerNmToConceptSpV.Len(); OfficerN1++){
1732      PBowSpV ConceptSpV1=OfficerNmToConceptSpV[OfficerN1];
1733      for (int OfficerN2=OfficerN1+1; OfficerN2&lt;OfficerNmToConceptSpV.Len(); OfficerN2++){
1734        PBowSpV ConceptSpV2=OfficerNmToConceptSpV[OfficerN2];
1735        double Sim=BowSim-&gt;GetSim(ConceptSpV1, ConceptSpV2);
1736        SimSum+=Sim;
1737        SimN1N2TrV.Add(TFltIntIntTr(Sim, OfficerN1, OfficerN2));
1738      }
1739    }
1740    SimN1N2TrV.Sort(false);
1741    PGraph Graph=TGraph::New();
1742    for (int OfficerN=0; OfficerN&lt;OfficerNmToConceptSpV.Len(); OfficerN++){
1743      TStr OfficerNm=OfficerNmToConceptSpV.GetKey(OfficerN);
1744      TStr OfficerDescStr=OfficerNmToDescH.GetDat(OfficerNm);
1745      Graph-&gt;AddVrtx(TGVrtx::New(OfficerN, OfficerDescStr));
1746    }
1747    double SimSumSF=0;
1748    for (int SimTrN=0; SimTrN&lt;SimN1N2TrV.Len(); SimTrN++){
1749      double Sim=SimN1N2TrV[SimTrN].Val1;
1750      double OfficerN1=SimN1N2TrV[SimTrN].Val2;
1751      double OfficerN2=SimN1N2TrV[SimTrN].Val3;
1752      if (SimSumSF&gt;SimSumPrc*SimSum){continue;}
1753      PVrtx Vrtx1=Graph-&gt;GetVrtx(OfficerN1);
1754      PVrtx Vrtx2=Graph-&gt;GetVrtx(OfficerN2);
1755      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(Sim, &quot;%.2f&quot;), false);
1756      Edge-&gt;PutWgt(Sim);
1757      Graph-&gt;AddEdge(Edge);
1758      SimSumSF+=Sim;
1759    }
1760    Graph-&gt;SetEdgeWidth(5);
1761    Graph-&gt;SaveTxt(GraphFNm);
1762    printf(&quot;Done.\n&quot;);
1763  }
1764  void TEpBs::SaveOrgPowerDist(const TStr&amp; FNm) const {
1765    int Orgs=GetOrgs();
1766    TIntPrV ClbOrgsOrgIdPrV; TIntIntH ClbOrgsToFqH;
1767    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1768      PEpOrg Org=GetOrg(OrgId);
1769      ClbOrgsOrgIdPrV.Add(TIntPr(Org-&gt;GetClbOrgs(), OrgId));
1770      ClbOrgsToFqH.AddDat(Org-&gt;GetClbOrgs())++;
1771    }
1772    ClbOrgsOrgIdPrV.Sort(false);
1773    TIntPrV FqClbOrgsPrV; ClbOrgsToFqH.GetDatKeyPrV(FqClbOrgsPrV);
1774    FqClbOrgsPrV.Sort(false);
1775    TFOut FOut(FNm);
1776    ClbOrgsOrgIdPrV.Save(FOut);
1777    FqClbOrgsPrV.Save(FOut);
1778  }
1779  void TEpBs::SaveCountryProjects(const TStr&amp; FNm,
1780   const PCordisEuProjBs&amp; EuProjBs, const TStr&amp; CountryNm) const {
1781    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1782    PEpCountry Country=GetCountry(CountryNm);
1783    for (int ProjN=0; ProjN&lt;Country-&gt;GetProjs(); ProjN++){
1784      TStr ProjNm=Country-&gt;GetProjNm(ProjN);
1785      PCordisEuProj EuProj; if (EuProjBs-&gt;IsEuProj(ProjNm, EuProj)){}
1786      PEpProj Proj=GetProj(ProjNm);
1787      fprintf(fOut, &quot;*** %s/%s-%s\n&quot;, Proj-&gt;GetProjNm().CStr(),
1788       Proj-&gt;GetDomainNm().CStr(), Proj-&gt;GetUnitNm().CStr());
1789      if (!EuProj.Empty()){
1790        fprintf(fOut, &quot;Title: %s\n&quot;, EuProj-&gt;GetTitleStr().CStr());}
1791      fprintf(fOut, &quot;Officer: %s\n&quot;, Proj-&gt;GetOfficerNm().CStr());
1792      fprintf(fOut, &quot;Organizations (%d):\n&quot;, Proj-&gt;GetOrgs());
1793      for (int OrgN=0; OrgN&lt;Proj-&gt;GetOrgs(); OrgN++){
1794        fprintf(fOut, &quot;   %s/%s\n&quot;, Proj-&gt;GetOrgNm(OrgN, this).CStr(),
1795         GetOrg(Proj-&gt;GetOrgNm(OrgN, this))-&gt;GetCountryNm().CStr());
1796      }
1797      fprintf(fOut, &quot;\n&quot;);
1798    }
1799  }
1800  void TEpBs::GetClbWgtProjNmPrV(
1801   TFltStrPrV&amp; ClbWgtProjNmPrV, const int&amp; DumpTopProjs) const {
1802    ClbWgtProjNmPrV.Clr();
1803    for (int ProjN=0; ProjN&lt;GetProjs(); ProjN++){
1804      PEpProj Proj=GetProj(ProjN);
1805      double ClbWgt=0;
1806      for (int OrgN=0; OrgN&lt;Proj-&gt;GetOrgs(); OrgN++){
1807        TStr OrgNm=Proj-&gt;GetOrgNm(OrgN, this);
1808        ClbWgt+=log(1+GetOrg(OrgNm)-&gt;GetClbOrgs());
1809      }
1810      ClbWgtProjNmPrV.Add(TFltStrPr(ClbWgt, Proj-&gt;GetProjNm()));
1811    }
1812    ClbWgtProjNmPrV.Sort(false);
1813    int DumpProjs=(DumpTopProjs==-1) ? GetProjs() : DumpTopProjs;
1814    {for (int ProjN=0; ProjN&lt;DumpProjs; ProjN++){
1815      double ClbWgt=ClbWgtProjNmPrV[ProjN].Val1;
1816      TStr ProjNm=ClbWgtProjNmPrV[ProjN].Val2;
1817      PEpProj Proj=GetProj(ProjNm);
1818      printf(&quot;%d. [%.1f] %s:\n&quot;, 1+ProjN, ClbWgt, ProjNm.CStr());
1819    }}
1820  }
1821  void TEpBs::GetBestClbWgtProjNmV(const int&amp; BestProjs, TStrV&amp; BestProjNmV){
1822    TFltStrPrV ClbWgtProjNmPrV; GetClbWgtProjNmPrV(ClbWgtProjNmPrV);
1823    int Projs=GetProjs(); BestProjNmV.Clr();
1824    for (int ProjN=0; ProjN&lt;BestProjs; ProjN++){
1825      if (ProjN&gt;=Projs){break;}
1826      BestProjNmV.Add(ClbWgtProjNmPrV[ProjN].Val2);
1827    }
1828  }
</code></pre>
        </div>
        <div class="column">
            <h3>snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-euproj.cpp</h3>
            <pre><code>1  #include &quot;euproj.h&quot;
2  #include &quot;graph.h&quot;
3  TStr TEpOrg::GetMultiLnOrgNm(
4   const TStr&amp; OrgNm, const int&amp; MnLnLen, const char&amp; NewLnCh){
5    TChA OrgNmChA=OrgNm;
6    TChA MultiLnOrgNmChA; int LnLen=0;
7    for (int ChN=0; ChN&lt;OrgNmChA.Len(); ChN++){
8      if ((LnLen&gt;MnLnLen)&amp;&amp;(OrgNmChA[ChN]==&#x27; &#x27;)){
9        MultiLnOrgNmChA+=NewLnCh; LnLen=0;
10      } else {
11        MultiLnOrgNmChA+=OrgNmChA[ChN]; LnLen++;
12      }
13    }
14    return MultiLnOrgNmChA;
15  }
16  TStr TEpOrg::GetClbOrgNm(const int&amp; ClbOrgN, const TEpBs* EpBs) const {
17    int ClbOrgId=ClbOrgIdToFqH.GetKey(ClbOrgN);
18    return EpBs-&gt;GetOrg(ClbOrgId)-&gt;GetOrgNm();
19  }
20  int TEpOrg::GetClbOrgFq(const TStr&amp; ClbOrgNm, const TEpBs* EpBs) const {
21    int ClbOrgId=EpBs-&gt;GetOrgId(ClbOrgNm);
22    if (ClbOrgIdToFqH.IsKey(ClbOrgId)){
23      return ClbOrgIdToFqH.GetDat(ClbOrgId);}
24    else {return 0;}
25  }
26  void TEpOrg::GetClbOrgProjNmV(
27   const TStr&amp; ClbOrgNm, TStrV&amp; ProjNmV, const TEpBs* EpBs) const {
28    int ClbOrgId=EpBs-&gt;GetOrgId(ClbOrgNm);
29    ProjNmV=ClbOrgIdToProjNmVH.GetDat(ClbOrgId);
30  }
31  void TEpOrg::AddClbOrg(
32   const TStr&amp; ClbOrgNm, const TStr&amp; ProjNm, const TEpBs* EpBs){
33    int ClbOrgId=EpBs-&gt;GetOrgId(ClbOrgNm);
34    ClbOrgIdToFqH.AddDat(ClbOrgId)++;
35    ClbOrgIdToProjNmVH.AddDat(ClbOrgId).AddSorted(ProjNm);
36    SumClbOrgFq++;
37  }
38  void TEpCountry::AddOrg(const TStr&amp; OrgNm, const TEpBs* EpBs){
39    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
40    OrgIdToFqH.AddDat(OrgId)++;
41  }
42  TStr TEpCountry::GetOrgNm(const int&amp; OrgN, const TEpBs* EpBs) const {
43    int OrgId=OrgIdToFqH.GetKey(OrgN);
44    return EpBs-&gt;GetOrg(OrgId)-&gt;GetOrgNm();
45  }
46  void TEpOfficer::AddOrg(const TStr&amp; OrgNm, const TEpBs* EpBs){
47    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
48    OrgIdToFqH.AddDat(OrgId)++;
49  }
50  void TEpProj::AddOrgNmRole(
51   const TStr&amp; OrgNm, const TStr&amp; OrgRoleNm, const TEpBs* EpBs){
52    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
53    OrgIdRoleKdV.AddMerged(TIntStrKd(OrgId, OrgRoleNm));
54  }
55  TStr TEpProj::GetRole(const TStr&amp; OrgNm, const TEpBs* EpBs) const {
56    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
57    return OrgIdRoleKdV.GetDat(TIntStrKd(OrgId)).Dat;
58  }
59  TStr TEpProj::GetOrgNm(const int&amp; OrgN, const TEpBs* EpBs) const {
60    int OrgId=OrgIdRoleKdV[OrgN].Key;
61    return EpBs-&gt;GetOrg(OrgId)-&gt;GetOrgNm();
62  }
63  void TEpDomain::AddOrg(const TStr&amp; OrgNm, const TEpBs* EpBs){
64    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
65    OrgIdToFqH.AddDat(OrgId)++;
66  }
67  TStr TEpDomain::GetOrgNm(const int&amp; OrgN, const TEpBs* EpBs) const {
68    int OrgId=OrgIdToFqH.GetKey(OrgN);
69    return EpBs-&gt;GetOrg(OrgId)-&gt;GetOrgNm();
70  }
71  bool TEpDomain::IsOrg(const TStr&amp; OrgNm, TInt&amp; OrgFq, const TEpBs* EpBs) const {
72    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
73    return OrgIdToFqH.IsKeyGetDat(OrgId, OrgFq);
74  }
75  void TEpUnit::AddOrg(const TStr&amp; OrgNm, const TEpBs* EpBs){
76    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
77    OrgIdToFqH.AddDat(OrgId)++;
78  }
79  TStr TEpUnit::GetOrgNm(const int&amp; OrgN, const TEpBs* EpBs) const {
80    int OrgId=OrgIdToFqH.GetKey(OrgN);
81    return EpBs-&gt;GetOrg(OrgId)-&gt;GetOrgNm();
82  }
83  bool TEpUnit::IsOrg(const TStr&amp; OrgNm, TInt&amp; OrgFq, const TEpBs* EpBs) const {
84    int OrgId=EpBs-&gt;GetOrgId(OrgNm);
85    return OrgIdToFqH.IsKeyGetDat(OrgId, OrgFq);
86  }
87  TStr TEpBs::GetUnitDNm(const TStr&amp; UnitNm){
88    if (UnitNm==&quot;B1&quot;){return &quot;Health-Applications&quot;;}
89    if (UnitNm==&quot;B2&quot;){return &quot;Handicapped&amp;Eldely&quot;;}
90    if (UnitNm==&quot;B3&quot;){return &quot;eGovernment&quot;;}
91    if (UnitNm==&quot;B4&quot;){return &quot;Environment&quot;;}
92    if (UnitNm==&quot;B5&quot;){return &quot;Transport&amp;Tourism&quot;;}
93    if (UnitNm==&quot;C1&quot;){return &quot;eWork&quot;;}
94    if (UnitNm==&quot;C2&quot;){return &quot;eBusiness&quot;;}
95    if (UnitNm==&quot;C3&quot;){return &quot;eCommerce&quot;;}
96    if (UnitNm==&quot;C4&quot;){return &quot;Trust&amp;Security&quot;;}
97    if (UnitNm==&quot;D1&quot;){return &quot;ePublishing&quot;;}
98    if (UnitNm==&quot;D2&quot;){return &quot;Cultural-Heritage&quot;;}
99    if (UnitNm==&quot;D3&quot;){return &quot;eLearning&quot;;}
100    if (UnitNm==&quot;D4&quot;){return &quot;Linguistics&quot;;}
101    if (UnitNm==&quot;E1&quot;){return &quot;Networks&quot;;}
102    if (UnitNm==&quot;E2&quot;){return &quot;Software&quot;;}
103    if (UnitNm==&quot;E3&quot;){return &quot;Multimedia&amp;Displays&quot;;}
104    if (UnitNm==&quot;E4&quot;){return &quot;Mobile-Communications&quot;;}
105    if (UnitNm==&quot;E5&quot;){return &quot;Peripherals&amp;Microsystems&quot;;}
106    if (UnitNm==&quot;E6&quot;){return &quot;Microelectronics&quot;;}
107    if (UnitNm==&quot;F1&quot;){return &quot;Future&amp;Emerging-Technologies&quot;;}
108    if (UnitNm==&quot;F2&quot;){return &quot;Research-Networks&quot;;}
109    return UnitNm;
110  }
111  void TEpBs::GetOrgIdSetV(const int&amp; OrgId,
112   const int&amp; Depth, TBoolV&amp; OrgIdSetV, int&amp; OrgIdSetVTrues) const {
113    int Orgs=GetOrgs();
114    OrgIdSetV.Gen(Orgs);
115    if (Depth==-1){return;}
116    if (!OrgIdSetV[OrgId]){
117      OrgIdSetV[OrgId]=true; OrgIdSetVTrues++;}
118    if (Depth&gt;0){
119      PEpOrg Org=GetOrg(OrgId);
120      int ClbOrgs=Org-&gt;GetClbOrgs();
121      for (int ClbOrgN=0; ClbOrgN&lt;ClbOrgs; ClbOrgN++){
122        int ClbOrgId=Org-&gt;GetClbOrgId(ClbOrgN);
123        TBoolV SubOrgIdSetV;
124        GetOrgIdSetV(ClbOrgId, Depth-1, SubOrgIdSetV, OrgIdSetVTrues);
125        for (int SubOrgId=0; SubOrgId&lt;Orgs; SubOrgId++){
126          OrgIdSetV[SubOrgId]=OrgIdSetV[SubOrgId]||SubOrgIdSetV[SubOrgId];
127        }
128      }
129    }
130  }
131  PMom TEpBs::GetDistMom(const int&amp; StartOrgId) const {
132    PMom DistMom=TMom::New();
133    TIntV OrgDistV(GetOrgs()); OrgDistV.PutAll(-1);
134    TIntPrQ OpenOrgIdQ; OpenOrgIdQ.Push(TIntPr(StartOrgId, 0));
135    OrgDistV[StartOrgId]=0;
136    while (!OpenOrgIdQ.Empty()){
137      int OrgId=OpenOrgIdQ.Top().Val1;
138      int OrgDist=OpenOrgIdQ.Top().Val2;
139      OpenOrgIdQ.Pop();
140      IAssert(OrgDistV[OrgId]==OrgDist);
141      PEpOrg Org=GetOrg(OrgId);
142      int ClbOrgs=Org-&gt;GetClbOrgs();
143      for (int ClbOrgN=0; ClbOrgN&lt;ClbOrgs; ClbOrgN++){
144        int ClbOrgId=Org-&gt;GetClbOrgId(ClbOrgN);
145        if (OrgDistV[ClbOrgId]==-1){
146          OpenOrgIdQ.Push(TIntPr(ClbOrgId, OrgDist+1));
147          OrgDistV[ClbOrgId]=OrgDist+1;
148          DistMom-&gt;Add(OrgDist+1);
149        }
150      }
151    }
152    DistMom-&gt;Def();
153    return DistMom;
154  }
155  PEpBs TEpBs::GetSelEpBs(const PSs&amp; Ss,
156   const TStrV&amp; SelOrgTypeNmV, const TStrV&amp; SelCountryNmV,
157   const TStrV&amp; SelDomainNmV, const TStrV&amp; SelUnitNmV,
158   const TStrV&amp; SelOfficerNmV, const TStrV&amp; SelProjNmV){
159    int ProjRefFldN=Ss-&gt;GetFldX(&quot;Project Ref&quot;);
160    int ProjNmFldN=Ss-&gt;GetFldX(&quot;Acronym&quot;);
161    int DomainFldN=Ss-&gt;GetFldX(&quot;Domain / Key Action&quot;);
162    int UnitFldN=Ss-&gt;GetFldX(&quot;Unit&quot;);
163    int OfficerFldN=Ss-&gt;GetFldX(&quot;PO&quot;);
164    int OrgNmFldN=Ss-&gt;GetFldX(&quot;Legal Name&quot;);
165    int OrgCountryFldN=Ss-&gt;GetFldX(&quot;Legal Country&quot;);
166    int OrgTypeFldN=Ss-&gt;GetFldX(&quot;Type of organisation&quot;);
167    int OrgRoleFldN=Ss-&gt;GetFldX(&quot;Participant role&quot;);
168    PEpBs EpBs=TEpBs::New(Ss);
169    int PPRecs=Ss-&gt;GetYLen();
170    for (int PPRecN=1; PPRecN&lt;PPRecs; PPRecN++){
171      if (PPRecN%100==0){printf(&quot;%d/%d\r&quot;, PPRecN, PPRecs);}
172      TStr ProjRef=Ss-&gt;GetVal(ProjRefFldN, PPRecN);
173      TStr ProjNm=Ss-&gt;GetVal(ProjNmFldN, PPRecN).GetTrunc();
174      TStr DomainNm=Ss-&gt;GetVal(DomainFldN, PPRecN);
175      TStr UnitNm=Ss-&gt;GetVal(UnitFldN, PPRecN);
176      TStr OfficerNm=Ss-&gt;GetVal(OfficerFldN, PPRecN);
177      TStr OrgNm=Ss-&gt;GetVal(OrgNmFldN, PPRecN);
178      TStr CountryNm=Ss-&gt;GetVal(OrgCountryFldN, PPRecN);
179      TStr OrgTypeNm=Ss-&gt;GetVal(OrgTypeFldN, PPRecN);
180      TStr OrgRoleNm=Ss-&gt;GetVal(OrgRoleFldN, PPRecN);
181      if ((!SelOrgTypeNmV.Empty())&amp;&amp;(!SelOrgTypeNmV.IsIn(OrgTypeNm))){continue;}
182      if ((!SelCountryNmV.Empty())&amp;&amp;(!SelCountryNmV.IsIn(CountryNm))){continue;}
183      if ((!SelDomainNmV.Empty())&amp;&amp;(!SelDomainNmV.IsIn(DomainNm))){continue;}
184      if ((!SelUnitNmV.Empty())&amp;&amp;(!SelUnitNmV.IsIn(UnitNm))){continue;}
185      if ((!SelOfficerNmV.Empty())&amp;&amp;(!SelOfficerNmV.IsIn(OfficerNm))){continue;}
186      if ((!SelProjNmV.Empty())&amp;&amp;(!SelProjNmV.IsIn(ProjNm))){continue;}
187      PEpOrg Org;
188      if (!EpBs-&gt;IsOrg(OrgNm, Org)){
189        Org=TEpOrg::New(OrgNm, OrgTypeNm, CountryNm); EpBs-&gt;AddOrg(Org);}
190      Org-&gt;AddProj(ProjNm);
191      PEpCountry Country;
192      if (!EpBs-&gt;IsCountry(CountryNm, Country)){
193        Country=TEpCountry::New(CountryNm); EpBs-&gt;AddCountry(Country);}
194      Country-&gt;AddOrg(OrgNm, EpBs());
195      Country-&gt;AddOrgType(OrgTypeNm);
196      Country-&gt;AddProj(ProjNm);
197      PEpOfficer Officer;
198      if (!EpBs-&gt;IsOfficer(OfficerNm, Officer)){
199        Officer=TEpOfficer::New(OfficerNm); EpBs-&gt;AddOfficer(Officer);}
200      Officer-&gt;AddOrg(OrgNm, EpBs());
201      Officer-&gt;AddProj(ProjNm);
202      Officer-&gt;AddCountry(CountryNm);
203      PEpProj Proj;
204      if (!EpBs-&gt;IsProj(ProjNm, Proj)){
205        Proj=TEpProj::New(ProjNm, ProjRef, DomainNm, UnitNm, OfficerNm);
206        EpBs-&gt;AddProj(Proj);}
207      Proj-&gt;AddOrgNmRole(OrgNm, OrgRoleNm, EpBs());
208      PEpDomain Domain;
209      if (!EpBs-&gt;IsDomain(DomainNm, Domain)){
210        Domain=TEpDomain::New(DomainNm); EpBs-&gt;AddDomain(Domain);}
211      Domain-&gt;AddOrg(OrgNm, EpBs());
212      Domain-&gt;AddProj(ProjNm);
213      Domain-&gt;AddCountry(CountryNm);
214      PEpUnit Unit;
215      if (!EpBs-&gt;IsUnit(UnitNm, Unit)){
216        Unit=TEpUnit::New(UnitNm); EpBs-&gt;AddUnit(Unit);}
217      Unit-&gt;AddOrg(OrgNm, EpBs());
218      Unit-&gt;AddProj(ProjNm);
219      Unit-&gt;AddCountry(CountryNm);
220    }
221    printf(&quot;\n&quot;);
222    int Projs=EpBs-&gt;GetProjs();
223    for (int ProjN=0; ProjN&lt;Projs; ProjN++){
224      if (ProjN%1==0){printf(&quot;%d/%d\r&quot;, ProjN, Projs);}
225      PEpProj Proj=EpBs-&gt;GetProj(ProjN);
226      for (int MainOrgN=0; MainOrgN&lt;Proj-&gt;GetOrgs(); MainOrgN++){
227        TStr MainOrgNm=Proj-&gt;GetOrgNm(MainOrgN, EpBs());
228        PEpOrg MainOrg=EpBs-&gt;GetOrg(MainOrgNm);
229        TStr MainCountryNm=MainOrg-&gt;GetCountryNm();
230        PEpCountry MainCountry=EpBs-&gt;GetCountry(MainCountryNm);
231        for (int ClbOrgN=0; ClbOrgN&lt;Proj-&gt;GetOrgs(); ClbOrgN++){
232          if (MainOrgN==ClbOrgN){continue;}
233          TStr ClbOrgNm=Proj-&gt;GetOrgNm(ClbOrgN, EpBs());
234          PEpOrg ClbOrg=EpBs-&gt;GetOrg(ClbOrgNm);
235          TStr ClbCountryNm=ClbOrg-&gt;GetCountryNm();
236          MainOrg-&gt;AddClbOrg(ClbOrgNm, Proj-&gt;GetProjNm(), EpBs());
237          MainCountry-&gt;AddClbCountry(ClbCountryNm);
238        }
239      }
240    }
241    printf(&quot;\n&quot;);
242    return EpBs;
243  }
244  PEpBs TEpBs::GetSelEpBs(
245   const TStr&amp; SelOrgTypeNm, const TStr&amp; SelCountryNm,
246   const TStr&amp; SelDomainNm, const TStr&amp; SelUnitNm,
247   const TStr&amp; SelOfficerNm, const TStr&amp; SelProjNm) const {
248    TStrV SelOrgTypeNmV; TStrV SelCountryNmV; TStrV SelDomainNmV;
249    TStrV SelUnitNmV; TStrV SelOfficerNmV; TStrV SelProjNmV;
250    if (!SelOrgTypeNm.Empty()){SelOrgTypeNmV.Add(SelOrgTypeNm);}
251    if (!SelCountryNm.Empty()){SelCountryNmV.Add(SelCountryNm);}
252    if (!SelDomainNm.Empty()){SelDomainNmV.Add(SelDomainNm);}
253    if (!SelUnitNm.Empty()){SelUnitNmV.Add(SelUnitNm);}
254    if (!SelOfficerNm.Empty()){SelOfficerNmV.Add(SelOfficerNm);}
255    if (!SelProjNm.Empty()){SelProjNmV.Add(SelProjNm);}
256    return TEpBs::GetSelEpBs(Ss,
257     SelOrgTypeNmV, SelCountryNmV, SelDomainNmV,
258     SelUnitNmV, SelOfficerNmV, SelProjNmV);
259  }
260  PEpBs TEpBs::GetSelEpBs(
261   const TStrV&amp; SelOrgTypeNmV, const TStrV&amp; SelCountryNmV,
262   const TStrV&amp; SelDomainNmV, const TStrV&amp; SelUnitNmV,
263   const TStrV&amp; SelOfficerNmV, const TStrV&amp; SelProjNmV) const {
264    return TEpBs::GetSelEpBs(
265     Ss, SelOrgTypeNmV, SelCountryNmV,
266     SelDomainNmV, SelUnitNmV,
267     SelOfficerNmV, SelProjNmV);
268  }
269  PEpBs TEpBs::LoadTxt(const TStr&amp; FNm){
270    PSs Ss=TSs::LoadTxt(ssfTabSep, FNm);
271    PEpBs EpBs=EpBs-&gt;GetSelEpBs(Ss,
272     TStrV(), TStrV(),
273     TStrV(), TStrV(),
274     TStrV(), TStrV());
275    return EpBs;
276  }
277  PEpBs TEpBs::LoadBinOrTxt(const TStr&amp; BinFNm, const TStr&amp; TxtFNm){
278    printf(&quot;Loading files ...\n&quot;);
279    PEpBs EpBs;
280    if (TFile::Exists(BinFNm)){
281      EpBs=TEpBs::LoadBin(BinFNm);
282    } else {
283      EpBs=LoadTxt(TxtFNm);
284      EpBs-&gt;SaveBin(BinFNm);
285    }
286    printf(&quot;Done.\n&quot;);
287    return EpBs;
288  }
289  void TEpBs::LoadBriefOrgNm(const TStr&amp; FNm) const {
290    if (!TFile::Exists(FNm)){
291      printf(&quot;Brief-Organization-Names file doesn&#x27;t exist (%s)\n&quot;, FNm.CStr());
292      return;
293    }
294    PSIn SIn=TFIn::New(FNm);
295    TILx Lx(SIn, TFSet()|iloRetEoln);
296    Lx.GetSym(syQStr, syEoln, syEof);
297    while (Lx.Sym!=syEof){
298      if (Lx.Sym!=syEoln){
299        TStr BriefOrgNm=Lx.Str;
300        TStr OrgNm=Lx.GetQStr();
301        Lx.GetSym(syEoln);
302        PEpOrg Org;
303        if (IsOrg(OrgNm, Org)){
304          Org-&gt;PutBriefOrgNm(BriefOrgNm);
305        }
306      }
307      Lx.GetSym(syQStr, syEoln, syEof);
308    }
309  }
310  void TEpBs::SaveTxtXmlGraph(const TStr&amp; TxtFNm, const TStr&amp; XmlFNm) const {
311    printf(&quot;Save Txt/Xml Graph to %s/%s ...\n&quot;, TxtFNm.CStr(), XmlFNm.CStr());
312    TFOut TxtFOut(TxtFNm); FILE* fTxt=TxtFOut.GetFileId();
313    TFOut XmlFOut(XmlFNm); FILE* fXml=XmlFOut.GetFileId();
314    fprintf(fXml, &quot;&lt;CollaborationGraph&gt;\n&quot;);
315    fprintf(fTxt, &quot;*organizations\t%d\n&quot;, GetOrgs());
316    for (int OrgId=0; OrgId&lt;GetOrgs(); OrgId++){
317      PEpOrg Org=GetOrg(OrgId);
318      fprintf(fTxt, &quot;%d&quot;, OrgId);
319      fprintf(fTxt, &quot;\t%s&quot;, Org-&gt;GetOrgNm().CStr());
320      fprintf(fTxt, &quot;\t%s&quot;, Org-&gt;GetCountryNm().CStr());
321      fprintf(fTxt, &quot;\t%s\n&quot;, Org-&gt;GetOrgTypeNm().CStr());
322      fprintf(fXml, &quot;&lt;Org&gt;&quot;);
323      fprintf(fXml, &quot; &lt;Id&gt;%d&lt;/Id&gt;&quot;, OrgId);
324      fprintf(fXml, &quot; &lt;Name&gt;%s&lt;/Name&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(Org-&gt;GetOrgNm()).CStr());
325      fprintf(fXml, &quot; &lt;Country&gt;%s&lt;/Country&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(Org-&gt;GetCountryNm()).CStr());
326      fprintf(fXml, &quot; &lt;Type&gt;%s&lt;/Type&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(Org-&gt;GetOrgTypeNm()).CStr());
327      fprintf(fXml, &quot; &lt;/Org&gt;\n&quot;);
328    }
329    int Clbs=0;
330    for (int SrcOrgId=0; SrcOrgId&lt;GetOrgs(); SrcOrgId++){
331      PEpOrg SrcOrg=GetOrg(SrcOrgId);
332      for (int ProjN=0; ProjN&lt;SrcOrg-&gt;GetProjs(); ProjN++){
333        TStr ProjNm=SrcOrg-&gt;GetProjNm(ProjN);
334        PEpProj Proj=GetProj(ProjNm);
335        for (int DstOrgN=0; DstOrgN&lt;Proj-&gt;GetOrgs(); DstOrgN++){
336          int DstOrgId=Proj-&gt;GetOrgId(DstOrgN);
337          if (SrcOrgId&gt;=DstOrgId){continue;}
338          Clbs++;
339        }
340      }
341    }
342    fprintf(fTxt, &quot;*collaborations\t%d\n&quot;, Clbs);
343    {for (int SrcOrgId=0; SrcOrgId&lt;GetOrgs(); SrcOrgId++){
344      PEpOrg SrcOrg=GetOrg(SrcOrgId);
345      for (int ProjN=0; ProjN&lt;SrcOrg-&gt;GetProjs(); ProjN++){
346        TStr ProjNm=SrcOrg-&gt;GetProjNm(ProjN);
347        PEpProj Proj=GetProj(ProjNm);
348        TStr DomainNm=GetProj(ProjNm)-&gt;GetDomainNm();
349        TStr UnitNm=GetProj(ProjNm)-&gt;GetUnitNm();
350        for (int DstOrgN=0; DstOrgN&lt;Proj-&gt;GetOrgs(); DstOrgN++){
351          int DstOrgId=Proj-&gt;GetOrgId(DstOrgN);
352          if (SrcOrgId&gt;=DstOrgId){continue;}
353          fprintf(fTxt, &quot;%d&quot;, SrcOrgId);
354          fprintf(fTxt, &quot;\t%d&quot;, DstOrgId);
355          fprintf(fTxt, &quot;\t%s&quot;, ProjNm.CStr());
356          fprintf(fTxt, &quot;\t%s&quot;, DomainNm.CStr());
357          fprintf(fTxt, &quot;\t%s\n&quot;, UnitNm.CStr());
358          fprintf(fXml, &quot;&lt;Clb&gt;&quot;);
359          fprintf(fXml, &quot; &lt;SrcId&gt;%d&lt;/SrcId&gt;&quot;, SrcOrgId);
360          fprintf(fXml, &quot; &lt;DstId&gt;%d&lt;/DstId&gt;&quot;, DstOrgId);
361          fprintf(fXml, &quot; &lt;Proj&gt;%s&lt;/Proj&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(ProjNm).CStr());
362          fprintf(fXml, &quot; &lt;Domain&gt;%s&lt;/Domain&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(DomainNm).CStr());
363          fprintf(fXml, &quot; &lt;Unit&gt;%s&lt;/Unit&gt;&quot;, TXmlLx::GetXmlStrFromPlainStr(UnitNm).CStr());
364          fprintf(fXml, &quot; &lt;/Clb&gt;\n&quot;);
365        }
366      }
367    }}
368    fprintf(fXml, &quot;&lt;/CollaborationGraph&gt;\n&quot;);
369    printf(&quot;Done.\n&quot;);
370  }
371  void TEpBs::SaveTxtCountryClb(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm) const {
372    printf(&quot;Save Country Collaboration to %s/%s ...\n&quot;, TxtFNm.CStr(), GraphFNm.CStr());
373    typedef TPair&lt;TInt, PEpCountry&gt; TFqCountryPr;
374    TVec&lt;TFqCountryPr&gt; FqCountryPrV;
375    TStrPrIntH CountryPrFqH;
376    for (int CountryN=0; CountryN&lt;GetCountries(); CountryN++){
377      PEpCountry Country=GetCountry(CountryN);
378      TStr CountryNm=Country-&gt;GetCountryNm();
379      FqCountryPrV.Add(TFqCountryPr(Country-&gt;GetSumClbCountriesFq(), Country));
380      for (int ClbCountryN=0; ClbCountryN&lt;Country-&gt;GetClbCountries(); ClbCountryN++){
381        TStr ClbCountryNm=Country-&gt;GetClbCountryNm(ClbCountryN);
382        int ClbCountryFq=Country-&gt;GetClbCountryFq(ClbCountryN);
383        CountryPrFqH.AddDat(TStrPr(CountryNm, ClbCountryNm))+=ClbCountryFq;
384      }
385    }
386    TFOut FOut(TxtFNm); FILE* fTxtOut=FOut.GetFileId();
387    TIntStrPrPrV FqCountryPrPrV; CountryPrFqH.GetDatKeyPrV(FqCountryPrPrV);
388    FqCountryPrPrV.Sort(false);
389    fprintf(fTxtOut, &quot;*** All Countries Collaborations:\n&quot;);
390    for (int CountryPrN=0; CountryPrN&lt;FqCountryPrPrV.Len(); CountryPrN++){
391      TStr CountryNm1=FqCountryPrPrV[CountryPrN].Val2.Val1;
392      TStr CountryNm2=FqCountryPrPrV[CountryPrN].Val2.Val2;
393      int Fq=FqCountryPrPrV[CountryPrN].Val1;
394      if ((CountryNm1&gt;CountryNm2)||(Fq&lt;5)){continue;}
395      fprintf(fTxtOut, &quot;%6d: %s - %s\n&quot;, Fq, CountryNm1.CStr(), CountryNm2.CStr());
396    }
397    fprintf(fTxtOut, &quot;\n&quot;);
398    FqCountryPrV.Sort(false);
399    {for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
400      PEpCountry Country=FqCountryPrV[CountryN].Val2;
401      TIntStrPrV FqClbCountryNmPrV;
402      Country-&gt;GetFqClbCountryNmPrV(FqClbCountryNmPrV);
403      FqClbCountryNmPrV.Sort(false);
404      fprintf(fTxtOut, &quot;*** %s (%d collaborations) (rank %d/%d):\n&quot;,
405       Country-&gt;GetCountryNm().CStr(), Country-&gt;GetSumClbCountriesFq(),
406       1+CountryN, FqCountryPrV.Len());
407      for (int SubCountryN=0; SubCountryN&lt;FqClbCountryNmPrV.Len(); SubCountryN++){
408        int Fq=FqClbCountryNmPrV[SubCountryN].Val1;
409        double FqPrc=double(Fq)/Country-&gt;GetSumClbCountriesFq();
410        TStr SubCountryNm=FqClbCountryNmPrV[SubCountryN].Val2;
411        if (FqPrc&lt;0.001){continue;}
412        fprintf(fTxtOut, &quot;   %2d. %s (%.2f%% / %d)\n&quot;,
413         1+SubCountryN, SubCountryNm.CStr(), 100*FqPrc, Fq);
414      }
415      fprintf(fTxtOut, &quot;\n&quot;);
416    }}
417    PGraph Graph=TGraph::New();
418    TStrH CountryNmH;
419    {for (int CountryPrN=0; CountryPrN&lt;FqCountryPrPrV.Len(); CountryPrN++){
420      if (CountryNmH.Len()&gt;11){break;}
421      TStr CountryNm1=FqCountryPrPrV[CountryPrN].Val2.Val1;
422      TStr CountryNm2=FqCountryPrPrV[CountryPrN].Val2.Val2;
423      int Fq=FqCountryPrPrV[CountryPrN].Val1;
424      if (CountryNm1&lt;=CountryNm2){continue;}
425      if (!CountryNmH.IsKey(CountryNm1)){
426        PEpCountry Country1=GetCountry(CountryNm1);
427        int CountryN1=GetCountryN(CountryNm1);
428        CountryNmH.AddKey(CountryNm1);
429        TStr VNm=CountryNm1+&quot;\n(&quot;+TInt::GetStr(Country1-&gt;GetProjs())+&quot;proj.)&quot;;
430        Graph-&gt;AddVrtx(TGVrtx::New(CountryN1, VNm));
431      }
432      if (!CountryNmH.IsKey(CountryNm2)){
433        PEpCountry Country2=GetCountry(CountryNm2);
434        int CountryN2=GetCountryN(CountryNm2);
435        CountryNmH.AddKey(CountryNm2);
436        TStr VNm=CountryNm2+&quot;\n(&quot;+TInt::GetStr(Country2-&gt;GetProjs())+&quot;proj.)&quot;;
437        Graph-&gt;AddVrtx(TGVrtx::New(CountryN2, VNm));
438      }
439      PVrtx Vrtx1=Graph-&gt;GetVrtx(GetCountryN(CountryNm1));
440      PVrtx Vrtx2=Graph-&gt;GetVrtx(GetCountryN(CountryNm2));
441      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TInt::GetStr(Fq), false);
442      Edge-&gt;PutWgt(1+log(Fq));
443      Graph-&gt;AddEdge(Edge);
444    }}
445    Graph-&gt;SetEdgeWidth(5);
446    Graph-&gt;SaveTxt(GraphFNm);
447    printf(&quot;Done.\n&quot;);
448  }
449  void TEpBs::SaveCountryClbTree(const TStr&amp; CountryNm, const TStr&amp; GraphFNm){
450    PGraph Graph=TGraph::New();
451    int RootCountryId=GetCountryN(CountryNm);
452    Graph-&gt;AddVrtx(TGVrtx::New(RootCountryId, CountryNm));
453    TIntV CountryDistV(GetCountries()); CountryDistV.PutAll(-1);
454    CountryDistV[RootCountryId]=0;
455    TIntPrQ OpenCountryIdDistPrQ; OpenCountryIdDistPrQ.Push(TIntPr(RootCountryId, 0));
456    while (!OpenCountryIdDistPrQ.Empty()){
457      int CountryId=OpenCountryIdDistPrQ.Top().Val1;
458      int CountryDist=OpenCountryIdDistPrQ.Top().Val2;
459      OpenCountryIdDistPrQ.Pop();
460      IAssert(CountryDistV[CountryId]==CountryDist);
461      PEpCountry Country=GetCountry(CountryId);
462      TStr CountryNm=Country-&gt;GetCountryNm();
463      printf(&quot;[%s:%d] &quot;, CountryNm.CStr(), CountryDist);
464      if (CountryDist&gt;0){continue;}
465      PVrtx SrcVrtx=Graph-&gt;GetVrtx(CountryId);
466      TIntStrPrV FqClbCountryNmPrV;
467      Country-&gt;GetFqClbCountryNmPrV(FqClbCountryNmPrV);
468      FqClbCountryNmPrV.Sort(false);
469      int SubCountries=FqClbCountryNmPrV.Len();
470      int CreatedSubCountries=0;
471      for (int SubCountryN=0; SubCountryN&lt;SubCountries; SubCountryN++){
472        int SubCountryFq=FqClbCountryNmPrV[SubCountryN].Val1;
473        TStr SubCountryNm=FqClbCountryNmPrV[SubCountryN].Val2;
474        int SubCountryId=GetCountryN(SubCountryNm);
475        if ((CountryDistV[SubCountryId]==-1)&amp;&amp;(!SubCountryNm.IsStrIn(&quot;EMPTY&quot;))){
476          int MxCreatedSubCountries=0;
477          switch (CountryDist){
478            case 0: MxCreatedSubCountries=70; break;
479            case 1: MxCreatedSubCountries=4; break;
480            case 2: MxCreatedSubCountries=2; break;
481            case 3: MxCreatedSubCountries=1; break;
482            case 4: MxCreatedSubCountries=1; break;
483            default: MxCreatedSubCountries=0; break;
484          }
485          CreatedSubCountries++;
486          if (CreatedSubCountries&gt;MxCreatedSubCountries){break;}
487          OpenCountryIdDistPrQ.Push(TIntPr(SubCountryId, CountryDist+1));
488          CountryDistV[SubCountryId]=CountryDist+1;
489          TStr VNm=SubCountryNm;
490          PVrtx DstVrtx=TGVrtx::New(SubCountryId, VNm);
491          Graph-&gt;AddVrtx(DstVrtx);
492          TStr ENm=TInt::GetStr(SubCountryFq);
493          PEdge Edge=TGEdge::New(SrcVrtx, DstVrtx, ENm);
494          Edge-&gt;PutWgt(1+log(SubCountryFq));
495          Graph-&gt;AddEdge(Edge);
496        }
497      }
498    }
499    Graph-&gt;SetEdgeWidth(5);
500    Graph-&gt;SaveTxt(GraphFNm);
501  }
502  void TEpBs::SaveTxtCountryClbPerCap(
503   const TStr&amp; TxtFNm, const TStr&amp; GraphFNm, const PCiaWFBBs&amp; CiaWFBBs) const {
504    printf(&quot;Save Country Collaboration Per Capita to %s/%s ...\n&quot;,
505     TxtFNm.CStr(), GraphFNm.CStr());
506    typedef TPair&lt;TFlt, PEpCountry&gt; TWgtCountryPr;
507    TVec&lt;TWgtCountryPr&gt; WgtCountryPrV;
508    TStrPrFltH CountryPrWgtH;
509    TStrPrIntH CountryPrFqH;
510    for (int CountryN=0; CountryN&lt;GetCountries(); CountryN++){
511      PEpCountry Country=GetCountry(CountryN);
512      TStr CountryNm=Country-&gt;GetCountryNm();
513      PCiaWFBCountry CiaWFBCountry;
514      if (CiaWFBBs-&gt;IsCountry(CountryNm, CiaWFBCountry)){
515        double Population=CiaWFBCountry-&gt;GetFldValNum(&quot;Population&quot;);
516        for (int ClbCountryN=0; ClbCountryN&lt;Country-&gt;GetClbCountries(); ClbCountryN++){
517          TStr ClbCountryNm=Country-&gt;GetClbCountryNm(ClbCountryN);
518          PCiaWFBCountry ClbCiaWFBCountry;
519          if (CiaWFBBs-&gt;IsCountry(ClbCountryNm, ClbCiaWFBCountry)){
520            double ClbPopulation=ClbCiaWFBCountry-&gt;GetFldValNum(&quot;Population&quot;);
521            int ClbCountryFq=Country-&gt;GetClbCountryFq(ClbCountryN);
522            double ClbCountryWgt;
523            if (CountryNm==ClbCountryNm){ClbCountryWgt=ClbCountryFq/ClbPopulation;}
524            else {ClbCountryWgt=ClbCountryFq/(ClbPopulation+Population);}
525            CountryPrWgtH.AddDat(TStrPr(CountryNm, ClbCountryNm))+=ClbCountryWgt;
526            CountryPrFqH.AddDat(TStrPr(CountryNm, ClbCountryNm))+=ClbCountryFq;
527          }
528        }
529      }
530    }
531    TFOut FOut(TxtFNm); FILE* fTxtOut=FOut.GetFileId();
532    TFltStrPrPrV WgtCountryPrPrV; CountryPrWgtH.GetDatKeyPrV(WgtCountryPrPrV);
533    WgtCountryPrPrV.Sort(false);
534    fprintf(fTxtOut, &quot;*** All Countries Collaborations Per Capita:\n&quot;);
535    fprintf(fTxtOut, &quot;[Rank] [Population-Per-Collaboration] [Collaborations] [Country-Country] [Population]\n&quot;);
536    {int RankN=0;
537    for (int CountryPrN=0; CountryPrN&lt;WgtCountryPrPrV.Len(); CountryPrN++){
538      TStr CountryNm1=WgtCountryPrPrV[CountryPrN].Val2.Val1;
539      TStr CountryNm2=WgtCountryPrPrV[CountryPrN].Val2.Val2;
540      double Wgt=WgtCountryPrPrV[CountryPrN].Val1;
541      int Fq=CountryPrFqH.GetDat(TStrPr(CountryNm1, CountryNm2));
542      double Population1=CiaWFBBs-&gt;GetCountry(CountryNm1)-&gt;GetFldValNum(&quot;Population&quot;);
543      double Population2=CiaWFBBs-&gt;GetCountry(CountryNm2)-&gt;GetFldValNum(&quot;Population&quot;);
544      if ((CountryNm1&gt;CountryNm2)||(Wgt&lt;0)){continue;}
545      if (CountryNm1==CountryNm2){
546        Wgt=Population1/Fq;
547        fprintf(fTxtOut, &quot;%3d. %6.0f ppc (%5d colab.): %s - %s   (pop.: %.0f)\n&quot;,
548         ++RankN, Wgt, Fq, CountryNm1.CStr(), CountryNm2.CStr(), Population1);
549      } else {
550        Wgt=(Population1+Population2)/Fq;
551        fprintf(fTxtOut, &quot;%3d. %6.0f ppc (%5d colab.): %s - %s   (pop.: %.0f=%.0f+%.0f)\n&quot;,
552         ++RankN, Wgt, Fq, CountryNm1.CStr(), CountryNm2.CStr(),
553         Population1+Population2, Population1, Population2);
554      }
555    }}
556    fprintf(fTxtOut, &quot;\n&quot;);
557    PGraph Graph=TGraph::New();
558    TStrH CountryNmH;
559    for (int CountryPrN=0; CountryPrN&lt;WgtCountryPrPrV.Len(); CountryPrN++){
560      if (CountryNmH.Len()&gt;12){break;}
561      TStr CountryNm1=WgtCountryPrPrV[CountryPrN].Val2.Val1;
562      TStr CountryNm2=WgtCountryPrPrV[CountryPrN].Val2.Val2;
563      double Wgt=WgtCountryPrPrV[CountryPrN].Val1;
564      if (CountryNm1&lt;=CountryNm2){continue;}
565      if (!CountryNmH.IsKey(CountryNm1)){
566        PEpCountry Country1=GetCountry(CountryNm1);
567        int CountryN1=GetCountryN(CountryNm1);
568        CountryNmH.AddKey(CountryNm1);
569        TStr VNm=CountryNm1+&quot;\n(&quot;+TInt::GetStr(Country1-&gt;GetProjs())+&quot;proj.)&quot;;
570        Graph-&gt;AddVrtx(TGVrtx::New(CountryN1, VNm));
571      }
572      if (!CountryNmH.IsKey(CountryNm2)){
573        PEpCountry Country2=GetCountry(CountryNm2);
574        int CountryN2=GetCountryN(CountryNm2);
575        CountryNmH.AddKey(CountryNm2);
576        TStr VNm=CountryNm2+&quot;\n(&quot;+TInt::GetStr(Country2-&gt;GetProjs())+&quot;proj.)&quot;;
577        Graph-&gt;AddVrtx(TGVrtx::New(CountryN2, VNm));
578      }
579      int Fq=CountryPrFqH.GetDat(TStrPr(CountryNm1, CountryNm2));
580      double Population1=CiaWFBBs-&gt;GetCountry(CountryNm1)-&gt;GetFldValNum(&quot;Population&quot;);
581      double Population2=CiaWFBBs-&gt;GetCountry(CountryNm2)-&gt;GetFldValNum(&quot;Population&quot;);
582      double PPCWgt=(Population1+Population2)/Fq;
583      PVrtx Vrtx1=Graph-&gt;GetVrtx(GetCountryN(CountryNm1));
584      PVrtx Vrtx2=Graph-&gt;GetVrtx(GetCountryN(CountryNm2));
585      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(PPCWgt, &quot;%0.fppc&quot;), false);
586      Edge-&gt;PutWgt(1+log(Wgt));
587      Graph-&gt;AddEdge(Edge);
588    }
589    Graph-&gt;SetEdgeWidth(5);
590    Graph-&gt;SaveTxt(GraphFNm);
591    printf(&quot;Done.\n&quot;);
592  }
593  void TEpBs::SaveTxtOrgClb(const TStr&amp; FNm) const {
594    printf(&quot;Save Organization Collaboration to %s ...\n&quot;, FNm.CStr());
595    typedef TPair&lt;TInt, PEpOrg&gt; TFqOrgPr;
596    TVec&lt;TFqOrgPr&gt; FqOrgPrV;
597    TStrPrIntH OrgPrFqH;
598    for (int OrgN=0; OrgN&lt;GetOrgs(); OrgN++){
599      PEpOrg Org=GetOrg(OrgN);
600      TStr OrgNm=Org-&gt;GetOrgNm();
601      FqOrgPrV.Add(TFqOrgPr(Org-&gt;GetSumClbOrgsFq(), Org));
602      for (int ClbOrgN=0; ClbOrgN&lt;Org-&gt;GetClbOrgs(); ClbOrgN++){
603        TStr ClbOrgNm=Org-&gt;GetClbOrgNm(ClbOrgN, this);
604        int ClbOrgFq=Org-&gt;GetClbOrgFq(ClbOrgN);
605        OrgPrFqH.AddDat(TStrPr(OrgNm, ClbOrgNm))+=ClbOrgFq;
606      }
607    }
608    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
609    TIntStrPrPrV FqOrgPrPrV; OrgPrFqH.GetDatKeyPrV(FqOrgPrPrV);
610    FqOrgPrPrV.Sort(false);
611    fprintf(fOut, &quot;*** All Organizations Collaborations:\n&quot;);
612    for (int OrgPrN=0; OrgPrN&lt;FqOrgPrPrV.Len(); OrgPrN++){
613      TStr OrgNm1=FqOrgPrPrV[OrgPrN].Val2.Val1;
614      TStr OrgNm2=FqOrgPrPrV[OrgPrN].Val2.Val2;
615      int Fq=FqOrgPrPrV[OrgPrN].Val1;
616      if ((OrgNm1&gt;OrgNm2)||(Fq&lt;3)){continue;}
617      fprintf(fOut, &quot;%6d: &#x27;%s&#x27; - &#x27;%s&#x27;\n&quot;, Fq, OrgNm1.CStr(), OrgNm2.CStr());
618    }
619    fprintf(fOut, &quot;\n&quot;);
620    FqOrgPrV.Sort(false);
621    {for (int OrgN=0; OrgN&lt;FqOrgPrV.Len(); OrgN++){
622      PEpOrg Org=FqOrgPrV[OrgN].Val2;
623      TIntPrV FqClbOrgIdPrV;
624      Org-&gt;GetFqClbOrgIdPrV(FqClbOrgIdPrV);
625      FqClbOrgIdPrV.Sort(false);
626      fprintf(fOut, &quot;*** %s/%s (%d collaborations) (rank: %d/%d):\n&quot;,
627       Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr(), Org-&gt;GetSumClbOrgsFq(),
628       1+OrgN, FqOrgPrV.Len());
629      if (FqClbOrgIdPrV.Len()==0){
630        fprintf(fOut, &quot;   Projects: [&quot;);
631        for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
632          TStr DomainNm=GetProj(Org-&gt;GetProjNm(ProjN))-&gt;GetDomainNm();
633          TStr UnitNm=GetProj(Org-&gt;GetProjNm(ProjN))-&gt;GetUnitNm();
634          fprintf(fOut, &quot;&#x27;%s&#x27;/%s-%s &quot;, Org-&gt;GetProjNm(ProjN).CStr(), DomainNm.CStr(), UnitNm.CStr());
635        }
636        fprintf(fOut, &quot;]\n&quot;);
637      } else {
638        for (int ClbOrgN=0; ClbOrgN&lt;FqClbOrgIdPrV.Len(); ClbOrgN++){
639          int ClbOrgId=FqClbOrgIdPrV[ClbOrgN].Val2;
640          TStr ClbOrgNm=GetOrg(ClbOrgId)-&gt;GetOrgNm();
641          TStr ClbCountryNm=GetOrg(ClbOrgNm)-&gt;GetCountryNm();
642          int Fq=Org-&gt;GetClbOrgFq(ClbOrgNm, this);
643          double FqPrc=double(Fq)/Org-&gt;GetSumClbOrgsFq();
644          TStrV ProjNmV; Org-&gt;GetClbOrgProjNmV(ClbOrgNm, ProjNmV, this);
645          fprintf(fOut, &quot;   %2d. %s/%s (%.2f%% / %d)     [&quot;,
646           1+ClbOrgN, ClbOrgNm.CStr(), ClbCountryNm.CStr(), 100*FqPrc, Fq);
647          for (int ProjN=0; ProjN&lt;ProjNmV.Len(); ProjN++){
648            TStr DomainNm=GetProj(ProjNmV[ProjN])-&gt;GetDomainNm();
649            TStr UnitNm=GetProj(ProjNmV[ProjN])-&gt;GetUnitNm();
650            fprintf(fOut, &quot;&#x27;%s&#x27;/%s-%s &quot;, ProjNmV[ProjN].CStr(), DomainNm.CStr(), UnitNm.CStr());
651          }
652          fprintf(fOut, &quot;]\n&quot;);
653        }
654      }
655      fprintf(fOut, &quot;\n&quot;);
656    }}
657    printf(&quot;Done.\n&quot;);
658  }
659  void TEpBs::SaveTxtDomainClb(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm) const {
660    printf(&quot;Save Domain Collaboration to %s/%s ...\n&quot;, TxtFNm.CStr(), GraphFNm.CStr());
661    TStrPrFltH DomainPrToWgtH;
662    TStrPrFltH DomainPrToOrgsH;
663    for (int DomainN=0; DomainN&lt;GetDomains(); DomainN++){
664      PEpDomain Domain=GetDomain(DomainN);
665      TStr DomainNm=Domain-&gt;GetDomainNm();
666      if (DomainNm==&quot;#EMPTY&quot;){continue;}
667      for (int OrgN=0; OrgN&lt;Domain-&gt;GetOrgs(); OrgN++){
668        TStr OrgNm=Domain-&gt;GetOrgNm(OrgN, this);
669        int OrgFq=Domain-&gt;GetOrgFq(OrgN);
670        if (OrgNm==&quot;#EMPTY&quot;){continue;}
671        for (int SubDomainN=0; SubDomainN&lt;GetDomains(); SubDomainN++){
672          PEpDomain SubDomain=GetDomain(SubDomainN);
673          TStr SubDomainNm=SubDomain-&gt;GetDomainNm();
674          if (SubDomainNm==&quot;#EMPTY&quot;){continue;}
675          TInt SubOrgFq;
676          if (SubDomain-&gt;IsOrg(OrgNm, SubOrgFq, this)){
677            if (DomainNm==SubDomainNm){SubOrgFq--;}
678            double ClbWgt=(OrgFq*SubOrgFq);
679            if (ClbWgt&gt;0){
680              DomainPrToWgtH.AddDat(TStrPr(DomainNm, SubDomainNm))+=ClbWgt;}
681            DomainPrToOrgsH.AddDat(TStrPr(DomainNm, SubDomainNm))++;
682          }
683        }
684      }
685    }
686    TFOut TxtFOut(TxtFNm); FILE* fTxtOut=TxtFOut.GetFileId();
687    TFltStrPrPrV OrgsDomainPrPrV;
688    DomainPrToOrgsH.GetDatKeyPrV(OrgsDomainPrPrV);
689    OrgsDomainPrPrV.Sort(false);
690    fprintf(fTxtOut, &quot;*** Number Of Organizations In Two Domains\n&quot;);
691    int OrgsDomainRank=0;
692    {for (int DomainPrN=0; DomainPrN&lt;OrgsDomainPrPrV.Len(); DomainPrN++){
693      TStr DomainNm1=OrgsDomainPrPrV[DomainPrN].Val2.Val1;
694      TStr DomainNm2=OrgsDomainPrPrV[DomainPrN].Val2.Val2;
695      double ClbOrgs=OrgsDomainPrPrV[DomainPrN].Val1;
696      if (DomainNm1&lt;DomainNm2){continue;}
697      OrgsDomainRank++;
698      fprintf(fTxtOut, &quot;%3d. %6.0f: %s - %s\n&quot;,
699       OrgsDomainRank, ClbOrgs, DomainNm1.CStr(), DomainNm2.CStr());
700    }}
701    fprintf(fTxtOut, &quot;\n&quot;);
702    TFltStrPrPrV WgtDomainPrPrV;
703    DomainPrToWgtH.GetDatKeyPrV(WgtDomainPrPrV);
704    WgtDomainPrPrV.Sort(false);
705    fprintf(fTxtOut, &quot;*** Weighted Number Of Organizations In Two Domains\n&quot;);
706    int WgtDomainRank=0;
707    {for (int DomainPrN=0; DomainPrN&lt;WgtDomainPrPrV.Len(); DomainPrN++){
708      TStr DomainNm1=WgtDomainPrPrV[DomainPrN].Val2.Val1;
709      TStr DomainNm2=WgtDomainPrPrV[DomainPrN].Val2.Val2;
710      double ClbWgt=WgtDomainPrPrV[DomainPrN].Val1;
711      if (DomainNm1&lt;DomainNm2){continue;}
712      WgtDomainRank++;
713      fprintf(fTxtOut, &quot;%3d. %6.0f: %s - %s\n&quot;,
714       WgtDomainRank, ClbWgt, DomainNm1.CStr(), DomainNm2.CStr());
715    }}
716    fprintf(fTxtOut, &quot;\n&quot;);
717    PGraph Graph=TGraph::New();
718    {for (int DomainN=0; DomainN&lt;GetDomains(); DomainN++){
719      TStr DomainNm=GetDomain(DomainN)-&gt;GetDomainNm();
720      if (DomainNm==&quot;#EMPTY&quot;){continue;}
721      Graph-&gt;AddVrtx(TGVrtx::New(DomainN, DomainNm));
722    }}
723    double SumGraphClbOrgs=0;
724    {for (int DomainPrN=0; DomainPrN&lt;OrgsDomainPrPrV.Len(); DomainPrN++){
725      TStr DomainNm1=OrgsDomainPrPrV[DomainPrN].Val2.Val1;
726      TStr DomainNm2=OrgsDomainPrPrV[DomainPrN].Val2.Val2;
727      double ClbOrgs=OrgsDomainPrPrV[DomainPrN].Val1;
728      if (DomainNm1&lt;=DomainNm2){continue;}
729      SumGraphClbOrgs+=ClbOrgs;
730    }}
731    double MnGraphClbOrgs=TFlt::Mx; double MxGraphClbOrgs=TFlt::Mn;
732    double SumGraphClbOrgsSF=0; int MxDomainPrN=0;
733    {for (int DomainPrN=0; DomainPrN&lt;OrgsDomainPrPrV.Len(); DomainPrN++){
734      TStr DomainNm1=OrgsDomainPrPrV[DomainPrN].Val2.Val1;
735      TStr DomainNm2=OrgsDomainPrPrV[DomainPrN].Val2.Val2;
736      double ClbOrgs=OrgsDomainPrPrV[DomainPrN].Val1;
737      if (DomainNm1&lt;=DomainNm2){continue;}
738      SumGraphClbOrgsSF+=ClbOrgs;
739      if (SumGraphClbOrgsSF&gt;SumGraphClbOrgs*0.75){break;}
740      MnGraphClbOrgs=TFlt::GetMn(MnGraphClbOrgs, ClbOrgs);
741      MxGraphClbOrgs=TFlt::GetMx(MxGraphClbOrgs, ClbOrgs);
742      MxDomainPrN=DomainPrN;
743    }}
744    {for (int DomainPrN=0; DomainPrN&lt;=MxDomainPrN; DomainPrN++){
745      TStr DomainNm1=OrgsDomainPrPrV[DomainPrN].Val2.Val1;
746      TStr DomainNm2=OrgsDomainPrPrV[DomainPrN].Val2.Val2;
747      double ClbOrgs=OrgsDomainPrPrV[DomainPrN].Val1;
748      if (DomainNm1&lt;=DomainNm2){continue;}
749      PVrtx Vrtx1=Graph-&gt;GetVrtx(DomainNm1);
750      PVrtx Vrtx2=Graph-&gt;GetVrtx(DomainNm2);
751      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(ClbOrgs, &quot;%.0f&quot;), false);
752      Edge-&gt;PutWgt(ClbOrgs);
753      int Width=1+10*((ClbOrgs-MnGraphClbOrgs)/(MxGraphClbOrgs-MnGraphClbOrgs+1));
754      Edge-&gt;PutWidth(Width);
755      Graph-&gt;AddEdge(Edge);
756    }}
757    Graph-&gt;SaveTxt(GraphFNm);
758    printf(&quot;Done.\n&quot;);
759  }
760  void TEpBs::SaveTxtUnitClb(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm) const {
761    printf(&quot;Save Unit Collaboration to %s/%s ...\n&quot;, TxtFNm.CStr(), GraphFNm.CStr());
762    int Units=GetUnits();
763    TStrPrFltH UnitPrToWgtH;
764    TStrPrFltH UnitPrToOrgsH;
765    for (int UnitN=0; UnitN&lt;Units; UnitN++){
766      PEpUnit Unit=GetUnit(UnitN);
767      TStr UnitNm=Unit-&gt;GetUnitNm();
768      for (int OrgN=0; OrgN&lt;Unit-&gt;GetOrgs(); OrgN++){
769        TStr OrgNm=Unit-&gt;GetOrgNm(OrgN, this);
770        int OrgFq=Unit-&gt;GetOrgFq(OrgN);
771        for (int SubUnitN=0; SubUnitN&lt;Units; SubUnitN++){
772          PEpUnit SubUnit=GetUnit(SubUnitN);
773          TStr SubUnitNm=SubUnit-&gt;GetUnitNm();
774          TInt SubOrgFq;
775          if (SubUnit-&gt;IsOrg(OrgNm, SubOrgFq, this)){
776            if (UnitNm==SubUnitNm){SubOrgFq--;}
777            double ClbWgt=(OrgFq*SubOrgFq);
778            if (ClbWgt&gt;0){
779              UnitPrToWgtH.AddDat(TStrPr(UnitNm, SubUnitNm))+=ClbWgt;}
780            UnitPrToOrgsH.AddDat(TStrPr(UnitNm, SubUnitNm))++;
781          }
782        }
783      }
784    }
785    TFOut TxtFOut(TxtFNm); FILE* fTxtOut=TxtFOut.GetFileId();
786    TFltStrPrPrV OrgsUnitPrPrV;
787    UnitPrToOrgsH.GetDatKeyPrV(OrgsUnitPrPrV);
788    OrgsUnitPrPrV.Sort(false);
789    fprintf(fTxtOut, &quot;*** Number Of Organizations In Two Units\n&quot;);
790    {for (int UnitPrN=0; UnitPrN&lt;OrgsUnitPrPrV.Len(); UnitPrN++){
791      TStr UnitNm1=OrgsUnitPrPrV[UnitPrN].Val2.Val1;
792      TStr UnitNm2=OrgsUnitPrPrV[UnitPrN].Val2.Val2;
793      double ClbOrgs=OrgsUnitPrPrV[UnitPrN].Val1;
794      if (UnitNm1&lt;=UnitNm2){continue;}
795      fprintf(fTxtOut, &quot;%6.0f: %s - %s (%s - %s)\n&quot;, ClbOrgs,
796       UnitNm1.CStr(), UnitNm2.CStr(),
797       GetUnitDNm(UnitNm1).CStr(), GetUnitDNm(UnitNm2).CStr());
798    }}
799    fprintf(fTxtOut, &quot;\n&quot;);
800    TFltStrPrPrV WgtUnitPrPrV;
801    UnitPrToWgtH.GetDatKeyPrV(WgtUnitPrPrV);
802    WgtUnitPrPrV.Sort(false);
803    fprintf(fTxtOut, &quot;*** Weighted-Number Of Organizations In Two Units\n&quot;);
804    {for (int UnitPrN=0; UnitPrN&lt;WgtUnitPrPrV.Len(); UnitPrN++){
805      TStr UnitNm1=WgtUnitPrPrV[UnitPrN].Val2.Val1;
806      TStr UnitNm2=WgtUnitPrPrV[UnitPrN].Val2.Val2;
807      double ClbWgt=WgtUnitPrPrV[UnitPrN].Val1;
808      if (UnitNm1&lt;=UnitNm2){continue;}
809      fprintf(fTxtOut, &quot;%6.0f: %s - %s (%s - %s)\n&quot;, ClbWgt,
810       UnitNm1.CStr(), UnitNm2.CStr(),
811       GetUnitDNm(UnitNm1).CStr(), GetUnitDNm(UnitNm2).CStr());
812    }}
813    fprintf(fTxtOut, &quot;\n&quot;);
814    PGraph Graph=TGraph::New();
815    {for (int UnitN=0; UnitN&lt;GetUnits(); UnitN++){
816      TStr UnitNm=GetUnit(UnitN)-&gt;GetUnitNm();
817      Graph-&gt;AddVrtx(TGVrtx::New(UnitN, UnitNm+&quot;/&quot;+GetUnitDNm(UnitNm)));
818    }}
819    double SumGraphClbOrgs=0;
820    {for (int UnitPrN=0; UnitPrN&lt;OrgsUnitPrPrV.Len(); UnitPrN++){
821      TStr UnitNm1=OrgsUnitPrPrV[UnitPrN].Val2.Val1;
822      TStr UnitNm2=OrgsUnitPrPrV[UnitPrN].Val2.Val2;
823      double ClbOrgs=OrgsUnitPrPrV[UnitPrN].Val1;
824      if (UnitNm1&lt;=UnitNm2){continue;}
825      SumGraphClbOrgs+=ClbOrgs;
826    }}
827    double MnGraphClbOrgs=TFlt::Mx; double MxGraphClbOrgs=TFlt::Mn;
828    double SumGraphClbOrgsSF=0; int MxUnitPrN=0;
829    {for (int UnitPrN=0; UnitPrN&lt;OrgsUnitPrPrV.Len(); UnitPrN++){
830      TStr UnitNm1=OrgsUnitPrPrV[UnitPrN].Val2.Val1;
831      TStr UnitNm2=OrgsUnitPrPrV[UnitPrN].Val2.Val2;
832      double ClbOrgs=OrgsUnitPrPrV[UnitPrN].Val1;
833      if (UnitNm1&lt;=UnitNm2){continue;}
834      SumGraphClbOrgsSF+=ClbOrgs;
835      if (SumGraphClbOrgsSF&gt;SumGraphClbOrgs*0.2){break;}
836      MnGraphClbOrgs=TFlt::GetMn(MnGraphClbOrgs, ClbOrgs);
837      MxGraphClbOrgs=TFlt::GetMx(MxGraphClbOrgs, ClbOrgs);
838      MxUnitPrN=UnitPrN;
839    }}
840    for (int UnitPrN=0; UnitPrN&lt;=MxUnitPrN; UnitPrN++){
841      TStr UnitNm1=OrgsUnitPrPrV[UnitPrN].Val2.Val1;
842      TStr UnitNm2=OrgsUnitPrPrV[UnitPrN].Val2.Val2;
843      double ClbOrgs=OrgsUnitPrPrV[UnitPrN].Val1;
844      if (UnitNm1&lt;=UnitNm2){continue;}
845      PVrtx Vrtx1=Graph-&gt;GetVrtx(UnitNm1+&quot;/&quot;+GetUnitDNm(UnitNm1));
846      PVrtx Vrtx2=Graph-&gt;GetVrtx(UnitNm2+&quot;/&quot;+GetUnitDNm(UnitNm2));
847      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(ClbOrgs, &quot;%.0f&quot;), false);
848      Edge-&gt;PutWgt(ClbOrgs);
849      int Width=1+10*((ClbOrgs-MnGraphClbOrgs)/(MxGraphClbOrgs-MnGraphClbOrgs+1));
850      Edge-&gt;PutWidth(Width);
851      Graph-&gt;AddEdge(Edge);
852    }
853    Graph-&gt;SaveTxt(GraphFNm);
854    printf(&quot;Done.\n&quot;);
855  }
856  void TEpBs::SaveTxtOrgHub(const TStr&amp; CountryHubFNm, const TStr&amp; DomainHubFNm,
857   const TStr&amp; UnitHubFNm) const {
858    printf(&quot;Save Organization Hubs to %s/%s/%s ...\n&quot;,
859     CountryHubFNm.CStr(), DomainHubFNm.CStr(), UnitHubFNm.CStr());
860    TStrStrIntKdVH OrgNmToCountryFqKdVH;
861    TStrStrIntKdVH OrgNmToDomainFqKdVH;
862    TStrStrIntKdVH OrgNmToUnitFqKdVH;
863    for (int OrgN=0; OrgN&lt;GetOrgs(); OrgN++){
864      PEpOrg Org=GetOrg(OrgN);
865      TStr OrgNm=Org-&gt;GetOrgNm();
866      for (int ClbOrgN=0; ClbOrgN&lt;Org-&gt;GetClbOrgs(); ClbOrgN++){
867        TStr ClbOrgNm=Org-&gt;GetClbOrgNm(ClbOrgN, this);
868        int ClbOrgFq=Org-&gt;GetClbOrgFq(ClbOrgN);
869        TStr ClbCountryNm=GetOrg(ClbOrgNm)-&gt;GetCountryNm();
870        TStrIntKdV&amp; CountryFqKdV=OrgNmToCountryFqKdVH.AddDat(OrgNm);
871        CountryFqKdV.GetAddDat(TStrIntKd(ClbCountryNm)).Dat+=ClbOrgFq;
872      }
873      for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
874        TStr ProjNm=Org-&gt;GetProjNm(ProjN);
875        PEpProj Proj=GetProj(ProjNm);
876        TStr DomainNm=Proj-&gt;GetDomainNm();
877        TStrIntKdV&amp; DomainFqKdV=OrgNmToDomainFqKdVH.AddDat(OrgNm);
878        DomainFqKdV.GetAddDat(TStrIntKd(DomainNm)).Dat++;
879        TStr UnitNm=Proj-&gt;GetUnitNm();
880        TStrIntKdV&amp; UnitFqKdV=OrgNmToUnitFqKdVH.AddDat(OrgNm);
881        UnitFqKdV.GetAddDat(TStrIntKd(UnitNm)).Dat++;
882      }
883    }
884    TFltStrPrV CountryWgtOrgPrV;
885    TFltStrPrV DomainWgtOrgPrV;
886    TFltStrPrV UnitWgtOrgPrV;
887    {for (int OrgN=0; OrgN&lt;GetOrgs(); OrgN++){
888      PEpOrg Org=GetOrg(OrgN);
889      TStr OrgNm=Org-&gt;GetOrgNm();
890      if (OrgNmToCountryFqKdVH.IsKey(OrgNm)){
891        TStrIntKdV&amp; CountryFqKdV=OrgNmToCountryFqKdVH.GetDat(OrgNm);
892        double Wgt=0;
893        for (int CountryN=0; CountryN&lt;CountryFqKdV.Len(); CountryN++){
894          int Fq=CountryFqKdV[CountryN].Dat;
895          if (Fq&gt;0){Wgt+=1+log(Fq);}
896        }
897        CountryWgtOrgPrV.Add(TFltStrPr(Wgt, OrgNm));
898      }
899      if (OrgNmToDomainFqKdVH.IsKey(OrgNm)){
900        TStrIntKdV&amp; DomainFqKdV=OrgNmToDomainFqKdVH.GetDat(OrgNm);
901        double Wgt=0;
902        for (int DomainN=0; DomainN&lt;DomainFqKdV.Len(); DomainN++){
903          int Fq=DomainFqKdV[DomainN].Dat;
904          if (Fq&gt;0){Wgt+=1+log(Fq);}
905        }
906        DomainWgtOrgPrV.Add(TFltStrPr(Wgt, OrgNm));
907      }
908      if (OrgNmToUnitFqKdVH.IsKey(OrgNm)){
909        TStrIntKdV&amp; UnitFqKdV=OrgNmToUnitFqKdVH.GetDat(OrgNm);
910        double Wgt=0;
911        for (int UnitN=0; UnitN&lt;UnitFqKdV.Len(); UnitN++){
912          int Fq=UnitFqKdV[UnitN].Dat;
913          if (Fq&gt;0){Wgt+=1+log(Fq);}
914        }
915        UnitWgtOrgPrV.Add(TFltStrPr(Wgt, OrgNm));
916      }
917    }}
918    CountryWgtOrgPrV.Sort(false);
919    DomainWgtOrgPrV.Sort(false);
920    UnitWgtOrgPrV.Sort(false);
921    {TFOut FOut(CountryHubFNm); FILE* fOut=FOut.GetFileId();
922    fprintf(fOut, &quot;*** Country Hubs\n&quot;);
923    fprintf(fOut, &quot;[Rank] [Score] [#Countries] [Organization] [Distribution]\n&quot;);
924    for (int OrgN=0; OrgN&lt;CountryWgtOrgPrV.Len(); OrgN++){
925      double Wgt=CountryWgtOrgPrV[OrgN].Val1;
926      TStr OrgNm=CountryWgtOrgPrV[OrgN].Val2;
927      PEpOrg Org=GetOrg(OrgNm);
928      TStrIntKdV&amp; CountryFqKdV=OrgNmToCountryFqKdVH.GetDat(OrgNm);
929      fprintf(fOut, &quot;%5d. %6.2f (%2d): &#x27;%s&#x27;/%s   [&quot;,
930       1+OrgN, Wgt, CountryFqKdV.Len(), OrgNm.CStr(), Org-&gt;GetCountryNm().CStr());
931      TIntStrPrV FqCountryPrV;
932      for (int CountryN=0; CountryN&lt;CountryFqKdV.Len(); CountryN++){
933        FqCountryPrV.Add(TIntStrPr(CountryFqKdV[CountryN].Dat, CountryFqKdV[CountryN].Key));}
934      FqCountryPrV.Sort(false);
935      {for (int CountryN=0; CountryN&lt;CountryFqKdV.Len(); CountryN++){
936        TStr CountryNm=FqCountryPrV[CountryN].Val2;
937        int Fq=FqCountryPrV[CountryN].Val1;
938        fprintf(fOut, &quot;&#x27;%s&#x27;:%d &quot;, CountryNm.CStr(), Fq);
939      }}
940      fprintf(fOut, &quot;]\n&quot;);
941    }}
942    {TFOut FOut(DomainHubFNm); FILE* fOut=FOut.GetFileId();
943    fprintf(fOut, &quot;*** Domain Hubs\n&quot;);
944    fprintf(fOut, &quot;[Rank] [Score] [#Domains] [Organization] [Distribution]\n&quot;);
945    for (int OrgN=0; OrgN&lt;DomainWgtOrgPrV.Len(); OrgN++){
946      double Wgt=DomainWgtOrgPrV[OrgN].Val1;
947      TStr OrgNm=DomainWgtOrgPrV[OrgN].Val2;
948      PEpOrg Org=GetOrg(OrgNm);
949      TStrIntKdV&amp; DomainFqKdV=OrgNmToDomainFqKdVH.GetDat(OrgNm);
950      fprintf(fOut, &quot;%5d. %6.2f (%2d): &#x27;%s&#x27;/%s   [&quot;,
951       1+OrgN, Wgt, DomainFqKdV.Len(), OrgNm.CStr(), Org-&gt;GetCountryNm().CStr());
952      TIntStrPrV FqDomainPrV;
953      for (int DomainN=0; DomainN&lt;DomainFqKdV.Len(); DomainN++){
954        FqDomainPrV.Add(TIntStrPr(DomainFqKdV[DomainN].Dat, DomainFqKdV[DomainN].Key));}
955      FqDomainPrV.Sort(false);
956      {for (int DomainN=0; DomainN&lt;DomainFqKdV.Len(); DomainN++){
957        TStr DomainNm=FqDomainPrV[DomainN].Val2;
958        int Fq=FqDomainPrV[DomainN].Val1;
959        fprintf(fOut, &quot;&#x27;%s&#x27;:%d &quot;, DomainNm.CStr(), Fq);
960      }}
961      fprintf(fOut, &quot;]\n&quot;);
962    }}
963    {TFOut FOut(UnitHubFNm); FILE* fOut=FOut.GetFileId();
964    fprintf(fOut, &quot;*** Unit Hubs\n&quot;);
965    fprintf(fOut, &quot;[Rank] [Score] [#Units] [Organization] [Distribution]\n&quot;);
966    for (int OrgN=0; OrgN&lt;UnitWgtOrgPrV.Len(); OrgN++){
967      double Wgt=UnitWgtOrgPrV[OrgN].Val1;
968      TStr OrgNm=UnitWgtOrgPrV[OrgN].Val2;
969      PEpOrg Org=GetOrg(OrgNm);
970      TStrIntKdV&amp; UnitFqKdV=OrgNmToUnitFqKdVH.GetDat(OrgNm);
971      fprintf(fOut, &quot;%5d. %6.2f (%2d): &#x27;%s&#x27;/%s   [&quot;,
972       1+OrgN, Wgt, UnitFqKdV.Len(), OrgNm.CStr(), Org-&gt;GetCountryNm().CStr());
973      TIntStrPrV FqUnitPrV;
974      for (int UnitN=0; UnitN&lt;UnitFqKdV.Len(); UnitN++){
975        FqUnitPrV.Add(TIntStrPr(UnitFqKdV[UnitN].Dat, UnitFqKdV[UnitN].Key));}
976      FqUnitPrV.Sort(false);
977      {for (int UnitN=0; UnitN&lt;UnitFqKdV.Len(); UnitN++){
978        TStr UnitNm=FqUnitPrV[UnitN].Val2;
979        int Fq=FqUnitPrV[UnitN].Val1;
980        fprintf(fOut, &quot;&#x27;%s&#x27;(%s):%d &quot;,
981         UnitNm.CStr(), TEpBs::GetUnitDNm(UnitNm).CStr(), Fq);
982      }}
983      fprintf(fOut, &quot;]\n&quot;);
984    }}
985    printf(&quot;Done.\n&quot;);
986  }
987  void TEpBs::SaveOrgConnectivity(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm,
988   const int&amp; MnClbOrgFq) const {
989    int Orgs=GetOrgs();
990    printf(&quot;Save Organization Connectivity %s/%s ...\n&quot;, TxtFNm.CStr(), GraphFNm.CStr());
991    TIntV OrgMarkV(Orgs); OrgMarkV.PutAll(-1);
992    int ConnComps=0; int NonSingleConnComps=0; TIntV ConnCompLenV;
993    forever{
994      int StartOrgId=OrgMarkV.SearchForw(-1);
995      if (StartOrgId==-1){break;}
996      int ConnCompN=ConnComps; ConnComps++; ConnCompLenV.Add(0);
997      TIntQ OpenOrgIdQ; OpenOrgIdQ.Push(StartOrgId);
998      while (!OpenOrgIdQ.Empty()){
999        int OrgId=OpenOrgIdQ.Top(); OpenOrgIdQ.Pop();
1000        PEpOrg Org=GetOrg(OrgId);
1001        IAssert((OrgMarkV[OrgId]==-1)||(OrgMarkV[OrgId]==ConnCompN));
1002        if (OrgMarkV[OrgId]==-1){
1003          OrgMarkV[OrgId]=ConnCompN;
1004          ConnCompLenV[ConnCompN]++;
1005          int ClbOrgs=Org-&gt;GetClbOrgs();
1006          for (int ClbOrgN=0; ClbOrgN&lt;ClbOrgs; ClbOrgN++){
1007            TStr ClbOrgNm=Org-&gt;GetClbOrgNm(ClbOrgN, this);
1008            int ClbOrgFq=Org-&gt;GetClbOrgFq(ClbOrgN);
1009            int ClbOrgId=GetOrgId(ClbOrgNm);
1010            if (ClbOrgFq&gt;=MnClbOrgFq){
1011              IAssert((OrgMarkV[ClbOrgId]==-1)||(OrgMarkV[ClbOrgId]==ConnCompN));
1012              if (OrgMarkV[ClbOrgId]==-1){
1013                OpenOrgIdQ.Push(ClbOrgId);
1014              }
1015            }
1016          }
1017        }
1018      }
1019      if (ConnCompLenV[ConnCompN]&gt;1){
1020        NonSingleConnComps++;}
1021    }
1022    TIntStrVH ConnCompNToOrgNmVH;
1023    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1024      int ConnCompN=OrgMarkV[OrgId];
1025      int ConnCompLen=ConnCompLenV[ConnCompN];
1026      if (ConnCompLen&gt;1){
1027        PEpOrg Org=GetOrg(OrgId);
1028        ConnCompNToOrgNmVH.AddDat(ConnCompN).Add(Org-&gt;GetOrgNm());}
1029    }
1030    TFOut FOut(TxtFNm); FILE* fOut=FOut.GetFileId();
1031    fprintf(fOut, &quot;*** All Connected-Components: %d\n&quot;, ConnComps);
1032    fprintf(fOut, &quot;*** Non-Single Connected-Components: %d\n&quot;, NonSingleConnComps);
1033    fprintf(fOut, &quot;*** Minimal Collaboration-Frequency: %d\n&quot;, MnClbOrgFq);
1034    fprintf(fOut, &quot;\n&quot;);
1035    for (int ConnCompP=0; ConnCompP&lt;ConnCompNToOrgNmVH.Len(); ConnCompP++){
1036      int ConnCompN=ConnCompNToOrgNmVH.GetKey(ConnCompP);
1037      int ConnCompLen=ConnCompLenV[ConnCompN];
1038      TStrV&amp; OrgNmV=ConnCompNToOrgNmVH[ConnCompP];
1039      OrgNmV.Sort();
1040      fprintf(fOut, &quot;*** Connected component %d (%d organizations)\n&quot;,
1041       1+ConnCompP, ConnCompLen);
1042      for (int OrgNmN=0; OrgNmN&lt;OrgNmV.Len(); OrgNmN++){
1043        PEpOrg Org=GetOrg(OrgNmV[OrgNmN]);
1044        fprintf(fOut, &quot;&#x27;%s&#x27;/%s\n&quot;,
1045         Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr());
1046      }
1047      fprintf(fOut, &quot;\n&quot;);
1048    }
1049    PGraph Graph=TGraph::New();
1050    TIntV VrtxOrgIdV;
1051    int Vrtxs=0;
1052    {for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1053      int ConnCompN=OrgMarkV[OrgId];
1054      int ConnCompLen=ConnCompLenV[ConnCompN];
1055      if (ConnCompLen&gt;1){
1056        PEpOrg Org=GetOrg(OrgId);
1057        TStr MLOrgNm=TEpOrg::GetMultiLnOrgNm(Org-&gt;GetOrgNm());
1058        VrtxOrgIdV.Add(OrgId);
1059        Graph-&gt;AddVrtx(TGVrtx::New(OrgId, MLOrgNm));
1060        Vrtxs++;
1061      }
1062    }}
1063    int Edges=0;
1064    for (int OrgIdN1=0; OrgIdN1&lt;VrtxOrgIdV.Len(); OrgIdN1++){
1065      int OrgId1=VrtxOrgIdV[OrgIdN1];
1066      PEpOrg Org1=GetOrg(OrgId1);
1067      for (int OrgIdN2=OrgIdN1+1; OrgIdN2&lt;VrtxOrgIdV.Len(); OrgIdN2++){
1068        int OrgId2=VrtxOrgIdV[OrgIdN2];
1069        PEpOrg Org2=GetOrg(OrgId2);
1070        int ClbFq=Org1-&gt;GetClbOrgFq(Org2-&gt;GetOrgNm(), this);
1071        if (ClbFq&gt;=MnClbOrgFq){
1072          PVrtx Vrtx1=Graph-&gt;GetVrtx(OrgId1);
1073          PVrtx Vrtx2=Graph-&gt;GetVrtx(OrgId2);
1074          PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TInt::GetStr(ClbFq), false);
1075          Edge-&gt;PutWidth(ClbFq-MnClbOrgFq+1);
1076          Graph-&gt;AddEdge(Edge);
1077          Edges++;
1078        }
1079      }
1080    }
1081    if (Edges&gt;0){
1082      Graph-&gt;SaveTxt(GraphFNm);}
1083    printf(&quot;Done.\n&quot;);
1084  }
1085  void TEpBs::SaveOrgConnectivity(const TStr&amp; TxtFNm, const TStr&amp; GraphFNm,
1086   const int&amp; MnClbOrgFq, const int&amp; MxClbOrgFq) const {
1087    for (int ClbOrgFq=MnClbOrgFq; ClbOrgFq&lt;=MxClbOrgFq; ClbOrgFq++){
1088      TStr SubTxtFNm=TxtFNm.GetFPath()+
1089       TxtFNm.GetFMid()+TInt::GetStr(ClbOrgFq)+TxtFNm.GetFExt();
1090      TStr SubGraphFNm=GraphFNm.GetFPath()+
1091       GraphFNm.GetFMid()+TInt::GetStr(ClbOrgFq)+GraphFNm.GetFExt();
1092      SaveOrgConnectivity(SubTxtFNm, SubGraphFNm, ClbOrgFq);
1093    }
1094  }
1095  void TEpBs::SaveOrgSmallWorld(const TStr&amp; TxtFNm, const TStr&amp; TreeFNm) const {
1096    printf(&quot;Save Organization Small World to %s/%s ...\n&quot;, TxtFNm.CStr(), TreeFNm.CStr());
1097    int Orgs=GetOrgs();
1098    typedef TTriple&lt;PMom, TFlt, TInt&gt; TMomDistOrgIdTr;
1099    TVec&lt;TMomDistOrgIdTr&gt; MomDistOrgIdV(Orgs, 0);
1100    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1101      printf(&quot;%d/%d\r&quot;, 1+OrgId, Orgs);
1102      PEpOrg Org=GetOrg(OrgId);
1103      PMom OrgDistMom=GetDistMom(OrgId);
1104      double OrgDistMean=OrgDistMom-&gt;GetMean();
1105      MomDistOrgIdV.Add(TMomDistOrgIdTr(OrgDistMom, -OrgDistMean, OrgId));
1106    }
1107    printf(&quot;\n&quot;);
1108    MomDistOrgIdV.Sort(false);
1109    TFOut TxtFOut(TxtFNm); FILE* fTxtOut=TxtFOut.GetFileId();
1110    fprintf(fTxtOut, &quot;*** Organizations by average distance to the rest of the graph\n&quot;);
1111    for (int OrgIdN=0; OrgIdN&lt;MomDistOrgIdV.Len(); OrgIdN++){
1112      PMom OrgDistMom=MomDistOrgIdV[OrgIdN].Val1;
1113      double OrgMeanDist=-MomDistOrgIdV[OrgIdN].Val2;
1114      int OrgId=MomDistOrgIdV[OrgIdN].Val3;
1115      PEpOrg Org=GetOrg(OrgId);
1116      fprintf(fTxtOut, &quot;%4d. %4.2f avg.dist. &#x27;%s&#x27;/%s (%d projects)\n&quot;,
1117       1+OrgIdN, OrgMeanDist, Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr(),
1118       Org-&gt;GetProjs());
1119    }
1120    fprintf(fTxtOut, &quot;\n&quot;);
1121    fprintf(fTxtOut, &quot;*** Full listing\n&quot;);
1122    {for (int OrgIdN=0; OrgIdN&lt;MomDistOrgIdV.Len(); OrgIdN++){
1123      PMom OrgDistMom=MomDistOrgIdV[OrgIdN].Val1;
1124      double OrgMeanDist=-MomDistOrgIdV[OrgIdN].Val2;
1125      int OrgId=MomDistOrgIdV[OrgIdN].Val3;
1126      PEpOrg Org=GetOrg(OrgId);
1127      fprintf(fTxtOut, &quot;%4d. %4.2f avg.dist. &#x27;%s&#x27;/%s (%d projects):\n\t%s\n&quot;,
1128       1+OrgIdN, OrgMeanDist, Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr(),
1129       Org-&gt;GetProjs(), OrgDistMom-&gt;GetStr(&#x27; &#x27;, &#x27;:&#x27;, true, &quot;%.2f&quot;).CStr());
1130    }}
1131    fprintf(fTxtOut, &quot;\n&quot;);
1132    if (MomDistOrgIdV.Len()&gt;0){
1133      int BestOrgId=MomDistOrgIdV[0].Val3;
1134      PEpOrg BestOrg=GetOrg(BestOrgId);
1135      SaveOrgDistTree(TreeFNm, BestOrg-&gt;GetOrgNm());
1136    }
1137    printf(&quot;Done.\n&quot;);
1138  }
1139  void TEpBs::SaveOfficerStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1140    printf(&quot;Save Officer Statistics to %s ...\n&quot;, FNm.CStr());
1141    int Offs=GetOfficers();
1142    TIntKdV FqOffIdKdV(Offs, 0);
1143    for (int OffId=0; OffId&lt;Offs; OffId++){
1144      PEpOfficer Officer=GetOfficer(OffId);
1145      FqOffIdKdV.Add(TIntKd(Officer-&gt;GetProjs(), OffId));
1146    }
1147    FqOffIdKdV.Sort(false);
1148    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1149    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1150    for (int OffIdN=0; OffIdN&lt;FqOffIdKdV.Len(); OffIdN++){
1151      int OffId=FqOffIdKdV[OffIdN].Dat;
1152      PEpOfficer Officer=GetOfficer(OffId);
1153      TStrIntH OrgNmToFqH;
1154      for (int ProjN=0; ProjN&lt;Officer-&gt;GetProjs(); ProjN++){
1155        TStr ProjNm=Officer-&gt;GetProjNm(ProjN);
1156        PEpProj Proj=GetProj(ProjNm);
1157        for (int OrgN=0; OrgN&lt;Proj-&gt;GetOrgs(); OrgN++){
1158          TStr OrgNm=Proj-&gt;GetOrgNm(OrgN, this);
1159          OrgNmToFqH.AddDat(OrgNm)++;
1160        }
1161      }
1162      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27; (%d projects):\n&quot;,
1163       1+OffIdN, Officer-&gt;GetOfficerNm().CStr(), Officer-&gt;GetProjs());
1164      fprintf(fOut, &quot;Projects(%d):&quot;, Officer-&gt;GetProjs());
1165      {for (int ProjN=0; ProjN&lt;Officer-&gt;GetProjs(); ProjN++){
1166        if ((ProjN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1167        TStr ProjNm=Officer-&gt;GetProjNm(ProjN);
1168        PEpProj Proj=GetProj(ProjNm);
1169        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Proj-&gt;GetProjNm().CStr());
1170      }}
1171      fprintf(fOut, &quot;\n&quot;);
1172      TIntStrPrV FqCountryPrV; Officer-&gt;GetFqCountryPrV(FqCountryPrV);
1173      FqCountryPrV.Sort(false);
1174      fprintf(fOut, &quot;Countries(all:%d)\n&quot;, FqCountryPrV.Len());
1175      int SumOrgFq=0;
1176      for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1177        SumOrgFq+=FqCountryPrV[CountryN].Val1;}
1178      fprintf(fOut, &quot;Organizations-Per-Country(all:%d):&quot;, SumOrgFq);
1179      {for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1180        int Fq=FqCountryPrV[CountryN].Val1;
1181        TStr CountryNm=FqCountryPrV[CountryN].Val2;
1182        if ((CountryN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1183        fprintf(fOut, &quot; %s(%.1f%%/%d)&quot;,
1184         CountryNm.CStr(), 100*Fq/double(SumOrgFq), Fq);
1185      }}
1186      fprintf(fOut, &quot;\n&quot;);
1187      TIntStrPrV FqOrgNmPrV; OrgNmToFqH.GetDatKeyPrV(FqOrgNmPrV);
1188      FqOrgNmPrV.Sort(false);
1189      fprintf(fOut, &quot;Organizations(all:%d):\n&quot;, FqOrgNmPrV.Len());
1190      for (int OrgN=0; OrgN&lt;FqOrgNmPrV.Len(); OrgN++){
1191        int Fq=FqOrgNmPrV[OrgN].Val1;
1192        TStr OrgNm=FqOrgNmPrV[OrgN].Val2;
1193        if (Fq&gt;2){fprintf(fOut, &quot;   &#x27;%s&#x27;:%d\n&quot;, OrgNm.CStr(), Fq);}
1194        else {break;}
1195      }
1196      TIntV DIdV; int DId;
1197      {for (int ProjN=0; ProjN&lt;Officer-&gt;GetProjs(); ProjN++){
1198        TStr ProjNm=Officer-&gt;GetProjNm(ProjN);
1199        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1200      }}
1201      PBowSpV ConceptSpV;
1202      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1203      TStrFltPrV WordStrWgtPrV;
1204      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 25, 0.66, WordStrWgtPrV);
1205      fprintf(fOut, &quot;Keywords:&quot;);
1206      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1207        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1208        double WordWgt=WordStrWgtPrV[WordN].Val2;
1209        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1210        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1211      }
1212      fprintf(fOut, &quot;\n&quot;);
1213      fprintf(fOut, &quot;\n&quot;);
1214    }
1215    printf(&quot;Done.\n&quot;);
1216  }
1217  void TEpBs::SaveOrgStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1218    printf(&quot;Save Organization Statistics to %s ...\n&quot;, FNm.CStr());
1219    int Orgs=GetOrgs();
1220    TIntKdV FqOrgIdKdV(Orgs, 0);
1221    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1222      PEpOrg Org=GetOrg(OrgId);
1223      FqOrgIdKdV.Add(TIntKd(Org-&gt;GetProjs(), OrgId));
1224    }
1225    FqOrgIdKdV.Sort(false);
1226    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1227    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1228    for (int OrgIdN=0; OrgIdN&lt;FqOrgIdKdV.Len(); OrgIdN++){
1229      printf(&quot;%d/%d\r&quot;, OrgIdN, FqOrgIdKdV.Len());
1230      int OrgId=FqOrgIdKdV[OrgIdN].Dat;
1231      PEpOrg Org=GetOrg(OrgId);
1232      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27;/%s (%d projects):\n&quot;,
1233       1+OrgIdN, Org-&gt;GetOrgNm().CStr(), Org-&gt;GetCountryNm().CStr(),
1234       Org-&gt;GetProjs());
1235      fprintf(fOut, &quot;Projects(%d):&quot;, Org-&gt;GetProjs());
1236      for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
1237        if ((ProjN)%5==0){fprintf(fOut, &quot;\n  &quot;);}
1238        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Org-&gt;GetProjNm(ProjN).CStr());
1239      }
1240      fprintf(fOut, &quot;\n&quot;);
1241      TStrIntH RoleNmToFqH;
1242      {for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
1243        PEpProj Proj=GetProj(Org-&gt;GetProjNm(ProjN));
1244        TStr RoleNm=Proj-&gt;GetRole(Org-&gt;GetOrgNm(), this);
1245        RoleNmToFqH.AddDat(RoleNm)++;
1246      }}
1247      TIntStrPrV FqRoleNmPrV; RoleNmToFqH.GetDatKeyPrV(FqRoleNmPrV);
1248      FqRoleNmPrV.Sort(false);
1249      fprintf(fOut, &quot;Project-Roles:\n&quot;);
1250      for (int RoleN=0; RoleN&lt;FqRoleNmPrV.Len(); RoleN++){
1251        int RoleFq=FqRoleNmPrV[RoleN].Val1;
1252        TStr RoleNm=FqRoleNmPrV[RoleN].Val2;
1253        fprintf(fOut, &quot; &#x27;%s&#x27;:%.2f%% (%d/%d)&quot;, RoleNm.CStr(),
1254         100*RoleFq/double(Org-&gt;GetProjs()), RoleFq, Org-&gt;GetProjs());
1255      }
1256      fprintf(fOut, &quot;\n&quot;);
1257      TIntV DIdV; int DId;
1258      {for (int ProjN=0; ProjN&lt;Org-&gt;GetProjs(); ProjN++){
1259        TStr ProjNm=Org-&gt;GetProjNm(ProjN);
1260        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1261      }}
1262      PBowSpV ConceptSpV;
1263      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1264      TStrFltPrV WordStrWgtPrV;
1265      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 25, 0.66, WordStrWgtPrV);
1266      fprintf(fOut, &quot;Keywords:&quot;);
1267      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1268        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1269        double WordWgt=WordStrWgtPrV[WordN].Val2;
1270        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1271        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1272      }
1273      fprintf(fOut, &quot;\n&quot;);
1274      fprintf(fOut, &quot;\n&quot;);
1275    }
1276    printf(&quot;\nDone.\n&quot;);
1277  }
1278  void TEpBs::SaveDomainStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1279    printf(&quot;Save Domain Statistics to %s ...\n&quot;, FNm.CStr());
1280    TIntKdV FqDomainIdKdV(GetDomains(), 0);
1281    for (int DomainId=0; DomainId&lt;GetDomains(); DomainId++){
1282      PEpDomain Domain=GetDomain(DomainId);
1283      FqDomainIdKdV.Add(TIntKd(Domain-&gt;GetProjs(), DomainId));
1284    }
1285    FqDomainIdKdV.Sort(false);
1286    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1287    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1288    for (int DomainIdN=0; DomainIdN&lt;FqDomainIdKdV.Len(); DomainIdN++){
1289      int DomainId=FqDomainIdKdV[DomainIdN].Dat;
1290      PEpDomain Domain=GetDomain(DomainId);
1291      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27; (%d projects):\n&quot;,
1292       1+DomainIdN, Domain-&gt;GetDomainNm().CStr(), Domain-&gt;GetProjs());
1293      TStrIntH OrgTypeToFqH; TStrIntH CountryToFqH; int OrgFqSum=0;
1294      for (int OrgN=0; OrgN&lt;Domain-&gt;GetOrgs(); OrgN++){
1295        int OrgId=Domain-&gt;GetOrgId(OrgN);
1296        int OrgFq=Domain-&gt;GetOrgFq(OrgN);
1297        PEpOrg Org=GetOrg(OrgId);
1298        OrgTypeToFqH.AddDat(Org-&gt;GetOrgTypeNm())+=OrgFq;
1299        CountryToFqH.AddDat(Org-&gt;GetCountryNm())+=OrgFq;
1300        OrgFqSum+=OrgFq;
1301      }
1302      TIntStrPrV FqOrgTypePrV; OrgTypeToFqH.GetDatKeyPrV(FqOrgTypePrV);
1303      TIntStrPrV FqCountryPrV; CountryToFqH.GetDatKeyPrV(FqCountryPrV);
1304      FqOrgTypePrV.Sort(false); FqCountryPrV.Sort(false);
1305      fprintf(fOut, &quot;Organization-Types:\n&quot;);
1306      for (int OrgTypeN=0; OrgTypeN&lt;FqOrgTypePrV.Len(); OrgTypeN++){
1307        int OrgTypeFq=FqOrgTypePrV[OrgTypeN].Val1;
1308        TStr OrgTypeNm=FqOrgTypePrV[OrgTypeN].Val2;
1309        fprintf(fOut, &quot;   &#x27;%s&#x27;: %.0f%% (%d/%d)\n&quot;, OrgTypeNm.CStr(),
1310         100*OrgTypeFq/double(OrgFqSum), OrgTypeFq, OrgFqSum);
1311      }
1312      fprintf(fOut, &quot;Countries:&quot;);
1313      for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1314        int CountryFq=FqCountryPrV[CountryN].Val1;
1315        double CountryPrc=CountryFq/double(OrgFqSum);
1316        if (CountryPrc&lt;0.05){break;}
1317        TStr CountryNm=FqCountryPrV[CountryN].Val2;
1318        if ((CountryN)%2==0){fprintf(fOut, &quot;\n  &quot;);}
1319        fprintf(fOut, &quot; [&#x27;%s&#x27; %.0f%% (%d/%d)]&quot;, CountryNm.CStr(),
1320         100*CountryPrc, CountryFq, OrgFqSum);
1321      }
1322      fprintf(fOut, &quot;\n&quot;);
1323      TIntV DIdV; int DId;
1324      {for (int ProjN=0; ProjN&lt;Domain-&gt;GetProjs(); ProjN++){
1325        TStr ProjNm=Domain-&gt;GetProjNm(ProjN);
1326        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1327      }}
1328      PBowSpV ConceptSpV;
1329      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1330      TStrFltPrV WordStrWgtPrV;
1331      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 50, 0.5, WordStrWgtPrV);
1332      fprintf(fOut, &quot;Keywords:&quot;);
1333      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1334        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1335        double WordWgt=WordStrWgtPrV[WordN].Val2;
1336        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1337        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1338      }
1339      fprintf(fOut, &quot;\n&quot;);
1340      fprintf(fOut, &quot;Projects(%d):&quot;, Domain-&gt;GetProjs());
1341      for (int ProjN=0; ProjN&lt;Domain-&gt;GetProjs(); ProjN++){
1342        if ((ProjN)%5==0){fprintf(fOut, &quot;\n  &quot;);}
1343        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Domain-&gt;GetProjNm(ProjN).CStr());
1344      }
1345      fprintf(fOut, &quot;\n&quot;);
1346      fprintf(fOut, &quot;\n&quot;);
1347    }
1348    printf(&quot;Done.\n&quot;);
1349  }
1350  void TEpBs::SaveUnitStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1351    printf(&quot;Save Unit Statistics to %s ...\n&quot;, FNm.CStr());
1352    int Units=GetUnits();
1353    TIntKdV FqUnitIdKdV(Units, 0);
1354    for (int UnitId=0; UnitId&lt;Units; UnitId++){
1355      PEpUnit Unit=GetUnit(UnitId);
1356      FqUnitIdKdV.Add(TIntKd(Unit-&gt;GetProjs(), UnitId));
1357    }
1358    FqUnitIdKdV.Sort(false);
1359    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1360    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1361    for (int UnitIdN=0; UnitIdN&lt;FqUnitIdKdV.Len(); UnitIdN++){
1362      int UnitId=FqUnitIdKdV[UnitIdN].Dat;
1363      PEpUnit Unit=GetUnit(UnitId);
1364      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27; [%s] (%d projects):\n&quot;,
1365       1+UnitIdN, Unit-&gt;GetUnitNm().CStr(), GetUnitDNm(Unit-&gt;GetUnitNm()).CStr(),
1366       Unit-&gt;GetProjs());
1367      TStrIntH OrgTypeToFqH; TStrIntH CountryToFqH; int OrgFqSum=0;
1368      for (int OrgN=0; OrgN&lt;Unit-&gt;GetOrgs(); OrgN++){
1369        int OrgId=Unit-&gt;GetOrgId(OrgN);
1370        int OrgFq=Unit-&gt;GetOrgFq(OrgN);
1371        PEpOrg Org=GetOrg(OrgId);
1372        OrgTypeToFqH.AddDat(Org-&gt;GetOrgTypeNm())+=OrgFq;
1373        CountryToFqH.AddDat(Org-&gt;GetCountryNm())+=OrgFq;
1374        OrgFqSum+=OrgFq;
1375      }
1376      TIntStrPrV FqOrgTypePrV; OrgTypeToFqH.GetDatKeyPrV(FqOrgTypePrV);
1377      TIntStrPrV FqCountryPrV; CountryToFqH.GetDatKeyPrV(FqCountryPrV);
1378      FqOrgTypePrV.Sort(false); FqCountryPrV.Sort(false);
1379      fprintf(fOut, &quot;Organization-Types:\n&quot;);
1380      for (int OrgTypeN=0; OrgTypeN&lt;FqOrgTypePrV.Len(); OrgTypeN++){
1381        int OrgTypeFq=FqOrgTypePrV[OrgTypeN].Val1;
1382        TStr OrgTypeNm=FqOrgTypePrV[OrgTypeN].Val2;
1383        fprintf(fOut, &quot;   &#x27;%s&#x27;: %.0f%% (%d/%d)\n&quot;, OrgTypeNm.CStr(),
1384         100*OrgTypeFq/double(OrgFqSum), OrgTypeFq, OrgFqSum);
1385      }
1386      fprintf(fOut, &quot;Countries:&quot;);
1387      for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1388        int CountryFq=FqCountryPrV[CountryN].Val1;
1389        double CountryPrc=CountryFq/double(OrgFqSum);
1390        if (CountryPrc&lt;0.03){break;}
1391        TStr CountryNm=FqCountryPrV[CountryN].Val2;
1392        if ((CountryN)%2==0){fprintf(fOut, &quot;\n  &quot;);}
1393        fprintf(fOut, &quot; [&#x27;%s&#x27; %.0f%% (%d/%d)]&quot;, CountryNm.CStr(),
1394         100*CountryPrc, CountryFq, OrgFqSum);
1395      }
1396      fprintf(fOut, &quot;\n&quot;);
1397      TIntV DIdV; int DId;
1398      {for (int ProjN=0; ProjN&lt;Unit-&gt;GetProjs(); ProjN++){
1399        TStr ProjNm=Unit-&gt;GetProjNm(ProjN);
1400        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1401      }}
1402      PBowSpV ConceptSpV;
1403      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1404      TStrFltPrV WordStrWgtPrV;
1405      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 50, 0.5, WordStrWgtPrV);
1406      fprintf(fOut, &quot;Keywords:&quot;);
1407      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1408        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1409        double WordWgt=WordStrWgtPrV[WordN].Val2;
1410        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1411        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1412      }
1413      fprintf(fOut, &quot;\n&quot;);
1414      fprintf(fOut, &quot;Projects(%d):&quot;, Unit-&gt;GetProjs());
1415      for (int ProjN=0; ProjN&lt;Unit-&gt;GetProjs(); ProjN++){
1416        if ((ProjN)%5==0){fprintf(fOut, &quot;\n  &quot;);}
1417        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Unit-&gt;GetProjNm(ProjN).CStr());
1418      }
1419      fprintf(fOut, &quot;\n&quot;);
1420      fprintf(fOut, &quot;\n&quot;);
1421    }
1422    printf(&quot;Done.\n&quot;);
1423  }
1424  void TEpBs::SaveCountryStat(const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs) const {
1425    printf(&quot;Save Country Statistics to %s ...\n&quot;, FNm.CStr());
1426    int Countries=GetCountries();
1427    TIntKdV FqCountryIdKdV(Countries, 0);
1428    for (int CountryId=0; CountryId&lt;Countries; CountryId++){
1429      PEpCountry Country=GetCountry(CountryId);
1430      FqCountryIdKdV.Add(TIntKd(Country-&gt;GetProjs(), CountryId));
1431    }
1432    FqCountryIdKdV.Sort(false);
1433    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1434    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1435    for (int CountryIdN=0; CountryIdN&lt;FqCountryIdKdV.Len(); CountryIdN++){
1436      int CountryId=FqCountryIdKdV[CountryIdN].Dat;
1437      PEpCountry Country=GetCountry(CountryId);
1438      fprintf(fOut, &quot;*** %4d. &#x27;%s&#x27;:\n&quot;, 1+CountryIdN, Country-&gt;GetCountryNm().CStr());
1439      fprintf(fOut, &quot;Projects: %d\n&quot;, Country-&gt;GetProjs());
1440      fprintf(fOut, &quot;Organizations: %d\n&quot;, Country-&gt;GetOrgs());
1441      fprintf(fOut, &quot;Project-Participations: %d\n&quot;, Country-&gt;GetOrgFqSum());
1442      TStrIntH OrgTypeToFqH; TStrIntH OrgToFqH; int OrgFqSum=0;
1443      for (int OrgN=0; OrgN&lt;Country-&gt;GetOrgs(); OrgN++){
1444        int OrgId=Country-&gt;GetOrgId(OrgN);
1445        int OrgFq=Country-&gt;GetOrgFq(OrgN);
1446        PEpOrg Org=GetOrg(OrgId);
1447        OrgTypeToFqH.AddDat(Org-&gt;GetOrgTypeNm())+=OrgFq;
1448        OrgToFqH.AddDat(Org-&gt;GetOrgNm())+=OrgFq;
1449        OrgFqSum+=OrgFq;
1450      }
1451      TIntStrPrV FqOrgTypePrV; OrgTypeToFqH.GetDatKeyPrV(FqOrgTypePrV);
1452      TIntStrPrV FqOrgPrV; OrgToFqH.GetDatKeyPrV(FqOrgPrV);
1453      FqOrgTypePrV.Sort(false); FqOrgPrV.Sort(false);
1454      fprintf(fOut, &quot;Organization-Types:\n&quot;);
1455      for (int OrgTypeN=0; OrgTypeN&lt;FqOrgTypePrV.Len(); OrgTypeN++){
1456        int OrgTypeFq=FqOrgTypePrV[OrgTypeN].Val1;
1457        TStr OrgTypeNm=FqOrgTypePrV[OrgTypeN].Val2;
1458        fprintf(fOut, &quot;   &#x27;%s&#x27;: %.0f%% (%d/%d)\n&quot;, OrgTypeNm.CStr(),
<span onclick='openModal()' class='match'>1459         100*OrgTypeFq/double(OrgFqSum), OrgTypeFq, OrgFqSum);
1460      }
1461      fprintf(fOut, &quot;Projects Participations Per Organization:\n&quot;);
1462      for (int CountryN=0; CountryN&lt;FqOrgPrV.Len(); CountryN++){
1463        int OrgFq=FqOrgPrV[CountryN].Val1;
1464        double OrgPrc=OrgFq/double(OrgFqSum);
1465        if (CountryN&gt;=10){break;}
</span>1466        TStr OrgNm=FqOrgPrV[CountryN].Val2;
1467        fprintf(fOut, &quot;   %2d. %5.2f%% (%d/%d) &#x27;%s&#x27;\n&quot;,
1468         1+CountryN, 100*OrgPrc, OrgFq, OrgFqSum, OrgNm.CStr());
1469      }
1470      TIntV DIdV; int DId;
1471      {for (int ProjN=0; ProjN&lt;Country-&gt;GetProjs(); ProjN++){
1472        TStr ProjNm=Country-&gt;GetProjNm(ProjN);
1473        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1474      }}
1475      PBowSpV ConceptSpV;
1476      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1477      TStrFltPrV WordStrWgtPrV;
1478      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, 50, 0.5, WordStrWgtPrV);
1479      fprintf(fOut, &quot;Keywords:&quot;);
1480      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1481        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1482        double WordWgt=WordStrWgtPrV[WordN].Val2;
1483        if ((WordN)%4==0){fprintf(fOut, &quot;\n  &quot;);}
1484        fprintf(fOut, &quot; [%s:%.2f]&quot;, WordStr.CStr(), WordWgt);
1485      }
1486      fprintf(fOut, &quot;\n&quot;);
1487      fprintf(fOut, &quot;Projects(%d):&quot;, Country-&gt;GetProjs());
1488      for (int ProjN=0; ProjN&lt;Country-&gt;GetProjs(); ProjN++){
1489        if ((ProjN)%5==0){fprintf(fOut, &quot;\n  &quot;);}
1490        fprintf(fOut, &quot; &#x27;%s&#x27;&quot;, Country-&gt;GetProjNm(ProjN).CStr());
1491      }
1492      fprintf(fOut, &quot;\n&quot;);
1493      fprintf(fOut, &quot;\n&quot;);
1494    }
1495    printf(&quot;Done.\n&quot;);
1496  }
1497  void TEpBs::SaveOrgDistTree(const TStr&amp; FNm, const TStr&amp; OrgNmWc) const {
1498    printf(&quot;Save Organization Distance Graph to %s ...\n&quot;, FNm.CStr());
1499    int Orgs=GetOrgs();
1500    int StartOrgId=-1;
1501    TIntKdV FqOrgIdKdV(Orgs, 0);
1502    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1503      PEpOrg Org=GetOrg(OrgId);
1504      TStr OrgNm=Org-&gt;GetOrgNm();
1505      if ((!OrgNmWc.Empty())&amp;&amp;(OrgNm.IsWcMatch(OrgNmWc))){
1506        StartOrgId=OrgId;}
1507      FqOrgIdKdV.Add(TIntKd(Org-&gt;GetProjs(), OrgId));
1508    }
1509    FqOrgIdKdV.Sort(false);
1510    int MnFullOrgNmProjs;
1511    if (FqOrgIdKdV.Len()&lt;15){MnFullOrgNmProjs=FqOrgIdKdV.Last().Key;}
1512    else {MnFullOrgNmProjs=FqOrgIdKdV[15].Key;}
1513    if (OrgNmWc.Empty()){
1514      StartOrgId=FqOrgIdKdV[0].Dat;
1515    } else
1516    if (StartOrgId==-1){
1517      printf(&quot;No match for wild-card &#x27;%s&#x27;.\n&quot;, OrgNmWc.CStr());
1518      return;
1519    }
1520    PEpOrg StartOrg=GetOrg(StartOrgId);
1521    TStr StartOrgNm=StartOrg-&gt;GetOrgNm();
1522    printf(&quot;Creating distance graph for organization &#x27;%s&#x27;.\n&quot;, StartOrgNm.CStr());
1523    PGraph Graph=TGraph::New();
1524    Graph-&gt;AddVrtx(TGVrtx::New(StartOrgId, TEpOrg::GetMultiLnOrgNm(
1525     StartOrgNm+&quot;(&quot;+TInt::GetStr(StartOrg-&gt;GetProjs())+&quot;)&quot;)));
1526    TIntV OrgDistV(GetOrgs()); OrgDistV.PutAll(-1);
1527    TIntPrQ OpenOrgIdQ; OpenOrgIdQ.Push(TIntPr(StartOrgId, 0));
1528    OrgDistV[StartOrgId]=0;
1529    while (!OpenOrgIdQ.Empty()){
1530      int OrgId=OpenOrgIdQ.Top().Val1;
1531      int OrgDist=OpenOrgIdQ.Top().Val2;
1532      OpenOrgIdQ.Pop();
1533      IAssert(OrgDistV[OrgId]==OrgDist);
1534      PEpOrg Org=GetOrg(OrgId);
1535      TStr OrgNm=Org-&gt;GetOrgNm();
1536      PVrtx SrcVrtx=Graph-&gt;GetVrtx(OrgId);
1537      int ClbOrgs=Org-&gt;GetClbOrgs();
1538      for (int ClbOrgN=0; ClbOrgN&lt;ClbOrgs; ClbOrgN++){
1539        TStr ClbOrgNm=Org-&gt;GetClbOrgNm(ClbOrgN, this);
1540        int ClbOrgId=GetOrgId(ClbOrgNm);
1541        PEpOrg ClbOrg=GetOrg(ClbOrgId);
1542        if (OrgDistV[ClbOrgId]==-1){
1543          OpenOrgIdQ.Push(TIntPr(ClbOrgId, OrgDist+1));
1544          OrgDistV[ClbOrgId]=OrgDist+1;
1545          TStr VNm=ClbOrg-&gt;GetBriefOrgNm();
1546          if (ClbOrg-&gt;GetProjs()&lt;=MnFullOrgNmProjs){VNm=TStr(&quot;_&quot;)+VNm;}
1547          VNm=VNm+&quot;(&quot;+TInt::GetStr(ClbOrg-&gt;GetProjs())+&quot;)&quot;;
1548          VNm=TEpOrg::GetMultiLnOrgNm(VNm);
1549          PVrtx DstVrtx=TGVrtx::New(ClbOrgId, VNm);
1550          Graph-&gt;AddVrtx(DstVrtx);
1551          TStr ENm=TInt::GetStr(OrgId)+&quot;-&quot;+TInt::GetStr(ClbOrgId);
1552          PEdge Edge=TGEdge::New(SrcVrtx, DstVrtx, TStr(&quot;_&quot;)+ENm);
1553          Graph-&gt;AddEdge(Edge);
1554        }
1555      }
1556    }
1557    Graph-&gt;SaveTxt(FNm);
1558    printf(&quot;Done.\n&quot;);
1559  }
1560  void TEpBs::SaveDomainSim(
1561   const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs,
1562   const double&amp; SimSumPrc, const int&amp; MxKws) const {
1563    printf(&quot;Save Domain Graph to %s ...\n&quot;, FNm.CStr());
1564    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1565    TStrStrH DomainNmToDescH;
1566    THash&lt;TStr, PBowSpV&gt; DomainNmToConceptSpV;
1567    for (int DomainId=0; DomainId&lt;GetDomains(); DomainId++){
1568      PEpDomain Domain=GetDomain(DomainId);
1569      TStr DomainNm=Domain-&gt;GetDomainNm();
1570      if (DomainNm==&quot;#EMPTY&quot;){continue;}
1571      TIntV DIdV; int DId;
1572      for (int ProjN=0; ProjN&lt;Domain-&gt;GetProjs(); ProjN++){
1573        TStr ProjNm=Domain-&gt;GetProjNm(ProjN);
1574        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1575      }
1576      PBowSpV ConceptSpV;
1577      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1578      TStrFltPrV WordStrWgtPrV;
1579      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, MxKws, 0.5, WordStrWgtPrV);
1580      DomainNmToConceptSpV.AddDat(DomainNm, ConceptSpV);
1581      TChA DomainDescChA;
1582      DomainDescChA+=TStr(&quot;*** &quot;)+DomainNm+&quot; ***&quot;;
1583      DomainDescChA+=TStr(&quot;\\&quot;)+TInt::GetStr(Domain-&gt;GetProjs())+ &quot; projects&quot;;
1584      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1585        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1586        double WordWgt=WordStrWgtPrV[WordN].Val2;
1587        DomainDescChA+=TStr(&quot;\\&quot;)+WordStr+&quot;:&quot;+TFlt::GetStr(WordWgt, &quot;%.2f&quot;);
1588      }
1589      DomainNmToDescH.AddDat(DomainNm, DomainDescChA);
1590    }
1591    PBowSim BowSim=TBowSim::New(bstCos); 
1592    TFltVV DomainSimVV;
1593    double SimSum=0; TFltIntIntTrV SimN1N2TrV;
1594    for (int DomainN1=0; DomainN1&lt;DomainNmToConceptSpV.Len(); DomainN1++){
1595      PBowSpV ConceptSpV1=DomainNmToConceptSpV[DomainN1];
1596      for (int DomainN2=DomainN1+1; DomainN2&lt;DomainNmToConceptSpV.Len(); DomainN2++){
1597        PBowSpV ConceptSpV2=DomainNmToConceptSpV[DomainN2];
1598        double Sim=BowSim-&gt;GetSim(ConceptSpV1, ConceptSpV2);
1599        SimSum+=Sim;
1600        SimN1N2TrV.Add(TFltIntIntTr(Sim, DomainN1, DomainN2));
1601      }
1602    }
1603    SimN1N2TrV.Sort(false);
1604    PGraph Graph=TGraph::New();
1605    for (int DomainN=0; DomainN&lt;DomainNmToConceptSpV.Len(); DomainN++){
1606      TStr DomainNm=DomainNmToConceptSpV.GetKey(DomainN);
1607      TStr DomainDescStr=DomainNmToDescH.GetDat(DomainNm);
1608      Graph-&gt;AddVrtx(TGVrtx::New(DomainN, DomainDescStr));
1609    }
1610    double SimSumSF=0;
1611    for (int SimTrN=0; SimTrN&lt;SimN1N2TrV.Len(); SimTrN++){
1612      double Sim=SimN1N2TrV[SimTrN].Val1;
1613      double DomainN1=SimN1N2TrV[SimTrN].Val2;
1614      double DomainN2=SimN1N2TrV[SimTrN].Val3;
1615      if (SimSumSF&gt;SimSumPrc*SimSum){continue;}
1616      PVrtx Vrtx1=Graph-&gt;GetVrtx(DomainN1);
1617      PVrtx Vrtx2=Graph-&gt;GetVrtx(DomainN2);
1618      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(Sim, &quot;%.2f&quot;), false);
1619      Edge-&gt;PutWgt(Sim);
1620      Graph-&gt;AddEdge(Edge);
1621      SimSumSF+=Sim;
1622    }
1623    Graph-&gt;SetEdgeWidth(5);
1624    Graph-&gt;SaveTxt(FNm);
1625    printf(&quot;Done.\n&quot;);
1626  }
1627  void TEpBs::SaveUnitSim(
1628   const TStr&amp; FNm, const PBowDocBs&amp; EpBowDocBs,
1629   const double&amp; SimSumPrc, const int&amp; MxKws) const {
1630    printf(&quot;Save Unit Graph to %s ...\n&quot;, FNm.CStr());
1631    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1632    TStrStrH UnitNmToDescH;
1633    THash&lt;TStr, PBowSpV&gt; UnitNmToConceptSpV;
1634    for (int UnitId=0; UnitId&lt;GetUnits(); UnitId++){
1635      PEpUnit Unit=GetUnit(UnitId);
1636      TStr UnitNm=Unit-&gt;GetUnitNm();
1637      if (UnitNm==&quot;#EMPTY&quot;){continue;}
1638      TIntV DIdV; int DId;
1639      for (int ProjN=0; ProjN&lt;Unit-&gt;GetProjs(); ProjN++){
1640        TStr ProjNm=Unit-&gt;GetProjNm(ProjN);
1641        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1642      }
1643      PBowSpV ConceptSpV;
1644      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1645      TStrFltPrV WordStrWgtPrV;
1646      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, MxKws, 0.5, WordStrWgtPrV);
1647      UnitNmToConceptSpV.AddDat(UnitNm, ConceptSpV);
1648      TChA UnitDescChA;
1649      if (UnitNm==TEpBs::GetUnitDNm(UnitNm)){
1650        UnitDescChA+=UnitNm+&quot;(&quot;+TInt::GetStr(Unit-&gt;GetProjs())+&quot;)&quot;;
1651      } else {
1652        UnitDescChA+=UnitNm+&quot;/&quot;+TEpBs::GetUnitDNm(UnitNm)+&quot;(&quot;+TInt::GetStr(Unit-&gt;GetProjs())+&quot;)&quot;;
1653      }
1654      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1655        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1656        double WordWgt=WordStrWgtPrV[WordN].Val2;
1657        UnitDescChA+=TStr(&quot;\\&quot;)+WordStr+&quot;:&quot;+TFlt::GetStr(WordWgt, &quot;%.2f&quot;);
1658      }
1659      UnitNmToDescH.AddDat(UnitNm, UnitDescChA);
1660    }
1661    PBowSim BowSim=TBowSim::New(bstCos); 
1662    TFltVV UnitSimVV;
1663    double SimSum=0; TFltIntIntTrV SimN1N2TrV;
1664    for (int UnitN1=0; UnitN1&lt;UnitNmToConceptSpV.Len(); UnitN1++){
1665      PBowSpV ConceptSpV1=UnitNmToConceptSpV[UnitN1];
1666      for (int UnitN2=UnitN1+1; UnitN2&lt;UnitNmToConceptSpV.Len(); UnitN2++){
1667        PBowSpV ConceptSpV2=UnitNmToConceptSpV[UnitN2];
1668        double Sim=BowSim-&gt;GetSim(ConceptSpV1, ConceptSpV2);
1669        SimSum+=Sim;
1670        SimN1N2TrV.Add(TFltIntIntTr(Sim, UnitN1, UnitN2));
1671      }
1672    }
1673    SimN1N2TrV.Sort(false);
1674    PGraph Graph=TGraph::New();
1675    for (int UnitN=0; UnitN&lt;UnitNmToConceptSpV.Len(); UnitN++){
1676      TStr UnitNm=UnitNmToConceptSpV.GetKey(UnitN);
1677      TStr UnitDescStr=UnitNmToDescH.GetDat(UnitNm);
1678      Graph-&gt;AddVrtx(TGVrtx::New(UnitN, UnitDescStr));
1679    }
1680    double SimSumSF=0;
1681    for (int SimTrN=0; SimTrN&lt;SimN1N2TrV.Len(); SimTrN++){
1682      double Sim=SimN1N2TrV[SimTrN].Val1;
1683      double UnitN1=SimN1N2TrV[SimTrN].Val2;
1684      double UnitN2=SimN1N2TrV[SimTrN].Val3;
1685      if (SimSumSF&gt;SimSumPrc*SimSum){continue;}
1686      PVrtx Vrtx1=Graph-&gt;GetVrtx(UnitN1);
1687      PVrtx Vrtx2=Graph-&gt;GetVrtx(UnitN2);
1688      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(Sim, &quot;%.2f&quot;), false);
1689      Edge-&gt;PutWgt(Sim);
1690      Graph-&gt;AddEdge(Edge);
1691      SimSumSF+=Sim;
1692    }
1693    Graph-&gt;SetEdgeWidth(5);
1694    Graph-&gt;SaveTxt(FNm);
1695    printf(&quot;Done.\n&quot;);
1696  }
1697  void TEpBs::SaveOfficerSim(
1698   const TStr&amp; GraphFNm, const PBowDocBs&amp; EpBowDocBs,
1699   const double&amp; SimSumPrc, const int&amp; MxKws) const {
1700    printf(&quot;Save Officer Graph to %s ...\n&quot;, GraphFNm.CStr());
1701    PBowDocWgtBs EpBowDocWgtBs=TBowDocWgtBs::New(EpBowDocBs, bwwtNrmTFIDF, 0, 3);
1702    TStrStrH OfficerNmToDescH;
1703    THash&lt;TStr, PBowSpV&gt; OfficerNmToConceptSpV;
1704    for (int OfficerId=0; OfficerId&lt;GetOfficers(); OfficerId++){
1705      PEpOfficer Officer=GetOfficer(OfficerId);
1706      TStr OfficerNm=Officer-&gt;GetOfficerNm();
1707      if (OfficerNm==&quot;#EMPTY&quot;){continue;}
1708      if (OfficerNm.GetTrunc().Empty()){continue;}
1709      TIntV DIdV; int DId;
1710      for (int ProjN=0; ProjN&lt;Officer-&gt;GetProjs(); ProjN++){
1711        TStr ProjNm=Officer-&gt;GetProjNm(ProjN);
1712        if (EpBowDocBs-&gt;IsDocNm(ProjNm, DId)){DIdV.Add(DId);}
1713      }
1714      PBowSpV ConceptSpV;
1715      TBowClust::GetConceptSpV(EpBowDocWgtBs, NULL, DIdV, ConceptSpV);
1716      TStrFltPrV WordStrWgtPrV;
1717      ConceptSpV-&gt;GetWordStrWgtPrV(EpBowDocBs, MxKws, 0.5, WordStrWgtPrV);
1718      OfficerNmToConceptSpV.AddDat(OfficerNm, ConceptSpV);
1719      TChA OfficerDescChA;
1720      OfficerDescChA+=OfficerNm+&quot;(&quot;+TInt::GetStr(Officer-&gt;GetProjs())+&quot;)&quot;;
1721      for (int WordN=0; WordN&lt;WordStrWgtPrV.Len(); WordN++){
1722        TStr WordStr=WordStrWgtPrV[WordN].Val1;
1723        double WordWgt=WordStrWgtPrV[WordN].Val2;
1724        OfficerDescChA+=TStr(&quot;\\&quot;)+WordStr+&quot;:&quot;+TFlt::GetStr(WordWgt, &quot;%.2f&quot;);
1725      }
1726      OfficerNmToDescH.AddDat(OfficerNm, OfficerDescChA);
1727    }
1728    PBowSim BowSim=TBowSim::New(bstCos); 
1729    TFltVV OfficerSimVV;
1730    double SimSum=0; TFltIntIntTrV SimN1N2TrV;
1731    for (int OfficerN1=0; OfficerN1&lt;OfficerNmToConceptSpV.Len(); OfficerN1++){
1732      PBowSpV ConceptSpV1=OfficerNmToConceptSpV[OfficerN1];
1733      for (int OfficerN2=OfficerN1+1; OfficerN2&lt;OfficerNmToConceptSpV.Len(); OfficerN2++){
1734        PBowSpV ConceptSpV2=OfficerNmToConceptSpV[OfficerN2];
1735        double Sim=BowSim-&gt;GetSim(ConceptSpV1, ConceptSpV2);
1736        SimSum+=Sim;
1737        SimN1N2TrV.Add(TFltIntIntTr(Sim, OfficerN1, OfficerN2));
1738      }
1739    }
1740    SimN1N2TrV.Sort(false);
1741    PGraph Graph=TGraph::New();
1742    for (int OfficerN=0; OfficerN&lt;OfficerNmToConceptSpV.Len(); OfficerN++){
1743      TStr OfficerNm=OfficerNmToConceptSpV.GetKey(OfficerN);
1744      TStr OfficerDescStr=OfficerNmToDescH.GetDat(OfficerNm);
1745      Graph-&gt;AddVrtx(TGVrtx::New(OfficerN, OfficerDescStr));
1746    }
1747    double SimSumSF=0;
1748    for (int SimTrN=0; SimTrN&lt;SimN1N2TrV.Len(); SimTrN++){
1749      double Sim=SimN1N2TrV[SimTrN].Val1;
1750      double OfficerN1=SimN1N2TrV[SimTrN].Val2;
1751      double OfficerN2=SimN1N2TrV[SimTrN].Val3;
1752      if (SimSumSF&gt;SimSumPrc*SimSum){continue;}
1753      PVrtx Vrtx1=Graph-&gt;GetVrtx(OfficerN1);
1754      PVrtx Vrtx2=Graph-&gt;GetVrtx(OfficerN2);
1755      PEdge Edge=TGEdge::New(Vrtx1, Vrtx2, TFlt::GetStr(Sim, &quot;%.2f&quot;), false);
1756      Edge-&gt;PutWgt(Sim);
1757      Graph-&gt;AddEdge(Edge);
1758      SimSumSF+=Sim;
1759    }
1760    Graph-&gt;SetEdgeWidth(5);
1761    Graph-&gt;SaveTxt(GraphFNm);
1762    printf(&quot;Done.\n&quot;);
1763  }
1764  void TEpBs::SaveOrgPowerDist(const TStr&amp; FNm) const {
1765    int Orgs=GetOrgs();
1766    TIntPrV ClbOrgsOrgIdPrV; TIntIntH ClbOrgsToFqH;
1767    for (int OrgId=0; OrgId&lt;Orgs; OrgId++){
1768      PEpOrg Org=GetOrg(OrgId);
1769      ClbOrgsOrgIdPrV.Add(TIntPr(Org-&gt;GetClbOrgs(), OrgId));
1770      ClbOrgsToFqH.AddDat(Org-&gt;GetClbOrgs())++;
1771    }
1772    ClbOrgsOrgIdPrV.Sort(false);
1773    TIntPrV FqClbOrgsPrV; ClbOrgsToFqH.GetDatKeyPrV(FqClbOrgsPrV);
1774    FqClbOrgsPrV.Sort(false);
1775    TFOut FOut(FNm);
1776    ClbOrgsOrgIdPrV.Save(FOut);
1777    FqClbOrgsPrV.Save(FOut);
1778  }
1779  void TEpBs::SaveCountryProjects(const TStr&amp; FNm,
1780   const PCordisEuProjBs&amp; EuProjBs, const TStr&amp; CountryNm) const {
1781    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
1782    PEpCountry Country=GetCountry(CountryNm);
1783    for (int ProjN=0; ProjN&lt;Country-&gt;GetProjs(); ProjN++){
1784      TStr ProjNm=Country-&gt;GetProjNm(ProjN);
1785      PCordisEuProj EuProj; if (EuProjBs-&gt;IsEuProj(ProjNm, EuProj)){}
1786      PEpProj Proj=GetProj(ProjNm);
1787      fprintf(fOut, &quot;*** %s/%s-%s\n&quot;, Proj-&gt;GetProjNm().CStr(),
1788       Proj-&gt;GetDomainNm().CStr(), Proj-&gt;GetUnitNm().CStr());
1789      if (!EuProj.Empty()){
1790        fprintf(fOut, &quot;Title: %s\n&quot;, EuProj-&gt;GetTitleStr().CStr());}
1791      fprintf(fOut, &quot;Officer: %s\n&quot;, Proj-&gt;GetOfficerNm().CStr());
1792      fprintf(fOut, &quot;Organizations (%d):\n&quot;, Proj-&gt;GetOrgs());
1793      for (int OrgN=0; OrgN&lt;Proj-&gt;GetOrgs(); OrgN++){
1794        fprintf(fOut, &quot;   %s/%s\n&quot;, Proj-&gt;GetOrgNm(OrgN, this).CStr(),
1795         GetOrg(Proj-&gt;GetOrgNm(OrgN, this))-&gt;GetCountryNm().CStr());
1796      }
1797      fprintf(fOut, &quot;\n&quot;);
1798    }
1799  }
1800  void TEpBs::GetClbWgtProjNmPrV(
1801   TFltStrPrV&amp; ClbWgtProjNmPrV, const int&amp; DumpTopProjs) const {
1802    ClbWgtProjNmPrV.Clr();
1803    for (int ProjN=0; ProjN&lt;GetProjs(); ProjN++){
1804      PEpProj Proj=GetProj(ProjN);
1805      double ClbWgt=0;
1806      for (int OrgN=0; OrgN&lt;Proj-&gt;GetOrgs(); OrgN++){
1807        TStr OrgNm=Proj-&gt;GetOrgNm(OrgN, this);
1808        ClbWgt+=log(1+GetOrg(OrgNm)-&gt;GetClbOrgs());
1809      }
1810      ClbWgtProjNmPrV.Add(TFltStrPr(ClbWgt, Proj-&gt;GetProjNm()));
1811    }
1812    ClbWgtProjNmPrV.Sort(false);
1813    int DumpProjs=(DumpTopProjs==-1) ? GetProjs() : DumpTopProjs;
1814    {for (int ProjN=0; ProjN&lt;DumpProjs; ProjN++){
1815      double ClbWgt=ClbWgtProjNmPrV[ProjN].Val1;
1816      TStr ProjNm=ClbWgtProjNmPrV[ProjN].Val2;
1817      PEpProj Proj=GetProj(ProjNm);
1818      printf(&quot;%d. [%.1f] %s:\n&quot;, 1+ProjN, ClbWgt, ProjNm.CStr());
1819    }}
1820  }
1821  void TEpBs::GetBestClbWgtProjNmV(const int&amp; BestProjs, TStrV&amp; BestProjNmV){
1822    TFltStrPrV ClbWgtProjNmPrV; GetClbWgtProjNmPrV(ClbWgtProjNmPrV);
1823    int Projs=GetProjs(); BestProjNmV.Clr();
1824    for (int ProjN=0; ProjN&lt;BestProjs; ProjN++){
1825      if (ProjN&gt;=Projs){break;}
1826      BestProjNmV.Add(ClbWgtProjNmPrV[ProjN].Val2);
1827    }
1828  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-euproj.cpp</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-euproj.cpp</div>
                </div>
                <div class="column column_space"><pre><code>1310         100*OrgTypeFq/double(OrgFqSum), OrgTypeFq, OrgFqSum);
1311      }
1312      fprintf(fOut, &quot;Countries:&quot;);
1313      for (int CountryN=0; CountryN&lt;FqCountryPrV.Len(); CountryN++){
1314        int CountryFq=FqCountryPrV[CountryN].Val1;
1315        double CountryPrc=CountryFq/double(OrgFqSum);
1316        if (CountryPrc&lt;0.05){break;}
</pre></code></div>
                <div class="column column_space"><pre><code>1459         100*OrgTypeFq/double(OrgFqSum), OrgTypeFq, OrgFqSum);
1460      }
1461      fprintf(fOut, &quot;Projects Participations Per Organization:\n&quot;);
1462      for (int CountryN=0; CountryN&lt;FqOrgPrV.Len(); CountryN++){
1463        int OrgFq=FqOrgPrV[CountryN].Val1;
1464        double OrgPrc=OrgFq/double(OrgFqSum);
1465        if (CountryN&gt;=10){break;}
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    