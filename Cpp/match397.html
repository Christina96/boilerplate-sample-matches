<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for rosout_appender.cpp & poll_manager.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for rosout_appender.cpp & poll_manager.cpp
      </h3>
      <h1 align="center">
        10.6%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>rosout_appender.cpp (7.7419353%)<TH>poll_manager.cpp (16.90141%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match397-0.html#0',2,'match397-1.html#0',3)" NAME="0">(119-133)<TD><A HREF="javascript:ZweiFrames('match397-0.html#0',2,'match397-1.html#0',3)" NAME="0">(66-79)</A><TD ALIGN=center><FONT COLOR="#ff0000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>rosout_appender.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Software License Agreement (BSD License)
 *
 *  Copyright (c) 2008, Willow Garage, Inc.
 *  All rights reserved.
 *
 *  Redistribution and use in source and binary forms, with or without
 *  modification, are permitted provided that the following conditions
 *  are met:
 *
 *   * Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *   * Redistributions in binary form must reproduce the above
 *     copyright notice, this list of conditions and the following
 *     disclaimer in the documentation and/or other materials provided
 *     with the distribution.
 *   * Neither the name of Willow Garage, Inc. nor the names of its
 *     contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 *  &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 *  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 *  FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 *  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 *  CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 *  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
 *  ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 *  POSSIBILITY OF SUCH DAMAGE.
 */

#include &quot;ros/rosout_appender.h&quot;
#include &quot;ros/this_node.h&quot;
#include &quot;ros/node_handle.h&quot;
#include &quot;ros/topic_manager.h&quot;
#include &quot;ros/advertise_options.h&quot;
#include &quot;ros/names.h&quot;
#include &quot;ros/param.h&quot;

#include &lt;rosgraph_msgs/Log.h&gt;

namespace ros
{

ROSOutAppender::ROSOutAppender()
: shutting_down_(false)
, disable_topics_(false)
, publish_thread_(boost::bind(&amp;ROSOutAppender::logThread, this))
{
  AdvertiseOptions ops;
  ops.init&lt;rosgraph_msgs::Log&gt;(names::resolve(&quot;/rosout&quot;), 0);
  ops.latch = true;
  SubscriberCallbacksPtr cbs(boost::make_shared&lt;SubscriberCallbacks&gt;());
  TopicManager::instance()-&gt;advertise(ops, cbs);
}

ROSOutAppender::~ROSOutAppender()
{
  shutting_down_ = true;

  {
    boost::mutex::scoped_lock lock(queue_mutex_);
    queue_condition_.notify_all();
  }

  publish_thread_.join();
}

const std::string&amp;  ROSOutAppender::getLastError() const
{
  return last_error_;
}

void ROSOutAppender::log(::ros::console::Level level, const char* str, const char* file, const char* function, int line)
{
  rosgraph_msgs::LogPtr msg(boost::make_shared&lt;rosgraph_msgs::Log&gt;());

  msg-&gt;header.stamp = ros::Time::now();
  if (level == ros::console::levels::Debug)
  {
    msg-&gt;level = rosgraph_msgs::Log::DEBUG;
  }
  else if (level == ros::console::levels::Info)
  {
    msg-&gt;level = rosgraph_msgs::Log::INFO;
  }
  else if (level == ros::console::levels::Warn)
  {
    msg-&gt;level = rosgraph_msgs::Log::WARN;
  }
  else if (level == ros::console::levels::Error)
  {
    msg-&gt;level = rosgraph_msgs::Log::ERROR;
  }
  else if (level == ros::console::levels::Fatal)
  {
    msg-&gt;level = rosgraph_msgs::Log::FATAL;
  }
  msg-&gt;name = this_node::getName();
  msg-&gt;msg = str;
  msg-&gt;file = file;
  msg-&gt;function = function;
  msg-&gt;line = line;
  
  // check parameter server/cache for omit_topics flag
  // the same parameter is checked in rosout.py for the same purpose
  ros::param::getCached(&quot;/rosout_disable_topics_generation&quot;, disable_topics_);

  if (!disable_topics_){
    this_node::getAdvertisedTopics(msg-&gt;topics);
  }

<A NAME="0"></A>  if (level == ::ros::console::levels::Fatal || level == ::ros::console::levels::Error)
  {
    last_error_ = str;
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match397-1.html#0',3,'match397-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>  }

  boost::mutex::scoped_lock lock(queue_mutex_);
  log_queue_.push_back(msg);
  queue_condition_.notify_all();
}

void ROSOutAppender::logThread()
{
  while (!shutting_down_)
  {
    V_Log local_queue;

    {
      boost::mutex::scoped_lock lock(queue_mutex_);</B></FONT>

      if (shutting_down_)
      {
        return;
      }

      if (log_queue_.empty())
      {
        queue_condition_.wait(lock);
      }

      if (shutting_down_)
      {
        return;
      }

      local_queue.swap(log_queue_);
    }

    V_Log::iterator it = local_queue.begin();
    V_Log::iterator end = local_queue.end();
    for (; it != end; ++it)
    {
      TopicManager::instance()-&gt;publish(names::resolve(&quot;/rosout&quot;), *(*it));
    }
  }
}

} // namespace ros
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>poll_manager.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2009, Willow Garage, Inc.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *   * Redistributions of source code must retain the above copyright notice,
 *     this list of conditions and the following disclaimer.
 *   * Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 *   * Neither the names of Willow Garage, Inc. nor the names of its
 *     contributors may be used to endorse or promote products derived from
 *     this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */

#include &quot;ros/poll_manager.h&quot;
#include &quot;ros/common.h&quot;

#include &lt;signal.h&gt;

namespace ros
{

const PollManagerPtr&amp; PollManager::instance()
{
  static PollManagerPtr poll_manager = boost::make_shared&lt;PollManager&gt;();
  return poll_manager;
}

PollManager::PollManager()
  : shutting_down_(false)
{
}

PollManager::~PollManager()
{
  shutdown();
}

void PollManager::start()
{
  shutting_down_ = false;
  thread_ = boost::thread(&amp;PollManager::threadFunc, this);
}

void PollManager::shutdown()
{
  if (shutting_down_) return;

  shutting_down_ = true;
<A NAME="0"></A>  if (thread_.get_id() != boost::this_thread::get_id())
  {
    thread_.join();
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match397-0.html#0',2,'match397-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>  }

  boost::recursive_mutex::scoped_lock lock(signal_mutex_);
  poll_signal_.disconnect_all_slots();
}

void PollManager::threadFunc()
{
  disableAllSignalsInThisThread();

  while (!shutting_down_)
  {
    {
      boost::recursive_mutex::scoped_lock lock(signal_mutex_);</B></FONT>
      poll_signal_();
    }

    if (shutting_down_)
    {
      return;
    }

    poll_set_.update(100);
  }
}

boost::signals2::connection PollManager::addPollThreadListener(const VoidFunc&amp; func)
{
  boost::recursive_mutex::scoped_lock lock(signal_mutex_);
  return poll_signal_.connect(func);
}

void PollManager::removePollThreadListener(boost::signals2::connection c)
{
  boost::recursive_mutex::scoped_lock lock(signal_mutex_);
  c.disconnect();
}

}
</PRE>
</div>
  </div>
</body>
</html>
