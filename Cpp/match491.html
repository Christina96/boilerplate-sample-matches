<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for subscription_callback_types.cpp &amp; test_client.cpp</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for subscription_callback_types.cpp &amp; test_client.cpp
      </h3>
<h1 align="center">
        8.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>subscription_callback_types.cpp (11.184211%)<th>test_client.cpp (6.463878%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(148-170)<td><a href="#" name="0">(44-62)</a><td align="center"><font color="#ff0000">17</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>subscription_callback_types.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 #include &lt;gtest/gtest.h&gt;
2 #include "ros/ros.h"
3 #include "std_msgs/String.h"
4 #include &lt;vector&gt;
5 void chatterCallback(const std_msgs::String::ConstPtr&amp; msg)
6 {
7   ROS_INFO("I heard: [%s]", msg-&gt;data.c_str());
8 }
9 void chatterCallback2(const std_msgs::String&amp; msg)
10 {
11   ROS_INFO("I heard(2): [%s]", msg.data.c_str());
12 }
13 void chatterCallback3(std_msgs::String::ConstPtr msg)
14 {
15   ROS_INFO("I heard(3): [%s]", msg-&gt;data.c_str());
16 }
17 void chatterCallback4(const ros::MessageEvent&lt;std_msgs::String const&gt;&amp; event)
18 {
19   ROS_INFO("I heard(4): [%s, %s]", event.getMessage()-&gt;data.c_str(), event.getConnectionHeader()["callerid"].c_str());
20 }
21 void chatterCallback5(std_msgs::String msg)
22 {
23   ROS_INFO("I heard(5): [%s]", msg.data.c_str());
24 }
25 void chatterCallback6(const std_msgs::String::Ptr&amp; msg)
26 {
27   ROS_INFO("I heard(6): [%s]", msg-&gt;data.c_str());
28 }
29 void chatterCallback7(std_msgs::String::Ptr msg)
30 {
31   ROS_INFO("I heard(7): [%s]", msg-&gt;data.c_str());
32 }
33 void chatterCallback8(const ros::MessageEvent&lt;std_msgs::String&gt;&amp; event)
34 {
35   ROS_INFO("I heard(8): [%s, %s]", event.getMessage()-&gt;data.c_str(), event.getConnectionHeader()["callerid"].c_str());
36 }
37 struct A
38 {
39   void chatterCallback(const std_msgs::String::ConstPtr&amp; msg)
40   {
41     ROS_INFO("A I heard: [%s]", msg-&gt;data.c_str());
42   }
43   void chatterCallback2(const std_msgs::String&amp; msg)
44   {
45     ROS_INFO("A I heard(2): [%s]", msg.data.c_str());
46   }
47   void chatterCallback3(std_msgs::String::ConstPtr msg)
48   {
49     ROS_INFO("A I heard(3): [%s]", msg-&gt;data.c_str());
50   }
51   void chatterCallback4(const ros::MessageEvent&lt;std_msgs::String const&gt;&amp; event)
52   {
53     ROS_INFO("A I heard(4): [%s]", event.getMessage()-&gt;data.c_str());
54   }
55   void chatterCallback5(std_msgs::String msg)
56   {
57     ROS_INFO("A I heard(5): [%s]", msg.data.c_str());
58   }
59   void chatterCallback6(const std_msgs::String::ConstPtr&amp; msg, const std::string&amp; bound)
60   {
61     ROS_INFO("A I heard(6): [%s, %s]", msg-&gt;data.c_str(), bound.c_str());
62   }
63   void chatterCallback7(const std_msgs::String&amp; msg, const std::string&amp; bound)
64   {
65     ROS_INFO("A I heard(7): [%s, %s]", msg.data.c_str(), bound.c_str());
66   }
67   void chatterCallback8(const std_msgs::String::Ptr&amp; msg)
68   {
69     ROS_INFO("A I heard(6): [%s]", msg-&gt;data.c_str());
70   }
71   void chatterCallback9(std_msgs::String::Ptr msg)
72   {
73     ROS_INFO("A I heard(7): [%s]", msg-&gt;data.c_str());
74   }
75   void chatterCallback10(const ros::MessageEvent&lt;std_msgs::String&gt;&amp; event)
76   {
77     ROS_INFO("A I heard(8): [%s, %s]", event.getMessage()-&gt;data.c_str(), event.getConnectionHeader()["callerid"].c_str());
78   }
79   void constCallback(std_msgs::String::Ptr msg) const
80   {
81     ROS_INFO("A I heard(7): [%s] and I'm const", msg-&gt;data.c_str());
82   }
83 };
84 <a name="0"></a>
85 TEST(SubscriptionCallbackTypes, compile)
86 {
87 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>  ros::NodeHandle n;
88   std::vector&lt;ros::Subscriber&gt; subs;
89   subs.push_back(n.subscribe("chatter", 1000, chatterCallback));
90   subs.push_back(n.subscribe&lt;std_msgs::String&gt;("chatter", 1000, chatterCallback));
91   subs.push_back(n.subscribe("chatter", 1000, chatterCallback2));
92   subs.push_back(n.subscribe("chatter", 1000, chatterCallback3));
93   subs.push_back(n.subscribe("chatter", 1000, chatterCallback4));
94   subs.push_back(n.subscribe("chatter", 1000, chatterCallback5));
95   subs.push_back(n.subscribe("chatter", 1000, chatterCallback6));
96   subs.push_back(n.subscribe("chatter", 1000, chatterCallback7));
97   subs.push_back(n.subscribe("chatter", 1000, chatterCallback8));
98   A a;
99   subs.push_back(n.subscribe("chatter", 1000, &amp;A::chatterCallback, &amp;a));
100   subs.push_back(n.subscribe&lt;std_msgs::String&gt;("chatter", 1000, &amp;A::chatterCallback, &amp;a));
101   subs.push_back(n.subscribe("chatter", 1000, &amp;A::chatterCallback2, &amp;a));
102   subs.push_back(n.subscribe("chatter", 1000, &amp;A::chatterCallback3, &amp;a));
103   subs.push_back(n.subscribe("chatter", 1000, &amp;A::chatterCallback4, &amp;a));
104   subs.push_back(n.subscribe("chatter", 1000, &amp;A::chatterCallback5, &amp;a));
105   subs.push_back(n.subscribe&lt;std_msgs::String&gt;("chatter", 1000, boost::bind(&amp;A::chatterCallback6, &amp;a, boost::placeholders::_1, std::string("hello"))));</b></font>
106   subs.push_back(n.subscribe&lt;std_msgs::String, const std_msgs::String&amp;&gt;("chatter", 1000, boost::bind(&amp;A::chatterCallback7, &amp;a, boost::placeholders::_1, std::string("hello2"))));
107   subs.push_back(n.subscribe("chatter", 1000, &amp;A::chatterCallback8, &amp;a));
108   subs.push_back(n.subscribe("chatter", 1000, &amp;A::chatterCallback9, &amp;a));
109   subs.push_back(n.subscribe("chatter", 1000, &amp;A::chatterCallback10, &amp;a));
110   subs.push_back(n.subscribe("chatter", 1000, &amp;A::constCallback, &amp;a));
111 }
112 int main(int argc, char **argv)
113 {
114   testing::InitGoogleTest(&amp;argc, argv);
115   ros::init( argc, argv, "subscription_callback_types" );
116   ros::NodeHandle nh;
117   return RUN_ALL_TESTS();
118 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_client.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 #include "xmlrpcpp/XmlRpcClient.h"
2 #include "xmlrpcpp/XmlRpcValue.h"
3 #include "mock_socket.h"
4 #include &lt;errno.h&gt;
5 #include &lt;climits&gt;
6 #include &lt;gtest/gtest.h&gt;
7 using XmlRpc::XmlRpcClient;
8 using XmlRpc::XmlRpcValue;
9 class XmlRpcClientForTest : public XmlRpcClient
10 {
11 public:
12   XmlRpcClientForTest(const char* host, int port, const char* uri=0) : XmlRpcClient(host, port, uri)
13 <a name="0"></a>  {
14   }
15 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>  using XmlRpcClient::doConnect;
16   using XmlRpcClient::setupConnection;
17   using XmlRpcClient::generateRequest;
18   using XmlRpcClient::generateHeader;
19   using XmlRpcClient::writeRequest;
20   using XmlRpcClient::readHeader;
21   using XmlRpcClient::readResponse;
22   using XmlRpcClient::parseResponse;
23   using XmlRpcClient::ClientConnectionState;
24   using XmlRpcClient::NO_CONNECTION;
25   using XmlRpcClient::CONNECTING;
26   using XmlRpcClient::WRITE_REQUEST;
27   using XmlRpcClient::READ_HEADER;
28   using XmlRpcClient::READ_RESPONSE;
29   using XmlRpcClient::IDLE;
30   using XmlRpcClient::_connectionState;
31   using XmlRpcClient::connectionStateStr;</b></font>
32 };
33 namespace XmlRpc {
34 void PrintTo(const XmlRpcClientForTest::ClientConnectionState&amp; state,
35              ::std::ostream* os) {
36   *os &lt;&lt; XmlRpcClientForTest::connectionStateStr(state);
37 }
38 }; 
39 bool sourceInList(XmlRpc::XmlRpcSource* source,
40                   const XmlRpc::XmlRpcDispatch::SourceList&amp; list) {
41   XmlRpc::XmlRpcDispatch::SourceList::const_iterator itr;
42   for (itr = list.begin(); itr != list.end(); itr++) {
43     if (itr-&gt;getSource() == source) {
44       return true;
45     }
46   }
47   return false;
48 }
49 TEST(XmlRpcClient, connectionStateStr) {
50 #define TEST_STATE(state)                                                      \
51   EXPECT_STREQ(#state, XmlRpcClientForTest::connectionStateStr(XmlRpcClientForTest::state))
52   TEST_STATE(NO_CONNECTION);
53   TEST_STATE(CONNECTING);
54   TEST_STATE(WRITE_REQUEST);
55   TEST_STATE(READ_HEADER);
56   TEST_STATE(READ_RESPONSE);
57   TEST_STATE(IDLE);
58 }
59 TEST_F(MockSocketTest, constructor) {
60   XmlRpcClientForTest a("localhost", 42);
61   EXPECT_EQ("localhost", a.getHost());
62   EXPECT_EQ(42, a.getPort());
63   EXPECT_EQ("/RPC2", a.getUri());
64   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
65   EXPECT_EQ(false, a._executing);
66   EXPECT_EQ(false, a._eof);
67   EXPECT_EQ(true, a.getKeepOpen());
68   EXPECT_EQ(-1, a.getfd());
69   EXPECT_EQ(0, a._sendAttempts);
70   EXPECT_EQ(0, a._bytesWritten);
71   EXPECT_EQ(0, a._contentLength);
72   EXPECT_FALSE(a._isFault);
73   EXPECT_FALSE(sourceInList(&amp;a, a._disp._sources));
74   XmlRpcClientForTest b("nowhere.com", 404, "/where");
75   EXPECT_EQ("nowhere.com", b.getHost());
76   EXPECT_EQ(404, b.getPort());
77   EXPECT_EQ("/where", b.getUri());
78 }
79 TEST_F(MockSocketTest, close_invalid_fd) {
80   XmlRpcClientForTest a("localhost", 42);
81   ASSERT_EQ(-1, a.getfd());
82   a.close();
83   EXPECT_EQ(-1, a.getfd());
84 }
85 TEST_F(MockSocketTest, close_valid_fd) {
86   XmlRpcClientForTest a("localhost", 42);
87   a.setfd(5);
88   Expect_close(5);
89   a.close();
90   EXPECT_EQ(-1, a.getfd());
91   CheckCalls();
92   a.close();
93   EXPECT_EQ(-1, a.getfd());
94 }
95 TEST_F(MockSocketTest, close_destructor) {
96   {
97     XmlRpcClientForTest a("localhost", 42);
98     a.setfd(5);
99     Expect_close(5);
100   }
101 }
102 TEST_F(MockSocketTest, setupConnection) {
103   XmlRpcClientForTest a("localhost", 42);
104   Expect_socket(7);
105   Expect_setNonBlocking(7, true);
106   Expect_connect(7, "localhost", 42, true);
107   EXPECT_TRUE(a.setupConnection());
108   EXPECT_EQ(7, a.getfd());
109   EXPECT_TRUE(sourceInList(&amp;a, a._disp._sources));
110   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
111   EXPECT_EQ(0, a._bytesWritten);
112   CheckCalls();
113   Expect_close(7);
114 }
115 TEST_F(MockSocketTest, setupConnection_eof) {
116   XmlRpcClientForTest a("localhost", 42);
117   a.setfd(5);
118   a._eof = true;
119   Expect_close(5);
120   Expect_socket(7);
121   Expect_setNonBlocking(7, true);
122   Expect_connect(7, "localhost", 42, true);
123   EXPECT_TRUE(a.setupConnection());
124   EXPECT_EQ(7, a.getfd());
125   EXPECT_TRUE(sourceInList(&amp;a, a._disp._sources));
126   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
127   EXPECT_EQ(0, a._bytesWritten);
128   CheckCalls();
129   Expect_close(7);
130 }
131 TEST_F(MockSocketTest, setupConnection_close) {
132   XmlRpcClientForTest a("localhost", 42);
133   a.setfd(5);
134   a._connectionState = XmlRpcClientForTest::WRITE_REQUEST;
135   Expect_close(5);
136   Expect_socket(7);
137   Expect_setNonBlocking(7, true);
138   Expect_connect(7, "localhost", 42, true);
139   EXPECT_TRUE(a.setupConnection());
140   EXPECT_EQ(7, a.getfd());
141   EXPECT_TRUE(sourceInList(&amp;a, a._disp._sources));
142   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
143   EXPECT_EQ(0, a._bytesWritten);
144   CheckCalls();
145   Expect_close(7);
146 }
147 TEST_F(MockSocketTest, setupConnection_err) {
148   XmlRpcClientForTest a("localhost", 42);
149   Expect_socket(7);
150   Expect_setNonBlocking(7, true);
151   Expect_connect(7, "localhost", 42, false);
152   Expect_getError(ECONNREFUSED);
153   Expect_close(7);
154   EXPECT_FALSE(a.setupConnection());
155   EXPECT_EQ(-1, a.getfd());
156   EXPECT_FALSE(sourceInList(&amp;a, a._disp._sources));
157   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
158 }
159 TEST_F(MockSocketTest, setupConnection_eor_reopen) {
160   XmlRpcClientForTest a("localhost", 42);
161   Expect_socket(7);
162   Expect_setNonBlocking(7, true);
163   Expect_connect(7, "localhost", 42, true);
164   EXPECT_TRUE(a.setupConnection());
165   EXPECT_EQ(7, a.getfd());
166   EXPECT_TRUE(sourceInList(&amp;a, a._disp._sources));
167   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
168   EXPECT_EQ(0, a._bytesWritten);
169   CheckCalls();
170   a._eof = true;
171   Expect_close(7);
172   Expect_socket(8);
173   Expect_setNonBlocking(8, true);
174   Expect_connect(8, "localhost", 42, false);
175   Expect_getError(ECONNREFUSED);
176   Expect_close(8);
177   EXPECT_FALSE(a.setupConnection());
178   EXPECT_EQ(-1, a.getfd());
179   EXPECT_FALSE(sourceInList(&amp;a, a._disp._sources));
180   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
181   CheckCalls();
182 }
183 TEST_F(MockSocketTest, doConnect) {
184   XmlRpcClientForTest a("localhost", 42);
185   Expect_socket(7);
186   Expect_setNonBlocking(7, true);
187   Expect_connect(7, "localhost", 42, true);
188   EXPECT_TRUE(a.doConnect());
189   EXPECT_EQ(7, a.getfd());
190   CheckCalls();
191   Expect_close(7);
192 }
193 TEST_F(MockSocketTest, doConnect_socketerr) {
194   XmlRpcClientForTest a("localhost", 42);
195   Expect_socket(-1);
196   Expect_getError(ENFILE);
197   EXPECT_FALSE(a.doConnect());
198   EXPECT_EQ(-1, a.getfd());
199 }
200 TEST_F(MockSocketTest, doConnect_nonBlockErr) {
201   XmlRpcClientForTest a("localhost", 42);
202   Expect_socket(7);
203   Expect_setNonBlocking(7, false);
204   Expect_getError(EBADF);
205   Expect_close(7);
206   EXPECT_FALSE(a.doConnect());
207   EXPECT_EQ(-1, a.getfd());
208 }
209 TEST_F(MockSocketTest, doConnect_connectErr) {
210   XmlRpcClientForTest a("localhost", 42);
211   Expect_socket(7);
212   Expect_setNonBlocking(7, true);
213   Expect_connect(7, "localhost", 42, false);
214   Expect_getError(ECONNREFUSED);
215   Expect_close(7);
216   EXPECT_FALSE(a.doConnect());
217   EXPECT_EQ(-1, a.getfd());
218 }
219 TEST(XmlRpcClient, generateRequest) {
220   XmlRpcClientForTest a("localhost", 42);
221   std::string header = "POST /RPC2 HTTP/1.1\r\n"
222                        "User-Agent: XMLRPC++ 0.7\r\n"
223                        "Host: localhost:42\r\n"
224                        "Content-Type: text/xml\r\n";
225   XmlRpcValue s("Hello");
226   EXPECT_TRUE(a.generateRequest("DoFoo", s));
227   EXPECT_EQ(header + "Content-length: 134\r\n\r\n"
228                      "&lt;?xml version=\"1.0\"?&gt;\r\n"
229                      "&lt;methodCall&gt;&lt;methodName&gt;DoFoo&lt;/methodName&gt;\r\n"
230                      "&lt;params&gt;&lt;param&gt;&lt;value&gt;Hello&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/"
231                      "methodCall&gt;\r\n",
232             a._request);
233   XmlRpcValue b(true);
234   EXPECT_TRUE(a.generateRequest("DoFoo", b));
235   EXPECT_EQ(header + "Content-length: 149\r\n\r\n"
236                      "&lt;?xml version=\"1.0\"?&gt;\r\n"
237                      "&lt;methodCall&gt;&lt;methodName&gt;DoFoo&lt;/methodName&gt;\r\n"
238                      "&lt;params&gt;&lt;param&gt;&lt;value&gt;&lt;boolean&gt;1&lt;/boolean&gt;&lt;/value&gt;&lt;/"
239                      "param&gt;&lt;/params&gt;&lt;/methodCall&gt;\r\n",
240             a._request);
241   XmlRpcValue i(42);
242   EXPECT_TRUE(a.generateRequest("DoFoo", i));
243   EXPECT_EQ(header + "Content-length: 140\r\n\r\n"
244                      "&lt;?xml version=\"1.0\"?&gt;\r\n"
245                      "&lt;methodCall&gt;&lt;methodName&gt;DoFoo&lt;/methodName&gt;\r\n"
246                      "&lt;params&gt;&lt;param&gt;&lt;value&gt;&lt;i4&gt;42&lt;/i4&gt;&lt;/value&gt;&lt;/param&gt;&lt;/"
247                      "params&gt;&lt;/methodCall&gt;\r\n",
248             a._request);
249   XmlRpcValue arr;
250   arr[0] = 2;
251   arr[1] = 3;
252   arr[2] = 5;
253   arr[3] = 7;
254   arr[4] = 11;
255   arr[5] = 13;
256   arr[6] = 17;
257   EXPECT_TRUE(a.generateRequest("DoFoo", arr));
258   EXPECT_EQ(header + "Content-length: 382\r\n\r\n"
259                      "&lt;?xml version=\"1.0\"?&gt;\r\n"
260                      "&lt;methodCall&gt;&lt;methodName&gt;DoFoo&lt;/methodName&gt;\r\n"
261                      "&lt;params&gt;"
262                      "&lt;param&gt;&lt;value&gt;&lt;i4&gt;2&lt;/i4&gt;&lt;/value&gt;&lt;/param&gt;"
263                      "&lt;param&gt;&lt;value&gt;&lt;i4&gt;3&lt;/i4&gt;&lt;/value&gt;&lt;/param&gt;"
264                      "&lt;param&gt;&lt;value&gt;&lt;i4&gt;5&lt;/i4&gt;&lt;/value&gt;&lt;/param&gt;"
265                      "&lt;param&gt;&lt;value&gt;&lt;i4&gt;7&lt;/i4&gt;&lt;/value&gt;&lt;/param&gt;"
266                      "&lt;param&gt;&lt;value&gt;&lt;i4&gt;11&lt;/i4&gt;&lt;/value&gt;&lt;/param&gt;"
267                      "&lt;param&gt;&lt;value&gt;&lt;i4&gt;13&lt;/i4&gt;&lt;/value&gt;&lt;/param&gt;"
268                      "&lt;param&gt;&lt;value&gt;&lt;i4&gt;17&lt;/i4&gt;&lt;/value&gt;&lt;/param&gt;"
269                      "&lt;/params&gt;&lt;/methodCall&gt;\r\n",
270             a._request);
271   XmlRpcValue empty;
272   EXPECT_FALSE(empty.valid());
273   EXPECT_TRUE(a.generateRequest("DoEmpty", empty));
274   EXPECT_EQ(header + "Content-length: 84\r\n\r\n"
275                      "&lt;?xml version=\"1.0\"?&gt;\r\n"
276                      "&lt;methodCall&gt;&lt;methodName&gt;DoEmpty&lt;/methodName&gt;\r\n"
277                      "&lt;/methodCall&gt;\r\n",
278             a._request);
279 }
280 TEST(XmlRpcClient, generateHeader) {
281   XmlRpcClientForTest a("localhost", 42);
282   std::string header = "POST /RPC2 HTTP/1.1\r\n"
283                        "User-Agent: XMLRPC++ 0.7\r\n"
284                        "Host: localhost:42\r\n"
285                        "Content-Type: text/xml\r\n";
286   EXPECT_EQ(header + "Content-length: 30\r\n\r\n", a.generateHeader(30));
287   EXPECT_EQ(header + "Content-length: 0\r\n\r\n", a.generateHeader(0));
288 }
289 TEST_F(MockSocketTest, writeRequest) {
290   XmlRpcClientForTest a("localhost", 42);
291   a.setfd(7);
292   a._connectionState = XmlRpcClientForTest::WRITE_REQUEST;
293   a._request = "FAKE_REQUEST";
294   ASSERT_EQ(12u, a._request.size());
295   Expect_nbWrite(7, "FAKE_REQUEST", 12, true);
296   EXPECT_TRUE(a.writeRequest());
297   EXPECT_EQ(XmlRpcClientForTest::READ_HEADER, a._connectionState);
298   CheckCalls();
299   Expect_close(7);
300 }
301 TEST_F(MockSocketTest, writeRequest_partial) {
302   XmlRpcClientForTest a("localhost", 42);
303   a.setfd(7);
304   a._connectionState = XmlRpcClientForTest::WRITE_REQUEST;
305   a._request = "FAKE_REQUEST";
306   ASSERT_EQ(12u, a._request.size());
307   Expect_nbWrite(7, "FAKE_REQUEST", 5, true);
308   EXPECT_TRUE(a.writeRequest());
309   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
310   CheckCalls();
311   Expect_nbWrite(7, "REQUEST", 7, true);
312   EXPECT_TRUE(a.writeRequest());
313   EXPECT_EQ(XmlRpcClientForTest::READ_HEADER, a._connectionState);
314   CheckCalls();
315   Expect_close(7);
316 }
317 TEST_F(MockSocketTest, writeRequest_partial_error) {
318   XmlRpcClientForTest a("localhost", 42);
319   a.setfd(7);
320   a._connectionState = XmlRpcClientForTest::WRITE_REQUEST;
321   a._request = "FAKE_REQUEST";
322   ASSERT_EQ(12u, a._request.size());
323   Expect_nbWrite(7, "FAKE_REQUEST", 5, true);
324   EXPECT_TRUE(a.writeRequest());
325   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
326   CheckCalls();
327   Expect_nbWrite(7, "REQUEST", 0, false);
328   Expect_close(7);
329   Expect_getError(ECONNREFUSED);
330   EXPECT_FALSE(a.writeRequest());
331   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
332   CheckCalls();
333 }
334 TEST_F(MockSocketTest, writeRequest_error) {
335   XmlRpcClientForTest a("localhost", 42);
336   a.setfd(7);
337   a._connectionState = XmlRpcClientForTest::WRITE_REQUEST;
338   a._request = "FAKE_REQUEST";
339   ASSERT_EQ(12u, a._request.size());
340   Expect_nbWrite(7, "FAKE_REQUEST", 0, false);
341   Expect_close(7);
342   Expect_getError(ECONNREFUSED);
343   EXPECT_FALSE(a.writeRequest());
344   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
345   CheckCalls();
346 }
347 const std::string header = "HTTP/1.1 200 OK\r\n"
348                            "Server: XMLRPC++ 0.7\r\n"
349                            "Content-Type: text/xml\r\n"
350                            "Content-length: 114\r\n\r\n";
351 const std::string header2 = "HTTP/1.0 200 OK\r\n"
352                             "Server: BaseHTTP/0.3 Python/2.7.6\r\n"
353                             "Date: Mon, 30 Oct 2017 22:28:12 GMT\r\n"
354                             "Content-type: text/xml\r\n"
355                             "Content-length: 114\r\n\r\n";
356 const std::string header3 = "HTTP/1.1 200 OK\r\n"
357                            "Server: XMLRPC++ 0.7\r\n"
358                            "Content-Type: text/xml\r\n"
359                            "Content-length: ";
360 const std::string response = "&lt;?xml version=\"1.0\"?&gt;\r\n"
361                              "&lt;methodResponse&gt;&lt;params&gt;&lt;param&gt;\r\n"
362                              "&lt;value&gt;Hello&lt;/value&gt;\r\n"
363                              "&lt;/param&gt;&lt;/params&gt;&lt;/methodResponse&gt;\r\n";
364 TEST_F(MockSocketTest, readHeader) {
365   XmlRpcClientForTest a("localhost", 42);
366   a.setfd(7);
367   a._connectionState = XmlRpcClientForTest::READ_HEADER;
368   ASSERT_EQ(114u, response.length());
369   Expect_nbRead(7, header + response, false, true);
370   EXPECT_TRUE(a.readHeader());
371   EXPECT_EQ(XmlRpcClientForTest::READ_RESPONSE, a._connectionState);
372   EXPECT_EQ(response, a._response);
373   EXPECT_EQ(114, a._contentLength); 
374   CheckCalls();
375   Expect_close(7);
376 }
377 TEST_F(MockSocketTest, readHeader2) {
378   XmlRpcClientForTest a("localhost", 42);
379   a.setfd(7);
380   a._connectionState = XmlRpcClientForTest::READ_HEADER;
381   Expect_nbRead(7, header2 + response, false, true);
382   EXPECT_TRUE(a.readHeader());
383   EXPECT_EQ(XmlRpcClientForTest::READ_RESPONSE, a._connectionState);
384   EXPECT_EQ(response, a._response);
385   EXPECT_EQ(114, a._contentLength); 
386   CheckCalls();
387   Expect_close(7);
388 }
389 TEST_F(MockSocketTest, readHeader_only) {
390   XmlRpcClientForTest a("localhost", 42);
391   a.setfd(7);
392   a._connectionState = XmlRpcClientForTest::READ_HEADER;
393   Expect_nbRead(7, header + " ", false, true);
394   EXPECT_TRUE(a.readHeader());
395   EXPECT_EQ(XmlRpcClientForTest::READ_RESPONSE, a._connectionState);
396   EXPECT_EQ(" ", a._response);
397   EXPECT_EQ(114, a._contentLength); 
398   CheckCalls();
399   Expect_close(7);
400 }
401 TEST_F(MockSocketTest, readHeader_partial) {
402   XmlRpcClientForTest a("localhost", 42);
403   a.setfd(7);
404   a._connectionState = XmlRpcClientForTest::READ_HEADER;
405   std::string header_part1 = header.substr(0, 32);
406   std::string header_part2 = header.substr(32);
407   Expect_nbRead(7, header_part1, false, true);
408   EXPECT_TRUE(a.readHeader());
409   EXPECT_EQ(XmlRpcClientForTest::READ_HEADER, a._connectionState);
410   EXPECT_EQ(header_part1, a._header);
411   CheckCalls();
412   Expect_nbRead(7, header_part2 + " ", false, true);
413   EXPECT_TRUE(a.readHeader());
414   EXPECT_EQ(XmlRpcClientForTest::READ_RESPONSE, a._connectionState);
415   EXPECT_EQ(" ", a._response);
416   EXPECT_EQ(114, a._contentLength); 
417   CheckCalls();
418   Expect_close(7);
419 }
420 TEST_F(MockSocketTest, readHeader_err) {
421   XmlRpcClientForTest a("localhost", 42);
422   a.setfd(7);
423   a._connectionState = XmlRpcClientForTest::READ_HEADER;
424   Expect_nbRead(7, "", false, false);
425   Expect_close(7);
426   Expect_socket(8);
427   Expect_setNonBlocking(8, true);
428   Expect_connect(8, "localhost", 42, true);
429   EXPECT_TRUE(a.readHeader());
430   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
431   EXPECT_EQ(1, a._sendAttempts);
432   CheckCalls();
433   a._connectionState = XmlRpcClientForTest::READ_HEADER;
434   Expect_nbRead(8, "", true, true);
435   Expect_getError(ENOTCONN);
436   Expect_close(8);
437   EXPECT_FALSE(a.readHeader());
438   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
439   CheckCalls();
440 }
441 TEST_F(MockSocketTest, readHeader_eof) {
442   XmlRpcClientForTest a("localhost", 42);
443   a.setfd(7);
444   a._connectionState = XmlRpcClientForTest::READ_HEADER;
445   Expect_nbRead(7, "", true, true);
446   Expect_close(7);
447   Expect_socket(8);
448   Expect_setNonBlocking(8, true);
449   Expect_connect(8, "localhost", 42, true);
450   EXPECT_TRUE(a.readHeader());
451   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
452   EXPECT_EQ(1, a._sendAttempts);
453   CheckCalls();
454   a._connectionState = XmlRpcClientForTest::READ_HEADER;
455   Expect_nbRead(8, "", true, true);
456   Expect_getError(ENOTCONN);
457   Expect_close(8);
458   EXPECT_FALSE(a.readHeader());
459   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
460   CheckCalls();
461 }
462 TEST_F(MockSocketTest, readHeader_partial_err) {
463   XmlRpcClientForTest a("localhost", 42);
464   a.setfd(7);
465   a._connectionState = XmlRpcClientForTest::READ_HEADER;
466   std::string header_part1 = header.substr(0, 32);
467   Expect_nbRead(7, header_part1, false, true);
468   EXPECT_TRUE(a.readHeader());
469   EXPECT_EQ(XmlRpcClientForTest::READ_HEADER, a._connectionState);
470   EXPECT_EQ(header_part1, a._header);
471   CheckCalls();
472   Expect_nbRead(7, "", false, false);
473   Expect_close(7);
474   Expect_socket(8);
475   Expect_setNonBlocking(8, true);
476   Expect_connect(8, "localhost", 42, true);
477   EXPECT_TRUE(a.readHeader());
478   EXPECT_EQ(XmlRpcClientForTest::WRITE_REQUEST, a._connectionState);
479   CheckCalls();
480   Expect_close(8);
481 }
482 TEST_F(MockSocketTest, readHeader_oversize) {
483   XmlRpcClientForTest a("localhost", 42);
484   a.setfd(7);
485   a._connectionState = XmlRpcClientForTest::READ_HEADER;
486   std::string header_cl = header3;
487   header_cl += std::to_string(size_t(INT_MAX) + 1);
488   header_cl += "\r\n\r\n ";
489   Expect_nbRead(7, header_cl, false, true);
490   Expect_close(7);
491   EXPECT_FALSE(a.readHeader());
492   EXPECT_EQ(0, a._contentLength); 
493   CheckCalls();
494 }
495 TEST_F(MockSocketTest, readResponse_noop) {
496   XmlRpcClientForTest a("localhost", 42);
497   a.setfd(7);
498   a._connectionState = XmlRpcClientForTest::READ_RESPONSE;
499   a._response = response;
500   a._contentLength = 114;
501   ASSERT_EQ(114u, a._response.length());
502   EXPECT_FALSE(a.readResponse());
503   EXPECT_EQ(XmlRpcClientForTest::IDLE, a._connectionState);
504   EXPECT_EQ(response, a._response);
505   EXPECT_EQ(114, a._contentLength); 
506   CheckCalls();
507   Expect_close(7);
508 }
509 TEST_F(MockSocketTest, readResponse) {
510   XmlRpcClientForTest a("localhost", 42);
511   a.setfd(7);
512   a._connectionState = XmlRpcClientForTest::READ_RESPONSE;
513   a._response = "";
514   a._contentLength = 114;
515   ASSERT_EQ(114u, response.length());
516   Expect_nbRead(7, response, false, true);
517   EXPECT_FALSE(a.readResponse());
518   EXPECT_EQ(XmlRpcClientForTest::IDLE, a._connectionState);
519   EXPECT_EQ(response, a._response);
520   CheckCalls();
521   Expect_close(7);
522 }
523 TEST_F(MockSocketTest, readResponse_partial) {
524   XmlRpcClientForTest a("localhost", 42);
525   a.setfd(7);
526   a._connectionState = XmlRpcClientForTest::READ_RESPONSE;
527   a._response = "";
528   a._contentLength = 114;
529   ASSERT_EQ(114u, response.length());
530   const std::string response_part1 = response.substr(0, 60);
531   const std::string response_part2 = response.substr(60);
532   Expect_nbRead(7, response_part1, false, true);
533   EXPECT_TRUE(a.readResponse());
534   EXPECT_EQ(response_part1, a._response);
535   EXPECT_EQ(XmlRpcClientForTest::READ_RESPONSE, a._connectionState);
536   CheckCalls();
537   Expect_nbRead(7, response_part2, false, true);
538   EXPECT_FALSE(a.readResponse());
539   EXPECT_EQ(XmlRpcClientForTest::IDLE, a._connectionState);
540   EXPECT_EQ(response, a._response);
541   CheckCalls();
542   Expect_close(7);
543 }
544 TEST_F(MockSocketTest, readResponse_err) {
545   XmlRpcClientForTest a("localhost", 42);
546   a.setfd(7);
547   a._connectionState = XmlRpcClientForTest::READ_RESPONSE;
548   a._response = "";
549   a._contentLength = 114;
550   ASSERT_EQ(114u, response.length());
551   Expect_nbRead(7, "", false, false);
552   Expect_getError(ENOTCONN);
553   Expect_close(7);
554   EXPECT_FALSE(a.readResponse());
555   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
556   CheckCalls();
557 }
558 TEST_F(MockSocketTest, readResponse_eof) {
559   XmlRpcClientForTest a("localhost", 42);
560   a.setfd(7);
561   a._connectionState = XmlRpcClientForTest::READ_RESPONSE;
562   a._response = "";
563   a._contentLength = 114;
564   ASSERT_EQ(114u, response.length());
565   Expect_nbRead(7, "", true, true);
566   Expect_close(7);
567   EXPECT_FALSE(a.readResponse());
568   EXPECT_EQ(XmlRpcClientForTest::NO_CONNECTION, a._connectionState);
569   CheckCalls();
570 }
571 int main(int argc, char **argv)
572 {
573   ::testing::InitGoogleTest(&amp;argc, argv);
574   return RUN_ALL_TESTS();
575 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
