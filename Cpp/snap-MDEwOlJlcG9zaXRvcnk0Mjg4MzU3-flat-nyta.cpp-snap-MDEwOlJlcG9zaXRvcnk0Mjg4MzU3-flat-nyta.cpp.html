
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 25, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-nyta.cpp</h3>
            <pre><code>1  #include "nyta.h"
2  void TNytaBs::LoadGeoNames(const TStr& FPath){
3    printf("Loading Geonames from '%s' ... ", FPath.CStr());
4    TStr CountriesFNm=TStr::GetNrFPath(FPath)+"countryInfo.txt";
5    PSs CountriesSs=TSs::LoadTxt(ssfTabSep, CountriesFNm, NULL, false, -1, TIntV(), false);
6    TStrStrH CountryCdToNmH;
7    for (int Y=38; Y<CountriesSs->GetYLen(); Y++){
8      TStr CountryCdNm=CountriesSs->GetVal(0, Y);
9      TStr CountryNm=CountriesSs->GetVal(4, Y);
10      TStr ContinetCdNm=CountriesSs->GetVal(8, Y);
11      CountryCdToNmH.AddDat(CountryCdNm, CountryNm);
12      TStr ContinentNm=ContinetCdNm;
13      if (ContinetCdNm=="AF"){ContinentNm="Africa";}
14      if (ContinetCdNm=="AS"){ContinentNm="Asia";}
15      if (ContinetCdNm=="EU"){ContinentNm="Europe";}
16      if (ContinetCdNm=="NA"){ContinentNm="North America";}
17      if (ContinetCdNm=="OC"){ContinentNm="Oceania";}
18      if (ContinetCdNm=="SA"){ContinentNm="South America";}
19      if (ContinetCdNm=="AN"){ContinentNm="Antarctica";}
20      TStrV CountryNmTokStrV; THtmlLx::GetTokStrV(CountryNm, CountryNmTokStrV);
21      AddTopicNm(CountryNmTokStrV, "gn:Country", TStr("gn:in-continent:")+ContinetCdNm);
22    }
23    TStr CitiesFNm=TStr::GetNrFPath(FPath)+"cities15000.txt";
24    PSs CitiesSs=TSs::LoadTxt(ssfTabSep, CitiesFNm, NULL, false, -1, TIntV(), false);
25    for (int Y=0; Y<CitiesSs->GetYLen(); Y++){
26      TStr CityNm=CitiesSs->GetVal(2, Y);
27      TStr GeoFeatureCdNm=CitiesSs->GetVal(7, Y);
28      TStr CountryCdNm=CitiesSs->GetVal(8, Y);
29      TStr CountryNm=CountryCdNm;
30      if (CountryCdToNmH.IsKey(CountryCdNm)){
31        CountryNm=CountryCdToNmH.GetDat(CountryCdNm);}
32      TStrV CityNmTokStrV; THtmlLx::GetTokStrV(CityNm, CityNmTokStrV);
33      AddTopicNm(CityNmTokStrV, "gn:City",
34       TStr("gn:feature:")+GeoFeatureCdNm, TStr("gn:in-country:")+CountryNm);
35    }
36    TStr GeoEntityFNm=TStr::GetNrFPath(FPath)+"null.txt";
<span onclick='openModal()' class='match'>37    PSs GeoEntitySs=TSs::LoadTxt(ssfTabSep, GeoEntityFNm, NULL, false, -1, TIntV(), false);
38    for (int Y=0; Y<GeoEntitySs->GetYLen(); Y++){
</span>39      TStr GeoEntityNm=GeoEntitySs->GetVal(2, Y);
40      TStr GeoFeatureCdNm=GeoEntitySs->GetVal(7, Y);
41      TStr CountryNm=GeoEntitySs->GetVal(8, Y);
42      TStr CountryCdNm=CountryNm;
43      if (CountryCdToNmH.IsKey(CountryCdNm)){
44        CountryNm=CountryCdToNmH.GetDat(CountryCdNm);}
45      TStrV GeoEntityNmTokStrV; THtmlLx::GetTokStrV(GeoEntityNm, GeoEntityNmTokStrV);
46      if (CountryNm.Empty()){
47        AddTopicNm(GeoEntityNmTokStrV, "gn:GeoEntity",
48         TStr("gn:feature:")+GeoFeatureCdNm);
49      } else {
50        AddTopicNm(GeoEntityNmTokStrV, "gn:GeoEntity",
51         TStr("gn:feature:")+GeoFeatureCdNm, TStr("gn:in-country:")+CountryNm);
52      }
53    }
54    printf("Done.\n");
55  }
56  void TNytaBs::LoadNytTopics(const TStr& FPath){
57    printf("Loading NYT-Topics from '%s' ...\n", FPath.CStr());
58    TFFile FFile(TStr::GetNrFPath(FPath)+"*.html"); TStr FNm;
59    while (FFile.Next(FNm)){
60      printf("  Processing '%s' ...", FNm.CStr());
61      PSIn SIn=TFIn::New(FNm);
62      THtmlLx Lx(SIn);
63      Lx.GetSym();
64      while (Lx.Sym!=hsyEof){
65        Lx.MoveToBTagArg2OrEof("<FONT>", "COLOR", "#000099", "SIZE", "2");
66        if (Lx.Sym!=hsyEof){
67          Lx.GetSym(); IAssert((Lx.Sym==hsyBTag)&&(Lx.UcChA=="<A>"));
68          TStr UrlStr=Lx.GetArg("HREF");
69          PUrl Url=TUrl::New(UrlStr);
70          TStr TopicTagNm=Url->GetPathSeg(3);
71          if (TopicTagNm=="diseasesconditionsandhealthtopics"){TopicTagNm="health";}
72          TopicTagNm=TStr("nytt:")+TopicTagNm;
73          TStr TopicNm=Lx.GetStrToETag("<FONT>", true);
74          TopicNm.ToTrunc();
75          TopicNm=TXmlLx::GetXmlStrFromPlainStr(TopicNm);
76          if (TopicNm.IsStrIn(" (")){
77            int BChN=TopicNm.SearchStr(" (");
78            int EChN=TopicNm.SearchStr(")");
79            TopicNm.DelSubStr(BChN, EChN);
80          }
81          if (TopicNm.IsStrIn(", ")){
82            TStr LeftStr; TStr RightStr;
83            TopicNm.SplitOnStr(LeftStr, ", ", RightStr);
84            if (RightStr=="Inc."){
85              TopicNm=LeftStr+" "+RightStr;
86            } else {
87              TopicNm=RightStr+" "+LeftStr;
88            }
89          }
90          PSIn TopicNmSIn=TStrIn::New(TopicNm);
91          THtmlLx TopicNmLx(TopicNmSIn);
92          TopicNmLx.GetSym(); IAssert(TopicNmLx.Sym!=hsyEof);
93          TStrV TopicNmTokStrV;
94          while (TopicNmLx.Sym!=hsyEof){
95            TopicNmTokStrV.Add(TopicNmLx.ChA);
96            TopicNmLx.GetSym();
97          }
98          AddTopicNm(TopicNmTokStrV, TopicTagNm);
99        }
100      }
101      printf(" Done.\n");
102    }
103    printf("Done.\n");
104  }
105  void TNytaBs::SaveNytTopicsTxt(const TStr& FNm){
106    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
107    for (int TopicId=0; TopicId<GetTopicNms(); TopicId++){
108      TStr TopicNm=GetTopicNm(TopicId);
109      fprintf(fOut, "'%s' (", TopicNm.CStr());
110      for (int TopicTagN=0; TopicTagN<GetTopicTags(TopicId); TopicTagN++){
111        TStr TopicTagNm=GetTopicTagNm(TopicId, TopicTagN);
112        if (TopicTagN>0){fprintf(fOut, ", ");}
113        fprintf(fOut, "'%s'", TopicTagNm.CStr());
114      }
115      fprintf(fOut, "):");
116      for (int DocIdN=0; DocIdN<GetTopicDocIds(TopicId); DocIdN++){
117        int DocId=GetTopicDocId(TopicId, DocIdN);
118        fprintf(fOut, " %d", DocId);
119      }
120      fprintf(fOut, "\n");
121    }
122  }
123  void TNytaBs::AnnotateWithNytTopics(){
124    printf("Annotating with NYT-Topics ...\n");
125    for (int DocId=0; DocId<NytaDocV.Len(); DocId++){
126      printf("%d/%d\r", 1+DocId, NytaDocV.Len());
127      PNytaDoc NytaDoc=GetDoc(DocId);
128      TStr SummaryXmlStr=NytaDoc->SummaryXmlStr;
129      typedef TTriple<TInt, TStr, TStr> TSymStrPreTr;
130      TVec<TSymStrPreTr> SymStrPreTrV;
131      PSIn SIn=TStrIn::New(SummaryXmlStr);
132      THtmlLx Lx(SIn);
133      Lx.GetSym();
134      while (Lx.Sym!=hsyEof){
135        TSymStrPreTr SymStrPreTr(TSymStrPreTr(Lx.Sym, Lx.SymChA, Lx.PreSpaceChA));
136        SymStrPreTrV.Add(SymStrPreTr);
137        Lx.GetSym();
138      }
139      TChA AnnDocChA;
140      int SymN=0;
141      while (SymN<SymStrPreTrV.Len()){
142        TStr SymStr=SymStrPreTrV[SymN].Val2;
143        TStr PreSpaceStr=SymStrPreTrV[SymN].Val3;
144        if (TopicNmFirstTokStrToToksVH.IsKey(SymStr)){
145          const TIntV& ToksV=TopicNmFirstTokStrToToksVH.GetDat(SymStr);
146          if ((ToksV.Len()==1)&&(ToksV[0]==1)){
147            TStrV TokStrV; TokStrV.Add(SymStr);
148            int TopicId=GetTopicId(TokStrV);
149            AddTopicDocId(TopicId, DocId);
150            AnnDocChA+=PreSpaceStr;
151            AnnDocChA+="<ent>"; AnnDocChA+=SymStr; AnnDocChA+="</ent>";
152            NytaDoc->AddTopicId(TopicId);
153            SymN++;
154          } else {
155            int MxToks=ToksV.Last(); TStrV TokStrV(MxToks, 0);
156            for (int TokN=0; TokN<MxToks; TokN++){
157              if (SymN+TokN>=SymStrPreTrV.Len()){break;}
158              TokStrV.Add(SymStrPreTrV[SymN+TokN].Val2);
159            }
160            int TopicId;
161            for (int ToksN=ToksV.Len()-1; ToksN>=0; ToksN--){
162              int Toks=ToksV[ToksN];
163              TokStrV.Trunc(Toks);
164              if (IsTopic(TokStrV, TopicId)){
165                break;}
166            }
167            if (IsTopic(TokStrV, TopicId)){
168              AddTopicDocId(TopicId, DocId);
169              AnnDocChA+=PreSpaceStr;
170              AnnDocChA+="<ent>"; AnnDocChA+=GetTopicNm(TopicId); AnnDocChA+="</ent>";
171              NytaDoc->AddTopicId(TopicId);
172              SymN+=TokStrV.Len();
173            } else {
174              AnnDocChA+=PreSpaceStr; AnnDocChA+=SymStr; SymN++;
175            }
176          }
177        } else {
178          AnnDocChA+=PreSpaceStr; AnnDocChA+=SymStr; SymN++;
179        }
180      }
181      if (!(SummaryXmlStr==AnnDocChA.CStr())){
182      }
183      NytaDoc->SummaryXmlStr=AnnDocChA;
184    }
185    printf("\nDone.\n");
186  }
187  int TNytaBs::AddTopicNm(const TStrV& TopicNmTokStrV,
188   const TStr& TopicTagNm1, const TStr& TopicTagNm2, const TStr& TopicTagNm3){
189    TopicNmFirstTokStrToToksVH.AddDat(TopicNmTokStrV[0]).AddUnique(TopicNmTokStrV.Len());
190    int TopicId=TokStrVToTopicH.AddKey(TopicNmTokStrV);
191    if (!TopicTagNm1.Empty()){
192      TokStrVToTopicH[TopicId].AddTopicTag(TopicTagNm1);}
193    if (!TopicTagNm2.Empty()){
194      TokStrVToTopicH[TopicId].AddTopicTag(TopicTagNm2);}
195    if (!TopicTagNm3.Empty()){
196      TokStrVToTopicH[TopicId].AddTopicTag(TopicTagNm3);}
197    return TopicId;
198  }
199  TStr TNytaBs::GetTopicNm(const int& TopicId) const {
200    const TStrV& TokStrV=TokStrVToTopicH.GetKey(TopicId);
201    TChA TopicChA;
202    for (int TokN=0; TokN<TokStrV.Len(); TokN++){
203      TStr TokStr=TokStrV[TokN];
204      if (TokN>0){
205        TStr NonSpaceChStr=".,-)";
206        if ((TokStr.Len()==1)&&(NonSpaceChStr).IsChIn(TokStr[0])){
207        } else
208        if ((TopicChA.Len()>0)&&
209         ((TopicChA.LastCh()=='-')||(TopicChA.LastCh()=='('))){
210        } else {
211          TopicChA+=' ';
212        }
213      }
214      TopicChA+=TokStrV[TokN];
215    }
216    return TopicChA;
217  }
218  void TNytaBs::SaveR2KXml(const TStr& FNm){
219    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
220    for (int DocId=0; DocId<NytaDocV.Len(); DocId++){
221      PNytaDoc NytaDoc=GetDoc(DocId);
222      TStr UrlXmlStr=TXmlLx::GetXmlStrFromPlainStr(NytaDoc->UrlStr);
223      TStr TitleXmlStr=NytaDoc->TitleXmlStr;
224      TStr SummaryXmlStr=NytaDoc->SummaryXmlStr;
225      TStr YMDDateXmlStr=NytaDoc->GetYMDDateStr();
226      fprintf(fOut, "<?xml version=\"1.0\" encoding=\"iso-8859-1\" ?>\n");
227      fprintf(fOut, "<newsitem itemid=\"%d\" id=\"root\" date=\"%s\" xml:lang=\"en\">\n", DocId, YMDDateXmlStr.CStr());
228      fprintf(fOut, "<title>%s</title>\n", TitleXmlStr.CStr());
229      fprintf(fOut, "<dateline>%s</dateline>\n", YMDDateXmlStr.CStr());
230      fprintf(fOut, "<text>\n");
231      fprintf(fOut, "<p>%s</p>\n", SummaryXmlStr.CStr());
232      fprintf(fOut, "</text>\n");
233      fprintf(fOut, "<url>%s</url>\n", UrlXmlStr.CStr());
234      fprintf(fOut, "<copyright>(c) New York Times 2008</copyright>\n");
235      fprintf(fOut, "<metadata>\n");
236      if (NytaDoc->GetTopicIds()>0){
237        fprintf(fOut, "  <codes class=\"nyt-quint:1.0\">\n");
238        for (int TopicIdN=0; TopicIdN<NytaDoc->GetTopicIds(); TopicIdN++){
239          int TopicId=NytaDoc->GetTopicId(TopicIdN);
240          TStr TopicNm=GetTopicNm(TopicId);
241          TStr XmlTopicNm=TXmlLx::GetXmlStrFromPlainStr(TopicNm);
242          fprintf(fOut, "    <code code=\"%s\">", XmlTopicNm.CStr());
243          for (int TopicTagN=0; TopicTagN<GetTopicTags(TopicId); TopicTagN++){
244            TStr TopicTagNm=GetTopicTagNm(TopicId, TopicTagN);
245            TStr XmlTopicTagNm=TXmlLx::GetXmlStrFromPlainStr(TopicTagNm);
246            fprintf(fOut, "<tag>%s</tag>", XmlTopicTagNm.CStr());
247          }
248          fprintf(fOut, "</code>\n");
249        }
250        fprintf(fOut, "  </codes>\n");
251      }
252      fprintf(fOut, "  <dc element=\"dc.publisher\" value=\"New York Times Inc\"/>\n");
253      fprintf(fOut, "  <dc element=\"dc.date.published\" value=\"%s\"/>\n", YMDDateXmlStr.CStr());
254      fprintf(fOut, "  <dc element=\"dc.conversion\" value=\"Quintelligence d.o.o.\"/>\n");
255      fprintf(fOut, "</metadata>\n");
256      fprintf(fOut, "</newsitem>\n");
257      fprintf(fOut, "\n");
258    }
259  }
</code></pre>
        </div>
        <div class="column">
            <h3>snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-nyta.cpp</h3>
            <pre><code>1  #include "nyta.h"
2  void TNytaBs::LoadGeoNames(const TStr& FPath){
3    printf("Loading Geonames from '%s' ... ", FPath.CStr());
4    TStr CountriesFNm=TStr::GetNrFPath(FPath)+"countryInfo.txt";
5    PSs CountriesSs=TSs::LoadTxt(ssfTabSep, CountriesFNm, NULL, false, -1, TIntV(), false);
6    TStrStrH CountryCdToNmH;
7    for (int Y=38; Y<CountriesSs->GetYLen(); Y++){
8      TStr CountryCdNm=CountriesSs->GetVal(0, Y);
9      TStr CountryNm=CountriesSs->GetVal(4, Y);
10      TStr ContinetCdNm=CountriesSs->GetVal(8, Y);
11      CountryCdToNmH.AddDat(CountryCdNm, CountryNm);
12      TStr ContinentNm=ContinetCdNm;
13      if (ContinetCdNm=="AF"){ContinentNm="Africa";}
14      if (ContinetCdNm=="AS"){ContinentNm="Asia";}
15      if (ContinetCdNm=="EU"){ContinentNm="Europe";}
16      if (ContinetCdNm=="NA"){ContinentNm="North America";}
17      if (ContinetCdNm=="OC"){ContinentNm="Oceania";}
18      if (ContinetCdNm=="SA"){ContinentNm="South America";}
19      if (ContinetCdNm=="AN"){ContinentNm="Antarctica";}
20      TStrV CountryNmTokStrV; THtmlLx::GetTokStrV(CountryNm, CountryNmTokStrV);
21      AddTopicNm(CountryNmTokStrV, "gn:Country", TStr("gn:in-continent:")+ContinetCdNm);
22    }
23    TStr CitiesFNm=TStr::GetNrFPath(FPath)+"cities15000.txt";
<span onclick='openModal()' class='match'>24    PSs CitiesSs=TSs::LoadTxt(ssfTabSep, CitiesFNm, NULL, false, -1, TIntV(), false);
25    for (int Y=0; Y<CitiesSs->GetYLen(); Y++){
</span>26      TStr CityNm=CitiesSs->GetVal(2, Y);
27      TStr GeoFeatureCdNm=CitiesSs->GetVal(7, Y);
28      TStr CountryCdNm=CitiesSs->GetVal(8, Y);
29      TStr CountryNm=CountryCdNm;
30      if (CountryCdToNmH.IsKey(CountryCdNm)){
31        CountryNm=CountryCdToNmH.GetDat(CountryCdNm);}
32      TStrV CityNmTokStrV; THtmlLx::GetTokStrV(CityNm, CityNmTokStrV);
33      AddTopicNm(CityNmTokStrV, "gn:City",
34       TStr("gn:feature:")+GeoFeatureCdNm, TStr("gn:in-country:")+CountryNm);
35    }
36    TStr GeoEntityFNm=TStr::GetNrFPath(FPath)+"null.txt";
37    PSs GeoEntitySs=TSs::LoadTxt(ssfTabSep, GeoEntityFNm, NULL, false, -1, TIntV(), false);
38    for (int Y=0; Y<GeoEntitySs->GetYLen(); Y++){
39      TStr GeoEntityNm=GeoEntitySs->GetVal(2, Y);
40      TStr GeoFeatureCdNm=GeoEntitySs->GetVal(7, Y);
41      TStr CountryNm=GeoEntitySs->GetVal(8, Y);
42      TStr CountryCdNm=CountryNm;
43      if (CountryCdToNmH.IsKey(CountryCdNm)){
44        CountryNm=CountryCdToNmH.GetDat(CountryCdNm);}
45      TStrV GeoEntityNmTokStrV; THtmlLx::GetTokStrV(GeoEntityNm, GeoEntityNmTokStrV);
46      if (CountryNm.Empty()){
47        AddTopicNm(GeoEntityNmTokStrV, "gn:GeoEntity",
48         TStr("gn:feature:")+GeoFeatureCdNm);
49      } else {
50        AddTopicNm(GeoEntityNmTokStrV, "gn:GeoEntity",
51         TStr("gn:feature:")+GeoFeatureCdNm, TStr("gn:in-country:")+CountryNm);
52      }
53    }
54    printf("Done.\n");
55  }
56  void TNytaBs::LoadNytTopics(const TStr& FPath){
57    printf("Loading NYT-Topics from '%s' ...\n", FPath.CStr());
58    TFFile FFile(TStr::GetNrFPath(FPath)+"*.html"); TStr FNm;
59    while (FFile.Next(FNm)){
60      printf("  Processing '%s' ...", FNm.CStr());
61      PSIn SIn=TFIn::New(FNm);
62      THtmlLx Lx(SIn);
63      Lx.GetSym();
64      while (Lx.Sym!=hsyEof){
65        Lx.MoveToBTagArg2OrEof("<FONT>", "COLOR", "#000099", "SIZE", "2");
66        if (Lx.Sym!=hsyEof){
67          Lx.GetSym(); IAssert((Lx.Sym==hsyBTag)&&(Lx.UcChA=="<A>"));
68          TStr UrlStr=Lx.GetArg("HREF");
69          PUrl Url=TUrl::New(UrlStr);
70          TStr TopicTagNm=Url->GetPathSeg(3);
71          if (TopicTagNm=="diseasesconditionsandhealthtopics"){TopicTagNm="health";}
72          TopicTagNm=TStr("nytt:")+TopicTagNm;
73          TStr TopicNm=Lx.GetStrToETag("<FONT>", true);
74          TopicNm.ToTrunc();
75          TopicNm=TXmlLx::GetXmlStrFromPlainStr(TopicNm);
76          if (TopicNm.IsStrIn(" (")){
77            int BChN=TopicNm.SearchStr(" (");
78            int EChN=TopicNm.SearchStr(")");
79            TopicNm.DelSubStr(BChN, EChN);
80          }
81          if (TopicNm.IsStrIn(", ")){
82            TStr LeftStr; TStr RightStr;
83            TopicNm.SplitOnStr(LeftStr, ", ", RightStr);
84            if (RightStr=="Inc."){
85              TopicNm=LeftStr+" "+RightStr;
86            } else {
87              TopicNm=RightStr+" "+LeftStr;
88            }
89          }
90          PSIn TopicNmSIn=TStrIn::New(TopicNm);
91          THtmlLx TopicNmLx(TopicNmSIn);
92          TopicNmLx.GetSym(); IAssert(TopicNmLx.Sym!=hsyEof);
93          TStrV TopicNmTokStrV;
94          while (TopicNmLx.Sym!=hsyEof){
95            TopicNmTokStrV.Add(TopicNmLx.ChA);
96            TopicNmLx.GetSym();
97          }
98          AddTopicNm(TopicNmTokStrV, TopicTagNm);
99        }
100      }
101      printf(" Done.\n");
102    }
103    printf("Done.\n");
104  }
105  void TNytaBs::SaveNytTopicsTxt(const TStr& FNm){
106    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
107    for (int TopicId=0; TopicId<GetTopicNms(); TopicId++){
108      TStr TopicNm=GetTopicNm(TopicId);
109      fprintf(fOut, "'%s' (", TopicNm.CStr());
110      for (int TopicTagN=0; TopicTagN<GetTopicTags(TopicId); TopicTagN++){
111        TStr TopicTagNm=GetTopicTagNm(TopicId, TopicTagN);
112        if (TopicTagN>0){fprintf(fOut, ", ");}
113        fprintf(fOut, "'%s'", TopicTagNm.CStr());
114      }
115      fprintf(fOut, "):");
116      for (int DocIdN=0; DocIdN<GetTopicDocIds(TopicId); DocIdN++){
117        int DocId=GetTopicDocId(TopicId, DocIdN);
118        fprintf(fOut, " %d", DocId);
119      }
120      fprintf(fOut, "\n");
121    }
122  }
123  void TNytaBs::AnnotateWithNytTopics(){
124    printf("Annotating with NYT-Topics ...\n");
125    for (int DocId=0; DocId<NytaDocV.Len(); DocId++){
126      printf("%d/%d\r", 1+DocId, NytaDocV.Len());
127      PNytaDoc NytaDoc=GetDoc(DocId);
128      TStr SummaryXmlStr=NytaDoc->SummaryXmlStr;
129      typedef TTriple<TInt, TStr, TStr> TSymStrPreTr;
130      TVec<TSymStrPreTr> SymStrPreTrV;
131      PSIn SIn=TStrIn::New(SummaryXmlStr);
132      THtmlLx Lx(SIn);
133      Lx.GetSym();
134      while (Lx.Sym!=hsyEof){
135        TSymStrPreTr SymStrPreTr(TSymStrPreTr(Lx.Sym, Lx.SymChA, Lx.PreSpaceChA));
136        SymStrPreTrV.Add(SymStrPreTr);
137        Lx.GetSym();
138      }
139      TChA AnnDocChA;
140      int SymN=0;
141      while (SymN<SymStrPreTrV.Len()){
142        TStr SymStr=SymStrPreTrV[SymN].Val2;
143        TStr PreSpaceStr=SymStrPreTrV[SymN].Val3;
144        if (TopicNmFirstTokStrToToksVH.IsKey(SymStr)){
145          const TIntV& ToksV=TopicNmFirstTokStrToToksVH.GetDat(SymStr);
146          if ((ToksV.Len()==1)&&(ToksV[0]==1)){
147            TStrV TokStrV; TokStrV.Add(SymStr);
148            int TopicId=GetTopicId(TokStrV);
149            AddTopicDocId(TopicId, DocId);
150            AnnDocChA+=PreSpaceStr;
151            AnnDocChA+="<ent>"; AnnDocChA+=SymStr; AnnDocChA+="</ent>";
152            NytaDoc->AddTopicId(TopicId);
153            SymN++;
154          } else {
155            int MxToks=ToksV.Last(); TStrV TokStrV(MxToks, 0);
156            for (int TokN=0; TokN<MxToks; TokN++){
157              if (SymN+TokN>=SymStrPreTrV.Len()){break;}
158              TokStrV.Add(SymStrPreTrV[SymN+TokN].Val2);
159            }
160            int TopicId;
161            for (int ToksN=ToksV.Len()-1; ToksN>=0; ToksN--){
162              int Toks=ToksV[ToksN];
163              TokStrV.Trunc(Toks);
164              if (IsTopic(TokStrV, TopicId)){
165                break;}
166            }
167            if (IsTopic(TokStrV, TopicId)){
168              AddTopicDocId(TopicId, DocId);
169              AnnDocChA+=PreSpaceStr;
170              AnnDocChA+="<ent>"; AnnDocChA+=GetTopicNm(TopicId); AnnDocChA+="</ent>";
171              NytaDoc->AddTopicId(TopicId);
172              SymN+=TokStrV.Len();
173            } else {
174              AnnDocChA+=PreSpaceStr; AnnDocChA+=SymStr; SymN++;
175            }
176          }
177        } else {
178          AnnDocChA+=PreSpaceStr; AnnDocChA+=SymStr; SymN++;
179        }
180      }
181      if (!(SummaryXmlStr==AnnDocChA.CStr())){
182      }
183      NytaDoc->SummaryXmlStr=AnnDocChA;
184    }
185    printf("\nDone.\n");
186  }
187  int TNytaBs::AddTopicNm(const TStrV& TopicNmTokStrV,
188   const TStr& TopicTagNm1, const TStr& TopicTagNm2, const TStr& TopicTagNm3){
189    TopicNmFirstTokStrToToksVH.AddDat(TopicNmTokStrV[0]).AddUnique(TopicNmTokStrV.Len());
190    int TopicId=TokStrVToTopicH.AddKey(TopicNmTokStrV);
191    if (!TopicTagNm1.Empty()){
192      TokStrVToTopicH[TopicId].AddTopicTag(TopicTagNm1);}
193    if (!TopicTagNm2.Empty()){
194      TokStrVToTopicH[TopicId].AddTopicTag(TopicTagNm2);}
195    if (!TopicTagNm3.Empty()){
196      TokStrVToTopicH[TopicId].AddTopicTag(TopicTagNm3);}
197    return TopicId;
198  }
199  TStr TNytaBs::GetTopicNm(const int& TopicId) const {
200    const TStrV& TokStrV=TokStrVToTopicH.GetKey(TopicId);
201    TChA TopicChA;
202    for (int TokN=0; TokN<TokStrV.Len(); TokN++){
203      TStr TokStr=TokStrV[TokN];
204      if (TokN>0){
205        TStr NonSpaceChStr=".,-)";
206        if ((TokStr.Len()==1)&&(NonSpaceChStr).IsChIn(TokStr[0])){
207        } else
208        if ((TopicChA.Len()>0)&&
209         ((TopicChA.LastCh()=='-')||(TopicChA.LastCh()=='('))){
210        } else {
211          TopicChA+=' ';
212        }
213      }
214      TopicChA+=TokStrV[TokN];
215    }
216    return TopicChA;
217  }
218  void TNytaBs::SaveR2KXml(const TStr& FNm){
219    TFOut FOut(FNm); FILE* fOut=FOut.GetFileId();
220    for (int DocId=0; DocId<NytaDocV.Len(); DocId++){
221      PNytaDoc NytaDoc=GetDoc(DocId);
222      TStr UrlXmlStr=TXmlLx::GetXmlStrFromPlainStr(NytaDoc->UrlStr);
223      TStr TitleXmlStr=NytaDoc->TitleXmlStr;
224      TStr SummaryXmlStr=NytaDoc->SummaryXmlStr;
225      TStr YMDDateXmlStr=NytaDoc->GetYMDDateStr();
226      fprintf(fOut, "<?xml version=\"1.0\" encoding=\"iso-8859-1\" ?>\n");
227      fprintf(fOut, "<newsitem itemid=\"%d\" id=\"root\" date=\"%s\" xml:lang=\"en\">\n", DocId, YMDDateXmlStr.CStr());
228      fprintf(fOut, "<title>%s</title>\n", TitleXmlStr.CStr());
229      fprintf(fOut, "<dateline>%s</dateline>\n", YMDDateXmlStr.CStr());
230      fprintf(fOut, "<text>\n");
231      fprintf(fOut, "<p>%s</p>\n", SummaryXmlStr.CStr());
232      fprintf(fOut, "</text>\n");
233      fprintf(fOut, "<url>%s</url>\n", UrlXmlStr.CStr());
234      fprintf(fOut, "<copyright>(c) New York Times 2008</copyright>\n");
235      fprintf(fOut, "<metadata>\n");
236      if (NytaDoc->GetTopicIds()>0){
237        fprintf(fOut, "  <codes class=\"nyt-quint:1.0\">\n");
238        for (int TopicIdN=0; TopicIdN<NytaDoc->GetTopicIds(); TopicIdN++){
239          int TopicId=NytaDoc->GetTopicId(TopicIdN);
240          TStr TopicNm=GetTopicNm(TopicId);
241          TStr XmlTopicNm=TXmlLx::GetXmlStrFromPlainStr(TopicNm);
242          fprintf(fOut, "    <code code=\"%s\">", XmlTopicNm.CStr());
243          for (int TopicTagN=0; TopicTagN<GetTopicTags(TopicId); TopicTagN++){
244            TStr TopicTagNm=GetTopicTagNm(TopicId, TopicTagN);
245            TStr XmlTopicTagNm=TXmlLx::GetXmlStrFromPlainStr(TopicTagNm);
246            fprintf(fOut, "<tag>%s</tag>", XmlTopicTagNm.CStr());
247          }
248          fprintf(fOut, "</code>\n");
249        }
250        fprintf(fOut, "  </codes>\n");
251      }
252      fprintf(fOut, "  <dc element=\"dc.publisher\" value=\"New York Times Inc\"/>\n");
253      fprintf(fOut, "  <dc element=\"dc.date.published\" value=\"%s\"/>\n", YMDDateXmlStr.CStr());
254      fprintf(fOut, "  <dc element=\"dc.conversion\" value=\"Quintelligence d.o.o.\"/>\n");
255      fprintf(fOut, "</metadata>\n");
256      fprintf(fOut, "</newsitem>\n");
257      fprintf(fOut, "\n");
258    }
259  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-nyta.cpp</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-nyta.cpp</div>
                </div>
                <div class="column column_space"><pre><code>37    PSs GeoEntitySs=TSs::LoadTxt(ssfTabSep, GeoEntityFNm, NULL, false, -1, TIntV(), false);
38    for (int Y=0; Y<GeoEntitySs->GetYLen(); Y++){
</pre></code></div>
                <div class="column column_space"><pre><code>24    PSs CitiesSs=TSs::LoadTxt(ssfTabSep, CitiesFNm, NULL, false, -1, TIntV(), false);
25    for (int Y=0; Y<CitiesSs->GetYLen(); Y++){
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    