
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 16, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-preferenceDlg.cpp</h3>
            <pre><code>1  #include &lt;shlwapi.h&gt;
2  #include &quot;preferenceDlg.h&quot;
3  #include &quot;lesDlgs.h&quot;
4  #include &quot;EncodingMapper.h&quot;
5  #include &quot;localization.h&quot;
6  #define MyGetGValue(rgb)      (LOBYTE((rgb)&gt;&gt;8))
7  using namespace std;
8  const int BLINKRATE_FASTEST = 50;
9  const int BLINKRATE_SLOWEST = 2500;
10  const int BLINKRATE_INTERVAL = 50;
11  const int CARETLINEFRAME_SMALLEST = 1;
12  const int CARETLINEFRAME_LARGEST = 6;
13  const int CARETLINEFRAME_INTERVAL = 1;
14  const int BORDERWIDTH_SMALLEST = 0;
15  const int BORDERWIDTH_LARGEST = 30;
16  const int BORDERWIDTH_INTERVAL = 1;
17  const int PADDING_SMALLEST = 0;
18  const int PADDING_LARGEST = 30;
19  const int PADDING_INTERVAL = 1;
20  const int DISTRACTIONFREE_SMALLEST = 3;
21  const int DISTRACTIONFREE_LARGEST = 9;
22  const int DISTRACTIONFREE_INTERVAL = 1;
23  constexpr int AUTOCOMPLETEFROMCHAR_SMALLEST = 1;
24  constexpr int AUTOCOMPLETEFROMCHAR_LARGEST = 9;
25  constexpr int AUTOCOMPLETEFROMCHAR_INTERVAL = 1;
26  static int encodings[] = {
27  	1250, 
28  	1251, 
29  	1252, 
30  	1253, 
31  	1254, 
32  	1255, 
33  	1256, 
34  	1257, 
35  	1258, 
36  	28591,
37  	28592,
38  	28593,
39  	28594,
40  	28595,
41  	28596,
42  	28597,
43  	28598,
44  	28599,
45  	28603,
46  	28604,
47  	28605,
48  	437,  
49  	720,  
50  	737,  
51  	775,  
52  	850,  
53  	852,  
54  	855,  
55  	857,  
56  	858,  
57  	860,  
58  	861,  
59  	862,  
60  	863,  
61  	865,  
62  	866,  
63  	869,  
64  	950,  
65  	936,  
66  	932,  
67  	949,  
68  	51949,
69  	874,
70  	10007,
71  	21866,
72  	20866
73  };
74  bool PreferenceDlg::goToSection(size_t iPage, intptr_t ctrlID)
75  {
76  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_SETCURSEL, iPage, 0);
77  	showDialogByIndex(iPage);
78  	getFocus();
79  	if (ctrlID != -1)
80  	{
81  		::SetFocus(::GetDlgItem(_wVector[iPage]._dlg-&gt;getHSelf(), int(ctrlID)));
82  	}
83  	return true;
84  }
85  intptr_t CALLBACK PreferenceDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
86  {
87  	switch (message) 
88  	{
89  		case WM_INITDIALOG :
90  		{
91  			_generalSubDlg.init(_hInst, _hSelf);
92  			_generalSubDlg.create(IDD_PREFERENCE_SUB_GENRAL, false, false);
93  			_generalSubDlg.display();
94  			_editingSubDlg.init(_hInst, _hSelf);
95  			_editingSubDlg.create(IDD_PREFERENCE_SUB_EDITING, false, false);
96  			_darkModeSubDlg.init(_hInst, _hSelf);
97  			_darkModeSubDlg.create(IDD_PREFERENCE_SUB_DARKMODE, false, false);
98  			_marginsBorderEdgeSubDlg.init(_hInst, _hSelf);
99  			_marginsBorderEdgeSubDlg.create(IDD_PREFERENCE_SUB_MARGING_BORDER_EDGE, false, false);
100  			_miscSubDlg.init(_hInst, _hSelf);
101  			_miscSubDlg.create(IDD_PREFERENCE_SUB_MISC, false, false);
102  			_newDocumentSubDlg.init(_hInst, _hSelf);
103  			_newDocumentSubDlg.create(IDD_PREFERENCE_SUB_NEWDOCUMENT, false, false);
104  			_defaultDirectorySubDlg.init(_hInst, _hSelf);
105  			_defaultDirectorySubDlg.create(IDD_PREFERENCE_SUB_DEFAULTDIRECTORY, false, false);
106  			_recentFilesHistorySubDlg.init(_hInst, _hSelf);
107  			_recentFilesHistorySubDlg.create(IDD_PREFERENCE_SUB_RECENTFILESHISTORY, false, false);
108  			_fileAssocDlg.init(_hInst, _hSelf);
109  			_fileAssocDlg.create(IDD_REGEXT_BOX, false, false);
110  			_printSubDlg.init(_hInst, _hSelf);
111  			_printSubDlg.create(IDD_PREFERENCE_SUB_PRINT, false, false);
112  			_searchingSubDlg.init(_hInst, _hSelf);
113  			_searchingSubDlg.create(IDD_PREFERENCE_SUB_SEARCHING, false, false);
114  			_languageSubDlg.init(_hInst, _hSelf);
115  			_languageSubDlg.create(IDD_PREFERENCE_SUB_LANGUAGE, false, false);
116  			_highlightingSubDlg.init(_hInst, _hSelf);
117  			_highlightingSubDlg.create(IDD_PREFERENCE_SUB_HIGHLIGHTING, false, false);
118  			_backupSubDlg.init(_hInst, _hSelf);
119  			_backupSubDlg.create(IDD_PREFERENCE_SUB_BACKUP, false, false);
120  			_autoCompletionSubDlg.init(_hInst, _hSelf);
121  			_autoCompletionSubDlg.create(IDD_PREFERENCE_SUB_AUTOCOMPLETION, false, false);
122  			_multiInstanceSubDlg.init(_hInst, _hSelf);
123  			_multiInstanceSubDlg.create(IDD_PREFERENCE_SUB_MULTIINSTANCE, false, false);
124  			_delimiterSubDlg.init(_hInst, _hSelf);
125  			_delimiterSubDlg.create(IDD_PREFERENCE_SUB_DELIMITER, false, false);
126  			_performanceSubDlg.init(_hInst, _hSelf);
127  			_performanceSubDlg.create(IDD_PREFERENCE_SUB_PERFORMANCE, false, false);
128  			_cloudAndLinkSubDlg.init(_hInst, _hSelf);
129  			_cloudAndLinkSubDlg.create(IDD_PREFERENCE_SUB_CLOUD_LINK, false, false);
130  			_searchEngineSubDlg.init(_hInst, _hSelf);
131  			_searchEngineSubDlg.create(IDD_PREFERENCE_SUB_SEARCHENGINE, false, false);			
132  			_wVector.push_back(DlgInfo(&amp;_generalSubDlg, TEXT(&quot;General&quot;), TEXT(&quot;Global&quot;)));
133  			_wVector.push_back(DlgInfo(&amp;_editingSubDlg, TEXT(&quot;Editing&quot;), TEXT(&quot;Scintillas&quot;)));
134  			_wVector.push_back(DlgInfo(&amp;_darkModeSubDlg, TEXT(&quot;Dark Mode&quot;), TEXT(&quot;DarkMode&quot;)));
135  			_wVector.push_back(DlgInfo(&amp;_marginsBorderEdgeSubDlg, TEXT(&quot;Margins/Border/Edge&quot;), TEXT(&quot;MarginsBorderEdge&quot;)));
136  			_wVector.push_back(DlgInfo(&amp;_newDocumentSubDlg, TEXT(&quot;New Document&quot;), TEXT(&quot;NewDoc&quot;)));
137  			_wVector.push_back(DlgInfo(&amp;_defaultDirectorySubDlg, TEXT(&quot;Default Directory&quot;), TEXT(&quot;DefaultDir&quot;)));
138  			_wVector.push_back(DlgInfo(&amp;_recentFilesHistorySubDlg, TEXT(&quot;Recent Files History&quot;), TEXT(&quot;RecentFilesHistory&quot;)));
139  			_wVector.push_back(DlgInfo(&amp;_fileAssocDlg, TEXT(&quot;File Association&quot;), TEXT(&quot;FileAssoc&quot;)));
140  			_wVector.push_back(DlgInfo(&amp;_languageSubDlg, TEXT(&quot;Language&quot;), TEXT(&quot;Language&quot;)));
141  			_wVector.push_back(DlgInfo(&amp;_highlightingSubDlg, TEXT(&quot;Highlighting&quot;), TEXT(&quot;Highlighting&quot;)));
142  			_wVector.push_back(DlgInfo(&amp;_printSubDlg, TEXT(&quot;Print&quot;), TEXT(&quot;Print&quot;)));
143  			_wVector.push_back(DlgInfo(&amp;_searchingSubDlg, TEXT(&quot;Searching&quot;), TEXT(&quot;Searching&quot;)));
144  			_wVector.push_back(DlgInfo(&amp;_backupSubDlg, TEXT(&quot;Backup&quot;), TEXT(&quot;Backup&quot;)));
145  			_wVector.push_back(DlgInfo(&amp;_autoCompletionSubDlg, TEXT(&quot;Auto-Completion&quot;), TEXT(&quot;AutoCompletion&quot;)));
146  			_wVector.push_back(DlgInfo(&amp;_multiInstanceSubDlg, TEXT(&quot;Multi-Instance &amp; Date&quot;), TEXT(&quot;MultiInstance&quot;)));
147  			_wVector.push_back(DlgInfo(&amp;_delimiterSubDlg, TEXT(&quot;Delimiter&quot;), TEXT(&quot;Delimiter&quot;)));
148  			_wVector.push_back(DlgInfo(&amp;_performanceSubDlg, TEXT(&quot;Performance&quot;), TEXT(&quot;Performance&quot;)));
149  			_wVector.push_back(DlgInfo(&amp;_cloudAndLinkSubDlg, TEXT(&quot;Cloud &amp; Link&quot;), TEXT(&quot;Cloud&quot;)));
150  			_wVector.push_back(DlgInfo(&amp;_searchEngineSubDlg, TEXT(&quot;Search Engine&quot;), TEXT(&quot;SearchEngine&quot;)));
151  			_wVector.push_back(DlgInfo(&amp;_miscSubDlg, TEXT(&quot;MISC.&quot;), TEXT(&quot;MISC&quot;)));
152  			makeCategoryList();
153  			NppDarkMode::autoSubclassAndThemeChildControls(_hSelf);
154  			return TRUE;
155  		}
156  		case WM_CTLCOLORLISTBOX:
157  		{
158  			return NppDarkMode::onCtlColorListbox(wParam, lParam);
159  		}
160  		case WM_CTLCOLORDLG:
161  		case WM_CTLCOLORSTATIC:
162  		{
163  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
164  		}
165  		case WM_PRINTCLIENT:
166  		{
167  			if (NppDarkMode::isEnabled())
168  			{
169  				return TRUE;
170  			}
171  			break;
172  		}
173  		case NPPM_INTERNAL_REFRESHDARKMODE:
174  		{
175  			NppDarkMode::autoThemeChildControls(_hSelf);
176  			if (_editingSubDlg._tip != nullptr)
177  				NppDarkMode::setDarkTooltips(_editingSubDlg._tip, NppDarkMode::ToolTipsType::tooltip);
178  			for (auto&amp; tip : _editingSubDlg._tips)
179  			{
180  				if (tip != nullptr)
181  				{
182  					NppDarkMode::setDarkTooltips(tip, NppDarkMode::ToolTipsType::tooltip);
183  				}
184  			}
185  			if (_delimiterSubDlg._tip != nullptr)
186  				NppDarkMode::setDarkTooltips(_delimiterSubDlg._tip, NppDarkMode::ToolTipsType::tooltip);
187  			if (_performanceSubDlg._largeFileRestrictionTip != nullptr)
188  				NppDarkMode::setDarkTooltips(_performanceSubDlg._largeFileRestrictionTip, NppDarkMode::ToolTipsType::tooltip);
189  			if (NppDarkMode::isEnabled())
190  			{
191  				const NppGUI&amp; nppGUI = NppParameters::getInstance().getNppGUI();
192  				::EnableWindow(::GetDlgItem(_highlightingSubDlg.getHSelf(), IDC_SMARTHILITEMATCHING_STATIC), nppGUI._enableSmartHilite);
193  				const bool noBackup = _backupSubDlg.isCheckedOrNot(IDC_RADIO_BKNONE);
194  				::EnableWindow(::GetDlgItem(_backupSubDlg.getHSelf(), IDC_BACKUPDIR_USERCUSTOMDIR_GRPSTATIC), !noBackup);
195  				const bool isEnableAutoC = _autoCompletionSubDlg.isCheckedOrNot(IDD_AUTOC_ENABLECHECK);
196  				::EnableWindow(::GetDlgItem(_autoCompletionSubDlg.getHSelf(), IDD_AUTOC_USEKEY_GRP_STATIC), isEnableAutoC);
197  			}
198  			return TRUE;
199  		}
200  		case PREF_MSG_SETGUITOOLICONSSET:
201  		{
202  			const HWND generalSubDlg = _generalSubDlg.getHSelf();
203  			auto checkOrUncheckBtn = [&amp;generalSubDlg](int id, WPARAM check = BST_UNCHECKED) -&gt; void
204  			{
205  				::SendDlgItemMessage(generalSubDlg, id, BM_SETCHECK, check, 0);
206  			};
207  			const int iconState = NppDarkMode::getToolBarIconSet(static_cast&lt;bool&gt;(wParam));
208  			NppParameters&amp; nppParams = NppParameters::getInstance();
209  			NppGUI&amp; nppGUI = nppParams.getNppGUI();
210  			if (iconState != -1)
211  			{
212  				nppGUI._toolBarStatus = static_cast&lt;toolBarStatusType&gt;(iconState);
213  			}
214  			else
215  			{
216  				auto state = TB_STANDARD;
217  				if (_generalSubDlg.isCheckedOrNot(IDC_RADIO_SMALLICON))
218  				{
219  					state = TB_SMALL;
220  				}
221  				else if (_generalSubDlg.isCheckedOrNot(IDC_RADIO_BIGICON))
222  				{
223  					state = TB_LARGE;
224  				}
225  				else if (_generalSubDlg.isCheckedOrNot(IDC_RADIO_SMALLICON2))
226  				{
227  					state = TB_SMALL2;
228  				}
229  				else if (_generalSubDlg.isCheckedOrNot(IDC_RADIO_BIGICON2))
230  				{
231  					state = TB_LARGE2;
232  				}
233  				nppGUI._toolBarStatus = state;
234  			}
235  			checkOrUncheckBtn(IDC_RADIO_STANDARD);
236  			checkOrUncheckBtn(IDC_RADIO_SMALLICON);
237  			checkOrUncheckBtn(IDC_RADIO_BIGICON);
238  			checkOrUncheckBtn(IDC_RADIO_SMALLICON2);
239  			checkOrUncheckBtn(IDC_RADIO_BIGICON2);
240  			switch (nppGUI._toolBarStatus)
241  			{
242  				case TB_LARGE:
243  				{
244  					checkOrUncheckBtn(IDC_RADIO_BIGICON, BST_CHECKED);
245  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_ENLARGE, 0);
246  					break;
247  				}
248  				case TB_SMALL2:
249  				{
250  					checkOrUncheckBtn(IDC_RADIO_SMALLICON2, BST_CHECKED);
251  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_REDUCE_SET2, 0);
252  					break;
253  				}
254  				case TB_LARGE2:
255  				{
256  					checkOrUncheckBtn(IDC_RADIO_BIGICON2, BST_CHECKED);
257  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_ENLARGE_SET2, 0);
258  					break;
259  				}
260  				case TB_STANDARD:
261  				{
262  					checkOrUncheckBtn(IDC_RADIO_STANDARD, BST_CHECKED);
263  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_STANDARD, 0);
264  					break;
265  				}
266  				default:
267  				{
268  					checkOrUncheckBtn(IDC_RADIO_SMALLICON, BST_CHECKED);
269  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_REDUCE, 0);
270  				}
271  			}
272  			return TRUE;
273  		}
274  		case PREF_MSG_SETGUITABBARICONS:
275  		{
276  			const int tabIconSet = NppDarkMode::getTabIconSet(static_cast&lt;bool&gt;(wParam));
277  			if (tabIconSet != -1)
278  			{
279  				_generalSubDlg.setTabbarAlternateIcons(tabIconSet == 1);
280  			}
281  			return TRUE;
282  		}
283  		case WM_COMMAND :
284  		{
285  			if (LOWORD(wParam) == IDC_LIST_DLGTITLE)
286  			{
287  				if (HIWORD(wParam) == CBN_SELCHANGE)
288  				{
289  					auto i = ::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_GETCURSEL, 0, 0);
290  					if (i != LB_ERR)
291  					{
292  						showDialogByIndex(i);
293  					}
294  				}
295  			}
296  			else 
297  			{
298  				switch (wParam)
299  				{
300  					case IDC_BUTTON_CLOSE :
301  					case IDCANCEL :
302  						display(false);
303  						return TRUE;
304  					default :
305  						::SendMessage(_hParent, WM_COMMAND, wParam, lParam);
306  						return TRUE;
307  				}
308  			}
309  		}
310  	}
311  	return FALSE;
312  }
313  void PreferenceDlg::makeCategoryList()
314  {
315  	for (size_t i = 0, len = _wVector.size(); i &lt; len; ++i)
316  	{
317  		::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(_wVector[i]._name.c_str()));
318  	}
319  	setListSelection(0);
320  }
321  int32_t PreferenceDlg::getIndexFromName(const TCHAR *name) const
322  {
323  	if (!name)
324  		return -1;
325  	int32_t i = 0;
326  	for (auto it = _wVector.begin() ; it != _wVector.end(); ++it, ++i)
327  	{
328  		if (it-&gt;_internalName == name)
329  			return i;
330  	}
331  	return -1;
332  }
333  bool PreferenceDlg::setListSelection(size_t currentSel) const
334  {
335  	const size_t selStrLenMax = 255;
336  	TCHAR selStr[selStrLenMax + 1] = { &#x27;\0&#x27; };
337  	auto lbTextLen = ::SendMessage(_hSelf, LB_GETTEXTLEN, currentSel, 0);
338  	if (static_cast&lt;size_t&gt;(lbTextLen) &gt; selStrLenMax)
339  		return false;
340  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_GETTEXT, currentSel, reinterpret_cast&lt;LPARAM&gt;(selStr));
341  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_SELECTSTRING, currentSel, reinterpret_cast&lt;LPARAM&gt;(selStr));
342  	return true;
343  }
344  bool PreferenceDlg::renameDialogTitle(const TCHAR *internalName, const TCHAR *newName)
345  {
346  	bool foundIt = false;
347  	size_t i = 0;
348  	for (size_t len = _wVector.size(); i &lt; len; ++i)
349  	{
350  		if (_wVector[i]._internalName == internalName)
351  		{
352  			foundIt = true;
353  			break;
354  		}
355  	}
356  	if (!foundIt)
357  		return false;
358  	const size_t lenMax = 256;
359  	TCHAR oldName[lenMax] = { &#x27;\0&#x27; };
360  	size_t txtLen = ::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_GETTEXTLEN, i, 0);
361  	if (txtLen &gt;= lenMax)
362  		return false;
363  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_GETTEXT, i, reinterpret_cast&lt;LPARAM&gt;(oldName));
364  	if (lstrcmp(newName, oldName) == 0)
365  		return true;
366  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_DELETESTRING, i, 0);
367  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_INSERTSTRING, i, reinterpret_cast&lt;LPARAM&gt;(newName));
368  	return true;
369  }
370  void PreferenceDlg::showDialogByName(const TCHAR *name) const
371  {
372  	int32_t i = getIndexFromName(name);
373  	if (i &gt;= 0)
374  	{
375  		showDialogByIndex(i);
376  		setListSelection(i);
377  	}
378  }
379  void PreferenceDlg::showDialogByIndex(size_t index) const
380  {
381  	size_t len = _wVector.size();
382  	for (size_t i = 0; i &lt; len; ++i)
383  	{
384  		_wVector[i]._dlg-&gt;display(false);
385  	}
386  	_wVector[index]._dlg-&gt;display(true);
387  }
388  void PreferenceDlg::destroy()
389  {
390  	_generalSubDlg.destroy();
391  	_editingSubDlg.destroy();
392  	_darkModeSubDlg.destroy();
393  	_marginsBorderEdgeSubDlg.destroy();
394  	_miscSubDlg.destroy();
395  	_fileAssocDlg.destroy();
396  	_languageSubDlg.destroy();
397  	_highlightingSubDlg.destroy();
398  	_printSubDlg.destroy();
399  	_searchingSubDlg.destroy();
400  	_newDocumentSubDlg.destroy();
401  	_defaultDirectorySubDlg.destroy();
402  	_recentFilesHistorySubDlg.destroy();
403  	_backupSubDlg.destroy();
404  	_autoCompletionSubDlg.destroy();
405  	_multiInstanceSubDlg.destroy();
406  	_delimiterSubDlg.destroy();
407  	_performanceSubDlg.destroy();
408  }
409  void GeneralSubDlg::setTabbarAlternateIcons(bool enable)
410  {
411  	NppGUI&amp; nppGUI = NppParameters::getInstance().getNppGUI();
412  	if (!enable)
413  	{
414  		nppGUI._tabStatus &amp;= ~TAB_ALTICONS;
415  		::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_ALTICONS, BM_SETCHECK, BST_UNCHECKED, 0);
416  	}
417  	else
418  	{
419  		nppGUI._tabStatus |= TAB_ALTICONS;
420  		::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_ALTICONS, BM_SETCHECK, BST_CHECKED, 0);
421  	}
422  }
423  intptr_t CALLBACK GeneralSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
424  {
425  	NppParameters&amp; nppParam = NppParameters::getInstance();
426  	switch (message) 
427  	{
428  		case WM_INITDIALOG :
429  		{
430  			const NppGUI &amp; nppGUI = nppParam.getNppGUI();
431  			toolBarStatusType tbStatus = nppGUI._toolBarStatus;
432  			int tabBarStatus = nppGUI._tabStatus;
433  			bool showTool = nppGUI._toolbarShow;
434  			bool showStatus = nppGUI._statusBarShow;
435  			bool showMenu = nppGUI._menuBarShow;
436  			bool hideRightShortcutsFromMenu = nppGUI._hideMenuRightShortcuts;
437  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDE, BM_SETCHECK, showTool?BST_UNCHECKED:BST_CHECKED, 0);
438  			int ID2Check = 0;
439  			switch (tbStatus)
440  			{
441  				case TB_SMALL :
442  					ID2Check = IDC_RADIO_SMALLICON;
443  					break;
444  				case TB_LARGE :
445  					ID2Check = IDC_RADIO_BIGICON;
446  					break;
447  				case TB_SMALL2 :
448  					ID2Check = IDC_RADIO_SMALLICON2;
449  					break;
450  				case TB_LARGE2 :
451  					ID2Check = IDC_RADIO_BIGICON2;
452  					break;
453  				case TB_STANDARD:
454  				default :
455  					ID2Check = IDC_RADIO_STANDARD;
456  			}
457  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
458  			::SendDlgItemMessage(_hSelf, IDC_CHECK_REDUCE, BM_SETCHECK, tabBarStatus &amp; TAB_REDUCE, 0);
459  			::SendDlgItemMessage(_hSelf, IDC_CHECK_LOCK, BM_SETCHECK, !(tabBarStatus &amp; TAB_DRAGNDROP), 0);
460  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ORANGE, BM_SETCHECK, tabBarStatus &amp; TAB_DRAWTOPBAR, 0);
461  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DRAWINACTIVE, BM_SETCHECK, tabBarStatus &amp; TAB_DRAWINACTIVETAB, 0);
462  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLETABCLOSE, BM_SETCHECK, tabBarStatus &amp; TAB_CLOSEBUTTON, 0);
463  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DBCLICK2CLOSE, BM_SETCHECK, tabBarStatus &amp; TAB_DBCLK2CLOSE, 0);
464  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_VERTICAL, BM_SETCHECK, tabBarStatus &amp; TAB_VERTICAL, 0);
465  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_MULTILINE, BM_SETCHECK, tabBarStatus &amp; TAB_MULTILINE, 0);
466  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_LAST_EXIT, BM_SETCHECK, tabBarStatus &amp; TAB_QUITONEMPTY, 0);
467  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_ALTICONS, BM_SETCHECK, tabBarStatus &amp; TAB_ALTICONS, 0);
468  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_HIDE, BM_SETCHECK, tabBarStatus &amp; TAB_HIDE, 0);
469  			::SendMessage(_hSelf, WM_COMMAND, IDC_CHECK_TAB_HIDE, 0);
470  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDESTATUSBAR, BM_SETCHECK, !showStatus, 0);
471  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDEMENUBAR, BM_SETCHECK, !showMenu, 0);
472  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDERIGHTSHORTCUTSOFMENUBAR, BM_SETCHECK, hideRightShortcutsFromMenu, 0);
473  			LocalizationSwitcher &amp; localizationSwitcher = nppParam.getLocalizationSwitcher();
474  			for (size_t i = 0, len = localizationSwitcher.size(); i &lt; len ; ++i)
475  			{
476  				pair&lt;wstring, wstring&gt; localizationInfo = localizationSwitcher.getElementFromIndex(i);
477  				::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(localizationInfo.first.c_str()));
478  			}
479  			wstring lang = TEXT(&quot;English&quot;); 
480  			if (nppParam.getNativeLangA()) 
481  			{
482  				string fn = localizationSwitcher.getFileName();
483  				wstring fnW = s2ws(fn);
484  				lang = localizationSwitcher.getLangFromXmlFileName(fnW.c_str());
485  			}
486  			auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(lang.c_str()));
487  			if (index != CB_ERR)
488                  ::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_SETCURSEL, index, 0);
489  			return TRUE;
490  		}
491  		case WM_CTLCOLORLISTBOX:
492  		{
493  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
494  		}
495  		case WM_CTLCOLORDLG:
496  		case WM_CTLCOLORSTATIC:
497  		{
498  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
499  		}
500  		case WM_PRINTCLIENT:
501  		{
502  			if (NppDarkMode::isEnabled())
503  			{
504  				return TRUE;
505  			}
506  			break;
507  		}
508  		case WM_COMMAND:
509  		{
510  			switch (wParam)
511  			{
512  				case IDC_CHECK_HIDESTATUSBAR:
513  				{
514  					const bool isChecked = isCheckedOrNot(IDC_CHECK_HIDESTATUSBAR);
515  					::SendMessage(::GetParent(_hParent), NPPM_HIDESTATUSBAR, 0, isChecked ? TRUE : FALSE);
516  				}
517  				return TRUE;
518  				case IDC_CHECK_HIDEMENUBAR :
519  				{
520  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDEMENUBAR, BM_GETCHECK, 0, 0));
521  					::SendMessage(::GetParent(_hParent), NPPM_HIDEMENU, 0, isChecked?TRUE:FALSE);
522  				}
523  				return TRUE;
524  				case IDC_CHECK_HIDERIGHTSHORTCUTSOFMENUBAR:
525  				{
526  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDERIGHTSHORTCUTSOFMENUBAR, BM_GETCHECK, 0, 0));
527  					NppGUI&amp; nppGUI = nppParam.getNppGUI();
528  					nppGUI._hideMenuRightShortcuts = isChecked;
529  				}
530  				return TRUE;
531  				case IDC_CHECK_TAB_HIDE :
532  				{
533  					bool toBeHidden = (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_TAB_HIDE), BM_GETCHECK, 0, 0));
534  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_TAB_MULTILINE), !toBeHidden);
535  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_TAB_VERTICAL), !toBeHidden);
536  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_REDUCE), !toBeHidden);
537  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_LOCK), !toBeHidden);
538  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_ORANGE), !toBeHidden);
539  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_DRAWINACTIVE), !toBeHidden);
540  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_ENABLETABCLOSE), !toBeHidden);
541  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_DBCLICK2CLOSE), !toBeHidden);
542  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_TAB_LAST_EXIT), !toBeHidden);
543  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_TAB_ALTICONS), !toBeHidden);
544  					::SendMessage(::GetParent(_hParent), NPPM_HIDETABBAR, 0, toBeHidden);
545  					return TRUE;
546  				}
547  				case  IDC_CHECK_TAB_VERTICAL:
548  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_VERTICAL, 0);
549  					return TRUE;
550  				case IDC_CHECK_TAB_MULTILINE :
551  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_MULTILINE, 0);
552  					return TRUE;
553  				case IDC_CHECK_TAB_LAST_EXIT:
554  				{
555  					NppGUI &amp; nppGUI = nppParam.getNppGUI();
556  					nppGUI._tabStatus ^= TAB_QUITONEMPTY;
557  				}
558  				return TRUE;
559  				case IDC_CHECK_TAB_ALTICONS:
560  				{
561  					NppGUI&amp; nppGUI = nppParam.getNppGUI();
562  					nppGUI._tabStatus ^= TAB_ALTICONS;
563  					const bool isChecked = isCheckedOrNot(IDC_CHECK_TAB_ALTICONS);
564  					const bool isBtnCmd = true;
565  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CHANGETABBAEICONS, static_cast&lt;WPARAM&gt;(isBtnCmd), isChecked ? 1 : (nppGUI._darkmode._isEnabled ? 2 : 0));
566  					NppDarkMode::setTabIconSet(isChecked, NppDarkMode::isEnabled());
567  					return TRUE;
568  				}
569  				case IDC_CHECK_REDUCE :
570  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_REDUCETABBAR, 0);
571  					return TRUE;
572  				case IDC_CHECK_LOCK :
573  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LOCKTABBAR, 0);
574  					return TRUE;
575  				case IDC_CHECK_ORANGE :
576  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_TOPBAR, 0);
577  					return TRUE;
578  				case IDC_CHECK_DRAWINACTIVE :
579  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_INACIVETAB, 0);
580  					return TRUE;
581  				case IDC_CHECK_ENABLETABCLOSE :
582  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_CLOSEBOTTUN, 0);
583  					return TRUE;
584  				case IDC_CHECK_DBCLICK2CLOSE :
585  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_DBCLK2CLOSE, 0);
586  					return TRUE;
587  				case IDC_CHECK_HIDE :
588  				{
589  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDE, BM_GETCHECK, 0, 0));
590  					::SendMessage(::GetParent(_hParent), NPPM_HIDETOOLBAR, 0, isChecked?TRUE:FALSE);
591  				}
592  				return TRUE;
593  				case IDC_RADIO_SMALLICON :
594  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_REDUCE, 0);
595  					NppDarkMode::setToolBarIconSet(0, NppDarkMode::isEnabled());
596  					return TRUE;
597  				case IDC_RADIO_BIGICON :
598  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_ENLARGE, 0);
599  					NppDarkMode::setToolBarIconSet(1, NppDarkMode::isEnabled());
600  					return TRUE;
601  				case IDC_RADIO_SMALLICON2:
602  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_REDUCE_SET2, 0);
603  					NppDarkMode::setToolBarIconSet(2, NppDarkMode::isEnabled());
604  					return TRUE;
605  				case IDC_RADIO_BIGICON2:
606  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_ENLARGE_SET2, 0);
607  					NppDarkMode::setToolBarIconSet(3, NppDarkMode::isEnabled());
608  					return TRUE;
609  				case IDC_RADIO_STANDARD :
610  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_STANDARD, 0);
611  					NppDarkMode::setToolBarIconSet(4, NppDarkMode::isEnabled());
612  					return TRUE;
613  				default :
614  					switch (HIWORD(wParam))
615  					{
616  						case CBN_SELCHANGE : 
617  						{
618  							switch (LOWORD(wParam))
619  							{
620  								case IDC_COMBO_LOCALIZATION :
621  								{
622  									LocalizationSwitcher &amp; localizationSwitcher = nppParam.getLocalizationSwitcher();
623  									auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_GETCURSEL, 0, 0);
624  									TCHAR langName[MAX_PATH] = { &#x27;\0&#x27; };
625  									auto cbTextLen = ::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_GETLBTEXTLEN, index, 0);
626  									if (cbTextLen &gt; MAX_PATH - 1)
627  										return TRUE;
628  									::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_GETLBTEXT, index, reinterpret_cast&lt;LPARAM&gt;(langName));
629  									if (langName[0])
630  									{
631  										if (localizationSwitcher.switchToLang(TEXT(&quot;English&quot;)))
632  										{
633  											::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RELOADNATIVELANG, 0, 0);
634  										}
635  										if (localizationSwitcher.switchToLang(langName))
636  										{
637  											::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RELOADNATIVELANG, 0, 0);
638  											::InvalidateRect(_hParent, NULL, TRUE);
639  										}
640  									}
641  								}
642  								return TRUE;
643  								default:
644  									break;
645  							}
646  						}
647  					}
648  			}
649  		}
650  	}
651  	return FALSE;
652  }
653  void EditingSubDlg::initScintParam()
654  {
655  	NppParameters&amp; nppParam = NppParameters::getInstance();
656  	ScintillaViewParams &amp; svp = const_cast&lt;ScintillaViewParams &amp;&gt;(nppParam.getSVP());
657  	int id = 0;
658  	switch (svp._lineWrapMethod)
659  	{
660  		case LINEWRAP_ALIGNED:
661  			id = IDC_RADIO_LWALIGN;
662  			break;
663  		case LINEWRAP_INDENT:
664  			id = IDC_RADIO_LWINDENT;
665  			break;
666  		default : 
667  			id = IDC_RADIO_LWDEF;
668  	}
669  	::SendDlgItemMessage(_hSelf, id, BM_SETCHECK, TRUE, 0);
670  	::SendDlgItemMessage(_hSelf, IDC_CHECK_SMOOTHFONT, BM_SETCHECK, svp._doSmoothFont, 0);
671  	int lineHilite = 0;
672  	switch (svp._currentLineHiliteMode)
673  	{
674  		case LINEHILITE_NONE:
675  			lineHilite = IDC_RADIO_CLM_NONE;
676  			break;
677  		case LINEHILITE_FRAME:
678  			lineHilite = IDC_RADIO_CLM_FRAME;
679  			break;
680  		default : 
681  			lineHilite = IDC_RADIO_CLM_HILITE;
682  	}
683  	::SendDlgItemMessage(_hSelf, lineHilite, BM_SETCHECK, TRUE, 0);
684  	::EnableWindow(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), (svp._currentLineHiliteMode == LINEHILITE_FRAME));
685  	::SendDlgItemMessage(_hSelf, IDC_CHECK_VIRTUALSPACE, BM_SETCHECK, svp._virtualSpace, 0);
686  	::SendDlgItemMessage(_hSelf, IDC_CHECK_SCROLLBEYONDLASTLINE, BM_SETCHECK, svp._scrollBeyondLastLine, 0);
687  	::SendDlgItemMessage(_hSelf, IDC_CHECK_RIGHTCLICKKEEPSSELECTION, BM_SETCHECK, svp._rightClickKeepsSelection, 0);
688  	::SendDlgItemMessage(_hSelf, IDC_CHECK_DISABLEADVANCEDSCROLL, BM_SETCHECK, svp._disableAdvancedScrolling, 0);
689  }
690  void EditingSubDlg::changeLineHiliteMode(bool enableSlider)
691  {
692  	::EnableWindow(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), enableSlider);
693  	redrawDlgItem(IDC_CARETLINEFRAME_WIDTH_STATIC);
694  	redrawDlgItem(IDC_CARETLINEFRAME_WIDTH_DISPLAY);
695  	::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_CURLINE_HILITING, 0);
696  }
697  static WNDPROC oldFunclstToolbarProc = NULL;
698  static LRESULT CALLBACK editNumSpaceProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)
699  {
700  	switch (message)
701  	{
702  		case WM_CHAR:
703  		{
704  			if ((wParam != 8 &amp;&amp; wParam != 32 &amp;&amp; wParam &lt; 48) || wParam &gt; 57)
705  			{
706  				return TRUE;
707  			}
708  		}
709  	}
710  	return oldFunclstToolbarProc(hwnd, message, wParam, lParam);
711  }
712  intptr_t CALLBACK EditingSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
713  {
714  	NppParameters&amp; nppParam = NppParameters::getInstance();
715  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
716  	ScintillaViewParams&amp; svp = (ScintillaViewParams&amp;)nppParam.getSVP();
717  	switch (message)
718  	{
719  		case WM_INITDIALOG :
720  		{
721  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;0&quot;)));
722  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;1&quot;)));
723  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;2&quot;)));
724  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;3&quot;)));
725  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Block&quot;)));
726  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Block After&quot;)));
727  			::SendMessage(::GetDlgItem(_hSelf, IDC_WIDTH_COMBO), CB_SETCURSEL, nppGUI._caretWidth, 0);
728  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FOLDINGTOGGLE, BM_SETCHECK, nppGUI._enableFoldCmdToggable, 0);
729  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MULTISELECTION, BM_SETCHECK, nppGUI._enableMultiSelection, 0);
730  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER),TBM_SETRANGEMIN, TRUE, BLINKRATE_FASTEST);
731  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER),TBM_SETRANGEMAX, TRUE, BLINKRATE_SLOWEST);
732  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER),TBM_SETPAGESIZE, 0, BLINKRATE_INTERVAL);
733  			int blinkRate = (nppGUI._caretBlinkRate == 0) ? BLINKRATE_SLOWEST : nppGUI._caretBlinkRate;
734  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER),TBM_SETPOS, TRUE, blinkRate);
735  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), TBM_SETRANGEMIN, TRUE, CARETLINEFRAME_SMALLEST);
736  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), TBM_SETRANGEMAX, TRUE, CARETLINEFRAME_LARGEST);
737  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), TBM_SETPAGESIZE, 0, CARETLINEFRAME_INTERVAL);
738  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), TBM_SETPOS, TRUE, svp._currentLineFrameWidth);
739  			::SetDlgItemInt(_hSelf, IDC_CARETLINEFRAME_WIDTH_DISPLAY, svp._currentLineFrameWidth, FALSE);
740  			bool checkDefaultCRLF = true;
741  			bool checkPlainTextCRLF = false;
742  			bool checkWithColorCRLF = false;
743  			if (svp._eolMode == svp.plainText)
744  			{
745  				checkDefaultCRLF = false;
746  				checkPlainTextCRLF = true;
747  				checkWithColorCRLF = false;
748  			}
749  			else if (svp._eolMode == svp.plainTextCustomColor)
750  			{
751  				checkDefaultCRLF = false;
752  				checkPlainTextCRLF = true;
753  				checkWithColorCRLF = true;
754  			}
755  			else if (svp._eolMode == svp.roundedRectangleTextCustomColor)
756  			{
757  				checkDefaultCRLF = true;
758  				checkPlainTextCRLF = false;
759  				checkWithColorCRLF = true;
760  			}
761  			::SendDlgItemMessage(_hSelf, IDC_RADIO_ROUNDCORNER_CRLF, BM_SETCHECK, checkDefaultCRLF, 0);
762  			::SendDlgItemMessage(_hSelf, IDC_RADIO_PLEINTEXT_CRLF, BM_SETCHECK, checkPlainTextCRLF, 0);
763  			::SendDlgItemMessage(_hSelf, IDC_CHECK_WITHCUSTOMCOLOR_CRLF, BM_SETCHECK, checkWithColorCRLF, 0);
764  			NativeLangSpeaker* pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
765  			generic_string tip2show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;eol-custom-color-tip&quot;, TEXT(&quot;Go to Style Configurator to change the default EOL custom color (\&quot;EOL custom color\&quot;).&quot;));
766  			_tip = CreateToolTip(IDC_BUTTON_LAUNCHSTYLECONF_CRLF, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tip2show.c_str()), pNativeSpeaker-&gt;isRTL());
767  			const bool isNpcModeAbbrv = svp._npcMode == svp.abbreviation;
768  			setChecked(IDC_RADIO_NPC_ABBREVIATION, isNpcModeAbbrv);
769  			setChecked(IDC_RADIO_NPC_CODEPOINT, !isNpcModeAbbrv);
770  			setChecked(IDC_CHECK_NPC_COLOR, svp._npcCustomColor);
771  			setChecked(IDC_CHECK_NPC_INCLUDECCUNIEOL, svp._npcIncludeCcUniEol);
772  			generic_string tipNote2Show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcNote-tip&quot;,
773  				L&quot;Representation of selected \&quot;non-ASCII\&quot; whitespace and non-printing (control) characters.\n\n&quot;\
774  				L&quot;NOTE:\n&quot;\
775  				L&quot;Using representation will disable character effects on text.\n\n&quot;\
776  				L&quot;For the full list of selected whitespace and non-printing characters check User Manual.\n\n&quot;\
777  				L&quot;Click on this button to open website with User Manual.&quot;);
778  			generic_string tipAb2Show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcAbbreviation-tip&quot;,
779  				L&quot;Abbreviation : name\n&quot;\
780  				L&quot;NBSP : no-break space\n&quot;\
781  				L&quot;ZWSP : zero-width space\n&quot;\
782  				L&quot;ZWNBSP : zero-width no-break space\n\n&quot;\
783  				L&quot;For the full list check User Manual.\n&quot;\
784  				L&quot;Click on \&quot;?\&quot; button on right to open website with User Manual.&quot;);
785  			generic_string tipCp2Show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcCodepoint-tip&quot;,
786  				L&quot;Codepoint : name\n&quot;\
787  				L&quot;U+00A0 : no-break space\n&quot;\
788  				L&quot;U+200B : zero-width space\n&quot;\
789  				L&quot;U+FEFF : zero-width no-break space\n\n&quot;\
790  				L&quot;For the full list check User Manual.\n&quot;\
791  				L&quot;Click on \&quot;?\&quot; button on right to open website with User Manual.&quot;);
792  			generic_string tipNpcCol2show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcCustomColor-tip&quot;,
793  				L&quot;Go to Style Configurator to change the default custom color for selected whitespace and non-printing characters (\&quot;Non-printing characters custom color\&quot;).&quot;);
794  			generic_string tipNpcInc2show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcIncludeCcUniEol-tip&quot;,
795  				L&quot;Apply non-printing characters appearance settings to C0, C1 control and Unicode EOL (next line, line separator and paragraph separator) characters.&quot;);
796  			_tipNote = CreateToolTip(IDC_BUTTON_NPC_NOTE, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipNote2Show.c_str()), pNativeSpeaker-&gt;isRTL());
797  			_tipAbb = CreateToolTip(IDC_RADIO_NPC_ABBREVIATION, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipAb2Show.c_str()), pNativeSpeaker-&gt;isRTL());
798  			_tipCodepoint = CreateToolTip(IDC_RADIO_NPC_CODEPOINT, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipCp2Show.c_str()), pNativeSpeaker-&gt;isRTL());
799  			_tipNpcColor = CreateToolTip(IDC_BUTTON_NPC_LAUNCHSTYLECONF, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipNpcCol2show.c_str()), pNativeSpeaker-&gt;isRTL());
800  			_tipNpcInclude = CreateToolTip(IDC_CHECK_NPC_INCLUDECCUNIEOL, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipNpcInc2show.c_str()), pNativeSpeaker-&gt;isRTL());
801  			_tips.push_back(_tipNote);
802  			_tips.push_back(_tipAbb);
803  			_tips.push_back(_tipCodepoint);
804  			_tips.push_back(_tipNpcColor);
805  			_tips.push_back(_tipNpcInclude);
806  			for (auto&amp; tip : _tips)
807  			{
808  				if (tip != nullptr)
809  				{
810  					::SendMessage(tip, TTM_SETMAXTIPWIDTH, 0, 260);
811  				}
812  			}
813  			if (_tipNote != nullptr)
814  			{
815  				::SendMessage(_tipNote, TTM_SETDELAYTIME, TTDT_AUTOPOP, MAKELPARAM((30000), (0)));
816  			}
817  			initScintParam();
818  			return TRUE;
819  		}
820  		case WM_CTLCOLOREDIT:
821  		{
822  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
823  		}
824  		case WM_CTLCOLORLISTBOX:
825  		{
826  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
827  		}
828  		case WM_CTLCOLORDLG:
829  		{
830  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
831  		}
832  		case WM_CTLCOLORSTATIC:
833  		{
834  			int dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
835  			if (dlgCtrlID == IDC_CARETLINEFRAME_WIDTH_STATIC || dlgCtrlID == IDC_CARETLINEFRAME_WIDTH_DISPLAY)
836  			{
837  				return NppDarkMode::onCtlColorDarkerBGStaticText(reinterpret_cast&lt;HDC&gt;(wParam), (svp._currentLineHiliteMode == LINEHILITE_FRAME));
838  			}
839  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
840  		}
841  		case WM_PRINTCLIENT:
842  		{
843  			if (NppDarkMode::isEnabled())
844  			{
845  				return TRUE;
846  			}
847  			break;
848  		}
849  		case WM_HSCROLL:
850  		{
851  			HWND hCaretBlinkRateSlider = ::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER);
852  			HWND hCaretLineFrameSlider = ::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER);
853  			if (reinterpret_cast&lt;HWND&gt;(lParam) == hCaretBlinkRateSlider)
854  			{
855  				auto blinkRate = ::SendMessage(hCaretBlinkRateSlider, TBM_GETPOS, 0, 0);
856  				if (blinkRate == BLINKRATE_SLOWEST)
857  					blinkRate = 0;
858  				nppGUI._caretBlinkRate = static_cast&lt;int&gt;(blinkRate);
859  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETCARETBLINKRATE, 0, 0);
860  			}
861  			else if (reinterpret_cast&lt;HWND&gt;(lParam) == hCaretLineFrameSlider)
862  			{
863  				svp._currentLineFrameWidth = static_cast&lt;unsigned char&gt;(::SendMessage(hCaretLineFrameSlider, TBM_GETPOS, 0, 0));
864  				::SetDlgItemInt(_hSelf, IDC_CARETLINEFRAME_WIDTH_DISPLAY, svp._currentLineFrameWidth, FALSE);
865  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CARETLINEFRAME, 0, svp._currentLineFrameWidth);
866  			}
867  			return 0;	
868  		}
869  		case WM_COMMAND : 
870  		{
871  			ScintillaViewParams &amp; svp = const_cast&lt;ScintillaViewParams &amp;&gt;(nppParam.getSVP());
872  			switch (wParam)
873  			{
874  				case IDC_CHECK_SMOOTHFONT:
875  					svp._doSmoothFont = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_SMOOTHFONT, BM_GETCHECK, 0, 0));
876  					::SendMessage(::GetParent(_hParent), NPPM_SETSMOOTHFONT, 0, svp._doSmoothFont);
877  					return TRUE;
878  				case IDC_RADIO_CLM_NONE:
879  					svp._currentLineHiliteMode = LINEHILITE_NONE;
880  					changeLineHiliteMode(false);
881  					return TRUE;
882  				case IDC_RADIO_CLM_HILITE:
883  					svp._currentLineHiliteMode = LINEHILITE_HILITE;
884  					changeLineHiliteMode(false);
885  					return TRUE;
886  				case IDC_RADIO_CLM_FRAME:
887  					svp._currentLineHiliteMode = LINEHILITE_FRAME;
888  					changeLineHiliteMode(true);
889  					return TRUE;
890  				case IDC_RADIO_ROUNDCORNER_CRLF:
891  				case IDC_RADIO_PLEINTEXT_CRLF:
892  				case IDC_CHECK_WITHCUSTOMCOLOR_CRLF:
893  				{
894  					bool doCustomColor = isCheckedOrNot(IDC_CHECK_WITHCUSTOMCOLOR_CRLF);
895  					if (wParam == IDC_RADIO_ROUNDCORNER_CRLF)
896  					{
897  						svp._eolMode = doCustomColor ? svp.roundedRectangleTextCustomColor : svp.roundedRectangleText;
898  					}
899  					else if (wParam == IDC_RADIO_PLEINTEXT_CRLF)
900  					{
901  						svp._eolMode = doCustomColor ? svp.plainTextCustomColor : svp.plainText;
902  					}
903  					else 
904  					{
905  						if (isCheckedOrNot(IDC_RADIO_ROUNDCORNER_CRLF))
906  						{
907  							svp._eolMode = doCustomColor ? svp.roundedRectangleTextCustomColor : svp.roundedRectangleText;
908  						}
909  						else 
910  						{
911  							svp._eolMode = doCustomColor ? svp.plainTextCustomColor : svp.plainText;
912  						}
913  					}
914  					HWND grandParent = ::GetParent(_hParent);
915  					::SendMessage(grandParent, NPPM_INTERNAL_CRLFFORMCHANGED, 0, 0);
916  					return TRUE;
917  				}
918  				case IDC_BUTTON_LAUNCHSTYLECONF_CRLF:
919  				{
920  					HWND grandParent = ::GetParent(_hParent);
921  					::SendMessage(grandParent, NPPM_INTERNAL_CRLFLAUNCHSTYLECONF, 0, 0);
922  					return TRUE;
923  				}
924  				case IDC_RADIO_NPC_ABBREVIATION:
925  				case IDC_RADIO_NPC_CODEPOINT:
926  				{
927  					if (wParam == IDC_RADIO_NPC_CODEPOINT)
928  					{
929  						svp._npcMode = svp.codepoint;
930  					}
931  					else 
932  					{
933  						svp._npcMode = svp.abbreviation;
934  					}
935  					HWND grandParent = ::GetParent(_hParent);
936  					::SendMessage(grandParent, NPPM_INTERNAL_SETNPC, 0, 0);
937  					return TRUE;
938  				}
939  				case IDC_BUTTON_NPC_NOTE:
940  				{
941  					::ShellExecute(NULL, L&quot;open&quot;, L&quot;https:&amp;bsol;&amp;bsol;npp-user-manual.org/docs/views/#show-symbol&quot;, NULL, NULL, SW_SHOWNORMAL);
942  					return TRUE;
943  				}
944  				case IDC_CHECK_NPC_COLOR:
945  				{
946  					svp._npcCustomColor = isCheckedOrNot(IDC_CHECK_NPC_COLOR);
947  					HWND grandParent = ::GetParent(_hParent);
948  					::SendMessage(grandParent, NPPM_INTERNAL_NPCFORMCHANGED, 0, 0);
949  					return TRUE;
950  				}
951  				case IDC_BUTTON_NPC_LAUNCHSTYLECONF:
952  				{
953  					HWND grandParent = ::GetParent(_hParent);
954  					::SendMessage(grandParent, NPPM_INTERNAL_NPCLAUNCHSTYLECONF, 0, 0);
955  					return TRUE;
956  				}
957  				case IDC_CHECK_NPC_INCLUDECCUNIEOL:
958  				{
959  					svp._npcIncludeCcUniEol = isCheckedOrNot(IDC_CHECK_NPC_INCLUDECCUNIEOL);
960  					const HWND grandParent = ::GetParent(_hParent);
961  					::SendMessage(grandParent, NPPM_INTERNAL_SETNPC, IDC_CHECK_NPC_INCLUDECCUNIEOL, 0);
962  					return TRUE;
963  				}
964  				case IDC_CHECK_VIRTUALSPACE:
965  					svp._virtualSpace = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_VIRTUALSPACE, BM_GETCHECK, 0, 0));
966  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_VIRTUALSPACE, 0, 0);
967  					return TRUE;
968  				case IDC_CHECK_SCROLLBEYONDLASTLINE:
969  					svp._scrollBeyondLastLine = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_SCROLLBEYONDLASTLINE, BM_GETCHECK, 0, 0));
970  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SCROLLBEYONDLASTLINE, 0, 0);
971  					return TRUE;
972  				case IDC_CHECK_RIGHTCLICKKEEPSSELECTION:
973  					svp._rightClickKeepsSelection = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_RIGHTCLICKKEEPSSELECTION, BM_GETCHECK, 0, 0));
974  					return TRUE;
975  				case IDC_CHECK_DISABLEADVANCEDSCROLL:
976  					svp._disableAdvancedScrolling = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_DISABLEADVANCEDSCROLL, BM_GETCHECK, 0, 0));
977  					return TRUE;
978                  case IDC_CHECK_MULTISELECTION :
979                      nppGUI._enableMultiSelection = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_MULTISELECTION, BM_GETCHECK, 0, 0));
980                      ::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETMULTISELCTION, 0, 0);
981                      return TRUE;
982  				case IDC_CHECK_FOLDINGTOGGLE:
983  					nppGUI._enableFoldCmdToggable = isCheckedOrNot(IDC_CHECK_FOLDINGTOGGLE);
984  					return TRUE;
985  				case IDC_RADIO_LWDEF:
986  					svp._lineWrapMethod = LINEWRAP_DEFAULT;
987  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LWDEF, 0);
988  					return TRUE;
989  				case IDC_RADIO_LWALIGN:
990  					svp._lineWrapMethod = LINEWRAP_ALIGNED;
991  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LWALIGN, 0);
992  					return TRUE;
993  				case IDC_RADIO_LWINDENT:
994  					svp._lineWrapMethod = LINEWRAP_INDENT;
995  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LWINDENT, 0);
996  					return TRUE;
997  				default :
998  					switch (HIWORD(wParam))
999  					{
1000  						case CBN_SELCHANGE : 
1001  						{
1002  							if (LOWORD(wParam) == IDC_WIDTH_COMBO)
1003  							{
1004  								nppGUI._caretWidth = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_GETCURSEL, 0, 0));
1005  								::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETCARETWIDTH, 0, 0);
1006  								return TRUE;
1007  							}
1008  						}
1009  						break;
1010  					}
1011  			}
1012  		}
1013  	}
1014  	return FALSE;
1015  }
1016  void DarkModeSubDlg::enableCustomizedColorCtrls(bool doEnable)
1017  {
1018  	::EnableWindow(_pBackgroundColorPicker-&gt;getHSelf(), doEnable);
1019  	::EnableWindow(_pSofterBackgroundColorPicker-&gt;getHSelf(), doEnable);
1020  	::EnableWindow(_pHotBackgroundColorPicker-&gt;getHSelf(), doEnable);
1021  	::EnableWindow(_pPureBackgroundColorPicker-&gt;getHSelf(), doEnable);
1022  	::EnableWindow(_pErrorBackgroundColorPicker-&gt;getHSelf(), doEnable);
1023  	::EnableWindow(_pTextColorPicker-&gt;getHSelf(), doEnable);
1024  	::EnableWindow(_pDarkerTextColorPicker-&gt;getHSelf(), doEnable);
1025  	::EnableWindow(_pDisabledTextColorPicker-&gt;getHSelf(), doEnable);
1026  	::EnableWindow(_pEdgeColorPicker-&gt;getHSelf(), doEnable);
1027  	::EnableWindow(_pLinkColorPicker-&gt;getHSelf(), doEnable);
1028  	::EnableWindow(_pHotEdgeColorPicker-&gt;getHSelf(), doEnable);
1029  	::EnableWindow(_pDisabledEdgeColorPicker-&gt;getHSelf(), doEnable);
1030  	::EnableWindow(::GetDlgItem(_hSelf, IDD_CUSTOMIZED_RESET_BUTTON), doEnable);
1031  	if (doEnable)
1032  	{
1033  		_pBackgroundColorPicker-&gt;setColour(NppDarkMode::getBackgroundColor());
1034  		_pSofterBackgroundColorPicker-&gt;setColour(NppDarkMode::getSofterBackgroundColor());
1035  		_pHotBackgroundColorPicker-&gt;setColour(NppDarkMode::getHotBackgroundColor());
1036  		_pPureBackgroundColorPicker-&gt;setColour(NppDarkMode::getDarkerBackgroundColor());
1037  		_pErrorBackgroundColorPicker-&gt;setColour(NppDarkMode::getErrorBackgroundColor());
1038  		_pTextColorPicker-&gt;setColour(NppDarkMode::getTextColor());
1039  		_pDarkerTextColorPicker-&gt;setColour(NppDarkMode::getDarkerTextColor());
1040  		_pDisabledTextColorPicker-&gt;setColour(NppDarkMode::getDisabledTextColor());
1041  		_pEdgeColorPicker-&gt;setColour(NppDarkMode::getEdgeColor());
1042  		_pLinkColorPicker-&gt;setColour(NppDarkMode::getLinkTextColor());
1043  		_pHotEdgeColorPicker-&gt;setColour(NppDarkMode::getHotEdgeColor());
1044  		_pDisabledEdgeColorPicker-&gt;setColour(NppDarkMode::getDisabledEdgeColor());
1045  	}
1046  }
1047  void DarkModeSubDlg::move2CtrlLeft(int ctrlID, HWND handle2Move, int handle2MoveWidth, int handle2MoveHeight)
1048  {
1049  	POINT p{};
1050  	RECT rc{};
1051  	::GetWindowRect(::GetDlgItem(_hSelf, ctrlID), &amp;rc);
1052  	NppParameters&amp; nppParam = NppParameters::getInstance();
1053  	if(nppParam.getNativeLangSpeaker()-&gt;isRTL())
1054  		p.x = rc.right + nppParam._dpiManager.scaleX(5) + handle2MoveWidth;
1055  	else
1056  		p.x = rc.left - nppParam._dpiManager.scaleX(5) - handle2MoveWidth;
1057  	p.y = rc.top + ((rc.bottom - rc.top) / 2) - handle2MoveHeight / 2;
1058  	::ScreenToClient(_hSelf, &amp;p);
1059  	::MoveWindow(handle2Move, p.x, p.y, handle2MoveWidth, handle2MoveHeight, TRUE);
1060  }
1061  intptr_t CALLBACK DarkModeSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
1062  {
1063  	UNREFERENCED_PARAMETER(lParam);
1064  	NppParameters&amp; nppParam = NppParameters::getInstance();
1065  	NppGUI&amp; nppGUI = nppParam.getNppGUI();
1066  	switch (message)
1067  	{
1068  		case WM_INITDIALOG:
1069  		{
1070  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_FOLLOWWINDOWS), NppDarkMode::isWindows10());
1071  			const int topControlID = NppDarkMode::isWindowsModeEnabled() &amp;&amp; NppDarkMode::isWindows10() ? IDC_RADIO_DARKMODE_FOLLOWWINDOWS : NppDarkMode::isEnabled() ? IDC_RADIO_DARKMODE_DARKMODE : IDC_RADIO_DARKMODE_LIGHTMODE;
1072  			::SendDlgItemMessage(_hSelf, topControlID, BM_SETCHECK, BST_CHECKED, 0);
1073  			int id = IDC_RADIO_DARKMODE_BLACK;
1074  			switch (nppGUI._darkmode._colorTone)
1075  			{
1076  				case NppDarkMode::redTone:
1077  					id = IDC_RADIO_DARKMODE_RED;
1078  					break;
1079  				case NppDarkMode::greenTone:
1080  					id = IDC_RADIO_DARKMODE_GREEN;
1081  					break;
1082  				case NppDarkMode::blueTone:
1083  					id = IDC_RADIO_DARKMODE_BLUE;
1084  					break;
1085  				case NppDarkMode::purpleTone:
1086  					id = IDC_RADIO_DARKMODE_PURPLE;
1087  					break;
1088  				case NppDarkMode::cyanTone:
1089  					id = IDC_RADIO_DARKMODE_CYAN;
1090  					break;
1091  				case NppDarkMode::oliveTone:
1092  					id = IDC_RADIO_DARKMODE_OLIVE;
1093  					break;
1094  				case NppDarkMode::customizedTone:
1095  					id = IDC_RADIO_DARKMODE_CUSTOMIZED;
1096  					break;
1097  				case NppDarkMode::blackTone:
1098  				default:
1099  					break;
1100  			}
1101  			::SendDlgItemMessage(_hSelf, id, BM_SETCHECK, TRUE, 0);
1102  			_pBackgroundColorPicker = new ColourPicker;
1103  			_pSofterBackgroundColorPicker = new ColourPicker;
1104  			_pHotBackgroundColorPicker = new ColourPicker;
1105  			_pPureBackgroundColorPicker = new ColourPicker;
1106  			_pErrorBackgroundColorPicker = new ColourPicker;
1107  			_pTextColorPicker = new ColourPicker;
1108  			_pDarkerTextColorPicker = new ColourPicker;
1109  			_pDisabledTextColorPicker = new ColourPicker;
1110  			_pEdgeColorPicker = new ColourPicker;
1111  			_pLinkColorPicker = new ColourPicker;
1112  			_pHotEdgeColorPicker = new ColourPicker;
1113  			_pDisabledEdgeColorPicker = new ColourPicker;
1114  			_pBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1115  			_pSofterBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1116  			_pHotBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1117  			_pPureBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1118  			_pErrorBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1119  			_pTextColorPicker-&gt;init(_hInst, _hSelf);
1120  			_pDarkerTextColorPicker-&gt;init(_hInst, _hSelf);
1121  			_pDisabledTextColorPicker-&gt;init(_hInst, _hSelf);
1122  			_pEdgeColorPicker-&gt;init(_hInst, _hSelf);
1123  			_pLinkColorPicker-&gt;init(_hInst, _hSelf);
1124  			_pHotEdgeColorPicker-&gt;init(_hInst, _hSelf);
1125  			_pDisabledEdgeColorPicker-&gt;init(_hInst, _hSelf);
1126  			int cpDynamicalWidth = NppParameters::getInstance()._dpiManager.scaleX(25);
1127  			int cpDynamicalHeight = NppParameters::getInstance()._dpiManager.scaleY(25);
1128  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR1_STATIC, _pPureBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1129  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR2_STATIC, _pHotBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1130  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR3_STATIC, _pSofterBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1131  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR4_STATIC, _pBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1132  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR5_STATIC, _pErrorBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1133  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR6_STATIC, _pTextColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1134  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR7_STATIC, _pDarkerTextColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1135  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR8_STATIC, _pDisabledTextColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1136  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR9_STATIC, _pEdgeColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1137  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR10_STATIC, _pLinkColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1138  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR11_STATIC, _pHotEdgeColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1139  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR12_STATIC, _pDisabledEdgeColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1140  			_pBackgroundColorPicker-&gt;display();
1141  			_pSofterBackgroundColorPicker-&gt;display();
1142  			_pHotBackgroundColorPicker-&gt;display();
1143  			_pPureBackgroundColorPicker-&gt;display();
1144  			_pErrorBackgroundColorPicker-&gt;display();
1145  			_pTextColorPicker-&gt;display();
1146  			_pDarkerTextColorPicker-&gt;display();
1147  			_pDisabledTextColorPicker-&gt;display();
1148  			_pEdgeColorPicker-&gt;display();
1149  			_pLinkColorPicker-&gt;display();
1150  			_pHotEdgeColorPicker-&gt;display();
1151  			_pDisabledEdgeColorPicker-&gt;display();
1152  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_BLACK), nppGUI._darkmode._isEnabled);
1153  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_RED), nppGUI._darkmode._isEnabled);
1154  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_GREEN), nppGUI._darkmode._isEnabled);
1155  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_BLUE), nppGUI._darkmode._isEnabled);
1156  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_PURPLE), nppGUI._darkmode._isEnabled);
1157  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_CYAN), nppGUI._darkmode._isEnabled);
1158  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_OLIVE), nppGUI._darkmode._isEnabled);
1159  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_CUSTOMIZED), nppGUI._darkmode._isEnabled);
1160  			enableCustomizedColorCtrls(nppGUI._darkmode._isEnabled &amp;&amp; id == IDC_RADIO_DARKMODE_CUSTOMIZED);
1161  			return TRUE;
1162  		}
1163  		case WM_CTLCOLORDLG:
1164  		{
1165  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1166  		}
1167  		case WM_CTLCOLORSTATIC:
1168  		{
1169  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
1170  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
1171  			bool isStaticText = (dlgCtrlID == IDD_CUSTOMIZED_COLOR1_STATIC ||
1172  				dlgCtrlID == IDD_CUSTOMIZED_COLOR2_STATIC ||
1173  				dlgCtrlID == IDD_CUSTOMIZED_COLOR3_STATIC ||
1174  				dlgCtrlID == IDD_CUSTOMIZED_COLOR4_STATIC ||
1175  				dlgCtrlID == IDD_CUSTOMIZED_COLOR5_STATIC ||
1176  				dlgCtrlID == IDD_CUSTOMIZED_COLOR6_STATIC ||
1177  				dlgCtrlID == IDD_CUSTOMIZED_COLOR7_STATIC ||
1178  				dlgCtrlID == IDD_CUSTOMIZED_COLOR8_STATIC ||
1179  				dlgCtrlID == IDD_CUSTOMIZED_COLOR9_STATIC ||
1180  				dlgCtrlID == IDD_CUSTOMIZED_COLOR10_STATIC ||
1181  				dlgCtrlID == IDD_CUSTOMIZED_COLOR11_STATIC ||
1182  				dlgCtrlID == IDD_CUSTOMIZED_COLOR12_STATIC);
1183  			if (isStaticText)
1184  			{
1185  				bool isTextEnabled = nppGUI._darkmode._isEnabled &amp;&amp; nppGUI._darkmode._colorTone == NppDarkMode::customizedTone;
1186  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
1187  			}
1188  			return NppDarkMode::onCtlColorDarker(hdcStatic);
1189  		}
1190  		case WM_PRINTCLIENT:
1191  		{
1192  			if (NppDarkMode::isEnabled())
1193  			{
1194  				return TRUE;
1195  			}
1196  			break;
1197  		}
1198  		case WM_DESTROY:
1199  		{
1200  			_pBackgroundColorPicker-&gt;destroy();
1201  			_pSofterBackgroundColorPicker-&gt;destroy();
1202  			_pHotBackgroundColorPicker-&gt;destroy();
1203  			_pPureBackgroundColorPicker-&gt;destroy();
1204  			_pErrorBackgroundColorPicker-&gt;destroy();
1205  			_pTextColorPicker-&gt;destroy();
1206  			_pDarkerTextColorPicker-&gt;destroy();
1207  			_pDisabledTextColorPicker-&gt;destroy();
1208  			_pEdgeColorPicker-&gt;destroy();
1209  			_pLinkColorPicker-&gt;destroy();
1210  			_pHotEdgeColorPicker-&gt;destroy();
1211  			_pDisabledEdgeColorPicker-&gt;destroy();
1212  			delete _pBackgroundColorPicker;
1213  			delete _pSofterBackgroundColorPicker;
1214  			delete _pHotBackgroundColorPicker;
1215  			delete _pPureBackgroundColorPicker;
1216  			delete _pErrorBackgroundColorPicker;
1217  			delete _pTextColorPicker;
1218  			delete _pDarkerTextColorPicker;
1219  			delete _pDisabledTextColorPicker;
1220  			delete _pEdgeColorPicker;
1221  			delete _pLinkColorPicker;
1222  			delete _pHotEdgeColorPicker;
1223  			delete _pDisabledEdgeColorPicker;
1224  			return TRUE;
1225  		}
1226  		case WM_COMMAND:
1227  		{
1228  			bool changed = false;
1229  			bool forceRefresh = false;
1230  			bool doEnableCustomizedColorCtrls = false;
1231  			switch (wParam)
1232  			{
1233  				case IDC_RADIO_DARKMODE_FOLLOWWINDOWS:
1234  				{
1235  					NppDarkMode::handleSettingChange(nullptr, 0, true);
1236  				}
1237  				[[fallthrough]];
1238  				case IDC_RADIO_DARKMODE_LIGHTMODE:
1239  				case IDC_RADIO_DARKMODE_DARKMODE:
1240  				{
1241  					const bool isFollowWindows = isCheckedOrNot(IDC_RADIO_DARKMODE_FOLLOWWINDOWS);
1242  					NppDarkMode::setWindowsMode(isFollowWindows);
1243  					const bool enableDarkMode = isCheckedOrNot(IDC_RADIO_DARKMODE_DARKMODE) || (isFollowWindows &amp;&amp; NppDarkMode::isExperimentalActive());
1244  					nppGUI._darkmode._isEnabled = enableDarkMode;
1245  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_BLACK), enableDarkMode);
1246  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_RED), enableDarkMode);
1247  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_GREEN), enableDarkMode);
1248  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_BLUE), enableDarkMode);
1249  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_PURPLE), enableDarkMode);
1250  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_CYAN), enableDarkMode);
1251  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_OLIVE), enableDarkMode);
1252  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_CUSTOMIZED), enableDarkMode);
1253  					doEnableCustomizedColorCtrls = enableDarkMode &amp;&amp; nppGUI._darkmode._colorTone == NppDarkMode::customizedTone;
1254  					enableCustomizedColorCtrls(doEnableCustomizedColorCtrls);
1255  					::SendMessage(_hParent, PREF_MSG_SETGUITOOLICONSSET, static_cast&lt;WPARAM&gt;(enableDarkMode), 0);
1256  					::SendMessage(_hParent, PREF_MSG_SETGUITABBARICONS, static_cast&lt;WPARAM&gt;(enableDarkMode), 0);
1257  					changed = true;
1258  				}
1259  				break;
1260  				case IDC_RADIO_DARKMODE_BLACK:
1261  				case IDC_RADIO_DARKMODE_RED:
1262  				case IDC_RADIO_DARKMODE_GREEN:
1263  				case IDC_RADIO_DARKMODE_BLUE:
1264  				case IDC_RADIO_DARKMODE_PURPLE:
1265  				case IDC_RADIO_DARKMODE_CYAN:
1266  				case IDC_RADIO_DARKMODE_OLIVE:
1267  				case IDC_RADIO_DARKMODE_CUSTOMIZED:
1268  				case IDD_CUSTOMIZED_RESET_BUTTON:
1269  				{
1270  					if (wParam == IDC_RADIO_DARKMODE_BLACK)
1271  					{
1272  						if (nppGUI._darkmode._colorTone == NppDarkMode::blackTone)
1273  							return TRUE;
1274  						nppGUI._darkmode._colorTone = NppDarkMode::blackTone;
1275  					}
1276  					else if (wParam == IDC_RADIO_DARKMODE_RED)
1277  					{
1278  						if (nppGUI._darkmode._colorTone == NppDarkMode::redTone)
1279  							return TRUE;
1280  						nppGUI._darkmode._colorTone = NppDarkMode::redTone;
1281  					}
1282  					else if (wParam == IDC_RADIO_DARKMODE_GREEN)
1283  					{
1284  						if (nppGUI._darkmode._colorTone == NppDarkMode::greenTone)
1285  							return TRUE;
1286  						nppGUI._darkmode._colorTone = NppDarkMode::greenTone;
1287  					}
1288  					else if (wParam == IDC_RADIO_DARKMODE_BLUE)
1289  					{
1290  						if (nppGUI._darkmode._colorTone == NppDarkMode::blueTone)
1291  							return TRUE;
1292  						nppGUI._darkmode._colorTone = NppDarkMode::blueTone;
1293  					}
1294  					else if (wParam == IDC_RADIO_DARKMODE_PURPLE)
1295  					{
1296  						if (nppGUI._darkmode._colorTone == NppDarkMode::purpleTone)
1297  							return TRUE;
1298  						nppGUI._darkmode._colorTone = NppDarkMode::purpleTone;
1299  					}
1300  					else if (wParam == IDC_RADIO_DARKMODE_CYAN)
1301  					{
1302  						if (nppGUI._darkmode._colorTone == NppDarkMode::cyanTone)
1303  							return TRUE;
1304  						nppGUI._darkmode._colorTone = NppDarkMode::cyanTone;
1305  					}
1306  					else if (wParam == IDC_RADIO_DARKMODE_OLIVE)
1307  					{
1308  						if (nppGUI._darkmode._colorTone == NppDarkMode::oliveTone)
1309  							return TRUE;
1310  						nppGUI._darkmode._colorTone = NppDarkMode::oliveTone;
1311  					}
1312  					else if (wParam == IDC_RADIO_DARKMODE_CUSTOMIZED)
1313  					{
1314  						if (nppGUI._darkmode._colorTone == NppDarkMode::customizedTone)
1315  							return TRUE;
1316  						nppGUI._darkmode._colorTone = NppDarkMode::customizedTone;
1317  						doEnableCustomizedColorCtrls = true;
1318  					}
1319  					else if (wParam == IDD_CUSTOMIZED_RESET_BUTTON)
1320  					{
1321  						nppGUI._darkmode._customColors = NppDarkMode::getDarkModeDefaultColors();
1322  						NppDarkMode::changeCustomTheme(nppGUI._darkmode._customColors);
1323  						doEnableCustomizedColorCtrls = true;
1324  					}
1325  					nppGUI._darkmode._isEnabled = true;
1326  					NppDarkMode::setDarkTone(nppGUI._darkmode._colorTone);
1327  					changed = true;
1328  					forceRefresh = true;
1329  					enableCustomizedColorCtrls(doEnableCustomizedColorCtrls);
1330  				}
1331  				break;
1332  				default:
1333  					switch (HIWORD(wParam))
1334  					{
1335  						case CPN_COLOURPICKED:
1336  						{
1337  							COLORREF c = 0;
1338  							if (reinterpret_cast&lt;HWND&gt;(lParam) == _pBackgroundColorPicker-&gt;getHSelf())
1339  							{
1340  								c = _pBackgroundColorPicker-&gt;getColour();
1341  								NppDarkMode::setBackgroundColor(c);
1342  								nppGUI._darkmode._customColors.background = c;
1343  							}
1344  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pSofterBackgroundColorPicker-&gt;getHSelf())
1345  							{
1346  								c = _pSofterBackgroundColorPicker-&gt;getColour();
1347  								NppDarkMode::setSofterBackgroundColor(c);
1348  								nppGUI._darkmode._customColors.softerBackground = c;
1349  							}
1350  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pHotBackgroundColorPicker-&gt;getHSelf())
1351  							{
1352  								c = _pHotBackgroundColorPicker-&gt;getColour();
1353  								NppDarkMode::setHotBackgroundColor(c);
1354  								nppGUI._darkmode._customColors.hotBackground = c;
1355  							}
1356  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pPureBackgroundColorPicker-&gt;getHSelf())
1357  							{
1358  								c = _pPureBackgroundColorPicker-&gt;getColour();
1359  								NppDarkMode::setDarkerBackgroundColor(c);
1360  								nppGUI._darkmode._customColors.pureBackground = c;
1361  							}
1362  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pErrorBackgroundColorPicker-&gt;getHSelf())
1363  							{
1364  								c = _pErrorBackgroundColorPicker-&gt;getColour();
1365  								NppDarkMode::setErrorBackgroundColor(c);
1366  								nppGUI._darkmode._customColors.errorBackground = c;
1367  							}
1368  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pTextColorPicker-&gt;getHSelf())
1369  							{
1370  								c = _pTextColorPicker-&gt;getColour();
1371  								NppDarkMode::setTextColor(c);
1372  								nppGUI._darkmode._customColors.text = c;
1373  							}
1374  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pDarkerTextColorPicker-&gt;getHSelf())
1375  							{
1376  								c = _pDarkerTextColorPicker-&gt;getColour();
1377  								NppDarkMode::setDarkerTextColor(c);
1378  								nppGUI._darkmode._customColors.darkerText = c;
1379  							}
1380  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pDisabledTextColorPicker-&gt;getHSelf())
1381  							{
1382  								c = _pDisabledTextColorPicker-&gt;getColour();
1383  								NppDarkMode::setDisabledTextColor(c);
1384  								nppGUI._darkmode._customColors.disabledText = c;
1385  							}
1386  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pEdgeColorPicker-&gt;getHSelf())
1387  							{
1388  								c = _pEdgeColorPicker-&gt;getColour();
1389  								NppDarkMode::setEdgeColor(c);
1390  								nppGUI._darkmode._customColors.edge = c;
1391  							}
1392  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pLinkColorPicker-&gt;getHSelf())
1393  							{
1394  								c = _pLinkColorPicker-&gt;getColour();
1395  								NppDarkMode::setLinkTextColor(c);
1396  								nppGUI._darkmode._customColors.linkText = c;
1397  							}
1398  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pHotEdgeColorPicker-&gt;getHSelf())
1399  							{
1400  								c = _pHotEdgeColorPicker-&gt;getColour();
1401  								NppDarkMode::setHotEdgeColor(c);
1402  								nppGUI._darkmode._customColors.hotEdge = c;
1403  							}
1404  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pDisabledEdgeColorPicker-&gt;getHSelf())
1405  							{
1406  								c = _pDisabledEdgeColorPicker-&gt;getColour();
1407  								NppDarkMode::setDisabledEdgeColor(c);
1408  								nppGUI._darkmode._customColors.disabledEdge = c;
1409  							}
1410  							else
1411  							{
1412  								return FALSE;
1413  							}
1414  							nppGUI._darkmode._isEnabled = true;
1415  							NppDarkMode::setDarkTone(nppGUI._darkmode._colorTone);
1416  							changed = true;
1417  							forceRefresh = true;
1418  							doEnableCustomizedColorCtrls = true;
1419  						}
1420  						break;
1421  						default:
1422  						{
1423  							return FALSE;
1424  						}
1425  					}
1426  			}
1427  			if (changed)
1428  			{
1429  				if (!doEnableCustomizedColorCtrls)
1430  				{
1431  					COLORREF disabledColor = nppGUI._darkmode._isEnabled ? NppDarkMode::getDarkerBackgroundColor() : ::GetSysColor(COLOR_3DFACE);
1432  					_pBackgroundColorPicker-&gt;setColour(disabledColor);
1433  					_pSofterBackgroundColorPicker-&gt;setColour(disabledColor);
1434  					_pHotBackgroundColorPicker-&gt;setColour(disabledColor);
1435  					_pPureBackgroundColorPicker-&gt;setColour(disabledColor);
1436  					_pErrorBackgroundColorPicker-&gt;setColour(disabledColor);
1437  					_pTextColorPicker-&gt;setColour(disabledColor);
1438  					_pDarkerTextColorPicker-&gt;setColour(disabledColor);
1439  					_pDisabledTextColorPicker-&gt;setColour(disabledColor);
1440  					_pEdgeColorPicker-&gt;setColour(disabledColor);
1441  					_pLinkColorPicker-&gt;setColour(disabledColor);
1442  					_pHotEdgeColorPicker-&gt;setColour(disabledColor);
1443  					_pDisabledEdgeColorPicker-&gt;setColour(disabledColor);
1444  				}
1445  				NppDarkMode::refreshDarkMode(_hSelf, forceRefresh);
1446  				getFocus(); 
1447  				return TRUE;
1448  			}
1449  			return FALSE;
1450  		}
1451  	}
1452  	return FALSE;
1453  }
1454  void MarginsBorderEdgeSubDlg::initScintParam()
1455  {
1456  	NppParameters&amp; nppParam = NppParameters::getInstance();
1457  	ScintillaViewParams &amp; svp = const_cast&lt;ScintillaViewParams &amp;&gt;(nppParam.getSVP());
1458  	::SendDlgItemMessage(_hSelf, IDC_RADIO_BOX, BM_SETCHECK, FALSE, 0);
1459  	::SendDlgItemMessage(_hSelf, IDC_RADIO_CIRCLE, BM_SETCHECK, FALSE, 0);
1460  	::SendDlgItemMessage(_hSelf, IDC_RADIO_ARROW, BM_SETCHECK, FALSE, 0);
1461  	::SendDlgItemMessage(_hSelf, IDC_RADIO_SIMPLE, BM_SETCHECK, FALSE, 0);
1462  	::SendDlgItemMessage(_hSelf, IDC_RADIO_FOLDMARGENONE, BM_SETCHECK, FALSE, 0);
1463  	int id = 0;
1464  	switch (svp._folderStyle)
1465  	{
1466  		case FOLDER_STYLE_NONE:
1467  			id = IDC_RADIO_FOLDMARGENONE;
1468  			break;
1469  		case FOLDER_STYLE_BOX:
1470  			id = IDC_RADIO_BOX;
1471  			break;
1472  		case FOLDER_STYLE_CIRCLE:
1473  			id = IDC_RADIO_CIRCLE;
1474  			break;
1475  		case FOLDER_STYLE_ARROW:
1476  			id = IDC_RADIO_ARROW;
1477  			break;
1478  		default : 
1479  			id = IDC_RADIO_SIMPLE;
1480  	}
1481  	::SendDlgItemMessage(_hSelf, id, BM_SETCHECK, TRUE, 0);
1482  	::SendDlgItemMessage(_hSelf, IDC_CHECK_LINENUMBERMARGE, BM_SETCHECK, svp._lineNumberMarginShow, 0);
1483  	::SendDlgItemMessage(_hSelf, IDC_RADIO_DYNAMIC, BM_SETCHECK, svp._lineNumberMarginDynamicWidth, 0);
1484  	::SendDlgItemMessage(_hSelf, IDC_RADIO_CONSTANT, BM_SETCHECK, !svp._lineNumberMarginDynamicWidth, 0);
1485  	::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DYNAMIC), svp._lineNumberMarginShow);
1486  	::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_CONSTANT), svp._lineNumberMarginShow);
1487  	::SendDlgItemMessage(_hSelf, IDC_CHECK_BOOKMARKMARGE, BM_SETCHECK, svp._bookMarkMarginShow, 0);
1488  	::SendDlgItemMessage(_hSelf, IDC_CHECK_CHANGHISTORYMARGE, BM_SETCHECK, svp._isChangeHistoryEnabled, 0);
1489  	::SendDlgItemMessage(_hSelf, IDC_CHECK_NOEDGE, BM_SETCHECK, !svp._showBorderEdge, 0);
1490  	bool canBeBg = svp._edgeMultiColumnPos.size() == 1;
1491  	if (!canBeBg)
1492  	{
1493  		svp._isEdgeBgMode = false;
1494  		::SendDlgItemMessage(_hSelf, IDC_CHECK_EDGEBGMODE, BM_SETCHECK, FALSE, 0);
1495  		::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_EDGEBGMODE), FALSE);
1496  	}
1497  	else
1498  	{
1499  		::SendDlgItemMessage(_hSelf, IDC_CHECK_EDGEBGMODE, BM_SETCHECK, svp._isEdgeBgMode, 0);
1500  	}
1501  	generic_string edgeColumnPosStr;
1502  	for (auto i : svp._edgeMultiColumnPos)
1503  	{
1504  		std::string s = std::to_string(i);
1505  		edgeColumnPosStr += generic_string(s.begin(), s.end());
1506  		edgeColumnPosStr += TEXT(&quot; &quot;);
1507  	}
1508  	::SendDlgItemMessage(_hSelf, IDC_COLUMNPOS_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(edgeColumnPosStr.c_str()));
1509  	oldFunclstToolbarProc = reinterpret_cast&lt;WNDPROC&gt;(::SetWindowLongPtr(::GetDlgItem(_hSelf, IDC_COLUMNPOS_EDIT), GWLP_WNDPROC, reinterpret_cast&lt;LONG_PTR&gt;(editNumSpaceProc)));
1510  }
1511  intptr_t CALLBACK MarginsBorderEdgeSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
1512  {
1513  	NppParameters&amp; nppParam = NppParameters::getInstance();
1514  	switch (message) 
1515  	{
1516  		case WM_INITDIALOG :
1517  		{
1518  			const ScintillaViewParams &amp; svp = nppParam.getSVP();
1519  			::SendMessage(::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER),TBM_SETRANGEMIN, TRUE, BORDERWIDTH_SMALLEST);
1520  			::SendMessage(::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER),TBM_SETRANGEMAX, TRUE, BORDERWIDTH_LARGEST);
1521  			::SendMessage(::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER),TBM_SETPAGESIZE, 0, BORDERWIDTH_INTERVAL);
1522  			::SendMessage(::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER),TBM_SETPOS, TRUE, svp._borderWidth);
1523  			::SetDlgItemInt(_hSelf, IDC_BORDERWIDTHVAL_STATIC, svp._borderWidth, FALSE);
1524  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER), TBM_SETRANGEMIN, TRUE, PADDING_SMALLEST);
1525  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER), TBM_SETRANGEMAX, TRUE, PADDING_LARGEST);
1526  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER), TBM_SETPAGESIZE, 0, PADDING_INTERVAL);
1527  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER), TBM_SETPOS, TRUE, svp._paddingLeft);
1528  			::SetDlgItemInt(_hSelf, IDC_PADDINGLEFTVAL_STATIC, svp._paddingLeft, FALSE);
1529  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER), TBM_SETRANGEMIN, TRUE, PADDING_SMALLEST);
1530  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER), TBM_SETRANGEMAX, TRUE, PADDING_LARGEST);
1531  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER), TBM_SETPAGESIZE, 0, PADDING_INTERVAL);
1532  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER), TBM_SETPOS, TRUE, svp._paddingRight);
1533  			::SetDlgItemInt(_hSelf, IDC_PADDINGRIGHTVAL_STATIC, svp._paddingRight, FALSE);
1534  			::SendMessage(::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER), TBM_SETRANGEMIN, TRUE, DISTRACTIONFREE_SMALLEST);
1535  			::SendMessage(::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER), TBM_SETRANGEMAX, TRUE, DISTRACTIONFREE_LARGEST);
1536  			::SendMessage(::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER), TBM_SETPAGESIZE, 0, DISTRACTIONFREE_INTERVAL);
1537  			::SendMessage(::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER), TBM_SETPOS, TRUE, svp._distractionFreeDivPart);
1538  			::SetDlgItemInt(_hSelf, IDC_DISTRACTIONFREEVAL_STATIC, svp._distractionFreeDivPart, FALSE);
1539  			initScintParam();
1540  			return TRUE;
1541  		}
1542  		case WM_CTLCOLOREDIT:
1543  		{
1544  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
1545  		}
1546  		case WM_CTLCOLORDLG:
1547  		case WM_CTLCOLORSTATIC:
1548  		{
1549  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1550  		}
1551  		case WM_PRINTCLIENT:
1552  		{
1553  			if (NppDarkMode::isEnabled())
1554  			{
1555  				return TRUE;
1556  			}
1557  			break;
1558  		}
1559  		case WM_HSCROLL:
1560  		{
1561  			ScintillaViewParams &amp; svp = (ScintillaViewParams &amp;)nppParam.getSVP();
1562  			HWND hBorderWidthSlider = ::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER);
1563  			HWND hPaddingLeftSlider = ::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER);
1564  			HWND hPaddingRightSlider = ::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER);
1565  			HWND hDistractionFreeSlider = ::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER);
1566  			if (reinterpret_cast&lt;HWND&gt;(lParam) == hBorderWidthSlider)
1567  			{
1568  				auto borderWidth = ::SendMessage(hBorderWidthSlider, TBM_GETPOS, 0, 0);
1569  				svp._borderWidth = static_cast&lt;int&gt;(borderWidth);
1570  				::SetDlgItemInt(_hSelf, IDC_BORDERWIDTHVAL_STATIC, static_cast&lt;UINT&gt;(borderWidth), FALSE);
1571  				::SendMessage(::GetParent(_hParent), WM_SIZE, 0, 0);
1572  			}
1573  			else if (reinterpret_cast&lt;HWND&gt;(lParam) == hPaddingLeftSlider)
1574  			{
1575  				svp._paddingLeft = static_cast&lt;unsigned char&gt;(::SendMessage(hPaddingLeftSlider, TBM_GETPOS, 0, 0));
1576  				::SetDlgItemInt(_hSelf, IDC_PADDINGLEFTVAL_STATIC, static_cast&lt;UINT&gt;(svp._paddingLeft), FALSE);
1577  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATETEXTZONEPADDING, 0, 0);
1578  			}
1579  			else if (reinterpret_cast&lt;HWND&gt;(lParam) == hPaddingRightSlider)
1580  			{
1581  				svp._paddingRight = static_cast&lt;unsigned char&gt;(::SendMessage(hPaddingRightSlider, TBM_GETPOS, 0, 0));
1582  				::SetDlgItemInt(_hSelf, IDC_PADDINGRIGHTVAL_STATIC, static_cast&lt;UINT&gt;(svp._paddingRight), FALSE);
1583  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATETEXTZONEPADDING, 0, 0);
1584  			}
1585  			else if (reinterpret_cast&lt;HWND&gt;(lParam) == hDistractionFreeSlider)
1586  			{
1587  				svp._distractionFreeDivPart = static_cast&lt;unsigned char&gt;(::SendMessage(hDistractionFreeSlider, TBM_GETPOS, 0, 0));
1588  				::SetDlgItemInt(_hSelf, IDC_DISTRACTIONFREEVAL_STATIC, static_cast&lt;UINT&gt;(svp._distractionFreeDivPart), FALSE);
1589  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATETEXTZONEPADDING, 0, 0);
1590  			}
1591  			return 0;	
1592  		}
1593  		case WM_COMMAND : 
1594  		{
1595  			ScintillaViewParams &amp; svp = const_cast&lt;ScintillaViewParams &amp;&gt;(nppParam.getSVP());
1596  			switch (wParam)
1597  			{
1598  				case IDC_CHECK_LINENUMBERMARGE:
1599  					svp._lineNumberMarginShow = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_LINENUMBERMARGE, BM_GETCHECK, 0, 0));
1600  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DYNAMIC), svp._lineNumberMarginShow);
1601  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_CONSTANT), svp._lineNumberMarginShow);
1602  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LINENUMBER, 0);
1603  					return TRUE;
1604  				case IDC_RADIO_DYNAMIC:
1605  					svp._lineNumberMarginDynamicWidth = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_RADIO_DYNAMIC, BM_GETCHECK, 0, 0));
1606  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LINENUMBER, 0);
1607  					return TRUE;
1608  				case IDC_RADIO_CONSTANT:
1609  					svp._lineNumberMarginDynamicWidth = !(BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_RADIO_CONSTANT, BM_GETCHECK, 0, 0));
1610  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LINENUMBER, 0);
1611  					return TRUE;
1612  				case IDC_CHECK_BOOKMARKMARGE:
1613  					svp._bookMarkMarginShow = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_BOOKMARKMARGE, BM_GETCHECK, 0, 0));
1614  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_SYMBOLMARGIN, 0);
1615  					return TRUE;
1616  				case IDC_CHECK_CHANGHISTORYMARGE:
1617  				{
1618  					bool isChangeHistoryEnabled = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_CHANGHISTORYMARGE, BM_GETCHECK, 0, 0));
1619  					if (isChangeHistoryEnabled)
1620  					{
1621  						NativeLangSpeaker* pNativeSpeaker = nppParam.getNativeLangSpeaker();
1622  						pNativeSpeaker-&gt;messageBox(&quot;ChangeHistoryEnabledWarning&quot;,
1623  							_hSelf,
1624  							TEXT(&quot;You have to restart Notepad++ to enable Change History.&quot;),
1625  							TEXT(&quot;Notepad++ need to be relaunched&quot;),
1626  							MB_OK | MB_APPLMODAL);
1627  						svp._isChangeHistoryEnabled4NextSession = true;
1628  					}
1629  					else
1630  					{
1631  						svp._isChangeHistoryEnabled = false;
1632  						svp._isChangeHistoryEnabled4NextSession = false;
1633  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_ENABLECHANGEHISTORY, 0, 0);
1634  					}
1635  					return TRUE;
1636  				}
1637  				case IDC_CHECK_NOEDGE:
1638  					svp._showBorderEdge = !(BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_NOEDGE, BM_GETCHECK, 0, 0));
1639  					::SendMessage(::GetParent(_hParent), NPPM_SETEDITORBORDEREDGE, 0, svp._showBorderEdge ? TRUE : FALSE);
1640  					return TRUE;
1641  				case IDC_RADIO_SIMPLE:
1642  					svp._folderStyle = FOLDER_STYLE_SIMPLE;
1643  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN_SIMPLE, 0);
1644  					return TRUE;
1645  				case IDC_RADIO_ARROW:
1646  					svp._folderStyle = FOLDER_STYLE_ARROW;
1647  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN_ARROW, 0);
1648  					return TRUE;
1649  				case IDC_RADIO_CIRCLE:
1650  					svp._folderStyle = FOLDER_STYLE_CIRCLE;
1651  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN_CIRCLE, 0);
1652  					return TRUE;
1653  				case IDC_RADIO_BOX:
1654  					svp._folderStyle = FOLDER_STYLE_BOX;
1655  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN_BOX, 0);
1656  					return TRUE;
1657  				case IDC_RADIO_FOLDMARGENONE:
1658  					svp._folderStyle = FOLDER_STYLE_NONE;
1659  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN, 0);
1660  					return TRUE;
1661  				case IDC_CHECK_EDGEBGMODE:
1662  					svp._isEdgeBgMode = isCheckedOrNot(IDC_CHECK_EDGEBGMODE);
1663  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_EDGEMULTISETSIZE, 0, 0);
1664  					return TRUE;
1665  				default :
1666  					switch (HIWORD(wParam))
1667  					{
1668  						case EN_CHANGE :
1669  						{
1670  							if (LOWORD(wParam) == IDC_COLUMNPOS_EDIT)
1671  							{
1672  								TCHAR text[MAX_PATH] = {&#x27;\0&#x27;};
1673  								::SendDlgItemMessage(_hSelf, IDC_COLUMNPOS_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(text));
1674  								if (str2numberVector(text, svp._edgeMultiColumnPos))
1675  								{
1676  									bool canBeBg = svp._edgeMultiColumnPos.size() == 1;
1677  									if (!canBeBg)
1678  									{
1679  										svp._isEdgeBgMode = false;
1680  										::SendDlgItemMessage(_hSelf, IDC_CHECK_EDGEBGMODE, BM_SETCHECK, FALSE, 0);
1681  									}
1682  									::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_EDGEBGMODE), canBeBg);
1683  									::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_EDGEMULTISETSIZE, 0, 0);
1684  									return TRUE;
1685  								}
1686  							}
1687  						}
1688  						break;
1689  					}
1690  			}
1691  		}
1692  	}
1693  	return FALSE;
1694  }
1695  const size_t fileUpdateChoiceEnable = 0;
1696  const size_t fileUpdateChoiceEnable4All = 1;
1697  const size_t fileUpdateChoiceDisable = 2;
1698  intptr_t CALLBACK MiscSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
1699  {
1700  	NppParameters&amp; nppParam = NppParameters::getInstance();
1701  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
1702  	switch (message) 
1703  	{
1704  		case WM_INITDIALOG :
1705  		{
1706  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Enable&quot;)));
1707  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Enable for all opened files&quot;)));
1708  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Disable&quot;)));
1709  			int selIndex = -1;
1710  			if (nppGUI._fileAutoDetection &amp; cdEnabledOld)
1711  			{
1712  				selIndex = fileUpdateChoiceEnable4All;
1713  			}
1714  			else if (nppGUI._fileAutoDetection &amp; cdEnabledNew)
1715  			{				
1716  				selIndex = fileUpdateChoiceEnable;
1717  			}
1718  			else 
1719  			{
1720  				::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATESILENTLY), FALSE);
1721  				::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATEGOTOEOF), FALSE);
1722  				selIndex = fileUpdateChoiceDisable;
1723  			}
1724  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_SETCURSEL, selIndex, 0);
1725  			bool bCheck = (nppGUI._fileAutoDetection &amp; cdAutoUpdate) ? true : false;
1726  			::SendDlgItemMessage(_hSelf, IDC_CHECK_UPDATESILENTLY, BM_SETCHECK, bCheck? BST_CHECKED: BST_UNCHECKED, 0);
1727  			bCheck = (nppGUI._fileAutoDetection &amp; cdGo2end) ? true : false;
1728  			::SendDlgItemMessage(_hSelf, IDC_CHECK_UPDATEGOTOEOF, BM_SETCHECK, bCheck ? BST_CHECKED : BST_UNCHECKED, 0);
1729  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MIN2SYSTRAY, BM_SETCHECK, nppGUI._isMinimizedToTray, 0);
1730  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DETECTENCODING, BM_SETCHECK, nppGUI._detectEncoding, 0);
1731  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SAVEALLCONFIRM, BM_SETCHECK, nppGUI._saveAllConfirm, 0);
1732  			::SendDlgItemMessage(_hSelf, IDC_CHECK_AUTOUPDATE, BM_SETCHECK, nppGUI._autoUpdateOpt._doAutoUpdate, 0);
1733  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DIRECTWRITE_ENABLE, BM_SETCHECK, nppGUI._writeTechnologyEngine == directWriteTechnology, 0);
1734  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLEDOCPEEKER, BM_SETCHECK, nppGUI._isDocPeekOnTab ? BST_CHECKED : BST_UNCHECKED, 0);
1735  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLEDOCPEEKONMAP, BM_SETCHECK, nppGUI._isDocPeekOnMap ? BST_CHECKED : BST_UNCHECKED, 0);
1736  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MUTE_SOUNDS, BM_SETCHECK, nppGUI._muteSounds ? BST_CHECKED : BST_UNCHECKED, 0);
1737  			::ShowWindow(::GetDlgItem(_hSelf, IDC_CHECK_AUTOUPDATE), nppGUI._doesExistUpdater?SW_SHOW:SW_HIDE);
1738  			::SendDlgItemMessage(_hSelf, IDC_EDIT_SESSIONFILEEXT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._definedSessionExt.c_str()));
1739  			::SendDlgItemMessage(_hSelf, IDC_EDIT_WORKSPACEFILEEXT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._definedWorkspaceExt.c_str()));
1740  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLEDOCSWITCHER, BM_SETCHECK, nppGUI._doTaskList, 0);
1741  			::SendDlgItemMessage(_hSelf, IDC_CHECK_STYLEMRU, BM_SETCHECK, nppGUI._styleMRU, 0);
1742  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SHORTTITLE, BM_SETCHECK, nppGUI._shortTitlebar, 0);
1743  			return TRUE;
1744  		}
1745  		case WM_CTLCOLOREDIT:
1746  		{
1747  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
1748  		}
1749  		case WM_CTLCOLORLISTBOX:
1750  		{
1751  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
1752  		}
1753  		case WM_CTLCOLORDLG:
1754  		case WM_CTLCOLORSTATIC:
1755  		{
1756  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1757  		}
1758  		case WM_PRINTCLIENT:
1759  		{
1760  			if (NppDarkMode::isEnabled())
1761  			{
1762  				return TRUE;
1763  			}
1764  			break;
1765  		}
1766  		case WM_COMMAND : 
1767  		{
1768  			if (HIWORD(wParam) == EN_CHANGE)
1769  			{
1770  				switch (LOWORD(wParam))
1771  				{
1772  					case  IDC_EDIT_SESSIONFILEEXT:
1773  					{
1774  						TCHAR sessionExt[MAX_PATH] = { &#x27;\0&#x27; };
1775  						::SendDlgItemMessage(_hSelf, IDC_EDIT_SESSIONFILEEXT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(sessionExt));
1776  						nppGUI._definedSessionExt = sessionExt;
1777  						return TRUE;
1778  					}
1779  					case  IDC_EDIT_WORKSPACEFILEEXT:
1780  					{
1781  						TCHAR workspaceExt[MAX_PATH] = { &#x27;\0&#x27; };
1782  						::SendDlgItemMessage(_hSelf, IDC_EDIT_WORKSPACEFILEEXT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(workspaceExt));
1783  						nppGUI._definedWorkspaceExt = workspaceExt;
1784  						return TRUE;
1785  					}
1786  				}
1787  			}
1788  			switch (wParam)
1789  			{
1790  				case IDC_CHECK_UPDATESILENTLY:
1791  				case IDC_CHECK_UPDATEGOTOEOF:
1792  				{
1793  					bool isSilent = isCheckedOrNot(IDC_CHECK_UPDATESILENTLY);
1794  					bool isGo2End = isCheckedOrNot(IDC_CHECK_UPDATEGOTOEOF);
1795  					auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_GETCURSEL, 0, 0);
1796  					int cd = cdDisabled;
1797  					if (index == fileUpdateChoiceEnable || index == fileUpdateChoiceEnable4All)
1798  					{
1799  						if (index == fileUpdateChoiceEnable4All)
1800  							cd |= cdEnabledOld;
1801  						else
1802  							cd |= cdEnabledNew;
1803  						if (isSilent)
1804  							cd |= cdAutoUpdate;
1805  						if (isGo2End)
1806  							cd |= cdGo2end;
1807  					}
1808  					nppGUI._fileAutoDetection = cd;
1809  				}
1810  				return TRUE;
1811  				case IDC_CHECK_AUTOUPDATE:
1812  					nppGUI._autoUpdateOpt._doAutoUpdate = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
1813  					return TRUE;
1814  				case IDC_CHECK_MIN2SYSTRAY:
1815  					nppGUI._isMinimizedToTray = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
1816  					return TRUE;
1817  				case IDC_CHECK_DETECTENCODING:
1818  					nppGUI._detectEncoding = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
1819  					return TRUE;
1820  				case IDC_CHECK_ENABLEDOCSWITCHER :
1821  				{
1822  					nppGUI._doTaskList = !nppGUI._doTaskList;
1823  					if (nppGUI._doTaskList)
1824  					{
1825  						::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_STYLEMRU), TRUE);
1826  					}
1827  					else
1828  					{
1829  						nppGUI._styleMRU = false;
1830  						::SendDlgItemMessage(_hSelf, IDC_CHECK_STYLEMRU, BM_SETCHECK, false, 0);
1831  						::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_STYLEMRU), FALSE);
1832  					}
1833  					return TRUE;
1834  				}
1835  				case IDC_CHECK_STYLEMRU :
1836  				{
1837  					nppGUI._styleMRU = isCheckedOrNot(IDC_CHECK_STYLEMRU);
1838  					return TRUE;
1839  				}
1840  				case IDC_CHECK_SHORTTITLE:
1841  				{
1842  					nppGUI._shortTitlebar = isCheckedOrNot(IDC_CHECK_SHORTTITLE);
1843  					HWND grandParent = ::GetParent(_hParent);
1844  					::SendMessage(grandParent, NPPM_INTERNAL_UPDATETITLEBAR, 0, 0);
1845  					return TRUE;
1846  				}
1847  				case IDC_CHECK_DIRECTWRITE_ENABLE:
1848  				{
1849  					nppGUI._writeTechnologyEngine = isCheckedOrNot(IDC_CHECK_DIRECTWRITE_ENABLE) ? directWriteTechnology : defaultTechnology;
1850  					return TRUE;
1851  				}
1852  				case IDC_CHECK_ENABLEDOCPEEKER:
1853  				{
1854  					nppGUI._isDocPeekOnTab = isCheckedOrNot(IDC_CHECK_ENABLEDOCPEEKER);
1855  					return TRUE;
1856  				}
1857  				case IDC_CHECK_ENABLEDOCPEEKONMAP:
1858  				{
1859  					nppGUI._isDocPeekOnMap = isCheckedOrNot(IDC_CHECK_ENABLEDOCPEEKONMAP);
1860  					return TRUE;
1861  				}
1862  				case IDC_CHECK_MUTE_SOUNDS:
1863  				{
<span onclick='openModal()' class='match'>1864  					nppGUI._muteSounds = isCheckedOrNot(IDC_CHECK_MUTE_SOUNDS);
1865  					return TRUE;
1866  				}
1867  				case IDC_CHECK_SAVEALLCONFIRM:
1868  				{
</span>1869  					nppGUI._saveAllConfirm = isCheckedOrNot(IDC_CHECK_SAVEALLCONFIRM);
1870  					return TRUE;
1871  				}
1872  				default:
1873  				{
1874  					if (HIWORD(wParam) == CBN_SELCHANGE)
1875  					{
1876  						if (LOWORD(wParam) == IDC_COMBO_FILEUPDATECHOICE)
1877  						{
1878  							auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_GETCURSEL, 0, 0);
1879  							if (index == fileUpdateChoiceEnable || index == fileUpdateChoiceEnable4All)
1880  							{
1881  								bool isSilent = isCheckedOrNot(IDC_CHECK_UPDATESILENTLY);
1882  								bool isGo2End = isCheckedOrNot(IDC_CHECK_UPDATEGOTOEOF);
1883  								int cd = cdDisabled;
1884  								if (index == fileUpdateChoiceEnable4All)
1885  									cd |= cdEnabledOld;
1886  								else
1887  									cd |= cdEnabledNew;
1888  								if (isSilent)
1889  									cd |= cdAutoUpdate;
1890  								if (isGo2End)
1891  									cd |= cdGo2end;
1892  								nppGUI._fileAutoDetection = cd;
1893  								::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATESILENTLY), TRUE);
1894  								::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATEGOTOEOF), TRUE);
1895  							}
1896  							else if (index == fileUpdateChoiceDisable)
1897  							{
1898  								::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATESILENTLY), FALSE);
1899  								::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATEGOTOEOF), FALSE);
1900  								nppGUI._fileAutoDetection = cdDisabled;
1901  							}
1902  							return TRUE;
1903  						}
1904  					}
1905  				}
1906  			}
1907  		}
1908  	}
1909  	return FALSE;
1910  }
1911  intptr_t CALLBACK NewDocumentSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
1912  {
1913  	NppParameters&amp; nppParam = NppParameters::getInstance();
1914  	NppGUI &amp; nppGUI = (NppGUI &amp; )nppParam.getNppGUI();
1915  	NewDocDefaultSettings &amp; ndds = (NewDocDefaultSettings &amp;)nppGUI.getNewDocDefaultSettings();
1916  	switch (message)
1917  	{
1918  		case WM_INITDIALOG:
1919  		{
1920  			int ID2Check = IDC_RADIO_F_WIN;
1921  			switch (ndds._format)
1922  			{
1923  				case EolType::windows:
1924  					ID2Check = IDC_RADIO_F_WIN;
1925  					break;
1926  				case EolType::macos:
1927  					ID2Check = IDC_RADIO_F_MAC;
1928  					break;
1929  				case EolType::unix:
1930  					ID2Check = IDC_RADIO_F_UNIX;
1931  					break;
1932  				case EolType::unknown:
1933  					assert(false);
1934  					break;
1935  			}
1936  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
1937  			switch (ndds._unicodeMode)
1938  			{
1939  				case uni16BE :
1940  					ID2Check = IDC_RADIO_UTF16BIG;
1941  					break;
1942  				case uni16LE :
1943  					ID2Check = IDC_RADIO_UTF16SMALL;
1944  					break;
1945  				case uniUTF8 :
1946  					ID2Check = IDC_RADIO_UTF8;
1947  					break;
1948  				case uniCookie :
1949  					ID2Check = IDC_RADIO_UTF8SANSBOM;
1950  					break;
1951  				default : 
1952  					ID2Check = IDC_RADIO_ANSI;
1953  			}
1954  			int selIndex = -1;
1955  			generic_string str;
1956  			EncodingMapper&amp; em = EncodingMapper::getInstance();
1957  			for (size_t i = 0, encodingArraySize = sizeof(encodings)/sizeof(int) ; i &lt; encodingArraySize ; ++i)
1958  			{
1959  				int cmdID = em.getIndexFromEncoding(encodings[i]);
1960  				if (cmdID != -1)
1961  				{
1962  					cmdID += IDM_FORMAT_ENCODE;
1963  					getNameStrFromCmd(cmdID, str);
1964  					int index = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(str.c_str())));
1965  					if (ndds._codepage == encodings[i])
1966  						selIndex = index;
1967  					::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_SETITEMDATA, index, encodings[i]);
1968  				}
1969  			}
1970  			if (ndds._codepage == -1 || selIndex == -1)
1971  			{
1972  				::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
1973  			}
1974  			else
1975  			{
1976  				ID2Check = IDC_RADIO_OTHERCP;
1977  				::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_SETCURSEL, selIndex, 0);
1978  			}
1979  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
1980  			::SendDlgItemMessage(_hSelf, IDC_CHECK_OPENANSIASUTF8, BM_SETCHECK, (ID2Check == IDC_RADIO_UTF8SANSBOM &amp;&amp; ndds._openAnsiAsUtf8)?BST_CHECKED:BST_UNCHECKED, 0);
1981  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_OPENANSIASUTF8), ID2Check == IDC_RADIO_UTF8SANSBOM);
1982  			for (int i = L_TEXT + 1 ; i &lt; nppParam.L_END ; ++i) 
1983  			{
1984  				LangType lt = static_cast&lt;LangType&gt;(i);
1985  				str.clear();
1986  				if (lt != L_USER &amp;&amp; lt != L_JS)
1987  				{
1988  					int cmdID = nppParam.langTypeToCommandID(lt);
1989  					if ((cmdID != -1))
1990  					{
1991  						getNameStrFromCmd(cmdID, str);
1992  						if (str.length() &gt; 0)
1993  						{
1994  							size_t index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(str.c_str()));
1995  							::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_SETITEMDATA, index, lt);
1996  						}
1997  					}
1998  				}
1999  			}
2000  			int normalTextCmdID = nppParam.langTypeToCommandID(L_TEXT);
2001  			getNameStrFromCmd(normalTextCmdID, str);
2002  			::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_INSERTSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(str.c_str()));
2003  			LangType l = L_TEXT;
2004  			size_t cbCount = ::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_GETCOUNT, 0, 0);
2005  			size_t j = 0;
2006  			for (; j &lt; cbCount; ++j)
2007  			{
2008  				l = static_cast&lt;LangType&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_GETITEMDATA, j, 0));
2009  				if (ndds._lang == l)
2010  					break;
2011  			}
2012  			::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_SETCURSEL, j, 0);
2013  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ADDNEWDOCONSTARTUP, BM_SETCHECK, ndds._addNewDocumentOnStartup, 0);
2014  			return TRUE;
2015  		}
2016  		case WM_CTLCOLORLISTBOX:
2017  		{
2018  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
2019  		}
2020  		case WM_CTLCOLORDLG:
2021  		case WM_CTLCOLORSTATIC:
2022  		{
2023  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2024  		}
2025  		case WM_PRINTCLIENT:
2026  		{
2027  			if (NppDarkMode::isEnabled())
2028  			{
2029  				return TRUE;
2030  			}
2031  			break;
2032  		}
2033  		case WM_COMMAND:
2034  			switch (wParam)
2035  			{
2036  				case IDC_RADIO_UTF16BIG:
2037  					ndds._unicodeMode = uni16BE;
2038  					ndds._openAnsiAsUtf8 = false;
2039  					makeOpenAnsiAsUtf8(false);
2040  					ndds._codepage = -1;
2041  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2042  					return TRUE;
2043  				case IDC_RADIO_UTF16SMALL:
2044  					ndds._unicodeMode = uni16LE;
2045  					ndds._openAnsiAsUtf8 = false;
2046  					makeOpenAnsiAsUtf8(false);
2047  					ndds._codepage = -1;
2048  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2049  					return TRUE;
2050  				case IDC_RADIO_UTF8:
2051  					ndds._unicodeMode = uniUTF8;
2052  					ndds._openAnsiAsUtf8 = false;
2053  					makeOpenAnsiAsUtf8(false);
2054  					ndds._codepage = -1;
2055  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2056  					return TRUE;
2057  				case IDC_RADIO_UTF8SANSBOM:
2058  					ndds._unicodeMode = uniCookie;
2059  					makeOpenAnsiAsUtf8(true);
2060  					ndds._codepage = -1;
2061  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2062  					return TRUE;
2063  				case IDC_RADIO_ANSI:
2064  					ndds._unicodeMode = uni8Bit;
2065  					ndds._openAnsiAsUtf8 = false;
2066  					makeOpenAnsiAsUtf8(false);
2067  					ndds._codepage = -1;
2068  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2069  					return TRUE;
2070  				case IDC_CHECK_OPENANSIASUTF8 :
2071  					ndds._openAnsiAsUtf8 = (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_OPENANSIASUTF8), BM_GETCHECK, 0, 0));
2072  					return TRUE;
2073  				case IDC_RADIO_OTHERCP :
2074  				{
2075  					ndds._openAnsiAsUtf8 = false;
2076  					makeOpenAnsiAsUtf8(false);
2077  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), true);
2078  					auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_GETCURSEL, 0, 0);
2079  					ndds._codepage = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_GETITEMDATA, index, 0));
2080  					return TRUE;
2081  				}
2082  				case IDC_RADIO_F_MAC:
2083  				{
2084  					ndds._format = EolType::macos;
2085  					return TRUE;
2086  				}
2087  				case IDC_RADIO_F_UNIX:
2088  				{
2089  					ndds._format = EolType::unix;
2090  					return TRUE;
2091  				}
2092  				case IDC_RADIO_F_WIN:
2093  				{
2094  					ndds._format = EolType::windows;
2095  					return TRUE;
2096  				}
2097  				case IDC_CHECK_ADDNEWDOCONSTARTUP:
2098  				{
2099  					ndds._addNewDocumentOnStartup = isCheckedOrNot(IDC_CHECK_ADDNEWDOCONSTARTUP);
2100  					return TRUE;
2101  				}
2102  				default:
2103  				{
2104  					if (HIWORD(wParam) == CBN_SELCHANGE)
2105  					{
2106  						if (LOWORD(wParam) == IDC_COMBO_DEFAULTLANG)
2107  						{
2108  							auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_GETCURSEL, 0, 0);
2109  							ndds._lang = static_cast&lt;LangType&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_GETITEMDATA, index, 0));
2110  							return TRUE;
2111  						}
2112  						else if (LOWORD(wParam) == IDC_COMBO_OTHERCP)
2113  						{
2114  							auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_GETCURSEL, 0, 0);
2115  							ndds._codepage = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_GETITEMDATA, index, 0));
2116  							return TRUE;
2117  						}
2118  					}
2119  					return FALSE;
2120  				}
2121  			}
2122  	}
2123   	return FALSE;
2124  }
2125  intptr_t CALLBACK DefaultDirectorySubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
2126  {
2127  	NppParameters&amp; nppParam = NppParameters::getInstance();
2128  	NppGUI &amp; nppGUI = (NppGUI &amp; )nppParam.getNppGUI();
2129  	switch (message) 
2130  	{
2131  		case WM_INITDIALOG :
2132  		{
2133  			int ID2Check = 0;
2134  			bool shouldActivated;
2135  			switch (nppGUI._openSaveDir)
2136  			{
2137  				case dir_last :
2138  					ID2Check = IDC_OPENSAVEDIR_REMEMBERLAST_RADIO;
2139  					shouldActivated = false;
2140  					break;
2141  				case dir_userDef :
2142  					ID2Check = IDC_OPENSAVEDIR_ALWAYSON_RADIO;
2143  					shouldActivated = true;
2144  					break;
2145  				default : 
2146  					ID2Check = IDC_OPENSAVEDIR_FOLLOWCURRENT_RADIO;
2147  					shouldActivated = false;
2148  			}
2149  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
2150  			::SendDlgItemMessage(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._defaultDir));
2151  			::EnableWindow(::GetDlgItem(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT), shouldActivated);
2152  			::EnableWindow(::GetDlgItem(_hSelf, IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON), shouldActivated);
2153  			::SendDlgItemMessage(_hSelf, IDC_OPENSAVEDIR_CHECK_DRROPFOLDEROPENFILES, BM_SETCHECK, nppGUI._isFolderDroppedOpenFiles ? BST_CHECKED : BST_UNCHECKED, 0);
2154  			return TRUE;
2155  		}
2156  		case WM_CTLCOLOREDIT:
2157  		{
2158  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
2159  		}
2160  		case WM_CTLCOLORDLG:
2161  		case WM_CTLCOLORSTATIC:
2162  		{
2163  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2164  		}
2165  		case WM_PRINTCLIENT:
2166  		{
2167  			if (NppDarkMode::isEnabled())
2168  			{
2169  				return TRUE;
2170  			}
2171  			break;
2172  		}
2173  		case WM_COMMAND : 
2174  		{
2175  			if (HIWORD(wParam) == EN_CHANGE)
2176  			{
2177  				switch (LOWORD(wParam))
2178  				{
2179  					case  IDC_OPENSAVEDIR_ALWAYSON_EDIT:
2180  					{
2181  						TCHAR inputDir[MAX_PATH] = { &#x27;\0&#x27; };
2182  						::SendDlgItemMessage(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(inputDir));
2183  						wcscpy_s(nppGUI._defaultDir, inputDir);
2184  						::ExpandEnvironmentStrings(nppGUI._defaultDir, nppGUI._defaultDirExp, _countof(nppGUI._defaultDirExp));
2185  						nppParam.setWorkingDir(nppGUI._defaultDirExp);
2186  						return TRUE;
2187  					}
2188  				}
2189  			}
2190  			switch (wParam)
2191  			{
2192  				case IDC_OPENSAVEDIR_FOLLOWCURRENT_RADIO:
2193  					nppGUI._openSaveDir = dir_followCurrent;
2194  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_REFRESHWORKDIR, 0, 0);
2195  					::EnableWindow(::GetDlgItem(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT), false);
2196  					::EnableWindow(::GetDlgItem(_hSelf, IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON), false);
2197  					return TRUE;
2198  				case IDC_OPENSAVEDIR_REMEMBERLAST_RADIO:
2199  					nppGUI._openSaveDir = dir_last;
2200  					::EnableWindow(::GetDlgItem(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT), false);
2201  					::EnableWindow(::GetDlgItem(_hSelf, IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON), false);
2202  					return TRUE;
2203  				case IDC_OPENSAVEDIR_ALWAYSON_RADIO:
2204  					nppGUI._openSaveDir = dir_userDef;
2205  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_REFRESHWORKDIR, 0, 0);
2206  					::EnableWindow(::GetDlgItem(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT), true);
2207  					::EnableWindow(::GetDlgItem(_hSelf, IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON), true);
2208  					return TRUE;
2209  				case IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON :
2210  					{
2211  						generic_string title = nppParam.getNativeLangSpeaker()-&gt;getLocalizedStrFromID(&quot;default-open-save-select-folder&quot;,
2212  							TEXT(&quot;Select a folder as default directory&quot;));
2213  						folderBrowser(_hSelf, title, IDC_OPENSAVEDIR_ALWAYSON_EDIT);
2214  					}
2215  					return TRUE;
2216  				case IDC_OPENSAVEDIR_CHECK_DRROPFOLDEROPENFILES:
2217  					nppGUI._isFolderDroppedOpenFiles = isCheckedOrNot(IDC_OPENSAVEDIR_CHECK_DRROPFOLDEROPENFILES);
2218  					return TRUE;
2219  				default:
2220  					return FALSE;
2221  			}
2222  		}
2223  	}
2224  	return FALSE;
2225  }
2226  void RecentFilesHistorySubDlg::setCustomLen(int val)
2227  {
2228  	::SetDlgItemInt(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, val, FALSE);
2229  	::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL), val &gt; 0);
2230  }
2231  intptr_t CALLBACK RecentFilesHistorySubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
2232  {
2233  	NppParameters&amp; nppParam = NppParameters::getInstance();
2234  	NppGUI&amp; nppGUI = nppParam.getNppGUI();
2235  	switch (message) 
2236  	{
2237  		case WM_INITDIALOG:
2238  		{
2239  			::SetDlgItemInt(_hSelf, IDC_EDIT_MAXNBFILEVAL, nppParam.getNbMaxRecentFile(), FALSE);
2240  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DONTCHECKHISTORY, BM_SETCHECK, !nppGUI._checkHistoryFiles, 0);
2241  			::SendDlgItemMessage(_hSelf, IDC_CHECK_INSUBMENU, BM_SETCHECK, nppParam.putRecentFileInSubMenu(), 0);
2242  			int customLength = nppParam.getRecentFileCustomLength();
2243  			int id = IDC_RADIO_CUSTOMIZELENTH;
2244  			int length = customLength;
2245  			if (customLength == RECENTFILES_SHOWONLYFILENAME)
2246  			{
2247  				id = IDC_RADIO_ONLYFILENAME;
2248  				length = 0;
2249  			}
2250  			else if (customLength == RECENTFILES_SHOWFULLPATH || customLength &lt; 0)
2251  			{
2252  				id = IDC_RADIO_FULLFILENAMEPATH;
2253  				length = 0;
2254  			}
2255  			setChecked(id);
2256  			setCustomLen(length);
2257  			return TRUE;
2258  		}
2259  		case WM_CTLCOLOREDIT:
2260  		{
2261  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
2262  		}
2263  		case WM_CTLCOLORDLG:
2264  		{
2265  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2266  		}
2267  		case WM_CTLCOLORSTATIC:
2268  		{
2269  			const auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
2270  			const auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
2271  			if (dlgCtrlID == IDC_CUSTOMIZELENGTH_RANGE_STATIC)
2272  			{
2273  				const bool isTextEnabled = isCheckedOrNot(IDC_RADIO_CUSTOMIZELENTH);
2274  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
2275  			}
2276  			if (dlgCtrlID == IDC_EDIT_CUSTOMIZELENGTHVAL)
2277  			{
2278  				return NppDarkMode::onCtlColor(hdcStatic);
2279  			}
2280  			return NppDarkMode::onCtlColorDarker(hdcStatic);
2281  		}
2282  		case WM_PRINTCLIENT:
2283  		{
2284  			if (NppDarkMode::isEnabled())
2285  			{
2286  				return TRUE;
2287  			}
2288  			break;
2289  		}
2290  		case WM_COMMAND:
2291  		{
2292  			switch (LOWORD(wParam))
2293  			{
2294  				case IDC_EDIT_MAXNBFILEVAL:
2295  				{
2296  					switch (HIWORD(wParam))
2297  					{
2298  						case EN_KILLFOCUS:
2299  						{
2300  							constexpr int stringSize = 3;
2301  							wchar_t str[stringSize]{};
2302  							::GetDlgItemText(_hSelf, IDC_EDIT_MAXNBFILEVAL, str, stringSize);
2303  							if (lstrcmp(str, L&quot;&quot;) == 0)
2304  							{
2305  								::SetDlgItemInt(_hSelf, IDC_EDIT_MAXNBFILEVAL, nppParam.getNbMaxRecentFile(), FALSE);
2306  								return FALSE;
2307  							}
2308  							UINT nbMaxFile = ::GetDlgItemInt(_hSelf, IDC_EDIT_MAXNBFILEVAL, nullptr, FALSE);
2309  							if (nbMaxFile == nppParam.getNbMaxRecentFile())
2310  							{
2311  								return FALSE;
2312  							}
2313  							if (nbMaxFile &gt; NB_MAX_LRF_FILE)
2314  							{
2315  								::SetDlgItemInt(_hSelf, IDC_EDIT_MAXNBFILEVAL, NB_MAX_LRF_FILE, FALSE);
2316  								nbMaxFile = NB_MAX_LRF_FILE;
2317  							}
2318  							nppParam.setNbMaxRecentFile(nbMaxFile);
2319  							::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETTING_HISTORY_SIZE, 0, 0);
2320  							return TRUE;
2321  						}
2322  						default:
2323  						{
2324  							break;
2325  						}
2326  					}
2327  					return FALSE;
2328  				}
2329  				case IDC_EDIT_CUSTOMIZELENGTHVAL:
2330  				{
2331  					if (!isCheckedOrNot(IDC_RADIO_CUSTOMIZELENTH))
2332  					{
2333  						return FALSE;
2334  					}
2335  					switch (HIWORD(wParam))
2336  					{
2337  						case EN_KILLFOCUS:
2338  						{
2339  							constexpr int stringSize = 4;
2340  							wchar_t str[stringSize]{};
2341  							::GetDlgItemText(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, str, stringSize);
2342  							if (lstrcmp(str, L&quot;&quot;) == 0)
2343  							{
2344  								::SetDlgItemInt(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, nppParam.getRecentFileCustomLength(), FALSE);
2345  								return FALSE;
2346  							}
2347  							UINT size = ::GetDlgItemInt(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, nullptr, FALSE);
2348  							if (size == static_cast&lt;UINT&gt;(nppParam.getRecentFileCustomLength()))
2349  							{
2350  								return FALSE;
2351  							}
2352  							bool change = false;
2353  							if (size == 0)
2354  							{
2355  								size = NB_DEFAULT_LRF_CUSTOMLENGTH;
2356  								change = true;
2357  							}
2358  							else if (size &gt; NB_MAX_LRF_CUSTOMLENGTH)
2359  							{
2360  								size = NB_MAX_LRF_CUSTOMLENGTH;
2361  								change = true;
2362  							}
2363  							if (change)
2364  							{
2365  								::SetDlgItemInt(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, size, FALSE);
2366  							}
2367  							nppParam.setRecentFileCustomLength(size);
2368  							::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_UPDATE, 0, 0);
2369  							return TRUE;
2370  						}
2371  						default:
2372  						{
2373  							break;
2374  						}
2375  					}
2376  					return FALSE;
2377  				}
2378  				default:
2379  				{
2380  					break;
2381  				}
2382  			}
2383  			switch (wParam)
2384  			{
2385  				case IDC_CHECK_DONTCHECKHISTORY:
2386  					nppGUI._checkHistoryFiles = !isCheckedOrNot(IDC_CHECK_DONTCHECKHISTORY);
2387  					return TRUE;
2388  				case IDC_CHECK_INSUBMENU:
2389  					nppParam.setPutRecentFileInSubMenu(isCheckedOrNot(IDC_CHECK_INSUBMENU));
2390  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_SWITCH, 0, 0);
2391  					return TRUE;
2392  				case IDC_RADIO_ONLYFILENAME:
2393  				{
2394  					setCustomLen(0);
2395  					nppParam.setRecentFileCustomLength(0);
2396  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_UPDATE, 0, 0);
2397  					redrawDlgItem(IDC_CUSTOMIZELENGTH_RANGE_STATIC);
2398  					return TRUE;
2399  				}
2400  				case IDC_RADIO_FULLFILENAMEPATH:
2401  				{
2402  					setCustomLen(0);
2403  					nppParam.setRecentFileCustomLength(-1);
2404  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_UPDATE, 0, 0);
2405  					redrawDlgItem(IDC_CUSTOMIZELENGTH_RANGE_STATIC);
2406  					return TRUE;
2407  				}
2408  				case IDC_RADIO_CUSTOMIZELENTH:
2409  				{
2410  					int len = nppParam.getRecentFileCustomLength();
2411  					if (len &lt;= 0)
2412  					{
2413  						setCustomLen(NB_DEFAULT_LRF_CUSTOMLENGTH);
2414  						nppParam.setRecentFileCustomLength(NB_DEFAULT_LRF_CUSTOMLENGTH);
2415  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_UPDATE, 0, 0);
2416  					}
2417  					redrawDlgItem(IDC_CUSTOMIZELENGTH_RANGE_STATIC);
2418  					return TRUE;
2419  				}
2420  				default:
2421  					return FALSE;
2422  			}
2423  		}
2424  	}
2425  	return FALSE;
2426  }
2427  intptr_t CALLBACK LanguageSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
2428  {
2429  	NppParameters&amp; nppParam = NppParameters::getInstance();
2430  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
2431  	NativeLangSpeaker *pNativeSpeaker = nppParam.getNativeLangSpeaker();
2432  	switch (message) 
2433  	{
2434  		case WM_INITDIALOG :
2435  		{
2436  			for (int i = L_TEXT ; i &lt; nppParam.L_END ; ++i)
2437  			{
2438  				generic_string str;
2439  				if (static_cast&lt;LangType&gt;(i) != L_USER)
2440  				{
2441  					int cmdID = nppParam.langTypeToCommandID(static_cast&lt;LangType&gt;(i));
2442  					if ((cmdID != -1))
2443  					{
2444  						getNameStrFromCmd(cmdID, str);
2445  						if (str.length() &gt; 0)
2446  						{
2447  							_langList.push_back(LangMenuItem(static_cast&lt;LangType&gt;(i), cmdID, str));
2448  							::SendDlgItemMessage(_hSelf, IDC_LIST_ENABLEDLANG, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(str.c_str()));
2449  						}
2450  					}
2451  				}
2452  			}
2453  			for (size_t i = 0, len = nppGUI._excludedLangList.size(); i &lt; len ; ++i)
2454  			{
2455  				::SendDlgItemMessage(_hSelf, IDC_LIST_DISABLEDLANG, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._excludedLangList[i]._langName.c_str()));
2456  			}
2457  			::SendDlgItemMessage(_hSelf, IDC_CHECK_LANGMENUCOMPACT, BM_SETCHECK, nppGUI._isLangMenuCompact?BST_CHECKED:BST_UNCHECKED, 0);
2458  			::EnableWindow(::GetDlgItem(_hSelf, IDC_BUTTON_REMOVE), FALSE);
2459  			::EnableWindow(::GetDlgItem(_hSelf, IDC_BUTTON_RESTORE), FALSE);
2460  			::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, nppGUI._tabSize, FALSE);
2461  			::SendDlgItemMessage(_hSelf, IDC_CHECK_REPLACEBYSPACE, BM_SETCHECK, nppGUI._tabReplacedBySpace, 0);
2462  			::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;[Default]&quot;)));
2463  			const int nbLang = nppParam.getNbLang();
2464  			for (int i = 0; i &lt; nbLang; ++i)
2465  			{
2466  				::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(nppParam.getLangFromIndex(i)-&gt;_langName.c_str()));
2467  			}
2468  			const int index2Begin = 0;
2469  			::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_SETCURSEL, index2Begin, 0);
2470  			::ShowWindow(::GetDlgItem(_hSelf, IDC_GR_TABVALUE_STATIC), SW_HIDE);
2471  			::ShowWindow(::GetDlgItem(_hSelf, IDC_CHECK_DEFAULTTABVALUE), SW_HIDE);
2472  			::SendDlgItemMessage(_hSelf, IDC_CHECK_BACKSLASHISESCAPECHARACTERFORSQL, BM_SETCHECK, nppGUI._backSlashIsEscapeCharacterForSql, 0);
2473  			return TRUE;
2474  		}
2475  		case WM_CTLCOLOREDIT:
2476  		{
2477  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
2478  		}
2479  		case WM_CTLCOLORLISTBOX:
2480  		{
2481  			return NppDarkMode::onCtlColorListbox(wParam, lParam);
2482  		}
2483  		case WM_CTLCOLORDLG:
2484  		{
2485  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2486  		}
2487  		case WM_CTLCOLORSTATIC:
2488  		{
2489  			const int dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
2490  			const auto&amp; hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
2491  			const size_t index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2492  			if ((index &gt; 0) &amp;&amp; (dlgCtrlID == IDC_TABSIZE_STATIC))
2493  			{
2494  				const Lang* lang = nppParam.getLangFromIndex(index - 1);
2495  				if (lang == nullptr)
2496  				{
2497  					return NppDarkMode::onCtlColorDarker(hdcStatic);
2498  				}
2499  				const bool useDefaultTab = isCheckedOrNot(IDC_CHECK_DEFAULTTABVALUE);
2500  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, !useDefaultTab);
2501  			}
2502  			return NppDarkMode::onCtlColorDarker(hdcStatic);
2503  		}
2504  		case WM_PRINTCLIENT:
2505  		{
2506  			if (NppDarkMode::isEnabled())
2507  			{
2508  				return TRUE;
2509  			}
2510  			break;
2511  		}
2512  		case WM_COMMAND : 
2513  		{
2514  			switch (HIWORD(wParam))
2515  			{
2516  				case LBN_SELCHANGE:
2517  				{
2518  					if (LOWORD(wParam) == IDC_LIST_DISABLEDLANG || LOWORD(wParam) == IDC_LIST_ENABLEDLANG)
2519  					{
2520  						int idButton2Enable;
2521  						int idButton2Disable;
2522  						if (LOWORD(wParam) == IDC_LIST_ENABLEDLANG)
2523  						{
2524  							idButton2Enable = IDC_BUTTON_REMOVE;
2525  							idButton2Disable = IDC_BUTTON_RESTORE;
2526  						}
2527  						else 
2528  						{
2529  							idButton2Enable = IDC_BUTTON_RESTORE;
2530  							idButton2Disable = IDC_BUTTON_REMOVE;
2531  						}
2532  						auto i = ::SendDlgItemMessage(_hSelf, LOWORD(wParam), LB_GETCURSEL, 0, 0);
2533  						if (i != LB_ERR)
2534  						{
2535  							::EnableWindow(::GetDlgItem(_hSelf, idButton2Enable), TRUE);
2536  							int idListbox2Disable = (LOWORD(wParam) == IDC_LIST_ENABLEDLANG) ? IDC_LIST_DISABLEDLANG : IDC_LIST_ENABLEDLANG;
2537  							::SendDlgItemMessage(_hSelf, idListbox2Disable, LB_SETCURSEL, static_cast&lt;WPARAM&gt;(-1), 0);
2538  							::EnableWindow(::GetDlgItem(_hSelf, idButton2Disable), FALSE);
2539  						}
2540  						return TRUE;
2541  					}
2542  					else if (LOWORD(wParam) == IDC_LIST_TABSETTNG)
2543  					{
2544  						auto index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2545  						if (index == LB_ERR)
2546  							return FALSE;
2547  						::ShowWindow(::GetDlgItem(_hSelf, IDC_GR_TABVALUE_STATIC), index &gt; 0 ? SW_SHOW : SW_HIDE);
2548  						::ShowWindow(::GetDlgItem(_hSelf, IDC_CHECK_DEFAULTTABVALUE), index &gt; 0 ? SW_SHOW : SW_HIDE);
2549  						if (index &gt; 0)
2550  						{
2551  							Lang* lang = nppParam.getLangFromIndex(index - 1);
2552  							if (!lang) return FALSE;
2553  							bool useDefaultTab = (lang-&gt;_tabSize == -1 || lang-&gt;_tabSize == 0);
2554  							::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_DEFAULTTABVALUE), BM_SETCHECK, useDefaultTab, 0);
2555  							int size = useDefaultTab ? nppGUI._tabSize : lang-&gt;_tabSize;
2556  							::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, size, FALSE);
2557  							::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), BM_SETCHECK, useDefaultTab ? nppGUI._tabReplacedBySpace : lang-&gt;_isTabReplacedBySpace, 0);
2558  							::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), !useDefaultTab);
2559  							::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_TABSIZEVAL), !useDefaultTab);
2560  							if (!useDefaultTab)
2561  							{
2562  								::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, lang-&gt;_tabSize, FALSE);
2563  								::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), BM_SETCHECK, lang-&gt;_isTabReplacedBySpace, 0);
2564  							}
2565  						}
2566  						else
2567  						{
2568  							::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, nppGUI._tabSize, FALSE);
2569  							::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), TRUE);
2570  							::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_TABSIZEVAL), TRUE);
2571  							::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), BM_SETCHECK, nppGUI._tabReplacedBySpace, 0);
2572  						}
2573  						redrawDlgItem(IDC_TABSIZE_STATIC);
2574  						return TRUE;
2575  					}
2576  					break;
2577  				}
2578  				case LBN_DBLCLK:
2579  				{
2580  					if (LOWORD(wParam) == IDC_LIST_DISABLEDLANG || LOWORD(wParam) == IDC_LIST_ENABLEDLANG)
2581  					{
2582  						HWND(lParam) == ::GetDlgItem(_hSelf, IDC_LIST_ENABLEDLANG) ?
2583  							::SendMessage(_hSelf, WM_COMMAND, IDC_BUTTON_REMOVE, 0) :
2584  							::SendMessage(_hSelf, WM_COMMAND, IDC_BUTTON_RESTORE, 0);
2585  						return TRUE;
2586  					}
2587  					break;
2588  				}
2589  				case EN_CHANGE:
2590  				{
2591  					switch (LOWORD(wParam))
2592  					{
2593  						case IDC_EDIT_TABSIZEVAL:
2594  						{
2595  							const auto tabSize = ::GetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, nullptr, FALSE);
2596  							if (tabSize &lt; 1)
2597  							{
2598  								return FALSE;
2599  							}
2600  							const bool useDefaultTab = isCheckedOrNot(IDC_CHECK_DEFAULTTABVALUE);
2601  							const size_t index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2602  							if (!useDefaultTab &amp;&amp; index &gt; 0)
2603  							{
2604  								Lang* lang = nppParam.getLangFromIndex(index - 1);
2605  								if (lang == nullptr)
2606  								{
2607  									return FALSE;
2608  								}
2609  								if (lang-&gt;_langID == L_JS)
2610  								{
2611  									Lang* ljs = nppParam.getLangFromID(L_JAVASCRIPT);
2612  									ljs-&gt;_tabSize = tabSize;
2613  								}
2614  								else if (lang-&gt;_langID == L_JAVASCRIPT)
2615  								{
2616  									Lang* ljavascript = nppParam.getLangFromID(L_JS);
2617  									ljavascript-&gt;_tabSize = tabSize;
2618  								}
2619  								lang-&gt;_tabSize = tabSize;
2620  								nppParam.insertTabInfo(lang-&gt;getLangName(), lang-&gt;getTabInfo());
2621  							}
2622  							else
2623  							{
2624  								nppGUI._tabSize = tabSize;
2625  							}
2626  							::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETTING_TAB_SIZE, 0, 0);
2627  							return TRUE;
2628  						}
2629  						default:
2630  						{
2631  							break;
2632  						}
2633  					}
2634  					break;
2635  				}
2636  				case EN_KILLFOCUS:
2637  				{
2638  					switch (LOWORD(wParam))
2639  					{
2640  						case IDC_EDIT_TABSIZEVAL:
2641  						{
2642  							const auto tabSize = ::GetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, nullptr, FALSE);
2643  							if (tabSize &lt; 1)
2644  							{
2645  								const bool useDefaultTab = isCheckedOrNot(IDC_CHECK_DEFAULTTABVALUE);
2646  								const size_t index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2647  								auto prevSize = nppGUI._tabSize;
2648  								if (!useDefaultTab &amp;&amp; index &gt; 0)
2649  								{
2650  									Lang* lang = nppParam.getLangFromIndex(index - 1);
2651  									if (lang != nullptr &amp;&amp; lang-&gt;_tabSize &gt; 0)
2652  									{
2653  										prevSize = lang-&gt;_tabSize;
2654  									}
2655  								}
2656  								::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, prevSize, FALSE);
2657  								return TRUE;
2658  							}
2659  							return FALSE;
2660  						}
2661  						default:
2662  						{
2663  							break;
2664  						}
2665  					}
2666  					break;
2667  				}
2668  				default:
2669  				{
2670  					break;
2671  				}
2672  			}
2673  			switch (wParam)
2674  			{
2675  				case IDC_CHECK_LANGMENUCOMPACT:
2676  				{
2677  					nppGUI._isLangMenuCompact = (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_LANGMENUCOMPACT), BM_GETCHECK, 0, 0));
2678  					pNativeSpeaker-&gt;messageBox(&quot;LanguageMenuCompactWarning&quot;,
2679  						_hSelf,
2680  						TEXT(&quot;This option will be changed on the next launch.&quot;),
2681  						TEXT(&quot;Compact Language Menu&quot;),
2682  						MB_OK);
2683  					return TRUE;
2684  				}
2685  				case IDC_CHECK_BACKSLASHISESCAPECHARACTERFORSQL:
2686  				{
2687  					nppGUI._backSlashIsEscapeCharacterForSql = isCheckedOrNot(IDC_CHECK_BACKSLASHISESCAPECHARACTERFORSQL);
2688  					return TRUE;
2689  				}
2690  				case IDC_BUTTON_RESTORE :
2691  				case IDC_BUTTON_REMOVE :
2692  				{
2693  					int list2Remove, list2Add, idButton2Enable, idButton2Disable;
2694  					vector&lt;LangMenuItem&gt; *pSrcLst, *pDestLst;
2695  					if (LOWORD(wParam)==IDC_BUTTON_REMOVE)
2696  					{
2697  						list2Remove = IDC_LIST_ENABLEDLANG;
2698  						list2Add = IDC_LIST_DISABLEDLANG;
2699  						idButton2Enable = IDC_BUTTON_RESTORE;
2700  						idButton2Disable = IDC_BUTTON_REMOVE;
2701  						pSrcLst = &amp;_langList;
2702  						pDestLst = &amp;nppGUI._excludedLangList;
2703  					}
2704  					else
2705  					{
2706  						list2Remove = IDC_LIST_DISABLEDLANG;
2707  						list2Add = IDC_LIST_ENABLEDLANG;
2708  						idButton2Enable = IDC_BUTTON_REMOVE;
2709  						idButton2Disable = IDC_BUTTON_RESTORE;
2710  						pSrcLst = &amp;nppGUI._excludedLangList;
2711  						pDestLst = &amp;_langList;
2712  					}
2713  					size_t iRemove = ::SendDlgItemMessage(_hSelf, list2Remove, LB_GETCURSEL, 0, 0);
2714  					if (static_cast&lt;intptr_t&gt;(iRemove) == -1)
2715  						return TRUE;
2716  					const size_t sL = 31;
2717  					TCHAR s[sL + 1] = { &#x27;\0&#x27; };
2718  					auto lbTextLen = ::SendDlgItemMessage(_hSelf, list2Remove, LB_GETTEXTLEN, iRemove, 0);
2719  					if (static_cast&lt;size_t&gt;(lbTextLen) &gt; sL)
2720  						return TRUE;
2721  					::SendDlgItemMessage(_hSelf, list2Remove, LB_GETTEXT, iRemove, reinterpret_cast&lt;LPARAM&gt;(s));
2722  					LangMenuItem lmi = pSrcLst-&gt;at(iRemove);
2723  					vector&lt;LangMenuItem&gt;::iterator lang2Remove = pSrcLst-&gt;begin() + iRemove;
2724  					pSrcLst-&gt;erase(lang2Remove);
2725  					auto iAdd = ::SendDlgItemMessage(_hSelf, list2Add, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(s));
2726  					::SendDlgItemMessage(_hSelf, list2Remove, LB_DELETESTRING, iRemove, 0);
2727  					pDestLst-&gt;push_back(lmi);
2728  					::SendDlgItemMessage(_hSelf, list2Add, LB_SETCURSEL, iAdd, 0);
2729  					::SendDlgItemMessage(_hSelf, list2Remove, LB_SETCURSEL, static_cast&lt;WPARAM&gt;(-1), 0);
2730  					::EnableWindow(::GetDlgItem(_hSelf, idButton2Enable), TRUE);
2731  					::EnableWindow(::GetDlgItem(_hSelf, idButton2Disable), FALSE);
2732  					if ((lmi._langType &gt;= L_EXTERNAL) &amp;&amp; (lmi._langType &lt; nppParam.L_END))
2733  					{
2734  						bool found(false);
2735  						for (size_t x = 0; x &lt; nppParam.getExternalLexerDoc()-&gt;size() &amp;&amp; !found; ++x)
2736  						{
2737  							TiXmlNode *lexersRoot = nppParam.getExternalLexerDoc()-&gt;at(x)-&gt;FirstChild(TEXT(&quot;NotepadPlus&quot;))-&gt;FirstChildElement(TEXT(&quot;LexerStyles&quot;));
2738  							for (TiXmlNode *childNode = lexersRoot-&gt;FirstChildElement(TEXT(&quot;LexerType&quot;));
2739  								childNode ;
2740  								childNode = childNode-&gt;NextSibling(TEXT(&quot;LexerType&quot;)))
2741  							{
2742  								TiXmlElement *element = childNode-&gt;ToElement();
2743  								if (generic_string(element-&gt;Attribute(TEXT(&quot;name&quot;))) == lmi._langName)
2744  								{
2745  									element-&gt;SetAttribute(TEXT(&quot;excluded&quot;), (LOWORD(wParam)==IDC_BUTTON_REMOVE)?TEXT(&quot;yes&quot;):TEXT(&quot;no&quot;));
2746  									nppParam.getExternalLexerDoc()-&gt;at(x)-&gt;SaveFile();
2747  									found = true;
2748  									break;
2749  								}
2750  							}
2751  						}
2752  					}
2753  					HWND grandParent = ::GetParent(_hParent);
2754  					if (LOWORD(wParam)==IDC_BUTTON_REMOVE)
2755  					{
2756  						HMENU menu2remove = reinterpret_cast&lt;HMENU&gt;(::SendMessage(grandParent, NPPM_INTERNAL_GETMENU, 0, 0));
2757  						::DeleteMenu(menu2remove, lmi._cmdID, MF_BYCOMMAND);
2758  					}
2759  					else
2760  					{
2761  						HMENU menu = HMENU(::SendMessage(grandParent, NPPM_INTERNAL_GETMENU, 0, 0));
2762  						HMENU subMenu = ::GetSubMenu(menu, MENUINDEX_LANGUAGE);
2763  						int nbItem = ::GetMenuItemCount(subMenu);
2764  						int x = 0;
2765  						MENUITEMINFO menuItemInfo
2766  						{
2767  							.cbSize = sizeof(MENUITEMINFO),
2768  							.fMask = MIIM_FTYPE
2769  						};
2770  						for (; x &lt; nbItem; ++x)
2771  						{
2772  							::GetMenuItemInfo(subMenu, x, TRUE, &amp;menuItemInfo);
2773  							if (menuItemInfo.fType &amp; MFT_SEPARATOR)
2774  							{
2775  								break;
2776  							}
2777  						}
2778  						TCHAR firstLetter = lmi._langName.empty() ? TEXT(&#x27;\0&#x27;) : towupper(lmi._langName[0]);
2779  						TCHAR buffer[MAX_EXTERNAL_LEXER_NAME_LEN]{TEXT(&#x27;\0&#x27;)};
2780  						menuItemInfo.fMask = MIIM_SUBMENU;
2781  						for (++x; x &lt; nbItem; ++x)
2782  						{
2783  							::GetMenuItemInfo(subMenu, x, TRUE, &amp;menuItemInfo);
2784  							::GetMenuString(subMenu, x, buffer, MAX_EXTERNAL_LEXER_NAME_LEN, MF_BYPOSITION);
2785  							if (menuItemInfo.hSubMenu &amp;&amp; buffer[0] == firstLetter)
2786  							{
2787  								subMenu = menuItemInfo.hSubMenu;
2788  								nbItem = ::GetMenuItemCount(subMenu);
2789  								x = -1;
2790  							}
2791  							else if (lstrcmp(lmi._langName.c_str(), buffer) &lt; 0)
2792  							{
2793  								break;
2794  							}
2795  						}
2796  						::InsertMenu(subMenu, x, MF_BYPOSITION, lmi._cmdID, lmi._langName.c_str());
2797  					}
2798  					::DrawMenuBar(grandParent);
2799  					return TRUE;
2800  				}
2801  				case IDC_CHECK_REPLACEBYSPACE:
2802  				{
2803  					bool isTabReplacedBySpace = BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), BM_GETCHECK, 0, 0);
2804  					auto index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2805  					if (index == LB_ERR) return FALSE;
2806  					if (index != 0)
2807  					{
2808  						Lang *lang = nppParam.getLangFromIndex(index - 1);
2809  						if (!lang) return FALSE;
2810  						if (!lang-&gt;_tabSize || lang-&gt;_tabSize == -1)
2811  							lang-&gt;_tabSize = nppGUI._tabSize;
2812  						if (lang-&gt;_langID == L_JS)
2813  						{
2814  							Lang *ljs = nppParam.getLangFromID(L_JAVASCRIPT);
2815  							ljs-&gt;_isTabReplacedBySpace = isTabReplacedBySpace;
2816  						}
2817  						else if (lang-&gt;_langID == L_JAVASCRIPT)
2818  						{
2819  							Lang *ljavascript = nppParam.getLangFromID(L_JS);
2820  							ljavascript-&gt;_isTabReplacedBySpace = isTabReplacedBySpace;
2821  						}
2822  						lang-&gt;_isTabReplacedBySpace = isTabReplacedBySpace;
2823  						nppParam.insertTabInfo(lang-&gt;getLangName(), lang-&gt;getTabInfo());
2824  					}
2825  					else
2826  					{
2827  						nppGUI._tabReplacedBySpace = isTabReplacedBySpace;
2828  					}
2829  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETTING_TAB_REPLCESPACE, 0, 0);
2830  					return TRUE;
2831  				}
2832  				case IDC_CHECK_DEFAULTTABVALUE:
2833  				{
2834  					const bool useDefaultTab = isCheckedOrNot(IDC_CHECK_DEFAULTTABVALUE);
2835  					const auto index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2836  					if (index == LB_ERR || index == 0) 
2837  						return FALSE;
2838  					Lang *lang = nppParam.getLangFromIndex(index - 1);
2839  					if (!lang)
2840  						return FALSE;
2841  					lang-&gt;_tabSize = useDefaultTab ? 0 : nppGUI._tabSize;
2842  					lang-&gt;_isTabReplacedBySpace = useDefaultTab ? false : nppGUI._tabReplacedBySpace;
2843  					::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, useDefaultTab ? nppGUI._tabSize : lang-&gt;_tabSize, FALSE);
2844  					setChecked(IDC_CHECK_REPLACEBYSPACE, useDefaultTab ? nppGUI._tabReplacedBySpace : lang-&gt;_isTabReplacedBySpace);
2845  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), !useDefaultTab);
2846  					::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_TABSIZEVAL), !useDefaultTab);
2847  					if (useDefaultTab)
2848  						nppParam.insertTabInfo(lang-&gt;getLangName(), -1);
2849  					redrawDlgItem(IDC_TABSIZE_STATIC);
2850  					return TRUE;
2851  				}
2852  				default:
2853  				{
2854  					break;
2855  				}
2856  			}
2857  		}
2858  		default:
2859  		{
2860  			break;
2861  		}
2862  	}
2863  	return FALSE;
2864  }
2865  intptr_t CALLBACK HighlightingSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM&amp;bsol;* lParam*/)
2866  {
2867  	NppParameters&amp; nppParam = NppParameters::getInstance();
2868  	NppGUI &amp; nppGUI = (NppGUI &amp; )nppParam.getNppGUI();
2869  	switch (message) 
2870  	{
2871  		case WM_INITDIALOG :
2872  		{
2873  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MARKALLCASESENSITIVE, BM_SETCHECK, nppGUI._markAllCaseSensitive, 0);
2874  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MARKALLWHOLEWORDONLY, BM_SETCHECK, nppGUI._markAllWordOnly, 0);
2875  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLSMARTHILITE, BM_SETCHECK, nppGUI._enableSmartHilite, 0);
2876  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITECASESENSITIVE, BM_SETCHECK, nppGUI._smartHiliteCaseSensitive, 0);
2877  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEWHOLEWORDONLY, BM_SETCHECK, nppGUI._smartHiliteWordOnly, 0);
2878  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS, BM_SETCHECK, nppGUI._smartHiliteUseFindSettings, 0);
2879  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEANOTHERRVIEW, BM_SETCHECK, nppGUI._smartHiliteOnAnotherView, 0);
2880  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLTAGSMATCHHILITE, BM_SETCHECK, nppGUI._enableTagsMatchHilite, 0);
2881  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLTAGATTRHILITE, BM_SETCHECK, nppGUI._enableTagAttrsHilite, 0);
2882  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIGHLITENONEHTMLZONE, BM_SETCHECK, nppGUI._enableHiliteNonHTMLZone, 0);
2883  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_ENABLTAGATTRHILITE), nppGUI._enableTagsMatchHilite);
2884  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_HIGHLITENONEHTMLZONE), nppGUI._enableTagsMatchHilite);
2885  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITECASESENSITIVE), nppGUI._enableSmartHilite);
2886  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEWHOLEWORDONLY), nppGUI._enableSmartHilite);
2887  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS), nppGUI._enableSmartHilite);
2888  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEANOTHERRVIEW), nppGUI._enableSmartHilite);
2889  			if (NppDarkMode::isEnabled())
2890  			{
2891  				::EnableWindow(::GetDlgItem(_hSelf, IDC_SMARTHILITEMATCHING_STATIC), nppGUI._enableSmartHilite);
2892  			}
2893  			return TRUE;
2894  		}
2895  		case WM_CTLCOLORDLG:
2896  		case WM_CTLCOLORSTATIC:
2897  		{
2898  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2899  		}
2900  		case WM_PRINTCLIENT:
2901  		{
2902  			if (NppDarkMode::isEnabled())
2903  			{
2904  				return TRUE;
2905  			}
2906  			break;
2907  		}
2908  		case WM_COMMAND : 
2909  		{
2910  			switch (wParam)
2911  			{
2912  				case IDC_CHECK_MARKALLCASESENSITIVE:
2913  				{
2914  					nppGUI._markAllCaseSensitive = isCheckedOrNot(IDC_CHECK_MARKALLCASESENSITIVE);
2915  					HWND grandParent = ::GetParent(_hParent);
2916  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2917  					return TRUE;
2918  				}
2919  				case IDC_CHECK_MARKALLWHOLEWORDONLY:
2920  				{
2921  					nppGUI._markAllWordOnly = isCheckedOrNot(IDC_CHECK_MARKALLWHOLEWORDONLY);
2922  					HWND grandParent = ::GetParent(_hParent);
2923  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2924  					return TRUE;
2925  				}
2926  				case IDC_CHECK_ENABLSMARTHILITE:
2927  				{
2928  					nppGUI._enableSmartHilite = !nppGUI._enableSmartHilite;
2929  					if (!nppGUI._enableSmartHilite)
2930  					{
2931  					}
2932  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITECASESENSITIVE), nppGUI._enableSmartHilite);
2933  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEWHOLEWORDONLY), nppGUI._enableSmartHilite);
2934  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS), nppGUI._enableSmartHilite);
2935  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEANOTHERRVIEW), nppGUI._enableSmartHilite);
2936  					if (NppDarkMode::isEnabled())
2937  					{
2938  						::EnableWindow(::GetDlgItem(_hSelf, IDC_SMARTHILITEMATCHING_STATIC), nppGUI._enableSmartHilite);
2939  						redrawDlgItem(IDC_SMARTHILITEMATCHING_STATIC);
2940  					}
2941  					HWND grandParent = ::GetParent(_hParent);
2942  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2943  					return TRUE;
2944  				}
2945  				case IDC_CHECK_SMARTHILITECASESENSITIVE:
2946  				{
2947  					nppGUI._smartHiliteCaseSensitive = isCheckedOrNot(IDC_CHECK_SMARTHILITECASESENSITIVE);
2948  					if (nppGUI._smartHiliteCaseSensitive)
2949  					{
2950  						::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS, BM_SETCHECK, false, 0);
2951  						nppGUI._smartHiliteUseFindSettings = false;
2952  					}
2953  					HWND grandParent = ::GetParent(_hParent);
2954  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2955  					return TRUE;
2956  				}
2957  				case IDC_CHECK_SMARTHILITEWHOLEWORDONLY:
2958  				{
2959  					nppGUI._smartHiliteWordOnly = isCheckedOrNot(IDC_CHECK_SMARTHILITEWHOLEWORDONLY);
2960  					if (nppGUI._smartHiliteWordOnly)
2961  					{
2962  						::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS, BM_SETCHECK, false, 0);
2963  						nppGUI._smartHiliteUseFindSettings = false;
2964  					}
2965  					HWND grandParent = ::GetParent(_hParent);
2966  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2967  					return TRUE;
2968  				}
2969  				case IDC_CHECK_SMARTHILITEUSEFINDSETTINGS:
2970  				{
2971  					nppGUI._smartHiliteUseFindSettings = isCheckedOrNot(IDC_CHECK_SMARTHILITEUSEFINDSETTINGS);
2972  					if (nppGUI._smartHiliteUseFindSettings)
2973  					{
2974  						::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITECASESENSITIVE, BM_SETCHECK, false, 0);
2975  						::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEWHOLEWORDONLY, BM_SETCHECK, false, 0);
2976  						nppGUI._smartHiliteCaseSensitive = false;
2977  						nppGUI._smartHiliteWordOnly = false;
2978  					}
2979  					HWND grandParent = ::GetParent(_hParent);
2980  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2981  					return TRUE;
2982  				}
2983  				case IDC_CHECK_SMARTHILITEANOTHERRVIEW:
2984  				{
2985  					nppGUI._smartHiliteOnAnotherView = isCheckedOrNot(IDC_CHECK_SMARTHILITEANOTHERRVIEW);
2986  					HWND grandParent = ::GetParent(_hParent);
2987  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2988  					return TRUE;
2989  				}
2990  				case IDC_CHECK_ENABLTAGSMATCHHILITE:
2991  				{
2992  					nppGUI._enableTagsMatchHilite = !nppGUI._enableTagsMatchHilite;
2993  					if (!nppGUI._enableTagsMatchHilite)
2994  					{
2995  						HWND grandParent = ::GetParent(_hParent);
2996  						::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATORTAGMATCH, 0, 0);
2997  					}
2998  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_ENABLTAGATTRHILITE), nppGUI._enableTagsMatchHilite);
2999  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_HIGHLITENONEHTMLZONE), nppGUI._enableTagsMatchHilite);
3000  					return TRUE;
3001  				}
3002  				case IDC_CHECK_ENABLTAGATTRHILITE:
3003  				{
3004  					nppGUI._enableTagAttrsHilite = !nppGUI._enableTagAttrsHilite;
3005  					if (!nppGUI._enableTagAttrsHilite)
3006  					{
3007  						HWND grandParent = ::GetParent(_hParent);
3008  						::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATORTAGATTR, 0, 0);
3009  					}
3010  					return TRUE;
3011  				}
3012  				case IDC_CHECK_HIGHLITENONEHTMLZONE:
3013  				{
3014  					nppGUI._enableHiliteNonHTMLZone = !nppGUI._enableHiliteNonHTMLZone;
3015  					return TRUE;
3016  				}
3017  			}
3018  		}
3019  	}
3020  	return FALSE;
3021  }
3022  intptr_t CALLBACK PrintSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
3023  {
3024  	NppParameters&amp; nppParam = NppParameters::getInstance();
3025  	NppGUI &amp; nppGUI = (NppGUI &amp; )nppParam.getNppGUI();
3026  	switch (message) 
3027  	{
3028  		case WM_INITDIALOG :
3029  		{
3030  			bool printLN = nppGUI._printSettings._printLineNumber;
3031  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PRINTLINENUM, BM_SETCHECK, printLN, 0);
3032  			int ID2Check = 0;
3033  			switch (nppGUI._printSettings._printOption)
3034  			{
3035  				case SC_PRINT_NORMAL :
3036  					ID2Check = IDC_RADIO_WYSIWYG;
3037  					break;
3038  				case SC_PRINT_INVERTLIGHT :
3039  					ID2Check = IDC_RADIO_INVERT;
3040  					break;
3041  				case SC_PRINT_BLACKONWHITE :
3042  					ID2Check = IDC_RADIO_BW;
3043  					break;
3044  				case SC_PRINT_COLOURONWHITE :
3045  					ID2Check = IDC_RADIO_NOBG;
3046  					break;
3047  			}
3048  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
3049  			::SetDlgItemInt(_hSelf, IDC_EDIT_ML, nppGUI._printSettings._marge.left, FALSE);
3050  			::SetDlgItemInt(_hSelf, IDC_EDIT_MR, nppGUI._printSettings._marge.right, FALSE);
3051  			::SetDlgItemInt(_hSelf, IDC_EDIT_MT, nppGUI._printSettings._marge.top, FALSE);
3052  			::SetDlgItemInt(_hSelf, IDC_EDIT_MB,  nppGUI._printSettings._marge.bottom, FALSE);
3053  			::SetDlgItemText(_hSelf, IDC_EDIT_HLEFT, nppGUI._printSettings._headerLeft.c_str());
3054  			::SetDlgItemText(_hSelf, IDC_EDIT_HMIDDLE, nppGUI._printSettings._headerMiddle.c_str());
3055  			::SetDlgItemText(_hSelf, IDC_EDIT_HRIGHT, nppGUI._printSettings._headerRight.c_str());
3056  			::SetDlgItemText(_hSelf, IDC_EDIT_FLEFT, nppGUI._printSettings._footerLeft.c_str());
3057  			::SetDlgItemText(_hSelf, IDC_EDIT_FMIDDLE, nppGUI._printSettings._footerMiddle.c_str());
3058  			::SetDlgItemText(_hSelf, IDC_EDIT_FRIGHT, nppGUI._printSettings._footerRight.c_str());
3059  			TCHAR intStr[5]{};
3060  			for (int i = 6 ; i &lt; 15 ; ++i)
3061  			{
3062  				wsprintf(intStr, TEXT(&quot;%d&quot;), i);
3063  				::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTSIZE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(intStr));
3064  				::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTSIZE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(intStr));
3065  			}
3066  			const std::vector&lt;generic_string&gt; &amp; fontlist = nppParam.getFontList();
3067  			for (size_t i = 0, len = fontlist.size() ; i &lt; len ; ++i)
3068  			{
3069  				auto j = ::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTNAME, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(fontlist[i].c_str()));
3070  				::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTNAME, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(fontlist[i].c_str()));
3071  				::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTNAME, CB_SETITEMDATA, j, reinterpret_cast&lt;LPARAM&gt;(fontlist[i].c_str()));
3072  				::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTNAME, CB_SETITEMDATA, j, reinterpret_cast&lt;LPARAM&gt;(fontlist[i].c_str()));
3073  			}
3074  			auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTNAME, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(nppGUI._printSettings._headerFontName.c_str()));
3075  			if (index == CB_ERR)
3076  				index = 0;
3077  			::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTNAME, CB_SETCURSEL, index, 0);
3078  			index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTNAME, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(nppGUI._printSettings._footerFontName.c_str()));
3079  			if (index == CB_ERR)
3080  				index = 0;
3081  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTNAME, CB_SETCURSEL, index, 0);
3082  			wsprintf(intStr, TEXT(&quot;%d&quot;), nppGUI._printSettings._headerFontSize);
3083  			::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTSIZE, CB_SELECTSTRING, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(intStr));
3084  			wsprintf(intStr, TEXT(&quot;%d&quot;), nppGUI._printSettings._footerFontSize);
3085  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTSIZE, CB_SELECTSTRING, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(intStr));
3086  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HBOLD, BM_SETCHECK, nppGUI._printSettings._headerFontStyle &amp; FONTSTYLE_BOLD, 0);
3087  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HITALIC, BM_SETCHECK, nppGUI._printSettings._headerFontStyle &amp; FONTSTYLE_ITALIC, 0);
3088  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FBOLD, BM_SETCHECK, nppGUI._printSettings._footerFontStyle &amp; FONTSTYLE_BOLD, 0);
3089  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FITALIC, BM_SETCHECK, nppGUI._printSettings._footerFontStyle &amp; FONTSTYLE_ITALIC, 0);
3090  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Full file name path&quot;)));
3091  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;File name&quot;)));
3092  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;File directory&quot;)));
3093  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Page&quot;)));
3094  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Short date format&quot;)));
3095  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Long date format&quot;)));
3096  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Time&quot;)));
3097  			varList.push_back(TEXT(&quot;$(FULL_CURRENT_PATH)&quot;));
3098  			varList.push_back(TEXT(&quot;$(FILE_NAME)&quot;));
3099  			varList.push_back(TEXT(&quot;$(CURRENT_DIRECTORY)&quot;));
3100  			varList.push_back(TEXT(&quot;$(CURRENT_PRINTING_PAGE)&quot;));
3101  			varList.push_back(TEXT(&quot;$(SHORT_DATE)&quot;));
3102  			varList.push_back(TEXT(&quot;$(LONG_DATE)&quot;));
3103  			varList.push_back(TEXT(&quot;$(TIME)&quot;));
3104  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_SETCURSEL, 0, 0);
3105  			return TRUE;
3106  		}
3107  		case WM_CTLCOLOREDIT:
3108  		{
3109  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
3110  		}
3111  		case WM_CTLCOLORLISTBOX:
3112  		{
3113  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
3114  		}
3115  		case WM_CTLCOLORDLG:
3116  		{
3117  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
3118  		}
3119  		case WM_CTLCOLORSTATIC:
3120  		{
3121  			const auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
3122  			const auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
3123  			if (dlgCtrlID == IDC_EDIT_VIEWPANEL)
3124  			{
3125  				return NppDarkMode::onCtlColor(hdcStatic);
3126  			}
3127  			return NppDarkMode::onCtlColorDarker(hdcStatic);
3128  		}
3129  		case WM_PRINTCLIENT:
3130  		{
3131  			if (NppDarkMode::isEnabled())
3132  			{
3133  				return TRUE;
3134  			}
3135  			break;
3136  		}
3137  		case WM_COMMAND:
3138  		{
3139  			if (HIWORD(wParam) == EN_CHANGE &amp;&amp; LOWORD(wParam) != IDC_EDIT_VIEWPANEL)
3140  			{
3141  				switch (LOWORD(wParam))
3142  				{
3143  					case  IDC_EDIT_ML:
3144  						nppGUI._printSettings._marge.left = ::GetDlgItemInt(_hSelf, IDC_EDIT_ML, NULL, FALSE);
3145  						return TRUE;
3146  					case  IDC_EDIT_MR:
3147  						nppGUI._printSettings._marge.right = ::GetDlgItemInt(_hSelf, IDC_EDIT_MR, NULL, FALSE);
3148  						return TRUE;
3149  					case IDC_EDIT_MT :
3150  						nppGUI._printSettings._marge.top = ::GetDlgItemInt(_hSelf, IDC_EDIT_MT, NULL, FALSE);
3151  						return TRUE;
3152  					case IDC_EDIT_MB :
3153  						nppGUI._printSettings._marge.bottom = ::GetDlgItemInt(_hSelf, IDC_EDIT_MB, NULL, FALSE);
3154  						return TRUE;
3155  					default:
3156  					{
3157  						constexpr int stringSize = 256;
3158  						TCHAR str[stringSize]{};
3159  						_focusedEditCtrl = LOWORD(wParam);
3160  						::GetDlgItemText(_hSelf, _focusedEditCtrl, str, stringSize);
3161  						::SendDlgItemMessage(_hSelf, IDC_EDIT_VIEWPANEL, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(str));
3162  						switch (LOWORD(wParam))
3163  						{
3164  							case  IDC_EDIT_HLEFT:
3165  								nppGUI._printSettings._headerLeft = str;
3166  								trim(nppGUI._printSettings._headerLeft);
3167  								return TRUE;
3168  							case  IDC_EDIT_HMIDDLE:
3169  								nppGUI._printSettings._headerMiddle = str;
3170  								trim(nppGUI._printSettings._headerMiddle);
3171  								return TRUE;
3172  							case IDC_EDIT_HRIGHT :
3173  								nppGUI._printSettings._headerRight = str;
3174  								trim(nppGUI._printSettings._headerRight);
3175  								return TRUE;
3176  							case  IDC_EDIT_FLEFT:
3177  								nppGUI._printSettings._footerLeft = str;
3178  								trim(nppGUI._printSettings._footerLeft);
3179  								return TRUE;
3180  							case  IDC_EDIT_FMIDDLE:
3181  								nppGUI._printSettings._footerMiddle = str;
3182  								trim(nppGUI._printSettings._footerMiddle);
3183  								return TRUE;
3184  							case IDC_EDIT_FRIGHT :
3185  								nppGUI._printSettings._footerRight = str;
3186  								trim(nppGUI._printSettings._footerRight);
3187  								return TRUE;
3188  							default :
3189  								return FALSE;
3190  						}
3191  					}
3192  				}
3193  			}
3194  			else if (HIWORD(wParam) == EN_SETFOCUS &amp;&amp; LOWORD(wParam) != IDC_EDIT_VIEWPANEL)
3195  			{
3196  				constexpr int stringSize = 256;
3197  				TCHAR str[stringSize]{};
3198  				_focusedEditCtrl = LOWORD(wParam);
3199  				int focusedEditStatic = 0;
3200  				int groupStatic = 0;
3201  				switch (_focusedEditCtrl)
3202  				{
3203  					case IDC_EDIT_HLEFT : focusedEditStatic = IDC_HL_STATIC; groupStatic = IDC_HGB_STATIC; break;
3204  					case IDC_EDIT_HMIDDLE : focusedEditStatic = IDC_HM_STATIC; groupStatic = IDC_HGB_STATIC; break;
3205  					case IDC_EDIT_HRIGHT : focusedEditStatic = IDC_HR_STATIC; groupStatic = IDC_HGB_STATIC; break;
3206  					case IDC_EDIT_FLEFT : focusedEditStatic = IDC_FL_STATIC; groupStatic = IDC_FGB_STATIC; break;
3207  					case IDC_EDIT_FMIDDLE : focusedEditStatic = IDC_FM_STATIC; groupStatic = IDC_FGB_STATIC; break;
3208  					case IDC_EDIT_FRIGHT : focusedEditStatic = IDC_FR_STATIC; groupStatic = IDC_FGB_STATIC; break;
3209  					default : return TRUE;
3210  				}
3211  				::GetDlgItemText(_hSelf, _focusedEditCtrl, str, stringSize);
3212  				::SendDlgItemMessage(_hSelf, IDC_EDIT_VIEWPANEL, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(str));
3213  				::GetDlgItemText(_hSelf, groupStatic, str, stringSize);
3214  				generic_string title = str;
3215  				title += TEXT(&quot; &quot;);
3216  				::GetDlgItemText(_hSelf, focusedEditStatic, str, stringSize);
3217  				title += str;
3218  				title = purgeMenuItemString(title.c_str()); 
3219  				::SendDlgItemMessage(_hSelf, IDC_WHICHPART_STATIC, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(title.c_str()));
3220  				redrawDlgItem(IDC_WHICHPART_STATIC);
3221  				return TRUE;
3222  			}
3223  			else if (HIWORD(wParam) == CBN_SELCHANGE)
3224  			{
3225  				auto iSel = ::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETCURSEL, 0, 0);
3226  				switch (LOWORD(wParam))
3227  				{
3228  					case IDC_COMBO_HFONTNAME :
3229  					case IDC_COMBO_FFONTNAME :
3230  					{
3231  						TCHAR *fnStr = (TCHAR *)::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETITEMDATA, iSel, 0);
3232  						if (LOWORD(wParam) == IDC_COMBO_HFONTNAME)
3233  							nppGUI._printSettings._headerFontName = fnStr;
3234  						else
3235  							nppGUI._printSettings._footerFontName = fnStr;
3236  					}
3237  					break;
3238  					case IDC_COMBO_HFONTSIZE :
3239  					case IDC_COMBO_FFONTSIZE :
3240  					{
3241  						constexpr size_t intStrLen = 3;
3242  						TCHAR intStr[intStrLen]{};
3243  						auto lbTextLen = ::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETLBTEXTLEN, iSel, 0);
3244  						if (static_cast&lt;size_t&gt;(lbTextLen) &gt;= intStrLen)
3245  							return TRUE;
3246  						::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETLBTEXT, iSel, reinterpret_cast&lt;LPARAM&gt;(intStr));
3247  						int *pVal = (LOWORD(wParam) == IDC_COMBO_HFONTSIZE)?&amp;(nppGUI._printSettings._headerFontSize):&amp;(nppGUI._printSettings._footerFontSize);
3248  						if (!intStr[0])
3249  							*pVal = 0;
3250  						else
3251  							*pVal = wcstol(intStr, NULL, 10);
3252  					}
3253  					break;
3254  					case IDC_COMBO_VARLIST:
3255  					{
3256  						break;
3257  					}
3258  					default:
3259  					{
3260  						break;
3261  					}
3262  				}
3263  				return TRUE;
3264  			}
3265  			switch (wParam)
3266  			{
3267  				case IDC_CHECK_PRINTLINENUM:
3268  					nppGUI._printSettings._printLineNumber = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_PRINTLINENUM, BM_GETCHECK, 0, 0));
3269  					break;
3270  				case  IDC_RADIO_WYSIWYG:
3271  					nppGUI._printSettings._printOption = SC_PRINT_NORMAL;
3272  					break;
3273  				case  IDC_RADIO_INVERT:
3274  					nppGUI._printSettings._printOption = SC_PRINT_INVERTLIGHT;
3275  					break;
3276  				case IDC_RADIO_BW :
3277  					nppGUI._printSettings._printOption = SC_PRINT_BLACKONWHITE;
3278  					break;
3279  				case IDC_RADIO_NOBG :
3280  					nppGUI._printSettings._printOption = SC_PRINT_COLOURONWHITE;
3281  					break;
3282  				case IDC_CHECK_HBOLD:
3283  					nppGUI._printSettings._headerFontStyle ^= FONTSTYLE_BOLD;
3284  					break;
3285  				case  IDC_CHECK_HITALIC:
3286  					nppGUI._printSettings._headerFontStyle ^= FONTSTYLE_ITALIC;
3287  					break;
3288  				case  IDC_CHECK_FBOLD:
3289  					nppGUI._printSettings._footerFontStyle ^= FONTSTYLE_BOLD;
3290  					break;
3291  				case  IDC_CHECK_FITALIC:
3292  					nppGUI._printSettings._footerFontStyle ^= FONTSTYLE_ITALIC;
3293  					break;
3294  				case  IDC_BUTTON_ADDVAR:
3295  				{
3296  					try {
3297  						if (!_focusedEditCtrl)
3298  							return TRUE;
3299  						size_t iSel = ::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_GETCURSEL, 0, 0);
3300  						if (iSel &gt;= varList.size())
3301  							return TRUE;
3302  						TCHAR *varStr = (TCHAR*)varList[iSel].c_str();
3303  						size_t selStart = 0;
3304  						size_t selEnd = 0;
3305  						::SendDlgItemMessage(_hSelf, _focusedEditCtrl, EM_GETSEL, reinterpret_cast&lt;WPARAM&gt;(&amp;selStart), reinterpret_cast&lt;LPARAM&gt;(&amp;selEnd));
3306  						constexpr int stringSize = 256;
3307  						TCHAR str[stringSize]{};
3308  						::SendDlgItemMessage(_hSelf, _focusedEditCtrl, WM_GETTEXT, stringSize, reinterpret_cast&lt;LPARAM&gt;(str));
3309  						generic_string str2Set(str);
3310  						size_t strLen = str2Set.length();
3311  						if (selStart &gt; strLen || selEnd &gt; strLen)
3312  							selStart = selEnd = strLen;
3313  						str2Set.replace(selStart, selEnd - selStart, varStr);
3314  						::SetDlgItemText(_hSelf, _focusedEditCtrl, str2Set.c_str());
3315  					}
3316  					catch (...)
3317  					{
3318  					}
3319  				}
3320  				break;
3321  			}
3322  			return TRUE;
3323  		}
3324  	}
3325  	return FALSE;
3326  }
3327  intptr_t CALLBACK BackupSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
3328  {
3329  	NppParameters&amp; nppParam = NppParameters::getInstance();
3330  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
3331  	switch (message) 
3332  	{
3333  		case WM_INITDIALOG :
3334  		{
3335  			::SendDlgItemMessage(_hSelf, IDC_CHECK_REMEMBERSESSION, BM_SETCHECK, nppGUI._rememberLastSession, 0);
3336  			bool snapshotCheck = nppGUI._rememberLastSession &amp;&amp; nppGUI.isSnapshotMode();
3337  			::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_RESTORESESSION_CHECK, BM_SETCHECK, snapshotCheck?BST_CHECKED:BST_UNCHECKED, 0);
3338  			auto periodicBackupInSec = static_cast&lt;UINT&gt;(nppGUI._snapshotBackupTiming / 1000);
3339  			::SetDlgItemInt(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT,periodicBackupInSec, FALSE);
3340  			generic_string backupFilePath = NppParameters::getInstance().getUserPath();
3341  			backupFilePath += TEXT(&quot;\\backup\\&quot;);
3342  			::SetDlgItemText(_hSelf, IDD_BACKUPDIR_RESTORESESSION_PATH_EDIT, backupFilePath.c_str());
3343  			int ID2CheckBackupOnSave = 0;
3344  			switch (nppGUI._backup)
3345  			{
3346  				case bak_simple :
3347  					ID2CheckBackupOnSave = IDC_RADIO_BKSIMPLE;
3348  					break;
3349  				case bak_verbose :
3350  					ID2CheckBackupOnSave = IDC_RADIO_BKVERBOSE;
3351  					break;
3352  				default : 
3353  					ID2CheckBackupOnSave = IDC_RADIO_BKNONE;
3354  			}
3355  			::SendDlgItemMessage(_hSelf, ID2CheckBackupOnSave, BM_SETCHECK, BST_CHECKED, 0);
3356  			if (nppGUI._useDir)
3357  				::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_CHECK, BM_SETCHECK, BST_CHECKED, 0);
3358  			::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;((nppGUI._backupDir.c_str())));
3359  			updateBackupSessionGUI();
3360  			updateBackupOnSaveGUI();
3361  			return TRUE;
3362  		}
3363  		case WM_CTLCOLOREDIT:
3364  		{
3365  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
3366  		}
3367  		case WM_CTLCOLORDLG:
3368  		{
3369  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
3370  		}
3371  		case WM_CTLCOLORSTATIC:
3372  		{
3373  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
3374  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
3375  			bool isStaticText = (dlgCtrlID == IDD_BACKUPDIR_RESTORESESSION_STATIC1 ||
3376  				dlgCtrlID == IDD_BACKUPDIR_RESTORESESSION_STATIC2 ||
3377  				dlgCtrlID == IDD_BACKUPDIR_RESTORESESSION_PATHLABEL_STATIC);
3378  			if (isStaticText)
3379  			{
3380  				bool isTextEnabled = isCheckedOrNot(IDC_BACKUPDIR_RESTORESESSION_CHECK);
3381  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
3382  			}
3383  			if (dlgCtrlID == IDD_BACKUPDIR_STATIC)
3384  			{
3385  				bool isTextEnabled = !isCheckedOrNot(IDC_RADIO_BKNONE) &amp;&amp; isCheckedOrNot(IDC_BACKUPDIR_CHECK);
3386  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
3387  			}
3388  			if (dlgCtrlID == IDD_BACKUPDIR_RESTORESESSION_PATH_EDIT)
3389  			{
3390  				return NppDarkMode::onCtlColor(hdcStatic);
3391  			}
3392  			return NppDarkMode::onCtlColorDarker(hdcStatic);
3393  		}
3394  		case WM_PRINTCLIENT:
3395  		{
3396  			if (NppDarkMode::isEnabled())
3397  			{
3398  				return TRUE;
3399  			}
3400  			break;
3401  		}
3402  		case WM_COMMAND : 
3403  		{
3404  			if (HIWORD(wParam) == EN_CHANGE)
3405  			{
3406  				switch (LOWORD(wParam))
3407  				{
3408  					case  IDC_BACKUPDIR_EDIT:
3409  					{
3410  						TCHAR inputDir[MAX_PATH] = {&#x27;\0&#x27;};
3411  						::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(inputDir));
3412  						nppGUI._backupDir = inputDir;
3413  						return TRUE;
3414  					}
3415  					case IDC_BACKUPDIR_RESTORESESSION_EDIT:
3416  					{
3417  						constexpr int stringSize = 16;
3418  						TCHAR str[stringSize]{};
3419  						::GetDlgItemText(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, str, stringSize);
3420  						if (lstrcmp(str, TEXT(&quot;&quot;)) == 0)
3421  							return TRUE;
3422  						nppGUI._snapshotBackupTiming = ::GetDlgItemInt(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, NULL, FALSE) * 1000;
3423  						if (!nppGUI._snapshotBackupTiming)
3424  						{
3425  							nppGUI._snapshotBackupTiming = 1000;
3426  							::SetDlgItemInt(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, 1, FALSE);
3427  						}
3428  						return TRUE;
3429  					}
3430  				}
3431  			}
3432  			else if (HIWORD(wParam) == EN_KILLFOCUS)
3433  			{
3434  				switch (LOWORD(wParam))
3435  				{
3436  					case  IDC_BACKUPDIR_RESTORESESSION_EDIT:
3437  					{
3438  						constexpr int stringSize = 16;
3439  						TCHAR str[stringSize]{};
3440  						::GetDlgItemText(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, str, stringSize);
3441  						if (lstrcmp(str, TEXT(&quot;&quot;)) == 0)
3442  						{
3443  							::SetDlgItemInt(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, static_cast&lt;int32_t&gt;(nppGUI._snapshotBackupTiming / 1000), FALSE);
3444  						}
3445  					}
3446  				}
3447  			}
3448  			switch (wParam)
3449  			{
3450  				case IDC_CHECK_REMEMBERSESSION:
3451  				{
3452  					nppGUI._rememberLastSession = isCheckedOrNot(IDC_CHECK_REMEMBERSESSION);
3453  					if (!nppGUI._rememberLastSession)
3454  					{
3455  						::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_RESTORESESSION_CHECK, BM_SETCHECK, BST_UNCHECKED, 0);
3456  						::SendMessage(_hSelf, WM_COMMAND, IDC_BACKUPDIR_RESTORESESSION_CHECK, 0);
3457  					}
3458  					updateBackupSessionGUI();
3459  					return TRUE;
3460  				}
3461  				case IDC_BACKUPDIR_RESTORESESSION_CHECK:
3462  				{
3463  					nppGUI._isSnapshotMode = BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_RESTORESESSION_CHECK, BM_GETCHECK, 0, 0);
3464  					updateBackupSessionGUI();
3465  					if (nppGUI._isSnapshotMode)
3466  					{
3467  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_ENABLESNAPSHOT, 0, 0);
3468  					}
3469  					return TRUE;
3470  				}
3471  				case IDC_RADIO_BKSIMPLE:
3472  				{
3473  					nppGUI._backup = bak_simple;
3474  					updateBackupOnSaveGUI();
3475  					return TRUE;
3476  				}
3477  				case IDC_RADIO_BKVERBOSE:
3478  				{
3479  					nppGUI._backup = bak_verbose;
3480  					updateBackupOnSaveGUI();
3481  					return TRUE;
3482  				}
3483  				case IDC_RADIO_BKNONE:
3484  				{
3485  					nppGUI._backup = bak_none;
3486  					updateBackupOnSaveGUI();
3487  					return TRUE;
3488  				}
3489  				case IDC_BACKUPDIR_CHECK:
3490  				{
3491  					nppGUI._useDir = !nppGUI._useDir;
3492  					updateBackupOnSaveGUI();
3493  					return TRUE;
3494  				}
3495  				case IDD_BACKUPDIR_BROWSE_BUTTON :
3496  				{
3497  					generic_string title = nppParam.getNativeLangSpeaker()-&gt;getLocalizedStrFromID(&quot;backup-select-folder&quot;,
3498  						TEXT(&quot;Select a folder as backup directory&quot;));
3499  					folderBrowser(_hSelf, title, IDC_BACKUPDIR_EDIT);
3500  					return TRUE;
3501  				}
3502  				default :
3503  					return FALSE;
3504  			}
3505  		}
3506  	}
3507  	return FALSE;
3508  }
3509  void BackupSubDlg::updateBackupSessionGUI()
3510  {
3511  	bool rememberSession = isCheckedOrNot(IDC_CHECK_REMEMBERSESSION);
3512  	bool isSnapshot = isCheckedOrNot(IDC_BACKUPDIR_RESTORESESSION_CHECK);
3513  	::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_RESTORESESSION_CHECK), rememberSession);
3514  	::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT), isSnapshot);
3515  	::EnableWindow(::GetDlgItem(_hSelf, IDD_BACKUPDIR_RESTORESESSION_PATH_EDIT), isSnapshot);
3516  	redrawDlgItem(IDD_BACKUPDIR_RESTORESESSION_STATIC1);
3517  	redrawDlgItem(IDD_BACKUPDIR_RESTORESESSION_STATIC2);
3518  	redrawDlgItem(IDD_BACKUPDIR_RESTORESESSION_PATHLABEL_STATIC);
3519  }
3520  void BackupSubDlg::updateBackupOnSaveGUI()
3521  {
3522  	bool noBackup = BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_RADIO_BKNONE, BM_GETCHECK, 0, 0);
3523  	bool isEnableGlobableCheck = false;
3524  	bool isEnableLocalCheck = false;
3525  	if (!noBackup)
3526  	{
3527  		isEnableGlobableCheck = true;
3528  		isEnableLocalCheck = BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_CHECK, BM_GETCHECK, 0, 0);
3529  	}
3530  	::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_CHECK), isEnableGlobableCheck);
3531  	::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_EDIT), isEnableLocalCheck);
3532  	::EnableWindow(::GetDlgItem(_hSelf, IDD_BACKUPDIR_BROWSE_BUTTON), isEnableLocalCheck);
3533  	if (NppDarkMode::isEnabled())
3534  	{
3535  		::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_USERCUSTOMDIR_GRPSTATIC), !noBackup);
3536  		redrawDlgItem(IDC_BACKUPDIR_USERCUSTOMDIR_GRPSTATIC);
3537  	}
3538  }
3539  intptr_t CALLBACK AutoCompletionSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
3540  {
3541  	NppParameters&amp; nppParam = NppParameters::getInstance();
3542  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
3543  	switch (message) 
3544  	{
3545  		case WM_INITDIALOG :
3546  		{
3547  			::SetDlgItemInt(_hSelf, IDD_AUTOC_STATIC_N,  nppGUI._autocFromLen, FALSE);
3548  			const HWND hNbCharSlider = ::GetDlgItem(_hSelf, IDC_AUTOC_CHAR_SLIDER);
3549  			::SendMessage(hNbCharSlider, TBM_SETRANGEMIN, TRUE, AUTOCOMPLETEFROMCHAR_SMALLEST);
3550  			::SendMessage(hNbCharSlider, TBM_SETRANGEMAX, TRUE, AUTOCOMPLETEFROMCHAR_LARGEST);
3551  			::SendMessage(hNbCharSlider, TBM_SETPAGESIZE, 0, AUTOCOMPLETEFROMCHAR_INTERVAL);
3552  			::SendMessage(hNbCharSlider, TBM_SETPOS, TRUE, nppGUI._autocFromLen);
3553  			bool isEnableAutoC = nppGUI._autocStatus != nppGUI.autoc_none;
3554  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_ENABLECHECK, BM_SETCHECK, isEnableAutoC?BST_CHECKED:BST_UNCHECKED, 0);
3555  			int selectedID = IDD_AUTOC_BOTHRADIO;
3556  			if (nppGUI._autocStatus == nppGUI.autoc_func)
3557  				selectedID = IDD_AUTOC_FUNCRADIO;
3558  			else if (nppGUI._autocStatus == nppGUI.autoc_word)
3559  				selectedID = IDD_AUTOC_WORDRADIO;
3560  			else if (nppGUI._autocStatus == nppGUI.autoc_both)
3561  				selectedID = IDD_AUTOC_BOTHRADIO;
3562  			::SendDlgItemMessage(_hSelf, selectedID, BM_SETCHECK, BST_CHECKED, 0);
3563  			if (nppGUI._autocStatus == nppGUI.autoc_word || nppGUI._autocStatus == nppGUI.autoc_both)
3564  				::SendDlgItemMessage(_hSelf, IDD_AUTOC_IGNORENUMBERS, BM_SETCHECK, nppGUI._autocIgnoreNumbers ? BST_CHECKED : BST_UNCHECKED, 0);
3565  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_USEENTER, BM_SETCHECK, nppGUI._autocInsertSelectedUseENTER ? BST_CHECKED : BST_UNCHECKED, 0);
3566  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_USETAB, BM_SETCHECK, nppGUI._autocInsertSelectedUseTAB ? BST_CHECKED : BST_UNCHECKED, 0);
3567  			if (!isEnableAutoC)
3568  			{
3569  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_FUNCRADIO), FALSE);
3570  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_WORDRADIO), FALSE);
3571  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_BRIEF_CHECK), FALSE);
3572  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_BOTHRADIO), FALSE);
3573  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEENTER), FALSE);
3574  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USETAB), FALSE);
3575  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), FALSE);
3576  				::EnableWindow(::GetDlgItem(_hSelf, IDC_AUTOC_CHAR_SLIDER), FALSE);
3577  				if (NppDarkMode::isEnabled())
3578  				{
3579  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEKEY_GRP_STATIC), FALSE);
3580  				}
3581  			}
3582  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MAINTAININDENT, BM_SETCHECK, nppGUI._maitainIndent, 0);
3583  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_BRIEF_CHECK, BM_SETCHECK, nppGUI._autocBrief ? BST_CHECKED : BST_UNCHECKED, 0);
3584  			::SendDlgItemMessage(_hSelf, IDD_FUNC_CHECK, BM_SETCHECK, nppGUI._funcParams ? BST_CHECKED : BST_UNCHECKED, 0);
3585  			::SendDlgItemMessage(_hSelf, IDD_AUTOCPARENTHESES_CHECK, BM_SETCHECK, nppGUI._matchedPairConf._doParentheses?BST_CHECKED:BST_UNCHECKED, 0);
3586  			if (nppGUI._matchedPairConf._doParentheses)
3587  				::SendDlgItemMessage(_hSelf, IDD_AUTOCPARENTHESES_CHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; (  )&quot;)));
3588  			::SendDlgItemMessage(_hSelf, IDD_AUTOCBRACKET_CHECK, BM_SETCHECK, nppGUI._matchedPairConf._doBrackets?BST_CHECKED:BST_UNCHECKED, 0);
3589  			if (nppGUI._matchedPairConf._doBrackets)
3590  				::SendDlgItemMessage(_hSelf, IDD_AUTOCBRACKET_CHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; [  ]&quot;)));
3591  			::SendDlgItemMessage(_hSelf, IDD_AUTOCCURLYBRACKET_CHECK, BM_SETCHECK, nppGUI._matchedPairConf._doCurlyBrackets?BST_CHECKED:BST_UNCHECKED, 0);
3592  			if (nppGUI._matchedPairConf._doCurlyBrackets)
3593  				::SendDlgItemMessage(_hSelf, IDD_AUTOCCURLYBRACKET_CHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; {  }&quot;)));
3594  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_QUOTESCHECK, BM_SETCHECK, nppGUI._matchedPairConf._doQuotes?BST_CHECKED:BST_UNCHECKED, 0);
3595  			if (nppGUI._matchedPairConf._doQuotes)
3596  				::SendDlgItemMessage(_hSelf, IDD_AUTOC_QUOTESCHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; &#x27;  &#x27;&quot;)));
3597  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_DOUBLEQUOTESCHECK, BM_SETCHECK, nppGUI._matchedPairConf._doDoubleQuotes?BST_CHECKED:BST_UNCHECKED, 0);
3598  			if (nppGUI._matchedPairConf._doDoubleQuotes)
3599  				::SendDlgItemMessage(_hSelf, IDD_AUTOC_DOUBLEQUOTESCHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; \&quot;  \&quot;&quot;)));
3600  			::SendDlgItemMessage(_hSelf, IDD_AUTOCTAG_CHECK, BM_SETCHECK, nppGUI._matchedPairConf._doHtmlXmlTag?BST_CHECKED:BST_UNCHECKED, 0);
3601  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT1, EM_LIMITTEXT, 1, 0);
3602  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT1, EM_LIMITTEXT, 1, 0);
3603  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT2, EM_LIMITTEXT, 1, 0);
3604  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT2, EM_LIMITTEXT, 1, 0);
3605  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT3, EM_LIMITTEXT, 1, 0);
3606  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT3, EM_LIMITTEXT, 1, 0);
3607  			size_t nbMatchedPair = nppGUI._matchedPairConf._matchedPairsInit.size();
3608  			if (nbMatchedPair &gt; 3)
3609  				nbMatchedPair = 3;
3610  			for (size_t i = 0; i &lt; nbMatchedPair; ++i)
3611  			{
3612  				TCHAR openChar[2]{};
3613  				openChar[0] = nppGUI._matchedPairConf._matchedPairsInit[i].first;
3614  				openChar[1] = &#x27;\0&#x27;;
3615  				TCHAR closeChar[2]{};
3616  				closeChar[0] = nppGUI._matchedPairConf._matchedPairsInit[i].second;
3617  				closeChar[1] = &#x27;\0&#x27;;
3618  				if (i == 0)
3619  				{
3620  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT1, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(openChar));
3621  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT1, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(closeChar));
3622  				}
3623  				else if (i == 1)
3624  				{
3625  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT2, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(openChar));
3626  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT2, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(closeChar));
3627  				}
3628  				if (i == 2)
3629  				{
3630  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT3, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(openChar));
3631  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT3, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(closeChar));
3632  				}
3633  			}
3634  			return TRUE;
3635  		}
3636  		case WM_CTLCOLOREDIT:
3637  		{
3638  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
3639  		}
3640  		case WM_CTLCOLORDLG:
3641  		{
3642  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
3643  		}
3644  		case WM_CTLCOLORSTATIC:
3645  		{
3646  			const auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
3647  			const auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
3648  			const bool isStaticText = (dlgCtrlID == IDD_AUTOC_STATIC_FROM ||
3649  				dlgCtrlID == IDD_AUTOC_STATIC_CHAR ||
3650  				dlgCtrlID == IDD_AUTOC_STATIC_N ||
3651  				dlgCtrlID == IDD_AUTOC_SLIDER_MIN_STATIC ||
3652  				dlgCtrlID == IDD_AUTOC_SLIDER_MAX_STATIC);
3653  			if (isStaticText)
3654  			{
3655  				const bool isTextEnabled = isCheckedOrNot(IDD_AUTOC_ENABLECHECK);
3656  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
3657  			}
3658  			return NppDarkMode::onCtlColorDarker(hdcStatic);
3659  		}
3660  		case WM_PRINTCLIENT:
3661  		{
3662  			if (NppDarkMode::isEnabled())
3663  			{
3664  				return TRUE;
3665  			}
3666  			break;
3667  		}
3668  		case WM_HSCROLL:
3669  		{
3670  			const HWND hNbCharSlider = ::GetDlgItem(_hSelf, IDC_AUTOC_CHAR_SLIDER);
3671  			if (hNbCharSlider == reinterpret_cast&lt;HWND&gt;(lParam))
3672  			{
3673  				nppGUI._autocFromLen = static_cast&lt;UINT&gt;(::SendMessage(hNbCharSlider, TBM_GETPOS, 0, 0));
3674  				::SetDlgItemInt(_hSelf, IDD_AUTOC_STATIC_N, nppGUI._autocFromLen, FALSE);
3675  			}
3676  			return 0; 
3677  		}
3678  		case WM_COMMAND : 
3679  		{
3680  			if (HIWORD(wParam) == EN_CHANGE)
3681  			{
3682  				switch (LOWORD(wParam))
3683  				{
3684  					case IDC_MACHEDPAIROPEN_EDIT1 :
3685  					case IDC_MACHEDPAIRCLOSE_EDIT1:
3686  					case IDC_MACHEDPAIROPEN_EDIT2 :
3687  					case IDC_MACHEDPAIRCLOSE_EDIT2:
3688  					case IDC_MACHEDPAIROPEN_EDIT3 :
3689  					case IDC_MACHEDPAIRCLOSE_EDIT3:
3690  					{
3691  						nppGUI._matchedPairConf._matchedPairs.clear();
3692  						TCHAR opener[2] = {&#x27;\0&#x27;, &#x27;\0&#x27;};
3693  						TCHAR closer[2] = {&#x27;\0&#x27;, &#x27;\0&#x27;};
3694  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT1, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(opener));
3695  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT1, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(closer));
3696  						if (opener[0] &lt; 0x80 &amp;&amp; opener[0] != &#x27;\0&#x27; &amp;&amp; closer[0] &lt; 0x80 &amp;&amp; closer[0] != &#x27;\0&#x27;)
3697  							nppGUI._matchedPairConf._matchedPairs.push_back(pair&lt;char, char&gt;(static_cast&lt;char&gt;(opener[0]), static_cast&lt;char&gt;(closer[0])));
3698  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT2, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(opener));
3699  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT2, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(closer));
3700  						if (opener[0] &lt; 0x80 &amp;&amp; opener[0] != &#x27;\0&#x27; &amp;&amp; closer[0] &lt; 0x80 &amp;&amp; closer[0] != &#x27;\0&#x27;)
3701  							nppGUI._matchedPairConf._matchedPairs.push_back(pair&lt;char, char&gt;(static_cast&lt;char&gt;(opener[0]), static_cast&lt;char&gt;(closer[0])));
3702  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT3, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(opener));
3703  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT3, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(closer));
3704  						if (opener[0] &lt; 0x80 &amp;&amp; opener[0] != &#x27;\0&#x27; &amp;&amp; closer[0] &lt; 0x80 &amp;&amp; closer[0] != &#x27;\0&#x27;)
3705  							nppGUI._matchedPairConf._matchedPairs.push_back(pair&lt;char, char&gt;(static_cast&lt;char&gt;(opener[0]), static_cast&lt;char&gt;(closer[0])));
3706  						return TRUE;
3707  					}
3708  				}
3709  			}
3710  			switch (wParam)
3711  			{
3712  				case IDC_CHECK_MAINTAININDENT:
3713  				{
3714  					nppGUI._maitainIndent = isCheckedOrNot(IDC_CHECK_MAINTAININDENT);
3715  					return TRUE;
3716  				}
3717  				case IDD_AUTOC_ENABLECHECK :
3718  				{
3719  					bool isEnableAutoC = BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDD_AUTOC_ENABLECHECK, BM_GETCHECK, 0, 0);
3720  					if (isEnableAutoC)
3721  					{
3722  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_BOTHRADIO, BM_SETCHECK, BST_CHECKED, 0);
3723  						nppGUI._autocStatus = nppGUI.autoc_both;
3724  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_IGNORENUMBERS, BM_SETCHECK, BST_UNCHECKED, 0);
3725  						nppGUI._autocIgnoreNumbers = false;
3726  					}
3727  					else 
3728  					{
3729  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_FUNCRADIO, BM_SETCHECK, BST_UNCHECKED, 0);
3730  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_WORDRADIO, BM_SETCHECK, BST_UNCHECKED, 0);
3731  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_BOTHRADIO, BM_SETCHECK, BST_UNCHECKED, 0);
3732  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_BRIEF_CHECK, BM_SETCHECK, BST_UNCHECKED, 0);
3733  						nppGUI._autocBrief = false;
3734  						nppGUI._autocStatus = nppGUI.autoc_none;
3735  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_IGNORENUMBERS, BM_SETCHECK, BST_UNCHECKED, 0);
3736  						nppGUI._autocIgnoreNumbers = false;
3737  					}
3738  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_FUNCRADIO), isEnableAutoC);
3739  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_WORDRADIO), isEnableAutoC);
3740  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_BOTHRADIO), isEnableAutoC);
3741  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_BRIEF_CHECK), isEnableAutoC);
3742  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEKEY_GRP_STATIC), isEnableAutoC);
3743  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEENTER), isEnableAutoC);
3744  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USETAB), isEnableAutoC);
3745  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), isEnableAutoC);
3746  					::EnableWindow(::GetDlgItem(_hSelf, IDC_AUTOC_CHAR_SLIDER), isEnableAutoC);
3747  					redrawDlgItem(IDD_AUTOC_STATIC_FROM);
3748  					redrawDlgItem(IDD_AUTOC_STATIC_N);
3749  					redrawDlgItem(IDD_AUTOC_STATIC_CHAR);
3750  					redrawDlgItem(IDD_AUTOC_SLIDER_MIN_STATIC);
3751  					redrawDlgItem(IDD_AUTOC_SLIDER_MAX_STATIC);
3752  					if (NppDarkMode::isEnabled())
3753  					{
3754  						::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEKEY_GRP_STATIC), isEnableAutoC);
3755  						redrawDlgItem(IDD_AUTOC_USEKEY_GRP_STATIC);
3756  					}
3757  					return TRUE;
3758  				}
3759  				case IDD_AUTOC_FUNCRADIO :
3760  				{
3761  					nppGUI._autocStatus = nppGUI.autoc_func;
3762  					::SendDlgItemMessage(_hSelf, IDD_AUTOC_IGNORENUMBERS, BM_SETCHECK, BST_UNCHECKED, 0);
3763  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), FALSE);
3764  					nppGUI._autocIgnoreNumbers = false;
3765  					::SendDlgItemMessage(_hSelf, IDD_AUTOC_BRIEF_CHECK, BM_SETCHECK, BST_UNCHECKED, 0);
3766  					nppGUI._autocBrief = false;
3767  					return TRUE;
3768  				}
3769  				case IDD_AUTOC_WORDRADIO :
3770  				{
3771  					nppGUI._autocStatus = nppGUI.autoc_word;
3772  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), TRUE);
3773  					return TRUE;
3774  				}
3775  				case IDD_AUTOC_BOTHRADIO :
3776  				{
3777  					nppGUI._autocStatus = nppGUI.autoc_both;
3778  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), TRUE);
3779  					return TRUE;
3780  				}
3781  				case IDD_AUTOC_USEENTER:
3782  				{
3783  					nppGUI._autocInsertSelectedUseENTER = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3784  					return TRUE;
3785  				}
3786  				case IDD_AUTOC_USETAB:
3787  				{
3788  					nppGUI._autocInsertSelectedUseTAB = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3789  					return TRUE;
3790  				}
3791  				case IDD_AUTOC_IGNORENUMBERS:
3792  				{
3793  					nppGUI._autocIgnoreNumbers = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3794  					return TRUE;
3795  				}
3796  				case IDD_AUTOC_BRIEF_CHECK :
3797  				{
3798  					nppGUI._autocBrief = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3799  					return TRUE;
3800  				}
3801  				case IDD_FUNC_CHECK :
3802  				{
3803  					nppGUI._funcParams = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3804  					return TRUE;
3805  				}
3806  				case IDD_AUTOCPARENTHESES_CHECK :
3807  				case IDD_AUTOCBRACKET_CHECK :
3808  				case IDD_AUTOCCURLYBRACKET_CHECK :
3809  				case IDD_AUTOC_DOUBLEQUOTESCHECK :
3810  				case IDD_AUTOC_QUOTESCHECK :
3811  				{
3812  					bool isChecked = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3813  					const TCHAR *label = nullptr;
3814  					if (wParam == IDD_AUTOCPARENTHESES_CHECK)
3815  					{
3816  						nppGUI._matchedPairConf._doParentheses = isChecked;
3817  						label = isChecked?TEXT(&quot; (  )&quot;):TEXT(&quot; (&quot;);
3818  					}
3819  					else if (wParam == IDD_AUTOCBRACKET_CHECK)
3820  					{
3821  						nppGUI._matchedPairConf._doBrackets = isChecked;
3822  						label = isChecked?TEXT(&quot; [  ]&quot;):TEXT(&quot; [&quot;);
3823  					}
3824  					else if (wParam == IDD_AUTOCCURLYBRACKET_CHECK)
3825  					{
3826  						nppGUI._matchedPairConf._doCurlyBrackets = isChecked;
3827  						label = isChecked?TEXT(&quot; {  }&quot;):TEXT(&quot; {&quot;);
3828  					}
3829  					else if (wParam == IDD_AUTOC_DOUBLEQUOTESCHECK)
3830  					{
3831  						nppGUI._matchedPairConf._doDoubleQuotes = isChecked;
3832  						label = isChecked?TEXT(&quot; \&quot;  \&quot;&quot;):TEXT(&quot; \&quot;&quot;);
3833  					}
3834  					else 
3835  					{
3836  						nppGUI._matchedPairConf._doQuotes = isChecked;
3837  						label = isChecked?TEXT(&quot; &#x27;  &#x27;&quot;):TEXT(&quot; &#x27;&quot;);
3838  					}
3839  					::SendDlgItemMessage(_hSelf, static_cast&lt;int32_t&gt;(wParam), WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(label));
3840  					return TRUE;
3841  				}
3842  				case IDD_AUTOCTAG_CHECK :
3843  				{
3844  					nppGUI._matchedPairConf._doHtmlXmlTag = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDD_AUTOCTAG_CHECK, BM_GETCHECK, 0, 0));
3845  					return TRUE;
3846  				}
3847  				default :
3848  					return FALSE;
3849  			}
3850  		}
3851  	}
3852  	return FALSE;
3853  }
3854  intptr_t CALLBACK MultiInstanceSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
3855  {
3856  	NppGUI &amp; nppGUI = (NppParameters::getInstance()).getNppGUI();
3857  	switch (message) 
3858  	{
3859  		case WM_INITDIALOG :
3860  		{
3861  			auto checkOrUncheckBtn = [this](int id, bool check) -&gt; void
3862  			{
3863  				::SendDlgItemMessage(_hSelf, id, BM_SETCHECK, check ? BST_CHECKED : BST_UNCHECKED, 0);
3864  			};
3865  			checkOrUncheckBtn(IDC_CHECK_CLIPBOARDHISTORY, nppGUI._clipboardHistoryPanelKeepState);
3866  			checkOrUncheckBtn(IDC_CHECK_DOCLIST, nppGUI._docListKeepState);
3867  			checkOrUncheckBtn(IDC_CHECK_CHARPANEL, nppGUI._charPanelKeepState);
3868  			checkOrUncheckBtn(IDC_CHECK_FILEBROWSER, nppGUI._fileBrowserKeepState);
3869  			checkOrUncheckBtn(IDC_CHECK_PROJECTPANEL, nppGUI._projectPanelKeepState);
3870  			checkOrUncheckBtn(IDC_CHECK_DOCMAP, nppGUI._docMapKeepState);
3871  			checkOrUncheckBtn(IDC_CHECK_FUNCLIST, nppGUI._funcListKeepState);
3872  			checkOrUncheckBtn(IDC_CHECK_PLUGINPANEL, nppGUI._pluginPanelKeepState);
3873  			MultiInstSetting multiInstSetting = nppGUI._multiInstSetting;
3874  			::SendDlgItemMessage(_hSelf, IDC_SESSIONININST_RADIO, BM_SETCHECK, multiInstSetting == multiInstOnSession?BST_CHECKED:BST_UNCHECKED, 0);
3875  			::SendDlgItemMessage(_hSelf, IDC_MULTIINST_RADIO, BM_SETCHECK, multiInstSetting == multiInst?BST_CHECKED:BST_UNCHECKED, 0);
3876  			::SendDlgItemMessage(_hSelf, IDC_MONOINST_RADIO, BM_SETCHECK, multiInstSetting == monoInst?BST_CHECKED:BST_UNCHECKED, 0);
3877  			::SendDlgItemMessage(_hSelf, IDD_DATETIMEFORMAT_REVERSEORDER_CHECK, BM_SETCHECK, nppGUI._dateTimeReverseDefaultOrder ? BST_CHECKED : BST_UNCHECKED, 0);
3878  			::SetDlgItemText(_hSelf, IDC_DATETIMEFORMAT_EDIT, nppGUI._dateTimeFormat.c_str());
3879  			generic_string datetimeStr = getDateTimeStrFrom(nppGUI._dateTimeFormat, _BTTF_time);
3880  			::SetDlgItemText(_hSelf, IDD_DATETIMEFORMAT_RESULT_STATIC, datetimeStr.c_str());
3881  			return TRUE;
3882  		}
3883  		case WM_CTLCOLOREDIT:
3884  		{
3885  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
3886  		}
3887  		case WM_CTLCOLORDLG:
3888  		case WM_CTLCOLORSTATIC:
3889  		{
3890  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
3891  		}
3892  		case WM_PRINTCLIENT:
3893  		{
3894  			if (NppDarkMode::isEnabled())
3895  			{
3896  				return TRUE;
3897  			}
3898  			break;
3899  		}
3900  		case WM_COMMAND : 
3901  		{
3902  			if (HIWORD(wParam) == EN_CHANGE &amp;&amp; LOWORD(wParam) == IDC_DATETIMEFORMAT_EDIT)
3903  			{
3904  				constexpr size_t inputLen = 256;
3905  				TCHAR input[inputLen]{};
3906  				::GetDlgItemText(_hSelf, IDC_DATETIMEFORMAT_EDIT, input, inputLen);
3907  				nppGUI._dateTimeFormat = input;
3908  				generic_string datetimeStr = getDateTimeStrFrom(nppGUI._dateTimeFormat, _BTTF_time);
3909  				::SetDlgItemText(_hSelf, IDD_DATETIMEFORMAT_RESULT_STATIC, datetimeStr.c_str());
3910  				return TRUE;
3911  			}
3912  			switch (wParam)
3913  			{
3914  				case IDC_SESSIONININST_RADIO :
3915  				{
3916  					nppGUI._multiInstSetting = multiInstOnSession;
3917  				}
3918  				break;
3919  				case IDC_MULTIINST_RADIO :
3920  				{
3921  					nppGUI._multiInstSetting = multiInst;
3922  				}
3923  				break;
3924  				case IDC_MONOINST_RADIO :
3925  				{
3926  					nppGUI._multiInstSetting = monoInst;
3927  				}
3928  				break;
3929  				case IDD_DATETIMEFORMAT_REVERSEORDER_CHECK:
3930  				{
3931  					nppGUI._dateTimeReverseDefaultOrder = isCheckedOrNot(IDD_DATETIMEFORMAT_REVERSEORDER_CHECK);
3932  				}
3933  				break;
3934  				case IDC_CHECK_CLIPBOARDHISTORY:
3935  				{
3936  					nppGUI._clipboardHistoryPanelKeepState = isCheckedOrNot(IDC_CHECK_CLIPBOARDHISTORY);
3937  				}
3938  				break;
3939  				case IDC_CHECK_DOCLIST:
3940  				{
3941  					nppGUI._docListKeepState = isCheckedOrNot(IDC_CHECK_DOCLIST);
3942  				}
3943  				break;
3944  				case IDC_CHECK_CHARPANEL:
3945  				{
3946  					nppGUI._charPanelKeepState = isCheckedOrNot(IDC_CHECK_CHARPANEL);
3947  				}
3948  				break;
3949  				case IDC_CHECK_FILEBROWSER:
3950  				{
3951  					nppGUI._fileBrowserKeepState = isCheckedOrNot(IDC_CHECK_FILEBROWSER);
3952  				}
3953  				break;
3954  				case IDC_CHECK_PROJECTPANEL:
3955  				{
3956  					nppGUI._projectPanelKeepState = isCheckedOrNot(IDC_CHECK_PROJECTPANEL);
3957  				}
3958  				break;
3959  				case IDC_CHECK_DOCMAP:
3960  				{
3961  					nppGUI._docMapKeepState = isCheckedOrNot(IDC_CHECK_DOCMAP);
3962  				}
3963  				break;
3964  				case IDC_CHECK_FUNCLIST:
3965  				{
3966  					nppGUI._funcListKeepState = isCheckedOrNot(IDC_CHECK_FUNCLIST);
3967  				}
3968  				break;
3969  				case IDC_CHECK_PLUGINPANEL:
3970  				{
3971  					nppGUI._pluginPanelKeepState = isCheckedOrNot(IDC_CHECK_PLUGINPANEL);
3972  				}
3973  				break;
3974  				default :
3975  					return FALSE;
3976  			}
3977  		}
3978  		break;
3979  	}
3980  	return FALSE;
3981  }
3982  void DelimiterSubDlg::detectSpace(const char *text2Check, int &amp; nbSp, int &amp; nbTab) const
3983  {
3984  	nbSp = nbTab = 0;
3985  	for (size_t i = 0; i &lt; strlen(text2Check); ++i)
3986  	{
3987  		if (text2Check[i] == &#x27; &#x27;)
3988  			++nbSp;
3989  		else if (text2Check[i] == &#x27;\t&#x27;)
3990  			++nbTab;
3991  	}
3992  }
3993  generic_string DelimiterSubDlg::getWarningText(size_t nbSp, size_t nbTab) const
3994  {
3995  	NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
3996  	generic_string msg;
3997  	if (nbSp &amp;&amp; nbTab)
3998  	{
3999  		generic_string nbSpStr = std::to_wstring(nbSp);
4000  		generic_string nbTabStr = std::to_wstring(nbTab);
4001  		generic_string warnBegin = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-begin&quot;, TEXT(&quot;&quot;));
4002  		generic_string space = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-space-warning&quot;, TEXT(&quot;&quot;));
4003  		generic_string tab = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-tab-warning&quot;, TEXT(&quot;&quot;));
4004  		generic_string warnEnd = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-end&quot;, TEXT(&quot;&quot;));
4005  		if (!warnBegin.empty() &amp;&amp; !space.empty() &amp;&amp; !tab.empty() &amp;&amp; !warnEnd.empty())
4006  		{
4007  			space = stringReplace(space, TEXT(&quot;$INT_REPLACE$&quot;), nbSpStr);
4008  			tab = stringReplace(tab, TEXT(&quot;$INT_REPLACE$&quot;), nbTabStr);
4009  			msg = warnBegin;
4010  			msg += space;
4011  			msg += TEXT(&quot; &amp;&amp; &quot;);
4012  			msg += tab;
4013  			msg += warnEnd;
4014  		}
4015  		else
4016  		{
4017  			msg = TEXT(&quot;Be aware: &quot;);
4018  			msg += nbSpStr;
4019  			msg += TEXT(&quot; space(s) &amp;&amp; &quot;);
4020  			msg += std::to_wstring(nbTab);
4021  			msg += TEXT(&quot; TAB(s) in your character list.&quot;);
4022  		}
4023  	}
4024  	else if (nbSp &amp;&amp; !nbTab)
4025  	{
4026  		generic_string nbSpStr = std::to_wstring(nbSp);
4027  		generic_string warnBegin = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-begin&quot;, TEXT(&quot;&quot;));
4028  		generic_string space = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-space-warning&quot;, TEXT(&quot;&quot;));
4029  		generic_string warnEnd = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-end&quot;, TEXT(&quot;&quot;));
4030  		if (!warnBegin.empty() &amp;&amp; !space.empty() &amp;&amp; !warnEnd.empty())
4031  		{
4032  			space = stringReplace(space, TEXT(&quot;$INT_REPLACE$&quot;), nbSpStr);
4033  			msg = warnBegin;
4034  			msg += space;
4035  			msg += warnEnd;
4036  		}
4037  		else
4038  		{
4039  			msg = TEXT(&quot;Be aware: &quot;);
4040  			msg += std::to_wstring(nbSp);
4041  			msg += TEXT(&quot; space(s) in your character list.&quot;);
4042  		}
4043  	}
4044  	else if (!nbSp &amp;&amp; nbTab)
4045  	{
4046  		generic_string nbTabStr = std::to_wstring(nbTab);
4047  		generic_string warnBegin = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-begin&quot;, TEXT(&quot;&quot;));
4048  		generic_string tab = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-tab-warning&quot;, TEXT(&quot;&quot;));
4049  		generic_string warnEnd = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-end&quot;, TEXT(&quot;&quot;));
4050  		if (!warnBegin.empty() &amp;&amp; !tab.empty() &amp;&amp; !warnEnd.empty())
4051  		{
4052  			tab = stringReplace(tab, TEXT(&quot;$INT_REPLACE$&quot;), nbTabStr);
4053  			msg = warnBegin;
4054  			msg += tab;
4055  			msg += warnEnd;
4056  		}
4057  		else
4058  		{
4059  			msg = TEXT(&quot;Be aware: &quot;);
4060  			msg += std::to_wstring(nbTab);
4061  			msg += TEXT(&quot; TAB(s) in your character list.&quot;);
4062  		}
4063  	}
4064  	else 
4065  	{
4066  	}
4067  	return msg;
4068  }
4069  void DelimiterSubDlg::setWarningIfNeed() const
4070  {
4071  	generic_string msg;
4072  	NppGUI &amp; nppGUI = (NppParameters::getInstance()).getNppGUI();
4073  	if (!nppGUI._isWordCharDefault)
4074  	{
4075  		int nbSp = 0;
4076  		int nbTab = 0;
4077  		detectSpace(nppGUI._customWordChars.c_str(), nbSp, nbTab);
4078  		msg = getWarningText(nbSp, nbTab);
4079  	}
4080  	::SetDlgItemText(_hSelf, IDD_STATIC_WORDCHAR_WARNING, msg.c_str());
4081  }
4082  intptr_t CALLBACK DelimiterSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
4083  {
4084  	NppGUI &amp; nppGUI = (NppParameters::getInstance()).getNppGUI();
4085  	switch (message) 
4086  	{
4087  		case WM_INITDIALOG :
4088  		{
4089  			TCHAR opener[2]{};
4090  			opener[0] = nppGUI._leftmostDelimiter;
4091  			opener[1] = &#x27;\0&#x27;;
4092  			TCHAR closer[2]{};
4093  			closer[0] = nppGUI._rightmostDelimiter;
4094  			closer[1] = &#x27;\0&#x27;;
4095  			bool onSeveralLines = nppGUI._delimiterSelectionOnEntireDocument;
4096  			::SendDlgItemMessage(_hSelf, IDC_EDIT_OPENDELIMITER, EM_LIMITTEXT, 1, 0);
4097  			::SendDlgItemMessage(_hSelf, IDC_EDIT_CLOSEDELIMITER, EM_LIMITTEXT, 1, 0);
4098  			::SendDlgItemMessage(_hSelf, IDC_EDIT_OPENDELIMITER, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(opener));
4099  			::SendDlgItemMessage(_hSelf, IDC_EDIT_CLOSEDELIMITER, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(closer));
4100  			::SendDlgItemMessage(_hSelf, IDD_SEVERALLINEMODEON_CHECK, BM_SETCHECK, onSeveralLines?BST_CHECKED:BST_UNCHECKED, 0);
4101  			POINT point = getTopPoint(::GetDlgItem(_hSelf, IDD_STATIC_BLABLA), false);
4102  			_singleLineModePoint.x = point.x + 4;
4103  			_singleLineModePoint.y = point.y - 4;
4104  			point = getTopPoint(::GetDlgItem(_hSelf, IDD_STATIC_BLABLA2NDLINE), false);
4105  			_multiLineModePoint.x = point.x + 4;
4106  			_multiLineModePoint.y = point.y - 4;
4107  			::GetClientRect(::GetDlgItem(_hSelf, IDC_EDIT_CLOSEDELIMITER), &amp;_closerRect);
4108  			_closerRect.right = _closerRect.right - _closerRect.left + 4;
4109  			_closerRect.bottom = _closerRect.bottom - _closerRect.top + 4;
4110  			::GetClientRect(::GetDlgItem(_hSelf, IDD_STATIC_CLOSEDELIMITER), &amp;_closerLabelRect);
4111  			_closerLabelRect.right = _closerLabelRect.right - _closerLabelRect.left + 4;
4112  			_closerLabelRect.bottom = _closerLabelRect.bottom - _closerLabelRect.top + 4;
4113  			::ShowWindow(::GetDlgItem(_hSelf, IDD_STATIC_BLABLA2NDLINE),onSeveralLines?SW_SHOW:SW_HIDE);
4114  			POINT *p = onSeveralLines?&amp;_multiLineModePoint:&amp;_singleLineModePoint;
4115  			::MoveWindow(::GetDlgItem(_hSelf, IDC_EDIT_CLOSEDELIMITER), p-&gt;x, p-&gt;y, _closerRect.right, _closerRect.bottom, TRUE);
4116  			::MoveWindow(::GetDlgItem(_hSelf, IDD_STATIC_CLOSEDELIMITER), p-&gt;x + _closerRect.right + 4, p-&gt;y + 4, _closerLabelRect.right, _closerLabelRect.bottom, TRUE);
4117  			::SetDlgItemTextA(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT, nppGUI._customWordChars.c_str());
4118  			::SendDlgItemMessage(_hSelf, IDC_RADIO_WORDCHAR_DEFAULT, BM_SETCHECK, nppGUI._isWordCharDefault ? BST_CHECKED : BST_UNCHECKED, 0);
4119  			::SendDlgItemMessage(_hSelf, IDC_RADIO_WORDCHAR_CUSTOM, BM_SETCHECK, !nppGUI._isWordCharDefault ? BST_CHECKED : BST_UNCHECKED, 0);
4120  			::EnableWindow(::GetDlgItem(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT), !nppGUI._isWordCharDefault);
4121  			setWarningIfNeed();
4122  			NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
4123  			generic_string tip2show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-tip&quot;, TEXT(&quot;This allows you to include additional character into current word characters while double clicking for selection or searching with \&quot;Match whole word only\&quot; option checked.&quot;));
4124  			_tip = CreateToolTip(IDD_WORDCHAR_QUESTION_BUTTON, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tip2show.c_str()), pNativeSpeaker-&gt;isRTL());
4125  			if (_tip)
4126  			{
4127  				SendMessage(_tip, TTM_SETDELAYTIME, TTDT_AUTOPOP, MAKELPARAM((30000), (0)));
4128  			}
4129  			return TRUE;
4130  		}
4131  		case WM_CTLCOLOREDIT:
4132  		{
4133  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
4134  		}
4135  		case WM_CTLCOLORDLG:
4136  		{
4137  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4138  		}
4139  		case WM_CTLCOLORSTATIC:
4140  		{
4141  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
4142  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
4143  			bool isBlabla = (dlgCtrlID == IDD_STATIC_BLABLA) || (dlgCtrlID == IDD_STATIC_BLABLA2NDLINE);
4144  			if (NppDarkMode::isEnabled())
4145  			{
4146  				if (isBlabla)
4147  				{
4148  					return NppDarkMode::onCtlColor(hdcStatic);
4149  				}
4150  				return NppDarkMode::onCtlColorDarker(hdcStatic);
4151  			}
4152  			else if (isBlabla)
4153  			{
4154  				COLORREF bgColor = getCtrlBgColor(_hSelf);
4155  				SetTextColor(hdcStatic, RGB(0, 0, 0));
4156  				BYTE r = GetRValue(bgColor) - 30;
4157  				BYTE g = MyGetGValue(bgColor) - 30;
4158  				BYTE b = GetBValue(bgColor) - 30;
4159  				SetBkColor(hdcStatic, RGB(r, g, b));
4160  				return TRUE;
4161  			}
4162  			break;
4163  		}
4164  		case WM_PRINTCLIENT:
4165  		{
4166  			if (NppDarkMode::isEnabled())
4167  			{
4168  				return TRUE;
4169  			}
4170  			break;
4171  		}
4172  		case WM_COMMAND : 
4173  		{
4174  			if (HIWORD(wParam) == EN_CHANGE)
4175  			{
4176  				switch (LOWORD(wParam))
4177  				{
4178  					case  IDC_EDIT_OPENDELIMITER:
4179  					{
4180  						TCHAR opener[2] = { &#x27;\0&#x27; };
4181  						::SendDlgItemMessage(_hSelf, IDC_EDIT_OPENDELIMITER, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(opener));
4182  						nppGUI._leftmostDelimiter =  static_cast&lt;char&gt;(opener[0]);
4183  						return TRUE;
4184  					}
4185  					case  IDC_EDIT_CLOSEDELIMITER:
4186  					{
4187  						TCHAR closer[2] = { &#x27;\0&#x27; };
4188  						::SendDlgItemMessage(_hSelf, IDC_EDIT_CLOSEDELIMITER, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(closer));
4189  						nppGUI._rightmostDelimiter =  static_cast&lt;char&gt;(closer[0]);
4190  						return TRUE;
4191  					}
4192  					case  IDC_WORDCHAR_CUSTOM_EDIT:
4193  					{
4194  						char customText[MAX_PATH];
4195  						::GetDlgItemTextA(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT, customText, MAX_PATH-1);
4196  						nppGUI._customWordChars = customText;
4197  						setWarningIfNeed();
4198  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETWORDCHARS, 0, 0);
4199  						return TRUE;
4200  					}
4201  					default:
4202  						return FALSE;
4203  				}
4204  			}
4205  			switch (wParam)
4206  			{
4207  				case IDD_SEVERALLINEMODEON_CHECK :
4208  				{
4209  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDD_SEVERALLINEMODEON_CHECK, BM_GETCHECK, 0, 0));
4210  					nppGUI._delimiterSelectionOnEntireDocument = isChecked;
4211  					::ShowWindow(::GetDlgItem(_hSelf, IDD_STATIC_BLABLA2NDLINE),isChecked?SW_SHOW:SW_HIDE);
4212  					POINT *p = isChecked?&amp;_multiLineModePoint:&amp;_singleLineModePoint;
4213  					::MoveWindow(::GetDlgItem(_hSelf, IDC_EDIT_CLOSEDELIMITER), p-&gt;x, p-&gt;y, _closerRect.right, _closerRect.bottom, TRUE);
4214  					::MoveWindow(::GetDlgItem(_hSelf, IDD_STATIC_CLOSEDELIMITER), p-&gt;x + _closerRect.right + 4, p-&gt;y + 4, _closerLabelRect.right, _closerLabelRect.bottom, TRUE);
4215  					return TRUE;
4216  				}
4217  				case IDC_RADIO_WORDCHAR_DEFAULT:
4218  				{
4219  					::SendDlgItemMessage(_hSelf, IDC_RADIO_WORDCHAR_CUSTOM, BM_SETCHECK, BST_UNCHECKED, 0);
4220  					nppGUI._isWordCharDefault = true;
4221  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETWORDCHARS, 0, 0);
4222  					::EnableWindow(::GetDlgItem(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT), !nppGUI._isWordCharDefault);
4223  					::SetDlgItemText(_hSelf, IDD_STATIC_WORDCHAR_WARNING, TEXT(&quot;&quot;));
4224  					return TRUE;
4225  				}
4226  				case IDC_RADIO_WORDCHAR_CUSTOM:
4227  				{
4228  					::SendDlgItemMessage(_hSelf, IDC_RADIO_WORDCHAR_DEFAULT, BM_SETCHECK, BST_UNCHECKED, 0);
4229  					nppGUI._isWordCharDefault = false;
4230  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETWORDCHARS, 0, 0);
4231  					::EnableWindow(::GetDlgItem(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT), !nppGUI._isWordCharDefault);
4232  					setWarningIfNeed();
4233  					return TRUE;
4234  				}
4235  				default :
4236  					return FALSE;
4237  			}
4238  		}
4239  		break;
4240  	}
4241  	return FALSE;
4242  }
4243  intptr_t CALLBACK CloudAndLinkSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
4244  {
4245  	NppParameters&amp; nppParams = NppParameters::getInstance();
4246  	NppGUI &amp; nppGUI = nppParams.getNppGUI();
4247  	const size_t uriSchemesMaxLength = 2048;
4248  	if (HIWORD(wParam) == EN_CHANGE)
4249  	{
4250  		switch (LOWORD(wParam))
4251  		{
4252  			case  IDC_CLOUDPATH_EDIT:
4253  			{
4254  				TCHAR inputDir[MAX_PATH] = {&#x27;\0&#x27;};
4255  				TCHAR inputDirExpanded[MAX_PATH] = {&#x27;\0&#x27;};
4256  				::SendDlgItemMessage(_hSelf, IDC_CLOUDPATH_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(inputDir));
4257  				::ExpandEnvironmentStrings(inputDir, inputDirExpanded, MAX_PATH);
4258  				NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
4259  				if (::PathFileExists(inputDirExpanded))
4260  				{
4261  					nppGUI._cloudPath = inputDirExpanded;
4262  					nppParams.setCloudChoice(inputDirExpanded);
4263  					generic_string message;
4264  					if (nppParams.isCloudPathChanged())
4265  					{
4266  						message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-restart-warning&quot;, TEXT(&quot;Please restart Notepad++ to take effect.&quot;));
4267  					}
4268  					::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4269  				}
4270  				else
4271  				{
4272  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_WITHCLOUD_RADIO, BM_GETCHECK, 0, 0));
4273  					if (isChecked)
4274  					{
4275  						generic_string message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-invalid-warning&quot;, TEXT(&quot;Invalid path.&quot;));
4276  						::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4277  						nppParams.removeCloudChoice();
4278  					}
4279  				}
4280  				return TRUE;
4281  			}
4282  			case IDC_URISCHEMES_EDIT:
4283  			{
4284  				TCHAR uriScheme[uriSchemesMaxLength] = { &#x27;\0&#x27; };
4285  				::SendDlgItemMessage(_hSelf, IDC_URISCHEMES_EDIT, WM_GETTEXT, uriSchemesMaxLength, reinterpret_cast&lt;LPARAM&gt;(uriScheme));
4286  				nppGUI._uriSchemes = uriScheme;
4287  				HWND grandParent = ::GetParent(_hParent);
4288  				::SendMessage(grandParent, NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4289  				return TRUE;
4290  			}
4291  		}
4292  	}
4293  	switch (message)
4294  	{
4295  		case WM_INITDIALOG:
4296  		{
4297  			generic_string message = TEXT(&quot;&quot;);
4298  			bool withCloud = nppGUI._cloudPath != TEXT(&quot;&quot;);
4299  			if (withCloud)
4300  			{
4301  				if (!::PathFileExists(nppGUI._cloudPath.c_str()))
4302  					message = TEXT(&quot;Invalid path&quot;);
4303  			}
4304  			::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4305  			::SendDlgItemMessage(_hSelf, IDC_NOCLOUD_RADIO, BM_SETCHECK, !withCloud ? BST_CHECKED : BST_UNCHECKED, 0);
4306  			::SendDlgItemMessage(_hSelf, IDC_WITHCLOUD_RADIO, BM_SETCHECK, withCloud ? BST_CHECKED : BST_UNCHECKED, 0);
4307  			::SendDlgItemMessage(_hSelf, IDC_CLOUDPATH_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._cloudPath.c_str()));
4308  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CLOUDPATH_EDIT), withCloud);
4309  			::EnableWindow(::GetDlgItem(_hSelf, IDD_CLOUDPATH_BROWSE_BUTTON), withCloud);
4310  			BOOL linkEnable = nppGUI._styleURL != urlDisable;
4311  			BOOL dontUnderline = (nppGUI._styleURL == urlNoUnderLineFg) || (nppGUI._styleURL == urlNoUnderLineBg);
4312  			BOOL roundBoxMode = (nppGUI._styleURL == urlNoUnderLineBg) || (nppGUI._styleURL == urlUnderLineBg);
4313  			::SendDlgItemMessage(_hSelf, IDC_URISCHEMES_EDIT, EM_SETLIMITTEXT, uriSchemesMaxLength, 0);
4314  			::SetWindowText(::GetDlgItem(_hSelf, IDC_URISCHEMES_EDIT), nppGUI._uriSchemes.c_str());
4315  			::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_ENABLE, BM_SETCHECK, linkEnable, 0);
4316  			::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_NOUNDERLINE, BM_SETCHECK, dontUnderline, 0);
4317  			::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_FULLBOXMODE, BM_SETCHECK, roundBoxMode, 0);
4318  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_CLICKABLELINK_NOUNDERLINE), linkEnable);
4319  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_CLICKABLELINK_FULLBOXMODE), linkEnable);
4320  			::EnableWindow(::GetDlgItem(_hSelf, IDC_URISCHEMES_EDIT), linkEnable);
4321  			return TRUE;
4322  		}
4323  		case WM_CTLCOLOREDIT:
4324  		{
4325  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
4326  		}
4327  		case WM_CTLCOLORDLG:
4328  		{
4329  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4330  		}
4331  		case WM_CTLCOLORSTATIC:
4332  		{
4333  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
4334  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
4335  			bool isStaticText = dlgCtrlID == IDC_URISCHEMES_STATIC;
4336  			if (isStaticText)
4337  			{
4338  				bool isTextEnabled = isCheckedOrNot(IDC_CHECK_CLICKABLELINK_ENABLE);
4339  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
4340  			}
4341  			return NppDarkMode::onCtlColorDarker(hdcStatic);
4342  		}
4343  		case WM_PRINTCLIENT:
4344  		{
4345  			if (NppDarkMode::isEnabled())
4346  			{
4347  				return TRUE;
4348  			}
4349  			break;
4350  		}
4351  		case WM_COMMAND:
4352  		{
4353  			NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
4354  			switch (wParam)
4355  			{
4356  				case IDC_NOCLOUD_RADIO:
4357  				{
4358  					nppGUI._cloudPath = TEXT(&quot;&quot;);
4359  					nppParams.removeCloudChoice();
4360  					generic_string message;
4361  					if (nppParams.isCloudPathChanged())
4362  					{
4363  						message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-restart-warning&quot;, TEXT(&quot;Please restart Notepad++ to take effect.&quot;));
4364  					}
4365  					::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4366  					::SendDlgItemMessage(_hSelf, IDC_CLOUDPATH_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._cloudPath.c_str()));
4367  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CLOUDPATH_EDIT), false);
4368  					::EnableWindow(::GetDlgItem(_hSelf, IDD_CLOUDPATH_BROWSE_BUTTON), false);
4369  				}
4370  				break;
4371  				case IDC_WITHCLOUD_RADIO:
4372  				{
4373  					generic_string message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-invalid-warning&quot;, TEXT(&quot;Invalid path.&quot;));
4374  					::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4375  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CLOUDPATH_EDIT), true);
4376  					::EnableWindow(::GetDlgItem(_hSelf, IDD_CLOUDPATH_BROWSE_BUTTON), true);
4377  				}
4378  				break;
4379  				case IDD_CLOUDPATH_BROWSE_BUTTON:
4380  				{
4381  					generic_string message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-select-folder&quot;, TEXT(&quot;Select a folder from/to where Notepad++ reads/writes its settings&quot;));
4382  					folderBrowser(_hSelf, message, IDC_CLOUDPATH_EDIT);
4383  				}
4384  				break;
4385  				case IDC_CHECK_CLICKABLELINK_ENABLE:
4386  				{
4387  					bool isChecked = isCheckedOrNot(IDC_CHECK_CLICKABLELINK_ENABLE);
4388  					if (!isChecked)
4389  					{
4390  						::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_NOUNDERLINE, BM_SETCHECK, BST_UNCHECKED, 0);
4391  						::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_FULLBOXMODE, BM_SETCHECK, BST_UNCHECKED, 0);
4392  					}
4393  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_CLICKABLELINK_NOUNDERLINE), isChecked);
4394  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_CLICKABLELINK_FULLBOXMODE), isChecked);
4395  					::EnableWindow(::GetDlgItem(_hSelf, IDC_URISCHEMES_EDIT), isChecked);
4396  					redrawDlgItem(IDC_CLICKABLELINK_STATIC);
4397  					nppGUI._styleURL = isChecked ? urlUnderLineFg : urlDisable;
4398  					HWND grandParent = ::GetParent(_hParent);
4399  					::SendMessage(grandParent, NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4400  				}
4401  				return TRUE;
4402  				case IDC_CHECK_CLICKABLELINK_NOUNDERLINE:
4403  				case IDC_CHECK_CLICKABLELINK_FULLBOXMODE:
4404  				{
4405  					bool isNoUnderline = isCheckedOrNot(IDC_CHECK_CLICKABLELINK_NOUNDERLINE);
4406  					bool isRoundBoxMode = isCheckedOrNot(IDC_CHECK_CLICKABLELINK_FULLBOXMODE);
4407  					if (isRoundBoxMode)
4408  						nppGUI._styleURL = isNoUnderline ? urlNoUnderLineBg : urlUnderLineBg;
4409  					else
4410  						nppGUI._styleURL = isNoUnderline ? urlNoUnderLineFg : urlUnderLineFg;
4411  					HWND grandParent = ::GetParent(_hParent);
4412  					::SendMessage(grandParent, NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4413  				}
4414  				return TRUE;
4415  				default:
4416  					return FALSE;
4417  			}
4418  		}																						
4419  	}
4420  	return FALSE;
4421  }
4422  intptr_t CALLBACK PerformanceSubDlg::run_dlgProc(UINT message , WPARAM wParam, LPARAM lParam)
4423  {
4424  	NppGUI&amp; nppGUI = NppParameters::getInstance().getNppGUI();
4425  	if (HIWORD(wParam) == EN_CHANGE)
4426  	{
4427  		switch (LOWORD(wParam))
4428  		{
4429  			case  IDC_EDIT_PERFORMANCE_FILESIZE:
4430  			{
4431  				constexpr int stringSize = 16;
4432  				TCHAR str[stringSize]{};
4433  				::GetDlgItemText(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, str, stringSize);
4434  				if (lstrcmp(str, TEXT(&quot;&quot;)) == 0)
4435  					return TRUE;
4436  				int64_t fileLenInMB = ::GetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, NULL, FALSE);
4437  				if (fileLenInMB &gt; 4096)
4438  				{
4439  					fileLenInMB = 4096;
4440  					::SetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, UINT(fileLenInMB), FALSE);
4441  				}
4442  				nppGUI._largeFileRestriction._largeFileSizeDefInByte = fileLenInMB * 1024 * 1024;
4443  			}
4444  			return TRUE;
4445  		}
4446  	}
4447  	else if (HIWORD(wParam) == EN_KILLFOCUS)
4448  	{
4449  		switch (LOWORD(wParam))
4450  		{
4451  			case  IDC_EDIT_PERFORMANCE_FILESIZE:
4452  			{
4453  				constexpr int stringSize = 16;
4454  				TCHAR str[stringSize]{};
4455  				::GetDlgItemText(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, str, stringSize);
4456  				if (lstrcmp(str, TEXT(&quot;&quot;)) == 0)
4457  				{
4458  					::SetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, (NPP_STYLING_FILESIZE_LIMIT_DEFAULT / 1024) / 1024, FALSE);
4459  					return TRUE;
4460  				}
4461  				int64_t fileLenInMB = ::GetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, NULL, FALSE);
4462  				if (fileLenInMB == 0)
4463  				{
4464  					fileLenInMB = (NPP_STYLING_FILESIZE_LIMIT_DEFAULT / 1024) / 1024;
4465  					::SetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, UINT(fileLenInMB), FALSE);
4466  					return TRUE;
4467  				}
4468  			}
4469  			return TRUE;
4470  		}
4471  	}
4472  	switch (message)
4473  	{
4474  		case WM_INITDIALOG:
4475  		{
4476  			int64_t fileLenInMB = (nppGUI._largeFileRestriction._largeFileSizeDefInByte / 1024) / 1024;
4477  			::SetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, UINT(fileLenInMB), FALSE);
4478  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ENABLE, BM_SETCHECK, nppGUI._largeFileRestriction._isEnabled ? BST_CHECKED : BST_UNCHECKED, 0);
4479  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWBRACEMATCH, BM_SETCHECK, nppGUI._largeFileRestriction._allowBraceMatch ? BST_CHECKED : BST_UNCHECKED, 0);
4480  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWAUTOCOMPLETION, BM_SETCHECK, nppGUI._largeFileRestriction._allowAutoCompletion ? BST_CHECKED : BST_UNCHECKED, 0);
4481  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWSMARTHILITE, BM_SETCHECK, nppGUI._largeFileRestriction._allowSmartHilite ? BST_CHECKED : BST_UNCHECKED, 0);
4482  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWCLICKABLELINK, BM_SETCHECK, nppGUI._largeFileRestriction._allowClickableLink ? BST_CHECKED : BST_UNCHECKED, 0);
4483  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_DEACTIVATEWORDWRAP, BM_SETCHECK, nppGUI._largeFileRestriction._deactivateWordWrap ? BST_CHECKED : BST_UNCHECKED, 0);
4484  			bool largeFileRestrictionEnabled = isCheckedOrNot(IDC_CHECK_PERFORMANCE_ENABLE);
4485  			::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE), largeFileRestrictionEnabled);
4486  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWBRACEMATCH), largeFileRestrictionEnabled);
4487  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWAUTOCOMPLETION), largeFileRestrictionEnabled);
4488  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWSMARTHILITE), largeFileRestrictionEnabled);
4489  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWCLICKABLELINK), largeFileRestrictionEnabled);
4490  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_DEACTIVATEWORDWRAP), largeFileRestrictionEnabled);
4491  			NativeLangSpeaker* pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
4492  			generic_string enablePerfTip = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;largeFileRestriction-tip&quot;, TEXT(&quot;Some features may slow performance in large files. These features can be auto-disabled on opening a large file. You can customize them here.\n\nNOTE:\n1. Modifying options here requires re-open currently opened large files to get proper behavior.\n\n2. If \&quot;Deactivate Word Wrap globally\&quot; is checked and you open a large file, \&quot;Word Wrap\&quot; will be disabled for all files. You can re-enable it via menu \&quot;View-&gt;Word Wrap\&quot;&quot;));
4493  			_largeFileRestrictionTip = CreateToolTip(IDD_PERFORMANCE_TIP_QUESTION_BUTTON, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(enablePerfTip.c_str()), false);
4494  			return TRUE;
4495  		}
4496  		case WM_CTLCOLOREDIT:
4497  		{
4498  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
4499  		}
4500  		case WM_CTLCOLORDLG:
4501  		{
4502  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4503  		}
4504  		case WM_CTLCOLORSTATIC:
4505  		{
4506  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
4507  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
4508  			bool isStaticText = (dlgCtrlID == IDC_STATIC_PERFORMANCE_FILESIZE || dlgCtrlID == IDC_STATIC_PERFORMANCE_MB);
4509  			if (isStaticText)
4510  			{
4511  				bool isTextEnabled = isCheckedOrNot(IDC_CHECK_PERFORMANCE_ENABLE);
4512  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
4513  			}
4514  			if (dlgCtrlID == IDC_EDIT_PERFORMANCE_FILESIZE)
4515  			{
4516  				return NppDarkMode::onCtlColor(hdcStatic);
4517  			}
4518  			return NppDarkMode::onCtlColorDarker(hdcStatic);
4519  		}
4520  		case WM_PRINTCLIENT:
4521  		{
4522  			if (NppDarkMode::isEnabled())
4523  			{
4524  				return TRUE;
4525  			}
4526  			break;
4527  		}
4528  		case WM_COMMAND:
4529  		{
4530  			switch (wParam)
4531  			{
4532  				case IDC_CHECK_PERFORMANCE_ENABLE:
4533  				{
4534  					bool largeFileRestrictionEnabled = isCheckedOrNot(IDC_CHECK_PERFORMANCE_ENABLE);
4535  					nppGUI._largeFileRestriction._isEnabled = largeFileRestrictionEnabled;
4536  					::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE), largeFileRestrictionEnabled);
4537  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWBRACEMATCH), largeFileRestrictionEnabled);
4538  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWAUTOCOMPLETION), largeFileRestrictionEnabled);
4539  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWSMARTHILITE), largeFileRestrictionEnabled);
4540  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWCLICKABLELINK), largeFileRestrictionEnabled);
4541  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_DEACTIVATEWORDWRAP), largeFileRestrictionEnabled);
4542  					redrawDlgItem(IDC_STATIC_PERFORMANCE_FILESIZE);
4543  					redrawDlgItem(IDC_STATIC_PERFORMANCE_MB);
4544  					if (largeFileRestrictionEnabled)
4545  					{
4546  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CLEANSMARTHILITING, 0, 0);
4547  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CLEANBRACEMATCH, 0, 0);
4548  					}
4549  					else
4550  					{
4551  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4552  					}
4553  				}
4554  				return TRUE;
4555  				case IDC_CHECK_PERFORMANCE_ALLOWBRACEMATCH:
4556  				{
4557  					bool isAllowed = isCheckedOrNot(int(wParam));
4558  					nppGUI._largeFileRestriction._allowBraceMatch = isAllowed;
4559  					if (!isAllowed)
4560  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CLEANBRACEMATCH, 0, 0);
4561  				}
4562  				return TRUE;
4563  				case IDC_CHECK_PERFORMANCE_ALLOWAUTOCOMPLETION:
4564  				{
4565  					bool isAllowed = isCheckedOrNot(int(wParam));
4566  					nppGUI._largeFileRestriction._allowAutoCompletion = isAllowed;
4567  				}
4568  				return TRUE;
4569  				case IDC_CHECK_PERFORMANCE_ALLOWSMARTHILITE:
4570  				{
4571  					bool isAllowed = isCheckedOrNot(int(wParam));
4572  					nppGUI._largeFileRestriction._allowSmartHilite = isAllowed;
4573  					if (!isAllowed)
4574  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CLEANSMARTHILITING, 0, 0);
4575  				}
4576  				return TRUE;
4577  				case IDC_CHECK_PERFORMANCE_ALLOWCLICKABLELINK:
4578  				{
4579  					bool isAllowed = isCheckedOrNot(int(wParam));
4580  					nppGUI._largeFileRestriction._allowClickableLink = isAllowed;
4581  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4582  				}
4583  				return TRUE;
4584  				case IDC_CHECK_PERFORMANCE_DEACTIVATEWORDWRAP:
4585  				{
4586  					bool isDeactivated = isCheckedOrNot(int(wParam));
4587  					nppGUI._largeFileRestriction._deactivateWordWrap = isDeactivated;
4588  				}
4589  				return TRUE;
4590  				default:
4591  					return FALSE;
4592  			}
4593  		}
4594  		break;
4595  	}
4596  	return FALSE;
4597  }
4598  intptr_t CALLBACK SearchEngineSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
4599  {
4600  	NppParameters&amp; nppParams = NppParameters::getInstance();
4601  	NppGUI &amp; nppGUI = nppParams.getNppGUI();
4602  	if (HIWORD(wParam) == EN_CHANGE)
4603  	{
4604  		switch (LOWORD(wParam))
4605  		{
4606  			case  IDC_SEARCHENGINE_EDIT:
4607  			{
4608  				TCHAR input[MAX_PATH] = { &#x27;\0&#x27; };
4609  				::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(input));
4610  				nppGUI._searchEngineCustom = input;
4611  				return TRUE;
4612  			}
4613  		}
4614  	}
4615  	switch (message)
4616  	{
4617  		case WM_INITDIALOG:
4618  		{
4619  			if (nppGUI._searchEngineChoice == nppGUI.se_custom)
4620  			{
4621  				if (nppGUI._searchEngineCustom.empty())
4622  				{
4623  					nppGUI._searchEngineChoice = nppGUI.se_google;
4624  				}
4625  			}
4626  			if (nppGUI._searchEngineChoice == nppGUI.se_bing)
4627  				nppGUI._searchEngineChoice = nppGUI.se_duckDuckGo;
4628  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_CUSTOM_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_custom ? BST_CHECKED : BST_UNCHECKED, 0);
4629  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_DUCKDUCKGO_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_duckDuckGo ? BST_CHECKED : BST_UNCHECKED, 0);
4630  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_GOOGLE_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_google ? BST_CHECKED : BST_UNCHECKED, 0);
4631  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_YAHOO_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_yahoo ? BST_CHECKED : BST_UNCHECKED, 0);
4632  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_STACKOVERFLOW_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_stackoverflow ? BST_CHECKED : BST_UNCHECKED, 0);
4633  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._searchEngineCustom.c_str()));
4634  			::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), nppGUI._searchEngineChoice == nppGUI.se_custom);
4635  			return TRUE;
4636  		}
4637  		case WM_CTLCOLOREDIT:
4638  		{
4639  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
4640  		}
4641  		case WM_CTLCOLORDLG:
4642  		case WM_CTLCOLORSTATIC:
4643  		{
4644  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4645  		}
4646  		case WM_PRINTCLIENT:
4647  		{
4648  			if (NppDarkMode::isEnabled())
4649  			{
4650  				return TRUE;
4651  			}
4652  			break;
4653  		}
4654  		case WM_COMMAND:
4655  		{
4656  			switch (wParam)
4657  			{
4658  				case IDC_SEARCHENGINE_DUCKDUCKGO_RADIO:
4659  				{
4660  					nppGUI._searchEngineChoice = nppGUI.se_duckDuckGo;
4661  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), false);
4662  				}
4663  				break;
4664  				case IDC_SEARCHENGINE_GOOGLE_RADIO:
4665  				{
4666  					nppGUI._searchEngineChoice = nppGUI.se_google;
4667  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), false);
4668  				}
4669  				break;
4670  				case IDC_SEARCHENGINE_YAHOO_RADIO:
4671  				{
4672  					nppGUI._searchEngineChoice = nppGUI.se_yahoo;
4673  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), false);
4674  				}
4675  				break;
4676  				case IDC_SEARCHENGINE_STACKOVERFLOW_RADIO:
4677  				{
4678  					nppGUI._searchEngineChoice = nppGUI.se_stackoverflow;
4679  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), false);
4680  				}
4681  				break;
4682  				case IDC_SEARCHENGINE_CUSTOM_RADIO:
4683  				{
4684  					nppGUI._searchEngineChoice = nppGUI.se_custom;
4685  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), true);
4686  				}
4687  				break;
4688  				default:
4689  					return FALSE;
4690  			}
4691  		}
4692  		break;
4693  	}
4694  	return FALSE;
4695  }
4696  intptr_t CALLBACK SearchingSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
4697  {
4698  	NppParameters&amp; nppParams = NppParameters::getInstance();
4699  	NppGUI&amp; nppGUI = nppParams.getNppGUI();
4700  	switch (message)
4701  	{
4702  		case WM_INITDIALOG:
4703  		{
4704  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FILL_FIND_FIELD_WITH_SELECTED, BM_SETCHECK, nppGUI._fillFindFieldWithSelected, 0);
4705  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET, BM_SETCHECK, nppGUI._fillFindFieldSelectCaret, 0);
4706  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MONOSPACEDFONT_FINDDLG, BM_SETCHECK, nppGUI._monospacedFontFindDlg, 0);
4707  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FINDDLG_ALWAYS_VISIBLE, BM_SETCHECK, nppGUI._findDlgAlwaysVisible, 0);
4708  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET), nppGUI._fillFindFieldWithSelected ? TRUE : FALSE);
4709  			::SendDlgItemMessage(_hSelf, IDC_CHECK_CONFIRMREPLOPENDOCS, BM_SETCHECK, nppGUI._confirmReplaceInAllOpenDocs, 0);
4710  			::SendDlgItemMessage(_hSelf, IDC_CHECK_REPLACEANDSTOP, BM_SETCHECK, nppGUI._replaceStopsWithoutFindingNext, 0);
4711  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SHOWONCEPERFOUNDLINE, BM_SETCHECK, nppGUI._finderShowOnlyOneEntryPerFoundLine, 0);
4712  			return TRUE;
4713  		}
4714  		case WM_CTLCOLORDLG:
4715  		case WM_CTLCOLORSTATIC:
4716  		{
4717  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4718  		}
4719  		case WM_PRINTCLIENT:
4720  		{
4721  			if (NppDarkMode::isEnabled())
4722  			{
4723  				return TRUE;
4724  			}
4725  			break;
4726  		}
4727  		case WM_COMMAND:
4728  		{
4729  			switch (wParam)
4730  			{
4731  				case IDC_CHECK_FILL_FIND_FIELD_WITH_SELECTED:
4732  				{
4733  					nppGUI._fillFindFieldWithSelected = isCheckedOrNot(IDC_CHECK_FILL_FIND_FIELD_WITH_SELECTED);
4734  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET), nppGUI._fillFindFieldWithSelected ? TRUE :FALSE);
4735  					if (!nppGUI._fillFindFieldWithSelected) 
4736  					{
4737  						::SendDlgItemMessage(_hSelf, IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET, BM_SETCHECK, BST_UNCHECKED, 0);
4738  						nppGUI._fillFindFieldSelectCaret = false;
4739  					}
4740  					return TRUE;
4741  				}
4742  				break;
4743  				case IDC_CHECK_MONOSPACEDFONT_FINDDLG:
4744  				{
4745  					nppGUI._monospacedFontFindDlg = isCheckedOrNot(IDC_CHECK_MONOSPACEDFONT_FINDDLG);
4746  					return TRUE;
4747  				}
4748  				break;
4749  				case IDC_CHECK_FINDDLG_ALWAYS_VISIBLE:
4750  				{
4751  					nppGUI._findDlgAlwaysVisible = isCheckedOrNot(IDC_CHECK_FINDDLG_ALWAYS_VISIBLE);
4752  					return TRUE;
4753  				}
4754  				break;
4755  				case IDC_CHECK_CONFIRMREPLOPENDOCS:
4756  				{
4757  					nppGUI._confirmReplaceInAllOpenDocs = isCheckedOrNot(IDC_CHECK_CONFIRMREPLOPENDOCS);
4758  					return TRUE;
4759  				}
4760  				break;
4761  				case IDC_CHECK_REPLACEANDSTOP:
4762  				{
4763  					nppGUI._replaceStopsWithoutFindingNext = isCheckedOrNot(IDC_CHECK_REPLACEANDSTOP);
4764  					return TRUE;
4765  				}
4766  				break;
4767  				case IDC_CHECK_SHOWONCEPERFOUNDLINE:
4768  				{
4769  					nppGUI._finderShowOnlyOneEntryPerFoundLine = isCheckedOrNot(IDC_CHECK_SHOWONCEPERFOUNDLINE);
4770  					return TRUE;
4771  				}
4772  				break;
4773  				case IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET:
4774  				{
4775  					nppGUI._fillFindFieldSelectCaret = isCheckedOrNot(IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET);
4776  					return TRUE;
4777  				}
4778  				break;
4779  				default:
4780  					return FALSE;
4781  			}
4782  		}
4783  		break;
4784  	}
4785  	return FALSE;
4786  }
</code></pre>
        </div>
        <div class="column">
            <h3>notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-preferenceDlg.cpp</h3>
            <pre><code>1  #include &lt;shlwapi.h&gt;
2  #include &quot;preferenceDlg.h&quot;
3  #include &quot;lesDlgs.h&quot;
4  #include &quot;EncodingMapper.h&quot;
5  #include &quot;localization.h&quot;
6  #define MyGetGValue(rgb)      (LOBYTE((rgb)&gt;&gt;8))
7  using namespace std;
8  const int BLINKRATE_FASTEST = 50;
9  const int BLINKRATE_SLOWEST = 2500;
10  const int BLINKRATE_INTERVAL = 50;
11  const int CARETLINEFRAME_SMALLEST = 1;
12  const int CARETLINEFRAME_LARGEST = 6;
13  const int CARETLINEFRAME_INTERVAL = 1;
14  const int BORDERWIDTH_SMALLEST = 0;
15  const int BORDERWIDTH_LARGEST = 30;
16  const int BORDERWIDTH_INTERVAL = 1;
17  const int PADDING_SMALLEST = 0;
18  const int PADDING_LARGEST = 30;
19  const int PADDING_INTERVAL = 1;
20  const int DISTRACTIONFREE_SMALLEST = 3;
21  const int DISTRACTIONFREE_LARGEST = 9;
22  const int DISTRACTIONFREE_INTERVAL = 1;
23  constexpr int AUTOCOMPLETEFROMCHAR_SMALLEST = 1;
24  constexpr int AUTOCOMPLETEFROMCHAR_LARGEST = 9;
25  constexpr int AUTOCOMPLETEFROMCHAR_INTERVAL = 1;
26  static int encodings[] = {
27  	1250, 
28  	1251, 
29  	1252, 
30  	1253, 
31  	1254, 
32  	1255, 
33  	1256, 
34  	1257, 
35  	1258, 
36  	28591,
37  	28592,
38  	28593,
39  	28594,
40  	28595,
41  	28596,
42  	28597,
43  	28598,
44  	28599,
45  	28603,
46  	28604,
47  	28605,
48  	437,  
49  	720,  
50  	737,  
51  	775,  
52  	850,  
53  	852,  
54  	855,  
55  	857,  
56  	858,  
57  	860,  
58  	861,  
59  	862,  
60  	863,  
61  	865,  
62  	866,  
63  	869,  
64  	950,  
65  	936,  
66  	932,  
67  	949,  
68  	51949,
69  	874,
70  	10007,
71  	21866,
72  	20866
73  };
74  bool PreferenceDlg::goToSection(size_t iPage, intptr_t ctrlID)
75  {
76  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_SETCURSEL, iPage, 0);
77  	showDialogByIndex(iPage);
78  	getFocus();
79  	if (ctrlID != -1)
80  	{
81  		::SetFocus(::GetDlgItem(_wVector[iPage]._dlg-&gt;getHSelf(), int(ctrlID)));
82  	}
83  	return true;
84  }
85  intptr_t CALLBACK PreferenceDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
86  {
87  	switch (message) 
88  	{
89  		case WM_INITDIALOG :
90  		{
91  			_generalSubDlg.init(_hInst, _hSelf);
92  			_generalSubDlg.create(IDD_PREFERENCE_SUB_GENRAL, false, false);
93  			_generalSubDlg.display();
94  			_editingSubDlg.init(_hInst, _hSelf);
95  			_editingSubDlg.create(IDD_PREFERENCE_SUB_EDITING, false, false);
96  			_darkModeSubDlg.init(_hInst, _hSelf);
97  			_darkModeSubDlg.create(IDD_PREFERENCE_SUB_DARKMODE, false, false);
98  			_marginsBorderEdgeSubDlg.init(_hInst, _hSelf);
99  			_marginsBorderEdgeSubDlg.create(IDD_PREFERENCE_SUB_MARGING_BORDER_EDGE, false, false);
100  			_miscSubDlg.init(_hInst, _hSelf);
101  			_miscSubDlg.create(IDD_PREFERENCE_SUB_MISC, false, false);
102  			_newDocumentSubDlg.init(_hInst, _hSelf);
103  			_newDocumentSubDlg.create(IDD_PREFERENCE_SUB_NEWDOCUMENT, false, false);
104  			_defaultDirectorySubDlg.init(_hInst, _hSelf);
105  			_defaultDirectorySubDlg.create(IDD_PREFERENCE_SUB_DEFAULTDIRECTORY, false, false);
106  			_recentFilesHistorySubDlg.init(_hInst, _hSelf);
107  			_recentFilesHistorySubDlg.create(IDD_PREFERENCE_SUB_RECENTFILESHISTORY, false, false);
108  			_fileAssocDlg.init(_hInst, _hSelf);
109  			_fileAssocDlg.create(IDD_REGEXT_BOX, false, false);
110  			_printSubDlg.init(_hInst, _hSelf);
111  			_printSubDlg.create(IDD_PREFERENCE_SUB_PRINT, false, false);
112  			_searchingSubDlg.init(_hInst, _hSelf);
113  			_searchingSubDlg.create(IDD_PREFERENCE_SUB_SEARCHING, false, false);
114  			_languageSubDlg.init(_hInst, _hSelf);
115  			_languageSubDlg.create(IDD_PREFERENCE_SUB_LANGUAGE, false, false);
116  			_highlightingSubDlg.init(_hInst, _hSelf);
117  			_highlightingSubDlg.create(IDD_PREFERENCE_SUB_HIGHLIGHTING, false, false);
118  			_backupSubDlg.init(_hInst, _hSelf);
119  			_backupSubDlg.create(IDD_PREFERENCE_SUB_BACKUP, false, false);
120  			_autoCompletionSubDlg.init(_hInst, _hSelf);
121  			_autoCompletionSubDlg.create(IDD_PREFERENCE_SUB_AUTOCOMPLETION, false, false);
122  			_multiInstanceSubDlg.init(_hInst, _hSelf);
123  			_multiInstanceSubDlg.create(IDD_PREFERENCE_SUB_MULTIINSTANCE, false, false);
124  			_delimiterSubDlg.init(_hInst, _hSelf);
125  			_delimiterSubDlg.create(IDD_PREFERENCE_SUB_DELIMITER, false, false);
126  			_performanceSubDlg.init(_hInst, _hSelf);
127  			_performanceSubDlg.create(IDD_PREFERENCE_SUB_PERFORMANCE, false, false);
128  			_cloudAndLinkSubDlg.init(_hInst, _hSelf);
129  			_cloudAndLinkSubDlg.create(IDD_PREFERENCE_SUB_CLOUD_LINK, false, false);
130  			_searchEngineSubDlg.init(_hInst, _hSelf);
131  			_searchEngineSubDlg.create(IDD_PREFERENCE_SUB_SEARCHENGINE, false, false);			
132  			_wVector.push_back(DlgInfo(&amp;_generalSubDlg, TEXT(&quot;General&quot;), TEXT(&quot;Global&quot;)));
133  			_wVector.push_back(DlgInfo(&amp;_editingSubDlg, TEXT(&quot;Editing&quot;), TEXT(&quot;Scintillas&quot;)));
134  			_wVector.push_back(DlgInfo(&amp;_darkModeSubDlg, TEXT(&quot;Dark Mode&quot;), TEXT(&quot;DarkMode&quot;)));
135  			_wVector.push_back(DlgInfo(&amp;_marginsBorderEdgeSubDlg, TEXT(&quot;Margins/Border/Edge&quot;), TEXT(&quot;MarginsBorderEdge&quot;)));
136  			_wVector.push_back(DlgInfo(&amp;_newDocumentSubDlg, TEXT(&quot;New Document&quot;), TEXT(&quot;NewDoc&quot;)));
137  			_wVector.push_back(DlgInfo(&amp;_defaultDirectorySubDlg, TEXT(&quot;Default Directory&quot;), TEXT(&quot;DefaultDir&quot;)));
138  			_wVector.push_back(DlgInfo(&amp;_recentFilesHistorySubDlg, TEXT(&quot;Recent Files History&quot;), TEXT(&quot;RecentFilesHistory&quot;)));
139  			_wVector.push_back(DlgInfo(&amp;_fileAssocDlg, TEXT(&quot;File Association&quot;), TEXT(&quot;FileAssoc&quot;)));
140  			_wVector.push_back(DlgInfo(&amp;_languageSubDlg, TEXT(&quot;Language&quot;), TEXT(&quot;Language&quot;)));
141  			_wVector.push_back(DlgInfo(&amp;_highlightingSubDlg, TEXT(&quot;Highlighting&quot;), TEXT(&quot;Highlighting&quot;)));
142  			_wVector.push_back(DlgInfo(&amp;_printSubDlg, TEXT(&quot;Print&quot;), TEXT(&quot;Print&quot;)));
143  			_wVector.push_back(DlgInfo(&amp;_searchingSubDlg, TEXT(&quot;Searching&quot;), TEXT(&quot;Searching&quot;)));
144  			_wVector.push_back(DlgInfo(&amp;_backupSubDlg, TEXT(&quot;Backup&quot;), TEXT(&quot;Backup&quot;)));
145  			_wVector.push_back(DlgInfo(&amp;_autoCompletionSubDlg, TEXT(&quot;Auto-Completion&quot;), TEXT(&quot;AutoCompletion&quot;)));
146  			_wVector.push_back(DlgInfo(&amp;_multiInstanceSubDlg, TEXT(&quot;Multi-Instance &amp; Date&quot;), TEXT(&quot;MultiInstance&quot;)));
147  			_wVector.push_back(DlgInfo(&amp;_delimiterSubDlg, TEXT(&quot;Delimiter&quot;), TEXT(&quot;Delimiter&quot;)));
148  			_wVector.push_back(DlgInfo(&amp;_performanceSubDlg, TEXT(&quot;Performance&quot;), TEXT(&quot;Performance&quot;)));
149  			_wVector.push_back(DlgInfo(&amp;_cloudAndLinkSubDlg, TEXT(&quot;Cloud &amp; Link&quot;), TEXT(&quot;Cloud&quot;)));
150  			_wVector.push_back(DlgInfo(&amp;_searchEngineSubDlg, TEXT(&quot;Search Engine&quot;), TEXT(&quot;SearchEngine&quot;)));
151  			_wVector.push_back(DlgInfo(&amp;_miscSubDlg, TEXT(&quot;MISC.&quot;), TEXT(&quot;MISC&quot;)));
152  			makeCategoryList();
153  			NppDarkMode::autoSubclassAndThemeChildControls(_hSelf);
154  			return TRUE;
155  		}
156  		case WM_CTLCOLORLISTBOX:
157  		{
158  			return NppDarkMode::onCtlColorListbox(wParam, lParam);
159  		}
160  		case WM_CTLCOLORDLG:
161  		case WM_CTLCOLORSTATIC:
162  		{
163  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
164  		}
165  		case WM_PRINTCLIENT:
166  		{
167  			if (NppDarkMode::isEnabled())
168  			{
169  				return TRUE;
170  			}
171  			break;
172  		}
173  		case NPPM_INTERNAL_REFRESHDARKMODE:
174  		{
175  			NppDarkMode::autoThemeChildControls(_hSelf);
176  			if (_editingSubDlg._tip != nullptr)
177  				NppDarkMode::setDarkTooltips(_editingSubDlg._tip, NppDarkMode::ToolTipsType::tooltip);
178  			for (auto&amp; tip : _editingSubDlg._tips)
179  			{
180  				if (tip != nullptr)
181  				{
182  					NppDarkMode::setDarkTooltips(tip, NppDarkMode::ToolTipsType::tooltip);
183  				}
184  			}
185  			if (_delimiterSubDlg._tip != nullptr)
186  				NppDarkMode::setDarkTooltips(_delimiterSubDlg._tip, NppDarkMode::ToolTipsType::tooltip);
187  			if (_performanceSubDlg._largeFileRestrictionTip != nullptr)
188  				NppDarkMode::setDarkTooltips(_performanceSubDlg._largeFileRestrictionTip, NppDarkMode::ToolTipsType::tooltip);
189  			if (NppDarkMode::isEnabled())
190  			{
191  				const NppGUI&amp; nppGUI = NppParameters::getInstance().getNppGUI();
192  				::EnableWindow(::GetDlgItem(_highlightingSubDlg.getHSelf(), IDC_SMARTHILITEMATCHING_STATIC), nppGUI._enableSmartHilite);
193  				const bool noBackup = _backupSubDlg.isCheckedOrNot(IDC_RADIO_BKNONE);
194  				::EnableWindow(::GetDlgItem(_backupSubDlg.getHSelf(), IDC_BACKUPDIR_USERCUSTOMDIR_GRPSTATIC), !noBackup);
195  				const bool isEnableAutoC = _autoCompletionSubDlg.isCheckedOrNot(IDD_AUTOC_ENABLECHECK);
196  				::EnableWindow(::GetDlgItem(_autoCompletionSubDlg.getHSelf(), IDD_AUTOC_USEKEY_GRP_STATIC), isEnableAutoC);
197  			}
198  			return TRUE;
199  		}
200  		case PREF_MSG_SETGUITOOLICONSSET:
201  		{
202  			const HWND generalSubDlg = _generalSubDlg.getHSelf();
203  			auto checkOrUncheckBtn = [&amp;generalSubDlg](int id, WPARAM check = BST_UNCHECKED) -&gt; void
204  			{
205  				::SendDlgItemMessage(generalSubDlg, id, BM_SETCHECK, check, 0);
206  			};
207  			const int iconState = NppDarkMode::getToolBarIconSet(static_cast&lt;bool&gt;(wParam));
208  			NppParameters&amp; nppParams = NppParameters::getInstance();
209  			NppGUI&amp; nppGUI = nppParams.getNppGUI();
210  			if (iconState != -1)
211  			{
212  				nppGUI._toolBarStatus = static_cast&lt;toolBarStatusType&gt;(iconState);
213  			}
214  			else
215  			{
216  				auto state = TB_STANDARD;
217  				if (_generalSubDlg.isCheckedOrNot(IDC_RADIO_SMALLICON))
218  				{
219  					state = TB_SMALL;
220  				}
221  				else if (_generalSubDlg.isCheckedOrNot(IDC_RADIO_BIGICON))
222  				{
223  					state = TB_LARGE;
224  				}
225  				else if (_generalSubDlg.isCheckedOrNot(IDC_RADIO_SMALLICON2))
226  				{
227  					state = TB_SMALL2;
228  				}
229  				else if (_generalSubDlg.isCheckedOrNot(IDC_RADIO_BIGICON2))
230  				{
231  					state = TB_LARGE2;
232  				}
233  				nppGUI._toolBarStatus = state;
234  			}
235  			checkOrUncheckBtn(IDC_RADIO_STANDARD);
236  			checkOrUncheckBtn(IDC_RADIO_SMALLICON);
237  			checkOrUncheckBtn(IDC_RADIO_BIGICON);
238  			checkOrUncheckBtn(IDC_RADIO_SMALLICON2);
239  			checkOrUncheckBtn(IDC_RADIO_BIGICON2);
240  			switch (nppGUI._toolBarStatus)
241  			{
242  				case TB_LARGE:
243  				{
244  					checkOrUncheckBtn(IDC_RADIO_BIGICON, BST_CHECKED);
245  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_ENLARGE, 0);
246  					break;
247  				}
248  				case TB_SMALL2:
249  				{
250  					checkOrUncheckBtn(IDC_RADIO_SMALLICON2, BST_CHECKED);
251  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_REDUCE_SET2, 0);
252  					break;
253  				}
254  				case TB_LARGE2:
255  				{
256  					checkOrUncheckBtn(IDC_RADIO_BIGICON2, BST_CHECKED);
257  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_ENLARGE_SET2, 0);
258  					break;
259  				}
260  				case TB_STANDARD:
261  				{
262  					checkOrUncheckBtn(IDC_RADIO_STANDARD, BST_CHECKED);
263  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_STANDARD, 0);
264  					break;
265  				}
266  				default:
267  				{
268  					checkOrUncheckBtn(IDC_RADIO_SMALLICON, BST_CHECKED);
269  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_REDUCE, 0);
270  				}
271  			}
272  			return TRUE;
273  		}
274  		case PREF_MSG_SETGUITABBARICONS:
275  		{
276  			const int tabIconSet = NppDarkMode::getTabIconSet(static_cast&lt;bool&gt;(wParam));
277  			if (tabIconSet != -1)
278  			{
279  				_generalSubDlg.setTabbarAlternateIcons(tabIconSet == 1);
280  			}
281  			return TRUE;
282  		}
283  		case WM_COMMAND :
284  		{
285  			if (LOWORD(wParam) == IDC_LIST_DLGTITLE)
286  			{
287  				if (HIWORD(wParam) == CBN_SELCHANGE)
288  				{
289  					auto i = ::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_GETCURSEL, 0, 0);
290  					if (i != LB_ERR)
291  					{
292  						showDialogByIndex(i);
293  					}
294  				}
295  			}
296  			else 
297  			{
298  				switch (wParam)
299  				{
300  					case IDC_BUTTON_CLOSE :
301  					case IDCANCEL :
302  						display(false);
303  						return TRUE;
304  					default :
305  						::SendMessage(_hParent, WM_COMMAND, wParam, lParam);
306  						return TRUE;
307  				}
308  			}
309  		}
310  	}
311  	return FALSE;
312  }
313  void PreferenceDlg::makeCategoryList()
314  {
315  	for (size_t i = 0, len = _wVector.size(); i &lt; len; ++i)
316  	{
317  		::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(_wVector[i]._name.c_str()));
318  	}
319  	setListSelection(0);
320  }
321  int32_t PreferenceDlg::getIndexFromName(const TCHAR *name) const
322  {
323  	if (!name)
324  		return -1;
325  	int32_t i = 0;
326  	for (auto it = _wVector.begin() ; it != _wVector.end(); ++it, ++i)
327  	{
328  		if (it-&gt;_internalName == name)
329  			return i;
330  	}
331  	return -1;
332  }
333  bool PreferenceDlg::setListSelection(size_t currentSel) const
334  {
335  	const size_t selStrLenMax = 255;
336  	TCHAR selStr[selStrLenMax + 1] = { &#x27;\0&#x27; };
337  	auto lbTextLen = ::SendMessage(_hSelf, LB_GETTEXTLEN, currentSel, 0);
338  	if (static_cast&lt;size_t&gt;(lbTextLen) &gt; selStrLenMax)
339  		return false;
340  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_GETTEXT, currentSel, reinterpret_cast&lt;LPARAM&gt;(selStr));
341  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_SELECTSTRING, currentSel, reinterpret_cast&lt;LPARAM&gt;(selStr));
342  	return true;
343  }
344  bool PreferenceDlg::renameDialogTitle(const TCHAR *internalName, const TCHAR *newName)
345  {
346  	bool foundIt = false;
347  	size_t i = 0;
348  	for (size_t len = _wVector.size(); i &lt; len; ++i)
349  	{
350  		if (_wVector[i]._internalName == internalName)
351  		{
352  			foundIt = true;
353  			break;
354  		}
355  	}
356  	if (!foundIt)
357  		return false;
358  	const size_t lenMax = 256;
359  	TCHAR oldName[lenMax] = { &#x27;\0&#x27; };
360  	size_t txtLen = ::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_GETTEXTLEN, i, 0);
361  	if (txtLen &gt;= lenMax)
362  		return false;
363  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_GETTEXT, i, reinterpret_cast&lt;LPARAM&gt;(oldName));
364  	if (lstrcmp(newName, oldName) == 0)
365  		return true;
366  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_DELETESTRING, i, 0);
367  	::SendDlgItemMessage(_hSelf, IDC_LIST_DLGTITLE, LB_INSERTSTRING, i, reinterpret_cast&lt;LPARAM&gt;(newName));
368  	return true;
369  }
370  void PreferenceDlg::showDialogByName(const TCHAR *name) const
371  {
372  	int32_t i = getIndexFromName(name);
373  	if (i &gt;= 0)
374  	{
375  		showDialogByIndex(i);
376  		setListSelection(i);
377  	}
378  }
379  void PreferenceDlg::showDialogByIndex(size_t index) const
380  {
381  	size_t len = _wVector.size();
382  	for (size_t i = 0; i &lt; len; ++i)
383  	{
384  		_wVector[i]._dlg-&gt;display(false);
385  	}
386  	_wVector[index]._dlg-&gt;display(true);
387  }
388  void PreferenceDlg::destroy()
389  {
390  	_generalSubDlg.destroy();
391  	_editingSubDlg.destroy();
392  	_darkModeSubDlg.destroy();
393  	_marginsBorderEdgeSubDlg.destroy();
394  	_miscSubDlg.destroy();
395  	_fileAssocDlg.destroy();
396  	_languageSubDlg.destroy();
397  	_highlightingSubDlg.destroy();
398  	_printSubDlg.destroy();
399  	_searchingSubDlg.destroy();
400  	_newDocumentSubDlg.destroy();
401  	_defaultDirectorySubDlg.destroy();
402  	_recentFilesHistorySubDlg.destroy();
403  	_backupSubDlg.destroy();
404  	_autoCompletionSubDlg.destroy();
405  	_multiInstanceSubDlg.destroy();
406  	_delimiterSubDlg.destroy();
407  	_performanceSubDlg.destroy();
408  }
409  void GeneralSubDlg::setTabbarAlternateIcons(bool enable)
410  {
411  	NppGUI&amp; nppGUI = NppParameters::getInstance().getNppGUI();
412  	if (!enable)
413  	{
414  		nppGUI._tabStatus &amp;= ~TAB_ALTICONS;
415  		::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_ALTICONS, BM_SETCHECK, BST_UNCHECKED, 0);
416  	}
417  	else
418  	{
419  		nppGUI._tabStatus |= TAB_ALTICONS;
420  		::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_ALTICONS, BM_SETCHECK, BST_CHECKED, 0);
421  	}
422  }
423  intptr_t CALLBACK GeneralSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
424  {
425  	NppParameters&amp; nppParam = NppParameters::getInstance();
426  	switch (message) 
427  	{
428  		case WM_INITDIALOG :
429  		{
430  			const NppGUI &amp; nppGUI = nppParam.getNppGUI();
431  			toolBarStatusType tbStatus = nppGUI._toolBarStatus;
432  			int tabBarStatus = nppGUI._tabStatus;
433  			bool showTool = nppGUI._toolbarShow;
434  			bool showStatus = nppGUI._statusBarShow;
435  			bool showMenu = nppGUI._menuBarShow;
436  			bool hideRightShortcutsFromMenu = nppGUI._hideMenuRightShortcuts;
437  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDE, BM_SETCHECK, showTool?BST_UNCHECKED:BST_CHECKED, 0);
438  			int ID2Check = 0;
439  			switch (tbStatus)
440  			{
441  				case TB_SMALL :
442  					ID2Check = IDC_RADIO_SMALLICON;
443  					break;
444  				case TB_LARGE :
445  					ID2Check = IDC_RADIO_BIGICON;
446  					break;
447  				case TB_SMALL2 :
448  					ID2Check = IDC_RADIO_SMALLICON2;
449  					break;
450  				case TB_LARGE2 :
451  					ID2Check = IDC_RADIO_BIGICON2;
452  					break;
453  				case TB_STANDARD:
454  				default :
455  					ID2Check = IDC_RADIO_STANDARD;
456  			}
457  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
458  			::SendDlgItemMessage(_hSelf, IDC_CHECK_REDUCE, BM_SETCHECK, tabBarStatus &amp; TAB_REDUCE, 0);
459  			::SendDlgItemMessage(_hSelf, IDC_CHECK_LOCK, BM_SETCHECK, !(tabBarStatus &amp; TAB_DRAGNDROP), 0);
460  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ORANGE, BM_SETCHECK, tabBarStatus &amp; TAB_DRAWTOPBAR, 0);
461  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DRAWINACTIVE, BM_SETCHECK, tabBarStatus &amp; TAB_DRAWINACTIVETAB, 0);
462  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLETABCLOSE, BM_SETCHECK, tabBarStatus &amp; TAB_CLOSEBUTTON, 0);
463  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DBCLICK2CLOSE, BM_SETCHECK, tabBarStatus &amp; TAB_DBCLK2CLOSE, 0);
464  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_VERTICAL, BM_SETCHECK, tabBarStatus &amp; TAB_VERTICAL, 0);
465  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_MULTILINE, BM_SETCHECK, tabBarStatus &amp; TAB_MULTILINE, 0);
466  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_LAST_EXIT, BM_SETCHECK, tabBarStatus &amp; TAB_QUITONEMPTY, 0);
467  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_ALTICONS, BM_SETCHECK, tabBarStatus &amp; TAB_ALTICONS, 0);
468  			::SendDlgItemMessage(_hSelf, IDC_CHECK_TAB_HIDE, BM_SETCHECK, tabBarStatus &amp; TAB_HIDE, 0);
469  			::SendMessage(_hSelf, WM_COMMAND, IDC_CHECK_TAB_HIDE, 0);
470  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDESTATUSBAR, BM_SETCHECK, !showStatus, 0);
471  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDEMENUBAR, BM_SETCHECK, !showMenu, 0);
472  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDERIGHTSHORTCUTSOFMENUBAR, BM_SETCHECK, hideRightShortcutsFromMenu, 0);
473  			LocalizationSwitcher &amp; localizationSwitcher = nppParam.getLocalizationSwitcher();
474  			for (size_t i = 0, len = localizationSwitcher.size(); i &lt; len ; ++i)
475  			{
476  				pair&lt;wstring, wstring&gt; localizationInfo = localizationSwitcher.getElementFromIndex(i);
477  				::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(localizationInfo.first.c_str()));
478  			}
479  			wstring lang = TEXT(&quot;English&quot;); 
480  			if (nppParam.getNativeLangA()) 
481  			{
482  				string fn = localizationSwitcher.getFileName();
483  				wstring fnW = s2ws(fn);
484  				lang = localizationSwitcher.getLangFromXmlFileName(fnW.c_str());
485  			}
486  			auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(lang.c_str()));
487  			if (index != CB_ERR)
488                  ::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_SETCURSEL, index, 0);
489  			return TRUE;
490  		}
491  		case WM_CTLCOLORLISTBOX:
492  		{
493  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
494  		}
495  		case WM_CTLCOLORDLG:
496  		case WM_CTLCOLORSTATIC:
497  		{
498  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
499  		}
500  		case WM_PRINTCLIENT:
501  		{
502  			if (NppDarkMode::isEnabled())
503  			{
504  				return TRUE;
505  			}
506  			break;
507  		}
508  		case WM_COMMAND:
509  		{
510  			switch (wParam)
511  			{
512  				case IDC_CHECK_HIDESTATUSBAR:
513  				{
514  					const bool isChecked = isCheckedOrNot(IDC_CHECK_HIDESTATUSBAR);
515  					::SendMessage(::GetParent(_hParent), NPPM_HIDESTATUSBAR, 0, isChecked ? TRUE : FALSE);
516  				}
517  				return TRUE;
518  				case IDC_CHECK_HIDEMENUBAR :
519  				{
520  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDEMENUBAR, BM_GETCHECK, 0, 0));
521  					::SendMessage(::GetParent(_hParent), NPPM_HIDEMENU, 0, isChecked?TRUE:FALSE);
522  				}
523  				return TRUE;
524  				case IDC_CHECK_HIDERIGHTSHORTCUTSOFMENUBAR:
525  				{
526  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDERIGHTSHORTCUTSOFMENUBAR, BM_GETCHECK, 0, 0));
527  					NppGUI&amp; nppGUI = nppParam.getNppGUI();
528  					nppGUI._hideMenuRightShortcuts = isChecked;
529  				}
530  				return TRUE;
531  				case IDC_CHECK_TAB_HIDE :
532  				{
533  					bool toBeHidden = (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_TAB_HIDE), BM_GETCHECK, 0, 0));
534  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_TAB_MULTILINE), !toBeHidden);
535  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_TAB_VERTICAL), !toBeHidden);
536  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_REDUCE), !toBeHidden);
537  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_LOCK), !toBeHidden);
538  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_ORANGE), !toBeHidden);
539  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_DRAWINACTIVE), !toBeHidden);
540  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_ENABLETABCLOSE), !toBeHidden);
541  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_DBCLICK2CLOSE), !toBeHidden);
542  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_TAB_LAST_EXIT), !toBeHidden);
543  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_TAB_ALTICONS), !toBeHidden);
544  					::SendMessage(::GetParent(_hParent), NPPM_HIDETABBAR, 0, toBeHidden);
545  					return TRUE;
546  				}
547  				case  IDC_CHECK_TAB_VERTICAL:
548  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_VERTICAL, 0);
549  					return TRUE;
550  				case IDC_CHECK_TAB_MULTILINE :
551  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_MULTILINE, 0);
552  					return TRUE;
553  				case IDC_CHECK_TAB_LAST_EXIT:
554  				{
555  					NppGUI &amp; nppGUI = nppParam.getNppGUI();
556  					nppGUI._tabStatus ^= TAB_QUITONEMPTY;
557  				}
558  				return TRUE;
559  				case IDC_CHECK_TAB_ALTICONS:
560  				{
561  					NppGUI&amp; nppGUI = nppParam.getNppGUI();
562  					nppGUI._tabStatus ^= TAB_ALTICONS;
563  					const bool isChecked = isCheckedOrNot(IDC_CHECK_TAB_ALTICONS);
564  					const bool isBtnCmd = true;
565  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CHANGETABBAEICONS, static_cast&lt;WPARAM&gt;(isBtnCmd), isChecked ? 1 : (nppGUI._darkmode._isEnabled ? 2 : 0));
566  					NppDarkMode::setTabIconSet(isChecked, NppDarkMode::isEnabled());
567  					return TRUE;
568  				}
569  				case IDC_CHECK_REDUCE :
570  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_REDUCETABBAR, 0);
571  					return TRUE;
572  				case IDC_CHECK_LOCK :
573  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LOCKTABBAR, 0);
574  					return TRUE;
575  				case IDC_CHECK_ORANGE :
576  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_TOPBAR, 0);
577  					return TRUE;
578  				case IDC_CHECK_DRAWINACTIVE :
579  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_INACIVETAB, 0);
580  					return TRUE;
581  				case IDC_CHECK_ENABLETABCLOSE :
582  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_CLOSEBOTTUN, 0);
583  					return TRUE;
584  				case IDC_CHECK_DBCLICK2CLOSE :
585  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_DRAWTABBAR_DBCLK2CLOSE, 0);
586  					return TRUE;
587  				case IDC_CHECK_HIDE :
588  				{
589  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_HIDE, BM_GETCHECK, 0, 0));
590  					::SendMessage(::GetParent(_hParent), NPPM_HIDETOOLBAR, 0, isChecked?TRUE:FALSE);
591  				}
592  				return TRUE;
593  				case IDC_RADIO_SMALLICON :
594  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_REDUCE, 0);
595  					NppDarkMode::setToolBarIconSet(0, NppDarkMode::isEnabled());
596  					return TRUE;
597  				case IDC_RADIO_BIGICON :
598  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_ENLARGE, 0);
599  					NppDarkMode::setToolBarIconSet(1, NppDarkMode::isEnabled());
600  					return TRUE;
601  				case IDC_RADIO_SMALLICON2:
602  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_REDUCE_SET2, 0);
603  					NppDarkMode::setToolBarIconSet(2, NppDarkMode::isEnabled());
604  					return TRUE;
605  				case IDC_RADIO_BIGICON2:
606  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_ENLARGE_SET2, 0);
607  					NppDarkMode::setToolBarIconSet(3, NppDarkMode::isEnabled());
608  					return TRUE;
609  				case IDC_RADIO_STANDARD :
610  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_TOOLBAR_STANDARD, 0);
611  					NppDarkMode::setToolBarIconSet(4, NppDarkMode::isEnabled());
612  					return TRUE;
613  				default :
614  					switch (HIWORD(wParam))
615  					{
616  						case CBN_SELCHANGE : 
617  						{
618  							switch (LOWORD(wParam))
619  							{
620  								case IDC_COMBO_LOCALIZATION :
621  								{
622  									LocalizationSwitcher &amp; localizationSwitcher = nppParam.getLocalizationSwitcher();
623  									auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_GETCURSEL, 0, 0);
624  									TCHAR langName[MAX_PATH] = { &#x27;\0&#x27; };
625  									auto cbTextLen = ::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_GETLBTEXTLEN, index, 0);
626  									if (cbTextLen &gt; MAX_PATH - 1)
627  										return TRUE;
628  									::SendDlgItemMessage(_hSelf, IDC_COMBO_LOCALIZATION, CB_GETLBTEXT, index, reinterpret_cast&lt;LPARAM&gt;(langName));
629  									if (langName[0])
630  									{
631  										if (localizationSwitcher.switchToLang(TEXT(&quot;English&quot;)))
632  										{
633  											::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RELOADNATIVELANG, 0, 0);
634  										}
635  										if (localizationSwitcher.switchToLang(langName))
636  										{
637  											::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RELOADNATIVELANG, 0, 0);
638  											::InvalidateRect(_hParent, NULL, TRUE);
639  										}
640  									}
641  								}
642  								return TRUE;
643  								default:
644  									break;
645  							}
646  						}
647  					}
648  			}
649  		}
650  	}
651  	return FALSE;
652  }
653  void EditingSubDlg::initScintParam()
654  {
655  	NppParameters&amp; nppParam = NppParameters::getInstance();
656  	ScintillaViewParams &amp; svp = const_cast&lt;ScintillaViewParams &amp;&gt;(nppParam.getSVP());
657  	int id = 0;
658  	switch (svp._lineWrapMethod)
659  	{
660  		case LINEWRAP_ALIGNED:
661  			id = IDC_RADIO_LWALIGN;
662  			break;
663  		case LINEWRAP_INDENT:
664  			id = IDC_RADIO_LWINDENT;
665  			break;
666  		default : 
667  			id = IDC_RADIO_LWDEF;
668  	}
669  	::SendDlgItemMessage(_hSelf, id, BM_SETCHECK, TRUE, 0);
670  	::SendDlgItemMessage(_hSelf, IDC_CHECK_SMOOTHFONT, BM_SETCHECK, svp._doSmoothFont, 0);
671  	int lineHilite = 0;
672  	switch (svp._currentLineHiliteMode)
673  	{
674  		case LINEHILITE_NONE:
675  			lineHilite = IDC_RADIO_CLM_NONE;
676  			break;
677  		case LINEHILITE_FRAME:
678  			lineHilite = IDC_RADIO_CLM_FRAME;
679  			break;
680  		default : 
681  			lineHilite = IDC_RADIO_CLM_HILITE;
682  	}
683  	::SendDlgItemMessage(_hSelf, lineHilite, BM_SETCHECK, TRUE, 0);
684  	::EnableWindow(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), (svp._currentLineHiliteMode == LINEHILITE_FRAME));
685  	::SendDlgItemMessage(_hSelf, IDC_CHECK_VIRTUALSPACE, BM_SETCHECK, svp._virtualSpace, 0);
686  	::SendDlgItemMessage(_hSelf, IDC_CHECK_SCROLLBEYONDLASTLINE, BM_SETCHECK, svp._scrollBeyondLastLine, 0);
687  	::SendDlgItemMessage(_hSelf, IDC_CHECK_RIGHTCLICKKEEPSSELECTION, BM_SETCHECK, svp._rightClickKeepsSelection, 0);
688  	::SendDlgItemMessage(_hSelf, IDC_CHECK_DISABLEADVANCEDSCROLL, BM_SETCHECK, svp._disableAdvancedScrolling, 0);
689  }
690  void EditingSubDlg::changeLineHiliteMode(bool enableSlider)
691  {
692  	::EnableWindow(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), enableSlider);
693  	redrawDlgItem(IDC_CARETLINEFRAME_WIDTH_STATIC);
694  	redrawDlgItem(IDC_CARETLINEFRAME_WIDTH_DISPLAY);
695  	::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_CURLINE_HILITING, 0);
696  }
697  static WNDPROC oldFunclstToolbarProc = NULL;
698  static LRESULT CALLBACK editNumSpaceProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)
699  {
700  	switch (message)
701  	{
702  		case WM_CHAR:
703  		{
704  			if ((wParam != 8 &amp;&amp; wParam != 32 &amp;&amp; wParam &lt; 48) || wParam &gt; 57)
705  			{
706  				return TRUE;
707  			}
708  		}
709  	}
710  	return oldFunclstToolbarProc(hwnd, message, wParam, lParam);
711  }
712  intptr_t CALLBACK EditingSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
713  {
714  	NppParameters&amp; nppParam = NppParameters::getInstance();
715  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
716  	ScintillaViewParams&amp; svp = (ScintillaViewParams&amp;)nppParam.getSVP();
717  	switch (message)
718  	{
719  		case WM_INITDIALOG :
720  		{
721  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;0&quot;)));
722  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;1&quot;)));
723  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;2&quot;)));
724  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;3&quot;)));
725  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Block&quot;)));
726  			::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Block After&quot;)));
727  			::SendMessage(::GetDlgItem(_hSelf, IDC_WIDTH_COMBO), CB_SETCURSEL, nppGUI._caretWidth, 0);
728  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FOLDINGTOGGLE, BM_SETCHECK, nppGUI._enableFoldCmdToggable, 0);
729  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MULTISELECTION, BM_SETCHECK, nppGUI._enableMultiSelection, 0);
730  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER),TBM_SETRANGEMIN, TRUE, BLINKRATE_FASTEST);
731  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER),TBM_SETRANGEMAX, TRUE, BLINKRATE_SLOWEST);
732  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER),TBM_SETPAGESIZE, 0, BLINKRATE_INTERVAL);
733  			int blinkRate = (nppGUI._caretBlinkRate == 0) ? BLINKRATE_SLOWEST : nppGUI._caretBlinkRate;
734  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER),TBM_SETPOS, TRUE, blinkRate);
735  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), TBM_SETRANGEMIN, TRUE, CARETLINEFRAME_SMALLEST);
736  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), TBM_SETRANGEMAX, TRUE, CARETLINEFRAME_LARGEST);
737  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), TBM_SETPAGESIZE, 0, CARETLINEFRAME_INTERVAL);
738  			::SendMessage(::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER), TBM_SETPOS, TRUE, svp._currentLineFrameWidth);
739  			::SetDlgItemInt(_hSelf, IDC_CARETLINEFRAME_WIDTH_DISPLAY, svp._currentLineFrameWidth, FALSE);
740  			bool checkDefaultCRLF = true;
741  			bool checkPlainTextCRLF = false;
742  			bool checkWithColorCRLF = false;
743  			if (svp._eolMode == svp.plainText)
744  			{
745  				checkDefaultCRLF = false;
746  				checkPlainTextCRLF = true;
747  				checkWithColorCRLF = false;
748  			}
749  			else if (svp._eolMode == svp.plainTextCustomColor)
750  			{
751  				checkDefaultCRLF = false;
752  				checkPlainTextCRLF = true;
753  				checkWithColorCRLF = true;
754  			}
755  			else if (svp._eolMode == svp.roundedRectangleTextCustomColor)
756  			{
757  				checkDefaultCRLF = true;
758  				checkPlainTextCRLF = false;
759  				checkWithColorCRLF = true;
760  			}
761  			::SendDlgItemMessage(_hSelf, IDC_RADIO_ROUNDCORNER_CRLF, BM_SETCHECK, checkDefaultCRLF, 0);
762  			::SendDlgItemMessage(_hSelf, IDC_RADIO_PLEINTEXT_CRLF, BM_SETCHECK, checkPlainTextCRLF, 0);
763  			::SendDlgItemMessage(_hSelf, IDC_CHECK_WITHCUSTOMCOLOR_CRLF, BM_SETCHECK, checkWithColorCRLF, 0);
764  			NativeLangSpeaker* pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
765  			generic_string tip2show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;eol-custom-color-tip&quot;, TEXT(&quot;Go to Style Configurator to change the default EOL custom color (\&quot;EOL custom color\&quot;).&quot;));
766  			_tip = CreateToolTip(IDC_BUTTON_LAUNCHSTYLECONF_CRLF, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tip2show.c_str()), pNativeSpeaker-&gt;isRTL());
767  			const bool isNpcModeAbbrv = svp._npcMode == svp.abbreviation;
768  			setChecked(IDC_RADIO_NPC_ABBREVIATION, isNpcModeAbbrv);
769  			setChecked(IDC_RADIO_NPC_CODEPOINT, !isNpcModeAbbrv);
770  			setChecked(IDC_CHECK_NPC_COLOR, svp._npcCustomColor);
771  			setChecked(IDC_CHECK_NPC_INCLUDECCUNIEOL, svp._npcIncludeCcUniEol);
772  			generic_string tipNote2Show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcNote-tip&quot;,
773  				L&quot;Representation of selected \&quot;non-ASCII\&quot; whitespace and non-printing (control) characters.\n\n&quot;\
774  				L&quot;NOTE:\n&quot;\
775  				L&quot;Using representation will disable character effects on text.\n\n&quot;\
776  				L&quot;For the full list of selected whitespace and non-printing characters check User Manual.\n\n&quot;\
777  				L&quot;Click on this button to open website with User Manual.&quot;);
778  			generic_string tipAb2Show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcAbbreviation-tip&quot;,
779  				L&quot;Abbreviation : name\n&quot;\
780  				L&quot;NBSP : no-break space\n&quot;\
781  				L&quot;ZWSP : zero-width space\n&quot;\
782  				L&quot;ZWNBSP : zero-width no-break space\n\n&quot;\
783  				L&quot;For the full list check User Manual.\n&quot;\
784  				L&quot;Click on \&quot;?\&quot; button on right to open website with User Manual.&quot;);
785  			generic_string tipCp2Show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcCodepoint-tip&quot;,
786  				L&quot;Codepoint : name\n&quot;\
787  				L&quot;U+00A0 : no-break space\n&quot;\
788  				L&quot;U+200B : zero-width space\n&quot;\
789  				L&quot;U+FEFF : zero-width no-break space\n\n&quot;\
790  				L&quot;For the full list check User Manual.\n&quot;\
791  				L&quot;Click on \&quot;?\&quot; button on right to open website with User Manual.&quot;);
792  			generic_string tipNpcCol2show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcCustomColor-tip&quot;,
793  				L&quot;Go to Style Configurator to change the default custom color for selected whitespace and non-printing characters (\&quot;Non-printing characters custom color\&quot;).&quot;);
794  			generic_string tipNpcInc2show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;npcIncludeCcUniEol-tip&quot;,
795  				L&quot;Apply non-printing characters appearance settings to C0, C1 control and Unicode EOL (next line, line separator and paragraph separator) characters.&quot;);
796  			_tipNote = CreateToolTip(IDC_BUTTON_NPC_NOTE, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipNote2Show.c_str()), pNativeSpeaker-&gt;isRTL());
797  			_tipAbb = CreateToolTip(IDC_RADIO_NPC_ABBREVIATION, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipAb2Show.c_str()), pNativeSpeaker-&gt;isRTL());
798  			_tipCodepoint = CreateToolTip(IDC_RADIO_NPC_CODEPOINT, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipCp2Show.c_str()), pNativeSpeaker-&gt;isRTL());
799  			_tipNpcColor = CreateToolTip(IDC_BUTTON_NPC_LAUNCHSTYLECONF, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipNpcCol2show.c_str()), pNativeSpeaker-&gt;isRTL());
800  			_tipNpcInclude = CreateToolTip(IDC_CHECK_NPC_INCLUDECCUNIEOL, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tipNpcInc2show.c_str()), pNativeSpeaker-&gt;isRTL());
801  			_tips.push_back(_tipNote);
802  			_tips.push_back(_tipAbb);
803  			_tips.push_back(_tipCodepoint);
804  			_tips.push_back(_tipNpcColor);
805  			_tips.push_back(_tipNpcInclude);
806  			for (auto&amp; tip : _tips)
807  			{
808  				if (tip != nullptr)
809  				{
810  					::SendMessage(tip, TTM_SETMAXTIPWIDTH, 0, 260);
811  				}
812  			}
813  			if (_tipNote != nullptr)
814  			{
815  				::SendMessage(_tipNote, TTM_SETDELAYTIME, TTDT_AUTOPOP, MAKELPARAM((30000), (0)));
816  			}
817  			initScintParam();
818  			return TRUE;
819  		}
820  		case WM_CTLCOLOREDIT:
821  		{
822  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
823  		}
824  		case WM_CTLCOLORLISTBOX:
825  		{
826  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
827  		}
828  		case WM_CTLCOLORDLG:
829  		{
830  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
831  		}
832  		case WM_CTLCOLORSTATIC:
833  		{
834  			int dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
835  			if (dlgCtrlID == IDC_CARETLINEFRAME_WIDTH_STATIC || dlgCtrlID == IDC_CARETLINEFRAME_WIDTH_DISPLAY)
836  			{
837  				return NppDarkMode::onCtlColorDarkerBGStaticText(reinterpret_cast&lt;HDC&gt;(wParam), (svp._currentLineHiliteMode == LINEHILITE_FRAME));
838  			}
839  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
840  		}
841  		case WM_PRINTCLIENT:
842  		{
843  			if (NppDarkMode::isEnabled())
844  			{
845  				return TRUE;
846  			}
847  			break;
848  		}
849  		case WM_HSCROLL:
850  		{
851  			HWND hCaretBlinkRateSlider = ::GetDlgItem(_hSelf, IDC_CARETBLINKRATE_SLIDER);
852  			HWND hCaretLineFrameSlider = ::GetDlgItem(_hSelf, IDC_CARETLINEFRAME_WIDTH_SLIDER);
853  			if (reinterpret_cast&lt;HWND&gt;(lParam) == hCaretBlinkRateSlider)
854  			{
855  				auto blinkRate = ::SendMessage(hCaretBlinkRateSlider, TBM_GETPOS, 0, 0);
856  				if (blinkRate == BLINKRATE_SLOWEST)
857  					blinkRate = 0;
858  				nppGUI._caretBlinkRate = static_cast&lt;int&gt;(blinkRate);
859  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETCARETBLINKRATE, 0, 0);
860  			}
861  			else if (reinterpret_cast&lt;HWND&gt;(lParam) == hCaretLineFrameSlider)
862  			{
863  				svp._currentLineFrameWidth = static_cast&lt;unsigned char&gt;(::SendMessage(hCaretLineFrameSlider, TBM_GETPOS, 0, 0));
864  				::SetDlgItemInt(_hSelf, IDC_CARETLINEFRAME_WIDTH_DISPLAY, svp._currentLineFrameWidth, FALSE);
865  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CARETLINEFRAME, 0, svp._currentLineFrameWidth);
866  			}
867  			return 0;	
868  		}
869  		case WM_COMMAND : 
870  		{
871  			ScintillaViewParams &amp; svp = const_cast&lt;ScintillaViewParams &amp;&gt;(nppParam.getSVP());
872  			switch (wParam)
873  			{
874  				case IDC_CHECK_SMOOTHFONT:
875  					svp._doSmoothFont = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_SMOOTHFONT, BM_GETCHECK, 0, 0));
876  					::SendMessage(::GetParent(_hParent), NPPM_SETSMOOTHFONT, 0, svp._doSmoothFont);
877  					return TRUE;
878  				case IDC_RADIO_CLM_NONE:
879  					svp._currentLineHiliteMode = LINEHILITE_NONE;
880  					changeLineHiliteMode(false);
881  					return TRUE;
882  				case IDC_RADIO_CLM_HILITE:
883  					svp._currentLineHiliteMode = LINEHILITE_HILITE;
884  					changeLineHiliteMode(false);
885  					return TRUE;
886  				case IDC_RADIO_CLM_FRAME:
887  					svp._currentLineHiliteMode = LINEHILITE_FRAME;
888  					changeLineHiliteMode(true);
889  					return TRUE;
890  				case IDC_RADIO_ROUNDCORNER_CRLF:
891  				case IDC_RADIO_PLEINTEXT_CRLF:
892  				case IDC_CHECK_WITHCUSTOMCOLOR_CRLF:
893  				{
894  					bool doCustomColor = isCheckedOrNot(IDC_CHECK_WITHCUSTOMCOLOR_CRLF);
895  					if (wParam == IDC_RADIO_ROUNDCORNER_CRLF)
896  					{
897  						svp._eolMode = doCustomColor ? svp.roundedRectangleTextCustomColor : svp.roundedRectangleText;
898  					}
899  					else if (wParam == IDC_RADIO_PLEINTEXT_CRLF)
900  					{
901  						svp._eolMode = doCustomColor ? svp.plainTextCustomColor : svp.plainText;
902  					}
903  					else 
904  					{
905  						if (isCheckedOrNot(IDC_RADIO_ROUNDCORNER_CRLF))
906  						{
907  							svp._eolMode = doCustomColor ? svp.roundedRectangleTextCustomColor : svp.roundedRectangleText;
908  						}
909  						else 
910  						{
911  							svp._eolMode = doCustomColor ? svp.plainTextCustomColor : svp.plainText;
912  						}
913  					}
914  					HWND grandParent = ::GetParent(_hParent);
915  					::SendMessage(grandParent, NPPM_INTERNAL_CRLFFORMCHANGED, 0, 0);
916  					return TRUE;
917  				}
918  				case IDC_BUTTON_LAUNCHSTYLECONF_CRLF:
919  				{
920  					HWND grandParent = ::GetParent(_hParent);
921  					::SendMessage(grandParent, NPPM_INTERNAL_CRLFLAUNCHSTYLECONF, 0, 0);
922  					return TRUE;
923  				}
924  				case IDC_RADIO_NPC_ABBREVIATION:
925  				case IDC_RADIO_NPC_CODEPOINT:
926  				{
927  					if (wParam == IDC_RADIO_NPC_CODEPOINT)
928  					{
929  						svp._npcMode = svp.codepoint;
930  					}
931  					else 
932  					{
933  						svp._npcMode = svp.abbreviation;
934  					}
935  					HWND grandParent = ::GetParent(_hParent);
936  					::SendMessage(grandParent, NPPM_INTERNAL_SETNPC, 0, 0);
937  					return TRUE;
938  				}
939  				case IDC_BUTTON_NPC_NOTE:
940  				{
941  					::ShellExecute(NULL, L&quot;open&quot;, L&quot;https:&amp;bsol;&amp;bsol;npp-user-manual.org/docs/views/#show-symbol&quot;, NULL, NULL, SW_SHOWNORMAL);
942  					return TRUE;
943  				}
944  				case IDC_CHECK_NPC_COLOR:
945  				{
946  					svp._npcCustomColor = isCheckedOrNot(IDC_CHECK_NPC_COLOR);
947  					HWND grandParent = ::GetParent(_hParent);
948  					::SendMessage(grandParent, NPPM_INTERNAL_NPCFORMCHANGED, 0, 0);
949  					return TRUE;
950  				}
951  				case IDC_BUTTON_NPC_LAUNCHSTYLECONF:
952  				{
953  					HWND grandParent = ::GetParent(_hParent);
954  					::SendMessage(grandParent, NPPM_INTERNAL_NPCLAUNCHSTYLECONF, 0, 0);
955  					return TRUE;
956  				}
957  				case IDC_CHECK_NPC_INCLUDECCUNIEOL:
958  				{
959  					svp._npcIncludeCcUniEol = isCheckedOrNot(IDC_CHECK_NPC_INCLUDECCUNIEOL);
960  					const HWND grandParent = ::GetParent(_hParent);
961  					::SendMessage(grandParent, NPPM_INTERNAL_SETNPC, IDC_CHECK_NPC_INCLUDECCUNIEOL, 0);
962  					return TRUE;
963  				}
964  				case IDC_CHECK_VIRTUALSPACE:
965  					svp._virtualSpace = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_VIRTUALSPACE, BM_GETCHECK, 0, 0));
966  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_VIRTUALSPACE, 0, 0);
967  					return TRUE;
968  				case IDC_CHECK_SCROLLBEYONDLASTLINE:
969  					svp._scrollBeyondLastLine = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_SCROLLBEYONDLASTLINE, BM_GETCHECK, 0, 0));
970  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SCROLLBEYONDLASTLINE, 0, 0);
971  					return TRUE;
972  				case IDC_CHECK_RIGHTCLICKKEEPSSELECTION:
973  					svp._rightClickKeepsSelection = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_RIGHTCLICKKEEPSSELECTION, BM_GETCHECK, 0, 0));
974  					return TRUE;
975  				case IDC_CHECK_DISABLEADVANCEDSCROLL:
976  					svp._disableAdvancedScrolling = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_DISABLEADVANCEDSCROLL, BM_GETCHECK, 0, 0));
977  					return TRUE;
978                  case IDC_CHECK_MULTISELECTION :
979                      nppGUI._enableMultiSelection = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_MULTISELECTION, BM_GETCHECK, 0, 0));
980                      ::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETMULTISELCTION, 0, 0);
981                      return TRUE;
982  				case IDC_CHECK_FOLDINGTOGGLE:
983  					nppGUI._enableFoldCmdToggable = isCheckedOrNot(IDC_CHECK_FOLDINGTOGGLE);
984  					return TRUE;
985  				case IDC_RADIO_LWDEF:
986  					svp._lineWrapMethod = LINEWRAP_DEFAULT;
987  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LWDEF, 0);
988  					return TRUE;
989  				case IDC_RADIO_LWALIGN:
990  					svp._lineWrapMethod = LINEWRAP_ALIGNED;
991  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LWALIGN, 0);
992  					return TRUE;
993  				case IDC_RADIO_LWINDENT:
994  					svp._lineWrapMethod = LINEWRAP_INDENT;
995  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LWINDENT, 0);
996  					return TRUE;
997  				default :
998  					switch (HIWORD(wParam))
999  					{
1000  						case CBN_SELCHANGE : 
1001  						{
1002  							if (LOWORD(wParam) == IDC_WIDTH_COMBO)
1003  							{
1004  								nppGUI._caretWidth = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_WIDTH_COMBO, CB_GETCURSEL, 0, 0));
1005  								::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETCARETWIDTH, 0, 0);
1006  								return TRUE;
1007  							}
1008  						}
1009  						break;
1010  					}
1011  			}
1012  		}
1013  	}
1014  	return FALSE;
1015  }
1016  void DarkModeSubDlg::enableCustomizedColorCtrls(bool doEnable)
1017  {
1018  	::EnableWindow(_pBackgroundColorPicker-&gt;getHSelf(), doEnable);
1019  	::EnableWindow(_pSofterBackgroundColorPicker-&gt;getHSelf(), doEnable);
1020  	::EnableWindow(_pHotBackgroundColorPicker-&gt;getHSelf(), doEnable);
1021  	::EnableWindow(_pPureBackgroundColorPicker-&gt;getHSelf(), doEnable);
1022  	::EnableWindow(_pErrorBackgroundColorPicker-&gt;getHSelf(), doEnable);
1023  	::EnableWindow(_pTextColorPicker-&gt;getHSelf(), doEnable);
1024  	::EnableWindow(_pDarkerTextColorPicker-&gt;getHSelf(), doEnable);
1025  	::EnableWindow(_pDisabledTextColorPicker-&gt;getHSelf(), doEnable);
1026  	::EnableWindow(_pEdgeColorPicker-&gt;getHSelf(), doEnable);
1027  	::EnableWindow(_pLinkColorPicker-&gt;getHSelf(), doEnable);
1028  	::EnableWindow(_pHotEdgeColorPicker-&gt;getHSelf(), doEnable);
1029  	::EnableWindow(_pDisabledEdgeColorPicker-&gt;getHSelf(), doEnable);
1030  	::EnableWindow(::GetDlgItem(_hSelf, IDD_CUSTOMIZED_RESET_BUTTON), doEnable);
1031  	if (doEnable)
1032  	{
1033  		_pBackgroundColorPicker-&gt;setColour(NppDarkMode::getBackgroundColor());
1034  		_pSofterBackgroundColorPicker-&gt;setColour(NppDarkMode::getSofterBackgroundColor());
1035  		_pHotBackgroundColorPicker-&gt;setColour(NppDarkMode::getHotBackgroundColor());
1036  		_pPureBackgroundColorPicker-&gt;setColour(NppDarkMode::getDarkerBackgroundColor());
1037  		_pErrorBackgroundColorPicker-&gt;setColour(NppDarkMode::getErrorBackgroundColor());
1038  		_pTextColorPicker-&gt;setColour(NppDarkMode::getTextColor());
1039  		_pDarkerTextColorPicker-&gt;setColour(NppDarkMode::getDarkerTextColor());
1040  		_pDisabledTextColorPicker-&gt;setColour(NppDarkMode::getDisabledTextColor());
1041  		_pEdgeColorPicker-&gt;setColour(NppDarkMode::getEdgeColor());
1042  		_pLinkColorPicker-&gt;setColour(NppDarkMode::getLinkTextColor());
1043  		_pHotEdgeColorPicker-&gt;setColour(NppDarkMode::getHotEdgeColor());
1044  		_pDisabledEdgeColorPicker-&gt;setColour(NppDarkMode::getDisabledEdgeColor());
1045  	}
1046  }
1047  void DarkModeSubDlg::move2CtrlLeft(int ctrlID, HWND handle2Move, int handle2MoveWidth, int handle2MoveHeight)
1048  {
1049  	POINT p{};
1050  	RECT rc{};
1051  	::GetWindowRect(::GetDlgItem(_hSelf, ctrlID), &amp;rc);
1052  	NppParameters&amp; nppParam = NppParameters::getInstance();
1053  	if(nppParam.getNativeLangSpeaker()-&gt;isRTL())
1054  		p.x = rc.right + nppParam._dpiManager.scaleX(5) + handle2MoveWidth;
1055  	else
1056  		p.x = rc.left - nppParam._dpiManager.scaleX(5) - handle2MoveWidth;
1057  	p.y = rc.top + ((rc.bottom - rc.top) / 2) - handle2MoveHeight / 2;
1058  	::ScreenToClient(_hSelf, &amp;p);
1059  	::MoveWindow(handle2Move, p.x, p.y, handle2MoveWidth, handle2MoveHeight, TRUE);
1060  }
1061  intptr_t CALLBACK DarkModeSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
1062  {
1063  	UNREFERENCED_PARAMETER(lParam);
1064  	NppParameters&amp; nppParam = NppParameters::getInstance();
1065  	NppGUI&amp; nppGUI = nppParam.getNppGUI();
1066  	switch (message)
1067  	{
1068  		case WM_INITDIALOG:
1069  		{
1070  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_FOLLOWWINDOWS), NppDarkMode::isWindows10());
1071  			const int topControlID = NppDarkMode::isWindowsModeEnabled() &amp;&amp; NppDarkMode::isWindows10() ? IDC_RADIO_DARKMODE_FOLLOWWINDOWS : NppDarkMode::isEnabled() ? IDC_RADIO_DARKMODE_DARKMODE : IDC_RADIO_DARKMODE_LIGHTMODE;
1072  			::SendDlgItemMessage(_hSelf, topControlID, BM_SETCHECK, BST_CHECKED, 0);
1073  			int id = IDC_RADIO_DARKMODE_BLACK;
1074  			switch (nppGUI._darkmode._colorTone)
1075  			{
1076  				case NppDarkMode::redTone:
1077  					id = IDC_RADIO_DARKMODE_RED;
1078  					break;
1079  				case NppDarkMode::greenTone:
1080  					id = IDC_RADIO_DARKMODE_GREEN;
1081  					break;
1082  				case NppDarkMode::blueTone:
1083  					id = IDC_RADIO_DARKMODE_BLUE;
1084  					break;
1085  				case NppDarkMode::purpleTone:
1086  					id = IDC_RADIO_DARKMODE_PURPLE;
1087  					break;
1088  				case NppDarkMode::cyanTone:
1089  					id = IDC_RADIO_DARKMODE_CYAN;
1090  					break;
1091  				case NppDarkMode::oliveTone:
1092  					id = IDC_RADIO_DARKMODE_OLIVE;
1093  					break;
1094  				case NppDarkMode::customizedTone:
1095  					id = IDC_RADIO_DARKMODE_CUSTOMIZED;
1096  					break;
1097  				case NppDarkMode::blackTone:
1098  				default:
1099  					break;
1100  			}
1101  			::SendDlgItemMessage(_hSelf, id, BM_SETCHECK, TRUE, 0);
1102  			_pBackgroundColorPicker = new ColourPicker;
1103  			_pSofterBackgroundColorPicker = new ColourPicker;
1104  			_pHotBackgroundColorPicker = new ColourPicker;
1105  			_pPureBackgroundColorPicker = new ColourPicker;
1106  			_pErrorBackgroundColorPicker = new ColourPicker;
1107  			_pTextColorPicker = new ColourPicker;
1108  			_pDarkerTextColorPicker = new ColourPicker;
1109  			_pDisabledTextColorPicker = new ColourPicker;
1110  			_pEdgeColorPicker = new ColourPicker;
1111  			_pLinkColorPicker = new ColourPicker;
1112  			_pHotEdgeColorPicker = new ColourPicker;
1113  			_pDisabledEdgeColorPicker = new ColourPicker;
1114  			_pBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1115  			_pSofterBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1116  			_pHotBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1117  			_pPureBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1118  			_pErrorBackgroundColorPicker-&gt;init(_hInst, _hSelf);
1119  			_pTextColorPicker-&gt;init(_hInst, _hSelf);
1120  			_pDarkerTextColorPicker-&gt;init(_hInst, _hSelf);
1121  			_pDisabledTextColorPicker-&gt;init(_hInst, _hSelf);
1122  			_pEdgeColorPicker-&gt;init(_hInst, _hSelf);
1123  			_pLinkColorPicker-&gt;init(_hInst, _hSelf);
1124  			_pHotEdgeColorPicker-&gt;init(_hInst, _hSelf);
1125  			_pDisabledEdgeColorPicker-&gt;init(_hInst, _hSelf);
1126  			int cpDynamicalWidth = NppParameters::getInstance()._dpiManager.scaleX(25);
1127  			int cpDynamicalHeight = NppParameters::getInstance()._dpiManager.scaleY(25);
1128  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR1_STATIC, _pPureBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1129  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR2_STATIC, _pHotBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1130  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR3_STATIC, _pSofterBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1131  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR4_STATIC, _pBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1132  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR5_STATIC, _pErrorBackgroundColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1133  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR6_STATIC, _pTextColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1134  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR7_STATIC, _pDarkerTextColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1135  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR8_STATIC, _pDisabledTextColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1136  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR9_STATIC, _pEdgeColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1137  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR10_STATIC, _pLinkColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1138  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR11_STATIC, _pHotEdgeColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1139  			move2CtrlLeft(IDD_CUSTOMIZED_COLOR12_STATIC, _pDisabledEdgeColorPicker-&gt;getHSelf(), cpDynamicalWidth, cpDynamicalHeight);
1140  			_pBackgroundColorPicker-&gt;display();
1141  			_pSofterBackgroundColorPicker-&gt;display();
1142  			_pHotBackgroundColorPicker-&gt;display();
1143  			_pPureBackgroundColorPicker-&gt;display();
1144  			_pErrorBackgroundColorPicker-&gt;display();
1145  			_pTextColorPicker-&gt;display();
1146  			_pDarkerTextColorPicker-&gt;display();
1147  			_pDisabledTextColorPicker-&gt;display();
1148  			_pEdgeColorPicker-&gt;display();
1149  			_pLinkColorPicker-&gt;display();
1150  			_pHotEdgeColorPicker-&gt;display();
1151  			_pDisabledEdgeColorPicker-&gt;display();
1152  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_BLACK), nppGUI._darkmode._isEnabled);
1153  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_RED), nppGUI._darkmode._isEnabled);
1154  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_GREEN), nppGUI._darkmode._isEnabled);
1155  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_BLUE), nppGUI._darkmode._isEnabled);
1156  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_PURPLE), nppGUI._darkmode._isEnabled);
1157  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_CYAN), nppGUI._darkmode._isEnabled);
1158  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_OLIVE), nppGUI._darkmode._isEnabled);
1159  			::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_CUSTOMIZED), nppGUI._darkmode._isEnabled);
1160  			enableCustomizedColorCtrls(nppGUI._darkmode._isEnabled &amp;&amp; id == IDC_RADIO_DARKMODE_CUSTOMIZED);
1161  			return TRUE;
1162  		}
1163  		case WM_CTLCOLORDLG:
1164  		{
1165  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1166  		}
1167  		case WM_CTLCOLORSTATIC:
1168  		{
1169  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
1170  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
1171  			bool isStaticText = (dlgCtrlID == IDD_CUSTOMIZED_COLOR1_STATIC ||
1172  				dlgCtrlID == IDD_CUSTOMIZED_COLOR2_STATIC ||
1173  				dlgCtrlID == IDD_CUSTOMIZED_COLOR3_STATIC ||
1174  				dlgCtrlID == IDD_CUSTOMIZED_COLOR4_STATIC ||
1175  				dlgCtrlID == IDD_CUSTOMIZED_COLOR5_STATIC ||
1176  				dlgCtrlID == IDD_CUSTOMIZED_COLOR6_STATIC ||
1177  				dlgCtrlID == IDD_CUSTOMIZED_COLOR7_STATIC ||
1178  				dlgCtrlID == IDD_CUSTOMIZED_COLOR8_STATIC ||
1179  				dlgCtrlID == IDD_CUSTOMIZED_COLOR9_STATIC ||
1180  				dlgCtrlID == IDD_CUSTOMIZED_COLOR10_STATIC ||
1181  				dlgCtrlID == IDD_CUSTOMIZED_COLOR11_STATIC ||
1182  				dlgCtrlID == IDD_CUSTOMIZED_COLOR12_STATIC);
1183  			if (isStaticText)
1184  			{
1185  				bool isTextEnabled = nppGUI._darkmode._isEnabled &amp;&amp; nppGUI._darkmode._colorTone == NppDarkMode::customizedTone;
1186  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
1187  			}
1188  			return NppDarkMode::onCtlColorDarker(hdcStatic);
1189  		}
1190  		case WM_PRINTCLIENT:
1191  		{
1192  			if (NppDarkMode::isEnabled())
1193  			{
1194  				return TRUE;
1195  			}
1196  			break;
1197  		}
1198  		case WM_DESTROY:
1199  		{
1200  			_pBackgroundColorPicker-&gt;destroy();
1201  			_pSofterBackgroundColorPicker-&gt;destroy();
1202  			_pHotBackgroundColorPicker-&gt;destroy();
1203  			_pPureBackgroundColorPicker-&gt;destroy();
1204  			_pErrorBackgroundColorPicker-&gt;destroy();
1205  			_pTextColorPicker-&gt;destroy();
1206  			_pDarkerTextColorPicker-&gt;destroy();
1207  			_pDisabledTextColorPicker-&gt;destroy();
1208  			_pEdgeColorPicker-&gt;destroy();
1209  			_pLinkColorPicker-&gt;destroy();
1210  			_pHotEdgeColorPicker-&gt;destroy();
1211  			_pDisabledEdgeColorPicker-&gt;destroy();
1212  			delete _pBackgroundColorPicker;
1213  			delete _pSofterBackgroundColorPicker;
1214  			delete _pHotBackgroundColorPicker;
1215  			delete _pPureBackgroundColorPicker;
1216  			delete _pErrorBackgroundColorPicker;
1217  			delete _pTextColorPicker;
1218  			delete _pDarkerTextColorPicker;
1219  			delete _pDisabledTextColorPicker;
1220  			delete _pEdgeColorPicker;
1221  			delete _pLinkColorPicker;
1222  			delete _pHotEdgeColorPicker;
1223  			delete _pDisabledEdgeColorPicker;
1224  			return TRUE;
1225  		}
1226  		case WM_COMMAND:
1227  		{
1228  			bool changed = false;
1229  			bool forceRefresh = false;
1230  			bool doEnableCustomizedColorCtrls = false;
1231  			switch (wParam)
1232  			{
1233  				case IDC_RADIO_DARKMODE_FOLLOWWINDOWS:
1234  				{
1235  					NppDarkMode::handleSettingChange(nullptr, 0, true);
1236  				}
1237  				[[fallthrough]];
1238  				case IDC_RADIO_DARKMODE_LIGHTMODE:
1239  				case IDC_RADIO_DARKMODE_DARKMODE:
1240  				{
1241  					const bool isFollowWindows = isCheckedOrNot(IDC_RADIO_DARKMODE_FOLLOWWINDOWS);
1242  					NppDarkMode::setWindowsMode(isFollowWindows);
1243  					const bool enableDarkMode = isCheckedOrNot(IDC_RADIO_DARKMODE_DARKMODE) || (isFollowWindows &amp;&amp; NppDarkMode::isExperimentalActive());
1244  					nppGUI._darkmode._isEnabled = enableDarkMode;
1245  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_BLACK), enableDarkMode);
1246  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_RED), enableDarkMode);
1247  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_GREEN), enableDarkMode);
1248  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_BLUE), enableDarkMode);
1249  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_PURPLE), enableDarkMode);
1250  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_CYAN), enableDarkMode);
1251  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_OLIVE), enableDarkMode);
1252  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DARKMODE_CUSTOMIZED), enableDarkMode);
1253  					doEnableCustomizedColorCtrls = enableDarkMode &amp;&amp; nppGUI._darkmode._colorTone == NppDarkMode::customizedTone;
1254  					enableCustomizedColorCtrls(doEnableCustomizedColorCtrls);
1255  					::SendMessage(_hParent, PREF_MSG_SETGUITOOLICONSSET, static_cast&lt;WPARAM&gt;(enableDarkMode), 0);
1256  					::SendMessage(_hParent, PREF_MSG_SETGUITABBARICONS, static_cast&lt;WPARAM&gt;(enableDarkMode), 0);
1257  					changed = true;
1258  				}
1259  				break;
1260  				case IDC_RADIO_DARKMODE_BLACK:
1261  				case IDC_RADIO_DARKMODE_RED:
1262  				case IDC_RADIO_DARKMODE_GREEN:
1263  				case IDC_RADIO_DARKMODE_BLUE:
1264  				case IDC_RADIO_DARKMODE_PURPLE:
1265  				case IDC_RADIO_DARKMODE_CYAN:
1266  				case IDC_RADIO_DARKMODE_OLIVE:
1267  				case IDC_RADIO_DARKMODE_CUSTOMIZED:
1268  				case IDD_CUSTOMIZED_RESET_BUTTON:
1269  				{
1270  					if (wParam == IDC_RADIO_DARKMODE_BLACK)
1271  					{
1272  						if (nppGUI._darkmode._colorTone == NppDarkMode::blackTone)
1273  							return TRUE;
1274  						nppGUI._darkmode._colorTone = NppDarkMode::blackTone;
1275  					}
1276  					else if (wParam == IDC_RADIO_DARKMODE_RED)
1277  					{
1278  						if (nppGUI._darkmode._colorTone == NppDarkMode::redTone)
1279  							return TRUE;
1280  						nppGUI._darkmode._colorTone = NppDarkMode::redTone;
1281  					}
1282  					else if (wParam == IDC_RADIO_DARKMODE_GREEN)
1283  					{
1284  						if (nppGUI._darkmode._colorTone == NppDarkMode::greenTone)
1285  							return TRUE;
1286  						nppGUI._darkmode._colorTone = NppDarkMode::greenTone;
1287  					}
1288  					else if (wParam == IDC_RADIO_DARKMODE_BLUE)
1289  					{
1290  						if (nppGUI._darkmode._colorTone == NppDarkMode::blueTone)
1291  							return TRUE;
1292  						nppGUI._darkmode._colorTone = NppDarkMode::blueTone;
1293  					}
1294  					else if (wParam == IDC_RADIO_DARKMODE_PURPLE)
1295  					{
1296  						if (nppGUI._darkmode._colorTone == NppDarkMode::purpleTone)
1297  							return TRUE;
1298  						nppGUI._darkmode._colorTone = NppDarkMode::purpleTone;
1299  					}
1300  					else if (wParam == IDC_RADIO_DARKMODE_CYAN)
1301  					{
1302  						if (nppGUI._darkmode._colorTone == NppDarkMode::cyanTone)
1303  							return TRUE;
1304  						nppGUI._darkmode._colorTone = NppDarkMode::cyanTone;
1305  					}
1306  					else if (wParam == IDC_RADIO_DARKMODE_OLIVE)
1307  					{
1308  						if (nppGUI._darkmode._colorTone == NppDarkMode::oliveTone)
1309  							return TRUE;
1310  						nppGUI._darkmode._colorTone = NppDarkMode::oliveTone;
1311  					}
1312  					else if (wParam == IDC_RADIO_DARKMODE_CUSTOMIZED)
1313  					{
1314  						if (nppGUI._darkmode._colorTone == NppDarkMode::customizedTone)
1315  							return TRUE;
1316  						nppGUI._darkmode._colorTone = NppDarkMode::customizedTone;
1317  						doEnableCustomizedColorCtrls = true;
1318  					}
1319  					else if (wParam == IDD_CUSTOMIZED_RESET_BUTTON)
1320  					{
1321  						nppGUI._darkmode._customColors = NppDarkMode::getDarkModeDefaultColors();
1322  						NppDarkMode::changeCustomTheme(nppGUI._darkmode._customColors);
1323  						doEnableCustomizedColorCtrls = true;
1324  					}
1325  					nppGUI._darkmode._isEnabled = true;
1326  					NppDarkMode::setDarkTone(nppGUI._darkmode._colorTone);
1327  					changed = true;
1328  					forceRefresh = true;
1329  					enableCustomizedColorCtrls(doEnableCustomizedColorCtrls);
1330  				}
1331  				break;
1332  				default:
1333  					switch (HIWORD(wParam))
1334  					{
1335  						case CPN_COLOURPICKED:
1336  						{
1337  							COLORREF c = 0;
1338  							if (reinterpret_cast&lt;HWND&gt;(lParam) == _pBackgroundColorPicker-&gt;getHSelf())
1339  							{
1340  								c = _pBackgroundColorPicker-&gt;getColour();
1341  								NppDarkMode::setBackgroundColor(c);
1342  								nppGUI._darkmode._customColors.background = c;
1343  							}
1344  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pSofterBackgroundColorPicker-&gt;getHSelf())
1345  							{
1346  								c = _pSofterBackgroundColorPicker-&gt;getColour();
1347  								NppDarkMode::setSofterBackgroundColor(c);
1348  								nppGUI._darkmode._customColors.softerBackground = c;
1349  							}
1350  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pHotBackgroundColorPicker-&gt;getHSelf())
1351  							{
1352  								c = _pHotBackgroundColorPicker-&gt;getColour();
1353  								NppDarkMode::setHotBackgroundColor(c);
1354  								nppGUI._darkmode._customColors.hotBackground = c;
1355  							}
1356  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pPureBackgroundColorPicker-&gt;getHSelf())
1357  							{
1358  								c = _pPureBackgroundColorPicker-&gt;getColour();
1359  								NppDarkMode::setDarkerBackgroundColor(c);
1360  								nppGUI._darkmode._customColors.pureBackground = c;
1361  							}
1362  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pErrorBackgroundColorPicker-&gt;getHSelf())
1363  							{
1364  								c = _pErrorBackgroundColorPicker-&gt;getColour();
1365  								NppDarkMode::setErrorBackgroundColor(c);
1366  								nppGUI._darkmode._customColors.errorBackground = c;
1367  							}
1368  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pTextColorPicker-&gt;getHSelf())
1369  							{
1370  								c = _pTextColorPicker-&gt;getColour();
1371  								NppDarkMode::setTextColor(c);
1372  								nppGUI._darkmode._customColors.text = c;
1373  							}
1374  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pDarkerTextColorPicker-&gt;getHSelf())
1375  							{
1376  								c = _pDarkerTextColorPicker-&gt;getColour();
1377  								NppDarkMode::setDarkerTextColor(c);
1378  								nppGUI._darkmode._customColors.darkerText = c;
1379  							}
1380  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pDisabledTextColorPicker-&gt;getHSelf())
1381  							{
1382  								c = _pDisabledTextColorPicker-&gt;getColour();
1383  								NppDarkMode::setDisabledTextColor(c);
1384  								nppGUI._darkmode._customColors.disabledText = c;
1385  							}
1386  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pEdgeColorPicker-&gt;getHSelf())
1387  							{
1388  								c = _pEdgeColorPicker-&gt;getColour();
1389  								NppDarkMode::setEdgeColor(c);
1390  								nppGUI._darkmode._customColors.edge = c;
1391  							}
1392  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pLinkColorPicker-&gt;getHSelf())
1393  							{
1394  								c = _pLinkColorPicker-&gt;getColour();
1395  								NppDarkMode::setLinkTextColor(c);
1396  								nppGUI._darkmode._customColors.linkText = c;
1397  							}
1398  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pHotEdgeColorPicker-&gt;getHSelf())
1399  							{
1400  								c = _pHotEdgeColorPicker-&gt;getColour();
1401  								NppDarkMode::setHotEdgeColor(c);
1402  								nppGUI._darkmode._customColors.hotEdge = c;
1403  							}
1404  							else if (reinterpret_cast&lt;HWND&gt;(lParam) == _pDisabledEdgeColorPicker-&gt;getHSelf())
1405  							{
1406  								c = _pDisabledEdgeColorPicker-&gt;getColour();
1407  								NppDarkMode::setDisabledEdgeColor(c);
1408  								nppGUI._darkmode._customColors.disabledEdge = c;
1409  							}
1410  							else
1411  							{
1412  								return FALSE;
1413  							}
1414  							nppGUI._darkmode._isEnabled = true;
1415  							NppDarkMode::setDarkTone(nppGUI._darkmode._colorTone);
1416  							changed = true;
1417  							forceRefresh = true;
1418  							doEnableCustomizedColorCtrls = true;
1419  						}
1420  						break;
1421  						default:
1422  						{
1423  							return FALSE;
1424  						}
1425  					}
1426  			}
1427  			if (changed)
1428  			{
1429  				if (!doEnableCustomizedColorCtrls)
1430  				{
1431  					COLORREF disabledColor = nppGUI._darkmode._isEnabled ? NppDarkMode::getDarkerBackgroundColor() : ::GetSysColor(COLOR_3DFACE);
1432  					_pBackgroundColorPicker-&gt;setColour(disabledColor);
1433  					_pSofterBackgroundColorPicker-&gt;setColour(disabledColor);
1434  					_pHotBackgroundColorPicker-&gt;setColour(disabledColor);
1435  					_pPureBackgroundColorPicker-&gt;setColour(disabledColor);
1436  					_pErrorBackgroundColorPicker-&gt;setColour(disabledColor);
1437  					_pTextColorPicker-&gt;setColour(disabledColor);
1438  					_pDarkerTextColorPicker-&gt;setColour(disabledColor);
1439  					_pDisabledTextColorPicker-&gt;setColour(disabledColor);
1440  					_pEdgeColorPicker-&gt;setColour(disabledColor);
1441  					_pLinkColorPicker-&gt;setColour(disabledColor);
1442  					_pHotEdgeColorPicker-&gt;setColour(disabledColor);
1443  					_pDisabledEdgeColorPicker-&gt;setColour(disabledColor);
1444  				}
1445  				NppDarkMode::refreshDarkMode(_hSelf, forceRefresh);
1446  				getFocus(); 
1447  				return TRUE;
1448  			}
1449  			return FALSE;
1450  		}
1451  	}
1452  	return FALSE;
1453  }
1454  void MarginsBorderEdgeSubDlg::initScintParam()
1455  {
1456  	NppParameters&amp; nppParam = NppParameters::getInstance();
1457  	ScintillaViewParams &amp; svp = const_cast&lt;ScintillaViewParams &amp;&gt;(nppParam.getSVP());
1458  	::SendDlgItemMessage(_hSelf, IDC_RADIO_BOX, BM_SETCHECK, FALSE, 0);
1459  	::SendDlgItemMessage(_hSelf, IDC_RADIO_CIRCLE, BM_SETCHECK, FALSE, 0);
1460  	::SendDlgItemMessage(_hSelf, IDC_RADIO_ARROW, BM_SETCHECK, FALSE, 0);
1461  	::SendDlgItemMessage(_hSelf, IDC_RADIO_SIMPLE, BM_SETCHECK, FALSE, 0);
1462  	::SendDlgItemMessage(_hSelf, IDC_RADIO_FOLDMARGENONE, BM_SETCHECK, FALSE, 0);
1463  	int id = 0;
1464  	switch (svp._folderStyle)
1465  	{
1466  		case FOLDER_STYLE_NONE:
1467  			id = IDC_RADIO_FOLDMARGENONE;
1468  			break;
1469  		case FOLDER_STYLE_BOX:
1470  			id = IDC_RADIO_BOX;
1471  			break;
1472  		case FOLDER_STYLE_CIRCLE:
1473  			id = IDC_RADIO_CIRCLE;
1474  			break;
1475  		case FOLDER_STYLE_ARROW:
1476  			id = IDC_RADIO_ARROW;
1477  			break;
1478  		default : 
1479  			id = IDC_RADIO_SIMPLE;
1480  	}
1481  	::SendDlgItemMessage(_hSelf, id, BM_SETCHECK, TRUE, 0);
1482  	::SendDlgItemMessage(_hSelf, IDC_CHECK_LINENUMBERMARGE, BM_SETCHECK, svp._lineNumberMarginShow, 0);
1483  	::SendDlgItemMessage(_hSelf, IDC_RADIO_DYNAMIC, BM_SETCHECK, svp._lineNumberMarginDynamicWidth, 0);
1484  	::SendDlgItemMessage(_hSelf, IDC_RADIO_CONSTANT, BM_SETCHECK, !svp._lineNumberMarginDynamicWidth, 0);
1485  	::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DYNAMIC), svp._lineNumberMarginShow);
1486  	::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_CONSTANT), svp._lineNumberMarginShow);
1487  	::SendDlgItemMessage(_hSelf, IDC_CHECK_BOOKMARKMARGE, BM_SETCHECK, svp._bookMarkMarginShow, 0);
1488  	::SendDlgItemMessage(_hSelf, IDC_CHECK_CHANGHISTORYMARGE, BM_SETCHECK, svp._isChangeHistoryEnabled, 0);
1489  	::SendDlgItemMessage(_hSelf, IDC_CHECK_NOEDGE, BM_SETCHECK, !svp._showBorderEdge, 0);
1490  	bool canBeBg = svp._edgeMultiColumnPos.size() == 1;
1491  	if (!canBeBg)
1492  	{
1493  		svp._isEdgeBgMode = false;
1494  		::SendDlgItemMessage(_hSelf, IDC_CHECK_EDGEBGMODE, BM_SETCHECK, FALSE, 0);
1495  		::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_EDGEBGMODE), FALSE);
1496  	}
1497  	else
1498  	{
1499  		::SendDlgItemMessage(_hSelf, IDC_CHECK_EDGEBGMODE, BM_SETCHECK, svp._isEdgeBgMode, 0);
1500  	}
1501  	generic_string edgeColumnPosStr;
1502  	for (auto i : svp._edgeMultiColumnPos)
1503  	{
1504  		std::string s = std::to_string(i);
1505  		edgeColumnPosStr += generic_string(s.begin(), s.end());
1506  		edgeColumnPosStr += TEXT(&quot; &quot;);
1507  	}
1508  	::SendDlgItemMessage(_hSelf, IDC_COLUMNPOS_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(edgeColumnPosStr.c_str()));
1509  	oldFunclstToolbarProc = reinterpret_cast&lt;WNDPROC&gt;(::SetWindowLongPtr(::GetDlgItem(_hSelf, IDC_COLUMNPOS_EDIT), GWLP_WNDPROC, reinterpret_cast&lt;LONG_PTR&gt;(editNumSpaceProc)));
1510  }
1511  intptr_t CALLBACK MarginsBorderEdgeSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
1512  {
1513  	NppParameters&amp; nppParam = NppParameters::getInstance();
1514  	switch (message) 
1515  	{
1516  		case WM_INITDIALOG :
1517  		{
1518  			const ScintillaViewParams &amp; svp = nppParam.getSVP();
1519  			::SendMessage(::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER),TBM_SETRANGEMIN, TRUE, BORDERWIDTH_SMALLEST);
1520  			::SendMessage(::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER),TBM_SETRANGEMAX, TRUE, BORDERWIDTH_LARGEST);
1521  			::SendMessage(::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER),TBM_SETPAGESIZE, 0, BORDERWIDTH_INTERVAL);
1522  			::SendMessage(::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER),TBM_SETPOS, TRUE, svp._borderWidth);
1523  			::SetDlgItemInt(_hSelf, IDC_BORDERWIDTHVAL_STATIC, svp._borderWidth, FALSE);
1524  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER), TBM_SETRANGEMIN, TRUE, PADDING_SMALLEST);
1525  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER), TBM_SETRANGEMAX, TRUE, PADDING_LARGEST);
1526  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER), TBM_SETPAGESIZE, 0, PADDING_INTERVAL);
1527  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER), TBM_SETPOS, TRUE, svp._paddingLeft);
1528  			::SetDlgItemInt(_hSelf, IDC_PADDINGLEFTVAL_STATIC, svp._paddingLeft, FALSE);
1529  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER), TBM_SETRANGEMIN, TRUE, PADDING_SMALLEST);
1530  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER), TBM_SETRANGEMAX, TRUE, PADDING_LARGEST);
1531  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER), TBM_SETPAGESIZE, 0, PADDING_INTERVAL);
1532  			::SendMessage(::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER), TBM_SETPOS, TRUE, svp._paddingRight);
1533  			::SetDlgItemInt(_hSelf, IDC_PADDINGRIGHTVAL_STATIC, svp._paddingRight, FALSE);
1534  			::SendMessage(::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER), TBM_SETRANGEMIN, TRUE, DISTRACTIONFREE_SMALLEST);
1535  			::SendMessage(::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER), TBM_SETRANGEMAX, TRUE, DISTRACTIONFREE_LARGEST);
1536  			::SendMessage(::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER), TBM_SETPAGESIZE, 0, DISTRACTIONFREE_INTERVAL);
1537  			::SendMessage(::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER), TBM_SETPOS, TRUE, svp._distractionFreeDivPart);
1538  			::SetDlgItemInt(_hSelf, IDC_DISTRACTIONFREEVAL_STATIC, svp._distractionFreeDivPart, FALSE);
1539  			initScintParam();
1540  			return TRUE;
1541  		}
1542  		case WM_CTLCOLOREDIT:
1543  		{
1544  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
1545  		}
1546  		case WM_CTLCOLORDLG:
1547  		case WM_CTLCOLORSTATIC:
1548  		{
1549  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1550  		}
1551  		case WM_PRINTCLIENT:
1552  		{
1553  			if (NppDarkMode::isEnabled())
1554  			{
1555  				return TRUE;
1556  			}
1557  			break;
1558  		}
1559  		case WM_HSCROLL:
1560  		{
1561  			ScintillaViewParams &amp; svp = (ScintillaViewParams &amp;)nppParam.getSVP();
1562  			HWND hBorderWidthSlider = ::GetDlgItem(_hSelf, IDC_BORDERWIDTH_SLIDER);
1563  			HWND hPaddingLeftSlider = ::GetDlgItem(_hSelf, IDC_PADDINGLEFT_SLIDER);
1564  			HWND hPaddingRightSlider = ::GetDlgItem(_hSelf, IDC_PADDINGRIGHT_SLIDER);
1565  			HWND hDistractionFreeSlider = ::GetDlgItem(_hSelf, IDC_DISTRACTIONFREE_SLIDER);
1566  			if (reinterpret_cast&lt;HWND&gt;(lParam) == hBorderWidthSlider)
1567  			{
1568  				auto borderWidth = ::SendMessage(hBorderWidthSlider, TBM_GETPOS, 0, 0);
1569  				svp._borderWidth = static_cast&lt;int&gt;(borderWidth);
1570  				::SetDlgItemInt(_hSelf, IDC_BORDERWIDTHVAL_STATIC, static_cast&lt;UINT&gt;(borderWidth), FALSE);
1571  				::SendMessage(::GetParent(_hParent), WM_SIZE, 0, 0);
1572  			}
1573  			else if (reinterpret_cast&lt;HWND&gt;(lParam) == hPaddingLeftSlider)
1574  			{
1575  				svp._paddingLeft = static_cast&lt;unsigned char&gt;(::SendMessage(hPaddingLeftSlider, TBM_GETPOS, 0, 0));
1576  				::SetDlgItemInt(_hSelf, IDC_PADDINGLEFTVAL_STATIC, static_cast&lt;UINT&gt;(svp._paddingLeft), FALSE);
1577  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATETEXTZONEPADDING, 0, 0);
1578  			}
1579  			else if (reinterpret_cast&lt;HWND&gt;(lParam) == hPaddingRightSlider)
1580  			{
1581  				svp._paddingRight = static_cast&lt;unsigned char&gt;(::SendMessage(hPaddingRightSlider, TBM_GETPOS, 0, 0));
1582  				::SetDlgItemInt(_hSelf, IDC_PADDINGRIGHTVAL_STATIC, static_cast&lt;UINT&gt;(svp._paddingRight), FALSE);
1583  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATETEXTZONEPADDING, 0, 0);
1584  			}
1585  			else if (reinterpret_cast&lt;HWND&gt;(lParam) == hDistractionFreeSlider)
1586  			{
1587  				svp._distractionFreeDivPart = static_cast&lt;unsigned char&gt;(::SendMessage(hDistractionFreeSlider, TBM_GETPOS, 0, 0));
1588  				::SetDlgItemInt(_hSelf, IDC_DISTRACTIONFREEVAL_STATIC, static_cast&lt;UINT&gt;(svp._distractionFreeDivPart), FALSE);
1589  				::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATETEXTZONEPADDING, 0, 0);
1590  			}
1591  			return 0;	
1592  		}
1593  		case WM_COMMAND : 
1594  		{
1595  			ScintillaViewParams &amp; svp = const_cast&lt;ScintillaViewParams &amp;&gt;(nppParam.getSVP());
1596  			switch (wParam)
1597  			{
1598  				case IDC_CHECK_LINENUMBERMARGE:
1599  					svp._lineNumberMarginShow = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_LINENUMBERMARGE, BM_GETCHECK, 0, 0));
1600  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_DYNAMIC), svp._lineNumberMarginShow);
1601  					::EnableWindow(::GetDlgItem(_hSelf, IDC_RADIO_CONSTANT), svp._lineNumberMarginShow);
1602  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LINENUMBER, 0);
1603  					return TRUE;
1604  				case IDC_RADIO_DYNAMIC:
1605  					svp._lineNumberMarginDynamicWidth = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_RADIO_DYNAMIC, BM_GETCHECK, 0, 0));
1606  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LINENUMBER, 0);
1607  					return TRUE;
1608  				case IDC_RADIO_CONSTANT:
1609  					svp._lineNumberMarginDynamicWidth = !(BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_RADIO_CONSTANT, BM_GETCHECK, 0, 0));
1610  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_LINENUMBER, 0);
1611  					return TRUE;
1612  				case IDC_CHECK_BOOKMARKMARGE:
1613  					svp._bookMarkMarginShow = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_BOOKMARKMARGE, BM_GETCHECK, 0, 0));
1614  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_SYMBOLMARGIN, 0);
1615  					return TRUE;
1616  				case IDC_CHECK_CHANGHISTORYMARGE:
1617  				{
1618  					bool isChangeHistoryEnabled = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_CHANGHISTORYMARGE, BM_GETCHECK, 0, 0));
1619  					if (isChangeHistoryEnabled)
1620  					{
1621  						NativeLangSpeaker* pNativeSpeaker = nppParam.getNativeLangSpeaker();
1622  						pNativeSpeaker-&gt;messageBox(&quot;ChangeHistoryEnabledWarning&quot;,
1623  							_hSelf,
1624  							TEXT(&quot;You have to restart Notepad++ to enable Change History.&quot;),
1625  							TEXT(&quot;Notepad++ need to be relaunched&quot;),
1626  							MB_OK | MB_APPLMODAL);
1627  						svp._isChangeHistoryEnabled4NextSession = true;
1628  					}
1629  					else
1630  					{
1631  						svp._isChangeHistoryEnabled = false;
1632  						svp._isChangeHistoryEnabled4NextSession = false;
1633  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_ENABLECHANGEHISTORY, 0, 0);
1634  					}
1635  					return TRUE;
1636  				}
1637  				case IDC_CHECK_NOEDGE:
1638  					svp._showBorderEdge = !(BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_NOEDGE, BM_GETCHECK, 0, 0));
1639  					::SendMessage(::GetParent(_hParent), NPPM_SETEDITORBORDEREDGE, 0, svp._showBorderEdge ? TRUE : FALSE);
1640  					return TRUE;
1641  				case IDC_RADIO_SIMPLE:
1642  					svp._folderStyle = FOLDER_STYLE_SIMPLE;
1643  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN_SIMPLE, 0);
1644  					return TRUE;
1645  				case IDC_RADIO_ARROW:
1646  					svp._folderStyle = FOLDER_STYLE_ARROW;
1647  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN_ARROW, 0);
1648  					return TRUE;
1649  				case IDC_RADIO_CIRCLE:
1650  					svp._folderStyle = FOLDER_STYLE_CIRCLE;
1651  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN_CIRCLE, 0);
1652  					return TRUE;
1653  				case IDC_RADIO_BOX:
1654  					svp._folderStyle = FOLDER_STYLE_BOX;
1655  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN_BOX, 0);
1656  					return TRUE;
1657  				case IDC_RADIO_FOLDMARGENONE:
1658  					svp._folderStyle = FOLDER_STYLE_NONE;
1659  					::SendMessage(_hParent, WM_COMMAND, IDM_VIEW_FOLDERMAGIN, 0);
1660  					return TRUE;
1661  				case IDC_CHECK_EDGEBGMODE:
1662  					svp._isEdgeBgMode = isCheckedOrNot(IDC_CHECK_EDGEBGMODE);
1663  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_EDGEMULTISETSIZE, 0, 0);
1664  					return TRUE;
1665  				default :
1666  					switch (HIWORD(wParam))
1667  					{
1668  						case EN_CHANGE :
1669  						{
1670  							if (LOWORD(wParam) == IDC_COLUMNPOS_EDIT)
1671  							{
1672  								TCHAR text[MAX_PATH] = {&#x27;\0&#x27;};
1673  								::SendDlgItemMessage(_hSelf, IDC_COLUMNPOS_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(text));
1674  								if (str2numberVector(text, svp._edgeMultiColumnPos))
1675  								{
1676  									bool canBeBg = svp._edgeMultiColumnPos.size() == 1;
1677  									if (!canBeBg)
1678  									{
1679  										svp._isEdgeBgMode = false;
1680  										::SendDlgItemMessage(_hSelf, IDC_CHECK_EDGEBGMODE, BM_SETCHECK, FALSE, 0);
1681  									}
1682  									::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_EDGEBGMODE), canBeBg);
1683  									::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_EDGEMULTISETSIZE, 0, 0);
1684  									return TRUE;
1685  								}
1686  							}
1687  						}
1688  						break;
1689  					}
1690  			}
1691  		}
1692  	}
1693  	return FALSE;
1694  }
1695  const size_t fileUpdateChoiceEnable = 0;
1696  const size_t fileUpdateChoiceEnable4All = 1;
1697  const size_t fileUpdateChoiceDisable = 2;
1698  intptr_t CALLBACK MiscSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
1699  {
1700  	NppParameters&amp; nppParam = NppParameters::getInstance();
1701  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
1702  	switch (message) 
1703  	{
1704  		case WM_INITDIALOG :
1705  		{
1706  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Enable&quot;)));
1707  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Enable for all opened files&quot;)));
1708  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Disable&quot;)));
1709  			int selIndex = -1;
1710  			if (nppGUI._fileAutoDetection &amp; cdEnabledOld)
1711  			{
1712  				selIndex = fileUpdateChoiceEnable4All;
1713  			}
1714  			else if (nppGUI._fileAutoDetection &amp; cdEnabledNew)
1715  			{				
1716  				selIndex = fileUpdateChoiceEnable;
1717  			}
1718  			else 
1719  			{
1720  				::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATESILENTLY), FALSE);
1721  				::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATEGOTOEOF), FALSE);
1722  				selIndex = fileUpdateChoiceDisable;
1723  			}
1724  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_SETCURSEL, selIndex, 0);
1725  			bool bCheck = (nppGUI._fileAutoDetection &amp; cdAutoUpdate) ? true : false;
1726  			::SendDlgItemMessage(_hSelf, IDC_CHECK_UPDATESILENTLY, BM_SETCHECK, bCheck? BST_CHECKED: BST_UNCHECKED, 0);
1727  			bCheck = (nppGUI._fileAutoDetection &amp; cdGo2end) ? true : false;
1728  			::SendDlgItemMessage(_hSelf, IDC_CHECK_UPDATEGOTOEOF, BM_SETCHECK, bCheck ? BST_CHECKED : BST_UNCHECKED, 0);
1729  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MIN2SYSTRAY, BM_SETCHECK, nppGUI._isMinimizedToTray, 0);
1730  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DETECTENCODING, BM_SETCHECK, nppGUI._detectEncoding, 0);
1731  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SAVEALLCONFIRM, BM_SETCHECK, nppGUI._saveAllConfirm, 0);
1732  			::SendDlgItemMessage(_hSelf, IDC_CHECK_AUTOUPDATE, BM_SETCHECK, nppGUI._autoUpdateOpt._doAutoUpdate, 0);
1733  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DIRECTWRITE_ENABLE, BM_SETCHECK, nppGUI._writeTechnologyEngine == directWriteTechnology, 0);
1734  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLEDOCPEEKER, BM_SETCHECK, nppGUI._isDocPeekOnTab ? BST_CHECKED : BST_UNCHECKED, 0);
1735  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLEDOCPEEKONMAP, BM_SETCHECK, nppGUI._isDocPeekOnMap ? BST_CHECKED : BST_UNCHECKED, 0);
1736  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MUTE_SOUNDS, BM_SETCHECK, nppGUI._muteSounds ? BST_CHECKED : BST_UNCHECKED, 0);
1737  			::ShowWindow(::GetDlgItem(_hSelf, IDC_CHECK_AUTOUPDATE), nppGUI._doesExistUpdater?SW_SHOW:SW_HIDE);
1738  			::SendDlgItemMessage(_hSelf, IDC_EDIT_SESSIONFILEEXT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._definedSessionExt.c_str()));
1739  			::SendDlgItemMessage(_hSelf, IDC_EDIT_WORKSPACEFILEEXT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._definedWorkspaceExt.c_str()));
1740  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLEDOCSWITCHER, BM_SETCHECK, nppGUI._doTaskList, 0);
1741  			::SendDlgItemMessage(_hSelf, IDC_CHECK_STYLEMRU, BM_SETCHECK, nppGUI._styleMRU, 0);
1742  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SHORTTITLE, BM_SETCHECK, nppGUI._shortTitlebar, 0);
1743  			return TRUE;
1744  		}
1745  		case WM_CTLCOLOREDIT:
1746  		{
1747  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
1748  		}
1749  		case WM_CTLCOLORLISTBOX:
1750  		{
1751  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
1752  		}
1753  		case WM_CTLCOLORDLG:
1754  		case WM_CTLCOLORSTATIC:
1755  		{
1756  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1757  		}
1758  		case WM_PRINTCLIENT:
1759  		{
1760  			if (NppDarkMode::isEnabled())
1761  			{
1762  				return TRUE;
1763  			}
1764  			break;
1765  		}
1766  		case WM_COMMAND : 
1767  		{
1768  			if (HIWORD(wParam) == EN_CHANGE)
1769  			{
1770  				switch (LOWORD(wParam))
1771  				{
1772  					case  IDC_EDIT_SESSIONFILEEXT:
1773  					{
1774  						TCHAR sessionExt[MAX_PATH] = { &#x27;\0&#x27; };
1775  						::SendDlgItemMessage(_hSelf, IDC_EDIT_SESSIONFILEEXT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(sessionExt));
1776  						nppGUI._definedSessionExt = sessionExt;
1777  						return TRUE;
1778  					}
1779  					case  IDC_EDIT_WORKSPACEFILEEXT:
1780  					{
1781  						TCHAR workspaceExt[MAX_PATH] = { &#x27;\0&#x27; };
1782  						::SendDlgItemMessage(_hSelf, IDC_EDIT_WORKSPACEFILEEXT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(workspaceExt));
1783  						nppGUI._definedWorkspaceExt = workspaceExt;
1784  						return TRUE;
1785  					}
1786  				}
1787  			}
1788  			switch (wParam)
1789  			{
1790  				case IDC_CHECK_UPDATESILENTLY:
1791  				case IDC_CHECK_UPDATEGOTOEOF:
1792  				{
1793  					bool isSilent = isCheckedOrNot(IDC_CHECK_UPDATESILENTLY);
1794  					bool isGo2End = isCheckedOrNot(IDC_CHECK_UPDATEGOTOEOF);
1795  					auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_GETCURSEL, 0, 0);
1796  					int cd = cdDisabled;
1797  					if (index == fileUpdateChoiceEnable || index == fileUpdateChoiceEnable4All)
1798  					{
1799  						if (index == fileUpdateChoiceEnable4All)
1800  							cd |= cdEnabledOld;
1801  						else
1802  							cd |= cdEnabledNew;
1803  						if (isSilent)
1804  							cd |= cdAutoUpdate;
1805  						if (isGo2End)
1806  							cd |= cdGo2end;
1807  					}
1808  					nppGUI._fileAutoDetection = cd;
1809  				}
1810  				return TRUE;
1811  				case IDC_CHECK_AUTOUPDATE:
1812  					nppGUI._autoUpdateOpt._doAutoUpdate = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
1813  					return TRUE;
1814  				case IDC_CHECK_MIN2SYSTRAY:
1815  					nppGUI._isMinimizedToTray = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
1816  					return TRUE;
1817  				case IDC_CHECK_DETECTENCODING:
1818  					nppGUI._detectEncoding = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
1819  					return TRUE;
1820  				case IDC_CHECK_ENABLEDOCSWITCHER :
1821  				{
1822  					nppGUI._doTaskList = !nppGUI._doTaskList;
1823  					if (nppGUI._doTaskList)
1824  					{
1825  						::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_STYLEMRU), TRUE);
1826  					}
1827  					else
1828  					{
1829  						nppGUI._styleMRU = false;
1830  						::SendDlgItemMessage(_hSelf, IDC_CHECK_STYLEMRU, BM_SETCHECK, false, 0);
1831  						::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_STYLEMRU), FALSE);
1832  					}
1833  					return TRUE;
1834  				}
1835  				case IDC_CHECK_STYLEMRU :
1836  				{
1837  					nppGUI._styleMRU = isCheckedOrNot(IDC_CHECK_STYLEMRU);
1838  					return TRUE;
1839  				}
1840  				case IDC_CHECK_SHORTTITLE:
1841  				{
1842  					nppGUI._shortTitlebar = isCheckedOrNot(IDC_CHECK_SHORTTITLE);
1843  					HWND grandParent = ::GetParent(_hParent);
1844  					::SendMessage(grandParent, NPPM_INTERNAL_UPDATETITLEBAR, 0, 0);
1845  					return TRUE;
1846  				}
1847  				case IDC_CHECK_DIRECTWRITE_ENABLE:
1848  				{
1849  					nppGUI._writeTechnologyEngine = isCheckedOrNot(IDC_CHECK_DIRECTWRITE_ENABLE) ? directWriteTechnology : defaultTechnology;
1850  					return TRUE;
1851  				}
1852  				case IDC_CHECK_ENABLEDOCPEEKER:
1853  				{
1854  					nppGUI._isDocPeekOnTab = isCheckedOrNot(IDC_CHECK_ENABLEDOCPEEKER);
1855  					return TRUE;
1856  				}
1857  				case IDC_CHECK_ENABLEDOCPEEKONMAP:
1858  				{
<span onclick='openModal()' class='match'>1859  					nppGUI._isDocPeekOnMap = isCheckedOrNot(IDC_CHECK_ENABLEDOCPEEKONMAP);
1860  					return TRUE;
1861  				}
1862  				case IDC_CHECK_MUTE_SOUNDS:
1863  				{
</span>1864  					nppGUI._muteSounds = isCheckedOrNot(IDC_CHECK_MUTE_SOUNDS);
1865  					return TRUE;
1866  				}
1867  				case IDC_CHECK_SAVEALLCONFIRM:
1868  				{
1869  					nppGUI._saveAllConfirm = isCheckedOrNot(IDC_CHECK_SAVEALLCONFIRM);
1870  					return TRUE;
1871  				}
1872  				default:
1873  				{
1874  					if (HIWORD(wParam) == CBN_SELCHANGE)
1875  					{
1876  						if (LOWORD(wParam) == IDC_COMBO_FILEUPDATECHOICE)
1877  						{
1878  							auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_FILEUPDATECHOICE, CB_GETCURSEL, 0, 0);
1879  							if (index == fileUpdateChoiceEnable || index == fileUpdateChoiceEnable4All)
1880  							{
1881  								bool isSilent = isCheckedOrNot(IDC_CHECK_UPDATESILENTLY);
1882  								bool isGo2End = isCheckedOrNot(IDC_CHECK_UPDATEGOTOEOF);
1883  								int cd = cdDisabled;
1884  								if (index == fileUpdateChoiceEnable4All)
1885  									cd |= cdEnabledOld;
1886  								else
1887  									cd |= cdEnabledNew;
1888  								if (isSilent)
1889  									cd |= cdAutoUpdate;
1890  								if (isGo2End)
1891  									cd |= cdGo2end;
1892  								nppGUI._fileAutoDetection = cd;
1893  								::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATESILENTLY), TRUE);
1894  								::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATEGOTOEOF), TRUE);
1895  							}
1896  							else if (index == fileUpdateChoiceDisable)
1897  							{
1898  								::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATESILENTLY), FALSE);
1899  								::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_UPDATEGOTOEOF), FALSE);
1900  								nppGUI._fileAutoDetection = cdDisabled;
1901  							}
1902  							return TRUE;
1903  						}
1904  					}
1905  				}
1906  			}
1907  		}
1908  	}
1909  	return FALSE;
1910  }
1911  intptr_t CALLBACK NewDocumentSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
1912  {
1913  	NppParameters&amp; nppParam = NppParameters::getInstance();
1914  	NppGUI &amp; nppGUI = (NppGUI &amp; )nppParam.getNppGUI();
1915  	NewDocDefaultSettings &amp; ndds = (NewDocDefaultSettings &amp;)nppGUI.getNewDocDefaultSettings();
1916  	switch (message)
1917  	{
1918  		case WM_INITDIALOG:
1919  		{
1920  			int ID2Check = IDC_RADIO_F_WIN;
1921  			switch (ndds._format)
1922  			{
1923  				case EolType::windows:
1924  					ID2Check = IDC_RADIO_F_WIN;
1925  					break;
1926  				case EolType::macos:
1927  					ID2Check = IDC_RADIO_F_MAC;
1928  					break;
1929  				case EolType::unix:
1930  					ID2Check = IDC_RADIO_F_UNIX;
1931  					break;
1932  				case EolType::unknown:
1933  					assert(false);
1934  					break;
1935  			}
1936  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
1937  			switch (ndds._unicodeMode)
1938  			{
1939  				case uni16BE :
1940  					ID2Check = IDC_RADIO_UTF16BIG;
1941  					break;
1942  				case uni16LE :
1943  					ID2Check = IDC_RADIO_UTF16SMALL;
1944  					break;
1945  				case uniUTF8 :
1946  					ID2Check = IDC_RADIO_UTF8;
1947  					break;
1948  				case uniCookie :
1949  					ID2Check = IDC_RADIO_UTF8SANSBOM;
1950  					break;
1951  				default : 
1952  					ID2Check = IDC_RADIO_ANSI;
1953  			}
1954  			int selIndex = -1;
1955  			generic_string str;
1956  			EncodingMapper&amp; em = EncodingMapper::getInstance();
1957  			for (size_t i = 0, encodingArraySize = sizeof(encodings)/sizeof(int) ; i &lt; encodingArraySize ; ++i)
1958  			{
1959  				int cmdID = em.getIndexFromEncoding(encodings[i]);
1960  				if (cmdID != -1)
1961  				{
1962  					cmdID += IDM_FORMAT_ENCODE;
1963  					getNameStrFromCmd(cmdID, str);
1964  					int index = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(str.c_str())));
1965  					if (ndds._codepage == encodings[i])
1966  						selIndex = index;
1967  					::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_SETITEMDATA, index, encodings[i]);
1968  				}
1969  			}
1970  			if (ndds._codepage == -1 || selIndex == -1)
1971  			{
1972  				::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
1973  			}
1974  			else
1975  			{
1976  				ID2Check = IDC_RADIO_OTHERCP;
1977  				::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_SETCURSEL, selIndex, 0);
1978  			}
1979  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
1980  			::SendDlgItemMessage(_hSelf, IDC_CHECK_OPENANSIASUTF8, BM_SETCHECK, (ID2Check == IDC_RADIO_UTF8SANSBOM &amp;&amp; ndds._openAnsiAsUtf8)?BST_CHECKED:BST_UNCHECKED, 0);
1981  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_OPENANSIASUTF8), ID2Check == IDC_RADIO_UTF8SANSBOM);
1982  			for (int i = L_TEXT + 1 ; i &lt; nppParam.L_END ; ++i) 
1983  			{
1984  				LangType lt = static_cast&lt;LangType&gt;(i);
1985  				str.clear();
1986  				if (lt != L_USER &amp;&amp; lt != L_JS)
1987  				{
1988  					int cmdID = nppParam.langTypeToCommandID(lt);
1989  					if ((cmdID != -1))
1990  					{
1991  						getNameStrFromCmd(cmdID, str);
1992  						if (str.length() &gt; 0)
1993  						{
1994  							size_t index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(str.c_str()));
1995  							::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_SETITEMDATA, index, lt);
1996  						}
1997  					}
1998  				}
1999  			}
2000  			int normalTextCmdID = nppParam.langTypeToCommandID(L_TEXT);
2001  			getNameStrFromCmd(normalTextCmdID, str);
2002  			::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_INSERTSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(str.c_str()));
2003  			LangType l = L_TEXT;
2004  			size_t cbCount = ::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_GETCOUNT, 0, 0);
2005  			size_t j = 0;
2006  			for (; j &lt; cbCount; ++j)
2007  			{
2008  				l = static_cast&lt;LangType&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_GETITEMDATA, j, 0));
2009  				if (ndds._lang == l)
2010  					break;
2011  			}
2012  			::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_SETCURSEL, j, 0);
2013  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ADDNEWDOCONSTARTUP, BM_SETCHECK, ndds._addNewDocumentOnStartup, 0);
2014  			return TRUE;
2015  		}
2016  		case WM_CTLCOLORLISTBOX:
2017  		{
2018  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
2019  		}
2020  		case WM_CTLCOLORDLG:
2021  		case WM_CTLCOLORSTATIC:
2022  		{
2023  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2024  		}
2025  		case WM_PRINTCLIENT:
2026  		{
2027  			if (NppDarkMode::isEnabled())
2028  			{
2029  				return TRUE;
2030  			}
2031  			break;
2032  		}
2033  		case WM_COMMAND:
2034  			switch (wParam)
2035  			{
2036  				case IDC_RADIO_UTF16BIG:
2037  					ndds._unicodeMode = uni16BE;
2038  					ndds._openAnsiAsUtf8 = false;
2039  					makeOpenAnsiAsUtf8(false);
2040  					ndds._codepage = -1;
2041  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2042  					return TRUE;
2043  				case IDC_RADIO_UTF16SMALL:
2044  					ndds._unicodeMode = uni16LE;
2045  					ndds._openAnsiAsUtf8 = false;
2046  					makeOpenAnsiAsUtf8(false);
2047  					ndds._codepage = -1;
2048  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2049  					return TRUE;
2050  				case IDC_RADIO_UTF8:
2051  					ndds._unicodeMode = uniUTF8;
2052  					ndds._openAnsiAsUtf8 = false;
2053  					makeOpenAnsiAsUtf8(false);
2054  					ndds._codepage = -1;
2055  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2056  					return TRUE;
2057  				case IDC_RADIO_UTF8SANSBOM:
2058  					ndds._unicodeMode = uniCookie;
2059  					makeOpenAnsiAsUtf8(true);
2060  					ndds._codepage = -1;
2061  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2062  					return TRUE;
2063  				case IDC_RADIO_ANSI:
2064  					ndds._unicodeMode = uni8Bit;
2065  					ndds._openAnsiAsUtf8 = false;
2066  					makeOpenAnsiAsUtf8(false);
2067  					ndds._codepage = -1;
2068  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), false);
2069  					return TRUE;
2070  				case IDC_CHECK_OPENANSIASUTF8 :
2071  					ndds._openAnsiAsUtf8 = (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_OPENANSIASUTF8), BM_GETCHECK, 0, 0));
2072  					return TRUE;
2073  				case IDC_RADIO_OTHERCP :
2074  				{
2075  					ndds._openAnsiAsUtf8 = false;
2076  					makeOpenAnsiAsUtf8(false);
2077  					::EnableWindow(::GetDlgItem(_hSelf, IDC_COMBO_OTHERCP), true);
2078  					auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_GETCURSEL, 0, 0);
2079  					ndds._codepage = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_GETITEMDATA, index, 0));
2080  					return TRUE;
2081  				}
2082  				case IDC_RADIO_F_MAC:
2083  				{
2084  					ndds._format = EolType::macos;
2085  					return TRUE;
2086  				}
2087  				case IDC_RADIO_F_UNIX:
2088  				{
2089  					ndds._format = EolType::unix;
2090  					return TRUE;
2091  				}
2092  				case IDC_RADIO_F_WIN:
2093  				{
2094  					ndds._format = EolType::windows;
2095  					return TRUE;
2096  				}
2097  				case IDC_CHECK_ADDNEWDOCONSTARTUP:
2098  				{
2099  					ndds._addNewDocumentOnStartup = isCheckedOrNot(IDC_CHECK_ADDNEWDOCONSTARTUP);
2100  					return TRUE;
2101  				}
2102  				default:
2103  				{
2104  					if (HIWORD(wParam) == CBN_SELCHANGE)
2105  					{
2106  						if (LOWORD(wParam) == IDC_COMBO_DEFAULTLANG)
2107  						{
2108  							auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_GETCURSEL, 0, 0);
2109  							ndds._lang = static_cast&lt;LangType&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_DEFAULTLANG, CB_GETITEMDATA, index, 0));
2110  							return TRUE;
2111  						}
2112  						else if (LOWORD(wParam) == IDC_COMBO_OTHERCP)
2113  						{
2114  							auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_GETCURSEL, 0, 0);
2115  							ndds._codepage = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_COMBO_OTHERCP, CB_GETITEMDATA, index, 0));
2116  							return TRUE;
2117  						}
2118  					}
2119  					return FALSE;
2120  				}
2121  			}
2122  	}
2123   	return FALSE;
2124  }
2125  intptr_t CALLBACK DefaultDirectorySubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
2126  {
2127  	NppParameters&amp; nppParam = NppParameters::getInstance();
2128  	NppGUI &amp; nppGUI = (NppGUI &amp; )nppParam.getNppGUI();
2129  	switch (message) 
2130  	{
2131  		case WM_INITDIALOG :
2132  		{
2133  			int ID2Check = 0;
2134  			bool shouldActivated;
2135  			switch (nppGUI._openSaveDir)
2136  			{
2137  				case dir_last :
2138  					ID2Check = IDC_OPENSAVEDIR_REMEMBERLAST_RADIO;
2139  					shouldActivated = false;
2140  					break;
2141  				case dir_userDef :
2142  					ID2Check = IDC_OPENSAVEDIR_ALWAYSON_RADIO;
2143  					shouldActivated = true;
2144  					break;
2145  				default : 
2146  					ID2Check = IDC_OPENSAVEDIR_FOLLOWCURRENT_RADIO;
2147  					shouldActivated = false;
2148  			}
2149  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
2150  			::SendDlgItemMessage(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._defaultDir));
2151  			::EnableWindow(::GetDlgItem(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT), shouldActivated);
2152  			::EnableWindow(::GetDlgItem(_hSelf, IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON), shouldActivated);
2153  			::SendDlgItemMessage(_hSelf, IDC_OPENSAVEDIR_CHECK_DRROPFOLDEROPENFILES, BM_SETCHECK, nppGUI._isFolderDroppedOpenFiles ? BST_CHECKED : BST_UNCHECKED, 0);
2154  			return TRUE;
2155  		}
2156  		case WM_CTLCOLOREDIT:
2157  		{
2158  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
2159  		}
2160  		case WM_CTLCOLORDLG:
2161  		case WM_CTLCOLORSTATIC:
2162  		{
2163  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2164  		}
2165  		case WM_PRINTCLIENT:
2166  		{
2167  			if (NppDarkMode::isEnabled())
2168  			{
2169  				return TRUE;
2170  			}
2171  			break;
2172  		}
2173  		case WM_COMMAND : 
2174  		{
2175  			if (HIWORD(wParam) == EN_CHANGE)
2176  			{
2177  				switch (LOWORD(wParam))
2178  				{
2179  					case  IDC_OPENSAVEDIR_ALWAYSON_EDIT:
2180  					{
2181  						TCHAR inputDir[MAX_PATH] = { &#x27;\0&#x27; };
2182  						::SendDlgItemMessage(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(inputDir));
2183  						wcscpy_s(nppGUI._defaultDir, inputDir);
2184  						::ExpandEnvironmentStrings(nppGUI._defaultDir, nppGUI._defaultDirExp, _countof(nppGUI._defaultDirExp));
2185  						nppParam.setWorkingDir(nppGUI._defaultDirExp);
2186  						return TRUE;
2187  					}
2188  				}
2189  			}
2190  			switch (wParam)
2191  			{
2192  				case IDC_OPENSAVEDIR_FOLLOWCURRENT_RADIO:
2193  					nppGUI._openSaveDir = dir_followCurrent;
2194  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_REFRESHWORKDIR, 0, 0);
2195  					::EnableWindow(::GetDlgItem(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT), false);
2196  					::EnableWindow(::GetDlgItem(_hSelf, IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON), false);
2197  					return TRUE;
2198  				case IDC_OPENSAVEDIR_REMEMBERLAST_RADIO:
2199  					nppGUI._openSaveDir = dir_last;
2200  					::EnableWindow(::GetDlgItem(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT), false);
2201  					::EnableWindow(::GetDlgItem(_hSelf, IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON), false);
2202  					return TRUE;
2203  				case IDC_OPENSAVEDIR_ALWAYSON_RADIO:
2204  					nppGUI._openSaveDir = dir_userDef;
2205  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_REFRESHWORKDIR, 0, 0);
2206  					::EnableWindow(::GetDlgItem(_hSelf, IDC_OPENSAVEDIR_ALWAYSON_EDIT), true);
2207  					::EnableWindow(::GetDlgItem(_hSelf, IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON), true);
2208  					return TRUE;
2209  				case IDD_OPENSAVEDIR_ALWAYSON_BROWSE_BUTTON :
2210  					{
2211  						generic_string title = nppParam.getNativeLangSpeaker()-&gt;getLocalizedStrFromID(&quot;default-open-save-select-folder&quot;,
2212  							TEXT(&quot;Select a folder as default directory&quot;));
2213  						folderBrowser(_hSelf, title, IDC_OPENSAVEDIR_ALWAYSON_EDIT);
2214  					}
2215  					return TRUE;
2216  				case IDC_OPENSAVEDIR_CHECK_DRROPFOLDEROPENFILES:
2217  					nppGUI._isFolderDroppedOpenFiles = isCheckedOrNot(IDC_OPENSAVEDIR_CHECK_DRROPFOLDEROPENFILES);
2218  					return TRUE;
2219  				default:
2220  					return FALSE;
2221  			}
2222  		}
2223  	}
2224  	return FALSE;
2225  }
2226  void RecentFilesHistorySubDlg::setCustomLen(int val)
2227  {
2228  	::SetDlgItemInt(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, val, FALSE);
2229  	::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL), val &gt; 0);
2230  }
2231  intptr_t CALLBACK RecentFilesHistorySubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
2232  {
2233  	NppParameters&amp; nppParam = NppParameters::getInstance();
2234  	NppGUI&amp; nppGUI = nppParam.getNppGUI();
2235  	switch (message) 
2236  	{
2237  		case WM_INITDIALOG:
2238  		{
2239  			::SetDlgItemInt(_hSelf, IDC_EDIT_MAXNBFILEVAL, nppParam.getNbMaxRecentFile(), FALSE);
2240  			::SendDlgItemMessage(_hSelf, IDC_CHECK_DONTCHECKHISTORY, BM_SETCHECK, !nppGUI._checkHistoryFiles, 0);
2241  			::SendDlgItemMessage(_hSelf, IDC_CHECK_INSUBMENU, BM_SETCHECK, nppParam.putRecentFileInSubMenu(), 0);
2242  			int customLength = nppParam.getRecentFileCustomLength();
2243  			int id = IDC_RADIO_CUSTOMIZELENTH;
2244  			int length = customLength;
2245  			if (customLength == RECENTFILES_SHOWONLYFILENAME)
2246  			{
2247  				id = IDC_RADIO_ONLYFILENAME;
2248  				length = 0;
2249  			}
2250  			else if (customLength == RECENTFILES_SHOWFULLPATH || customLength &lt; 0)
2251  			{
2252  				id = IDC_RADIO_FULLFILENAMEPATH;
2253  				length = 0;
2254  			}
2255  			setChecked(id);
2256  			setCustomLen(length);
2257  			return TRUE;
2258  		}
2259  		case WM_CTLCOLOREDIT:
2260  		{
2261  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
2262  		}
2263  		case WM_CTLCOLORDLG:
2264  		{
2265  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2266  		}
2267  		case WM_CTLCOLORSTATIC:
2268  		{
2269  			const auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
2270  			const auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
2271  			if (dlgCtrlID == IDC_CUSTOMIZELENGTH_RANGE_STATIC)
2272  			{
2273  				const bool isTextEnabled = isCheckedOrNot(IDC_RADIO_CUSTOMIZELENTH);
2274  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
2275  			}
2276  			if (dlgCtrlID == IDC_EDIT_CUSTOMIZELENGTHVAL)
2277  			{
2278  				return NppDarkMode::onCtlColor(hdcStatic);
2279  			}
2280  			return NppDarkMode::onCtlColorDarker(hdcStatic);
2281  		}
2282  		case WM_PRINTCLIENT:
2283  		{
2284  			if (NppDarkMode::isEnabled())
2285  			{
2286  				return TRUE;
2287  			}
2288  			break;
2289  		}
2290  		case WM_COMMAND:
2291  		{
2292  			switch (LOWORD(wParam))
2293  			{
2294  				case IDC_EDIT_MAXNBFILEVAL:
2295  				{
2296  					switch (HIWORD(wParam))
2297  					{
2298  						case EN_KILLFOCUS:
2299  						{
2300  							constexpr int stringSize = 3;
2301  							wchar_t str[stringSize]{};
2302  							::GetDlgItemText(_hSelf, IDC_EDIT_MAXNBFILEVAL, str, stringSize);
2303  							if (lstrcmp(str, L&quot;&quot;) == 0)
2304  							{
2305  								::SetDlgItemInt(_hSelf, IDC_EDIT_MAXNBFILEVAL, nppParam.getNbMaxRecentFile(), FALSE);
2306  								return FALSE;
2307  							}
2308  							UINT nbMaxFile = ::GetDlgItemInt(_hSelf, IDC_EDIT_MAXNBFILEVAL, nullptr, FALSE);
2309  							if (nbMaxFile == nppParam.getNbMaxRecentFile())
2310  							{
2311  								return FALSE;
2312  							}
2313  							if (nbMaxFile &gt; NB_MAX_LRF_FILE)
2314  							{
2315  								::SetDlgItemInt(_hSelf, IDC_EDIT_MAXNBFILEVAL, NB_MAX_LRF_FILE, FALSE);
2316  								nbMaxFile = NB_MAX_LRF_FILE;
2317  							}
2318  							nppParam.setNbMaxRecentFile(nbMaxFile);
2319  							::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETTING_HISTORY_SIZE, 0, 0);
2320  							return TRUE;
2321  						}
2322  						default:
2323  						{
2324  							break;
2325  						}
2326  					}
2327  					return FALSE;
2328  				}
2329  				case IDC_EDIT_CUSTOMIZELENGTHVAL:
2330  				{
2331  					if (!isCheckedOrNot(IDC_RADIO_CUSTOMIZELENTH))
2332  					{
2333  						return FALSE;
2334  					}
2335  					switch (HIWORD(wParam))
2336  					{
2337  						case EN_KILLFOCUS:
2338  						{
2339  							constexpr int stringSize = 4;
2340  							wchar_t str[stringSize]{};
2341  							::GetDlgItemText(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, str, stringSize);
2342  							if (lstrcmp(str, L&quot;&quot;) == 0)
2343  							{
2344  								::SetDlgItemInt(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, nppParam.getRecentFileCustomLength(), FALSE);
2345  								return FALSE;
2346  							}
2347  							UINT size = ::GetDlgItemInt(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, nullptr, FALSE);
2348  							if (size == static_cast&lt;UINT&gt;(nppParam.getRecentFileCustomLength()))
2349  							{
2350  								return FALSE;
2351  							}
2352  							bool change = false;
2353  							if (size == 0)
2354  							{
2355  								size = NB_DEFAULT_LRF_CUSTOMLENGTH;
2356  								change = true;
2357  							}
2358  							else if (size &gt; NB_MAX_LRF_CUSTOMLENGTH)
2359  							{
2360  								size = NB_MAX_LRF_CUSTOMLENGTH;
2361  								change = true;
2362  							}
2363  							if (change)
2364  							{
2365  								::SetDlgItemInt(_hSelf, IDC_EDIT_CUSTOMIZELENGTHVAL, size, FALSE);
2366  							}
2367  							nppParam.setRecentFileCustomLength(size);
2368  							::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_UPDATE, 0, 0);
2369  							return TRUE;
2370  						}
2371  						default:
2372  						{
2373  							break;
2374  						}
2375  					}
2376  					return FALSE;
2377  				}
2378  				default:
2379  				{
2380  					break;
2381  				}
2382  			}
2383  			switch (wParam)
2384  			{
2385  				case IDC_CHECK_DONTCHECKHISTORY:
2386  					nppGUI._checkHistoryFiles = !isCheckedOrNot(IDC_CHECK_DONTCHECKHISTORY);
2387  					return TRUE;
2388  				case IDC_CHECK_INSUBMENU:
2389  					nppParam.setPutRecentFileInSubMenu(isCheckedOrNot(IDC_CHECK_INSUBMENU));
2390  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_SWITCH, 0, 0);
2391  					return TRUE;
2392  				case IDC_RADIO_ONLYFILENAME:
2393  				{
2394  					setCustomLen(0);
2395  					nppParam.setRecentFileCustomLength(0);
2396  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_UPDATE, 0, 0);
2397  					redrawDlgItem(IDC_CUSTOMIZELENGTH_RANGE_STATIC);
2398  					return TRUE;
2399  				}
2400  				case IDC_RADIO_FULLFILENAMEPATH:
2401  				{
2402  					setCustomLen(0);
2403  					nppParam.setRecentFileCustomLength(-1);
2404  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_UPDATE, 0, 0);
2405  					redrawDlgItem(IDC_CUSTOMIZELENGTH_RANGE_STATIC);
2406  					return TRUE;
2407  				}
2408  				case IDC_RADIO_CUSTOMIZELENTH:
2409  				{
2410  					int len = nppParam.getRecentFileCustomLength();
2411  					if (len &lt;= 0)
2412  					{
2413  						setCustomLen(NB_DEFAULT_LRF_CUSTOMLENGTH);
2414  						nppParam.setRecentFileCustomLength(NB_DEFAULT_LRF_CUSTOMLENGTH);
2415  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_RECENTFILELIST_UPDATE, 0, 0);
2416  					}
2417  					redrawDlgItem(IDC_CUSTOMIZELENGTH_RANGE_STATIC);
2418  					return TRUE;
2419  				}
2420  				default:
2421  					return FALSE;
2422  			}
2423  		}
2424  	}
2425  	return FALSE;
2426  }
2427  intptr_t CALLBACK LanguageSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
2428  {
2429  	NppParameters&amp; nppParam = NppParameters::getInstance();
2430  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
2431  	NativeLangSpeaker *pNativeSpeaker = nppParam.getNativeLangSpeaker();
2432  	switch (message) 
2433  	{
2434  		case WM_INITDIALOG :
2435  		{
2436  			for (int i = L_TEXT ; i &lt; nppParam.L_END ; ++i)
2437  			{
2438  				generic_string str;
2439  				if (static_cast&lt;LangType&gt;(i) != L_USER)
2440  				{
2441  					int cmdID = nppParam.langTypeToCommandID(static_cast&lt;LangType&gt;(i));
2442  					if ((cmdID != -1))
2443  					{
2444  						getNameStrFromCmd(cmdID, str);
2445  						if (str.length() &gt; 0)
2446  						{
2447  							_langList.push_back(LangMenuItem(static_cast&lt;LangType&gt;(i), cmdID, str));
2448  							::SendDlgItemMessage(_hSelf, IDC_LIST_ENABLEDLANG, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(str.c_str()));
2449  						}
2450  					}
2451  				}
2452  			}
2453  			for (size_t i = 0, len = nppGUI._excludedLangList.size(); i &lt; len ; ++i)
2454  			{
2455  				::SendDlgItemMessage(_hSelf, IDC_LIST_DISABLEDLANG, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._excludedLangList[i]._langName.c_str()));
2456  			}
2457  			::SendDlgItemMessage(_hSelf, IDC_CHECK_LANGMENUCOMPACT, BM_SETCHECK, nppGUI._isLangMenuCompact?BST_CHECKED:BST_UNCHECKED, 0);
2458  			::EnableWindow(::GetDlgItem(_hSelf, IDC_BUTTON_REMOVE), FALSE);
2459  			::EnableWindow(::GetDlgItem(_hSelf, IDC_BUTTON_RESTORE), FALSE);
2460  			::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, nppGUI._tabSize, FALSE);
2461  			::SendDlgItemMessage(_hSelf, IDC_CHECK_REPLACEBYSPACE, BM_SETCHECK, nppGUI._tabReplacedBySpace, 0);
2462  			::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;[Default]&quot;)));
2463  			const int nbLang = nppParam.getNbLang();
2464  			for (int i = 0; i &lt; nbLang; ++i)
2465  			{
2466  				::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(nppParam.getLangFromIndex(i)-&gt;_langName.c_str()));
2467  			}
2468  			const int index2Begin = 0;
2469  			::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_SETCURSEL, index2Begin, 0);
2470  			::ShowWindow(::GetDlgItem(_hSelf, IDC_GR_TABVALUE_STATIC), SW_HIDE);
2471  			::ShowWindow(::GetDlgItem(_hSelf, IDC_CHECK_DEFAULTTABVALUE), SW_HIDE);
2472  			::SendDlgItemMessage(_hSelf, IDC_CHECK_BACKSLASHISESCAPECHARACTERFORSQL, BM_SETCHECK, nppGUI._backSlashIsEscapeCharacterForSql, 0);
2473  			return TRUE;
2474  		}
2475  		case WM_CTLCOLOREDIT:
2476  		{
2477  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
2478  		}
2479  		case WM_CTLCOLORLISTBOX:
2480  		{
2481  			return NppDarkMode::onCtlColorListbox(wParam, lParam);
2482  		}
2483  		case WM_CTLCOLORDLG:
2484  		{
2485  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2486  		}
2487  		case WM_CTLCOLORSTATIC:
2488  		{
2489  			const int dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
2490  			const auto&amp; hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
2491  			const size_t index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2492  			if ((index &gt; 0) &amp;&amp; (dlgCtrlID == IDC_TABSIZE_STATIC))
2493  			{
2494  				const Lang* lang = nppParam.getLangFromIndex(index - 1);
2495  				if (lang == nullptr)
2496  				{
2497  					return NppDarkMode::onCtlColorDarker(hdcStatic);
2498  				}
2499  				const bool useDefaultTab = isCheckedOrNot(IDC_CHECK_DEFAULTTABVALUE);
2500  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, !useDefaultTab);
2501  			}
2502  			return NppDarkMode::onCtlColorDarker(hdcStatic);
2503  		}
2504  		case WM_PRINTCLIENT:
2505  		{
2506  			if (NppDarkMode::isEnabled())
2507  			{
2508  				return TRUE;
2509  			}
2510  			break;
2511  		}
2512  		case WM_COMMAND : 
2513  		{
2514  			switch (HIWORD(wParam))
2515  			{
2516  				case LBN_SELCHANGE:
2517  				{
2518  					if (LOWORD(wParam) == IDC_LIST_DISABLEDLANG || LOWORD(wParam) == IDC_LIST_ENABLEDLANG)
2519  					{
2520  						int idButton2Enable;
2521  						int idButton2Disable;
2522  						if (LOWORD(wParam) == IDC_LIST_ENABLEDLANG)
2523  						{
2524  							idButton2Enable = IDC_BUTTON_REMOVE;
2525  							idButton2Disable = IDC_BUTTON_RESTORE;
2526  						}
2527  						else 
2528  						{
2529  							idButton2Enable = IDC_BUTTON_RESTORE;
2530  							idButton2Disable = IDC_BUTTON_REMOVE;
2531  						}
2532  						auto i = ::SendDlgItemMessage(_hSelf, LOWORD(wParam), LB_GETCURSEL, 0, 0);
2533  						if (i != LB_ERR)
2534  						{
2535  							::EnableWindow(::GetDlgItem(_hSelf, idButton2Enable), TRUE);
2536  							int idListbox2Disable = (LOWORD(wParam) == IDC_LIST_ENABLEDLANG) ? IDC_LIST_DISABLEDLANG : IDC_LIST_ENABLEDLANG;
2537  							::SendDlgItemMessage(_hSelf, idListbox2Disable, LB_SETCURSEL, static_cast&lt;WPARAM&gt;(-1), 0);
2538  							::EnableWindow(::GetDlgItem(_hSelf, idButton2Disable), FALSE);
2539  						}
2540  						return TRUE;
2541  					}
2542  					else if (LOWORD(wParam) == IDC_LIST_TABSETTNG)
2543  					{
2544  						auto index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2545  						if (index == LB_ERR)
2546  							return FALSE;
2547  						::ShowWindow(::GetDlgItem(_hSelf, IDC_GR_TABVALUE_STATIC), index &gt; 0 ? SW_SHOW : SW_HIDE);
2548  						::ShowWindow(::GetDlgItem(_hSelf, IDC_CHECK_DEFAULTTABVALUE), index &gt; 0 ? SW_SHOW : SW_HIDE);
2549  						if (index &gt; 0)
2550  						{
2551  							Lang* lang = nppParam.getLangFromIndex(index - 1);
2552  							if (!lang) return FALSE;
2553  							bool useDefaultTab = (lang-&gt;_tabSize == -1 || lang-&gt;_tabSize == 0);
2554  							::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_DEFAULTTABVALUE), BM_SETCHECK, useDefaultTab, 0);
2555  							int size = useDefaultTab ? nppGUI._tabSize : lang-&gt;_tabSize;
2556  							::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, size, FALSE);
2557  							::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), BM_SETCHECK, useDefaultTab ? nppGUI._tabReplacedBySpace : lang-&gt;_isTabReplacedBySpace, 0);
2558  							::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), !useDefaultTab);
2559  							::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_TABSIZEVAL), !useDefaultTab);
2560  							if (!useDefaultTab)
2561  							{
2562  								::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, lang-&gt;_tabSize, FALSE);
2563  								::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), BM_SETCHECK, lang-&gt;_isTabReplacedBySpace, 0);
2564  							}
2565  						}
2566  						else
2567  						{
2568  							::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, nppGUI._tabSize, FALSE);
2569  							::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), TRUE);
2570  							::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_TABSIZEVAL), TRUE);
2571  							::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), BM_SETCHECK, nppGUI._tabReplacedBySpace, 0);
2572  						}
2573  						redrawDlgItem(IDC_TABSIZE_STATIC);
2574  						return TRUE;
2575  					}
2576  					break;
2577  				}
2578  				case LBN_DBLCLK:
2579  				{
2580  					if (LOWORD(wParam) == IDC_LIST_DISABLEDLANG || LOWORD(wParam) == IDC_LIST_ENABLEDLANG)
2581  					{
2582  						HWND(lParam) == ::GetDlgItem(_hSelf, IDC_LIST_ENABLEDLANG) ?
2583  							::SendMessage(_hSelf, WM_COMMAND, IDC_BUTTON_REMOVE, 0) :
2584  							::SendMessage(_hSelf, WM_COMMAND, IDC_BUTTON_RESTORE, 0);
2585  						return TRUE;
2586  					}
2587  					break;
2588  				}
2589  				case EN_CHANGE:
2590  				{
2591  					switch (LOWORD(wParam))
2592  					{
2593  						case IDC_EDIT_TABSIZEVAL:
2594  						{
2595  							const auto tabSize = ::GetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, nullptr, FALSE);
2596  							if (tabSize &lt; 1)
2597  							{
2598  								return FALSE;
2599  							}
2600  							const bool useDefaultTab = isCheckedOrNot(IDC_CHECK_DEFAULTTABVALUE);
2601  							const size_t index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2602  							if (!useDefaultTab &amp;&amp; index &gt; 0)
2603  							{
2604  								Lang* lang = nppParam.getLangFromIndex(index - 1);
2605  								if (lang == nullptr)
2606  								{
2607  									return FALSE;
2608  								}
2609  								if (lang-&gt;_langID == L_JS)
2610  								{
2611  									Lang* ljs = nppParam.getLangFromID(L_JAVASCRIPT);
2612  									ljs-&gt;_tabSize = tabSize;
2613  								}
2614  								else if (lang-&gt;_langID == L_JAVASCRIPT)
2615  								{
2616  									Lang* ljavascript = nppParam.getLangFromID(L_JS);
2617  									ljavascript-&gt;_tabSize = tabSize;
2618  								}
2619  								lang-&gt;_tabSize = tabSize;
2620  								nppParam.insertTabInfo(lang-&gt;getLangName(), lang-&gt;getTabInfo());
2621  							}
2622  							else
2623  							{
2624  								nppGUI._tabSize = tabSize;
2625  							}
2626  							::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETTING_TAB_SIZE, 0, 0);
2627  							return TRUE;
2628  						}
2629  						default:
2630  						{
2631  							break;
2632  						}
2633  					}
2634  					break;
2635  				}
2636  				case EN_KILLFOCUS:
2637  				{
2638  					switch (LOWORD(wParam))
2639  					{
2640  						case IDC_EDIT_TABSIZEVAL:
2641  						{
2642  							const auto tabSize = ::GetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, nullptr, FALSE);
2643  							if (tabSize &lt; 1)
2644  							{
2645  								const bool useDefaultTab = isCheckedOrNot(IDC_CHECK_DEFAULTTABVALUE);
2646  								const size_t index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2647  								auto prevSize = nppGUI._tabSize;
2648  								if (!useDefaultTab &amp;&amp; index &gt; 0)
2649  								{
2650  									Lang* lang = nppParam.getLangFromIndex(index - 1);
2651  									if (lang != nullptr &amp;&amp; lang-&gt;_tabSize &gt; 0)
2652  									{
2653  										prevSize = lang-&gt;_tabSize;
2654  									}
2655  								}
2656  								::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, prevSize, FALSE);
2657  								return TRUE;
2658  							}
2659  							return FALSE;
2660  						}
2661  						default:
2662  						{
2663  							break;
2664  						}
2665  					}
2666  					break;
2667  				}
2668  				default:
2669  				{
2670  					break;
2671  				}
2672  			}
2673  			switch (wParam)
2674  			{
2675  				case IDC_CHECK_LANGMENUCOMPACT:
2676  				{
2677  					nppGUI._isLangMenuCompact = (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_LANGMENUCOMPACT), BM_GETCHECK, 0, 0));
2678  					pNativeSpeaker-&gt;messageBox(&quot;LanguageMenuCompactWarning&quot;,
2679  						_hSelf,
2680  						TEXT(&quot;This option will be changed on the next launch.&quot;),
2681  						TEXT(&quot;Compact Language Menu&quot;),
2682  						MB_OK);
2683  					return TRUE;
2684  				}
2685  				case IDC_CHECK_BACKSLASHISESCAPECHARACTERFORSQL:
2686  				{
2687  					nppGUI._backSlashIsEscapeCharacterForSql = isCheckedOrNot(IDC_CHECK_BACKSLASHISESCAPECHARACTERFORSQL);
2688  					return TRUE;
2689  				}
2690  				case IDC_BUTTON_RESTORE :
2691  				case IDC_BUTTON_REMOVE :
2692  				{
2693  					int list2Remove, list2Add, idButton2Enable, idButton2Disable;
2694  					vector&lt;LangMenuItem&gt; *pSrcLst, *pDestLst;
2695  					if (LOWORD(wParam)==IDC_BUTTON_REMOVE)
2696  					{
2697  						list2Remove = IDC_LIST_ENABLEDLANG;
2698  						list2Add = IDC_LIST_DISABLEDLANG;
2699  						idButton2Enable = IDC_BUTTON_RESTORE;
2700  						idButton2Disable = IDC_BUTTON_REMOVE;
2701  						pSrcLst = &amp;_langList;
2702  						pDestLst = &amp;nppGUI._excludedLangList;
2703  					}
2704  					else
2705  					{
2706  						list2Remove = IDC_LIST_DISABLEDLANG;
2707  						list2Add = IDC_LIST_ENABLEDLANG;
2708  						idButton2Enable = IDC_BUTTON_REMOVE;
2709  						idButton2Disable = IDC_BUTTON_RESTORE;
2710  						pSrcLst = &amp;nppGUI._excludedLangList;
2711  						pDestLst = &amp;_langList;
2712  					}
2713  					size_t iRemove = ::SendDlgItemMessage(_hSelf, list2Remove, LB_GETCURSEL, 0, 0);
2714  					if (static_cast&lt;intptr_t&gt;(iRemove) == -1)
2715  						return TRUE;
2716  					const size_t sL = 31;
2717  					TCHAR s[sL + 1] = { &#x27;\0&#x27; };
2718  					auto lbTextLen = ::SendDlgItemMessage(_hSelf, list2Remove, LB_GETTEXTLEN, iRemove, 0);
2719  					if (static_cast&lt;size_t&gt;(lbTextLen) &gt; sL)
2720  						return TRUE;
2721  					::SendDlgItemMessage(_hSelf, list2Remove, LB_GETTEXT, iRemove, reinterpret_cast&lt;LPARAM&gt;(s));
2722  					LangMenuItem lmi = pSrcLst-&gt;at(iRemove);
2723  					vector&lt;LangMenuItem&gt;::iterator lang2Remove = pSrcLst-&gt;begin() + iRemove;
2724  					pSrcLst-&gt;erase(lang2Remove);
2725  					auto iAdd = ::SendDlgItemMessage(_hSelf, list2Add, LB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(s));
2726  					::SendDlgItemMessage(_hSelf, list2Remove, LB_DELETESTRING, iRemove, 0);
2727  					pDestLst-&gt;push_back(lmi);
2728  					::SendDlgItemMessage(_hSelf, list2Add, LB_SETCURSEL, iAdd, 0);
2729  					::SendDlgItemMessage(_hSelf, list2Remove, LB_SETCURSEL, static_cast&lt;WPARAM&gt;(-1), 0);
2730  					::EnableWindow(::GetDlgItem(_hSelf, idButton2Enable), TRUE);
2731  					::EnableWindow(::GetDlgItem(_hSelf, idButton2Disable), FALSE);
2732  					if ((lmi._langType &gt;= L_EXTERNAL) &amp;&amp; (lmi._langType &lt; nppParam.L_END))
2733  					{
2734  						bool found(false);
2735  						for (size_t x = 0; x &lt; nppParam.getExternalLexerDoc()-&gt;size() &amp;&amp; !found; ++x)
2736  						{
2737  							TiXmlNode *lexersRoot = nppParam.getExternalLexerDoc()-&gt;at(x)-&gt;FirstChild(TEXT(&quot;NotepadPlus&quot;))-&gt;FirstChildElement(TEXT(&quot;LexerStyles&quot;));
2738  							for (TiXmlNode *childNode = lexersRoot-&gt;FirstChildElement(TEXT(&quot;LexerType&quot;));
2739  								childNode ;
2740  								childNode = childNode-&gt;NextSibling(TEXT(&quot;LexerType&quot;)))
2741  							{
2742  								TiXmlElement *element = childNode-&gt;ToElement();
2743  								if (generic_string(element-&gt;Attribute(TEXT(&quot;name&quot;))) == lmi._langName)
2744  								{
2745  									element-&gt;SetAttribute(TEXT(&quot;excluded&quot;), (LOWORD(wParam)==IDC_BUTTON_REMOVE)?TEXT(&quot;yes&quot;):TEXT(&quot;no&quot;));
2746  									nppParam.getExternalLexerDoc()-&gt;at(x)-&gt;SaveFile();
2747  									found = true;
2748  									break;
2749  								}
2750  							}
2751  						}
2752  					}
2753  					HWND grandParent = ::GetParent(_hParent);
2754  					if (LOWORD(wParam)==IDC_BUTTON_REMOVE)
2755  					{
2756  						HMENU menu2remove = reinterpret_cast&lt;HMENU&gt;(::SendMessage(grandParent, NPPM_INTERNAL_GETMENU, 0, 0));
2757  						::DeleteMenu(menu2remove, lmi._cmdID, MF_BYCOMMAND);
2758  					}
2759  					else
2760  					{
2761  						HMENU menu = HMENU(::SendMessage(grandParent, NPPM_INTERNAL_GETMENU, 0, 0));
2762  						HMENU subMenu = ::GetSubMenu(menu, MENUINDEX_LANGUAGE);
2763  						int nbItem = ::GetMenuItemCount(subMenu);
2764  						int x = 0;
2765  						MENUITEMINFO menuItemInfo
2766  						{
2767  							.cbSize = sizeof(MENUITEMINFO),
2768  							.fMask = MIIM_FTYPE
2769  						};
2770  						for (; x &lt; nbItem; ++x)
2771  						{
2772  							::GetMenuItemInfo(subMenu, x, TRUE, &amp;menuItemInfo);
2773  							if (menuItemInfo.fType &amp; MFT_SEPARATOR)
2774  							{
2775  								break;
2776  							}
2777  						}
2778  						TCHAR firstLetter = lmi._langName.empty() ? TEXT(&#x27;\0&#x27;) : towupper(lmi._langName[0]);
2779  						TCHAR buffer[MAX_EXTERNAL_LEXER_NAME_LEN]{TEXT(&#x27;\0&#x27;)};
2780  						menuItemInfo.fMask = MIIM_SUBMENU;
2781  						for (++x; x &lt; nbItem; ++x)
2782  						{
2783  							::GetMenuItemInfo(subMenu, x, TRUE, &amp;menuItemInfo);
2784  							::GetMenuString(subMenu, x, buffer, MAX_EXTERNAL_LEXER_NAME_LEN, MF_BYPOSITION);
2785  							if (menuItemInfo.hSubMenu &amp;&amp; buffer[0] == firstLetter)
2786  							{
2787  								subMenu = menuItemInfo.hSubMenu;
2788  								nbItem = ::GetMenuItemCount(subMenu);
2789  								x = -1;
2790  							}
2791  							else if (lstrcmp(lmi._langName.c_str(), buffer) &lt; 0)
2792  							{
2793  								break;
2794  							}
2795  						}
2796  						::InsertMenu(subMenu, x, MF_BYPOSITION, lmi._cmdID, lmi._langName.c_str());
2797  					}
2798  					::DrawMenuBar(grandParent);
2799  					return TRUE;
2800  				}
2801  				case IDC_CHECK_REPLACEBYSPACE:
2802  				{
2803  					bool isTabReplacedBySpace = BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), BM_GETCHECK, 0, 0);
2804  					auto index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2805  					if (index == LB_ERR) return FALSE;
2806  					if (index != 0)
2807  					{
2808  						Lang *lang = nppParam.getLangFromIndex(index - 1);
2809  						if (!lang) return FALSE;
2810  						if (!lang-&gt;_tabSize || lang-&gt;_tabSize == -1)
2811  							lang-&gt;_tabSize = nppGUI._tabSize;
2812  						if (lang-&gt;_langID == L_JS)
2813  						{
2814  							Lang *ljs = nppParam.getLangFromID(L_JAVASCRIPT);
2815  							ljs-&gt;_isTabReplacedBySpace = isTabReplacedBySpace;
2816  						}
2817  						else if (lang-&gt;_langID == L_JAVASCRIPT)
2818  						{
2819  							Lang *ljavascript = nppParam.getLangFromID(L_JS);
2820  							ljavascript-&gt;_isTabReplacedBySpace = isTabReplacedBySpace;
2821  						}
2822  						lang-&gt;_isTabReplacedBySpace = isTabReplacedBySpace;
2823  						nppParam.insertTabInfo(lang-&gt;getLangName(), lang-&gt;getTabInfo());
2824  					}
2825  					else
2826  					{
2827  						nppGUI._tabReplacedBySpace = isTabReplacedBySpace;
2828  					}
2829  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETTING_TAB_REPLCESPACE, 0, 0);
2830  					return TRUE;
2831  				}
2832  				case IDC_CHECK_DEFAULTTABVALUE:
2833  				{
2834  					const bool useDefaultTab = isCheckedOrNot(IDC_CHECK_DEFAULTTABVALUE);
2835  					const auto index = ::SendDlgItemMessage(_hSelf, IDC_LIST_TABSETTNG, LB_GETCURSEL, 0, 0);
2836  					if (index == LB_ERR || index == 0) 
2837  						return FALSE;
2838  					Lang *lang = nppParam.getLangFromIndex(index - 1);
2839  					if (!lang)
2840  						return FALSE;
2841  					lang-&gt;_tabSize = useDefaultTab ? 0 : nppGUI._tabSize;
2842  					lang-&gt;_isTabReplacedBySpace = useDefaultTab ? false : nppGUI._tabReplacedBySpace;
2843  					::SetDlgItemInt(_hSelf, IDC_EDIT_TABSIZEVAL, useDefaultTab ? nppGUI._tabSize : lang-&gt;_tabSize, FALSE);
2844  					setChecked(IDC_CHECK_REPLACEBYSPACE, useDefaultTab ? nppGUI._tabReplacedBySpace : lang-&gt;_isTabReplacedBySpace);
2845  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_REPLACEBYSPACE), !useDefaultTab);
2846  					::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_TABSIZEVAL), !useDefaultTab);
2847  					if (useDefaultTab)
2848  						nppParam.insertTabInfo(lang-&gt;getLangName(), -1);
2849  					redrawDlgItem(IDC_TABSIZE_STATIC);
2850  					return TRUE;
2851  				}
2852  				default:
2853  				{
2854  					break;
2855  				}
2856  			}
2857  		}
2858  		default:
2859  		{
2860  			break;
2861  		}
2862  	}
2863  	return FALSE;
2864  }
2865  intptr_t CALLBACK HighlightingSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM&amp;bsol;* lParam*/)
2866  {
2867  	NppParameters&amp; nppParam = NppParameters::getInstance();
2868  	NppGUI &amp; nppGUI = (NppGUI &amp; )nppParam.getNppGUI();
2869  	switch (message) 
2870  	{
2871  		case WM_INITDIALOG :
2872  		{
2873  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MARKALLCASESENSITIVE, BM_SETCHECK, nppGUI._markAllCaseSensitive, 0);
2874  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MARKALLWHOLEWORDONLY, BM_SETCHECK, nppGUI._markAllWordOnly, 0);
2875  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLSMARTHILITE, BM_SETCHECK, nppGUI._enableSmartHilite, 0);
2876  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITECASESENSITIVE, BM_SETCHECK, nppGUI._smartHiliteCaseSensitive, 0);
2877  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEWHOLEWORDONLY, BM_SETCHECK, nppGUI._smartHiliteWordOnly, 0);
2878  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS, BM_SETCHECK, nppGUI._smartHiliteUseFindSettings, 0);
2879  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEANOTHERRVIEW, BM_SETCHECK, nppGUI._smartHiliteOnAnotherView, 0);
2880  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLTAGSMATCHHILITE, BM_SETCHECK, nppGUI._enableTagsMatchHilite, 0);
2881  			::SendDlgItemMessage(_hSelf, IDC_CHECK_ENABLTAGATTRHILITE, BM_SETCHECK, nppGUI._enableTagAttrsHilite, 0);
2882  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HIGHLITENONEHTMLZONE, BM_SETCHECK, nppGUI._enableHiliteNonHTMLZone, 0);
2883  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_ENABLTAGATTRHILITE), nppGUI._enableTagsMatchHilite);
2884  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_HIGHLITENONEHTMLZONE), nppGUI._enableTagsMatchHilite);
2885  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITECASESENSITIVE), nppGUI._enableSmartHilite);
2886  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEWHOLEWORDONLY), nppGUI._enableSmartHilite);
2887  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS), nppGUI._enableSmartHilite);
2888  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEANOTHERRVIEW), nppGUI._enableSmartHilite);
2889  			if (NppDarkMode::isEnabled())
2890  			{
2891  				::EnableWindow(::GetDlgItem(_hSelf, IDC_SMARTHILITEMATCHING_STATIC), nppGUI._enableSmartHilite);
2892  			}
2893  			return TRUE;
2894  		}
2895  		case WM_CTLCOLORDLG:
2896  		case WM_CTLCOLORSTATIC:
2897  		{
2898  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
2899  		}
2900  		case WM_PRINTCLIENT:
2901  		{
2902  			if (NppDarkMode::isEnabled())
2903  			{
2904  				return TRUE;
2905  			}
2906  			break;
2907  		}
2908  		case WM_COMMAND : 
2909  		{
2910  			switch (wParam)
2911  			{
2912  				case IDC_CHECK_MARKALLCASESENSITIVE:
2913  				{
2914  					nppGUI._markAllCaseSensitive = isCheckedOrNot(IDC_CHECK_MARKALLCASESENSITIVE);
2915  					HWND grandParent = ::GetParent(_hParent);
2916  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2917  					return TRUE;
2918  				}
2919  				case IDC_CHECK_MARKALLWHOLEWORDONLY:
2920  				{
2921  					nppGUI._markAllWordOnly = isCheckedOrNot(IDC_CHECK_MARKALLWHOLEWORDONLY);
2922  					HWND grandParent = ::GetParent(_hParent);
2923  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2924  					return TRUE;
2925  				}
2926  				case IDC_CHECK_ENABLSMARTHILITE:
2927  				{
2928  					nppGUI._enableSmartHilite = !nppGUI._enableSmartHilite;
2929  					if (!nppGUI._enableSmartHilite)
2930  					{
2931  					}
2932  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITECASESENSITIVE), nppGUI._enableSmartHilite);
2933  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEWHOLEWORDONLY), nppGUI._enableSmartHilite);
2934  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS), nppGUI._enableSmartHilite);
2935  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_SMARTHILITEANOTHERRVIEW), nppGUI._enableSmartHilite);
2936  					if (NppDarkMode::isEnabled())
2937  					{
2938  						::EnableWindow(::GetDlgItem(_hSelf, IDC_SMARTHILITEMATCHING_STATIC), nppGUI._enableSmartHilite);
2939  						redrawDlgItem(IDC_SMARTHILITEMATCHING_STATIC);
2940  					}
2941  					HWND grandParent = ::GetParent(_hParent);
2942  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2943  					return TRUE;
2944  				}
2945  				case IDC_CHECK_SMARTHILITECASESENSITIVE:
2946  				{
2947  					nppGUI._smartHiliteCaseSensitive = isCheckedOrNot(IDC_CHECK_SMARTHILITECASESENSITIVE);
2948  					if (nppGUI._smartHiliteCaseSensitive)
2949  					{
2950  						::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS, BM_SETCHECK, false, 0);
2951  						nppGUI._smartHiliteUseFindSettings = false;
2952  					}
2953  					HWND grandParent = ::GetParent(_hParent);
2954  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2955  					return TRUE;
2956  				}
2957  				case IDC_CHECK_SMARTHILITEWHOLEWORDONLY:
2958  				{
2959  					nppGUI._smartHiliteWordOnly = isCheckedOrNot(IDC_CHECK_SMARTHILITEWHOLEWORDONLY);
2960  					if (nppGUI._smartHiliteWordOnly)
2961  					{
2962  						::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEUSEFINDSETTINGS, BM_SETCHECK, false, 0);
2963  						nppGUI._smartHiliteUseFindSettings = false;
2964  					}
2965  					HWND grandParent = ::GetParent(_hParent);
2966  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2967  					return TRUE;
2968  				}
2969  				case IDC_CHECK_SMARTHILITEUSEFINDSETTINGS:
2970  				{
2971  					nppGUI._smartHiliteUseFindSettings = isCheckedOrNot(IDC_CHECK_SMARTHILITEUSEFINDSETTINGS);
2972  					if (nppGUI._smartHiliteUseFindSettings)
2973  					{
2974  						::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITECASESENSITIVE, BM_SETCHECK, false, 0);
2975  						::SendDlgItemMessage(_hSelf, IDC_CHECK_SMARTHILITEWHOLEWORDONLY, BM_SETCHECK, false, 0);
2976  						nppGUI._smartHiliteCaseSensitive = false;
2977  						nppGUI._smartHiliteWordOnly = false;
2978  					}
2979  					HWND grandParent = ::GetParent(_hParent);
2980  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2981  					return TRUE;
2982  				}
2983  				case IDC_CHECK_SMARTHILITEANOTHERRVIEW:
2984  				{
2985  					nppGUI._smartHiliteOnAnotherView = isCheckedOrNot(IDC_CHECK_SMARTHILITEANOTHERRVIEW);
2986  					HWND grandParent = ::GetParent(_hParent);
2987  					::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATOR, 0, 0);
2988  					return TRUE;
2989  				}
2990  				case IDC_CHECK_ENABLTAGSMATCHHILITE:
2991  				{
2992  					nppGUI._enableTagsMatchHilite = !nppGUI._enableTagsMatchHilite;
2993  					if (!nppGUI._enableTagsMatchHilite)
2994  					{
2995  						HWND grandParent = ::GetParent(_hParent);
2996  						::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATORTAGMATCH, 0, 0);
2997  					}
2998  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_ENABLTAGATTRHILITE), nppGUI._enableTagsMatchHilite);
2999  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_HIGHLITENONEHTMLZONE), nppGUI._enableTagsMatchHilite);
3000  					return TRUE;
3001  				}
3002  				case IDC_CHECK_ENABLTAGATTRHILITE:
3003  				{
3004  					nppGUI._enableTagAttrsHilite = !nppGUI._enableTagAttrsHilite;
3005  					if (!nppGUI._enableTagAttrsHilite)
3006  					{
3007  						HWND grandParent = ::GetParent(_hParent);
3008  						::SendMessage(grandParent, NPPM_INTERNAL_CLEARINDICATORTAGATTR, 0, 0);
3009  					}
3010  					return TRUE;
3011  				}
3012  				case IDC_CHECK_HIGHLITENONEHTMLZONE:
3013  				{
3014  					nppGUI._enableHiliteNonHTMLZone = !nppGUI._enableHiliteNonHTMLZone;
3015  					return TRUE;
3016  				}
3017  			}
3018  		}
3019  	}
3020  	return FALSE;
3021  }
3022  intptr_t CALLBACK PrintSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
3023  {
3024  	NppParameters&amp; nppParam = NppParameters::getInstance();
3025  	NppGUI &amp; nppGUI = (NppGUI &amp; )nppParam.getNppGUI();
3026  	switch (message) 
3027  	{
3028  		case WM_INITDIALOG :
3029  		{
3030  			bool printLN = nppGUI._printSettings._printLineNumber;
3031  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PRINTLINENUM, BM_SETCHECK, printLN, 0);
3032  			int ID2Check = 0;
3033  			switch (nppGUI._printSettings._printOption)
3034  			{
3035  				case SC_PRINT_NORMAL :
3036  					ID2Check = IDC_RADIO_WYSIWYG;
3037  					break;
3038  				case SC_PRINT_INVERTLIGHT :
3039  					ID2Check = IDC_RADIO_INVERT;
3040  					break;
3041  				case SC_PRINT_BLACKONWHITE :
3042  					ID2Check = IDC_RADIO_BW;
3043  					break;
3044  				case SC_PRINT_COLOURONWHITE :
3045  					ID2Check = IDC_RADIO_NOBG;
3046  					break;
3047  			}
3048  			::SendDlgItemMessage(_hSelf, ID2Check, BM_SETCHECK, BST_CHECKED, 0);
3049  			::SetDlgItemInt(_hSelf, IDC_EDIT_ML, nppGUI._printSettings._marge.left, FALSE);
3050  			::SetDlgItemInt(_hSelf, IDC_EDIT_MR, nppGUI._printSettings._marge.right, FALSE);
3051  			::SetDlgItemInt(_hSelf, IDC_EDIT_MT, nppGUI._printSettings._marge.top, FALSE);
3052  			::SetDlgItemInt(_hSelf, IDC_EDIT_MB,  nppGUI._printSettings._marge.bottom, FALSE);
3053  			::SetDlgItemText(_hSelf, IDC_EDIT_HLEFT, nppGUI._printSettings._headerLeft.c_str());
3054  			::SetDlgItemText(_hSelf, IDC_EDIT_HMIDDLE, nppGUI._printSettings._headerMiddle.c_str());
3055  			::SetDlgItemText(_hSelf, IDC_EDIT_HRIGHT, nppGUI._printSettings._headerRight.c_str());
3056  			::SetDlgItemText(_hSelf, IDC_EDIT_FLEFT, nppGUI._printSettings._footerLeft.c_str());
3057  			::SetDlgItemText(_hSelf, IDC_EDIT_FMIDDLE, nppGUI._printSettings._footerMiddle.c_str());
3058  			::SetDlgItemText(_hSelf, IDC_EDIT_FRIGHT, nppGUI._printSettings._footerRight.c_str());
3059  			TCHAR intStr[5]{};
3060  			for (int i = 6 ; i &lt; 15 ; ++i)
3061  			{
3062  				wsprintf(intStr, TEXT(&quot;%d&quot;), i);
3063  				::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTSIZE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(intStr));
3064  				::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTSIZE, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(intStr));
3065  			}
3066  			const std::vector&lt;generic_string&gt; &amp; fontlist = nppParam.getFontList();
3067  			for (size_t i = 0, len = fontlist.size() ; i &lt; len ; ++i)
3068  			{
3069  				auto j = ::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTNAME, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(fontlist[i].c_str()));
3070  				::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTNAME, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(fontlist[i].c_str()));
3071  				::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTNAME, CB_SETITEMDATA, j, reinterpret_cast&lt;LPARAM&gt;(fontlist[i].c_str()));
3072  				::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTNAME, CB_SETITEMDATA, j, reinterpret_cast&lt;LPARAM&gt;(fontlist[i].c_str()));
3073  			}
3074  			auto index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTNAME, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(nppGUI._printSettings._headerFontName.c_str()));
3075  			if (index == CB_ERR)
3076  				index = 0;
3077  			::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTNAME, CB_SETCURSEL, index, 0);
3078  			index = ::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTNAME, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(nppGUI._printSettings._footerFontName.c_str()));
3079  			if (index == CB_ERR)
3080  				index = 0;
3081  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTNAME, CB_SETCURSEL, index, 0);
3082  			wsprintf(intStr, TEXT(&quot;%d&quot;), nppGUI._printSettings._headerFontSize);
3083  			::SendDlgItemMessage(_hSelf, IDC_COMBO_HFONTSIZE, CB_SELECTSTRING, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(intStr));
3084  			wsprintf(intStr, TEXT(&quot;%d&quot;), nppGUI._printSettings._footerFontSize);
3085  			::SendDlgItemMessage(_hSelf, IDC_COMBO_FFONTSIZE, CB_SELECTSTRING, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(intStr));
3086  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HBOLD, BM_SETCHECK, nppGUI._printSettings._headerFontStyle &amp; FONTSTYLE_BOLD, 0);
3087  			::SendDlgItemMessage(_hSelf, IDC_CHECK_HITALIC, BM_SETCHECK, nppGUI._printSettings._headerFontStyle &amp; FONTSTYLE_ITALIC, 0);
3088  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FBOLD, BM_SETCHECK, nppGUI._printSettings._footerFontStyle &amp; FONTSTYLE_BOLD, 0);
3089  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FITALIC, BM_SETCHECK, nppGUI._printSettings._footerFontStyle &amp; FONTSTYLE_ITALIC, 0);
3090  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Full file name path&quot;)));
3091  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;File name&quot;)));
3092  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;File directory&quot;)));
3093  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Page&quot;)));
3094  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Short date format&quot;)));
3095  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Long date format&quot;)));
3096  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;Time&quot;)));
3097  			varList.push_back(TEXT(&quot;$(FULL_CURRENT_PATH)&quot;));
3098  			varList.push_back(TEXT(&quot;$(FILE_NAME)&quot;));
3099  			varList.push_back(TEXT(&quot;$(CURRENT_DIRECTORY)&quot;));
3100  			varList.push_back(TEXT(&quot;$(CURRENT_PRINTING_PAGE)&quot;));
3101  			varList.push_back(TEXT(&quot;$(SHORT_DATE)&quot;));
3102  			varList.push_back(TEXT(&quot;$(LONG_DATE)&quot;));
3103  			varList.push_back(TEXT(&quot;$(TIME)&quot;));
3104  			::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_SETCURSEL, 0, 0);
3105  			return TRUE;
3106  		}
3107  		case WM_CTLCOLOREDIT:
3108  		{
3109  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
3110  		}
3111  		case WM_CTLCOLORLISTBOX:
3112  		{
3113  			return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
3114  		}
3115  		case WM_CTLCOLORDLG:
3116  		{
3117  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
3118  		}
3119  		case WM_CTLCOLORSTATIC:
3120  		{
3121  			const auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
3122  			const auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
3123  			if (dlgCtrlID == IDC_EDIT_VIEWPANEL)
3124  			{
3125  				return NppDarkMode::onCtlColor(hdcStatic);
3126  			}
3127  			return NppDarkMode::onCtlColorDarker(hdcStatic);
3128  		}
3129  		case WM_PRINTCLIENT:
3130  		{
3131  			if (NppDarkMode::isEnabled())
3132  			{
3133  				return TRUE;
3134  			}
3135  			break;
3136  		}
3137  		case WM_COMMAND:
3138  		{
3139  			if (HIWORD(wParam) == EN_CHANGE &amp;&amp; LOWORD(wParam) != IDC_EDIT_VIEWPANEL)
3140  			{
3141  				switch (LOWORD(wParam))
3142  				{
3143  					case  IDC_EDIT_ML:
3144  						nppGUI._printSettings._marge.left = ::GetDlgItemInt(_hSelf, IDC_EDIT_ML, NULL, FALSE);
3145  						return TRUE;
3146  					case  IDC_EDIT_MR:
3147  						nppGUI._printSettings._marge.right = ::GetDlgItemInt(_hSelf, IDC_EDIT_MR, NULL, FALSE);
3148  						return TRUE;
3149  					case IDC_EDIT_MT :
3150  						nppGUI._printSettings._marge.top = ::GetDlgItemInt(_hSelf, IDC_EDIT_MT, NULL, FALSE);
3151  						return TRUE;
3152  					case IDC_EDIT_MB :
3153  						nppGUI._printSettings._marge.bottom = ::GetDlgItemInt(_hSelf, IDC_EDIT_MB, NULL, FALSE);
3154  						return TRUE;
3155  					default:
3156  					{
3157  						constexpr int stringSize = 256;
3158  						TCHAR str[stringSize]{};
3159  						_focusedEditCtrl = LOWORD(wParam);
3160  						::GetDlgItemText(_hSelf, _focusedEditCtrl, str, stringSize);
3161  						::SendDlgItemMessage(_hSelf, IDC_EDIT_VIEWPANEL, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(str));
3162  						switch (LOWORD(wParam))
3163  						{
3164  							case  IDC_EDIT_HLEFT:
3165  								nppGUI._printSettings._headerLeft = str;
3166  								trim(nppGUI._printSettings._headerLeft);
3167  								return TRUE;
3168  							case  IDC_EDIT_HMIDDLE:
3169  								nppGUI._printSettings._headerMiddle = str;
3170  								trim(nppGUI._printSettings._headerMiddle);
3171  								return TRUE;
3172  							case IDC_EDIT_HRIGHT :
3173  								nppGUI._printSettings._headerRight = str;
3174  								trim(nppGUI._printSettings._headerRight);
3175  								return TRUE;
3176  							case  IDC_EDIT_FLEFT:
3177  								nppGUI._printSettings._footerLeft = str;
3178  								trim(nppGUI._printSettings._footerLeft);
3179  								return TRUE;
3180  							case  IDC_EDIT_FMIDDLE:
3181  								nppGUI._printSettings._footerMiddle = str;
3182  								trim(nppGUI._printSettings._footerMiddle);
3183  								return TRUE;
3184  							case IDC_EDIT_FRIGHT :
3185  								nppGUI._printSettings._footerRight = str;
3186  								trim(nppGUI._printSettings._footerRight);
3187  								return TRUE;
3188  							default :
3189  								return FALSE;
3190  						}
3191  					}
3192  				}
3193  			}
3194  			else if (HIWORD(wParam) == EN_SETFOCUS &amp;&amp; LOWORD(wParam) != IDC_EDIT_VIEWPANEL)
3195  			{
3196  				constexpr int stringSize = 256;
3197  				TCHAR str[stringSize]{};
3198  				_focusedEditCtrl = LOWORD(wParam);
3199  				int focusedEditStatic = 0;
3200  				int groupStatic = 0;
3201  				switch (_focusedEditCtrl)
3202  				{
3203  					case IDC_EDIT_HLEFT : focusedEditStatic = IDC_HL_STATIC; groupStatic = IDC_HGB_STATIC; break;
3204  					case IDC_EDIT_HMIDDLE : focusedEditStatic = IDC_HM_STATIC; groupStatic = IDC_HGB_STATIC; break;
3205  					case IDC_EDIT_HRIGHT : focusedEditStatic = IDC_HR_STATIC; groupStatic = IDC_HGB_STATIC; break;
3206  					case IDC_EDIT_FLEFT : focusedEditStatic = IDC_FL_STATIC; groupStatic = IDC_FGB_STATIC; break;
3207  					case IDC_EDIT_FMIDDLE : focusedEditStatic = IDC_FM_STATIC; groupStatic = IDC_FGB_STATIC; break;
3208  					case IDC_EDIT_FRIGHT : focusedEditStatic = IDC_FR_STATIC; groupStatic = IDC_FGB_STATIC; break;
3209  					default : return TRUE;
3210  				}
3211  				::GetDlgItemText(_hSelf, _focusedEditCtrl, str, stringSize);
3212  				::SendDlgItemMessage(_hSelf, IDC_EDIT_VIEWPANEL, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(str));
3213  				::GetDlgItemText(_hSelf, groupStatic, str, stringSize);
3214  				generic_string title = str;
3215  				title += TEXT(&quot; &quot;);
3216  				::GetDlgItemText(_hSelf, focusedEditStatic, str, stringSize);
3217  				title += str;
3218  				title = purgeMenuItemString(title.c_str()); 
3219  				::SendDlgItemMessage(_hSelf, IDC_WHICHPART_STATIC, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(title.c_str()));
3220  				redrawDlgItem(IDC_WHICHPART_STATIC);
3221  				return TRUE;
3222  			}
3223  			else if (HIWORD(wParam) == CBN_SELCHANGE)
3224  			{
3225  				auto iSel = ::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETCURSEL, 0, 0);
3226  				switch (LOWORD(wParam))
3227  				{
3228  					case IDC_COMBO_HFONTNAME :
3229  					case IDC_COMBO_FFONTNAME :
3230  					{
3231  						TCHAR *fnStr = (TCHAR *)::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETITEMDATA, iSel, 0);
3232  						if (LOWORD(wParam) == IDC_COMBO_HFONTNAME)
3233  							nppGUI._printSettings._headerFontName = fnStr;
3234  						else
3235  							nppGUI._printSettings._footerFontName = fnStr;
3236  					}
3237  					break;
3238  					case IDC_COMBO_HFONTSIZE :
3239  					case IDC_COMBO_FFONTSIZE :
3240  					{
3241  						constexpr size_t intStrLen = 3;
3242  						TCHAR intStr[intStrLen]{};
3243  						auto lbTextLen = ::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETLBTEXTLEN, iSel, 0);
3244  						if (static_cast&lt;size_t&gt;(lbTextLen) &gt;= intStrLen)
3245  							return TRUE;
3246  						::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETLBTEXT, iSel, reinterpret_cast&lt;LPARAM&gt;(intStr));
3247  						int *pVal = (LOWORD(wParam) == IDC_COMBO_HFONTSIZE)?&amp;(nppGUI._printSettings._headerFontSize):&amp;(nppGUI._printSettings._footerFontSize);
3248  						if (!intStr[0])
3249  							*pVal = 0;
3250  						else
3251  							*pVal = wcstol(intStr, NULL, 10);
3252  					}
3253  					break;
3254  					case IDC_COMBO_VARLIST:
3255  					{
3256  						break;
3257  					}
3258  					default:
3259  					{
3260  						break;
3261  					}
3262  				}
3263  				return TRUE;
3264  			}
3265  			switch (wParam)
3266  			{
3267  				case IDC_CHECK_PRINTLINENUM:
3268  					nppGUI._printSettings._printLineNumber = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_CHECK_PRINTLINENUM, BM_GETCHECK, 0, 0));
3269  					break;
3270  				case  IDC_RADIO_WYSIWYG:
3271  					nppGUI._printSettings._printOption = SC_PRINT_NORMAL;
3272  					break;
3273  				case  IDC_RADIO_INVERT:
3274  					nppGUI._printSettings._printOption = SC_PRINT_INVERTLIGHT;
3275  					break;
3276  				case IDC_RADIO_BW :
3277  					nppGUI._printSettings._printOption = SC_PRINT_BLACKONWHITE;
3278  					break;
3279  				case IDC_RADIO_NOBG :
3280  					nppGUI._printSettings._printOption = SC_PRINT_COLOURONWHITE;
3281  					break;
3282  				case IDC_CHECK_HBOLD:
3283  					nppGUI._printSettings._headerFontStyle ^= FONTSTYLE_BOLD;
3284  					break;
3285  				case  IDC_CHECK_HITALIC:
3286  					nppGUI._printSettings._headerFontStyle ^= FONTSTYLE_ITALIC;
3287  					break;
3288  				case  IDC_CHECK_FBOLD:
3289  					nppGUI._printSettings._footerFontStyle ^= FONTSTYLE_BOLD;
3290  					break;
3291  				case  IDC_CHECK_FITALIC:
3292  					nppGUI._printSettings._footerFontStyle ^= FONTSTYLE_ITALIC;
3293  					break;
3294  				case  IDC_BUTTON_ADDVAR:
3295  				{
3296  					try {
3297  						if (!_focusedEditCtrl)
3298  							return TRUE;
3299  						size_t iSel = ::SendDlgItemMessage(_hSelf, IDC_COMBO_VARLIST, CB_GETCURSEL, 0, 0);
3300  						if (iSel &gt;= varList.size())
3301  							return TRUE;
3302  						TCHAR *varStr = (TCHAR*)varList[iSel].c_str();
3303  						size_t selStart = 0;
3304  						size_t selEnd = 0;
3305  						::SendDlgItemMessage(_hSelf, _focusedEditCtrl, EM_GETSEL, reinterpret_cast&lt;WPARAM&gt;(&amp;selStart), reinterpret_cast&lt;LPARAM&gt;(&amp;selEnd));
3306  						constexpr int stringSize = 256;
3307  						TCHAR str[stringSize]{};
3308  						::SendDlgItemMessage(_hSelf, _focusedEditCtrl, WM_GETTEXT, stringSize, reinterpret_cast&lt;LPARAM&gt;(str));
3309  						generic_string str2Set(str);
3310  						size_t strLen = str2Set.length();
3311  						if (selStart &gt; strLen || selEnd &gt; strLen)
3312  							selStart = selEnd = strLen;
3313  						str2Set.replace(selStart, selEnd - selStart, varStr);
3314  						::SetDlgItemText(_hSelf, _focusedEditCtrl, str2Set.c_str());
3315  					}
3316  					catch (...)
3317  					{
3318  					}
3319  				}
3320  				break;
3321  			}
3322  			return TRUE;
3323  		}
3324  	}
3325  	return FALSE;
3326  }
3327  intptr_t CALLBACK BackupSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
3328  {
3329  	NppParameters&amp; nppParam = NppParameters::getInstance();
3330  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
3331  	switch (message) 
3332  	{
3333  		case WM_INITDIALOG :
3334  		{
3335  			::SendDlgItemMessage(_hSelf, IDC_CHECK_REMEMBERSESSION, BM_SETCHECK, nppGUI._rememberLastSession, 0);
3336  			bool snapshotCheck = nppGUI._rememberLastSession &amp;&amp; nppGUI.isSnapshotMode();
3337  			::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_RESTORESESSION_CHECK, BM_SETCHECK, snapshotCheck?BST_CHECKED:BST_UNCHECKED, 0);
3338  			auto periodicBackupInSec = static_cast&lt;UINT&gt;(nppGUI._snapshotBackupTiming / 1000);
3339  			::SetDlgItemInt(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT,periodicBackupInSec, FALSE);
3340  			generic_string backupFilePath = NppParameters::getInstance().getUserPath();
3341  			backupFilePath += TEXT(&quot;\\backup\\&quot;);
3342  			::SetDlgItemText(_hSelf, IDD_BACKUPDIR_RESTORESESSION_PATH_EDIT, backupFilePath.c_str());
3343  			int ID2CheckBackupOnSave = 0;
3344  			switch (nppGUI._backup)
3345  			{
3346  				case bak_simple :
3347  					ID2CheckBackupOnSave = IDC_RADIO_BKSIMPLE;
3348  					break;
3349  				case bak_verbose :
3350  					ID2CheckBackupOnSave = IDC_RADIO_BKVERBOSE;
3351  					break;
3352  				default : 
3353  					ID2CheckBackupOnSave = IDC_RADIO_BKNONE;
3354  			}
3355  			::SendDlgItemMessage(_hSelf, ID2CheckBackupOnSave, BM_SETCHECK, BST_CHECKED, 0);
3356  			if (nppGUI._useDir)
3357  				::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_CHECK, BM_SETCHECK, BST_CHECKED, 0);
3358  			::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;((nppGUI._backupDir.c_str())));
3359  			updateBackupSessionGUI();
3360  			updateBackupOnSaveGUI();
3361  			return TRUE;
3362  		}
3363  		case WM_CTLCOLOREDIT:
3364  		{
3365  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
3366  		}
3367  		case WM_CTLCOLORDLG:
3368  		{
3369  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
3370  		}
3371  		case WM_CTLCOLORSTATIC:
3372  		{
3373  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
3374  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
3375  			bool isStaticText = (dlgCtrlID == IDD_BACKUPDIR_RESTORESESSION_STATIC1 ||
3376  				dlgCtrlID == IDD_BACKUPDIR_RESTORESESSION_STATIC2 ||
3377  				dlgCtrlID == IDD_BACKUPDIR_RESTORESESSION_PATHLABEL_STATIC);
3378  			if (isStaticText)
3379  			{
3380  				bool isTextEnabled = isCheckedOrNot(IDC_BACKUPDIR_RESTORESESSION_CHECK);
3381  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
3382  			}
3383  			if (dlgCtrlID == IDD_BACKUPDIR_STATIC)
3384  			{
3385  				bool isTextEnabled = !isCheckedOrNot(IDC_RADIO_BKNONE) &amp;&amp; isCheckedOrNot(IDC_BACKUPDIR_CHECK);
3386  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
3387  			}
3388  			if (dlgCtrlID == IDD_BACKUPDIR_RESTORESESSION_PATH_EDIT)
3389  			{
3390  				return NppDarkMode::onCtlColor(hdcStatic);
3391  			}
3392  			return NppDarkMode::onCtlColorDarker(hdcStatic);
3393  		}
3394  		case WM_PRINTCLIENT:
3395  		{
3396  			if (NppDarkMode::isEnabled())
3397  			{
3398  				return TRUE;
3399  			}
3400  			break;
3401  		}
3402  		case WM_COMMAND : 
3403  		{
3404  			if (HIWORD(wParam) == EN_CHANGE)
3405  			{
3406  				switch (LOWORD(wParam))
3407  				{
3408  					case  IDC_BACKUPDIR_EDIT:
3409  					{
3410  						TCHAR inputDir[MAX_PATH] = {&#x27;\0&#x27;};
3411  						::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(inputDir));
3412  						nppGUI._backupDir = inputDir;
3413  						return TRUE;
3414  					}
3415  					case IDC_BACKUPDIR_RESTORESESSION_EDIT:
3416  					{
3417  						constexpr int stringSize = 16;
3418  						TCHAR str[stringSize]{};
3419  						::GetDlgItemText(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, str, stringSize);
3420  						if (lstrcmp(str, TEXT(&quot;&quot;)) == 0)
3421  							return TRUE;
3422  						nppGUI._snapshotBackupTiming = ::GetDlgItemInt(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, NULL, FALSE) * 1000;
3423  						if (!nppGUI._snapshotBackupTiming)
3424  						{
3425  							nppGUI._snapshotBackupTiming = 1000;
3426  							::SetDlgItemInt(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, 1, FALSE);
3427  						}
3428  						return TRUE;
3429  					}
3430  				}
3431  			}
3432  			else if (HIWORD(wParam) == EN_KILLFOCUS)
3433  			{
3434  				switch (LOWORD(wParam))
3435  				{
3436  					case  IDC_BACKUPDIR_RESTORESESSION_EDIT:
3437  					{
3438  						constexpr int stringSize = 16;
3439  						TCHAR str[stringSize]{};
3440  						::GetDlgItemText(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, str, stringSize);
3441  						if (lstrcmp(str, TEXT(&quot;&quot;)) == 0)
3442  						{
3443  							::SetDlgItemInt(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT, static_cast&lt;int32_t&gt;(nppGUI._snapshotBackupTiming / 1000), FALSE);
3444  						}
3445  					}
3446  				}
3447  			}
3448  			switch (wParam)
3449  			{
3450  				case IDC_CHECK_REMEMBERSESSION:
3451  				{
3452  					nppGUI._rememberLastSession = isCheckedOrNot(IDC_CHECK_REMEMBERSESSION);
3453  					if (!nppGUI._rememberLastSession)
3454  					{
3455  						::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_RESTORESESSION_CHECK, BM_SETCHECK, BST_UNCHECKED, 0);
3456  						::SendMessage(_hSelf, WM_COMMAND, IDC_BACKUPDIR_RESTORESESSION_CHECK, 0);
3457  					}
3458  					updateBackupSessionGUI();
3459  					return TRUE;
3460  				}
3461  				case IDC_BACKUPDIR_RESTORESESSION_CHECK:
3462  				{
3463  					nppGUI._isSnapshotMode = BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_RESTORESESSION_CHECK, BM_GETCHECK, 0, 0);
3464  					updateBackupSessionGUI();
3465  					if (nppGUI._isSnapshotMode)
3466  					{
3467  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_ENABLESNAPSHOT, 0, 0);
3468  					}
3469  					return TRUE;
3470  				}
3471  				case IDC_RADIO_BKSIMPLE:
3472  				{
3473  					nppGUI._backup = bak_simple;
3474  					updateBackupOnSaveGUI();
3475  					return TRUE;
3476  				}
3477  				case IDC_RADIO_BKVERBOSE:
3478  				{
3479  					nppGUI._backup = bak_verbose;
3480  					updateBackupOnSaveGUI();
3481  					return TRUE;
3482  				}
3483  				case IDC_RADIO_BKNONE:
3484  				{
3485  					nppGUI._backup = bak_none;
3486  					updateBackupOnSaveGUI();
3487  					return TRUE;
3488  				}
3489  				case IDC_BACKUPDIR_CHECK:
3490  				{
3491  					nppGUI._useDir = !nppGUI._useDir;
3492  					updateBackupOnSaveGUI();
3493  					return TRUE;
3494  				}
3495  				case IDD_BACKUPDIR_BROWSE_BUTTON :
3496  				{
3497  					generic_string title = nppParam.getNativeLangSpeaker()-&gt;getLocalizedStrFromID(&quot;backup-select-folder&quot;,
3498  						TEXT(&quot;Select a folder as backup directory&quot;));
3499  					folderBrowser(_hSelf, title, IDC_BACKUPDIR_EDIT);
3500  					return TRUE;
3501  				}
3502  				default :
3503  					return FALSE;
3504  			}
3505  		}
3506  	}
3507  	return FALSE;
3508  }
3509  void BackupSubDlg::updateBackupSessionGUI()
3510  {
3511  	bool rememberSession = isCheckedOrNot(IDC_CHECK_REMEMBERSESSION);
3512  	bool isSnapshot = isCheckedOrNot(IDC_BACKUPDIR_RESTORESESSION_CHECK);
3513  	::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_RESTORESESSION_CHECK), rememberSession);
3514  	::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_RESTORESESSION_EDIT), isSnapshot);
3515  	::EnableWindow(::GetDlgItem(_hSelf, IDD_BACKUPDIR_RESTORESESSION_PATH_EDIT), isSnapshot);
3516  	redrawDlgItem(IDD_BACKUPDIR_RESTORESESSION_STATIC1);
3517  	redrawDlgItem(IDD_BACKUPDIR_RESTORESESSION_STATIC2);
3518  	redrawDlgItem(IDD_BACKUPDIR_RESTORESESSION_PATHLABEL_STATIC);
3519  }
3520  void BackupSubDlg::updateBackupOnSaveGUI()
3521  {
3522  	bool noBackup = BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_RADIO_BKNONE, BM_GETCHECK, 0, 0);
3523  	bool isEnableGlobableCheck = false;
3524  	bool isEnableLocalCheck = false;
3525  	if (!noBackup)
3526  	{
3527  		isEnableGlobableCheck = true;
3528  		isEnableLocalCheck = BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_BACKUPDIR_CHECK, BM_GETCHECK, 0, 0);
3529  	}
3530  	::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_CHECK), isEnableGlobableCheck);
3531  	::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_EDIT), isEnableLocalCheck);
3532  	::EnableWindow(::GetDlgItem(_hSelf, IDD_BACKUPDIR_BROWSE_BUTTON), isEnableLocalCheck);
3533  	if (NppDarkMode::isEnabled())
3534  	{
3535  		::EnableWindow(::GetDlgItem(_hSelf, IDC_BACKUPDIR_USERCUSTOMDIR_GRPSTATIC), !noBackup);
3536  		redrawDlgItem(IDC_BACKUPDIR_USERCUSTOMDIR_GRPSTATIC);
3537  	}
3538  }
3539  intptr_t CALLBACK AutoCompletionSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
3540  {
3541  	NppParameters&amp; nppParam = NppParameters::getInstance();
3542  	NppGUI &amp; nppGUI = nppParam.getNppGUI();
3543  	switch (message) 
3544  	{
3545  		case WM_INITDIALOG :
3546  		{
3547  			::SetDlgItemInt(_hSelf, IDD_AUTOC_STATIC_N,  nppGUI._autocFromLen, FALSE);
3548  			const HWND hNbCharSlider = ::GetDlgItem(_hSelf, IDC_AUTOC_CHAR_SLIDER);
3549  			::SendMessage(hNbCharSlider, TBM_SETRANGEMIN, TRUE, AUTOCOMPLETEFROMCHAR_SMALLEST);
3550  			::SendMessage(hNbCharSlider, TBM_SETRANGEMAX, TRUE, AUTOCOMPLETEFROMCHAR_LARGEST);
3551  			::SendMessage(hNbCharSlider, TBM_SETPAGESIZE, 0, AUTOCOMPLETEFROMCHAR_INTERVAL);
3552  			::SendMessage(hNbCharSlider, TBM_SETPOS, TRUE, nppGUI._autocFromLen);
3553  			bool isEnableAutoC = nppGUI._autocStatus != nppGUI.autoc_none;
3554  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_ENABLECHECK, BM_SETCHECK, isEnableAutoC?BST_CHECKED:BST_UNCHECKED, 0);
3555  			int selectedID = IDD_AUTOC_BOTHRADIO;
3556  			if (nppGUI._autocStatus == nppGUI.autoc_func)
3557  				selectedID = IDD_AUTOC_FUNCRADIO;
3558  			else if (nppGUI._autocStatus == nppGUI.autoc_word)
3559  				selectedID = IDD_AUTOC_WORDRADIO;
3560  			else if (nppGUI._autocStatus == nppGUI.autoc_both)
3561  				selectedID = IDD_AUTOC_BOTHRADIO;
3562  			::SendDlgItemMessage(_hSelf, selectedID, BM_SETCHECK, BST_CHECKED, 0);
3563  			if (nppGUI._autocStatus == nppGUI.autoc_word || nppGUI._autocStatus == nppGUI.autoc_both)
3564  				::SendDlgItemMessage(_hSelf, IDD_AUTOC_IGNORENUMBERS, BM_SETCHECK, nppGUI._autocIgnoreNumbers ? BST_CHECKED : BST_UNCHECKED, 0);
3565  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_USEENTER, BM_SETCHECK, nppGUI._autocInsertSelectedUseENTER ? BST_CHECKED : BST_UNCHECKED, 0);
3566  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_USETAB, BM_SETCHECK, nppGUI._autocInsertSelectedUseTAB ? BST_CHECKED : BST_UNCHECKED, 0);
3567  			if (!isEnableAutoC)
3568  			{
3569  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_FUNCRADIO), FALSE);
3570  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_WORDRADIO), FALSE);
3571  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_BRIEF_CHECK), FALSE);
3572  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_BOTHRADIO), FALSE);
3573  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEENTER), FALSE);
3574  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USETAB), FALSE);
3575  				::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), FALSE);
3576  				::EnableWindow(::GetDlgItem(_hSelf, IDC_AUTOC_CHAR_SLIDER), FALSE);
3577  				if (NppDarkMode::isEnabled())
3578  				{
3579  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEKEY_GRP_STATIC), FALSE);
3580  				}
3581  			}
3582  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MAINTAININDENT, BM_SETCHECK, nppGUI._maitainIndent, 0);
3583  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_BRIEF_CHECK, BM_SETCHECK, nppGUI._autocBrief ? BST_CHECKED : BST_UNCHECKED, 0);
3584  			::SendDlgItemMessage(_hSelf, IDD_FUNC_CHECK, BM_SETCHECK, nppGUI._funcParams ? BST_CHECKED : BST_UNCHECKED, 0);
3585  			::SendDlgItemMessage(_hSelf, IDD_AUTOCPARENTHESES_CHECK, BM_SETCHECK, nppGUI._matchedPairConf._doParentheses?BST_CHECKED:BST_UNCHECKED, 0);
3586  			if (nppGUI._matchedPairConf._doParentheses)
3587  				::SendDlgItemMessage(_hSelf, IDD_AUTOCPARENTHESES_CHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; (  )&quot;)));
3588  			::SendDlgItemMessage(_hSelf, IDD_AUTOCBRACKET_CHECK, BM_SETCHECK, nppGUI._matchedPairConf._doBrackets?BST_CHECKED:BST_UNCHECKED, 0);
3589  			if (nppGUI._matchedPairConf._doBrackets)
3590  				::SendDlgItemMessage(_hSelf, IDD_AUTOCBRACKET_CHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; [  ]&quot;)));
3591  			::SendDlgItemMessage(_hSelf, IDD_AUTOCCURLYBRACKET_CHECK, BM_SETCHECK, nppGUI._matchedPairConf._doCurlyBrackets?BST_CHECKED:BST_UNCHECKED, 0);
3592  			if (nppGUI._matchedPairConf._doCurlyBrackets)
3593  				::SendDlgItemMessage(_hSelf, IDD_AUTOCCURLYBRACKET_CHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; {  }&quot;)));
3594  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_QUOTESCHECK, BM_SETCHECK, nppGUI._matchedPairConf._doQuotes?BST_CHECKED:BST_UNCHECKED, 0);
3595  			if (nppGUI._matchedPairConf._doQuotes)
3596  				::SendDlgItemMessage(_hSelf, IDD_AUTOC_QUOTESCHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; &#x27;  &#x27;&quot;)));
3597  			::SendDlgItemMessage(_hSelf, IDD_AUTOC_DOUBLEQUOTESCHECK, BM_SETCHECK, nppGUI._matchedPairConf._doDoubleQuotes?BST_CHECKED:BST_UNCHECKED, 0);
3598  			if (nppGUI._matchedPairConf._doDoubleQuotes)
3599  				::SendDlgItemMessage(_hSelf, IDD_AUTOC_DOUBLEQUOTESCHECK, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot; \&quot;  \&quot;&quot;)));
3600  			::SendDlgItemMessage(_hSelf, IDD_AUTOCTAG_CHECK, BM_SETCHECK, nppGUI._matchedPairConf._doHtmlXmlTag?BST_CHECKED:BST_UNCHECKED, 0);
3601  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT1, EM_LIMITTEXT, 1, 0);
3602  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT1, EM_LIMITTEXT, 1, 0);
3603  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT2, EM_LIMITTEXT, 1, 0);
3604  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT2, EM_LIMITTEXT, 1, 0);
3605  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT3, EM_LIMITTEXT, 1, 0);
3606  			::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT3, EM_LIMITTEXT, 1, 0);
3607  			size_t nbMatchedPair = nppGUI._matchedPairConf._matchedPairsInit.size();
3608  			if (nbMatchedPair &gt; 3)
3609  				nbMatchedPair = 3;
3610  			for (size_t i = 0; i &lt; nbMatchedPair; ++i)
3611  			{
3612  				TCHAR openChar[2]{};
3613  				openChar[0] = nppGUI._matchedPairConf._matchedPairsInit[i].first;
3614  				openChar[1] = &#x27;\0&#x27;;
3615  				TCHAR closeChar[2]{};
3616  				closeChar[0] = nppGUI._matchedPairConf._matchedPairsInit[i].second;
3617  				closeChar[1] = &#x27;\0&#x27;;
3618  				if (i == 0)
3619  				{
3620  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT1, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(openChar));
3621  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT1, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(closeChar));
3622  				}
3623  				else if (i == 1)
3624  				{
3625  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT2, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(openChar));
3626  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT2, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(closeChar));
3627  				}
3628  				if (i == 2)
3629  				{
3630  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT3, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(openChar));
3631  					::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT3, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(closeChar));
3632  				}
3633  			}
3634  			return TRUE;
3635  		}
3636  		case WM_CTLCOLOREDIT:
3637  		{
3638  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
3639  		}
3640  		case WM_CTLCOLORDLG:
3641  		{
3642  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
3643  		}
3644  		case WM_CTLCOLORSTATIC:
3645  		{
3646  			const auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
3647  			const auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
3648  			const bool isStaticText = (dlgCtrlID == IDD_AUTOC_STATIC_FROM ||
3649  				dlgCtrlID == IDD_AUTOC_STATIC_CHAR ||
3650  				dlgCtrlID == IDD_AUTOC_STATIC_N ||
3651  				dlgCtrlID == IDD_AUTOC_SLIDER_MIN_STATIC ||
3652  				dlgCtrlID == IDD_AUTOC_SLIDER_MAX_STATIC);
3653  			if (isStaticText)
3654  			{
3655  				const bool isTextEnabled = isCheckedOrNot(IDD_AUTOC_ENABLECHECK);
3656  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
3657  			}
3658  			return NppDarkMode::onCtlColorDarker(hdcStatic);
3659  		}
3660  		case WM_PRINTCLIENT:
3661  		{
3662  			if (NppDarkMode::isEnabled())
3663  			{
3664  				return TRUE;
3665  			}
3666  			break;
3667  		}
3668  		case WM_HSCROLL:
3669  		{
3670  			const HWND hNbCharSlider = ::GetDlgItem(_hSelf, IDC_AUTOC_CHAR_SLIDER);
3671  			if (hNbCharSlider == reinterpret_cast&lt;HWND&gt;(lParam))
3672  			{
3673  				nppGUI._autocFromLen = static_cast&lt;UINT&gt;(::SendMessage(hNbCharSlider, TBM_GETPOS, 0, 0));
3674  				::SetDlgItemInt(_hSelf, IDD_AUTOC_STATIC_N, nppGUI._autocFromLen, FALSE);
3675  			}
3676  			return 0; 
3677  		}
3678  		case WM_COMMAND : 
3679  		{
3680  			if (HIWORD(wParam) == EN_CHANGE)
3681  			{
3682  				switch (LOWORD(wParam))
3683  				{
3684  					case IDC_MACHEDPAIROPEN_EDIT1 :
3685  					case IDC_MACHEDPAIRCLOSE_EDIT1:
3686  					case IDC_MACHEDPAIROPEN_EDIT2 :
3687  					case IDC_MACHEDPAIRCLOSE_EDIT2:
3688  					case IDC_MACHEDPAIROPEN_EDIT3 :
3689  					case IDC_MACHEDPAIRCLOSE_EDIT3:
3690  					{
3691  						nppGUI._matchedPairConf._matchedPairs.clear();
3692  						TCHAR opener[2] = {&#x27;\0&#x27;, &#x27;\0&#x27;};
3693  						TCHAR closer[2] = {&#x27;\0&#x27;, &#x27;\0&#x27;};
3694  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT1, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(opener));
3695  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT1, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(closer));
3696  						if (opener[0] &lt; 0x80 &amp;&amp; opener[0] != &#x27;\0&#x27; &amp;&amp; closer[0] &lt; 0x80 &amp;&amp; closer[0] != &#x27;\0&#x27;)
3697  							nppGUI._matchedPairConf._matchedPairs.push_back(pair&lt;char, char&gt;(static_cast&lt;char&gt;(opener[0]), static_cast&lt;char&gt;(closer[0])));
3698  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT2, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(opener));
3699  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT2, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(closer));
3700  						if (opener[0] &lt; 0x80 &amp;&amp; opener[0] != &#x27;\0&#x27; &amp;&amp; closer[0] &lt; 0x80 &amp;&amp; closer[0] != &#x27;\0&#x27;)
3701  							nppGUI._matchedPairConf._matchedPairs.push_back(pair&lt;char, char&gt;(static_cast&lt;char&gt;(opener[0]), static_cast&lt;char&gt;(closer[0])));
3702  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIROPEN_EDIT3, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(opener));
3703  						::SendDlgItemMessage(_hSelf, IDC_MACHEDPAIRCLOSE_EDIT3, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(closer));
3704  						if (opener[0] &lt; 0x80 &amp;&amp; opener[0] != &#x27;\0&#x27; &amp;&amp; closer[0] &lt; 0x80 &amp;&amp; closer[0] != &#x27;\0&#x27;)
3705  							nppGUI._matchedPairConf._matchedPairs.push_back(pair&lt;char, char&gt;(static_cast&lt;char&gt;(opener[0]), static_cast&lt;char&gt;(closer[0])));
3706  						return TRUE;
3707  					}
3708  				}
3709  			}
3710  			switch (wParam)
3711  			{
3712  				case IDC_CHECK_MAINTAININDENT:
3713  				{
3714  					nppGUI._maitainIndent = isCheckedOrNot(IDC_CHECK_MAINTAININDENT);
3715  					return TRUE;
3716  				}
3717  				case IDD_AUTOC_ENABLECHECK :
3718  				{
3719  					bool isEnableAutoC = BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDD_AUTOC_ENABLECHECK, BM_GETCHECK, 0, 0);
3720  					if (isEnableAutoC)
3721  					{
3722  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_BOTHRADIO, BM_SETCHECK, BST_CHECKED, 0);
3723  						nppGUI._autocStatus = nppGUI.autoc_both;
3724  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_IGNORENUMBERS, BM_SETCHECK, BST_UNCHECKED, 0);
3725  						nppGUI._autocIgnoreNumbers = false;
3726  					}
3727  					else 
3728  					{
3729  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_FUNCRADIO, BM_SETCHECK, BST_UNCHECKED, 0);
3730  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_WORDRADIO, BM_SETCHECK, BST_UNCHECKED, 0);
3731  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_BOTHRADIO, BM_SETCHECK, BST_UNCHECKED, 0);
3732  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_BRIEF_CHECK, BM_SETCHECK, BST_UNCHECKED, 0);
3733  						nppGUI._autocBrief = false;
3734  						nppGUI._autocStatus = nppGUI.autoc_none;
3735  						::SendDlgItemMessage(_hSelf, IDD_AUTOC_IGNORENUMBERS, BM_SETCHECK, BST_UNCHECKED, 0);
3736  						nppGUI._autocIgnoreNumbers = false;
3737  					}
3738  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_FUNCRADIO), isEnableAutoC);
3739  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_WORDRADIO), isEnableAutoC);
3740  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_BOTHRADIO), isEnableAutoC);
3741  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_BRIEF_CHECK), isEnableAutoC);
3742  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEKEY_GRP_STATIC), isEnableAutoC);
3743  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEENTER), isEnableAutoC);
3744  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USETAB), isEnableAutoC);
3745  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), isEnableAutoC);
3746  					::EnableWindow(::GetDlgItem(_hSelf, IDC_AUTOC_CHAR_SLIDER), isEnableAutoC);
3747  					redrawDlgItem(IDD_AUTOC_STATIC_FROM);
3748  					redrawDlgItem(IDD_AUTOC_STATIC_N);
3749  					redrawDlgItem(IDD_AUTOC_STATIC_CHAR);
3750  					redrawDlgItem(IDD_AUTOC_SLIDER_MIN_STATIC);
3751  					redrawDlgItem(IDD_AUTOC_SLIDER_MAX_STATIC);
3752  					if (NppDarkMode::isEnabled())
3753  					{
3754  						::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_USEKEY_GRP_STATIC), isEnableAutoC);
3755  						redrawDlgItem(IDD_AUTOC_USEKEY_GRP_STATIC);
3756  					}
3757  					return TRUE;
3758  				}
3759  				case IDD_AUTOC_FUNCRADIO :
3760  				{
3761  					nppGUI._autocStatus = nppGUI.autoc_func;
3762  					::SendDlgItemMessage(_hSelf, IDD_AUTOC_IGNORENUMBERS, BM_SETCHECK, BST_UNCHECKED, 0);
3763  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), FALSE);
3764  					nppGUI._autocIgnoreNumbers = false;
3765  					::SendDlgItemMessage(_hSelf, IDD_AUTOC_BRIEF_CHECK, BM_SETCHECK, BST_UNCHECKED, 0);
3766  					nppGUI._autocBrief = false;
3767  					return TRUE;
3768  				}
3769  				case IDD_AUTOC_WORDRADIO :
3770  				{
3771  					nppGUI._autocStatus = nppGUI.autoc_word;
3772  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), TRUE);
3773  					return TRUE;
3774  				}
3775  				case IDD_AUTOC_BOTHRADIO :
3776  				{
3777  					nppGUI._autocStatus = nppGUI.autoc_both;
3778  					::EnableWindow(::GetDlgItem(_hSelf, IDD_AUTOC_IGNORENUMBERS), TRUE);
3779  					return TRUE;
3780  				}
3781  				case IDD_AUTOC_USEENTER:
3782  				{
3783  					nppGUI._autocInsertSelectedUseENTER = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3784  					return TRUE;
3785  				}
3786  				case IDD_AUTOC_USETAB:
3787  				{
3788  					nppGUI._autocInsertSelectedUseTAB = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3789  					return TRUE;
3790  				}
3791  				case IDD_AUTOC_IGNORENUMBERS:
3792  				{
3793  					nppGUI._autocIgnoreNumbers = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3794  					return TRUE;
3795  				}
3796  				case IDD_AUTOC_BRIEF_CHECK :
3797  				{
3798  					nppGUI._autocBrief = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3799  					return TRUE;
3800  				}
3801  				case IDD_FUNC_CHECK :
3802  				{
3803  					nppGUI._funcParams = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3804  					return TRUE;
3805  				}
3806  				case IDD_AUTOCPARENTHESES_CHECK :
3807  				case IDD_AUTOCBRACKET_CHECK :
3808  				case IDD_AUTOCCURLYBRACKET_CHECK :
3809  				case IDD_AUTOC_DOUBLEQUOTESCHECK :
3810  				case IDD_AUTOC_QUOTESCHECK :
3811  				{
3812  					bool isChecked = isCheckedOrNot(static_cast&lt;int32_t&gt;(wParam));
3813  					const TCHAR *label = nullptr;
3814  					if (wParam == IDD_AUTOCPARENTHESES_CHECK)
3815  					{
3816  						nppGUI._matchedPairConf._doParentheses = isChecked;
3817  						label = isChecked?TEXT(&quot; (  )&quot;):TEXT(&quot; (&quot;);
3818  					}
3819  					else if (wParam == IDD_AUTOCBRACKET_CHECK)
3820  					{
3821  						nppGUI._matchedPairConf._doBrackets = isChecked;
3822  						label = isChecked?TEXT(&quot; [  ]&quot;):TEXT(&quot; [&quot;);
3823  					}
3824  					else if (wParam == IDD_AUTOCCURLYBRACKET_CHECK)
3825  					{
3826  						nppGUI._matchedPairConf._doCurlyBrackets = isChecked;
3827  						label = isChecked?TEXT(&quot; {  }&quot;):TEXT(&quot; {&quot;);
3828  					}
3829  					else if (wParam == IDD_AUTOC_DOUBLEQUOTESCHECK)
3830  					{
3831  						nppGUI._matchedPairConf._doDoubleQuotes = isChecked;
3832  						label = isChecked?TEXT(&quot; \&quot;  \&quot;&quot;):TEXT(&quot; \&quot;&quot;);
3833  					}
3834  					else 
3835  					{
3836  						nppGUI._matchedPairConf._doQuotes = isChecked;
3837  						label = isChecked?TEXT(&quot; &#x27;  &#x27;&quot;):TEXT(&quot; &#x27;&quot;);
3838  					}
3839  					::SendDlgItemMessage(_hSelf, static_cast&lt;int32_t&gt;(wParam), WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(label));
3840  					return TRUE;
3841  				}
3842  				case IDD_AUTOCTAG_CHECK :
3843  				{
3844  					nppGUI._matchedPairConf._doHtmlXmlTag = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDD_AUTOCTAG_CHECK, BM_GETCHECK, 0, 0));
3845  					return TRUE;
3846  				}
3847  				default :
3848  					return FALSE;
3849  			}
3850  		}
3851  	}
3852  	return FALSE;
3853  }
3854  intptr_t CALLBACK MultiInstanceSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
3855  {
3856  	NppGUI &amp; nppGUI = (NppParameters::getInstance()).getNppGUI();
3857  	switch (message) 
3858  	{
3859  		case WM_INITDIALOG :
3860  		{
3861  			auto checkOrUncheckBtn = [this](int id, bool check) -&gt; void
3862  			{
3863  				::SendDlgItemMessage(_hSelf, id, BM_SETCHECK, check ? BST_CHECKED : BST_UNCHECKED, 0);
3864  			};
3865  			checkOrUncheckBtn(IDC_CHECK_CLIPBOARDHISTORY, nppGUI._clipboardHistoryPanelKeepState);
3866  			checkOrUncheckBtn(IDC_CHECK_DOCLIST, nppGUI._docListKeepState);
3867  			checkOrUncheckBtn(IDC_CHECK_CHARPANEL, nppGUI._charPanelKeepState);
3868  			checkOrUncheckBtn(IDC_CHECK_FILEBROWSER, nppGUI._fileBrowserKeepState);
3869  			checkOrUncheckBtn(IDC_CHECK_PROJECTPANEL, nppGUI._projectPanelKeepState);
3870  			checkOrUncheckBtn(IDC_CHECK_DOCMAP, nppGUI._docMapKeepState);
3871  			checkOrUncheckBtn(IDC_CHECK_FUNCLIST, nppGUI._funcListKeepState);
3872  			checkOrUncheckBtn(IDC_CHECK_PLUGINPANEL, nppGUI._pluginPanelKeepState);
3873  			MultiInstSetting multiInstSetting = nppGUI._multiInstSetting;
3874  			::SendDlgItemMessage(_hSelf, IDC_SESSIONININST_RADIO, BM_SETCHECK, multiInstSetting == multiInstOnSession?BST_CHECKED:BST_UNCHECKED, 0);
3875  			::SendDlgItemMessage(_hSelf, IDC_MULTIINST_RADIO, BM_SETCHECK, multiInstSetting == multiInst?BST_CHECKED:BST_UNCHECKED, 0);
3876  			::SendDlgItemMessage(_hSelf, IDC_MONOINST_RADIO, BM_SETCHECK, multiInstSetting == monoInst?BST_CHECKED:BST_UNCHECKED, 0);
3877  			::SendDlgItemMessage(_hSelf, IDD_DATETIMEFORMAT_REVERSEORDER_CHECK, BM_SETCHECK, nppGUI._dateTimeReverseDefaultOrder ? BST_CHECKED : BST_UNCHECKED, 0);
3878  			::SetDlgItemText(_hSelf, IDC_DATETIMEFORMAT_EDIT, nppGUI._dateTimeFormat.c_str());
3879  			generic_string datetimeStr = getDateTimeStrFrom(nppGUI._dateTimeFormat, _BTTF_time);
3880  			::SetDlgItemText(_hSelf, IDD_DATETIMEFORMAT_RESULT_STATIC, datetimeStr.c_str());
3881  			return TRUE;
3882  		}
3883  		case WM_CTLCOLOREDIT:
3884  		{
3885  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
3886  		}
3887  		case WM_CTLCOLORDLG:
3888  		case WM_CTLCOLORSTATIC:
3889  		{
3890  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
3891  		}
3892  		case WM_PRINTCLIENT:
3893  		{
3894  			if (NppDarkMode::isEnabled())
3895  			{
3896  				return TRUE;
3897  			}
3898  			break;
3899  		}
3900  		case WM_COMMAND : 
3901  		{
3902  			if (HIWORD(wParam) == EN_CHANGE &amp;&amp; LOWORD(wParam) == IDC_DATETIMEFORMAT_EDIT)
3903  			{
3904  				constexpr size_t inputLen = 256;
3905  				TCHAR input[inputLen]{};
3906  				::GetDlgItemText(_hSelf, IDC_DATETIMEFORMAT_EDIT, input, inputLen);
3907  				nppGUI._dateTimeFormat = input;
3908  				generic_string datetimeStr = getDateTimeStrFrom(nppGUI._dateTimeFormat, _BTTF_time);
3909  				::SetDlgItemText(_hSelf, IDD_DATETIMEFORMAT_RESULT_STATIC, datetimeStr.c_str());
3910  				return TRUE;
3911  			}
3912  			switch (wParam)
3913  			{
3914  				case IDC_SESSIONININST_RADIO :
3915  				{
3916  					nppGUI._multiInstSetting = multiInstOnSession;
3917  				}
3918  				break;
3919  				case IDC_MULTIINST_RADIO :
3920  				{
3921  					nppGUI._multiInstSetting = multiInst;
3922  				}
3923  				break;
3924  				case IDC_MONOINST_RADIO :
3925  				{
3926  					nppGUI._multiInstSetting = monoInst;
3927  				}
3928  				break;
3929  				case IDD_DATETIMEFORMAT_REVERSEORDER_CHECK:
3930  				{
3931  					nppGUI._dateTimeReverseDefaultOrder = isCheckedOrNot(IDD_DATETIMEFORMAT_REVERSEORDER_CHECK);
3932  				}
3933  				break;
3934  				case IDC_CHECK_CLIPBOARDHISTORY:
3935  				{
3936  					nppGUI._clipboardHistoryPanelKeepState = isCheckedOrNot(IDC_CHECK_CLIPBOARDHISTORY);
3937  				}
3938  				break;
3939  				case IDC_CHECK_DOCLIST:
3940  				{
3941  					nppGUI._docListKeepState = isCheckedOrNot(IDC_CHECK_DOCLIST);
3942  				}
3943  				break;
3944  				case IDC_CHECK_CHARPANEL:
3945  				{
3946  					nppGUI._charPanelKeepState = isCheckedOrNot(IDC_CHECK_CHARPANEL);
3947  				}
3948  				break;
3949  				case IDC_CHECK_FILEBROWSER:
3950  				{
3951  					nppGUI._fileBrowserKeepState = isCheckedOrNot(IDC_CHECK_FILEBROWSER);
3952  				}
3953  				break;
3954  				case IDC_CHECK_PROJECTPANEL:
3955  				{
3956  					nppGUI._projectPanelKeepState = isCheckedOrNot(IDC_CHECK_PROJECTPANEL);
3957  				}
3958  				break;
3959  				case IDC_CHECK_DOCMAP:
3960  				{
3961  					nppGUI._docMapKeepState = isCheckedOrNot(IDC_CHECK_DOCMAP);
3962  				}
3963  				break;
3964  				case IDC_CHECK_FUNCLIST:
3965  				{
3966  					nppGUI._funcListKeepState = isCheckedOrNot(IDC_CHECK_FUNCLIST);
3967  				}
3968  				break;
3969  				case IDC_CHECK_PLUGINPANEL:
3970  				{
3971  					nppGUI._pluginPanelKeepState = isCheckedOrNot(IDC_CHECK_PLUGINPANEL);
3972  				}
3973  				break;
3974  				default :
3975  					return FALSE;
3976  			}
3977  		}
3978  		break;
3979  	}
3980  	return FALSE;
3981  }
3982  void DelimiterSubDlg::detectSpace(const char *text2Check, int &amp; nbSp, int &amp; nbTab) const
3983  {
3984  	nbSp = nbTab = 0;
3985  	for (size_t i = 0; i &lt; strlen(text2Check); ++i)
3986  	{
3987  		if (text2Check[i] == &#x27; &#x27;)
3988  			++nbSp;
3989  		else if (text2Check[i] == &#x27;\t&#x27;)
3990  			++nbTab;
3991  	}
3992  }
3993  generic_string DelimiterSubDlg::getWarningText(size_t nbSp, size_t nbTab) const
3994  {
3995  	NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
3996  	generic_string msg;
3997  	if (nbSp &amp;&amp; nbTab)
3998  	{
3999  		generic_string nbSpStr = std::to_wstring(nbSp);
4000  		generic_string nbTabStr = std::to_wstring(nbTab);
4001  		generic_string warnBegin = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-begin&quot;, TEXT(&quot;&quot;));
4002  		generic_string space = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-space-warning&quot;, TEXT(&quot;&quot;));
4003  		generic_string tab = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-tab-warning&quot;, TEXT(&quot;&quot;));
4004  		generic_string warnEnd = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-end&quot;, TEXT(&quot;&quot;));
4005  		if (!warnBegin.empty() &amp;&amp; !space.empty() &amp;&amp; !tab.empty() &amp;&amp; !warnEnd.empty())
4006  		{
4007  			space = stringReplace(space, TEXT(&quot;$INT_REPLACE$&quot;), nbSpStr);
4008  			tab = stringReplace(tab, TEXT(&quot;$INT_REPLACE$&quot;), nbTabStr);
4009  			msg = warnBegin;
4010  			msg += space;
4011  			msg += TEXT(&quot; &amp;&amp; &quot;);
4012  			msg += tab;
4013  			msg += warnEnd;
4014  		}
4015  		else
4016  		{
4017  			msg = TEXT(&quot;Be aware: &quot;);
4018  			msg += nbSpStr;
4019  			msg += TEXT(&quot; space(s) &amp;&amp; &quot;);
4020  			msg += std::to_wstring(nbTab);
4021  			msg += TEXT(&quot; TAB(s) in your character list.&quot;);
4022  		}
4023  	}
4024  	else if (nbSp &amp;&amp; !nbTab)
4025  	{
4026  		generic_string nbSpStr = std::to_wstring(nbSp);
4027  		generic_string warnBegin = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-begin&quot;, TEXT(&quot;&quot;));
4028  		generic_string space = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-space-warning&quot;, TEXT(&quot;&quot;));
4029  		generic_string warnEnd = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-end&quot;, TEXT(&quot;&quot;));
4030  		if (!warnBegin.empty() &amp;&amp; !space.empty() &amp;&amp; !warnEnd.empty())
4031  		{
4032  			space = stringReplace(space, TEXT(&quot;$INT_REPLACE$&quot;), nbSpStr);
4033  			msg = warnBegin;
4034  			msg += space;
4035  			msg += warnEnd;
4036  		}
4037  		else
4038  		{
4039  			msg = TEXT(&quot;Be aware: &quot;);
4040  			msg += std::to_wstring(nbSp);
4041  			msg += TEXT(&quot; space(s) in your character list.&quot;);
4042  		}
4043  	}
4044  	else if (!nbSp &amp;&amp; nbTab)
4045  	{
4046  		generic_string nbTabStr = std::to_wstring(nbTab);
4047  		generic_string warnBegin = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-begin&quot;, TEXT(&quot;&quot;));
4048  		generic_string tab = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-tab-warning&quot;, TEXT(&quot;&quot;));
4049  		generic_string warnEnd = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-warning-end&quot;, TEXT(&quot;&quot;));
4050  		if (!warnBegin.empty() &amp;&amp; !tab.empty() &amp;&amp; !warnEnd.empty())
4051  		{
4052  			tab = stringReplace(tab, TEXT(&quot;$INT_REPLACE$&quot;), nbTabStr);
4053  			msg = warnBegin;
4054  			msg += tab;
4055  			msg += warnEnd;
4056  		}
4057  		else
4058  		{
4059  			msg = TEXT(&quot;Be aware: &quot;);
4060  			msg += std::to_wstring(nbTab);
4061  			msg += TEXT(&quot; TAB(s) in your character list.&quot;);
4062  		}
4063  	}
4064  	else 
4065  	{
4066  	}
4067  	return msg;
4068  }
4069  void DelimiterSubDlg::setWarningIfNeed() const
4070  {
4071  	generic_string msg;
4072  	NppGUI &amp; nppGUI = (NppParameters::getInstance()).getNppGUI();
4073  	if (!nppGUI._isWordCharDefault)
4074  	{
4075  		int nbSp = 0;
4076  		int nbTab = 0;
4077  		detectSpace(nppGUI._customWordChars.c_str(), nbSp, nbTab);
4078  		msg = getWarningText(nbSp, nbTab);
4079  	}
4080  	::SetDlgItemText(_hSelf, IDD_STATIC_WORDCHAR_WARNING, msg.c_str());
4081  }
4082  intptr_t CALLBACK DelimiterSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
4083  {
4084  	NppGUI &amp; nppGUI = (NppParameters::getInstance()).getNppGUI();
4085  	switch (message) 
4086  	{
4087  		case WM_INITDIALOG :
4088  		{
4089  			TCHAR opener[2]{};
4090  			opener[0] = nppGUI._leftmostDelimiter;
4091  			opener[1] = &#x27;\0&#x27;;
4092  			TCHAR closer[2]{};
4093  			closer[0] = nppGUI._rightmostDelimiter;
4094  			closer[1] = &#x27;\0&#x27;;
4095  			bool onSeveralLines = nppGUI._delimiterSelectionOnEntireDocument;
4096  			::SendDlgItemMessage(_hSelf, IDC_EDIT_OPENDELIMITER, EM_LIMITTEXT, 1, 0);
4097  			::SendDlgItemMessage(_hSelf, IDC_EDIT_CLOSEDELIMITER, EM_LIMITTEXT, 1, 0);
4098  			::SendDlgItemMessage(_hSelf, IDC_EDIT_OPENDELIMITER, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(opener));
4099  			::SendDlgItemMessage(_hSelf, IDC_EDIT_CLOSEDELIMITER, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(closer));
4100  			::SendDlgItemMessage(_hSelf, IDD_SEVERALLINEMODEON_CHECK, BM_SETCHECK, onSeveralLines?BST_CHECKED:BST_UNCHECKED, 0);
4101  			POINT point = getTopPoint(::GetDlgItem(_hSelf, IDD_STATIC_BLABLA), false);
4102  			_singleLineModePoint.x = point.x + 4;
4103  			_singleLineModePoint.y = point.y - 4;
4104  			point = getTopPoint(::GetDlgItem(_hSelf, IDD_STATIC_BLABLA2NDLINE), false);
4105  			_multiLineModePoint.x = point.x + 4;
4106  			_multiLineModePoint.y = point.y - 4;
4107  			::GetClientRect(::GetDlgItem(_hSelf, IDC_EDIT_CLOSEDELIMITER), &amp;_closerRect);
4108  			_closerRect.right = _closerRect.right - _closerRect.left + 4;
4109  			_closerRect.bottom = _closerRect.bottom - _closerRect.top + 4;
4110  			::GetClientRect(::GetDlgItem(_hSelf, IDD_STATIC_CLOSEDELIMITER), &amp;_closerLabelRect);
4111  			_closerLabelRect.right = _closerLabelRect.right - _closerLabelRect.left + 4;
4112  			_closerLabelRect.bottom = _closerLabelRect.bottom - _closerLabelRect.top + 4;
4113  			::ShowWindow(::GetDlgItem(_hSelf, IDD_STATIC_BLABLA2NDLINE),onSeveralLines?SW_SHOW:SW_HIDE);
4114  			POINT *p = onSeveralLines?&amp;_multiLineModePoint:&amp;_singleLineModePoint;
4115  			::MoveWindow(::GetDlgItem(_hSelf, IDC_EDIT_CLOSEDELIMITER), p-&gt;x, p-&gt;y, _closerRect.right, _closerRect.bottom, TRUE);
4116  			::MoveWindow(::GetDlgItem(_hSelf, IDD_STATIC_CLOSEDELIMITER), p-&gt;x + _closerRect.right + 4, p-&gt;y + 4, _closerLabelRect.right, _closerLabelRect.bottom, TRUE);
4117  			::SetDlgItemTextA(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT, nppGUI._customWordChars.c_str());
4118  			::SendDlgItemMessage(_hSelf, IDC_RADIO_WORDCHAR_DEFAULT, BM_SETCHECK, nppGUI._isWordCharDefault ? BST_CHECKED : BST_UNCHECKED, 0);
4119  			::SendDlgItemMessage(_hSelf, IDC_RADIO_WORDCHAR_CUSTOM, BM_SETCHECK, !nppGUI._isWordCharDefault ? BST_CHECKED : BST_UNCHECKED, 0);
4120  			::EnableWindow(::GetDlgItem(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT), !nppGUI._isWordCharDefault);
4121  			setWarningIfNeed();
4122  			NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
4123  			generic_string tip2show = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;word-chars-list-tip&quot;, TEXT(&quot;This allows you to include additional character into current word characters while double clicking for selection or searching with \&quot;Match whole word only\&quot; option checked.&quot;));
4124  			_tip = CreateToolTip(IDD_WORDCHAR_QUESTION_BUTTON, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(tip2show.c_str()), pNativeSpeaker-&gt;isRTL());
4125  			if (_tip)
4126  			{
4127  				SendMessage(_tip, TTM_SETDELAYTIME, TTDT_AUTOPOP, MAKELPARAM((30000), (0)));
4128  			}
4129  			return TRUE;
4130  		}
4131  		case WM_CTLCOLOREDIT:
4132  		{
4133  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
4134  		}
4135  		case WM_CTLCOLORDLG:
4136  		{
4137  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4138  		}
4139  		case WM_CTLCOLORSTATIC:
4140  		{
4141  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
4142  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
4143  			bool isBlabla = (dlgCtrlID == IDD_STATIC_BLABLA) || (dlgCtrlID == IDD_STATIC_BLABLA2NDLINE);
4144  			if (NppDarkMode::isEnabled())
4145  			{
4146  				if (isBlabla)
4147  				{
4148  					return NppDarkMode::onCtlColor(hdcStatic);
4149  				}
4150  				return NppDarkMode::onCtlColorDarker(hdcStatic);
4151  			}
4152  			else if (isBlabla)
4153  			{
4154  				COLORREF bgColor = getCtrlBgColor(_hSelf);
4155  				SetTextColor(hdcStatic, RGB(0, 0, 0));
4156  				BYTE r = GetRValue(bgColor) - 30;
4157  				BYTE g = MyGetGValue(bgColor) - 30;
4158  				BYTE b = GetBValue(bgColor) - 30;
4159  				SetBkColor(hdcStatic, RGB(r, g, b));
4160  				return TRUE;
4161  			}
4162  			break;
4163  		}
4164  		case WM_PRINTCLIENT:
4165  		{
4166  			if (NppDarkMode::isEnabled())
4167  			{
4168  				return TRUE;
4169  			}
4170  			break;
4171  		}
4172  		case WM_COMMAND : 
4173  		{
4174  			if (HIWORD(wParam) == EN_CHANGE)
4175  			{
4176  				switch (LOWORD(wParam))
4177  				{
4178  					case  IDC_EDIT_OPENDELIMITER:
4179  					{
4180  						TCHAR opener[2] = { &#x27;\0&#x27; };
4181  						::SendDlgItemMessage(_hSelf, IDC_EDIT_OPENDELIMITER, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(opener));
4182  						nppGUI._leftmostDelimiter =  static_cast&lt;char&gt;(opener[0]);
4183  						return TRUE;
4184  					}
4185  					case  IDC_EDIT_CLOSEDELIMITER:
4186  					{
4187  						TCHAR closer[2] = { &#x27;\0&#x27; };
4188  						::SendDlgItemMessage(_hSelf, IDC_EDIT_CLOSEDELIMITER, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(closer));
4189  						nppGUI._rightmostDelimiter =  static_cast&lt;char&gt;(closer[0]);
4190  						return TRUE;
4191  					}
4192  					case  IDC_WORDCHAR_CUSTOM_EDIT:
4193  					{
4194  						char customText[MAX_PATH];
4195  						::GetDlgItemTextA(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT, customText, MAX_PATH-1);
4196  						nppGUI._customWordChars = customText;
4197  						setWarningIfNeed();
4198  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETWORDCHARS, 0, 0);
4199  						return TRUE;
4200  					}
4201  					default:
4202  						return FALSE;
4203  				}
4204  			}
4205  			switch (wParam)
4206  			{
4207  				case IDD_SEVERALLINEMODEON_CHECK :
4208  				{
4209  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDD_SEVERALLINEMODEON_CHECK, BM_GETCHECK, 0, 0));
4210  					nppGUI._delimiterSelectionOnEntireDocument = isChecked;
4211  					::ShowWindow(::GetDlgItem(_hSelf, IDD_STATIC_BLABLA2NDLINE),isChecked?SW_SHOW:SW_HIDE);
4212  					POINT *p = isChecked?&amp;_multiLineModePoint:&amp;_singleLineModePoint;
4213  					::MoveWindow(::GetDlgItem(_hSelf, IDC_EDIT_CLOSEDELIMITER), p-&gt;x, p-&gt;y, _closerRect.right, _closerRect.bottom, TRUE);
4214  					::MoveWindow(::GetDlgItem(_hSelf, IDD_STATIC_CLOSEDELIMITER), p-&gt;x + _closerRect.right + 4, p-&gt;y + 4, _closerLabelRect.right, _closerLabelRect.bottom, TRUE);
4215  					return TRUE;
4216  				}
4217  				case IDC_RADIO_WORDCHAR_DEFAULT:
4218  				{
4219  					::SendDlgItemMessage(_hSelf, IDC_RADIO_WORDCHAR_CUSTOM, BM_SETCHECK, BST_UNCHECKED, 0);
4220  					nppGUI._isWordCharDefault = true;
4221  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETWORDCHARS, 0, 0);
4222  					::EnableWindow(::GetDlgItem(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT), !nppGUI._isWordCharDefault);
4223  					::SetDlgItemText(_hSelf, IDD_STATIC_WORDCHAR_WARNING, TEXT(&quot;&quot;));
4224  					return TRUE;
4225  				}
4226  				case IDC_RADIO_WORDCHAR_CUSTOM:
4227  				{
4228  					::SendDlgItemMessage(_hSelf, IDC_RADIO_WORDCHAR_DEFAULT, BM_SETCHECK, BST_UNCHECKED, 0);
4229  					nppGUI._isWordCharDefault = false;
4230  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_SETWORDCHARS, 0, 0);
4231  					::EnableWindow(::GetDlgItem(_hSelf, IDC_WORDCHAR_CUSTOM_EDIT), !nppGUI._isWordCharDefault);
4232  					setWarningIfNeed();
4233  					return TRUE;
4234  				}
4235  				default :
4236  					return FALSE;
4237  			}
4238  		}
4239  		break;
4240  	}
4241  	return FALSE;
4242  }
4243  intptr_t CALLBACK CloudAndLinkSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
4244  {
4245  	NppParameters&amp; nppParams = NppParameters::getInstance();
4246  	NppGUI &amp; nppGUI = nppParams.getNppGUI();
4247  	const size_t uriSchemesMaxLength = 2048;
4248  	if (HIWORD(wParam) == EN_CHANGE)
4249  	{
4250  		switch (LOWORD(wParam))
4251  		{
4252  			case  IDC_CLOUDPATH_EDIT:
4253  			{
4254  				TCHAR inputDir[MAX_PATH] = {&#x27;\0&#x27;};
4255  				TCHAR inputDirExpanded[MAX_PATH] = {&#x27;\0&#x27;};
4256  				::SendDlgItemMessage(_hSelf, IDC_CLOUDPATH_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(inputDir));
4257  				::ExpandEnvironmentStrings(inputDir, inputDirExpanded, MAX_PATH);
4258  				NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
4259  				if (::PathFileExists(inputDirExpanded))
4260  				{
4261  					nppGUI._cloudPath = inputDirExpanded;
4262  					nppParams.setCloudChoice(inputDirExpanded);
4263  					generic_string message;
4264  					if (nppParams.isCloudPathChanged())
4265  					{
4266  						message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-restart-warning&quot;, TEXT(&quot;Please restart Notepad++ to take effect.&quot;));
4267  					}
4268  					::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4269  				}
4270  				else
4271  				{
4272  					bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_WITHCLOUD_RADIO, BM_GETCHECK, 0, 0));
4273  					if (isChecked)
4274  					{
4275  						generic_string message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-invalid-warning&quot;, TEXT(&quot;Invalid path.&quot;));
4276  						::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4277  						nppParams.removeCloudChoice();
4278  					}
4279  				}
4280  				return TRUE;
4281  			}
4282  			case IDC_URISCHEMES_EDIT:
4283  			{
4284  				TCHAR uriScheme[uriSchemesMaxLength] = { &#x27;\0&#x27; };
4285  				::SendDlgItemMessage(_hSelf, IDC_URISCHEMES_EDIT, WM_GETTEXT, uriSchemesMaxLength, reinterpret_cast&lt;LPARAM&gt;(uriScheme));
4286  				nppGUI._uriSchemes = uriScheme;
4287  				HWND grandParent = ::GetParent(_hParent);
4288  				::SendMessage(grandParent, NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4289  				return TRUE;
4290  			}
4291  		}
4292  	}
4293  	switch (message)
4294  	{
4295  		case WM_INITDIALOG:
4296  		{
4297  			generic_string message = TEXT(&quot;&quot;);
4298  			bool withCloud = nppGUI._cloudPath != TEXT(&quot;&quot;);
4299  			if (withCloud)
4300  			{
4301  				if (!::PathFileExists(nppGUI._cloudPath.c_str()))
4302  					message = TEXT(&quot;Invalid path&quot;);
4303  			}
4304  			::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4305  			::SendDlgItemMessage(_hSelf, IDC_NOCLOUD_RADIO, BM_SETCHECK, !withCloud ? BST_CHECKED : BST_UNCHECKED, 0);
4306  			::SendDlgItemMessage(_hSelf, IDC_WITHCLOUD_RADIO, BM_SETCHECK, withCloud ? BST_CHECKED : BST_UNCHECKED, 0);
4307  			::SendDlgItemMessage(_hSelf, IDC_CLOUDPATH_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._cloudPath.c_str()));
4308  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CLOUDPATH_EDIT), withCloud);
4309  			::EnableWindow(::GetDlgItem(_hSelf, IDD_CLOUDPATH_BROWSE_BUTTON), withCloud);
4310  			BOOL linkEnable = nppGUI._styleURL != urlDisable;
4311  			BOOL dontUnderline = (nppGUI._styleURL == urlNoUnderLineFg) || (nppGUI._styleURL == urlNoUnderLineBg);
4312  			BOOL roundBoxMode = (nppGUI._styleURL == urlNoUnderLineBg) || (nppGUI._styleURL == urlUnderLineBg);
4313  			::SendDlgItemMessage(_hSelf, IDC_URISCHEMES_EDIT, EM_SETLIMITTEXT, uriSchemesMaxLength, 0);
4314  			::SetWindowText(::GetDlgItem(_hSelf, IDC_URISCHEMES_EDIT), nppGUI._uriSchemes.c_str());
4315  			::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_ENABLE, BM_SETCHECK, linkEnable, 0);
4316  			::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_NOUNDERLINE, BM_SETCHECK, dontUnderline, 0);
4317  			::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_FULLBOXMODE, BM_SETCHECK, roundBoxMode, 0);
4318  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_CLICKABLELINK_NOUNDERLINE), linkEnable);
4319  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_CLICKABLELINK_FULLBOXMODE), linkEnable);
4320  			::EnableWindow(::GetDlgItem(_hSelf, IDC_URISCHEMES_EDIT), linkEnable);
4321  			return TRUE;
4322  		}
4323  		case WM_CTLCOLOREDIT:
4324  		{
4325  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
4326  		}
4327  		case WM_CTLCOLORDLG:
4328  		{
4329  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4330  		}
4331  		case WM_CTLCOLORSTATIC:
4332  		{
4333  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
4334  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
4335  			bool isStaticText = dlgCtrlID == IDC_URISCHEMES_STATIC;
4336  			if (isStaticText)
4337  			{
4338  				bool isTextEnabled = isCheckedOrNot(IDC_CHECK_CLICKABLELINK_ENABLE);
4339  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
4340  			}
4341  			return NppDarkMode::onCtlColorDarker(hdcStatic);
4342  		}
4343  		case WM_PRINTCLIENT:
4344  		{
4345  			if (NppDarkMode::isEnabled())
4346  			{
4347  				return TRUE;
4348  			}
4349  			break;
4350  		}
4351  		case WM_COMMAND:
4352  		{
4353  			NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
4354  			switch (wParam)
4355  			{
4356  				case IDC_NOCLOUD_RADIO:
4357  				{
4358  					nppGUI._cloudPath = TEXT(&quot;&quot;);
4359  					nppParams.removeCloudChoice();
4360  					generic_string message;
4361  					if (nppParams.isCloudPathChanged())
4362  					{
4363  						message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-restart-warning&quot;, TEXT(&quot;Please restart Notepad++ to take effect.&quot;));
4364  					}
4365  					::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4366  					::SendDlgItemMessage(_hSelf, IDC_CLOUDPATH_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._cloudPath.c_str()));
4367  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CLOUDPATH_EDIT), false);
4368  					::EnableWindow(::GetDlgItem(_hSelf, IDD_CLOUDPATH_BROWSE_BUTTON), false);
4369  				}
4370  				break;
4371  				case IDC_WITHCLOUD_RADIO:
4372  				{
4373  					generic_string message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-invalid-warning&quot;, TEXT(&quot;Invalid path.&quot;));
4374  					::SetDlgItemText(_hSelf, IDC_SETTINGSONCLOUD_WARNING_STATIC, message.c_str());
4375  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CLOUDPATH_EDIT), true);
4376  					::EnableWindow(::GetDlgItem(_hSelf, IDD_CLOUDPATH_BROWSE_BUTTON), true);
4377  				}
4378  				break;
4379  				case IDD_CLOUDPATH_BROWSE_BUTTON:
4380  				{
4381  					generic_string message = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;cloud-select-folder&quot;, TEXT(&quot;Select a folder from/to where Notepad++ reads/writes its settings&quot;));
4382  					folderBrowser(_hSelf, message, IDC_CLOUDPATH_EDIT);
4383  				}
4384  				break;
4385  				case IDC_CHECK_CLICKABLELINK_ENABLE:
4386  				{
4387  					bool isChecked = isCheckedOrNot(IDC_CHECK_CLICKABLELINK_ENABLE);
4388  					if (!isChecked)
4389  					{
4390  						::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_NOUNDERLINE, BM_SETCHECK, BST_UNCHECKED, 0);
4391  						::SendDlgItemMessage(_hSelf, IDC_CHECK_CLICKABLELINK_FULLBOXMODE, BM_SETCHECK, BST_UNCHECKED, 0);
4392  					}
4393  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_CLICKABLELINK_NOUNDERLINE), isChecked);
4394  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_CLICKABLELINK_FULLBOXMODE), isChecked);
4395  					::EnableWindow(::GetDlgItem(_hSelf, IDC_URISCHEMES_EDIT), isChecked);
4396  					redrawDlgItem(IDC_CLICKABLELINK_STATIC);
4397  					nppGUI._styleURL = isChecked ? urlUnderLineFg : urlDisable;
4398  					HWND grandParent = ::GetParent(_hParent);
4399  					::SendMessage(grandParent, NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4400  				}
4401  				return TRUE;
4402  				case IDC_CHECK_CLICKABLELINK_NOUNDERLINE:
4403  				case IDC_CHECK_CLICKABLELINK_FULLBOXMODE:
4404  				{
4405  					bool isNoUnderline = isCheckedOrNot(IDC_CHECK_CLICKABLELINK_NOUNDERLINE);
4406  					bool isRoundBoxMode = isCheckedOrNot(IDC_CHECK_CLICKABLELINK_FULLBOXMODE);
4407  					if (isRoundBoxMode)
4408  						nppGUI._styleURL = isNoUnderline ? urlNoUnderLineBg : urlUnderLineBg;
4409  					else
4410  						nppGUI._styleURL = isNoUnderline ? urlNoUnderLineFg : urlUnderLineFg;
4411  					HWND grandParent = ::GetParent(_hParent);
4412  					::SendMessage(grandParent, NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4413  				}
4414  				return TRUE;
4415  				default:
4416  					return FALSE;
4417  			}
4418  		}																						
4419  	}
4420  	return FALSE;
4421  }
4422  intptr_t CALLBACK PerformanceSubDlg::run_dlgProc(UINT message , WPARAM wParam, LPARAM lParam)
4423  {
4424  	NppGUI&amp; nppGUI = NppParameters::getInstance().getNppGUI();
4425  	if (HIWORD(wParam) == EN_CHANGE)
4426  	{
4427  		switch (LOWORD(wParam))
4428  		{
4429  			case  IDC_EDIT_PERFORMANCE_FILESIZE:
4430  			{
4431  				constexpr int stringSize = 16;
4432  				TCHAR str[stringSize]{};
4433  				::GetDlgItemText(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, str, stringSize);
4434  				if (lstrcmp(str, TEXT(&quot;&quot;)) == 0)
4435  					return TRUE;
4436  				int64_t fileLenInMB = ::GetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, NULL, FALSE);
4437  				if (fileLenInMB &gt; 4096)
4438  				{
4439  					fileLenInMB = 4096;
4440  					::SetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, UINT(fileLenInMB), FALSE);
4441  				}
4442  				nppGUI._largeFileRestriction._largeFileSizeDefInByte = fileLenInMB * 1024 * 1024;
4443  			}
4444  			return TRUE;
4445  		}
4446  	}
4447  	else if (HIWORD(wParam) == EN_KILLFOCUS)
4448  	{
4449  		switch (LOWORD(wParam))
4450  		{
4451  			case  IDC_EDIT_PERFORMANCE_FILESIZE:
4452  			{
4453  				constexpr int stringSize = 16;
4454  				TCHAR str[stringSize]{};
4455  				::GetDlgItemText(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, str, stringSize);
4456  				if (lstrcmp(str, TEXT(&quot;&quot;)) == 0)
4457  				{
4458  					::SetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, (NPP_STYLING_FILESIZE_LIMIT_DEFAULT / 1024) / 1024, FALSE);
4459  					return TRUE;
4460  				}
4461  				int64_t fileLenInMB = ::GetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, NULL, FALSE);
4462  				if (fileLenInMB == 0)
4463  				{
4464  					fileLenInMB = (NPP_STYLING_FILESIZE_LIMIT_DEFAULT / 1024) / 1024;
4465  					::SetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, UINT(fileLenInMB), FALSE);
4466  					return TRUE;
4467  				}
4468  			}
4469  			return TRUE;
4470  		}
4471  	}
4472  	switch (message)
4473  	{
4474  		case WM_INITDIALOG:
4475  		{
4476  			int64_t fileLenInMB = (nppGUI._largeFileRestriction._largeFileSizeDefInByte / 1024) / 1024;
4477  			::SetDlgItemInt(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE, UINT(fileLenInMB), FALSE);
4478  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ENABLE, BM_SETCHECK, nppGUI._largeFileRestriction._isEnabled ? BST_CHECKED : BST_UNCHECKED, 0);
4479  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWBRACEMATCH, BM_SETCHECK, nppGUI._largeFileRestriction._allowBraceMatch ? BST_CHECKED : BST_UNCHECKED, 0);
4480  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWAUTOCOMPLETION, BM_SETCHECK, nppGUI._largeFileRestriction._allowAutoCompletion ? BST_CHECKED : BST_UNCHECKED, 0);
4481  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWSMARTHILITE, BM_SETCHECK, nppGUI._largeFileRestriction._allowSmartHilite ? BST_CHECKED : BST_UNCHECKED, 0);
4482  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWCLICKABLELINK, BM_SETCHECK, nppGUI._largeFileRestriction._allowClickableLink ? BST_CHECKED : BST_UNCHECKED, 0);
4483  			::SendDlgItemMessage(_hSelf, IDC_CHECK_PERFORMANCE_DEACTIVATEWORDWRAP, BM_SETCHECK, nppGUI._largeFileRestriction._deactivateWordWrap ? BST_CHECKED : BST_UNCHECKED, 0);
4484  			bool largeFileRestrictionEnabled = isCheckedOrNot(IDC_CHECK_PERFORMANCE_ENABLE);
4485  			::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE), largeFileRestrictionEnabled);
4486  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWBRACEMATCH), largeFileRestrictionEnabled);
4487  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWAUTOCOMPLETION), largeFileRestrictionEnabled);
4488  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWSMARTHILITE), largeFileRestrictionEnabled);
4489  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWCLICKABLELINK), largeFileRestrictionEnabled);
4490  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_DEACTIVATEWORDWRAP), largeFileRestrictionEnabled);
4491  			NativeLangSpeaker* pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
4492  			generic_string enablePerfTip = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;largeFileRestriction-tip&quot;, TEXT(&quot;Some features may slow performance in large files. These features can be auto-disabled on opening a large file. You can customize them here.\n\nNOTE:\n1. Modifying options here requires re-open currently opened large files to get proper behavior.\n\n2. If \&quot;Deactivate Word Wrap globally\&quot; is checked and you open a large file, \&quot;Word Wrap\&quot; will be disabled for all files. You can re-enable it via menu \&quot;View-&gt;Word Wrap\&quot;&quot;));
4493  			_largeFileRestrictionTip = CreateToolTip(IDD_PERFORMANCE_TIP_QUESTION_BUTTON, _hSelf, _hInst, const_cast&lt;PTSTR&gt;(enablePerfTip.c_str()), false);
4494  			return TRUE;
4495  		}
4496  		case WM_CTLCOLOREDIT:
4497  		{
4498  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
4499  		}
4500  		case WM_CTLCOLORDLG:
4501  		{
4502  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4503  		}
4504  		case WM_CTLCOLORSTATIC:
4505  		{
4506  			auto hdcStatic = reinterpret_cast&lt;HDC&gt;(wParam);
4507  			auto dlgCtrlID = ::GetDlgCtrlID(reinterpret_cast&lt;HWND&gt;(lParam));
4508  			bool isStaticText = (dlgCtrlID == IDC_STATIC_PERFORMANCE_FILESIZE || dlgCtrlID == IDC_STATIC_PERFORMANCE_MB);
4509  			if (isStaticText)
4510  			{
4511  				bool isTextEnabled = isCheckedOrNot(IDC_CHECK_PERFORMANCE_ENABLE);
4512  				return NppDarkMode::onCtlColorDarkerBGStaticText(hdcStatic, isTextEnabled);
4513  			}
4514  			if (dlgCtrlID == IDC_EDIT_PERFORMANCE_FILESIZE)
4515  			{
4516  				return NppDarkMode::onCtlColor(hdcStatic);
4517  			}
4518  			return NppDarkMode::onCtlColorDarker(hdcStatic);
4519  		}
4520  		case WM_PRINTCLIENT:
4521  		{
4522  			if (NppDarkMode::isEnabled())
4523  			{
4524  				return TRUE;
4525  			}
4526  			break;
4527  		}
4528  		case WM_COMMAND:
4529  		{
4530  			switch (wParam)
4531  			{
4532  				case IDC_CHECK_PERFORMANCE_ENABLE:
4533  				{
4534  					bool largeFileRestrictionEnabled = isCheckedOrNot(IDC_CHECK_PERFORMANCE_ENABLE);
4535  					nppGUI._largeFileRestriction._isEnabled = largeFileRestrictionEnabled;
4536  					::EnableWindow(::GetDlgItem(_hSelf, IDC_EDIT_PERFORMANCE_FILESIZE), largeFileRestrictionEnabled);
4537  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWBRACEMATCH), largeFileRestrictionEnabled);
4538  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWAUTOCOMPLETION), largeFileRestrictionEnabled);
4539  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWSMARTHILITE), largeFileRestrictionEnabled);
4540  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_ALLOWCLICKABLELINK), largeFileRestrictionEnabled);
4541  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_PERFORMANCE_DEACTIVATEWORDWRAP), largeFileRestrictionEnabled);
4542  					redrawDlgItem(IDC_STATIC_PERFORMANCE_FILESIZE);
4543  					redrawDlgItem(IDC_STATIC_PERFORMANCE_MB);
4544  					if (largeFileRestrictionEnabled)
4545  					{
4546  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CLEANSMARTHILITING, 0, 0);
4547  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CLEANBRACEMATCH, 0, 0);
4548  					}
4549  					else
4550  					{
4551  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4552  					}
4553  				}
4554  				return TRUE;
4555  				case IDC_CHECK_PERFORMANCE_ALLOWBRACEMATCH:
4556  				{
4557  					bool isAllowed = isCheckedOrNot(int(wParam));
4558  					nppGUI._largeFileRestriction._allowBraceMatch = isAllowed;
4559  					if (!isAllowed)
4560  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CLEANBRACEMATCH, 0, 0);
4561  				}
4562  				return TRUE;
4563  				case IDC_CHECK_PERFORMANCE_ALLOWAUTOCOMPLETION:
4564  				{
4565  					bool isAllowed = isCheckedOrNot(int(wParam));
4566  					nppGUI._largeFileRestriction._allowAutoCompletion = isAllowed;
4567  				}
4568  				return TRUE;
4569  				case IDC_CHECK_PERFORMANCE_ALLOWSMARTHILITE:
4570  				{
4571  					bool isAllowed = isCheckedOrNot(int(wParam));
4572  					nppGUI._largeFileRestriction._allowSmartHilite = isAllowed;
4573  					if (!isAllowed)
4574  						::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_CLEANSMARTHILITING, 0, 0);
4575  				}
4576  				return TRUE;
4577  				case IDC_CHECK_PERFORMANCE_ALLOWCLICKABLELINK:
4578  				{
4579  					bool isAllowed = isCheckedOrNot(int(wParam));
4580  					nppGUI._largeFileRestriction._allowClickableLink = isAllowed;
4581  					::SendMessage(::GetParent(_hParent), NPPM_INTERNAL_UPDATECLICKABLELINKS, 0, 0);
4582  				}
4583  				return TRUE;
4584  				case IDC_CHECK_PERFORMANCE_DEACTIVATEWORDWRAP:
4585  				{
4586  					bool isDeactivated = isCheckedOrNot(int(wParam));
4587  					nppGUI._largeFileRestriction._deactivateWordWrap = isDeactivated;
4588  				}
4589  				return TRUE;
4590  				default:
4591  					return FALSE;
4592  			}
4593  		}
4594  		break;
4595  	}
4596  	return FALSE;
4597  }
4598  intptr_t CALLBACK SearchEngineSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
4599  {
4600  	NppParameters&amp; nppParams = NppParameters::getInstance();
4601  	NppGUI &amp; nppGUI = nppParams.getNppGUI();
4602  	if (HIWORD(wParam) == EN_CHANGE)
4603  	{
4604  		switch (LOWORD(wParam))
4605  		{
4606  			case  IDC_SEARCHENGINE_EDIT:
4607  			{
4608  				TCHAR input[MAX_PATH] = { &#x27;\0&#x27; };
4609  				::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_EDIT, WM_GETTEXT, MAX_PATH, reinterpret_cast&lt;LPARAM&gt;(input));
4610  				nppGUI._searchEngineCustom = input;
4611  				return TRUE;
4612  			}
4613  		}
4614  	}
4615  	switch (message)
4616  	{
4617  		case WM_INITDIALOG:
4618  		{
4619  			if (nppGUI._searchEngineChoice == nppGUI.se_custom)
4620  			{
4621  				if (nppGUI._searchEngineCustom.empty())
4622  				{
4623  					nppGUI._searchEngineChoice = nppGUI.se_google;
4624  				}
4625  			}
4626  			if (nppGUI._searchEngineChoice == nppGUI.se_bing)
4627  				nppGUI._searchEngineChoice = nppGUI.se_duckDuckGo;
4628  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_CUSTOM_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_custom ? BST_CHECKED : BST_UNCHECKED, 0);
4629  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_DUCKDUCKGO_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_duckDuckGo ? BST_CHECKED : BST_UNCHECKED, 0);
4630  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_GOOGLE_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_google ? BST_CHECKED : BST_UNCHECKED, 0);
4631  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_YAHOO_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_yahoo ? BST_CHECKED : BST_UNCHECKED, 0);
4632  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_STACKOVERFLOW_RADIO, BM_SETCHECK, nppGUI._searchEngineChoice == nppGUI.se_stackoverflow ? BST_CHECKED : BST_UNCHECKED, 0);
4633  			::SendDlgItemMessage(_hSelf, IDC_SEARCHENGINE_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(nppGUI._searchEngineCustom.c_str()));
4634  			::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), nppGUI._searchEngineChoice == nppGUI.se_custom);
4635  			return TRUE;
4636  		}
4637  		case WM_CTLCOLOREDIT:
4638  		{
4639  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
4640  		}
4641  		case WM_CTLCOLORDLG:
4642  		case WM_CTLCOLORSTATIC:
4643  		{
4644  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4645  		}
4646  		case WM_PRINTCLIENT:
4647  		{
4648  			if (NppDarkMode::isEnabled())
4649  			{
4650  				return TRUE;
4651  			}
4652  			break;
4653  		}
4654  		case WM_COMMAND:
4655  		{
4656  			switch (wParam)
4657  			{
4658  				case IDC_SEARCHENGINE_DUCKDUCKGO_RADIO:
4659  				{
4660  					nppGUI._searchEngineChoice = nppGUI.se_duckDuckGo;
4661  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), false);
4662  				}
4663  				break;
4664  				case IDC_SEARCHENGINE_GOOGLE_RADIO:
4665  				{
4666  					nppGUI._searchEngineChoice = nppGUI.se_google;
4667  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), false);
4668  				}
4669  				break;
4670  				case IDC_SEARCHENGINE_YAHOO_RADIO:
4671  				{
4672  					nppGUI._searchEngineChoice = nppGUI.se_yahoo;
4673  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), false);
4674  				}
4675  				break;
4676  				case IDC_SEARCHENGINE_STACKOVERFLOW_RADIO:
4677  				{
4678  					nppGUI._searchEngineChoice = nppGUI.se_stackoverflow;
4679  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), false);
4680  				}
4681  				break;
4682  				case IDC_SEARCHENGINE_CUSTOM_RADIO:
4683  				{
4684  					nppGUI._searchEngineChoice = nppGUI.se_custom;
4685  					::EnableWindow(::GetDlgItem(_hSelf, IDC_SEARCHENGINE_EDIT), true);
4686  				}
4687  				break;
4688  				default:
4689  					return FALSE;
4690  			}
4691  		}
4692  		break;
4693  	}
4694  	return FALSE;
4695  }
4696  intptr_t CALLBACK SearchingSubDlg::run_dlgProc(UINT message, WPARAM wParam, LPARAM)
4697  {
4698  	NppParameters&amp; nppParams = NppParameters::getInstance();
4699  	NppGUI&amp; nppGUI = nppParams.getNppGUI();
4700  	switch (message)
4701  	{
4702  		case WM_INITDIALOG:
4703  		{
4704  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FILL_FIND_FIELD_WITH_SELECTED, BM_SETCHECK, nppGUI._fillFindFieldWithSelected, 0);
4705  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET, BM_SETCHECK, nppGUI._fillFindFieldSelectCaret, 0);
4706  			::SendDlgItemMessage(_hSelf, IDC_CHECK_MONOSPACEDFONT_FINDDLG, BM_SETCHECK, nppGUI._monospacedFontFindDlg, 0);
4707  			::SendDlgItemMessage(_hSelf, IDC_CHECK_FINDDLG_ALWAYS_VISIBLE, BM_SETCHECK, nppGUI._findDlgAlwaysVisible, 0);
4708  			::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET), nppGUI._fillFindFieldWithSelected ? TRUE : FALSE);
4709  			::SendDlgItemMessage(_hSelf, IDC_CHECK_CONFIRMREPLOPENDOCS, BM_SETCHECK, nppGUI._confirmReplaceInAllOpenDocs, 0);
4710  			::SendDlgItemMessage(_hSelf, IDC_CHECK_REPLACEANDSTOP, BM_SETCHECK, nppGUI._replaceStopsWithoutFindingNext, 0);
4711  			::SendDlgItemMessage(_hSelf, IDC_CHECK_SHOWONCEPERFOUNDLINE, BM_SETCHECK, nppGUI._finderShowOnlyOneEntryPerFoundLine, 0);
4712  			return TRUE;
4713  		}
4714  		case WM_CTLCOLORDLG:
4715  		case WM_CTLCOLORSTATIC:
4716  		{
4717  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
4718  		}
4719  		case WM_PRINTCLIENT:
4720  		{
4721  			if (NppDarkMode::isEnabled())
4722  			{
4723  				return TRUE;
4724  			}
4725  			break;
4726  		}
4727  		case WM_COMMAND:
4728  		{
4729  			switch (wParam)
4730  			{
4731  				case IDC_CHECK_FILL_FIND_FIELD_WITH_SELECTED:
4732  				{
4733  					nppGUI._fillFindFieldWithSelected = isCheckedOrNot(IDC_CHECK_FILL_FIND_FIELD_WITH_SELECTED);
4734  					::EnableWindow(::GetDlgItem(_hSelf, IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET), nppGUI._fillFindFieldWithSelected ? TRUE :FALSE);
4735  					if (!nppGUI._fillFindFieldWithSelected) 
4736  					{
4737  						::SendDlgItemMessage(_hSelf, IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET, BM_SETCHECK, BST_UNCHECKED, 0);
4738  						nppGUI._fillFindFieldSelectCaret = false;
4739  					}
4740  					return TRUE;
4741  				}
4742  				break;
4743  				case IDC_CHECK_MONOSPACEDFONT_FINDDLG:
4744  				{
4745  					nppGUI._monospacedFontFindDlg = isCheckedOrNot(IDC_CHECK_MONOSPACEDFONT_FINDDLG);
4746  					return TRUE;
4747  				}
4748  				break;
4749  				case IDC_CHECK_FINDDLG_ALWAYS_VISIBLE:
4750  				{
4751  					nppGUI._findDlgAlwaysVisible = isCheckedOrNot(IDC_CHECK_FINDDLG_ALWAYS_VISIBLE);
4752  					return TRUE;
4753  				}
4754  				break;
4755  				case IDC_CHECK_CONFIRMREPLOPENDOCS:
4756  				{
4757  					nppGUI._confirmReplaceInAllOpenDocs = isCheckedOrNot(IDC_CHECK_CONFIRMREPLOPENDOCS);
4758  					return TRUE;
4759  				}
4760  				break;
4761  				case IDC_CHECK_REPLACEANDSTOP:
4762  				{
4763  					nppGUI._replaceStopsWithoutFindingNext = isCheckedOrNot(IDC_CHECK_REPLACEANDSTOP);
4764  					return TRUE;
4765  				}
4766  				break;
4767  				case IDC_CHECK_SHOWONCEPERFOUNDLINE:
4768  				{
4769  					nppGUI._finderShowOnlyOneEntryPerFoundLine = isCheckedOrNot(IDC_CHECK_SHOWONCEPERFOUNDLINE);
4770  					return TRUE;
4771  				}
4772  				break;
4773  				case IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET:
4774  				{
4775  					nppGUI._fillFindFieldSelectCaret = isCheckedOrNot(IDC_CHECK_FILL_FIND_FIELD_SELECT_CARET);
4776  					return TRUE;
4777  				}
4778  				break;
4779  				default:
4780  					return FALSE;
4781  			}
4782  		}
4783  		break;
4784  	}
4785  	return FALSE;
4786  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-preferenceDlg.cpp</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-preferenceDlg.cpp</div>
                </div>
                <div class="column column_space"><pre><code>1864  					nppGUI._muteSounds = isCheckedOrNot(IDC_CHECK_MUTE_SOUNDS);
1865  					return TRUE;
1866  				}
1867  				case IDC_CHECK_SAVEALLCONFIRM:
1868  				{
</pre></code></div>
                <div class="column column_space"><pre><code>1859  					nppGUI._isDocPeekOnMap = isCheckedOrNot(IDC_CHECK_ENABLEDOCPEEKONMAP);
1860  					return TRUE;
1861  				}
1862  				case IDC_CHECK_MUTE_SOUNDS:
1863  				{
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    