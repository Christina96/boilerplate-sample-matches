<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for testInitState.cpp & testDeadState.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for testInitState.cpp & testDeadState.cpp
      </h3>
      <h1 align="center">
        57.2%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>testInitState.cpp (70.34884%)<TH>testDeadState.cpp (48.207172%)<TH>Tokens
<TR onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"'><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match23-0.html#0',2,'match23-1.html#0',3)" NAME="0">(114-135)<TD><A HREF="javascript:ZweiFrames('match23-0.html#0',2,'match23-1.html#0',3)" NAME="0">(185-206)</A><TD ALIGN=center><FONT COLOR="#ff0000">23</FONT>
<TR onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' ><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match23-0.html#1',2,'match23-1.html#1',3)" NAME="1">(65-84)<TD><A HREF="javascript:ZweiFrames('match23-0.html#1',2,'match23-1.html#1',3)" NAME="1">(99-122)</A><TD ALIGN=center><FONT COLOR="#e80000">21</FONT>
<TR onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"'><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match23-0.html#2',2,'match23-1.html#2',3)" NAME="2">(333-364)<TD><A HREF="javascript:ZweiFrames('match23-0.html#2',2,'match23-1.html#2',3)" NAME="2">(467-495)</A><TD ALIGN=center><FONT COLOR="#dd0000">20</FONT>
<TR onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"'><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match23-0.html#3',2,'match23-1.html#3',3)" NAME="3">(95-113)<TD><A HREF="javascript:ZweiFrames('match23-0.html#3',2,'match23-1.html#3',3)" NAME="3">(138-157)</A><TD ALIGN=center><FONT COLOR="#a60000">15</FONT>
<TR onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"'><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match23-0.html#4',2,'match23-1.html#4',3)" NAME="4">(232-270)<TD><A HREF="javascript:ZweiFrames('match23-0.html#4',2,'match23-1.html#4',3)" NAME="4">(334-380)</A><TD ALIGN=center><FONT COLOR="#9b0000">14</FONT>
<TR onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"'><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match23-0.html#5',2,'match23-1.html#5',3)" NAME="5">(171-209)<TD><A HREF="javascript:ZweiFrames('match23-0.html#5',2,'match23-1.html#5',3)" NAME="5">(252-297)</A><TD ALIGN=center><FONT COLOR="#9b0000">14</FONT>
<TR onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"'><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match23-0.html#6',2,'match23-1.html#6',3)" NAME="6">(26-37)<TD><A HREF="javascript:ZweiFrames('match23-0.html#6',2,'match23-1.html#6',3)" NAME="6">(42-57)</A><TD ALIGN=center><FONT COLOR="#9b0000">14</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>testInitState.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
1 #include &quot;gtest/gtest.h&quot;
2 #include &lt;string&gt;
3 #include &lt;vector&gt;
4 #include &quot;StateMachine.hpp&quot;
5 #include &quot;StateMachineBuilder.hpp&quot;
6 #include &quot;SDLUtils.hpp&quot;
7 #include &quot;InitState.hpp&quot;
8 #include &quot;MockNetworkManager.hpp&quot;
9 #include &quot;MockImageManager.hpp&quot;
10 #include &quot;MockInputManager.hpp&quot;
11 #include &quot;MentalMap.hpp&quot;
12 #include &quot;MockRobotManager.hpp&quot;
13 #include &quot;MockAudioManager.hpp&quot;
14 #include &quot;SDLScreenManager.hpp&quot;
15 #include &lt;yarp/os/Network.h&gt;
16 <A NAME="6"></A>#include &lt;yarp/os/Time.h&gt;
17 namespace rd
18 <FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match23-1.html#6',3,'match23-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
19 namespace test
20 {
21 class InitStateTestEnvironment : public testing::Environment
22 {
23     public:
24         InitStateTestEnvironment(int argc, char ** argv)
25         {
26             this-&gt;argc = argc;
27             this-&gt;argv = argv;</B></FONT>
28         }
29         virtual void SetUp()
30         {
31             initSDL();
32         }
33         virtual void TearDown()
34         {
35             cleanupSDL();
36         }
37     private:
38         int argc;
39         char ** argv;
40 };
41 class InitStateTest : public testing::Test
42 {
43     public:
44 <A NAME="1"></A>        virtual void SetUp()
45         {
46 <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match23-1.html#1',3,'match23-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>            yarp::os::NetworkBase::setLocalMode(true);
47             yarp::os::Network::init();
48             MockNetworkManager::RegisterManager();
49             MockImageManager::RegisterManager();
50             MockInputManager::RegisterManager();
51             MockAudioManager::RegisterManager();
52             SDLScreenManager::RegisterManager();
53             networkManager = NetworkManager::getNetworkManager(&quot;MOCK&quot;);
54             mockNetworkManager = dynamic_cast&lt;MockNetworkManager *&gt;(networkManager);
55             ASSERT_NE((NetworkManager*) NULL, networkManager);
56             ASSERT_NE((MockNetworkManager*) NULL, mockNetworkManager);
57             imageManager = ImageManager::getImageManager(&quot;MOCK&quot;);
58             mockImageManager = dynamic_cast&lt;MockImageManager *&gt;(imageManager);
59             ASSERT_NE((ImageManager*) NULL, imageManager);
60             ASSERT_NE((MockImageManager*) NULL, mockImageManager);</B></FONT>
61             inputManager = InputManager::getInputManager(&quot;MOCK&quot;);
62             mockInputManager = dynamic_cast&lt;MockInputManager *&gt;(inputManager);
63             ASSERT_NE((InputManager*) NULL, inputManager);
64             ASSERT_NE((MockInputManager*) NULL, mockInputManager);
65             audioManager = AudioManager::getAudioManager(&quot;MOCK&quot;);
66 <A NAME="3"></A>            mockAudioManager = dynamic_cast&lt;MockAudioManager *&gt;(audioManager);
67             ASSERT_NE((AudioManager*) NULL, audioManager);
68             ASSERT_NE((MockAudioManager*) NULL, mockAudioManager);
69 <FONT color="#53858b"><A HREF="javascript:ZweiFrames('match23-1.html#3',3,'match23-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>            mockAudioManager-&gt;load(&quot;RD_THEME&quot;,&quot;RD_THEME&quot;, AudioManager::MUSIC);
70             mentalMap = MentalMap::getMentalMap();
71             ASSERT_NE((MentalMap*) NULL, mentalMap);
72             ASSERT_TRUE(mentalMap-&gt;configure(1));
73             std::vector&lt;Player&gt; players;
74             players.push_back(Player(1,&quot;test_player&quot;,100,100,0,0) );
75             ASSERT_TRUE(mentalMap-&gt;updatePlayers(players));
76             mentalMap-&gt;addWeapon(Weapon(&quot;Default gun&quot;, 10, 5));
77             networkManager-&gt;configure(&quot;player&quot;, players[0]);
78             mockRobotManager = new MockRobotManager(&quot;MOCK&quot;);
79             robotManager = (asrob::IRobotManager *) mockRobotManager;
80             ASSERT_NE((MockRobotManager*) NULL, mockRobotManager);
81             ASSERT_NE((asrob::IRobotManager*) NULL, robotManager);
82 <A NAME="0"></A>
83             screenManager = ScreenManager::getScreenManager(&quot;SDL&quot;);
84             ASSERT_NE((ScreenManager*) NULL, screenManager);</B></FONT>
85 <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match23-1.html#0',3,'match23-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>        }
86         virtual void TearDown()
87         {
88             yarp::os::Network::fini();
89             NetworkManager::destroyNetworkManager();
90             networkManager = NULL;
91             mockNetworkManager = NULL;
92             ImageManager::destroyImageManager();
93             imageManager = NULL;
94             mockImageManager = NULL;
95             InputManager::destroyInputManager();
96             AudioManager::destroyAudioManager();
97             MentalMap::destroyMentalMap();
98             delete mockRobotManager;
99             mockRobotManager = NULL;</B></FONT>
100             ScreenManager::destroyScreenManager();
101         }
102     protected:
103         FiniteStateMachine *fsm;
104         NetworkManager * networkManager;
105         MockNetworkManager * mockNetworkManager;
106         ImageManager * imageManager;
107         MockImageManager * mockImageManager;
108         InputManager * inputManager;
109         MockInputManager * mockInputManager;
110         AudioManager * audioManager;
111         MockAudioManager * mockAudioManager;
112         MentalMap * mentalMap;
113         MockRobotManager * mockRobotManager;
114         asrob::IRobotManager * robotManager;
115         ScreenManager * screenManager;
116 };
117 TEST_F(InitStateTest, InitStateGoesToLogin)
118 {
119 <A NAME="5"></A>    StateMachineBuilder builder;
120     ASSERT_TRUE(builder.setDirectorType(&quot;YARP&quot;));
121 <FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match23-1.html#5',3,'match23-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    int init_state_id = builder.addState(new InitState(networkManager, imageManager, inputManager, mentalMap,
122                                                        robotManager, audioManager, screenManager));
123     int end_state_id = builder.addState(State::getEndState());
124     ASSERT_NE(-1, init_state_id);
125     ASSERT_TRUE(builder.addTransition(init_state_id, end_state_id, InitState::LOGIN_SUCCESSFUL));
126     ASSERT_TRUE(builder.addTransition(init_state_id, end_state_id, InitState::EXIT_REQUESTED));
127     ASSERT_TRUE(builder.setInitialState(init_state_id));
128     fsm = builder.buildStateMachine();
129     ASSERT_NE((FiniteStateMachine*)NULL, fsm);
130     ASSERT_TRUE(mockAudioManager-&gt;isStopped());
131     ASSERT_TRUE(mockNetworkManager-&gt;isStopped());
132     ASSERT_TRUE(mockImageManager-&gt;isStopped());
133     ASSERT_TRUE(mockInputManager-&gt;isStopped());
134     ASSERT_TRUE(fsm-&gt;start());
135     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
136     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
137     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
138     ASSERT_FALSE(mockNetworkManager-&gt;isLoggedIn());
139     ASSERT_TRUE(mockImageManager-&gt;isStopped());
140     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
141     ASSERT_FALSE(mockInputManager-&gt;isStopped());
142     ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
143     mockInputManager-&gt;sendKeyPress(Key::KEY_ENTER);
144     yarp::os::Time::delay(0.5);</B></FONT>
145     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
146     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
147     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
148     ASSERT_TRUE(mockNetworkManager-&gt;isLoggedIn());
149     ASSERT_FALSE(mockImageManager-&gt;isStopped());
150     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
151     ASSERT_FALSE(mockInputManager-&gt;isStopped());
152     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners());
153 }
154 TEST_F(InitStateTest, InitStateGoesToExitKeyPress)
155 {
156 <A NAME="4"></A>    StateMachineBuilder builder;
157     ASSERT_TRUE(builder.setDirectorType(&quot;YARP&quot;));
158 <FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match23-1.html#4',3,'match23-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    int init_state_id = builder.addState(new InitState(networkManager, imageManager, inputManager, mentalMap,
159                                                        robotManager, audioManager, screenManager));
160     int end_state_id = builder.addState(State::getEndState());
161     ASSERT_NE(-1, init_state_id);
162     ASSERT_TRUE(builder.addTransition(init_state_id, end_state_id, InitState::LOGIN_SUCCESSFUL));
163     ASSERT_TRUE(builder.addTransition(init_state_id, end_state_id, InitState::EXIT_REQUESTED));
164     ASSERT_TRUE(builder.setInitialState(init_state_id));
165     fsm = builder.buildStateMachine();
166     ASSERT_NE((FiniteStateMachine*)NULL, fsm);
167     ASSERT_TRUE(mockAudioManager-&gt;isStopped());
168     ASSERT_TRUE(mockNetworkManager-&gt;isStopped());
169     ASSERT_TRUE(mockImageManager-&gt;isStopped());
170     ASSERT_TRUE(mockInputManager-&gt;isStopped());
171     ASSERT_TRUE(fsm-&gt;start());
172     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
173     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
174     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
175     ASSERT_FALSE(mockNetworkManager-&gt;isLoggedIn());
176     ASSERT_TRUE(mockImageManager-&gt;isStopped());
177     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
178     ASSERT_FALSE(mockInputManager-&gt;isStopped());
179     ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
180     mockInputManager-&gt;sendKeyPress(Key::KEY_ESCAPE);
181     yarp::os::Time::delay(0.5);</B></FONT>
182     ASSERT_TRUE(mockImageManager-&gt;isStopped());
183     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
184     ASSERT_TRUE(mockInputManager-&gt;isStopped());
185     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners());
186     ASSERT_TRUE(mockAudioManager-&gt;isStopped());
187     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
188     ASSERT_TRUE(mockNetworkManager-&gt;isStopped());
189     ASSERT_FALSE(mockNetworkManager-&gt;isLoggedIn());
190     ASSERT_EQ(-1, fsm-&gt;getCurrentState()); //-- (When FSM is ended, no state is active, hence -1)
191 }
192 TEST_F(InitStateTest, InitStateGoesToExitWindowEvent)
193 {
194     StateMachineBuilder builder;
195     ASSERT_TRUE(builder.setDirectorType(&quot;YARP&quot;));
196     int init_state_id = builder.addState(new InitState(networkManager, imageManager, inputManager, mentalMap,
197                                                        robotManager, audioManager, screenManager));
198     int end_state_id = builder.addState(State::getEndState());
199     ASSERT_NE(-1, init_state_id);
200     ASSERT_TRUE(builder.addTransition(init_state_id, end_state_id, InitState::LOGIN_SUCCESSFUL));
201     ASSERT_TRUE(builder.addTransition(init_state_id, end_state_id, InitState::EXIT_REQUESTED));
202     ASSERT_TRUE(builder.setInitialState(init_state_id));
203     fsm = builder.buildStateMachine();
204     ASSERT_NE((FiniteStateMachine*)NULL, fsm);
205     ASSERT_TRUE(mockAudioManager-&gt;isStopped());
206     ASSERT_TRUE(mockNetworkManager-&gt;isStopped());
207     ASSERT_TRUE(mockImageManager-&gt;isStopped());
208     ASSERT_TRUE(mockInputManager-&gt;isStopped());
209     ASSERT_TRUE(fsm-&gt;start());
210     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
211     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
212     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
213     ASSERT_FALSE(mockNetworkManager-&gt;isLoggedIn());
214     ASSERT_TRUE(mockImageManager-&gt;isStopped());
215     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
216     ASSERT_FALSE(mockInputManager-&gt;isStopped());
217 <A NAME="2"></A>    ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
218 <FONT color="#980517"><A HREF="javascript:ZweiFrames('match23-1.html#2',3,'match23-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    mockInputManager-&gt;sendWindowEvent(WindowEvent::WINDOW_CLOSE);
219     yarp::os::Time::delay(0.5);
220     ASSERT_TRUE(mockImageManager-&gt;isStopped());
221     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
222     ASSERT_TRUE(mockInputManager-&gt;isStopped());
223     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners());
224     ASSERT_TRUE(mockAudioManager-&gt;isStopped());
225     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
226     ASSERT_TRUE(mockNetworkManager-&gt;isStopped());
227     ASSERT_FALSE(mockNetworkManager-&gt;isLoggedIn());
228     ASSERT_EQ(-1, fsm-&gt;getCurrentState()); //-- (When FSM is ended, no state is active, hence -1)
229 }
230 }  
231 }  
232 int main(int argc, char **argv)
233 {
234   testing::InitGoogleTest(&amp;argc, argv);
235   testing::Environment* env = testing::AddGlobalTestEnvironment(new rd::test::InitStateTestEnvironment(argc, argv));
236   return RUN_ALL_TESTS();
237 }</B></FONT>
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>testDeadState.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
1 #include &quot;gtest/gtest.h&quot;
2 #include &lt;string&gt;
3 #include &lt;vector&gt;
4 #include &lt;yarp/sig/all.h&gt;
5 #include &lt;yarp/os/Network.h&gt;
6 #include &lt;yarp/os/Time.h&gt;
7 #include &lt;yarp/os/ResourceFinder.h&gt;
8 #include &quot;StateMachine.hpp&quot;
9 #include &quot;StateMachineBuilder.hpp&quot;
10 #include &quot;SDLUtils.hpp&quot;
11 #include &quot;DeadState.hpp&quot;
12 #include &quot;InitState.hpp&quot;
13 #include &quot;MockState.hpp&quot;
14 #include &quot;MockNetworkManager.hpp&quot;
15 #include &quot;MockImageManager.hpp&quot;
16 #include &quot;MockInputEventListener.hpp&quot;
17 #include &quot;MockInputManager.hpp&quot;
18 #include &quot;MentalMap.hpp&quot;
19 #include &quot;MockRobotManager.hpp&quot;
20 #include &quot;MockAudioManager.hpp&quot;
21 <A NAME="6"></A>#include &quot;SDLScreenManager.hpp&quot;
22 namespace rd
23 <FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match23-0.html#6',2,'match23-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{
24 namespace test
25 {
26 class DeadStateTestEnvironment : public testing::Environment
27 {
28     public:
29         DeadStateTestEnvironment(int argc, char ** argv)
30         {
31             this-&gt;argc = argc;
32             this-&gt;argv = argv;</B></FONT>
33             screenManager = NULL;
34         }
35         virtual void SetUp()
36         {
37             yarp::os::NetworkBase::setLocalMode(true);
38             yarp::os::Network::init();
39             SDLScreenManager::RegisterManager();
40             screenManager = ScreenManager::getScreenManager(&quot;SDL&quot;);
41             ASSERT_NE((ScreenManager*) NULL, screenManager);
42             screenManager-&gt;start();
43         }
44         virtual void TearDown()
45         {
46             yarp::os::Network::fini();
47             screenManager-&gt;stop();
48             ScreenManager::destroyScreenManager();
49         }
50     private:
51         int argc;
52         char ** argv;
53     protected:
54         ScreenManager * screenManager;
55 };
56 class DeadStateTest : public testing::Test
57 {
58     public:
59 <A NAME="1"></A>        virtual void SetUp()
60         {
61 <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match23-0.html#1',2,'match23-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>            yarp::os::ResourceFinder rf;
62             rf.setDefaultContext(&quot;robotDevastation&quot;);
63             rf.setDefaultConfigFile(&quot;robotDevastation.ini&quot;);
64             yarp::os::NetworkBase::setLocalMode(true);
65             yarp::os::Network::init();
66             MockNetworkManager::RegisterManager();
67             MockImageManager::RegisterManager();
68             MockInputManager::RegisterManager();
69             MockAudioManager::RegisterManager();
70             networkManager = NetworkManager::getNetworkManager(&quot;MOCK&quot;);
71             mockNetworkManager = dynamic_cast&lt;MockNetworkManager *&gt;(networkManager);
72             ASSERT_NE((NetworkManager*) NULL, networkManager);
73             ASSERT_NE((MockNetworkManager*) NULL, mockNetworkManager);
74             imageManager = ImageManager::getImageManager(&quot;MOCK&quot;);
75             mockImageManager = dynamic_cast&lt;MockImageManager *&gt;(imageManager);
76             ASSERT_NE((ImageManager*) NULL, imageManager);
77             ASSERT_NE((MockImageManager*) NULL, mockImageManager);</B></FONT>
78             Image test_frame;
79             yarp::sig::file::read(test_frame, rf.findFileByName(&quot;../images/test_frame_qr.ppm&quot;));
80             mockImageManager-&gt;receiveImage(test_frame);
81             inputManager = InputManager::getInputManager(&quot;MOCK&quot;);
82             mockInputManager = dynamic_cast&lt;MockInputManager *&gt;(inputManager);
83             ASSERT_NE((InputManager*) NULL, inputManager);
84             ASSERT_NE((MockInputManager*) NULL, mockInputManager);
85             audioManager = AudioManager::getAudioManager(&quot;MOCK&quot;);
86             mockAudioManager = dynamic_cast&lt;MockAudioManager *&gt;(audioManager);
87 <A NAME="3"></A>            ASSERT_NE((AudioManager*) NULL, audioManager);
88             ASSERT_NE((MockAudioManager*) NULL, mockAudioManager);
89             mockAudioManager-&gt;load(&quot;RD_THEME&quot;,&quot;RD_THEME&quot;, AudioManager::MUSIC);
90 <FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match23-0.html#3',2,'match23-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>            mockAudioManager-&gt;load(&quot;RD_DEAD&quot;,&quot;RD_DEAD&quot;, AudioManager::MUSIC);
91             mentalMap = MentalMap::getMentalMap();
92             ASSERT_NE((MentalMap*) NULL, mentalMap);
93             ASSERT_TRUE(mentalMap-&gt;configure(1));
94             std::vector&lt;Player&gt; players;
95             players.push_back(Player(1,&quot;test_player&quot;, 0,MAX_HEALTH,0,0) );
96             ASSERT_TRUE(mentalMap-&gt;updatePlayers(players));
97             mentalMap-&gt;addWeapon(Weapon(&quot;Default gun&quot;, 10, 5));
98             networkManager-&gt;configure(&quot;player&quot;, players[0]);
99             mockRobotManager = new MockRobotManager(&quot;MOCK&quot;);
100             robotManager = (asrob::IRobotManager *) mockRobotManager;
101             ASSERT_NE((MockRobotManager*) NULL, mockRobotManager);
102             ASSERT_NE((asrob::IRobotManager*) NULL, robotManager);
103             screenManager = ScreenManager::getScreenManager(&quot;SDL&quot;);
104             ASSERT_NE((ScreenManager*) NULL, screenManager);</B></FONT>
105             State * initState = new InitState(networkManager, imageManager, inputManager,
106                                               mentalMap, robotManager, audioManager,
107                                               screenManager);
108             initState-&gt;setup();
109             dynamic_cast&lt;InputEventListener *&gt;(initState)-&gt;onKeyUp(Key::KEY_ENTER);
110             initState-&gt;loop();
111             initState-&gt;cleanup();
112             delete initState;
113             initState = NULL;
114             mockImageManager-&gt;start();
115             listener = new MockInputEventListener;
116             mockInputManager-&gt;addInputEventListener(listener);
117             audioManager-&gt;start();
118 <A NAME="0"></A>            audioManager-&gt;play(&quot;RD_THEME&quot;, -1);
119             mockImageManager-&gt;setEnabled(true);
120 <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match23-0.html#0',2,'match23-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>        }
121         virtual void TearDown()
122         {
123             yarp::os::Network::fini();
124             NetworkManager::destroyNetworkManager();
125             networkManager = NULL;
126             mockNetworkManager = NULL;
127             ImageManager::destroyImageManager();
128             imageManager = NULL;
129             mockImageManager = NULL;
130             InputManager::destroyInputManager();
131             AudioManager::destroyAudioManager();
132             MentalMap::destroyMentalMap();
133             delete mockRobotManager;
134             mockRobotManager = NULL;</B></FONT>
135             delete listener;
136             listener=NULL;
137         }
138     static const int MAX_HEALTH;
139     protected:
140         FiniteStateMachine *fsm;
141         NetworkManager * networkManager;
142         MockNetworkManager * mockNetworkManager;
143         ImageManager * imageManager;
144         MockImageManager * mockImageManager;
145         InputManager * inputManager;
146         MockInputManager * mockInputManager;
147         AudioManager * audioManager;
148         MockAudioManager * mockAudioManager;
149         MentalMap * mentalMap;
150         MockRobotManager * mockRobotManager;
151         asrob::IRobotManager * robotManager;
152         ScreenManager * screenManager;
153         MockInputEventListener * listener;
154 };
155 const int DeadStateTest::MAX_HEALTH = 100;
156 TEST_F(DeadStateTest, DeadStateGoesToRespawn)
157 {
158     StateMachineBuilder builder;
159     ASSERT_TRUE(builder.setDirectorType(&quot;YARP&quot;));
160 <A NAME="5"></A>    int dead_state_id = builder.addState(new DeadState(networkManager, imageManager, inputManager,
161                                                        mentalMap, robotManager, audioManager, screenManager));
162     ASSERT_NE(-1, dead_state_id);
163 <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match23-0.html#5',2,'match23-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    int game_state_id = builder.addState(new MockState(1));
164     ASSERT_NE(-1, game_state_id);
165     int exit_state_id = builder.addState(State::getEndState());
166     ASSERT_TRUE(builder.addTransition(dead_state_id, game_state_id, DeadState::RESPAWN_SELECTED));
167     ASSERT_TRUE(builder.addTransition(dead_state_id, exit_state_id, DeadState::EXIT_SELECTED));
168     ASSERT_TRUE(builder.setInitialState(dead_state_id));
169     fsm = builder.buildStateMachine();
170     ASSERT_NE((FiniteStateMachine*)NULL, fsm);
171     ASSERT_EQ(0, mentalMap-&gt;getMyself().getHealth()); //-- Important thing to check
172     ASSERT_FALSE(mockImageManager-&gt;isStopped());
173     ASSERT_TRUE(mockImageManager-&gt;isEnabled());
174     ASSERT_FALSE(mockInputManager-&gt;isStopped());
175     ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
176     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
177     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
178     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
179     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
180     ASSERT_TRUE(mockNetworkManager-&gt;isLoggedIn());
181     ASSERT_TRUE(fsm-&gt;start());
182     ASSERT_EQ(0, mentalMap-&gt;getMyself().getHealth()); //-- Important thing to check
183     ASSERT_FALSE(mockImageManager-&gt;isStopped());
184     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
185     ASSERT_FALSE(mockInputManager-&gt;isStopped());
186     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners());
187     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
188     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
189     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
190     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
191     ASSERT_TRUE(mockNetworkManager-&gt;isLoggedIn());
192     ASSERT_EQ(dead_state_id, fsm-&gt;getCurrentState());
193     yarp::os::Time::delay(0.5);
194     mockInputManager-&gt;sendKeyPress(Key::KEY_ENTER);</B></FONT>
195     yarp::os::Time::delay(0.5);
196     ASSERT_EQ(dead_state_id, fsm-&gt;getCurrentState());
197     yarp::os::Time::delay(10);
198     ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
199     mockInputManager-&gt;sendKeyPress(Key::KEY_ENTER);
200     yarp::os::Time::delay(0.5);
201     ASSERT_EQ(DeadStateTest::MAX_HEALTH, mentalMap-&gt;getMyself().getHealth());
202     ASSERT_FALSE(mockImageManager-&gt;isStopped());
203     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
204     ASSERT_FALSE(mockInputManager-&gt;isStopped());
205     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners()); //-- Game sets its own listener
206     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
207     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
208     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
209     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
210     ASSERT_TRUE(mockNetworkManager-&gt;isLoggedIn());
211     ASSERT_EQ(game_state_id, fsm-&gt;getCurrentState());
212 }
213 TEST_F(DeadStateTest, DeadStateGoesToLogoutKeyPress)
214 {
215     StateMachineBuilder builder;
216     ASSERT_TRUE(builder.setDirectorType(&quot;YARP&quot;));
217 <A NAME="4"></A>    int dead_state_id = builder.addState(new DeadState(networkManager, imageManager, inputManager,
218                                                        mentalMap, robotManager, audioManager, screenManager));
219     ASSERT_NE(-1, dead_state_id);
220 <FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match23-0.html#4',2,'match23-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    int game_state_id = builder.addState(new MockState(1));
221     ASSERT_NE(-1, game_state_id);
222     int exit_state_id = builder.addState(State::getEndState());
223     ASSERT_NE(-1, exit_state_id);
224     ASSERT_TRUE(builder.addTransition(dead_state_id, game_state_id, DeadState::RESPAWN_SELECTED));
225     ASSERT_TRUE(builder.addTransition(dead_state_id, exit_state_id, DeadState::EXIT_SELECTED));
226     ASSERT_TRUE(builder.setInitialState(dead_state_id));
227     fsm = builder.buildStateMachine();
228     ASSERT_NE((FiniteStateMachine*)NULL, fsm);
229     ASSERT_EQ(0, mentalMap-&gt;getMyself().getHealth()); //-- Important thing to check
230     ASSERT_FALSE(mockImageManager-&gt;isStopped());
231     ASSERT_TRUE(mockImageManager-&gt;isEnabled());
232     ASSERT_FALSE(mockInputManager-&gt;isStopped());
233     ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
234     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
235     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
236     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
237     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
238     ASSERT_TRUE(mockNetworkManager-&gt;isLoggedIn());
239     ASSERT_TRUE(fsm-&gt;start());
240     ASSERT_EQ(0, mentalMap-&gt;getMyself().getHealth()); //-- Important thing to check
241     ASSERT_FALSE(mockImageManager-&gt;isStopped());
242     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
243     ASSERT_FALSE(mockInputManager-&gt;isStopped());
244     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners());
245     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
246     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
247     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
248     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
249     ASSERT_TRUE(mockNetworkManager-&gt;isLoggedIn());
250     ASSERT_EQ(dead_state_id, fsm-&gt;getCurrentState());
251     yarp::os::Time::delay(0.5);
252     mockInputManager-&gt;sendKeyPress(Key::KEY_ENTER);</B></FONT>
253     yarp::os::Time::delay(0.5);
254     ASSERT_EQ(dead_state_id, fsm-&gt;getCurrentState());
255     yarp::os::Time::delay(10);
256     ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
257     mockInputManager-&gt;sendKeyPress(Key::KEY_ESCAPE);
258     yarp::os::Time::delay(0.5);
259     ASSERT_TRUE(mockImageManager-&gt;isStopped());
260     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
261     ASSERT_TRUE(mockInputManager-&gt;isStopped());
262     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners());
263     ASSERT_TRUE(mockAudioManager-&gt;isStopped());
264     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
265     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
266     ASSERT_TRUE(mockNetworkManager-&gt;isStopped());
267     ASSERT_FALSE(mockNetworkManager-&gt;isLoggedIn());
268     ASSERT_EQ(-1, fsm-&gt;getCurrentState()); //-- (When FSM is ended, no state is active, hence -1)
269 }
270 TEST_F(DeadStateTest, DeadStateGoesToLogoutWindowEvent)
271 {
272     StateMachineBuilder builder;
273     ASSERT_TRUE(builder.setDirectorType(&quot;YARP&quot;));
274     int dead_state_id = builder.addState(new DeadState(networkManager, imageManager, inputManager,
275                                                        mentalMap, robotManager, audioManager, screenManager));
276     ASSERT_NE(-1, dead_state_id);
277     int game_state_id = builder.addState(new MockState(1));
278     ASSERT_NE(-1, game_state_id);
279     int exit_state_id = builder.addState(State::getEndState());
280     ASSERT_NE(-1, exit_state_id);
281     ASSERT_TRUE(builder.addTransition(dead_state_id, game_state_id, DeadState::RESPAWN_SELECTED));
282     ASSERT_TRUE(builder.addTransition(dead_state_id, exit_state_id, DeadState::EXIT_SELECTED));
283     ASSERT_TRUE(builder.setInitialState(dead_state_id));
284     fsm = builder.buildStateMachine();
285     ASSERT_NE((FiniteStateMachine*)NULL, fsm);
286     ASSERT_EQ(0, mentalMap-&gt;getMyself().getHealth()); //-- Important thing to check
287     ASSERT_FALSE(mockImageManager-&gt;isStopped());
288     ASSERT_TRUE(mockImageManager-&gt;isEnabled());
289     ASSERT_FALSE(mockInputManager-&gt;isStopped());
290     ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
291     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
292     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
293     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
294     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
295     ASSERT_TRUE(mockNetworkManager-&gt;isLoggedIn());
296     ASSERT_TRUE(fsm-&gt;start());
297     ASSERT_EQ(0, mentalMap-&gt;getMyself().getHealth()); //-- Important thing to check
298     ASSERT_FALSE(mockImageManager-&gt;isStopped());
299     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
300     ASSERT_FALSE(mockInputManager-&gt;isStopped());
301     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners());
302     ASSERT_FALSE(mockAudioManager-&gt;isStopped());
303     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
304     ASSERT_TRUE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
305     ASSERT_FALSE(mockNetworkManager-&gt;isStopped());
306     ASSERT_TRUE(mockNetworkManager-&gt;isLoggedIn());
307     ASSERT_EQ(dead_state_id, fsm-&gt;getCurrentState());
308     yarp::os::Time::delay(0.5);
309     mockInputManager-&gt;sendKeyPress(Key::KEY_ENTER);
310     yarp::os::Time::delay(0.5);
311     ASSERT_EQ(dead_state_id, fsm-&gt;getCurrentState());
312 <A NAME="2"></A>    //-- When time is up, and the window is closed, the system should exit the game:
313     yarp::os::Time::delay(10);
314     ASSERT_EQ(1, mockInputManager-&gt;getNumListeners());
315 <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match23-0.html#2',2,'match23-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    mockInputManager-&gt;sendWindowEvent(WindowEvent::WINDOW_CLOSE);
316     yarp::os::Time::delay(0.5);
317     ASSERT_TRUE(mockImageManager-&gt;isStopped());
318     ASSERT_FALSE(mockImageManager-&gt;isEnabled());
319     ASSERT_TRUE(mockInputManager-&gt;isStopped());
320     ASSERT_EQ(0, mockInputManager-&gt;getNumListeners());
321     ASSERT_TRUE(mockAudioManager-&gt;isStopped());
322     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_THEME&quot;));
323     ASSERT_FALSE(mockAudioManager-&gt;isPlaying(&quot;RD_DEAD&quot;));
324     ASSERT_TRUE(mockNetworkManager-&gt;isStopped());
325     ASSERT_FALSE(mockNetworkManager-&gt;isLoggedIn());
326     ASSERT_EQ(-1, fsm-&gt;getCurrentState()); //-- (When FSM is ended, no state is active, hence -1)
327 }
328 }  
329 }  
330 int main(int argc, char **argv)
331 {
332   testing::InitGoogleTest(&amp;argc, argv);
333   testing::Environment* env = testing::AddGlobalTestEnvironment(new rd::test::DeadStateTestEnvironment(argc, argv));
334   return RUN_ALL_TESTS();
335 }</B></FONT>
</PRE>
</div>
  </div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
