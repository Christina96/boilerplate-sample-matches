<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for name_remapping_with_ns.cpp & create_and_iterate_bag.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for name_remapping_with_ns.cpp & create_and_iterate_bag.cpp
      </h3>
      <h1 align="center">
        19.2%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>name_remapping_with_ns.cpp (45.238094%)<TH>create_and_iterate_bag.cpp (12.258064%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match183-0.html#0',2,'match183-1.html#0',3)" NAME="0">(50-62)<TD><A HREF="javascript:ZweiFrames('match183-0.html#0',2,'match183-1.html#0',3)" NAME="0">(35-43)</A><TD ALIGN=center><FONT COLOR="#ff0000">19</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>name_remapping_with_ns.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (c) 2008, Willow Garage, Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Willow Garage, Inc. nor the names of its
 *       contributors may be used to endorse or promote products derived from
 *       this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */

/* Author: Josh Faust */

/*
 * Test name remapping.  Assumes the parameter &quot;test&quot; is remapped to &quot;test_remap&quot;, and the node name is remapped to &quot;name_remapped&quot;
 */

#include &lt;string&gt;
#include &lt;sstream&gt;
#include &lt;fstream&gt;

#include &lt;gtest/gtest.h&gt;

#include &lt;time.h&gt;
#include &lt;stdlib.h&gt;

#include &quot;ros/ros.h&quot;
#include &lt;ros/param.h&gt;
<A NAME="0"></A>#include &lt;ros/names.h&gt;

TEST(roscpp, parameterRemapping)
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match183-1.html#0',3,'match183-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
  std::string param;
  ASSERT_STREQ(ros::names::resolve(&quot;test_full&quot;).c_str(), &quot;/b/test_full&quot;);
  ASSERT_TRUE(ros::param::get(&quot;test_full&quot;, param));
  ASSERT_STREQ(ros::names::resolve(&quot;/a/test_full&quot;).c_str(), &quot;/b/test_full&quot;);
  ASSERT_TRUE(ros::param::get(&quot;/a/test_full&quot;, param));

  ASSERT_STREQ(ros::names::resolve(&quot;test_local&quot;).c_str(), &quot;/a/test_local2&quot;);
  ASSERT_TRUE(ros::param::get(&quot;test_local&quot;, param));
  ASSERT_STREQ(ros::names::resolve(&quot;/a/test_local&quot;).c_str(), &quot;/a/test_local2&quot;);
  ASSERT_TRUE(ros::param::get(&quot;/a/test_local&quot;, param));

  ASSERT_STREQ(ros::names::resolve(&quot;test_relative&quot;).c_str(), &quot;/b/test_relative&quot;);</B></FONT>
  ASSERT_TRUE(ros::param::get(&quot;test_relative&quot;, param));
  ASSERT_STREQ(ros::names::resolve(&quot;/a/test_relative&quot;).c_str(), &quot;/b/test_relative&quot;);
  ASSERT_TRUE(ros::param::get(&quot;/a/test_relative&quot;, param));
}

TEST(roscpp, nodeNameRemapping)
{
  std::string node_name = ros::this_node::getName();
  ASSERT_STREQ(node_name.c_str(), &quot;/a/name_remapped_with_ns&quot;);
}
int
main(int argc, char** argv)
{
  testing::InitGoogleTest(&amp;argc, argv);
  ros::init( argc, argv, &quot;name_remapping_with_ns&quot; );
  ros::NodeHandle nh;

  return RUN_ALL_TESTS();
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>create_and_iterate_bag.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
#include &quot;ros/time.h&quot;
#include &quot;rosbag/bag.h&quot;
#include &quot;rosbag/view.h&quot;
#include &quot;std_msgs/Int8.h&quot;
#include &quot;std_msgs/UInt16.h&quot;
#include &quot;std_msgs/Int32.h&quot;
#include &quot;std_msgs/UInt64.h&quot;
#include &quot;std_msgs/String.h&quot;

#include &lt;string&gt;
#include &lt;vector&gt;

#include &quot;boost/foreach.hpp&quot;
#include &lt;gtest/gtest.h&gt;

template&lt;typename T&gt;
T make_std_msg(const typename T::_data_type&amp; data) {
  T msg;
  msg.data = data;
  return msg;
}

void create_test_bag(const std::string &amp;filename)
{
  rosbag::Bag bag;
  bag.open(filename, rosbag::bagmode::Write);

  bag.write(&quot;chatter&quot;, ros::Time::now(), make_std_msg&lt;std_msgs::String&gt;(&quot;foo&quot;));
  bag.write(&quot;numbers&quot;, ros::Time::now(), make_std_msg&lt;std_msgs::Int32&gt;(42));

  bag.close();
<A NAME="0"></A>}

void create_a_different_test_bag(const std::string &amp;filename)
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match183-0.html#0',2,'match183-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{
  rosbag::Bag bag;
  bag.open(filename, rosbag::bagmode::Write);

  bag.write(&quot;a&quot;, ros::Time::now(), make_std_msg&lt;std_msgs::String&gt;(&quot;Hello World!&quot;));
  bag.write(&quot;b&quot;, ros::Time::now(), make_std_msg&lt;std_msgs::Int8&gt;(1));
  bag.write(&quot;c&quot;, ros::Time::now(), make_std_msg&lt;std_msgs::UInt16&gt;(2));
  bag.write(&quot;d&quot;, ros::Time::now(), make_std_msg&lt;std_msgs::Int32&gt;(3));
  bag.write(&quot;e&quot;, ros::Time::now(), make_std_msg&lt;std_msgs::UInt64&gt;(4));</B></FONT>

  bag.close();
}

const char* bag_filename = &quot;/tmp/rosbag_storage_create_and_iterate_bag.bag&quot;;
const char* bag_filename2 = &quot;/tmp/rosbag_storage_create_and_iterate_bag2.bag&quot;;

TEST(rosbag_storage, iterator_copy_constructor)
{
  // copy ctor
  rosbag::Bag bag;
  bag.open(bag_filename, rosbag::bagmode::Read);
  rosbag::View view(bag, rosbag::TopicQuery(&quot;numbers&quot;));
  rosbag::View::const_iterator it0 = view.begin();
  EXPECT_EQ(42, it0-&gt;instantiate&lt;std_msgs::Int32&gt;()-&gt;data);
  rosbag::View::const_iterator it1(it0);
  EXPECT_EQ(it0, it1);
  EXPECT_EQ(42, it1-&gt;instantiate&lt;std_msgs::Int32&gt;()-&gt;data);
  ++it1;
  EXPECT_NE(it0, it1);
  EXPECT_EQ(42, it0-&gt;instantiate&lt;std_msgs::Int32&gt;()-&gt;data);
}

TEST(rosbag_storage, iterator_copy_assignment)
{
  // copy assignment
  rosbag::Bag bag;
  bag.open(bag_filename, rosbag::bagmode::Read);
  rosbag::View view(bag, rosbag::TopicQuery(&quot;numbers&quot;));
  rosbag::View::const_iterator it0 = view.begin();
  EXPECT_EQ(42, it0-&gt;instantiate&lt;std_msgs::Int32&gt;()-&gt;data);
  rosbag::View::const_iterator it1;
  it1 = it0;
  EXPECT_EQ(it0, it1);
  EXPECT_EQ(42, it1-&gt;instantiate&lt;std_msgs::Int32&gt;()-&gt;data);
  ++it1;
  EXPECT_NE(it0, it1);
  EXPECT_EQ(42, it0-&gt;instantiate&lt;std_msgs::Int32&gt;()-&gt;data);
}

TEST(rosbag_storage, iterate_bag)
{
  rosbag::Bag bag;
  bag.open(bag_filename, rosbag::bagmode::Read);

  std::vector&lt;std::string&gt; topics;
  topics.push_back(std::string(&quot;chatter&quot;));
  topics.push_back(std::string(&quot;numbers&quot;));

  rosbag::View view(bag, rosbag::TopicQuery(topics));

  BOOST_FOREACH(rosbag::MessageInstance const m, view)
  {
    std_msgs::String::ConstPtr s = m.instantiate&lt;std_msgs::String&gt;();
    if (s != NULL)
    {
      if(s-&gt;data == std::string(&quot;foo&quot;)) {
        printf(&quot;Successfully checked string foo\n&quot;);
      }
      else
      {
        printf(&quot;Failed checked string foo\n&quot;);
        FAIL();
      }
    }

    std_msgs::Int32::ConstPtr i = m.instantiate&lt;std_msgs::Int32&gt;();
    if (i != NULL)
    {
      if (i-&gt;data == 42) {
        printf(&quot;Successfully checked value 42\n&quot;);
      }
      else
      {
        printf(&quot;Failed checked value 42.\n&quot;);
        FAIL();
      }
    }
  }

  bag.close();
}

void serialize_bag(rosbag::Bag&amp; bag, const char* filename)
{
  bag.open(filename);

  rosbag::View bag_view(bag);
  std::vector&lt;uint8_t&gt; buffer;

  BOOST_FOREACH(const rosbag::MessageInstance&amp; msg_instance, bag_view)
  {
    const size_t msg_size  = msg_instance.size();
    buffer.resize(msg_size);
    ros::serialization::OStream stream(buffer.data(), buffer.size());
    msg_instance.write(stream);

    printf(&quot;reading: %s\n&quot;,  msg_instance.getTopic().c_str() );
  }
  bag.close();
}

TEST(rosbag_storage, reuse_bag)
{
  rosbag::Bag bag;

  serialize_bag(bag, bag_filename);
  serialize_bag(bag, bag_filename2);
}

int main(int argc, char **argv) {
    ros::Time::init();
    create_test_bag(bag_filename);
    create_a_different_test_bag(bag_filename2);

    testing::InitGoogleTest(&amp;argc, argv);
    return RUN_ALL_TESTS();
}
</PRE>
</div>
  </div>
</body>
</html>
