<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_fileref.cpp &amp; test_id3v2.cpp</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_fileref.cpp &amp; test_id3v2.cpp
      </h3>
<h1 align="center">
        12.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_fileref.cpp (32.88288%)<th>test_id3v2.cpp (7.8579116%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(255-295)<td><a href="#" name="0">(467-572)</a><td align="center"><font color="#ff0000">34</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(295-310)<td><a href="#" name="1">(715-765)</a><td align="center"><font color="#700000">15</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(321-334)<td><a href="#" name="2">(322-361)</a><td align="center"><font color="#5a0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(236-250)<td><a href="#" name="3">(773-800)</a><td align="center"><font color="#5a0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_fileref.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 #include &lt;string&gt;
2 #include &lt;stdio.h&gt;
3 #include &lt;tag.h&gt;
4 #include &lt;fileref.h&gt;
5 #include &lt;oggflacfile.h&gt;
6 #include &lt;vorbisfile.h&gt;
7 #include &lt;mpegfile.h&gt;
8 #include &lt;mpcfile.h&gt;
9 #include &lt;asffile.h&gt;
10 #include &lt;speexfile.h&gt;
11 #include &lt;flacfile.h&gt;
12 #include &lt;trueaudiofile.h&gt;
13 #include &lt;mp4file.h&gt;
14 #include &lt;wavfile.h&gt;
15 #include &lt;apefile.h&gt;
16 #include &lt;aifffile.h&gt;
17 #include &lt;wavpackfile.h&gt;
18 #include &lt;opusfile.h&gt;
19 #include &lt;xmfile.h&gt;
20 #include &lt;tfilestream.h&gt;
21 #include &lt;tbytevectorstream.h&gt;
22 #include &lt;cppunit/extensions/HelperMacros.h&gt;
23 #include "utils.h"
24 using namespace std;
25 using namespace TagLib;
26 namespace
27 {
28   class DummyResolver : public FileRef::FileTypeResolver
29   {
30   public:
31     virtual File *createFile(FileName fileName, bool, AudioProperties::ReadStyle) const
32     {
33       return new Ogg::Vorbis::File(fileName);
34     }
35   };
36   class DummyStreamResolver : public FileRef::StreamTypeResolver
37   {
38   public:
39     virtual File *createFile(FileName, bool, AudioProperties::ReadStyle) const
40     {
41       return 0;
42     }
43     virtual File *createFileFromStream(IOStream *s, bool, AudioProperties::ReadStyle) const
44     {
45       return new MP4::File(s);
46     }
47   };
48 }
49 class TestFileRef : public CppUnit::TestFixture
50 {
51   CPPUNIT_TEST_SUITE(TestFileRef);
52   CPPUNIT_TEST(testASF);
53   CPPUNIT_TEST(testMusepack);
54   CPPUNIT_TEST(testVorbis);
55   CPPUNIT_TEST(testSpeex);
56   CPPUNIT_TEST(testFLAC);
57   CPPUNIT_TEST(testMP3);
58   CPPUNIT_TEST(testOGA_FLAC);
59   CPPUNIT_TEST(testOGA_Vorbis);
60   CPPUNIT_TEST(testMP4_1);
61   CPPUNIT_TEST(testMP4_2);
62   CPPUNIT_TEST(testMP4_3);
63   CPPUNIT_TEST(testMP4_4);
64   CPPUNIT_TEST(testTrueAudio);
65   CPPUNIT_TEST(testAPE);
66   CPPUNIT_TEST(testWav);
67   CPPUNIT_TEST(testAIFF_1);
68   CPPUNIT_TEST(testAIFF_2);
69   CPPUNIT_TEST(testWavPack);
70   CPPUNIT_TEST(testOpus);
71   CPPUNIT_TEST(testUnsupported);
72   CPPUNIT_TEST(testCreate);
73   CPPUNIT_TEST(testAudioProperties);
74   CPPUNIT_TEST(testDefaultFileExtensions);
75   CPPUNIT_TEST(testFileResolver);
76   CPPUNIT_TEST_SUITE_END();
77 public:
78   template &lt;typename T&gt;
79   void fileRefSave(const string &amp;filename, const string &amp;ext)
80   {
81     ScopedFileCopy copy(filename, ext);
82     string newname = copy.fileName();
83     {
84       FileRef f(newname.c_str());
85       CPPUNIT_ASSERT(dynamic_cast&lt;T*&gt;(f.file()));
86       CPPUNIT_ASSERT(!f.isNull());
87       f.tag()-&gt;setArtist("test artist");
88       f.tag()-&gt;setTitle("test title");
89       f.tag()-&gt;setGenre("Test!");
90       f.tag()-&gt;setAlbum("albummmm");
91       f.tag()-&gt;setComment("a comment");
92       f.tag()-&gt;setTrack(5);
93       f.tag()-&gt;setYear(2020);
94       f.save();
95     }
96     {
97       FileRef f(newname.c_str());
98       CPPUNIT_ASSERT(!f.isNull());
99       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;artist(), String("test artist"));
100       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;title(), String("test title"));
101       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;genre(), String("Test!"));
102       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;album(), String("albummmm"));
103       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;comment(), String("a comment"));
104       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;track(), (unsigned int)5);
105       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;year(), (unsigned int)2020);
106       f.tag()-&gt;setArtist("ttest artist");
107       f.tag()-&gt;setTitle("ytest title");
108       f.tag()-&gt;setGenre("uTest!");
109       f.tag()-&gt;setAlbum("ialbummmm");
110       f.tag()-&gt;setComment("another comment");
111       f.tag()-&gt;setTrack(7);
112       f.tag()-&gt;setYear(2080);
113       f.save();
114     }
115     {
116       FileRef f(newname.c_str());
117       CPPUNIT_ASSERT(!f.isNull());
118       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;artist(), String("ttest artist"));
119       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;title(), String("ytest title"));
120       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;genre(), String("uTest!"));
121       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;album(), String("ialbummmm"));
122       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;comment(), String("another comment"));
123       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;track(), (unsigned int)7);
124       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;year(), (unsigned int)2080);
125     }
126     {
127       FileStream fs(newname.c_str());
128       FileRef f(&amp;fs);
129       CPPUNIT_ASSERT(dynamic_cast&lt;T*&gt;(f.file()));
130       CPPUNIT_ASSERT(!f.isNull());
131       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;artist(), String("ttest artist"));
132       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;title(), String("ytest title"));
133       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;genre(), String("uTest!"));
134       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;album(), String("ialbummmm"));
135       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;comment(), String("another comment"));
136       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;track(), (unsigned int)7);
137       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;year(), (unsigned int)2080);
138       f.tag()-&gt;setArtist("test artist");
139       f.tag()-&gt;setTitle("test title");
140       f.tag()-&gt;setGenre("Test!");
141       f.tag()-&gt;setAlbum("albummmm");
142       f.tag()-&gt;setComment("a comment");
143       f.tag()-&gt;setTrack(5);
144       f.tag()-&gt;setYear(2020);
145       f.save();
146     }
147     ByteVector fileContent;
148     {
149       FileStream fs(newname.c_str());
150       FileRef f(&amp;fs);
151       CPPUNIT_ASSERT(dynamic_cast&lt;T*&gt;(f.file()));
152       CPPUNIT_ASSERT(!f.isNull());
153       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;artist(), String("test artist"));
154       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;title(), String("test title"));
155       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;genre(), String("Test!"));
156       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;album(), String("albummmm"));
157       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;comment(), String("a comment"));
158       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;track(), (unsigned int)5);
159       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;year(), (unsigned int)2020);
160       fs.seek(0);
161       fileContent = fs.readBlock(fs.length());
162     }
163     {
164       ByteVectorStream bs(fileContent);
165       FileRef f(&amp;bs);
166       CPPUNIT_ASSERT(dynamic_cast&lt;T*&gt;(f.file()));
167       CPPUNIT_ASSERT(!f.isNull());
168       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;artist(), String("test artist"));
169       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;title(), String("test title"));
170       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;genre(), String("Test!"));
171       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;album(), String("albummmm"));
172       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;comment(), String("a comment"));
173       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;track(), (unsigned int)5);
174       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;year(), (unsigned int)2020);
175       f.tag()-&gt;setArtist("ttest artist");
176       f.tag()-&gt;setTitle("ytest title");
177       f.tag()-&gt;setGenre("uTest!");
178       f.tag()-&gt;setAlbum("ialbummmm");
179       f.tag()-&gt;setComment("another comment");
180       f.tag()-&gt;setTrack(7);
181       f.tag()-&gt;setYear(2080);
182       f.save();
183       fileContent = *bs.data();
184     }
185     {
186       ByteVectorStream bs(fileContent);
187       FileRef f(&amp;bs);
188       CPPUNIT_ASSERT(dynamic_cast&lt;T*&gt;(f.file()));
189       CPPUNIT_ASSERT(!f.isNull());
190       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;artist(), String("ttest artist"));
191       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;title(), String("ytest title"));
192       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;genre(), String("uTest!"));
193       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;album(), String("ialbummmm"));
194       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;comment(), String("another comment"));
195 <a name="3"></a>      CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;track(), (unsigned int)7);
196       CPPUNIT_ASSERT_EQUAL(f.tag()-&gt;year(), (unsigned int)2080);
197     }
198 <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>  }
199   void testMusepack()
200   {
201     fileRefSave&lt;MPC::File&gt;("click", ".mpc");
202   }
203   void testASF()
204   {
205     fileRefSave&lt;ASF::File&gt;("silence-1", ".wma");
206   }
207   void testVorbis()
208   {
209     fileRefSave&lt;Ogg::Vorbis::File&gt;("empty", ".ogg");</b></font>
210   }
211 <a name="0"></a>
212   void testSpeex()
213   {
214 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>    fileRefSave&lt;Ogg::Speex::File&gt;("empty", ".spx");
215   }
216   void testFLAC()
217   {
218     fileRefSave&lt;FLAC::File&gt;("no-tags", ".flac");
219   }
220   void testMP3()
221   {
222     fileRefSave&lt;MPEG::File&gt;("xing", ".mp3");
223   }
224   void testTrueAudio()
225   {
226     fileRefSave&lt;TrueAudio::File&gt;("empty", ".tta");
227   }
228   void testMP4_1()
229   {
230     fileRefSave&lt;MP4::File&gt;("has-tags", ".m4a");
231   }
232   void testMP4_2()
233   {
234     fileRefSave&lt;MP4::File&gt;("no-tags", ".m4a");
235   }
236   void testMP4_3()
237   {
238     fileRefSave&lt;MP4::File&gt;("no-tags", ".3g2");
239   }
240   void testMP4_4()
241   {
242     fileRefSave&lt;MP4::File&gt;("blank_video", ".m4v");
243   }
244 <a name="1"></a>
245   void testWav()
246   {
247     fileRefSave&lt;RIFF::WAV::File&gt;("empty", ".wav");</b></font><font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>
248   }
249   void testOGA_FLAC()
250   {
251     fileRefSave&lt;Ogg::FLAC::File&gt;("empty_flac", ".oga");
252   }
253   void testOGA_Vorbis()
254   {
255     fileRefSave&lt;Ogg::Vorbis::File&gt;("empty_vorbis", ".oga");
256   }
257   void testAPE()
258   {
259     fileRefSave&lt;APE::File&gt;("mac-399", ".ape");</b></font>
260   }
261   void testAIFF_1()
262   {
263     fileRefSave&lt;RIFF::AIFF::File&gt;("empty", ".aiff");
264   }
265 <a name="2"></a>  void testAIFF_2()
266   {
267     fileRefSave&lt;RIFF::AIFF::File&gt;("alaw", ".aifc");
268 <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>  }
269   void testWavPack()
270   {
271     fileRefSave&lt;WavPack::File&gt;("click", ".wv");
272   }
273   void testOpus()
274   {
275     fileRefSave&lt;Ogg::Opus::File&gt;("correctness_gain_silent_output", ".opus");
276   }
277   void testUnsupported()
278   {</b></font>
279     FileRef f1(TEST_FILE_PATH_C("no-extension"));
280     CPPUNIT_ASSERT(f1.isNull());
281     FileRef f2(TEST_FILE_PATH_C("unsupported-extension.xx"));
282     CPPUNIT_ASSERT(f2.isNull());
283   }
284   void testCreate()
285   {
286     File *f = FileRef::create(TEST_FILE_PATH_C("empty_vorbis.oga"));
287     CPPUNIT_ASSERT(dynamic_cast&lt;Ogg::Vorbis::File*&gt;(f));
288     delete f;
289     f = FileRef::create(TEST_FILE_PATH_C("xing.mp3"));
290     CPPUNIT_ASSERT(dynamic_cast&lt;MPEG::File*&gt;(f));
291     delete f;
292     f = FileRef::create(TEST_FILE_PATH_C("test.xm"));
293     CPPUNIT_ASSERT(dynamic_cast&lt;XM::File*&gt;(f));
294     delete f;
295   }
296   void testAudioProperties()
297   {
298     FileRef f(TEST_FILE_PATH_C("xing.mp3"));
299     const AudioProperties *audioProperties = f.audioProperties();
300     CPPUNIT_ASSERT_EQUAL(2, audioProperties-&gt;lengthInSeconds());
301     CPPUNIT_ASSERT_EQUAL(2064, audioProperties-&gt;lengthInMilliseconds());
302   }
303   void testDefaultFileExtensions()
304   {
305     const StringList extensions = FileRef::defaultFileExtensions();
306     CPPUNIT_ASSERT(extensions.contains("mpc"));
307     CPPUNIT_ASSERT(extensions.contains("wma"));
308     CPPUNIT_ASSERT(extensions.contains("ogg"));
309     CPPUNIT_ASSERT(extensions.contains("spx"));
310     CPPUNIT_ASSERT(extensions.contains("flac"));
311     CPPUNIT_ASSERT(extensions.contains("mp3"));
312     CPPUNIT_ASSERT(extensions.contains("tta"));
313     CPPUNIT_ASSERT(extensions.contains("m4a"));
314     CPPUNIT_ASSERT(extensions.contains("3g2"));
315     CPPUNIT_ASSERT(extensions.contains("m4v"));
316     CPPUNIT_ASSERT(extensions.contains("wav"));
317     CPPUNIT_ASSERT(extensions.contains("oga"));
318     CPPUNIT_ASSERT(extensions.contains("ape"));
319     CPPUNIT_ASSERT(extensions.contains("aiff"));
320     CPPUNIT_ASSERT(extensions.contains("aifc"));
321     CPPUNIT_ASSERT(extensions.contains("wv"));
322     CPPUNIT_ASSERT(extensions.contains("opus"));
323     CPPUNIT_ASSERT(extensions.contains("xm"));
324   }
325   void testFileResolver()
326   {
327     {
328       FileRef f(TEST_FILE_PATH_C("xing.mp3"));
329       CPPUNIT_ASSERT(dynamic_cast&lt;MPEG::File *&gt;(f.file()) != NULL);
330     }
331     DummyResolver resolver;
332     FileRef::addFileTypeResolver(&amp;resolver);
333     {
334       FileRef f(TEST_FILE_PATH_C("xing.mp3"));
335       CPPUNIT_ASSERT(dynamic_cast&lt;Ogg::Vorbis::File *&gt;(f.file()) != NULL);
336     }
337     DummyStreamResolver streamResolver;
338     FileRef::addFileTypeResolver(&amp;streamResolver);
339     {
340       FileStream s(TEST_FILE_PATH_C("xing.mp3"));
341       FileRef f(&amp;s);
342       CPPUNIT_ASSERT(dynamic_cast&lt;MP4::File *&gt;(f.file()) != NULL);
343     }
344   }
345 };
346 CPPUNIT_TEST_SUITE_REGISTRATION(TestFileRef);
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_id3v2.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 #include &lt;string&gt;
2 #include &lt;stdio.h&gt;
3 #include &lt;id3v2tag.h&gt;
4 #include &lt;mpegfile.h&gt;
5 #include &lt;id3v2frame.h&gt;
6 #include &lt;uniquefileidentifierframe.h&gt;
7 #include &lt;textidentificationframe.h&gt;
8 #include &lt;attachedpictureframe.h&gt;
9 #include &lt;unsynchronizedlyricsframe.h&gt;
10 #include &lt;synchronizedlyricsframe.h&gt;
11 #include &lt;eventtimingcodesframe.h&gt;
12 #include &lt;generalencapsulatedobjectframe.h&gt;
13 #include &lt;relativevolumeframe.h&gt;
14 #include &lt;popularimeterframe.h&gt;
15 #include &lt;urllinkframe.h&gt;
16 #include &lt;ownershipframe.h&gt;
17 #include &lt;unknownframe.h&gt;
18 #include &lt;chapterframe.h&gt;
19 #include &lt;tableofcontentsframe.h&gt;
20 #include &lt;commentsframe.h&gt;
21 #include &lt;podcastframe.h&gt;
22 #include &lt;privateframe.h&gt;
23 #include &lt;tdebug.h&gt;
24 #include &lt;tpropertymap.h&gt;
25 #include &lt;tzlib.h&gt;
26 #include &lt;cppunit/extensions/HelperMacros.h&gt;
27 #include "plainfile.h"
28 #include "utils.h"
29 using namespace std;
30 using namespace TagLib;
31 class PublicFrame : public ID3v2::Frame
32 {
33   public:
34     PublicFrame() : ID3v2::Frame(ByteVector("XXXX\0\0\0\0\0\0", 10)) {}
35     String readStringField(const ByteVector &amp;data, String::Type encoding,
36                            int *position = 0)
37       { return ID3v2::Frame::readStringField(data, encoding, position); }
38     virtual String toString() const { return String(); }
39     virtual void parseFields(const ByteVector &amp;) {}
40     virtual ByteVector renderFields() const { return ByteVector(); }
41 };
42 class TestID3v2 : public CppUnit::TestFixture
43 {
44   CPPUNIT_TEST_SUITE(TestID3v2);
45   CPPUNIT_TEST(testUnsynchDecode);
46   CPPUNIT_TEST(testDowngradeUTF8ForID3v23_1);
47   CPPUNIT_TEST(testDowngradeUTF8ForID3v23_2);
48   CPPUNIT_TEST(testUTF16BEDelimiter);
49   CPPUNIT_TEST(testUTF16Delimiter);
50   CPPUNIT_TEST(testReadStringField);
51   CPPUNIT_TEST(testParseAPIC);
52   CPPUNIT_TEST(testParseAPIC_UTF16_BOM);
53   CPPUNIT_TEST(testParseAPICv22);
54   CPPUNIT_TEST(testRenderAPIC);
55   CPPUNIT_TEST(testDontRender22);
56   CPPUNIT_TEST(testParseGEOB);
57   CPPUNIT_TEST(testRenderGEOB);
58   CPPUNIT_TEST(testPOPMtoString);
59   CPPUNIT_TEST(testParsePOPM);
60   CPPUNIT_TEST(testParsePOPMWithoutCounter);
61   CPPUNIT_TEST(testRenderPOPM);
62   CPPUNIT_TEST(testPOPMFromFile);
63   CPPUNIT_TEST(testParseRelativeVolumeFrame);
64   CPPUNIT_TEST(testRenderRelativeVolumeFrame);
65   CPPUNIT_TEST(testParseUniqueFileIdentifierFrame);
66   CPPUNIT_TEST(testParseEmptyUniqueFileIdentifierFrame);
67   CPPUNIT_TEST(testRenderUniqueFileIdentifierFrame);
68   CPPUNIT_TEST(testBrokenFrame1);
69   CPPUNIT_TEST(testItunes24FrameSize);
70   CPPUNIT_TEST(testParseUrlLinkFrame);
71   CPPUNIT_TEST(testRenderUrlLinkFrame);
72   CPPUNIT_TEST(testParseUserUrlLinkFrame);
73   CPPUNIT_TEST(testRenderUserUrlLinkFrame);
74   CPPUNIT_TEST(testParseOwnershipFrame);
75   CPPUNIT_TEST(testRenderOwnershipFrame);
76   CPPUNIT_TEST(testParseSynchronizedLyricsFrame);
77   CPPUNIT_TEST(testParseSynchronizedLyricsFrameWithEmptyDescritpion);
78   CPPUNIT_TEST(testRenderSynchronizedLyricsFrame);
79   CPPUNIT_TEST(testParseEventTimingCodesFrame);
80   CPPUNIT_TEST(testRenderEventTimingCodesFrame);
81   CPPUNIT_TEST(testParseCommentsFrame);
82   CPPUNIT_TEST(testRenderCommentsFrame);
83   CPPUNIT_TEST(testParsePodcastFrame);
84   CPPUNIT_TEST(testRenderPodcastFrame);
85   CPPUNIT_TEST(testParsePrivateFrame);
86   CPPUNIT_TEST(testRenderPrivateFrame);
87   CPPUNIT_TEST(testSaveUTF16Comment);
88   CPPUNIT_TEST(testUpdateGenre23_1);
89   CPPUNIT_TEST(testUpdateGenre23_2);
90   CPPUNIT_TEST(testUpdateGenre23_3);
91   CPPUNIT_TEST(testUpdateGenre24);
92   CPPUNIT_TEST(testUpdateDate22);
93   CPPUNIT_TEST(testDowngradeTo23);
94   CPPUNIT_TEST(testCompressedFrameWithBrokenLength);
95   CPPUNIT_TEST(testW000);
96   CPPUNIT_TEST(testPropertyInterface);
97   CPPUNIT_TEST(testPropertyInterface2);
98   CPPUNIT_TEST(testPropertiesMovement);
99   CPPUNIT_TEST(testPropertyGrouping);
100   CPPUNIT_TEST(testDeleteFrame);
101   CPPUNIT_TEST(testSaveAndStripID3v1ShouldNotAddFrameFromID3v1ToId3v2);
102   CPPUNIT_TEST(testParseChapterFrame);
103   CPPUNIT_TEST(testRenderChapterFrame);
104   CPPUNIT_TEST(testParseTableOfContentsFrame);
105   CPPUNIT_TEST(testRenderTableOfContentsFrame);
106   CPPUNIT_TEST(testShrinkPadding);
107   CPPUNIT_TEST(testEmptyFrame);
108   CPPUNIT_TEST(testDuplicateTags);
109   CPPUNIT_TEST(testParseTOCFrameWithManyChildren);
110   CPPUNIT_TEST_SUITE_END();
111 public:
112   void testUnsynchDecode()
113   {
114     MPEG::File f(TEST_FILE_PATH_C("unsynch.id3"), false);
115     CPPUNIT_ASSERT(f.tag());
116     CPPUNIT_ASSERT_EQUAL(String("My babe just cares for me"), f.tag()-&gt;title());
117   }
118   void testDowngradeUTF8ForID3v23_1()
119   {
120     ScopedFileCopy copy("xing", ".mp3");
121     string newname = copy.fileName();
122     ID3v2::TextIdentificationFrame *f
123       = new ID3v2::TextIdentificationFrame(ByteVector("TPE1"), String::UTF8);
124     StringList sl;
125     sl.append("Foo");
126     f-&gt;setText(sl);
127     MPEG::File file(newname.c_str());
128     file.ID3v2Tag(true)-&gt;addFrame(f);
129     file.save(MPEG::File::ID3v2, File::StripOthers, ID3v2::v3);
130     CPPUNIT_ASSERT_EQUAL(true, file.hasID3v2Tag());
131     ByteVector data = f-&gt;render();
132     CPPUNIT_ASSERT_EQUAL((unsigned int)(4+4+2+1+6+2), data.size());
133     ID3v2::TextIdentificationFrame f2(data);
134     CPPUNIT_ASSERT_EQUAL(sl, f2.fieldList());
135     CPPUNIT_ASSERT_EQUAL(String::UTF16, f2.textEncoding());
136   }
137   void testDowngradeUTF8ForID3v23_2()
138   {
139     ScopedFileCopy copy("xing", ".mp3");
140     ID3v2::UnsynchronizedLyricsFrame *f
141       = new ID3v2::UnsynchronizedLyricsFrame(String::UTF8);
142     f-&gt;setText("Foo");
143     MPEG::File file(copy.fileName().c_str());
144     file.ID3v2Tag(true)-&gt;addFrame(f);
145     file.save(MPEG::File::ID3v2, File::StripOthers, ID3v2::v3);
146     CPPUNIT_ASSERT(file.hasID3v2Tag());
147     ByteVector data = f-&gt;render();
148     CPPUNIT_ASSERT_EQUAL((unsigned int)(4+4+2+1+3+2+2+6+2), data.size());
149     ID3v2::UnsynchronizedLyricsFrame f2(data);
150     CPPUNIT_ASSERT_EQUAL(String("Foo"), f2.text());
151     CPPUNIT_ASSERT_EQUAL(String::UTF16, f2.textEncoding());
152   }
153   void testUTF16BEDelimiter()
154   {
155     ID3v2::TextIdentificationFrame f(ByteVector("TPE1"), String::UTF16BE);
156     StringList sl;
157     sl.append("Foo");
158     sl.append("Bar");
159     f.setText(sl);
160     CPPUNIT_ASSERT_EQUAL((unsigned int)(4+4+2+1+6+2+6), f.render().size());
161   }
162   void testUTF16Delimiter()
163   {
164     ID3v2::TextIdentificationFrame f(ByteVector("TPE1"), String::UTF16);
165     StringList sl;
166     sl.append("Foo");
167     sl.append("Bar");
168     f.setText(sl);
169     CPPUNIT_ASSERT_EQUAL((unsigned int)(4+4+2+1+8+2+8), f.render().size());
170   }
171   void testBrokenFrame1()
172   {
173     MPEG::File f(TEST_FILE_PATH_C("broken-tenc.id3"), false);
174     CPPUNIT_ASSERT(f.tag());
175     CPPUNIT_ASSERT(!f.ID3v2Tag()-&gt;frameListMap().contains("TENC"));
176   }
177   void testReadStringField()
178   {
179     PublicFrame f;
180     ByteVector data("abc\0", 4);
181     String str = f.readStringField(data, String::Latin1);
182     CPPUNIT_ASSERT_EQUAL(String("abc"), str);
183   }
184   void testParseAPIC()
185   {
186     ID3v2::AttachedPictureFrame f(ByteVector("APIC"
187                                              "\x00\x00\x00\x07"
188                                              "\x00\x00"
189                                              "\x00"
190                                              "m\x00"
191                                              "\x01"
192                                              "d\x00"
193                                              "\x00", 17));
194     CPPUNIT_ASSERT_EQUAL(String("m"), f.mimeType());
195     CPPUNIT_ASSERT_EQUAL(ID3v2::AttachedPictureFrame::FileIcon, f.type());
196     CPPUNIT_ASSERT_EQUAL(String("d"), f.description());
197   }
198   void testParseAPIC_UTF16_BOM()
199   {
200     ID3v2::AttachedPictureFrame f(ByteVector(
201       "\x41\x50\x49\x43\x00\x02\x0c\x59\x00\x00\x01\x69\x6d\x61\x67\x65"
202       "\x2f\x6a\x70\x65\x67\x00\x00\xfe\xff\x00\x63\x00\x6f\x00\x76\x00"
203       "\x65\x00\x72\x00\x2e\x00\x6a\x00\x70\x00\x67\x00\x00\xff\xd8\xff",
204       16 * 3));
205     CPPUNIT_ASSERT_EQUAL(String("image/jpeg"), f.mimeType());
206     CPPUNIT_ASSERT_EQUAL(ID3v2::AttachedPictureFrame::Other, f.type());
207     CPPUNIT_ASSERT_EQUAL(String("cover.jpg"), f.description());
208     CPPUNIT_ASSERT_EQUAL(ByteVector("\xff\xd8\xff", 3), f.picture());
209   }
210   void testParseAPICv22()
211   {
212     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();
213     ByteVector data = ByteVector("PIC"
214                                  "\x00\x00\x08"
215                                  "\x00"
216                                  "JPG"
217                                  "\x01"
218                                  "d\x00"
219                                  "\x00", 14);
220     ID3v2::Header header;
221     header.setMajorVersion(2);
222     ID3v2::AttachedPictureFrame *frame =
223       dynamic_cast&lt;TagLib::ID3v2::AttachedPictureFrame *&gt;(factory-&gt;createFrame(data, &amp;header));
224     CPPUNIT_ASSERT(frame);
225     CPPUNIT_ASSERT_EQUAL(String("image/jpeg"), frame-&gt;mimeType());
226     CPPUNIT_ASSERT_EQUAL(ID3v2::AttachedPictureFrame::FileIcon, frame-&gt;type());
227     CPPUNIT_ASSERT_EQUAL(String("d"), frame-&gt;description());
228     delete frame;
229   }
230   void testRenderAPIC()
231   {
232     ID3v2::AttachedPictureFrame f;
233     f.setTextEncoding(String::UTF8);
234     f.setMimeType("image/png");
235     f.setType(ID3v2::AttachedPictureFrame::BackCover);
236     f.setDescription("Description");
237     f.setPicture("PNG data");
238     CPPUNIT_ASSERT_EQUAL(
239       ByteVector("APIC"
240                  "\x00\x00\x00\x20"
241                  "\x00\x00"
242                  "\x03"
243                  "image/png\x00"
244                  "\x04"
245                  "Description\x00"
246                  "PNG data", 42),
247       f.render());
248   }
249   void testDontRender22()
250   {
251     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();
252     ByteVector data = ByteVector("FOO"
253                                  "\x00\x00\x08"
254                                  "\x00"
255                                  "JPG"
256                                  "\x01"
257                                  "d\x00"
258                                  "\x00", 14);
259     ID3v2::Header header;
260     header.setMajorVersion(2);
261     ID3v2::UnknownFrame *frame =
262       dynamic_cast&lt;TagLib::ID3v2::UnknownFrame*&gt;(factory-&gt;createFrame(data, &amp;header));
263     CPPUNIT_ASSERT(frame);
264 <a name="2"></a>    ID3v2::Tag tag;
265     tag.addFrame(frame);
266     CPPUNIT_ASSERT_EQUAL((unsigned int)1034, tag.render().size());
267 <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>  }
268   void testParseGEOB()
269   {
270     ID3v2::GeneralEncapsulatedObjectFrame f(ByteVector("GEOB"
271                                              "\x00\x00\x00\x08"
272                                              "\x00\x00"
273                                              "\x00"
274                                              "m\x00"
275                                              "f\x00"
276                                              "d\x00"
277                                              "\x00", 18));
278     CPPUNIT_ASSERT_EQUAL(String("m"), f.mimeType());
279     CPPUNIT_ASSERT_EQUAL(String("f"), f.fileName());
280     CPPUNIT_ASSERT_EQUAL(String("d"), f.description());
281   }
282   void testRenderGEOB()
283   {
284     ID3v2::GeneralEncapsulatedObjectFrame f;
285     f.setTextEncoding(String::Latin1);
286     f.setMimeType("application/octet-stream");
287     f.setFileName("test.bin");
288     f.setDescription("Description");
289     f.setObject(ByteVector(3, '\x01'));
290     CPPUNIT_ASSERT_EQUAL(
291       ByteVector("GEOB"
292                  "\x00\x00\x00\x32"
293                  "\x00\x00"
294                  "\x00"
295                  "application/octet-stream\x00"
296                  "test.bin\x00"
297                  "Description\x00"
298                  "\x01\x01\x01", 60),
299       f.render());
300   }
301   void testParsePOPM()
302   {</b></font>
303     ID3v2::PopularimeterFrame f(ByteVector("POPM"
304                                            "\x00\x00\x00\x17"
305                                            "\x00\x00"
306                                            "email@example.com\x00"
307                                            "\x02"
308                                            "\x00\x00\x00\x03", 33));
309     CPPUNIT_ASSERT_EQUAL(String("email@example.com"), f.email());
310     CPPUNIT_ASSERT_EQUAL(2, f.rating());
311     CPPUNIT_ASSERT_EQUAL((unsigned int)3, f.counter());
312   }
313   void testParsePOPMWithoutCounter()
314   {
315     ID3v2::PopularimeterFrame f(ByteVector("POPM"
316                                            "\x00\x00\x00\x13"
317                                            "\x00\x00"
318                                            "email@example.com\x00"
319                                            "\x02", 29));
320     CPPUNIT_ASSERT_EQUAL(String("email@example.com"), f.email());
321     CPPUNIT_ASSERT_EQUAL(2, f.rating());
322     CPPUNIT_ASSERT_EQUAL((unsigned int)0, f.counter());
323   }
324   void testRenderPOPM()
325   {
326     ID3v2::PopularimeterFrame f;
327     f.setEmail("email@example.com");
328     f.setRating(2);
329     f.setCounter(3);
330     CPPUNIT_ASSERT_EQUAL(
331       ByteVector("POPM"
332                  "\x00\x00\x00\x17"
333                  "\x00\x00"
334                  "email@example.com\x00"
335                  "\x02"
336                  "\x00\x00\x00\x03", 33),
337       f.render());
338   }
339   void testPOPMtoString()
340   {
341     ID3v2::PopularimeterFrame f;
342     f.setEmail("email@example.com");
343     f.setRating(2);
344     f.setCounter(3);
345     CPPUNIT_ASSERT_EQUAL(
346       String("email@example.com rating=2 counter=3"), f.toString());
347   }
348   void testPOPMFromFile()
349   {
350     ScopedFileCopy copy("xing", ".mp3");
351     string newname = copy.fileName();
352     ID3v2::PopularimeterFrame *f = new ID3v2::PopularimeterFrame();
353     f-&gt;setEmail("email@example.com");
354     f-&gt;setRating(200);
355     f-&gt;setCounter(3);
356     {
357       MPEG::File foo(newname.c_str());
358       foo.ID3v2Tag()-&gt;addFrame(f);
359       foo.save();
360     }
361     {
362       MPEG::File bar(newname.c_str());
363       CPPUNIT_ASSERT_EQUAL(String("email@example.com"), dynamic_cast&lt;ID3v2::PopularimeterFrame *&gt;(bar.ID3v2Tag()-&gt;frameList("POPM").front())-&gt;email());
364       CPPUNIT_ASSERT_EQUAL(200, dynamic_cast&lt;ID3v2::PopularimeterFrame *&gt;(bar.ID3v2Tag()-&gt;frameList("POPM").front())-&gt;rating());
365     }
366   }
367   void testParseRelativeVolumeFrame()
368   {
369     ID3v2::RelativeVolumeFrame f(
370       ByteVector("RVA2"                               "\x00\x00\x00\x0B"                   "\x00\x00"                           "ident\x00"                          "\x02"                               "\x00\x0F"                           "\x08"                               "\x45", 21));           CPPUNIT_ASSERT_EQUAL(String("ident"), f.identification());
371     CPPUNIT_ASSERT_EQUAL(15.0f / 512.0f,
372                          f.volumeAdjustment(ID3v2::RelativeVolumeFrame::FrontRight));
373     CPPUNIT_ASSERT_EQUAL(static_cast&lt;short&gt;(15),
374                          f.volumeAdjustmentIndex(ID3v2::RelativeVolumeFrame::FrontRight));
375     CPPUNIT_ASSERT_EQUAL((unsigned char)8,
376                          f.peakVolume(ID3v2::RelativeVolumeFrame::FrontRight).bitsRepresentingPeak);
377     CPPUNIT_ASSERT_EQUAL(ByteVector("\x45"),
378                          f.peakVolume(ID3v2::RelativeVolumeFrame::FrontRight).peakVolume);
379     const List&lt;ID3v2::RelativeVolumeFrame::ChannelType&gt; channels = f.channels();
380     CPPUNIT_ASSERT_EQUAL(1U, channels.size());
381     CPPUNIT_ASSERT_EQUAL(ID3v2::RelativeVolumeFrame::FrontRight, channels[0]);
382   }
383   void testRenderRelativeVolumeFrame()
384   {
385     ID3v2::RelativeVolumeFrame f;
386     f.setIdentification("ident");
387     f.setVolumeAdjustment(15.0f / 512.0f, ID3v2::RelativeVolumeFrame::FrontRight);
388 <a name="0"></a>    ID3v2::RelativeVolumeFrame::PeakVolume peakVolume;
389     peakVolume.bitsRepresentingPeak = 8;
390     peakVolume.peakVolume.setData("\x45");
391 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>    f.setPeakVolume(peakVolume, ID3v2::RelativeVolumeFrame::FrontRight);
392     CPPUNIT_ASSERT_EQUAL(
393       ByteVector("RVA2"
394                  "\x00\x00\x00\x0B"
395                  "\x00\x00"
396                  "ident\x00"
397                  "\x02"
398                  "\x00\x0F"
399                  "\x08"
400                  "\x45", 21),
401       f.render());
402   }
403   void testParseUniqueFileIdentifierFrame()
404   {
405     ID3v2::UniqueFileIdentifierFrame f(
406       ByteVector("UFID"                                  "\x00\x00\x00\x09"                      "\x00\x00"                              "owner\x00"                             "\x00\x01\x02", 19));      CPPUNIT_ASSERT_EQUAL(String("owner"),
407                          f.owner());
408     CPPUNIT_ASSERT_EQUAL(ByteVector("\x00\x01\x02", 3),
409                          f.identifier());
410   }
411   void testParseEmptyUniqueFileIdentifierFrame()
412   {
413     ID3v2::UniqueFileIdentifierFrame f(
414       ByteVector("UFID"                                  "\x00\x00\x00\x01"                      "\x00\x00"                              "\x00"                                  "", 11));                  CPPUNIT_ASSERT_EQUAL(String(),
415                          f.owner());
416     CPPUNIT_ASSERT_EQUAL(ByteVector(),
417                          f.identifier());
418   }
419   void testRenderUniqueFileIdentifierFrame()
420   {
421     ID3v2::UniqueFileIdentifierFrame f("owner", "\x01\x02\x03");
422     CPPUNIT_ASSERT_EQUAL(
423       ByteVector("UFID"
424                  "\x00\x00\x00\x09"
425                  "\x00\x00"
426                  "owner\x00"
427                  "\x01\x02\x03", 19),
428       f.render());
429   }
430   void testParseUrlLinkFrame()
431   {
432     ID3v2::UrlLinkFrame f(
433       ByteVector("WOAF"                                       "\x00\x00\x00\x12"                           "\x00\x00"                                   "http://example.com", 28));     CPPUNIT_ASSERT_EQUAL(String("http://example.com"), f.url());
434   }
435   void testRenderUrlLinkFrame()
436   {
437     ID3v2::UrlLinkFrame f("WOAF");
438     f.setUrl("http://example.com");
439     CPPUNIT_ASSERT_EQUAL(
440       ByteVector("WOAF"                                       "\x00\x00\x00\x12"                           "\x00\x00"                                   "http://example.com", 28),        f.render());
441   }
442   void testParseUserUrlLinkFrame()
443   {
444     ID3v2::UserUrlLinkFrame f(
445       ByteVector("WXXX"                                       "\x00\x00\x00\x17"                           "\x00\x00"                                   "\x00"                                       "foo\x00"                                    "http://example.com", 33));     CPPUNIT_ASSERT_EQUAL(String("foo"), f.description());
446     CPPUNIT_ASSERT_EQUAL(String("http://example.com"), f.url());
447   }
448   void testRenderUserUrlLinkFrame()
449   {
450     ID3v2::UserUrlLinkFrame f;
451     f.setDescription("foo");
452     f.setUrl("http://example.com");
453     CPPUNIT_ASSERT_EQUAL(
454       ByteVector("WXXX"                                       "\x00\x00\x00\x17"                           "\x00\x00"                                   "\x00"                                       "foo\x00"                                    "http://example.com", 33),        f.render());
455   }
456   void testParseOwnershipFrame()
457   {
458     ID3v2::OwnershipFrame f(</b></font>
459                             ByteVector("OWNE"                                                             "\x00\x00\x00\x19"                                                 "\x00\x00"                                                         "\x00"                                                             "GBP1.99\x00"                                                      "20120905"                                                         "Beatport", 35));               CPPUNIT_ASSERT_EQUAL(String("GBP1.99"), f.pricePaid());
460     CPPUNIT_ASSERT_EQUAL(String("20120905"), f.datePurchased());
461     CPPUNIT_ASSERT_EQUAL(String("Beatport"), f.seller());
462   }
463   void testRenderOwnershipFrame()
464   {
465     ID3v2::OwnershipFrame f;
466     f.setPricePaid("GBP1.99");
467     f.setDatePurchased("20120905");
468     f.setSeller("Beatport");
469     CPPUNIT_ASSERT_EQUAL(
470                          ByteVector("OWNE"                                                          "\x00\x00\x00\x19"                                              "\x00\x00"                                                      "\x00"                                                          "GBP1.99\x00"                                                   "20120905"                                                      "Beatport", 35),                           f.render());
471   }
472   void testParseSynchronizedLyricsFrame()
473   {
474     ID3v2::SynchronizedLyricsFrame f(
475       ByteVector("SYLT"                                       "\x00\x00\x00\x21"                           "\x00\x00"                                   "\x00"                                       "eng"                                        "\x02"                                       "\x01"                                       "foo\x00"                                    "Example\x00"                                "\x00\x00\x04\xd2"                           "Lyrics\x00"                                 "\x00\x00\x11\xd7", 43));       CPPUNIT_ASSERT_EQUAL(String::Latin1, f.textEncoding());
476     CPPUNIT_ASSERT_EQUAL(ByteVector("eng", 3), f.language());
477     CPPUNIT_ASSERT_EQUAL(ID3v2::SynchronizedLyricsFrame::AbsoluteMilliseconds,
478                          f.timestampFormat());
479     CPPUNIT_ASSERT_EQUAL(ID3v2::SynchronizedLyricsFrame::Lyrics, f.type());
480     CPPUNIT_ASSERT_EQUAL(String("foo"), f.description());
481     ID3v2::SynchronizedLyricsFrame::SynchedTextList stl = f.synchedText();
482     CPPUNIT_ASSERT_EQUAL((unsigned int)2, stl.size());
483     CPPUNIT_ASSERT_EQUAL(String("Example"), stl[0].text);
484     CPPUNIT_ASSERT_EQUAL((unsigned int)1234, stl[0].time);
485     CPPUNIT_ASSERT_EQUAL(String("Lyrics"), stl[1].text);
486     CPPUNIT_ASSERT_EQUAL((unsigned int)4567, stl[1].time);
487   }
488   void testParseSynchronizedLyricsFrameWithEmptyDescritpion()
489   {
490     ID3v2::SynchronizedLyricsFrame f(
491       ByteVector("SYLT"                                       "\x00\x00\x00\x21"                           "\x00\x00"                                   "\x00"                                       "eng"                                        "\x02"                                       "\x01"                                       "\x00"                                       "Example\x00"                                "\x00\x00\x04\xd2"                           "Lyrics\x00"                                 "\x00\x00\x11\xd7", 40));       CPPUNIT_ASSERT_EQUAL(String::Latin1, f.textEncoding());
492     CPPUNIT_ASSERT_EQUAL(ByteVector("eng", 3), f.language());
493     CPPUNIT_ASSERT_EQUAL(ID3v2::SynchronizedLyricsFrame::AbsoluteMilliseconds,
494                          f.timestampFormat());
495     CPPUNIT_ASSERT_EQUAL(ID3v2::SynchronizedLyricsFrame::Lyrics, f.type());
496     CPPUNIT_ASSERT(f.description().isEmpty());
497     ID3v2::SynchronizedLyricsFrame::SynchedTextList stl = f.synchedText();
498     CPPUNIT_ASSERT_EQUAL((unsigned int)2, stl.size());
499     CPPUNIT_ASSERT_EQUAL(String("Example"), stl[0].text);
500     CPPUNIT_ASSERT_EQUAL((unsigned int)1234, stl[0].time);
501     CPPUNIT_ASSERT_EQUAL(String("Lyrics"), stl[1].text);
502     CPPUNIT_ASSERT_EQUAL((unsigned int)4567, stl[1].time);
503   }
504   void testRenderSynchronizedLyricsFrame()
505   {
506     ID3v2::SynchronizedLyricsFrame f;
507     f.setTextEncoding(String::Latin1);
508     f.setLanguage(ByteVector("eng", 3));
509     f.setTimestampFormat(ID3v2::SynchronizedLyricsFrame::AbsoluteMilliseconds);
510     f.setType(ID3v2::SynchronizedLyricsFrame::Lyrics);
511     f.setDescription("foo");
512     ID3v2::SynchronizedLyricsFrame::SynchedTextList stl;
513     stl.append(ID3v2::SynchronizedLyricsFrame::SynchedText(1234, "Example"));
514     stl.append(ID3v2::SynchronizedLyricsFrame::SynchedText(4567, "Lyrics"));
515     f.setSynchedText(stl);
516     CPPUNIT_ASSERT_EQUAL(
517       ByteVector("SYLT"                                       "\x00\x00\x00\x21"                           "\x00\x00"                                   "\x00"                                       "eng"                                        "\x02"                                       "\x01"                                       "foo\x00"                                    "Example\x00"                                "\x00\x00\x04\xd2"                           "Lyrics\x00"                                 "\x00\x00\x11\xd7", 43),          f.render());
518   }
519   void testParseEventTimingCodesFrame()
520   {
521     ID3v2::EventTimingCodesFrame f(
522       ByteVector("ETCO"                                       "\x00\x00\x00\x0b"                           "\x00\x00"                                   "\x02"                                       "\x02"                                       "\x00\x00\xf3\x5c"                           "\xfe"                                       "\x00\x36\xee\x80", 21));       CPPUNIT_ASSERT_EQUAL(ID3v2::EventTimingCodesFrame::AbsoluteMilliseconds,
523                          f.timestampFormat());
524     ID3v2::EventTimingCodesFrame::SynchedEventList sel = f.synchedEvents();
525     CPPUNIT_ASSERT_EQUAL((unsigned int)2, sel.size());
526     CPPUNIT_ASSERT_EQUAL(ID3v2::EventTimingCodesFrame::IntroStart, sel[0].type);
527     CPPUNIT_ASSERT_EQUAL((unsigned int)62300, sel[0].time);
528     CPPUNIT_ASSERT_EQUAL(ID3v2::EventTimingCodesFrame::AudioFileEnds, sel[1].type);
529     CPPUNIT_ASSERT_EQUAL((unsigned int)3600000, sel[1].time);
530   }
531   void testRenderEventTimingCodesFrame()
532   {
533     ID3v2::EventTimingCodesFrame f;
534 <a name="1"></a>    f.setTimestampFormat(ID3v2::EventTimingCodesFrame::AbsoluteMilliseconds);
535     ID3v2::EventTimingCodesFrame::SynchedEventList sel;
536     sel.append(ID3v2::EventTimingCodesFrame::SynchedEvent(62300, ID3v2::EventTimingCodesFrame::IntroStart));
537 <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>    sel.append(ID3v2::EventTimingCodesFrame::SynchedEvent(3600000, ID3v2::EventTimingCodesFrame::AudioFileEnds));
538     f.setSynchedEvents(sel);
539     CPPUNIT_ASSERT_EQUAL(
540       ByteVector("ETCO"                                       "\x00\x00\x00\x0b"                           "\x00\x00"                                   "\x02"                                       "\x02"                                       "\x00\x00\xf3\x5c"                           "\xfe"                                       "\x00\x36\xee\x80", 21),          f.render());
541   }
542   void testParseCommentsFrame()
543   {
544     ID3v2::CommentsFrame f(
545       ByteVector("COMM"
546                  "\x00\x00\x00\x14"
547                  "\x00\x00"
548                  "\x03"
549                  "deu"
550                  "Description\x00"
551                  "Text", 30));
552     CPPUNIT_ASSERT_EQUAL(String::UTF8, f.textEncoding());
553     CPPUNIT_ASSERT_EQUAL(ByteVector("deu"), f.language());
554     CPPUNIT_ASSERT_EQUAL(String("Description"), f.description());
555     CPPUNIT_ASSERT_EQUAL(String("Text"), f.text());
556   }
557   void testRenderCommentsFrame()
558   {
559     ID3v2::CommentsFrame f;
560     f.setTextEncoding(String::UTF16);
561     f.setLanguage("eng");
562     f.setDescription("Description");
563     f.setText("Text");
564     CPPUNIT_ASSERT_EQUAL(
565       ByteVector("COMM"
566                  "\x00\x00\x00\x28"
567                  "\x00\x00"
568                  "\x01"
569                  "eng"
570                  "\xff\xfe" "D\0e\0s\0c\0r\0i\0p\0t\0i\0o\0n\0" "\x00\x00"
571                  "\xff\xfe" "T\0e\0x\0t\0", 50),
572       f.render());
573   }
574   void testParsePodcastFrame()
575   {
576     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();</b></font>
577     ByteVector data = ByteVector("PCST"
578                                  "\x00\x00\x00\x04"
579                                  "\x00\x00"
580                                  "\x00\x00\x00\x00", 14);
581 <a name="3"></a>    const ID3v2::Header header;
582     CPPUNIT_ASSERT(dynamic_cast&lt;ID3v2::PodcastFrame *&gt;(
583                      factory-&gt;createFrame(data, &amp;header)));
584 <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>  }
585   void testRenderPodcastFrame()
586   {
587     ID3v2::PodcastFrame f;
588     CPPUNIT_ASSERT_EQUAL(
589       ByteVector("PCST"
590                  "\x00\x00\x00\x04"
591                  "\x00\x00"
592                  "\x00\x00\x00\x00", 14),
593       f.render());
594   }
595   void testParsePrivateFrame()
596   {
597     ID3v2::PrivateFrame f(
598       ByteVector("PRIV"
599                  "\x00\x00\x00\x0e"
600                  "\x00\x00"
601                  "WM/Provider\x00"
602                  "TL", 24));
603     CPPUNIT_ASSERT_EQUAL(String("WM/Provider"), f.owner());
604     CPPUNIT_ASSERT_EQUAL(ByteVector("TL"), f.data());
605   }
606   void testRenderPrivateFrame()
607   {
608     ID3v2::PrivateFrame f;</b></font>
609     f.setOwner("WM/Provider");
610     f.setData("TL");
611     CPPUNIT_ASSERT_EQUAL(
612       ByteVector("PRIV"
613                  "\x00\x00\x00\x0e"
614                  "\x00\x00"
615                  "WM/Provider\x00"
616                  "TL", 24),
617       f.render());
618   }
619   void testItunes24FrameSize()
620   {
621     MPEG::File f(TEST_FILE_PATH_C("005411.id3"), false);
622     CPPUNIT_ASSERT(f.tag());
623     CPPUNIT_ASSERT(f.ID3v2Tag()-&gt;frameListMap().contains("TIT2"));
624     CPPUNIT_ASSERT_EQUAL(String("Sunshine Superman"), f.ID3v2Tag()-&gt;frameListMap()["TIT2"].front()-&gt;toString());
625   }
626   void testSaveUTF16Comment()
627   {
628     String::Type defaultEncoding = ID3v2::FrameFactory::instance()-&gt;defaultTextEncoding();
629     ScopedFileCopy copy("xing", ".mp3");
630     string newname = copy.fileName();
631     ID3v2::FrameFactory::instance()-&gt;setDefaultTextEncoding(String::UTF16);
632     {
633       MPEG::File foo(newname.c_str());
634       foo.strip();
635       foo.tag()-&gt;setComment("Test comment!");
636       foo.save();
637     }
638     {
639       MPEG::File bar(newname.c_str());
640       CPPUNIT_ASSERT_EQUAL(String("Test comment!"), bar.tag()-&gt;comment());
641       ID3v2::FrameFactory::instance()-&gt;setDefaultTextEncoding(defaultEncoding);
642     }
643   }
644   void testUpdateGenre23_1()
645   {
646     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();
647     ByteVector data = ByteVector("TCON"                                                  "\x00\x00\x00\x10"                                      "\x00\x00"                                              "\x00"                                                  "(22)Death Metal", 26);         ID3v2::Header header;
648     header.setMajorVersion(3);
649     ID3v2::TextIdentificationFrame *frame =
650       dynamic_cast&lt;TagLib::ID3v2::TextIdentificationFrame*&gt;(factory-&gt;createFrame(data, &amp;header));
651     CPPUNIT_ASSERT_EQUAL((unsigned int)1, frame-&gt;fieldList().size());
652     CPPUNIT_ASSERT_EQUAL(String("Death Metal"), frame-&gt;fieldList()[0]);
653     ID3v2::Tag tag;
654     tag.addFrame(frame);
655     CPPUNIT_ASSERT_EQUAL(String("Death Metal"), tag.genre());
656   }
657   void testUpdateGenre23_2()
658   {
659     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();
660     ByteVector data = ByteVector("TCON"                                                  "\x00\x00\x00\x0d"                                      "\x00\x00"                                              "\x00"                                                  "(4)Eurodisco", 23);       ID3v2::Header header;
661     header.setMajorVersion(3);
662     ID3v2::TextIdentificationFrame *frame =
663       dynamic_cast&lt;TagLib::ID3v2::TextIdentificationFrame*&gt;(factory-&gt;createFrame(data, &amp;header));
664     CPPUNIT_ASSERT_EQUAL((unsigned int)2, frame-&gt;fieldList().size());
665     CPPUNIT_ASSERT_EQUAL(String("4"), frame-&gt;fieldList()[0]);
666     CPPUNIT_ASSERT_EQUAL(String("Eurodisco"), frame-&gt;fieldList()[1]);
667     ID3v2::Tag tag;
668     tag.addFrame(frame);
669     CPPUNIT_ASSERT_EQUAL(String("Disco Eurodisco"), tag.genre());
670   }
671   void testUpdateGenre23_3()
672   {
673     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();
674     ByteVector data = ByteVector("TCON"                                                  "\x00\x00\x00\x15"                                      "\x00\x00"                                              "\x00"                                                  "(9)(138)Viking Metal", 31);       ID3v2::Header header;
675     header.setMajorVersion(3);
676     ID3v2::TextIdentificationFrame *frame =
677       dynamic_cast&lt;TagLib::ID3v2::TextIdentificationFrame*&gt;(factory-&gt;createFrame(data, &amp;header));
678     CPPUNIT_ASSERT_EQUAL(3U, frame-&gt;fieldList().size());
679     CPPUNIT_ASSERT_EQUAL(String("9"), frame-&gt;fieldList()[0]);
680     CPPUNIT_ASSERT_EQUAL(String("138"), frame-&gt;fieldList()[1]);
681     CPPUNIT_ASSERT_EQUAL(String("Viking Metal"), frame-&gt;fieldList()[2]);
682     ID3v2::Tag tag;
683     tag.addFrame(frame);
684     CPPUNIT_ASSERT_EQUAL(String("Metal Black Metal Viking Metal"), tag.genre());
685   }
686   void testUpdateGenre24()
687   {
688     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();
689     ByteVector data = ByteVector("TCON"                                                    "\x00\x00\x00\x0D"                                        "\x00\x00"                                                "\0"                                                    "14\0Eurodisco", 23);         ID3v2::Header header;
690     ID3v2::TextIdentificationFrame *frame =
691       dynamic_cast&lt;TagLib::ID3v2::TextIdentificationFrame*&gt;(factory-&gt;createFrame(data, &amp;header));
692     CPPUNIT_ASSERT_EQUAL((unsigned int)2, frame-&gt;fieldList().size());
693     CPPUNIT_ASSERT_EQUAL(String("14"), frame-&gt;fieldList()[0]);
694     CPPUNIT_ASSERT_EQUAL(String("Eurodisco"), frame-&gt;fieldList()[1]);
695     ID3v2::Tag tag;
696     tag.addFrame(frame);
697     CPPUNIT_ASSERT_EQUAL(String("R&amp;B Eurodisco"), tag.genre());
698   }
699   void testUpdateDate22()
700   {
701     MPEG::File f(TEST_FILE_PATH_C("id3v22-tda.mp3"), false);
702     CPPUNIT_ASSERT(f.tag());
703     CPPUNIT_ASSERT_EQUAL((unsigned int)2010, f.tag()-&gt;year());
704   }
705   void testUpdateFullDate22()
706   {
707     MPEG::File f(TEST_FILE_PATH_C("id3v22-tda.mp3"), false);
708     CPPUNIT_ASSERT(f.tag());
709     CPPUNIT_ASSERT_EQUAL(String("2010-04-03"), f.ID3v2Tag()-&gt;frameListMap()["TDRC"].front()-&gt;toString());
710   }
711   void testDowngradeTo23()
712   {
713     ScopedFileCopy copy("xing", ".mp3");
714     string newname = copy.fileName();
715     ID3v2::TextIdentificationFrame *tf;
716     {
717       MPEG::File foo(newname.c_str());
718       tf = new ID3v2::TextIdentificationFrame("TDOR", String::Latin1);
719       tf-&gt;setText("2011-03-16");
720       foo.ID3v2Tag()-&gt;addFrame(tf);
721       tf = new ID3v2::TextIdentificationFrame("TDRC", String::Latin1);
722       tf-&gt;setText("2012-04-17T12:01");
723       foo.ID3v2Tag()-&gt;addFrame(tf);
724       tf = new ID3v2::TextIdentificationFrame("TMCL", String::Latin1);
725       tf-&gt;setText(StringList().append("Guitar").append("Artist 1").append("Drums").append("Artist 2"));
726       foo.ID3v2Tag()-&gt;addFrame(tf);
727       tf = new ID3v2::TextIdentificationFrame("TIPL", String::Latin1);
728       tf-&gt;setText(StringList().append("Producer").append("Artist 3").append("Mastering").append("Artist 4"));
729       foo.ID3v2Tag()-&gt;addFrame(tf);
730       tf = new ID3v2::TextIdentificationFrame("TCON", String::Latin1);
731       tf-&gt;setText(StringList().append("51").append("Noise").append("Power Noise"));
732       foo.ID3v2Tag()-&gt;addFrame(tf);
733       foo.ID3v2Tag()-&gt;addFrame(new ID3v2::TextIdentificationFrame("TDRL", String::Latin1));
734       foo.ID3v2Tag()-&gt;addFrame(new ID3v2::TextIdentificationFrame("TDTG", String::Latin1));
735       foo.ID3v2Tag()-&gt;addFrame(new ID3v2::TextIdentificationFrame("TMOO", String::Latin1));
736       foo.ID3v2Tag()-&gt;addFrame(new ID3v2::TextIdentificationFrame("TPRO", String::Latin1));
737       foo.ID3v2Tag()-&gt;addFrame(new ID3v2::TextIdentificationFrame("TSOA", String::Latin1));
738       foo.ID3v2Tag()-&gt;addFrame(new ID3v2::TextIdentificationFrame("TSOT", String::Latin1));
739       foo.ID3v2Tag()-&gt;addFrame(new ID3v2::TextIdentificationFrame("TSST", String::Latin1));
740       foo.ID3v2Tag()-&gt;addFrame(new ID3v2::TextIdentificationFrame("TSOP", String::Latin1));
741       foo.save(MPEG::File::AllTags, File::StripOthers, ID3v2::v3);
742     }
743     {
744       MPEG::File bar(newname.c_str());
745       tf = dynamic_cast&lt;ID3v2::TextIdentificationFrame *&gt;(bar.ID3v2Tag()-&gt;frameList("TDOR").front());
746       CPPUNIT_ASSERT(tf);
747       CPPUNIT_ASSERT_EQUAL((unsigned int)1, tf-&gt;fieldList().size());
748       CPPUNIT_ASSERT_EQUAL(String("2011"), tf-&gt;fieldList().front());
749       tf = dynamic_cast&lt;ID3v2::TextIdentificationFrame *&gt;(bar.ID3v2Tag()-&gt;frameList("TDRC").front());
750       CPPUNIT_ASSERT(tf);
751       CPPUNIT_ASSERT_EQUAL((unsigned int)1, tf-&gt;fieldList().size());
752       CPPUNIT_ASSERT_EQUAL(String("2012-04-17T12:01"), tf-&gt;fieldList().front());
753       tf = dynamic_cast&lt;ID3v2::TextIdentificationFrame *&gt;(bar.ID3v2Tag()-&gt;frameList("TIPL").front());
754       CPPUNIT_ASSERT(tf);
755       CPPUNIT_ASSERT_EQUAL((unsigned int)8, tf-&gt;fieldList().size());
756       CPPUNIT_ASSERT_EQUAL(String("Guitar"), tf-&gt;fieldList()[0]);
757       CPPUNIT_ASSERT_EQUAL(String("Artist 1"), tf-&gt;fieldList()[1]);
758       CPPUNIT_ASSERT_EQUAL(String("Drums"), tf-&gt;fieldList()[2]);
759       CPPUNIT_ASSERT_EQUAL(String("Artist 2"), tf-&gt;fieldList()[3]);
760       CPPUNIT_ASSERT_EQUAL(String("Producer"), tf-&gt;fieldList()[4]);
761       CPPUNIT_ASSERT_EQUAL(String("Artist 3"), tf-&gt;fieldList()[5]);
762       CPPUNIT_ASSERT_EQUAL(String("Mastering"), tf-&gt;fieldList()[6]);
763       CPPUNIT_ASSERT_EQUAL(String("Artist 4"), tf-&gt;fieldList()[7]);
764       tf = dynamic_cast&lt;ID3v2::TextIdentificationFrame *&gt;(bar.ID3v2Tag()-&gt;frameList("TCON").front());
765       CPPUNIT_ASSERT(tf);
766       CPPUNIT_ASSERT_EQUAL(3U, tf-&gt;fieldList().size());
767       CPPUNIT_ASSERT_EQUAL(String("51"), tf-&gt;fieldList()[0]);
768       CPPUNIT_ASSERT_EQUAL(String("39"), tf-&gt;fieldList()[1]);
769       CPPUNIT_ASSERT_EQUAL(String("Power Noise"), tf-&gt;fieldList()[2]);
770       CPPUNIT_ASSERT(!bar.ID3v2Tag()-&gt;frameListMap().contains("TDRL"));
771       CPPUNIT_ASSERT(!bar.ID3v2Tag()-&gt;frameListMap().contains("TDTG"));
772       CPPUNIT_ASSERT(!bar.ID3v2Tag()-&gt;frameListMap().contains("TMOO"));
773       CPPUNIT_ASSERT(!bar.ID3v2Tag()-&gt;frameListMap().contains("TPRO"));
774 #ifdef NO_ITUNES_HACKS
775       CPPUNIT_ASSERT(!bar.ID3v2Tag()-&gt;frameListMap().contains("TSOA"));
776       CPPUNIT_ASSERT(!bar.ID3v2Tag()-&gt;frameListMap().contains("TSOT"));
777       CPPUNIT_ASSERT(!bar.ID3v2Tag()-&gt;frameListMap().contains("TSOP"));
778 #endif
779       CPPUNIT_ASSERT(!bar.ID3v2Tag()-&gt;frameListMap().contains("TSST"));
780     }
781     {
782       const ByteVector expectedId3v23Data(
783             "ID3" "\x03\x00\x00\x00\x00\x09\x49"
784             "TSOA" "\x00\x00\x00\x01\x00\x00\x00"
785             "TSOT" "\x00\x00\x00\x01\x00\x00\x00"
786             "TSOP" "\x00\x00\x00\x01\x00\x00\x00"
787             "TORY" "\x00\x00\x00\x05\x00\x00\x00" "2011"
788             "TYER" "\x00\x00\x00\x05\x00\x00\x00" "2012"
789             "TDAT" "\x00\x00\x00\x05\x00\x00\x00" "1704"
790             "TIME" "\x00\x00\x00\x05\x00\x00\x00" "1201"
791             "IPLS" "\x00\x00\x00\x44\x00\x00\x00" "Guitar" "\x00"
792             "Artist 1" "\x00" "Drums" "\x00" "Artist 2" "\x00" "Producer" "\x00"
793             "Artist 3" "\x00" "Mastering" "\x00" "Artist 4"
794             "TCON" "\x00\x00\x00\x14\x00\x00\x00" "(51)(39)Power Noise", 211);
795       const ByteVector actualId3v23Data =
796           PlainFile(newname.c_str()).readBlock(expectedId3v23Data.size());
797       CPPUNIT_ASSERT_EQUAL(expectedId3v23Data, actualId3v23Data);
798     }
799     ScopedFileCopy rareFramesCopy("rare_frames", ".mp3");
800     {
801       MPEG::File f(rareFramesCopy.fileName().c_str());
802       f.save(MPEG::File::AllTags, File::StripOthers, ID3v2::v3);
803       f.seek(f.find("TCON") + 11);
804       CPPUNIT_ASSERT_EQUAL(ByteVector("(13)"), f.readBlock(4));
805     }
806   }
807   void testCompressedFrameWithBrokenLength()
808   {
809     MPEG::File f(TEST_FILE_PATH_C("compressed_id3_frame.mp3"), false);
810     CPPUNIT_ASSERT(f.ID3v2Tag()-&gt;frameListMap().contains("APIC"));
811     if(zlib::isAvailable()) {
812       ID3v2::AttachedPictureFrame *frame
813         = dynamic_cast&lt;TagLib::ID3v2::AttachedPictureFrame*&gt;(f.ID3v2Tag()-&gt;frameListMap()["APIC"].front());
814       CPPUNIT_ASSERT(frame);
815       CPPUNIT_ASSERT_EQUAL(String("image/bmp"), frame-&gt;mimeType());
816       CPPUNIT_ASSERT_EQUAL(ID3v2::AttachedPictureFrame::Other, frame-&gt;type());
817       CPPUNIT_ASSERT_EQUAL(String(""), frame-&gt;description());
818       CPPUNIT_ASSERT_EQUAL((unsigned int)86414, frame-&gt;picture().size());
819     }
820     else {
821       ID3v2::UnknownFrame *frame
822         = dynamic_cast&lt;TagLib::ID3v2::UnknownFrame*&gt;(f.ID3v2Tag()-&gt;frameListMap()["APIC"].front());
823       CPPUNIT_ASSERT(frame);
824     }
825   }
826   void testW000()
827   {
828     MPEG::File f(TEST_FILE_PATH_C("w000.mp3"), false);
829     CPPUNIT_ASSERT(f.ID3v2Tag()-&gt;frameListMap().contains("W000"));
830     ID3v2::UrlLinkFrame *frame =
831     dynamic_cast&lt;TagLib::ID3v2::UrlLinkFrame*&gt;(f.ID3v2Tag()-&gt;frameListMap()["W000"].front());
832     CPPUNIT_ASSERT(frame);
833     CPPUNIT_ASSERT_EQUAL(String("lukas.lalinsky@example.com____"), frame-&gt;url());
834   }
835   void testPropertyInterface()
836   {
837     ScopedFileCopy copy("rare_frames", ".mp3");
838     string newname = copy.fileName();
839     MPEG::File f(newname.c_str());
840     PropertyMap dict = f.ID3v2Tag(false)-&gt;properties();
841     CPPUNIT_ASSERT_EQUAL((unsigned int)6, dict.size());
842     CPPUNIT_ASSERT(dict.contains("USERTEXTDESCRIPTION1"));
843     CPPUNIT_ASSERT(dict.contains("QuodLibet::USERTEXTDESCRIPTION2"));
844     CPPUNIT_ASSERT_EQUAL((unsigned int)2, dict["USERTEXTDESCRIPTION1"].size());
845     CPPUNIT_ASSERT_EQUAL((unsigned int)2, dict["QuodLibet::USERTEXTDESCRIPTION2"].size());
846     CPPUNIT_ASSERT_EQUAL(String("userTextData1"), dict["USERTEXTDESCRIPTION1"][0]);
847     CPPUNIT_ASSERT_EQUAL(String("userTextData2"), dict["USERTEXTDESCRIPTION1"][1]);
848     CPPUNIT_ASSERT_EQUAL(String("userTextData1"), dict["QuodLibet::USERTEXTDESCRIPTION2"][0]);
849     CPPUNIT_ASSERT_EQUAL(String("userTextData2"), dict["QuodLibet::USERTEXTDESCRIPTION2"][1]);
850     CPPUNIT_ASSERT_EQUAL(String("Pop"), dict["GENRE"].front());
851     CPPUNIT_ASSERT_EQUAL(String("http://a.user.url"), dict["URL:USERURL"].front());
852     CPPUNIT_ASSERT_EQUAL(String("http://a.user.url/with/empty/description"), dict["URL"].front());
853     CPPUNIT_ASSERT_EQUAL(String("A COMMENT"), dict["COMMENT"].front());
854     CPPUNIT_ASSERT_EQUAL(1u, dict.unsupportedData().size());
855     CPPUNIT_ASSERT_EQUAL(String("UFID/supermihi@web.de"), dict.unsupportedData().front());
856   }
857   void testPropertyInterface2()
858   {
859     ID3v2::Tag tag;
860     ID3v2::UnsynchronizedLyricsFrame *frame1 = new ID3v2::UnsynchronizedLyricsFrame();
861     frame1-&gt;setDescription("test");
862     frame1-&gt;setText("la-la-la test");
863     tag.addFrame(frame1);
864     ID3v2::UnsynchronizedLyricsFrame *frame2 = new ID3v2::UnsynchronizedLyricsFrame();
865     frame2-&gt;setDescription("");
866     frame2-&gt;setText("la-la-la nodescription");
867     tag.addFrame(frame2);
868     ID3v2::AttachedPictureFrame *frame3 = new ID3v2::AttachedPictureFrame();
869     frame3-&gt;setDescription("test picture");
870     tag.addFrame(frame3);
871     ID3v2::TextIdentificationFrame *frame4 = new ID3v2::TextIdentificationFrame("TIPL");
872     frame4-&gt;setText("single value is invalid for TIPL");
873     tag.addFrame(frame4);
874     ID3v2::TextIdentificationFrame *frame5 = new ID3v2::TextIdentificationFrame("TMCL");
875     StringList tmclData;
876     tmclData.append("VIOLIN");
877     tmclData.append("a violinist");
878     tmclData.append("PIANO");
879     tmclData.append("a pianist");
880     frame5-&gt;setText(tmclData);
881     tag.addFrame(frame5);
882     ID3v2::UniqueFileIdentifierFrame *frame6 = new ID3v2::UniqueFileIdentifierFrame("http://musicbrainz.org", "152454b9-19ba-49f3-9fc9-8fc26545cf41");
883     tag.addFrame(frame6);
884     ID3v2::UniqueFileIdentifierFrame *frame7 = new ID3v2::UniqueFileIdentifierFrame("http://example.com", "123");
885     tag.addFrame(frame7);
886     ID3v2::UserTextIdentificationFrame *frame8 = new ID3v2::UserTextIdentificationFrame();
887     frame8-&gt;setDescription("MusicBrainz Album Id");
888     frame8-&gt;setText("95c454a5-d7e0-4d8f-9900-db04aca98ab3");
889     tag.addFrame(frame8);
890     PropertyMap properties = tag.properties();
891     CPPUNIT_ASSERT_EQUAL(3u, properties.unsupportedData().size());
892     CPPUNIT_ASSERT(properties.unsupportedData().contains("TIPL"));
893     CPPUNIT_ASSERT(properties.unsupportedData().contains("APIC"));
894     CPPUNIT_ASSERT(properties.unsupportedData().contains("UFID/http://example.com"));
895     CPPUNIT_ASSERT(properties.contains("PERFORMER:VIOLIN"));
896     CPPUNIT_ASSERT(properties.contains("PERFORMER:PIANO"));
897     CPPUNIT_ASSERT_EQUAL(String("a violinist"), properties["PERFORMER:VIOLIN"].front());
898     CPPUNIT_ASSERT_EQUAL(String("a pianist"), properties["PERFORMER:PIANO"].front());
899     CPPUNIT_ASSERT(properties.contains("LYRICS"));
900     CPPUNIT_ASSERT(properties.contains("LYRICS:TEST"));
901     CPPUNIT_ASSERT(properties.contains("MUSICBRAINZ_TRACKID"));
902     CPPUNIT_ASSERT_EQUAL(String("152454b9-19ba-49f3-9fc9-8fc26545cf41"), properties["MUSICBRAINZ_TRACKID"].front());
903     CPPUNIT_ASSERT(properties.contains("MUSICBRAINZ_ALBUMID"));
904     CPPUNIT_ASSERT_EQUAL(String("95c454a5-d7e0-4d8f-9900-db04aca98ab3"), properties["MUSICBRAINZ_ALBUMID"].front());
905     tag.removeUnsupportedProperties(properties.unsupportedData());
906     CPPUNIT_ASSERT(tag.frameList("APIC").isEmpty());
907     CPPUNIT_ASSERT(tag.frameList("TIPL").isEmpty());
908     CPPUNIT_ASSERT_EQUAL((ID3v2::UniqueFileIdentifierFrame *)0, ID3v2::UniqueFileIdentifierFrame::findByOwner(&amp;tag, "http://example.com"));
909     CPPUNIT_ASSERT_EQUAL(frame6, ID3v2::UniqueFileIdentifierFrame::findByOwner(&amp;tag, "http://musicbrainz.org"));
910   }
911   void testPropertiesMovement()
912   {
913     ID3v2::Tag tag;
914     ID3v2::TextIdentificationFrame *frameMvnm = new ID3v2::TextIdentificationFrame("MVNM");
915     frameMvnm-&gt;setText("Movement Name");
916     tag.addFrame(frameMvnm);
917     ID3v2::TextIdentificationFrame *frameMvin = new ID3v2::TextIdentificationFrame("MVIN");
918     frameMvin-&gt;setText("2/3");
919     tag.addFrame(frameMvin);
920     PropertyMap properties = tag.properties();
921     CPPUNIT_ASSERT(properties.contains("MOVEMENTNAME"));
922     CPPUNIT_ASSERT(properties.contains("MOVEMENTNUMBER"));
923     CPPUNIT_ASSERT_EQUAL(String("Movement Name"), properties["MOVEMENTNAME"].front());
924     CPPUNIT_ASSERT_EQUAL(String("2/3"), properties["MOVEMENTNUMBER"].front());
925     ByteVector frameDataMvnm("MVNM"
926                              "\x00\x00\x00\x0e"
927                              "\x00\x00"
928                              "\x00"
929                              "Movement Name", 24);
930     CPPUNIT_ASSERT_EQUAL(frameDataMvnm, frameMvnm-&gt;render());
931     ByteVector frameDataMvin("MVIN"
932                              "\x00\x00\x00\x04"
933                              "\x00\x00"
934                              "\x00"
935                              "2/3", 14);
936     CPPUNIT_ASSERT_EQUAL(frameDataMvin, frameMvin-&gt;render());
937     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();
938     ID3v2::Header header;
939     ID3v2::TextIdentificationFrame *parsedFrameMvnm =
940       dynamic_cast&lt;ID3v2::TextIdentificationFrame *&gt;(
941         factory-&gt;createFrame(frameDataMvnm, &amp;header));
942     ID3v2::TextIdentificationFrame *parsedFrameMvin =
943       dynamic_cast&lt;ID3v2::TextIdentificationFrame *&gt;(
944         factory-&gt;createFrame(frameDataMvin, &amp;header));
945     CPPUNIT_ASSERT(parsedFrameMvnm);
946     CPPUNIT_ASSERT(parsedFrameMvin);
947     CPPUNIT_ASSERT_EQUAL(String("Movement Name"), parsedFrameMvnm-&gt;toString());
948     CPPUNIT_ASSERT_EQUAL(String("2/3"), parsedFrameMvin-&gt;toString());
949     tag.addFrame(parsedFrameMvnm);
950     tag.addFrame(parsedFrameMvin);
951   }
952   void testPropertyGrouping()
953   {
954     ID3v2::Tag tag;
955     ID3v2::TextIdentificationFrame *frameGrp1 = new ID3v2::TextIdentificationFrame("GRP1");
956     frameGrp1-&gt;setText("Grouping");
957     tag.addFrame(frameGrp1);
958     PropertyMap properties = tag.properties();
959     CPPUNIT_ASSERT(properties.contains("GROUPING"));
960     CPPUNIT_ASSERT_EQUAL(String("Grouping"), properties["GROUPING"].front());
961     ByteVector frameDataGrp1("GRP1"
962                              "\x00\x00\x00\x09"
963                              "\x00\x00"
964                              "\x00"
965                              "Grouping", 19);
966     CPPUNIT_ASSERT_EQUAL(frameDataGrp1, frameGrp1-&gt;render());
967     ID3v2::FrameFactory *factory = ID3v2::FrameFactory::instance();
968     ID3v2::Header header;
969     ID3v2::TextIdentificationFrame *parsedFrameGrp1 =
970       dynamic_cast&lt;ID3v2::TextIdentificationFrame *&gt;(
971         factory-&gt;createFrame(frameDataGrp1, &amp;header));
972     CPPUNIT_ASSERT(parsedFrameGrp1);
973     CPPUNIT_ASSERT_EQUAL(String("Grouping"), parsedFrameGrp1-&gt;toString());
974     tag.addFrame(parsedFrameGrp1);
975   }
976   void testDeleteFrame()
977   {
978     ScopedFileCopy copy("rare_frames", ".mp3");
979     string newname = copy.fileName();
980     {
981       MPEG::File f(newname.c_str());
982       ID3v2::Tag *t = f.ID3v2Tag();
983       ID3v2::Frame *frame = t-&gt;frameList("TCON")[0];
984       CPPUNIT_ASSERT_EQUAL(1u, t-&gt;frameList("TCON").size());
985       t-&gt;removeFrame(frame, true);
986       f.save(MPEG::File::ID3v2);
987     }
988     {
989       MPEG::File f2(newname.c_str());
990       ID3v2::Tag *t = f2.ID3v2Tag();
991       CPPUNIT_ASSERT(t-&gt;frameList("TCON").isEmpty());
992     }
993   }
994   void testSaveAndStripID3v1ShouldNotAddFrameFromID3v1ToId3v2()
995   {
996     ScopedFileCopy copy("xing", ".mp3");
997     string newname = copy.fileName();
998     {
999       MPEG::File foo(newname.c_str());
1000       foo.tag()-&gt;setArtist("Artist");
1001       foo.save(MPEG::File::ID3v1 | MPEG::File::ID3v2);
1002     }
1003     {
1004       MPEG::File bar(newname.c_str());
1005       bar.ID3v2Tag()-&gt;removeFrames("TPE1");
1006       bar.save(MPEG::File::ID3v2, File::StripOthers);
1007     }
1008     MPEG::File f(newname.c_str());
1009     CPPUNIT_ASSERT(!f.ID3v2Tag()-&gt;frameListMap().contains("TPE1"));
1010   }
1011   void testParseChapterFrame()
1012   {
1013     ID3v2::Header header;
1014     ByteVector chapterData =
1015       ByteVector("CHAP"                                      "\x00\x00\x00\x20"                          "\x00\x00"                                  "\x43\x00"                                  "\x00\x00\x00\x03"                          "\x00\x00\x00\x05"                          "\x00\x00\x00\x02"                          "\x00\x00\x00\x03", 28);       ByteVector embeddedFrameData =
1016       ByteVector("TIT2"                                      "\x00\x00\x00\x04"                          "\x00\x00"                                  "\x00"                                      "CH1", 14);                
1017     ID3v2::ChapterFrame f1(&amp;header, chapterData);
1018     CPPUNIT_ASSERT_EQUAL(ByteVector("C"), f1.elementID());
1019     CPPUNIT_ASSERT((unsigned int)0x03 == f1.startTime());
1020     CPPUNIT_ASSERT((unsigned int)0x05 == f1.endTime());
1021     CPPUNIT_ASSERT((unsigned int)0x02 == f1.startOffset());
1022     CPPUNIT_ASSERT((unsigned int)0x03 == f1.endOffset());
1023     CPPUNIT_ASSERT((unsigned int)0x00 == f1.embeddedFrameList().size());
1024     ID3v2::ChapterFrame f2(&amp;header, chapterData + embeddedFrameData);
1025     CPPUNIT_ASSERT_EQUAL(ByteVector("C"), f2.elementID());
1026     CPPUNIT_ASSERT((unsigned int)0x03 == f2.startTime());
1027     CPPUNIT_ASSERT((unsigned int)0x05 == f2.endTime());
1028     CPPUNIT_ASSERT((unsigned int)0x02 == f2.startOffset());
1029     CPPUNIT_ASSERT((unsigned int)0x03 == f2.endOffset());
1030     CPPUNIT_ASSERT((unsigned int)0x01 == f2.embeddedFrameList().size());
1031     CPPUNIT_ASSERT(f2.embeddedFrameList("TIT2").size() == 1);
1032     CPPUNIT_ASSERT(f2.embeddedFrameList("TIT2")[0]-&gt;toString() == "CH1");
1033   }
1034   void testRenderChapterFrame()
1035   {
1036     ID3v2::Header header;
1037     ID3v2::ChapterFrame f1(&amp;header, "CHAP");
1038     f1.setElementID(ByteVector("\x43\x00", 2));
1039     f1.setStartTime(3);
1040     f1.setEndTime(5);
1041     f1.setStartOffset(2);
1042     f1.setEndOffset(3);
1043     ID3v2::TextIdentificationFrame *eF = new ID3v2::TextIdentificationFrame("TIT2");
1044     eF-&gt;setText("CH1");
1045     f1.addEmbeddedFrame(eF);
1046     ByteVector expected =
1047       ByteVector("CHAP"                                      "\x00\x00\x00\x20"                          "\x00\x00"                                  "\x43\x00"                                  "\x00\x00\x00\x03"                          "\x00\x00\x00\x05"                          "\x00\x00\x00\x02"                          "\x00\x00\x00\x03"                          "TIT2"                                      "\x00\x00\x00\x04"                          "\x00\x00"                                  "\x00"                                      "CH1", 42);                
1048     CPPUNIT_ASSERT_EQUAL(expected, f1.render());
1049     f1.setElementID("C");
1050     CPPUNIT_ASSERT_EQUAL(expected, f1.render());
1051     ID3v2::FrameList frames;
1052     eF = new ID3v2::TextIdentificationFrame("TIT2");
1053     eF-&gt;setText("CH1");
1054     frames.append(eF);
1055     ID3v2::ChapterFrame f2(ByteVector("\x43\x00", 2), 3, 5, 2, 3, frames);
1056     CPPUNIT_ASSERT_EQUAL(expected, f2.render());
1057     frames.clear();
1058     eF = new ID3v2::TextIdentificationFrame("TIT2");
1059     eF-&gt;setText("CH1");
1060     frames.append(eF);
1061     ID3v2::ChapterFrame f3(ByteVector("C\x00", 2), 3, 5, 2, 3, frames);
1062     CPPUNIT_ASSERT_EQUAL(expected, f3.render());
1063     frames.clear();
1064     eF = new ID3v2::TextIdentificationFrame("TIT2");
1065     eF-&gt;setText("CH1");
1066     frames.append(eF);
1067     ID3v2::ChapterFrame f4("C", 3, 5, 2, 3, frames);
1068     CPPUNIT_ASSERT_EQUAL(expected, f4.render());
1069     CPPUNIT_ASSERT(!f4.toString().isEmpty());
1070     ID3v2::ChapterFrame f5("C", 3, 5, 2, 3);
1071     eF = new ID3v2::TextIdentificationFrame("TIT2");
1072     eF-&gt;setText("CH1");
1073     f5.addEmbeddedFrame(eF);
1074     CPPUNIT_ASSERT_EQUAL(expected, f5.render());
1075   }
1076   void testParseTableOfContentsFrame()
1077   {
1078     ID3v2::Header header;
1079     ID3v2::TableOfContentsFrame f(
1080       &amp;header,
1081       ByteVector("CTOC"                                      "\x00\x00\x00\x16"                          "\x00\x00"                                  "\x54\x00"                                  "\x01"                                      "\x02"                                      "\x43\x00"                                  "\x44\x00"                                  "TIT2"                                      "\x00\x00\x00\x04"                          "\x00\x00"                                  "\x00"                                      "TC1", 32));                   CPPUNIT_ASSERT_EQUAL(ByteVector("T"), f.elementID());
1082     CPPUNIT_ASSERT(!f.isTopLevel());
1083     CPPUNIT_ASSERT(f.isOrdered());
1084     CPPUNIT_ASSERT((unsigned int)0x02 == f.entryCount());
1085     CPPUNIT_ASSERT_EQUAL(ByteVector("C"), f.childElements()[0]);
1086     CPPUNIT_ASSERT_EQUAL(ByteVector("D"), f.childElements()[1]);
1087     CPPUNIT_ASSERT((unsigned int)0x01 == f.embeddedFrameList().size());
1088     CPPUNIT_ASSERT(f.embeddedFrameList("TIT2").size() == 1);
1089     CPPUNIT_ASSERT(f.embeddedFrameList("TIT2")[0]-&gt;toString() == "TC1");
1090     f.removeChildElement("E");     CPPUNIT_ASSERT_EQUAL(2U, f.entryCount());
1091     f.removeChildElement("C");
1092     CPPUNIT_ASSERT_EQUAL(1U, f.entryCount());
1093     CPPUNIT_ASSERT_EQUAL(ByteVector("D"), f.childElements()[0]);
1094     ID3v2::Frame *frame = f.embeddedFrameList("TIT2")[0];
1095     f.removeEmbeddedFrame(frame);
1096     CPPUNIT_ASSERT(f.embeddedFrameList("TIT2").isEmpty());
1097   }
1098   void testRenderTableOfContentsFrame()
1099   {
1100     ID3v2::Header header;
1101     ID3v2::TableOfContentsFrame f(&amp;header, "CTOC");
1102     f.setElementID(ByteVector("\x54\x00", 2));
1103     f.setIsTopLevel(false);
1104     f.setIsOrdered(true);
1105     f.addChildElement(ByteVector("\x43\x00", 2));
1106     f.addChildElement(ByteVector("\x44\x00", 2));
1107     ID3v2::TextIdentificationFrame *eF = new ID3v2::TextIdentificationFrame("TIT2");
1108     eF-&gt;setText("TC1");
1109     f.addEmbeddedFrame(eF);
1110     CPPUNIT_ASSERT_EQUAL(
1111       ByteVector("CTOC"                                      "\x00\x00\x00\x16"                          "\x00\x00"                                  "\x54\x00"                                  "\x01"                                      "\x02"                                      "\x43\x00"                                  "\x44\x00"                                  "TIT2"                                      "\x00\x00\x00\x04"                          "\x00\x00"                                  "\x00"                                      "TC1", 32),                      f.render());
1112   }
1113   void testShrinkPadding()
1114   {
1115     ScopedFileCopy copy("xing", ".mp3");
1116     string newname = copy.fileName();
1117     {
1118       MPEG::File f(newname.c_str());
1119       f.ID3v2Tag()-&gt;setTitle(longText(64 * 1024));
1120       f.save(MPEG::File::ID3v2, File::StripOthers);
1121     }
1122     {
1123       MPEG::File f(newname.c_str());
1124       CPPUNIT_ASSERT(f.hasID3v2Tag());
1125       CPPUNIT_ASSERT_EQUAL(74789L, f.length());
1126       f.ID3v2Tag()-&gt;setTitle("ABCDEFGHIJ");
1127       f.save(MPEG::File::ID3v2, File::StripOthers);
1128     }
1129     {
1130       MPEG::File f(newname.c_str());
1131       CPPUNIT_ASSERT(f.hasID3v2Tag());
1132       CPPUNIT_ASSERT_EQUAL(9263L, f.length());
1133     }
1134   }
1135   void testEmptyFrame()
1136   {
1137     ScopedFileCopy copy("xing", ".mp3");
1138     string newname = copy.fileName();
1139     {
1140       MPEG::File f(newname.c_str());
1141       ID3v2::Tag *tag = f.ID3v2Tag(true);
1142       ID3v2::UrlLinkFrame *frame1 = new ID3v2::UrlLinkFrame(
1143         ByteVector("WOAF\x00\x00\x00\x01\x00\x00\x00", 11));
1144       tag-&gt;addFrame(frame1);
1145       ID3v2::TextIdentificationFrame *frame2 = new ID3v2::TextIdentificationFrame("TIT2");
1146       frame2-&gt;setText("Title");
1147       tag-&gt;addFrame(frame2);
1148       f.save();
1149     }
1150     {
1151       MPEG::File f(newname.c_str());
1152       CPPUNIT_ASSERT_EQUAL(true, f.hasID3v2Tag());
1153       ID3v2::Tag *tag = f.ID3v2Tag();
1154       CPPUNIT_ASSERT_EQUAL(String("Title"), tag-&gt;title());
1155       CPPUNIT_ASSERT_EQUAL(true, tag-&gt;frameListMap()["WOAF"].isEmpty());
1156     }
1157   }
1158   void testDuplicateTags()
1159   {
1160     ScopedFileCopy copy("duplicate_id3v2", ".mp3");
1161     ByteVector audioStream;
1162     {
1163       MPEG::File f(copy.fileName().c_str());
1164       f.seek(f.ID3v2Tag()-&gt;header()-&gt;completeTagSize());
1165       audioStream = f.readBlock(2089);
1166       CPPUNIT_ASSERT(f.hasID3v2Tag());
1167       CPPUNIT_ASSERT_EQUAL((unsigned int)8049, f.ID3v2Tag()-&gt;header()-&gt;completeTagSize());
1168       CPPUNIT_ASSERT_EQUAL(44100, f.audioProperties()-&gt;sampleRate());
1169       f.ID3v2Tag()-&gt;setArtist("Artist A");
1170       f.save(MPEG::File::ID3v2, File::StripOthers);
1171     }
1172     {
1173       MPEG::File f(copy.fileName().c_str());
1174       CPPUNIT_ASSERT(f.hasID3v2Tag());
1175       CPPUNIT_ASSERT_EQUAL((long)3594, f.length());
1176       CPPUNIT_ASSERT_EQUAL((unsigned int)1505, f.ID3v2Tag()-&gt;header()-&gt;completeTagSize());
1177       CPPUNIT_ASSERT_EQUAL(String("Artist A"), f.ID3v2Tag()-&gt;artist());
1178       CPPUNIT_ASSERT_EQUAL(44100, f.audioProperties()-&gt;sampleRate());
1179       f.seek(f.ID3v2Tag()-&gt;header()-&gt;completeTagSize());
1180       CPPUNIT_ASSERT_EQUAL(f.readBlock(2089), audioStream);
1181     }
1182   }
1183   void testParseTOCFrameWithManyChildren()
1184   {
1185     MPEG::File f(TEST_FILE_PATH_C("toc_many_children.mp3"));
1186     CPPUNIT_ASSERT(f.isValid());
1187     ID3v2::Tag *tag = f.ID3v2Tag();
1188     const ID3v2::FrameList &amp;frames = tag-&gt;frameList();
1189     CPPUNIT_ASSERT_EQUAL(130U, frames.size());
1190     int i = 0;
1191     for(ID3v2::FrameList::ConstIterator it = frames.begin(); it != frames.end();
1192         ++it, ++i) {
1193       if(i &gt; 0) {
1194         CPPUNIT_ASSERT_EQUAL(ByteVector("CHAP"), (*it)-&gt;frameID());
1195         const ID3v2::ChapterFrame *chapFrame =
1196             dynamic_cast&lt;const ID3v2::ChapterFrame *&gt;(*it);
1197         CPPUNIT_ASSERT_EQUAL(ByteVector("chapter") +
1198                              ByteVector(String::number(i - 1).toCString()),
1199                              chapFrame-&gt;elementID());
1200         CPPUNIT_ASSERT_EQUAL(static_cast&lt;unsigned int&gt;(100 * i),
1201                              chapFrame-&gt;startTime());
1202         CPPUNIT_ASSERT_EQUAL(static_cast&lt;unsigned int&gt;(100 * i),
1203                              chapFrame-&gt;endTime());
1204         const ID3v2::FrameList &amp;embeddedFrames = chapFrame-&gt;embeddedFrameList();
1205         CPPUNIT_ASSERT_EQUAL(1U, embeddedFrames.size());
1206         const ID3v2::TextIdentificationFrame *tit2Frame =
1207             dynamic_cast&lt;const ID3v2::TextIdentificationFrame *&gt;(
1208               embeddedFrames.front());
1209         CPPUNIT_ASSERT(tit2Frame);
1210         CPPUNIT_ASSERT_EQUAL(String("Marker ") + String::number(i),
1211                              tit2Frame-&gt;fieldList().front());
1212       }
1213       else {
1214         CPPUNIT_ASSERT_EQUAL(ByteVector("CTOC"), (*it)-&gt;frameID());
1215         const ID3v2::TableOfContentsFrame *ctocFrame =
1216             dynamic_cast&lt;const ID3v2::TableOfContentsFrame *&gt;(*it);
1217         CPPUNIT_ASSERT_EQUAL(ByteVector("toc"), ctocFrame-&gt;elementID());
1218         CPPUNIT_ASSERT(!ctocFrame-&gt;isTopLevel());
1219         CPPUNIT_ASSERT(!ctocFrame-&gt;isOrdered());
1220         CPPUNIT_ASSERT_EQUAL(129U, ctocFrame-&gt;entryCount());
1221         const ID3v2::FrameList &amp;embeddedFrames = ctocFrame-&gt;embeddedFrameList();
1222         CPPUNIT_ASSERT_EQUAL(1U, embeddedFrames.size());
1223         const ID3v2::TextIdentificationFrame *tit2Frame =
1224             dynamic_cast&lt;const ID3v2::TextIdentificationFrame *&gt;(
1225               embeddedFrames.front());
1226         CPPUNIT_ASSERT(tit2Frame);
1227         CPPUNIT_ASSERT_EQUAL(StringList("toplevel toc"), tit2Frame-&gt;fieldList());
1228       }
1229     }
1230     CPPUNIT_ASSERT(!ID3v2::ChapterFrame::findByElementID(tag, "chap2"));
1231     CPPUNIT_ASSERT(ID3v2::ChapterFrame::findByElementID(tag, "chapter2"));
1232     CPPUNIT_ASSERT(!ID3v2::TableOfContentsFrame::findTopLevel(tag));
1233     CPPUNIT_ASSERT(!ID3v2::TableOfContentsFrame::findByElementID(tag, "ctoc"));
1234     CPPUNIT_ASSERT(ID3v2::TableOfContentsFrame::findByElementID(tag, "toc"));
1235   }
1236 };
1237 CPPUNIT_TEST_SUITE_REGISTRATION(TestID3v2);
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
