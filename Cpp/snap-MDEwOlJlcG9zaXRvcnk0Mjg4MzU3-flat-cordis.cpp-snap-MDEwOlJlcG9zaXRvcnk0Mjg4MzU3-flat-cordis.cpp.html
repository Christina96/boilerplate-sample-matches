
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 14, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-cordis.cpp</h3>
            <pre><code>1  #include "cordisold.h"
2  TStr TCordisEuPart::ExtrCountry(const TStr& AddrStr){
3    TStr CountryStr;
4    TStrV LnV; AddrStr.SplitOnStr("<br>", LnV);
5    if (LnV.Len()>0){
6      CountryStr=LnV.Last();
7      if (CountryStr.Empty()&&(LnV.Len()>1)){
8        CountryStr=LnV[LnV.Len()-2];}
9      CountryStr.DelChAll('\r');
10      CountryStr.DelChAll('\n');
11    }
12    if (CountryStr.Empty()){
13      printf("Country Field Not Found!\n");}
14    return CountryStr;
15  }
16  TStr TCordisEuPart::ExtrDeptNm(const TStr& EuPartStr){
17    TStr DeptNm=EuPartStr.GetWcMatch("*Department:</span>*</td>*", 1).GetTrunc();
18    if (!DeptNm.Empty()){
19      DeptNm.ChangeStrAll("\n<BR>", " ");
20      DeptNm=TXmlLx::GetPlainStrFromXmlStr(DeptNm);
21    }
22    return DeptNm;
23  }
24  void TCordisEuPart::ExtrEuPartV(const TStr& AllEuPartStr, TCordisEuPartV& EuPartV){
25    TStrV EuPartStrV; AllEuPartStr.SplitOnStr("Organisation Type:", EuPartStrV);
26    for (int EuPartN=1; EuPartN<EuPartStrV.Len(); EuPartN++){
27      TStr EuPartStr=EuPartStrV[EuPartN];
28      TStr WcStr=
29       "</span>*</td>"
30       "*Organisation:</span>*<br>"
31       "*</td>*";
32      TStrV StarStrV;
33      if (EuPartStr.IsWcMatch(WcStr, StarStrV)){
34        PCordisEuPart EuPart=TCordisEuPart::New();
35        EuPart->DeptNm=ExtrDeptNm(EuPartStr);
36        EuPart->OrgNm=TXmlLx::GetPlainStrFromXmlStr(StarStrV[2].GetTrunc());
37        EuPart->OrgTypeNm=StarStrV[0].GetTrunc();
38        EuPart->CountryNm=ExtrCountry(StarStrV[3].GetTrunc());
39        EuPart->CoordP=(EuPartN==1);
40        printf("   Partner: '%s'/'%s'/'%s'/'%s'/'%s'\n",
41         EuPart->DeptNm.CStr(), EuPart->OrgNm.CStr(),
42         EuPart->OrgTypeNm.CStr(), EuPart->CountryNm.CStr(),
43         TBool::GetStr(EuPart->CoordP).CStr());
44        EuPartV.Add(EuPart);
45      } else {
46        printf("Partner Fields Not Found!\n");
47      }
48    }
49  }
50  TStr TCordisEuPart::GetNrOrgNm(const TStr& Str){
51    TStrV NrStrV; TChA ChA;
52    PSwSet SwSet=TSwSet::GetSwSet(swstEnglish523);
53    PSIn HtmlSIn=TStrIn::New(Str);
54    THtmlLx Lx(HtmlSIn);
55    while (Lx.Sym!=hsyEof){
56      if ((Lx.Sym==hsyStr)||(Lx.Sym==hsyNum)){
57        Lx.UcChA.ChangeCh('\xc2', 'A');
58        Lx.UcChA.ChangeCh('\xc1', 'A');
59        Lx.UcChA.ChangeCh('\xc4', 'A');
60        Lx.UcChA.ChangeCh('\xc3', 'A');
61        Lx.UcChA.ChangeCh('\xc0', 'A');
62        Lx.UcChA.ChangeCh('\xc7', 'C');
63        Lx.UcChA.ChangeCh('\xc9', 'E');
64        Lx.UcChA.ChangeCh('\xc8', 'E');
65        Lx.UcChA.ChangeCh('\xca', 'E');
66        Lx.UcChA.ChangeCh('\xcd', 'I');
67        Lx.UcChA.ChangeCh('\xd3', 'O');
68        Lx.UcChA.ChangeCh('\xd6', 'O');
69        Lx.UcChA.ChangeCh('\xd1', 'N');
70        Lx.UcChA.ChangeCh('\xdc', 'U');
71        Lx.UcChA.ChangeCh('\xda', 'U');
72        TStr NrStr=THtmlLx::GetAsciiStr(Lx.UcChA);
73        if ((NrStr.Len()==1)||(SwSet->IsIn(NrStr))||
74         (NrStr=="AG")||(NrStr=="GMBH")||(NrStr=="LTD")||(NrStr=="SRL")||
75         (NrStr=="SA")||(NrStr=="EV")||(NrStr=="AS")||(NrStr=="AB")||
76         (NrStr=="NV")||(NrStr=="BV")||
77         (NrStr=="AKTIENGESELLSCHAFT")||(NrStr=="LIMITED")||
78         (NrStr=="FUER")||(NrStr=="FUR")){
79          NrStr="";}
80        if (!NrStr.Empty()){NrStrV.Add(NrStr);}
81      }
82      Lx.GetSym();
83    }
84    TChA NrChA;
85    for (int NrStrN=0; NrStrN<NrStrV.Len(); NrStrN++){
86      if (NrStrN>0){NrChA+=' ';}
87      NrChA+=NrStrV[NrStrN];
88    }
89    if (NrChA.Empty()){
90      NrChA=Str.GetUc();
91    }
92    return NrChA;
93  }
94  void TCordisEuProj::ExtrEuProjV(const TStr& EuProjHtmlBsFNm, TCordisEuProjV& EuProjV){
95    PSIn EuProjSIn(TFIn::New(EuProjHtmlBsFNm)); int EuProjRecN=0;
96    while (!EuProjSIn->Eof()){
97      printf("[%d]\n", EuProjRecN); EuProjRecN++;
<span onclick='openModal()' class='match'>98      TStr UrlStr(*EuProjSIn);
99      TStr HtmlStr(*EuProjSIn);
100      TStr WcStr=
</span>101       "*FP5 Project Record*<center><span class=h3>*.\n*</span></center>"
102       "*FP5 Programme Acronym:</span> <B><I>*</I></B></td>"
103       "*Project Reference:</span>*</td>"
104       "*Start Date:</span>*</td>"
105       "*End Date:</span>*</td>"
106       "*Duration:</span>*</td>"
107       "*Project Status:</span>*</td>"
108       "*Project Acronym:</span>*</td>"
109       "*<span class=b>Project Description</span>*"
110       "<span class=b>Coordinator</span>*";
111      TStrV StarStrV;
112      if (HtmlStr.IsWcMatch(WcStr, StarStrV)){
113        PCordisEuProj EuProj=TCordisEuProj::New();
114        EuProj->TitleStr=TXmlLx::GetPlainStrFromXmlStr(StarStrV[3].GetTrunc());
115        EuProj->EuProgAcrStr=StarStrV[5].GetTrunc();
116        EuProj->EuProjRefStr=StarStrV[7].GetTrunc();
117        EuProj->StartDateStr=StarStrV[9].GetTrunc();
118        EuProj->EndDateStr=StarStrV[11].GetTrunc();
119        EuProj->DurationStr=StarStrV[13].GetTrunc();
120        EuProj->EuProjStatusStr=StarStrV[15].GetTrunc();
121        EuProj->EuProjAcrStr=StarStrV[17].GetTrunc();
122        EuProj->EuProjDescHtmlStr=StarStrV[19].GetTrunc();
123        TStr AllEuPartStr=StarStrV[20].GetTrunc();
124        printf("Project: '%s'/'%s'/'%s'/'%s'/'%s'/'%s'/'%s'/'%s'\n",
125         EuProj->TitleStr.CStr(), EuProj->EuProgAcrStr.CStr(),
126         EuProj->EuProjRefStr.CStr(), EuProj->StartDateStr.CStr(),
127         EuProj->EndDateStr.CStr(), EuProj->DurationStr.CStr(),
128         EuProj->EuProjStatusStr.CStr(), EuProj->EuProjAcrStr.CStr());
129        TCordisEuPart::ExtrEuPartV(AllEuPartStr, EuProj->EuPartV);
130        EuProjV.Add(EuProj);
131      } else {
132        printf("Project Fields Not Found!\n");
133      }
134    }
135  }
136  PCordisEuProjBs TCordisEuProjBs::ExtrEuProjBs(const TStr& EuProjHtmlBsFNm){
137    PCordisEuProjBs EuProjBs=TCordisEuProjBs::New();
138    TCordisEuProj::ExtrEuProjV(EuProjHtmlBsFNm, EuProjBs->EuProjV);
139    return EuProjBs;
140  }
141  PBowDocBs TCordisEuProjBs::GetBowDocBsFromEuProjDesc() const {
142    printf("Generating Bag-Of-Words...\n");
143    TStrV HtmlStrV;
144    int EuProjs=GetEuProjs();
145    for (int EuProjN=0; EuProjN<EuProjs; EuProjN++){
146      PCordisEuProj EuProj=GetEuProj(EuProjN);
147      TStr EuProjNm=EuProj->GetEuProjAcrStr();
148      TStr EuProjHtmlStr=EuProj->GetTitleStr()+" "+EuProj->GetEuProjDescHtmlStr();
149      HtmlStrV.Add(EuProjHtmlStr);
150    }
151    PSwSet SwSet=TSwSet::GetSwSet(swstEnglish523);
152    PNGramBs NGramBs=TNGramBs::GetNGramBsFromHtmlStrV(HtmlStrV, 3, 3, SwSet);
153    NGramBs->SaveTxt("NGram.Txt");
154    printf("\n");
155    PBowDocBs BowDocBs=TBowDocBs::New();
156    BowDocBs->PutNGramBs(NGramBs);
157    {for (int EuProjN=0; EuProjN<EuProjs; EuProjN++){
158      if (EuProjN%100==0){printf("%d/%d\r", EuProjN, EuProjs);}
159      PCordisEuProj EuProj=GetEuProj(EuProjN);
160      TStr DocNm=EuProj->GetEuProjAcrStr();
161      TStr HtmlStr=EuProj->GetTitleStr()+" "+EuProj->GetEuProjDescHtmlStr();
162      BowDocBs->AddHtmlDoc(DocNm, TStrV(), HtmlStr);
163    }}
164    BowDocBs->AssertOk();
165    printf("\nDone.\n");
166    return BowDocBs;
167  }
168  void TCordisEuProjWebFetch::OnFetch(const int&, const PWebPg& WebPg){
169    printf("%s\n", WebPg->GetUrlStr().CStr());
170    printf("-----------------------\n");
171    TStr WebPgUrlStr=WebPg->GetUrlStr();
172    TStrKdV DescUrlStrKdV; WebPg->GetOutDescUrlStrKdV(DescUrlStrKdV);
173    if (WebPgUrlStr.IsPrefix("http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?ACTION=D&")){
174      TStr HtmlStr=WebPg->GetHttpBodyAsStr();
175      WebPgUrlStr.Save(*EuProjSOut);
176      HtmlStr.Save(*EuProjSOut);
177      EuProjSOut->Flush();
178      int DescUrlStrKdN=DescUrlStrKdV.SearchForw(TStrKd("NEXT RECORD"));
179      if (DescUrlStrKdN!=-1){
180        FetchDocN++;
181        FetchUrlStr=
182         TStr("http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?ACTION=D&SESSION=")+
183         FetchSesIdStr+"&DOC="+TInt::GetStr(FetchDocN);
184        FetchRetries=0;
185        FetchUrl(FetchUrlStr);
186      } else {
187        printf("*** No forward pointer.\n");
188        TSysMsg::Quit();
189      }
190    } else
191    if (WebPgUrlStr.IsPrefix("http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?ACTION=R&")){
192      FetchSesIdStr=WebPgUrlStr.GetWcMatch("*SESSION=*&*", 1);
193      FetchDocN=1;
194      FetchUrlStr=
195       TStr("http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?ACTION=D&SESSION=")+
196       FetchSesIdStr+"&DOC="+TInt::GetStr(FetchDocN);
197      FetchRetries=0;
198      FetchUrl(FetchUrlStr);
199    } else {
200      int DescUrlStrKdN=DescUrlStrKdV.SearchForw(TStrKd("NEXT 20 RECORDS"));
201      if (DescUrlStrKdN!=-1){
202        FetchUrl(DescUrlStrKdV[DescUrlStrKdN].Dat);}
203    }
204  }
205  void TCordisEuProjWebFetch::OnError(const int&, const TStr& MsgStr){
206    printf("*** Error: '%s'\n", MsgStr.CStr());
207    if (FetchUrlStr.Empty()||(FetchRetries>10)){
208      TSysMsg::Quit(); 
209    } else {
210      FetchRetries++;
211      printf("*** Retry (#%d): '%s'\n", FetchRetries, FetchUrlStr.CStr());
212      FetchUrl(FetchUrlStr);
213    }
214  }
215  TStr TCordisEuProjWebFetch::GetEuProgUrlStr(const TEuProg& EuProg){
216    switch (EuProg){
217      case eupAll: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; All
218      case eupIST: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=IST&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; IST
219      case eupQualityOfLife: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=LIFE+QUALITY&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; Quality-Of-Life
220      case eupGrowth: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=GROWTH&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; Growth
221      case eupEEST: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=EESD&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; EEST
222      case eupINCO2: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=INCO+2&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; INCO 2
223      case eupInnovationSMEs: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=INNOVATION-SME&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; Innovation-SMEs
224      case eupImprovingHumanPotential: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=HUMAN+POTENTIAL&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; Improving-Human-Potential
225      case eupEurAtom: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=FP5-EAECTP+C&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; EurAtom
226      default: Fail; return "";
227    }
228  }
229  void TCordisEuProjWebFetch::FetchEuProg(
230   const TEuProg& EuProg, const TStr& EuProjHtmlBsFNm){
231    TCordisEuProjWebFetch EuProjWebFetch(EuProjHtmlBsFNm);
232    TStr EuProgUrlStr=GetEuProgUrlStr(EuProg);
233    EuProjWebFetch.FetchUrl(EuProgUrlStr);
234    TSysMsg::Loop();
235  }
</code></pre>
        </div>
        <div class="column">
            <h3>snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-cordis.cpp</h3>
            <pre><code>1  #include "cordisold.h"
2  TStr TCordisEuPart::ExtrCountry(const TStr& AddrStr){
3    TStr CountryStr;
4    TStrV LnV; AddrStr.SplitOnStr("<br>", LnV);
5    if (LnV.Len()>0){
6      CountryStr=LnV.Last();
7      if (CountryStr.Empty()&&(LnV.Len()>1)){
8        CountryStr=LnV[LnV.Len()-2];}
9      CountryStr.DelChAll('\r');
10      CountryStr.DelChAll('\n');
11    }
12    if (CountryStr.Empty()){
13      printf("Country Field Not Found!\n");}
14    return CountryStr;
15  }
16  TStr TCordisEuPart::ExtrDeptNm(const TStr& EuPartStr){
17    TStr DeptNm=EuPartStr.GetWcMatch("*Department:</span>*</td>*", 1).GetTrunc();
18    if (!DeptNm.Empty()){
19      DeptNm.ChangeStrAll("\n<BR>", " ");
20      DeptNm=TXmlLx::GetPlainStrFromXmlStr(DeptNm);
21    }
22    return DeptNm;
23  }
24  void TCordisEuPart::ExtrEuPartV(const TStr& AllEuPartStr, TCordisEuPartV& EuPartV){
25    TStrV EuPartStrV; AllEuPartStr.SplitOnStr("Organisation Type:", EuPartStrV);
26    for (int EuPartN=1; EuPartN<EuPartStrV.Len(); EuPartN++){
27      TStr EuPartStr=EuPartStrV[EuPartN];
28      TStr WcStr=
29       "</span>*</td>"
30       "*Organisation:</span>*<br>"
31       "*</td>*";
32      TStrV StarStrV;
33      if (EuPartStr.IsWcMatch(WcStr, StarStrV)){
34        PCordisEuPart EuPart=TCordisEuPart::New();
35        EuPart->DeptNm=ExtrDeptNm(EuPartStr);
36        EuPart->OrgNm=TXmlLx::GetPlainStrFromXmlStr(StarStrV[2].GetTrunc());
37        EuPart->OrgTypeNm=StarStrV[0].GetTrunc();
38        EuPart->CountryNm=ExtrCountry(StarStrV[3].GetTrunc());
39        EuPart->CoordP=(EuPartN==1);
40        printf("   Partner: '%s'/'%s'/'%s'/'%s'/'%s'\n",
41         EuPart->DeptNm.CStr(), EuPart->OrgNm.CStr(),
42         EuPart->OrgTypeNm.CStr(), EuPart->CountryNm.CStr(),
43         TBool::GetStr(EuPart->CoordP).CStr());
44        EuPartV.Add(EuPart);
45      } else {
46        printf("Partner Fields Not Found!\n");
47      }
48    }
49  }
50  TStr TCordisEuPart::GetNrOrgNm(const TStr& Str){
51    TStrV NrStrV; TChA ChA;
52    PSwSet SwSet=TSwSet::GetSwSet(swstEnglish523);
53    PSIn HtmlSIn=TStrIn::New(Str);
54    THtmlLx Lx(HtmlSIn);
55    while (Lx.Sym!=hsyEof){
56      if ((Lx.Sym==hsyStr)||(Lx.Sym==hsyNum)){
57        Lx.UcChA.ChangeCh('\xc2', 'A');
58        Lx.UcChA.ChangeCh('\xc1', 'A');
59        Lx.UcChA.ChangeCh('\xc4', 'A');
60        Lx.UcChA.ChangeCh('\xc3', 'A');
61        Lx.UcChA.ChangeCh('\xc0', 'A');
62        Lx.UcChA.ChangeCh('\xc7', 'C');
63        Lx.UcChA.ChangeCh('\xc9', 'E');
64        Lx.UcChA.ChangeCh('\xc8', 'E');
65        Lx.UcChA.ChangeCh('\xca', 'E');
66        Lx.UcChA.ChangeCh('\xcd', 'I');
67        Lx.UcChA.ChangeCh('\xd3', 'O');
68        Lx.UcChA.ChangeCh('\xd6', 'O');
69        Lx.UcChA.ChangeCh('\xd1', 'N');
70        Lx.UcChA.ChangeCh('\xdc', 'U');
71        Lx.UcChA.ChangeCh('\xda', 'U');
72        TStr NrStr=THtmlLx::GetAsciiStr(Lx.UcChA);
73        if ((NrStr.Len()==1)||(SwSet->IsIn(NrStr))||
74         (NrStr=="AG")||(NrStr=="GMBH")||(NrStr=="LTD")||(NrStr=="SRL")||
75         (NrStr=="SA")||(NrStr=="EV")||(NrStr=="AS")||(NrStr=="AB")||
76         (NrStr=="NV")||(NrStr=="BV")||
77         (NrStr=="AKTIENGESELLSCHAFT")||(NrStr=="LIMITED")||
78         (NrStr=="FUER")||(NrStr=="FUR")){
79          NrStr="";}
80        if (!NrStr.Empty()){NrStrV.Add(NrStr);}
81      }
82      Lx.GetSym();
83    }
84    TChA NrChA;
85    for (int NrStrN=0; NrStrN<NrStrV.Len(); NrStrN++){
86      if (NrStrN>0){NrChA+=' ';}
87      NrChA+=NrStrV[NrStrN];
88    }
89    if (NrChA.Empty()){
90      NrChA=Str.GetUc();
91    }
92    return NrChA;
93  }
94  void TCordisEuProj::ExtrEuProjV(const TStr& EuProjHtmlBsFNm, TCordisEuProjV& EuProjV){
95    PSIn EuProjSIn(TFIn::New(EuProjHtmlBsFNm)); int EuProjRecN=0;
96    while (!EuProjSIn->Eof()){
97      printf("[%d]\n", EuProjRecN); EuProjRecN++;
<span onclick='openModal()' class='match'>98      TStr UrlStr(*EuProjSIn);
99      TStr HtmlStr(*EuProjSIn);
100      TStr WcStr=
</span>101       "*FP5 Project Record*<center><span class=h3>*.\n*</span></center>"
102       "*FP5 Programme Acronym:</span> <B><I>*</I></B></td>"
103       "*Project Reference:</span>*</td>"
104       "*Start Date:</span>*</td>"
105       "*End Date:</span>*</td>"
106       "*Duration:</span>*</td>"
107       "*Project Status:</span>*</td>"
108       "*Project Acronym:</span>*</td>"
109       "*<span class=b>Project Description</span>*"
110       "<span class=b>Coordinator</span>*";
111      TStrV StarStrV;
112      if (HtmlStr.IsWcMatch(WcStr, StarStrV)){
113        PCordisEuProj EuProj=TCordisEuProj::New();
114        EuProj->TitleStr=TXmlLx::GetPlainStrFromXmlStr(StarStrV[3].GetTrunc());
115        EuProj->EuProgAcrStr=StarStrV[5].GetTrunc();
116        EuProj->EuProjRefStr=StarStrV[7].GetTrunc();
117        EuProj->StartDateStr=StarStrV[9].GetTrunc();
118        EuProj->EndDateStr=StarStrV[11].GetTrunc();
119        EuProj->DurationStr=StarStrV[13].GetTrunc();
120        EuProj->EuProjStatusStr=StarStrV[15].GetTrunc();
121        EuProj->EuProjAcrStr=StarStrV[17].GetTrunc();
122        EuProj->EuProjDescHtmlStr=StarStrV[19].GetTrunc();
123        TStr AllEuPartStr=StarStrV[20].GetTrunc();
124        printf("Project: '%s'/'%s'/'%s'/'%s'/'%s'/'%s'/'%s'/'%s'\n",
125         EuProj->TitleStr.CStr(), EuProj->EuProgAcrStr.CStr(),
126         EuProj->EuProjRefStr.CStr(), EuProj->StartDateStr.CStr(),
127         EuProj->EndDateStr.CStr(), EuProj->DurationStr.CStr(),
128         EuProj->EuProjStatusStr.CStr(), EuProj->EuProjAcrStr.CStr());
129        TCordisEuPart::ExtrEuPartV(AllEuPartStr, EuProj->EuPartV);
130        EuProjV.Add(EuProj);
131      } else {
132        printf("Project Fields Not Found!\n");
133      }
134    }
135  }
136  PCordisEuProjBs TCordisEuProjBs::ExtrEuProjBs(const TStr& EuProjHtmlBsFNm){
137    PCordisEuProjBs EuProjBs=TCordisEuProjBs::New();
138    TCordisEuProj::ExtrEuProjV(EuProjHtmlBsFNm, EuProjBs->EuProjV);
139    return EuProjBs;
140  }
141  PBowDocBs TCordisEuProjBs::GetBowDocBsFromEuProjDesc() const {
142    printf("Generating Bag-Of-Words...\n");
143    TStrV HtmlStrV;
144    int EuProjs=GetEuProjs();
145    for (int EuProjN=0; EuProjN<EuProjs; EuProjN++){
146      PCordisEuProj EuProj=GetEuProj(EuProjN);
147      TStr EuProjNm=EuProj->GetEuProjAcrStr();
148      TStr EuProjHtmlStr=EuProj->GetTitleStr()+" "+EuProj->GetEuProjDescHtmlStr();
149      HtmlStrV.Add(EuProjHtmlStr);
150    }
151    PSwSet SwSet=TSwSet::GetSwSet(swstEnglish523);
152    PNGramBs NGramBs=TNGramBs::GetNGramBsFromHtmlStrV(HtmlStrV, 3, 3, SwSet);
153    NGramBs->SaveTxt("NGram.Txt");
154    printf("\n");
155    PBowDocBs BowDocBs=TBowDocBs::New();
156    BowDocBs->PutNGramBs(NGramBs);
157    {for (int EuProjN=0; EuProjN<EuProjs; EuProjN++){
158      if (EuProjN%100==0){printf("%d/%d\r", EuProjN, EuProjs);}
159      PCordisEuProj EuProj=GetEuProj(EuProjN);
160      TStr DocNm=EuProj->GetEuProjAcrStr();
161      TStr HtmlStr=EuProj->GetTitleStr()+" "+EuProj->GetEuProjDescHtmlStr();
162      BowDocBs->AddHtmlDoc(DocNm, TStrV(), HtmlStr);
163    }}
164    BowDocBs->AssertOk();
165    printf("\nDone.\n");
166    return BowDocBs;
167  }
168  void TCordisEuProjWebFetch::OnFetch(const int&, const PWebPg& WebPg){
169    printf("%s\n", WebPg->GetUrlStr().CStr());
170    printf("-----------------------\n");
171    TStr WebPgUrlStr=WebPg->GetUrlStr();
172    TStrKdV DescUrlStrKdV; WebPg->GetOutDescUrlStrKdV(DescUrlStrKdV);
173    if (WebPgUrlStr.IsPrefix("http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?ACTION=D&")){
174      TStr HtmlStr=WebPg->GetHttpBodyAsStr();
175      WebPgUrlStr.Save(*EuProjSOut);
176      HtmlStr.Save(*EuProjSOut);
177      EuProjSOut->Flush();
178      int DescUrlStrKdN=DescUrlStrKdV.SearchForw(TStrKd("NEXT RECORD"));
179      if (DescUrlStrKdN!=-1){
180        FetchDocN++;
181        FetchUrlStr=
182         TStr("http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?ACTION=D&SESSION=")+
183         FetchSesIdStr+"&DOC="+TInt::GetStr(FetchDocN);
184        FetchRetries=0;
185        FetchUrl(FetchUrlStr);
186      } else {
187        printf("*** No forward pointer.\n");
188        TSysMsg::Quit();
189      }
190    } else
191    if (WebPgUrlStr.IsPrefix("http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?ACTION=R&")){
192      FetchSesIdStr=WebPgUrlStr.GetWcMatch("*SESSION=*&*", 1);
193      FetchDocN=1;
194      FetchUrlStr=
195       TStr("http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?ACTION=D&SESSION=")+
196       FetchSesIdStr+"&DOC="+TInt::GetStr(FetchDocN);
197      FetchRetries=0;
198      FetchUrl(FetchUrlStr);
199    } else {
200      int DescUrlStrKdN=DescUrlStrKdV.SearchForw(TStrKd("NEXT 20 RECORDS"));
201      if (DescUrlStrKdN!=-1){
202        FetchUrl(DescUrlStrKdV[DescUrlStrKdN].Dat);}
203    }
204  }
205  void TCordisEuProjWebFetch::OnError(const int&, const TStr& MsgStr){
206    printf("*** Error: '%s'\n", MsgStr.CStr());
207    if (FetchUrlStr.Empty()||(FetchRetries>10)){
208      TSysMsg::Quit(); 
209    } else {
210      FetchRetries++;
211      printf("*** Retry (#%d): '%s'\n", FetchRetries, FetchUrlStr.CStr());
212      FetchUrl(FetchUrlStr);
213    }
214  }
215  TStr TCordisEuProjWebFetch::GetEuProgUrlStr(const TEuProg& EuProg){
216    switch (EuProg){
217      case eupAll: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; All
218      case eupIST: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=IST&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; IST
219      case eupQualityOfLife: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=LIFE+QUALITY&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; Quality-Of-Life
220      case eupGrowth: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=GROWTH&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; Growth
221      case eupEEST: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=EESD&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; EEST
222      case eupINCO2: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=INCO+2&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; INCO 2
223      case eupInnovationSMEs: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=INNOVATION-SME&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; Innovation-SMEs
224      case eupImprovingHumanPotential: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=HUMAN+POTENTIAL&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; Improving-Human-Potential
225      case eupEurAtom: return "http:&bsol;&bsol;dbs.cordis.lu/fep-cgi/srchidadb?CALLER=PROJ_FP5&QM_EP_PGA_D=LIFE+QUALITY&QM_EP_PGA_D=EESD&QM_EP_PGA_D=GROWTH&QM_EP_PGA_D=FP5-EAECTP+C&QM_EP_PGA_D=HUMAN+POTENTIAL&QM_EP_PGA_D=INCO+2&QM_EP_PGA_D=INNOVATION-SME&QM_EP_PGA_D=IST&QM_EP_PGA_D=FRAMEWORK+5C&QZ_WEBSRCH=&QM_EP_PGA_A=FP5-EAECTP+C&USR_SORT=EP_PGA_A+CHAR+ASC"; &bsol;&bsol; EurAtom
226      default: Fail; return "";
227    }
228  }
229  void TCordisEuProjWebFetch::FetchEuProg(
230   const TEuProg& EuProg, const TStr& EuProjHtmlBsFNm){
231    TCordisEuProjWebFetch EuProjWebFetch(EuProjHtmlBsFNm);
232    TStr EuProgUrlStr=GetEuProgUrlStr(EuProg);
233    EuProjWebFetch.FetchUrl(EuProgUrlStr);
234    TSysMsg::Loop();
235  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-cordis.cpp</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from snap-MDEwOlJlcG9zaXRvcnk0Mjg4MzU3-flat-cordis.cpp</div>
                </div>
                <div class="column column_space"><pre><code>98      TStr UrlStr(*EuProjSIn);
99      TStr HtmlStr(*EuProjSIn);
100      TStr WcStr=
</pre></code></div>
                <div class="column column_space"><pre><code>98      TStr UrlStr(*EuProjSIn);
99      TStr HtmlStr(*EuProjSIn);
100      TStr WcStr=
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    