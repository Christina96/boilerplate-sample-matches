
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 27, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-UserDefineDialog.cpp</h3>
            <pre><code>1  #include &quot;localization.h&quot;
2  #include &quot;UserDefineDialog.h&quot;
3  #include &quot;ScintillaEditView.h&quot;
4  #include &quot;Notepad_plus_msgs.h&quot;
5  #include &quot;CustomFileDialog.h&quot;
6  using namespace std;
7  UserLangContainer * SharedParametersDialog::_pUserLang = NULL;
8  ScintillaEditView * SharedParametersDialog::_pScintilla = NULL;
9  GlobalMappers &amp; globalMappper()
10  {
11      static GlobalMappers gm;
12      return gm;
13  }
14  void convertTo(TCHAR *dest, int destLen, const TCHAR *toConvert, const TCHAR *prefix)
15  {
16  	bool inGroup = false;
17  	int index = lstrlen(dest);
18  	if (index &gt; 0)
19  		dest[index++] = &#x27; &#x27;;
20  	dest[index++] = prefix[0];
21  	dest[index++] = prefix[1];
22  	for (size_t i = 0, len = lstrlen(toConvert); i &lt; len &amp;&amp; index &lt; destLen - 7; ++i)
23  	{
24  		if (i == 0 &amp;&amp; toConvert[i] == &#x27;(&#x27; &amp;&amp; toConvert[i + 1] == &#x27;(&#x27;)
25  		{
26  			inGroup = true;
27  		}
28  		else if (toConvert[i] == &#x27; &#x27; &amp;&amp; toConvert[i + 1] == &#x27;(&#x27; &amp;&amp; toConvert[i + 2] == &#x27;(&#x27;)
29  		{
30  			inGroup = true;
31  			dest[index++] = &#x27; &#x27;;
32  			dest[index++] = prefix[0];
33  			dest[index++] = prefix[1];
34  			++i;    
35  		}
36  		if (inGroup &amp;&amp; toConvert[i - 1] == &#x27;)&#x27; &amp;&amp; toConvert[i - 2] == &#x27;)&#x27;)
37  		{
38  			inGroup = false;
39  		}
40  		if (toConvert[i] == &#x27; &#x27;)
41  		{
42  			if (toConvert[i + 1] != &#x27; &#x27; &amp;&amp; toConvert[i + 1] != &#x27;\0&#x27;)
43  			{
44  				dest[index++] = &#x27; &#x27;;
45  				if (!inGroup)
46  				{
47  					dest[index++] = prefix[0];
48  					dest[index++] = prefix[1];
49  				}
50  			}
51  		}
52  		else
53  		{
54  			dest[index++] = toConvert[i];
55  		}
56  	}
57  	dest[index] = &#x27;\0&#x27;;
58  }
59  bool SharedParametersDialog::setPropertyByCheck(HWND hwnd, WPARAM id, bool &amp; bool2set)
60  {
61      bool2set = (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, int(id)), BM_GETCHECK, 0, 0));
62      if (_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
63          _pScintilla-&gt;styleChange();
64      return TRUE;
65  }
66  intptr_t CALLBACK SharedParametersDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM &amp;bsol;*lParam*/)
67  {
68      switch (Message)
69      {
70          case WM_INITDIALOG :
71          {
72              return TRUE;
73          }
74          case WM_CTLCOLOREDIT:
75          {
76              return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
77          }
78          case WM_CTLCOLORDLG:
79          case WM_CTLCOLORSTATIC:
80          {
81              return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
82          }
83          case WM_PRINTCLIENT:
84          {
85              if (NppDarkMode::isEnabled())
86              {
87                  return TRUE;
88              }
89              break;
90          }
91          case WM_COMMAND :
92          {
93              if (HIWORD(wParam) == EN_CHANGE)
94              {
95                  setKeywords2List(LOWORD(wParam));
96                  if (_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
97                      _pScintilla-&gt;styleChange();
98                  return TRUE;
99              }
100              return FALSE;
101          }
102      }
103      return FALSE;
104  }
105  intptr_t CALLBACK FolderStyleDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM lParam)
106  {
107      switch (Message)
108      {
109          case WM_INITDIALOG :
110          {
111              _pageLink.init(_hInst, _hSelf);
112              _pageLink.create(::GetDlgItem(_hSelf, IDC_WEB_HELP_LINK), TEXT(&quot;https:&amp;bsol;&amp;bsol;ivan-radic.github.io/udl-documentation/&quot;));
113              return TRUE;
114          }
115          case WM_COMMAND :
116          {
117              switch (wParam)
118              {
119                  case IDC_FOLDER_FOLD_COMPACT :
120                  {
121                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_foldCompact);
122                  }
123                  case IDC_FOLDER_IN_CODE1_STYLER :
124                  {
125                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_FOLDER_IN_CODE1, SCE_USER_MASK_NESTING_NONE);
126                      stylerDlg.doDialog();
127                      return TRUE;
128                  }
129                  case IDC_FOLDER_IN_CODE2_STYLER :
130                  {
131                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_FOLDER_IN_CODE2, SCE_USER_MASK_NESTING_NONE);
132                      stylerDlg.doDialog();
133                      return TRUE;
134                  }
135                  case IDC_FOLDER_IN_COMMENT_STYLER :
136                  {
137                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_FOLDER_IN_COMMENT, SCE_USER_MASK_NESTING_NONE);
138                      stylerDlg.doDialog();
139                      return TRUE;
140                  }
141                  case IDC_DEFAULT_STYLER :
142                  {
143                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DEFAULT, SCE_USER_MASK_NESTING_NONE);
144                      stylerDlg.doDialog();
145                      return TRUE;
146                  }
147                  default :
148                      return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
149              }
150          }
151          case WM_DESTROY:
152          {
153              _pageLink.destroy();
154              return TRUE;
155          }
156          default :
157              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
158      }
159  }
160  void FolderStyleDialog::setKeywords2List(int id)
161  {
162      switch (id)
163      {
164          case IDC_FOLDER_IN_CODE1_OPEN_EDIT :     
165          case IDC_FOLDER_IN_CODE1_MIDDLE_EDIT :   
166          case IDC_FOLDER_IN_CODE1_CLOSE_EDIT :    
167          case IDC_FOLDER_IN_CODE2_OPEN_EDIT :     
168          case IDC_FOLDER_IN_CODE2_MIDDLE_EDIT :   
169          case IDC_FOLDER_IN_CODE2_CLOSE_EDIT :    
170          case IDC_FOLDER_IN_COMMENT_OPEN_EDIT :   
171          case IDC_FOLDER_IN_COMMENT_MIDDLE_EDIT : 
172          case IDC_FOLDER_IN_COMMENT_CLOSE_EDIT :  
173              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[globalMappper().dialogMapper[id]], max_char);
174              break;
175      }
176  }
177  void FolderStyleDialog::updateDlg()
178  {
179      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_FOLD_COMPACT,           BM_SETCHECK, _pUserLang-&gt;_foldCompact, 0);
180      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE1_OPEN_EDIT,     WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE1_OPEN]));
181      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE1_MIDDLE_EDIT,   WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE1_MIDDLE]));
182      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE1_CLOSE_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE1_CLOSE]));
183      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE2_OPEN_EDIT,     WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE2_OPEN]));
184      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE2_MIDDLE_EDIT,   WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE2_MIDDLE]));
185      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE2_CLOSE_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE2_CLOSE]));
186      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_COMMENT_OPEN_EDIT,   WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_COMMENT_OPEN]));
187      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_COMMENT_MIDDLE_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_COMMENT_MIDDLE]));
188      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_COMMENT_CLOSE_EDIT,  WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_COMMENT_CLOSE]));
189  }
190  void FolderStyleDialog::retrieve(TCHAR *dest, const TCHAR *toRetrieve, TCHAR *prefix) const
191  {
192      int j = 0;
193      bool begin2Copy = false;
194      for (size_t i = 0, len = lstrlen(toRetrieve); i &lt; len ; ++i)
195      {
196          if ((i == 0 || (toRetrieve[i-1] == &#x27; &#x27;)) &amp;&amp; (toRetrieve[i] == prefix[0] &amp;&amp; toRetrieve[i+1] == prefix[1]))
197          {
198              if (j &gt; 0)
199                  dest[j++] = &#x27; &#x27;;
200              begin2Copy = true;
201              ++i;
202              continue;
203          }
204          else if (((toRetrieve[i] == &#x27; &#x27;) &amp;&amp; begin2Copy == true))
205          {
206              begin2Copy = false;
207          }
208          if (begin2Copy)
209              dest[j++] = toRetrieve[i];
210      }
211      dest[j++] = &#x27;\0&#x27;;
212  }
213  intptr_t CALLBACK KeyWordsStyleDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM lParam)
214  {
215      switch (Message)
216      {
217          case WM_INITDIALOG :
218          {
219              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD1_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
220              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD2_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
221              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD3_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
222              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD4_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
223              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD5_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
224              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD6_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
225              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD7_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
226              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD8_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
227              return TRUE;
228          }
229          case WM_COMMAND :
230          {
231              switch (wParam)
232              {
233                  case IDC_KEYWORD1_PREFIX_CHECK :
234                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[0]);
235                  case IDC_KEYWORD2_PREFIX_CHECK :
236                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[1]);
237                  case IDC_KEYWORD3_PREFIX_CHECK :
238                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[2]);
239                  case IDC_KEYWORD4_PREFIX_CHECK :
240                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[3]);
241                  case IDC_KEYWORD5_PREFIX_CHECK :
242                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[4]);
243                  case IDC_KEYWORD6_PREFIX_CHECK :
244                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[5]);
245                  case IDC_KEYWORD7_PREFIX_CHECK :
246                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[6]);
247                  case IDC_KEYWORD8_PREFIX_CHECK :
248                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[7]);
249                  case IDC_KEYWORD1_STYLER :
250                  {
251                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD1, SCE_USER_MASK_NESTING_NONE);
252                      stylerDlg.doDialog();
253                      return TRUE;
254                  }
255                  case IDC_KEYWORD2_STYLER :
256                  {
257                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD2, SCE_USER_MASK_NESTING_NONE);
258                      stylerDlg.doDialog();
259                      return TRUE;
260                  }
261                  case IDC_KEYWORD3_STYLER :
262                  {
263                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD3, SCE_USER_MASK_NESTING_NONE);
264                      stylerDlg.doDialog();
265                      return TRUE;
266                  }
267                  case IDC_KEYWORD4_STYLER :
268                  {
269                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD4, SCE_USER_MASK_NESTING_NONE);
270                      stylerDlg.doDialog();
271                      return TRUE;
272                  }
273                  case IDC_KEYWORD5_STYLER :
274                  {
275                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD5, SCE_USER_MASK_NESTING_NONE);
276                      stylerDlg.doDialog();
277                      return TRUE;
278                  }
279                  case IDC_KEYWORD6_STYLER :
280                  {
281                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD6, SCE_USER_MASK_NESTING_NONE);
282                      stylerDlg.doDialog();
283                      return TRUE;
284                  }
285                  case IDC_KEYWORD7_STYLER :
286                  {
287                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD7, SCE_USER_MASK_NESTING_NONE);
288                      stylerDlg.doDialog();
289                      return TRUE;
290                  }
291                  case IDC_KEYWORD8_STYLER :
292                  {
293                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD8, SCE_USER_MASK_NESTING_NONE);
294                      stylerDlg.doDialog();
295                      return TRUE;
296                  }
297                  default :
298                      return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
299              }
300          }
301          default :
302              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
303      }
304  }
305  void KeyWordsStyleDialog::setKeywords2List(int id)
306  {
307      switch (id)
308      {
309          case IDC_KEYWORD1_EDIT :
310          case IDC_KEYWORD2_EDIT :
311          case IDC_KEYWORD3_EDIT :
312          case IDC_KEYWORD4_EDIT :
313          case IDC_KEYWORD5_EDIT :
314          case IDC_KEYWORD6_EDIT :
315          case IDC_KEYWORD7_EDIT :
316          case IDC_KEYWORD8_EDIT :
317              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[globalMappper().dialogMapper[id]], max_char);
318      }
319  }
320  void KeyWordsStyleDialog::updateDlg()
321  {
322      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD1_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS1]));
323      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD2_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS2]));
324      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD3_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS3]));
325      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD4_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS4]));
326      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD5_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS5]));
327      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD6_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS6]));
328      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD7_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS7]));
329      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD8_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS8]));
330      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD1_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[0], 0);
331      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD2_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[1], 0);
332      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD3_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[2], 0);
333      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD4_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[3], 0);
334      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD5_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[4], 0);
335      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD6_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[5], 0);
336      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD7_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[6], 0);
337      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD8_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[7], 0);
338  }
339  intptr_t CALLBACK CommentStyleDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM lParam)
340  {
341      switch (Message)
342      {
343          case WM_ACTIVATE :
344          case WM_SHOWWINDOW :
345          {
346              ::SendDlgItemMessage(_hSelf, IDC_ALLOW_ANYWHERE,    BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_NONE, 0);
347              ::SendDlgItemMessage(_hSelf, IDC_FORCE_AT_BOL,      BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_BOL,  0);
348              ::SendDlgItemMessage(_hSelf, IDC_ALLOW_WHITESPACE,  BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_WSP,  0);
349              ::SendDlgItemMessage(_hSelf, IDC_DOT_RADIO,         BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_DOT,   0);
350              ::SendDlgItemMessage(_hSelf, IDC_COMMA_RADIO,       BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_COMMA, 0);
351              ::SendDlgItemMessage(_hSelf, IDC_BOTH_RADIO,        BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_BOTH,  0);
352              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
353          }
354          case WM_COMMAND :
355          {
356              switch (wParam)
357              {
358                  case IDC_FOLDING_OF_COMMENTS :
359                  {
360                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_allowFoldOfComments);
361                  }
362                  case IDC_ALLOW_ANYWHERE :
363                  case IDC_FORCE_AT_BOL :
364                  case IDC_ALLOW_WHITESPACE :
365                  {
366                      if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_ALLOW_ANYWHERE), BM_GETCHECK, 0, 0))
367                          _pUserLang-&gt;_forcePureLC = PURE_LC_NONE;
368                      else if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_FORCE_AT_BOL), BM_GETCHECK, 0, 0))
369                          _pUserLang-&gt;_forcePureLC = PURE_LC_BOL;
370                      else if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_ALLOW_WHITESPACE), BM_GETCHECK, 0, 0))
371                          _pUserLang-&gt;_forcePureLC = PURE_LC_WSP;
372                      if (_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
373                          _pScintilla-&gt;styleChange();
374                      return TRUE;
375                  }
376                  case IDC_DOT_RADIO :
377                  case IDC_COMMA_RADIO :
378                  case IDC_BOTH_RADIO :
379                  {
380                      if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_DOT_RADIO), BM_GETCHECK, 0, 0))
381                          _pUserLang-&gt;_decimalSeparator = DECSEP_DOT;
382                      else if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_COMMA_RADIO), BM_GETCHECK, 0, 0))
383                          _pUserLang-&gt;_decimalSeparator = DECSEP_COMMA;
384                      else if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_BOTH_RADIO), BM_GETCHECK, 0, 0))
385                          _pUserLang-&gt;_decimalSeparator = DECSEP_BOTH;
386                      if (_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
387                          _pScintilla-&gt;styleChange();
388                      return TRUE;
389                  }
390                  case IDC_COMMENTLINE_STYLER :
391                  {
392                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_COMMENTLINE);
393                      stylerDlg.doDialog();
394                      return TRUE;
395                  }
396                  case IDC_COMMENT_STYLER :
397                  {
398                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_COMMENT);
399                      stylerDlg.doDialog();
400                      return TRUE;
401                  }
402                  case IDC_NUMBER_STYLER :
403                  {
404                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_NUMBER, SCE_USER_MASK_NESTING_NONE);
405                      stylerDlg.doDialog();
406                      return TRUE;
407                  }
408                  default :
409                      return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
410              }
411          }
412          default :
413              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
414      }
415  }
416  void CommentStyleDialog::setKeywords2List(int id)
417  {
418      int index = 0;
419      switch (id)
420      {
421          case IDC_NUMBER_PREFIX1_EDIT :
422          case IDC_NUMBER_PREFIX2_EDIT :
423          case IDC_NUMBER_EXTRAS1_EDIT :
424          case IDC_NUMBER_EXTRAS2_EDIT :
425          case IDC_NUMBER_SUFFIX1_EDIT :
426          case IDC_NUMBER_SUFFIX2_EDIT :
427          case IDC_NUMBER_RANGE_EDIT :  
428          {
429              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[globalMappper().dialogMapper[id]], max_char);
430              break;
431          }
432          case IDC_COMMENT_OPEN_EDIT :
433          case IDC_COMMENT_CLOSE_EDIT :
434          case IDC_COMMENTLINE_OPEN_EDIT :
435          case IDC_COMMENTLINE_CONTINUE_EDIT :
436          case IDC_COMMENTLINE_CLOSE_EDIT :
437              index = SCE_USER_KWLIST_COMMENTS;
438              break;
439          default : index = -1;
440      }
441      if (index != -1)
442      {
443          TCHAR* newList = new TCHAR[max_char];
444          newList[0] = &#x27;\0&#x27;;
445          TCHAR* buffer = new TCHAR[max_char];
446          buffer[0] = &#x27;\0&#x27;;
447          const int list[] = {
448              IDC_COMMENTLINE_OPEN_EDIT,
449              IDC_COMMENTLINE_CONTINUE_EDIT,
450              IDC_COMMENTLINE_CLOSE_EDIT,
451              IDC_COMMENT_OPEN_EDIT,
452              IDC_COMMENT_CLOSE_EDIT
453          };
454          TCHAR intBuffer[10] = { &#x27;0&#x27;, 0 };
455          for (int i = 0; static_cast&lt;size_t&gt;(i) &lt; sizeof(list) / sizeof(int); ++i)
456          {
457              _itow(i, intBuffer + 1, 10);
458              ::GetDlgItemText(_hSelf, list[i], buffer, max_char);
459              convertTo(newList, max_char, buffer, intBuffer);
460          }
461  		wcscpy_s(_pUserLang-&gt;_keywordLists[index], newList);
462          delete[] newList;
463          delete[] buffer;
464      }
465  }
466  void CommentStyleDialog::retrieve(TCHAR *dest, const TCHAR *toRetrieve, const TCHAR *prefix) const
467  {
468      int j = 0;
469      bool begin2Copy = false;
470      bool inGroup = false;
471      for (size_t i = 0, len = lstrlen(toRetrieve); i &lt; len ; ++i)
472      {
473          if ((i == 0 || (toRetrieve[i-1] == &#x27; &#x27;)) &amp;&amp; (toRetrieve[i] == prefix[0] &amp;&amp; toRetrieve[i+1] == prefix[1]))
474          {
475              if (j &gt; 0)
476                  dest[j++] = &#x27; &#x27;;
477              begin2Copy = true;
478              ++i;
479              continue;
480          }
481          if (toRetrieve[i] == &#x27;(&#x27; &amp;&amp; toRetrieve[i+1] == &#x27;(&#x27; &amp;&amp; inGroup == false &amp;&amp; begin2Copy == true)
482          {
483              inGroup = true;
484          }
485          if (toRetrieve[i] != &#x27;)&#x27; &amp;&amp; toRetrieve[i-1] == &#x27;)&#x27; &amp;&amp; toRetrieve[i-2] == &#x27;)&#x27; &amp;&amp; inGroup == true)
486          {
487              inGroup = false;
488          }
489          if (toRetrieve[i] == &#x27; &#x27; &amp;&amp; begin2Copy == true)
490          {
491              begin2Copy = false;
492          }
493          if (begin2Copy || inGroup)
494              dest[j++] = toRetrieve[i];
495      }
496      dest[j++] = &#x27;\0&#x27;;
497  }
498  void CommentStyleDialog::updateDlg()
499  {
500      TCHAR* buffer = new TCHAR[max_char];
501      buffer[0] = &#x27;\0&#x27;;
502      const int list[] = {
503          IDC_COMMENTLINE_OPEN_EDIT,
504          IDC_COMMENTLINE_CONTINUE_EDIT,
505          IDC_COMMENTLINE_CLOSE_EDIT,
506          IDC_COMMENT_OPEN_EDIT,
507          IDC_COMMENT_CLOSE_EDIT
508      };
509      TCHAR intBuffer[10] = { &#x27;0&#x27;, 0 };
510      for (int i = 0; static_cast&lt;size_t&gt;(i) &lt; sizeof(list) / sizeof(int); ++i)
511      {
512          _itow(i, intBuffer + 1, 10);
513          retrieve(buffer, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_COMMENTS], intBuffer);
514          ::SendDlgItemMessage(_hSelf, list[i], WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(buffer));
515      }
516      ::SendDlgItemMessage(_hSelf, IDC_FOLDING_OF_COMMENTS,   BM_SETCHECK, _pUserLang-&gt;_allowFoldOfComments,    0);
517      ::SendDlgItemMessage(_hSelf, IDC_ALLOW_ANYWHERE,        BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_NONE, 0);
518      ::SendDlgItemMessage(_hSelf, IDC_FORCE_AT_BOL,          BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_BOL,  0);
519      ::SendDlgItemMessage(_hSelf, IDC_ALLOW_WHITESPACE,      BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_WSP,  0);
520      ::SendDlgItemMessage(_hSelf, IDC_DOT_RADIO,             BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_DOT, 0);
521      ::SendDlgItemMessage(_hSelf, IDC_COMMA_RADIO,           BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_COMMA,  0);
522      ::SendDlgItemMessage(_hSelf, IDC_BOTH_RADIO,            BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_BOTH,  0);
523      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_PREFIX1_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_PREFIX1]));
524      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_PREFIX2_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_PREFIX2]));
525      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_EXTRAS1_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_EXTRAS1]));
526      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_EXTRAS2_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_EXTRAS2]));
527      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_SUFFIX1_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_SUFFIX1]));
528      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_SUFFIX2_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_SUFFIX2]));
529      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_RANGE_EDIT,      WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_RANGE]));
530      delete[] buffer;
531  }
532  void SymbolsStyleDialog::updateDlg()
533  {
534      TCHAR* buffer = new TCHAR[max_char];
535      buffer[0] = &#x27;\0&#x27;;
536      const int list[] = {
537          IDC_DELIMITER1_BOUNDARYOPEN_EDIT,
538          IDC_DELIMITER1_ESCAPE_EDIT,
539          IDC_DELIMITER1_BOUNDARYCLOSE_EDIT,
540          IDC_DELIMITER2_BOUNDARYOPEN_EDIT,
541          IDC_DELIMITER2_ESCAPE_EDIT,
542          IDC_DELIMITER2_BOUNDARYCLOSE_EDIT,
543          IDC_DELIMITER3_BOUNDARYOPEN_EDIT,
544          IDC_DELIMITER3_ESCAPE_EDIT,
545          IDC_DELIMITER3_BOUNDARYCLOSE_EDIT,
546          IDC_DELIMITER4_BOUNDARYOPEN_EDIT,
547          IDC_DELIMITER4_ESCAPE_EDIT,
548          IDC_DELIMITER4_BOUNDARYCLOSE_EDIT,
549          IDC_DELIMITER5_BOUNDARYOPEN_EDIT,
550          IDC_DELIMITER5_ESCAPE_EDIT,
551          IDC_DELIMITER5_BOUNDARYCLOSE_EDIT,
552          IDC_DELIMITER6_BOUNDARYOPEN_EDIT,
553          IDC_DELIMITER6_ESCAPE_EDIT,
554          IDC_DELIMITER6_BOUNDARYCLOSE_EDIT,
555          IDC_DELIMITER7_BOUNDARYOPEN_EDIT,
556          IDC_DELIMITER7_ESCAPE_EDIT,
557          IDC_DELIMITER7_BOUNDARYCLOSE_EDIT,
558          IDC_DELIMITER8_BOUNDARYOPEN_EDIT,
559          IDC_DELIMITER8_ESCAPE_EDIT,
560          IDC_DELIMITER8_BOUNDARYCLOSE_EDIT
561      };
562      TCHAR intBuffer[10] = {&#x27;0&#x27;, 0};
563      for (int i = 0; static_cast&lt;size_t&gt;(i) &lt; sizeof(list)/sizeof(int); ++i)
564      {
<span onclick='openModal()' class='match'>565          if (i &lt; 10)
566              _itow(i, intBuffer + 1, 10);
567          else
568              _itow(i, intBuffer, 10);
569          retrieve(buffer, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_DELIMITERS], intBuffer);
</span>570  		::SendDlgItemMessage(_hSelf, list[i], WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(buffer));
571      }
572      delete[] buffer;
573      ::SendDlgItemMessage(_hSelf, IDC_OPERATOR1_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_OPERATORS1]));
574      ::SendDlgItemMessage(_hSelf, IDC_OPERATOR2_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_OPERATORS2]));
575  }
576  intptr_t CALLBACK SymbolsStyleDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM lParam)
577  {
578      switch (Message)
579      {
580          case WM_COMMAND :
581          {
582              switch (wParam)
583              {
584                  case IDC_OPERATOR_STYLER :
585                  {
586                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_OPERATOR, SCE_USER_MASK_NESTING_NONE);
587                      stylerDlg.doDialog();
588                      return TRUE;
589                  }
590                  case IDC_DELIMITER1_STYLER :
591                  {
592                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER1);
593                      stylerDlg.doDialog();
594                      return TRUE;
595                  }
596                  case IDC_DELIMITER2_STYLER :
597                  {
598                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER2);
599                      stylerDlg.doDialog();
600                      return TRUE;
601                  }
602                  case IDC_DELIMITER3_STYLER :
603                  {
604                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER3);
605                      stylerDlg.doDialog();
606                      return TRUE;
607                  }
608                  case IDC_DELIMITER4_STYLER :
609                  {
610                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER4);
611                      stylerDlg.doDialog();
612                      return TRUE;
613                  }
614                  case IDC_DELIMITER5_STYLER :
615                  {
616                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER5);
617                      stylerDlg.doDialog();
618                      return TRUE;
619                  }
620                  case IDC_DELIMITER6_STYLER :
621                  {
622                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER6);
623                      stylerDlg.doDialog();
624                      return TRUE;
625                  }
626                  case IDC_DELIMITER7_STYLER :
627                  {
628                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER7);
629                      stylerDlg.doDialog();
630                      return TRUE;
631                  }
632                  case IDC_DELIMITER8_STYLER :
633                  {
634                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER8);
635                      stylerDlg.doDialog();
636                      return TRUE;
637                  }
638                  default :
639                      return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
640              }
641          }
642          default :
643              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
644      }
645  }
646  void SymbolsStyleDialog::retrieve(TCHAR *dest, const TCHAR *toRetrieve, TCHAR *prefix) const
647  {
648      int j = 0;
649      bool begin2Copy = false;
650      bool inGroup = false;
651      for (size_t i = 0, len = lstrlen(toRetrieve); i &lt; len ; ++i)
652      {
653          if ((i == 0 || (toRetrieve[i-1] == &#x27; &#x27;)) &amp;&amp; (toRetrieve[i] == prefix[0] &amp;&amp; toRetrieve[i+1] == prefix[1]))
654          {
655              if (j &gt; 0)
656                  dest[j++] = &#x27; &#x27;;
657              begin2Copy = true;
658              ++i;
659              continue;
660          }
661          if (toRetrieve[i] == &#x27;(&#x27; &amp;&amp; toRetrieve[i+1] == &#x27;(&#x27; &amp;&amp; inGroup == false &amp;&amp; begin2Copy == true)
662          {
663              inGroup = true;
664          }
665          if (toRetrieve[i] != &#x27;)&#x27; &amp;&amp; toRetrieve[i-1] == &#x27;)&#x27; &amp;&amp; toRetrieve[i-2] == &#x27;)&#x27; &amp;&amp; inGroup == true)
666          {
667              inGroup = false;
668          }
669          if (toRetrieve[i] == &#x27; &#x27; &amp;&amp; begin2Copy == true)
670          {
671              begin2Copy = false;
672          }
673          if (begin2Copy || inGroup)
674              dest[j++] = toRetrieve[i];
675      }
676      dest[j++] = &#x27;\0&#x27;;
677  }
678  void SymbolsStyleDialog::setKeywords2List(int id)
679  {
680      switch (id)
681      {
682          case IDC_OPERATOR1_EDIT :
683              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_OPERATORS1], max_char);
684              break;
685          case IDC_OPERATOR2_EDIT :
686              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_OPERATORS2], max_char);
687              break;
688          case IDC_DELIMITER1_BOUNDARYOPEN_EDIT :
689          case IDC_DELIMITER1_ESCAPE_EDIT :
690          case IDC_DELIMITER1_BOUNDARYCLOSE_EDIT :
691          case IDC_DELIMITER2_BOUNDARYOPEN_EDIT :
692          case IDC_DELIMITER2_ESCAPE_EDIT :
693          case IDC_DELIMITER2_BOUNDARYCLOSE_EDIT :
694          case IDC_DELIMITER3_BOUNDARYOPEN_EDIT :
695          case IDC_DELIMITER3_ESCAPE_EDIT :
696          case IDC_DELIMITER3_BOUNDARYCLOSE_EDIT :
697          case IDC_DELIMITER4_BOUNDARYOPEN_EDIT :
698          case IDC_DELIMITER4_ESCAPE_EDIT :
699          case IDC_DELIMITER4_BOUNDARYCLOSE_EDIT :
700          case IDC_DELIMITER5_BOUNDARYOPEN_EDIT :
701          case IDC_DELIMITER5_ESCAPE_EDIT :
702          case IDC_DELIMITER5_BOUNDARYCLOSE_EDIT :
703          case IDC_DELIMITER6_BOUNDARYOPEN_EDIT :
704          case IDC_DELIMITER6_ESCAPE_EDIT :
705          case IDC_DELIMITER6_BOUNDARYCLOSE_EDIT :
706          case IDC_DELIMITER7_BOUNDARYOPEN_EDIT :
707          case IDC_DELIMITER7_ESCAPE_EDIT :
708          case IDC_DELIMITER7_BOUNDARYCLOSE_EDIT :
709          case IDC_DELIMITER8_BOUNDARYOPEN_EDIT :
710          case IDC_DELIMITER8_ESCAPE_EDIT :
711          case IDC_DELIMITER8_BOUNDARYCLOSE_EDIT :
712          {
713              TCHAR* newList = new TCHAR[max_char];
714              newList[0] = &#x27;\0&#x27;;
715              TCHAR* buffer = new TCHAR[max_char];
716              buffer[0] = &#x27;\0&#x27;;
717              TCHAR intBuffer[10] = {&#x27;0&#x27;, 0};
718              const int list[] = {
719                  IDC_DELIMITER1_BOUNDARYOPEN_EDIT,
720                  IDC_DELIMITER1_ESCAPE_EDIT,
721                  IDC_DELIMITER1_BOUNDARYCLOSE_EDIT,
722                  IDC_DELIMITER2_BOUNDARYOPEN_EDIT,
723                  IDC_DELIMITER2_ESCAPE_EDIT,
724                  IDC_DELIMITER2_BOUNDARYCLOSE_EDIT,
725                  IDC_DELIMITER3_BOUNDARYOPEN_EDIT,
726                  IDC_DELIMITER3_ESCAPE_EDIT,
727                  IDC_DELIMITER3_BOUNDARYCLOSE_EDIT,
728                  IDC_DELIMITER4_BOUNDARYOPEN_EDIT,
729                  IDC_DELIMITER4_ESCAPE_EDIT,
730                  IDC_DELIMITER4_BOUNDARYCLOSE_EDIT,
731                  IDC_DELIMITER5_BOUNDARYOPEN_EDIT,
732                  IDC_DELIMITER5_ESCAPE_EDIT,
733                  IDC_DELIMITER5_BOUNDARYCLOSE_EDIT,
734                  IDC_DELIMITER6_BOUNDARYOPEN_EDIT,
735                  IDC_DELIMITER6_ESCAPE_EDIT,
736                  IDC_DELIMITER6_BOUNDARYCLOSE_EDIT,
737                  IDC_DELIMITER7_BOUNDARYOPEN_EDIT,
738                  IDC_DELIMITER7_ESCAPE_EDIT,
739                  IDC_DELIMITER7_BOUNDARYCLOSE_EDIT,
740                  IDC_DELIMITER8_BOUNDARYOPEN_EDIT,
741                  IDC_DELIMITER8_ESCAPE_EDIT,
742                  IDC_DELIMITER8_BOUNDARYCLOSE_EDIT
743              };
744              for (int i = 0; static_cast&lt;size_t&gt;(i) &lt; sizeof(list)/sizeof(int); ++i)
745              {
746                  if (i &lt; 10)
747                      _itow(i, intBuffer+1, 10);
748                  else
749                      _itow(i, intBuffer, 10);
750                  int dd = list[i];
751                  ::GetDlgItemText(_hSelf, dd, buffer, max_char);
752                  convertTo(newList, max_char, buffer, intBuffer);
753              }
754  			wcscpy_s(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_DELIMITERS], newList);
755              delete[] newList;
756              delete[] buffer;
757              break;
758          }
759          default :
760              break;
761      }
762  }
763  UserDefineDialog::UserDefineDialog(): SharedParametersDialog()
764  {
765      _pCurrentUserLang = new UserLangContainer();
766      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DEFAULT,              globalMappper().styleNameMapper[SCE_USER_STYLE_DEFAULT].c_str());
767      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_COMMENT,              globalMappper().styleNameMapper[SCE_USER_STYLE_COMMENT].c_str());
768      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_COMMENTLINE,          globalMappper().styleNameMapper[SCE_USER_STYLE_COMMENTLINE].c_str());
769      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_NUMBER,               globalMappper().styleNameMapper[SCE_USER_STYLE_NUMBER].c_str());
770      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD1,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD1].c_str());
771      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD2,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD2].c_str());
772      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD3,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD3].c_str());
773      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD4,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD4].c_str());
774      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD5,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD5].c_str());
775      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD6,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD6].c_str());
776      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD7,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD7].c_str());
777      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD8,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD8].c_str());
778      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_OPERATOR,             globalMappper().styleNameMapper[SCE_USER_STYLE_OPERATOR].c_str());
779      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_FOLDER_IN_CODE1,      globalMappper().styleNameMapper[SCE_USER_STYLE_FOLDER_IN_CODE1].c_str());
780      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_FOLDER_IN_CODE2,      globalMappper().styleNameMapper[SCE_USER_STYLE_FOLDER_IN_CODE2].c_str());
781      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_FOLDER_IN_COMMENT,    globalMappper().styleNameMapper[SCE_USER_STYLE_FOLDER_IN_COMMENT].c_str());
782      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER1,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER1].c_str());
783      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER2,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER2].c_str());
784      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER3,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER3].c_str());
785      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER4,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER4].c_str());
786      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER5,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER5].c_str());
787      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER6,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER6].c_str());
788      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER7,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER7].c_str());
789      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER8,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER8].c_str());
790  }
791  UserDefineDialog::~UserDefineDialog()
792  {
793      delete _pCurrentUserLang;
794  }
795  void UserDefineDialog::reloadLangCombo()
796  {
797      NppParameters&amp; nppParam = NppParameters::getInstance();
798      ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_RESETCONTENT, 0, 0);
799  	::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;User Defined Language&quot;)));
800      for (int i = 0, nb = nppParam.getNbUserLang(); i &lt; nb ; ++i)
801      {
802          UserLangContainer &amp; userLangContainer = nppParam.getULCFromIndex(i);
803  		::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(userLangContainer.getName()));
804      }
805  }
806  void UserDefineDialog::changeStyle()
807  {
808      _status = !_status;
809      NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
810      TiXmlNodeA *targetNode = nullptr;
811      if (pNativeSpeaker-&gt;getNativeLangA())
812      {
813          targetNode = (pNativeSpeaker-&gt;getNativeLangA())-&gt;FirstChildElement(&quot;Dialog&quot;);
814          if (targetNode)
815              targetNode = targetNode-&gt;FirstChildElement(&quot;UserDefine&quot;);
816      }
817      generic_string dockButtonLabel;
818      generic_string defauleLabel;
819      string idStr;
820      if (_status == DOCK)
821      {
822          defauleLabel = TEXT(&quot;Undock&quot;);
823          idStr = std::to_string(IDC_UNDOCK_BUTTON);
824      }
825      else
826      {
827          defauleLabel = TEXT(&quot;Dock&quot;);
828          idStr = std::to_string(IDC_DOCK_BUTTON);
829      }
830      dockButtonLabel = pNativeSpeaker-&gt;getAttrNameByIdStr(defauleLabel.c_str(), targetNode, idStr.c_str());
831      ::SetDlgItemText(_hSelf, IDC_DOCK_BUTTON, dockButtonLabel.c_str());
832      auto style = ::GetWindowLongPtr(_hSelf, GWL_STYLE);
833      if (!style)
834          ::MessageBox(NULL, TEXT(&quot;GetWindowLongPtr failed in UserDefineDialog::changeStyle()&quot;), TEXT(&quot;&quot;), MB_OK);
835      style = (_status == DOCK)?
836          ((style &amp; ~WS_POPUP) &amp; ~DS_MODALFRAME &amp; ~WS_CAPTION) | WS_CHILD :
837          (style &amp; ~WS_CHILD) | WS_POPUP | DS_MODALFRAME | WS_CAPTION;
838      auto result = ::SetWindowLongPtr(_hSelf, GWL_STYLE, style);
839      if (!result)
840          ::MessageBox(NULL, TEXT(&quot;SetWindowLongPtr failed in UserDefineDialog::changeStyle()&quot;), TEXT(&quot;&quot;), MB_OK);
841      if (_status == DOCK)
842          getActualPosSize();
843      else
844          restorePosSize();
845      ::SetParent(_hSelf, (_status == DOCK)?_hParent:NULL);
846  }
847  void UserDefineDialog::enableLangAndControlsBy(size_t index)
848  {
849      _pUserLang = (index == 0)?_pCurrentUserLang:&amp;((NppParameters::getInstance()).getULCFromIndex(index - 1));
850      if (index != 0)
851          ::SetWindowText(::GetDlgItem(_hSelf, IDC_EXT_EDIT), _pUserLang-&gt;_ext.c_str());
852      ::ShowWindow(::GetDlgItem(_hSelf, IDC_EXT_STATIC), (index == 0)?SW_HIDE:SW_SHOW);
853      ::ShowWindow(::GetDlgItem(_hSelf, IDC_EXT_EDIT), (index == 0)?SW_HIDE:SW_SHOW);
854      ::ShowWindow(::GetDlgItem(_hSelf, IDC_RENAME_BUTTON), (index == 0)?SW_HIDE:SW_SHOW);
855      ::ShowWindow(::GetDlgItem(_hSelf, IDC_REMOVELANG_BUTTON), (index == 0)?SW_HIDE:SW_SHOW);
856  }
857  void UserDefineDialog::updateDlg()
858  {
859  	int i = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0));
860  	if (i &gt; 0) 
861  	{
862  		NppParameters&amp; nppParam = NppParameters::getInstance();
863  		nppParam.setUdlXmlDirtyFromIndex(i - 1);
864  	}
865      ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_IGNORECASE_CHECK, BM_SETCHECK, _pUserLang-&gt;_isCaseIgnored, 0);
866      _folderStyleDlg.updateDlg();
867      _keyWordsStyleDlg.updateDlg();
868      _commentStyleDlg.updateDlg();
869      _symbolsStyleDlg.updateDlg();
870  }
871  intptr_t CALLBACK UserDefineDialog::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
872  {
873      NppParameters&amp; nppParam = NppParameters::getInstance();
874  	NativeLangSpeaker * pNativeSpeaker = nppParam.getNativeLangSpeaker();
875      switch (message)
876      {
877          case WM_INITDIALOG :
878          {
879              _pUserLang = _pCurrentUserLang;
880              _ctrlTab.init(_hInst, _hSelf, false);
881              NppDarkMode::subclassTabControl(_ctrlTab.getHSelf());
882              int tabDpiDynamicalHeight = nppParam._dpiManager.scaleY(13);
883              _ctrlTab.setFont(TEXT(&quot;Tahoma&quot;), tabDpiDynamicalHeight);
884              _folderStyleDlg.init(_hInst, _hSelf);
885              _folderStyleDlg.create(IDD_FOLDER_STYLE_DLG);
886              _folderStyleDlg.display();
887              _keyWordsStyleDlg.init(_hInst, _hSelf);
888              _keyWordsStyleDlg.create(IDD_KEYWORD_STYLE_DLG);
889              _keyWordsStyleDlg.display(false);
890              _commentStyleDlg.init(_hInst, _hSelf);
891              _commentStyleDlg.create(IDD_COMMENT_STYLE_DLG);
892              _commentStyleDlg.display(false);
893              _symbolsStyleDlg.init(_hInst, _hSelf);
894              _symbolsStyleDlg.create(IDD_SYMBOL_STYLE_DLG);
895              _symbolsStyleDlg.display(false);
896              _wVector.push_back(DlgInfo(&amp;_folderStyleDlg,    TEXT(&quot;Folder &amp;&amp; Default&quot;)));
897              _wVector.push_back(DlgInfo(&amp;_keyWordsStyleDlg,  TEXT(&quot;Keywords Lists&quot;)));
898              _wVector.push_back(DlgInfo(&amp;_commentStyleDlg,   TEXT(&quot;Comment &amp;&amp; Number&quot;)));
899              _wVector.push_back(DlgInfo(&amp;_symbolsStyleDlg,   TEXT(&quot;Operators &amp;&amp; Delimiters&quot;)));
900              _ctrlTab.createTabs(_wVector);
901              _ctrlTab.display();
902              RECT arc{};
903              ::GetWindowRect(::GetDlgItem(_hSelf, IDC_IMPORT_BUTTON), &amp;arc);
904              POINT p{};
905              p.x = arc.left;
906              p.y = arc.bottom;
907              ::ScreenToClient(_hSelf, &amp;p);
908              RECT rc{};
909              getClientRect(rc);
910              rc.top = p.y + 10;
911              rc.bottom -= 20;
912              _ctrlTab.reSizeTo(rc);
913              _folderStyleDlg.reSizeTo(rc);
914              _keyWordsStyleDlg.reSizeTo(rc);
915              _commentStyleDlg.reSizeTo(rc);
916              _symbolsStyleDlg.reSizeTo(rc);
917              reloadLangCombo();
918              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, 0, 0);
919              enableLangAndControlsBy(0);
920              if (nppParam.isTransparentAvailable())
921              {
922                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_TRANSPARENT_CHECK), SW_SHOW);
923                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), SW_SHOW);
924                  ::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_SETRANGE, FALSE, MAKELONG(20, 200));
925                  ::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_SETPOS, TRUE, 150);
926                  if (!(BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, BM_GETCHECK, 0, 0)))
927                      ::EnableWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), FALSE);
928              }
929              SCROLLINFO si{};
930              si.cbSize = sizeof(si);
931              si.fMask  = SIF_RANGE; 
932              si.nMin   = 0;
933              si.nMax   = 0;
934              ::SetScrollInfo(_hSelf, SB_VERT, &amp;si, TRUE);
935              TCHAR temp[32] = { &#x27;\0&#x27; };
936              generic_string udlVersion = TEXT(&quot;User Defined Language v.&quot;);
937              udlVersion += _itow(SCE_UDL_VERSION_MAJOR, temp, 10);
938              udlVersion += TEXT(&quot;.&quot;);
939              udlVersion += _itow(SCE_UDL_VERSION_MINOR, temp, 10);
940              udlVersion += TEXT(&quot;.&quot;);
941              udlVersion += _itow(SCE_UDL_VERSION_BUILD, temp, 10);
942              udlVersion += TEXT(&quot;.&quot;);
943              udlVersion += _itow(SCE_UDL_VERSION_REVISION, temp, 10);
944              ::SetWindowText(_hSelf, udlVersion.c_str());
945              NppDarkMode::autoSubclassAndThemeChildControls(_hSelf);
946              NppDarkMode::setDarkScrollBar(_hSelf);
947              return TRUE;
948          }
949          case WM_CTLCOLOREDIT:
950          {
951              return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
952          }
953          case WM_CTLCOLORLISTBOX:
954          {
955              return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
956          }
957          case WM_CTLCOLORDLG:
958          case WM_CTLCOLORSTATIC:
959          {
960              return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
961          }
962          case WM_PRINTCLIENT:
963          {
964              if (NppDarkMode::isEnabled())
965              {
966                  return TRUE;
967              }
968              break;
969          }
970          case NPPM_INTERNAL_REFRESHDARKMODE:
971          {
972              NppDarkMode::autoThemeChildControls(_hSelf);
973              NppDarkMode::setDarkScrollBar(_hSelf);
974              return TRUE;
975          }
976          case WM_NOTIFY:
977          {
978              NMHDR *nmhdr = (NMHDR *)lParam;
979              if (nmhdr-&gt;code == TCN_SELCHANGE)
980              {
981                  if (nmhdr-&gt;hwndFrom == _ctrlTab.getHSelf())
982                  {
983                      _ctrlTab.clickedUpdate();
984                      return TRUE;
985                  }
986              }
987              break;
988          }
989          case WM_HSCROLL:
990          {
991              if (reinterpret_cast&lt;HWND&gt;(lParam) == ::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER))
992              {
993  				int percent = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_GETPOS, 0, 0));
994                  nppParam.SetTransparent(_hSelf, percent);
995              }
996              return TRUE;
997          }
998          case WM_COMMAND :
999          {
1000              if (HIWORD(wParam) == EN_CHANGE)
1001              {
1002                  TCHAR ext[extsLenMax] = { &#x27;\0&#x27; };
1003  				::SendDlgItemMessage(_hSelf, IDC_EXT_EDIT, WM_GETTEXT, extsLenMax, reinterpret_cast&lt;LPARAM&gt;(ext));
1004                  _pUserLang-&gt;_ext = ext;
1005                  return TRUE;
1006              }
1007              else if (HIWORD(wParam) == CBN_SELCHANGE)
1008              {
1009                  if (LOWORD(wParam) == IDC_LANGNAME_COMBO)
1010                  {
1011  					auto i = ::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETCURSEL, 0, 0);
1012                      enableLangAndControlsBy(i);
1013                      updateDlg();
1014                  }
1015                  return TRUE;
1016              }
1017              else
1018              {
1019                  switch (wParam)
1020                  {
1021                      case IDC_DOCK_BUTTON :
1022                      {
1023                          int msg = WM_UNDOCK_USERDEFINE_DLG;
1024                          if (_status == UNDOCK)
1025                          {
1026                              if (nppParam.isTransparentAvailable())
1027                              {
1028                                  nppParam.removeTransparent(_hSelf);
1029                                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_TRANSPARENT_CHECK), SW_HIDE);
1030                                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), SW_HIDE);
1031                              }
1032                              msg = WM_DOCK_USERDEFINE_DLG;
1033                          }
1034                          changeStyle();
1035                          if (_status == UNDOCK)
1036                          {
1037                              if (nppParam.isTransparentAvailable())
1038                              {
1039                                  bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_UD_TRANSPARENT_CHECK, BM_GETCHECK, 0, 0));
1040                                  if (isChecked)
1041                                  {
1042  									int percent = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_GETPOS, 0, 0));
1043                                      nppParam.SetTransparent(_hSelf, percent);
1044                                  }
1045                                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_TRANSPARENT_CHECK), SW_SHOW);
1046                                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), SW_SHOW);
1047                              }
1048                          }
1049                          ::SendMessage(_hParent, msg, 0, 0);
1050                          return TRUE;
1051                      }
1052                      case IDCANCEL:
1053  					{
1054  						::SendMessage(_hParent, WM_CLOSE_USERDEFINE_DLG, 0, 0);
1055  						display(false);
1056  						return TRUE;
1057  					}
1058                      case IDC_REMOVELANG_BUTTON :
1059                      {
1060                          int result = nppParam.getNativeLangSpeaker()-&gt;messageBox(&quot;UDLRemoveCurrentLang&quot;,
1061  							_hSelf,
1062  							TEXT(&quot;Are you sure?&quot;),
1063  							TEXT(&quot;Remove the current language&quot;),
1064  							MB_YESNO);
1065                          if (result == IDYES)
1066                          {
1067                              auto i = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1068  							const size_t langNameLen = 256;
1069  							TCHAR langName[langNameLen + 1] = { &#x27;\0&#x27; };
1070  							auto cbTextLen = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETLBTEXTLEN, i, 0);
1071  							if (static_cast&lt;size_t&gt;(cbTextLen) &gt; langNameLen)
1072  								return TRUE;
1073  							::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETLBTEXT, i, reinterpret_cast&lt;LPARAM&gt;(langName));
1074                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_DELETESTRING, i, 0);
1075                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, i-1, 0);
1076  							::SendMessage(_hSelf, WM_COMMAND, MAKELONG(IDC_LANGNAME_COMBO, CBN_SELCHANGE), reinterpret_cast&lt;LPARAM&gt;(::GetDlgItem(_hSelf, IDC_LANGNAME_COMBO)));
1077                              nppParam.removeUserLang(i-1);
1078                              HWND hNpp = ::GetParent(_hSelf);
1079  							HMENU m = reinterpret_cast&lt;HMENU&gt;(::SendMessage(hNpp, NPPM_INTERNAL_GETMENU, 0, 0));
1080  							HMENU subMenu = ::GetSubMenu(m, MENUINDEX_LANGUAGE);
1081  							::RemoveMenu(subMenu, static_cast&lt;UINT&gt;(IDM_LANG_USER + i), MF_BYCOMMAND);
1082                              ::DrawMenuBar(hNpp);
1083  							::SendMessage(_hParent, WM_REMOVE_USERLANG, 0, reinterpret_cast&lt;LPARAM&gt;(langName));
1084                          }
1085                          return TRUE;
1086                      }
1087                      case IDC_RENAME_BUTTON :
1088                      {
1089                          auto i = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1090  						const size_t langNameLen = 256;
1091  						TCHAR langName[langNameLen + 1] = { &#x27;\0&#x27; };
1092  						auto cbTextLen = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETLBTEXTLEN, i, 0);
1093  						if (static_cast&lt;size_t&gt;(cbTextLen) &gt; langNameLen)
1094  							return TRUE;
1095  						::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETLBTEXT, i, reinterpret_cast&lt;LPARAM&gt;(langName));
1096  						generic_string strName = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;common-name&quot;, TEXT(&quot;Name&quot;));
1097  						generic_string strTitle = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;userdefined-title-rename&quot;, TEXT(&quot;Rename Current Language Name&quot;));
1098                          StringDlg strDlg;
1099                          strDlg.init(_hInst, _hSelf, strTitle.c_str(), strName.c_str(), langName, langNameLenMax - 1);
1100                          TCHAR *newName = (TCHAR *)strDlg.doDialog();
1101                          if (newName)
1102                          {
1103                              if (nppParam.isExistingUserLangName(newName))
1104                              {
1105  								nppParam.getNativeLangSpeaker()-&gt;messageBox(&quot;UDLNewNameError&quot;,
1106  									_hSelf,
1107  									TEXT(&quot;This name is used by another language,\rplease give another one.&quot;),
1108  									TEXT(&quot;UDL Error&quot;),
1109  									MB_OK);
1110                                  ::PostMessage(_hSelf, WM_COMMAND, IDC_RENAME_BUTTON, 0);
1111                                  return TRUE;
1112                              }
1113                              if (nppParam.getNbUserLang() &gt;= NB_MAX_USER_LANG)
1114                                  return TRUE;
1115                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_DELETESTRING, i, 0);
1116  							::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_INSERTSTRING, i, reinterpret_cast&lt;LPARAM&gt;(newName));
1117                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, i, 0);
1118                              UserLangContainer &amp; userLangContainer = nppParam.getULCFromIndex(i-1);
1119                              userLangContainer._name = newName;
1120                              HWND hNpp = ::GetParent(_hSelf);
1121  							HMENU hM = reinterpret_cast&lt;HMENU&gt;(::SendMessage(hNpp, NPPM_INTERNAL_GETMENU, 0, 0));
1122  							HMENU hSubM = ::GetSubMenu(hM, MENUINDEX_LANGUAGE);
1123                              ::ModifyMenu(hSubM, static_cast&lt;UINT&gt;(IDM_LANG_USER + i), MF_BYCOMMAND, IDM_LANG_USER + i, newName);
1124                              ::DrawMenuBar(hNpp);
1125  							::SendMessage(_hParent, WM_RENAME_USERLANG, reinterpret_cast&lt;WPARAM&gt;(newName), reinterpret_cast&lt;LPARAM&gt;(langName));
1126                          }
1127                          return TRUE;
1128                      }
1129                      case IDC_ADDNEW_BUTTON :
1130                      case IDC_SAVEAS_BUTTON :
1131                      {
1132                          auto i = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1133                          if (i == 0)
1134                              wParam = IDC_ADDNEW_BUTTON;
1135  						generic_string strName = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;common-name&quot;, TEXT(&quot;Name&quot;));
1136  						generic_string strTitle = (wParam == IDC_SAVEAS_BUTTON) ?
1137  							pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;userdefined-title-save&quot;, TEXT(&quot;Save Current Language Name As...&quot;)) :
1138  							pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;userdefined-title-new&quot;, TEXT(&quot;Create New Language...&quot;));
1139                          StringDlg strDlg;
1140  						strDlg.init(_hInst, _hSelf, strTitle.c_str(), strName.c_str(), TEXT(&quot;&quot;), langNameLenMax - 1);
1141                          TCHAR *tmpName = reinterpret_cast&lt;TCHAR *&gt;(strDlg.doDialog());
1142                          if (tmpName &amp;&amp; tmpName[0])
1143                          {
1144                              generic_string newNameString(tmpName);
1145                              const TCHAR *newName = newNameString.c_str();
1146                              if (nppParam.isExistingUserLangName(newName))
1147                              {
1148  								pNativeSpeaker-&gt;messageBox(&quot;UDLNewNameError&quot;,
1149  									_hSelf,
1150  									TEXT(&quot;This name is used by another language,\rplease give another one.&quot;),
1151  									TEXT(&quot;UDL Error&quot;),
1152  									MB_OK);
1153                                  ::PostMessage(_hSelf, WM_COMMAND, IDC_RENAME_BUTTON, 0);
1154                                  return TRUE;
1155                              }
1156                              if (nppParam.getNbUserLang() &gt;= NB_MAX_USER_LANG)
1157                                  return TRUE;
1158                              UserLangContainer &amp; userLang = (wParam == IDC_SAVEAS_BUTTON)?nppParam.getULCFromIndex(i-1):*_pCurrentUserLang;
1159                              int newIndex = nppParam.addUserLangToEnd(userLang, newName);
1160                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_ADDSTRING, 0, LPARAM(newName));
1161                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, newIndex + 1, 0);
1162  							::SendMessage(_hSelf, WM_COMMAND, MAKELONG(IDC_LANGNAME_COMBO, CBN_SELCHANGE), reinterpret_cast&lt;LPARAM&gt;(::GetDlgItem(_hSelf, IDC_LANGNAME_COMBO)));
1163                              HWND hNpp = ::GetParent(_hSelf);
1164  							HMENU m = reinterpret_cast&lt;HMENU&gt;(::SendMessage(hNpp, NPPM_INTERNAL_GETMENU, 0, 0));
1165                              ::InsertMenu(::GetSubMenu(m, MENUINDEX_LANGUAGE), IDM_LANG_USER + newIndex, MF_BYCOMMAND, IDM_LANG_USER + newIndex + 1, newName);
1166                              ::DrawMenuBar(hNpp);
1167                          }
1168                          return TRUE;
1169                      }
1170                      case IDC_IMPORT_BUTTON :
1171                      {
1172                          CustomFileDialog fDlg(_hSelf);
1173                          fDlg.setExtFilter(TEXT(&quot;UDL&quot;), TEXT(&quot;.xml&quot;));
1174                          generic_string sourceFile = fDlg.doOpenSingleFileDlg();
1175                          if (sourceFile.empty()) break;
1176                          bool isSuccessful = nppParam.importUDLFromFile(sourceFile);
1177                          if (isSuccessful)
1178                          {
1179                              auto i = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1180                              reloadLangCombo();
1181                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, i, 0);
1182                              printStr(TEXT(&quot;Import successful.&quot;));
1183                          }
1184                          else
1185                          {
1186                              printStr(TEXT(&quot;Fail to import.&quot;));
1187                          }
1188                          break;
1189                      }
1190                      case IDC_EXPORT_BUTTON :
1191                      {
1192  						auto i2Export = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1193                          if (i2Export == 0)
1194                          {
1195                              printStr(TEXT(&quot;Before exporting, save your language definition by clicking \&quot;Save As...\&quot; button&quot;));
1196                              break;
1197                          }
1198                          CustomFileDialog fDlg(_hSelf);
1199                          fDlg.setExtFilter(TEXT(&quot;UDL&quot;), TEXT(&quot;.xml&quot;));
1200  						fDlg.setExtIndex(0);		
1201  						generic_string fileName2save = fDlg.doSaveDlg();
1202                          if (fileName2save.empty()) break;
1203                          if (i2Export &gt; 0)
1204                          {
1205                              bool isSuccessful = nppParam.exportUDLToFile(i2Export - 1, fileName2save);
1206                              if (isSuccessful)
1207                              {
1208                                  printStr(TEXT(&quot;Export successful&quot;));
1209                              }
1210                              else
1211                              {
1212                                  printStr(TEXT(&quot;Fail to export.&quot;));
1213                              }
1214                          }
1215                          break;
1216                      }
1217                      case IDC_UD_TRANSPARENT_CHECK :
1218                      {
1219                          bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_UD_TRANSPARENT_CHECK, BM_GETCHECK, 0, 0));
1220                          if (isChecked)
1221                          {
1222  							int percent = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_GETPOS, 0, 0));
1223                              nppParam.SetTransparent(_hSelf, percent);
1224                          }
1225                          else
1226                              nppParam.removeTransparent(_hSelf);
1227                          ::EnableWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), isChecked);
1228                          return TRUE;
1229                      }
1230                      case IDC_LANGNAME_IGNORECASE_CHECK :
1231                          return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isCaseIgnored);
1232                      default :
1233                          break;
1234                  }
1235              }
1236              return FALSE;
1237          }
1238          case WM_DESTROY:
1239          {
1240              _folderStyleDlg.destroy();
1241              _keyWordsStyleDlg.destroy();
1242              _commentStyleDlg.destroy();
1243              _symbolsStyleDlg.destroy();
1244              _ctrlTab.destroy();
1245              return TRUE;
1246          }
1247          case WM_SIZE:
1248          {
1249              int originalHight = _dlgPos.bottom; 
1250              _currentHight = HIWORD (lParam);
1251              int diff = _currentHight - _prevHightVal;
1252              _prevHightVal = _currentHight;
1253               int maxPos = originalHight - _currentHight;
1254              SCROLLINFO si{};
1255              si.cbSize = sizeof(si);
1256              si.fMask  = SIF_RANGE | SIF_PAGE;
1257              si.nMin   = 0;
1258              si.nMax   = (_status == UNDOCK)?0:originalHight;
1259              si.nPage  = _currentHight;
1260              ::SetScrollInfo(_hSelf, SB_VERT, &amp;si, TRUE);
1261              if ((_yScrollPos &gt;= maxPos) &amp;&amp; (_currentHight &lt; originalHight))
1262              {
1263                  if (_yScrollPos &gt; 0)
1264                  {
1265                      _yScrollPos -= diff;
1266                      ::SetScrollPos(_hSelf, SB_VERT, _yScrollPos, TRUE);
1267                      ::ScrollWindow(_hSelf, 0, diff, NULL, NULL);
1268                  }
1269              }
1270              return TRUE;
1271          }
1272          case WM_VSCROLL :
1273          {
1274              int originalHight = _dlgPos.bottom;
1275              int oldy = _yScrollPos;
1276              int maxPos = originalHight - _currentHight;
1277              switch (LOWORD (wParam))
1278              {
1279                  case SB_LINEUP:
1280                      if (_yScrollPos &lt;= 0)
1281                          return FALSE;
1282                      _yScrollPos = 0;
1283                      break;
1284                  case SB_LINEDOWN:
1285                      if (_yScrollPos &gt;= maxPos)
1286                          return FALSE;
1287                      _yScrollPos = maxPos;
1288                      break;
1289                  case SB_PAGEDOWN:
1290                      if (_yScrollPos &gt;= maxPos)
1291                          return FALSE;
1292                      _yScrollPos = maxPos;
1293                      break;
1294                  case SB_PAGEUP:
1295                      if (_yScrollPos &lt;= 0)
1296                          return FALSE;
1297                      _yScrollPos = 0;
1298                      break;
1299                  case SB_THUMBTRACK:
1300                  case SB_THUMBPOSITION:
1301                      _yScrollPos = HIWORD(wParam);
1302                      break;
1303                  default :
1304                      return FALSE;
1305              }
1306              ::SetScrollPos(_hSelf, SB_VERT, _yScrollPos, TRUE);
1307              ::ScrollWindow(_hSelf, 0, oldy-_yScrollPos, NULL, NULL);
1308              break;
1309          }
1310          case NPPM_MODELESSDIALOG :
1311              return ::SendMessage(_hParent, NPPM_MODELESSDIALOG, wParam, lParam);
1312      }
1313      return FALSE;
1314  }
1315  intptr_t CALLBACK StringDlg::run_dlgProc(UINT Message, WPARAM wParam, LPARAM)
1316  {
1317      switch (Message)
1318      {
1319          case WM_INITDIALOG :
1320          {
1321  			NppDarkMode::autoSubclassAndThemeChildControls(_hSelf);
1322  			if (_restrictedChars.length())
1323  			{
1324  				::SetWindowLongPtr(GetDlgItem(_hSelf, IDC_STRING_EDIT), GWLP_USERDATA, reinterpret_cast&lt;LONG_PTR&gt;(this));
1325  				_oldEditProc = reinterpret_cast&lt;WNDPROC&gt;(SetWindowLongPtr(GetDlgItem(_hSelf, IDC_STRING_EDIT), GWLP_WNDPROC, reinterpret_cast&lt;LONG_PTR&gt;(customEditProc)));
1326  			}
1327              ::SetWindowText(_hSelf, _title.c_str());
1328              ::SetDlgItemText(_hSelf, IDC_STRING_STATIC, _static.c_str());
1329              ::SetDlgItemText(_hSelf, IDC_STRING_EDIT, _textValue.c_str());
1330              if (_txtLen)
1331                  ::SendDlgItemMessage(_hSelf, IDC_STRING_EDIT, EM_SETLIMITTEXT, _txtLen, 0);
1332  			NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
1333  			if (pNativeSpeaker)
1334  			{
1335  				generic_string ok = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;common-ok&quot;, TEXT(&quot;OK&quot;));
1336  				generic_string cancel = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;common-cancel&quot;, TEXT(&quot;Cancel&quot;));
1337  				::SetDlgItemText(_hSelf, IDOK, ok.c_str());
1338  				::SetDlgItemText(_hSelf, IDCANCEL, cancel.c_str());
1339  			}
1340  			if (_shouldGotoCenter)
1341  				goToCenter(SWP_SHOWWINDOW | SWP_NOSIZE);
1342  			return TRUE;
1343  		}
1344  		case WM_CTLCOLOREDIT:
1345  		{
1346  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
1347  		}
1348  		case WM_CTLCOLORDLG:
1349  		case WM_CTLCOLORSTATIC:
1350  		{
1351  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1352  		}
1353  		case WM_PRINTCLIENT:
1354  		{
1355  			if (NppDarkMode::isEnabled())
1356  			{
1357  				return TRUE;
1358  			}
1359  			break;
1360  		}
1361  		case WM_ERASEBKGND:
1362  		{
1363  			if (NppDarkMode::isEnabled())
1364  			{
1365  				RECT rc{};
1366  				getClientRect(rc);
1367  				::FillRect(reinterpret_cast&lt;HDC&gt;(wParam), &amp;rc, NppDarkMode::getDarkerBackgroundBrush());
1368  				return TRUE;
1369  			}
1370  			break;
1371  		}
1372  		case NPPM_INTERNAL_REFRESHDARKMODE:
1373  		{
1374  			NppDarkMode::autoThemeChildControls(_hSelf);
1375  			return TRUE;
1376  		}
1377          case WM_COMMAND :
1378          {
1379              switch (wParam)
1380              {
1381                  case IDOK :
1382                  {
1383                      TCHAR tmpName[langNameLenMax] = { &#x27;\0&#x27; };
1384                      ::GetDlgItemText(_hSelf, IDC_STRING_EDIT, tmpName, langNameLenMax);
1385                      _textValue = tmpName;
1386                      ::EndDialog(_hSelf, reinterpret_cast&lt;intptr_t&gt;(_textValue.c_str()));
1387                      return TRUE;
1388                  }
1389                  case IDCANCEL :
1390                      ::EndDialog(_hSelf, 0);
1391                      return TRUE;
1392                  default:
1393                      return FALSE;
1394              }
1395          }
1396          default :
1397              return FALSE;
1398      }
1399  	return FALSE;
1400  }
1401  LRESULT StringDlg::customEditProc(HWND hEdit, UINT msg, WPARAM wParam, LPARAM lParam)
1402  {
1403  	StringDlg *pSelf = reinterpret_cast&lt;StringDlg *&gt;(::GetWindowLongPtr(hEdit, GWLP_USERDATA));
1404  	if (!pSelf)
1405  	{
1406  		return 0;
1407  	}
1408  	switch (msg)
1409  	{
1410  	case WM_CHAR:
1411  		if (0x80 &amp; GetKeyState(VK_CONTROL))
1412  		{
1413  			switch (wParam)
1414  			{
1415  			case 0x16: 
1416  				pSelf-&gt;HandlePaste(hEdit);
1417  				return 0;
1418  			case 0x03: 
1419  			case 0x18: 
1420  			default:
1421  				break;
1422  			}
1423  		}
1424  		else
1425  		{
1426  			if (!pSelf-&gt;isAllowed(reinterpret_cast&lt;TCHAR*&gt;(&amp;wParam)))
1427  				return 0;
1428  		}
1429  		break;
1430  	case WM_DESTROY:
1431  		SetWindowLongPtr(hEdit, GWLP_WNDPROC, reinterpret_cast&lt;LONG_PTR&gt;(pSelf-&gt;_oldEditProc));
1432  		return 0;
1433  	}
1434  	return CallWindowProc(pSelf-&gt;_oldEditProc, hEdit, msg, wParam, lParam);
1435  }
1436  bool StringDlg::isAllowed([[maybe_unused]] const generic_string &amp; txt)
1437  {
1438  #ifndef __MINGW32__
1439  	for (auto ch : txt)
1440  	{
1441  		if (std::find(_restrictedChars.cbegin(), _restrictedChars.cend(), ch) != _restrictedChars.cend())
1442  			return false;
1443  	}
1444  #endif
1445  	return true;
1446  }
1447  void StringDlg::HandlePaste(HWND hEdit)
1448  {
1449  	if (OpenClipboard(hEdit))
1450  	{
1451  		HANDLE hClipboardData = GetClipboardData(CF_UNICODETEXT);
1452  		if (NULL != hClipboardData)
1453  		{
1454  			LPTSTR pszText = static_cast&lt;LPTSTR&gt;(GlobalLock(hClipboardData));
1455  			if (NULL != pszText &amp;&amp; isAllowed(pszText))
1456  			{
1457  				SendMessage(hEdit, EM_REPLACESEL, TRUE, reinterpret_cast&lt;LPARAM&gt;(pszText));
1458  			}
1459  			GlobalUnlock(hClipboardData);
1460  		}
1461  		CloseClipboard();
1462  	}
1463  }
1464  void StylerDlg::move2CtrlRight(HWND hwndDlg, int ctrlID, HWND handle2Move, int handle2MoveWidth, int handle2MoveHeight)
1465  {
1466      POINT p{};
1467      RECT rc{};
1468      ::GetWindowRect(::GetDlgItem(hwndDlg, ctrlID), &amp;rc);
1469      p.x = rc.right + NppParameters::getInstance()._dpiManager.scaleX(5);
1470      p.y = rc.top + ((rc.bottom - rc.top) / 2) - handle2MoveHeight / 2;
1471      ::ScreenToClient(hwndDlg, &amp;p);
1472      ::MoveWindow(handle2Move, p.x, p.y, handle2MoveWidth, handle2MoveHeight, TRUE);
1473  }
1474  intptr_t CALLBACK StylerDlg::dlgProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)
1475  {
1476      StylerDlg * dlg = (StylerDlg *)::GetProp(hwnd, TEXT(&quot;Styler dialog prop&quot;));
1477      NppParameters&amp; nppParam = NppParameters::getInstance();
1478      switch (message)
1479      {
1480          case WM_INITDIALOG :
1481          {
1482              NppDarkMode::setDarkTitleBar(hwnd);
1483              NppDarkMode::autoSubclassAndThemeChildControls(hwnd);
1484              NativeLangSpeaker *pNativeLangSpeaker = nppParam.getNativeLangSpeaker();
1485              pNativeLangSpeaker-&gt;changeUserDefineLangPopupDlg(hwnd);
1486              ::SetProp(hwnd, TEXT(&quot;Styler dialog prop&quot;), (HANDLE)lParam);
1487              dlg = (StylerDlg *)::GetProp(hwnd, TEXT(&quot;Styler dialog prop&quot;));
1488              Style &amp; style = SharedParametersDialog::_pUserLang-&gt;_styles.getStyler(dlg-&gt;_stylerIndex);
1489              RECT wrc{};
1490              ::GetWindowRect(dlg-&gt;_parent, &amp;wrc);
1491              wrc.left = wrc.left &lt; 0 ? 200 : wrc.left;   
1492              wrc.top = wrc.top &lt; 0 ? 200 : wrc.top;
1493              ::SetWindowPos(hwnd, HWND_TOP, wrc.left, wrc.top, 0, 0, SWP_NOSIZE | SWP_NOZORDER);
1494              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_UNDERLINE, BM_SETCHECK, style._fontStyle &amp; FONTSTYLE_UNDERLINE, 0);
1495              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_ITALIC,    BM_SETCHECK, style._fontStyle &amp; FONTSTYLE_ITALIC, 0);
1496              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_BOLD,      BM_SETCHECK, style._fontStyle &amp; FONTSTYLE_BOLD, 0);
1497              HWND hFontSizeCombo = ::GetDlgItem(hwnd, IDC_STYLER_COMBO_FONT_SIZE);
1498              for (size_t j = 0 ; j &lt; int(sizeof(fontSizeStrs))/(3*sizeof(TCHAR)) ; ++j)
1499  				::SendMessage(hFontSizeCombo, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(fontSizeStrs[j]));
1500              TCHAR size[10] = { &#x27;\0&#x27; };
1501              if (style._fontSize == -1)
1502                  size[0] = &#x27;\0&#x27;;
1503              else
1504                  wsprintf(size, TEXT(&quot;%d&quot;),style._fontSize);
1505  			auto i = ::SendMessage(hFontSizeCombo, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(size));
1506              if (i != CB_ERR)
1507                  ::SendMessage(hFontSizeCombo, CB_SETCURSEL, i, 0);
1508              HWND hFontNameCombo = ::GetDlgItem(hwnd, IDC_STYLER_COMBO_FONT_NAME);
1509              const std::vector&lt;generic_string&gt; &amp; fontlist = nppParam.getFontList();
1510              for (size_t j = 0, len = fontlist.size() ; j &lt; len ; ++j)
1511              {
1512  				auto k = ::SendMessage(hFontNameCombo, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(fontlist[j].c_str()));
1513  				::SendMessage(hFontNameCombo, CB_SETITEMDATA, k, reinterpret_cast&lt;LPARAM&gt;(fontlist[j].c_str()));
1514              }
1515  			i = ::SendMessage(hFontNameCombo, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(style._fontName.c_str()));
1516              if (i == CB_ERR)
1517                  i = 0;
1518              ::SendMessage(hFontNameCombo, CB_SETCURSEL, i, 0);
1519              if (style._fgColor == COLORREF(-1))
1520                  style._fgColor = black;
1521              if (style._bgColor == COLORREF(-1))
1522                  style._bgColor = white;
1523              dlg-&gt;_pFgColour-&gt;init(dlg-&gt;_hInst, hwnd);
1524              dlg-&gt;_pFgColour-&gt;setColour(style._fgColor);
1525              bool isFgEnabled = (style._colorStyle &amp; COLORSTYLE_FOREGROUND) != 0;
1526              dlg-&gt;_pFgColour-&gt;setEnabled(isFgEnabled);
1527              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_FG_TRANSPARENT, BM_SETCHECK, !isFgEnabled, 0);
1528              dlg-&gt;_pBgColour-&gt;init(dlg-&gt;_hInst, hwnd);
1529              dlg-&gt;_pBgColour-&gt;setColour(style._bgColor);
1530              bool isBgEnabled = (style._colorStyle &amp; COLORSTYLE_BACKGROUND) != 0;
1531              dlg-&gt;_pBgColour-&gt;setEnabled(isBgEnabled);
1532              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_BG_TRANSPARENT, BM_SETCHECK, !isBgEnabled, 0);
1533              int w = nppParam._dpiManager.scaleX(25);
1534              int h = nppParam._dpiManager.scaleY(25);
1535              dlg-&gt;move2CtrlRight(hwnd, IDC_STYLER_FG_STATIC, dlg-&gt;_pFgColour-&gt;getHSelf(), w, h);
1536              dlg-&gt;move2CtrlRight(hwnd, IDC_STYLER_BG_STATIC, dlg-&gt;_pBgColour-&gt;getHSelf(), w, h);
1537              dlg-&gt;_pFgColour-&gt;display();
1538              dlg-&gt;_pBgColour-&gt;display();
1539              unordered_map&lt;int, int&gt;::iterator iter = globalMappper().nestingMapper.begin();
1540              for (; iter != globalMappper().nestingMapper.end(); ++iter)
1541              {
1542                  ::SendDlgItemMessage(hwnd, iter-&gt;first, BM_SETCHECK, style._nesting &amp; iter-&gt;second, 0);
1543                  ::EnableWindow(::GetDlgItem(hwnd, iter-&gt;first), dlg-&gt;_enabledNesters &amp; iter-&gt;second);
1544              }
1545              return TRUE;
1546          }
1547          case WM_CTLCOLOREDIT:
1548          {
1549              return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
1550          }
1551          case WM_CTLCOLORLISTBOX:
1552          {
1553              return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
1554          }
1555          case WM_CTLCOLORDLG:
1556          case WM_CTLCOLORSTATIC:
1557          {
1558              return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1559          }
1560          case WM_PRINTCLIENT:
1561          {
1562              if (NppDarkMode::isEnabled())
1563              {
1564                  return TRUE;
1565              }
1566              break;
1567          }
1568          case NPPM_INTERNAL_REFRESHDARKMODE:
1569          {
1570              NppDarkMode::setDarkTitleBar(hwnd);
1571              NppDarkMode::autoThemeChildControls(hwnd);
1572              ::SetWindowPos(hwnd, nullptr, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOZORDER | SWP_FRAMECHANGED);
1573              return TRUE;
1574          }
1575          case WM_COMMAND :
1576          {
1577  			if (dlg == nullptr)
1578  				return FALSE;
1579              Style &amp; style = SharedParametersDialog::_pUserLang-&gt;_styles.getStyler(dlg-&gt;_stylerIndex);
1580              if (HIWORD(wParam) == CBN_SELCHANGE)
1581              {
1582                  auto i = ::SendDlgItemMessage(hwnd, LOWORD(wParam), CB_GETCURSEL, 0, 0);
1583                  if (LOWORD(wParam) == IDC_STYLER_COMBO_FONT_SIZE)
1584                  {
1585                      if (i != 0)
1586                      {
1587  						const size_t intStrLen = 3;
1588  						TCHAR intStr[intStrLen] = { &#x27;\0&#x27; };
1589  						auto lbTextLen = ::SendDlgItemMessage(hwnd, LOWORD(wParam), CB_GETLBTEXTLEN, i, 0);
1590  						if (static_cast&lt;size_t&gt;(lbTextLen) &gt; intStrLen - 1)
1591  							return TRUE;
1592  						::SendDlgItemMessage(hwnd, LOWORD(wParam), CB_GETLBTEXT, i, reinterpret_cast&lt;LPARAM&gt;(intStr));
1593                          if (!intStr[0])
1594                              style._fontSize = -1;
1595                          else
1596                          {
1597                              TCHAR *finStr = nullptr;
1598                              style._fontSize = wcstol(intStr, &amp;finStr, 10);
1599                              if (*finStr != &#x27;\0&#x27;)
1600                                  style._fontSize = -1;
1601                          }
1602                      }
1603                      else
1604                      {
1605                          style._fontSize = -1;
1606                      }
1607                  }
1608                  else if (LOWORD(wParam) == IDC_STYLER_COMBO_FONT_NAME)
1609                  {
1610                      style._fontName = (TCHAR *)::SendDlgItemMessage(hwnd, LOWORD(wParam), CB_GETITEMDATA, i, 0);
1611                  }
1612                  if (SharedParametersDialog::_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
1613                      SharedParametersDialog::_pScintilla-&gt;styleChange();
1614                  return TRUE;
1615              }
1616              else if (HIWORD(wParam) == CPN_COLOURPICKED)    
1617              {
1618                  if (wParam == IDCANCEL)
1619                  {
1620                      style = dlg-&gt;_initialStyle;
1621                      if (SharedParametersDialog::_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
1622                          SharedParametersDialog::_pScintilla-&gt;styleChange();
1623                      ::RemoveProp(hwnd, TEXT(&quot;Styler dialog prop&quot;));
1624                      ::EndDialog(hwnd, IDCANCEL);
1625                      return TRUE;
1626                  }
1627                  if (wParam == IDOK)
1628                  {
1629                      ::RemoveProp(hwnd, TEXT(&quot;Styler dialog prop&quot;));
1630                      ::EndDialog(hwnd, IDOK);
1631                      return TRUE;
1632                  }
1633                  style._fgColor = dlg-&gt;_pFgColour-&gt;getColour();
1634                  style._bgColor = dlg-&gt;_pBgColour-&gt;getColour();
1635  				if (wParam == IDC_STYLER_CHECK_FG_TRANSPARENT || wParam == IDC_STYLER_CHECK_BG_TRANSPARENT)
1636  				{
1637  					if (wParam == IDC_STYLER_CHECK_FG_TRANSPARENT)
1638  					{
1639  						bool isTransparent = (BST_CHECKED == ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_FG_TRANSPARENT, BM_GETCHECK, 0, 0));
1640  						dlg-&gt;_pFgColour-&gt;setEnabled(!isTransparent);
1641  						dlg-&gt;_pFgColour-&gt;redraw();
1642                          if (isTransparent)
1643  						    style._colorStyle &amp;= ~COLORSTYLE_FOREGROUND;
1644                          else
1645                              style._colorStyle |= COLORSTYLE_FOREGROUND;
1646  					}
1647  					if (wParam == IDC_STYLER_CHECK_BG_TRANSPARENT)
1648  					{
1649  						bool isTransparent = (BST_CHECKED == ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_BG_TRANSPARENT, BM_GETCHECK, 0, 0));
1650  						dlg-&gt;_pBgColour-&gt;setEnabled(!isTransparent);
1651  						dlg-&gt;_pBgColour-&gt;redraw();
1652                          if (isTransparent)
1653  						    style._colorStyle &amp;= ~COLORSTYLE_BACKGROUND;
1654                          else
1655  						    style._colorStyle |= COLORSTYLE_BACKGROUND;
1656  					}
1657  				}
1658  				else
1659  				{
1660  					if (dlg-&gt;_pFgColour-&gt;isEnabled())
1661  					{
1662  						style._colorStyle |= COLORSTYLE_FOREGROUND;
1663  					}
1664  					else
1665  					{
1666  						style._colorStyle &amp;= ~COLORSTYLE_FOREGROUND;
1667  					}
1668  					::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_FG_TRANSPARENT, BM_SETCHECK, !dlg-&gt;_pFgColour-&gt;isEnabled(), 0);
1669  					if (dlg-&gt;_pBgColour-&gt;isEnabled())
1670  					{
1671  						style._colorStyle |= COLORSTYLE_BACKGROUND;
1672  					}
1673  					else
1674  					{
1675  						style._colorStyle &amp;= ~COLORSTYLE_BACKGROUND;
1676  					}
1677  					::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_BG_TRANSPARENT, BM_SETCHECK, !dlg-&gt;_pBgColour-&gt;isEnabled(), 0);
1678  				}
1679                  style._fontStyle = FONTSTYLE_NONE;
1680                  if (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, IDC_STYLER_CHECK_BOLD), BM_GETCHECK, 0, 0))
1681                      style._fontStyle |= FONTSTYLE_BOLD;
1682                  if (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, IDC_STYLER_CHECK_ITALIC), BM_GETCHECK, 0, 0))
1683                      style._fontStyle |= FONTSTYLE_ITALIC;
1684                  if (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, IDC_STYLER_CHECK_UNDERLINE), BM_GETCHECK, 0, 0))
1685                      style._fontStyle |= FONTSTYLE_UNDERLINE;
1686                  style._nesting = SCE_USER_MASK_NESTING_NONE;
1687                  unordered_map&lt;int, int&gt;::iterator iter = globalMappper().nestingMapper.begin();
1688                  for (; iter != globalMappper().nestingMapper.end(); ++iter)
1689                  {
1690                      if (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, iter-&gt;first), BM_GETCHECK, 0, 0))
1691                          style._nesting |= iter-&gt;second;
1692                  }
1693                  if (SharedParametersDialog::_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
1694                      SharedParametersDialog::_pScintilla-&gt;styleChange();
1695                  return TRUE;
1696              }
1697              return FALSE;
1698          }
1699          case WM_CLOSE:
1700          {
1701              return TRUE;
1702          }
1703          default :
1704              return FALSE;
1705      }
1706      return FALSE;
1707  }
</code></pre>
        </div>
        <div class="column">
            <h3>notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-UserDefineDialog.cpp</h3>
            <pre><code>1  #include &quot;localization.h&quot;
2  #include &quot;UserDefineDialog.h&quot;
3  #include &quot;ScintillaEditView.h&quot;
4  #include &quot;Notepad_plus_msgs.h&quot;
5  #include &quot;CustomFileDialog.h&quot;
6  using namespace std;
7  UserLangContainer * SharedParametersDialog::_pUserLang = NULL;
8  ScintillaEditView * SharedParametersDialog::_pScintilla = NULL;
9  GlobalMappers &amp; globalMappper()
10  {
11      static GlobalMappers gm;
12      return gm;
13  }
14  void convertTo(TCHAR *dest, int destLen, const TCHAR *toConvert, const TCHAR *prefix)
15  {
16  	bool inGroup = false;
17  	int index = lstrlen(dest);
18  	if (index &gt; 0)
19  		dest[index++] = &#x27; &#x27;;
20  	dest[index++] = prefix[0];
21  	dest[index++] = prefix[1];
22  	for (size_t i = 0, len = lstrlen(toConvert); i &lt; len &amp;&amp; index &lt; destLen - 7; ++i)
23  	{
24  		if (i == 0 &amp;&amp; toConvert[i] == &#x27;(&#x27; &amp;&amp; toConvert[i + 1] == &#x27;(&#x27;)
25  		{
26  			inGroup = true;
27  		}
28  		else if (toConvert[i] == &#x27; &#x27; &amp;&amp; toConvert[i + 1] == &#x27;(&#x27; &amp;&amp; toConvert[i + 2] == &#x27;(&#x27;)
29  		{
30  			inGroup = true;
31  			dest[index++] = &#x27; &#x27;;
32  			dest[index++] = prefix[0];
33  			dest[index++] = prefix[1];
34  			++i;    
35  		}
36  		if (inGroup &amp;&amp; toConvert[i - 1] == &#x27;)&#x27; &amp;&amp; toConvert[i - 2] == &#x27;)&#x27;)
37  		{
38  			inGroup = false;
39  		}
40  		if (toConvert[i] == &#x27; &#x27;)
41  		{
42  			if (toConvert[i + 1] != &#x27; &#x27; &amp;&amp; toConvert[i + 1] != &#x27;\0&#x27;)
43  			{
44  				dest[index++] = &#x27; &#x27;;
45  				if (!inGroup)
46  				{
47  					dest[index++] = prefix[0];
48  					dest[index++] = prefix[1];
49  				}
50  			}
51  		}
52  		else
53  		{
54  			dest[index++] = toConvert[i];
55  		}
56  	}
57  	dest[index] = &#x27;\0&#x27;;
58  }
59  bool SharedParametersDialog::setPropertyByCheck(HWND hwnd, WPARAM id, bool &amp; bool2set)
60  {
61      bool2set = (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, int(id)), BM_GETCHECK, 0, 0));
62      if (_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
63          _pScintilla-&gt;styleChange();
64      return TRUE;
65  }
66  intptr_t CALLBACK SharedParametersDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM &amp;bsol;*lParam*/)
67  {
68      switch (Message)
69      {
70          case WM_INITDIALOG :
71          {
72              return TRUE;
73          }
74          case WM_CTLCOLOREDIT:
75          {
76              return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
77          }
78          case WM_CTLCOLORDLG:
79          case WM_CTLCOLORSTATIC:
80          {
81              return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
82          }
83          case WM_PRINTCLIENT:
84          {
85              if (NppDarkMode::isEnabled())
86              {
87                  return TRUE;
88              }
89              break;
90          }
91          case WM_COMMAND :
92          {
93              if (HIWORD(wParam) == EN_CHANGE)
94              {
95                  setKeywords2List(LOWORD(wParam));
96                  if (_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
97                      _pScintilla-&gt;styleChange();
98                  return TRUE;
99              }
100              return FALSE;
101          }
102      }
103      return FALSE;
104  }
105  intptr_t CALLBACK FolderStyleDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM lParam)
106  {
107      switch (Message)
108      {
109          case WM_INITDIALOG :
110          {
111              _pageLink.init(_hInst, _hSelf);
112              _pageLink.create(::GetDlgItem(_hSelf, IDC_WEB_HELP_LINK), TEXT(&quot;https:&amp;bsol;&amp;bsol;ivan-radic.github.io/udl-documentation/&quot;));
113              return TRUE;
114          }
115          case WM_COMMAND :
116          {
117              switch (wParam)
118              {
119                  case IDC_FOLDER_FOLD_COMPACT :
120                  {
121                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_foldCompact);
122                  }
123                  case IDC_FOLDER_IN_CODE1_STYLER :
124                  {
125                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_FOLDER_IN_CODE1, SCE_USER_MASK_NESTING_NONE);
126                      stylerDlg.doDialog();
127                      return TRUE;
128                  }
129                  case IDC_FOLDER_IN_CODE2_STYLER :
130                  {
131                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_FOLDER_IN_CODE2, SCE_USER_MASK_NESTING_NONE);
132                      stylerDlg.doDialog();
133                      return TRUE;
134                  }
135                  case IDC_FOLDER_IN_COMMENT_STYLER :
136                  {
137                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_FOLDER_IN_COMMENT, SCE_USER_MASK_NESTING_NONE);
138                      stylerDlg.doDialog();
139                      return TRUE;
140                  }
141                  case IDC_DEFAULT_STYLER :
142                  {
143                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DEFAULT, SCE_USER_MASK_NESTING_NONE);
144                      stylerDlg.doDialog();
145                      return TRUE;
146                  }
147                  default :
148                      return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
149              }
150          }
151          case WM_DESTROY:
152          {
153              _pageLink.destroy();
154              return TRUE;
155          }
156          default :
157              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
158      }
159  }
160  void FolderStyleDialog::setKeywords2List(int id)
161  {
162      switch (id)
163      {
164          case IDC_FOLDER_IN_CODE1_OPEN_EDIT :     
165          case IDC_FOLDER_IN_CODE1_MIDDLE_EDIT :   
166          case IDC_FOLDER_IN_CODE1_CLOSE_EDIT :    
167          case IDC_FOLDER_IN_CODE2_OPEN_EDIT :     
168          case IDC_FOLDER_IN_CODE2_MIDDLE_EDIT :   
169          case IDC_FOLDER_IN_CODE2_CLOSE_EDIT :    
170          case IDC_FOLDER_IN_COMMENT_OPEN_EDIT :   
171          case IDC_FOLDER_IN_COMMENT_MIDDLE_EDIT : 
172          case IDC_FOLDER_IN_COMMENT_CLOSE_EDIT :  
173              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[globalMappper().dialogMapper[id]], max_char);
174              break;
175      }
176  }
177  void FolderStyleDialog::updateDlg()
178  {
179      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_FOLD_COMPACT,           BM_SETCHECK, _pUserLang-&gt;_foldCompact, 0);
180      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE1_OPEN_EDIT,     WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE1_OPEN]));
181      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE1_MIDDLE_EDIT,   WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE1_MIDDLE]));
182      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE1_CLOSE_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE1_CLOSE]));
183      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE2_OPEN_EDIT,     WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE2_OPEN]));
184      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE2_MIDDLE_EDIT,   WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE2_MIDDLE]));
185      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_CODE2_CLOSE_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_CODE2_CLOSE]));
186      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_COMMENT_OPEN_EDIT,   WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_COMMENT_OPEN]));
187      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_COMMENT_MIDDLE_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_COMMENT_MIDDLE]));
188      ::SendDlgItemMessage(_hSelf, IDC_FOLDER_IN_COMMENT_CLOSE_EDIT,  WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_FOLDERS_IN_COMMENT_CLOSE]));
189  }
190  void FolderStyleDialog::retrieve(TCHAR *dest, const TCHAR *toRetrieve, TCHAR *prefix) const
191  {
192      int j = 0;
193      bool begin2Copy = false;
194      for (size_t i = 0, len = lstrlen(toRetrieve); i &lt; len ; ++i)
195      {
196          if ((i == 0 || (toRetrieve[i-1] == &#x27; &#x27;)) &amp;&amp; (toRetrieve[i] == prefix[0] &amp;&amp; toRetrieve[i+1] == prefix[1]))
197          {
198              if (j &gt; 0)
199                  dest[j++] = &#x27; &#x27;;
200              begin2Copy = true;
201              ++i;
202              continue;
203          }
204          else if (((toRetrieve[i] == &#x27; &#x27;) &amp;&amp; begin2Copy == true))
205          {
206              begin2Copy = false;
207          }
208          if (begin2Copy)
209              dest[j++] = toRetrieve[i];
210      }
211      dest[j++] = &#x27;\0&#x27;;
212  }
213  intptr_t CALLBACK KeyWordsStyleDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM lParam)
214  {
215      switch (Message)
216      {
217          case WM_INITDIALOG :
218          {
219              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD1_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
220              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD2_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
221              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD3_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
222              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD4_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
223              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD5_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
224              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD6_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
225              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD7_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
226              ::SendMessage(::GetDlgItem(_hSelf,IDC_KEYWORD8_EDIT), EM_LIMITTEXT, WPARAM(128*1024), 0);
227              return TRUE;
228          }
229          case WM_COMMAND :
230          {
231              switch (wParam)
232              {
233                  case IDC_KEYWORD1_PREFIX_CHECK :
234                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[0]);
235                  case IDC_KEYWORD2_PREFIX_CHECK :
236                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[1]);
237                  case IDC_KEYWORD3_PREFIX_CHECK :
238                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[2]);
239                  case IDC_KEYWORD4_PREFIX_CHECK :
240                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[3]);
241                  case IDC_KEYWORD5_PREFIX_CHECK :
242                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[4]);
243                  case IDC_KEYWORD6_PREFIX_CHECK :
244                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[5]);
245                  case IDC_KEYWORD7_PREFIX_CHECK :
246                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[6]);
247                  case IDC_KEYWORD8_PREFIX_CHECK :
248                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isPrefix[7]);
249                  case IDC_KEYWORD1_STYLER :
250                  {
251                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD1, SCE_USER_MASK_NESTING_NONE);
252                      stylerDlg.doDialog();
253                      return TRUE;
254                  }
255                  case IDC_KEYWORD2_STYLER :
256                  {
257                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD2, SCE_USER_MASK_NESTING_NONE);
258                      stylerDlg.doDialog();
259                      return TRUE;
260                  }
261                  case IDC_KEYWORD3_STYLER :
262                  {
263                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD3, SCE_USER_MASK_NESTING_NONE);
264                      stylerDlg.doDialog();
265                      return TRUE;
266                  }
267                  case IDC_KEYWORD4_STYLER :
268                  {
269                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD4, SCE_USER_MASK_NESTING_NONE);
270                      stylerDlg.doDialog();
271                      return TRUE;
272                  }
273                  case IDC_KEYWORD5_STYLER :
274                  {
275                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD5, SCE_USER_MASK_NESTING_NONE);
276                      stylerDlg.doDialog();
277                      return TRUE;
278                  }
279                  case IDC_KEYWORD6_STYLER :
280                  {
281                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD6, SCE_USER_MASK_NESTING_NONE);
282                      stylerDlg.doDialog();
283                      return TRUE;
284                  }
285                  case IDC_KEYWORD7_STYLER :
286                  {
287                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD7, SCE_USER_MASK_NESTING_NONE);
288                      stylerDlg.doDialog();
289                      return TRUE;
290                  }
291                  case IDC_KEYWORD8_STYLER :
292                  {
293                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_KEYWORD8, SCE_USER_MASK_NESTING_NONE);
294                      stylerDlg.doDialog();
295                      return TRUE;
296                  }
297                  default :
298                      return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
299              }
300          }
301          default :
302              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
303      }
304  }
305  void KeyWordsStyleDialog::setKeywords2List(int id)
306  {
307      switch (id)
308      {
309          case IDC_KEYWORD1_EDIT :
310          case IDC_KEYWORD2_EDIT :
311          case IDC_KEYWORD3_EDIT :
312          case IDC_KEYWORD4_EDIT :
313          case IDC_KEYWORD5_EDIT :
314          case IDC_KEYWORD6_EDIT :
315          case IDC_KEYWORD7_EDIT :
316          case IDC_KEYWORD8_EDIT :
317              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[globalMappper().dialogMapper[id]], max_char);
318      }
319  }
320  void KeyWordsStyleDialog::updateDlg()
321  {
322      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD1_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS1]));
323      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD2_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS2]));
324      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD3_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS3]));
325      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD4_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS4]));
326      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD5_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS5]));
327      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD6_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS6]));
328      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD7_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS7]));
329      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD8_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_KEYWORDS8]));
330      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD1_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[0], 0);
331      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD2_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[1], 0);
332      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD3_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[2], 0);
333      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD4_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[3], 0);
334      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD5_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[4], 0);
335      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD6_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[5], 0);
336      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD7_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[6], 0);
337      ::SendDlgItemMessage(_hSelf, IDC_KEYWORD8_PREFIX_CHECK, BM_SETCHECK, _pUserLang-&gt;_isPrefix[7], 0);
338  }
339  intptr_t CALLBACK CommentStyleDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM lParam)
340  {
341      switch (Message)
342      {
343          case WM_ACTIVATE :
344          case WM_SHOWWINDOW :
345          {
346              ::SendDlgItemMessage(_hSelf, IDC_ALLOW_ANYWHERE,    BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_NONE, 0);
347              ::SendDlgItemMessage(_hSelf, IDC_FORCE_AT_BOL,      BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_BOL,  0);
348              ::SendDlgItemMessage(_hSelf, IDC_ALLOW_WHITESPACE,  BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_WSP,  0);
349              ::SendDlgItemMessage(_hSelf, IDC_DOT_RADIO,         BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_DOT,   0);
350              ::SendDlgItemMessage(_hSelf, IDC_COMMA_RADIO,       BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_COMMA, 0);
351              ::SendDlgItemMessage(_hSelf, IDC_BOTH_RADIO,        BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_BOTH,  0);
352              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
353          }
354          case WM_COMMAND :
355          {
356              switch (wParam)
357              {
358                  case IDC_FOLDING_OF_COMMENTS :
359                  {
360                      return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_allowFoldOfComments);
361                  }
362                  case IDC_ALLOW_ANYWHERE :
363                  case IDC_FORCE_AT_BOL :
364                  case IDC_ALLOW_WHITESPACE :
365                  {
366                      if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_ALLOW_ANYWHERE), BM_GETCHECK, 0, 0))
367                          _pUserLang-&gt;_forcePureLC = PURE_LC_NONE;
368                      else if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_FORCE_AT_BOL), BM_GETCHECK, 0, 0))
369                          _pUserLang-&gt;_forcePureLC = PURE_LC_BOL;
370                      else if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_ALLOW_WHITESPACE), BM_GETCHECK, 0, 0))
371                          _pUserLang-&gt;_forcePureLC = PURE_LC_WSP;
372                      if (_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
373                          _pScintilla-&gt;styleChange();
374                      return TRUE;
375                  }
376                  case IDC_DOT_RADIO :
377                  case IDC_COMMA_RADIO :
378                  case IDC_BOTH_RADIO :
379                  {
380                      if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_DOT_RADIO), BM_GETCHECK, 0, 0))
381                          _pUserLang-&gt;_decimalSeparator = DECSEP_DOT;
382                      else if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_COMMA_RADIO), BM_GETCHECK, 0, 0))
383                          _pUserLang-&gt;_decimalSeparator = DECSEP_COMMA;
384                      else if (BST_CHECKED == ::SendMessage(::GetDlgItem(_hSelf, IDC_BOTH_RADIO), BM_GETCHECK, 0, 0))
385                          _pUserLang-&gt;_decimalSeparator = DECSEP_BOTH;
386                      if (_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
387                          _pScintilla-&gt;styleChange();
388                      return TRUE;
389                  }
390                  case IDC_COMMENTLINE_STYLER :
391                  {
392                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_COMMENTLINE);
393                      stylerDlg.doDialog();
394                      return TRUE;
395                  }
396                  case IDC_COMMENT_STYLER :
397                  {
398                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_COMMENT);
399                      stylerDlg.doDialog();
400                      return TRUE;
401                  }
402                  case IDC_NUMBER_STYLER :
403                  {
404                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_NUMBER, SCE_USER_MASK_NESTING_NONE);
405                      stylerDlg.doDialog();
406                      return TRUE;
407                  }
408                  default :
409                      return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
410              }
411          }
412          default :
413              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
414      }
415  }
416  void CommentStyleDialog::setKeywords2List(int id)
417  {
418      int index = 0;
419      switch (id)
420      {
421          case IDC_NUMBER_PREFIX1_EDIT :
422          case IDC_NUMBER_PREFIX2_EDIT :
423          case IDC_NUMBER_EXTRAS1_EDIT :
424          case IDC_NUMBER_EXTRAS2_EDIT :
425          case IDC_NUMBER_SUFFIX1_EDIT :
426          case IDC_NUMBER_SUFFIX2_EDIT :
427          case IDC_NUMBER_RANGE_EDIT :  
428          {
429              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[globalMappper().dialogMapper[id]], max_char);
430              break;
431          }
432          case IDC_COMMENT_OPEN_EDIT :
433          case IDC_COMMENT_CLOSE_EDIT :
434          case IDC_COMMENTLINE_OPEN_EDIT :
435          case IDC_COMMENTLINE_CONTINUE_EDIT :
436          case IDC_COMMENTLINE_CLOSE_EDIT :
437              index = SCE_USER_KWLIST_COMMENTS;
438              break;
439          default : index = -1;
440      }
441      if (index != -1)
442      {
443          TCHAR* newList = new TCHAR[max_char];
444          newList[0] = &#x27;\0&#x27;;
445          TCHAR* buffer = new TCHAR[max_char];
446          buffer[0] = &#x27;\0&#x27;;
447          const int list[] = {
448              IDC_COMMENTLINE_OPEN_EDIT,
449              IDC_COMMENTLINE_CONTINUE_EDIT,
450              IDC_COMMENTLINE_CLOSE_EDIT,
451              IDC_COMMENT_OPEN_EDIT,
452              IDC_COMMENT_CLOSE_EDIT
453          };
454          TCHAR intBuffer[10] = { &#x27;0&#x27;, 0 };
455          for (int i = 0; static_cast&lt;size_t&gt;(i) &lt; sizeof(list) / sizeof(int); ++i)
456          {
457              _itow(i, intBuffer + 1, 10);
458              ::GetDlgItemText(_hSelf, list[i], buffer, max_char);
459              convertTo(newList, max_char, buffer, intBuffer);
460          }
461  		wcscpy_s(_pUserLang-&gt;_keywordLists[index], newList);
462          delete[] newList;
463          delete[] buffer;
464      }
465  }
466  void CommentStyleDialog::retrieve(TCHAR *dest, const TCHAR *toRetrieve, const TCHAR *prefix) const
467  {
468      int j = 0;
469      bool begin2Copy = false;
470      bool inGroup = false;
471      for (size_t i = 0, len = lstrlen(toRetrieve); i &lt; len ; ++i)
472      {
473          if ((i == 0 || (toRetrieve[i-1] == &#x27; &#x27;)) &amp;&amp; (toRetrieve[i] == prefix[0] &amp;&amp; toRetrieve[i+1] == prefix[1]))
474          {
475              if (j &gt; 0)
476                  dest[j++] = &#x27; &#x27;;
477              begin2Copy = true;
478              ++i;
479              continue;
480          }
481          if (toRetrieve[i] == &#x27;(&#x27; &amp;&amp; toRetrieve[i+1] == &#x27;(&#x27; &amp;&amp; inGroup == false &amp;&amp; begin2Copy == true)
482          {
483              inGroup = true;
484          }
485          if (toRetrieve[i] != &#x27;)&#x27; &amp;&amp; toRetrieve[i-1] == &#x27;)&#x27; &amp;&amp; toRetrieve[i-2] == &#x27;)&#x27; &amp;&amp; inGroup == true)
486          {
487              inGroup = false;
488          }
489          if (toRetrieve[i] == &#x27; &#x27; &amp;&amp; begin2Copy == true)
490          {
491              begin2Copy = false;
492          }
493          if (begin2Copy || inGroup)
494              dest[j++] = toRetrieve[i];
495      }
496      dest[j++] = &#x27;\0&#x27;;
497  }
498  void CommentStyleDialog::updateDlg()
499  {
500      TCHAR* buffer = new TCHAR[max_char];
501      buffer[0] = &#x27;\0&#x27;;
502      const int list[] = {
503          IDC_COMMENTLINE_OPEN_EDIT,
504          IDC_COMMENTLINE_CONTINUE_EDIT,
505          IDC_COMMENTLINE_CLOSE_EDIT,
506          IDC_COMMENT_OPEN_EDIT,
507          IDC_COMMENT_CLOSE_EDIT
508      };
509      TCHAR intBuffer[10] = { &#x27;0&#x27;, 0 };
510      for (int i = 0; static_cast&lt;size_t&gt;(i) &lt; sizeof(list) / sizeof(int); ++i)
511      {
512          _itow(i, intBuffer + 1, 10);
513          retrieve(buffer, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_COMMENTS], intBuffer);
514          ::SendDlgItemMessage(_hSelf, list[i], WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(buffer));
515      }
516      ::SendDlgItemMessage(_hSelf, IDC_FOLDING_OF_COMMENTS,   BM_SETCHECK, _pUserLang-&gt;_allowFoldOfComments,    0);
517      ::SendDlgItemMessage(_hSelf, IDC_ALLOW_ANYWHERE,        BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_NONE, 0);
518      ::SendDlgItemMessage(_hSelf, IDC_FORCE_AT_BOL,          BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_BOL,  0);
519      ::SendDlgItemMessage(_hSelf, IDC_ALLOW_WHITESPACE,      BM_SETCHECK, _pUserLang-&gt;_forcePureLC == PURE_LC_WSP,  0);
520      ::SendDlgItemMessage(_hSelf, IDC_DOT_RADIO,             BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_DOT, 0);
521      ::SendDlgItemMessage(_hSelf, IDC_COMMA_RADIO,           BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_COMMA,  0);
522      ::SendDlgItemMessage(_hSelf, IDC_BOTH_RADIO,            BM_SETCHECK, _pUserLang-&gt;_decimalSeparator == DECSEP_BOTH,  0);
523      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_PREFIX1_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_PREFIX1]));
524      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_PREFIX2_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_PREFIX2]));
525      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_EXTRAS1_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_EXTRAS1]));
526      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_EXTRAS2_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_EXTRAS2]));
527      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_SUFFIX1_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_SUFFIX1]));
528      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_SUFFIX2_EDIT,    WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_SUFFIX2]));
529      ::SendDlgItemMessage(_hSelf, IDC_NUMBER_RANGE_EDIT,      WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_NUMBER_RANGE]));
530      delete[] buffer;
531  }
532  void SymbolsStyleDialog::updateDlg()
533  {
534      TCHAR* buffer = new TCHAR[max_char];
535      buffer[0] = &#x27;\0&#x27;;
536      const int list[] = {
537          IDC_DELIMITER1_BOUNDARYOPEN_EDIT,
538          IDC_DELIMITER1_ESCAPE_EDIT,
539          IDC_DELIMITER1_BOUNDARYCLOSE_EDIT,
540          IDC_DELIMITER2_BOUNDARYOPEN_EDIT,
541          IDC_DELIMITER2_ESCAPE_EDIT,
542          IDC_DELIMITER2_BOUNDARYCLOSE_EDIT,
543          IDC_DELIMITER3_BOUNDARYOPEN_EDIT,
544          IDC_DELIMITER3_ESCAPE_EDIT,
545          IDC_DELIMITER3_BOUNDARYCLOSE_EDIT,
546          IDC_DELIMITER4_BOUNDARYOPEN_EDIT,
547          IDC_DELIMITER4_ESCAPE_EDIT,
548          IDC_DELIMITER4_BOUNDARYCLOSE_EDIT,
549          IDC_DELIMITER5_BOUNDARYOPEN_EDIT,
550          IDC_DELIMITER5_ESCAPE_EDIT,
551          IDC_DELIMITER5_BOUNDARYCLOSE_EDIT,
552          IDC_DELIMITER6_BOUNDARYOPEN_EDIT,
553          IDC_DELIMITER6_ESCAPE_EDIT,
554          IDC_DELIMITER6_BOUNDARYCLOSE_EDIT,
555          IDC_DELIMITER7_BOUNDARYOPEN_EDIT,
556          IDC_DELIMITER7_ESCAPE_EDIT,
557          IDC_DELIMITER7_BOUNDARYCLOSE_EDIT,
558          IDC_DELIMITER8_BOUNDARYOPEN_EDIT,
559          IDC_DELIMITER8_ESCAPE_EDIT,
560          IDC_DELIMITER8_BOUNDARYCLOSE_EDIT
561      };
562      TCHAR intBuffer[10] = {&#x27;0&#x27;, 0};
563      for (int i = 0; static_cast&lt;size_t&gt;(i) &lt; sizeof(list)/sizeof(int); ++i)
564      {
565          if (i &lt; 10)
566              _itow(i, intBuffer + 1, 10);
567          else
568              _itow(i, intBuffer, 10);
569          retrieve(buffer, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_DELIMITERS], intBuffer);
570  		::SendDlgItemMessage(_hSelf, list[i], WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(buffer));
571      }
572      delete[] buffer;
573      ::SendDlgItemMessage(_hSelf, IDC_OPERATOR1_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_OPERATORS1]));
574      ::SendDlgItemMessage(_hSelf, IDC_OPERATOR2_EDIT, WM_SETTEXT, 0, reinterpret_cast&lt;LPARAM&gt;(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_OPERATORS2]));
575  }
576  intptr_t CALLBACK SymbolsStyleDialog::run_dlgProc(UINT Message, WPARAM wParam, LPARAM lParam)
577  {
578      switch (Message)
579      {
580          case WM_COMMAND :
581          {
582              switch (wParam)
583              {
584                  case IDC_OPERATOR_STYLER :
585                  {
586                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_OPERATOR, SCE_USER_MASK_NESTING_NONE);
587                      stylerDlg.doDialog();
588                      return TRUE;
589                  }
590                  case IDC_DELIMITER1_STYLER :
591                  {
592                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER1);
593                      stylerDlg.doDialog();
594                      return TRUE;
595                  }
596                  case IDC_DELIMITER2_STYLER :
597                  {
598                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER2);
599                      stylerDlg.doDialog();
600                      return TRUE;
601                  }
602                  case IDC_DELIMITER3_STYLER :
603                  {
604                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER3);
605                      stylerDlg.doDialog();
606                      return TRUE;
607                  }
608                  case IDC_DELIMITER4_STYLER :
609                  {
610                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER4);
611                      stylerDlg.doDialog();
612                      return TRUE;
613                  }
614                  case IDC_DELIMITER5_STYLER :
615                  {
616                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER5);
617                      stylerDlg.doDialog();
618                      return TRUE;
619                  }
620                  case IDC_DELIMITER6_STYLER :
621                  {
622                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER6);
623                      stylerDlg.doDialog();
624                      return TRUE;
625                  }
626                  case IDC_DELIMITER7_STYLER :
627                  {
628                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER7);
629                      stylerDlg.doDialog();
630                      return TRUE;
631                  }
632                  case IDC_DELIMITER8_STYLER :
633                  {
634                      StylerDlg stylerDlg(_hInst, _hSelf, SCE_USER_STYLE_DELIMITER8);
635                      stylerDlg.doDialog();
636                      return TRUE;
637                  }
638                  default :
639                      return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
640              }
641          }
642          default :
643              return SharedParametersDialog::run_dlgProc(Message, wParam, lParam);
644      }
645  }
646  void SymbolsStyleDialog::retrieve(TCHAR *dest, const TCHAR *toRetrieve, TCHAR *prefix) const
647  {
648      int j = 0;
649      bool begin2Copy = false;
650      bool inGroup = false;
651      for (size_t i = 0, len = lstrlen(toRetrieve); i &lt; len ; ++i)
652      {
653          if ((i == 0 || (toRetrieve[i-1] == &#x27; &#x27;)) &amp;&amp; (toRetrieve[i] == prefix[0] &amp;&amp; toRetrieve[i+1] == prefix[1]))
654          {
655              if (j &gt; 0)
656                  dest[j++] = &#x27; &#x27;;
657              begin2Copy = true;
658              ++i;
659              continue;
660          }
661          if (toRetrieve[i] == &#x27;(&#x27; &amp;&amp; toRetrieve[i+1] == &#x27;(&#x27; &amp;&amp; inGroup == false &amp;&amp; begin2Copy == true)
662          {
663              inGroup = true;
664          }
665          if (toRetrieve[i] != &#x27;)&#x27; &amp;&amp; toRetrieve[i-1] == &#x27;)&#x27; &amp;&amp; toRetrieve[i-2] == &#x27;)&#x27; &amp;&amp; inGroup == true)
666          {
667              inGroup = false;
668          }
669          if (toRetrieve[i] == &#x27; &#x27; &amp;&amp; begin2Copy == true)
670          {
671              begin2Copy = false;
672          }
673          if (begin2Copy || inGroup)
674              dest[j++] = toRetrieve[i];
675      }
676      dest[j++] = &#x27;\0&#x27;;
677  }
678  void SymbolsStyleDialog::setKeywords2List(int id)
679  {
680      switch (id)
681      {
682          case IDC_OPERATOR1_EDIT :
683              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_OPERATORS1], max_char);
684              break;
685          case IDC_OPERATOR2_EDIT :
686              ::GetDlgItemText(_hSelf, id, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_OPERATORS2], max_char);
687              break;
688          case IDC_DELIMITER1_BOUNDARYOPEN_EDIT :
689          case IDC_DELIMITER1_ESCAPE_EDIT :
690          case IDC_DELIMITER1_BOUNDARYCLOSE_EDIT :
691          case IDC_DELIMITER2_BOUNDARYOPEN_EDIT :
692          case IDC_DELIMITER2_ESCAPE_EDIT :
693          case IDC_DELIMITER2_BOUNDARYCLOSE_EDIT :
694          case IDC_DELIMITER3_BOUNDARYOPEN_EDIT :
695          case IDC_DELIMITER3_ESCAPE_EDIT :
696          case IDC_DELIMITER3_BOUNDARYCLOSE_EDIT :
697          case IDC_DELIMITER4_BOUNDARYOPEN_EDIT :
698          case IDC_DELIMITER4_ESCAPE_EDIT :
699          case IDC_DELIMITER4_BOUNDARYCLOSE_EDIT :
700          case IDC_DELIMITER5_BOUNDARYOPEN_EDIT :
701          case IDC_DELIMITER5_ESCAPE_EDIT :
702          case IDC_DELIMITER5_BOUNDARYCLOSE_EDIT :
703          case IDC_DELIMITER6_BOUNDARYOPEN_EDIT :
704          case IDC_DELIMITER6_ESCAPE_EDIT :
705          case IDC_DELIMITER6_BOUNDARYCLOSE_EDIT :
706          case IDC_DELIMITER7_BOUNDARYOPEN_EDIT :
707          case IDC_DELIMITER7_ESCAPE_EDIT :
708          case IDC_DELIMITER7_BOUNDARYCLOSE_EDIT :
709          case IDC_DELIMITER8_BOUNDARYOPEN_EDIT :
710          case IDC_DELIMITER8_ESCAPE_EDIT :
711          case IDC_DELIMITER8_BOUNDARYCLOSE_EDIT :
712          {
713              TCHAR* newList = new TCHAR[max_char];
714              newList[0] = &#x27;\0&#x27;;
715              TCHAR* buffer = new TCHAR[max_char];
716              buffer[0] = &#x27;\0&#x27;;
717              TCHAR intBuffer[10] = {&#x27;0&#x27;, 0};
718              const int list[] = {
719                  IDC_DELIMITER1_BOUNDARYOPEN_EDIT,
720                  IDC_DELIMITER1_ESCAPE_EDIT,
721                  IDC_DELIMITER1_BOUNDARYCLOSE_EDIT,
722                  IDC_DELIMITER2_BOUNDARYOPEN_EDIT,
723                  IDC_DELIMITER2_ESCAPE_EDIT,
724                  IDC_DELIMITER2_BOUNDARYCLOSE_EDIT,
725                  IDC_DELIMITER3_BOUNDARYOPEN_EDIT,
726                  IDC_DELIMITER3_ESCAPE_EDIT,
727                  IDC_DELIMITER3_BOUNDARYCLOSE_EDIT,
728                  IDC_DELIMITER4_BOUNDARYOPEN_EDIT,
729                  IDC_DELIMITER4_ESCAPE_EDIT,
730                  IDC_DELIMITER4_BOUNDARYCLOSE_EDIT,
731                  IDC_DELIMITER5_BOUNDARYOPEN_EDIT,
732                  IDC_DELIMITER5_ESCAPE_EDIT,
733                  IDC_DELIMITER5_BOUNDARYCLOSE_EDIT,
734                  IDC_DELIMITER6_BOUNDARYOPEN_EDIT,
735                  IDC_DELIMITER6_ESCAPE_EDIT,
736                  IDC_DELIMITER6_BOUNDARYCLOSE_EDIT,
737                  IDC_DELIMITER7_BOUNDARYOPEN_EDIT,
738                  IDC_DELIMITER7_ESCAPE_EDIT,
739                  IDC_DELIMITER7_BOUNDARYCLOSE_EDIT,
740                  IDC_DELIMITER8_BOUNDARYOPEN_EDIT,
741                  IDC_DELIMITER8_ESCAPE_EDIT,
742                  IDC_DELIMITER8_BOUNDARYCLOSE_EDIT
743              };
744              for (int i = 0; static_cast&lt;size_t&gt;(i) &lt; sizeof(list)/sizeof(int); ++i)
745              {
<span onclick='openModal()' class='match'>746                  if (i &lt; 10)
747                      _itow(i, intBuffer+1, 10);
748                  else
749                      _itow(i, intBuffer, 10);
750                  int dd = list[i];
</span>751                  ::GetDlgItemText(_hSelf, dd, buffer, max_char);
752                  convertTo(newList, max_char, buffer, intBuffer);
753              }
754  			wcscpy_s(_pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_DELIMITERS], newList);
755              delete[] newList;
756              delete[] buffer;
757              break;
758          }
759          default :
760              break;
761      }
762  }
763  UserDefineDialog::UserDefineDialog(): SharedParametersDialog()
764  {
765      _pCurrentUserLang = new UserLangContainer();
766      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DEFAULT,              globalMappper().styleNameMapper[SCE_USER_STYLE_DEFAULT].c_str());
767      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_COMMENT,              globalMappper().styleNameMapper[SCE_USER_STYLE_COMMENT].c_str());
768      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_COMMENTLINE,          globalMappper().styleNameMapper[SCE_USER_STYLE_COMMENTLINE].c_str());
769      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_NUMBER,               globalMappper().styleNameMapper[SCE_USER_STYLE_NUMBER].c_str());
770      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD1,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD1].c_str());
771      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD2,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD2].c_str());
772      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD3,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD3].c_str());
773      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD4,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD4].c_str());
774      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD5,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD5].c_str());
775      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD6,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD6].c_str());
776      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD7,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD7].c_str());
777      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_KEYWORD8,             globalMappper().styleNameMapper[SCE_USER_STYLE_KEYWORD8].c_str());
778      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_OPERATOR,             globalMappper().styleNameMapper[SCE_USER_STYLE_OPERATOR].c_str());
779      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_FOLDER_IN_CODE1,      globalMappper().styleNameMapper[SCE_USER_STYLE_FOLDER_IN_CODE1].c_str());
780      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_FOLDER_IN_CODE2,      globalMappper().styleNameMapper[SCE_USER_STYLE_FOLDER_IN_CODE2].c_str());
781      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_FOLDER_IN_COMMENT,    globalMappper().styleNameMapper[SCE_USER_STYLE_FOLDER_IN_COMMENT].c_str());
782      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER1,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER1].c_str());
783      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER2,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER2].c_str());
784      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER3,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER3].c_str());
785      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER4,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER4].c_str());
786      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER5,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER5].c_str());
787      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER6,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER6].c_str());
788      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER7,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER7].c_str());
789      _pCurrentUserLang-&gt;_styles.addStyler(SCE_USER_STYLE_DELIMITER8,           globalMappper().styleNameMapper[SCE_USER_STYLE_DELIMITER8].c_str());
790  }
791  UserDefineDialog::~UserDefineDialog()
792  {
793      delete _pCurrentUserLang;
794  }
795  void UserDefineDialog::reloadLangCombo()
796  {
797      NppParameters&amp; nppParam = NppParameters::getInstance();
798      ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_RESETCONTENT, 0, 0);
799  	::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(TEXT(&quot;User Defined Language&quot;)));
800      for (int i = 0, nb = nppParam.getNbUserLang(); i &lt; nb ; ++i)
801      {
802          UserLangContainer &amp; userLangContainer = nppParam.getULCFromIndex(i);
803  		::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(userLangContainer.getName()));
804      }
805  }
806  void UserDefineDialog::changeStyle()
807  {
808      _status = !_status;
809      NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
810      TiXmlNodeA *targetNode = nullptr;
811      if (pNativeSpeaker-&gt;getNativeLangA())
812      {
813          targetNode = (pNativeSpeaker-&gt;getNativeLangA())-&gt;FirstChildElement(&quot;Dialog&quot;);
814          if (targetNode)
815              targetNode = targetNode-&gt;FirstChildElement(&quot;UserDefine&quot;);
816      }
817      generic_string dockButtonLabel;
818      generic_string defauleLabel;
819      string idStr;
820      if (_status == DOCK)
821      {
822          defauleLabel = TEXT(&quot;Undock&quot;);
823          idStr = std::to_string(IDC_UNDOCK_BUTTON);
824      }
825      else
826      {
827          defauleLabel = TEXT(&quot;Dock&quot;);
828          idStr = std::to_string(IDC_DOCK_BUTTON);
829      }
830      dockButtonLabel = pNativeSpeaker-&gt;getAttrNameByIdStr(defauleLabel.c_str(), targetNode, idStr.c_str());
831      ::SetDlgItemText(_hSelf, IDC_DOCK_BUTTON, dockButtonLabel.c_str());
832      auto style = ::GetWindowLongPtr(_hSelf, GWL_STYLE);
833      if (!style)
834          ::MessageBox(NULL, TEXT(&quot;GetWindowLongPtr failed in UserDefineDialog::changeStyle()&quot;), TEXT(&quot;&quot;), MB_OK);
835      style = (_status == DOCK)?
836          ((style &amp; ~WS_POPUP) &amp; ~DS_MODALFRAME &amp; ~WS_CAPTION) | WS_CHILD :
837          (style &amp; ~WS_CHILD) | WS_POPUP | DS_MODALFRAME | WS_CAPTION;
838      auto result = ::SetWindowLongPtr(_hSelf, GWL_STYLE, style);
839      if (!result)
840          ::MessageBox(NULL, TEXT(&quot;SetWindowLongPtr failed in UserDefineDialog::changeStyle()&quot;), TEXT(&quot;&quot;), MB_OK);
841      if (_status == DOCK)
842          getActualPosSize();
843      else
844          restorePosSize();
845      ::SetParent(_hSelf, (_status == DOCK)?_hParent:NULL);
846  }
847  void UserDefineDialog::enableLangAndControlsBy(size_t index)
848  {
849      _pUserLang = (index == 0)?_pCurrentUserLang:&amp;((NppParameters::getInstance()).getULCFromIndex(index - 1));
850      if (index != 0)
851          ::SetWindowText(::GetDlgItem(_hSelf, IDC_EXT_EDIT), _pUserLang-&gt;_ext.c_str());
852      ::ShowWindow(::GetDlgItem(_hSelf, IDC_EXT_STATIC), (index == 0)?SW_HIDE:SW_SHOW);
853      ::ShowWindow(::GetDlgItem(_hSelf, IDC_EXT_EDIT), (index == 0)?SW_HIDE:SW_SHOW);
854      ::ShowWindow(::GetDlgItem(_hSelf, IDC_RENAME_BUTTON), (index == 0)?SW_HIDE:SW_SHOW);
855      ::ShowWindow(::GetDlgItem(_hSelf, IDC_REMOVELANG_BUTTON), (index == 0)?SW_HIDE:SW_SHOW);
856  }
857  void UserDefineDialog::updateDlg()
858  {
859  	int i = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0));
860  	if (i &gt; 0) 
861  	{
862  		NppParameters&amp; nppParam = NppParameters::getInstance();
863  		nppParam.setUdlXmlDirtyFromIndex(i - 1);
864  	}
865      ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_IGNORECASE_CHECK, BM_SETCHECK, _pUserLang-&gt;_isCaseIgnored, 0);
866      _folderStyleDlg.updateDlg();
867      _keyWordsStyleDlg.updateDlg();
868      _commentStyleDlg.updateDlg();
869      _symbolsStyleDlg.updateDlg();
870  }
871  intptr_t CALLBACK UserDefineDialog::run_dlgProc(UINT message, WPARAM wParam, LPARAM lParam)
872  {
873      NppParameters&amp; nppParam = NppParameters::getInstance();
874  	NativeLangSpeaker * pNativeSpeaker = nppParam.getNativeLangSpeaker();
875      switch (message)
876      {
877          case WM_INITDIALOG :
878          {
879              _pUserLang = _pCurrentUserLang;
880              _ctrlTab.init(_hInst, _hSelf, false);
881              NppDarkMode::subclassTabControl(_ctrlTab.getHSelf());
882              int tabDpiDynamicalHeight = nppParam._dpiManager.scaleY(13);
883              _ctrlTab.setFont(TEXT(&quot;Tahoma&quot;), tabDpiDynamicalHeight);
884              _folderStyleDlg.init(_hInst, _hSelf);
885              _folderStyleDlg.create(IDD_FOLDER_STYLE_DLG);
886              _folderStyleDlg.display();
887              _keyWordsStyleDlg.init(_hInst, _hSelf);
888              _keyWordsStyleDlg.create(IDD_KEYWORD_STYLE_DLG);
889              _keyWordsStyleDlg.display(false);
890              _commentStyleDlg.init(_hInst, _hSelf);
891              _commentStyleDlg.create(IDD_COMMENT_STYLE_DLG);
892              _commentStyleDlg.display(false);
893              _symbolsStyleDlg.init(_hInst, _hSelf);
894              _symbolsStyleDlg.create(IDD_SYMBOL_STYLE_DLG);
895              _symbolsStyleDlg.display(false);
896              _wVector.push_back(DlgInfo(&amp;_folderStyleDlg,    TEXT(&quot;Folder &amp;&amp; Default&quot;)));
897              _wVector.push_back(DlgInfo(&amp;_keyWordsStyleDlg,  TEXT(&quot;Keywords Lists&quot;)));
898              _wVector.push_back(DlgInfo(&amp;_commentStyleDlg,   TEXT(&quot;Comment &amp;&amp; Number&quot;)));
899              _wVector.push_back(DlgInfo(&amp;_symbolsStyleDlg,   TEXT(&quot;Operators &amp;&amp; Delimiters&quot;)));
900              _ctrlTab.createTabs(_wVector);
901              _ctrlTab.display();
902              RECT arc{};
903              ::GetWindowRect(::GetDlgItem(_hSelf, IDC_IMPORT_BUTTON), &amp;arc);
904              POINT p{};
905              p.x = arc.left;
906              p.y = arc.bottom;
907              ::ScreenToClient(_hSelf, &amp;p);
908              RECT rc{};
909              getClientRect(rc);
910              rc.top = p.y + 10;
911              rc.bottom -= 20;
912              _ctrlTab.reSizeTo(rc);
913              _folderStyleDlg.reSizeTo(rc);
914              _keyWordsStyleDlg.reSizeTo(rc);
915              _commentStyleDlg.reSizeTo(rc);
916              _symbolsStyleDlg.reSizeTo(rc);
917              reloadLangCombo();
918              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, 0, 0);
919              enableLangAndControlsBy(0);
920              if (nppParam.isTransparentAvailable())
921              {
922                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_TRANSPARENT_CHECK), SW_SHOW);
923                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), SW_SHOW);
924                  ::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_SETRANGE, FALSE, MAKELONG(20, 200));
925                  ::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_SETPOS, TRUE, 150);
926                  if (!(BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, BM_GETCHECK, 0, 0)))
927                      ::EnableWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), FALSE);
928              }
929              SCROLLINFO si{};
930              si.cbSize = sizeof(si);
931              si.fMask  = SIF_RANGE; 
932              si.nMin   = 0;
933              si.nMax   = 0;
934              ::SetScrollInfo(_hSelf, SB_VERT, &amp;si, TRUE);
935              TCHAR temp[32] = { &#x27;\0&#x27; };
936              generic_string udlVersion = TEXT(&quot;User Defined Language v.&quot;);
937              udlVersion += _itow(SCE_UDL_VERSION_MAJOR, temp, 10);
938              udlVersion += TEXT(&quot;.&quot;);
939              udlVersion += _itow(SCE_UDL_VERSION_MINOR, temp, 10);
940              udlVersion += TEXT(&quot;.&quot;);
941              udlVersion += _itow(SCE_UDL_VERSION_BUILD, temp, 10);
942              udlVersion += TEXT(&quot;.&quot;);
943              udlVersion += _itow(SCE_UDL_VERSION_REVISION, temp, 10);
944              ::SetWindowText(_hSelf, udlVersion.c_str());
945              NppDarkMode::autoSubclassAndThemeChildControls(_hSelf);
946              NppDarkMode::setDarkScrollBar(_hSelf);
947              return TRUE;
948          }
949          case WM_CTLCOLOREDIT:
950          {
951              return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
952          }
953          case WM_CTLCOLORLISTBOX:
954          {
955              return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
956          }
957          case WM_CTLCOLORDLG:
958          case WM_CTLCOLORSTATIC:
959          {
960              return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
961          }
962          case WM_PRINTCLIENT:
963          {
964              if (NppDarkMode::isEnabled())
965              {
966                  return TRUE;
967              }
968              break;
969          }
970          case NPPM_INTERNAL_REFRESHDARKMODE:
971          {
972              NppDarkMode::autoThemeChildControls(_hSelf);
973              NppDarkMode::setDarkScrollBar(_hSelf);
974              return TRUE;
975          }
976          case WM_NOTIFY:
977          {
978              NMHDR *nmhdr = (NMHDR *)lParam;
979              if (nmhdr-&gt;code == TCN_SELCHANGE)
980              {
981                  if (nmhdr-&gt;hwndFrom == _ctrlTab.getHSelf())
982                  {
983                      _ctrlTab.clickedUpdate();
984                      return TRUE;
985                  }
986              }
987              break;
988          }
989          case WM_HSCROLL:
990          {
991              if (reinterpret_cast&lt;HWND&gt;(lParam) == ::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER))
992              {
993  				int percent = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_GETPOS, 0, 0));
994                  nppParam.SetTransparent(_hSelf, percent);
995              }
996              return TRUE;
997          }
998          case WM_COMMAND :
999          {
1000              if (HIWORD(wParam) == EN_CHANGE)
1001              {
1002                  TCHAR ext[extsLenMax] = { &#x27;\0&#x27; };
1003  				::SendDlgItemMessage(_hSelf, IDC_EXT_EDIT, WM_GETTEXT, extsLenMax, reinterpret_cast&lt;LPARAM&gt;(ext));
1004                  _pUserLang-&gt;_ext = ext;
1005                  return TRUE;
1006              }
1007              else if (HIWORD(wParam) == CBN_SELCHANGE)
1008              {
1009                  if (LOWORD(wParam) == IDC_LANGNAME_COMBO)
1010                  {
1011  					auto i = ::SendDlgItemMessage(_hSelf, LOWORD(wParam), CB_GETCURSEL, 0, 0);
1012                      enableLangAndControlsBy(i);
1013                      updateDlg();
1014                  }
1015                  return TRUE;
1016              }
1017              else
1018              {
1019                  switch (wParam)
1020                  {
1021                      case IDC_DOCK_BUTTON :
1022                      {
1023                          int msg = WM_UNDOCK_USERDEFINE_DLG;
1024                          if (_status == UNDOCK)
1025                          {
1026                              if (nppParam.isTransparentAvailable())
1027                              {
1028                                  nppParam.removeTransparent(_hSelf);
1029                                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_TRANSPARENT_CHECK), SW_HIDE);
1030                                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), SW_HIDE);
1031                              }
1032                              msg = WM_DOCK_USERDEFINE_DLG;
1033                          }
1034                          changeStyle();
1035                          if (_status == UNDOCK)
1036                          {
1037                              if (nppParam.isTransparentAvailable())
1038                              {
1039                                  bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_UD_TRANSPARENT_CHECK, BM_GETCHECK, 0, 0));
1040                                  if (isChecked)
1041                                  {
1042  									int percent = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_GETPOS, 0, 0));
1043                                      nppParam.SetTransparent(_hSelf, percent);
1044                                  }
1045                                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_TRANSPARENT_CHECK), SW_SHOW);
1046                                  ::ShowWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), SW_SHOW);
1047                              }
1048                          }
1049                          ::SendMessage(_hParent, msg, 0, 0);
1050                          return TRUE;
1051                      }
1052                      case IDCANCEL:
1053  					{
1054  						::SendMessage(_hParent, WM_CLOSE_USERDEFINE_DLG, 0, 0);
1055  						display(false);
1056  						return TRUE;
1057  					}
1058                      case IDC_REMOVELANG_BUTTON :
1059                      {
1060                          int result = nppParam.getNativeLangSpeaker()-&gt;messageBox(&quot;UDLRemoveCurrentLang&quot;,
1061  							_hSelf,
1062  							TEXT(&quot;Are you sure?&quot;),
1063  							TEXT(&quot;Remove the current language&quot;),
1064  							MB_YESNO);
1065                          if (result == IDYES)
1066                          {
1067                              auto i = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1068  							const size_t langNameLen = 256;
1069  							TCHAR langName[langNameLen + 1] = { &#x27;\0&#x27; };
1070  							auto cbTextLen = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETLBTEXTLEN, i, 0);
1071  							if (static_cast&lt;size_t&gt;(cbTextLen) &gt; langNameLen)
1072  								return TRUE;
1073  							::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETLBTEXT, i, reinterpret_cast&lt;LPARAM&gt;(langName));
1074                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_DELETESTRING, i, 0);
1075                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, i-1, 0);
1076  							::SendMessage(_hSelf, WM_COMMAND, MAKELONG(IDC_LANGNAME_COMBO, CBN_SELCHANGE), reinterpret_cast&lt;LPARAM&gt;(::GetDlgItem(_hSelf, IDC_LANGNAME_COMBO)));
1077                              nppParam.removeUserLang(i-1);
1078                              HWND hNpp = ::GetParent(_hSelf);
1079  							HMENU m = reinterpret_cast&lt;HMENU&gt;(::SendMessage(hNpp, NPPM_INTERNAL_GETMENU, 0, 0));
1080  							HMENU subMenu = ::GetSubMenu(m, MENUINDEX_LANGUAGE);
1081  							::RemoveMenu(subMenu, static_cast&lt;UINT&gt;(IDM_LANG_USER + i), MF_BYCOMMAND);
1082                              ::DrawMenuBar(hNpp);
1083  							::SendMessage(_hParent, WM_REMOVE_USERLANG, 0, reinterpret_cast&lt;LPARAM&gt;(langName));
1084                          }
1085                          return TRUE;
1086                      }
1087                      case IDC_RENAME_BUTTON :
1088                      {
1089                          auto i = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1090  						const size_t langNameLen = 256;
1091  						TCHAR langName[langNameLen + 1] = { &#x27;\0&#x27; };
1092  						auto cbTextLen = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETLBTEXTLEN, i, 0);
1093  						if (static_cast&lt;size_t&gt;(cbTextLen) &gt; langNameLen)
1094  							return TRUE;
1095  						::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETLBTEXT, i, reinterpret_cast&lt;LPARAM&gt;(langName));
1096  						generic_string strName = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;common-name&quot;, TEXT(&quot;Name&quot;));
1097  						generic_string strTitle = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;userdefined-title-rename&quot;, TEXT(&quot;Rename Current Language Name&quot;));
1098                          StringDlg strDlg;
1099                          strDlg.init(_hInst, _hSelf, strTitle.c_str(), strName.c_str(), langName, langNameLenMax - 1);
1100                          TCHAR *newName = (TCHAR *)strDlg.doDialog();
1101                          if (newName)
1102                          {
1103                              if (nppParam.isExistingUserLangName(newName))
1104                              {
1105  								nppParam.getNativeLangSpeaker()-&gt;messageBox(&quot;UDLNewNameError&quot;,
1106  									_hSelf,
1107  									TEXT(&quot;This name is used by another language,\rplease give another one.&quot;),
1108  									TEXT(&quot;UDL Error&quot;),
1109  									MB_OK);
1110                                  ::PostMessage(_hSelf, WM_COMMAND, IDC_RENAME_BUTTON, 0);
1111                                  return TRUE;
1112                              }
1113                              if (nppParam.getNbUserLang() &gt;= NB_MAX_USER_LANG)
1114                                  return TRUE;
1115                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_DELETESTRING, i, 0);
1116  							::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_INSERTSTRING, i, reinterpret_cast&lt;LPARAM&gt;(newName));
1117                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, i, 0);
1118                              UserLangContainer &amp; userLangContainer = nppParam.getULCFromIndex(i-1);
1119                              userLangContainer._name = newName;
1120                              HWND hNpp = ::GetParent(_hSelf);
1121  							HMENU hM = reinterpret_cast&lt;HMENU&gt;(::SendMessage(hNpp, NPPM_INTERNAL_GETMENU, 0, 0));
1122  							HMENU hSubM = ::GetSubMenu(hM, MENUINDEX_LANGUAGE);
1123                              ::ModifyMenu(hSubM, static_cast&lt;UINT&gt;(IDM_LANG_USER + i), MF_BYCOMMAND, IDM_LANG_USER + i, newName);
1124                              ::DrawMenuBar(hNpp);
1125  							::SendMessage(_hParent, WM_RENAME_USERLANG, reinterpret_cast&lt;WPARAM&gt;(newName), reinterpret_cast&lt;LPARAM&gt;(langName));
1126                          }
1127                          return TRUE;
1128                      }
1129                      case IDC_ADDNEW_BUTTON :
1130                      case IDC_SAVEAS_BUTTON :
1131                      {
1132                          auto i = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1133                          if (i == 0)
1134                              wParam = IDC_ADDNEW_BUTTON;
1135  						generic_string strName = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;common-name&quot;, TEXT(&quot;Name&quot;));
1136  						generic_string strTitle = (wParam == IDC_SAVEAS_BUTTON) ?
1137  							pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;userdefined-title-save&quot;, TEXT(&quot;Save Current Language Name As...&quot;)) :
1138  							pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;userdefined-title-new&quot;, TEXT(&quot;Create New Language...&quot;));
1139                          StringDlg strDlg;
1140  						strDlg.init(_hInst, _hSelf, strTitle.c_str(), strName.c_str(), TEXT(&quot;&quot;), langNameLenMax - 1);
1141                          TCHAR *tmpName = reinterpret_cast&lt;TCHAR *&gt;(strDlg.doDialog());
1142                          if (tmpName &amp;&amp; tmpName[0])
1143                          {
1144                              generic_string newNameString(tmpName);
1145                              const TCHAR *newName = newNameString.c_str();
1146                              if (nppParam.isExistingUserLangName(newName))
1147                              {
1148  								pNativeSpeaker-&gt;messageBox(&quot;UDLNewNameError&quot;,
1149  									_hSelf,
1150  									TEXT(&quot;This name is used by another language,\rplease give another one.&quot;),
1151  									TEXT(&quot;UDL Error&quot;),
1152  									MB_OK);
1153                                  ::PostMessage(_hSelf, WM_COMMAND, IDC_RENAME_BUTTON, 0);
1154                                  return TRUE;
1155                              }
1156                              if (nppParam.getNbUserLang() &gt;= NB_MAX_USER_LANG)
1157                                  return TRUE;
1158                              UserLangContainer &amp; userLang = (wParam == IDC_SAVEAS_BUTTON)?nppParam.getULCFromIndex(i-1):*_pCurrentUserLang;
1159                              int newIndex = nppParam.addUserLangToEnd(userLang, newName);
1160                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_ADDSTRING, 0, LPARAM(newName));
1161                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, newIndex + 1, 0);
1162  							::SendMessage(_hSelf, WM_COMMAND, MAKELONG(IDC_LANGNAME_COMBO, CBN_SELCHANGE), reinterpret_cast&lt;LPARAM&gt;(::GetDlgItem(_hSelf, IDC_LANGNAME_COMBO)));
1163                              HWND hNpp = ::GetParent(_hSelf);
1164  							HMENU m = reinterpret_cast&lt;HMENU&gt;(::SendMessage(hNpp, NPPM_INTERNAL_GETMENU, 0, 0));
1165                              ::InsertMenu(::GetSubMenu(m, MENUINDEX_LANGUAGE), IDM_LANG_USER + newIndex, MF_BYCOMMAND, IDM_LANG_USER + newIndex + 1, newName);
1166                              ::DrawMenuBar(hNpp);
1167                          }
1168                          return TRUE;
1169                      }
1170                      case IDC_IMPORT_BUTTON :
1171                      {
1172                          CustomFileDialog fDlg(_hSelf);
1173                          fDlg.setExtFilter(TEXT(&quot;UDL&quot;), TEXT(&quot;.xml&quot;));
1174                          generic_string sourceFile = fDlg.doOpenSingleFileDlg();
1175                          if (sourceFile.empty()) break;
1176                          bool isSuccessful = nppParam.importUDLFromFile(sourceFile);
1177                          if (isSuccessful)
1178                          {
1179                              auto i = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1180                              reloadLangCombo();
1181                              ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_SETCURSEL, i, 0);
1182                              printStr(TEXT(&quot;Import successful.&quot;));
1183                          }
1184                          else
1185                          {
1186                              printStr(TEXT(&quot;Fail to import.&quot;));
1187                          }
1188                          break;
1189                      }
1190                      case IDC_EXPORT_BUTTON :
1191                      {
1192  						auto i2Export = ::SendDlgItemMessage(_hSelf, IDC_LANGNAME_COMBO, CB_GETCURSEL, 0, 0);
1193                          if (i2Export == 0)
1194                          {
1195                              printStr(TEXT(&quot;Before exporting, save your language definition by clicking \&quot;Save As...\&quot; button&quot;));
1196                              break;
1197                          }
1198                          CustomFileDialog fDlg(_hSelf);
1199                          fDlg.setExtFilter(TEXT(&quot;UDL&quot;), TEXT(&quot;.xml&quot;));
1200  						fDlg.setExtIndex(0);		
1201  						generic_string fileName2save = fDlg.doSaveDlg();
1202                          if (fileName2save.empty()) break;
1203                          if (i2Export &gt; 0)
1204                          {
1205                              bool isSuccessful = nppParam.exportUDLToFile(i2Export - 1, fileName2save);
1206                              if (isSuccessful)
1207                              {
1208                                  printStr(TEXT(&quot;Export successful&quot;));
1209                              }
1210                              else
1211                              {
1212                                  printStr(TEXT(&quot;Fail to export.&quot;));
1213                              }
1214                          }
1215                          break;
1216                      }
1217                      case IDC_UD_TRANSPARENT_CHECK :
1218                      {
1219                          bool isChecked = (BST_CHECKED == ::SendDlgItemMessage(_hSelf, IDC_UD_TRANSPARENT_CHECK, BM_GETCHECK, 0, 0));
1220                          if (isChecked)
1221                          {
1222  							int percent = static_cast&lt;int32_t&gt;(::SendDlgItemMessage(_hSelf, IDC_UD_PERCENTAGE_SLIDER, TBM_GETPOS, 0, 0));
1223                              nppParam.SetTransparent(_hSelf, percent);
1224                          }
1225                          else
1226                              nppParam.removeTransparent(_hSelf);
1227                          ::EnableWindow(::GetDlgItem(_hSelf, IDC_UD_PERCENTAGE_SLIDER), isChecked);
1228                          return TRUE;
1229                      }
1230                      case IDC_LANGNAME_IGNORECASE_CHECK :
1231                          return setPropertyByCheck(_hSelf, wParam, _pUserLang-&gt;_isCaseIgnored);
1232                      default :
1233                          break;
1234                  }
1235              }
1236              return FALSE;
1237          }
1238          case WM_DESTROY:
1239          {
1240              _folderStyleDlg.destroy();
1241              _keyWordsStyleDlg.destroy();
1242              _commentStyleDlg.destroy();
1243              _symbolsStyleDlg.destroy();
1244              _ctrlTab.destroy();
1245              return TRUE;
1246          }
1247          case WM_SIZE:
1248          {
1249              int originalHight = _dlgPos.bottom; 
1250              _currentHight = HIWORD (lParam);
1251              int diff = _currentHight - _prevHightVal;
1252              _prevHightVal = _currentHight;
1253               int maxPos = originalHight - _currentHight;
1254              SCROLLINFO si{};
1255              si.cbSize = sizeof(si);
1256              si.fMask  = SIF_RANGE | SIF_PAGE;
1257              si.nMin   = 0;
1258              si.nMax   = (_status == UNDOCK)?0:originalHight;
1259              si.nPage  = _currentHight;
1260              ::SetScrollInfo(_hSelf, SB_VERT, &amp;si, TRUE);
1261              if ((_yScrollPos &gt;= maxPos) &amp;&amp; (_currentHight &lt; originalHight))
1262              {
1263                  if (_yScrollPos &gt; 0)
1264                  {
1265                      _yScrollPos -= diff;
1266                      ::SetScrollPos(_hSelf, SB_VERT, _yScrollPos, TRUE);
1267                      ::ScrollWindow(_hSelf, 0, diff, NULL, NULL);
1268                  }
1269              }
1270              return TRUE;
1271          }
1272          case WM_VSCROLL :
1273          {
1274              int originalHight = _dlgPos.bottom;
1275              int oldy = _yScrollPos;
1276              int maxPos = originalHight - _currentHight;
1277              switch (LOWORD (wParam))
1278              {
1279                  case SB_LINEUP:
1280                      if (_yScrollPos &lt;= 0)
1281                          return FALSE;
1282                      _yScrollPos = 0;
1283                      break;
1284                  case SB_LINEDOWN:
1285                      if (_yScrollPos &gt;= maxPos)
1286                          return FALSE;
1287                      _yScrollPos = maxPos;
1288                      break;
1289                  case SB_PAGEDOWN:
1290                      if (_yScrollPos &gt;= maxPos)
1291                          return FALSE;
1292                      _yScrollPos = maxPos;
1293                      break;
1294                  case SB_PAGEUP:
1295                      if (_yScrollPos &lt;= 0)
1296                          return FALSE;
1297                      _yScrollPos = 0;
1298                      break;
1299                  case SB_THUMBTRACK:
1300                  case SB_THUMBPOSITION:
1301                      _yScrollPos = HIWORD(wParam);
1302                      break;
1303                  default :
1304                      return FALSE;
1305              }
1306              ::SetScrollPos(_hSelf, SB_VERT, _yScrollPos, TRUE);
1307              ::ScrollWindow(_hSelf, 0, oldy-_yScrollPos, NULL, NULL);
1308              break;
1309          }
1310          case NPPM_MODELESSDIALOG :
1311              return ::SendMessage(_hParent, NPPM_MODELESSDIALOG, wParam, lParam);
1312      }
1313      return FALSE;
1314  }
1315  intptr_t CALLBACK StringDlg::run_dlgProc(UINT Message, WPARAM wParam, LPARAM)
1316  {
1317      switch (Message)
1318      {
1319          case WM_INITDIALOG :
1320          {
1321  			NppDarkMode::autoSubclassAndThemeChildControls(_hSelf);
1322  			if (_restrictedChars.length())
1323  			{
1324  				::SetWindowLongPtr(GetDlgItem(_hSelf, IDC_STRING_EDIT), GWLP_USERDATA, reinterpret_cast&lt;LONG_PTR&gt;(this));
1325  				_oldEditProc = reinterpret_cast&lt;WNDPROC&gt;(SetWindowLongPtr(GetDlgItem(_hSelf, IDC_STRING_EDIT), GWLP_WNDPROC, reinterpret_cast&lt;LONG_PTR&gt;(customEditProc)));
1326  			}
1327              ::SetWindowText(_hSelf, _title.c_str());
1328              ::SetDlgItemText(_hSelf, IDC_STRING_STATIC, _static.c_str());
1329              ::SetDlgItemText(_hSelf, IDC_STRING_EDIT, _textValue.c_str());
1330              if (_txtLen)
1331                  ::SendDlgItemMessage(_hSelf, IDC_STRING_EDIT, EM_SETLIMITTEXT, _txtLen, 0);
1332  			NativeLangSpeaker *pNativeSpeaker = (NppParameters::getInstance()).getNativeLangSpeaker();
1333  			if (pNativeSpeaker)
1334  			{
1335  				generic_string ok = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;common-ok&quot;, TEXT(&quot;OK&quot;));
1336  				generic_string cancel = pNativeSpeaker-&gt;getLocalizedStrFromID(&quot;common-cancel&quot;, TEXT(&quot;Cancel&quot;));
1337  				::SetDlgItemText(_hSelf, IDOK, ok.c_str());
1338  				::SetDlgItemText(_hSelf, IDCANCEL, cancel.c_str());
1339  			}
1340  			if (_shouldGotoCenter)
1341  				goToCenter(SWP_SHOWWINDOW | SWP_NOSIZE);
1342  			return TRUE;
1343  		}
1344  		case WM_CTLCOLOREDIT:
1345  		{
1346  			return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
1347  		}
1348  		case WM_CTLCOLORDLG:
1349  		case WM_CTLCOLORSTATIC:
1350  		{
1351  			return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1352  		}
1353  		case WM_PRINTCLIENT:
1354  		{
1355  			if (NppDarkMode::isEnabled())
1356  			{
1357  				return TRUE;
1358  			}
1359  			break;
1360  		}
1361  		case WM_ERASEBKGND:
1362  		{
1363  			if (NppDarkMode::isEnabled())
1364  			{
1365  				RECT rc{};
1366  				getClientRect(rc);
1367  				::FillRect(reinterpret_cast&lt;HDC&gt;(wParam), &amp;rc, NppDarkMode::getDarkerBackgroundBrush());
1368  				return TRUE;
1369  			}
1370  			break;
1371  		}
1372  		case NPPM_INTERNAL_REFRESHDARKMODE:
1373  		{
1374  			NppDarkMode::autoThemeChildControls(_hSelf);
1375  			return TRUE;
1376  		}
1377          case WM_COMMAND :
1378          {
1379              switch (wParam)
1380              {
1381                  case IDOK :
1382                  {
1383                      TCHAR tmpName[langNameLenMax] = { &#x27;\0&#x27; };
1384                      ::GetDlgItemText(_hSelf, IDC_STRING_EDIT, tmpName, langNameLenMax);
1385                      _textValue = tmpName;
1386                      ::EndDialog(_hSelf, reinterpret_cast&lt;intptr_t&gt;(_textValue.c_str()));
1387                      return TRUE;
1388                  }
1389                  case IDCANCEL :
1390                      ::EndDialog(_hSelf, 0);
1391                      return TRUE;
1392                  default:
1393                      return FALSE;
1394              }
1395          }
1396          default :
1397              return FALSE;
1398      }
1399  	return FALSE;
1400  }
1401  LRESULT StringDlg::customEditProc(HWND hEdit, UINT msg, WPARAM wParam, LPARAM lParam)
1402  {
1403  	StringDlg *pSelf = reinterpret_cast&lt;StringDlg *&gt;(::GetWindowLongPtr(hEdit, GWLP_USERDATA));
1404  	if (!pSelf)
1405  	{
1406  		return 0;
1407  	}
1408  	switch (msg)
1409  	{
1410  	case WM_CHAR:
1411  		if (0x80 &amp; GetKeyState(VK_CONTROL))
1412  		{
1413  			switch (wParam)
1414  			{
1415  			case 0x16: 
1416  				pSelf-&gt;HandlePaste(hEdit);
1417  				return 0;
1418  			case 0x03: 
1419  			case 0x18: 
1420  			default:
1421  				break;
1422  			}
1423  		}
1424  		else
1425  		{
1426  			if (!pSelf-&gt;isAllowed(reinterpret_cast&lt;TCHAR*&gt;(&amp;wParam)))
1427  				return 0;
1428  		}
1429  		break;
1430  	case WM_DESTROY:
1431  		SetWindowLongPtr(hEdit, GWLP_WNDPROC, reinterpret_cast&lt;LONG_PTR&gt;(pSelf-&gt;_oldEditProc));
1432  		return 0;
1433  	}
1434  	return CallWindowProc(pSelf-&gt;_oldEditProc, hEdit, msg, wParam, lParam);
1435  }
1436  bool StringDlg::isAllowed([[maybe_unused]] const generic_string &amp; txt)
1437  {
1438  #ifndef __MINGW32__
1439  	for (auto ch : txt)
1440  	{
1441  		if (std::find(_restrictedChars.cbegin(), _restrictedChars.cend(), ch) != _restrictedChars.cend())
1442  			return false;
1443  	}
1444  #endif
1445  	return true;
1446  }
1447  void StringDlg::HandlePaste(HWND hEdit)
1448  {
1449  	if (OpenClipboard(hEdit))
1450  	{
1451  		HANDLE hClipboardData = GetClipboardData(CF_UNICODETEXT);
1452  		if (NULL != hClipboardData)
1453  		{
1454  			LPTSTR pszText = static_cast&lt;LPTSTR&gt;(GlobalLock(hClipboardData));
1455  			if (NULL != pszText &amp;&amp; isAllowed(pszText))
1456  			{
1457  				SendMessage(hEdit, EM_REPLACESEL, TRUE, reinterpret_cast&lt;LPARAM&gt;(pszText));
1458  			}
1459  			GlobalUnlock(hClipboardData);
1460  		}
1461  		CloseClipboard();
1462  	}
1463  }
1464  void StylerDlg::move2CtrlRight(HWND hwndDlg, int ctrlID, HWND handle2Move, int handle2MoveWidth, int handle2MoveHeight)
1465  {
1466      POINT p{};
1467      RECT rc{};
1468      ::GetWindowRect(::GetDlgItem(hwndDlg, ctrlID), &amp;rc);
1469      p.x = rc.right + NppParameters::getInstance()._dpiManager.scaleX(5);
1470      p.y = rc.top + ((rc.bottom - rc.top) / 2) - handle2MoveHeight / 2;
1471      ::ScreenToClient(hwndDlg, &amp;p);
1472      ::MoveWindow(handle2Move, p.x, p.y, handle2MoveWidth, handle2MoveHeight, TRUE);
1473  }
1474  intptr_t CALLBACK StylerDlg::dlgProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)
1475  {
1476      StylerDlg * dlg = (StylerDlg *)::GetProp(hwnd, TEXT(&quot;Styler dialog prop&quot;));
1477      NppParameters&amp; nppParam = NppParameters::getInstance();
1478      switch (message)
1479      {
1480          case WM_INITDIALOG :
1481          {
1482              NppDarkMode::setDarkTitleBar(hwnd);
1483              NppDarkMode::autoSubclassAndThemeChildControls(hwnd);
1484              NativeLangSpeaker *pNativeLangSpeaker = nppParam.getNativeLangSpeaker();
1485              pNativeLangSpeaker-&gt;changeUserDefineLangPopupDlg(hwnd);
1486              ::SetProp(hwnd, TEXT(&quot;Styler dialog prop&quot;), (HANDLE)lParam);
1487              dlg = (StylerDlg *)::GetProp(hwnd, TEXT(&quot;Styler dialog prop&quot;));
1488              Style &amp; style = SharedParametersDialog::_pUserLang-&gt;_styles.getStyler(dlg-&gt;_stylerIndex);
1489              RECT wrc{};
1490              ::GetWindowRect(dlg-&gt;_parent, &amp;wrc);
1491              wrc.left = wrc.left &lt; 0 ? 200 : wrc.left;   
1492              wrc.top = wrc.top &lt; 0 ? 200 : wrc.top;
1493              ::SetWindowPos(hwnd, HWND_TOP, wrc.left, wrc.top, 0, 0, SWP_NOSIZE | SWP_NOZORDER);
1494              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_UNDERLINE, BM_SETCHECK, style._fontStyle &amp; FONTSTYLE_UNDERLINE, 0);
1495              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_ITALIC,    BM_SETCHECK, style._fontStyle &amp; FONTSTYLE_ITALIC, 0);
1496              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_BOLD,      BM_SETCHECK, style._fontStyle &amp; FONTSTYLE_BOLD, 0);
1497              HWND hFontSizeCombo = ::GetDlgItem(hwnd, IDC_STYLER_COMBO_FONT_SIZE);
1498              for (size_t j = 0 ; j &lt; int(sizeof(fontSizeStrs))/(3*sizeof(TCHAR)) ; ++j)
1499  				::SendMessage(hFontSizeCombo, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(fontSizeStrs[j]));
1500              TCHAR size[10] = { &#x27;\0&#x27; };
1501              if (style._fontSize == -1)
1502                  size[0] = &#x27;\0&#x27;;
1503              else
1504                  wsprintf(size, TEXT(&quot;%d&quot;),style._fontSize);
1505  			auto i = ::SendMessage(hFontSizeCombo, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(size));
1506              if (i != CB_ERR)
1507                  ::SendMessage(hFontSizeCombo, CB_SETCURSEL, i, 0);
1508              HWND hFontNameCombo = ::GetDlgItem(hwnd, IDC_STYLER_COMBO_FONT_NAME);
1509              const std::vector&lt;generic_string&gt; &amp; fontlist = nppParam.getFontList();
1510              for (size_t j = 0, len = fontlist.size() ; j &lt; len ; ++j)
1511              {
1512  				auto k = ::SendMessage(hFontNameCombo, CB_ADDSTRING, 0, reinterpret_cast&lt;LPARAM&gt;(fontlist[j].c_str()));
1513  				::SendMessage(hFontNameCombo, CB_SETITEMDATA, k, reinterpret_cast&lt;LPARAM&gt;(fontlist[j].c_str()));
1514              }
1515  			i = ::SendMessage(hFontNameCombo, CB_FINDSTRINGEXACT, static_cast&lt;WPARAM&gt;(-1), reinterpret_cast&lt;LPARAM&gt;(style._fontName.c_str()));
1516              if (i == CB_ERR)
1517                  i = 0;
1518              ::SendMessage(hFontNameCombo, CB_SETCURSEL, i, 0);
1519              if (style._fgColor == COLORREF(-1))
1520                  style._fgColor = black;
1521              if (style._bgColor == COLORREF(-1))
1522                  style._bgColor = white;
1523              dlg-&gt;_pFgColour-&gt;init(dlg-&gt;_hInst, hwnd);
1524              dlg-&gt;_pFgColour-&gt;setColour(style._fgColor);
1525              bool isFgEnabled = (style._colorStyle &amp; COLORSTYLE_FOREGROUND) != 0;
1526              dlg-&gt;_pFgColour-&gt;setEnabled(isFgEnabled);
1527              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_FG_TRANSPARENT, BM_SETCHECK, !isFgEnabled, 0);
1528              dlg-&gt;_pBgColour-&gt;init(dlg-&gt;_hInst, hwnd);
1529              dlg-&gt;_pBgColour-&gt;setColour(style._bgColor);
1530              bool isBgEnabled = (style._colorStyle &amp; COLORSTYLE_BACKGROUND) != 0;
1531              dlg-&gt;_pBgColour-&gt;setEnabled(isBgEnabled);
1532              ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_BG_TRANSPARENT, BM_SETCHECK, !isBgEnabled, 0);
1533              int w = nppParam._dpiManager.scaleX(25);
1534              int h = nppParam._dpiManager.scaleY(25);
1535              dlg-&gt;move2CtrlRight(hwnd, IDC_STYLER_FG_STATIC, dlg-&gt;_pFgColour-&gt;getHSelf(), w, h);
1536              dlg-&gt;move2CtrlRight(hwnd, IDC_STYLER_BG_STATIC, dlg-&gt;_pBgColour-&gt;getHSelf(), w, h);
1537              dlg-&gt;_pFgColour-&gt;display();
1538              dlg-&gt;_pBgColour-&gt;display();
1539              unordered_map&lt;int, int&gt;::iterator iter = globalMappper().nestingMapper.begin();
1540              for (; iter != globalMappper().nestingMapper.end(); ++iter)
1541              {
1542                  ::SendDlgItemMessage(hwnd, iter-&gt;first, BM_SETCHECK, style._nesting &amp; iter-&gt;second, 0);
1543                  ::EnableWindow(::GetDlgItem(hwnd, iter-&gt;first), dlg-&gt;_enabledNesters &amp; iter-&gt;second);
1544              }
1545              return TRUE;
1546          }
1547          case WM_CTLCOLOREDIT:
1548          {
1549              return NppDarkMode::onCtlColorSofter(reinterpret_cast&lt;HDC&gt;(wParam));
1550          }
1551          case WM_CTLCOLORLISTBOX:
1552          {
1553              return NppDarkMode::onCtlColor(reinterpret_cast&lt;HDC&gt;(wParam));
1554          }
1555          case WM_CTLCOLORDLG:
1556          case WM_CTLCOLORSTATIC:
1557          {
1558              return NppDarkMode::onCtlColorDarker(reinterpret_cast&lt;HDC&gt;(wParam));
1559          }
1560          case WM_PRINTCLIENT:
1561          {
1562              if (NppDarkMode::isEnabled())
1563              {
1564                  return TRUE;
1565              }
1566              break;
1567          }
1568          case NPPM_INTERNAL_REFRESHDARKMODE:
1569          {
1570              NppDarkMode::setDarkTitleBar(hwnd);
1571              NppDarkMode::autoThemeChildControls(hwnd);
1572              ::SetWindowPos(hwnd, nullptr, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOZORDER | SWP_FRAMECHANGED);
1573              return TRUE;
1574          }
1575          case WM_COMMAND :
1576          {
1577  			if (dlg == nullptr)
1578  				return FALSE;
1579              Style &amp; style = SharedParametersDialog::_pUserLang-&gt;_styles.getStyler(dlg-&gt;_stylerIndex);
1580              if (HIWORD(wParam) == CBN_SELCHANGE)
1581              {
1582                  auto i = ::SendDlgItemMessage(hwnd, LOWORD(wParam), CB_GETCURSEL, 0, 0);
1583                  if (LOWORD(wParam) == IDC_STYLER_COMBO_FONT_SIZE)
1584                  {
1585                      if (i != 0)
1586                      {
1587  						const size_t intStrLen = 3;
1588  						TCHAR intStr[intStrLen] = { &#x27;\0&#x27; };
1589  						auto lbTextLen = ::SendDlgItemMessage(hwnd, LOWORD(wParam), CB_GETLBTEXTLEN, i, 0);
1590  						if (static_cast&lt;size_t&gt;(lbTextLen) &gt; intStrLen - 1)
1591  							return TRUE;
1592  						::SendDlgItemMessage(hwnd, LOWORD(wParam), CB_GETLBTEXT, i, reinterpret_cast&lt;LPARAM&gt;(intStr));
1593                          if (!intStr[0])
1594                              style._fontSize = -1;
1595                          else
1596                          {
1597                              TCHAR *finStr = nullptr;
1598                              style._fontSize = wcstol(intStr, &amp;finStr, 10);
1599                              if (*finStr != &#x27;\0&#x27;)
1600                                  style._fontSize = -1;
1601                          }
1602                      }
1603                      else
1604                      {
1605                          style._fontSize = -1;
1606                      }
1607                  }
1608                  else if (LOWORD(wParam) == IDC_STYLER_COMBO_FONT_NAME)
1609                  {
1610                      style._fontName = (TCHAR *)::SendDlgItemMessage(hwnd, LOWORD(wParam), CB_GETITEMDATA, i, 0);
1611                  }
1612                  if (SharedParametersDialog::_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
1613                      SharedParametersDialog::_pScintilla-&gt;styleChange();
1614                  return TRUE;
1615              }
1616              else if (HIWORD(wParam) == CPN_COLOURPICKED)    
1617              {
1618                  if (wParam == IDCANCEL)
1619                  {
1620                      style = dlg-&gt;_initialStyle;
1621                      if (SharedParametersDialog::_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
1622                          SharedParametersDialog::_pScintilla-&gt;styleChange();
1623                      ::RemoveProp(hwnd, TEXT(&quot;Styler dialog prop&quot;));
1624                      ::EndDialog(hwnd, IDCANCEL);
1625                      return TRUE;
1626                  }
1627                  if (wParam == IDOK)
1628                  {
1629                      ::RemoveProp(hwnd, TEXT(&quot;Styler dialog prop&quot;));
1630                      ::EndDialog(hwnd, IDOK);
1631                      return TRUE;
1632                  }
1633                  style._fgColor = dlg-&gt;_pFgColour-&gt;getColour();
1634                  style._bgColor = dlg-&gt;_pBgColour-&gt;getColour();
1635  				if (wParam == IDC_STYLER_CHECK_FG_TRANSPARENT || wParam == IDC_STYLER_CHECK_BG_TRANSPARENT)
1636  				{
1637  					if (wParam == IDC_STYLER_CHECK_FG_TRANSPARENT)
1638  					{
1639  						bool isTransparent = (BST_CHECKED == ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_FG_TRANSPARENT, BM_GETCHECK, 0, 0));
1640  						dlg-&gt;_pFgColour-&gt;setEnabled(!isTransparent);
1641  						dlg-&gt;_pFgColour-&gt;redraw();
1642                          if (isTransparent)
1643  						    style._colorStyle &amp;= ~COLORSTYLE_FOREGROUND;
1644                          else
1645                              style._colorStyle |= COLORSTYLE_FOREGROUND;
1646  					}
1647  					if (wParam == IDC_STYLER_CHECK_BG_TRANSPARENT)
1648  					{
1649  						bool isTransparent = (BST_CHECKED == ::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_BG_TRANSPARENT, BM_GETCHECK, 0, 0));
1650  						dlg-&gt;_pBgColour-&gt;setEnabled(!isTransparent);
1651  						dlg-&gt;_pBgColour-&gt;redraw();
1652                          if (isTransparent)
1653  						    style._colorStyle &amp;= ~COLORSTYLE_BACKGROUND;
1654                          else
1655  						    style._colorStyle |= COLORSTYLE_BACKGROUND;
1656  					}
1657  				}
1658  				else
1659  				{
1660  					if (dlg-&gt;_pFgColour-&gt;isEnabled())
1661  					{
1662  						style._colorStyle |= COLORSTYLE_FOREGROUND;
1663  					}
1664  					else
1665  					{
1666  						style._colorStyle &amp;= ~COLORSTYLE_FOREGROUND;
1667  					}
1668  					::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_FG_TRANSPARENT, BM_SETCHECK, !dlg-&gt;_pFgColour-&gt;isEnabled(), 0);
1669  					if (dlg-&gt;_pBgColour-&gt;isEnabled())
1670  					{
1671  						style._colorStyle |= COLORSTYLE_BACKGROUND;
1672  					}
1673  					else
1674  					{
1675  						style._colorStyle &amp;= ~COLORSTYLE_BACKGROUND;
1676  					}
1677  					::SendDlgItemMessage(hwnd, IDC_STYLER_CHECK_BG_TRANSPARENT, BM_SETCHECK, !dlg-&gt;_pBgColour-&gt;isEnabled(), 0);
1678  				}
1679                  style._fontStyle = FONTSTYLE_NONE;
1680                  if (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, IDC_STYLER_CHECK_BOLD), BM_GETCHECK, 0, 0))
1681                      style._fontStyle |= FONTSTYLE_BOLD;
1682                  if (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, IDC_STYLER_CHECK_ITALIC), BM_GETCHECK, 0, 0))
1683                      style._fontStyle |= FONTSTYLE_ITALIC;
1684                  if (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, IDC_STYLER_CHECK_UNDERLINE), BM_GETCHECK, 0, 0))
1685                      style._fontStyle |= FONTSTYLE_UNDERLINE;
1686                  style._nesting = SCE_USER_MASK_NESTING_NONE;
1687                  unordered_map&lt;int, int&gt;::iterator iter = globalMappper().nestingMapper.begin();
1688                  for (; iter != globalMappper().nestingMapper.end(); ++iter)
1689                  {
1690                      if (BST_CHECKED == ::SendMessage(::GetDlgItem(hwnd, iter-&gt;first), BM_GETCHECK, 0, 0))
1691                          style._nesting |= iter-&gt;second;
1692                  }
1693                  if (SharedParametersDialog::_pScintilla-&gt;getCurrentBuffer()-&gt;getLangType() == L_USER)
1694                      SharedParametersDialog::_pScintilla-&gt;styleChange();
1695                  return TRUE;
1696              }
1697              return FALSE;
1698          }
1699          case WM_CLOSE:
1700          {
1701              return TRUE;
1702          }
1703          default :
1704              return FALSE;
1705      }
1706      return FALSE;
1707  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-UserDefineDialog.cpp</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-UserDefineDialog.cpp</div>
                </div>
                <div class="column column_space"><pre><code>565          if (i &lt; 10)
566              _itow(i, intBuffer + 1, 10);
567          else
568              _itow(i, intBuffer, 10);
569          retrieve(buffer, _pUserLang-&gt;_keywordLists[SCE_USER_KWLIST_DELIMITERS], intBuffer);
</pre></code></div>
                <div class="column column_space"><pre><code>746                  if (i &lt; 10)
747                      _itow(i, intBuffer+1, 10);
748                  else
749                      _itow(i, intBuffer, 10);
750                  int dd = list[i];
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    