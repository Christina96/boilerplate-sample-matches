
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 80, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-civil_time_test.cc</h3>
            <pre><code>1  #include "absl/time/civil_time.h"
2  #include <limits>
3  #include <sstream>
4  #include <type_traits>
5  #include "absl/base/macros.h"
6  #include "gtest/gtest.h"
7  namespace {
8  TEST(CivilTime, DefaultConstruction) {
9    absl::CivilSecond ss;
10    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(ss));
11    absl::CivilMinute mm;
12    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(mm));
13    absl::CivilHour hh;
14    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hh));
15    absl::CivilDay d;
16    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(d));
17    absl::CivilMonth m;
18    EXPECT_EQ("1970-01", absl::FormatCivilTime(m));
19    absl::CivilYear y;
20    EXPECT_EQ("1970", absl::FormatCivilTime(y));
21  }
22  TEST(CivilTime, StructMember) {
23    struct S {
24      absl::CivilDay day;
25    };
26    S s = {};
27    EXPECT_EQ(absl::CivilDay{}, s.day);
28  }
29  TEST(CivilTime, FieldsConstruction) {
30    EXPECT_EQ("2015-01-02T03:04:05",
31              absl::FormatCivilTime(absl::CivilSecond(2015, 1, 2, 3, 4, 5)));
32    EXPECT_EQ("2015-01-02T03:04:00",
33              absl::FormatCivilTime(absl::CivilSecond(2015, 1, 2, 3, 4)));
34    EXPECT_EQ("2015-01-02T03:00:00",
35              absl::FormatCivilTime(absl::CivilSecond(2015, 1, 2, 3)));
36    EXPECT_EQ("2015-01-02T00:00:00",
37              absl::FormatCivilTime(absl::CivilSecond(2015, 1, 2)));
38    EXPECT_EQ("2015-01-01T00:00:00",
39              absl::FormatCivilTime(absl::CivilSecond(2015, 1)));
40    EXPECT_EQ("2015-01-01T00:00:00",
41              absl::FormatCivilTime(absl::CivilSecond(2015)));
42    EXPECT_EQ("2015-01-02T03:04",
43              absl::FormatCivilTime(absl::CivilMinute(2015, 1, 2, 3, 4, 5)));
44    EXPECT_EQ("2015-01-02T03:04",
45              absl::FormatCivilTime(absl::CivilMinute(2015, 1, 2, 3, 4)));
46    EXPECT_EQ("2015-01-02T03:00",
47              absl::FormatCivilTime(absl::CivilMinute(2015, 1, 2, 3)));
48    EXPECT_EQ("2015-01-02T00:00",
49              absl::FormatCivilTime(absl::CivilMinute(2015, 1, 2)));
50    EXPECT_EQ("2015-01-01T00:00",
51              absl::FormatCivilTime(absl::CivilMinute(2015, 1)));
52    EXPECT_EQ("2015-01-01T00:00",
53              absl::FormatCivilTime(absl::CivilMinute(2015)));
54    EXPECT_EQ("2015-01-02T03",
55              absl::FormatCivilTime(absl::CivilHour(2015, 1, 2, 3, 4, 5)));
56    EXPECT_EQ("2015-01-02T03",
57              absl::FormatCivilTime(absl::CivilHour(2015, 1, 2, 3, 4)));
58    EXPECT_EQ("2015-01-02T03",
59              absl::FormatCivilTime(absl::CivilHour(2015, 1, 2, 3)));
60    EXPECT_EQ("2015-01-02T00",
61              absl::FormatCivilTime(absl::CivilHour(2015, 1, 2)));
62    EXPECT_EQ("2015-01-01T00",
63              absl::FormatCivilTime(absl::CivilHour(2015, 1)));
64    EXPECT_EQ("2015-01-01T00",
65              absl::FormatCivilTime(absl::CivilHour(2015)));
66    EXPECT_EQ("2015-01-02",
67              absl::FormatCivilTime(absl::CivilDay(2015, 1, 2, 3, 4, 5)));
68    EXPECT_EQ("2015-01-02",
69              absl::FormatCivilTime(absl::CivilDay(2015, 1, 2, 3, 4)));
70    EXPECT_EQ("2015-01-02",
71              absl::FormatCivilTime(absl::CivilDay(2015, 1, 2, 3)));
72    EXPECT_EQ("2015-01-02",
73              absl::FormatCivilTime(absl::CivilDay(2015, 1, 2)));
74    EXPECT_EQ("2015-01-01",
75              absl::FormatCivilTime(absl::CivilDay(2015, 1)));
76    EXPECT_EQ("2015-01-01",
77              absl::FormatCivilTime(absl::CivilDay(2015)));
78    EXPECT_EQ("2015-01",
79              absl::FormatCivilTime(absl::CivilMonth(2015, 1, 2, 3, 4, 5)));
80    EXPECT_EQ("2015-01",
81              absl::FormatCivilTime(absl::CivilMonth(2015, 1, 2, 3, 4)));
82    EXPECT_EQ("2015-01",
83              absl::FormatCivilTime(absl::CivilMonth(2015, 1, 2, 3)));
84    EXPECT_EQ("2015-01",
85              absl::FormatCivilTime(absl::CivilMonth(2015, 1, 2)));
86    EXPECT_EQ("2015-01",
87              absl::FormatCivilTime(absl::CivilMonth(2015, 1)));
88    EXPECT_EQ("2015-01",
89              absl::FormatCivilTime(absl::CivilMonth(2015)));
90    EXPECT_EQ("2015",
91              absl::FormatCivilTime(absl::CivilYear(2015, 1, 2, 3, 4, 5)));
92    EXPECT_EQ("2015",
93              absl::FormatCivilTime(absl::CivilYear(2015, 1, 2, 3, 4)));
94    EXPECT_EQ("2015",
95              absl::FormatCivilTime(absl::CivilYear(2015, 1, 2, 3)));
96    EXPECT_EQ("2015",
97              absl::FormatCivilTime(absl::CivilYear(2015, 1, 2)));
98    EXPECT_EQ("2015",
99              absl::FormatCivilTime(absl::CivilYear(2015, 1)));
100    EXPECT_EQ("2015",
101              absl::FormatCivilTime(absl::CivilYear(2015)));
102  }
103  TEST(CivilTime, FieldsConstructionLimits) {
104    const int kIntMax = std::numeric_limits<int>::max();
105    EXPECT_EQ("2038-01-19T03:14:07",
106              absl::FormatCivilTime(absl::CivilSecond(
107                  1970, 1, 1, 0, 0, kIntMax)));
108    EXPECT_EQ("6121-02-11T05:21:07",
109              absl::FormatCivilTime(absl::CivilSecond(
110                  1970, 1, 1, 0, kIntMax, kIntMax)));
111    EXPECT_EQ("251104-11-20T12:21:07",
112              absl::FormatCivilTime(absl::CivilSecond(
113                  1970, 1, 1, kIntMax, kIntMax, kIntMax)));
114    EXPECT_EQ("6130715-05-30T12:21:07",
115              absl::FormatCivilTime(absl::CivilSecond(
116                  1970, 1, kIntMax, kIntMax, kIntMax, kIntMax)));
117    EXPECT_EQ("185087685-11-26T12:21:07",
118              absl::FormatCivilTime(absl::CivilSecond(
119                  1970, kIntMax, kIntMax, kIntMax, kIntMax, kIntMax)));
120    const int kIntMin = std::numeric_limits<int>::min();
121    EXPECT_EQ("1901-12-13T20:45:52",
122              absl::FormatCivilTime(absl::CivilSecond(
123                  1970, 1, 1, 0, 0, kIntMin)));
124    EXPECT_EQ("-2182-11-20T18:37:52",
125              absl::FormatCivilTime(absl::CivilSecond(
126                  1970, 1, 1, 0, kIntMin, kIntMin)));
127    EXPECT_EQ("-247165-02-11T10:37:52",
128              absl::FormatCivilTime(absl::CivilSecond(
129                  1970, 1, 1, kIntMin, kIntMin, kIntMin)));
130    EXPECT_EQ("-6126776-08-01T10:37:52",
131              absl::FormatCivilTime(absl::CivilSecond(
132                  1970, 1, kIntMin, kIntMin, kIntMin, kIntMin)));
133    EXPECT_EQ("-185083747-10-31T10:37:52",
134              absl::FormatCivilTime(absl::CivilSecond(
135                  1970, kIntMin, kIntMin, kIntMin, kIntMin, kIntMin)));
136  }
137  TEST(CivilTime, RangeLimits) {
138    const absl::civil_year_t kYearMax =
139        std::numeric_limits<absl::civil_year_t>::max();
140    EXPECT_EQ(absl::CivilYear(kYearMax),
141              absl::CivilYear::max());
142    EXPECT_EQ(absl::CivilMonth(kYearMax, 12),
143              absl::CivilMonth::max());
144    EXPECT_EQ(absl::CivilDay(kYearMax, 12, 31),
145              absl::CivilDay::max());
146    EXPECT_EQ(absl::CivilHour(kYearMax, 12, 31, 23),
147              absl::CivilHour::max());
148    EXPECT_EQ(absl::CivilMinute(kYearMax, 12, 31, 23, 59),
149              absl::CivilMinute::max());
150    EXPECT_EQ(absl::CivilSecond(kYearMax, 12, 31, 23, 59, 59),
151              absl::CivilSecond::max());
152    const absl::civil_year_t kYearMin =
153        std::numeric_limits<absl::civil_year_t>::min();
154    EXPECT_EQ(absl::CivilYear(kYearMin),
155              absl::CivilYear::min());
156    EXPECT_EQ(absl::CivilMonth(kYearMin, 1),
157              absl::CivilMonth::min());
158    EXPECT_EQ(absl::CivilDay(kYearMin, 1, 1),
159              absl::CivilDay::min());
160    EXPECT_EQ(absl::CivilHour(kYearMin, 1, 1, 0),
161              absl::CivilHour::min());
162    EXPECT_EQ(absl::CivilMinute(kYearMin, 1, 1, 0, 0),
163              absl::CivilMinute::min());
164    EXPECT_EQ(absl::CivilSecond(kYearMin, 1, 1, 0, 0, 0),
165              absl::CivilSecond::min());
166  }
167  TEST(CivilTime, ImplicitCrossAlignment) {
168    absl::CivilYear year(2015);
169    absl::CivilMonth month = year;
170    absl::CivilDay day = month;
171    absl::CivilHour hour = day;
172    absl::CivilMinute minute = hour;
173    absl::CivilSecond second = minute;
174    second = year;
175    EXPECT_EQ(second, year);
176    second = month;
177    EXPECT_EQ(second, month);
178    second = day;
179    EXPECT_EQ(second, day);
180    second = hour;
181    EXPECT_EQ(second, hour);
182    second = minute;
183    EXPECT_EQ(second, minute);
184    minute = year;
185    EXPECT_EQ(minute, year);
186    minute = month;
187    EXPECT_EQ(minute, month);
188    minute = day;
189    EXPECT_EQ(minute, day);
190    minute = hour;
191    EXPECT_EQ(minute, hour);
192    hour = year;
193    EXPECT_EQ(hour, year);
194    hour = month;
195    EXPECT_EQ(hour, month);
196    hour = day;
197    EXPECT_EQ(hour, day);
198    day = year;
199    EXPECT_EQ(day, year);
200    day = month;
201    EXPECT_EQ(day, month);
202    month = year;
203    EXPECT_EQ(month, year);
204    EXPECT_FALSE(
205        (std::is_convertible<absl::CivilSecond, absl::CivilMinute>::value));
206    EXPECT_FALSE(
207        (std::is_convertible<absl::CivilSecond, absl::CivilHour>::value));
208    EXPECT_FALSE(
209        (std::is_convertible<absl::CivilSecond, absl::CivilDay>::value));
210    EXPECT_FALSE(
211        (std::is_convertible<absl::CivilSecond, absl::CivilMonth>::value));
212    EXPECT_FALSE(
213        (std::is_convertible<absl::CivilSecond, absl::CivilYear>::value));
214    EXPECT_FALSE(
215        (std::is_convertible<absl::CivilMinute, absl::CivilHour>::value));
216    EXPECT_FALSE(
217        (std::is_convertible<absl::CivilMinute, absl::CivilDay>::value));
218    EXPECT_FALSE(
219        (std::is_convertible<absl::CivilMinute, absl::CivilMonth>::value));
220    EXPECT_FALSE(
221        (std::is_convertible<absl::CivilMinute, absl::CivilYear>::value));
222    EXPECT_FALSE(
223        (std::is_convertible<absl::CivilHour, absl::CivilDay>::value));
224    EXPECT_FALSE(
225        (std::is_convertible<absl::CivilHour, absl::CivilMonth>::value));
226    EXPECT_FALSE(
227        (std::is_convertible<absl::CivilHour, absl::CivilYear>::value));
228    EXPECT_FALSE(
229        (std::is_convertible<absl::CivilDay, absl::CivilMonth>::value));
230    EXPECT_FALSE(
231        (std::is_convertible<absl::CivilDay, absl::CivilYear>::value));
232    EXPECT_FALSE(
233        (std::is_convertible<absl::CivilMonth, absl::CivilYear>::value));
234  }
235  TEST(CivilTime, ExplicitCrossAlignment) {
236    absl::CivilSecond second(2015, 1, 2, 3, 4, 5);
237    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(second));
238    absl::CivilMinute minute(second);
239    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(minute));
240    absl::CivilHour hour(minute);
241    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour));
242    absl::CivilDay day(hour);
243    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day));
244    absl::CivilMonth month(day);
245    EXPECT_EQ("2015-01", absl::FormatCivilTime(month));
246    absl::CivilYear year(month);
247    EXPECT_EQ("2015", absl::FormatCivilTime(year));
248    month = absl::CivilMonth(year);
249    EXPECT_EQ("2015-01", absl::FormatCivilTime(month));
250    day = absl::CivilDay(month);
251    EXPECT_EQ("2015-01-01", absl::FormatCivilTime(day));
252    hour = absl::CivilHour(day);
253    EXPECT_EQ("2015-01-01T00", absl::FormatCivilTime(hour));
254    minute = absl::CivilMinute(hour);
255    EXPECT_EQ("2015-01-01T00:00", absl::FormatCivilTime(minute));
256    second = absl::CivilSecond(minute);
257    EXPECT_EQ("2015-01-01T00:00:00", absl::FormatCivilTime(second));
258  }
259  template <typename T1, typename T2>
260  struct HasDiff {
261    template <typename U1, typename U2>
262    static std::false_type test(...);
263    template <typename U1, typename U2>
264    static std::true_type test(decltype(std::declval<U1>() - std::declval<U2>()));
265    static constexpr bool value = decltype(test<T1, T2>(0))::value;
266  };
267  TEST(CivilTime, DisallowCrossAlignedDifference) {
268    static_assert(HasDiff<absl::CivilSecond, absl::CivilSecond>::value, "");
269    static_assert(HasDiff<absl::CivilMinute, absl::CivilMinute>::value, "");
270    static_assert(HasDiff<absl::CivilHour, absl::CivilHour>::value, "");
271    static_assert(HasDiff<absl::CivilDay, absl::CivilDay>::value, "");
272    static_assert(HasDiff<absl::CivilMonth, absl::CivilMonth>::value, "");
273    static_assert(HasDiff<absl::CivilYear, absl::CivilYear>::value, "");
274    static_assert(!HasDiff<absl::CivilSecond, absl::CivilMinute>::value, "");
275    static_assert(!HasDiff<absl::CivilSecond, absl::CivilHour>::value, "");
276    static_assert(!HasDiff<absl::CivilSecond, absl::CivilDay>::value, "");
277    static_assert(!HasDiff<absl::CivilSecond, absl::CivilMonth>::value, "");
278    static_assert(!HasDiff<absl::CivilSecond, absl::CivilYear>::value, "");
279    static_assert(!HasDiff<absl::CivilMinute, absl::CivilHour>::value, "");
280    static_assert(!HasDiff<absl::CivilMinute, absl::CivilDay>::value, "");
281    static_assert(!HasDiff<absl::CivilMinute, absl::CivilMonth>::value, "");
282    static_assert(!HasDiff<absl::CivilMinute, absl::CivilYear>::value, "");
283    static_assert(!HasDiff<absl::CivilHour, absl::CivilDay>::value, "");
284    static_assert(!HasDiff<absl::CivilHour, absl::CivilMonth>::value, "");
285    static_assert(!HasDiff<absl::CivilHour, absl::CivilYear>::value, "");
286    static_assert(!HasDiff<absl::CivilDay, absl::CivilMonth>::value, "");
287    static_assert(!HasDiff<absl::CivilDay, absl::CivilYear>::value, "");
288    static_assert(!HasDiff<absl::CivilMonth, absl::CivilYear>::value, "");
289  }
290  TEST(CivilTime, ValueSemantics) {
291    const absl::CivilHour a(2015, 1, 2, 3);
292    const absl::CivilHour b = a;
293    const absl::CivilHour c(b);
294    absl::CivilHour d;
295    d = c;
296    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(d));
297  }
298  TEST(CivilTime, Relational) {
299    const absl::CivilYear year(2014);
300    const absl::CivilMonth month(year);
301    EXPECT_EQ(year, month);
302  #define TEST_RELATIONAL(OLDER, YOUNGER) \
303    do {                                  \
304      EXPECT_FALSE(OLDER < OLDER);        \
305      EXPECT_FALSE(OLDER > OLDER);        \
306      EXPECT_TRUE(OLDER >= OLDER);        \
307      EXPECT_TRUE(OLDER <= OLDER);        \
308      EXPECT_FALSE(YOUNGER < YOUNGER);    \
309      EXPECT_FALSE(YOUNGER > YOUNGER);    \
310      EXPECT_TRUE(YOUNGER >= YOUNGER);    \
311      EXPECT_TRUE(YOUNGER <= YOUNGER);    \
312      EXPECT_EQ(OLDER, OLDER);            \
313      EXPECT_NE(OLDER, YOUNGER);          \
314      EXPECT_LT(OLDER, YOUNGER);          \
315      EXPECT_LE(OLDER, YOUNGER);          \
316      EXPECT_GT(YOUNGER, OLDER);          \
317      EXPECT_GE(YOUNGER, OLDER);          \
318    } while (0)
319    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 0, 0, 0),
320                    absl::CivilSecond(2015, 1, 1, 0, 0, 0));
321    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 0, 0, 0),
322                    absl::CivilSecond(2014, 2, 1, 0, 0, 0));
323    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 0, 0, 0),
324                    absl::CivilSecond(2014, 1, 2, 0, 0, 0));
325    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 0, 0, 0),
326                    absl::CivilSecond(2014, 1, 1, 1, 0, 0));
327    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 1, 0, 0),
328                    absl::CivilSecond(2014, 1, 1, 1, 1, 0));
329    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 1, 1, 0),
330                    absl::CivilSecond(2014, 1, 1, 1, 1, 1));
331    TEST_RELATIONAL(absl::CivilDay(2014, 1, 1),
332                    absl::CivilMinute(2014, 1, 1, 1, 1));
333    TEST_RELATIONAL(absl::CivilDay(2014, 1, 1),
334                    absl::CivilMonth(2014, 2));
335  #undef TEST_RELATIONAL
336  }
337  TEST(CivilTime, Arithmetic) {
338    absl::CivilSecond second(2015, 1, 2, 3, 4, 5);
339    EXPECT_EQ("2015-01-02T03:04:06", absl::FormatCivilTime(second += 1));
340    EXPECT_EQ("2015-01-02T03:04:07", absl::FormatCivilTime(second + 1));
341    EXPECT_EQ("2015-01-02T03:04:08", absl::FormatCivilTime(2 + second));
342    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(second - 1));
343    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(second -= 1));
344    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(second++));
345    EXPECT_EQ("2015-01-02T03:04:07", absl::FormatCivilTime(++second));
346    EXPECT_EQ("2015-01-02T03:04:07", absl::FormatCivilTime(second--));
347    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(--second));
348    absl::CivilMinute minute(2015, 1, 2, 3, 4);
349    EXPECT_EQ("2015-01-02T03:05", absl::FormatCivilTime(minute += 1));
350    EXPECT_EQ("2015-01-02T03:06", absl::FormatCivilTime(minute + 1));
351    EXPECT_EQ("2015-01-02T03:07", absl::FormatCivilTime(2 + minute));
352    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(minute - 1));
353    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(minute -= 1));
354    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(minute++));
355    EXPECT_EQ("2015-01-02T03:06", absl::FormatCivilTime(++minute));
356    EXPECT_EQ("2015-01-02T03:06", absl::FormatCivilTime(minute--));
357    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(--minute));
358    absl::CivilHour hour(2015, 1, 2, 3);
359    EXPECT_EQ("2015-01-02T04", absl::FormatCivilTime(hour += 1));
360    EXPECT_EQ("2015-01-02T05", absl::FormatCivilTime(hour + 1));
361    EXPECT_EQ("2015-01-02T06", absl::FormatCivilTime(2 + hour));
362    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour - 1));
363    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour -= 1));
364    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour++));
365    EXPECT_EQ("2015-01-02T05", absl::FormatCivilTime(++hour));
366    EXPECT_EQ("2015-01-02T05", absl::FormatCivilTime(hour--));
367    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(--hour));
368    absl::CivilDay day(2015, 1, 2);
369    EXPECT_EQ("2015-01-03", absl::FormatCivilTime(day += 1));
370    EXPECT_EQ("2015-01-04", absl::FormatCivilTime(day + 1));
371    EXPECT_EQ("2015-01-05", absl::FormatCivilTime(2 + day));
<span onclick='openModal()' class='match'>372    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day - 1));
373    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day -= 1));
374    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day++));
375    EXPECT_EQ("2015-01-04", absl::FormatCivilTime(++day));
376    EXPECT_EQ("2015-01-04", absl::FormatCivilTime(day--));
377    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(--day));
378    absl::CivilMonth month(2015, 1);
</span>379    EXPECT_EQ("2015-02", absl::FormatCivilTime(month += 1));
380    EXPECT_EQ("2015-03", absl::FormatCivilTime(month + 1));
381    EXPECT_EQ("2015-04", absl::FormatCivilTime(2 + month));
382    EXPECT_EQ("2015-01", absl::FormatCivilTime(month - 1));
383    EXPECT_EQ("2015-01", absl::FormatCivilTime(month -= 1));
384    EXPECT_EQ("2015-01", absl::FormatCivilTime(month++));
385    EXPECT_EQ("2015-03", absl::FormatCivilTime(++month));
386    EXPECT_EQ("2015-03", absl::FormatCivilTime(month--));
387    EXPECT_EQ("2015-01", absl::FormatCivilTime(--month));
388    absl::CivilYear year(2015);
389    EXPECT_EQ("2016", absl::FormatCivilTime(year += 1));
390    EXPECT_EQ("2017", absl::FormatCivilTime(year + 1));
391    EXPECT_EQ("2018", absl::FormatCivilTime(2 + year));
392    EXPECT_EQ("2015", absl::FormatCivilTime(year - 1));
393    EXPECT_EQ("2015", absl::FormatCivilTime(year -= 1));
394    EXPECT_EQ("2015", absl::FormatCivilTime(year++));
395    EXPECT_EQ("2017", absl::FormatCivilTime(++year));
396    EXPECT_EQ("2017", absl::FormatCivilTime(year--));
397    EXPECT_EQ("2015", absl::FormatCivilTime(--year));
398  }
399  TEST(CivilTime, ArithmeticLimits) {
400    const int kIntMax = std::numeric_limits<int>::max();
401    const int kIntMin = std::numeric_limits<int>::min();
402    absl::CivilSecond second(1970, 1, 1, 0, 0, 0);
403    second += kIntMax;
404    EXPECT_EQ("2038-01-19T03:14:07", absl::FormatCivilTime(second));
405    second -= kIntMax;
406    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(second));
407    second += kIntMin;
408    EXPECT_EQ("1901-12-13T20:45:52", absl::FormatCivilTime(second));
409    second -= kIntMin;
410    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(second));
411    absl::CivilMinute minute(1970, 1, 1, 0, 0);
412    minute += kIntMax;
413    EXPECT_EQ("6053-01-23T02:07", absl::FormatCivilTime(minute));
414    minute -= kIntMax;
415    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(minute));
416    minute += kIntMin;
417    EXPECT_EQ("-2114-12-08T21:52", absl::FormatCivilTime(minute));
418    minute -= kIntMin;
419    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(minute));
420    absl::CivilHour hour(1970, 1, 1, 0);
421    hour += kIntMax;
422    EXPECT_EQ("246953-10-09T07", absl::FormatCivilTime(hour));
423    hour -= kIntMax;
424    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hour));
425    hour += kIntMin;
426    EXPECT_EQ("-243014-03-24T16", absl::FormatCivilTime(hour));
427    hour -= kIntMin;
428    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hour));
429    absl::CivilDay day(1970, 1, 1);
430    day += kIntMax;
431    EXPECT_EQ("5881580-07-11", absl::FormatCivilTime(day));
432    day -= kIntMax;
433    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(day));
434    day += kIntMin;
435    EXPECT_EQ("-5877641-06-23", absl::FormatCivilTime(day));
436    day -= kIntMin;
437    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(day));
438    absl::CivilMonth month(1970, 1);
439    month += kIntMax;
440    EXPECT_EQ("178958940-08", absl::FormatCivilTime(month));
441    month -= kIntMax;
442    EXPECT_EQ("1970-01", absl::FormatCivilTime(month));
443    month += kIntMin;
444    EXPECT_EQ("-178955001-05", absl::FormatCivilTime(month));
445    month -= kIntMin;
446    EXPECT_EQ("1970-01", absl::FormatCivilTime(month));
447    absl::CivilYear year(0);
448    year += kIntMax;
449    EXPECT_EQ("2147483647", absl::FormatCivilTime(year));
450    year -= kIntMax;
451    EXPECT_EQ("0", absl::FormatCivilTime(year));
452    year += kIntMin;
453    EXPECT_EQ("-2147483648", absl::FormatCivilTime(year));
454    year -= kIntMin;
455    EXPECT_EQ("0", absl::FormatCivilTime(year));
456  }
457  TEST(CivilTime, Difference) {
458    absl::CivilSecond second(2015, 1, 2, 3, 4, 5);
459    EXPECT_EQ(0, second - second);
460    EXPECT_EQ(10, (second + 10) - second);
461    EXPECT_EQ(-10, (second - 10) - second);
462    absl::CivilMinute minute(2015, 1, 2, 3, 4);
463    EXPECT_EQ(0, minute - minute);
464    EXPECT_EQ(10, (minute + 10) - minute);
465    EXPECT_EQ(-10, (minute - 10) - minute);
466    absl::CivilHour hour(2015, 1, 2, 3);
467    EXPECT_EQ(0, hour - hour);
468    EXPECT_EQ(10, (hour + 10) - hour);
469    EXPECT_EQ(-10, (hour - 10) - hour);
470    absl::CivilDay day(2015, 1, 2);
471    EXPECT_EQ(0, day - day);
472    EXPECT_EQ(10, (day + 10) - day);
473    EXPECT_EQ(-10, (day - 10) - day);
474    absl::CivilMonth month(2015, 1);
475    EXPECT_EQ(0, month - month);
476    EXPECT_EQ(10, (month + 10) - month);
477    EXPECT_EQ(-10, (month - 10) - month);
478    absl::CivilYear year(2015);
479    EXPECT_EQ(0, year - year);
480    EXPECT_EQ(10, (year + 10) - year);
481    EXPECT_EQ(-10, (year - 10) - year);
482  }
483  TEST(CivilTime, DifferenceLimits) {
484    const absl::civil_diff_t kDiffMax =
485        std::numeric_limits<absl::civil_diff_t>::max();
486    const absl::civil_diff_t kDiffMin =
487        std::numeric_limits<absl::civil_diff_t>::min();
488    const absl::CivilDay max_day(kDiffMax, 12, 31);
489    EXPECT_EQ(1, max_day - (max_day - 1));
490    EXPECT_EQ(-1, (max_day - 1) - max_day);
491    const absl::CivilDay min_day(kDiffMin, 1, 1);
492    EXPECT_EQ(1, (min_day + 1) - min_day);
493    EXPECT_EQ(-1, min_day - (min_day + 1));
494    const absl::CivilDay d1(1970, 1, 1);
495    const absl::CivilDay d2(25252734927768524, 7, 27);
496    EXPECT_EQ(kDiffMax, d2 - d1);
497    EXPECT_EQ(kDiffMin, d1 - (d2 + 1));
498  }
499  TEST(CivilTime, Properties) {
500    absl::CivilSecond ss(2015, 2, 3, 4, 5, 6);
501    EXPECT_EQ(2015, ss.year());
502    EXPECT_EQ(2, ss.month());
503    EXPECT_EQ(3, ss.day());
504    EXPECT_EQ(4, ss.hour());
505    EXPECT_EQ(5, ss.minute());
506    EXPECT_EQ(6, ss.second());
507    EXPECT_EQ(absl::Weekday::tuesday, absl::GetWeekday(ss));
508    EXPECT_EQ(34, absl::GetYearDay(ss));
509    absl::CivilMinute mm(2015, 2, 3, 4, 5, 6);
510    EXPECT_EQ(2015, mm.year());
511    EXPECT_EQ(2, mm.month());
512    EXPECT_EQ(3, mm.day());
513    EXPECT_EQ(4, mm.hour());
514    EXPECT_EQ(5, mm.minute());
515    EXPECT_EQ(0, mm.second());
516    EXPECT_EQ(absl::Weekday::tuesday, absl::GetWeekday(mm));
517    EXPECT_EQ(34, absl::GetYearDay(mm));
518    absl::CivilHour hh(2015, 2, 3, 4, 5, 6);
519    EXPECT_EQ(2015, hh.year());
520    EXPECT_EQ(2, hh.month());
521    EXPECT_EQ(3, hh.day());
522    EXPECT_EQ(4, hh.hour());
523    EXPECT_EQ(0, hh.minute());
524    EXPECT_EQ(0, hh.second());
525    EXPECT_EQ(absl::Weekday::tuesday, absl::GetWeekday(hh));
526    EXPECT_EQ(34, absl::GetYearDay(hh));
527    absl::CivilDay d(2015, 2, 3, 4, 5, 6);
528    EXPECT_EQ(2015, d.year());
529    EXPECT_EQ(2, d.month());
530    EXPECT_EQ(3, d.day());
531    EXPECT_EQ(0, d.hour());
532    EXPECT_EQ(0, d.minute());
533    EXPECT_EQ(0, d.second());
534    EXPECT_EQ(absl::Weekday::tuesday, absl::GetWeekday(d));
535    EXPECT_EQ(34, absl::GetYearDay(d));
536    absl::CivilMonth m(2015, 2, 3, 4, 5, 6);
537    EXPECT_EQ(2015, m.year());
538    EXPECT_EQ(2, m.month());
539    EXPECT_EQ(1, m.day());
540    EXPECT_EQ(0, m.hour());
541    EXPECT_EQ(0, m.minute());
542    EXPECT_EQ(0, m.second());
543    EXPECT_EQ(absl::Weekday::sunday, absl::GetWeekday(m));
544    EXPECT_EQ(32, absl::GetYearDay(m));
545    absl::CivilYear y(2015, 2, 3, 4, 5, 6);
546    EXPECT_EQ(2015, y.year());
547    EXPECT_EQ(1, y.month());
548    EXPECT_EQ(1, y.day());
549    EXPECT_EQ(0, y.hour());
550    EXPECT_EQ(0, y.minute());
551    EXPECT_EQ(0, y.second());
552    EXPECT_EQ(absl::Weekday::thursday, absl::GetWeekday(y));
553    EXPECT_EQ(1, absl::GetYearDay(y));
554  }
555  TEST(CivilTime, Format) {
556    absl::CivilSecond ss;
557    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(ss));
558    absl::CivilMinute mm;
559    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(mm));
560    absl::CivilHour hh;
561    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hh));
562    absl::CivilDay d;
563    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(d));
564    absl::CivilMonth m;
565    EXPECT_EQ("1970-01", absl::FormatCivilTime(m));
566    absl::CivilYear y;
567    EXPECT_EQ("1970", absl::FormatCivilTime(y));
568  }
569  TEST(CivilTime, Parse) {
570    absl::CivilSecond ss;
571    absl::CivilMinute mm;
572    absl::CivilHour hh;
573    absl::CivilDay d;
574    absl::CivilMonth m;
575    absl::CivilYear y;
576    EXPECT_TRUE(absl::ParseCivilTime("2015-01-02T03:04:05", &ss));
577    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(ss));
578    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &mm));
579    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &hh));
580    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &d));
581    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &m));
582    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &y));
583    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &ss));
584    EXPECT_TRUE(absl::ParseCivilTime("2015-01-02T03:04", &mm));
585    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(mm));
586    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &hh));
587    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &d));
588    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &m));
589    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &y));
590    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &ss));
591    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &mm));
592    EXPECT_TRUE(absl::ParseCivilTime("2015-01-02T03", &hh));
593    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hh));
594    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &d));
595    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &m));
596    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &y));
597    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &ss));
598    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &mm));
599    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &hh));
600    EXPECT_TRUE(absl::ParseCivilTime("2015-01-02", &d));
601    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(d));
602    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &m));
603    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &y));
604    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &ss));
605    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &mm));
606    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &hh));
607    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &d));
608    EXPECT_TRUE(absl::ParseCivilTime("2015-01", &m));
609    EXPECT_EQ("2015-01", absl::FormatCivilTime(m));
610    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &y));
611    EXPECT_FALSE(absl::ParseCivilTime("2015", &ss));
612    EXPECT_FALSE(absl::ParseCivilTime("2015", &mm));
613    EXPECT_FALSE(absl::ParseCivilTime("2015", &hh));
614    EXPECT_FALSE(absl::ParseCivilTime("2015", &d));
615    EXPECT_FALSE(absl::ParseCivilTime("2015", &m));
616    EXPECT_TRUE(absl::ParseCivilTime("2015", &y));
617    EXPECT_EQ("2015", absl::FormatCivilTime(y));
618  }
619  TEST(CivilTime, FormatAndParseLenient) {
620    absl::CivilSecond ss;
621    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(ss));
622    absl::CivilMinute mm;
623    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(mm));
624    absl::CivilHour hh;
625    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hh));
626    absl::CivilDay d;
627    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(d));
628    absl::CivilMonth m;
629    EXPECT_EQ("1970-01", absl::FormatCivilTime(m));
630    absl::CivilYear y;
631    EXPECT_EQ("1970", absl::FormatCivilTime(y));
632    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &ss));
633    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(ss));
634    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &mm));
635    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(mm));
636    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &hh));
637    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hh));
638    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &d));
639    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(d));
640    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &m));
641    EXPECT_EQ("2015-01", absl::FormatCivilTime(m));
642    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &y));
643    EXPECT_EQ("2015", absl::FormatCivilTime(y));
644  }
645  TEST(CivilTime, ParseEdgeCases) {
646    absl::CivilSecond ss;
647    EXPECT_TRUE(
648        absl::ParseLenientCivilTime("9223372036854775807-12-31T23:59:59", &ss));
649    EXPECT_EQ("9223372036854775807-12-31T23:59:59", absl::FormatCivilTime(ss));
650    EXPECT_TRUE(
651        absl::ParseLenientCivilTime("-9223372036854775808-01-01T00:00:00", &ss));
652    EXPECT_EQ("-9223372036854775808-01-01T00:00:00", absl::FormatCivilTime(ss));
653    absl::CivilMinute mm;
654    EXPECT_TRUE(
655        absl::ParseLenientCivilTime("9223372036854775807-12-31T23:59", &mm));
656    EXPECT_EQ("9223372036854775807-12-31T23:59", absl::FormatCivilTime(mm));
657    EXPECT_TRUE(
658        absl::ParseLenientCivilTime("-9223372036854775808-01-01T00:00", &mm));
659    EXPECT_EQ("-9223372036854775808-01-01T00:00", absl::FormatCivilTime(mm));
660    absl::CivilHour hh;
661    EXPECT_TRUE(
662        absl::ParseLenientCivilTime("9223372036854775807-12-31T23", &hh));
663    EXPECT_EQ("9223372036854775807-12-31T23", absl::FormatCivilTime(hh));
664    EXPECT_TRUE(
665        absl::ParseLenientCivilTime("-9223372036854775808-01-01T00", &hh));
666    EXPECT_EQ("-9223372036854775808-01-01T00", absl::FormatCivilTime(hh));
667    absl::CivilDay d;
668    EXPECT_TRUE(absl::ParseLenientCivilTime("9223372036854775807-12-31", &d));
669    EXPECT_EQ("9223372036854775807-12-31", absl::FormatCivilTime(d));
670    EXPECT_TRUE(absl::ParseLenientCivilTime("-9223372036854775808-01-01", &d));
671    EXPECT_EQ("-9223372036854775808-01-01", absl::FormatCivilTime(d));
672    absl::CivilMonth m;
673    EXPECT_TRUE(absl::ParseLenientCivilTime("9223372036854775807-12", &m));
674    EXPECT_EQ("9223372036854775807-12", absl::FormatCivilTime(m));
675    EXPECT_TRUE(absl::ParseLenientCivilTime("-9223372036854775808-01", &m));
676    EXPECT_EQ("-9223372036854775808-01", absl::FormatCivilTime(m));
677    absl::CivilYear y;
678    EXPECT_TRUE(absl::ParseLenientCivilTime("9223372036854775807", &y));
679    EXPECT_EQ("9223372036854775807", absl::FormatCivilTime(y));
680    EXPECT_TRUE(absl::ParseLenientCivilTime("-9223372036854775808", &y));
681    EXPECT_EQ("-9223372036854775808", absl::FormatCivilTime(y));
682    EXPECT_TRUE(absl::ParseLenientCivilTime("0", &ss)) << ss;
683    EXPECT_EQ(absl::CivilYear(0), ss);
684    EXPECT_TRUE(absl::ParseLenientCivilTime("0-1", &ss)) << ss;
685    EXPECT_EQ(absl::CivilMonth(0, 1), ss);
686    EXPECT_TRUE(absl::ParseLenientCivilTime(" 2015 ", &ss)) << ss;
687    EXPECT_EQ(absl::CivilYear(2015), ss);
688    EXPECT_TRUE(absl::ParseLenientCivilTime(" 2015-6 ", &ss)) << ss;
689    EXPECT_EQ(absl::CivilMonth(2015, 6), ss);
690    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-6-7", &ss)) << ss;
691    EXPECT_EQ(absl::CivilDay(2015, 6, 7), ss);
692    EXPECT_TRUE(absl::ParseLenientCivilTime(" 2015-6-7 ", &ss)) << ss;
693    EXPECT_EQ(absl::CivilDay(2015, 6, 7), ss);
694    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-06-07T10:11:12 ", &ss)) << ss;
695    EXPECT_EQ(absl::CivilSecond(2015, 6, 7, 10, 11, 12), ss);
696    EXPECT_TRUE(absl::ParseLenientCivilTime(" 2015-06-07T10:11:12 ", &ss)) << ss;
697    EXPECT_EQ(absl::CivilSecond(2015, 6, 7, 10, 11, 12), ss);
698    EXPECT_TRUE(absl::ParseLenientCivilTime("-01-01", &ss)) << ss;
699    EXPECT_EQ(absl::CivilMonth(-1, 1), ss);
700    EXPECT_FALSE(absl::ParseLenientCivilTime("01-01-2015", &ss)) << ss;
701    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-", &ss)) << ss;
702    EXPECT_FALSE(absl::ParseLenientCivilTime("0xff-01", &ss)) << ss;
703    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-02-30T04:05:06", &ss)) << ss;
704    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-02-03T04:05:96", &ss)) << ss;
705    EXPECT_FALSE(absl::ParseLenientCivilTime("X2015-02-03T04:05:06", &ss)) << ss;
706    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-02-03T04:05:003", &ss)) << ss;
707    EXPECT_FALSE(absl::ParseLenientCivilTime("2015 -02-03T04:05:06", &ss)) << ss;
708    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-02-03-04:05:06", &ss)) << ss;
709    EXPECT_FALSE(absl::ParseLenientCivilTime("2015:02:03T04-05-06", &ss)) << ss;
710    EXPECT_FALSE(absl::ParseLenientCivilTime("9223372036854775808", &y)) << y;
711  }
712  TEST(CivilTime, OutputStream) {
713    absl::CivilSecond cs(2016, 2, 3, 4, 5, 6);
714    {
715      std::stringstream ss;
716      ss << std::left << std::setfill('.');
717      ss << std::setw(3) << 'X';
718      ss << std::setw(21) << absl::CivilYear(cs);
719      ss << std::setw(3) << 'X';
720      EXPECT_EQ("X..2016.................X..", ss.str());
721    }
722    {
723      std::stringstream ss;
724      ss << std::left << std::setfill('.');
725      ss << std::setw(3) << 'X';
726      ss << std::setw(21) << absl::CivilMonth(cs);
727      ss << std::setw(3) << 'X';
728      EXPECT_EQ("X..2016-02..............X..", ss.str());
729    }
730    {
731      std::stringstream ss;
732      ss << std::left << std::setfill('.');
733      ss << std::setw(3) << 'X';
734      ss << std::setw(21) << absl::CivilDay(cs);
735      ss << std::setw(3) << 'X';
736      EXPECT_EQ("X..2016-02-03...........X..", ss.str());
737    }
738    {
739      std::stringstream ss;
740      ss << std::left << std::setfill('.');
741      ss << std::setw(3) << 'X';
742      ss << std::setw(21) << absl::CivilHour(cs);
743      ss << std::setw(3) << 'X';
744      EXPECT_EQ("X..2016-02-03T04........X..", ss.str());
745    }
746    {
747      std::stringstream ss;
748      ss << std::left << std::setfill('.');
749      ss << std::setw(3) << 'X';
750      ss << std::setw(21) << absl::CivilMinute(cs);
751      ss << std::setw(3) << 'X';
752      EXPECT_EQ("X..2016-02-03T04:05.....X..", ss.str());
753    }
754    {
755      std::stringstream ss;
756      ss << std::left << std::setfill('.');
757      ss << std::setw(3) << 'X';
758      ss << std::setw(21) << absl::CivilSecond(cs);
759      ss << std::setw(3) << 'X';
760      EXPECT_EQ("X..2016-02-03T04:05:06..X..", ss.str());
761    }
762    {
763      std::stringstream ss;
764      ss << std::left << std::setfill('.');
765      ss << std::setw(3) << 'X';
766      ss << std::setw(21) << absl::Weekday::wednesday;
767      ss << std::setw(3) << 'X';
768      EXPECT_EQ("X..Wednesday............X..", ss.str());
769    }
770  }
771  TEST(CivilTime, Weekday) {
772    absl::CivilDay d(1970, 1, 1);
773    EXPECT_EQ(absl::Weekday::thursday, absl::GetWeekday(d)) << d;
774    d = absl::CivilDay(-31, 12, 24);
775    EXPECT_EQ(absl::Weekday::wednesday, absl::GetWeekday(d)) << d;
776  }
777  TEST(CivilTime, NextPrevWeekday) {
778    const absl::CivilDay thursday(1970, 1, 1);
779    absl::CivilDay d = absl::NextWeekday(thursday, absl::Weekday::thursday);
780    EXPECT_EQ(7, d - thursday) << d;
781    EXPECT_EQ(d - 14, absl::PrevWeekday(thursday, absl::Weekday::thursday));
782    d = absl::NextWeekday(thursday, absl::Weekday::friday);
783    EXPECT_EQ(1, d - thursday) << d;
784    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::friday));
785    d = absl::NextWeekday(thursday, absl::Weekday::saturday);
786    EXPECT_EQ(2, d - thursday) << d;
787    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::saturday));
788    d = absl::NextWeekday(thursday, absl::Weekday::sunday);
789    EXPECT_EQ(3, d - thursday) << d;
790    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::sunday));
791    d = absl::NextWeekday(thursday, absl::Weekday::monday);
792    EXPECT_EQ(4, d - thursday) << d;
793    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::monday));
794    d = absl::NextWeekday(thursday, absl::Weekday::tuesday);
795    EXPECT_EQ(5, d - thursday) << d;
796    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::tuesday));
797    d = absl::NextWeekday(thursday, absl::Weekday::wednesday);
798    EXPECT_EQ(6, d - thursday) << d;
799    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::wednesday));
800  }
801  TEST(CivilTime, DifferenceWithHugeYear) {
802    absl::CivilDay d1(9223372036854775807, 1, 1);
803    absl::CivilDay d2(9223372036854775807, 12, 31);
804    EXPECT_EQ(364, d2 - d1);
805    d1 = absl::CivilDay(-9223372036854775807 - 1, 1, 1);
806    d2 = absl::CivilDay(-9223372036854775807 - 1, 12, 31);
807    EXPECT_EQ(365, d2 - d1);
808    d1 = absl::CivilDay(9223372036854775807, 1, 1);
809    d2 = absl::CivilDay(9198119301927009252, 6, 6);
810    EXPECT_EQ(9223372036854775807, d1 - d2);
811    d2 = d2 - 1;
812    EXPECT_EQ(-9223372036854775807 - 1, d2 - d1);
813    d1 = absl::CivilDay(-9223372036854775807 - 1, 1, 1);
814    d2 = absl::CivilDay(-9198119301927009254, 7, 28);
815    EXPECT_EQ(9223372036854775807, d2 - d1);
816    d2 = d2 + 1;
817    EXPECT_EQ(-9223372036854775807 - 1, d1 - d2);
818    d1 = absl::CivilDay(-12626367463883278, 9, 3);
819    d2 = absl::CivilDay(12626367463883277, 3, 28);
820    EXPECT_EQ(9223372036854775807, d2 - d1);
821    d2 = d2 + 1;
822    EXPECT_EQ(-9223372036854775807 - 1, d1 - d2);
823  }
824  TEST(CivilTime, DifferenceNoIntermediateOverflow) {
825    absl::CivilSecond s1(-292277022657, 1, 27, 8, 29 - 1, 52);
826    absl::CivilSecond s2(1970, 1, 1, 0, 0 - 1, 0);
827    EXPECT_EQ(-9223372036854775807 - 1, s1 - s2);
828    s1 = absl::CivilSecond(292277026596, 12, 4, 15, 30, 7 - 7);
829    s2 = absl::CivilSecond(1970, 1, 1, 0, 0, 0 - 7);
830    EXPECT_EQ(9223372036854775807, s1 - s2);
831  }
832  TEST(CivilTime, NormalizeSimpleOverflow) {
833    absl::CivilSecond cs;
834    cs = absl::CivilSecond(2013, 11, 15, 16, 32, 59 + 1);
835    EXPECT_EQ("2013-11-15T16:33:00", absl::FormatCivilTime(cs));
836    cs = absl::CivilSecond(2013, 11, 15, 16, 59 + 1, 14);
837    EXPECT_EQ("2013-11-15T17:00:14", absl::FormatCivilTime(cs));
838    cs = absl::CivilSecond(2013, 11, 15, 23 + 1, 32, 14);
839    EXPECT_EQ("2013-11-16T00:32:14", absl::FormatCivilTime(cs));
840    cs = absl::CivilSecond(2013, 11, 30 + 1, 16, 32, 14);
841    EXPECT_EQ("2013-12-01T16:32:14", absl::FormatCivilTime(cs));
842    cs = absl::CivilSecond(2013, 12 + 1, 15, 16, 32, 14);
843    EXPECT_EQ("2014-01-15T16:32:14", absl::FormatCivilTime(cs));
844  }
845  TEST(CivilTime, NormalizeSimpleUnderflow) {
846    absl::CivilSecond cs;
847    cs = absl::CivilSecond(2013, 11, 15, 16, 32, 0 - 1);
848    EXPECT_EQ("2013-11-15T16:31:59", absl::FormatCivilTime(cs));
849    cs = absl::CivilSecond(2013, 11, 15, 16, 0 - 1, 14);
850    EXPECT_EQ("2013-11-15T15:59:14", absl::FormatCivilTime(cs));
851    cs = absl::CivilSecond(2013, 11, 15, 0 - 1, 32, 14);
852    EXPECT_EQ("2013-11-14T23:32:14", absl::FormatCivilTime(cs));
853    cs = absl::CivilSecond(2013, 11, 1 - 1, 16, 32, 14);
854    EXPECT_EQ("2013-10-31T16:32:14", absl::FormatCivilTime(cs));
855    cs = absl::CivilSecond(2013, 1 - 1, 15, 16, 32, 14);
856    EXPECT_EQ("2012-12-15T16:32:14", absl::FormatCivilTime(cs));
857  }
858  TEST(CivilTime, NormalizeMultipleOverflow) {
859    absl::CivilSecond cs(2013, 12, 31, 23, 59, 59 + 1);
860    EXPECT_EQ("2014-01-01T00:00:00", absl::FormatCivilTime(cs));
861  }
862  TEST(CivilTime, NormalizeMultipleUnderflow) {
863    absl::CivilSecond cs(2014, 1, 1, 0, 0, 0 - 1);
864    EXPECT_EQ("2013-12-31T23:59:59", absl::FormatCivilTime(cs));
865  }
866  TEST(CivilTime, NormalizeOverflowLimits) {
867    absl::CivilSecond cs;
868    const int kintmax = std::numeric_limits<int>::max();
869    cs = absl::CivilSecond(0, kintmax, kintmax, kintmax, kintmax, kintmax);
870    EXPECT_EQ("185085715-11-27T12:21:07", absl::FormatCivilTime(cs));
871    const int kintmin = std::numeric_limits<int>::min();
872    cs = absl::CivilSecond(0, kintmin, kintmin, kintmin, kintmin, kintmin);
873    EXPECT_EQ("-185085717-10-31T10:37:52", absl::FormatCivilTime(cs));
874  }
875  TEST(CivilTime, NormalizeComplexOverflow) {
876    absl::CivilSecond cs;
877    cs = absl::CivilSecond(2013, 11, 15, 16, 32, 14 + 123456789);
878    EXPECT_EQ("2017-10-14T14:05:23", absl::FormatCivilTime(cs));
879    cs = absl::CivilSecond(2013, 11, 15, 16, 32 + 1234567, 14);
880    EXPECT_EQ("2016-03-22T00:39:14", absl::FormatCivilTime(cs));
881    cs = absl::CivilSecond(2013, 11, 15, 16 + 123456, 32, 14);
882    EXPECT_EQ("2027-12-16T16:32:14", absl::FormatCivilTime(cs));
883    cs = absl::CivilSecond(2013, 11, 15 + 1234, 16, 32, 14);
884    EXPECT_EQ("2017-04-02T16:32:14", absl::FormatCivilTime(cs));
885    cs = absl::CivilSecond(2013, 11 + 123, 15, 16, 32, 14);
886    EXPECT_EQ("2024-02-15T16:32:14", absl::FormatCivilTime(cs));
887  }
888  TEST(CivilTime, NormalizeComplexUnderflow) {
889    absl::CivilSecond cs;
890    cs = absl::CivilSecond(1999, 3, 0, 0, 0, 0);  
891    EXPECT_EQ("1999-02-28T00:00:00", absl::FormatCivilTime(cs));
892    cs = absl::CivilSecond(2013, 11, 15, 16, 32, 14 - 123456789);
893    EXPECT_EQ("2009-12-17T18:59:05", absl::FormatCivilTime(cs));
894    cs = absl::CivilSecond(2013, 11, 15, 16, 32 - 1234567, 14);
895    EXPECT_EQ("2011-07-12T08:25:14", absl::FormatCivilTime(cs));
896    cs = absl::CivilSecond(2013, 11, 15, 16 - 123456, 32, 14);
897    EXPECT_EQ("1999-10-16T16:32:14", absl::FormatCivilTime(cs));
898    cs = absl::CivilSecond(2013, 11, 15 - 1234, 16, 32, 14);
899    EXPECT_EQ("2010-06-30T16:32:14", absl::FormatCivilTime(cs));
900    cs = absl::CivilSecond(2013, 11 - 123, 15, 16, 32, 14);
901    EXPECT_EQ("2003-08-15T16:32:14", absl::FormatCivilTime(cs));
902  }
903  TEST(CivilTime, NormalizeMishmash) {
904    absl::CivilSecond cs;
905    cs = absl::CivilSecond(2013, 11 - 123, 15 + 1234, 16 - 123456, 32 + 1234567,
906                           14 - 123456789);
907    EXPECT_EQ("1991-05-09T03:06:05", absl::FormatCivilTime(cs));
908    cs = absl::CivilSecond(2013, 11 + 123, 15 - 1234, 16 + 123456, 32 - 1234567,
909                           14 + 123456789);
910    EXPECT_EQ("2036-05-24T05:58:23", absl::FormatCivilTime(cs));
911    cs = absl::CivilSecond(2013, 11, -146097 + 1, 16, 32, 14);
912    EXPECT_EQ("1613-11-01T16:32:14", absl::FormatCivilTime(cs));
913    cs = absl::CivilSecond(2013, 11 + 400 * 12, -146097 + 1, 16, 32, 14);
914    EXPECT_EQ("2013-11-01T16:32:14", absl::FormatCivilTime(cs));
915  }
916  TEST(CivilTime, NormalizeAllTheDays) {
917    absl::CivilDay expected(1970, 1, 1);
918    for (int day = 1; day <= 146097; ++day) {
919      absl::CivilSecond cs(1970, 1, day, 0, 0, 0);
920      EXPECT_EQ(expected, cs);
921      ++expected;
922    }
923  }
924  TEST(CivilTime, NormalizeWithHugeYear) {
925    absl::CivilMonth c(9223372036854775807, 1);
926    EXPECT_EQ("9223372036854775807-01", absl::FormatCivilTime(c));
927    c = c - 1;  
928    EXPECT_EQ("9223372036854775806-12", absl::FormatCivilTime(c));
929    c = absl::CivilMonth(-9223372036854775807 - 1, 1);
930    EXPECT_EQ("-9223372036854775808-01", absl::FormatCivilTime(c));
931    c = c + 12;  
932    EXPECT_EQ("-9223372036854775807-01", absl::FormatCivilTime(c));
933  }
934  TEST(CivilTime, LeapYears) {
935    const absl::CivilSecond s1(2013, 2, 28 + 1, 0, 0, 0);
936    EXPECT_EQ("2013-03-01T00:00:00", absl::FormatCivilTime(s1));
937    const absl::CivilSecond s2(2012, 2, 28 + 1, 0, 0, 0);
938    EXPECT_EQ("2012-02-29T00:00:00", absl::FormatCivilTime(s2));
939    const absl::CivilSecond s3(1900, 2, 28 + 1, 0, 0, 0);
940    EXPECT_EQ("1900-03-01T00:00:00", absl::FormatCivilTime(s3));
941    const struct {
942      int year;
943      int days;
944      struct {
945        int month;
946        int day;
947      } leap_day;  
948    } kLeapYearTable[]{
949        {1900, 365, {3, 1}},
950        {1999, 365, {3, 1}},
951        {2000, 366, {2, 29}},  
952        {2001, 365, {3, 1}},
953        {2002, 365, {3, 1}},
954        {2003, 365, {3, 1}},
955        {2004, 366, {2, 29}},  
956        {2005, 365, {3, 1}},
957        {2006, 365, {3, 1}},
958        {2007, 365, {3, 1}},
959        {2008, 366, {2, 29}},  
960        {2009, 365, {3, 1}},
961        {2100, 365, {3, 1}},
962    };
963    for (int i = 0; i < ABSL_ARRAYSIZE(kLeapYearTable); ++i) {
964      const int y = kLeapYearTable[i].year;
965      const int m = kLeapYearTable[i].leap_day.month;
966      const int d = kLeapYearTable[i].leap_day.day;
967      const int n = kLeapYearTable[i].days;
968      const absl::CivilDay feb28(y, 2, 28);
969      const absl::CivilDay next_day = feb28 + 1;
970      EXPECT_EQ(m, next_day.month());
971      EXPECT_EQ(d, next_day.day());
972      const absl::CivilYear year(feb28);
973      const absl::CivilYear next_year = year + 1;
974      EXPECT_EQ(n, absl::CivilDay(next_year) - absl::CivilDay(year));
975    }
976  }
977  TEST(CivilTime, FirstThursdayInMonth) {
978    const absl::CivilDay nov1(2014, 11, 1);
979    const absl::CivilDay thursday =
980        absl::NextWeekday(nov1 - 1, absl::Weekday::thursday);
981    EXPECT_EQ("2014-11-06", absl::FormatCivilTime(thursday));
982    const absl::CivilDay thanksgiving = thursday +  7 * 3;
983    EXPECT_EQ("2014-11-27", absl::FormatCivilTime(thanksgiving));
984  }
985  TEST(CivilTime, DocumentationExample) {
986    absl::CivilSecond second(2015, 6, 28, 1, 2, 3);  
987    absl::CivilMinute minute(second);                
988    absl::CivilDay day(minute);                      
989    second -= 1;                    
990    --second;                       
991    EXPECT_EQ(minute, second - 1);  
992    EXPECT_LT(minute, second);
993    absl::CivilDay june_1(2015, 6, 1);  
994    int diff = day - june_1;            
995    EXPECT_EQ(27, diff);
996    absl::CivilDay day_floor(2015, 1, 2, 9, 9, 9);
997    EXPECT_EQ(0, day_floor.hour());  
998    EXPECT_EQ(absl::CivilDay(2015, 1, 2), day_floor);
999    absl::CivilDay day_default(2015);  
1000    EXPECT_EQ(absl::CivilDay(2015, 1, 1), day_default);
1001    absl::CivilMonth june(day);  
1002    absl::CivilMonth july = june + 1;
1003    for (absl::CivilDay day = june_1; day < july; ++day) {
1004    }
1005  }
1006  }  
</code></pre>
        </div>
        <div class="column">
            <h3>abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-civil_time_test.cc</h3>
            <pre><code>1  #include "absl/time/civil_time.h"
2  #include <limits>
3  #include <sstream>
4  #include <type_traits>
5  #include "absl/base/macros.h"
6  #include "gtest/gtest.h"
7  namespace {
8  TEST(CivilTime, DefaultConstruction) {
9    absl::CivilSecond ss;
10    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(ss));
11    absl::CivilMinute mm;
12    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(mm));
13    absl::CivilHour hh;
14    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hh));
15    absl::CivilDay d;
16    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(d));
17    absl::CivilMonth m;
18    EXPECT_EQ("1970-01", absl::FormatCivilTime(m));
19    absl::CivilYear y;
20    EXPECT_EQ("1970", absl::FormatCivilTime(y));
21  }
22  TEST(CivilTime, StructMember) {
23    struct S {
24      absl::CivilDay day;
25    };
26    S s = {};
27    EXPECT_EQ(absl::CivilDay{}, s.day);
28  }
29  TEST(CivilTime, FieldsConstruction) {
30    EXPECT_EQ("2015-01-02T03:04:05",
31              absl::FormatCivilTime(absl::CivilSecond(2015, 1, 2, 3, 4, 5)));
32    EXPECT_EQ("2015-01-02T03:04:00",
33              absl::FormatCivilTime(absl::CivilSecond(2015, 1, 2, 3, 4)));
34    EXPECT_EQ("2015-01-02T03:00:00",
35              absl::FormatCivilTime(absl::CivilSecond(2015, 1, 2, 3)));
36    EXPECT_EQ("2015-01-02T00:00:00",
37              absl::FormatCivilTime(absl::CivilSecond(2015, 1, 2)));
38    EXPECT_EQ("2015-01-01T00:00:00",
39              absl::FormatCivilTime(absl::CivilSecond(2015, 1)));
40    EXPECT_EQ("2015-01-01T00:00:00",
41              absl::FormatCivilTime(absl::CivilSecond(2015)));
42    EXPECT_EQ("2015-01-02T03:04",
43              absl::FormatCivilTime(absl::CivilMinute(2015, 1, 2, 3, 4, 5)));
44    EXPECT_EQ("2015-01-02T03:04",
45              absl::FormatCivilTime(absl::CivilMinute(2015, 1, 2, 3, 4)));
46    EXPECT_EQ("2015-01-02T03:00",
47              absl::FormatCivilTime(absl::CivilMinute(2015, 1, 2, 3)));
48    EXPECT_EQ("2015-01-02T00:00",
49              absl::FormatCivilTime(absl::CivilMinute(2015, 1, 2)));
50    EXPECT_EQ("2015-01-01T00:00",
51              absl::FormatCivilTime(absl::CivilMinute(2015, 1)));
52    EXPECT_EQ("2015-01-01T00:00",
53              absl::FormatCivilTime(absl::CivilMinute(2015)));
54    EXPECT_EQ("2015-01-02T03",
55              absl::FormatCivilTime(absl::CivilHour(2015, 1, 2, 3, 4, 5)));
56    EXPECT_EQ("2015-01-02T03",
57              absl::FormatCivilTime(absl::CivilHour(2015, 1, 2, 3, 4)));
58    EXPECT_EQ("2015-01-02T03",
59              absl::FormatCivilTime(absl::CivilHour(2015, 1, 2, 3)));
60    EXPECT_EQ("2015-01-02T00",
61              absl::FormatCivilTime(absl::CivilHour(2015, 1, 2)));
62    EXPECT_EQ("2015-01-01T00",
63              absl::FormatCivilTime(absl::CivilHour(2015, 1)));
64    EXPECT_EQ("2015-01-01T00",
65              absl::FormatCivilTime(absl::CivilHour(2015)));
66    EXPECT_EQ("2015-01-02",
67              absl::FormatCivilTime(absl::CivilDay(2015, 1, 2, 3, 4, 5)));
68    EXPECT_EQ("2015-01-02",
69              absl::FormatCivilTime(absl::CivilDay(2015, 1, 2, 3, 4)));
70    EXPECT_EQ("2015-01-02",
71              absl::FormatCivilTime(absl::CivilDay(2015, 1, 2, 3)));
72    EXPECT_EQ("2015-01-02",
73              absl::FormatCivilTime(absl::CivilDay(2015, 1, 2)));
74    EXPECT_EQ("2015-01-01",
75              absl::FormatCivilTime(absl::CivilDay(2015, 1)));
76    EXPECT_EQ("2015-01-01",
77              absl::FormatCivilTime(absl::CivilDay(2015)));
78    EXPECT_EQ("2015-01",
79              absl::FormatCivilTime(absl::CivilMonth(2015, 1, 2, 3, 4, 5)));
80    EXPECT_EQ("2015-01",
81              absl::FormatCivilTime(absl::CivilMonth(2015, 1, 2, 3, 4)));
82    EXPECT_EQ("2015-01",
83              absl::FormatCivilTime(absl::CivilMonth(2015, 1, 2, 3)));
84    EXPECT_EQ("2015-01",
85              absl::FormatCivilTime(absl::CivilMonth(2015, 1, 2)));
86    EXPECT_EQ("2015-01",
87              absl::FormatCivilTime(absl::CivilMonth(2015, 1)));
88    EXPECT_EQ("2015-01",
89              absl::FormatCivilTime(absl::CivilMonth(2015)));
90    EXPECT_EQ("2015",
91              absl::FormatCivilTime(absl::CivilYear(2015, 1, 2, 3, 4, 5)));
92    EXPECT_EQ("2015",
93              absl::FormatCivilTime(absl::CivilYear(2015, 1, 2, 3, 4)));
94    EXPECT_EQ("2015",
95              absl::FormatCivilTime(absl::CivilYear(2015, 1, 2, 3)));
96    EXPECT_EQ("2015",
97              absl::FormatCivilTime(absl::CivilYear(2015, 1, 2)));
98    EXPECT_EQ("2015",
99              absl::FormatCivilTime(absl::CivilYear(2015, 1)));
100    EXPECT_EQ("2015",
101              absl::FormatCivilTime(absl::CivilYear(2015)));
102  }
103  TEST(CivilTime, FieldsConstructionLimits) {
104    const int kIntMax = std::numeric_limits<int>::max();
105    EXPECT_EQ("2038-01-19T03:14:07",
106              absl::FormatCivilTime(absl::CivilSecond(
107                  1970, 1, 1, 0, 0, kIntMax)));
108    EXPECT_EQ("6121-02-11T05:21:07",
109              absl::FormatCivilTime(absl::CivilSecond(
110                  1970, 1, 1, 0, kIntMax, kIntMax)));
111    EXPECT_EQ("251104-11-20T12:21:07",
112              absl::FormatCivilTime(absl::CivilSecond(
113                  1970, 1, 1, kIntMax, kIntMax, kIntMax)));
114    EXPECT_EQ("6130715-05-30T12:21:07",
115              absl::FormatCivilTime(absl::CivilSecond(
116                  1970, 1, kIntMax, kIntMax, kIntMax, kIntMax)));
117    EXPECT_EQ("185087685-11-26T12:21:07",
118              absl::FormatCivilTime(absl::CivilSecond(
119                  1970, kIntMax, kIntMax, kIntMax, kIntMax, kIntMax)));
120    const int kIntMin = std::numeric_limits<int>::min();
121    EXPECT_EQ("1901-12-13T20:45:52",
122              absl::FormatCivilTime(absl::CivilSecond(
123                  1970, 1, 1, 0, 0, kIntMin)));
124    EXPECT_EQ("-2182-11-20T18:37:52",
125              absl::FormatCivilTime(absl::CivilSecond(
126                  1970, 1, 1, 0, kIntMin, kIntMin)));
127    EXPECT_EQ("-247165-02-11T10:37:52",
128              absl::FormatCivilTime(absl::CivilSecond(
129                  1970, 1, 1, kIntMin, kIntMin, kIntMin)));
130    EXPECT_EQ("-6126776-08-01T10:37:52",
131              absl::FormatCivilTime(absl::CivilSecond(
132                  1970, 1, kIntMin, kIntMin, kIntMin, kIntMin)));
133    EXPECT_EQ("-185083747-10-31T10:37:52",
134              absl::FormatCivilTime(absl::CivilSecond(
135                  1970, kIntMin, kIntMin, kIntMin, kIntMin, kIntMin)));
136  }
137  TEST(CivilTime, RangeLimits) {
138    const absl::civil_year_t kYearMax =
139        std::numeric_limits<absl::civil_year_t>::max();
140    EXPECT_EQ(absl::CivilYear(kYearMax),
141              absl::CivilYear::max());
142    EXPECT_EQ(absl::CivilMonth(kYearMax, 12),
143              absl::CivilMonth::max());
144    EXPECT_EQ(absl::CivilDay(kYearMax, 12, 31),
145              absl::CivilDay::max());
146    EXPECT_EQ(absl::CivilHour(kYearMax, 12, 31, 23),
147              absl::CivilHour::max());
148    EXPECT_EQ(absl::CivilMinute(kYearMax, 12, 31, 23, 59),
149              absl::CivilMinute::max());
150    EXPECT_EQ(absl::CivilSecond(kYearMax, 12, 31, 23, 59, 59),
151              absl::CivilSecond::max());
152    const absl::civil_year_t kYearMin =
153        std::numeric_limits<absl::civil_year_t>::min();
154    EXPECT_EQ(absl::CivilYear(kYearMin),
155              absl::CivilYear::min());
156    EXPECT_EQ(absl::CivilMonth(kYearMin, 1),
157              absl::CivilMonth::min());
158    EXPECT_EQ(absl::CivilDay(kYearMin, 1, 1),
159              absl::CivilDay::min());
160    EXPECT_EQ(absl::CivilHour(kYearMin, 1, 1, 0),
161              absl::CivilHour::min());
162    EXPECT_EQ(absl::CivilMinute(kYearMin, 1, 1, 0, 0),
163              absl::CivilMinute::min());
164    EXPECT_EQ(absl::CivilSecond(kYearMin, 1, 1, 0, 0, 0),
165              absl::CivilSecond::min());
166  }
167  TEST(CivilTime, ImplicitCrossAlignment) {
168    absl::CivilYear year(2015);
169    absl::CivilMonth month = year;
170    absl::CivilDay day = month;
171    absl::CivilHour hour = day;
172    absl::CivilMinute minute = hour;
173    absl::CivilSecond second = minute;
174    second = year;
175    EXPECT_EQ(second, year);
176    second = month;
177    EXPECT_EQ(second, month);
178    second = day;
179    EXPECT_EQ(second, day);
180    second = hour;
181    EXPECT_EQ(second, hour);
182    second = minute;
183    EXPECT_EQ(second, minute);
184    minute = year;
185    EXPECT_EQ(minute, year);
186    minute = month;
187    EXPECT_EQ(minute, month);
188    minute = day;
189    EXPECT_EQ(minute, day);
190    minute = hour;
191    EXPECT_EQ(minute, hour);
192    hour = year;
193    EXPECT_EQ(hour, year);
194    hour = month;
195    EXPECT_EQ(hour, month);
196    hour = day;
197    EXPECT_EQ(hour, day);
198    day = year;
199    EXPECT_EQ(day, year);
200    day = month;
201    EXPECT_EQ(day, month);
202    month = year;
203    EXPECT_EQ(month, year);
204    EXPECT_FALSE(
205        (std::is_convertible<absl::CivilSecond, absl::CivilMinute>::value));
206    EXPECT_FALSE(
207        (std::is_convertible<absl::CivilSecond, absl::CivilHour>::value));
208    EXPECT_FALSE(
209        (std::is_convertible<absl::CivilSecond, absl::CivilDay>::value));
210    EXPECT_FALSE(
211        (std::is_convertible<absl::CivilSecond, absl::CivilMonth>::value));
212    EXPECT_FALSE(
213        (std::is_convertible<absl::CivilSecond, absl::CivilYear>::value));
214    EXPECT_FALSE(
215        (std::is_convertible<absl::CivilMinute, absl::CivilHour>::value));
216    EXPECT_FALSE(
217        (std::is_convertible<absl::CivilMinute, absl::CivilDay>::value));
218    EXPECT_FALSE(
219        (std::is_convertible<absl::CivilMinute, absl::CivilMonth>::value));
220    EXPECT_FALSE(
221        (std::is_convertible<absl::CivilMinute, absl::CivilYear>::value));
222    EXPECT_FALSE(
223        (std::is_convertible<absl::CivilHour, absl::CivilDay>::value));
224    EXPECT_FALSE(
225        (std::is_convertible<absl::CivilHour, absl::CivilMonth>::value));
226    EXPECT_FALSE(
227        (std::is_convertible<absl::CivilHour, absl::CivilYear>::value));
228    EXPECT_FALSE(
229        (std::is_convertible<absl::CivilDay, absl::CivilMonth>::value));
230    EXPECT_FALSE(
231        (std::is_convertible<absl::CivilDay, absl::CivilYear>::value));
232    EXPECT_FALSE(
233        (std::is_convertible<absl::CivilMonth, absl::CivilYear>::value));
234  }
235  TEST(CivilTime, ExplicitCrossAlignment) {
236    absl::CivilSecond second(2015, 1, 2, 3, 4, 5);
237    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(second));
238    absl::CivilMinute minute(second);
239    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(minute));
240    absl::CivilHour hour(minute);
241    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour));
242    absl::CivilDay day(hour);
243    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day));
244    absl::CivilMonth month(day);
245    EXPECT_EQ("2015-01", absl::FormatCivilTime(month));
246    absl::CivilYear year(month);
247    EXPECT_EQ("2015", absl::FormatCivilTime(year));
248    month = absl::CivilMonth(year);
249    EXPECT_EQ("2015-01", absl::FormatCivilTime(month));
250    day = absl::CivilDay(month);
251    EXPECT_EQ("2015-01-01", absl::FormatCivilTime(day));
252    hour = absl::CivilHour(day);
253    EXPECT_EQ("2015-01-01T00", absl::FormatCivilTime(hour));
254    minute = absl::CivilMinute(hour);
255    EXPECT_EQ("2015-01-01T00:00", absl::FormatCivilTime(minute));
256    second = absl::CivilSecond(minute);
257    EXPECT_EQ("2015-01-01T00:00:00", absl::FormatCivilTime(second));
258  }
259  template <typename T1, typename T2>
260  struct HasDiff {
261    template <typename U1, typename U2>
262    static std::false_type test(...);
263    template <typename U1, typename U2>
264    static std::true_type test(decltype(std::declval<U1>() - std::declval<U2>()));
265    static constexpr bool value = decltype(test<T1, T2>(0))::value;
266  };
267  TEST(CivilTime, DisallowCrossAlignedDifference) {
268    static_assert(HasDiff<absl::CivilSecond, absl::CivilSecond>::value, "");
269    static_assert(HasDiff<absl::CivilMinute, absl::CivilMinute>::value, "");
270    static_assert(HasDiff<absl::CivilHour, absl::CivilHour>::value, "");
271    static_assert(HasDiff<absl::CivilDay, absl::CivilDay>::value, "");
272    static_assert(HasDiff<absl::CivilMonth, absl::CivilMonth>::value, "");
273    static_assert(HasDiff<absl::CivilYear, absl::CivilYear>::value, "");
274    static_assert(!HasDiff<absl::CivilSecond, absl::CivilMinute>::value, "");
275    static_assert(!HasDiff<absl::CivilSecond, absl::CivilHour>::value, "");
276    static_assert(!HasDiff<absl::CivilSecond, absl::CivilDay>::value, "");
277    static_assert(!HasDiff<absl::CivilSecond, absl::CivilMonth>::value, "");
278    static_assert(!HasDiff<absl::CivilSecond, absl::CivilYear>::value, "");
279    static_assert(!HasDiff<absl::CivilMinute, absl::CivilHour>::value, "");
280    static_assert(!HasDiff<absl::CivilMinute, absl::CivilDay>::value, "");
281    static_assert(!HasDiff<absl::CivilMinute, absl::CivilMonth>::value, "");
282    static_assert(!HasDiff<absl::CivilMinute, absl::CivilYear>::value, "");
283    static_assert(!HasDiff<absl::CivilHour, absl::CivilDay>::value, "");
284    static_assert(!HasDiff<absl::CivilHour, absl::CivilMonth>::value, "");
285    static_assert(!HasDiff<absl::CivilHour, absl::CivilYear>::value, "");
286    static_assert(!HasDiff<absl::CivilDay, absl::CivilMonth>::value, "");
287    static_assert(!HasDiff<absl::CivilDay, absl::CivilYear>::value, "");
288    static_assert(!HasDiff<absl::CivilMonth, absl::CivilYear>::value, "");
289  }
290  TEST(CivilTime, ValueSemantics) {
291    const absl::CivilHour a(2015, 1, 2, 3);
292    const absl::CivilHour b = a;
293    const absl::CivilHour c(b);
294    absl::CivilHour d;
295    d = c;
296    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(d));
297  }
298  TEST(CivilTime, Relational) {
299    const absl::CivilYear year(2014);
300    const absl::CivilMonth month(year);
301    EXPECT_EQ(year, month);
302  #define TEST_RELATIONAL(OLDER, YOUNGER) \
303    do {                                  \
304      EXPECT_FALSE(OLDER < OLDER);        \
305      EXPECT_FALSE(OLDER > OLDER);        \
306      EXPECT_TRUE(OLDER >= OLDER);        \
307      EXPECT_TRUE(OLDER <= OLDER);        \
308      EXPECT_FALSE(YOUNGER < YOUNGER);    \
309      EXPECT_FALSE(YOUNGER > YOUNGER);    \
310      EXPECT_TRUE(YOUNGER >= YOUNGER);    \
311      EXPECT_TRUE(YOUNGER <= YOUNGER);    \
312      EXPECT_EQ(OLDER, OLDER);            \
313      EXPECT_NE(OLDER, YOUNGER);          \
314      EXPECT_LT(OLDER, YOUNGER);          \
315      EXPECT_LE(OLDER, YOUNGER);          \
316      EXPECT_GT(YOUNGER, OLDER);          \
317      EXPECT_GE(YOUNGER, OLDER);          \
318    } while (0)
319    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 0, 0, 0),
320                    absl::CivilSecond(2015, 1, 1, 0, 0, 0));
321    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 0, 0, 0),
322                    absl::CivilSecond(2014, 2, 1, 0, 0, 0));
323    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 0, 0, 0),
324                    absl::CivilSecond(2014, 1, 2, 0, 0, 0));
325    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 0, 0, 0),
326                    absl::CivilSecond(2014, 1, 1, 1, 0, 0));
327    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 1, 0, 0),
328                    absl::CivilSecond(2014, 1, 1, 1, 1, 0));
329    TEST_RELATIONAL(absl::CivilSecond(2014, 1, 1, 1, 1, 0),
330                    absl::CivilSecond(2014, 1, 1, 1, 1, 1));
331    TEST_RELATIONAL(absl::CivilDay(2014, 1, 1),
332                    absl::CivilMinute(2014, 1, 1, 1, 1));
333    TEST_RELATIONAL(absl::CivilDay(2014, 1, 1),
334                    absl::CivilMonth(2014, 2));
335  #undef TEST_RELATIONAL
336  }
337  TEST(CivilTime, Arithmetic) {
338    absl::CivilSecond second(2015, 1, 2, 3, 4, 5);
339    EXPECT_EQ("2015-01-02T03:04:06", absl::FormatCivilTime(second += 1));
340    EXPECT_EQ("2015-01-02T03:04:07", absl::FormatCivilTime(second + 1));
341    EXPECT_EQ("2015-01-02T03:04:08", absl::FormatCivilTime(2 + second));
342    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(second - 1));
343    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(second -= 1));
344    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(second++));
345    EXPECT_EQ("2015-01-02T03:04:07", absl::FormatCivilTime(++second));
346    EXPECT_EQ("2015-01-02T03:04:07", absl::FormatCivilTime(second--));
347    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(--second));
348    absl::CivilMinute minute(2015, 1, 2, 3, 4);
349    EXPECT_EQ("2015-01-02T03:05", absl::FormatCivilTime(minute += 1));
350    EXPECT_EQ("2015-01-02T03:06", absl::FormatCivilTime(minute + 1));
351    EXPECT_EQ("2015-01-02T03:07", absl::FormatCivilTime(2 + minute));
352    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(minute - 1));
353    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(minute -= 1));
354    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(minute++));
355    EXPECT_EQ("2015-01-02T03:06", absl::FormatCivilTime(++minute));
356    EXPECT_EQ("2015-01-02T03:06", absl::FormatCivilTime(minute--));
357    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(--minute));
358    absl::CivilHour hour(2015, 1, 2, 3);
359    EXPECT_EQ("2015-01-02T04", absl::FormatCivilTime(hour += 1));
360    EXPECT_EQ("2015-01-02T05", absl::FormatCivilTime(hour + 1));
361    EXPECT_EQ("2015-01-02T06", absl::FormatCivilTime(2 + hour));
<span onclick='openModal()' class='match'>362    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour - 1));
363    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour -= 1));
364    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour++));
365    EXPECT_EQ("2015-01-02T05", absl::FormatCivilTime(++hour));
366    EXPECT_EQ("2015-01-02T05", absl::FormatCivilTime(hour--));
367    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(--hour));
368    absl::CivilDay day(2015, 1, 2);
</span>369    EXPECT_EQ("2015-01-03", absl::FormatCivilTime(day += 1));
370    EXPECT_EQ("2015-01-04", absl::FormatCivilTime(day + 1));
371    EXPECT_EQ("2015-01-05", absl::FormatCivilTime(2 + day));
372    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day - 1));
373    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day -= 1));
374    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day++));
375    EXPECT_EQ("2015-01-04", absl::FormatCivilTime(++day));
376    EXPECT_EQ("2015-01-04", absl::FormatCivilTime(day--));
377    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(--day));
378    absl::CivilMonth month(2015, 1);
379    EXPECT_EQ("2015-02", absl::FormatCivilTime(month += 1));
380    EXPECT_EQ("2015-03", absl::FormatCivilTime(month + 1));
381    EXPECT_EQ("2015-04", absl::FormatCivilTime(2 + month));
382    EXPECT_EQ("2015-01", absl::FormatCivilTime(month - 1));
383    EXPECT_EQ("2015-01", absl::FormatCivilTime(month -= 1));
384    EXPECT_EQ("2015-01", absl::FormatCivilTime(month++));
385    EXPECT_EQ("2015-03", absl::FormatCivilTime(++month));
386    EXPECT_EQ("2015-03", absl::FormatCivilTime(month--));
387    EXPECT_EQ("2015-01", absl::FormatCivilTime(--month));
388    absl::CivilYear year(2015);
389    EXPECT_EQ("2016", absl::FormatCivilTime(year += 1));
390    EXPECT_EQ("2017", absl::FormatCivilTime(year + 1));
391    EXPECT_EQ("2018", absl::FormatCivilTime(2 + year));
392    EXPECT_EQ("2015", absl::FormatCivilTime(year - 1));
393    EXPECT_EQ("2015", absl::FormatCivilTime(year -= 1));
394    EXPECT_EQ("2015", absl::FormatCivilTime(year++));
395    EXPECT_EQ("2017", absl::FormatCivilTime(++year));
396    EXPECT_EQ("2017", absl::FormatCivilTime(year--));
397    EXPECT_EQ("2015", absl::FormatCivilTime(--year));
398  }
399  TEST(CivilTime, ArithmeticLimits) {
400    const int kIntMax = std::numeric_limits<int>::max();
401    const int kIntMin = std::numeric_limits<int>::min();
402    absl::CivilSecond second(1970, 1, 1, 0, 0, 0);
403    second += kIntMax;
404    EXPECT_EQ("2038-01-19T03:14:07", absl::FormatCivilTime(second));
405    second -= kIntMax;
406    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(second));
407    second += kIntMin;
408    EXPECT_EQ("1901-12-13T20:45:52", absl::FormatCivilTime(second));
409    second -= kIntMin;
410    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(second));
411    absl::CivilMinute minute(1970, 1, 1, 0, 0);
412    minute += kIntMax;
413    EXPECT_EQ("6053-01-23T02:07", absl::FormatCivilTime(minute));
414    minute -= kIntMax;
415    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(minute));
416    minute += kIntMin;
417    EXPECT_EQ("-2114-12-08T21:52", absl::FormatCivilTime(minute));
418    minute -= kIntMin;
419    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(minute));
420    absl::CivilHour hour(1970, 1, 1, 0);
421    hour += kIntMax;
422    EXPECT_EQ("246953-10-09T07", absl::FormatCivilTime(hour));
423    hour -= kIntMax;
424    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hour));
425    hour += kIntMin;
426    EXPECT_EQ("-243014-03-24T16", absl::FormatCivilTime(hour));
427    hour -= kIntMin;
428    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hour));
429    absl::CivilDay day(1970, 1, 1);
430    day += kIntMax;
431    EXPECT_EQ("5881580-07-11", absl::FormatCivilTime(day));
432    day -= kIntMax;
433    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(day));
434    day += kIntMin;
435    EXPECT_EQ("-5877641-06-23", absl::FormatCivilTime(day));
436    day -= kIntMin;
437    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(day));
438    absl::CivilMonth month(1970, 1);
439    month += kIntMax;
440    EXPECT_EQ("178958940-08", absl::FormatCivilTime(month));
441    month -= kIntMax;
442    EXPECT_EQ("1970-01", absl::FormatCivilTime(month));
443    month += kIntMin;
444    EXPECT_EQ("-178955001-05", absl::FormatCivilTime(month));
445    month -= kIntMin;
446    EXPECT_EQ("1970-01", absl::FormatCivilTime(month));
447    absl::CivilYear year(0);
448    year += kIntMax;
449    EXPECT_EQ("2147483647", absl::FormatCivilTime(year));
450    year -= kIntMax;
451    EXPECT_EQ("0", absl::FormatCivilTime(year));
452    year += kIntMin;
453    EXPECT_EQ("-2147483648", absl::FormatCivilTime(year));
454    year -= kIntMin;
455    EXPECT_EQ("0", absl::FormatCivilTime(year));
456  }
457  TEST(CivilTime, Difference) {
458    absl::CivilSecond second(2015, 1, 2, 3, 4, 5);
459    EXPECT_EQ(0, second - second);
460    EXPECT_EQ(10, (second + 10) - second);
461    EXPECT_EQ(-10, (second - 10) - second);
462    absl::CivilMinute minute(2015, 1, 2, 3, 4);
463    EXPECT_EQ(0, minute - minute);
464    EXPECT_EQ(10, (minute + 10) - minute);
465    EXPECT_EQ(-10, (minute - 10) - minute);
466    absl::CivilHour hour(2015, 1, 2, 3);
467    EXPECT_EQ(0, hour - hour);
468    EXPECT_EQ(10, (hour + 10) - hour);
469    EXPECT_EQ(-10, (hour - 10) - hour);
470    absl::CivilDay day(2015, 1, 2);
471    EXPECT_EQ(0, day - day);
472    EXPECT_EQ(10, (day + 10) - day);
473    EXPECT_EQ(-10, (day - 10) - day);
474    absl::CivilMonth month(2015, 1);
475    EXPECT_EQ(0, month - month);
476    EXPECT_EQ(10, (month + 10) - month);
477    EXPECT_EQ(-10, (month - 10) - month);
478    absl::CivilYear year(2015);
479    EXPECT_EQ(0, year - year);
480    EXPECT_EQ(10, (year + 10) - year);
481    EXPECT_EQ(-10, (year - 10) - year);
482  }
483  TEST(CivilTime, DifferenceLimits) {
484    const absl::civil_diff_t kDiffMax =
485        std::numeric_limits<absl::civil_diff_t>::max();
486    const absl::civil_diff_t kDiffMin =
487        std::numeric_limits<absl::civil_diff_t>::min();
488    const absl::CivilDay max_day(kDiffMax, 12, 31);
489    EXPECT_EQ(1, max_day - (max_day - 1));
490    EXPECT_EQ(-1, (max_day - 1) - max_day);
491    const absl::CivilDay min_day(kDiffMin, 1, 1);
492    EXPECT_EQ(1, (min_day + 1) - min_day);
493    EXPECT_EQ(-1, min_day - (min_day + 1));
494    const absl::CivilDay d1(1970, 1, 1);
495    const absl::CivilDay d2(25252734927768524, 7, 27);
496    EXPECT_EQ(kDiffMax, d2 - d1);
497    EXPECT_EQ(kDiffMin, d1 - (d2 + 1));
498  }
499  TEST(CivilTime, Properties) {
500    absl::CivilSecond ss(2015, 2, 3, 4, 5, 6);
501    EXPECT_EQ(2015, ss.year());
502    EXPECT_EQ(2, ss.month());
503    EXPECT_EQ(3, ss.day());
504    EXPECT_EQ(4, ss.hour());
505    EXPECT_EQ(5, ss.minute());
506    EXPECT_EQ(6, ss.second());
507    EXPECT_EQ(absl::Weekday::tuesday, absl::GetWeekday(ss));
508    EXPECT_EQ(34, absl::GetYearDay(ss));
509    absl::CivilMinute mm(2015, 2, 3, 4, 5, 6);
510    EXPECT_EQ(2015, mm.year());
511    EXPECT_EQ(2, mm.month());
512    EXPECT_EQ(3, mm.day());
513    EXPECT_EQ(4, mm.hour());
514    EXPECT_EQ(5, mm.minute());
515    EXPECT_EQ(0, mm.second());
516    EXPECT_EQ(absl::Weekday::tuesday, absl::GetWeekday(mm));
517    EXPECT_EQ(34, absl::GetYearDay(mm));
518    absl::CivilHour hh(2015, 2, 3, 4, 5, 6);
519    EXPECT_EQ(2015, hh.year());
520    EXPECT_EQ(2, hh.month());
521    EXPECT_EQ(3, hh.day());
522    EXPECT_EQ(4, hh.hour());
523    EXPECT_EQ(0, hh.minute());
524    EXPECT_EQ(0, hh.second());
525    EXPECT_EQ(absl::Weekday::tuesday, absl::GetWeekday(hh));
526    EXPECT_EQ(34, absl::GetYearDay(hh));
527    absl::CivilDay d(2015, 2, 3, 4, 5, 6);
528    EXPECT_EQ(2015, d.year());
529    EXPECT_EQ(2, d.month());
530    EXPECT_EQ(3, d.day());
531    EXPECT_EQ(0, d.hour());
532    EXPECT_EQ(0, d.minute());
533    EXPECT_EQ(0, d.second());
534    EXPECT_EQ(absl::Weekday::tuesday, absl::GetWeekday(d));
535    EXPECT_EQ(34, absl::GetYearDay(d));
536    absl::CivilMonth m(2015, 2, 3, 4, 5, 6);
537    EXPECT_EQ(2015, m.year());
538    EXPECT_EQ(2, m.month());
539    EXPECT_EQ(1, m.day());
540    EXPECT_EQ(0, m.hour());
541    EXPECT_EQ(0, m.minute());
542    EXPECT_EQ(0, m.second());
543    EXPECT_EQ(absl::Weekday::sunday, absl::GetWeekday(m));
544    EXPECT_EQ(32, absl::GetYearDay(m));
545    absl::CivilYear y(2015, 2, 3, 4, 5, 6);
546    EXPECT_EQ(2015, y.year());
547    EXPECT_EQ(1, y.month());
548    EXPECT_EQ(1, y.day());
549    EXPECT_EQ(0, y.hour());
550    EXPECT_EQ(0, y.minute());
551    EXPECT_EQ(0, y.second());
552    EXPECT_EQ(absl::Weekday::thursday, absl::GetWeekday(y));
553    EXPECT_EQ(1, absl::GetYearDay(y));
554  }
555  TEST(CivilTime, Format) {
556    absl::CivilSecond ss;
557    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(ss));
558    absl::CivilMinute mm;
559    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(mm));
560    absl::CivilHour hh;
561    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hh));
562    absl::CivilDay d;
563    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(d));
564    absl::CivilMonth m;
565    EXPECT_EQ("1970-01", absl::FormatCivilTime(m));
566    absl::CivilYear y;
567    EXPECT_EQ("1970", absl::FormatCivilTime(y));
568  }
569  TEST(CivilTime, Parse) {
570    absl::CivilSecond ss;
571    absl::CivilMinute mm;
572    absl::CivilHour hh;
573    absl::CivilDay d;
574    absl::CivilMonth m;
575    absl::CivilYear y;
576    EXPECT_TRUE(absl::ParseCivilTime("2015-01-02T03:04:05", &ss));
577    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(ss));
578    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &mm));
579    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &hh));
580    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &d));
581    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &m));
582    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04:05", &y));
583    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &ss));
584    EXPECT_TRUE(absl::ParseCivilTime("2015-01-02T03:04", &mm));
585    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(mm));
586    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &hh));
587    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &d));
588    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &m));
589    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03:04", &y));
590    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &ss));
591    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &mm));
592    EXPECT_TRUE(absl::ParseCivilTime("2015-01-02T03", &hh));
593    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hh));
594    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &d));
595    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &m));
596    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02T03", &y));
597    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &ss));
598    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &mm));
599    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &hh));
600    EXPECT_TRUE(absl::ParseCivilTime("2015-01-02", &d));
601    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(d));
602    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &m));
603    EXPECT_FALSE(absl::ParseCivilTime("2015-01-02", &y));
604    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &ss));
605    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &mm));
606    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &hh));
607    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &d));
608    EXPECT_TRUE(absl::ParseCivilTime("2015-01", &m));
609    EXPECT_EQ("2015-01", absl::FormatCivilTime(m));
610    EXPECT_FALSE(absl::ParseCivilTime("2015-01", &y));
611    EXPECT_FALSE(absl::ParseCivilTime("2015", &ss));
612    EXPECT_FALSE(absl::ParseCivilTime("2015", &mm));
613    EXPECT_FALSE(absl::ParseCivilTime("2015", &hh));
614    EXPECT_FALSE(absl::ParseCivilTime("2015", &d));
615    EXPECT_FALSE(absl::ParseCivilTime("2015", &m));
616    EXPECT_TRUE(absl::ParseCivilTime("2015", &y));
617    EXPECT_EQ("2015", absl::FormatCivilTime(y));
618  }
619  TEST(CivilTime, FormatAndParseLenient) {
620    absl::CivilSecond ss;
621    EXPECT_EQ("1970-01-01T00:00:00", absl::FormatCivilTime(ss));
622    absl::CivilMinute mm;
623    EXPECT_EQ("1970-01-01T00:00", absl::FormatCivilTime(mm));
624    absl::CivilHour hh;
625    EXPECT_EQ("1970-01-01T00", absl::FormatCivilTime(hh));
626    absl::CivilDay d;
627    EXPECT_EQ("1970-01-01", absl::FormatCivilTime(d));
628    absl::CivilMonth m;
629    EXPECT_EQ("1970-01", absl::FormatCivilTime(m));
630    absl::CivilYear y;
631    EXPECT_EQ("1970", absl::FormatCivilTime(y));
632    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &ss));
633    EXPECT_EQ("2015-01-02T03:04:05", absl::FormatCivilTime(ss));
634    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &mm));
635    EXPECT_EQ("2015-01-02T03:04", absl::FormatCivilTime(mm));
636    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &hh));
637    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hh));
638    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &d));
639    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(d));
640    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &m));
641    EXPECT_EQ("2015-01", absl::FormatCivilTime(m));
642    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-01-02T03:04:05", &y));
643    EXPECT_EQ("2015", absl::FormatCivilTime(y));
644  }
645  TEST(CivilTime, ParseEdgeCases) {
646    absl::CivilSecond ss;
647    EXPECT_TRUE(
648        absl::ParseLenientCivilTime("9223372036854775807-12-31T23:59:59", &ss));
649    EXPECT_EQ("9223372036854775807-12-31T23:59:59", absl::FormatCivilTime(ss));
650    EXPECT_TRUE(
651        absl::ParseLenientCivilTime("-9223372036854775808-01-01T00:00:00", &ss));
652    EXPECT_EQ("-9223372036854775808-01-01T00:00:00", absl::FormatCivilTime(ss));
653    absl::CivilMinute mm;
654    EXPECT_TRUE(
655        absl::ParseLenientCivilTime("9223372036854775807-12-31T23:59", &mm));
656    EXPECT_EQ("9223372036854775807-12-31T23:59", absl::FormatCivilTime(mm));
657    EXPECT_TRUE(
658        absl::ParseLenientCivilTime("-9223372036854775808-01-01T00:00", &mm));
659    EXPECT_EQ("-9223372036854775808-01-01T00:00", absl::FormatCivilTime(mm));
660    absl::CivilHour hh;
661    EXPECT_TRUE(
662        absl::ParseLenientCivilTime("9223372036854775807-12-31T23", &hh));
663    EXPECT_EQ("9223372036854775807-12-31T23", absl::FormatCivilTime(hh));
664    EXPECT_TRUE(
665        absl::ParseLenientCivilTime("-9223372036854775808-01-01T00", &hh));
666    EXPECT_EQ("-9223372036854775808-01-01T00", absl::FormatCivilTime(hh));
667    absl::CivilDay d;
668    EXPECT_TRUE(absl::ParseLenientCivilTime("9223372036854775807-12-31", &d));
669    EXPECT_EQ("9223372036854775807-12-31", absl::FormatCivilTime(d));
670    EXPECT_TRUE(absl::ParseLenientCivilTime("-9223372036854775808-01-01", &d));
671    EXPECT_EQ("-9223372036854775808-01-01", absl::FormatCivilTime(d));
672    absl::CivilMonth m;
673    EXPECT_TRUE(absl::ParseLenientCivilTime("9223372036854775807-12", &m));
674    EXPECT_EQ("9223372036854775807-12", absl::FormatCivilTime(m));
675    EXPECT_TRUE(absl::ParseLenientCivilTime("-9223372036854775808-01", &m));
676    EXPECT_EQ("-9223372036854775808-01", absl::FormatCivilTime(m));
677    absl::CivilYear y;
678    EXPECT_TRUE(absl::ParseLenientCivilTime("9223372036854775807", &y));
679    EXPECT_EQ("9223372036854775807", absl::FormatCivilTime(y));
680    EXPECT_TRUE(absl::ParseLenientCivilTime("-9223372036854775808", &y));
681    EXPECT_EQ("-9223372036854775808", absl::FormatCivilTime(y));
682    EXPECT_TRUE(absl::ParseLenientCivilTime("0", &ss)) << ss;
683    EXPECT_EQ(absl::CivilYear(0), ss);
684    EXPECT_TRUE(absl::ParseLenientCivilTime("0-1", &ss)) << ss;
685    EXPECT_EQ(absl::CivilMonth(0, 1), ss);
686    EXPECT_TRUE(absl::ParseLenientCivilTime(" 2015 ", &ss)) << ss;
687    EXPECT_EQ(absl::CivilYear(2015), ss);
688    EXPECT_TRUE(absl::ParseLenientCivilTime(" 2015-6 ", &ss)) << ss;
689    EXPECT_EQ(absl::CivilMonth(2015, 6), ss);
690    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-6-7", &ss)) << ss;
691    EXPECT_EQ(absl::CivilDay(2015, 6, 7), ss);
692    EXPECT_TRUE(absl::ParseLenientCivilTime(" 2015-6-7 ", &ss)) << ss;
693    EXPECT_EQ(absl::CivilDay(2015, 6, 7), ss);
694    EXPECT_TRUE(absl::ParseLenientCivilTime("2015-06-07T10:11:12 ", &ss)) << ss;
695    EXPECT_EQ(absl::CivilSecond(2015, 6, 7, 10, 11, 12), ss);
696    EXPECT_TRUE(absl::ParseLenientCivilTime(" 2015-06-07T10:11:12 ", &ss)) << ss;
697    EXPECT_EQ(absl::CivilSecond(2015, 6, 7, 10, 11, 12), ss);
698    EXPECT_TRUE(absl::ParseLenientCivilTime("-01-01", &ss)) << ss;
699    EXPECT_EQ(absl::CivilMonth(-1, 1), ss);
700    EXPECT_FALSE(absl::ParseLenientCivilTime("01-01-2015", &ss)) << ss;
701    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-", &ss)) << ss;
702    EXPECT_FALSE(absl::ParseLenientCivilTime("0xff-01", &ss)) << ss;
703    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-02-30T04:05:06", &ss)) << ss;
704    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-02-03T04:05:96", &ss)) << ss;
705    EXPECT_FALSE(absl::ParseLenientCivilTime("X2015-02-03T04:05:06", &ss)) << ss;
706    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-02-03T04:05:003", &ss)) << ss;
707    EXPECT_FALSE(absl::ParseLenientCivilTime("2015 -02-03T04:05:06", &ss)) << ss;
708    EXPECT_FALSE(absl::ParseLenientCivilTime("2015-02-03-04:05:06", &ss)) << ss;
709    EXPECT_FALSE(absl::ParseLenientCivilTime("2015:02:03T04-05-06", &ss)) << ss;
710    EXPECT_FALSE(absl::ParseLenientCivilTime("9223372036854775808", &y)) << y;
711  }
712  TEST(CivilTime, OutputStream) {
713    absl::CivilSecond cs(2016, 2, 3, 4, 5, 6);
714    {
715      std::stringstream ss;
716      ss << std::left << std::setfill('.');
717      ss << std::setw(3) << 'X';
718      ss << std::setw(21) << absl::CivilYear(cs);
719      ss << std::setw(3) << 'X';
720      EXPECT_EQ("X..2016.................X..", ss.str());
721    }
722    {
723      std::stringstream ss;
724      ss << std::left << std::setfill('.');
725      ss << std::setw(3) << 'X';
726      ss << std::setw(21) << absl::CivilMonth(cs);
727      ss << std::setw(3) << 'X';
728      EXPECT_EQ("X..2016-02..............X..", ss.str());
729    }
730    {
731      std::stringstream ss;
732      ss << std::left << std::setfill('.');
733      ss << std::setw(3) << 'X';
734      ss << std::setw(21) << absl::CivilDay(cs);
735      ss << std::setw(3) << 'X';
736      EXPECT_EQ("X..2016-02-03...........X..", ss.str());
737    }
738    {
739      std::stringstream ss;
740      ss << std::left << std::setfill('.');
741      ss << std::setw(3) << 'X';
742      ss << std::setw(21) << absl::CivilHour(cs);
743      ss << std::setw(3) << 'X';
744      EXPECT_EQ("X..2016-02-03T04........X..", ss.str());
745    }
746    {
747      std::stringstream ss;
748      ss << std::left << std::setfill('.');
749      ss << std::setw(3) << 'X';
750      ss << std::setw(21) << absl::CivilMinute(cs);
751      ss << std::setw(3) << 'X';
752      EXPECT_EQ("X..2016-02-03T04:05.....X..", ss.str());
753    }
754    {
755      std::stringstream ss;
756      ss << std::left << std::setfill('.');
757      ss << std::setw(3) << 'X';
758      ss << std::setw(21) << absl::CivilSecond(cs);
759      ss << std::setw(3) << 'X';
760      EXPECT_EQ("X..2016-02-03T04:05:06..X..", ss.str());
761    }
762    {
763      std::stringstream ss;
764      ss << std::left << std::setfill('.');
765      ss << std::setw(3) << 'X';
766      ss << std::setw(21) << absl::Weekday::wednesday;
767      ss << std::setw(3) << 'X';
768      EXPECT_EQ("X..Wednesday............X..", ss.str());
769    }
770  }
771  TEST(CivilTime, Weekday) {
772    absl::CivilDay d(1970, 1, 1);
773    EXPECT_EQ(absl::Weekday::thursday, absl::GetWeekday(d)) << d;
774    d = absl::CivilDay(-31, 12, 24);
775    EXPECT_EQ(absl::Weekday::wednesday, absl::GetWeekday(d)) << d;
776  }
777  TEST(CivilTime, NextPrevWeekday) {
778    const absl::CivilDay thursday(1970, 1, 1);
779    absl::CivilDay d = absl::NextWeekday(thursday, absl::Weekday::thursday);
780    EXPECT_EQ(7, d - thursday) << d;
781    EXPECT_EQ(d - 14, absl::PrevWeekday(thursday, absl::Weekday::thursday));
782    d = absl::NextWeekday(thursday, absl::Weekday::friday);
783    EXPECT_EQ(1, d - thursday) << d;
784    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::friday));
785    d = absl::NextWeekday(thursday, absl::Weekday::saturday);
786    EXPECT_EQ(2, d - thursday) << d;
787    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::saturday));
788    d = absl::NextWeekday(thursday, absl::Weekday::sunday);
789    EXPECT_EQ(3, d - thursday) << d;
790    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::sunday));
791    d = absl::NextWeekday(thursday, absl::Weekday::monday);
792    EXPECT_EQ(4, d - thursday) << d;
793    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::monday));
794    d = absl::NextWeekday(thursday, absl::Weekday::tuesday);
795    EXPECT_EQ(5, d - thursday) << d;
796    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::tuesday));
797    d = absl::NextWeekday(thursday, absl::Weekday::wednesday);
798    EXPECT_EQ(6, d - thursday) << d;
799    EXPECT_EQ(d - 7, absl::PrevWeekday(thursday, absl::Weekday::wednesday));
800  }
801  TEST(CivilTime, DifferenceWithHugeYear) {
802    absl::CivilDay d1(9223372036854775807, 1, 1);
803    absl::CivilDay d2(9223372036854775807, 12, 31);
804    EXPECT_EQ(364, d2 - d1);
805    d1 = absl::CivilDay(-9223372036854775807 - 1, 1, 1);
806    d2 = absl::CivilDay(-9223372036854775807 - 1, 12, 31);
807    EXPECT_EQ(365, d2 - d1);
808    d1 = absl::CivilDay(9223372036854775807, 1, 1);
809    d2 = absl::CivilDay(9198119301927009252, 6, 6);
810    EXPECT_EQ(9223372036854775807, d1 - d2);
811    d2 = d2 - 1;
812    EXPECT_EQ(-9223372036854775807 - 1, d2 - d1);
813    d1 = absl::CivilDay(-9223372036854775807 - 1, 1, 1);
814    d2 = absl::CivilDay(-9198119301927009254, 7, 28);
815    EXPECT_EQ(9223372036854775807, d2 - d1);
816    d2 = d2 + 1;
817    EXPECT_EQ(-9223372036854775807 - 1, d1 - d2);
818    d1 = absl::CivilDay(-12626367463883278, 9, 3);
819    d2 = absl::CivilDay(12626367463883277, 3, 28);
820    EXPECT_EQ(9223372036854775807, d2 - d1);
821    d2 = d2 + 1;
822    EXPECT_EQ(-9223372036854775807 - 1, d1 - d2);
823  }
824  TEST(CivilTime, DifferenceNoIntermediateOverflow) {
825    absl::CivilSecond s1(-292277022657, 1, 27, 8, 29 - 1, 52);
826    absl::CivilSecond s2(1970, 1, 1, 0, 0 - 1, 0);
827    EXPECT_EQ(-9223372036854775807 - 1, s1 - s2);
828    s1 = absl::CivilSecond(292277026596, 12, 4, 15, 30, 7 - 7);
829    s2 = absl::CivilSecond(1970, 1, 1, 0, 0, 0 - 7);
830    EXPECT_EQ(9223372036854775807, s1 - s2);
831  }
832  TEST(CivilTime, NormalizeSimpleOverflow) {
833    absl::CivilSecond cs;
834    cs = absl::CivilSecond(2013, 11, 15, 16, 32, 59 + 1);
835    EXPECT_EQ("2013-11-15T16:33:00", absl::FormatCivilTime(cs));
836    cs = absl::CivilSecond(2013, 11, 15, 16, 59 + 1, 14);
837    EXPECT_EQ("2013-11-15T17:00:14", absl::FormatCivilTime(cs));
838    cs = absl::CivilSecond(2013, 11, 15, 23 + 1, 32, 14);
839    EXPECT_EQ("2013-11-16T00:32:14", absl::FormatCivilTime(cs));
840    cs = absl::CivilSecond(2013, 11, 30 + 1, 16, 32, 14);
841    EXPECT_EQ("2013-12-01T16:32:14", absl::FormatCivilTime(cs));
842    cs = absl::CivilSecond(2013, 12 + 1, 15, 16, 32, 14);
843    EXPECT_EQ("2014-01-15T16:32:14", absl::FormatCivilTime(cs));
844  }
845  TEST(CivilTime, NormalizeSimpleUnderflow) {
846    absl::CivilSecond cs;
847    cs = absl::CivilSecond(2013, 11, 15, 16, 32, 0 - 1);
848    EXPECT_EQ("2013-11-15T16:31:59", absl::FormatCivilTime(cs));
849    cs = absl::CivilSecond(2013, 11, 15, 16, 0 - 1, 14);
850    EXPECT_EQ("2013-11-15T15:59:14", absl::FormatCivilTime(cs));
851    cs = absl::CivilSecond(2013, 11, 15, 0 - 1, 32, 14);
852    EXPECT_EQ("2013-11-14T23:32:14", absl::FormatCivilTime(cs));
853    cs = absl::CivilSecond(2013, 11, 1 - 1, 16, 32, 14);
854    EXPECT_EQ("2013-10-31T16:32:14", absl::FormatCivilTime(cs));
855    cs = absl::CivilSecond(2013, 1 - 1, 15, 16, 32, 14);
856    EXPECT_EQ("2012-12-15T16:32:14", absl::FormatCivilTime(cs));
857  }
858  TEST(CivilTime, NormalizeMultipleOverflow) {
859    absl::CivilSecond cs(2013, 12, 31, 23, 59, 59 + 1);
860    EXPECT_EQ("2014-01-01T00:00:00", absl::FormatCivilTime(cs));
861  }
862  TEST(CivilTime, NormalizeMultipleUnderflow) {
863    absl::CivilSecond cs(2014, 1, 1, 0, 0, 0 - 1);
864    EXPECT_EQ("2013-12-31T23:59:59", absl::FormatCivilTime(cs));
865  }
866  TEST(CivilTime, NormalizeOverflowLimits) {
867    absl::CivilSecond cs;
868    const int kintmax = std::numeric_limits<int>::max();
869    cs = absl::CivilSecond(0, kintmax, kintmax, kintmax, kintmax, kintmax);
870    EXPECT_EQ("185085715-11-27T12:21:07", absl::FormatCivilTime(cs));
871    const int kintmin = std::numeric_limits<int>::min();
872    cs = absl::CivilSecond(0, kintmin, kintmin, kintmin, kintmin, kintmin);
873    EXPECT_EQ("-185085717-10-31T10:37:52", absl::FormatCivilTime(cs));
874  }
875  TEST(CivilTime, NormalizeComplexOverflow) {
876    absl::CivilSecond cs;
877    cs = absl::CivilSecond(2013, 11, 15, 16, 32, 14 + 123456789);
878    EXPECT_EQ("2017-10-14T14:05:23", absl::FormatCivilTime(cs));
879    cs = absl::CivilSecond(2013, 11, 15, 16, 32 + 1234567, 14);
880    EXPECT_EQ("2016-03-22T00:39:14", absl::FormatCivilTime(cs));
881    cs = absl::CivilSecond(2013, 11, 15, 16 + 123456, 32, 14);
882    EXPECT_EQ("2027-12-16T16:32:14", absl::FormatCivilTime(cs));
883    cs = absl::CivilSecond(2013, 11, 15 + 1234, 16, 32, 14);
884    EXPECT_EQ("2017-04-02T16:32:14", absl::FormatCivilTime(cs));
885    cs = absl::CivilSecond(2013, 11 + 123, 15, 16, 32, 14);
886    EXPECT_EQ("2024-02-15T16:32:14", absl::FormatCivilTime(cs));
887  }
888  TEST(CivilTime, NormalizeComplexUnderflow) {
889    absl::CivilSecond cs;
890    cs = absl::CivilSecond(1999, 3, 0, 0, 0, 0);  
891    EXPECT_EQ("1999-02-28T00:00:00", absl::FormatCivilTime(cs));
892    cs = absl::CivilSecond(2013, 11, 15, 16, 32, 14 - 123456789);
893    EXPECT_EQ("2009-12-17T18:59:05", absl::FormatCivilTime(cs));
894    cs = absl::CivilSecond(2013, 11, 15, 16, 32 - 1234567, 14);
895    EXPECT_EQ("2011-07-12T08:25:14", absl::FormatCivilTime(cs));
896    cs = absl::CivilSecond(2013, 11, 15, 16 - 123456, 32, 14);
897    EXPECT_EQ("1999-10-16T16:32:14", absl::FormatCivilTime(cs));
898    cs = absl::CivilSecond(2013, 11, 15 - 1234, 16, 32, 14);
899    EXPECT_EQ("2010-06-30T16:32:14", absl::FormatCivilTime(cs));
900    cs = absl::CivilSecond(2013, 11 - 123, 15, 16, 32, 14);
901    EXPECT_EQ("2003-08-15T16:32:14", absl::FormatCivilTime(cs));
902  }
903  TEST(CivilTime, NormalizeMishmash) {
904    absl::CivilSecond cs;
905    cs = absl::CivilSecond(2013, 11 - 123, 15 + 1234, 16 - 123456, 32 + 1234567,
906                           14 - 123456789);
907    EXPECT_EQ("1991-05-09T03:06:05", absl::FormatCivilTime(cs));
908    cs = absl::CivilSecond(2013, 11 + 123, 15 - 1234, 16 + 123456, 32 - 1234567,
909                           14 + 123456789);
910    EXPECT_EQ("2036-05-24T05:58:23", absl::FormatCivilTime(cs));
911    cs = absl::CivilSecond(2013, 11, -146097 + 1, 16, 32, 14);
912    EXPECT_EQ("1613-11-01T16:32:14", absl::FormatCivilTime(cs));
913    cs = absl::CivilSecond(2013, 11 + 400 * 12, -146097 + 1, 16, 32, 14);
914    EXPECT_EQ("2013-11-01T16:32:14", absl::FormatCivilTime(cs));
915  }
916  TEST(CivilTime, NormalizeAllTheDays) {
917    absl::CivilDay expected(1970, 1, 1);
918    for (int day = 1; day <= 146097; ++day) {
919      absl::CivilSecond cs(1970, 1, day, 0, 0, 0);
920      EXPECT_EQ(expected, cs);
921      ++expected;
922    }
923  }
924  TEST(CivilTime, NormalizeWithHugeYear) {
925    absl::CivilMonth c(9223372036854775807, 1);
926    EXPECT_EQ("9223372036854775807-01", absl::FormatCivilTime(c));
927    c = c - 1;  
928    EXPECT_EQ("9223372036854775806-12", absl::FormatCivilTime(c));
929    c = absl::CivilMonth(-9223372036854775807 - 1, 1);
930    EXPECT_EQ("-9223372036854775808-01", absl::FormatCivilTime(c));
931    c = c + 12;  
932    EXPECT_EQ("-9223372036854775807-01", absl::FormatCivilTime(c));
933  }
934  TEST(CivilTime, LeapYears) {
935    const absl::CivilSecond s1(2013, 2, 28 + 1, 0, 0, 0);
936    EXPECT_EQ("2013-03-01T00:00:00", absl::FormatCivilTime(s1));
937    const absl::CivilSecond s2(2012, 2, 28 + 1, 0, 0, 0);
938    EXPECT_EQ("2012-02-29T00:00:00", absl::FormatCivilTime(s2));
939    const absl::CivilSecond s3(1900, 2, 28 + 1, 0, 0, 0);
940    EXPECT_EQ("1900-03-01T00:00:00", absl::FormatCivilTime(s3));
941    const struct {
942      int year;
943      int days;
944      struct {
945        int month;
946        int day;
947      } leap_day;  
948    } kLeapYearTable[]{
949        {1900, 365, {3, 1}},
950        {1999, 365, {3, 1}},
951        {2000, 366, {2, 29}},  
952        {2001, 365, {3, 1}},
953        {2002, 365, {3, 1}},
954        {2003, 365, {3, 1}},
955        {2004, 366, {2, 29}},  
956        {2005, 365, {3, 1}},
957        {2006, 365, {3, 1}},
958        {2007, 365, {3, 1}},
959        {2008, 366, {2, 29}},  
960        {2009, 365, {3, 1}},
961        {2100, 365, {3, 1}},
962    };
963    for (int i = 0; i < ABSL_ARRAYSIZE(kLeapYearTable); ++i) {
964      const int y = kLeapYearTable[i].year;
965      const int m = kLeapYearTable[i].leap_day.month;
966      const int d = kLeapYearTable[i].leap_day.day;
967      const int n = kLeapYearTable[i].days;
968      const absl::CivilDay feb28(y, 2, 28);
969      const absl::CivilDay next_day = feb28 + 1;
970      EXPECT_EQ(m, next_day.month());
971      EXPECT_EQ(d, next_day.day());
972      const absl::CivilYear year(feb28);
973      const absl::CivilYear next_year = year + 1;
974      EXPECT_EQ(n, absl::CivilDay(next_year) - absl::CivilDay(year));
975    }
976  }
977  TEST(CivilTime, FirstThursdayInMonth) {
978    const absl::CivilDay nov1(2014, 11, 1);
979    const absl::CivilDay thursday =
980        absl::NextWeekday(nov1 - 1, absl::Weekday::thursday);
981    EXPECT_EQ("2014-11-06", absl::FormatCivilTime(thursday));
982    const absl::CivilDay thanksgiving = thursday +  7 * 3;
983    EXPECT_EQ("2014-11-27", absl::FormatCivilTime(thanksgiving));
984  }
985  TEST(CivilTime, DocumentationExample) {
986    absl::CivilSecond second(2015, 6, 28, 1, 2, 3);  
987    absl::CivilMinute minute(second);                
988    absl::CivilDay day(minute);                      
989    second -= 1;                    
990    --second;                       
991    EXPECT_EQ(minute, second - 1);  
992    EXPECT_LT(minute, second);
993    absl::CivilDay june_1(2015, 6, 1);  
994    int diff = day - june_1;            
995    EXPECT_EQ(27, diff);
996    absl::CivilDay day_floor(2015, 1, 2, 9, 9, 9);
997    EXPECT_EQ(0, day_floor.hour());  
998    EXPECT_EQ(absl::CivilDay(2015, 1, 2), day_floor);
999    absl::CivilDay day_default(2015);  
1000    EXPECT_EQ(absl::CivilDay(2015, 1, 1), day_default);
1001    absl::CivilMonth june(day);  
1002    absl::CivilMonth july = june + 1;
1003    for (absl::CivilDay day = june_1; day < july; ++day) {
1004    }
1005  }
1006  }  
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-civil_time_test.cc</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from abseil-cpp-MDEwOlJlcG9zaXRvcnkxMDQyMzE1NDE=-flat-civil_time_test.cc</div>
                </div>
                <div class="column column_space"><pre><code>372    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day - 1));
373    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day -= 1));
374    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(day++));
375    EXPECT_EQ("2015-01-04", absl::FormatCivilTime(++day));
376    EXPECT_EQ("2015-01-04", absl::FormatCivilTime(day--));
377    EXPECT_EQ("2015-01-02", absl::FormatCivilTime(--day));
378    absl::CivilMonth month(2015, 1);
</pre></code></div>
                <div class="column column_space"><pre><code>362    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour - 1));
363    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour -= 1));
364    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(hour++));
365    EXPECT_EQ("2015-01-02T05", absl::FormatCivilTime(++hour));
366    EXPECT_EQ("2015-01-02T05", absl::FormatCivilTime(hour--));
367    EXPECT_EQ("2015-01-02T03", absl::FormatCivilTime(--hour));
368    absl::CivilDay day(2015, 1, 2);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    