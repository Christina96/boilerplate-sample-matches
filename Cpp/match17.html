<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for YarpLocalImageManager.cpp & MockImageManager.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for YarpLocalImageManager.cpp & MockImageManager.cpp
      </h3>
      <h1 align="center">
        66.1%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>YarpLocalImageManager.cpp (57.74648%)<TH>MockImageManager.cpp (77.35849%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#0',2,'match17-1.html#0',3)" NAME="0">(102-127)<TD><A HREF="javascript:ZweiFrames('match17-0.html#0',2,'match17-1.html#0',3)" NAME="0">(48-73)</A><TD ALIGN=center><FONT COLOR="#ff0000">29</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#1',2,'match17-1.html#1',3)" NAME="1">(54-83)<TD><A HREF="javascript:ZweiFrames('match17-0.html#1',2,'match17-1.html#1',3)" NAME="1">(17-40)</A><TD ALIGN=center><FONT COLOR="#e40000">26</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#2',2,'match17-1.html#2',3)" NAME="2">(132-143)<TD><A HREF="javascript:ZweiFrames('match17-0.html#2',2,'match17-1.html#2',3)" NAME="2">(78-90)</A><TD ALIGN=center><FONT COLOR="#7b0000">14</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#3',2,'match17-1.html#3',3)" NAME="3">(16-21)<TD><A HREF="javascript:ZweiFrames('match17-0.html#3',2,'match17-1.html#3',3)" NAME="3">(12-16)</A><TD ALIGN=center><FONT COLOR="#720000">13</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>YarpLocalImageManager.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
// Authors: see AUTHORS.md at project root.
// CopyPolicy: released under the terms of the LGPLv2.1, see LICENSE at project root.
// URL: https://github.com/asrob-uc3m/robotDevastation

#include &quot;YarpLocalImageManager.hpp&quot;

#include &lt;sstream&gt;

#include &lt;yarp/os/LogStream.h&gt;
#include &lt;yarp/os/Network.h&gt;
#include &lt;yarp/os/Property.h&gt;

<A NAME="3"></A>#include &quot;LogComponent.hpp&quot;

//-- Initialize static members
<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match17-1.html#3',3,'match17-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>rd::YarpLocalImageManager * rd::YarpLocalImageManager::uniqueInstance = NULL;
const std::string rd::YarpLocalImageManager::id = &quot;YARPlocal&quot;;


bool rd::YarpLocalImageManager::start()
{</B></FONT>
    yarp::os::Network::init();

    yarp::os::Property cameraOptions;
    cameraOptions.put(&quot;device&quot;,&quot;grabber&quot;);
    cameraOptions.put(&quot;subdevice&quot;,&quot;opencv_grabber&quot;);
    cameraOptions.put(&quot;name&quot;,remote_port_name);
    yCDebug(RD_IMG) &lt;&lt; &quot;Camera id:&quot; &lt;&lt; camera_id;
    cameraOptions.put(&quot;camera&quot;, camera_id);
    cameraDevice.open(cameraOptions);
    if(!cameraDevice.isValid())
    {
        yCError(RD_IMG) &lt;&lt; &quot;Could not open opencv_grabber device&quot;;
        return false;
    }
    yCInfo(RD_IMG) &lt;&lt; &quot;Opened opencv_grabber device&quot;;

    imagePort.open(local_port_name.c_str());
    imagePort.useCallback(*this);

    if(! yarp::os::Network::connect( remote_port_name.c_str(), local_port_name.c_str(), &quot;mjpeg&quot; ) )
    {
        yCWarning(RD_IMG) &lt;&lt; &quot;Could not connect to robot camera via mjpeg&quot;;
        if (!yarp::os::Network::connect(remote_port_name.c_str(), local_port_name.c_str()))
        {
            yCWarning(RD_IMG) &lt;&lt; &quot;Could not connect to robot camera&quot;;
            return false;
        }
    }

<A NAME="1"></A>    yCInfo(RD_IMG) &lt;&lt; &quot;Connected to robot camera&quot;;

    stopped = false;
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match17-1.html#1',3,'match17-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    enabled = false;
    return true;
}

bool rd::YarpLocalImageManager::stop()
{
    imagePort.disableCallback();
    imagePort.interrupt();
    imagePort.close();

    cameraDevice.close();

    stopped = true;
    enabled = false;

    return true;
}

bool rd::YarpLocalImageManager::isStopped() const
{
    return stopped;
}

bool rd::YarpLocalImageManager::setEnabled(bool enabled)
{
    this-&gt;enabled = enabled;
    return true;
}

bool rd::YarpLocalImageManager::configure(const std::string &amp; parameter, const std::string &amp; value)</B></FONT>
{
    if ( parameter.compare(&quot;remote_img_port&quot;) == 0 &amp;&amp; value.compare(&quot;&quot;) != 0)
    {
        remote_port_name = value;
        return true;
    }
    else if ( parameter.compare(&quot;local_img_port&quot;) == 0 &amp;&amp; value.compare(&quot;&quot;) != 0)
    {
        local_port_name = value;
        return true;
    }
    else if (parameter.compare(&quot;camera_id&quot;) == 0)
    {
        std::stringstream ss(value);
        ss &gt;&gt; camera_id;
<A NAME="0"></A>        return true;
    }
    else
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match17-1.html#0',3,'match17-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>        return ImageManager::configure(parameter, value);
}

rd::Image rd::YarpLocalImageManager::getImage() const
{
    semaphore.wait();
    Image return_image = image;
    semaphore.post();

    return return_image;
}

bool rd::YarpLocalImageManager::RegisterManager()
{
    if (uniqueInstance == NULL)
    {
        uniqueInstance = new YarpLocalImageManager();
    }

    return Register( uniqueInstance, id);
}

rd::YarpLocalImageManager::~YarpLocalImageManager()
{
    uniqueInstance = NULL;
}</B></FONT>

<A NAME="2"></A>void rd::YarpLocalImageManager::onRead(Image &amp;image)
{
    semaphore.wait();
<FONT color="#980517"><A HREF="javascript:ZweiFrames('match17-1.html#2',3,'match17-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    this-&gt;image=image;
    semaphore.post();
    //-- Notify listeners
    if (enabled)
    {
        for (std::vector&lt;ImageEventListener *&gt;::iterator it = listeners.begin(); it != listeners.end(); ++it)
        {
            (*it)-&gt;onImageArrived(this);
        }
    }
    else
    {</B></FONT>
        yCWarning(RD_IMG) &lt;&lt; &quot;YarpImageManager is disabled!&quot;;
    }
}

rd::YarpLocalImageManager::YarpLocalImageManager()
{
    stopped = true;
    enabled = false;
    camera_id = 0; // see OpenCV C API: CV_CAP_ANY
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>MockImageManager.cpp</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
// Authors: see AUTHORS.md at project root.
// CopyPolicy: released under the terms of the LGPLv2.1, see LICENSE at project root.
// URL: https://github.com/asrob-uc3m/robotDevastation

#include &quot;MockImageManager.hpp&quot;

#include &lt;yarp/os/LogStream.h&gt;

<A NAME="3"></A>#include &quot;LogComponent.hpp&quot;

//-- Initialize static members
<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#3',2,'match17-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>rd::MockImageManager * rd::MockImageManager::uniqueInstance = NULL;
const std::string rd::MockImageManager::id = &quot;MOCK&quot;;
<A NAME="1"></A>
bool rd::MockImageManager::start()
{</B></FONT>
<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#1',2,'match17-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    stopped = false;
    return true;

}

bool rd::MockImageManager::stop()
{
    stopped = true;
    enabled = false;
    return true;
}

bool rd::MockImageManager::isStopped() const
{
    return stopped;
}

bool rd::MockImageManager::setEnabled(bool enabled)
{
    this-&gt;enabled = enabled;
    return true;
}

bool rd::MockImageManager::isEnabled() const</B></FONT>
{
    return enabled;
}

<A NAME="0"></A>bool rd::MockImageManager::configure(const std::string &amp; parameter, const std::string &amp; value)
{
    yCDebug(RD_IMG) &lt;&lt; &quot;Configure called for parameter&quot; &lt;&lt; parameter &lt;&lt; &quot;with value&quot; &lt;&lt; value;
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#0',2,'match17-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    return ImageManager::configure(parameter, value);
}

rd::Image rd::MockImageManager::getImage() const
{
    semaphore.wait();
    Image return_image = image;
    semaphore.post();

    return return_image;
}

bool rd::MockImageManager::RegisterManager()
{
    if (uniqueInstance == NULL)
    {
        uniqueInstance = new MockImageManager();
    }

    return Register(uniqueInstance, id);
}

rd::MockImageManager::~MockImageManager()
{
    uniqueInstance = NULL;
}</B></FONT>

<A NAME="2"></A>bool rd::MockImageManager::receiveImage(const Image &amp; received_image)
{
    semaphore.wait();
<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#2',2,'match17-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    image = received_image;
    semaphore.post();

    //-- Notify listeners
    if (enabled)
    {
        for (std::vector&lt;ImageEventListener *&gt;::iterator it = listeners.begin(); it != listeners.end(); ++it)
        {
            (*it)-&gt;onImageArrived(this);
        }
    }
    else
    {</B></FONT>
        yCWarning(RD_IMG) &lt;&lt; &quot;MockImageManager is disabled!&quot;;
        return false;
    }

    return true;
}

rd::MockImageManager::MockImageManager()
{
    stopped = true;
    enabled = false;
}
</PRE>
</div>
  </div>
</body>
</html>
