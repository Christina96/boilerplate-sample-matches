
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 9.558823529411764%, Tokens: 13, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-ReadFileChanges.h</h3>
            <pre><code>1  #pragma once
2  #include <stdio.h>
3  #ifndef VC_EXTRALEAN
4  #define VC_EXTRALEAN            
5  #endif
6  #include <windows.h>
7  class CReadFileChanges
8  {
9  public:
10  	CReadFileChanges();
11  	~CReadFileChanges();
<span onclick='openModal()' class='match'>12  	void AddFile(LPCTSTR szDirectory, DWORD dwNotifyFilter);
13  	BOOL DetectChanges();
14  	void Terminate();
15  private:
16  	LPCTSTR _szFile = nullptr;
17  	DWORD _dwNotifyFilter = 0;
18  	WIN32_FILE_ATTRIBUTE_DATA _lastFileInfo = {};
</span>19  };
</code></pre>
        </div>
        <div class="column">
            <h3>notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-DarkMode.cpp</h3>
            <pre><code>1  #include <windows.h>
2  #include "DarkMode.h"
3  #include "IatHook.h"
4  #include <uxtheme.h>
5  #include <vssym32.h>
6  #include <unordered_set>
7  #include <mutex>
8  #if defined(__GNUC__) && __GNUC__ > 8
9  #define WINAPI_LAMBDA_RETURN(return_t) -> return_t WINAPI
10  #elif defined(__GNUC__)
11  #define WINAPI_LAMBDA_RETURN(return_t) WINAPI -> return_t
12  #else
13  #define WINAPI_LAMBDA_RETURN(return_t) -> return_t
14  #endif
15  enum IMMERSIVE_HC_CACHE_MODE
16  {
17  	IHCM_USE_CACHED_VALUE,
18  	IHCM_REFRESH
19  };
20  enum class PreferredAppMode
21  {
22  	Default,
23  	AllowDark,
24  	ForceDark,
25  	ForceLight,
26  	Max
27  };
28  enum WINDOWCOMPOSITIONATTRIB
29  {
30  	WCA_UNDEFINED = 0,
31  	WCA_NCRENDERING_ENABLED = 1,
32  	WCA_NCRENDERING_POLICY = 2,
33  	WCA_TRANSITIONS_FORCEDISABLED = 3,
34  	WCA_ALLOW_NCPAINT = 4,
35  	WCA_CAPTION_BUTTON_BOUNDS = 5,
36  	WCA_NONCLIENT_RTL_LAYOUT = 6,
37  	WCA_FORCE_ICONIC_REPRESENTATION = 7,
38  	WCA_EXTENDED_FRAME_BOUNDS = 8,
39  	WCA_HAS_ICONIC_BITMAP = 9,
40  	WCA_THEME_ATTRIBUTES = 10,
41  	WCA_NCRENDERING_EXILED = 11,
42  	WCA_NCADORNMENTINFO = 12,
43  	WCA_EXCLUDED_FROM_LIVEPREVIEW = 13,
44  	WCA_VIDEO_OVERLAY_ACTIVE = 14,
45  	WCA_FORCE_ACTIVEWINDOW_APPEARANCE = 15,
46  	WCA_DISALLOW_PEEK = 16,
47  	WCA_CLOAK = 17,
48  	WCA_CLOAKED = 18,
49  	WCA_ACCENT_POLICY = 19,
50  	WCA_FREEZE_REPRESENTATION = 20,
51  	WCA_EVER_UNCLOAKED = 21,
52  	WCA_VISUAL_OWNER = 22,
53  	WCA_HOLOGRAPHIC = 23,
54  	WCA_EXCLUDED_FROM_DDA = 24,
55  	WCA_PASSIVEUPDATEMODE = 25,
56  	WCA_USEDARKMODECOLORS = 26,
57  	WCA_LAST = 27
58  };
59  struct WINDOWCOMPOSITIONATTRIBDATA
60  {
61  	WINDOWCOMPOSITIONATTRIB Attrib;
62  	PVOID pvData;
63  	SIZE_T cbData;
64  };
65  using fnRtlGetNtVersionNumbers = void (WINAPI *)(LPDWORD major, LPDWORD minor, LPDWORD build);
66  using fnSetWindowCompositionAttribute = BOOL (WINAPI *)(HWND hWnd, WINDOWCOMPOSITIONATTRIBDATA*);
67  using fnShouldAppsUseDarkMode = bool (WINAPI *)(); 
68  using fnAllowDarkModeForWindow = bool (WINAPI *)(HWND hWnd, bool allow); 
69  using fnAllowDarkModeForApp = bool (WINAPI *)(bool allow); 
70  using fnFlushMenuThemes = void (WINAPI *)(); 
71  using fnRefreshImmersiveColorPolicyState = void (WINAPI *)(); 
72  using fnIsDarkModeAllowedForWindow = bool (WINAPI *)(HWND hWnd); 
73  using fnGetIsImmersiveColorUsingHighContrast = bool (WINAPI *)(IMMERSIVE_HC_CACHE_MODE mode); 
<span onclick='openModal()' class='match'>74  using fnOpenNcThemeData = HTHEME(WINAPI *)(HWND hWnd, LPCWSTR pszClassList); 
75  using fnShouldSystemUseDarkMode = bool (WINAPI *)(); 
76  using fnSetPreferredAppMode = PreferredAppMode (WINAPI *)(PreferredAppMode appMode); 
77  using fnIsDarkModeAllowedForApp = bool (WINAPI *)(); 
78  fnSetWindowCompositionAttribute _SetWindowCompositionAttribute = nullptr;
79  fnShouldAppsUseDarkMode _ShouldAppsUseDarkMode = nullptr;
80  fnAllowDarkModeForWindow _AllowDarkModeForWindow = nullptr;
</span>81  fnAllowDarkModeForApp _AllowDarkModeForApp = nullptr;
82  fnFlushMenuThemes _FlushMenuThemes = nullptr;
83  fnRefreshImmersiveColorPolicyState _RefreshImmersiveColorPolicyState = nullptr;
84  fnIsDarkModeAllowedForWindow _IsDarkModeAllowedForWindow = nullptr;
85  fnGetIsImmersiveColorUsingHighContrast _GetIsImmersiveColorUsingHighContrast = nullptr;
86  fnOpenNcThemeData _OpenNcThemeData = nullptr;
87  fnSetPreferredAppMode _SetPreferredAppMode = nullptr;
88  bool g_darkModeSupported = false;
89  bool g_darkModeEnabled = false;
90  DWORD g_buildNumber = 0;
91  bool ShouldAppsUseDarkMode()
92  {
93  	if (!_ShouldAppsUseDarkMode)
94  	{
95  		return false;
96  	}
97  	return _ShouldAppsUseDarkMode();
98  }
99  bool AllowDarkModeForWindow(HWND hWnd, bool allow)
100  {
101  	if (g_darkModeSupported && _AllowDarkModeForWindow)
102  		return _AllowDarkModeForWindow(hWnd, allow);
103  	return false;
104  }
105  bool IsHighContrast()
106  {
107  	HIGHCONTRASTW highContrast{};
108  	highContrast.cbSize = sizeof(HIGHCONTRASTW);
109  	if (SystemParametersInfoW(SPI_GETHIGHCONTRAST, sizeof(HIGHCONTRASTW), &highContrast, FALSE))
110  		return (highContrast.dwFlags & HCF_HIGHCONTRASTON) == HCF_HIGHCONTRASTON;
111  	return false;
112  }
113  void SetTitleBarThemeColor(HWND hWnd, BOOL dark)
114  {
115  	if (g_buildNumber < 18362)
116  		SetPropW(hWnd, L"UseImmersiveDarkModeColors", reinterpret_cast<HANDLE>(static_cast<intptr_t>(dark)));
117  	else if (_SetWindowCompositionAttribute)
118  	{
119  		WINDOWCOMPOSITIONATTRIBDATA data = { WCA_USEDARKMODECOLORS, &dark, sizeof(dark) };
120  		_SetWindowCompositionAttribute(hWnd, &data);
121  	}
122  }
123  void RefreshTitleBarThemeColor(HWND hWnd)
124  {
125  	BOOL dark = FALSE;
126  	if (_IsDarkModeAllowedForWindow && _ShouldAppsUseDarkMode)
127  	{
128  		if (_IsDarkModeAllowedForWindow(hWnd) && _ShouldAppsUseDarkMode() && !IsHighContrast())
129  		{
130  			dark = TRUE;
131  		}
132  	}
133  	SetTitleBarThemeColor(hWnd, dark);
134  }
135  bool IsColorSchemeChangeMessage(LPARAM lParam)
136  {
137  	bool is = false;
138  	if (lParam && (0 == lstrcmpi(reinterpret_cast<LPCWCH>(lParam), L"ImmersiveColorSet")) && _RefreshImmersiveColorPolicyState)
139  	{
140  		_RefreshImmersiveColorPolicyState();
141  		is = true;
142  	}
143  	if (_GetIsImmersiveColorUsingHighContrast)
144  		_GetIsImmersiveColorUsingHighContrast(IHCM_REFRESH);
145  	return is;
146  }
147  bool IsColorSchemeChangeMessage(UINT message, LPARAM lParam)
148  {
149  	if (message == WM_SETTINGCHANGE)
150  		return IsColorSchemeChangeMessage(lParam);
151  	return false;
152  }
153  void AllowDarkModeForApp(bool allow)
154  {
155  	if (_AllowDarkModeForApp)
156  		_AllowDarkModeForApp(allow);
157  	else if (_SetPreferredAppMode)
158  		_SetPreferredAppMode(allow ? PreferredAppMode::ForceDark : PreferredAppMode::Default);
159  }
160  void FlushMenuThemes()
161  {
162  	if (_FlushMenuThemes)
163  	{
164  		_FlushMenuThemes();
165  	}
166  }
167  std::unordered_set<HWND> g_darkScrollBarWindows;
168  std::mutex g_darkScrollBarMutex;
169  void EnableDarkScrollBarForWindowAndChildren(HWND hwnd)
170  {
171  	std::lock_guard<std::mutex> lock(g_darkScrollBarMutex);
172  	g_darkScrollBarWindows.insert(hwnd);
173  }
174  bool IsWindowOrParentUsingDarkScrollBar(HWND hwnd)
175  {
176  	HWND hwndRoot = GetAncestor(hwnd, GA_ROOT);
177  	std::lock_guard<std::mutex> lock(g_darkScrollBarMutex);
178  	if (g_darkScrollBarWindows.count(hwnd)) {
179  		return true;
180  	}
181  	if (hwnd != hwndRoot && g_darkScrollBarWindows.count(hwndRoot)) {
182  		return true;
183  	}
184  	return false;
185  }
186  void FixDarkScrollBar()
187  {
188  	HMODULE hComctl = LoadLibraryEx(L"comctl32.dll", nullptr, LOAD_LIBRARY_SEARCH_SYSTEM32);
189  	if (hComctl)
190  	{
191  		auto addr = FindDelayLoadThunkInModule(hComctl, "uxtheme.dll", 49); 
192  		if (addr)
193  		{
194  			DWORD oldProtect;
195  			if (VirtualProtect(addr, sizeof(IMAGE_THUNK_DATA), PAGE_READWRITE, &oldProtect) && _OpenNcThemeData)
196  			{
197  				auto MyOpenThemeData = [](HWND hWnd, LPCWSTR classList) WINAPI_LAMBDA_RETURN(HTHEME) {
198  					if (wcscmp(classList, L"ScrollBar") == 0)
199  					{
200  						if (IsWindowOrParentUsingDarkScrollBar(hWnd)) {
201  							hWnd = nullptr;
202  							classList = L"Explorer::ScrollBar";
203  						}
204  					}
205  					return _OpenNcThemeData(hWnd, classList);
206  				};
207  				addr->u1.Function = reinterpret_cast<ULONG_PTR>(static_cast<fnOpenNcThemeData>(MyOpenThemeData));
208  				VirtualProtect(addr, sizeof(IMAGE_THUNK_DATA), oldProtect, &oldProtect);
209  			}
210  		}
211  	}
212  }
213  constexpr bool CheckBuildNumber(DWORD buildNumber)
214  {
215  	return (buildNumber == 17763 || 
216  		buildNumber == 18362 || 
217  		buildNumber == 18363 || 
218  		buildNumber == 19041 || 
219  		buildNumber == 19042 || 
220  		buildNumber == 19043 || 
221  		buildNumber == 19044 || 
222  		(buildNumber > 19044 && buildNumber < 22000) || 
223  		buildNumber >= 22000);  
224  }
225  bool IsWindows10() 
226  {
227  	return (g_buildNumber >= 17763);
228  }
229  bool IsWindows11() 
230  {
231  	return (g_buildNumber >= 22000);
232  }
233  DWORD GetWindowsBuildNumber()
234  {
235  	return g_buildNumber;
236  }
237  void InitDarkMode()
238  {
239  	fnRtlGetNtVersionNumbers RtlGetNtVersionNumbers = nullptr;
240  	HMODULE hNtdllModule = GetModuleHandle(L"ntdll.dll");
241  	if (hNtdllModule)
242  	{
243  		RtlGetNtVersionNumbers = reinterpret_cast<fnRtlGetNtVersionNumbers>(GetProcAddress(hNtdllModule, "RtlGetNtVersionNumbers"));
244  	}
245  	if (RtlGetNtVersionNumbers)
246  	{
247  		DWORD major, minor;
248  		RtlGetNtVersionNumbers(&major, &minor, &g_buildNumber);
249  		g_buildNumber &= ~0xF0000000;
250  		if (major == 10 && minor == 0 && CheckBuildNumber(g_buildNumber))
251  		{
252  			HMODULE hUxtheme = LoadLibraryEx(L"uxtheme.dll", nullptr, LOAD_LIBRARY_SEARCH_SYSTEM32);
253  			if (hUxtheme)
254  			{
255  				_OpenNcThemeData = reinterpret_cast<fnOpenNcThemeData>(GetProcAddress(hUxtheme, MAKEINTRESOURCEA(49)));
256  				_RefreshImmersiveColorPolicyState = reinterpret_cast<fnRefreshImmersiveColorPolicyState>(GetProcAddress(hUxtheme, MAKEINTRESOURCEA(104)));
257  				_GetIsImmersiveColorUsingHighContrast = reinterpret_cast<fnGetIsImmersiveColorUsingHighContrast>(GetProcAddress(hUxtheme, MAKEINTRESOURCEA(106)));
258  				_ShouldAppsUseDarkMode = reinterpret_cast<fnShouldAppsUseDarkMode>(GetProcAddress(hUxtheme, MAKEINTRESOURCEA(132)));
259  				_AllowDarkModeForWindow = reinterpret_cast<fnAllowDarkModeForWindow>(GetProcAddress(hUxtheme, MAKEINTRESOURCEA(133)));
260  				auto ord135 = GetProcAddress(hUxtheme, MAKEINTRESOURCEA(135));
261  				if (g_buildNumber < 18362)
262  					_AllowDarkModeForApp = reinterpret_cast<fnAllowDarkModeForApp>(ord135);
263  				else
264  					_SetPreferredAppMode = reinterpret_cast<fnSetPreferredAppMode>(ord135);
265  				_FlushMenuThemes = reinterpret_cast<fnFlushMenuThemes>(GetProcAddress(hUxtheme, MAKEINTRESOURCEA(136)));
266  				_IsDarkModeAllowedForWindow = reinterpret_cast<fnIsDarkModeAllowedForWindow>(GetProcAddress(hUxtheme, MAKEINTRESOURCEA(137)));
267  				HMODULE hUser32Module = GetModuleHandleW(L"user32.dll");
268  				if (hUser32Module)
269  				{
270  					_SetWindowCompositionAttribute = reinterpret_cast<fnSetWindowCompositionAttribute>(GetProcAddress(hUser32Module, "SetWindowCompositionAttribute"));
271  				}
272  				if (_OpenNcThemeData &&
273  					_RefreshImmersiveColorPolicyState &&
274  					_ShouldAppsUseDarkMode &&
275  					_AllowDarkModeForWindow &&
276  					(_AllowDarkModeForApp || _SetPreferredAppMode) &&
277  					_FlushMenuThemes &&
278  					_IsDarkModeAllowedForWindow)
279  				{
280  					g_darkModeSupported = true;
281  				}
282  			}
283  		}
284  	}
285  }
286  void SetDarkMode(bool useDark, bool fixDarkScrollbar)
287  {
288  	if (g_darkModeSupported)
289  	{
290  		AllowDarkModeForApp(useDark);
291  		FlushMenuThemes();
292  		if (fixDarkScrollbar)
293  		{
294  			FixDarkScrollBar();
295  		}
296  		g_darkModeEnabled = ShouldAppsUseDarkMode() && !IsHighContrast();
297  	}
298  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-ReadFileChanges.h</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from notepad-plus-plus-MDEwOlJlcG9zaXRvcnkzMzAxNDgxMQ==-flat-DarkMode.cpp</div>
                </div>
                <div class="column column_space"><pre><code>12  	void AddFile(LPCTSTR szDirectory, DWORD dwNotifyFilter);
13  	BOOL DetectChanges();
14  	void Terminate();
15  private:
16  	LPCTSTR _szFile = nullptr;
17  	DWORD _dwNotifyFilter = 0;
18  	WIN32_FILE_ATTRIBUTE_DATA _lastFileInfo = {};
</pre></code></div>
                <div class="column column_space"><pre><code>74  using fnOpenNcThemeData = HTHEME(WINAPI *)(HWND hWnd, LPCWSTR pszClassList); 
75  using fnShouldSystemUseDarkMode = bool (WINAPI *)(); 
76  using fnSetPreferredAppMode = PreferredAppMode (WINAPI *)(PreferredAppMode appMode); 
77  using fnIsDarkModeAllowedForApp = bool (WINAPI *)(); 
78  fnSetWindowCompositionAttribute _SetWindowCompositionAttribute = nullptr;
79  fnShouldAppsUseDarkMode _ShouldAppsUseDarkMode = nullptr;
80  fnAllowDarkModeForWindow _AllowDarkModeForWindow = nullptr;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    