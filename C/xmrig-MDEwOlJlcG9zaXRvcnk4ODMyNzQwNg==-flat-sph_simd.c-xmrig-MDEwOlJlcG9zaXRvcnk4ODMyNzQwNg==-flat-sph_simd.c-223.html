
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 455, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-sph_simd.c</h3>
            <pre><code>1  #include &lt;stddef.h&gt;
2  #include &lt;string.h&gt;
3  #include &lt;limits.h&gt;
4  #include &quot;sph_simd.h&quot;
5  #ifdef __cplusplus
6  extern &quot;C&quot;{
7  #endif
8  #if SPH_SMALL_FOOTPRINT &amp;&amp; !defined SPH_SMALL_FOOTPRINT_SIMD
9  #define SPH_SMALL_FOOTPRINT_SIMD   1
10  #endif
11  #ifdef _MSC_VER
12  #pragma warning (disable: 4146)
13  #endif
14  typedef sph_u32 u32;
15  typedef sph_s32 s32;
16  #define C32     SPH_C32
17  #define T32     SPH_T32
18  #define ROL32   SPH_ROTL32
19  #define XCAT(x, y)    XCAT_(x, y)
20  #define XCAT_(x, y)   x ## y
21  static const s32 alpha_tab[] = {
22  	  1,  41, 139,  45,  46,  87, 226,  14,  60, 147, 116, 130,
23  	190,  80, 196,  69,   2,  82,  21,  90,  92, 174, 195,  28,
24  	120,  37, 232,   3, 123, 160, 135, 138,   4, 164,  42, 180,
25  	184,  91, 133,  56, 240,  74, 207,   6, 246,  63,  13,  19,
26  	  8,  71,  84, 103, 111, 182,   9, 112, 223, 148, 157,  12,
27  	235, 126,  26,  38,  16, 142, 168, 206, 222, 107,  18, 224,
28  	189,  39,  57,  24, 213, 252,  52,  76,  32,  27,  79, 155,
29  	187, 214,  36, 191, 121,  78, 114,  48, 169, 247, 104, 152,
30  	 64,  54, 158,  53, 117, 171,  72, 125, 242, 156, 228,  96,
31  	 81, 237, 208,  47, 128, 108,  59, 106, 234,  85, 144, 250,
32  	227,  55, 199, 192, 162, 217, 159,  94, 256, 216, 118, 212,
33  	211, 170,  31, 243, 197, 110, 141, 127,  67, 177,  61, 188,
34  	255, 175, 236, 167, 165,  83,  62, 229, 137, 220,  25, 254,
35  	134,  97, 122, 119, 253,  93, 215,  77,  73, 166, 124, 201,
36  	 17, 183,  50, 251,  11, 194, 244, 238, 249, 186, 173, 154,
37  	146,  75, 248, 145,  34, 109, 100, 245,  22, 131, 231, 219,
38  	241, 115,  89,  51,  35, 150, 239,  33,  68, 218, 200, 233,
39  	 44,   5, 205, 181, 225, 230, 178, 102,  70,  43, 221,  66,
40  	136, 179, 143, 209,  88,  10, 153, 105, 193, 203,  99, 204,
41  	140,  86, 185, 132,  15, 101,  29, 161, 176,  20,  49, 210,
42  	129, 149, 198, 151,  23, 172, 113,   7,  30, 202,  58,  65,
43  	 95,  40,  98, 163
44  };
45  #define REDS1(x)    (((x) &amp; 0xFF) - ((x) &gt;&gt; 8))
46  #define REDS2(x)    (((x) &amp; 0xFFFF) + ((x) &gt;&gt; 16))
47  #define FFT_LOOP(rb, hk, as, id)   do { \
48  		size_t u, v; \
49  		s32 m = q[(rb)]; \
50  		s32 n = q[(rb) + (hk)]; \
51  		q[(rb)] = m + n; \
52  		q[(rb) + (hk)] = m - n; \
53  		u = v = 0; \
54  		goto id; \
55  		for (; u &lt; (hk); u += 4, v += 4 * (as)) { \
56  			s32 t; \
57  			m = q[(rb) + u + 0]; \
58  			n = q[(rb) + u + 0 + (hk)]; \
59  			t = REDS2(n * alpha_tab[v + 0 * (as)]); \
60  			q[(rb) + u + 0] = m + t; \
61  			q[(rb) + u + 0 + (hk)] = m - t; \
62  		id: \
63  			m = q[(rb) + u + 1]; \
64  			n = q[(rb) + u + 1 + (hk)]; \
65  			t = REDS2(n * alpha_tab[v + 1 * (as)]); \
66  			q[(rb) + u + 1] = m + t; \
67  			q[(rb) + u + 1 + (hk)] = m - t; \
68  			m = q[(rb) + u + 2]; \
69  			n = q[(rb) + u + 2 + (hk)]; \
70  			t = REDS2(n * alpha_tab[v + 2 * (as)]); \
71  			q[(rb) + u + 2] = m + t; \
72  			q[(rb) + u + 2 + (hk)] = m - t; \
73  			m = q[(rb) + u + 3]; \
74  			n = q[(rb) + u + 3 + (hk)]; \
75  			t = REDS2(n * alpha_tab[v + 3 * (as)]); \
76  			q[(rb) + u + 3] = m + t; \
77  			q[(rb) + u + 3 + (hk)] = m - t; \
78  		} \
79  	} while (0)
80  #define FFT8(xb, xs, d)   do { \
81  		s32 x0 = x[(xb)]; \
82  		s32 x1 = x[(xb) + (xs)]; \
83  		s32 x2 = x[(xb) + 2 * (xs)]; \
84  		s32 x3 = x[(xb) + 3 * (xs)]; \
85  		s32 a0 = x0 + x2; \
86  		s32 a1 = x0 + (x2 &lt;&lt; 4); \
87  		s32 a2 = x0 - x2; \
88  		s32 a3 = x0 - (x2 &lt;&lt; 4); \
89  		s32 b0 = x1 + x3; \
90  		s32 b1 = REDS1((x1 &lt;&lt; 2) + (x3 &lt;&lt; 6)); \
91  		s32 b2 = (x1 &lt;&lt; 4) - (x3 &lt;&lt; 4); \
92  		s32 b3 = REDS1((x1 &lt;&lt; 6) + (x3 &lt;&lt; 2)); \
93  		d ## 0 = a0 + b0; \
94  		d ## 1 = a1 + b1; \
95  		d ## 2 = a2 + b2; \
96  		d ## 3 = a3 + b3; \
97  		d ## 4 = a0 - b0; \
98  		d ## 5 = a1 - b1; \
99  		d ## 6 = a2 - b2; \
100  		d ## 7 = a3 - b3; \
101  	} while (0)
102  #define FFT16(xb, xs, rb)   do { \
103  		s32 d1_0, d1_1, d1_2, d1_3, d1_4, d1_5, d1_6, d1_7; \
104  		s32 d2_0, d2_1, d2_2, d2_3, d2_4, d2_5, d2_6, d2_7; \
105  		FFT8(xb, (xs) &lt;&lt; 1, d1_); \
106  		FFT8((xb) + (xs), (xs) &lt;&lt; 1, d2_); \
107  		q[(rb) +  0] = d1_0 + d2_0; \
108  		q[(rb) +  1] = d1_1 + (d2_1 &lt;&lt; 1); \
109  		q[(rb) +  2] = d1_2 + (d2_2 &lt;&lt; 2); \
110  		q[(rb) +  3] = d1_3 + (d2_3 &lt;&lt; 3); \
111  		q[(rb) +  4] = d1_4 + (d2_4 &lt;&lt; 4); \
112  		q[(rb) +  5] = d1_5 + (d2_5 &lt;&lt; 5); \
113  		q[(rb) +  6] = d1_6 + (d2_6 &lt;&lt; 6); \
114  		q[(rb) +  7] = d1_7 + (d2_7 &lt;&lt; 7); \
115  		q[(rb) +  8] = d1_0 - d2_0; \
116  		q[(rb) +  9] = d1_1 - (d2_1 &lt;&lt; 1); \
117  		q[(rb) + 10] = d1_2 - (d2_2 &lt;&lt; 2); \
118  		q[(rb) + 11] = d1_3 - (d2_3 &lt;&lt; 3); \
119  		q[(rb) + 12] = d1_4 - (d2_4 &lt;&lt; 4); \
120  		q[(rb) + 13] = d1_5 - (d2_5 &lt;&lt; 5); \
121  		q[(rb) + 14] = d1_6 - (d2_6 &lt;&lt; 6); \
122  		q[(rb) + 15] = d1_7 - (d2_7 &lt;&lt; 7); \
123  	} while (0)
124  #define FFT32(xb, xs, rb, id)   do { \
125  		FFT16(xb, (xs) &lt;&lt; 1, rb); \
126  		FFT16((xb) + (xs), (xs) &lt;&lt; 1, (rb) + 16); \
127  		FFT_LOOP(rb, 16, 8, id); \
128  	} while (0)
129  #define FFT64(xb, xs, rb, id)   do { \
130  		FFT32(xb, (xs) &lt;&lt; 1, rb, XCAT(id, a)); \
131  		FFT32((xb) + (xs), (xs) &lt;&lt; 1, (rb) + 32, XCAT(id, b)); \
132  		FFT_LOOP(rb, 32, 4, id); \
133  	} while (0)
134  #if SPH_SMALL_FOOTPRINT_SIMD
135  static void
136  fft32(unsigned char *x, size_t xs, s32 *q)
137  {
138  	size_t xd;
139  	xd = xs &lt;&lt; 1;
140  	FFT16(0, xd, 0);
141  	FFT16(xs, xd, 16);
142  	FFT_LOOP(0, 16, 8, label_);
143  }
144  #define FFT128(xb, xs, rb, id)   do { \
145  		fft32(x + (xb) + ((xs) * 0), (xs) &lt;&lt; 2, &amp;q[(rb) +  0]); \
146  		fft32(x + (xb) + ((xs) * 2), (xs) &lt;&lt; 2, &amp;q[(rb) + 32]); \
147  		FFT_LOOP(rb, 32, 4, XCAT(id, aa)); \
148  		fft32(x + (xb) + ((xs) * 1), (xs) &lt;&lt; 2, &amp;q[(rb) + 64]); \
149  		fft32(x + (xb) + ((xs) * 3), (xs) &lt;&lt; 2, &amp;q[(rb) + 96]); \
150  		FFT_LOOP((rb) + 64, 32, 4, XCAT(id, ab)); \
151  		FFT_LOOP(rb, 64, 2, XCAT(id, a)); \
152  	} while (0)
153  #else
154  #define FFT128(xb, xs, rb, id)   do { \
155  		FFT64(xb, (xs) &lt;&lt; 1, rb, XCAT(id, a)); \
156  		FFT64((xb) + (xs), (xs) &lt;&lt; 1, (rb) + 64, XCAT(id, b)); \
157  		FFT_LOOP(rb, 64, 2, id); \
158  	} while (0)
159  #endif
160  static void
161  fft64(unsigned char *x, size_t xs, s32 *q)
162  {
163  	size_t xd;
164  	xd = xs &lt;&lt; 1;
165  	FFT32(0, xd, 0, label_a);
166  	FFT32(xs, xd, 32, label_b);
167  	FFT_LOOP(0, 32, 4, label_);
168  }
169  #define FFT256(xb, xs, rb, id)   do { \
170  		fft64(x + (xb) + ((xs) * 0), (xs) &lt;&lt; 2, &amp;q[(rb) +   0]); \
171  		fft64(x + (xb) + ((xs) * 2), (xs) &lt;&lt; 2, &amp;q[(rb) +  64]); \
172  		FFT_LOOP(rb, 64, 2, XCAT(id, aa)); \
173  		fft64(x + (xb) + ((xs) * 1), (xs) &lt;&lt; 2, &amp;q[(rb) + 128]); \
174  		fft64(x + (xb) + ((xs) * 3), (xs) &lt;&lt; 2, &amp;q[(rb) + 192]); \
175  		FFT_LOOP((rb) + 128, 64, 2, XCAT(id, ab)); \
176  		FFT_LOOP(rb, 128, 1, XCAT(id, a)); \
177  	} while (0)
178  static const unsigned short yoff_s_n[] = {
179  	  1,  98,  95,  58,  30, 113,  23, 198, 129,  49, 176,  29,
180  	 15, 185, 140,  99, 193, 153,  88, 143, 136, 221,  70, 178,
181  	225, 205,  44, 200,  68, 239,  35,  89, 241, 231,  22, 100,
182  	 34, 248, 146, 173, 249, 244,  11,  50,  17, 124,  73, 215,
183  	253, 122, 134,  25, 137,  62, 165, 236, 255,  61,  67, 141,
184  	197,  31, 211, 118, 256, 159, 162, 199, 227, 144, 234,  59,
185  	128, 208,  81, 228, 242,  72, 117, 158,  64, 104, 169, 114,
186  	121,  36, 187,  79,  32,  52, 213,  57, 189,  18, 222, 168,
187  	 16,  26, 235, 157, 223,   9, 111,  84,   8,  13, 246, 207,
188  	240, 133, 184,  42,   4, 135, 123, 232, 120, 195,  92,  21,
189  	  2, 196, 190, 116,  60, 226,  46, 139
190  };
191  static const unsigned short yoff_s_f[] = {
192  	  2, 156, 118, 107,  45, 212, 111, 162,  97, 249, 211,   3,
193  	 49, 101, 151, 223, 189, 178, 253, 204,  76,  82, 232,  65,
194  	 96, 176, 161,  47, 189,  61, 248, 107,   0, 131, 133, 113,
195  	 17,  33,  12, 111, 251, 103,  57, 148,  47,  65, 249, 143,
196  	189,   8, 204, 230, 205, 151, 187, 227, 247, 111, 140,   6,
197  	 77,  10,  21, 149, 255, 101, 139, 150, 212,  45, 146,  95,
198  	160,   8,  46, 254, 208, 156, 106,  34,  68,  79,   4,  53,
199  	181, 175,  25, 192, 161,  81,  96, 210,  68, 196,   9, 150,
200  	  0, 126, 124, 144, 240, 224, 245, 146,   6, 154, 200, 109,
201  	210, 192,   8, 114,  68, 249,  53,  27,  52, 106,  70,  30,
202  	 10, 146, 117, 251, 180, 247, 236, 108
203  };
204  static const unsigned short yoff_b_n[] = {
205  	  1, 163,  98,  40,  95,  65,  58, 202,  30,   7, 113, 172,
206  	 23, 151, 198, 149, 129, 210,  49,  20, 176, 161,  29, 101,
207  	 15, 132, 185,  86, 140, 204,  99, 203, 193, 105, 153,  10,
208  	 88, 209, 143, 179, 136,  66, 221,  43,  70, 102, 178, 230,
209  	225, 181, 205,   5,  44, 233, 200, 218,  68,  33, 239, 150,
210  	 35,  51,  89, 115, 241, 219, 231, 131,  22, 245, 100, 109,
211  	 34, 145, 248,  75, 146, 154, 173, 186, 249, 238, 244, 194,
212  	 11, 251,  50, 183,  17, 201, 124, 166,  73,  77, 215,  93,
213  	253, 119, 122,  97, 134, 254,  25, 220, 137, 229,  62,  83,
214  	165, 167, 236, 175, 255, 188,  61, 177,  67, 127, 141, 110,
215  	197, 243,  31, 170, 211, 212, 118, 216, 256,  94, 159, 217,
216  	162, 192, 199,  55, 227, 250, 144,  85, 234, 106,  59, 108,
217  	128,  47, 208, 237,  81,  96, 228, 156, 242, 125,  72, 171,
218  	117,  53, 158,  54,  64, 152, 104, 247, 169,  48, 114,  78,
219  	121, 191,  36, 214, 187, 155,  79,  27,  32,  76,  52, 252,
220  	213,  24,  57,  39, 189, 224,  18, 107, 222, 206, 168, 142,
221  	 16,  38,  26, 126, 235,  12, 157, 148, 223, 112,   9, 182,
222  	111, 103,  84,  71,   8,  19,  13,  63, 246,   6, 207,  74,
223  	240,  56, 133,  91, 184, 180,  42, 164,   4, 138, 135, 160,
224  	123,   3, 232,  37, 120,  28, 195, 174,  92,  90,  21,  82,
225  	  2,  69, 196,  80, 190, 130, 116, 147,  60,  14, 226,  87,
226  	 46,  45, 139,  41
227  };
228  static const unsigned short yoff_b_f[] = {
229  	  2, 203, 156,  47, 118, 214, 107, 106,  45,  93, 212,  20,
230  	111,  73, 162, 251,  97, 215, 249,  53, 211,  19,   3,  89,
231  	 49, 207, 101,  67, 151, 130, 223,  23, 189, 202, 178, 239,
232  	253, 127, 204,  49,  76, 236,  82, 137, 232, 157,  65,  79,
233  	 96, 161, 176, 130, 161,  30,  47,   9, 189, 247,  61, 226,
234  	248,  90, 107,  64,   0,  88, 131, 243, 133,  59, 113, 115,
235  	 17, 236,  33, 213,  12, 191, 111,  19, 251,  61, 103, 208,
236  	 57,  35, 148, 248,  47, 116,  65, 119, 249, 178, 143,  40,
237  	189, 129,   8, 163, 204, 227, 230, 196, 205, 122, 151,  45,
238  	187,  19, 227,  72, 247, 125, 111, 121, 140, 220,   6, 107,
239  	 77,  69,  10, 101,  21,  65, 149, 171, 255,  54, 101, 210,
240  	139,  43, 150, 151, 212, 164,  45, 237, 146, 184,  95,   6,
241  	160,  42,   8, 204,  46, 238, 254, 168, 208,  50, 156, 190,
242  	106, 127,  34, 234,  68,  55,  79,  18,   4, 130,  53, 208,
243  	181,  21, 175, 120,  25, 100, 192, 178, 161,  96,  81, 127,
244  	 96, 227, 210, 248,  68,  10, 196,  31,   9, 167, 150, 193,
245  	  0, 169, 126,  14, 124, 198, 144, 142, 240,  21, 224,  44,
246  	245,  66, 146, 238,   6, 196, 154,  49, 200, 222, 109,   9,
247  	210, 141, 192, 138,   8,  79, 114, 217,  68, 128, 249,  94,
248  	 53,  30,  27,  61,  52, 135, 106, 212,  70, 238,  30, 185,
249  	 10, 132, 146, 136, 117,  37, 251, 150, 180, 188, 247, 156,
250  	236, 192, 108,  86
251  };
252  #define INNER(l, h, mm)   (((u32)((l) * (mm)) &amp; 0xFFFFU) \
253                            + ((u32)((h) * (mm)) &lt;&lt; 16))
254  #define W_SMALL(sb, o1, o2, mm) \
255  	(INNER(q[8 * (sb) + 2 * 0 + o1], q[8 * (sb) + 2 * 0 + o2], mm), \
256  	 INNER(q[8 * (sb) + 2 * 1 + o1], q[8 * (sb) + 2 * 1 + o2], mm), \
257  	 INNER(q[8 * (sb) + 2 * 2 + o1], q[8 * (sb) + 2 * 2 + o2], mm), \
258  	 INNER(q[8 * (sb) + 2 * 3 + o1], q[8 * (sb) + 2 * 3 + o2], mm)
259  #define WS_0_0   W_SMALL( 4,    0,    1, 185)
260  #define WS_0_1   W_SMALL( 6,    0,    1, 185)
261  #define WS_0_2   W_SMALL( 0,    0,    1, 185)
262  #define WS_0_3   W_SMALL( 2,    0,    1, 185)
263  #define WS_0_4   W_SMALL( 7,    0,    1, 185)
264  #define WS_0_5   W_SMALL( 5,    0,    1, 185)
265  #define WS_0_6   W_SMALL( 3,    0,    1, 185)
266  #define WS_0_7   W_SMALL( 1,    0,    1, 185)
267  #define WS_1_0   W_SMALL(15,    0,    1, 185)
268  #define WS_1_1   W_SMALL(11,    0,    1, 185)
269  #define WS_1_2   W_SMALL(12,    0,    1, 185)
270  #define WS_1_3   W_SMALL( 8,    0,    1, 185)
271  #define WS_1_4   W_SMALL( 9,    0,    1, 185)
272  #define WS_1_5   W_SMALL(13,    0,    1, 185)
273  #define WS_1_6   W_SMALL(10,    0,    1, 185)
274  #define WS_1_7   W_SMALL(14,    0,    1, 185)
275  #define WS_2_0   W_SMALL(17, -128,  -64, 233)
276  #define WS_2_1   W_SMALL(18, -128,  -64, 233)
277  #define WS_2_2   W_SMALL(23, -128,  -64, 233)
278  #define WS_2_3   W_SMALL(20, -128,  -64, 233)
279  #define WS_2_4   W_SMALL(22, -128,  -64, 233)
280  #define WS_2_5   W_SMALL(21, -128,  -64, 233)
281  #define WS_2_6   W_SMALL(16, -128,  -64, 233)
282  #define WS_2_7   W_SMALL(19, -128,  -64, 233)
283  #define WS_3_0   W_SMALL(30, -191, -127, 233)
284  #define WS_3_1   W_SMALL(24, -191, -127, 233)
285  #define WS_3_2   W_SMALL(25, -191, -127, 233)
286  #define WS_3_3   W_SMALL(31, -191, -127, 233)
287  #define WS_3_4   W_SMALL(27, -191, -127, 233)
288  #define WS_3_5   W_SMALL(29, -191, -127, 233)
289  #define WS_3_6   W_SMALL(28, -191, -127, 233)
290  #define WS_3_7   W_SMALL(26, -191, -127, 233)
291  #define W_BIG(sb, o1, o2, mm) \
292  	(INNER(q[16 * (sb) + 2 * 0 + o1], q[16 * (sb) + 2 * 0 + o2], mm), \
293  	 INNER(q[16 * (sb) + 2 * 1 + o1], q[16 * (sb) + 2 * 1 + o2], mm), \
294  	 INNER(q[16 * (sb) + 2 * 2 + o1], q[16 * (sb) + 2 * 2 + o2], mm), \
295  	 INNER(q[16 * (sb) + 2 * 3 + o1], q[16 * (sb) + 2 * 3 + o2], mm), \
296  	 INNER(q[16 * (sb) + 2 * 4 + o1], q[16 * (sb) + 2 * 4 + o2], mm), \
297  	 INNER(q[16 * (sb) + 2 * 5 + o1], q[16 * (sb) + 2 * 5 + o2], mm), \
298  	 INNER(q[16 * (sb) + 2 * 6 + o1], q[16 * (sb) + 2 * 6 + o2], mm), \
299  	 INNER(q[16 * (sb) + 2 * 7 + o1], q[16 * (sb) + 2 * 7 + o2], mm)
300  #define WB_0_0   W_BIG( 4,    0,    1, 185)
301  #define WB_0_1   W_BIG( 6,    0,    1, 185)
302  #define WB_0_2   W_BIG( 0,    0,    1, 185)
303  #define WB_0_3   W_BIG( 2,    0,    1, 185)
304  #define WB_0_4   W_BIG( 7,    0,    1, 185)
305  #define WB_0_5   W_BIG( 5,    0,    1, 185)
306  #define WB_0_6   W_BIG( 3,    0,    1, 185)
307  #define WB_0_7   W_BIG( 1,    0,    1, 185)
308  #define WB_1_0   W_BIG(15,    0,    1, 185)
309  #define WB_1_1   W_BIG(11,    0,    1, 185)
310  #define WB_1_2   W_BIG(12,    0,    1, 185)
311  #define WB_1_3   W_BIG( 8,    0,    1, 185)
312  #define WB_1_4   W_BIG( 9,    0,    1, 185)
313  #define WB_1_5   W_BIG(13,    0,    1, 185)
314  #define WB_1_6   W_BIG(10,    0,    1, 185)
315  #define WB_1_7   W_BIG(14,    0,    1, 185)
316  #define WB_2_0   W_BIG(17, -256, -128, 233)
317  #define WB_2_1   W_BIG(18, -256, -128, 233)
318  #define WB_2_2   W_BIG(23, -256, -128, 233)
319  #define WB_2_3   W_BIG(20, -256, -128, 233)
320  #define WB_2_4   W_BIG(22, -256, -128, 233)
321  #define WB_2_5   W_BIG(21, -256, -128, 233)
322  #define WB_2_6   W_BIG(16, -256, -128, 233)
323  #define WB_2_7   W_BIG(19, -256, -128, 233)
324  #define WB_3_0   W_BIG(30, -383, -255, 233)
325  #define WB_3_1   W_BIG(24, -383, -255, 233)
326  #define WB_3_2   W_BIG(25, -383, -255, 233)
327  #define WB_3_3   W_BIG(31, -383, -255, 233)
328  #define WB_3_4   W_BIG(27, -383, -255, 233)
329  #define WB_3_5   W_BIG(29, -383, -255, 233)
330  #define WB_3_6   W_BIG(28, -383, -255, 233)
331  #define WB_3_7   W_BIG(26, -383, -255, 233)
332  #define IF(x, y, z)    ((((y) ^ (z)) &amp; (x)) ^ (z))
333  #define MAJ(x, y, z)   (((x) &amp; (y)) | (((x) | (y)) &amp; (z)))
334  #define PP4_0_0   1
335  #define PP4_0_1   0
336  #define PP4_0_2   3
337  #define PP4_0_3   2
338  #define PP4_1_0   2
339  #define PP4_1_1   3
340  #define PP4_1_2   0
341  #define PP4_1_3   1
342  #define PP4_2_0   3
343  #define PP4_2_1   2
344  #define PP4_2_2   1
345  #define PP4_2_3   0
346  #define PP8_0_0   1
347  #define PP8_0_1   0
348  #define PP8_0_2   3
349  #define PP8_0_3   2
350  #define PP8_0_4   5
351  #define PP8_0_5   4
352  #define PP8_0_6   7
353  #define PP8_0_7   6
354  #define PP8_1_0   6
355  #define PP8_1_1   7
356  #define PP8_1_2   4
357  #define PP8_1_3   5
358  #define PP8_1_4   2
359  #define PP8_1_5   3
360  #define PP8_1_6   0
361  #define PP8_1_7   1
362  #define PP8_2_0   2
363  #define PP8_2_1   3
364  #define PP8_2_2   0
365  #define PP8_2_3   1
366  #define PP8_2_4   6
367  #define PP8_2_5   7
368  #define PP8_2_6   4
369  #define PP8_2_7   5
370  #define PP8_3_0   3
371  #define PP8_3_1   2
372  #define PP8_3_2   1
373  #define PP8_3_3   0
374  #define PP8_3_4   7
375  #define PP8_3_5   6
376  #define PP8_3_6   5
377  #define PP8_3_7   4
378  #define PP8_4_0   5
379  #define PP8_4_1   4
380  #define PP8_4_2   7
381  #define PP8_4_3   6
382  #define PP8_4_4   1
383  #define PP8_4_5   0
384  #define PP8_4_6   3
385  #define PP8_4_7   2
386  #define PP8_5_0   7
387  #define PP8_5_1   6
388  #define PP8_5_2   5
389  #define PP8_5_3   4
390  #define PP8_5_4   3
391  #define PP8_5_5   2
392  #define PP8_5_6   1
393  #define PP8_5_7   0
394  #define PP8_6_0   4
395  #define PP8_6_1   5
396  #define PP8_6_2   6
397  #define PP8_6_3   7
398  #define PP8_6_4   0
399  #define PP8_6_5   1
400  #define PP8_6_6   2
401  #define PP8_6_7   3
402  #if SPH_SIMD_NOCOPY
403  #define DECL_STATE_SMALL
404  #define READ_STATE_SMALL(sc)
405  #define WRITE_STATE_SMALL(sc)
406  #define DECL_STATE_BIG
407  #define READ_STATE_BIG(sc)
408  #define WRITE_STATE_BIG(sc)
409  #else
410  #define DECL_STATE_SMALL   \
411  	u32 A0, A1, A2, A3, B0, B1, B2, B3, C0, C1, C2, C3, D0, D1, D2, D3;
412  #define READ_STATE_SMALL(sc)   do { \
413  		A0 = (sc)-&gt;state[ 0]; \
414  		A1 = (sc)-&gt;state[ 1]; \
415  		A2 = (sc)-&gt;state[ 2]; \
416  		A3 = (sc)-&gt;state[ 3]; \
417  		B0 = (sc)-&gt;state[ 4]; \
418  		B1 = (sc)-&gt;state[ 5]; \
419  		B2 = (sc)-&gt;state[ 6]; \
420  		B3 = (sc)-&gt;state[ 7]; \
421  		C0 = (sc)-&gt;state[ 8]; \
422  		C1 = (sc)-&gt;state[ 9]; \
423  		C2 = (sc)-&gt;state[10]; \
424  		C3 = (sc)-&gt;state[11]; \
425  		D0 = (sc)-&gt;state[12]; \
426  		D1 = (sc)-&gt;state[13]; \
427  		D2 = (sc)-&gt;state[14]; \
428  		D3 = (sc)-&gt;state[15]; \
429  	} while (0)
430  #define WRITE_STATE_SMALL(sc)   do { \
431  		(sc)-&gt;state[ 0] = A0; \
432  		(sc)-&gt;state[ 1] = A1; \
433  		(sc)-&gt;state[ 2] = A2; \
434  		(sc)-&gt;state[ 3] = A3; \
435  		(sc)-&gt;state[ 4] = B0; \
436  		(sc)-&gt;state[ 5] = B1; \
437  		(sc)-&gt;state[ 6] = B2; \
438  		(sc)-&gt;state[ 7] = B3; \
439  		(sc)-&gt;state[ 8] = C0; \
440  		(sc)-&gt;state[ 9] = C1; \
441  		(sc)-&gt;state[10] = C2; \
442  		(sc)-&gt;state[11] = C3; \
443  		(sc)-&gt;state[12] = D0; \
444  		(sc)-&gt;state[13] = D1; \
445  		(sc)-&gt;state[14] = D2; \
446  		(sc)-&gt;state[15] = D3; \
447  	} while (0)
448  #define DECL_STATE_BIG   \
449  	u32 A0, A1, A2, A3, A4, A5, A6, A7; \
450  	u32 B0, B1, B2, B3, B4, B5, B6, B7; \
451  	u32 C0, C1, C2, C3, C4, C5, C6, C7; \
452  	u32 D0, D1, D2, D3, D4, D5, D6, D7;
453  #define READ_STATE_BIG(sc)   do { \
454  		A0 = (sc)-&gt;state[ 0]; \
455  		A1 = (sc)-&gt;state[ 1]; \
456  		A2 = (sc)-&gt;state[ 2]; \
457  		A3 = (sc)-&gt;state[ 3]; \
458  		A4 = (sc)-&gt;state[ 4]; \
459  		A5 = (sc)-&gt;state[ 5]; \
460  		A6 = (sc)-&gt;state[ 6]; \
461  		A7 = (sc)-&gt;state[ 7]; \
462  		B0 = (sc)-&gt;state[ 8]; \
463  		B1 = (sc)-&gt;state[ 9]; \
464  		B2 = (sc)-&gt;state[10]; \
465  		B3 = (sc)-&gt;state[11]; \
466  		B4 = (sc)-&gt;state[12]; \
467  		B5 = (sc)-&gt;state[13]; \
468  		B6 = (sc)-&gt;state[14]; \
469  		B7 = (sc)-&gt;state[15]; \
470  		C0 = (sc)-&gt;state[16]; \
471  		C1 = (sc)-&gt;state[17]; \
472  		C2 = (sc)-&gt;state[18]; \
473  		C3 = (sc)-&gt;state[19]; \
474  		C4 = (sc)-&gt;state[20]; \
475  		C5 = (sc)-&gt;state[21]; \
476  		C6 = (sc)-&gt;state[22]; \
477  		C7 = (sc)-&gt;state[23]; \
478  		D0 = (sc)-&gt;state[24]; \
479  		D1 = (sc)-&gt;state[25]; \
480  		D2 = (sc)-&gt;state[26]; \
481  		D3 = (sc)-&gt;state[27]; \
482  		D4 = (sc)-&gt;state[28]; \
483  		D5 = (sc)-&gt;state[29]; \
484  		D6 = (sc)-&gt;state[30]; \
485  		D7 = (sc)-&gt;state[31]; \
486  	} while (0)
487  #define WRITE_STATE_BIG(sc)   do { \
488  		(sc)-&gt;state[ 0] = A0; \
489  		(sc)-&gt;state[ 1] = A1; \
490  		(sc)-&gt;state[ 2] = A2; \
491  		(sc)-&gt;state[ 3] = A3; \
492  		(sc)-&gt;state[ 4] = A4; \
493  		(sc)-&gt;state[ 5] = A5; \
494  		(sc)-&gt;state[ 6] = A6; \
495  		(sc)-&gt;state[ 7] = A7; \
496  		(sc)-&gt;state[ 8] = B0; \
497  		(sc)-&gt;state[ 9] = B1; \
498  		(sc)-&gt;state[10] = B2; \
499  		(sc)-&gt;state[11] = B3; \
500  		(sc)-&gt;state[12] = B4; \
501  		(sc)-&gt;state[13] = B5; \
502  		(sc)-&gt;state[14] = B6; \
503  		(sc)-&gt;state[15] = B7; \
504  		(sc)-&gt;state[16] = C0; \
505  		(sc)-&gt;state[17] = C1; \
506  		(sc)-&gt;state[18] = C2; \
507  		(sc)-&gt;state[19] = C3; \
508  		(sc)-&gt;state[20] = C4; \
509  		(sc)-&gt;state[21] = C5; \
510  		(sc)-&gt;state[22] = C6; \
511  		(sc)-&gt;state[23] = C7; \
512  		(sc)-&gt;state[24] = D0; \
513  		(sc)-&gt;state[25] = D1; \
514  		(sc)-&gt;state[26] = D2; \
515  		(sc)-&gt;state[27] = D3; \
516  		(sc)-&gt;state[28] = D4; \
517  		(sc)-&gt;state[29] = D5; \
518  		(sc)-&gt;state[30] = D6; \
519  		(sc)-&gt;state[31] = D7; \
520  	} while (0)
521  #endif
522  #define STEP_ELT(n, w, fun, s, ppb)   do { \
523  		u32 tt = T32(D ## n + (w) + fun(A ## n, B ## n, C ## n)); \
524  		A ## n = T32(ROL32(tt, s) + XCAT(tA, XCAT(ppb, n))); \
525  		D ## n = C ## n; \
526  		C ## n = B ## n; \
527  		B ## n = tA ## n; \
528  	} while (0)
529  #define STEP_SMALL(w0, w1, w2, w3, fun, r, s, pp4b)   do { \
530  		u32 tA0 = ROL32(A0, r); \
531  		u32 tA1 = ROL32(A1, r); \
532  		u32 tA2 = ROL32(A2, r); \
533  		u32 tA3 = ROL32(A3, r); \
534  		STEP_ELT(0, w0, fun, s, pp4b); \
535  		STEP_ELT(1, w1, fun, s, pp4b); \
536  		STEP_ELT(2, w2, fun, s, pp4b); \
537  		STEP_ELT(3, w3, fun, s, pp4b); \
538  	} while (0)
539  #define STEP_BIG(w0, w1, w2, w3, w4, w5, w6, w7, fun, r, s, pp8b)   do { \
540  		u32 tA0 = ROL32(A0, r); \
541  		u32 tA1 = ROL32(A1, r); \
542  		u32 tA2 = ROL32(A2, r); \
543  		u32 tA3 = ROL32(A3, r); \
544  		u32 tA4 = ROL32(A4, r); \
545  		u32 tA5 = ROL32(A5, r); \
546  		u32 tA6 = ROL32(A6, r); \
547  		u32 tA7 = ROL32(A7, r); \
548  		STEP_ELT(0, w0, fun, s, pp8b); \
549  		STEP_ELT(1, w1, fun, s, pp8b); \
550  		STEP_ELT(2, w2, fun, s, pp8b); \
551  		STEP_ELT(3, w3, fun, s, pp8b); \
552  		STEP_ELT(4, w4, fun, s, pp8b); \
553  		STEP_ELT(5, w5, fun, s, pp8b); \
554  		STEP_ELT(6, w6, fun, s, pp8b); \
555  		STEP_ELT(7, w7, fun, s, pp8b); \
556  	} while (0)
557  #define M3_0_0   0_
558  #define M3_1_0   1_
559  #define M3_2_0   2_
560  #define M3_3_0   0_
561  #define M3_4_0   1_
562  #define M3_5_0   2_
563  #define M3_6_0   0_
564  #define M3_7_0   1_
565  #define M3_0_1   1_
566  #define M3_1_1   2_
567  #define M3_2_1   0_
568  #define M3_3_1   1_
569  #define M3_4_1   2_
570  #define M3_5_1   0_
571  #define M3_6_1   1_
572  #define M3_7_1   2_
573  #define M3_0_2   2_
574  #define M3_1_2   0_
575  #define M3_2_2   1_
576  #define M3_3_2   2_
577  #define M3_4_2   0_
578  #define M3_5_2   1_
579  #define M3_6_2   2_
580  #define M3_7_2   0_
581  #define STEP_SMALL_(w, fun, r, s, pp4b)   STEP_SMALL w, fun, r, s, pp4b)
582  #define ONE_ROUND_SMALL(ri, isp, p0, p1, p2, p3)   do { \
583  		STEP_SMALL_(WS_ ## ri ## 0, \
584  			IF,  p0, p1, XCAT(PP4_, M3_0_ ## isp)); \
585  		STEP_SMALL_(WS_ ## ri ## 1, \
586  			IF,  p1, p2, XCAT(PP4_, M3_1_ ## isp)); \
587  		STEP_SMALL_(WS_ ## ri ## 2, \
588  			IF,  p2, p3, XCAT(PP4_, M3_2_ ## isp)); \
589  		STEP_SMALL_(WS_ ## ri ## 3, \
590  			IF,  p3, p0, XCAT(PP4_, M3_3_ ## isp)); \
591  		STEP_SMALL_(WS_ ## ri ## 4, \
592  			MAJ, p0, p1, XCAT(PP4_, M3_4_ ## isp)); \
593  		STEP_SMALL_(WS_ ## ri ## 5, \
594  			MAJ, p1, p2, XCAT(PP4_, M3_5_ ## isp)); \
595  		STEP_SMALL_(WS_ ## ri ## 6, \
596  			MAJ, p2, p3, XCAT(PP4_, M3_6_ ## isp)); \
597  		STEP_SMALL_(WS_ ## ri ## 7, \
598  			MAJ, p3, p0, XCAT(PP4_, M3_7_ ## isp)); \
599  	} while (0)
600  #define M7_0_0   0_
601  #define M7_1_0   1_
602  #define M7_2_0   2_
603  #define M7_3_0   3_
604  #define M7_4_0   4_
605  #define M7_5_0   5_
606  #define M7_6_0   6_
607  #define M7_7_0   0_
608  #define M7_0_1   1_
609  #define M7_1_1   2_
610  #define M7_2_1   3_
611  #define M7_3_1   4_
612  #define M7_4_1   5_
613  #define M7_5_1   6_
614  #define M7_6_1   0_
615  #define M7_7_1   1_
616  #define M7_0_2   2_
617  #define M7_1_2   3_
618  #define M7_2_2   4_
619  #define M7_3_2   5_
620  #define M7_4_2   6_
621  #define M7_5_2   0_
622  #define M7_6_2   1_
623  #define M7_7_2   2_
624  #define M7_0_3   3_
625  #define M7_1_3   4_
626  #define M7_2_3   5_
627  #define M7_3_3   6_
628  #define M7_4_3   0_
629  #define M7_5_3   1_
630  #define M7_6_3   2_
631  #define M7_7_3   3_
632  #define STEP_BIG_(w, fun, r, s, pp8b)   STEP_BIG w, fun, r, s, pp8b)
633  #define ONE_ROUND_BIG(ri, isp, p0, p1, p2, p3)   do { \
634  		STEP_BIG_(WB_ ## ri ## 0, \
635  			IF,  p0, p1, XCAT(PP8_, M7_0_ ## isp)); \
636  		STEP_BIG_(WB_ ## ri ## 1, \
637  			IF,  p1, p2, XCAT(PP8_, M7_1_ ## isp)); \
638  		STEP_BIG_(WB_ ## ri ## 2, \
639  			IF,  p2, p3, XCAT(PP8_, M7_2_ ## isp)); \
640  		STEP_BIG_(WB_ ## ri ## 3, \
641  			IF,  p3, p0, XCAT(PP8_, M7_3_ ## isp)); \
642  		STEP_BIG_(WB_ ## ri ## 4, \
643  			MAJ, p0, p1, XCAT(PP8_, M7_4_ ## isp)); \
644  		STEP_BIG_(WB_ ## ri ## 5, \
645  			MAJ, p1, p2, XCAT(PP8_, M7_5_ ## isp)); \
646  		STEP_BIG_(WB_ ## ri ## 6, \
647  			MAJ, p2, p3, XCAT(PP8_, M7_6_ ## isp)); \
648  		STEP_BIG_(WB_ ## ri ## 7, \
649  			MAJ, p3, p0, XCAT(PP8_, M7_7_ ## isp)); \
650  	} while (0)
651  #if SPH_SMALL_FOOTPRINT_SIMD
652  #define A0   state[ 0]
653  #define A1   state[ 1]
654  #define A2   state[ 2]
655  #define A3   state[ 3]
656  #define B0   state[ 4]
657  #define B1   state[ 5]
658  #define B2   state[ 6]
659  #define B3   state[ 7]
660  #define C0   state[ 8]
661  #define C1   state[ 9]
662  #define C2   state[10]
663  #define C3   state[11]
664  #define D0   state[12]
665  #define D1   state[13]
666  #define D2   state[14]
667  #define D3   state[15]
668  #define STEP2_ELT(n, w, fun, s, ppb)   do { \
669  		u32 tt = T32(D ## n + (w) + fun(A ## n, B ## n, C ## n)); \
670  		A ## n = T32(ROL32(tt, s) + tA[(ppb) ^ n]); \
671  		D ## n = C ## n; \
672  		C ## n = B ## n; \
673  		B ## n = tA[n]; \
674  	} while (0)
675  #define STEP2_SMALL(w0, w1, w2, w3, fun, r, s, pp4b)   do { \
676  		u32 tA[4]; \
677  		tA[0] = ROL32(A0, r); \
678  		tA[1] = ROL32(A1, r); \
679  		tA[2] = ROL32(A2, r); \
680  		tA[3] = ROL32(A3, r); \
681  		STEP2_ELT(0, w0, fun, s, pp4b); \
682  		STEP2_ELT(1, w1, fun, s, pp4b); \
683  		STEP2_ELT(2, w2, fun, s, pp4b); \
684  		STEP2_ELT(3, w3, fun, s, pp4b); \
685  	} while (0)
686  static void
687  one_round_small(u32 *state, u32 *w, int isp, int p0, int p1, int p2, int p3)
688  {
689  	static const int pp4k[] = { 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2 };
690  	STEP2_SMALL(w[ 0], w[ 1], w[ 2], w[ 3], IF,  p0, p1, pp4k[isp + 0]);
691  	STEP2_SMALL(w[ 4], w[ 5], w[ 6], w[ 7], IF,  p1, p2, pp4k[isp + 1]);
692  	STEP2_SMALL(w[ 8], w[ 9], w[10], w[11], IF,  p2, p3, pp4k[isp + 2]);
693  	STEP2_SMALL(w[12], w[13], w[14], w[15], IF,  p3, p0, pp4k[isp + 3]);
694  	STEP2_SMALL(w[16], w[17], w[18], w[19], MAJ, p0, p1, pp4k[isp + 4]);
695  	STEP2_SMALL(w[20], w[21], w[22], w[23], MAJ, p1, p2, pp4k[isp + 5]);
696  	STEP2_SMALL(w[24], w[25], w[26], w[27], MAJ, p2, p3, pp4k[isp + 6]);
697  	STEP2_SMALL(w[28], w[29], w[30], w[31], MAJ, p3, p0, pp4k[isp + 7]);
698  }
699  static void
700  compress_small(sph_simd_small_context *sc, int last)
701  {
702  	unsigned char *x;
<span onclick='openModal()' class='match'>703  	s32 q[128];
704  	int i;
705  	u32 w[32];
706  	u32 state[16];
707  	size_t u;
708  	static const size_t wsp[32] = {
709  		 4 &lt;&lt; 3,  6 &lt;&lt; 3,  0 &lt;&lt; 3,  2 &lt;&lt; 3,
710  		 7 &lt;&lt; 3,  5 &lt;&lt; 3,  3 &lt;&lt; 3,  1 &lt;&lt; 3,
711  		15 &lt;&lt; 3, 11 &lt;&lt; 3, 12 &lt;&lt; 3,  8 &lt;&lt; 3,
712  		 9 &lt;&lt; 3, 13 &lt;&lt; 3, 10 &lt;&lt; 3, 14 &lt;&lt; 3,
713  		17 &lt;&lt; 3, 18 &lt;&lt; 3, 23 &lt;&lt; 3, 20 &lt;&lt; 3,
714  		22 &lt;&lt; 3, 21 &lt;&lt; 3, 16 &lt;&lt; 3, 19 &lt;&lt; 3,
715  		30 &lt;&lt; 3, 24 &lt;&lt; 3, 25 &lt;&lt; 3, 31 &lt;&lt; 3,
716  		27 &lt;&lt; 3, 29 &lt;&lt; 3, 28 &lt;&lt; 3, 26 &lt;&lt; 3
717  	};
718  	x = sc-&gt;buf;
719  	FFT128(0, 1, 0, ll);
720  	if (last) {
721  		for (i = 0; i &lt; 128; i ++) {
722  			s32 tq;
723  			tq = q[i] + yoff_s_f[i];
724  			tq = REDS2(tq);
725  			tq = REDS1(tq);
726  			tq = REDS1(tq);
727  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
728  		}
729  	} else {
730  		for (i = 0; i &lt; 128; i ++) {
731  			s32 tq;
732  			tq = q[i] + yoff_s_n[i];
733  			tq = REDS2(tq);
734  			tq = REDS1(tq);
735  			tq = REDS1(tq);
736  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
737  		}
738  	}
739  	for (i = 0; i &lt; 16; i += 4) {
740  		state[i + 0] = sc-&gt;state[i + 0]
741  			^ sph_dec32le_aligned(x + 4 * (i + 0));
742  		state[i + 1] = sc-&gt;state[i + 1]
743  			^ sph_dec32le_aligned(x + 4 * (i + 1));
744  		state[i + 2] = sc-&gt;state[i + 2]
745  			^ sph_dec32le_aligned(x + 4 * (i + 2));
746  		state[i + 3] = sc-&gt;state[i + 3]
747  			^ sph_dec32le_aligned(x + 4 * (i + 3));
748  	}
</span>749  #define WSREAD(sb, o1, o2, mm)   do { \
750  		for (u = 0; u &lt; 32; u += 4) { \
751  			size_t v = wsp[(u &gt;&gt; 2) + (sb)]; \
752  			w[u + 0] = INNER(q[v + 2 * 0 + (o1)], \
753  				q[v + 2 * 0 + (o2)], mm); \
754  			w[u + 1] = INNER(q[v + 2 * 1 + (o1)], \
755  				q[v + 2 * 1 + (o2)], mm); \
756  			w[u + 2] = INNER(q[v + 2 * 2 + (o1)], \
757  				q[v + 2 * 2 + (o2)], mm); \
758  			w[u + 3] = INNER(q[v + 2 * 3 + (o1)], \
759  				q[v + 2 * 3 + (o2)], mm); \
760  		} \
761  	} while (0)
762  	WSREAD( 0,    0,    1, 185);
763  	one_round_small(state, w, 0,  3, 23, 17, 27);
764  	WSREAD( 8,    0,    1, 185);
765  	one_round_small(state, w, 2, 28, 19, 22,  7);
766  	WSREAD(16, -128,  -64, 233);
767  	one_round_small(state, w, 1, 29,  9, 15,  5);
768  	WSREAD(24, -191, -127, 233);
769  	one_round_small(state, w, 0,  4, 13, 10, 25);
770  #undef WSREAD
771  	STEP_SMALL(sc-&gt;state[ 0], sc-&gt;state[ 1], sc-&gt;state[ 2], sc-&gt;state[ 3],
772  		IF,  4, 13, PP4_2_);
773  	STEP_SMALL(sc-&gt;state[ 4], sc-&gt;state[ 5], sc-&gt;state[ 6], sc-&gt;state[ 7],
774  		IF, 13, 10, PP4_0_);
775  	STEP_SMALL(sc-&gt;state[ 8], sc-&gt;state[ 9], sc-&gt;state[10], sc-&gt;state[11],
776  		IF, 10, 25, PP4_1_);
777  	STEP_SMALL(sc-&gt;state[12], sc-&gt;state[13], sc-&gt;state[14], sc-&gt;state[15],
778  		IF, 25,  4, PP4_2_);
779  	memcpy(sc-&gt;state, state, sizeof state);
780  }
781  #undef A0
782  #undef A1
783  #undef A2
784  #undef A3
785  #undef B0
786  #undef B1
787  #undef B2
788  #undef B3
789  #undef C0
790  #undef C1
791  #undef C2
792  #undef C3
793  #undef D0
794  #undef D1
795  #undef D2
796  #undef D3
797  #else
798  #if SPH_SIMD_NOCOPY
799  #define A0   (sc-&gt;state[ 0])
800  #define A1   (sc-&gt;state[ 1])
801  #define A2   (sc-&gt;state[ 2])
802  #define A3   (sc-&gt;state[ 3])
803  #define B0   (sc-&gt;state[ 4])
804  #define B1   (sc-&gt;state[ 5])
805  #define B2   (sc-&gt;state[ 6])
806  #define B3   (sc-&gt;state[ 7])
807  #define C0   (sc-&gt;state[ 8])
808  #define C1   (sc-&gt;state[ 9])
809  #define C2   (sc-&gt;state[10])
810  #define C3   (sc-&gt;state[11])
811  #define D0   (sc-&gt;state[12])
812  #define D1   (sc-&gt;state[13])
813  #define D2   (sc-&gt;state[14])
814  #define D3   (sc-&gt;state[15])
815  #endif
816  static void
817  compress_small(sph_simd_small_context *sc, int last)
818  {
819  	unsigned char *x;
820  	s32 q[128];
821  	int i;
822  	DECL_STATE_SMALL
823  #if SPH_SIMD_NOCOPY
824  	sph_u32 saved[16];
825  #endif
826  #if SPH_SIMD_NOCOPY
827  	memcpy(saved, sc-&gt;state, sizeof saved);
828  #endif
829  	x = sc-&gt;buf;
830  	FFT128(0, 1, 0, ll);
831  	if (last) {
832  		for (i = 0; i &lt; 128; i ++) {
833  			s32 tq;
834  			tq = q[i] + yoff_s_f[i];
835  			tq = REDS2(tq);
836  			tq = REDS1(tq);
837  			tq = REDS1(tq);
838  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
839  		}
840  	} else {
841  		for (i = 0; i &lt; 128; i ++) {
842  			s32 tq;
843  			tq = q[i] + yoff_s_n[i];
844  			tq = REDS2(tq);
845  			tq = REDS1(tq);
846  			tq = REDS1(tq);
847  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
848  		}
849  	}
850  	READ_STATE_SMALL(sc);
851  	A0 ^= sph_dec32le_aligned(x +  0);
852  	A1 ^= sph_dec32le_aligned(x +  4);
853  	A2 ^= sph_dec32le_aligned(x +  8);
854  	A3 ^= sph_dec32le_aligned(x + 12);
855  	B0 ^= sph_dec32le_aligned(x + 16);
856  	B1 ^= sph_dec32le_aligned(x + 20);
857  	B2 ^= sph_dec32le_aligned(x + 24);
858  	B3 ^= sph_dec32le_aligned(x + 28);
859  	C0 ^= sph_dec32le_aligned(x + 32);
860  	C1 ^= sph_dec32le_aligned(x + 36);
861  	C2 ^= sph_dec32le_aligned(x + 40);
862  	C3 ^= sph_dec32le_aligned(x + 44);
863  	D0 ^= sph_dec32le_aligned(x + 48);
864  	D1 ^= sph_dec32le_aligned(x + 52);
865  	D2 ^= sph_dec32le_aligned(x + 56);
866  	D3 ^= sph_dec32le_aligned(x + 60);
867  	ONE_ROUND_SMALL(0_, 0,  3, 23, 17, 27);
868  	ONE_ROUND_SMALL(1_, 2, 28, 19, 22,  7);
869  	ONE_ROUND_SMALL(2_, 1, 29,  9, 15,  5);
870  	ONE_ROUND_SMALL(3_, 0,  4, 13, 10, 25);
871  #if SPH_SIMD_NOCOPY
872  	STEP_SMALL(saved[ 0], saved[ 1], saved[ 2], saved[ 3],
873  		IF,  4, 13, PP4_2_);
874  	STEP_SMALL(saved[ 4], saved[ 5], saved[ 6], saved[ 7],
875  		IF, 13, 10, PP4_0_);
876  	STEP_SMALL(saved[ 8], saved[ 9], saved[10], saved[11],
877  		IF, 10, 25, PP4_1_);
878  	STEP_SMALL(saved[12], saved[13], saved[14], saved[15],
879  		IF, 25,  4, PP4_2_);
880  #else
881  	STEP_SMALL(sc-&gt;state[ 0], sc-&gt;state[ 1], sc-&gt;state[ 2], sc-&gt;state[ 3],
882  		IF,  4, 13, PP4_2_);
883  	STEP_SMALL(sc-&gt;state[ 4], sc-&gt;state[ 5], sc-&gt;state[ 6], sc-&gt;state[ 7],
884  		IF, 13, 10, PP4_0_);
885  	STEP_SMALL(sc-&gt;state[ 8], sc-&gt;state[ 9], sc-&gt;state[10], sc-&gt;state[11],
886  		IF, 10, 25, PP4_1_);
887  	STEP_SMALL(sc-&gt;state[12], sc-&gt;state[13], sc-&gt;state[14], sc-&gt;state[15],
888  		IF, 25,  4, PP4_2_);
889  	WRITE_STATE_SMALL(sc);
890  #endif
891  }
892  #if SPH_SIMD_NOCOPY
893  #undef A0
894  #undef A1
895  #undef A2
896  #undef A3
897  #undef B0
898  #undef B1
899  #undef B2
900  #undef B3
901  #undef C0
902  #undef C1
903  #undef C2
904  #undef C3
905  #undef D0
906  #undef D1
907  #undef D2
908  #undef D3
909  #endif
910  #endif
911  #if SPH_SMALL_FOOTPRINT_SIMD
912  #define A0   state[ 0]
913  #define A1   state[ 1]
914  #define A2   state[ 2]
915  #define A3   state[ 3]
916  #define A4   state[ 4]
917  #define A5   state[ 5]
918  #define A6   state[ 6]
919  #define A7   state[ 7]
920  #define B0   state[ 8]
921  #define B1   state[ 9]
922  #define B2   state[10]
923  #define B3   state[11]
924  #define B4   state[12]
925  #define B5   state[13]
926  #define B6   state[14]
927  #define B7   state[15]
928  #define C0   state[16]
929  #define C1   state[17]
930  #define C2   state[18]
931  #define C3   state[19]
932  #define C4   state[20]
933  #define C5   state[21]
934  #define C6   state[22]
935  #define C7   state[23]
936  #define D0   state[24]
937  #define D1   state[25]
938  #define D2   state[26]
939  #define D3   state[27]
940  #define D4   state[28]
941  #define D5   state[29]
942  #define D6   state[30]
943  #define D7   state[31]
944  #define STEP2_BIG(w0, w1, w2, w3, w4, w5, w6, w7, fun, r, s, pp8b)   do { \
945  		u32 tA[8]; \
946  		tA[0] = ROL32(A0, r); \
947  		tA[1] = ROL32(A1, r); \
948  		tA[2] = ROL32(A2, r); \
949  		tA[3] = ROL32(A3, r); \
950  		tA[4] = ROL32(A4, r); \
951  		tA[5] = ROL32(A5, r); \
952  		tA[6] = ROL32(A6, r); \
953  		tA[7] = ROL32(A7, r); \
954  		STEP2_ELT(0, w0, fun, s, pp8b); \
955  		STEP2_ELT(1, w1, fun, s, pp8b); \
956  		STEP2_ELT(2, w2, fun, s, pp8b); \
957  		STEP2_ELT(3, w3, fun, s, pp8b); \
958  		STEP2_ELT(4, w4, fun, s, pp8b); \
959  		STEP2_ELT(5, w5, fun, s, pp8b); \
960  		STEP2_ELT(6, w6, fun, s, pp8b); \
961  		STEP2_ELT(7, w7, fun, s, pp8b); \
962  	} while (0)
963  static void
964  one_round_big(u32 *state, u32 *w, int isp, int p0, int p1, int p2, int p3)
965  {
966  	static const int pp8k[] = { 1, 6, 2, 3, 5, 7, 4, 1, 6, 2, 3 };
967  	STEP2_BIG(w[ 0], w[ 1], w[ 2], w[ 3], w[ 4], w[ 5], w[ 6], w[ 7],
968  		IF,  p0, p1, pp8k[isp + 0]);
969  	STEP2_BIG(w[ 8], w[ 9], w[10], w[11], w[12], w[13], w[14], w[15],
970  		IF,  p1, p2, pp8k[isp + 1]);
971  	STEP2_BIG(w[16], w[17], w[18], w[19], w[20], w[21], w[22], w[23],
972  		IF,  p2, p3, pp8k[isp + 2]);
973  	STEP2_BIG(w[24], w[25], w[26], w[27], w[28], w[29], w[30], w[31],
974  		IF,  p3, p0, pp8k[isp + 3]);
975  	STEP2_BIG(w[32], w[33], w[34], w[35], w[36], w[37], w[38], w[39],
976  		MAJ, p0, p1, pp8k[isp + 4]);
977  	STEP2_BIG(w[40], w[41], w[42], w[43], w[44], w[45], w[46], w[47],
978  		MAJ, p1, p2, pp8k[isp + 5]);
979  	STEP2_BIG(w[48], w[49], w[50], w[51], w[52], w[53], w[54], w[55],
980  		MAJ, p2, p3, pp8k[isp + 6]);
981  	STEP2_BIG(w[56], w[57], w[58], w[59], w[60], w[61], w[62], w[63],
982  		MAJ, p3, p0, pp8k[isp + 7]);
983  }
984  static void
985  compress_big(sph_simd_big_context *sc, int last)
986  {
987  	unsigned char *x;
988  	s32 q[256];
989  	int i;
990  	u32 w[64];
991  	u32 state[32];
992  	size_t u;
993  	static const size_t wbp[32] = {
994  		 4 &lt;&lt; 4,  6 &lt;&lt; 4,  0 &lt;&lt; 4,  2 &lt;&lt; 4,
995  		 7 &lt;&lt; 4,  5 &lt;&lt; 4,  3 &lt;&lt; 4,  1 &lt;&lt; 4,
996  		15 &lt;&lt; 4, 11 &lt;&lt; 4, 12 &lt;&lt; 4,  8 &lt;&lt; 4,
997  		 9 &lt;&lt; 4, 13 &lt;&lt; 4, 10 &lt;&lt; 4, 14 &lt;&lt; 4,
998  		17 &lt;&lt; 4, 18 &lt;&lt; 4, 23 &lt;&lt; 4, 20 &lt;&lt; 4,
999  		22 &lt;&lt; 4, 21 &lt;&lt; 4, 16 &lt;&lt; 4, 19 &lt;&lt; 4,
1000  		30 &lt;&lt; 4, 24 &lt;&lt; 4, 25 &lt;&lt; 4, 31 &lt;&lt; 4,
1001  		27 &lt;&lt; 4, 29 &lt;&lt; 4, 28 &lt;&lt; 4, 26 &lt;&lt; 4
1002  	};
1003  	x = sc-&gt;buf;
1004  	FFT256(0, 1, 0, ll);
1005  	if (last) {
1006  		for (i = 0; i &lt; 256; i ++) {
1007  			s32 tq;
1008  			tq = q[i] + yoff_b_f[i];
1009  			tq = REDS2(tq);
1010  			tq = REDS1(tq);
1011  			tq = REDS1(tq);
1012  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1013  		}
1014  	} else {
1015  		for (i = 0; i &lt; 256; i ++) {
1016  			s32 tq;
1017  			tq = q[i] + yoff_b_n[i];
1018  			tq = REDS2(tq);
1019  			tq = REDS1(tq);
1020  			tq = REDS1(tq);
1021  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1022  		}
1023  	}
1024  	for (i = 0; i &lt; 32; i += 8) {
1025  		state[i + 0] = sc-&gt;state[i + 0]
1026  			^ sph_dec32le_aligned(x + 4 * (i + 0));
1027  		state[i + 1] = sc-&gt;state[i + 1]
1028  			^ sph_dec32le_aligned(x + 4 * (i + 1));
1029  		state[i + 2] = sc-&gt;state[i + 2]
1030  			^ sph_dec32le_aligned(x + 4 * (i + 2));
1031  		state[i + 3] = sc-&gt;state[i + 3]
1032  			^ sph_dec32le_aligned(x + 4 * (i + 3));
1033  		state[i + 4] = sc-&gt;state[i + 4]
1034  			^ sph_dec32le_aligned(x + 4 * (i + 4));
1035  		state[i + 5] = sc-&gt;state[i + 5]
1036  			^ sph_dec32le_aligned(x + 4 * (i + 5));
1037  		state[i + 6] = sc-&gt;state[i + 6]
1038  			^ sph_dec32le_aligned(x + 4 * (i + 6));
1039  		state[i + 7] = sc-&gt;state[i + 7]
1040  			^ sph_dec32le_aligned(x + 4 * (i + 7));
1041  	}
1042  #define WBREAD(sb, o1, o2, mm)   do { \
1043  		for (u = 0; u &lt; 64; u += 8) { \
1044  			size_t v = wbp[(u &gt;&gt; 3) + (sb)]; \
1045  			w[u + 0] = INNER(q[v + 2 * 0 + (o1)], \
1046  				q[v + 2 * 0 + (o2)], mm); \
1047  			w[u + 1] = INNER(q[v + 2 * 1 + (o1)], \
1048  				q[v + 2 * 1 + (o2)], mm); \
1049  			w[u + 2] = INNER(q[v + 2 * 2 + (o1)], \
1050  				q[v + 2 * 2 + (o2)], mm); \
1051  			w[u + 3] = INNER(q[v + 2 * 3 + (o1)], \
1052  				q[v + 2 * 3 + (o2)], mm); \
1053  			w[u + 4] = INNER(q[v + 2 * 4 + (o1)], \
1054  				q[v + 2 * 4 + (o2)], mm); \
1055  			w[u + 5] = INNER(q[v + 2 * 5 + (o1)], \
1056  				q[v + 2 * 5 + (o2)], mm); \
1057  			w[u + 6] = INNER(q[v + 2 * 6 + (o1)], \
1058  				q[v + 2 * 6 + (o2)], mm); \
1059  			w[u + 7] = INNER(q[v + 2 * 7 + (o1)], \
1060  				q[v + 2 * 7 + (o2)], mm); \
1061  		} \
1062  	} while (0)
1063  	WBREAD( 0,    0,    1, 185);
1064  	one_round_big(state, w, 0,  3, 23, 17, 27);
1065  	WBREAD( 8,    0,    1, 185);
1066  	one_round_big(state, w, 1, 28, 19, 22,  7);
1067  	WBREAD(16, -256, -128, 233);
1068  	one_round_big(state, w, 2, 29,  9, 15,  5);
1069  	WBREAD(24, -383, -255, 233);
1070  	one_round_big(state, w, 3,  4, 13, 10, 25);
1071  #undef WBREAD
1072  	STEP_BIG(
1073  		sc-&gt;state[ 0], sc-&gt;state[ 1], sc-&gt;state[ 2], sc-&gt;state[ 3],
1074  		sc-&gt;state[ 4], sc-&gt;state[ 5], sc-&gt;state[ 6], sc-&gt;state[ 7],
1075  		IF,  4, 13, PP8_4_);
1076  	STEP_BIG(
1077  		sc-&gt;state[ 8], sc-&gt;state[ 9], sc-&gt;state[10], sc-&gt;state[11],
1078  		sc-&gt;state[12], sc-&gt;state[13], sc-&gt;state[14], sc-&gt;state[15],
1079  		IF, 13, 10, PP8_5_);
1080  	STEP_BIG(
1081  		sc-&gt;state[16], sc-&gt;state[17], sc-&gt;state[18], sc-&gt;state[19],
1082  		sc-&gt;state[20], sc-&gt;state[21], sc-&gt;state[22], sc-&gt;state[23],
1083  		IF, 10, 25, PP8_6_);
1084  	STEP_BIG(
1085  		sc-&gt;state[24], sc-&gt;state[25], sc-&gt;state[26], sc-&gt;state[27],
1086  		sc-&gt;state[28], sc-&gt;state[29], sc-&gt;state[30], sc-&gt;state[31],
1087  		IF, 25,  4, PP8_0_);
1088  	memcpy(sc-&gt;state, state, sizeof state);
1089  }
1090  #undef A0
1091  #undef A1
1092  #undef A2
1093  #undef A3
1094  #undef A4
1095  #undef A5
1096  #undef A6
1097  #undef A7
1098  #undef B0
1099  #undef B1
1100  #undef B2
1101  #undef B3
1102  #undef B4
1103  #undef B5
1104  #undef B6
1105  #undef B7
1106  #undef C0
1107  #undef C1
1108  #undef C2
1109  #undef C3
1110  #undef C4
1111  #undef C5
1112  #undef C6
1113  #undef C7
1114  #undef D0
1115  #undef D1
1116  #undef D2
1117  #undef D3
1118  #undef D4
1119  #undef D5
1120  #undef D6
1121  #undef D7
1122  #else
1123  #if SPH_SIMD_NOCOPY
1124  #define A0   (sc-&gt;state[ 0])
1125  #define A1   (sc-&gt;state[ 1])
1126  #define A2   (sc-&gt;state[ 2])
1127  #define A3   (sc-&gt;state[ 3])
1128  #define A4   (sc-&gt;state[ 4])
1129  #define A5   (sc-&gt;state[ 5])
1130  #define A6   (sc-&gt;state[ 6])
1131  #define A7   (sc-&gt;state[ 7])
1132  #define B0   (sc-&gt;state[ 8])
1133  #define B1   (sc-&gt;state[ 9])
1134  #define B2   (sc-&gt;state[10])
1135  #define B3   (sc-&gt;state[11])
1136  #define B4   (sc-&gt;state[12])
1137  #define B5   (sc-&gt;state[13])
1138  #define B6   (sc-&gt;state[14])
1139  #define B7   (sc-&gt;state[15])
1140  #define C0   (sc-&gt;state[16])
1141  #define C1   (sc-&gt;state[17])
1142  #define C2   (sc-&gt;state[18])
1143  #define C3   (sc-&gt;state[19])
1144  #define C4   (sc-&gt;state[20])
1145  #define C5   (sc-&gt;state[21])
1146  #define C6   (sc-&gt;state[22])
1147  #define C7   (sc-&gt;state[23])
1148  #define D0   (sc-&gt;state[24])
1149  #define D1   (sc-&gt;state[25])
1150  #define D2   (sc-&gt;state[26])
1151  #define D3   (sc-&gt;state[27])
1152  #define D4   (sc-&gt;state[28])
1153  #define D5   (sc-&gt;state[29])
1154  #define D6   (sc-&gt;state[30])
1155  #define D7   (sc-&gt;state[31])
1156  #endif
1157  static void
1158  compress_big(sph_simd_big_context *sc, int last)
1159  {
1160  	unsigned char *x;
1161  	s32 q[256];
1162  	int i;
1163  	DECL_STATE_BIG
1164  #if SPH_SIMD_NOCOPY
1165  	sph_u32 saved[32];
1166  #endif
1167  #if SPH_SIMD_NOCOPY
1168  	memcpy(saved, sc-&gt;state, sizeof saved);
1169  #endif
1170  	x = sc-&gt;buf;
1171  	FFT256(0, 1, 0, ll);
1172  	if (last) {
1173  		for (i = 0; i &lt; 256; i ++) {
1174  			s32 tq;
1175  			tq = q[i] + yoff_b_f[i];
1176  			tq = REDS2(tq);
1177  			tq = REDS1(tq);
1178  			tq = REDS1(tq);
1179  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1180  		}
1181  	} else {
1182  		for (i = 0; i &lt; 256; i ++) {
1183  			s32 tq;
1184  			tq = q[i] + yoff_b_n[i];
1185  			tq = REDS2(tq);
1186  			tq = REDS1(tq);
1187  			tq = REDS1(tq);
1188  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1189  		}
1190  	}
1191  	READ_STATE_BIG(sc);
1192  	A0 ^= sph_dec32le_aligned(x +   0);
1193  	A1 ^= sph_dec32le_aligned(x +   4);
1194  	A2 ^= sph_dec32le_aligned(x +   8);
1195  	A3 ^= sph_dec32le_aligned(x +  12);
1196  	A4 ^= sph_dec32le_aligned(x +  16);
1197  	A5 ^= sph_dec32le_aligned(x +  20);
1198  	A6 ^= sph_dec32le_aligned(x +  24);
1199  	A7 ^= sph_dec32le_aligned(x +  28);
1200  	B0 ^= sph_dec32le_aligned(x +  32);
1201  	B1 ^= sph_dec32le_aligned(x +  36);
1202  	B2 ^= sph_dec32le_aligned(x +  40);
1203  	B3 ^= sph_dec32le_aligned(x +  44);
1204  	B4 ^= sph_dec32le_aligned(x +  48);
1205  	B5 ^= sph_dec32le_aligned(x +  52);
1206  	B6 ^= sph_dec32le_aligned(x +  56);
1207  	B7 ^= sph_dec32le_aligned(x +  60);
1208  	C0 ^= sph_dec32le_aligned(x +  64);
1209  	C1 ^= sph_dec32le_aligned(x +  68);
1210  	C2 ^= sph_dec32le_aligned(x +  72);
1211  	C3 ^= sph_dec32le_aligned(x +  76);
1212  	C4 ^= sph_dec32le_aligned(x +  80);
1213  	C5 ^= sph_dec32le_aligned(x +  84);
1214  	C6 ^= sph_dec32le_aligned(x +  88);
1215  	C7 ^= sph_dec32le_aligned(x +  92);
1216  	D0 ^= sph_dec32le_aligned(x +  96);
1217  	D1 ^= sph_dec32le_aligned(x + 100);
1218  	D2 ^= sph_dec32le_aligned(x + 104);
1219  	D3 ^= sph_dec32le_aligned(x + 108);
1220  	D4 ^= sph_dec32le_aligned(x + 112);
1221  	D5 ^= sph_dec32le_aligned(x + 116);
1222  	D6 ^= sph_dec32le_aligned(x + 120);
1223  	D7 ^= sph_dec32le_aligned(x + 124);
1224  	ONE_ROUND_BIG(0_, 0,  3, 23, 17, 27);
1225  	ONE_ROUND_BIG(1_, 1, 28, 19, 22,  7);
1226  	ONE_ROUND_BIG(2_, 2, 29,  9, 15,  5);
1227  	ONE_ROUND_BIG(3_, 3,  4, 13, 10, 25);
1228  #if SPH_SIMD_NOCOPY
1229  	STEP_BIG(
1230  		saved[ 0], saved[ 1], saved[ 2], saved[ 3],
1231  		saved[ 4], saved[ 5], saved[ 6], saved[ 7],
1232  		IF,  4, 13, PP8_4_);
1233  	STEP_BIG(
1234  		saved[ 8], saved[ 9], saved[10], saved[11],
1235  		saved[12], saved[13], saved[14], saved[15],
1236  		IF, 13, 10, PP8_5_);
1237  	STEP_BIG(
1238  		saved[16], saved[17], saved[18], saved[19],
1239  		saved[20], saved[21], saved[22], saved[23],
1240  		IF, 10, 25, PP8_6_);
1241  	STEP_BIG(
1242  		saved[24], saved[25], saved[26], saved[27],
1243  		saved[28], saved[29], saved[30], saved[31],
1244  		IF, 25,  4, PP8_0_);
1245  #else
1246  	STEP_BIG(
1247  		sc-&gt;state[ 0], sc-&gt;state[ 1], sc-&gt;state[ 2], sc-&gt;state[ 3],
1248  		sc-&gt;state[ 4], sc-&gt;state[ 5], sc-&gt;state[ 6], sc-&gt;state[ 7],
1249  		IF,  4, 13, PP8_4_);
1250  	STEP_BIG(
1251  		sc-&gt;state[ 8], sc-&gt;state[ 9], sc-&gt;state[10], sc-&gt;state[11],
1252  		sc-&gt;state[12], sc-&gt;state[13], sc-&gt;state[14], sc-&gt;state[15],
1253  		IF, 13, 10, PP8_5_);
1254  	STEP_BIG(
1255  		sc-&gt;state[16], sc-&gt;state[17], sc-&gt;state[18], sc-&gt;state[19],
1256  		sc-&gt;state[20], sc-&gt;state[21], sc-&gt;state[22], sc-&gt;state[23],
1257  		IF, 10, 25, PP8_6_);
1258  	STEP_BIG(
1259  		sc-&gt;state[24], sc-&gt;state[25], sc-&gt;state[26], sc-&gt;state[27],
1260  		sc-&gt;state[28], sc-&gt;state[29], sc-&gt;state[30], sc-&gt;state[31],
1261  		IF, 25,  4, PP8_0_);
1262  	WRITE_STATE_BIG(sc);
1263  #endif
1264  }
1265  #if SPH_SIMD_NOCOPY
1266  #undef A0
1267  #undef A1
1268  #undef A2
1269  #undef A3
1270  #undef A4
1271  #undef A5
1272  #undef A6
1273  #undef A7
1274  #undef B0
1275  #undef B1
1276  #undef B2
1277  #undef B3
1278  #undef B4
1279  #undef B5
1280  #undef B6
1281  #undef B7
1282  #undef C0
1283  #undef C1
1284  #undef C2
1285  #undef C3
1286  #undef C4
1287  #undef C5
1288  #undef C6
1289  #undef C7
1290  #undef D0
1291  #undef D1
1292  #undef D2
1293  #undef D3
1294  #undef D4
1295  #undef D5
1296  #undef D6
1297  #undef D7
1298  #endif
1299  #endif
1300  static const u32 IV224[] = {
1301  	C32(0x33586E9F), C32(0x12FFF033), C32(0xB2D9F64D), C32(0x6F8FEA53),
1302  	C32(0xDE943106), C32(0x2742E439), C32(0x4FBAB5AC), C32(0x62B9FF96),
1303  	C32(0x22E7B0AF), C32(0xC862B3A8), C32(0x33E00CDC), C32(0x236B86A6),
1304  	C32(0xF64AE77C), C32(0xFA373B76), C32(0x7DC1EE5B), C32(0x7FB29CE8)
1305  };
1306  static const u32 IV256[] = {
1307  	C32(0x4D567983), C32(0x07190BA9), C32(0x8474577B), C32(0x39D726E9),
1308  	C32(0xAAF3D925), C32(0x3EE20B03), C32(0xAFD5E751), C32(0xC96006D3),
1309  	C32(0xC2C2BA14), C32(0x49B3BCB4), C32(0xF67CAF46), C32(0x668626C9),
1310  	C32(0xE2EAA8D2), C32(0x1FF47833), C32(0xD0C661A5), C32(0x55693DE1)
1311  };
1312  static const u32 IV384[] = {
1313  	C32(0x8A36EEBC), C32(0x94A3BD90), C32(0xD1537B83), C32(0xB25B070B),
1314  	C32(0xF463F1B5), C32(0xB6F81E20), C32(0x0055C339), C32(0xB4D144D1),
1315  	C32(0x7360CA61), C32(0x18361A03), C32(0x17DCB4B9), C32(0x3414C45A),
1316  	C32(0xA699A9D2), C32(0xE39E9664), C32(0x468BFE77), C32(0x51D062F8),
1317  	C32(0xB9E3BFE8), C32(0x63BECE2A), C32(0x8FE506B9), C32(0xF8CC4AC2),
1318  	C32(0x7AE11542), C32(0xB1AADDA1), C32(0x64B06794), C32(0x28D2F462),
1319  	C32(0xE64071EC), C32(0x1DEB91A8), C32(0x8AC8DB23), C32(0x3F782AB5),
1320  	C32(0x039B5CB8), C32(0x71DDD962), C32(0xFADE2CEA), C32(0x1416DF71)
1321  };
1322  static const u32 IV512[] = {
1323  	C32(0x0BA16B95), C32(0x72F999AD), C32(0x9FECC2AE), C32(0xBA3264FC),
1324  	C32(0x5E894929), C32(0x8E9F30E5), C32(0x2F1DAA37), C32(0xF0F2C558),
1325  	C32(0xAC506643), C32(0xA90635A5), C32(0xE25B878B), C32(0xAAB7878F),
1326  	C32(0x88817F7A), C32(0x0A02892B), C32(0x559A7550), C32(0x598F657E),
1327  	C32(0x7EEF60A1), C32(0x6B70E3E8), C32(0x9C1714D1), C32(0xB958E2A8),
1328  	C32(0xAB02675E), C32(0xED1C014F), C32(0xCD8D65BB), C32(0xFDB7A257),
1329  	C32(0x09254899), C32(0xD699C7BC), C32(0x9019B6DC), C32(0x2B9022E4),
1330  	C32(0x8FA14956), C32(0x21BF9BD3), C32(0xB94D0943), C32(0x6FFDDC22)
1331  };
1332  static void
1333  init_small(void *cc, const u32 *iv)
1334  {
1335  	sph_simd_small_context *sc;
1336  	sc = cc;
1337  	memcpy(sc-&gt;state, iv, sizeof sc-&gt;state);
1338  	sc-&gt;count_low = sc-&gt;count_high = 0;
1339  	sc-&gt;ptr = 0;
1340  }
1341  static void
1342  init_big(void *cc, const u32 *iv)
1343  {
1344  	sph_simd_big_context *sc;
1345  	sc = cc;
1346  	memcpy(sc-&gt;state, iv, sizeof sc-&gt;state);
1347  	sc-&gt;count_low = sc-&gt;count_high = 0;
1348  	sc-&gt;ptr = 0;
1349  }
1350  static void
1351  update_small(void *cc, const void *data, size_t len)
1352  {
1353  	sph_simd_small_context *sc;
1354  	sc = cc;
1355  	while (len &gt; 0) {
1356  		size_t clen;
1357  		clen = (sizeof sc-&gt;buf) - sc-&gt;ptr;
1358  		if (clen &gt; len)
1359  			clen = len;
1360  		memcpy(sc-&gt;buf + sc-&gt;ptr, data, clen);
1361  		data = (const unsigned char *)data + clen;
1362  		len -= clen;
1363  		if ((sc-&gt;ptr += clen) == sizeof sc-&gt;buf) {
1364  			compress_small(sc, 0);
1365  			sc-&gt;ptr = 0;
1366  			sc-&gt;count_low = T32(sc-&gt;count_low + 1);
1367  			if (sc-&gt;count_low == 0)
1368  				sc-&gt;count_high ++;
1369  		}
1370  	}
1371  }
1372  static void
1373  update_big(void *cc, const void *data, size_t len)
1374  {
1375  	sph_simd_big_context *sc;
1376  	sc = cc;
1377  	while (len &gt; 0) {
1378  		size_t clen;
1379  		clen = (sizeof sc-&gt;buf) - sc-&gt;ptr;
1380  		if (clen &gt; len)
1381  			clen = len;
1382  		memcpy(sc-&gt;buf + sc-&gt;ptr, data, clen);
1383  		data = (const unsigned char *)data + clen;
1384  		len -= clen;
1385  		if ((sc-&gt;ptr += clen) == sizeof sc-&gt;buf) {
1386  			compress_big(sc, 0);
1387  			sc-&gt;ptr = 0;
1388  			sc-&gt;count_low = T32(sc-&gt;count_low + 1);
1389  			if (sc-&gt;count_low == 0)
1390  				sc-&gt;count_high ++;
1391  		}
1392  	}
1393  }
1394  static void
1395  encode_count_small(unsigned char *dst,
1396  	u32 low, u32 high, size_t ptr, unsigned n)
1397  {
1398  	low = T32(low &lt;&lt; 9);
1399  	high = T32(high &lt;&lt; 9) + (low &gt;&gt; 23);
1400  	low += (ptr &lt;&lt; 3) + n;
1401  	sph_enc32le(dst, low);
1402  	sph_enc32le(dst + 4, high);
1403  }
1404  static void
1405  encode_count_big(unsigned char *dst,
1406  	u32 low, u32 high, size_t ptr, unsigned n)
1407  {
1408  	low = T32(low &lt;&lt; 10);
1409  	high = T32(high &lt;&lt; 10) + (low &gt;&gt; 22);
1410  	low += (ptr &lt;&lt; 3) + n;
1411  	sph_enc32le(dst, low);
1412  	sph_enc32le(dst + 4, high);
1413  }
1414  static void
1415  finalize_small(void *cc, unsigned ub, unsigned n, void *dst, size_t dst_len)
1416  {
1417  	sph_simd_small_context *sc;
1418  	unsigned char *d;
1419  	size_t u;
1420  	sc = cc;
1421  	if (sc-&gt;ptr &gt; 0 || n &gt; 0) {
1422  		memset(sc-&gt;buf + sc-&gt;ptr, 0,
1423  			(sizeof sc-&gt;buf) - sc-&gt;ptr);
1424  		sc-&gt;buf[sc-&gt;ptr] = ub &amp; (0xFF &lt;&lt; (8 - n));
1425  		compress_small(sc, 0);
1426  	}
1427  	memset(sc-&gt;buf, 0, sizeof sc-&gt;buf);
1428  	encode_count_small(sc-&gt;buf, sc-&gt;count_low, sc-&gt;count_high, sc-&gt;ptr, n);
1429  	compress_small(sc, 1);
1430  	d = dst;
1431  	for (d = dst, u = 0; u &lt; dst_len; u ++)
1432  		sph_enc32le(d + (u &lt;&lt; 2), sc-&gt;state[u]);
1433  }
1434  static void
1435  finalize_big(void *cc, unsigned ub, unsigned n, void *dst, size_t dst_len)
1436  {
1437  	sph_simd_big_context *sc;
1438  	unsigned char *d;
1439  	size_t u;
1440  	sc = cc;
1441  	if (sc-&gt;ptr &gt; 0 || n &gt; 0) {
1442  		memset(sc-&gt;buf + sc-&gt;ptr, 0,
1443  			(sizeof sc-&gt;buf) - sc-&gt;ptr);
1444  		sc-&gt;buf[sc-&gt;ptr] = ub &amp; (0xFF &lt;&lt; (8 - n));
1445  		compress_big(sc, 0);
1446  	}
1447  	memset(sc-&gt;buf, 0, sizeof sc-&gt;buf);
1448  	encode_count_big(sc-&gt;buf, sc-&gt;count_low, sc-&gt;count_high, sc-&gt;ptr, n);
1449  	compress_big(sc, 1);
1450  	d = dst;
1451  	for (d = dst, u = 0; u &lt; dst_len; u ++)
1452  		sph_enc32le(d + (u &lt;&lt; 2), sc-&gt;state[u]);
1453  }
1454  void
1455  sph_simd224_init(void *cc)
1456  {
1457  	init_small(cc, IV224);
1458  }
1459  void
1460  sph_simd224(void *cc, const void *data, size_t len)
1461  {
1462  	update_small(cc, data, len);
1463  }
1464  void
1465  sph_simd224_close(void *cc, void *dst)
1466  {
1467  	sph_simd224_addbits_and_close(cc, 0, 0, dst);
1468  }
1469  void
1470  sph_simd224_addbits_and_close(void *cc, unsigned ub, unsigned n, void *dst)
1471  {
1472  	finalize_small(cc, ub, n, dst, 7);
1473  	sph_simd224_init(cc);
1474  }
1475  void
1476  sph_simd256_init(void *cc)
1477  {
1478  	init_small(cc, IV256);
1479  }
1480  void
1481  sph_simd256(void *cc, const void *data, size_t len)
1482  {
1483  	update_small(cc, data, len);
1484  }
1485  void
1486  sph_simd256_close(void *cc, void *dst)
1487  {
1488  	sph_simd256_addbits_and_close(cc, 0, 0, dst);
1489  }
1490  void
1491  sph_simd256_addbits_and_close(void *cc, unsigned ub, unsigned n, void *dst)
1492  {
1493  	finalize_small(cc, ub, n, dst, 8);
1494  	sph_simd256_init(cc);
1495  }
1496  void
1497  sph_simd384_init(void *cc)
1498  {
1499  	init_big(cc, IV384);
1500  }
1501  void
1502  sph_simd384(void *cc, const void *data, size_t len)
1503  {
1504  	update_big(cc, data, len);
1505  }
1506  void
1507  sph_simd384_close(void *cc, void *dst)
1508  {
1509  	sph_simd384_addbits_and_close(cc, 0, 0, dst);
1510  }
1511  void
1512  sph_simd384_addbits_and_close(void *cc, unsigned ub, unsigned n, void *dst)
1513  {
1514  	finalize_big(cc, ub, n, dst, 12);
1515  	sph_simd384_init(cc);
1516  }
1517  void
1518  sph_simd512_init(void *cc)
1519  {
1520  	init_big(cc, IV512);
1521  }
1522  void
1523  sph_simd512(void *cc, const void *data, size_t len)
1524  {
1525  	update_big(cc, data, len);
1526  }
1527  void
1528  sph_simd512_close(void *cc, void *dst)
1529  {
1530  	sph_simd512_addbits_and_close(cc, 0, 0, dst);
1531  }
1532  void
1533  sph_simd512_addbits_and_close(void *cc, unsigned ub, unsigned n, void *dst)
1534  {
1535  	finalize_big(cc, ub, n, dst, 16);
1536  	sph_simd512_init(cc);
1537  }
1538  #ifdef __cplusplus
1539  }
1540  #endif
</code></pre>
        </div>
        <div class="column">
            <h3>xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-sph_simd.c</h3>
            <pre><code>1  #include &lt;stddef.h&gt;
2  #include &lt;string.h&gt;
3  #include &lt;limits.h&gt;
4  #include &quot;sph_simd.h&quot;
5  #ifdef __cplusplus
6  extern &quot;C&quot;{
7  #endif
8  #if SPH_SMALL_FOOTPRINT &amp;&amp; !defined SPH_SMALL_FOOTPRINT_SIMD
9  #define SPH_SMALL_FOOTPRINT_SIMD   1
10  #endif
11  #ifdef _MSC_VER
12  #pragma warning (disable: 4146)
13  #endif
14  typedef sph_u32 u32;
15  typedef sph_s32 s32;
16  #define C32     SPH_C32
17  #define T32     SPH_T32
18  #define ROL32   SPH_ROTL32
19  #define XCAT(x, y)    XCAT_(x, y)
20  #define XCAT_(x, y)   x ## y
21  static const s32 alpha_tab[] = {
22  	  1,  41, 139,  45,  46,  87, 226,  14,  60, 147, 116, 130,
23  	190,  80, 196,  69,   2,  82,  21,  90,  92, 174, 195,  28,
24  	120,  37, 232,   3, 123, 160, 135, 138,   4, 164,  42, 180,
25  	184,  91, 133,  56, 240,  74, 207,   6, 246,  63,  13,  19,
26  	  8,  71,  84, 103, 111, 182,   9, 112, 223, 148, 157,  12,
27  	235, 126,  26,  38,  16, 142, 168, 206, 222, 107,  18, 224,
28  	189,  39,  57,  24, 213, 252,  52,  76,  32,  27,  79, 155,
29  	187, 214,  36, 191, 121,  78, 114,  48, 169, 247, 104, 152,
30  	 64,  54, 158,  53, 117, 171,  72, 125, 242, 156, 228,  96,
31  	 81, 237, 208,  47, 128, 108,  59, 106, 234,  85, 144, 250,
32  	227,  55, 199, 192, 162, 217, 159,  94, 256, 216, 118, 212,
33  	211, 170,  31, 243, 197, 110, 141, 127,  67, 177,  61, 188,
34  	255, 175, 236, 167, 165,  83,  62, 229, 137, 220,  25, 254,
35  	134,  97, 122, 119, 253,  93, 215,  77,  73, 166, 124, 201,
36  	 17, 183,  50, 251,  11, 194, 244, 238, 249, 186, 173, 154,
37  	146,  75, 248, 145,  34, 109, 100, 245,  22, 131, 231, 219,
38  	241, 115,  89,  51,  35, 150, 239,  33,  68, 218, 200, 233,
39  	 44,   5, 205, 181, 225, 230, 178, 102,  70,  43, 221,  66,
40  	136, 179, 143, 209,  88,  10, 153, 105, 193, 203,  99, 204,
41  	140,  86, 185, 132,  15, 101,  29, 161, 176,  20,  49, 210,
42  	129, 149, 198, 151,  23, 172, 113,   7,  30, 202,  58,  65,
43  	 95,  40,  98, 163
44  };
45  #define REDS1(x)    (((x) &amp; 0xFF) - ((x) &gt;&gt; 8))
46  #define REDS2(x)    (((x) &amp; 0xFFFF) + ((x) &gt;&gt; 16))
47  #define FFT_LOOP(rb, hk, as, id)   do { \
48  		size_t u, v; \
49  		s32 m = q[(rb)]; \
50  		s32 n = q[(rb) + (hk)]; \
51  		q[(rb)] = m + n; \
52  		q[(rb) + (hk)] = m - n; \
53  		u = v = 0; \
54  		goto id; \
55  		for (; u &lt; (hk); u += 4, v += 4 * (as)) { \
56  			s32 t; \
57  			m = q[(rb) + u + 0]; \
58  			n = q[(rb) + u + 0 + (hk)]; \
59  			t = REDS2(n * alpha_tab[v + 0 * (as)]); \
60  			q[(rb) + u + 0] = m + t; \
61  			q[(rb) + u + 0 + (hk)] = m - t; \
62  		id: \
63  			m = q[(rb) + u + 1]; \
64  			n = q[(rb) + u + 1 + (hk)]; \
65  			t = REDS2(n * alpha_tab[v + 1 * (as)]); \
66  			q[(rb) + u + 1] = m + t; \
67  			q[(rb) + u + 1 + (hk)] = m - t; \
68  			m = q[(rb) + u + 2]; \
69  			n = q[(rb) + u + 2 + (hk)]; \
70  			t = REDS2(n * alpha_tab[v + 2 * (as)]); \
71  			q[(rb) + u + 2] = m + t; \
72  			q[(rb) + u + 2 + (hk)] = m - t; \
73  			m = q[(rb) + u + 3]; \
74  			n = q[(rb) + u + 3 + (hk)]; \
75  			t = REDS2(n * alpha_tab[v + 3 * (as)]); \
76  			q[(rb) + u + 3] = m + t; \
77  			q[(rb) + u + 3 + (hk)] = m - t; \
78  		} \
79  	} while (0)
80  #define FFT8(xb, xs, d)   do { \
81  		s32 x0 = x[(xb)]; \
82  		s32 x1 = x[(xb) + (xs)]; \
83  		s32 x2 = x[(xb) + 2 * (xs)]; \
84  		s32 x3 = x[(xb) + 3 * (xs)]; \
85  		s32 a0 = x0 + x2; \
86  		s32 a1 = x0 + (x2 &lt;&lt; 4); \
87  		s32 a2 = x0 - x2; \
88  		s32 a3 = x0 - (x2 &lt;&lt; 4); \
89  		s32 b0 = x1 + x3; \
90  		s32 b1 = REDS1((x1 &lt;&lt; 2) + (x3 &lt;&lt; 6)); \
91  		s32 b2 = (x1 &lt;&lt; 4) - (x3 &lt;&lt; 4); \
92  		s32 b3 = REDS1((x1 &lt;&lt; 6) + (x3 &lt;&lt; 2)); \
93  		d ## 0 = a0 + b0; \
94  		d ## 1 = a1 + b1; \
95  		d ## 2 = a2 + b2; \
96  		d ## 3 = a3 + b3; \
97  		d ## 4 = a0 - b0; \
98  		d ## 5 = a1 - b1; \
99  		d ## 6 = a2 - b2; \
100  		d ## 7 = a3 - b3; \
101  	} while (0)
102  #define FFT16(xb, xs, rb)   do { \
103  		s32 d1_0, d1_1, d1_2, d1_3, d1_4, d1_5, d1_6, d1_7; \
104  		s32 d2_0, d2_1, d2_2, d2_3, d2_4, d2_5, d2_6, d2_7; \
105  		FFT8(xb, (xs) &lt;&lt; 1, d1_); \
106  		FFT8((xb) + (xs), (xs) &lt;&lt; 1, d2_); \
107  		q[(rb) +  0] = d1_0 + d2_0; \
108  		q[(rb) +  1] = d1_1 + (d2_1 &lt;&lt; 1); \
109  		q[(rb) +  2] = d1_2 + (d2_2 &lt;&lt; 2); \
110  		q[(rb) +  3] = d1_3 + (d2_3 &lt;&lt; 3); \
111  		q[(rb) +  4] = d1_4 + (d2_4 &lt;&lt; 4); \
112  		q[(rb) +  5] = d1_5 + (d2_5 &lt;&lt; 5); \
113  		q[(rb) +  6] = d1_6 + (d2_6 &lt;&lt; 6); \
114  		q[(rb) +  7] = d1_7 + (d2_7 &lt;&lt; 7); \
115  		q[(rb) +  8] = d1_0 - d2_0; \
116  		q[(rb) +  9] = d1_1 - (d2_1 &lt;&lt; 1); \
117  		q[(rb) + 10] = d1_2 - (d2_2 &lt;&lt; 2); \
118  		q[(rb) + 11] = d1_3 - (d2_3 &lt;&lt; 3); \
119  		q[(rb) + 12] = d1_4 - (d2_4 &lt;&lt; 4); \
120  		q[(rb) + 13] = d1_5 - (d2_5 &lt;&lt; 5); \
121  		q[(rb) + 14] = d1_6 - (d2_6 &lt;&lt; 6); \
122  		q[(rb) + 15] = d1_7 - (d2_7 &lt;&lt; 7); \
123  	} while (0)
124  #define FFT32(xb, xs, rb, id)   do { \
125  		FFT16(xb, (xs) &lt;&lt; 1, rb); \
126  		FFT16((xb) + (xs), (xs) &lt;&lt; 1, (rb) + 16); \
127  		FFT_LOOP(rb, 16, 8, id); \
128  	} while (0)
129  #define FFT64(xb, xs, rb, id)   do { \
130  		FFT32(xb, (xs) &lt;&lt; 1, rb, XCAT(id, a)); \
131  		FFT32((xb) + (xs), (xs) &lt;&lt; 1, (rb) + 32, XCAT(id, b)); \
132  		FFT_LOOP(rb, 32, 4, id); \
133  	} while (0)
134  #if SPH_SMALL_FOOTPRINT_SIMD
135  static void
136  fft32(unsigned char *x, size_t xs, s32 *q)
137  {
138  	size_t xd;
139  	xd = xs &lt;&lt; 1;
140  	FFT16(0, xd, 0);
141  	FFT16(xs, xd, 16);
142  	FFT_LOOP(0, 16, 8, label_);
143  }
144  #define FFT128(xb, xs, rb, id)   do { \
145  		fft32(x + (xb) + ((xs) * 0), (xs) &lt;&lt; 2, &amp;q[(rb) +  0]); \
146  		fft32(x + (xb) + ((xs) * 2), (xs) &lt;&lt; 2, &amp;q[(rb) + 32]); \
147  		FFT_LOOP(rb, 32, 4, XCAT(id, aa)); \
148  		fft32(x + (xb) + ((xs) * 1), (xs) &lt;&lt; 2, &amp;q[(rb) + 64]); \
149  		fft32(x + (xb) + ((xs) * 3), (xs) &lt;&lt; 2, &amp;q[(rb) + 96]); \
150  		FFT_LOOP((rb) + 64, 32, 4, XCAT(id, ab)); \
151  		FFT_LOOP(rb, 64, 2, XCAT(id, a)); \
152  	} while (0)
153  #else
154  #define FFT128(xb, xs, rb, id)   do { \
155  		FFT64(xb, (xs) &lt;&lt; 1, rb, XCAT(id, a)); \
156  		FFT64((xb) + (xs), (xs) &lt;&lt; 1, (rb) + 64, XCAT(id, b)); \
157  		FFT_LOOP(rb, 64, 2, id); \
158  	} while (0)
159  #endif
160  static void
161  fft64(unsigned char *x, size_t xs, s32 *q)
162  {
163  	size_t xd;
164  	xd = xs &lt;&lt; 1;
165  	FFT32(0, xd, 0, label_a);
166  	FFT32(xs, xd, 32, label_b);
167  	FFT_LOOP(0, 32, 4, label_);
168  }
169  #define FFT256(xb, xs, rb, id)   do { \
170  		fft64(x + (xb) + ((xs) * 0), (xs) &lt;&lt; 2, &amp;q[(rb) +   0]); \
171  		fft64(x + (xb) + ((xs) * 2), (xs) &lt;&lt; 2, &amp;q[(rb) +  64]); \
172  		FFT_LOOP(rb, 64, 2, XCAT(id, aa)); \
173  		fft64(x + (xb) + ((xs) * 1), (xs) &lt;&lt; 2, &amp;q[(rb) + 128]); \
174  		fft64(x + (xb) + ((xs) * 3), (xs) &lt;&lt; 2, &amp;q[(rb) + 192]); \
175  		FFT_LOOP((rb) + 128, 64, 2, XCAT(id, ab)); \
176  		FFT_LOOP(rb, 128, 1, XCAT(id, a)); \
177  	} while (0)
178  static const unsigned short yoff_s_n[] = {
179  	  1,  98,  95,  58,  30, 113,  23, 198, 129,  49, 176,  29,
180  	 15, 185, 140,  99, 193, 153,  88, 143, 136, 221,  70, 178,
181  	225, 205,  44, 200,  68, 239,  35,  89, 241, 231,  22, 100,
182  	 34, 248, 146, 173, 249, 244,  11,  50,  17, 124,  73, 215,
183  	253, 122, 134,  25, 137,  62, 165, 236, 255,  61,  67, 141,
184  	197,  31, 211, 118, 256, 159, 162, 199, 227, 144, 234,  59,
185  	128, 208,  81, 228, 242,  72, 117, 158,  64, 104, 169, 114,
186  	121,  36, 187,  79,  32,  52, 213,  57, 189,  18, 222, 168,
187  	 16,  26, 235, 157, 223,   9, 111,  84,   8,  13, 246, 207,
188  	240, 133, 184,  42,   4, 135, 123, 232, 120, 195,  92,  21,
189  	  2, 196, 190, 116,  60, 226,  46, 139
190  };
191  static const unsigned short yoff_s_f[] = {
192  	  2, 156, 118, 107,  45, 212, 111, 162,  97, 249, 211,   3,
193  	 49, 101, 151, 223, 189, 178, 253, 204,  76,  82, 232,  65,
194  	 96, 176, 161,  47, 189,  61, 248, 107,   0, 131, 133, 113,
195  	 17,  33,  12, 111, 251, 103,  57, 148,  47,  65, 249, 143,
196  	189,   8, 204, 230, 205, 151, 187, 227, 247, 111, 140,   6,
197  	 77,  10,  21, 149, 255, 101, 139, 150, 212,  45, 146,  95,
198  	160,   8,  46, 254, 208, 156, 106,  34,  68,  79,   4,  53,
199  	181, 175,  25, 192, 161,  81,  96, 210,  68, 196,   9, 150,
200  	  0, 126, 124, 144, 240, 224, 245, 146,   6, 154, 200, 109,
201  	210, 192,   8, 114,  68, 249,  53,  27,  52, 106,  70,  30,
202  	 10, 146, 117, 251, 180, 247, 236, 108
203  };
204  static const unsigned short yoff_b_n[] = {
205  	  1, 163,  98,  40,  95,  65,  58, 202,  30,   7, 113, 172,
206  	 23, 151, 198, 149, 129, 210,  49,  20, 176, 161,  29, 101,
207  	 15, 132, 185,  86, 140, 204,  99, 203, 193, 105, 153,  10,
208  	 88, 209, 143, 179, 136,  66, 221,  43,  70, 102, 178, 230,
209  	225, 181, 205,   5,  44, 233, 200, 218,  68,  33, 239, 150,
210  	 35,  51,  89, 115, 241, 219, 231, 131,  22, 245, 100, 109,
211  	 34, 145, 248,  75, 146, 154, 173, 186, 249, 238, 244, 194,
212  	 11, 251,  50, 183,  17, 201, 124, 166,  73,  77, 215,  93,
213  	253, 119, 122,  97, 134, 254,  25, 220, 137, 229,  62,  83,
214  	165, 167, 236, 175, 255, 188,  61, 177,  67, 127, 141, 110,
215  	197, 243,  31, 170, 211, 212, 118, 216, 256,  94, 159, 217,
216  	162, 192, 199,  55, 227, 250, 144,  85, 234, 106,  59, 108,
217  	128,  47, 208, 237,  81,  96, 228, 156, 242, 125,  72, 171,
218  	117,  53, 158,  54,  64, 152, 104, 247, 169,  48, 114,  78,
219  	121, 191,  36, 214, 187, 155,  79,  27,  32,  76,  52, 252,
220  	213,  24,  57,  39, 189, 224,  18, 107, 222, 206, 168, 142,
221  	 16,  38,  26, 126, 235,  12, 157, 148, 223, 112,   9, 182,
222  	111, 103,  84,  71,   8,  19,  13,  63, 246,   6, 207,  74,
223  	240,  56, 133,  91, 184, 180,  42, 164,   4, 138, 135, 160,
224  	123,   3, 232,  37, 120,  28, 195, 174,  92,  90,  21,  82,
225  	  2,  69, 196,  80, 190, 130, 116, 147,  60,  14, 226,  87,
226  	 46,  45, 139,  41
227  };
228  static const unsigned short yoff_b_f[] = {
229  	  2, 203, 156,  47, 118, 214, 107, 106,  45,  93, 212,  20,
230  	111,  73, 162, 251,  97, 215, 249,  53, 211,  19,   3,  89,
231  	 49, 207, 101,  67, 151, 130, 223,  23, 189, 202, 178, 239,
232  	253, 127, 204,  49,  76, 236,  82, 137, 232, 157,  65,  79,
233  	 96, 161, 176, 130, 161,  30,  47,   9, 189, 247,  61, 226,
234  	248,  90, 107,  64,   0,  88, 131, 243, 133,  59, 113, 115,
235  	 17, 236,  33, 213,  12, 191, 111,  19, 251,  61, 103, 208,
236  	 57,  35, 148, 248,  47, 116,  65, 119, 249, 178, 143,  40,
237  	189, 129,   8, 163, 204, 227, 230, 196, 205, 122, 151,  45,
238  	187,  19, 227,  72, 247, 125, 111, 121, 140, 220,   6, 107,
239  	 77,  69,  10, 101,  21,  65, 149, 171, 255,  54, 101, 210,
240  	139,  43, 150, 151, 212, 164,  45, 237, 146, 184,  95,   6,
241  	160,  42,   8, 204,  46, 238, 254, 168, 208,  50, 156, 190,
242  	106, 127,  34, 234,  68,  55,  79,  18,   4, 130,  53, 208,
243  	181,  21, 175, 120,  25, 100, 192, 178, 161,  96,  81, 127,
244  	 96, 227, 210, 248,  68,  10, 196,  31,   9, 167, 150, 193,
245  	  0, 169, 126,  14, 124, 198, 144, 142, 240,  21, 224,  44,
246  	245,  66, 146, 238,   6, 196, 154,  49, 200, 222, 109,   9,
247  	210, 141, 192, 138,   8,  79, 114, 217,  68, 128, 249,  94,
248  	 53,  30,  27,  61,  52, 135, 106, 212,  70, 238,  30, 185,
249  	 10, 132, 146, 136, 117,  37, 251, 150, 180, 188, 247, 156,
250  	236, 192, 108,  86
251  };
252  #define INNER(l, h, mm)   (((u32)((l) * (mm)) &amp; 0xFFFFU) \
253                            + ((u32)((h) * (mm)) &lt;&lt; 16))
254  #define W_SMALL(sb, o1, o2, mm) \
255  	(INNER(q[8 * (sb) + 2 * 0 + o1], q[8 * (sb) + 2 * 0 + o2], mm), \
256  	 INNER(q[8 * (sb) + 2 * 1 + o1], q[8 * (sb) + 2 * 1 + o2], mm), \
257  	 INNER(q[8 * (sb) + 2 * 2 + o1], q[8 * (sb) + 2 * 2 + o2], mm), \
258  	 INNER(q[8 * (sb) + 2 * 3 + o1], q[8 * (sb) + 2 * 3 + o2], mm)
259  #define WS_0_0   W_SMALL( 4,    0,    1, 185)
260  #define WS_0_1   W_SMALL( 6,    0,    1, 185)
261  #define WS_0_2   W_SMALL( 0,    0,    1, 185)
262  #define WS_0_3   W_SMALL( 2,    0,    1, 185)
263  #define WS_0_4   W_SMALL( 7,    0,    1, 185)
264  #define WS_0_5   W_SMALL( 5,    0,    1, 185)
265  #define WS_0_6   W_SMALL( 3,    0,    1, 185)
266  #define WS_0_7   W_SMALL( 1,    0,    1, 185)
267  #define WS_1_0   W_SMALL(15,    0,    1, 185)
268  #define WS_1_1   W_SMALL(11,    0,    1, 185)
269  #define WS_1_2   W_SMALL(12,    0,    1, 185)
270  #define WS_1_3   W_SMALL( 8,    0,    1, 185)
271  #define WS_1_4   W_SMALL( 9,    0,    1, 185)
272  #define WS_1_5   W_SMALL(13,    0,    1, 185)
273  #define WS_1_6   W_SMALL(10,    0,    1, 185)
274  #define WS_1_7   W_SMALL(14,    0,    1, 185)
275  #define WS_2_0   W_SMALL(17, -128,  -64, 233)
276  #define WS_2_1   W_SMALL(18, -128,  -64, 233)
277  #define WS_2_2   W_SMALL(23, -128,  -64, 233)
278  #define WS_2_3   W_SMALL(20, -128,  -64, 233)
279  #define WS_2_4   W_SMALL(22, -128,  -64, 233)
280  #define WS_2_5   W_SMALL(21, -128,  -64, 233)
281  #define WS_2_6   W_SMALL(16, -128,  -64, 233)
282  #define WS_2_7   W_SMALL(19, -128,  -64, 233)
283  #define WS_3_0   W_SMALL(30, -191, -127, 233)
284  #define WS_3_1   W_SMALL(24, -191, -127, 233)
285  #define WS_3_2   W_SMALL(25, -191, -127, 233)
286  #define WS_3_3   W_SMALL(31, -191, -127, 233)
287  #define WS_3_4   W_SMALL(27, -191, -127, 233)
288  #define WS_3_5   W_SMALL(29, -191, -127, 233)
289  #define WS_3_6   W_SMALL(28, -191, -127, 233)
290  #define WS_3_7   W_SMALL(26, -191, -127, 233)
291  #define W_BIG(sb, o1, o2, mm) \
292  	(INNER(q[16 * (sb) + 2 * 0 + o1], q[16 * (sb) + 2 * 0 + o2], mm), \
293  	 INNER(q[16 * (sb) + 2 * 1 + o1], q[16 * (sb) + 2 * 1 + o2], mm), \
294  	 INNER(q[16 * (sb) + 2 * 2 + o1], q[16 * (sb) + 2 * 2 + o2], mm), \
295  	 INNER(q[16 * (sb) + 2 * 3 + o1], q[16 * (sb) + 2 * 3 + o2], mm), \
296  	 INNER(q[16 * (sb) + 2 * 4 + o1], q[16 * (sb) + 2 * 4 + o2], mm), \
297  	 INNER(q[16 * (sb) + 2 * 5 + o1], q[16 * (sb) + 2 * 5 + o2], mm), \
298  	 INNER(q[16 * (sb) + 2 * 6 + o1], q[16 * (sb) + 2 * 6 + o2], mm), \
299  	 INNER(q[16 * (sb) + 2 * 7 + o1], q[16 * (sb) + 2 * 7 + o2], mm)
300  #define WB_0_0   W_BIG( 4,    0,    1, 185)
301  #define WB_0_1   W_BIG( 6,    0,    1, 185)
302  #define WB_0_2   W_BIG( 0,    0,    1, 185)
303  #define WB_0_3   W_BIG( 2,    0,    1, 185)
304  #define WB_0_4   W_BIG( 7,    0,    1, 185)
305  #define WB_0_5   W_BIG( 5,    0,    1, 185)
306  #define WB_0_6   W_BIG( 3,    0,    1, 185)
307  #define WB_0_7   W_BIG( 1,    0,    1, 185)
308  #define WB_1_0   W_BIG(15,    0,    1, 185)
309  #define WB_1_1   W_BIG(11,    0,    1, 185)
310  #define WB_1_2   W_BIG(12,    0,    1, 185)
311  #define WB_1_3   W_BIG( 8,    0,    1, 185)
312  #define WB_1_4   W_BIG( 9,    0,    1, 185)
313  #define WB_1_5   W_BIG(13,    0,    1, 185)
314  #define WB_1_6   W_BIG(10,    0,    1, 185)
315  #define WB_1_7   W_BIG(14,    0,    1, 185)
316  #define WB_2_0   W_BIG(17, -256, -128, 233)
317  #define WB_2_1   W_BIG(18, -256, -128, 233)
318  #define WB_2_2   W_BIG(23, -256, -128, 233)
319  #define WB_2_3   W_BIG(20, -256, -128, 233)
320  #define WB_2_4   W_BIG(22, -256, -128, 233)
321  #define WB_2_5   W_BIG(21, -256, -128, 233)
322  #define WB_2_6   W_BIG(16, -256, -128, 233)
323  #define WB_2_7   W_BIG(19, -256, -128, 233)
324  #define WB_3_0   W_BIG(30, -383, -255, 233)
325  #define WB_3_1   W_BIG(24, -383, -255, 233)
326  #define WB_3_2   W_BIG(25, -383, -255, 233)
327  #define WB_3_3   W_BIG(31, -383, -255, 233)
328  #define WB_3_4   W_BIG(27, -383, -255, 233)
329  #define WB_3_5   W_BIG(29, -383, -255, 233)
330  #define WB_3_6   W_BIG(28, -383, -255, 233)
331  #define WB_3_7   W_BIG(26, -383, -255, 233)
332  #define IF(x, y, z)    ((((y) ^ (z)) &amp; (x)) ^ (z))
333  #define MAJ(x, y, z)   (((x) &amp; (y)) | (((x) | (y)) &amp; (z)))
334  #define PP4_0_0   1
335  #define PP4_0_1   0
336  #define PP4_0_2   3
337  #define PP4_0_3   2
338  #define PP4_1_0   2
339  #define PP4_1_1   3
340  #define PP4_1_2   0
341  #define PP4_1_3   1
342  #define PP4_2_0   3
343  #define PP4_2_1   2
344  #define PP4_2_2   1
345  #define PP4_2_3   0
346  #define PP8_0_0   1
347  #define PP8_0_1   0
348  #define PP8_0_2   3
349  #define PP8_0_3   2
350  #define PP8_0_4   5
351  #define PP8_0_5   4
352  #define PP8_0_6   7
353  #define PP8_0_7   6
354  #define PP8_1_0   6
355  #define PP8_1_1   7
356  #define PP8_1_2   4
357  #define PP8_1_3   5
358  #define PP8_1_4   2
359  #define PP8_1_5   3
360  #define PP8_1_6   0
361  #define PP8_1_7   1
362  #define PP8_2_0   2
363  #define PP8_2_1   3
364  #define PP8_2_2   0
365  #define PP8_2_3   1
366  #define PP8_2_4   6
367  #define PP8_2_5   7
368  #define PP8_2_6   4
369  #define PP8_2_7   5
370  #define PP8_3_0   3
371  #define PP8_3_1   2
372  #define PP8_3_2   1
373  #define PP8_3_3   0
374  #define PP8_3_4   7
375  #define PP8_3_5   6
376  #define PP8_3_6   5
377  #define PP8_3_7   4
378  #define PP8_4_0   5
379  #define PP8_4_1   4
380  #define PP8_4_2   7
381  #define PP8_4_3   6
382  #define PP8_4_4   1
383  #define PP8_4_5   0
384  #define PP8_4_6   3
385  #define PP8_4_7   2
386  #define PP8_5_0   7
387  #define PP8_5_1   6
388  #define PP8_5_2   5
389  #define PP8_5_3   4
390  #define PP8_5_4   3
391  #define PP8_5_5   2
392  #define PP8_5_6   1
393  #define PP8_5_7   0
394  #define PP8_6_0   4
395  #define PP8_6_1   5
396  #define PP8_6_2   6
397  #define PP8_6_3   7
398  #define PP8_6_4   0
399  #define PP8_6_5   1
400  #define PP8_6_6   2
401  #define PP8_6_7   3
402  #if SPH_SIMD_NOCOPY
403  #define DECL_STATE_SMALL
404  #define READ_STATE_SMALL(sc)
405  #define WRITE_STATE_SMALL(sc)
406  #define DECL_STATE_BIG
407  #define READ_STATE_BIG(sc)
408  #define WRITE_STATE_BIG(sc)
409  #else
410  #define DECL_STATE_SMALL   \
411  	u32 A0, A1, A2, A3, B0, B1, B2, B3, C0, C1, C2, C3, D0, D1, D2, D3;
412  #define READ_STATE_SMALL(sc)   do { \
413  		A0 = (sc)-&gt;state[ 0]; \
414  		A1 = (sc)-&gt;state[ 1]; \
415  		A2 = (sc)-&gt;state[ 2]; \
416  		A3 = (sc)-&gt;state[ 3]; \
417  		B0 = (sc)-&gt;state[ 4]; \
418  		B1 = (sc)-&gt;state[ 5]; \
419  		B2 = (sc)-&gt;state[ 6]; \
420  		B3 = (sc)-&gt;state[ 7]; \
421  		C0 = (sc)-&gt;state[ 8]; \
422  		C1 = (sc)-&gt;state[ 9]; \
423  		C2 = (sc)-&gt;state[10]; \
424  		C3 = (sc)-&gt;state[11]; \
425  		D0 = (sc)-&gt;state[12]; \
426  		D1 = (sc)-&gt;state[13]; \
427  		D2 = (sc)-&gt;state[14]; \
428  		D3 = (sc)-&gt;state[15]; \
429  	} while (0)
430  #define WRITE_STATE_SMALL(sc)   do { \
431  		(sc)-&gt;state[ 0] = A0; \
432  		(sc)-&gt;state[ 1] = A1; \
433  		(sc)-&gt;state[ 2] = A2; \
434  		(sc)-&gt;state[ 3] = A3; \
435  		(sc)-&gt;state[ 4] = B0; \
436  		(sc)-&gt;state[ 5] = B1; \
437  		(sc)-&gt;state[ 6] = B2; \
438  		(sc)-&gt;state[ 7] = B3; \
439  		(sc)-&gt;state[ 8] = C0; \
440  		(sc)-&gt;state[ 9] = C1; \
441  		(sc)-&gt;state[10] = C2; \
442  		(sc)-&gt;state[11] = C3; \
443  		(sc)-&gt;state[12] = D0; \
444  		(sc)-&gt;state[13] = D1; \
445  		(sc)-&gt;state[14] = D2; \
446  		(sc)-&gt;state[15] = D3; \
447  	} while (0)
448  #define DECL_STATE_BIG   \
449  	u32 A0, A1, A2, A3, A4, A5, A6, A7; \
450  	u32 B0, B1, B2, B3, B4, B5, B6, B7; \
451  	u32 C0, C1, C2, C3, C4, C5, C6, C7; \
452  	u32 D0, D1, D2, D3, D4, D5, D6, D7;
453  #define READ_STATE_BIG(sc)   do { \
454  		A0 = (sc)-&gt;state[ 0]; \
455  		A1 = (sc)-&gt;state[ 1]; \
456  		A2 = (sc)-&gt;state[ 2]; \
457  		A3 = (sc)-&gt;state[ 3]; \
458  		A4 = (sc)-&gt;state[ 4]; \
459  		A5 = (sc)-&gt;state[ 5]; \
460  		A6 = (sc)-&gt;state[ 6]; \
461  		A7 = (sc)-&gt;state[ 7]; \
462  		B0 = (sc)-&gt;state[ 8]; \
463  		B1 = (sc)-&gt;state[ 9]; \
464  		B2 = (sc)-&gt;state[10]; \
465  		B3 = (sc)-&gt;state[11]; \
466  		B4 = (sc)-&gt;state[12]; \
467  		B5 = (sc)-&gt;state[13]; \
468  		B6 = (sc)-&gt;state[14]; \
469  		B7 = (sc)-&gt;state[15]; \
470  		C0 = (sc)-&gt;state[16]; \
471  		C1 = (sc)-&gt;state[17]; \
472  		C2 = (sc)-&gt;state[18]; \
473  		C3 = (sc)-&gt;state[19]; \
474  		C4 = (sc)-&gt;state[20]; \
475  		C5 = (sc)-&gt;state[21]; \
476  		C6 = (sc)-&gt;state[22]; \
477  		C7 = (sc)-&gt;state[23]; \
478  		D0 = (sc)-&gt;state[24]; \
479  		D1 = (sc)-&gt;state[25]; \
480  		D2 = (sc)-&gt;state[26]; \
481  		D3 = (sc)-&gt;state[27]; \
482  		D4 = (sc)-&gt;state[28]; \
483  		D5 = (sc)-&gt;state[29]; \
484  		D6 = (sc)-&gt;state[30]; \
485  		D7 = (sc)-&gt;state[31]; \
486  	} while (0)
487  #define WRITE_STATE_BIG(sc)   do { \
488  		(sc)-&gt;state[ 0] = A0; \
489  		(sc)-&gt;state[ 1] = A1; \
490  		(sc)-&gt;state[ 2] = A2; \
491  		(sc)-&gt;state[ 3] = A3; \
492  		(sc)-&gt;state[ 4] = A4; \
493  		(sc)-&gt;state[ 5] = A5; \
494  		(sc)-&gt;state[ 6] = A6; \
495  		(sc)-&gt;state[ 7] = A7; \
496  		(sc)-&gt;state[ 8] = B0; \
497  		(sc)-&gt;state[ 9] = B1; \
498  		(sc)-&gt;state[10] = B2; \
499  		(sc)-&gt;state[11] = B3; \
500  		(sc)-&gt;state[12] = B4; \
501  		(sc)-&gt;state[13] = B5; \
502  		(sc)-&gt;state[14] = B6; \
503  		(sc)-&gt;state[15] = B7; \
504  		(sc)-&gt;state[16] = C0; \
505  		(sc)-&gt;state[17] = C1; \
506  		(sc)-&gt;state[18] = C2; \
507  		(sc)-&gt;state[19] = C3; \
508  		(sc)-&gt;state[20] = C4; \
509  		(sc)-&gt;state[21] = C5; \
510  		(sc)-&gt;state[22] = C6; \
511  		(sc)-&gt;state[23] = C7; \
512  		(sc)-&gt;state[24] = D0; \
513  		(sc)-&gt;state[25] = D1; \
514  		(sc)-&gt;state[26] = D2; \
515  		(sc)-&gt;state[27] = D3; \
516  		(sc)-&gt;state[28] = D4; \
517  		(sc)-&gt;state[29] = D5; \
518  		(sc)-&gt;state[30] = D6; \
519  		(sc)-&gt;state[31] = D7; \
520  	} while (0)
521  #endif
522  #define STEP_ELT(n, w, fun, s, ppb)   do { \
523  		u32 tt = T32(D ## n + (w) + fun(A ## n, B ## n, C ## n)); \
524  		A ## n = T32(ROL32(tt, s) + XCAT(tA, XCAT(ppb, n))); \
525  		D ## n = C ## n; \
526  		C ## n = B ## n; \
527  		B ## n = tA ## n; \
528  	} while (0)
529  #define STEP_SMALL(w0, w1, w2, w3, fun, r, s, pp4b)   do { \
530  		u32 tA0 = ROL32(A0, r); \
531  		u32 tA1 = ROL32(A1, r); \
532  		u32 tA2 = ROL32(A2, r); \
533  		u32 tA3 = ROL32(A3, r); \
534  		STEP_ELT(0, w0, fun, s, pp4b); \
535  		STEP_ELT(1, w1, fun, s, pp4b); \
536  		STEP_ELT(2, w2, fun, s, pp4b); \
537  		STEP_ELT(3, w3, fun, s, pp4b); \
538  	} while (0)
539  #define STEP_BIG(w0, w1, w2, w3, w4, w5, w6, w7, fun, r, s, pp8b)   do { \
540  		u32 tA0 = ROL32(A0, r); \
541  		u32 tA1 = ROL32(A1, r); \
542  		u32 tA2 = ROL32(A2, r); \
543  		u32 tA3 = ROL32(A3, r); \
544  		u32 tA4 = ROL32(A4, r); \
545  		u32 tA5 = ROL32(A5, r); \
546  		u32 tA6 = ROL32(A6, r); \
547  		u32 tA7 = ROL32(A7, r); \
548  		STEP_ELT(0, w0, fun, s, pp8b); \
549  		STEP_ELT(1, w1, fun, s, pp8b); \
550  		STEP_ELT(2, w2, fun, s, pp8b); \
551  		STEP_ELT(3, w3, fun, s, pp8b); \
552  		STEP_ELT(4, w4, fun, s, pp8b); \
553  		STEP_ELT(5, w5, fun, s, pp8b); \
554  		STEP_ELT(6, w6, fun, s, pp8b); \
555  		STEP_ELT(7, w7, fun, s, pp8b); \
556  	} while (0)
557  #define M3_0_0   0_
558  #define M3_1_0   1_
559  #define M3_2_0   2_
560  #define M3_3_0   0_
561  #define M3_4_0   1_
562  #define M3_5_0   2_
563  #define M3_6_0   0_
564  #define M3_7_0   1_
565  #define M3_0_1   1_
566  #define M3_1_1   2_
567  #define M3_2_1   0_
568  #define M3_3_1   1_
569  #define M3_4_1   2_
570  #define M3_5_1   0_
571  #define M3_6_1   1_
572  #define M3_7_1   2_
573  #define M3_0_2   2_
574  #define M3_1_2   0_
575  #define M3_2_2   1_
576  #define M3_3_2   2_
577  #define M3_4_2   0_
578  #define M3_5_2   1_
579  #define M3_6_2   2_
580  #define M3_7_2   0_
581  #define STEP_SMALL_(w, fun, r, s, pp4b)   STEP_SMALL w, fun, r, s, pp4b)
582  #define ONE_ROUND_SMALL(ri, isp, p0, p1, p2, p3)   do { \
583  		STEP_SMALL_(WS_ ## ri ## 0, \
584  			IF,  p0, p1, XCAT(PP4_, M3_0_ ## isp)); \
585  		STEP_SMALL_(WS_ ## ri ## 1, \
586  			IF,  p1, p2, XCAT(PP4_, M3_1_ ## isp)); \
587  		STEP_SMALL_(WS_ ## ri ## 2, \
588  			IF,  p2, p3, XCAT(PP4_, M3_2_ ## isp)); \
589  		STEP_SMALL_(WS_ ## ri ## 3, \
590  			IF,  p3, p0, XCAT(PP4_, M3_3_ ## isp)); \
591  		STEP_SMALL_(WS_ ## ri ## 4, \
592  			MAJ, p0, p1, XCAT(PP4_, M3_4_ ## isp)); \
593  		STEP_SMALL_(WS_ ## ri ## 5, \
594  			MAJ, p1, p2, XCAT(PP4_, M3_5_ ## isp)); \
595  		STEP_SMALL_(WS_ ## ri ## 6, \
596  			MAJ, p2, p3, XCAT(PP4_, M3_6_ ## isp)); \
597  		STEP_SMALL_(WS_ ## ri ## 7, \
598  			MAJ, p3, p0, XCAT(PP4_, M3_7_ ## isp)); \
599  	} while (0)
600  #define M7_0_0   0_
601  #define M7_1_0   1_
602  #define M7_2_0   2_
603  #define M7_3_0   3_
604  #define M7_4_0   4_
605  #define M7_5_0   5_
606  #define M7_6_0   6_
607  #define M7_7_0   0_
608  #define M7_0_1   1_
609  #define M7_1_1   2_
610  #define M7_2_1   3_
611  #define M7_3_1   4_
612  #define M7_4_1   5_
613  #define M7_5_1   6_
614  #define M7_6_1   0_
615  #define M7_7_1   1_
616  #define M7_0_2   2_
617  #define M7_1_2   3_
618  #define M7_2_2   4_
619  #define M7_3_2   5_
620  #define M7_4_2   6_
621  #define M7_5_2   0_
622  #define M7_6_2   1_
623  #define M7_7_2   2_
624  #define M7_0_3   3_
625  #define M7_1_3   4_
626  #define M7_2_3   5_
627  #define M7_3_3   6_
628  #define M7_4_3   0_
629  #define M7_5_3   1_
630  #define M7_6_3   2_
631  #define M7_7_3   3_
632  #define STEP_BIG_(w, fun, r, s, pp8b)   STEP_BIG w, fun, r, s, pp8b)
633  #define ONE_ROUND_BIG(ri, isp, p0, p1, p2, p3)   do { \
634  		STEP_BIG_(WB_ ## ri ## 0, \
635  			IF,  p0, p1, XCAT(PP8_, M7_0_ ## isp)); \
636  		STEP_BIG_(WB_ ## ri ## 1, \
637  			IF,  p1, p2, XCAT(PP8_, M7_1_ ## isp)); \
638  		STEP_BIG_(WB_ ## ri ## 2, \
639  			IF,  p2, p3, XCAT(PP8_, M7_2_ ## isp)); \
640  		STEP_BIG_(WB_ ## ri ## 3, \
641  			IF,  p3, p0, XCAT(PP8_, M7_3_ ## isp)); \
642  		STEP_BIG_(WB_ ## ri ## 4, \
643  			MAJ, p0, p1, XCAT(PP8_, M7_4_ ## isp)); \
644  		STEP_BIG_(WB_ ## ri ## 5, \
645  			MAJ, p1, p2, XCAT(PP8_, M7_5_ ## isp)); \
646  		STEP_BIG_(WB_ ## ri ## 6, \
647  			MAJ, p2, p3, XCAT(PP8_, M7_6_ ## isp)); \
648  		STEP_BIG_(WB_ ## ri ## 7, \
649  			MAJ, p3, p0, XCAT(PP8_, M7_7_ ## isp)); \
650  	} while (0)
651  #if SPH_SMALL_FOOTPRINT_SIMD
652  #define A0   state[ 0]
653  #define A1   state[ 1]
654  #define A2   state[ 2]
655  #define A3   state[ 3]
656  #define B0   state[ 4]
657  #define B1   state[ 5]
658  #define B2   state[ 6]
659  #define B3   state[ 7]
660  #define C0   state[ 8]
661  #define C1   state[ 9]
662  #define C2   state[10]
663  #define C3   state[11]
664  #define D0   state[12]
665  #define D1   state[13]
666  #define D2   state[14]
667  #define D3   state[15]
668  #define STEP2_ELT(n, w, fun, s, ppb)   do { \
669  		u32 tt = T32(D ## n + (w) + fun(A ## n, B ## n, C ## n)); \
670  		A ## n = T32(ROL32(tt, s) + tA[(ppb) ^ n]); \
671  		D ## n = C ## n; \
672  		C ## n = B ## n; \
673  		B ## n = tA[n]; \
674  	} while (0)
675  #define STEP2_SMALL(w0, w1, w2, w3, fun, r, s, pp4b)   do { \
676  		u32 tA[4]; \
677  		tA[0] = ROL32(A0, r); \
678  		tA[1] = ROL32(A1, r); \
679  		tA[2] = ROL32(A2, r); \
680  		tA[3] = ROL32(A3, r); \
681  		STEP2_ELT(0, w0, fun, s, pp4b); \
682  		STEP2_ELT(1, w1, fun, s, pp4b); \
683  		STEP2_ELT(2, w2, fun, s, pp4b); \
684  		STEP2_ELT(3, w3, fun, s, pp4b); \
685  	} while (0)
686  static void
687  one_round_small(u32 *state, u32 *w, int isp, int p0, int p1, int p2, int p3)
688  {
689  	static const int pp4k[] = { 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2 };
690  	STEP2_SMALL(w[ 0], w[ 1], w[ 2], w[ 3], IF,  p0, p1, pp4k[isp + 0]);
691  	STEP2_SMALL(w[ 4], w[ 5], w[ 6], w[ 7], IF,  p1, p2, pp4k[isp + 1]);
692  	STEP2_SMALL(w[ 8], w[ 9], w[10], w[11], IF,  p2, p3, pp4k[isp + 2]);
693  	STEP2_SMALL(w[12], w[13], w[14], w[15], IF,  p3, p0, pp4k[isp + 3]);
694  	STEP2_SMALL(w[16], w[17], w[18], w[19], MAJ, p0, p1, pp4k[isp + 4]);
695  	STEP2_SMALL(w[20], w[21], w[22], w[23], MAJ, p1, p2, pp4k[isp + 5]);
696  	STEP2_SMALL(w[24], w[25], w[26], w[27], MAJ, p2, p3, pp4k[isp + 6]);
697  	STEP2_SMALL(w[28], w[29], w[30], w[31], MAJ, p3, p0, pp4k[isp + 7]);
698  }
699  static void
700  compress_small(sph_simd_small_context *sc, int last)
701  {
702  	unsigned char *x;
703  	s32 q[128];
704  	int i;
705  	u32 w[32];
706  	u32 state[16];
707  	size_t u;
708  	static const size_t wsp[32] = {
709  		 4 &lt;&lt; 3,  6 &lt;&lt; 3,  0 &lt;&lt; 3,  2 &lt;&lt; 3,
710  		 7 &lt;&lt; 3,  5 &lt;&lt; 3,  3 &lt;&lt; 3,  1 &lt;&lt; 3,
711  		15 &lt;&lt; 3, 11 &lt;&lt; 3, 12 &lt;&lt; 3,  8 &lt;&lt; 3,
712  		 9 &lt;&lt; 3, 13 &lt;&lt; 3, 10 &lt;&lt; 3, 14 &lt;&lt; 3,
713  		17 &lt;&lt; 3, 18 &lt;&lt; 3, 23 &lt;&lt; 3, 20 &lt;&lt; 3,
714  		22 &lt;&lt; 3, 21 &lt;&lt; 3, 16 &lt;&lt; 3, 19 &lt;&lt; 3,
715  		30 &lt;&lt; 3, 24 &lt;&lt; 3, 25 &lt;&lt; 3, 31 &lt;&lt; 3,
716  		27 &lt;&lt; 3, 29 &lt;&lt; 3, 28 &lt;&lt; 3, 26 &lt;&lt; 3
717  	};
718  	x = sc-&gt;buf;
719  	FFT128(0, 1, 0, ll);
720  	if (last) {
721  		for (i = 0; i &lt; 128; i ++) {
722  			s32 tq;
723  			tq = q[i] + yoff_s_f[i];
724  			tq = REDS2(tq);
725  			tq = REDS1(tq);
726  			tq = REDS1(tq);
727  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
728  		}
729  	} else {
730  		for (i = 0; i &lt; 128; i ++) {
731  			s32 tq;
732  			tq = q[i] + yoff_s_n[i];
733  			tq = REDS2(tq);
734  			tq = REDS1(tq);
735  			tq = REDS1(tq);
736  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
737  		}
738  	}
739  	for (i = 0; i &lt; 16; i += 4) {
740  		state[i + 0] = sc-&gt;state[i + 0]
741  			^ sph_dec32le_aligned(x + 4 * (i + 0));
742  		state[i + 1] = sc-&gt;state[i + 1]
743  			^ sph_dec32le_aligned(x + 4 * (i + 1));
744  		state[i + 2] = sc-&gt;state[i + 2]
745  			^ sph_dec32le_aligned(x + 4 * (i + 2));
746  		state[i + 3] = sc-&gt;state[i + 3]
747  			^ sph_dec32le_aligned(x + 4 * (i + 3));
748  	}
749  #define WSREAD(sb, o1, o2, mm)   do { \
750  		for (u = 0; u &lt; 32; u += 4) { \
751  			size_t v = wsp[(u &gt;&gt; 2) + (sb)]; \
752  			w[u + 0] = INNER(q[v + 2 * 0 + (o1)], \
753  				q[v + 2 * 0 + (o2)], mm); \
754  			w[u + 1] = INNER(q[v + 2 * 1 + (o1)], \
755  				q[v + 2 * 1 + (o2)], mm); \
756  			w[u + 2] = INNER(q[v + 2 * 2 + (o1)], \
757  				q[v + 2 * 2 + (o2)], mm); \
758  			w[u + 3] = INNER(q[v + 2 * 3 + (o1)], \
759  				q[v + 2 * 3 + (o2)], mm); \
760  		} \
761  	} while (0)
762  	WSREAD( 0,    0,    1, 185);
763  	one_round_small(state, w, 0,  3, 23, 17, 27);
764  	WSREAD( 8,    0,    1, 185);
765  	one_round_small(state, w, 2, 28, 19, 22,  7);
766  	WSREAD(16, -128,  -64, 233);
767  	one_round_small(state, w, 1, 29,  9, 15,  5);
768  	WSREAD(24, -191, -127, 233);
769  	one_round_small(state, w, 0,  4, 13, 10, 25);
770  #undef WSREAD
771  	STEP_SMALL(sc-&gt;state[ 0], sc-&gt;state[ 1], sc-&gt;state[ 2], sc-&gt;state[ 3],
772  		IF,  4, 13, PP4_2_);
773  	STEP_SMALL(sc-&gt;state[ 4], sc-&gt;state[ 5], sc-&gt;state[ 6], sc-&gt;state[ 7],
774  		IF, 13, 10, PP4_0_);
775  	STEP_SMALL(sc-&gt;state[ 8], sc-&gt;state[ 9], sc-&gt;state[10], sc-&gt;state[11],
776  		IF, 10, 25, PP4_1_);
777  	STEP_SMALL(sc-&gt;state[12], sc-&gt;state[13], sc-&gt;state[14], sc-&gt;state[15],
778  		IF, 25,  4, PP4_2_);
779  	memcpy(sc-&gt;state, state, sizeof state);
780  }
781  #undef A0
782  #undef A1
783  #undef A2
784  #undef A3
785  #undef B0
786  #undef B1
787  #undef B2
788  #undef B3
789  #undef C0
790  #undef C1
791  #undef C2
792  #undef C3
793  #undef D0
794  #undef D1
795  #undef D2
796  #undef D3
797  #else
798  #if SPH_SIMD_NOCOPY
799  #define A0   (sc-&gt;state[ 0])
800  #define A1   (sc-&gt;state[ 1])
801  #define A2   (sc-&gt;state[ 2])
802  #define A3   (sc-&gt;state[ 3])
803  #define B0   (sc-&gt;state[ 4])
804  #define B1   (sc-&gt;state[ 5])
805  #define B2   (sc-&gt;state[ 6])
806  #define B3   (sc-&gt;state[ 7])
807  #define C0   (sc-&gt;state[ 8])
808  #define C1   (sc-&gt;state[ 9])
809  #define C2   (sc-&gt;state[10])
810  #define C3   (sc-&gt;state[11])
811  #define D0   (sc-&gt;state[12])
812  #define D1   (sc-&gt;state[13])
813  #define D2   (sc-&gt;state[14])
814  #define D3   (sc-&gt;state[15])
815  #endif
816  static void
817  compress_small(sph_simd_small_context *sc, int last)
818  {
819  	unsigned char *x;
820  	s32 q[128];
821  	int i;
822  	DECL_STATE_SMALL
823  #if SPH_SIMD_NOCOPY
824  	sph_u32 saved[16];
825  #endif
826  #if SPH_SIMD_NOCOPY
827  	memcpy(saved, sc-&gt;state, sizeof saved);
828  #endif
829  	x = sc-&gt;buf;
830  	FFT128(0, 1, 0, ll);
831  	if (last) {
832  		for (i = 0; i &lt; 128; i ++) {
833  			s32 tq;
834  			tq = q[i] + yoff_s_f[i];
835  			tq = REDS2(tq);
836  			tq = REDS1(tq);
837  			tq = REDS1(tq);
838  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
839  		}
840  	} else {
841  		for (i = 0; i &lt; 128; i ++) {
842  			s32 tq;
843  			tq = q[i] + yoff_s_n[i];
844  			tq = REDS2(tq);
845  			tq = REDS1(tq);
846  			tq = REDS1(tq);
847  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
848  		}
849  	}
850  	READ_STATE_SMALL(sc);
851  	A0 ^= sph_dec32le_aligned(x +  0);
852  	A1 ^= sph_dec32le_aligned(x +  4);
853  	A2 ^= sph_dec32le_aligned(x +  8);
854  	A3 ^= sph_dec32le_aligned(x + 12);
855  	B0 ^= sph_dec32le_aligned(x + 16);
856  	B1 ^= sph_dec32le_aligned(x + 20);
857  	B2 ^= sph_dec32le_aligned(x + 24);
858  	B3 ^= sph_dec32le_aligned(x + 28);
859  	C0 ^= sph_dec32le_aligned(x + 32);
860  	C1 ^= sph_dec32le_aligned(x + 36);
861  	C2 ^= sph_dec32le_aligned(x + 40);
862  	C3 ^= sph_dec32le_aligned(x + 44);
863  	D0 ^= sph_dec32le_aligned(x + 48);
864  	D1 ^= sph_dec32le_aligned(x + 52);
865  	D2 ^= sph_dec32le_aligned(x + 56);
866  	D3 ^= sph_dec32le_aligned(x + 60);
867  	ONE_ROUND_SMALL(0_, 0,  3, 23, 17, 27);
868  	ONE_ROUND_SMALL(1_, 2, 28, 19, 22,  7);
869  	ONE_ROUND_SMALL(2_, 1, 29,  9, 15,  5);
870  	ONE_ROUND_SMALL(3_, 0,  4, 13, 10, 25);
871  #if SPH_SIMD_NOCOPY
872  	STEP_SMALL(saved[ 0], saved[ 1], saved[ 2], saved[ 3],
873  		IF,  4, 13, PP4_2_);
874  	STEP_SMALL(saved[ 4], saved[ 5], saved[ 6], saved[ 7],
875  		IF, 13, 10, PP4_0_);
876  	STEP_SMALL(saved[ 8], saved[ 9], saved[10], saved[11],
877  		IF, 10, 25, PP4_1_);
878  	STEP_SMALL(saved[12], saved[13], saved[14], saved[15],
879  		IF, 25,  4, PP4_2_);
880  #else
881  	STEP_SMALL(sc-&gt;state[ 0], sc-&gt;state[ 1], sc-&gt;state[ 2], sc-&gt;state[ 3],
882  		IF,  4, 13, PP4_2_);
883  	STEP_SMALL(sc-&gt;state[ 4], sc-&gt;state[ 5], sc-&gt;state[ 6], sc-&gt;state[ 7],
884  		IF, 13, 10, PP4_0_);
885  	STEP_SMALL(sc-&gt;state[ 8], sc-&gt;state[ 9], sc-&gt;state[10], sc-&gt;state[11],
886  		IF, 10, 25, PP4_1_);
887  	STEP_SMALL(sc-&gt;state[12], sc-&gt;state[13], sc-&gt;state[14], sc-&gt;state[15],
888  		IF, 25,  4, PP4_2_);
889  	WRITE_STATE_SMALL(sc);
890  #endif
891  }
892  #if SPH_SIMD_NOCOPY
893  #undef A0
894  #undef A1
895  #undef A2
896  #undef A3
897  #undef B0
898  #undef B1
899  #undef B2
900  #undef B3
901  #undef C0
902  #undef C1
903  #undef C2
904  #undef C3
905  #undef D0
906  #undef D1
907  #undef D2
908  #undef D3
909  #endif
910  #endif
911  #if SPH_SMALL_FOOTPRINT_SIMD
912  #define A0   state[ 0]
913  #define A1   state[ 1]
914  #define A2   state[ 2]
915  #define A3   state[ 3]
916  #define A4   state[ 4]
917  #define A5   state[ 5]
918  #define A6   state[ 6]
919  #define A7   state[ 7]
920  #define B0   state[ 8]
921  #define B1   state[ 9]
922  #define B2   state[10]
923  #define B3   state[11]
924  #define B4   state[12]
925  #define B5   state[13]
926  #define B6   state[14]
927  #define B7   state[15]
928  #define C0   state[16]
929  #define C1   state[17]
930  #define C2   state[18]
931  #define C3   state[19]
932  #define C4   state[20]
933  #define C5   state[21]
934  #define C6   state[22]
935  #define C7   state[23]
936  #define D0   state[24]
937  #define D1   state[25]
938  #define D2   state[26]
939  #define D3   state[27]
940  #define D4   state[28]
941  #define D5   state[29]
942  #define D6   state[30]
943  #define D7   state[31]
944  #define STEP2_BIG(w0, w1, w2, w3, w4, w5, w6, w7, fun, r, s, pp8b)   do { \
945  		u32 tA[8]; \
946  		tA[0] = ROL32(A0, r); \
947  		tA[1] = ROL32(A1, r); \
948  		tA[2] = ROL32(A2, r); \
949  		tA[3] = ROL32(A3, r); \
950  		tA[4] = ROL32(A4, r); \
951  		tA[5] = ROL32(A5, r); \
952  		tA[6] = ROL32(A6, r); \
953  		tA[7] = ROL32(A7, r); \
954  		STEP2_ELT(0, w0, fun, s, pp8b); \
955  		STEP2_ELT(1, w1, fun, s, pp8b); \
956  		STEP2_ELT(2, w2, fun, s, pp8b); \
957  		STEP2_ELT(3, w3, fun, s, pp8b); \
958  		STEP2_ELT(4, w4, fun, s, pp8b); \
959  		STEP2_ELT(5, w5, fun, s, pp8b); \
960  		STEP2_ELT(6, w6, fun, s, pp8b); \
961  		STEP2_ELT(7, w7, fun, s, pp8b); \
962  	} while (0)
963  static void
964  one_round_big(u32 *state, u32 *w, int isp, int p0, int p1, int p2, int p3)
965  {
966  	static const int pp8k[] = { 1, 6, 2, 3, 5, 7, 4, 1, 6, 2, 3 };
967  	STEP2_BIG(w[ 0], w[ 1], w[ 2], w[ 3], w[ 4], w[ 5], w[ 6], w[ 7],
968  		IF,  p0, p1, pp8k[isp + 0]);
969  	STEP2_BIG(w[ 8], w[ 9], w[10], w[11], w[12], w[13], w[14], w[15],
970  		IF,  p1, p2, pp8k[isp + 1]);
971  	STEP2_BIG(w[16], w[17], w[18], w[19], w[20], w[21], w[22], w[23],
972  		IF,  p2, p3, pp8k[isp + 2]);
973  	STEP2_BIG(w[24], w[25], w[26], w[27], w[28], w[29], w[30], w[31],
974  		IF,  p3, p0, pp8k[isp + 3]);
975  	STEP2_BIG(w[32], w[33], w[34], w[35], w[36], w[37], w[38], w[39],
976  		MAJ, p0, p1, pp8k[isp + 4]);
977  	STEP2_BIG(w[40], w[41], w[42], w[43], w[44], w[45], w[46], w[47],
978  		MAJ, p1, p2, pp8k[isp + 5]);
979  	STEP2_BIG(w[48], w[49], w[50], w[51], w[52], w[53], w[54], w[55],
980  		MAJ, p2, p3, pp8k[isp + 6]);
981  	STEP2_BIG(w[56], w[57], w[58], w[59], w[60], w[61], w[62], w[63],
982  		MAJ, p3, p0, pp8k[isp + 7]);
983  }
984  static void
985  compress_big(sph_simd_big_context *sc, int last)
986  {
987  	unsigned char *x;
<span onclick='openModal()' class='match'>988  	s32 q[256];
989  	int i;
990  	u32 w[64];
991  	u32 state[32];
992  	size_t u;
993  	static const size_t wbp[32] = {
994  		 4 &lt;&lt; 4,  6 &lt;&lt; 4,  0 &lt;&lt; 4,  2 &lt;&lt; 4,
995  		 7 &lt;&lt; 4,  5 &lt;&lt; 4,  3 &lt;&lt; 4,  1 &lt;&lt; 4,
996  		15 &lt;&lt; 4, 11 &lt;&lt; 4, 12 &lt;&lt; 4,  8 &lt;&lt; 4,
997  		 9 &lt;&lt; 4, 13 &lt;&lt; 4, 10 &lt;&lt; 4, 14 &lt;&lt; 4,
998  		17 &lt;&lt; 4, 18 &lt;&lt; 4, 23 &lt;&lt; 4, 20 &lt;&lt; 4,
999  		22 &lt;&lt; 4, 21 &lt;&lt; 4, 16 &lt;&lt; 4, 19 &lt;&lt; 4,
1000  		30 &lt;&lt; 4, 24 &lt;&lt; 4, 25 &lt;&lt; 4, 31 &lt;&lt; 4,
1001  		27 &lt;&lt; 4, 29 &lt;&lt; 4, 28 &lt;&lt; 4, 26 &lt;&lt; 4
1002  	};
1003  	x = sc-&gt;buf;
1004  	FFT256(0, 1, 0, ll);
1005  	if (last) {
1006  		for (i = 0; i &lt; 256; i ++) {
1007  			s32 tq;
1008  			tq = q[i] + yoff_b_f[i];
1009  			tq = REDS2(tq);
1010  			tq = REDS1(tq);
1011  			tq = REDS1(tq);
1012  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1013  		}
1014  	} else {
1015  		for (i = 0; i &lt; 256; i ++) {
1016  			s32 tq;
1017  			tq = q[i] + yoff_b_n[i];
1018  			tq = REDS2(tq);
1019  			tq = REDS1(tq);
1020  			tq = REDS1(tq);
1021  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1022  		}
1023  	}
1024  	for (i = 0; i &lt; 32; i += 8) {
1025  		state[i + 0] = sc-&gt;state[i + 0]
1026  			^ sph_dec32le_aligned(x + 4 * (i + 0));
1027  		state[i + 1] = sc-&gt;state[i + 1]
1028  			^ sph_dec32le_aligned(x + 4 * (i + 1));
1029  		state[i + 2] = sc-&gt;state[i + 2]
1030  			^ sph_dec32le_aligned(x + 4 * (i + 2));
1031  		state[i + 3] = sc-&gt;state[i + 3]
1032  			^ sph_dec32le_aligned(x + 4 * (i + 3));
1033  		state[i + 4] = sc-&gt;state[i + 4]
</span>1034  			^ sph_dec32le_aligned(x + 4 * (i + 4));
1035  		state[i + 5] = sc-&gt;state[i + 5]
1036  			^ sph_dec32le_aligned(x + 4 * (i + 5));
1037  		state[i + 6] = sc-&gt;state[i + 6]
1038  			^ sph_dec32le_aligned(x + 4 * (i + 6));
1039  		state[i + 7] = sc-&gt;state[i + 7]
1040  			^ sph_dec32le_aligned(x + 4 * (i + 7));
1041  	}
1042  #define WBREAD(sb, o1, o2, mm)   do { \
1043  		for (u = 0; u &lt; 64; u += 8) { \
1044  			size_t v = wbp[(u &gt;&gt; 3) + (sb)]; \
1045  			w[u + 0] = INNER(q[v + 2 * 0 + (o1)], \
1046  				q[v + 2 * 0 + (o2)], mm); \
1047  			w[u + 1] = INNER(q[v + 2 * 1 + (o1)], \
1048  				q[v + 2 * 1 + (o2)], mm); \
1049  			w[u + 2] = INNER(q[v + 2 * 2 + (o1)], \
1050  				q[v + 2 * 2 + (o2)], mm); \
1051  			w[u + 3] = INNER(q[v + 2 * 3 + (o1)], \
1052  				q[v + 2 * 3 + (o2)], mm); \
1053  			w[u + 4] = INNER(q[v + 2 * 4 + (o1)], \
1054  				q[v + 2 * 4 + (o2)], mm); \
1055  			w[u + 5] = INNER(q[v + 2 * 5 + (o1)], \
1056  				q[v + 2 * 5 + (o2)], mm); \
1057  			w[u + 6] = INNER(q[v + 2 * 6 + (o1)], \
1058  				q[v + 2 * 6 + (o2)], mm); \
1059  			w[u + 7] = INNER(q[v + 2 * 7 + (o1)], \
1060  				q[v + 2 * 7 + (o2)], mm); \
1061  		} \
1062  	} while (0)
1063  	WBREAD( 0,    0,    1, 185);
1064  	one_round_big(state, w, 0,  3, 23, 17, 27);
1065  	WBREAD( 8,    0,    1, 185);
1066  	one_round_big(state, w, 1, 28, 19, 22,  7);
1067  	WBREAD(16, -256, -128, 233);
1068  	one_round_big(state, w, 2, 29,  9, 15,  5);
1069  	WBREAD(24, -383, -255, 233);
1070  	one_round_big(state, w, 3,  4, 13, 10, 25);
1071  #undef WBREAD
1072  	STEP_BIG(
1073  		sc-&gt;state[ 0], sc-&gt;state[ 1], sc-&gt;state[ 2], sc-&gt;state[ 3],
1074  		sc-&gt;state[ 4], sc-&gt;state[ 5], sc-&gt;state[ 6], sc-&gt;state[ 7],
1075  		IF,  4, 13, PP8_4_);
1076  	STEP_BIG(
1077  		sc-&gt;state[ 8], sc-&gt;state[ 9], sc-&gt;state[10], sc-&gt;state[11],
1078  		sc-&gt;state[12], sc-&gt;state[13], sc-&gt;state[14], sc-&gt;state[15],
1079  		IF, 13, 10, PP8_5_);
1080  	STEP_BIG(
1081  		sc-&gt;state[16], sc-&gt;state[17], sc-&gt;state[18], sc-&gt;state[19],
1082  		sc-&gt;state[20], sc-&gt;state[21], sc-&gt;state[22], sc-&gt;state[23],
1083  		IF, 10, 25, PP8_6_);
1084  	STEP_BIG(
1085  		sc-&gt;state[24], sc-&gt;state[25], sc-&gt;state[26], sc-&gt;state[27],
1086  		sc-&gt;state[28], sc-&gt;state[29], sc-&gt;state[30], sc-&gt;state[31],
1087  		IF, 25,  4, PP8_0_);
1088  	memcpy(sc-&gt;state, state, sizeof state);
1089  }
1090  #undef A0
1091  #undef A1
1092  #undef A2
1093  #undef A3
1094  #undef A4
1095  #undef A5
1096  #undef A6
1097  #undef A7
1098  #undef B0
1099  #undef B1
1100  #undef B2
1101  #undef B3
1102  #undef B4
1103  #undef B5
1104  #undef B6
1105  #undef B7
1106  #undef C0
1107  #undef C1
1108  #undef C2
1109  #undef C3
1110  #undef C4
1111  #undef C5
1112  #undef C6
1113  #undef C7
1114  #undef D0
1115  #undef D1
1116  #undef D2
1117  #undef D3
1118  #undef D4
1119  #undef D5
1120  #undef D6
1121  #undef D7
1122  #else
1123  #if SPH_SIMD_NOCOPY
1124  #define A0   (sc-&gt;state[ 0])
1125  #define A1   (sc-&gt;state[ 1])
1126  #define A2   (sc-&gt;state[ 2])
1127  #define A3   (sc-&gt;state[ 3])
1128  #define A4   (sc-&gt;state[ 4])
1129  #define A5   (sc-&gt;state[ 5])
1130  #define A6   (sc-&gt;state[ 6])
1131  #define A7   (sc-&gt;state[ 7])
1132  #define B0   (sc-&gt;state[ 8])
1133  #define B1   (sc-&gt;state[ 9])
1134  #define B2   (sc-&gt;state[10])
1135  #define B3   (sc-&gt;state[11])
1136  #define B4   (sc-&gt;state[12])
1137  #define B5   (sc-&gt;state[13])
1138  #define B6   (sc-&gt;state[14])
1139  #define B7   (sc-&gt;state[15])
1140  #define C0   (sc-&gt;state[16])
1141  #define C1   (sc-&gt;state[17])
1142  #define C2   (sc-&gt;state[18])
1143  #define C3   (sc-&gt;state[19])
1144  #define C4   (sc-&gt;state[20])
1145  #define C5   (sc-&gt;state[21])
1146  #define C6   (sc-&gt;state[22])
1147  #define C7   (sc-&gt;state[23])
1148  #define D0   (sc-&gt;state[24])
1149  #define D1   (sc-&gt;state[25])
1150  #define D2   (sc-&gt;state[26])
1151  #define D3   (sc-&gt;state[27])
1152  #define D4   (sc-&gt;state[28])
1153  #define D5   (sc-&gt;state[29])
1154  #define D6   (sc-&gt;state[30])
1155  #define D7   (sc-&gt;state[31])
1156  #endif
1157  static void
1158  compress_big(sph_simd_big_context *sc, int last)
1159  {
1160  	unsigned char *x;
1161  	s32 q[256];
1162  	int i;
1163  	DECL_STATE_BIG
1164  #if SPH_SIMD_NOCOPY
1165  	sph_u32 saved[32];
1166  #endif
1167  #if SPH_SIMD_NOCOPY
1168  	memcpy(saved, sc-&gt;state, sizeof saved);
1169  #endif
1170  	x = sc-&gt;buf;
1171  	FFT256(0, 1, 0, ll);
1172  	if (last) {
1173  		for (i = 0; i &lt; 256; i ++) {
1174  			s32 tq;
1175  			tq = q[i] + yoff_b_f[i];
1176  			tq = REDS2(tq);
1177  			tq = REDS1(tq);
1178  			tq = REDS1(tq);
1179  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1180  		}
1181  	} else {
1182  		for (i = 0; i &lt; 256; i ++) {
1183  			s32 tq;
1184  			tq = q[i] + yoff_b_n[i];
1185  			tq = REDS2(tq);
1186  			tq = REDS1(tq);
1187  			tq = REDS1(tq);
1188  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1189  		}
1190  	}
1191  	READ_STATE_BIG(sc);
1192  	A0 ^= sph_dec32le_aligned(x +   0);
1193  	A1 ^= sph_dec32le_aligned(x +   4);
1194  	A2 ^= sph_dec32le_aligned(x +   8);
1195  	A3 ^= sph_dec32le_aligned(x +  12);
1196  	A4 ^= sph_dec32le_aligned(x +  16);
1197  	A5 ^= sph_dec32le_aligned(x +  20);
1198  	A6 ^= sph_dec32le_aligned(x +  24);
1199  	A7 ^= sph_dec32le_aligned(x +  28);
1200  	B0 ^= sph_dec32le_aligned(x +  32);
1201  	B1 ^= sph_dec32le_aligned(x +  36);
1202  	B2 ^= sph_dec32le_aligned(x +  40);
1203  	B3 ^= sph_dec32le_aligned(x +  44);
1204  	B4 ^= sph_dec32le_aligned(x +  48);
1205  	B5 ^= sph_dec32le_aligned(x +  52);
1206  	B6 ^= sph_dec32le_aligned(x +  56);
1207  	B7 ^= sph_dec32le_aligned(x +  60);
1208  	C0 ^= sph_dec32le_aligned(x +  64);
1209  	C1 ^= sph_dec32le_aligned(x +  68);
1210  	C2 ^= sph_dec32le_aligned(x +  72);
1211  	C3 ^= sph_dec32le_aligned(x +  76);
1212  	C4 ^= sph_dec32le_aligned(x +  80);
1213  	C5 ^= sph_dec32le_aligned(x +  84);
1214  	C6 ^= sph_dec32le_aligned(x +  88);
1215  	C7 ^= sph_dec32le_aligned(x +  92);
1216  	D0 ^= sph_dec32le_aligned(x +  96);
1217  	D1 ^= sph_dec32le_aligned(x + 100);
1218  	D2 ^= sph_dec32le_aligned(x + 104);
1219  	D3 ^= sph_dec32le_aligned(x + 108);
1220  	D4 ^= sph_dec32le_aligned(x + 112);
1221  	D5 ^= sph_dec32le_aligned(x + 116);
1222  	D6 ^= sph_dec32le_aligned(x + 120);
1223  	D7 ^= sph_dec32le_aligned(x + 124);
1224  	ONE_ROUND_BIG(0_, 0,  3, 23, 17, 27);
1225  	ONE_ROUND_BIG(1_, 1, 28, 19, 22,  7);
1226  	ONE_ROUND_BIG(2_, 2, 29,  9, 15,  5);
1227  	ONE_ROUND_BIG(3_, 3,  4, 13, 10, 25);
1228  #if SPH_SIMD_NOCOPY
1229  	STEP_BIG(
1230  		saved[ 0], saved[ 1], saved[ 2], saved[ 3],
1231  		saved[ 4], saved[ 5], saved[ 6], saved[ 7],
1232  		IF,  4, 13, PP8_4_);
1233  	STEP_BIG(
1234  		saved[ 8], saved[ 9], saved[10], saved[11],
1235  		saved[12], saved[13], saved[14], saved[15],
1236  		IF, 13, 10, PP8_5_);
1237  	STEP_BIG(
1238  		saved[16], saved[17], saved[18], saved[19],
1239  		saved[20], saved[21], saved[22], saved[23],
1240  		IF, 10, 25, PP8_6_);
1241  	STEP_BIG(
1242  		saved[24], saved[25], saved[26], saved[27],
1243  		saved[28], saved[29], saved[30], saved[31],
1244  		IF, 25,  4, PP8_0_);
1245  #else
1246  	STEP_BIG(
1247  		sc-&gt;state[ 0], sc-&gt;state[ 1], sc-&gt;state[ 2], sc-&gt;state[ 3],
1248  		sc-&gt;state[ 4], sc-&gt;state[ 5], sc-&gt;state[ 6], sc-&gt;state[ 7],
1249  		IF,  4, 13, PP8_4_);
1250  	STEP_BIG(
1251  		sc-&gt;state[ 8], sc-&gt;state[ 9], sc-&gt;state[10], sc-&gt;state[11],
1252  		sc-&gt;state[12], sc-&gt;state[13], sc-&gt;state[14], sc-&gt;state[15],
1253  		IF, 13, 10, PP8_5_);
1254  	STEP_BIG(
1255  		sc-&gt;state[16], sc-&gt;state[17], sc-&gt;state[18], sc-&gt;state[19],
1256  		sc-&gt;state[20], sc-&gt;state[21], sc-&gt;state[22], sc-&gt;state[23],
1257  		IF, 10, 25, PP8_6_);
1258  	STEP_BIG(
1259  		sc-&gt;state[24], sc-&gt;state[25], sc-&gt;state[26], sc-&gt;state[27],
1260  		sc-&gt;state[28], sc-&gt;state[29], sc-&gt;state[30], sc-&gt;state[31],
1261  		IF, 25,  4, PP8_0_);
1262  	WRITE_STATE_BIG(sc);
1263  #endif
1264  }
1265  #if SPH_SIMD_NOCOPY
1266  #undef A0
1267  #undef A1
1268  #undef A2
1269  #undef A3
1270  #undef A4
1271  #undef A5
1272  #undef A6
1273  #undef A7
1274  #undef B0
1275  #undef B1
1276  #undef B2
1277  #undef B3
1278  #undef B4
1279  #undef B5
1280  #undef B6
1281  #undef B7
1282  #undef C0
1283  #undef C1
1284  #undef C2
1285  #undef C3
1286  #undef C4
1287  #undef C5
1288  #undef C6
1289  #undef C7
1290  #undef D0
1291  #undef D1
1292  #undef D2
1293  #undef D3
1294  #undef D4
1295  #undef D5
1296  #undef D6
1297  #undef D7
1298  #endif
1299  #endif
1300  static const u32 IV224[] = {
1301  	C32(0x33586E9F), C32(0x12FFF033), C32(0xB2D9F64D), C32(0x6F8FEA53),
1302  	C32(0xDE943106), C32(0x2742E439), C32(0x4FBAB5AC), C32(0x62B9FF96),
1303  	C32(0x22E7B0AF), C32(0xC862B3A8), C32(0x33E00CDC), C32(0x236B86A6),
1304  	C32(0xF64AE77C), C32(0xFA373B76), C32(0x7DC1EE5B), C32(0x7FB29CE8)
1305  };
1306  static const u32 IV256[] = {
1307  	C32(0x4D567983), C32(0x07190BA9), C32(0x8474577B), C32(0x39D726E9),
1308  	C32(0xAAF3D925), C32(0x3EE20B03), C32(0xAFD5E751), C32(0xC96006D3),
1309  	C32(0xC2C2BA14), C32(0x49B3BCB4), C32(0xF67CAF46), C32(0x668626C9),
1310  	C32(0xE2EAA8D2), C32(0x1FF47833), C32(0xD0C661A5), C32(0x55693DE1)
1311  };
1312  static const u32 IV384[] = {
1313  	C32(0x8A36EEBC), C32(0x94A3BD90), C32(0xD1537B83), C32(0xB25B070B),
1314  	C32(0xF463F1B5), C32(0xB6F81E20), C32(0x0055C339), C32(0xB4D144D1),
1315  	C32(0x7360CA61), C32(0x18361A03), C32(0x17DCB4B9), C32(0x3414C45A),
1316  	C32(0xA699A9D2), C32(0xE39E9664), C32(0x468BFE77), C32(0x51D062F8),
1317  	C32(0xB9E3BFE8), C32(0x63BECE2A), C32(0x8FE506B9), C32(0xF8CC4AC2),
1318  	C32(0x7AE11542), C32(0xB1AADDA1), C32(0x64B06794), C32(0x28D2F462),
1319  	C32(0xE64071EC), C32(0x1DEB91A8), C32(0x8AC8DB23), C32(0x3F782AB5),
1320  	C32(0x039B5CB8), C32(0x71DDD962), C32(0xFADE2CEA), C32(0x1416DF71)
1321  };
1322  static const u32 IV512[] = {
1323  	C32(0x0BA16B95), C32(0x72F999AD), C32(0x9FECC2AE), C32(0xBA3264FC),
1324  	C32(0x5E894929), C32(0x8E9F30E5), C32(0x2F1DAA37), C32(0xF0F2C558),
1325  	C32(0xAC506643), C32(0xA90635A5), C32(0xE25B878B), C32(0xAAB7878F),
1326  	C32(0x88817F7A), C32(0x0A02892B), C32(0x559A7550), C32(0x598F657E),
1327  	C32(0x7EEF60A1), C32(0x6B70E3E8), C32(0x9C1714D1), C32(0xB958E2A8),
1328  	C32(0xAB02675E), C32(0xED1C014F), C32(0xCD8D65BB), C32(0xFDB7A257),
1329  	C32(0x09254899), C32(0xD699C7BC), C32(0x9019B6DC), C32(0x2B9022E4),
1330  	C32(0x8FA14956), C32(0x21BF9BD3), C32(0xB94D0943), C32(0x6FFDDC22)
1331  };
1332  static void
1333  init_small(void *cc, const u32 *iv)
1334  {
1335  	sph_simd_small_context *sc;
1336  	sc = cc;
1337  	memcpy(sc-&gt;state, iv, sizeof sc-&gt;state);
1338  	sc-&gt;count_low = sc-&gt;count_high = 0;
1339  	sc-&gt;ptr = 0;
1340  }
1341  static void
1342  init_big(void *cc, const u32 *iv)
1343  {
1344  	sph_simd_big_context *sc;
1345  	sc = cc;
1346  	memcpy(sc-&gt;state, iv, sizeof sc-&gt;state);
1347  	sc-&gt;count_low = sc-&gt;count_high = 0;
1348  	sc-&gt;ptr = 0;
1349  }
1350  static void
1351  update_small(void *cc, const void *data, size_t len)
1352  {
1353  	sph_simd_small_context *sc;
1354  	sc = cc;
1355  	while (len &gt; 0) {
1356  		size_t clen;
1357  		clen = (sizeof sc-&gt;buf) - sc-&gt;ptr;
1358  		if (clen &gt; len)
1359  			clen = len;
1360  		memcpy(sc-&gt;buf + sc-&gt;ptr, data, clen);
1361  		data = (const unsigned char *)data + clen;
1362  		len -= clen;
1363  		if ((sc-&gt;ptr += clen) == sizeof sc-&gt;buf) {
1364  			compress_small(sc, 0);
1365  			sc-&gt;ptr = 0;
1366  			sc-&gt;count_low = T32(sc-&gt;count_low + 1);
1367  			if (sc-&gt;count_low == 0)
1368  				sc-&gt;count_high ++;
1369  		}
1370  	}
1371  }
1372  static void
1373  update_big(void *cc, const void *data, size_t len)
1374  {
1375  	sph_simd_big_context *sc;
1376  	sc = cc;
1377  	while (len &gt; 0) {
1378  		size_t clen;
1379  		clen = (sizeof sc-&gt;buf) - sc-&gt;ptr;
1380  		if (clen &gt; len)
1381  			clen = len;
1382  		memcpy(sc-&gt;buf + sc-&gt;ptr, data, clen);
1383  		data = (const unsigned char *)data + clen;
1384  		len -= clen;
1385  		if ((sc-&gt;ptr += clen) == sizeof sc-&gt;buf) {
1386  			compress_big(sc, 0);
1387  			sc-&gt;ptr = 0;
1388  			sc-&gt;count_low = T32(sc-&gt;count_low + 1);
1389  			if (sc-&gt;count_low == 0)
1390  				sc-&gt;count_high ++;
1391  		}
1392  	}
1393  }
1394  static void
1395  encode_count_small(unsigned char *dst,
1396  	u32 low, u32 high, size_t ptr, unsigned n)
1397  {
1398  	low = T32(low &lt;&lt; 9);
1399  	high = T32(high &lt;&lt; 9) + (low &gt;&gt; 23);
1400  	low += (ptr &lt;&lt; 3) + n;
1401  	sph_enc32le(dst, low);
1402  	sph_enc32le(dst + 4, high);
1403  }
1404  static void
1405  encode_count_big(unsigned char *dst,
1406  	u32 low, u32 high, size_t ptr, unsigned n)
1407  {
1408  	low = T32(low &lt;&lt; 10);
1409  	high = T32(high &lt;&lt; 10) + (low &gt;&gt; 22);
1410  	low += (ptr &lt;&lt; 3) + n;
1411  	sph_enc32le(dst, low);
1412  	sph_enc32le(dst + 4, high);
1413  }
1414  static void
1415  finalize_small(void *cc, unsigned ub, unsigned n, void *dst, size_t dst_len)
1416  {
1417  	sph_simd_small_context *sc;
1418  	unsigned char *d;
1419  	size_t u;
1420  	sc = cc;
1421  	if (sc-&gt;ptr &gt; 0 || n &gt; 0) {
1422  		memset(sc-&gt;buf + sc-&gt;ptr, 0,
1423  			(sizeof sc-&gt;buf) - sc-&gt;ptr);
1424  		sc-&gt;buf[sc-&gt;ptr] = ub &amp; (0xFF &lt;&lt; (8 - n));
1425  		compress_small(sc, 0);
1426  	}
1427  	memset(sc-&gt;buf, 0, sizeof sc-&gt;buf);
1428  	encode_count_small(sc-&gt;buf, sc-&gt;count_low, sc-&gt;count_high, sc-&gt;ptr, n);
1429  	compress_small(sc, 1);
1430  	d = dst;
1431  	for (d = dst, u = 0; u &lt; dst_len; u ++)
1432  		sph_enc32le(d + (u &lt;&lt; 2), sc-&gt;state[u]);
1433  }
1434  static void
1435  finalize_big(void *cc, unsigned ub, unsigned n, void *dst, size_t dst_len)
1436  {
1437  	sph_simd_big_context *sc;
1438  	unsigned char *d;
1439  	size_t u;
1440  	sc = cc;
1441  	if (sc-&gt;ptr &gt; 0 || n &gt; 0) {
1442  		memset(sc-&gt;buf + sc-&gt;ptr, 0,
1443  			(sizeof sc-&gt;buf) - sc-&gt;ptr);
1444  		sc-&gt;buf[sc-&gt;ptr] = ub &amp; (0xFF &lt;&lt; (8 - n));
1445  		compress_big(sc, 0);
1446  	}
1447  	memset(sc-&gt;buf, 0, sizeof sc-&gt;buf);
1448  	encode_count_big(sc-&gt;buf, sc-&gt;count_low, sc-&gt;count_high, sc-&gt;ptr, n);
1449  	compress_big(sc, 1);
1450  	d = dst;
1451  	for (d = dst, u = 0; u &lt; dst_len; u ++)
1452  		sph_enc32le(d + (u &lt;&lt; 2), sc-&gt;state[u]);
1453  }
1454  void
1455  sph_simd224_init(void *cc)
1456  {
1457  	init_small(cc, IV224);
1458  }
1459  void
1460  sph_simd224(void *cc, const void *data, size_t len)
1461  {
1462  	update_small(cc, data, len);
1463  }
1464  void
1465  sph_simd224_close(void *cc, void *dst)
1466  {
1467  	sph_simd224_addbits_and_close(cc, 0, 0, dst);
1468  }
1469  void
1470  sph_simd224_addbits_and_close(void *cc, unsigned ub, unsigned n, void *dst)
1471  {
1472  	finalize_small(cc, ub, n, dst, 7);
1473  	sph_simd224_init(cc);
1474  }
1475  void
1476  sph_simd256_init(void *cc)
1477  {
1478  	init_small(cc, IV256);
1479  }
1480  void
1481  sph_simd256(void *cc, const void *data, size_t len)
1482  {
1483  	update_small(cc, data, len);
1484  }
1485  void
1486  sph_simd256_close(void *cc, void *dst)
1487  {
1488  	sph_simd256_addbits_and_close(cc, 0, 0, dst);
1489  }
1490  void
1491  sph_simd256_addbits_and_close(void *cc, unsigned ub, unsigned n, void *dst)
1492  {
1493  	finalize_small(cc, ub, n, dst, 8);
1494  	sph_simd256_init(cc);
1495  }
1496  void
1497  sph_simd384_init(void *cc)
1498  {
1499  	init_big(cc, IV384);
1500  }
1501  void
1502  sph_simd384(void *cc, const void *data, size_t len)
1503  {
1504  	update_big(cc, data, len);
1505  }
1506  void
1507  sph_simd384_close(void *cc, void *dst)
1508  {
1509  	sph_simd384_addbits_and_close(cc, 0, 0, dst);
1510  }
1511  void
1512  sph_simd384_addbits_and_close(void *cc, unsigned ub, unsigned n, void *dst)
1513  {
1514  	finalize_big(cc, ub, n, dst, 12);
1515  	sph_simd384_init(cc);
1516  }
1517  void
1518  sph_simd512_init(void *cc)
1519  {
1520  	init_big(cc, IV512);
1521  }
1522  void
1523  sph_simd512(void *cc, const void *data, size_t len)
1524  {
1525  	update_big(cc, data, len);
1526  }
1527  void
1528  sph_simd512_close(void *cc, void *dst)
1529  {
1530  	sph_simd512_addbits_and_close(cc, 0, 0, dst);
1531  }
1532  void
1533  sph_simd512_addbits_and_close(void *cc, unsigned ub, unsigned n, void *dst)
1534  {
1535  	finalize_big(cc, ub, n, dst, 16);
1536  	sph_simd512_init(cc);
1537  }
1538  #ifdef __cplusplus
1539  }
1540  #endif
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-sph_simd.c</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-sph_simd.c</div>
                </div>
                <div class="column column_space"><pre><code>703  	s32 q[128];
704  	int i;
705  	u32 w[32];
706  	u32 state[16];
707  	size_t u;
708  	static const size_t wsp[32] = {
709  		 4 &lt;&lt; 3,  6 &lt;&lt; 3,  0 &lt;&lt; 3,  2 &lt;&lt; 3,
710  		 7 &lt;&lt; 3,  5 &lt;&lt; 3,  3 &lt;&lt; 3,  1 &lt;&lt; 3,
711  		15 &lt;&lt; 3, 11 &lt;&lt; 3, 12 &lt;&lt; 3,  8 &lt;&lt; 3,
712  		 9 &lt;&lt; 3, 13 &lt;&lt; 3, 10 &lt;&lt; 3, 14 &lt;&lt; 3,
713  		17 &lt;&lt; 3, 18 &lt;&lt; 3, 23 &lt;&lt; 3, 20 &lt;&lt; 3,
714  		22 &lt;&lt; 3, 21 &lt;&lt; 3, 16 &lt;&lt; 3, 19 &lt;&lt; 3,
715  		30 &lt;&lt; 3, 24 &lt;&lt; 3, 25 &lt;&lt; 3, 31 &lt;&lt; 3,
716  		27 &lt;&lt; 3, 29 &lt;&lt; 3, 28 &lt;&lt; 3, 26 &lt;&lt; 3
717  	};
718  	x = sc-&gt;buf;
719  	FFT128(0, 1, 0, ll);
720  	if (last) {
721  		for (i = 0; i &lt; 128; i ++) {
722  			s32 tq;
723  			tq = q[i] + yoff_s_f[i];
724  			tq = REDS2(tq);
725  			tq = REDS1(tq);
726  			tq = REDS1(tq);
727  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
728  		}
729  	} else {
730  		for (i = 0; i &lt; 128; i ++) {
731  			s32 tq;
732  			tq = q[i] + yoff_s_n[i];
733  			tq = REDS2(tq);
734  			tq = REDS1(tq);
735  			tq = REDS1(tq);
736  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
737  		}
738  	}
739  	for (i = 0; i &lt; 16; i += 4) {
740  		state[i + 0] = sc-&gt;state[i + 0]
741  			^ sph_dec32le_aligned(x + 4 * (i + 0));
742  		state[i + 1] = sc-&gt;state[i + 1]
743  			^ sph_dec32le_aligned(x + 4 * (i + 1));
744  		state[i + 2] = sc-&gt;state[i + 2]
745  			^ sph_dec32le_aligned(x + 4 * (i + 2));
746  		state[i + 3] = sc-&gt;state[i + 3]
747  			^ sph_dec32le_aligned(x + 4 * (i + 3));
748  	}
</pre></code></div>
                <div class="column column_space"><pre><code>988  	s32 q[256];
989  	int i;
990  	u32 w[64];
991  	u32 state[32];
992  	size_t u;
993  	static const size_t wbp[32] = {
994  		 4 &lt;&lt; 4,  6 &lt;&lt; 4,  0 &lt;&lt; 4,  2 &lt;&lt; 4,
995  		 7 &lt;&lt; 4,  5 &lt;&lt; 4,  3 &lt;&lt; 4,  1 &lt;&lt; 4,
996  		15 &lt;&lt; 4, 11 &lt;&lt; 4, 12 &lt;&lt; 4,  8 &lt;&lt; 4,
997  		 9 &lt;&lt; 4, 13 &lt;&lt; 4, 10 &lt;&lt; 4, 14 &lt;&lt; 4,
998  		17 &lt;&lt; 4, 18 &lt;&lt; 4, 23 &lt;&lt; 4, 20 &lt;&lt; 4,
999  		22 &lt;&lt; 4, 21 &lt;&lt; 4, 16 &lt;&lt; 4, 19 &lt;&lt; 4,
1000  		30 &lt;&lt; 4, 24 &lt;&lt; 4, 25 &lt;&lt; 4, 31 &lt;&lt; 4,
1001  		27 &lt;&lt; 4, 29 &lt;&lt; 4, 28 &lt;&lt; 4, 26 &lt;&lt; 4
1002  	};
1003  	x = sc-&gt;buf;
1004  	FFT256(0, 1, 0, ll);
1005  	if (last) {
1006  		for (i = 0; i &lt; 256; i ++) {
1007  			s32 tq;
1008  			tq = q[i] + yoff_b_f[i];
1009  			tq = REDS2(tq);
1010  			tq = REDS1(tq);
1011  			tq = REDS1(tq);
1012  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1013  		}
1014  	} else {
1015  		for (i = 0; i &lt; 256; i ++) {
1016  			s32 tq;
1017  			tq = q[i] + yoff_b_n[i];
1018  			tq = REDS2(tq);
1019  			tq = REDS1(tq);
1020  			tq = REDS1(tq);
1021  			q[i] = (tq &lt;= 128 ? tq : tq - 257);
1022  		}
1023  	}
1024  	for (i = 0; i &lt; 32; i += 8) {
1025  		state[i + 0] = sc-&gt;state[i + 0]
1026  			^ sph_dec32le_aligned(x + 4 * (i + 0));
1027  		state[i + 1] = sc-&gt;state[i + 1]
1028  			^ sph_dec32le_aligned(x + 4 * (i + 1));
1029  		state[i + 2] = sc-&gt;state[i + 2]
1030  			^ sph_dec32le_aligned(x + 4 * (i + 2));
1031  		state[i + 3] = sc-&gt;state[i + 3]
1032  			^ sph_dec32le_aligned(x + 4 * (i + 3));
1033  		state[i + 4] = sc-&gt;state[i + 4]
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    