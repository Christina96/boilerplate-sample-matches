<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for smartcrop.c &amp; webpload.c</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for smartcrop.c &amp; webpload.c
      </h3>
<h1 align="center">
        5.4%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>smartcrop.c (5.533597%)<th>webpload.c (5.3846154%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(403-442)<td><a href="#" name="0">(171-215)</a><td align="center"><font color="#ff0000">14</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>smartcrop.c</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 #ifdef HAVE_CONFIG_H
2 #include &lt;config.h&gt;
3 #include &lt;vips/intl.h&gt;
4 #include &lt;stdio.h&gt;
5 #include &lt;string.h&gt;
6 #include &lt;stdlib.h&gt;
7 #include &lt;vips/vips.h&gt;
8 #include &lt;vips/debug.h&gt;
9 #include "pconversion.h"
10 #include "bandary.h"
11 typedef struct _VipsSmartcrop {
12 	VipsConversion parent_instance;
13 	VipsImage *in;
14 	int width;
15 	int height;
16 	VipsInteresting interesting;
17 } VipsSmartcrop;
18 typedef VipsConversionClass VipsSmartcropClass;
19 G_DEFINE_TYPE( VipsSmartcrop, vips_smartcrop, VIPS_TYPE_CONVERSION );
20 static int
21 vips_smartcrop_score( VipsSmartcrop *smartcrop, VipsImage *in, 
22 	int left, int top, int width, int height, double *score )
23 {
24 	VipsImage **t = (VipsImage **) 
25 		vips_object_local_array( VIPS_OBJECT( smartcrop ), 2 );
26 	if( vips_extract_area( in, &amp;t[0], left, top, width, height, NULL ) ||
27 		vips_hist_find( t[0], &amp;t[1], NULL ) ||
28 		vips_hist_entropy( t[1], score, NULL ) )
29 		return( -1 );
30 	return( 0 );
31 }
32 static int
33 vips_smartcrop_entropy( VipsSmartcrop *smartcrop, 
34 	VipsImage *in, int *left, int *top )
35 {
36 	int max_slice_size;
37 	int width;
38 	int height;
39 	*left = 0;
40 	*top = 0;
41 	width = in-&gt;Xsize;
42 	height = in-&gt;Ysize;
43 	max_slice_size = VIPS_MAX( 
44 		ceil( (width - smartcrop-&gt;width) / 8.0 ),
45 		ceil( (height - smartcrop-&gt;height) / 8.0 ) );
46 	while( width &gt; smartcrop-&gt;width || 
47 		height &gt; smartcrop-&gt;height ) {
48 		const int slice_width = 
49 			VIPS_MIN( width - smartcrop-&gt;width, max_slice_size );
50 		const int slice_height = 
51 			VIPS_MIN( height - smartcrop-&gt;height, max_slice_size );
52 		if( slice_width &gt; 0 ) { 
53 			double left_score;
54 			double right_score;
55 			if( vips_smartcrop_score( smartcrop, in, 
56 				*left, *top, 
57 				slice_width, height, &amp;left_score ) )
58 				return( -1 );
59 			if( vips_smartcrop_score( smartcrop, in, 
60 				*left + width - slice_width, *top, 
61 				slice_width, height, &amp;right_score ) )
62 				return( -1 ); 
63 			width -= slice_width;
64 			if( left_score &lt; right_score ) 
65 				*left += slice_width;
66 		}
67 		if( slice_height &gt; 0 ) { 
68 			double top_score;
69 			double bottom_score;
70 			if( vips_smartcrop_score( smartcrop, in, 
71 				*left, *top, 
72 				width, slice_height, &amp;top_score ) )
73 				return( -1 );
74 			if( vips_smartcrop_score( smartcrop, in, 
75 				*left, *top + height - slice_height, 
76 				width, slice_height, &amp;bottom_score ) )
77 				return( -1 ); 
78 			height -= slice_height;
79 			if( top_score &lt; bottom_score ) 
80 				*top += slice_height;
81 		}
82 	}
83 	return( 0 );
84 }
85 static int
86 pythagoras( VipsSmartcrop *smartcrop, VipsImage *in, VipsImage **out )
87 {
88 	VipsImage **t = (VipsImage **) 
89 		vips_object_local_array( VIPS_OBJECT( smartcrop ), 
90 			2 * in-&gt;Bands + 1 );
91 	int i;
92 	for( i = 0; i &lt; in-&gt;Bands; i++ ) 
93 		if( vips_extract_band( in, &amp;t[i], i, NULL ) )
94 			return( -1 );
95 	for( i = 0; i &lt; in-&gt;Bands; i++ ) 
96 		if( vips_multiply( t[i], t[i], &amp;t[i + in-&gt;Bands], NULL ) )
97 			return( -1 );
98 	if( vips_sum( &amp;t[in-&gt;Bands], &amp;t[2 * in-&gt;Bands], in-&gt;Bands, NULL ) ||
99 		vips_pow_const1( t[2 * in-&gt;Bands], out, 0.5, NULL ) )
100 		return( -1 );
101 	return( 0 );
102 }
103 static int
104 vips_smartcrop_attention( VipsSmartcrop *smartcrop, 
105 	VipsImage *in, int *left, int *top )
106 {
107 	static double skin_vector[] = {-0.78, -0.57, -0.44};
108 	static double ones[] = {1.0, 1.0, 1.0};
109 	VipsImage **t = (VipsImage **) 
110 		vips_object_local_array( VIPS_OBJECT( smartcrop ), 24 );
111 	double hscale;
112 	double vscale;
113 	double sigma;
114 	double max;
115 	int x_pos;
116 	int y_pos;
117 	hscale = 32.0 / in-&gt;Xsize;
118 	vscale = 32.0 / in-&gt;Ysize;
119 	sigma = VIPS_MAX( sqrt( pow( smartcrop-&gt;width * hscale, 2 ) +
120 		pow( smartcrop-&gt;height * vscale, 2 ) ) / 10, 1.0 );
121 	if ( vips_resize( in, &amp;t[17], hscale,
122 		"vscale", vscale,
123 		NULL ) )
124 		return( -1 );
125 	if( !(t[21] = vips_image_new_matrixv( 3, 3,
126 		 0.0, -1.0,  0.0, 
127 		-1.0,  4.0, -1.0, 
128 		 0.0, -1.0,  0.0 )) )
129 		return( -1 );
130 	if( vips_colourspace( t[17], &amp;t[0], VIPS_INTERPRETATION_XYZ, NULL ) ||
131 		vips_extract_band( t[0], &amp;t[1], 0, "n", 3, NULL ) )
132 		return( -1 );
133 	if( vips_extract_band( t[1], &amp;t[2], 1, NULL ) ||
134 		vips_conv( t[2], &amp;t[3], t[21], 
135 			"precision", VIPS_PRECISION_INTEGER,
136 			NULL ) ||
137 		vips_linear1( t[3], &amp;t[4], 5.0, 0.0, NULL ) ||
138 		vips_abs( t[4], &amp;t[14], NULL ) )
139 		return( -1 );
140 	if( 
141 		pythagoras( smartcrop, t[1], &amp;t[5] ) ||
142 		vips_divide( t[1], t[5], &amp;t[6], NULL ) ||
143 		vips_linear( t[6], &amp;t[7], ones, skin_vector, 3, NULL ) ||
144 		pythagoras( smartcrop, t[7], &amp;t[8] ) ||
145 		vips_linear1( t[8], &amp;t[9], -100.0, 100.0, NULL ) ||
146 		vips_more_const1( t[2], &amp;t[10], 5.0, NULL ) ||
147 		!(t[11] = vips_image_new_from_image1( t[10], 0.0 )) ||
148 		vips_ifthenelse( t[10], t[9], t[11], &amp;t[15], NULL ) )
149 		return( -1 );
150 	if( vips_colourspace( t[1], &amp;t[12], 
151 		VIPS_INTERPRETATION_LAB, NULL ) ||
152 		vips_extract_band( t[12], &amp;t[13], 1, NULL ) ||
153 		vips_ifthenelse( t[10], t[13], t[11], &amp;t[16], NULL ) )
154 		return( -1 );
155 	if( vips_sum( &amp;t[14], &amp;t[18], 3, NULL ) ||
156 		vips_gaussblur( t[18], &amp;t[19], sigma, NULL ) ||
157 		vips_max( t[19], &amp;max, "x", &amp;x_pos, "y", &amp;y_pos, NULL ) )
158 		return( -1 ); 
159 	*left = VIPS_CLIP( 0, 
160 		x_pos / hscale - smartcrop-&gt;width / 2, 
161 		in-&gt;Xsize - smartcrop-&gt;width );
162 	*top = VIPS_CLIP( 0, 
163 		y_pos / vscale - smartcrop-&gt;height / 2, 
164 		in-&gt;Ysize - smartcrop-&gt;height ); 
165 	return( 0 ); 
166 }
167 static int
168 vips_smartcrop_build( VipsObject *object )
169 {
170 	VipsObjectClass *class = VIPS_OBJECT_GET_CLASS( object );
171 	VipsConversion *conversion = VIPS_CONVERSION( object );
172 	VipsSmartcrop *smartcrop = (VipsSmartcrop *) object;
173 	VipsImage **t = (VipsImage **) vips_object_local_array( object, 2 );
174 	VipsImage *in;
175 	int left;
176 	int top;
177 	if( VIPS_OBJECT_CLASS( vips_smartcrop_parent_class )-&gt;
178 		build( object ) )
179 		return( -1 );
180 	if( smartcrop-&gt;width &gt; smartcrop-&gt;in-&gt;Xsize ||
181 		smartcrop-&gt;height &gt; smartcrop-&gt;in-&gt;Ysize ||
182 		smartcrop-&gt;width &lt;= 0 || smartcrop-&gt;height &lt;= 0 ) {
183 		vips_error( class-&gt;nickname, "%s", _( "bad extract area" ) );
184 		return( -1 );
185 	}
186 	in = smartcrop-&gt;in;
187 	if( vips_image_hasalpha( in ) ) { 
188 		if( vips_premultiply( in, &amp;t[0], NULL ) ) 
189 			return( -1 );
190 		in = t[0];
191 	}
192 	switch( smartcrop-&gt;interesting ) {
193 	case VIPS_INTERESTING_NONE:
194 	case VIPS_INTERESTING_LOW:
195 		left = 0;
196 		top = 0;
197 		break;
198 	case VIPS_INTERESTING_CENTRE:
199 		left = (in-&gt;Xsize - smartcrop-&gt;width) / 2;
200 		top = (in-&gt;Ysize - smartcrop-&gt;height) / 2;
201 		break;
202 	case VIPS_INTERESTING_ENTROPY:
203 		if( vips_smartcrop_entropy( smartcrop, in, &amp;left, &amp;top ) )
204 			return( -1 );
205 		break;
206 	case VIPS_INTERESTING_ATTENTION:
207 		if( vips_smartcrop_attention( smartcrop, in, &amp;left, &amp;top ) )
208 			return( -1 );
209 		break;
210 	case VIPS_INTERESTING_HIGH:
211 		left = in-&gt;Xsize - smartcrop-&gt;width;
212 		top = in-&gt;Ysize - smartcrop-&gt;height;
213 		break;
214 	case VIPS_INTERESTING_ALL:
215 		left = 0;
216 		top = 0;
217 		smartcrop-&gt;width = in-&gt;Xsize;
218 		smartcrop-&gt;height = in-&gt;Ysize;
219 		break;
220 	default:
221 		g_assert_not_reached();
222 		left = 0;
223 		top = 0;
224 		break;
225 	}
226 	if( vips_extract_area( smartcrop-&gt;in, &amp;t[1], 
227 			left, top, 
228 			smartcrop-&gt;width, smartcrop-&gt;height, NULL ) ||
229 		vips_image_write( t[1], conversion-&gt;out ) )
230 		return( -1 ); 
231 	return( 0 );
232 }
233 static void
234 vips_smartcrop_class_init( VipsSmartcropClass *class )
235 {
236 	GObjectClass *gobject_class = G_OBJECT_CLASS( class );
237 	VipsObjectClass *vobject_class = VIPS_OBJECT_CLASS( class );
238 <a name="0"></a>
239 	VIPS_DEBUG_MSG( "vips_smartcrop_class_init\n" );
240 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>	gobject_class-&gt;set_property = vips_object_set_property;
241 	gobject_class-&gt;get_property = vips_object_get_property;
242 	vobject_class-&gt;nickname = "smartcrop";
243 	vobject_class-&gt;description = _( "extract an area from an image" );
244 	vobject_class-&gt;build = vips_smartcrop_build;
245 	VIPS_ARG_IMAGE( class, "input", 0, 
246 		_( "Input" ), 
247 		_( "Input image" ),
248 		VIPS_ARGUMENT_REQUIRED_INPUT,
249 		G_STRUCT_OFFSET( VipsSmartcrop, in ) );
250 	VIPS_ARG_INT( class, "width", 4, 
251 		_( "Width" ), 
252 		_( "Width of extract area" ),
253 		VIPS_ARGUMENT_REQUIRED_INPUT,
254 		G_STRUCT_OFFSET( VipsSmartcrop, width ),
255 		1, VIPS_MAX_COORD, 1 );
256 	VIPS_ARG_INT( class, "height", 5, 
257 		_( "Height" ), 
258 		_( "Height of extract area" ),
259 		VIPS_ARGUMENT_REQUIRED_INPUT,
260 		G_STRUCT_OFFSET( VipsSmartcrop, height ),
261 		1, VIPS_MAX_COORD, 1 );
262 	VIPS_ARG_ENUM( class, "interesting", 6, 
263 		_( "Interesting" ), 
264 		_( "How to measure interestingness" ),
265 		VIPS_ARGUMENT_OPTIONAL_INPUT,
266 		G_STRUCT_OFFSET( VipsSmartcrop, interesting ),
267 		VIPS_TYPE_INTERESTING, VIPS_INTERESTING_ATTENTION );
268 }
269 static void
270 vips_smartcrop_init( VipsSmartcrop *smartcrop )
271 {
272 	smartcrop-&gt;interesting = VIPS_INTERESTING_ATTENTION;</b></font>
273 }
274 int
275 vips_smartcrop( VipsImage *in, VipsImage **out, int width, int height, ... )
276 {
277 	va_list ap;
278 	int result;
279 	va_start( ap, height );
280 	result = vips_call_split( "smartcrop", ap, in, out, width, height );
281 	va_end( ap );
282 	return( result );
283 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>webpload.c</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 #ifdef HAVE_CONFIG_H
2 #include &lt;config.h&gt;
3 #include &lt;vips/intl.h&gt;
4 #include &lt;string.h&gt;
5 #include &lt;vips/vips.h&gt;
6 #include "pforeign.h"
7 #ifdef HAVE_LIBWEBP
8 typedef struct _VipsForeignLoadWebp {
9 	VipsForeignLoad parent_object;
10 	VipsSource *source;
11 	int page;
12 	int n;
13 	double scale; 
14 	int shrink;
15 } VipsForeignLoadWebp;
16 typedef VipsForeignLoadClass VipsForeignLoadWebpClass;
17 G_DEFINE_ABSTRACT_TYPE( VipsForeignLoadWebp, vips_foreign_load_webp, 
18 	VIPS_TYPE_FOREIGN_LOAD );
19 static void
20 vips_foreign_load_webp_dispose( GObject *gobject )
21 {
22 	VipsForeignLoadWebp *webp = (VipsForeignLoadWebp *) gobject;
23 	VIPS_UNREF( webp-&gt;source );
24 	G_OBJECT_CLASS( vips_foreign_load_webp_parent_class )-&gt;
25 		dispose( gobject );
26 }
27 static int
28 vips_foreign_load_webp_build( VipsObject *object )
29 {
30 	VipsForeignLoadWebp *webp = (VipsForeignLoadWebp *) object;
31 	if( !vips_object_argument_isset( VIPS_OBJECT( webp ), "scale" ) &amp;&amp;
32 		vips_object_argument_isset( VIPS_OBJECT( webp ), "shrink" ) &amp;&amp;
33 		webp-&gt;shrink != 0 )
34 		webp-&gt;scale = 1.0 / webp-&gt;shrink;
35 	if( VIPS_OBJECT_CLASS( vips_foreign_load_webp_parent_class )-&gt;
36 		build( object ) )
37 		return( -1 );
38 	return( 0 );
39 }
40 static VipsForeignFlags
41 vips_foreign_load_webp_get_flags( VipsForeignLoad *load )
42 {
43 	return( 0 );
44 }
45 static VipsForeignFlags
46 vips_foreign_load_webp_get_flags_filename( const char *filename )
47 {
48 	return( 0 );
49 }
50 static int
51 vips_foreign_load_webp_header( VipsForeignLoad *load )
52 {
53 	VipsForeignLoadWebp *webp = (VipsForeignLoadWebp *) load;
54 	if( vips__webp_read_header_source( webp-&gt;source, load-&gt;out, 
55 		webp-&gt;page, webp-&gt;n, webp-&gt;scale ) ) 
56 		return( -1 );
57 	return( 0 );
58 }
59 static int
60 vips_foreign_load_webp_load( VipsForeignLoad *load )
61 {
62 	VipsForeignLoadWebp *webp = (VipsForeignLoadWebp *) load;
63 	if( vips__webp_read_source( webp-&gt;source, load-&gt;real, 
64 		webp-&gt;page, webp-&gt;n, webp-&gt;scale ) ) 
65 		return( -1 );
66 	return( 0 );
67 }
68 static void
69 vips_foreign_load_webp_class_init( VipsForeignLoadWebpClass *class )
70 {
71 	GObjectClass *gobject_class = G_OBJECT_CLASS( class );
72 	VipsObjectClass *object_class = (VipsObjectClass *) class;
73 	VipsForeignClass *foreign_class = (VipsForeignClass *) class;
74 	VipsForeignLoadClass *load_class = (VipsForeignLoadClass *) class;
75 	gobject_class-&gt;dispose = vips_foreign_load_webp_dispose;
76 	gobject_class-&gt;set_property = vips_object_set_property;
77 	gobject_class-&gt;get_property = vips_object_get_property;
78 	object_class-&gt;nickname = "webpload_base";
79 	object_class-&gt;description = _( "load webp" );
80 	object_class-&gt;build = vips_foreign_load_webp_build;
81 <a name="0"></a>
82 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>	foreign_class-&gt;priority = -50;
83 	load_class-&gt;get_flags_filename = 
84 		vips_foreign_load_webp_get_flags_filename;
85 	load_class-&gt;get_flags = vips_foreign_load_webp_get_flags;
86 	load_class-&gt;header = vips_foreign_load_webp_header;
87 	load_class-&gt;load = vips_foreign_load_webp_load;
88 	VIPS_ARG_INT( class, "page", 20,
89 		_( "Page" ),
90 		_( "Load this page from the file" ),
91 		VIPS_ARGUMENT_OPTIONAL_INPUT,
92 		G_STRUCT_OFFSET( VipsForeignLoadWebp, page ),
93 		0, 100000, 0 );
94 	VIPS_ARG_INT( class, "n", 21,
95 		_( "n" ),
96 		_( "Load this many pages" ),
97 		VIPS_ARGUMENT_OPTIONAL_INPUT,
98 		G_STRUCT_OFFSET( VipsForeignLoadWebp, n ),
99 		-1, 100000, 1 );
100 	VIPS_ARG_DOUBLE( class, "scale", 22, 
101 		_( "Scale" ), 
102 		_( "Scale factor on load" ),
103 		VIPS_ARGUMENT_OPTIONAL_INPUT,
104 		G_STRUCT_OFFSET( VipsForeignLoadWebp, scale ),
105 		0.0, 1024.0, 1.0 );
106 	VIPS_ARG_INT( class, "shrink", 23, 
107 		_( "Shrink" ), 
108 		_( "Shrink factor on load" ),
109 		VIPS_ARGUMENT_OPTIONAL_INPUT | VIPS_ARGUMENT_DEPRECATED,
110 		G_STRUCT_OFFSET( VipsForeignLoadWebp, shrink ),
111 		1, 1024, 1 );
112 }
113 static void
114 vips_foreign_load_webp_init( VipsForeignLoadWebp *webp )
115 {
116 	webp-&gt;n = 1;</b></font>
117 	webp-&gt;shrink = 1;
118 	webp-&gt;scale = 1.0;
119 }
120 typedef struct _VipsForeignLoadWebpSource {
121 	VipsForeignLoadWebp parent_object;
122 	VipsSource *source;
123 } VipsForeignLoadWebpSource;
124 typedef VipsForeignLoadWebpClass VipsForeignLoadWebpSourceClass;
125 G_DEFINE_TYPE( VipsForeignLoadWebpSource, vips_foreign_load_webp_source, 
126 	vips_foreign_load_webp_get_type() );
127 static int
128 vips_foreign_load_webp_source_build( VipsObject *object )
129 {
130 	VipsForeignLoadWebp *webp = (VipsForeignLoadWebp *) object;
131 	VipsForeignLoadWebpSource *source = 
132 		(VipsForeignLoadWebpSource *) object;
133 	if( source-&gt;source ) {
134 		webp-&gt;source = source-&gt;source;
135 		g_object_ref( webp-&gt;source );
136 	}
137 	if( VIPS_OBJECT_CLASS( vips_foreign_load_webp_source_parent_class )-&gt;
138 		build( object ) )
139 		return( -1 );
140 	return( 0 );
141 }
142 static void
143 vips_foreign_load_webp_source_class_init( 
144 	VipsForeignLoadWebpSourceClass *class )
145 {
146 	GObjectClass *gobject_class = G_OBJECT_CLASS( class );
147 	VipsObjectClass *object_class = (VipsObjectClass *) class;
148 	VipsForeignLoadClass *load_class = (VipsForeignLoadClass *) class;
149 	gobject_class-&gt;set_property = vips_object_set_property;
150 	gobject_class-&gt;get_property = vips_object_get_property;
151 	object_class-&gt;nickname = "webpload_source";
152 	object_class-&gt;description = _( "load webp from source" );
153 	object_class-&gt;build = vips_foreign_load_webp_source_build;
154 	load_class-&gt;is_a_source = vips__iswebp_source; 
155 	VIPS_ARG_OBJECT( class, "source", 1,
156 		_( "Source" ),
157 		_( "Source to load from" ),
158 		VIPS_ARGUMENT_REQUIRED_INPUT, 
159 		G_STRUCT_OFFSET( VipsForeignLoadWebpSource, source ),
160 		VIPS_TYPE_SOURCE );
161 }
162 static void
163 vips_foreign_load_webp_source_init( VipsForeignLoadWebpSource *buffer )
164 {
165 }
166 typedef struct _VipsForeignLoadWebpFile {
167 	VipsForeignLoadWebp parent_object;
168 	char *filename; 
169 } VipsForeignLoadWebpFile;
170 typedef VipsForeignLoadWebpClass VipsForeignLoadWebpFileClass;
171 G_DEFINE_TYPE( VipsForeignLoadWebpFile, vips_foreign_load_webp_file, 
172 	vips_foreign_load_webp_get_type() );
173 static int
174 vips_foreign_load_webp_file_build( VipsObject *object )
175 {
176 	VipsForeignLoadWebp *webp = (VipsForeignLoadWebp *) object;
177 	VipsForeignLoadWebpFile *file = (VipsForeignLoadWebpFile *) object;
178 	if( file-&gt;filename &amp;&amp;
179 		!(webp-&gt;source = 
180 			vips_source_new_from_file( file-&gt;filename )) )
181 		return( -1 );
182 	if( VIPS_OBJECT_CLASS( vips_foreign_load_webp_file_parent_class )-&gt;
183 		build( object ) )
184 		return( -1 );
185 	return( 0 );
186 }
187 static gboolean
188 vips_foreign_load_webp_file_is_a( const char *filename )
189 {
190 	VipsSource *source;
191 	gboolean result;
192 	if( !(source = vips_source_new_from_file( filename )) )
193 		return( FALSE );
194 	result = vips__iswebp_source( source );
195 	VIPS_UNREF( source );
196 	return( result );
197 }
198 const char *vips__webp_suffs[] = { ".webp", NULL };
199 static void
200 vips_foreign_load_webp_file_class_init( VipsForeignLoadWebpFileClass *class )
201 {
202 	GObjectClass *gobject_class = G_OBJECT_CLASS( class );
203 	VipsObjectClass *object_class = (VipsObjectClass *) class;
204 	VipsForeignClass *foreign_class = (VipsForeignClass *) class;
205 	VipsForeignLoadClass *load_class = (VipsForeignLoadClass *) class;
206 	gobject_class-&gt;set_property = vips_object_set_property;
207 	gobject_class-&gt;get_property = vips_object_get_property;
208 	object_class-&gt;nickname = "webpload";
209 	object_class-&gt;description = _( "load webp from file" );
210 	object_class-&gt;build = vips_foreign_load_webp_file_build;
211 	foreign_class-&gt;suffs = vips__webp_suffs;
212 	load_class-&gt;is_a = vips_foreign_load_webp_file_is_a;
213 	VIPS_ARG_STRING( class, "filename", 1, 
214 		_( "Filename" ),
215 		_( "Filename to load from" ),
216 		VIPS_ARGUMENT_REQUIRED_INPUT, 
217 		G_STRUCT_OFFSET( VipsForeignLoadWebpFile, filename ),
218 		NULL );
219 }
220 static void
221 vips_foreign_load_webp_file_init( VipsForeignLoadWebpFile *file )
222 {
223 }
224 typedef struct _VipsForeignLoadWebpBuffer {
225 	VipsForeignLoadWebp parent_object;
226 	VipsBlob *blob;
227 } VipsForeignLoadWebpBuffer;
228 typedef VipsForeignLoadWebpClass VipsForeignLoadWebpBufferClass;
229 G_DEFINE_TYPE( VipsForeignLoadWebpBuffer, vips_foreign_load_webp_buffer, 
230 	vips_foreign_load_webp_get_type() );
231 static int
232 vips_foreign_load_webp_buffer_build( VipsObject *object )
233 {
234 	VipsForeignLoadWebp *webp = (VipsForeignLoadWebp *) object;
235 	VipsForeignLoadWebpBuffer *buffer = 
236 		(VipsForeignLoadWebpBuffer *) object;
237 	if( buffer-&gt;blob &amp;&amp;
238 		!(webp-&gt;source = vips_source_new_from_memory( 
239 			VIPS_AREA( buffer-&gt;blob )-&gt;data, 
240 			VIPS_AREA( buffer-&gt;blob )-&gt;length )) )
241 		return( -1 );
242 	if( VIPS_OBJECT_CLASS( vips_foreign_load_webp_buffer_parent_class )-&gt;
243 		build( object ) )
244 		return( -1 );
245 	return( 0 );
246 }
247 static gboolean
248 vips_foreign_load_webp_buffer_is_a_buffer( const void *buf, size_t len )
249 {
250 	VipsSource *source;
251 	gboolean result;
252 	if( !(source = vips_source_new_from_memory( buf, len )) )
253 		return( FALSE );
254 	result = vips__iswebp_source( source );
255 	VIPS_UNREF( source );
256 	return( result );
257 }
258 static void
259 vips_foreign_load_webp_buffer_class_init( 
260 	VipsForeignLoadWebpBufferClass *class )
261 {
262 	GObjectClass *gobject_class = G_OBJECT_CLASS( class );
263 	VipsObjectClass *object_class = (VipsObjectClass *) class;
264 	VipsForeignLoadClass *load_class = (VipsForeignLoadClass *) class;
265 	gobject_class-&gt;set_property = vips_object_set_property;
266 	gobject_class-&gt;get_property = vips_object_get_property;
267 	object_class-&gt;nickname = "webpload_buffer";
268 	object_class-&gt;description = _( "load webp from buffer" );
269 	object_class-&gt;build = vips_foreign_load_webp_buffer_build;
270 	load_class-&gt;is_a_buffer = vips_foreign_load_webp_buffer_is_a_buffer; 
271 	VIPS_ARG_BOXED( class, "buffer", 1, 
272 		_( "Buffer" ),
273 		_( "Buffer to load from" ),
274 		VIPS_ARGUMENT_REQUIRED_INPUT, 
275 		G_STRUCT_OFFSET( VipsForeignLoadWebpBuffer, blob ),
276 		VIPS_TYPE_BLOB );
277 }
278 static void
279 vips_foreign_load_webp_buffer_init( VipsForeignLoadWebpBuffer *buffer )
280 {
281 }
282 int
283 vips_webpload( const char *filename, VipsImage **out, ... )
284 {
285 	va_list ap;
286 	int result;
287 	va_start( ap, out );
288 	result = vips_call_split( "webpload", ap, filename, out );
289 	va_end( ap );
290 	return( result );
291 }
292 int
293 vips_webpload_buffer( void *buf, size_t len, VipsImage **out, ... )
294 {
295 	va_list ap;
296 	VipsBlob *blob;
297 	int result;
298 	blob = vips_blob_new( NULL, buf, len );
299 	va_start( ap, out );
300 	result = vips_call_split( "webpload_buffer", ap, blob, out );
301 	va_end( ap );
302 	vips_area_unref( VIPS_AREA( blob ) );
303 	return( result );
304 }
305 int
306 vips_webpload_source( VipsSource *source, VipsImage **out, ... )
307 {
308 	va_list ap;
309 	int result;
310 	va_start( ap, out );
311 	result = vips_call_split( "webpload_source", ap, source, out );
312 	va_end( ap );
313 	return( result );
314 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
