
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 26, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-components.c</h3>
            <pre><code>1  #include &quot;private/autogen/config.h&quot;
2  #include &quot;hwloc.h&quot;
3  #include &quot;private/private.h&quot;
4  #include &quot;private/xml.h&quot;
5  #include &quot;private/misc.h&quot;
6  #define HWLOC_COMPONENT_STOP_NAME &quot;stop&quot;
7  #define HWLOC_COMPONENT_EXCLUDE_CHAR &#x27;-&#x27;
8  #define HWLOC_COMPONENT_SEPS &quot;,&quot;
9  #define HWLOC_COMPONENT_PHASESEP_CHAR &#x27;:&#x27;
10  static struct hwloc_disc_component * hwloc_disc_components = NULL;
11  static unsigned hwloc_components_users = 0; &amp;bsol;* first one initializes, last ones destroys */
12  static int hwloc_components_verbose = 0;
13  #ifdef HWLOC_HAVE_PLUGINS
14  static int hwloc_plugins_verbose = 0;
15  static const char * hwloc_plugins_blacklist = NULL;
16  #endif
17  #ifdef HWLOC_WIN_SYS
18  #include &lt;windows.h&gt;
19  static LONG hwloc_components_mutex = 0;
20  #define HWLOC_COMPONENTS_LOCK() do {						\
21    while (InterlockedCompareExchange(&amp;hwloc_components_mutex, 1, 0) != 0)	\
22      SwitchToThread();								\
23  } while (0)
24  #define HWLOC_COMPONENTS_UNLOCK() do {						\
25    assert(hwloc_components_mutex == 1);						\
26    hwloc_components_mutex = 0;							\
27  } while (0)
28  #elif defined HWLOC_HAVE_PTHREAD_MUTEX
29  #include &lt;pthread.h&gt;
30  static pthread_mutex_t hwloc_components_mutex = PTHREAD_MUTEX_INITIALIZER;
31  #define HWLOC_COMPONENTS_LOCK() pthread_mutex_lock(&amp;hwloc_components_mutex)
32  #define HWLOC_COMPONENTS_UNLOCK() pthread_mutex_unlock(&amp;hwloc_components_mutex)
33  #else &amp;bsol;* HWLOC_WIN_SYS || HWLOC_HAVE_PTHREAD_MUTEX */
34  #error No mutex implementation available
35  #endif
36  #ifdef HWLOC_HAVE_PLUGINS
37  #ifdef HWLOC_HAVE_LTDL
38  #include &lt;ltdl.h&gt;
39  typedef lt_dlhandle hwloc_dlhandle;
40  #define hwloc_dlinit lt_dlinit
41  #define hwloc_dlexit lt_dlexit
42  #define hwloc_dlopenext lt_dlopenext
43  #define hwloc_dlclose lt_dlclose
44  #define hwloc_dlerror lt_dlerror
45  #define hwloc_dlsym lt_dlsym
46  #define hwloc_dlforeachfile lt_dlforeachfile
47  #else &amp;bsol;* !HWLOC_HAVE_LTDL */
48  #include &lt;dlfcn.h&gt;
49  typedef void * hwloc_dlhandle;
50  static __hwloc_inline int hwloc_dlinit(void) { return 0; }
51  static __hwloc_inline int hwloc_dlexit(void) { return 0; }
52  #define hwloc_dlclose dlclose
53  #define hwloc_dlerror dlerror
54  #define hwloc_dlsym dlsym
55  #include &lt;sys/stat.h&gt;
56  #include &lt;sys/types.h&gt;
57  #include &lt;dirent.h&gt;
58  #include &lt;unistd.h&gt;
59  static hwloc_dlhandle hwloc_dlopenext(const char *_filename)
60  {
61    hwloc_dlhandle handle;
62    char *filename = NULL;
63    (void) asprintf(&amp;filename, &quot;%s.so&quot;, _filename);
64    if (!filename)
65      return NULL;
66    handle = dlopen(filename, RTLD_NOW|RTLD_LOCAL);
67    free(filename);
68    return handle;
69  }
70  static int
71  hwloc_dlforeachfile(const char *_paths,
72  		    int (*func)(const char *filename, void *data),
73  		    void *data)
74  {
75    char *paths = NULL, *path;
76    paths = strdup(_paths);
77    if (!paths)
78      return -1;
79    path = paths;
80    while (*path) {
81      char *colon;
82      DIR *dir;
83      struct dirent *dirent;
84      colon = strchr(path, &#x27;:&#x27;);
85      if (colon)
86        *colon = &#x27;\0&#x27;;
87      if (hwloc_plugins_verbose)
88        fprintf(stderr, &quot;hwloc:  Looking under %s\n&quot;, path);
89      dir = opendir(path);
90      if (!dir)
91        goto next;
92      while ((dirent = readdir(dir)) != NULL) {
93        char *abs_name, *suffix;
94        struct stat stbuf;
95        int err;
96        err = asprintf(&amp;abs_name, &quot;%s/%s&quot;, path, dirent-&gt;d_name);
97        if (err &lt; 0)
98  	continue;
99        err = stat(abs_name, &amp;stbuf);
100        if (err &lt; 0) {
101  	free(abs_name);
102          continue;
103        }
104        if (!S_ISREG(stbuf.st_mode)) {
105  	free(abs_name);
106  	continue;
107        }
108        suffix = strrchr(abs_name, &#x27;.&#x27;);
109        if (!suffix || strcmp(suffix, &quot;.so&quot;)) {
110  	free(abs_name);
111  	continue;
112        }
113        *suffix = &#x27;\0&#x27;;
114        err = func(abs_name, data);
115        if (err) {
116  	free(abs_name);
117  	continue;
118        }
119        free(abs_name);
120      }
121      closedir(dir);
122    next:
123      if (!colon)
124        break;
125      path = colon+1;
126    }
127    free(paths);
128    return 0;
129  }
130  #endif &amp;bsol;* !HWLOC_HAVE_LTDL */
131  static struct hwloc__plugin_desc {
132    char *name;
133    struct hwloc_component *component;
134    char *filename;
135    hwloc_dlhandle handle;
136    struct hwloc__plugin_desc *next;
137  } *hwloc_plugins = NULL;
138  static int
139  hwloc__dlforeach_cb(const char *filename, void *_data __hwloc_attribute_unused)
140  {
141    const char *basename;
142    hwloc_dlhandle handle;
143    struct hwloc_component *component;
144    struct hwloc__plugin_desc *desc, **prevdesc;
145    char *componentsymbolname;
146    if (hwloc_plugins_verbose)
147      fprintf(stderr, &quot;hwloc: Plugin dlforeach found `%s&#x27;\n&quot;, filename);
148    basename = strrchr(filename, &#x27;/&#x27;);
149    if (!basename)
150      basename = filename;
151    else
152      basename++;
153    if (hwloc_plugins_blacklist &amp;&amp; strstr(hwloc_plugins_blacklist, basename)) {
154      if (hwloc_plugins_verbose)
155        fprintf(stderr, &quot;hwloc: Plugin `%s&#x27; is blacklisted in the environment\n&quot;, basename);
156      goto out;
157    }
158    handle = hwloc_dlopenext(filename);
159    if (!handle) {
160      if (hwloc_plugins_verbose)
161        fprintf(stderr, &quot;hwloc: Failed to load plugin: %s\n&quot;, hwloc_dlerror());
162      goto out;
163    }
164    componentsymbolname = malloc(strlen(basename)+10+1);
165    if (!componentsymbolname) {
166      if (hwloc_plugins_verbose)
167        fprintf(stderr, &quot;hwloc: Failed to allocation component `%s&#x27; symbol\n&quot;,
168  	      basename);
169      goto out_with_handle;
170    }
171    sprintf(componentsymbolname, &quot;%s_component&quot;, basename);
172    component = hwloc_dlsym(handle, componentsymbolname);
173    if (!component) {
174      if (hwloc_plugins_verbose)
175        fprintf(stderr, &quot;hwloc: Failed to find component symbol `%s&#x27;\n&quot;,
176  	      componentsymbolname);
177      free(componentsymbolname);
178      goto out_with_handle;
179    }
180    if (component-&gt;abi != HWLOC_COMPONENT_ABI) {
181      if (hwloc_plugins_verbose)
182        fprintf(stderr, &quot;hwloc: Plugin symbol ABI %u instead of %d\n&quot;,
183  	      component-&gt;abi, HWLOC_COMPONENT_ABI);
184      free(componentsymbolname);
185      goto out_with_handle;
186    }
187    if (hwloc_plugins_verbose)
188      fprintf(stderr, &quot;hwloc: Plugin contains expected symbol `%s&#x27;\n&quot;,
189  	    componentsymbolname);
190    free(componentsymbolname);
191    if (HWLOC_COMPONENT_TYPE_DISC == component-&gt;type) {
192      if (strncmp(basename, &quot;hwloc_&quot;, 6)) {
193        if (hwloc_plugins_verbose)
194  	fprintf(stderr, &quot;hwloc: Plugin name `%s&#x27; doesn&#x27;t match its type DISCOVERY\n&quot;, basename);
195        goto out_with_handle;
196      }
197    } else if (HWLOC_COMPONENT_TYPE_XML == component-&gt;type) {
198      if (strncmp(basename, &quot;hwloc_xml_&quot;, 10)) {
199        if (hwloc_plugins_verbose)
200  	fprintf(stderr, &quot;hwloc: Plugin name `%s&#x27; doesn&#x27;t match its type XML\n&quot;, basename);
201        goto out_with_handle;
202      }
203    } else {
204      if (hwloc_plugins_verbose)
205        fprintf(stderr, &quot;hwloc: Plugin name `%s&#x27; has invalid type %u\n&quot;,
206  	      basename, (unsigned) component-&gt;type);
207      goto out_with_handle;
208    }
209    desc = malloc(sizeof(*desc));
210    if (!desc)
211      goto out_with_handle;
212    desc-&gt;name = strdup(basename);
213    desc-&gt;filename = strdup(filename);
214    desc-&gt;component = component;
215    desc-&gt;handle = handle;
216    desc-&gt;next = NULL;
217    if (hwloc_plugins_verbose)
218      fprintf(stderr, &quot;hwloc: Plugin descriptor `%s&#x27; ready\n&quot;, basename);
219    prevdesc = &amp;hwloc_plugins;
220    while (*prevdesc)
221      prevdesc = &amp;((*prevdesc)-&gt;next);
222    *prevdesc = desc;
223    if (hwloc_plugins_verbose)
224      fprintf(stderr, &quot;hwloc: Plugin descriptor `%s&#x27; queued\n&quot;, basename);
225    return 0;
226   out_with_handle:
227    hwloc_dlclose(handle);
228   out:
229    return 0;
230  }
231  static void
232  hwloc_plugins_exit(void)
233  {
234    struct hwloc__plugin_desc *desc, *next;
235    if (hwloc_plugins_verbose)
236      fprintf(stderr, &quot;hwloc: Closing all plugins\n&quot;);
237    desc = hwloc_plugins;
238    while (desc) {
239      next = desc-&gt;next;
240      hwloc_dlclose(desc-&gt;handle);
241      free(desc-&gt;name);
242      free(desc-&gt;filename);
243      free(desc);
244      desc = next;
245    }
246    hwloc_plugins = NULL;
247    hwloc_dlexit();
248  }
249  static int
250  hwloc_plugins_init(void)
251  {
252    const char *verboseenv;
253    const char *path = HWLOC_PLUGINS_PATH;
254    const char *env;
255    int err;
256    verboseenv = getenv(&quot;HWLOC_PLUGINS_VERBOSE&quot;);
257    hwloc_plugins_verbose = verboseenv ? atoi(verboseenv) : 0;
258    hwloc_plugins_blacklist = getenv(&quot;HWLOC_PLUGINS_BLACKLIST&quot;);
259    err = hwloc_dlinit();
260    if (err)
261      goto out;
262    env = getenv(&quot;HWLOC_PLUGINS_PATH&quot;);
263    if (env)
264      path = env;
265    hwloc_plugins = NULL;
266    if (hwloc_plugins_verbose)
267      fprintf(stderr, &quot;hwloc: Starting plugin dlforeach in %s\n&quot;, path);
268    err = hwloc_dlforeachfile(path, hwloc__dlforeach_cb, NULL);
269    if (err)
270      goto out_with_init;
271    return 0;
272   out_with_init:
273    hwloc_plugins_exit();
274   out:
275    return -1;
276  }
277  #endif &amp;bsol;* HWLOC_HAVE_PLUGINS */
278  static int
279  hwloc_disc_component_register(struct hwloc_disc_component *component,
280  			      const char *filename)
281  {
282    struct hwloc_disc_component **prev;
283    if (!strcmp(component-&gt;name, HWLOC_COMPONENT_STOP_NAME)) {
284      if (hwloc_components_verbose)
285        fprintf(stderr, &quot;hwloc: Cannot register discovery component with reserved name `&quot; HWLOC_COMPONENT_STOP_NAME &quot;&#x27;\n&quot;);
286      return -1;
287    }
288    if (strchr(component-&gt;name, HWLOC_COMPONENT_EXCLUDE_CHAR)
289        || strchr(component-&gt;name, HWLOC_COMPONENT_PHASESEP_CHAR)
290        || strcspn(component-&gt;name, HWLOC_COMPONENT_SEPS) != strlen(component-&gt;name)) {
291      if (hwloc_components_verbose)
292        fprintf(stderr, &quot;hwloc: Cannot register discovery component with name `%s&#x27; containing reserved characters `%c&quot; HWLOC_COMPONENT_SEPS &quot;&#x27;\n&quot;,
293  	      component-&gt;name, HWLOC_COMPONENT_EXCLUDE_CHAR);
294      return -1;
295    }
296    if (!component-&gt;phases
297        || (component-&gt;phases != HWLOC_DISC_PHASE_GLOBAL
298  	  &amp;&amp; component-&gt;phases &amp; ~(HWLOC_DISC_PHASE_CPU
299  				   |HWLOC_DISC_PHASE_MEMORY
300  				   |HWLOC_DISC_PHASE_PCI
301  				   |HWLOC_DISC_PHASE_IO
302  				   |HWLOC_DISC_PHASE_MISC
303  				   |HWLOC_DISC_PHASE_ANNOTATE
304  				   |HWLOC_DISC_PHASE_TWEAK))) {
305      if (HWLOC_SHOW_CRITICAL_ERRORS())
306        fprintf(stderr, &quot;hwloc: Cannot register discovery component `%s&#x27; with invalid phases 0x%x\n&quot;,
307                component-&gt;name, component-&gt;phases);
308      return -1;
309    }
310    prev = &amp;hwloc_disc_components;
311    while (NULL != *prev) {
312      if (!strcmp((*prev)-&gt;name, component-&gt;name)) {
313        if ((*prev)-&gt;priority &lt; component-&gt;priority) {
314  	if (hwloc_components_verbose)
315  	  fprintf(stderr, &quot;hwloc: Dropping previously registered discovery component `%s&#x27;, priority %u lower than new one %u\n&quot;,
316  		  (*prev)-&gt;name, (*prev)-&gt;priority, component-&gt;priority);
317  	*prev = (*prev)-&gt;next;
318        } else {
319  	if (hwloc_components_verbose)
320  	  fprintf(stderr, &quot;hwloc: Ignoring new discovery component `%s&#x27;, priority %u lower than previously registered one %u\n&quot;,
321  		  component-&gt;name, component-&gt;priority, (*prev)-&gt;priority);
322  	return -1;
323        }
324      }
325      prev = &amp;((*prev)-&gt;next);
326    }
327    if (hwloc_components_verbose)
328      fprintf(stderr, &quot;hwloc: Registered discovery component `%s&#x27; phases 0x%x with priority %u (%s%s)\n&quot;,
329  	    component-&gt;name, component-&gt;phases, component-&gt;priority,
330  	    filename ? &quot;from plugin &quot; : &quot;statically build&quot;, filename ? filename : &quot;&quot;);
331    prev = &amp;hwloc_disc_components;
332    while (NULL != *prev) {
333      if ((*prev)-&gt;priority &lt; component-&gt;priority)
334        break;
335      prev = &amp;((*prev)-&gt;next);
336    }
337    component-&gt;next = *prev;
338    *prev = component;
339    return 0;
340  }
341  #include &quot;static-components.h&quot;
342  static void (**hwloc_component_finalize_cbs)(unsigned long);
343  static unsigned hwloc_component_finalize_cb_count;
344  void
345  hwloc_components_init(void)
346  {
347  #ifdef HWLOC_HAVE_PLUGINS
348    struct hwloc__plugin_desc *desc;
349  #endif
350    const char *verboseenv;
351    unsigned i;
352    HWLOC_COMPONENTS_LOCK();
353    assert((unsigned) -1 != hwloc_components_users);
354    if (0 != hwloc_components_users++) {
355      HWLOC_COMPONENTS_UNLOCK();
356      return;
357    }
358    verboseenv = getenv(&quot;HWLOC_COMPONENTS_VERBOSE&quot;);
359    hwloc_components_verbose = verboseenv ? atoi(verboseenv) : 0;
360  #ifdef HWLOC_HAVE_PLUGINS
361    hwloc_plugins_init();
362  #endif
363    hwloc_component_finalize_cbs = NULL;
364    hwloc_component_finalize_cb_count = 0;
365    for(i=0; NULL != hwloc_static_components[i]; i++)
366      hwloc_component_finalize_cb_count++;
367  #ifdef HWLOC_HAVE_PLUGINS
368    for(desc = hwloc_plugins; NULL != desc; desc = desc-&gt;next)
369      hwloc_component_finalize_cb_count++;
370  #endif
371    if (hwloc_component_finalize_cb_count) {
372      hwloc_component_finalize_cbs = calloc(hwloc_component_finalize_cb_count,
373  					  sizeof(*hwloc_component_finalize_cbs));
374      assert(hwloc_component_finalize_cbs);
375      hwloc_component_finalize_cb_count = 0;
376    }
377    for(i=0; NULL != hwloc_static_components[i]; i++) {
378      if (hwloc_static_components[i]-&gt;flags) {
379        if (HWLOC_SHOW_CRITICAL_ERRORS())
380          fprintf(stderr, &quot;hwloc: Ignoring static component with invalid flags %lx\n&quot;,
381                  hwloc_static_components[i]-&gt;flags);
382        continue;
383      }
384      if (hwloc_static_components[i]-&gt;init &amp;&amp; hwloc_static_components[i]-&gt;init(0) &lt; 0) {
385        if (hwloc_components_verbose)
386  	fprintf(stderr, &quot;hwloc: Ignoring static component, failed to initialize\n&quot;);
387        continue;
388      }
389      if (hwloc_static_components[i]-&gt;finalize)
390        hwloc_component_finalize_cbs[hwloc_component_finalize_cb_count++] = hwloc_static_components[i]-&gt;finalize;
391      if (HWLOC_COMPONENT_TYPE_DISC == hwloc_static_components[i]-&gt;type)
392        hwloc_disc_component_register(hwloc_static_components[i]-&gt;data, NULL);
393      else if (HWLOC_COMPONENT_TYPE_XML == hwloc_static_components[i]-&gt;type)
394        hwloc_xml_callbacks_register(hwloc_static_components[i]-&gt;data);
395      else
396        assert(0);
397    }
398  #ifdef HWLOC_HAVE_PLUGINS
399    for(desc = hwloc_plugins; NULL != desc; desc = desc-&gt;next) {
400      if (desc-&gt;component-&gt;flags) {
401        if (HWLOC_SHOW_CRITICAL_ERRORS())
402          fprintf(stderr, &quot;hwloc: Ignoring plugin `%s&#x27; component with invalid flags %lx\n&quot;,
403                  desc-&gt;name, desc-&gt;component-&gt;flags);
404        continue;
405      }
406      if (desc-&gt;component-&gt;init &amp;&amp; desc-&gt;component-&gt;init(0) &lt; 0) {
407        if (hwloc_components_verbose)
408  	fprintf(stderr, &quot;hwloc: Ignoring plugin `%s&#x27;, failed to initialize\n&quot;, desc-&gt;name);
409        continue;
410      }
411      if (desc-&gt;component-&gt;finalize)
412        hwloc_component_finalize_cbs[hwloc_component_finalize_cb_count++] = desc-&gt;component-&gt;finalize;
413      if (HWLOC_COMPONENT_TYPE_DISC == desc-&gt;component-&gt;type)
414        hwloc_disc_component_register(desc-&gt;component-&gt;data, desc-&gt;filename);
415      else if (HWLOC_COMPONENT_TYPE_XML == desc-&gt;component-&gt;type)
416        hwloc_xml_callbacks_register(desc-&gt;component-&gt;data);
417      else
418        assert(0);
419    }
420  #endif
421    HWLOC_COMPONENTS_UNLOCK();
422  }
423  void
424  hwloc_topology_components_init(struct hwloc_topology *topology)
425  {
426    topology-&gt;nr_blacklisted_components = 0;
427    topology-&gt;blacklisted_components = NULL;
428    topology-&gt;backends = NULL;
429    topology-&gt;backend_phases = 0;
430    topology-&gt;backend_excluded_phases = 0;
431  }
432  static struct hwloc_disc_component *
433  hwloc_disc_component_find(const char *name, const char **endp)
434  {
435    struct hwloc_disc_component *comp;
436    size_t length;
437    const char *end = strchr(name, HWLOC_COMPONENT_PHASESEP_CHAR);
438    if (end) {
439      length = end-name;
440      if (endp)
441        *endp = end+1;
442    } else {
443      length = strlen(name);
444      if (endp)
445        *endp = NULL;
446    }
447    comp = hwloc_disc_components;
448    while (NULL != comp) {
449      if (!strncmp(name, comp-&gt;name, length))
450        return comp;
451      comp = comp-&gt;next;
452    }
453    return NULL;
454  }
455  static unsigned
456  hwloc_phases_from_string(const char *s)
457  {
458    if (!s)
459      return ~0U;
460    if (s[0]&lt;&#x27;0&#x27; || s[0]&gt;&#x27;9&#x27;) {
461      if (!strcasecmp(s, &quot;global&quot;))
462        return HWLOC_DISC_PHASE_GLOBAL;
463      else if (!strcasecmp(s, &quot;cpu&quot;))
464        return HWLOC_DISC_PHASE_CPU;
465      if (!strcasecmp(s, &quot;memory&quot;))
466        return HWLOC_DISC_PHASE_MEMORY;
467      if (!strcasecmp(s, &quot;pci&quot;))
468        return HWLOC_DISC_PHASE_PCI;
469      if (!strcasecmp(s, &quot;io&quot;))
470        return HWLOC_DISC_PHASE_IO;
471      if (!strcasecmp(s, &quot;misc&quot;))
472        return HWLOC_DISC_PHASE_MISC;
473      if (!strcasecmp(s, &quot;annotate&quot;))
474        return HWLOC_DISC_PHASE_ANNOTATE;
475      if (!strcasecmp(s, &quot;tweak&quot;))
476        return HWLOC_DISC_PHASE_TWEAK;
477      return 0;
478    }
479    return (unsigned) strtoul(s, NULL, 0);
480  }
481  static int
482  hwloc_disc_component_blacklist_one(struct hwloc_topology *topology,
483  				   const char *name)
484  {
485    struct hwloc_topology_forced_component_s *blacklisted;
486    struct hwloc_disc_component *comp;
487    unsigned phases;
488    unsigned i;
489    if (!strcmp(name, &quot;linuxpci&quot;) || !strcmp(name, &quot;linuxio&quot;)) {
490      if (hwloc_components_verbose)
491        fprintf(stderr, &quot;hwloc: Replacing deprecated component `%s&#x27; with `linux&#x27; IO phases in blacklisting\n&quot;, name);
492      comp = hwloc_disc_component_find(&quot;linux&quot;, NULL);
493      phases = HWLOC_DISC_PHASE_PCI | HWLOC_DISC_PHASE_IO | HWLOC_DISC_PHASE_MISC | HWLOC_DISC_PHASE_ANNOTATE;
494    } else {
495      const char *end;
496      comp = hwloc_disc_component_find(name, &amp;end);
497      phases = hwloc_phases_from_string(end);
498    }
499    if (!comp) {
500      errno = EINVAL;
501      return -1;
502    }
503    if (hwloc_components_verbose)
504      fprintf(stderr, &quot;hwloc: Blacklisting component `%s` phases 0x%x\n&quot;, comp-&gt;name, phases);
505    for(i=0; i&lt;topology-&gt;nr_blacklisted_components; i++) {
506      if (topology-&gt;blacklisted_components[i].component == comp) {
507        topology-&gt;blacklisted_components[i].phases |= phases;
508        return 0;
509      }
510    }
511    blacklisted = realloc(topology-&gt;blacklisted_components, (topology-&gt;nr_blacklisted_components+1)*sizeof(*blacklisted));
512    if (!blacklisted)
513      return -1;
514    blacklisted[topology-&gt;nr_blacklisted_components].component = comp;
515    blacklisted[topology-&gt;nr_blacklisted_components].phases = phases;
516    topology-&gt;blacklisted_components = blacklisted;
517    topology-&gt;nr_blacklisted_components++;
518    return 0;
519  }
520  int
521  hwloc_topology_set_components(struct hwloc_topology *topology,
522  			      unsigned long flags,
523  			      const char *name)
524  {
525    if (topology-&gt;is_loaded) {
526      errno = EBUSY;
527      return -1;
528    }
529    if (flags &amp; ~HWLOC_TOPOLOGY_COMPONENTS_FLAG_BLACKLIST) {
530      errno = EINVAL;
531      return -1;
532    }
533    if (flags != HWLOC_TOPOLOGY_COMPONENTS_FLAG_BLACKLIST) {
534      errno = EINVAL;
535      return -1;
536    }
537    if (!strncmp(name, &quot;all&quot;, 3) &amp;&amp; name[3] == HWLOC_COMPONENT_PHASESEP_CHAR) {
538      topology-&gt;backend_excluded_phases = hwloc_phases_from_string(name+4);
539      return 0;
540    }
541    return hwloc_disc_component_blacklist_one(topology, name);
542  }
543  int
544  hwloc_disc_component_force_enable(struct hwloc_topology *topology,
545  				  int envvar_forced,
546  				  const char *name,
547  				  const void *data1, const void *data2, const void *data3)
548  {
549    struct hwloc_disc_component *comp;
550    struct hwloc_backend *backend;
551    if (topology-&gt;is_loaded) {
552      errno = EBUSY;
553      return -1;
554    }
555    comp = hwloc_disc_component_find(name, NULL);
556    if (!comp) {
557      errno = ENOSYS;
558      return -1;
559    }
560    backend = comp-&gt;instantiate(topology, comp, 0U &amp;bsol;* force-enabled don&#x27;t get any phase blacklisting */,
561  			      data1, data2, data3);
562    if (backend) {
563      int err;
564      backend-&gt;envvar_forced = envvar_forced;
565      if (topology-&gt;backends)
566        hwloc_backends_disable_all(topology);
567      err = hwloc_backend_enable(backend);
568      if (comp-&gt;phases == HWLOC_DISC_PHASE_GLOBAL) {
569        char *env = getenv(&quot;HWLOC_ANNOTATE_GLOBAL_COMPONENTS&quot;);
570        if (env &amp;&amp; atoi(env))
571  	topology-&gt;backend_excluded_phases &amp;= ~HWLOC_DISC_PHASE_ANNOTATE;
572      }
573      return err;
574    } else
575      return -1;
576  }
577  static int
578  hwloc_disc_component_try_enable(struct hwloc_topology *topology,
579  				struct hwloc_disc_component *comp,
580  				int envvar_forced,
581  				unsigned blacklisted_phases)
582  {
583    struct hwloc_backend *backend;
584    if (!(comp-&gt;phases &amp; ~(topology-&gt;backend_excluded_phases | blacklisted_phases))) {
585      if (hwloc_components_verbose)
586        fprintf(stderr, &quot;hwloc: Excluding discovery component `%s&#x27; phases 0x%x, conflicts with excludes 0x%x\n&quot;,
587  	      comp-&gt;name, comp-&gt;phases, topology-&gt;backend_excluded_phases);
588      return -1;
589    }
590    backend = comp-&gt;instantiate(topology, comp, topology-&gt;backend_excluded_phases | blacklisted_phases,
591  			      NULL, NULL, NULL);
592    if (!backend) {
593      if (hwloc_components_verbose || (envvar_forced &amp;&amp; HWLOC_SHOW_CRITICAL_ERRORS()))
594        fprintf(stderr, &quot;hwloc: Failed to instantiate discovery component `%s&#x27;\n&quot;, comp-&gt;name);
595      return -1;
596    }
597    backend-&gt;phases &amp;= ~blacklisted_phases;
598    backend-&gt;envvar_forced = envvar_forced;
599    return hwloc_backend_enable(backend);
600  }
601  void
602  hwloc_disc_components_enable_others(struct hwloc_topology *topology)
603  {
604    struct hwloc_disc_component *comp;
605    struct hwloc_backend *backend;
606    int tryall = 1;
607    const char *_env;
608    char *env; &amp;bsol;* we&#x27;ll to modify the env value, so duplicate it */
609    unsigned i;
610    _env = getenv(&quot;HWLOC_COMPONENTS&quot;);
611    env = _env ? strdup(_env) : NULL;
612    if (env) {
613      char *curenv = env;
<span onclick='openModal()' class='match'>614      size_t s;
615      while (*curenv) {
616        s = strcspn(curenv, HWLOC_COMPONENT_SEPS);
617        if (s) {
618  	char c;
619  	if (curenv[0] != HWLOC_COMPONENT_EXCLUDE_CHAR)
</span>620  	  goto nextname;
621  	c = curenv[s];
622  	curenv[s] = &#x27;\0&#x27;;
623  	hwloc_disc_component_blacklist_one(topology, curenv+1);
624  	for(i=0; i&lt;s; i++)
625  	  curenv[i] = *HWLOC_COMPONENT_SEPS;
626  	curenv[s] = c;
627        }
628      nextname:
629        curenv += s;
630        if (*curenv)
631  	curenv++;
632      }
633    }
634    if (env) {
635      char *curenv = env;
636      size_t s;
637      while (*curenv) {
638        s = strcspn(curenv, HWLOC_COMPONENT_SEPS);
639        if (s) {
640  	char c;
641  	const char *name;
642  	if (!strncmp(curenv, HWLOC_COMPONENT_STOP_NAME, s)) {
643  	  tryall = 0;
644  	  break;
645  	}
646  	c = curenv[s];
647  	curenv[s] = &#x27;\0&#x27;;
648  	name = curenv;
649  	if (!strcmp(name, &quot;linuxpci&quot;) || !strcmp(name, &quot;linuxio&quot;)) {
650  	  if (hwloc_components_verbose)
651  	    fprintf(stderr, &quot;hwloc: Replacing deprecated component `%s&#x27; with `linux&#x27; in envvar forcing\n&quot;, name);
652  	  name = &quot;linux&quot;;
653  	}
654  	comp = hwloc_disc_component_find(name, NULL &amp;bsol;* we enable the entire component, phases must be blacklisted separately */);
655  	if (comp) {
656  	  unsigned blacklisted_phases = 0U;
657  	  for(i=0; i&lt;topology-&gt;nr_blacklisted_components; i++)
658  	    if (comp == topology-&gt;blacklisted_components[i].component) {
659  	      blacklisted_phases = topology-&gt;blacklisted_components[i].phases;
660  	      break;
661  	    }
662  	  if (comp-&gt;phases &amp; ~blacklisted_phases)
663  	    hwloc_disc_component_try_enable(topology, comp, 1 &amp;bsol;* envvar forced */, blacklisted_phases);
664  	} else {
665            if (HWLOC_SHOW_CRITICAL_ERRORS())
666              fprintf(stderr, &quot;hwloc: Cannot find discovery component `%s&#x27;\n&quot;, name);
667  	}
668  	curenv[s] = c;
669        }
670        curenv += s;
671        if (*curenv)
672  	curenv++;
673      }
674    }
675    if (tryall) {
676      comp = hwloc_disc_components;
677      while (NULL != comp) {
678        unsigned blacklisted_phases = 0U;
679        if (!comp-&gt;enabled_by_default)
680  	goto nextcomp;
681        for(i=0; i&lt;topology-&gt;nr_blacklisted_components; i++)
682  	if (comp == topology-&gt;blacklisted_components[i].component) {
683  	  blacklisted_phases = topology-&gt;blacklisted_components[i].phases;
684  	  break;
685  	}
686        if (!(comp-&gt;phases &amp; ~blacklisted_phases)) {
687  	if (hwloc_components_verbose)
688  	  fprintf(stderr, &quot;hwloc: Excluding blacklisted discovery component `%s&#x27; phases 0x%x\n&quot;,
689  		  comp-&gt;name, comp-&gt;phases);
690  	goto nextcomp;
691        }
692        hwloc_disc_component_try_enable(topology, comp, 0 &amp;bsol;* defaults, not envvar forced */, blacklisted_phases);
693  nextcomp:
694        comp = comp-&gt;next;
695      }
696    }
697    if (hwloc_components_verbose) {
698      int first = 1;
699      backend = topology-&gt;backends;
700      fprintf(stderr, &quot;hwloc: Final list of enabled discovery components: &quot;);
701      while (backend != NULL) {
702        fprintf(stderr, &quot;%s%s(0x%x)&quot;, first ? &quot;&quot; : &quot;,&quot;, backend-&gt;component-&gt;name, backend-&gt;phases);
703        backend = backend-&gt;next;
704        first = 0;
705      }
706      fprintf(stderr, &quot;\n&quot;);
707    }
708    free(env);
709  }
710  void
711  hwloc_components_fini(void)
712  {
713    unsigned i;
714    HWLOC_COMPONENTS_LOCK();
715    assert(0 != hwloc_components_users);
716    if (0 != --hwloc_components_users) {
717      HWLOC_COMPONENTS_UNLOCK();
718      return;
719    }
720    for(i=0; i&lt;hwloc_component_finalize_cb_count; i++)
721      hwloc_component_finalize_cbs[hwloc_component_finalize_cb_count-i-1](0);
722    free(hwloc_component_finalize_cbs);
723    hwloc_component_finalize_cbs = NULL;
724    hwloc_component_finalize_cb_count = 0;
725    hwloc_disc_components = NULL;
726    hwloc_xml_callbacks_reset();
727  #ifdef HWLOC_HAVE_PLUGINS
728    hwloc_plugins_exit();
729  #endif
730    HWLOC_COMPONENTS_UNLOCK();
731  }
732  struct hwloc_backend *
733  hwloc_backend_alloc(struct hwloc_topology *topology,
734  		    struct hwloc_disc_component *component)
735  {
736    struct hwloc_backend * backend = malloc(sizeof(*backend));
737    if (!backend) {
738      errno = ENOMEM;
739      return NULL;
740    }
741    backend-&gt;component = component;
742    backend-&gt;topology = topology;
743    backend-&gt;phases = component-&gt;phases &amp; ~topology-&gt;backend_excluded_phases;
744    if (backend-&gt;phases != component-&gt;phases &amp;&amp; hwloc_components_verbose)
745      fprintf(stderr, &quot;hwloc: Trying discovery component `%s&#x27; with phases 0x%x instead of 0x%x\n&quot;,
746  	    component-&gt;name, backend-&gt;phases, component-&gt;phases);
747    backend-&gt;flags = 0;
748    backend-&gt;discover = NULL;
749    backend-&gt;get_pci_busid_cpuset = NULL;
750    backend-&gt;disable = NULL;
751    backend-&gt;is_thissystem = -1;
752    backend-&gt;next = NULL;
753    backend-&gt;envvar_forced = 0;
754    return backend;
755  }
756  static void
757  hwloc_backend_disable(struct hwloc_backend *backend)
758  {
759    if (backend-&gt;disable)
760      backend-&gt;disable(backend);
761    free(backend);
762  }
763  int
764  hwloc_backend_enable(struct hwloc_backend *backend)
765  {
766    struct hwloc_topology *topology = backend-&gt;topology;
767    struct hwloc_backend **pprev;
768    if (backend-&gt;flags) {
769      if (HWLOC_SHOW_CRITICAL_ERRORS())
770        fprintf(stderr, &quot;hwloc: Cannot enable discovery component `%s&#x27; phases 0x%x with unknown flags %lx\n&quot;,
771                backend-&gt;component-&gt;name, backend-&gt;component-&gt;phases, backend-&gt;flags);
772      return -1;
773    }
774    pprev = &amp;topology-&gt;backends;
775    while (NULL != *pprev) {
776      if ((*pprev)-&gt;component == backend-&gt;component) {
777        if (hwloc_components_verbose)
778  	fprintf(stderr, &quot;hwloc: Cannot enable  discovery component `%s&#x27; phases 0x%x twice\n&quot;,
779  		backend-&gt;component-&gt;name, backend-&gt;component-&gt;phases);
780        hwloc_backend_disable(backend);
781        errno = EBUSY;
782        return -1;
783      }
784      pprev = &amp;((*pprev)-&gt;next);
785    }
786    if (hwloc_components_verbose)
787      fprintf(stderr, &quot;hwloc: Enabling discovery component `%s&#x27; with phases 0x%x (among 0x%x)\n&quot;,
788  	    backend-&gt;component-&gt;name, backend-&gt;phases, backend-&gt;component-&gt;phases);
789    pprev = &amp;topology-&gt;backends;
790    while (NULL != *pprev)
791      pprev = &amp;((*pprev)-&gt;next);
792    backend-&gt;next = *pprev;
793    *pprev = backend;
794    topology-&gt;backend_phases |= backend-&gt;component-&gt;phases;
795    topology-&gt;backend_excluded_phases |= backend-&gt;component-&gt;excluded_phases;
796    return 0;
797  }
798  void
799  hwloc_backends_is_thissystem(struct hwloc_topology *topology)
800  {
801    struct hwloc_backend *backend;
802    const char *local_env;
803    topology-&gt;is_thissystem = 1;
804    backend = topology-&gt;backends;
805    while (backend != NULL) {
806      if (backend-&gt;envvar_forced == 0 &amp;&amp; backend-&gt;is_thissystem != -1) {
807        assert(backend-&gt;is_thissystem == 0);
808        topology-&gt;is_thissystem = 0;
809      }
810      backend = backend-&gt;next;
811    }
812    if (topology-&gt;flags &amp; HWLOC_TOPOLOGY_FLAG_IS_THISSYSTEM)
813      topology-&gt;is_thissystem = 1;
814    backend = topology-&gt;backends;
815    while (backend != NULL) {
816      if (backend-&gt;envvar_forced == 1 &amp;&amp; backend-&gt;is_thissystem != -1) {
817        assert(backend-&gt;is_thissystem == 0);
818        topology-&gt;is_thissystem = 0;
819      }
820      backend = backend-&gt;next;
821    }
822    local_env = getenv(&quot;HWLOC_THISSYSTEM&quot;);
823    if (local_env)
824      topology-&gt;is_thissystem = atoi(local_env);
825  }
826  void
827  hwloc_backends_find_callbacks(struct hwloc_topology *topology)
828  {
829    struct hwloc_backend *backend = topology-&gt;backends;
830    topology-&gt;get_pci_busid_cpuset_backend = NULL;
831    while (backend != NULL) {
832      if (backend-&gt;get_pci_busid_cpuset) {
833        topology-&gt;get_pci_busid_cpuset_backend = backend;
834        return;
835      }
836      backend = backend-&gt;next;
837    }
838    return;
839  }
840  void
841  hwloc_backends_disable_all(struct hwloc_topology *topology)
842  {
843    struct hwloc_backend *backend;
844    while (NULL != (backend = topology-&gt;backends)) {
845      struct hwloc_backend *next = backend-&gt;next;
846      if (hwloc_components_verbose)
847        fprintf(stderr, &quot;hwloc: Disabling discovery component `%s&#x27;\n&quot;,
848  	      backend-&gt;component-&gt;name);
849      hwloc_backend_disable(backend);
850      topology-&gt;backends = next;
851    }
852    topology-&gt;backends = NULL;
853    topology-&gt;backend_excluded_phases = 0;
854  }
855  void
856  hwloc_topology_components_fini(struct hwloc_topology *topology)
857  {
858    assert(!topology-&gt;backends);
859    free(topology-&gt;blacklisted_components);
860  }
</code></pre>
        </div>
        <div class="column">
            <h3>xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-components.c</h3>
            <pre><code>1  #include &quot;private/autogen/config.h&quot;
2  #include &quot;hwloc.h&quot;
3  #include &quot;private/private.h&quot;
4  #include &quot;private/xml.h&quot;
5  #include &quot;private/misc.h&quot;
6  #define HWLOC_COMPONENT_STOP_NAME &quot;stop&quot;
7  #define HWLOC_COMPONENT_EXCLUDE_CHAR &#x27;-&#x27;
8  #define HWLOC_COMPONENT_SEPS &quot;,&quot;
9  #define HWLOC_COMPONENT_PHASESEP_CHAR &#x27;:&#x27;
10  static struct hwloc_disc_component * hwloc_disc_components = NULL;
11  static unsigned hwloc_components_users = 0; &amp;bsol;* first one initializes, last ones destroys */
12  static int hwloc_components_verbose = 0;
13  #ifdef HWLOC_HAVE_PLUGINS
14  static int hwloc_plugins_verbose = 0;
15  static const char * hwloc_plugins_blacklist = NULL;
16  #endif
17  #ifdef HWLOC_WIN_SYS
18  #include &lt;windows.h&gt;
19  static LONG hwloc_components_mutex = 0;
20  #define HWLOC_COMPONENTS_LOCK() do {						\
21    while (InterlockedCompareExchange(&amp;hwloc_components_mutex, 1, 0) != 0)	\
22      SwitchToThread();								\
23  } while (0)
24  #define HWLOC_COMPONENTS_UNLOCK() do {						\
25    assert(hwloc_components_mutex == 1);						\
26    hwloc_components_mutex = 0;							\
27  } while (0)
28  #elif defined HWLOC_HAVE_PTHREAD_MUTEX
29  #include &lt;pthread.h&gt;
30  static pthread_mutex_t hwloc_components_mutex = PTHREAD_MUTEX_INITIALIZER;
31  #define HWLOC_COMPONENTS_LOCK() pthread_mutex_lock(&amp;hwloc_components_mutex)
32  #define HWLOC_COMPONENTS_UNLOCK() pthread_mutex_unlock(&amp;hwloc_components_mutex)
33  #else &amp;bsol;* HWLOC_WIN_SYS || HWLOC_HAVE_PTHREAD_MUTEX */
34  #error No mutex implementation available
35  #endif
36  #ifdef HWLOC_HAVE_PLUGINS
37  #ifdef HWLOC_HAVE_LTDL
38  #include &lt;ltdl.h&gt;
39  typedef lt_dlhandle hwloc_dlhandle;
40  #define hwloc_dlinit lt_dlinit
41  #define hwloc_dlexit lt_dlexit
42  #define hwloc_dlopenext lt_dlopenext
43  #define hwloc_dlclose lt_dlclose
44  #define hwloc_dlerror lt_dlerror
45  #define hwloc_dlsym lt_dlsym
46  #define hwloc_dlforeachfile lt_dlforeachfile
47  #else &amp;bsol;* !HWLOC_HAVE_LTDL */
48  #include &lt;dlfcn.h&gt;
49  typedef void * hwloc_dlhandle;
50  static __hwloc_inline int hwloc_dlinit(void) { return 0; }
51  static __hwloc_inline int hwloc_dlexit(void) { return 0; }
52  #define hwloc_dlclose dlclose
53  #define hwloc_dlerror dlerror
54  #define hwloc_dlsym dlsym
55  #include &lt;sys/stat.h&gt;
56  #include &lt;sys/types.h&gt;
57  #include &lt;dirent.h&gt;
58  #include &lt;unistd.h&gt;
59  static hwloc_dlhandle hwloc_dlopenext(const char *_filename)
60  {
61    hwloc_dlhandle handle;
62    char *filename = NULL;
63    (void) asprintf(&amp;filename, &quot;%s.so&quot;, _filename);
64    if (!filename)
65      return NULL;
66    handle = dlopen(filename, RTLD_NOW|RTLD_LOCAL);
67    free(filename);
68    return handle;
69  }
70  static int
71  hwloc_dlforeachfile(const char *_paths,
72  		    int (*func)(const char *filename, void *data),
73  		    void *data)
74  {
75    char *paths = NULL, *path;
76    paths = strdup(_paths);
77    if (!paths)
78      return -1;
79    path = paths;
80    while (*path) {
81      char *colon;
82      DIR *dir;
83      struct dirent *dirent;
84      colon = strchr(path, &#x27;:&#x27;);
85      if (colon)
86        *colon = &#x27;\0&#x27;;
87      if (hwloc_plugins_verbose)
88        fprintf(stderr, &quot;hwloc:  Looking under %s\n&quot;, path);
89      dir = opendir(path);
90      if (!dir)
91        goto next;
92      while ((dirent = readdir(dir)) != NULL) {
93        char *abs_name, *suffix;
94        struct stat stbuf;
95        int err;
96        err = asprintf(&amp;abs_name, &quot;%s/%s&quot;, path, dirent-&gt;d_name);
97        if (err &lt; 0)
98  	continue;
99        err = stat(abs_name, &amp;stbuf);
100        if (err &lt; 0) {
101  	free(abs_name);
102          continue;
103        }
104        if (!S_ISREG(stbuf.st_mode)) {
105  	free(abs_name);
106  	continue;
107        }
108        suffix = strrchr(abs_name, &#x27;.&#x27;);
109        if (!suffix || strcmp(suffix, &quot;.so&quot;)) {
110  	free(abs_name);
111  	continue;
112        }
113        *suffix = &#x27;\0&#x27;;
114        err = func(abs_name, data);
115        if (err) {
116  	free(abs_name);
117  	continue;
118        }
119        free(abs_name);
120      }
121      closedir(dir);
122    next:
123      if (!colon)
124        break;
125      path = colon+1;
126    }
127    free(paths);
128    return 0;
129  }
130  #endif &amp;bsol;* !HWLOC_HAVE_LTDL */
131  static struct hwloc__plugin_desc {
132    char *name;
133    struct hwloc_component *component;
134    char *filename;
135    hwloc_dlhandle handle;
136    struct hwloc__plugin_desc *next;
137  } *hwloc_plugins = NULL;
138  static int
139  hwloc__dlforeach_cb(const char *filename, void *_data __hwloc_attribute_unused)
140  {
141    const char *basename;
142    hwloc_dlhandle handle;
143    struct hwloc_component *component;
144    struct hwloc__plugin_desc *desc, **prevdesc;
145    char *componentsymbolname;
146    if (hwloc_plugins_verbose)
147      fprintf(stderr, &quot;hwloc: Plugin dlforeach found `%s&#x27;\n&quot;, filename);
148    basename = strrchr(filename, &#x27;/&#x27;);
149    if (!basename)
150      basename = filename;
151    else
152      basename++;
153    if (hwloc_plugins_blacklist &amp;&amp; strstr(hwloc_plugins_blacklist, basename)) {
154      if (hwloc_plugins_verbose)
155        fprintf(stderr, &quot;hwloc: Plugin `%s&#x27; is blacklisted in the environment\n&quot;, basename);
156      goto out;
157    }
158    handle = hwloc_dlopenext(filename);
159    if (!handle) {
160      if (hwloc_plugins_verbose)
161        fprintf(stderr, &quot;hwloc: Failed to load plugin: %s\n&quot;, hwloc_dlerror());
162      goto out;
163    }
164    componentsymbolname = malloc(strlen(basename)+10+1);
165    if (!componentsymbolname) {
166      if (hwloc_plugins_verbose)
167        fprintf(stderr, &quot;hwloc: Failed to allocation component `%s&#x27; symbol\n&quot;,
168  	      basename);
169      goto out_with_handle;
170    }
171    sprintf(componentsymbolname, &quot;%s_component&quot;, basename);
172    component = hwloc_dlsym(handle, componentsymbolname);
173    if (!component) {
174      if (hwloc_plugins_verbose)
175        fprintf(stderr, &quot;hwloc: Failed to find component symbol `%s&#x27;\n&quot;,
176  	      componentsymbolname);
177      free(componentsymbolname);
178      goto out_with_handle;
179    }
180    if (component-&gt;abi != HWLOC_COMPONENT_ABI) {
181      if (hwloc_plugins_verbose)
182        fprintf(stderr, &quot;hwloc: Plugin symbol ABI %u instead of %d\n&quot;,
183  	      component-&gt;abi, HWLOC_COMPONENT_ABI);
184      free(componentsymbolname);
185      goto out_with_handle;
186    }
187    if (hwloc_plugins_verbose)
188      fprintf(stderr, &quot;hwloc: Plugin contains expected symbol `%s&#x27;\n&quot;,
189  	    componentsymbolname);
190    free(componentsymbolname);
191    if (HWLOC_COMPONENT_TYPE_DISC == component-&gt;type) {
192      if (strncmp(basename, &quot;hwloc_&quot;, 6)) {
193        if (hwloc_plugins_verbose)
194  	fprintf(stderr, &quot;hwloc: Plugin name `%s&#x27; doesn&#x27;t match its type DISCOVERY\n&quot;, basename);
195        goto out_with_handle;
196      }
197    } else if (HWLOC_COMPONENT_TYPE_XML == component-&gt;type) {
198      if (strncmp(basename, &quot;hwloc_xml_&quot;, 10)) {
199        if (hwloc_plugins_verbose)
200  	fprintf(stderr, &quot;hwloc: Plugin name `%s&#x27; doesn&#x27;t match its type XML\n&quot;, basename);
201        goto out_with_handle;
202      }
203    } else {
204      if (hwloc_plugins_verbose)
205        fprintf(stderr, &quot;hwloc: Plugin name `%s&#x27; has invalid type %u\n&quot;,
206  	      basename, (unsigned) component-&gt;type);
207      goto out_with_handle;
208    }
209    desc = malloc(sizeof(*desc));
210    if (!desc)
211      goto out_with_handle;
212    desc-&gt;name = strdup(basename);
213    desc-&gt;filename = strdup(filename);
214    desc-&gt;component = component;
215    desc-&gt;handle = handle;
216    desc-&gt;next = NULL;
217    if (hwloc_plugins_verbose)
218      fprintf(stderr, &quot;hwloc: Plugin descriptor `%s&#x27; ready\n&quot;, basename);
219    prevdesc = &amp;hwloc_plugins;
220    while (*prevdesc)
221      prevdesc = &amp;((*prevdesc)-&gt;next);
222    *prevdesc = desc;
223    if (hwloc_plugins_verbose)
224      fprintf(stderr, &quot;hwloc: Plugin descriptor `%s&#x27; queued\n&quot;, basename);
225    return 0;
226   out_with_handle:
227    hwloc_dlclose(handle);
228   out:
229    return 0;
230  }
231  static void
232  hwloc_plugins_exit(void)
233  {
234    struct hwloc__plugin_desc *desc, *next;
235    if (hwloc_plugins_verbose)
236      fprintf(stderr, &quot;hwloc: Closing all plugins\n&quot;);
237    desc = hwloc_plugins;
238    while (desc) {
239      next = desc-&gt;next;
240      hwloc_dlclose(desc-&gt;handle);
241      free(desc-&gt;name);
242      free(desc-&gt;filename);
243      free(desc);
244      desc = next;
245    }
246    hwloc_plugins = NULL;
247    hwloc_dlexit();
248  }
249  static int
250  hwloc_plugins_init(void)
251  {
252    const char *verboseenv;
253    const char *path = HWLOC_PLUGINS_PATH;
254    const char *env;
255    int err;
256    verboseenv = getenv(&quot;HWLOC_PLUGINS_VERBOSE&quot;);
257    hwloc_plugins_verbose = verboseenv ? atoi(verboseenv) : 0;
258    hwloc_plugins_blacklist = getenv(&quot;HWLOC_PLUGINS_BLACKLIST&quot;);
259    err = hwloc_dlinit();
260    if (err)
261      goto out;
262    env = getenv(&quot;HWLOC_PLUGINS_PATH&quot;);
263    if (env)
264      path = env;
265    hwloc_plugins = NULL;
266    if (hwloc_plugins_verbose)
267      fprintf(stderr, &quot;hwloc: Starting plugin dlforeach in %s\n&quot;, path);
268    err = hwloc_dlforeachfile(path, hwloc__dlforeach_cb, NULL);
269    if (err)
270      goto out_with_init;
271    return 0;
272   out_with_init:
273    hwloc_plugins_exit();
274   out:
275    return -1;
276  }
277  #endif &amp;bsol;* HWLOC_HAVE_PLUGINS */
278  static int
279  hwloc_disc_component_register(struct hwloc_disc_component *component,
280  			      const char *filename)
281  {
282    struct hwloc_disc_component **prev;
283    if (!strcmp(component-&gt;name, HWLOC_COMPONENT_STOP_NAME)) {
284      if (hwloc_components_verbose)
285        fprintf(stderr, &quot;hwloc: Cannot register discovery component with reserved name `&quot; HWLOC_COMPONENT_STOP_NAME &quot;&#x27;\n&quot;);
286      return -1;
287    }
288    if (strchr(component-&gt;name, HWLOC_COMPONENT_EXCLUDE_CHAR)
289        || strchr(component-&gt;name, HWLOC_COMPONENT_PHASESEP_CHAR)
290        || strcspn(component-&gt;name, HWLOC_COMPONENT_SEPS) != strlen(component-&gt;name)) {
291      if (hwloc_components_verbose)
292        fprintf(stderr, &quot;hwloc: Cannot register discovery component with name `%s&#x27; containing reserved characters `%c&quot; HWLOC_COMPONENT_SEPS &quot;&#x27;\n&quot;,
293  	      component-&gt;name, HWLOC_COMPONENT_EXCLUDE_CHAR);
294      return -1;
295    }
296    if (!component-&gt;phases
297        || (component-&gt;phases != HWLOC_DISC_PHASE_GLOBAL
298  	  &amp;&amp; component-&gt;phases &amp; ~(HWLOC_DISC_PHASE_CPU
299  				   |HWLOC_DISC_PHASE_MEMORY
300  				   |HWLOC_DISC_PHASE_PCI
301  				   |HWLOC_DISC_PHASE_IO
302  				   |HWLOC_DISC_PHASE_MISC
303  				   |HWLOC_DISC_PHASE_ANNOTATE
304  				   |HWLOC_DISC_PHASE_TWEAK))) {
305      if (HWLOC_SHOW_CRITICAL_ERRORS())
306        fprintf(stderr, &quot;hwloc: Cannot register discovery component `%s&#x27; with invalid phases 0x%x\n&quot;,
307                component-&gt;name, component-&gt;phases);
308      return -1;
309    }
310    prev = &amp;hwloc_disc_components;
311    while (NULL != *prev) {
312      if (!strcmp((*prev)-&gt;name, component-&gt;name)) {
313        if ((*prev)-&gt;priority &lt; component-&gt;priority) {
314  	if (hwloc_components_verbose)
315  	  fprintf(stderr, &quot;hwloc: Dropping previously registered discovery component `%s&#x27;, priority %u lower than new one %u\n&quot;,
316  		  (*prev)-&gt;name, (*prev)-&gt;priority, component-&gt;priority);
317  	*prev = (*prev)-&gt;next;
318        } else {
319  	if (hwloc_components_verbose)
320  	  fprintf(stderr, &quot;hwloc: Ignoring new discovery component `%s&#x27;, priority %u lower than previously registered one %u\n&quot;,
321  		  component-&gt;name, component-&gt;priority, (*prev)-&gt;priority);
322  	return -1;
323        }
324      }
325      prev = &amp;((*prev)-&gt;next);
326    }
327    if (hwloc_components_verbose)
328      fprintf(stderr, &quot;hwloc: Registered discovery component `%s&#x27; phases 0x%x with priority %u (%s%s)\n&quot;,
329  	    component-&gt;name, component-&gt;phases, component-&gt;priority,
330  	    filename ? &quot;from plugin &quot; : &quot;statically build&quot;, filename ? filename : &quot;&quot;);
331    prev = &amp;hwloc_disc_components;
332    while (NULL != *prev) {
333      if ((*prev)-&gt;priority &lt; component-&gt;priority)
334        break;
335      prev = &amp;((*prev)-&gt;next);
336    }
337    component-&gt;next = *prev;
338    *prev = component;
339    return 0;
340  }
341  #include &quot;static-components.h&quot;
342  static void (**hwloc_component_finalize_cbs)(unsigned long);
343  static unsigned hwloc_component_finalize_cb_count;
344  void
345  hwloc_components_init(void)
346  {
347  #ifdef HWLOC_HAVE_PLUGINS
348    struct hwloc__plugin_desc *desc;
349  #endif
350    const char *verboseenv;
351    unsigned i;
352    HWLOC_COMPONENTS_LOCK();
353    assert((unsigned) -1 != hwloc_components_users);
354    if (0 != hwloc_components_users++) {
355      HWLOC_COMPONENTS_UNLOCK();
356      return;
357    }
358    verboseenv = getenv(&quot;HWLOC_COMPONENTS_VERBOSE&quot;);
359    hwloc_components_verbose = verboseenv ? atoi(verboseenv) : 0;
360  #ifdef HWLOC_HAVE_PLUGINS
361    hwloc_plugins_init();
362  #endif
363    hwloc_component_finalize_cbs = NULL;
364    hwloc_component_finalize_cb_count = 0;
365    for(i=0; NULL != hwloc_static_components[i]; i++)
366      hwloc_component_finalize_cb_count++;
367  #ifdef HWLOC_HAVE_PLUGINS
368    for(desc = hwloc_plugins; NULL != desc; desc = desc-&gt;next)
369      hwloc_component_finalize_cb_count++;
370  #endif
371    if (hwloc_component_finalize_cb_count) {
372      hwloc_component_finalize_cbs = calloc(hwloc_component_finalize_cb_count,
373  					  sizeof(*hwloc_component_finalize_cbs));
374      assert(hwloc_component_finalize_cbs);
375      hwloc_component_finalize_cb_count = 0;
376    }
377    for(i=0; NULL != hwloc_static_components[i]; i++) {
378      if (hwloc_static_components[i]-&gt;flags) {
379        if (HWLOC_SHOW_CRITICAL_ERRORS())
380          fprintf(stderr, &quot;hwloc: Ignoring static component with invalid flags %lx\n&quot;,
381                  hwloc_static_components[i]-&gt;flags);
382        continue;
383      }
384      if (hwloc_static_components[i]-&gt;init &amp;&amp; hwloc_static_components[i]-&gt;init(0) &lt; 0) {
385        if (hwloc_components_verbose)
386  	fprintf(stderr, &quot;hwloc: Ignoring static component, failed to initialize\n&quot;);
387        continue;
388      }
389      if (hwloc_static_components[i]-&gt;finalize)
390        hwloc_component_finalize_cbs[hwloc_component_finalize_cb_count++] = hwloc_static_components[i]-&gt;finalize;
391      if (HWLOC_COMPONENT_TYPE_DISC == hwloc_static_components[i]-&gt;type)
392        hwloc_disc_component_register(hwloc_static_components[i]-&gt;data, NULL);
393      else if (HWLOC_COMPONENT_TYPE_XML == hwloc_static_components[i]-&gt;type)
394        hwloc_xml_callbacks_register(hwloc_static_components[i]-&gt;data);
395      else
396        assert(0);
397    }
398  #ifdef HWLOC_HAVE_PLUGINS
399    for(desc = hwloc_plugins; NULL != desc; desc = desc-&gt;next) {
400      if (desc-&gt;component-&gt;flags) {
401        if (HWLOC_SHOW_CRITICAL_ERRORS())
402          fprintf(stderr, &quot;hwloc: Ignoring plugin `%s&#x27; component with invalid flags %lx\n&quot;,
403                  desc-&gt;name, desc-&gt;component-&gt;flags);
404        continue;
405      }
406      if (desc-&gt;component-&gt;init &amp;&amp; desc-&gt;component-&gt;init(0) &lt; 0) {
407        if (hwloc_components_verbose)
408  	fprintf(stderr, &quot;hwloc: Ignoring plugin `%s&#x27;, failed to initialize\n&quot;, desc-&gt;name);
409        continue;
410      }
411      if (desc-&gt;component-&gt;finalize)
412        hwloc_component_finalize_cbs[hwloc_component_finalize_cb_count++] = desc-&gt;component-&gt;finalize;
413      if (HWLOC_COMPONENT_TYPE_DISC == desc-&gt;component-&gt;type)
414        hwloc_disc_component_register(desc-&gt;component-&gt;data, desc-&gt;filename);
415      else if (HWLOC_COMPONENT_TYPE_XML == desc-&gt;component-&gt;type)
416        hwloc_xml_callbacks_register(desc-&gt;component-&gt;data);
417      else
418        assert(0);
419    }
420  #endif
421    HWLOC_COMPONENTS_UNLOCK();
422  }
423  void
424  hwloc_topology_components_init(struct hwloc_topology *topology)
425  {
426    topology-&gt;nr_blacklisted_components = 0;
427    topology-&gt;blacklisted_components = NULL;
428    topology-&gt;backends = NULL;
429    topology-&gt;backend_phases = 0;
430    topology-&gt;backend_excluded_phases = 0;
431  }
432  static struct hwloc_disc_component *
433  hwloc_disc_component_find(const char *name, const char **endp)
434  {
435    struct hwloc_disc_component *comp;
436    size_t length;
437    const char *end = strchr(name, HWLOC_COMPONENT_PHASESEP_CHAR);
438    if (end) {
439      length = end-name;
440      if (endp)
441        *endp = end+1;
442    } else {
443      length = strlen(name);
444      if (endp)
445        *endp = NULL;
446    }
447    comp = hwloc_disc_components;
448    while (NULL != comp) {
449      if (!strncmp(name, comp-&gt;name, length))
450        return comp;
451      comp = comp-&gt;next;
452    }
453    return NULL;
454  }
455  static unsigned
456  hwloc_phases_from_string(const char *s)
457  {
458    if (!s)
459      return ~0U;
460    if (s[0]&lt;&#x27;0&#x27; || s[0]&gt;&#x27;9&#x27;) {
461      if (!strcasecmp(s, &quot;global&quot;))
462        return HWLOC_DISC_PHASE_GLOBAL;
463      else if (!strcasecmp(s, &quot;cpu&quot;))
464        return HWLOC_DISC_PHASE_CPU;
465      if (!strcasecmp(s, &quot;memory&quot;))
466        return HWLOC_DISC_PHASE_MEMORY;
467      if (!strcasecmp(s, &quot;pci&quot;))
468        return HWLOC_DISC_PHASE_PCI;
469      if (!strcasecmp(s, &quot;io&quot;))
470        return HWLOC_DISC_PHASE_IO;
471      if (!strcasecmp(s, &quot;misc&quot;))
472        return HWLOC_DISC_PHASE_MISC;
473      if (!strcasecmp(s, &quot;annotate&quot;))
474        return HWLOC_DISC_PHASE_ANNOTATE;
475      if (!strcasecmp(s, &quot;tweak&quot;))
476        return HWLOC_DISC_PHASE_TWEAK;
477      return 0;
478    }
479    return (unsigned) strtoul(s, NULL, 0);
480  }
481  static int
482  hwloc_disc_component_blacklist_one(struct hwloc_topology *topology,
483  				   const char *name)
484  {
485    struct hwloc_topology_forced_component_s *blacklisted;
486    struct hwloc_disc_component *comp;
487    unsigned phases;
488    unsigned i;
489    if (!strcmp(name, &quot;linuxpci&quot;) || !strcmp(name, &quot;linuxio&quot;)) {
490      if (hwloc_components_verbose)
491        fprintf(stderr, &quot;hwloc: Replacing deprecated component `%s&#x27; with `linux&#x27; IO phases in blacklisting\n&quot;, name);
492      comp = hwloc_disc_component_find(&quot;linux&quot;, NULL);
493      phases = HWLOC_DISC_PHASE_PCI | HWLOC_DISC_PHASE_IO | HWLOC_DISC_PHASE_MISC | HWLOC_DISC_PHASE_ANNOTATE;
494    } else {
495      const char *end;
496      comp = hwloc_disc_component_find(name, &amp;end);
497      phases = hwloc_phases_from_string(end);
498    }
499    if (!comp) {
500      errno = EINVAL;
501      return -1;
502    }
503    if (hwloc_components_verbose)
504      fprintf(stderr, &quot;hwloc: Blacklisting component `%s` phases 0x%x\n&quot;, comp-&gt;name, phases);
505    for(i=0; i&lt;topology-&gt;nr_blacklisted_components; i++) {
506      if (topology-&gt;blacklisted_components[i].component == comp) {
507        topology-&gt;blacklisted_components[i].phases |= phases;
508        return 0;
509      }
510    }
511    blacklisted = realloc(topology-&gt;blacklisted_components, (topology-&gt;nr_blacklisted_components+1)*sizeof(*blacklisted));
512    if (!blacklisted)
513      return -1;
514    blacklisted[topology-&gt;nr_blacklisted_components].component = comp;
515    blacklisted[topology-&gt;nr_blacklisted_components].phases = phases;
516    topology-&gt;blacklisted_components = blacklisted;
517    topology-&gt;nr_blacklisted_components++;
518    return 0;
519  }
520  int
521  hwloc_topology_set_components(struct hwloc_topology *topology,
522  			      unsigned long flags,
523  			      const char *name)
524  {
525    if (topology-&gt;is_loaded) {
526      errno = EBUSY;
527      return -1;
528    }
529    if (flags &amp; ~HWLOC_TOPOLOGY_COMPONENTS_FLAG_BLACKLIST) {
530      errno = EINVAL;
531      return -1;
532    }
533    if (flags != HWLOC_TOPOLOGY_COMPONENTS_FLAG_BLACKLIST) {
534      errno = EINVAL;
535      return -1;
536    }
537    if (!strncmp(name, &quot;all&quot;, 3) &amp;&amp; name[3] == HWLOC_COMPONENT_PHASESEP_CHAR) {
538      topology-&gt;backend_excluded_phases = hwloc_phases_from_string(name+4);
539      return 0;
540    }
541    return hwloc_disc_component_blacklist_one(topology, name);
542  }
543  int
544  hwloc_disc_component_force_enable(struct hwloc_topology *topology,
545  				  int envvar_forced,
546  				  const char *name,
547  				  const void *data1, const void *data2, const void *data3)
548  {
549    struct hwloc_disc_component *comp;
550    struct hwloc_backend *backend;
551    if (topology-&gt;is_loaded) {
552      errno = EBUSY;
553      return -1;
554    }
555    comp = hwloc_disc_component_find(name, NULL);
556    if (!comp) {
557      errno = ENOSYS;
558      return -1;
559    }
560    backend = comp-&gt;instantiate(topology, comp, 0U &amp;bsol;* force-enabled don&#x27;t get any phase blacklisting */,
561  			      data1, data2, data3);
562    if (backend) {
563      int err;
564      backend-&gt;envvar_forced = envvar_forced;
565      if (topology-&gt;backends)
566        hwloc_backends_disable_all(topology);
567      err = hwloc_backend_enable(backend);
568      if (comp-&gt;phases == HWLOC_DISC_PHASE_GLOBAL) {
569        char *env = getenv(&quot;HWLOC_ANNOTATE_GLOBAL_COMPONENTS&quot;);
570        if (env &amp;&amp; atoi(env))
571  	topology-&gt;backend_excluded_phases &amp;= ~HWLOC_DISC_PHASE_ANNOTATE;
572      }
573      return err;
574    } else
575      return -1;
576  }
577  static int
578  hwloc_disc_component_try_enable(struct hwloc_topology *topology,
579  				struct hwloc_disc_component *comp,
580  				int envvar_forced,
581  				unsigned blacklisted_phases)
582  {
583    struct hwloc_backend *backend;
584    if (!(comp-&gt;phases &amp; ~(topology-&gt;backend_excluded_phases | blacklisted_phases))) {
585      if (hwloc_components_verbose)
586        fprintf(stderr, &quot;hwloc: Excluding discovery component `%s&#x27; phases 0x%x, conflicts with excludes 0x%x\n&quot;,
587  	      comp-&gt;name, comp-&gt;phases, topology-&gt;backend_excluded_phases);
588      return -1;
589    }
590    backend = comp-&gt;instantiate(topology, comp, topology-&gt;backend_excluded_phases | blacklisted_phases,
591  			      NULL, NULL, NULL);
592    if (!backend) {
593      if (hwloc_components_verbose || (envvar_forced &amp;&amp; HWLOC_SHOW_CRITICAL_ERRORS()))
594        fprintf(stderr, &quot;hwloc: Failed to instantiate discovery component `%s&#x27;\n&quot;, comp-&gt;name);
595      return -1;
596    }
597    backend-&gt;phases &amp;= ~blacklisted_phases;
598    backend-&gt;envvar_forced = envvar_forced;
599    return hwloc_backend_enable(backend);
600  }
601  void
602  hwloc_disc_components_enable_others(struct hwloc_topology *topology)
603  {
604    struct hwloc_disc_component *comp;
605    struct hwloc_backend *backend;
606    int tryall = 1;
607    const char *_env;
608    char *env; &amp;bsol;* we&#x27;ll to modify the env value, so duplicate it */
609    unsigned i;
610    _env = getenv(&quot;HWLOC_COMPONENTS&quot;);
611    env = _env ? strdup(_env) : NULL;
612    if (env) {
613      char *curenv = env;
614      size_t s;
615      while (*curenv) {
616        s = strcspn(curenv, HWLOC_COMPONENT_SEPS);
617        if (s) {
618  	char c;
619  	if (curenv[0] != HWLOC_COMPONENT_EXCLUDE_CHAR)
620  	  goto nextname;
621  	c = curenv[s];
622  	curenv[s] = &#x27;\0&#x27;;
623  	hwloc_disc_component_blacklist_one(topology, curenv+1);
624  	for(i=0; i&lt;s; i++)
625  	  curenv[i] = *HWLOC_COMPONENT_SEPS;
626  	curenv[s] = c;
627        }
628      nextname:
629        curenv += s;
630        if (*curenv)
631  	curenv++;
632      }
633    }
634    if (env) {
635      char *curenv = env;
<span onclick='openModal()' class='match'>636      size_t s;
637      while (*curenv) {
638        s = strcspn(curenv, HWLOC_COMPONENT_SEPS);
639        if (s) {
640  	char c;
641  	const char *name;
</span>642  	if (!strncmp(curenv, HWLOC_COMPONENT_STOP_NAME, s)) {
643  	  tryall = 0;
644  	  break;
645  	}
646  	c = curenv[s];
647  	curenv[s] = &#x27;\0&#x27;;
648  	name = curenv;
649  	if (!strcmp(name, &quot;linuxpci&quot;) || !strcmp(name, &quot;linuxio&quot;)) {
650  	  if (hwloc_components_verbose)
651  	    fprintf(stderr, &quot;hwloc: Replacing deprecated component `%s&#x27; with `linux&#x27; in envvar forcing\n&quot;, name);
652  	  name = &quot;linux&quot;;
653  	}
654  	comp = hwloc_disc_component_find(name, NULL &amp;bsol;* we enable the entire component, phases must be blacklisted separately */);
655  	if (comp) {
656  	  unsigned blacklisted_phases = 0U;
657  	  for(i=0; i&lt;topology-&gt;nr_blacklisted_components; i++)
658  	    if (comp == topology-&gt;blacklisted_components[i].component) {
659  	      blacklisted_phases = topology-&gt;blacklisted_components[i].phases;
660  	      break;
661  	    }
662  	  if (comp-&gt;phases &amp; ~blacklisted_phases)
663  	    hwloc_disc_component_try_enable(topology, comp, 1 &amp;bsol;* envvar forced */, blacklisted_phases);
664  	} else {
665            if (HWLOC_SHOW_CRITICAL_ERRORS())
666              fprintf(stderr, &quot;hwloc: Cannot find discovery component `%s&#x27;\n&quot;, name);
667  	}
668  	curenv[s] = c;
669        }
670        curenv += s;
671        if (*curenv)
672  	curenv++;
673      }
674    }
675    if (tryall) {
676      comp = hwloc_disc_components;
677      while (NULL != comp) {
678        unsigned blacklisted_phases = 0U;
679        if (!comp-&gt;enabled_by_default)
680  	goto nextcomp;
681        for(i=0; i&lt;topology-&gt;nr_blacklisted_components; i++)
682  	if (comp == topology-&gt;blacklisted_components[i].component) {
683  	  blacklisted_phases = topology-&gt;blacklisted_components[i].phases;
684  	  break;
685  	}
686        if (!(comp-&gt;phases &amp; ~blacklisted_phases)) {
687  	if (hwloc_components_verbose)
688  	  fprintf(stderr, &quot;hwloc: Excluding blacklisted discovery component `%s&#x27; phases 0x%x\n&quot;,
689  		  comp-&gt;name, comp-&gt;phases);
690  	goto nextcomp;
691        }
692        hwloc_disc_component_try_enable(topology, comp, 0 &amp;bsol;* defaults, not envvar forced */, blacklisted_phases);
693  nextcomp:
694        comp = comp-&gt;next;
695      }
696    }
697    if (hwloc_components_verbose) {
698      int first = 1;
699      backend = topology-&gt;backends;
700      fprintf(stderr, &quot;hwloc: Final list of enabled discovery components: &quot;);
701      while (backend != NULL) {
702        fprintf(stderr, &quot;%s%s(0x%x)&quot;, first ? &quot;&quot; : &quot;,&quot;, backend-&gt;component-&gt;name, backend-&gt;phases);
703        backend = backend-&gt;next;
704        first = 0;
705      }
706      fprintf(stderr, &quot;\n&quot;);
707    }
708    free(env);
709  }
710  void
711  hwloc_components_fini(void)
712  {
713    unsigned i;
714    HWLOC_COMPONENTS_LOCK();
715    assert(0 != hwloc_components_users);
716    if (0 != --hwloc_components_users) {
717      HWLOC_COMPONENTS_UNLOCK();
718      return;
719    }
720    for(i=0; i&lt;hwloc_component_finalize_cb_count; i++)
721      hwloc_component_finalize_cbs[hwloc_component_finalize_cb_count-i-1](0);
722    free(hwloc_component_finalize_cbs);
723    hwloc_component_finalize_cbs = NULL;
724    hwloc_component_finalize_cb_count = 0;
725    hwloc_disc_components = NULL;
726    hwloc_xml_callbacks_reset();
727  #ifdef HWLOC_HAVE_PLUGINS
728    hwloc_plugins_exit();
729  #endif
730    HWLOC_COMPONENTS_UNLOCK();
731  }
732  struct hwloc_backend *
733  hwloc_backend_alloc(struct hwloc_topology *topology,
734  		    struct hwloc_disc_component *component)
735  {
736    struct hwloc_backend * backend = malloc(sizeof(*backend));
737    if (!backend) {
738      errno = ENOMEM;
739      return NULL;
740    }
741    backend-&gt;component = component;
742    backend-&gt;topology = topology;
743    backend-&gt;phases = component-&gt;phases &amp; ~topology-&gt;backend_excluded_phases;
744    if (backend-&gt;phases != component-&gt;phases &amp;&amp; hwloc_components_verbose)
745      fprintf(stderr, &quot;hwloc: Trying discovery component `%s&#x27; with phases 0x%x instead of 0x%x\n&quot;,
746  	    component-&gt;name, backend-&gt;phases, component-&gt;phases);
747    backend-&gt;flags = 0;
748    backend-&gt;discover = NULL;
749    backend-&gt;get_pci_busid_cpuset = NULL;
750    backend-&gt;disable = NULL;
751    backend-&gt;is_thissystem = -1;
752    backend-&gt;next = NULL;
753    backend-&gt;envvar_forced = 0;
754    return backend;
755  }
756  static void
757  hwloc_backend_disable(struct hwloc_backend *backend)
758  {
759    if (backend-&gt;disable)
760      backend-&gt;disable(backend);
761    free(backend);
762  }
763  int
764  hwloc_backend_enable(struct hwloc_backend *backend)
765  {
766    struct hwloc_topology *topology = backend-&gt;topology;
767    struct hwloc_backend **pprev;
768    if (backend-&gt;flags) {
769      if (HWLOC_SHOW_CRITICAL_ERRORS())
770        fprintf(stderr, &quot;hwloc: Cannot enable discovery component `%s&#x27; phases 0x%x with unknown flags %lx\n&quot;,
771                backend-&gt;component-&gt;name, backend-&gt;component-&gt;phases, backend-&gt;flags);
772      return -1;
773    }
774    pprev = &amp;topology-&gt;backends;
775    while (NULL != *pprev) {
776      if ((*pprev)-&gt;component == backend-&gt;component) {
777        if (hwloc_components_verbose)
778  	fprintf(stderr, &quot;hwloc: Cannot enable  discovery component `%s&#x27; phases 0x%x twice\n&quot;,
779  		backend-&gt;component-&gt;name, backend-&gt;component-&gt;phases);
780        hwloc_backend_disable(backend);
781        errno = EBUSY;
782        return -1;
783      }
784      pprev = &amp;((*pprev)-&gt;next);
785    }
786    if (hwloc_components_verbose)
787      fprintf(stderr, &quot;hwloc: Enabling discovery component `%s&#x27; with phases 0x%x (among 0x%x)\n&quot;,
788  	    backend-&gt;component-&gt;name, backend-&gt;phases, backend-&gt;component-&gt;phases);
789    pprev = &amp;topology-&gt;backends;
790    while (NULL != *pprev)
791      pprev = &amp;((*pprev)-&gt;next);
792    backend-&gt;next = *pprev;
793    *pprev = backend;
794    topology-&gt;backend_phases |= backend-&gt;component-&gt;phases;
795    topology-&gt;backend_excluded_phases |= backend-&gt;component-&gt;excluded_phases;
796    return 0;
797  }
798  void
799  hwloc_backends_is_thissystem(struct hwloc_topology *topology)
800  {
801    struct hwloc_backend *backend;
802    const char *local_env;
803    topology-&gt;is_thissystem = 1;
804    backend = topology-&gt;backends;
805    while (backend != NULL) {
806      if (backend-&gt;envvar_forced == 0 &amp;&amp; backend-&gt;is_thissystem != -1) {
807        assert(backend-&gt;is_thissystem == 0);
808        topology-&gt;is_thissystem = 0;
809      }
810      backend = backend-&gt;next;
811    }
812    if (topology-&gt;flags &amp; HWLOC_TOPOLOGY_FLAG_IS_THISSYSTEM)
813      topology-&gt;is_thissystem = 1;
814    backend = topology-&gt;backends;
815    while (backend != NULL) {
816      if (backend-&gt;envvar_forced == 1 &amp;&amp; backend-&gt;is_thissystem != -1) {
817        assert(backend-&gt;is_thissystem == 0);
818        topology-&gt;is_thissystem = 0;
819      }
820      backend = backend-&gt;next;
821    }
822    local_env = getenv(&quot;HWLOC_THISSYSTEM&quot;);
823    if (local_env)
824      topology-&gt;is_thissystem = atoi(local_env);
825  }
826  void
827  hwloc_backends_find_callbacks(struct hwloc_topology *topology)
828  {
829    struct hwloc_backend *backend = topology-&gt;backends;
830    topology-&gt;get_pci_busid_cpuset_backend = NULL;
831    while (backend != NULL) {
832      if (backend-&gt;get_pci_busid_cpuset) {
833        topology-&gt;get_pci_busid_cpuset_backend = backend;
834        return;
835      }
836      backend = backend-&gt;next;
837    }
838    return;
839  }
840  void
841  hwloc_backends_disable_all(struct hwloc_topology *topology)
842  {
843    struct hwloc_backend *backend;
844    while (NULL != (backend = topology-&gt;backends)) {
845      struct hwloc_backend *next = backend-&gt;next;
846      if (hwloc_components_verbose)
847        fprintf(stderr, &quot;hwloc: Disabling discovery component `%s&#x27;\n&quot;,
848  	      backend-&gt;component-&gt;name);
849      hwloc_backend_disable(backend);
850      topology-&gt;backends = next;
851    }
852    topology-&gt;backends = NULL;
853    topology-&gt;backend_excluded_phases = 0;
854  }
855  void
856  hwloc_topology_components_fini(struct hwloc_topology *topology)
857  {
858    assert(!topology-&gt;backends);
859    free(topology-&gt;blacklisted_components);
860  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-components.c</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-components.c</div>
                </div>
                <div class="column column_space"><pre><code>614      size_t s;
615      while (*curenv) {
616        s = strcspn(curenv, HWLOC_COMPONENT_SEPS);
617        if (s) {
618  	char c;
619  	if (curenv[0] != HWLOC_COMPONENT_EXCLUDE_CHAR)
</pre></code></div>
                <div class="column column_space"><pre><code>636      size_t s;
637      while (*curenv) {
638        s = strcspn(curenv, HWLOC_COMPONENT_SEPS);
639        if (s) {
640  	char c;
641  	const char *name;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    