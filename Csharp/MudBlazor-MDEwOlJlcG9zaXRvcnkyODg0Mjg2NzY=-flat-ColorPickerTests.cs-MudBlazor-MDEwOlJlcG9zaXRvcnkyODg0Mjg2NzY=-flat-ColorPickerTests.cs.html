
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 43, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-ColorPickerTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  #pragma warning disable IDE1006 
3  using System;
4  using System.Collections.Generic;
5  using System.Globalization;
6  using System.Linq;
7  using System.Threading.Tasks;
8  using AngleSharp.Dom;
9  using AngleSharp.Html.Dom;
10  using Bunit;
11  using FluentAssertions;
12  using Microsoft.AspNetCore.Components.Web;
13  using Microsoft.Extensions.DependencyInjection;
14  using MudBlazor.UnitTests.Mocks;
15  using MudBlazor.UnitTests.TestComponents;
16  using MudBlazor.UnitTests.TestComponents.ColorPicker;
17  using MudBlazor.Utilities;
18  using NUnit.Framework;
19  namespace MudBlazor.UnitTests.Components
20  {
21      [TestFixture]
22      public class ColorPickerTests : BunitTest
23      {
24          private const double _defaultXForColorPanel = 209.84;
25          private const double _defaultYForColorPanel = 28.43;
26          private static MudColor _defaultColor = "#594ae2";
27          private const string _hueSliderCssSelector = ".mud-slider.mud-picker-color-slider.hue input";
28          private const string _alphaSliderCssSelector = ".mud-picker-color-slider.alpha input";
29          private const string _colorDotCssSelector = ".mud-picker-color-fill";
30          private const string _toolbarCssSelector = ".mud-toolbar";
31          private const string _mudColorPickerCssSelector = ".mud-picker-color-picker";
32          private const string _slidersControlCssSelector = ".mud-picker-color-sliders";
33          private const string _colorInputCssSelector = ".mud-picker-color-inputs";
34          private const string _colorInputModeSwitchCssSelector = ".mud-picker-control-switch";
35          private const string _alphaInputCssSelector = ".input-field-alpha";
36          private const string CssSelector = ".mud-picker-color-overlay-black .mud-picker-color-overlay";
37          private const string _mudToolbarButtonsCssSelector = ".mud-toolbar button";
38          private static MudColor[] _mudGridDefaultColors = new MudColor[]
39                          {
40                  "#FFFFFF","#ebebeb","#d6d6d6","#c2c2c2","#adadad","#999999","#858586","#707070","#5c5c5c","#474747","#333333","#000000",
41                  "#133648","#071d53","#0f0638","#2a093b","#370c1b","#541107","#532009","#53350d","#523e0f","#65611b","#505518","#2b3d16",
42                  "#1e4c63","#0f2e76","#180b4e","#3f1256","#4e1629","#781e0e","#722f10","#734c16","#73591a","#8c8629","#707625","#3f5623",
43                  "#2e6c8c","#1841a3","#280c72","#591e77","#6f223d","#a62c17","#a0451a","#a06b23","#9f7d28","#c3bc3c","#9da436","#587934",
44                  "#3c8ab0","#2155ce","#331c8e","#702898","#8d2e4f","#d03a20","#ca5a24","#c8862e","#c99f35","#f3ec4e","#c6d047","#729b44",
45                  "#479fd3","#2660f5","#4725ab","#8c33b5","#aa395d","#eb512e","#ed732e","#f3ae3d","#f5c944","#fefb67","#ddeb5c","#86b953",
46                  "#59c4f7","#4e85f6","#5733e2","#af43eb","#d44a7a","#ed6c59","#ef8c56","#f3b757","#f6cd5b","#fef881","#e6ee7a","#a3d16e",
47                  "#78d3f8","#7fa6f8","#7e52f5","#c45ff6","#de789d","#f09286","#f2a984","#f6c983","#f9da85","#fef9a1","#ebf29b","#badc94",
48                  "#a5e1fa","#adc5fa","#ab8df7","#d696f8","#e8a7bf","#f4b8b1","#f6c7af","#f9daae","#fae5af","#fefbc0","#f3f7be","#d2e7ba",
49                  "#d2effd","#d6e1fc","#d6c9fa","#e9cbfb","#f3d4df","#f9dcd9","#fae3d8","#fcecd7","#fdf2d8","#fefce0","#f7fade","#e3edd6"
50                          };
51          private static MudColor[] _mudGridPaletteDefaultClors = new MudColor[]
52                  {
53                     "#424242", "#2196f3", "#00c853", "#ff9800", "#f44336",
54                    "#f6f9fb", "#9df1fa", "#bdffcf", "#fff0a3", "#ffd254",
55                    "#e6e9eb", "#27dbf5", "#7ef7a0", "#ffe273", "#ffb31f",
56                    "#c9cccf", "#13b8e8", "#14dc71", "#fdd22f", "#ff9102",
57                    "#858791", "#0989c2", "#1bbd66", "#ebb323", "#fe6800",
58                    "#585b62", "#17698e", "#17a258", "#d9980d", "#dc3f11",
59                    "#353940", "#113b53", "#127942", "#bf7d11", "#aa0000"
60                  };
61          private MockEventListener _eventListener;
62          public override void Setup()
63          {
64              _eventListener = new MockEventListener();
65              base.Setup();
66              Context.Services.AddSingleton<IEventListenerFactory>(new MockEventListenerFactory(_eventListener));
67          }
68          private void CheckColorRelatedValues(IRenderedComponent<SimpleColorPickerTest> comp, double expectedX, double expectedY, MudColor expectedColor, ColorPickerMode mode, bool checkInstanceValue = true, bool isRtl = false)
69          {
70              if (checkInstanceValue == true)
71              {
72                  comp.Instance.ColorValue.Should().Be(expectedColor);
73              }
74              if (mode is ColorPickerMode.RGB or ColorPickerMode.HSL)
75              {
76                  var castedInputs = GetColorInputs(comp);
77                  if (mode == ColorPickerMode.RGB)
78                  {
79                      castedInputs[0].Value.Should().Be(expectedColor.R.ToString());
80                      castedInputs[1].Value.Should().Be(expectedColor.G.ToString());
81                      castedInputs[2].Value.Should().Be(expectedColor.B.ToString());
82                      castedInputs[3].Value.Should().Be(expectedColor.APercentage.ToString(CultureInfo.CurrentUICulture));
83                  }
84                  else
85                  {
86                      castedInputs[0].Value.Should().Be(expectedColor.H.ToString(CultureInfo.CurrentUICulture));
87                      castedInputs[1].Value.Should().Be(expectedColor.S.ToString(CultureInfo.CurrentUICulture));
88                      castedInputs[2].Value.Should().Be(expectedColor.L.ToString(CultureInfo.CurrentUICulture));
89                      castedInputs[3].Value.Should().Match(x => double.Parse(x, CultureInfo.CurrentUICulture) == Math.Round((expectedColor.A / 255.0), 2));
90                  }
91              }
92              else if (mode == ColorPickerMode.HEX)
93              {
94                  var castedInputs = GetColorInputs(comp, 1);
95                  castedInputs[0].Value.Should().Be(expectedColor.Value);
96              }
97              var selector = comp.Find(".mud-picker-color-selector");
98              selector.Should().NotBeNull();
99              var selectorStyleAttribute = selector.GetAttribute("style");
100              selectorStyleAttribute.Should().Be($"transform: translate({expectedX.ToString(CultureInfo.InvariantCulture)}px, {expectedY.ToString(CultureInfo.InvariantCulture)}px);");
101              var hueSlideValue = comp.FindAll(".mud-picker-color-slider.hue input");
102              hueSlideValue.Should().ContainSingle();
103              hueSlideValue[0].Should().BeAssignableTo<IHtmlInputElement>();
104              ((IHtmlInputElement)hueSlideValue[0]).Value.Should().Be(((int)expectedColor.H).ToString());
105              var alphaSlider = comp.FindAll(_alphaSliderCssSelector);
106              alphaSlider.Should().ContainSingle();
107              alphaSlider[0].Should().BeAssignableTo<IHtmlInputElement>();
108              ((IHtmlInputElement)alphaSlider[0]).Value.Should().Be(((int)expectedColor.A).ToString());
109              var alphaSliderStyleAttritbute = ((IHtmlElement)alphaSlider[0].Parent.Parent).GetAttribute("style");
110              if (isRtl == false)
111              {
112                  alphaSliderStyleAttritbute.Should().Be($"background-image: linear-gradient(to right, transparent, {expectedColor.ToString(MudColorOutputFormats.RGB)});");
113              }
114              else
115              {
116                  alphaSliderStyleAttritbute.Should().Be($"background-image: linear-gradient(to left, transparent, {expectedColor.ToString(MudColorOutputFormats.RGB)});");
117              }
118          }
119          private IHtmlInputElement[] GetColorInputs(IRenderedComponent<SimpleColorPickerTest> comp, int expectedCount = 4)
120          {
121              var inputs = comp.FindAll(".mud-picker-color-inputs input");
122              inputs.Should().AllBeAssignableTo<IHtmlInputElement>();
123              inputs.Should().HaveCount(expectedCount);
124              var castedInputs = inputs.Cast<IHtmlInputElement>().ToArray();
125              return castedInputs;
126          }
127          private IHtmlInputElement GetColorInput(IRenderedComponent<SimpleColorPickerTest> comp, int index, int expectedCount = 4) => GetColorInputs(comp, expectedCount)[index];
128          [Test]
129          public void ColorPickerOpenButtonAriaLabel()
130          {
131              var comp = Context.RenderComponent<MudColorPicker>();
132              var openButton = comp.Find(".mud-input-adornment button");
133              openButton.Attributes.GetNamedItem("aria-label")?.Value.Should().Be("Open Color Picker");
134          }
135          [Test]
136          public async Task Default()
137          {
138              var comp = Context.RenderComponent<MudColorPicker>();
139              comp.Instance.DisableAlpha.Should().BeFalse();
140              comp.Instance.DisableColorField.Should().BeFalse();
141              comp.Instance.DisableModeSwitch.Should().BeFalse();
142              comp.Instance.DisableInputs.Should().BeFalse();
143              comp.Instance.DisableSliders.Should().BeFalse();
144              comp.Instance.DisablePreview.Should().BeFalse();
145              comp.Instance.ColorPickerMode.Should().Be(ColorPickerMode.RGB);
146              comp.Instance.ColorPickerView.Should().Be(ColorPickerView.Spectrum);
147              comp.Instance.UpdateBindingIfOnlyHSLChanged.Should().BeFalse();
148              comp.Instance.Value.Should().Be(_defaultColor);
149              comp.Instance.Palette.Should().BeEquivalentTo(_mudGridPaletteDefaultClors);
150              comp.Instance.DisableDragEffect.Should().BeFalse();
151          }
152          [Test]
153          [TestCase(40, 256.78, _defaultYForColorPanel)]
154          public void SetR(byte r, double selectorXPosition, double selectorYPosition)
155          {
156              var comp = Context.RenderComponent<SimpleColorPickerTest>();
157              var rInput = GetColorInput(comp, 0);
158              var expectedColor = comp.Instance.ColorValue.SetR(r);
159              rInput.Change(expectedColor.R.ToString());
160              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.RGB);
161          }
162          [Test]
163          [TestCase(240, 196.3, 14.71)]
164          public void SetG(byte g, double selectorXPosition, double selectorYPosition)
165          {
166              var comp = Context.RenderComponent<SimpleColorPickerTest>();
167              var gInput = GetColorInput(comp, 1);
168              var expectedColor = comp.Instance.ColorValue.SetG(g);
169              gInput.Change(expectedColor.G.ToString());
170              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.RGB);
171          }
172          [Test]
173          [TestCase(90, 55.47, 161.76)]
174          public void SetB(byte b, double selectorXPosition, double selectorYPosition)
175          {
176              var comp = Context.RenderComponent<SimpleColorPickerTest>();
177              var bInput = GetColorInput(comp, 2);
178              var expectedColor = comp.Instance.ColorValue.SetB(b);
179              bInput.Change(expectedColor.B.ToString());
180              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.RGB);
181          }
182          [Test]
183          [TestCase(0.9, _defaultXForColorPanel, _defaultYForColorPanel)]
184          public void SetA_InRGBMode(double a, double selectorXPosition, double selectorYPosition)
185          {
186              var comp = Context.RenderComponent<SimpleColorPickerTest>();
187              var aInput = GetColorInput(comp, 3);
188              var expectedColor = comp.Instance.ColorValue.SetAlpha(a);
189              aInput.Change(a.ToString(CultureInfo.CurrentUICulture));
190              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.RGB);
191          }
192          [Test]
193          [TestCase(90, 208.46, _defaultYForColorPanel)]
194          public void SetH(int h, double selectorXPosition, double selectorYPosition)
195          {
196              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL));
197              var hInput = GetColorInput(comp, 0);
198              var expectedColor = comp.Instance.ColorValue.SetH(h);
199              hInput.Change(expectedColor.H.ToString());
200              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HSL);
201          }
202          [Test]
203          [TestCase(0.4, 134.88, 61.76)]
204          public void SetS(double s, double selectorXPosition, double selectorYPosition)
205          {
206              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL));
207              var sColor = GetColorInput(comp, 1);
208              var expectedColor = comp.Instance.ColorValue.SetS(s);
209              sColor.Change(expectedColor.S.ToString(CultureInfo.CurrentUICulture));
210              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HSL);
211          }
212          [Test]
213          [TestCase(0.67, 163.43, 23.53)]
214          public void SetL(double l, double selectorXPosition, double selectorYPosition)
215          {
216              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL));
217              var lColor = GetColorInput(comp, 2);
218              var expectedColor = comp.Instance.ColorValue.SetL(l);
219              lColor.Change(expectedColor.L.ToString(CultureInfo.CurrentUICulture));
220              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HSL);
221          }
222          [Test]
223          [TestCase(0.5, _defaultXForColorPanel, _defaultYForColorPanel)]
224          public void SetAlpha_AsHLS(double a, double selectorXPosition, double selectorYPosition)
225          {
226              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL));
227              var lColor = GetColorInput(comp, 3);
228              var expectedColor = comp.Instance.ColorValue.SetAlpha(a);
229              lColor.Change(a.ToString(CultureInfo.CurrentUICulture));
230              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HSL);
231          }
232          [Test]
233          [TestCase("#8cb829ff", 242.48, 69.61)]
234          public void SetColorInput(string colorHexString, double selectorXPosition, double selectorYPosition)
235          {
236              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HEX));
237              var inputs = comp.FindAll(".mud-picker-color-inputs input");
238              var lColor = GetColorInput(comp, 0, 1);
239              var expectedColor = colorHexString;
240              lColor.Change(colorHexString);
241              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HEX);
242          }
243          [Test]
244          [TestCase("#8qb829ff")]
245          public void SetColorInput_InvalidNoChange(string colorHexString)
246          {
247              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HEX));
248              var inputs = comp.FindAll(".mud-picker-color-inputs input");
<span onclick='openModal()' class='match'>249              var hexInput = GetColorInput(comp, 0, 1);
250              var expectedColor = _defaultColor;
251              hexInput.Change(colorHexString);
252              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, expectedColor, ColorPickerMode.HEX);
253          }
254          [Test]
255          public void SetAlphaSlider()
</span>256          {
257              var comp = Context.RenderComponent<SimpleColorPickerTest>();
258              for (var i = 256 - 1; i >= 0; i--)
259              {
260                  var expectedColor = comp.Instance.ColorValue.SetAlpha((byte)i);
261                  var hueColerSlider = comp.FindAll(_alphaSliderCssSelector);
262                  hueColerSlider.Should().ContainSingle();
263                  hueColerSlider[0].Should().BeAssignableTo<IHtmlInputElement>();
264                  InputEventDispatchExtensions.Input(hueColerSlider[0], i.ToString());
265                  CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, expectedColor, ColorPickerMode.RGB);
266              }
267          }
268          [Test]
269          public void MouseMove()
270          {
271              var comp = Context.RenderComponent<SimpleColorPickerTest>();
272              var args = new MouseEventArgs
273              {
274                  OffsetX = 117.0,
275                  OffsetY = 140.0,
276                  Buttons = 1,
277              };
278              _eventListener.FireEvent(args);
279              var expectedColor = new MudColor(74, 70, 112, 255);
280              CheckColorRelatedValues(comp, args.OffsetX, args.OffsetY, expectedColor, ColorPickerMode.RGB);
281              var argsWithoutLeftButtonPushed = new MouseEventArgs
282              {
283                  OffsetX = 117.0,
284                  OffsetY = 140.0,
285                  Buttons = 0,
286              };
287              _eventListener.FireEvent(argsWithoutLeftButtonPushed);
288              CheckColorRelatedValues(comp, args.OffsetX, args.OffsetY, expectedColor, ColorPickerMode.RGB);
289          }
290          [Test]
291          [TestCase(PickerVariant.Dialog)]
292          [TestCase(PickerVariant.Inline)]
293          public async Task MouseMove_InDialogMode(PickerVariant variant)
294          {
295              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(y =>
296              y.Variant, variant));
297              var args = new MouseEventArgs
298              {
299                  OffsetX = 117.0,
300                  OffsetY = 140.0,
301                  Buttons = 1,
302              };
303              _eventListener.Callbacks.Values.Should().BeEmpty();
304              await comp.Instance.OpenPicker();
305              _eventListener.Callbacks.Values.Should().ContainSingle();
306              _eventListener.FireEvent(args);
307              var expectedColor = new MudColor(74, 70, 112, 255);
308              CheckColorRelatedValues(comp, args.OffsetX, args.OffsetY, expectedColor, ColorPickerMode.RGB);
309              var argsWithoutLeftButtonPushed = new MouseEventArgs
310              {
311                  OffsetX = 117.0,
312                  OffsetY = 140.0,
313                  Buttons = 0,
314              };
315              _eventListener.FireEvent(argsWithoutLeftButtonPushed);
316              CheckColorRelatedValues(comp, args.OffsetX, args.OffsetY, expectedColor, ColorPickerMode.RGB);
317              await comp.Instance.ClosePicker();
318              _eventListener.Callbacks.Should().BeEmpty();
319          }
320          [Test]
321          public void SetHueSlider()
322          {
323              var comp = Context.RenderComponent<SimpleColorPickerTest>();
324              for (var i = 0; i <= 360; i++)
325              {
326                  var expectedColor = comp.Instance.ColorValue.SetH(i);
327                  var hueColorSlider = comp.FindAll(_hueSliderCssSelector);
328                  hueColorSlider.Should().ContainSingle();
329                  hueColorSlider[0].Should().BeAssignableTo<IHtmlInputElement>();
330                  InputEventDispatchExtensions.Input(hueColorSlider[0], i.ToString());
331                  CheckColorRelatedValues(comp, 208.46, _defaultYForColorPanel, expectedColor, ColorPickerMode.RGB);
332              }
333          }
334          [Test]
335          public void Click_ColorPanel()
336          {
337              var comp = Context.RenderComponent<SimpleColorPickerTest>();
338              var overlay = comp.Find(CssSelector);
339              var x = 99.2;
340              var y = 200.98;
341              overlay.Click(new MouseEventArgs { OffsetX = x, OffsetY = y });
342              MudColor color = "#232232ff";
343              MudColor expectedColor = new MudColor(color.R, color.G, color.B, _defaultColor);
344              CheckColorRelatedValues(comp, x, y, expectedColor, ColorPickerMode.RGB);
345          }
346          [Test]
347          public void Click_ModeButton()
348          {
349              var comp = Context.RenderComponent<SimpleColorPickerTest>();
350              var color = comp.Instance.ColorValue;
351              var modeButton = comp.Find(".mud-picker-control-switch button");
352              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, color, ColorPickerMode.RGB);
353              modeButton.Click();
354              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, color, ColorPickerMode.HSL);
355              modeButton.Click();
356              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, color, ColorPickerMode.HEX);
357              modeButton.Click();
358              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, color, ColorPickerMode.RGB);
359          }
360          [Test]
361          public void ColorPalette_Interaction()
362          {
363              var comp = Context.RenderComponent<SimpleColorPickerTest>();
364              var colorDot = comp.Find(_colorDotCssSelector);
365              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-collection"));
366              colorDot.Click();
367              var colorsToSelectPanel = comp.Find(".mud-picker-color-collection");
368              colorsToSelectPanel.Children.Should().HaveCount(5);
369              var expectedColors = new MudColor[] { "#ff4081ff", "#2196f3ff", "#00c853ff", "#ff9800ff", "#f44336ff" };
370              for (var i = 0; i < 5; i++)
371              {
372                  var styleAttribute = colorsToSelectPanel.Children[i].GetAttribute("style");
373                  styleAttribute.Should().Be($"background: {expectedColors[i].ToString(MudColorOutputFormats.RGBA)};");
374              }
375              colorDot.Click();
376              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-collection"));
377          }
378          [Test]
379          public void ColorPalette_CustomColors()
380          {
381              var expectedColors = new MudColor[] { "#23af3daa", "#56a23dff", "#56a85dff" };
382              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.Palette, expectedColors));
383              var colorDot = comp.Find(_colorDotCssSelector);
384              colorDot.Click();
385              var colorsToSelectPanel = comp.Find(".mud-picker-color-collection");
386              colorsToSelectPanel.Children.Should().HaveCount(expectedColors.Length);
387              for (var i = 0; i < expectedColors.Length; i++)
388              {
389                  var styleAttribute = colorsToSelectPanel.Children[i].GetAttribute("style");
390                  styleAttribute.Should().Be($"background: {expectedColors[i].ToString(MudColorOutputFormats.RGBA)};");
391              }
392          }
393          [Test]
394          public void ColorPalette_SelectColor()
395          {
396              var comp = Context.RenderComponent<SimpleColorPickerTest>();
397              var colorDot = comp.Find(_colorDotCssSelector);
398              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-collection"));
399              colorDot.Click();
400              var expectedColors = new MudColor[] { "#ff4081ff", "#2196f3ff", "#00c853ff", "#ff9800ff", "#f44336ff" };
401              for (var i = 0; i < 5; i++)
402              {
403                  var colorsToSelectPanel = comp.Find(".mud-picker-color-collection");
404                  colorsToSelectPanel.Children[i].Click();
405                  colorDot = comp.Find(_colorDotCssSelector);
406                  var styleAttribute = colorDot.GetAttribute("style");
407                  styleAttribute.Should().Be($"background: {expectedColors[i].ToString(MudColorOutputFormats.RGBA)};");
408                  comp.Instance.ColorValue.Should().Be(expectedColors[i]);
409                  colorDot.Click();
410              }
411          }
412          [Test]
413          public void Toggle_Toolbar()
414          {
415              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisableToolbar, false));
416              _ = comp.Find(_toolbarCssSelector);
417              comp.SetParametersAndRender(p => p.Add(x => x.DisableToolbar, true));
418              Assert.Throws<ElementNotFoundException>(() => comp.Find(_toolbarCssSelector));
419              comp.SetParametersAndRender(p => p.Add(x => x.DisableToolbar, false));
420              _ = comp.Find(_toolbarCssSelector);
421          }
422          [Test]
423          public void Toggle_ColorField()
424          {
425              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisableColorField, false));
426              _ = comp.Find(_mudColorPickerCssSelector);
427              comp.SetParametersAndRender(p => p.Add(x => x.DisableColorField, true));
428              Assert.Throws<ElementNotFoundException>(() => comp.Find(_mudColorPickerCssSelector));
429              comp.SetParametersAndRender(p => p.Add(x => x.DisableColorField, false));
430              _ = comp.Find(_mudColorPickerCssSelector);
431          }
432          [Test]
433          public void Toggle_Preview()
434          {
435              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisablePreview, false));
436              _ = comp.Find(_colorDotCssSelector);
437              comp.SetParametersAndRender(p => p.Add(x => x.DisablePreview, true));
438              Assert.Throws<ElementNotFoundException>(() => comp.Find(_colorDotCssSelector));
439              comp.SetParametersAndRender(p => p.Add(x => x.DisablePreview, false));
440              _ = comp.Find(_colorDotCssSelector);
441          }
442          [Test]
443          public void Toggle_Sliders()
444          {
445              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisableSliders, false));
446              _ = comp.Find(_slidersControlCssSelector);
447              comp.SetParametersAndRender(p => p.Add(x => x.DisableSliders, true));
448              Assert.Throws<ElementNotFoundException>(() => comp.Find(_slidersControlCssSelector));
449              comp.SetParametersAndRender(p => p.Add(x => x.DisableSliders, false));
450              _ = comp.Find(_slidersControlCssSelector);
451          }
452          [Test]
453          [TestCase(ColorPickerMode.HEX)]
454          [TestCase(ColorPickerMode.HSL)]
455          [TestCase(ColorPickerMode.RGB)]
456          public void Toggle_Input(ColorPickerMode mode)
457          {
458              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
459              {
460                  p.Add(x => x.ColorPickerMode, mode);
461                  p.Add(x => x.DisableInput, false);
462              });
463              _ = comp.Find(_colorInputCssSelector);
464              comp.SetParametersAndRender(p => p.Add(x => x.DisableInput, true));
465              Assert.Throws<ElementNotFoundException>(() => comp.Find(_colorInputCssSelector));
466              comp.SetParametersAndRender(p => p.Add(x => x.DisableInput, false));
467              _ = comp.Find(_colorInputCssSelector);
468          }
469          [Test]
470          public void Toggle_ModeSwitch()
471          {
472              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisableModeSwitch, false));
473              _ = comp.Find(_colorInputModeSwitchCssSelector);
474              comp.SetParametersAndRender(p => p.Add(x => x.DisableModeSwitch, true));
475              Assert.Throws<ElementNotFoundException>(() => comp.Find(_colorInputModeSwitchCssSelector));
476              comp.SetParametersAndRender(p => p.Add(x => x.DisableModeSwitch, false));
477              _ = comp.Find(_colorInputModeSwitchCssSelector);
478          }
479          [Test]
480          [TestCase(ColorPickerMode.HSL)]
481          [TestCase(ColorPickerMode.RGB)]
482          public void Toggle_Alpha(ColorPickerMode mode)
483          {
484              var color = new MudColor(12, 220, 124, 120);
485              var expectedColor = new MudColor(12, 220, 124, 120);
486              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
487              {
488                  p.Add(x => x.ColorPickerMode, mode);
489                  p.Add(x => x.DisableAlpha, false);
490                  p.Add(x => x.ColorValue, color);
491              });
492              _ = comp.Find(_alphaInputCssSelector);
493              comp.SetParametersAndRender(p => p.Add(x => x.DisableAlpha, true));
494              Assert.Throws<ElementNotFoundException>(() => comp.Find(_alphaInputCssSelector));
495              comp.Instance.ColorValue.Should().Be(expectedColor);
496              comp.Instance.TextValue.Should().Be(expectedColor.ToString(MudColorOutputFormats.Hex));
497              comp.SetParametersAndRender(p => p.Add(x => x.DisableAlpha, false));
498              _ = comp.Find(_alphaInputCssSelector);
499              comp.Instance.ColorValue.Should().Be(expectedColor);
500              comp.Instance.TextValue.Should().Be(expectedColor.ToString(MudColorOutputFormats.HexA));
501          }
502          [Test]
503          public void Toggle_Alpha_HexInputMode()
504          {
505              var color = new MudColor(12, 220, 124, 120);
506              var expectedColor = new MudColor(12, 220, 124, 120);
507              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
508              {
509                  p.Add(x => x.ColorPickerMode, ColorPickerMode.HEX);
510                  p.Add(x => x.DisableAlpha, false);
511                  p.Add(x => x.ColorValue, color);
512              });
513              Assert.Throws<ElementNotFoundException>(() => comp.Find(_alphaInputCssSelector));
514              comp.SetParametersAndRender(p => p.Add(x => x.DisableAlpha, true));
515              comp.Instance.ColorValue.Should().Be(expectedColor);
516              var inputs = comp.FindAll(".mud-picker-color-inputfield input");
517              inputs.Should().ContainSingle();
518              inputs.Should().AllBeAssignableTo<IHtmlInputElement>();
519              ((IHtmlInputElement)inputs[0]).Value.Should().Be("#0cdc7c");
520              ((IHtmlInputElement)inputs[0]).MaxLength.Should().Be(7);
521              comp.Instance.TextValue.Should().Be("#0cdc7c");
522              comp.SetParametersAndRender(p => p.Add(x => x.DisableAlpha, false));
523              comp.Instance.ColorValue.Should().Be(expectedColor);
524              inputs = comp.FindAll(".mud-picker-color-inputfield input");
525              inputs.Should().ContainSingle();
526              inputs.Should().AllBeAssignableTo<IHtmlInputElement>();
527              ((IHtmlInputElement)inputs[0]).Value.Should().Be("#0cdc7c78");
528              ((IHtmlInputElement)inputs[0]).MaxLength.Should().Be(9);
529              comp.Instance.TextValue.Should().Be("#0cdc7c78");
530          }
531          [Test]
532          public void ToggleViewMode()
533          {
534              var comp = Context.RenderComponent<MudColorPicker>(p =>
535              {
536                  p.Add(x => x.DisableToolbar, false);
537                  p.Add(x => x.PickerVariant, PickerVariant.Static);
538              });
539              var buttons = comp.FindAll(_mudToolbarButtonsCssSelector);
540              Dictionary<int, (ColorPickerView, string)> buttonMapper = new()
541              {
542                  { 2, (ColorPickerView.Palette, ".mud-picker-color-view-collection") },
543                  { 1, (ColorPickerView.Grid, ".mud-picker-color-grid") },
544                  { 0, (ColorPickerView.Spectrum, ".mud-picker-color-overlay") },
545              };
546              foreach (var item in buttonMapper)
547              {
548                  buttons[item.Key].Click();
549                  _ = comp.Find(item.Value.Item2);
550              }
551          }
552          [Test]
553          [TestCase(PickerVariant.Static, false)]
554          [TestCase(PickerVariant.Inline, true)]
555          [TestCase(PickerVariant.Dialog, true)]
556          public async Task CloseButtonInToolbarVisible(PickerVariant variant, bool expectedVisibility)
557          {
558              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
559              {
560                  p.Add(x => x.Variant, variant);
561                  p.Add(x => x.DisableToolbar, false);
562              });
563              if (variant is PickerVariant.Dialog or PickerVariant.Inline)
564              {
565                  await comp.Instance.OpenPicker();
566              }
567              if (expectedVisibility == false)
568              {
569                  Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-close-picker-button"));
570              }
571              else
572              {
573                  _ = comp.Find(".mud-close-picker-button");
574              }
575          }
576          [Test]
577          [TestCase(ColorPickerView.Spectrum, 0)]
578          [TestCase(ColorPickerView.Grid, 1)]
579          [TestCase(ColorPickerView.Palette, 2)]
580          public void ColorPickerView_Selection(ColorPickerView view, int index)
581          {
582              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
583              {
584                  p.Add(x => x.ViewMode, view);
585                  p.Add(x => x.DisableToolbar, false);
586              });
587              var toolbarButtons = comp.FindAll(".mud-toolbar .mud-icon-button button");
588              for (var i = 0; i < toolbarButtons.Count; i++)
589              {
590                  if (i == index)
591                  {
592                      toolbarButtons[i].ClassList.Should().Contain(".mud-icon-button-color-primary");
593                  }
594                  else
595                  {
596                      toolbarButtons[i].ClassList.Should().NotContain(".mud-icon-button-color-primary");
597                  }
598              }
599          }
600          [Test]
601          public void PaletteView()
602          {
603              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
604              {
605                  p.Add(x => x.ViewMode, ColorPickerView.Palette);
606                  p.Add(x => x.Palette, _mudGridPaletteDefaultClors);
607              });
608              var expectedColors = _mudGridPaletteDefaultClors;
609              var collectionView = comp.Find(".mud-picker-color-view-collection");
610              collectionView.Children.Should().HaveCount(expectedColors.Length);
611              for (var i = 0; i < collectionView.Children.Length; i++)
612              {
613                  var expectedColor = expectedColors[i];
614                  var colorElement = collectionView.Children[i];
615                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
616                  var style = colorElement.GetAttribute("style");
617                  style.Should().Be($"background: {expectedColor.ToString(MudColorOutputFormats.RGBA)};");
618              }
619          }
620          [Test]
621          public void PaletteView_ChooseColor()
622          {
623              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
624              {
625                  p.Add(x => x.ViewMode, ColorPickerView.Palette);
626                  p.Add(x => x.Palette, _mudGridPaletteDefaultClors);
627              });
628              var expectedColors = _mudGridPaletteDefaultClors;
629              var collectionView = comp.Find(".mud-picker-color-view-collection");
630              for (var i = 0; i < collectionView.Children.Length; i++)
631              {
632                  var expectedColor = expectedColors[i];
633                  var colorElement = collectionView.Children[i];
634                  colorElement.Click();
635                  comp.Instance.ColorValue.Should().Be(expectedColor);
636                  comp.Find(".mud-picker-color-view-collection").Children[i].ClassList.Should().BeEquivalentTo("mud-picker-color-dot", "selected");
637              }
638          }
639          [Test]
640          public void GridView()
641          {
642              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
643              {
644                  p.Add(x => x.ViewMode, ColorPickerView.Grid);
645              });
646              var expectedColors = _mudGridDefaultColors;
647              var collectionView = comp.Find(".mud-picker-color-grid");
648              collectionView.Children.Should().HaveCount(expectedColors.Length);
649              for (var i = 0; i < collectionView.Children.Length; i++)
650              {
651                  var expectedColor = expectedColors[i];
652                  var colorElement = collectionView.Children[i];
653                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
654                  var style = colorElement.GetAttribute("style");
655                  style.Should().Be($"background: {expectedColor.ToString(MudColorOutputFormats.RGBA)};");
656              }
657          }
658          [Test]
659          public void GridView_ChooseColor()
660          {
661              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
662              {
663                  p.Add(x => x.ViewMode, ColorPickerView.Grid);
664              });
665              var expectedColors = _mudGridDefaultColors;
666              var collectionView = comp.Find(".mud-picker-color-grid");
667              for (var i = 0; i < collectionView.Children.Length; i++)
668              {
669                  var expectedColor = expectedColors[i];
670                  var colorElement = collectionView.Children[i];
671                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
672                  colorElement.Click();
673                  comp.Instance.ColorValue.Should().Be(expectedColor);
674                  comp.Find(".mud-picker-color-grid").Children[i].ClassList.Should().BeEquivalentTo("mud-picker-color-dot", "selected");
675              }
676          }
677          [Test]
678          public void GridCompactView()
679          {
680              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
681              {
682                  p.Add(x => x.ViewMode, ColorPickerView.GridCompact);
683              });
684              var expectedColors = _mudGridDefaultColors;
685              var content = comp.Find(".mud-picker-content.mud-picker-color-content");
686              content.Children.Should().ContainSingle();
687              var gridView = comp.Find(".mud-picker-color-grid");
688              gridView.Children.Should().HaveCount(expectedColors.Length);
689              for (var i = 0; i < gridView.Children.Length; i++)
690              {
691                  var expectedColor = expectedColors[i];
692                  var colorElement = gridView.Children[i];
693                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
694                  var style = colorElement.GetAttribute("style");
695                  style.Should().Be($"background: {expectedColor.ToString(MudColorOutputFormats.RGBA)};");
696              }
697          }
698          [Test]
699          public void GridCompactView_ChooseColor()
700          {
701              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
702              {
703                  p.Add(x => x.ViewMode, ColorPickerView.GridCompact);
704              });
705              var expectedColors = _mudGridDefaultColors;
706              var gridView = comp.Find(".mud-picker-color-grid");
707              gridView.Children.Should().HaveCount(expectedColors.Length);
708              for (var i = 0; i < gridView.Children.Length; i++)
709              {
710                  var expectedColor = expectedColors[i];
711                  var colorElement = gridView.Children[i];
712                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
713                  colorElement.Click();
714                  comp.WaitForAssertion(() => comp.Instance.ColorValue.Should().Be(expectedColor));
715                  comp.Find(".mud-picker-color-grid").Children[i].ClassList.Should().BeEquivalentTo("mud-picker-color-dot", "selected");
716              }
717          }
718          [Test]
719          [TestCase(PickerVariant.Inline)]
720          [TestCase(PickerVariant.Dialog)]
721          public async Task GridCompact_CloseOnSelect(PickerVariant variant)
722          {
723              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
724              {
725                  p.Add(x => x.ViewMode, ColorPickerView.GridCompact);
726                  p.Add(x => x.Variant, variant);
727              });
728              await comp.Instance.OpenPicker();
729              var expectedColors = _mudGridDefaultColors;
730              var gridView = comp.Find(".mud-picker-color-grid");
731              gridView.Children[0].Click();
732              comp.Instance.ColorValue.Should().Be(expectedColors[0]);
733              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-container"));
734          }
735          [Test]
736          [TestCase(PickerVariant.Inline)]
737          [TestCase(PickerVariant.Dialog)]
738          public async Task Palette_CloseOnSelect(PickerVariant variant)
739          {
740              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
741              {
742                  p.Add(x => x.ViewMode, ColorPickerView.Palette);
743                  p.Add(x => x.Variant, variant);
744                  p.Add(x => x.Palette, _mudGridPaletteDefaultClors);
745              });
746              await comp.Instance.OpenPicker();
747              var expectedColors = _mudGridPaletteDefaultClors;
748              var gridView = comp.Find(".mud-picker-color-view-collection");
749              gridView.Children[0].Click();
750              comp.Instance.ColorValue.Should().Be(expectedColors[0]);
751              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-container"));
752          }
753          [Test]
754          [TestCase(PickerVariant.Inline, ColorPickerView.Grid)]
755          [TestCase(PickerVariant.Dialog, ColorPickerView.Grid)]
756          [TestCase(PickerVariant.Inline, ColorPickerView.Spectrum)]
757          [TestCase(PickerVariant.Dialog, ColorPickerView.Spectrum)]
758          public async Task NoControls_CloseOnSelect(PickerVariant variant, ColorPickerView view)
759          {
760              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
761              {
762                  p.Add(x => x.ViewMode, view);
763                  p.Add(x => x.Variant, variant);
764                  p.Add(x => x.DisablePreview, true);
765                  p.Add(x => x.DisableSliders, true);
766                  p.Add(x => x.DisableInput, true);
767              });
768              await comp.Instance.OpenPicker();
769              var expectedColors = view == ColorPickerView.Grid ? _mudGridDefaultColors : _mudGridPaletteDefaultClors;
770              IElement item;
771              if (view == ColorPickerView.Grid)
772              {
773                  item = comp.Find(".mud-picker-color-grid").Children[0];
774              }
775              else
776              {
777                  item = comp.Find("[class=\"mud-picker-color-overlay\"][id]");
778              }
779              item.Click();
780              comp.Instance.ColorValue.Should().NotBe(_defaultColor);
781              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-container"));
782          }
783          [Test]
784          [TestCase(ColorPickerView.Spectrum, false, "#78797aff")]
785          [TestCase(ColorPickerView.Grid, false, "#78797aff")]
786          [TestCase(ColorPickerView.Palette, false, "#78797a")]
787          [TestCase(ColorPickerView.GridCompact, false, "#78797a")]
788          [TestCase(ColorPickerView.Spectrum, true, "#78797a")]
789          [TestCase(ColorPickerView.Grid, true, "#78797a")]
790          [TestCase(ColorPickerView.Palette, true, "#78797a")]
791          [TestCase(ColorPickerView.GridCompact, true, "#78797a")]
792          public void TextOutput_Alpha(ColorPickerView view, bool disableAlpha, string expectedOutput)
793          {
794              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
795              {
796                  p.Add(x => x.ViewMode, view);
797                  p.Add(x => x.DisableAlpha, disableAlpha);
798                  p.Add(x => x.ColorValue, new MudColor(120, 121, 122, 1.0));
799              });
800              comp.Instance.TextValue.Should().Be(expectedOutput);
801          }
802          [Test]
803          public void SetNullColor_NothingChanged()
804          {
805              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
806              {
807                  p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL);
808              });
809              comp.SetParametersAndRender(p => p.Add(x => x.ColorValue, null));
810              var lColor = GetColorInput(comp, 2);
811              var expectedColor = _defaultColor;
812              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, expectedColor, ColorPickerMode.HSL, false);
813              comp.FindComponent<MudColorPicker>().Instance.Value.Should().Be(_defaultColor);
814          }
815          [Test]
816          public void SetHLS_NotChangeRBG_ButCallbackFired()
817          {
818              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
819              {
820                  p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL);
821                  p.Add(x => x.AlwaysUpdateBinding, true);
822                  p.Add(x => x.ColorValue, new MudColor(245, 0.35, 0.95, 1.0));
823              });
824              var sColor = GetColorInput(comp, 1);
825              var colorValue = comp.Instance.ColorValue.ToString(MudColorOutputFormats.HexA);
826              CheckColorRelatedValues(comp, 11.37, 7.84, comp.Instance.ColorValue, ColorPickerMode.HSL);
827              var expectedColor = comp.Instance.ColorValue.SetS(comp.Instance.ColorValue.S - 0.01);
828              sColor.Change(expectedColor.S.ToString(CultureInfo.CurrentUICulture));
829              CheckColorRelatedValues(comp, 11.37, 7.84, expectedColor, ColorPickerMode.HSL);
830              var colorValueAfterChange = comp.Instance.ColorValue.ToString(MudColorOutputFormats.HexA);
831              colorValue.Should().Be(colorValueAfterChange);
832              comp.Instance.ValueChangeCallbackCounter.Should().Be(1);
833          }
834          [Test]
835          public void RTL_AlphaSliderInverseStyle()
836          {
837              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
838              {
839                  p.AddCascadingValue("RightToLeft", true);
840              });
841              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, comp.Instance.ColorValue, ColorPickerMode.RGB, true, true);
842          }
843          [Test]
844          public void AddAndRemoveEventListenerWhenChangingColorPickerView()
845          {
846              var comp = Context.RenderComponent<MudColorPicker>(p =>
847              {
848                  p.Add(x => x.DisableToolbar, false);
849                  p.Add(x => x.PickerVariant, PickerVariant.Static);
850                  p.Add(x => x.ColorPickerView, ColorPickerView.Spectrum);
851              });
852              var buttons = comp.FindAll(_mudToolbarButtonsCssSelector);
853              _eventListener.ElementIdMapper.Keys.Should().ContainSingle();
854              var value = _eventListener.ElementIdMapper.Values.First();
855              buttons[2].Click();
856              _eventListener.ElementIdMapper.Keys.Should().BeEmpty();
857              buttons[1].Click();
858              _eventListener.ElementIdMapper.Keys.Should().BeEmpty();
859              buttons[0].Click();
860              _eventListener.ElementIdMapper.Keys.Should().ContainSingle();
861              _eventListener.ElementIdMapper.Values.First().Should().Be(value);
862          }
863          [Test]
864          public void EventListenerNotAttachedWhenEnableDragEffectIsDisabled()
865          {
866              var comp = Context.RenderComponent<MudColorPicker>(p =>
867              {
868                  p.Add(x => x.DisableToolbar, false);
869                  p.Add(x => x.PickerVariant, PickerVariant.Static);
870                  p.Add(x => x.ColorPickerView, ColorPickerView.Spectrum);
871                  p.Add(x => x.DisableDragEffect, true);
872              });
873              var buttons = comp.FindAll(_mudToolbarButtonsCssSelector);
874              _eventListener.ElementIdMapper.Keys.Should().BeEmpty();
875              for (var i = 3 - 1; i >= 0; i--)
876              {
877                  buttons[i].Click();
878                  _eventListener.ElementIdMapper.Keys.Should().BeEmpty();
879              }
880          }
881          [Test]
882          public void StableHue_WhenColorSpectrumClicked()
883          {
884              var comp = Context.RenderComponent<MudColorPicker>(p =>
885              {
886                  p.Add(x => x.PickerVariant, PickerVariant.Static);
887                  p.Add(x => x.ColorPickerView, ColorPickerView.Spectrum);
888              });
889              var overlay = comp.Find(CssSelector);
890              double expectedHue = _defaultColor.H;
891              for (int x = 0; x < 312; x += 5)
892              {
893                  for (int y = 0; y < 250; y += 5)
894                  {
895                      overlay.Click(new MouseEventArgs { OffsetX = x, OffsetY = y });
896                      comp.Instance.Value.H.Should().Be(expectedHue);
897                  }
898              }
899          }
900          [Test]
901          public void Click_Selector_ColorPanel()
902          {
903              var comp = Context.RenderComponent<SimpleColorPickerTest>();
904              var overlay = comp.Find(CssSelector);
905              var x = 99.2;
906              var y = 200.98;
907              overlay.Click(new MouseEventArgs { OffsetX = x, OffsetY = y });
908              MudColor color = "#232232ff";
909              MudColor expectedColor = new MudColor(color.R, color.G, color.B, _defaultColor);
910              CheckColorRelatedValues(comp, x, y, expectedColor, ColorPickerMode.RGB);
911              var selector = comp.Find(".mud-picker-color-selector");
912              selector.Click(new MouseEventArgs { OffsetX = 13, OffsetY = 13 });
913              CheckColorRelatedValues(comp, x, y, expectedColor, ColorPickerMode.RGB);
914              selector.Click(new MouseEventArgs { OffsetX = 5, OffsetY = 20 });
915              MudColor secondExpectedColor = new MudColor(31, 30, 42, _defaultColor);
916              CheckColorRelatedValues(comp, x - 8, y + 7, secondExpectedColor, ColorPickerMode.RGB);
917          }
918          [Test]
919          public async Task CheckPickerPopover()
920          {
921              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
922              {
923                  p.Add(x => x.Variant, PickerVariant.Inline);
924              });
925              await comp.Instance.OpenPicker();
926              var providerNode = comp.Find(".mud-popover-provider");
927              providerNode.Children.Should().ContainSingle();
928              var popoverNode = providerNode.Children[0];
929              popoverNode.ClassList.Should().BeEquivalentTo(new[]
930              {
931                  "mud-popover",
932                  "mud-popover-fixed",
933                  "mud-popover-open",
934                  "mud-popover-top-left",
935                  "mud-popover-anchor-top-left",
936                  "mud-popover-overflow-flip-onopen",
937              });
938          }
939          [Test]
940          public void DistingishBetweenInternalAndExternalView()
941          {
942              var comp = Context.RenderComponent<PickerWithFixedView>();
943              var inputField = comp.Find(".mud-input-slot");
944              inputField.Click();
945              var grid = comp.Find(".mud-picker-color-grid");
946              var spectrumButton = comp.FindAll(_mudToolbarButtonsCssSelector)[1];
947              spectrumButton.Click();
948              var overlay = comp.Find(CssSelector);
949              overlay.Click(new MouseEventArgs { OffsetX = 10.5, OffsetY = 10.5 });
950              _ = comp.Find(".mud-picker-color-overlay");
951              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-grid"));
952              comp.SetParametersAndRender(x => x.Add(y => y.ColorPickerView, ColorPickerView.GridCompact));
953              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-overlay"));
954              _ = comp.Find(".mud-picker-color-grid");
955          }
956          [Test]
957          public void ColorPickerValueShouldUpdateOnTextTest()
958          {
959              var comp = Context.RenderComponent<MudColorPicker>(parameters => parameters
960              .Add(x => x.Editable, true));
961              comp.Find("input").Change("#180f6fff");
962              comp.Instance.Text.Should().Be("#180f6fff");
963              comp.Instance.Value.Should().Be(new MudColor("#180f6fff"));
964          }
965      }
966  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-ColorPickerTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  #pragma warning disable IDE1006 
3  using System;
4  using System.Collections.Generic;
5  using System.Globalization;
6  using System.Linq;
7  using System.Threading.Tasks;
8  using AngleSharp.Dom;
9  using AngleSharp.Html.Dom;
10  using Bunit;
11  using FluentAssertions;
12  using Microsoft.AspNetCore.Components.Web;
13  using Microsoft.Extensions.DependencyInjection;
14  using MudBlazor.UnitTests.Mocks;
15  using MudBlazor.UnitTests.TestComponents;
16  using MudBlazor.UnitTests.TestComponents.ColorPicker;
17  using MudBlazor.Utilities;
18  using NUnit.Framework;
19  namespace MudBlazor.UnitTests.Components
20  {
21      [TestFixture]
22      public class ColorPickerTests : BunitTest
23      {
24          private const double _defaultXForColorPanel = 209.84;
25          private const double _defaultYForColorPanel = 28.43;
26          private static MudColor _defaultColor = "#594ae2";
27          private const string _hueSliderCssSelector = ".mud-slider.mud-picker-color-slider.hue input";
28          private const string _alphaSliderCssSelector = ".mud-picker-color-slider.alpha input";
29          private const string _colorDotCssSelector = ".mud-picker-color-fill";
30          private const string _toolbarCssSelector = ".mud-toolbar";
31          private const string _mudColorPickerCssSelector = ".mud-picker-color-picker";
32          private const string _slidersControlCssSelector = ".mud-picker-color-sliders";
33          private const string _colorInputCssSelector = ".mud-picker-color-inputs";
34          private const string _colorInputModeSwitchCssSelector = ".mud-picker-control-switch";
35          private const string _alphaInputCssSelector = ".input-field-alpha";
36          private const string CssSelector = ".mud-picker-color-overlay-black .mud-picker-color-overlay";
37          private const string _mudToolbarButtonsCssSelector = ".mud-toolbar button";
38          private static MudColor[] _mudGridDefaultColors = new MudColor[]
39                          {
40                  "#FFFFFF","#ebebeb","#d6d6d6","#c2c2c2","#adadad","#999999","#858586","#707070","#5c5c5c","#474747","#333333","#000000",
41                  "#133648","#071d53","#0f0638","#2a093b","#370c1b","#541107","#532009","#53350d","#523e0f","#65611b","#505518","#2b3d16",
42                  "#1e4c63","#0f2e76","#180b4e","#3f1256","#4e1629","#781e0e","#722f10","#734c16","#73591a","#8c8629","#707625","#3f5623",
43                  "#2e6c8c","#1841a3","#280c72","#591e77","#6f223d","#a62c17","#a0451a","#a06b23","#9f7d28","#c3bc3c","#9da436","#587934",
44                  "#3c8ab0","#2155ce","#331c8e","#702898","#8d2e4f","#d03a20","#ca5a24","#c8862e","#c99f35","#f3ec4e","#c6d047","#729b44",
45                  "#479fd3","#2660f5","#4725ab","#8c33b5","#aa395d","#eb512e","#ed732e","#f3ae3d","#f5c944","#fefb67","#ddeb5c","#86b953",
46                  "#59c4f7","#4e85f6","#5733e2","#af43eb","#d44a7a","#ed6c59","#ef8c56","#f3b757","#f6cd5b","#fef881","#e6ee7a","#a3d16e",
47                  "#78d3f8","#7fa6f8","#7e52f5","#c45ff6","#de789d","#f09286","#f2a984","#f6c983","#f9da85","#fef9a1","#ebf29b","#badc94",
48                  "#a5e1fa","#adc5fa","#ab8df7","#d696f8","#e8a7bf","#f4b8b1","#f6c7af","#f9daae","#fae5af","#fefbc0","#f3f7be","#d2e7ba",
49                  "#d2effd","#d6e1fc","#d6c9fa","#e9cbfb","#f3d4df","#f9dcd9","#fae3d8","#fcecd7","#fdf2d8","#fefce0","#f7fade","#e3edd6"
50                          };
51          private static MudColor[] _mudGridPaletteDefaultClors = new MudColor[]
52                  {
53                     "#424242", "#2196f3", "#00c853", "#ff9800", "#f44336",
54                    "#f6f9fb", "#9df1fa", "#bdffcf", "#fff0a3", "#ffd254",
55                    "#e6e9eb", "#27dbf5", "#7ef7a0", "#ffe273", "#ffb31f",
56                    "#c9cccf", "#13b8e8", "#14dc71", "#fdd22f", "#ff9102",
57                    "#858791", "#0989c2", "#1bbd66", "#ebb323", "#fe6800",
58                    "#585b62", "#17698e", "#17a258", "#d9980d", "#dc3f11",
59                    "#353940", "#113b53", "#127942", "#bf7d11", "#aa0000"
60                  };
61          private MockEventListener _eventListener;
62          public override void Setup()
63          {
64              _eventListener = new MockEventListener();
65              base.Setup();
66              Context.Services.AddSingleton<IEventListenerFactory>(new MockEventListenerFactory(_eventListener));
67          }
68          private void CheckColorRelatedValues(IRenderedComponent<SimpleColorPickerTest> comp, double expectedX, double expectedY, MudColor expectedColor, ColorPickerMode mode, bool checkInstanceValue = true, bool isRtl = false)
69          {
70              if (checkInstanceValue == true)
71              {
72                  comp.Instance.ColorValue.Should().Be(expectedColor);
73              }
74              if (mode is ColorPickerMode.RGB or ColorPickerMode.HSL)
75              {
76                  var castedInputs = GetColorInputs(comp);
77                  if (mode == ColorPickerMode.RGB)
78                  {
79                      castedInputs[0].Value.Should().Be(expectedColor.R.ToString());
80                      castedInputs[1].Value.Should().Be(expectedColor.G.ToString());
81                      castedInputs[2].Value.Should().Be(expectedColor.B.ToString());
82                      castedInputs[3].Value.Should().Be(expectedColor.APercentage.ToString(CultureInfo.CurrentUICulture));
83                  }
84                  else
85                  {
86                      castedInputs[0].Value.Should().Be(expectedColor.H.ToString(CultureInfo.CurrentUICulture));
87                      castedInputs[1].Value.Should().Be(expectedColor.S.ToString(CultureInfo.CurrentUICulture));
88                      castedInputs[2].Value.Should().Be(expectedColor.L.ToString(CultureInfo.CurrentUICulture));
89                      castedInputs[3].Value.Should().Match(x => double.Parse(x, CultureInfo.CurrentUICulture) == Math.Round((expectedColor.A / 255.0), 2));
90                  }
91              }
92              else if (mode == ColorPickerMode.HEX)
93              {
94                  var castedInputs = GetColorInputs(comp, 1);
95                  castedInputs[0].Value.Should().Be(expectedColor.Value);
96              }
97              var selector = comp.Find(".mud-picker-color-selector");
98              selector.Should().NotBeNull();
99              var selectorStyleAttribute = selector.GetAttribute("style");
100              selectorStyleAttribute.Should().Be($"transform: translate({expectedX.ToString(CultureInfo.InvariantCulture)}px, {expectedY.ToString(CultureInfo.InvariantCulture)}px);");
101              var hueSlideValue = comp.FindAll(".mud-picker-color-slider.hue input");
102              hueSlideValue.Should().ContainSingle();
103              hueSlideValue[0].Should().BeAssignableTo<IHtmlInputElement>();
104              ((IHtmlInputElement)hueSlideValue[0]).Value.Should().Be(((int)expectedColor.H).ToString());
105              var alphaSlider = comp.FindAll(_alphaSliderCssSelector);
106              alphaSlider.Should().ContainSingle();
107              alphaSlider[0].Should().BeAssignableTo<IHtmlInputElement>();
108              ((IHtmlInputElement)alphaSlider[0]).Value.Should().Be(((int)expectedColor.A).ToString());
109              var alphaSliderStyleAttritbute = ((IHtmlElement)alphaSlider[0].Parent.Parent).GetAttribute("style");
110              if (isRtl == false)
111              {
112                  alphaSliderStyleAttritbute.Should().Be($"background-image: linear-gradient(to right, transparent, {expectedColor.ToString(MudColorOutputFormats.RGB)});");
113              }
114              else
115              {
116                  alphaSliderStyleAttritbute.Should().Be($"background-image: linear-gradient(to left, transparent, {expectedColor.ToString(MudColorOutputFormats.RGB)});");
117              }
118          }
119          private IHtmlInputElement[] GetColorInputs(IRenderedComponent<SimpleColorPickerTest> comp, int expectedCount = 4)
120          {
121              var inputs = comp.FindAll(".mud-picker-color-inputs input");
122              inputs.Should().AllBeAssignableTo<IHtmlInputElement>();
123              inputs.Should().HaveCount(expectedCount);
124              var castedInputs = inputs.Cast<IHtmlInputElement>().ToArray();
125              return castedInputs;
126          }
127          private IHtmlInputElement GetColorInput(IRenderedComponent<SimpleColorPickerTest> comp, int index, int expectedCount = 4) => GetColorInputs(comp, expectedCount)[index];
128          [Test]
129          public void ColorPickerOpenButtonAriaLabel()
130          {
131              var comp = Context.RenderComponent<MudColorPicker>();
132              var openButton = comp.Find(".mud-input-adornment button");
133              openButton.Attributes.GetNamedItem("aria-label")?.Value.Should().Be("Open Color Picker");
134          }
135          [Test]
136          public async Task Default()
137          {
138              var comp = Context.RenderComponent<MudColorPicker>();
139              comp.Instance.DisableAlpha.Should().BeFalse();
140              comp.Instance.DisableColorField.Should().BeFalse();
141              comp.Instance.DisableModeSwitch.Should().BeFalse();
142              comp.Instance.DisableInputs.Should().BeFalse();
143              comp.Instance.DisableSliders.Should().BeFalse();
144              comp.Instance.DisablePreview.Should().BeFalse();
145              comp.Instance.ColorPickerMode.Should().Be(ColorPickerMode.RGB);
146              comp.Instance.ColorPickerView.Should().Be(ColorPickerView.Spectrum);
147              comp.Instance.UpdateBindingIfOnlyHSLChanged.Should().BeFalse();
148              comp.Instance.Value.Should().Be(_defaultColor);
149              comp.Instance.Palette.Should().BeEquivalentTo(_mudGridPaletteDefaultClors);
150              comp.Instance.DisableDragEffect.Should().BeFalse();
151          }
152          [Test]
153          [TestCase(40, 256.78, _defaultYForColorPanel)]
154          public void SetR(byte r, double selectorXPosition, double selectorYPosition)
155          {
156              var comp = Context.RenderComponent<SimpleColorPickerTest>();
157              var rInput = GetColorInput(comp, 0);
158              var expectedColor = comp.Instance.ColorValue.SetR(r);
159              rInput.Change(expectedColor.R.ToString());
160              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.RGB);
161          }
162          [Test]
163          [TestCase(240, 196.3, 14.71)]
164          public void SetG(byte g, double selectorXPosition, double selectorYPosition)
165          {
166              var comp = Context.RenderComponent<SimpleColorPickerTest>();
167              var gInput = GetColorInput(comp, 1);
168              var expectedColor = comp.Instance.ColorValue.SetG(g);
169              gInput.Change(expectedColor.G.ToString());
170              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.RGB);
171          }
172          [Test]
173          [TestCase(90, 55.47, 161.76)]
174          public void SetB(byte b, double selectorXPosition, double selectorYPosition)
175          {
176              var comp = Context.RenderComponent<SimpleColorPickerTest>();
177              var bInput = GetColorInput(comp, 2);
178              var expectedColor = comp.Instance.ColorValue.SetB(b);
179              bInput.Change(expectedColor.B.ToString());
180              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.RGB);
181          }
182          [Test]
183          [TestCase(0.9, _defaultXForColorPanel, _defaultYForColorPanel)]
184          public void SetA_InRGBMode(double a, double selectorXPosition, double selectorYPosition)
185          {
186              var comp = Context.RenderComponent<SimpleColorPickerTest>();
187              var aInput = GetColorInput(comp, 3);
188              var expectedColor = comp.Instance.ColorValue.SetAlpha(a);
189              aInput.Change(a.ToString(CultureInfo.CurrentUICulture));
190              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.RGB);
191          }
192          [Test]
193          [TestCase(90, 208.46, _defaultYForColorPanel)]
194          public void SetH(int h, double selectorXPosition, double selectorYPosition)
195          {
196              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL));
197              var hInput = GetColorInput(comp, 0);
198              var expectedColor = comp.Instance.ColorValue.SetH(h);
199              hInput.Change(expectedColor.H.ToString());
200              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HSL);
201          }
202          [Test]
203          [TestCase(0.4, 134.88, 61.76)]
204          public void SetS(double s, double selectorXPosition, double selectorYPosition)
205          {
206              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL));
207              var sColor = GetColorInput(comp, 1);
208              var expectedColor = comp.Instance.ColorValue.SetS(s);
209              sColor.Change(expectedColor.S.ToString(CultureInfo.CurrentUICulture));
210              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HSL);
211          }
212          [Test]
213          [TestCase(0.67, 163.43, 23.53)]
214          public void SetL(double l, double selectorXPosition, double selectorYPosition)
215          {
216              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL));
217              var lColor = GetColorInput(comp, 2);
218              var expectedColor = comp.Instance.ColorValue.SetL(l);
219              lColor.Change(expectedColor.L.ToString(CultureInfo.CurrentUICulture));
220              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HSL);
221          }
222          [Test]
223          [TestCase(0.5, _defaultXForColorPanel, _defaultYForColorPanel)]
224          public void SetAlpha_AsHLS(double a, double selectorXPosition, double selectorYPosition)
225          {
226              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL));
227              var lColor = GetColorInput(comp, 3);
228              var expectedColor = comp.Instance.ColorValue.SetAlpha(a);
229              lColor.Change(a.ToString(CultureInfo.CurrentUICulture));
230              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HSL);
231          }
232          [Test]
233          [TestCase("#8cb829ff", 242.48, 69.61)]
234          public void SetColorInput(string colorHexString, double selectorXPosition, double selectorYPosition)
235          {
236              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HEX));
237              var inputs = comp.FindAll(".mud-picker-color-inputs input");
238              var lColor = GetColorInput(comp, 0, 1);
239              var expectedColor = colorHexString;
240              lColor.Change(colorHexString);
241              CheckColorRelatedValues(comp, selectorXPosition, selectorYPosition, expectedColor, ColorPickerMode.HEX);
242          }
243          [Test]
244          [TestCase("#8qb829ff")]
245          public void SetColorInput_InvalidNoChange(string colorHexString)
246          {
247              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.ColorPickerMode, ColorPickerMode.HEX));
248              var inputs = comp.FindAll(".mud-picker-color-inputs input");
<span onclick='openModal()' class='match'>249              var hexInput = GetColorInput(comp, 0, 1);
250              var expectedColor = _defaultColor;
251              hexInput.Change(colorHexString);
252              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, expectedColor, ColorPickerMode.HEX);
253          }
254          [Test]
255          public void SetAlphaSlider()
</span>256          {
257              var comp = Context.RenderComponent<SimpleColorPickerTest>();
258              for (var i = 256 - 1; i >= 0; i--)
259              {
260                  var expectedColor = comp.Instance.ColorValue.SetAlpha((byte)i);
261                  var hueColerSlider = comp.FindAll(_alphaSliderCssSelector);
262                  hueColerSlider.Should().ContainSingle();
263                  hueColerSlider[0].Should().BeAssignableTo<IHtmlInputElement>();
264                  InputEventDispatchExtensions.Input(hueColerSlider[0], i.ToString());
265                  CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, expectedColor, ColorPickerMode.RGB);
266              }
267          }
268          [Test]
269          public void MouseMove()
270          {
271              var comp = Context.RenderComponent<SimpleColorPickerTest>();
272              var args = new MouseEventArgs
273              {
274                  OffsetX = 117.0,
275                  OffsetY = 140.0,
276                  Buttons = 1,
277              };
278              _eventListener.FireEvent(args);
279              var expectedColor = new MudColor(74, 70, 112, 255);
280              CheckColorRelatedValues(comp, args.OffsetX, args.OffsetY, expectedColor, ColorPickerMode.RGB);
281              var argsWithoutLeftButtonPushed = new MouseEventArgs
282              {
283                  OffsetX = 117.0,
284                  OffsetY = 140.0,
285                  Buttons = 0,
286              };
287              _eventListener.FireEvent(argsWithoutLeftButtonPushed);
288              CheckColorRelatedValues(comp, args.OffsetX, args.OffsetY, expectedColor, ColorPickerMode.RGB);
289          }
290          [Test]
291          [TestCase(PickerVariant.Dialog)]
292          [TestCase(PickerVariant.Inline)]
293          public async Task MouseMove_InDialogMode(PickerVariant variant)
294          {
295              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(y =>
296              y.Variant, variant));
297              var args = new MouseEventArgs
298              {
299                  OffsetX = 117.0,
300                  OffsetY = 140.0,
301                  Buttons = 1,
302              };
303              _eventListener.Callbacks.Values.Should().BeEmpty();
304              await comp.Instance.OpenPicker();
305              _eventListener.Callbacks.Values.Should().ContainSingle();
306              _eventListener.FireEvent(args);
307              var expectedColor = new MudColor(74, 70, 112, 255);
308              CheckColorRelatedValues(comp, args.OffsetX, args.OffsetY, expectedColor, ColorPickerMode.RGB);
309              var argsWithoutLeftButtonPushed = new MouseEventArgs
310              {
311                  OffsetX = 117.0,
312                  OffsetY = 140.0,
313                  Buttons = 0,
314              };
315              _eventListener.FireEvent(argsWithoutLeftButtonPushed);
316              CheckColorRelatedValues(comp, args.OffsetX, args.OffsetY, expectedColor, ColorPickerMode.RGB);
317              await comp.Instance.ClosePicker();
318              _eventListener.Callbacks.Should().BeEmpty();
319          }
320          [Test]
321          public void SetHueSlider()
322          {
323              var comp = Context.RenderComponent<SimpleColorPickerTest>();
324              for (var i = 0; i <= 360; i++)
325              {
326                  var expectedColor = comp.Instance.ColorValue.SetH(i);
327                  var hueColorSlider = comp.FindAll(_hueSliderCssSelector);
328                  hueColorSlider.Should().ContainSingle();
329                  hueColorSlider[0].Should().BeAssignableTo<IHtmlInputElement>();
330                  InputEventDispatchExtensions.Input(hueColorSlider[0], i.ToString());
331                  CheckColorRelatedValues(comp, 208.46, _defaultYForColorPanel, expectedColor, ColorPickerMode.RGB);
332              }
333          }
334          [Test]
335          public void Click_ColorPanel()
336          {
337              var comp = Context.RenderComponent<SimpleColorPickerTest>();
338              var overlay = comp.Find(CssSelector);
339              var x = 99.2;
340              var y = 200.98;
341              overlay.Click(new MouseEventArgs { OffsetX = x, OffsetY = y });
342              MudColor color = "#232232ff";
343              MudColor expectedColor = new MudColor(color.R, color.G, color.B, _defaultColor);
344              CheckColorRelatedValues(comp, x, y, expectedColor, ColorPickerMode.RGB);
345          }
346          [Test]
347          public void Click_ModeButton()
348          {
349              var comp = Context.RenderComponent<SimpleColorPickerTest>();
350              var color = comp.Instance.ColorValue;
351              var modeButton = comp.Find(".mud-picker-control-switch button");
352              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, color, ColorPickerMode.RGB);
353              modeButton.Click();
354              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, color, ColorPickerMode.HSL);
355              modeButton.Click();
356              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, color, ColorPickerMode.HEX);
357              modeButton.Click();
358              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, color, ColorPickerMode.RGB);
359          }
360          [Test]
361          public void ColorPalette_Interaction()
362          {
363              var comp = Context.RenderComponent<SimpleColorPickerTest>();
364              var colorDot = comp.Find(_colorDotCssSelector);
365              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-collection"));
366              colorDot.Click();
367              var colorsToSelectPanel = comp.Find(".mud-picker-color-collection");
368              colorsToSelectPanel.Children.Should().HaveCount(5);
369              var expectedColors = new MudColor[] { "#ff4081ff", "#2196f3ff", "#00c853ff", "#ff9800ff", "#f44336ff" };
370              for (var i = 0; i < 5; i++)
371              {
372                  var styleAttribute = colorsToSelectPanel.Children[i].GetAttribute("style");
373                  styleAttribute.Should().Be($"background: {expectedColors[i].ToString(MudColorOutputFormats.RGBA)};");
374              }
375              colorDot.Click();
376              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-collection"));
377          }
378          [Test]
379          public void ColorPalette_CustomColors()
380          {
381              var expectedColors = new MudColor[] { "#23af3daa", "#56a23dff", "#56a85dff" };
382              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.Palette, expectedColors));
383              var colorDot = comp.Find(_colorDotCssSelector);
384              colorDot.Click();
385              var colorsToSelectPanel = comp.Find(".mud-picker-color-collection");
386              colorsToSelectPanel.Children.Should().HaveCount(expectedColors.Length);
387              for (var i = 0; i < expectedColors.Length; i++)
388              {
389                  var styleAttribute = colorsToSelectPanel.Children[i].GetAttribute("style");
390                  styleAttribute.Should().Be($"background: {expectedColors[i].ToString(MudColorOutputFormats.RGBA)};");
391              }
392          }
393          [Test]
394          public void ColorPalette_SelectColor()
395          {
396              var comp = Context.RenderComponent<SimpleColorPickerTest>();
397              var colorDot = comp.Find(_colorDotCssSelector);
398              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-collection"));
399              colorDot.Click();
400              var expectedColors = new MudColor[] { "#ff4081ff", "#2196f3ff", "#00c853ff", "#ff9800ff", "#f44336ff" };
401              for (var i = 0; i < 5; i++)
402              {
403                  var colorsToSelectPanel = comp.Find(".mud-picker-color-collection");
404                  colorsToSelectPanel.Children[i].Click();
405                  colorDot = comp.Find(_colorDotCssSelector);
406                  var styleAttribute = colorDot.GetAttribute("style");
407                  styleAttribute.Should().Be($"background: {expectedColors[i].ToString(MudColorOutputFormats.RGBA)};");
408                  comp.Instance.ColorValue.Should().Be(expectedColors[i]);
409                  colorDot.Click();
410              }
411          }
412          [Test]
413          public void Toggle_Toolbar()
414          {
415              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisableToolbar, false));
416              _ = comp.Find(_toolbarCssSelector);
417              comp.SetParametersAndRender(p => p.Add(x => x.DisableToolbar, true));
418              Assert.Throws<ElementNotFoundException>(() => comp.Find(_toolbarCssSelector));
419              comp.SetParametersAndRender(p => p.Add(x => x.DisableToolbar, false));
420              _ = comp.Find(_toolbarCssSelector);
421          }
422          [Test]
423          public void Toggle_ColorField()
424          {
425              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisableColorField, false));
426              _ = comp.Find(_mudColorPickerCssSelector);
427              comp.SetParametersAndRender(p => p.Add(x => x.DisableColorField, true));
428              Assert.Throws<ElementNotFoundException>(() => comp.Find(_mudColorPickerCssSelector));
429              comp.SetParametersAndRender(p => p.Add(x => x.DisableColorField, false));
430              _ = comp.Find(_mudColorPickerCssSelector);
431          }
432          [Test]
433          public void Toggle_Preview()
434          {
435              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisablePreview, false));
436              _ = comp.Find(_colorDotCssSelector);
437              comp.SetParametersAndRender(p => p.Add(x => x.DisablePreview, true));
438              Assert.Throws<ElementNotFoundException>(() => comp.Find(_colorDotCssSelector));
439              comp.SetParametersAndRender(p => p.Add(x => x.DisablePreview, false));
440              _ = comp.Find(_colorDotCssSelector);
441          }
442          [Test]
443          public void Toggle_Sliders()
444          {
445              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisableSliders, false));
446              _ = comp.Find(_slidersControlCssSelector);
447              comp.SetParametersAndRender(p => p.Add(x => x.DisableSliders, true));
448              Assert.Throws<ElementNotFoundException>(() => comp.Find(_slidersControlCssSelector));
449              comp.SetParametersAndRender(p => p.Add(x => x.DisableSliders, false));
450              _ = comp.Find(_slidersControlCssSelector);
451          }
452          [Test]
453          [TestCase(ColorPickerMode.HEX)]
454          [TestCase(ColorPickerMode.HSL)]
455          [TestCase(ColorPickerMode.RGB)]
456          public void Toggle_Input(ColorPickerMode mode)
457          {
458              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
459              {
460                  p.Add(x => x.ColorPickerMode, mode);
461                  p.Add(x => x.DisableInput, false);
462              });
463              _ = comp.Find(_colorInputCssSelector);
464              comp.SetParametersAndRender(p => p.Add(x => x.DisableInput, true));
465              Assert.Throws<ElementNotFoundException>(() => comp.Find(_colorInputCssSelector));
466              comp.SetParametersAndRender(p => p.Add(x => x.DisableInput, false));
467              _ = comp.Find(_colorInputCssSelector);
468          }
469          [Test]
470          public void Toggle_ModeSwitch()
471          {
472              var comp = Context.RenderComponent<SimpleColorPickerTest>(p => p.Add(x => x.DisableModeSwitch, false));
473              _ = comp.Find(_colorInputModeSwitchCssSelector);
474              comp.SetParametersAndRender(p => p.Add(x => x.DisableModeSwitch, true));
475              Assert.Throws<ElementNotFoundException>(() => comp.Find(_colorInputModeSwitchCssSelector));
476              comp.SetParametersAndRender(p => p.Add(x => x.DisableModeSwitch, false));
477              _ = comp.Find(_colorInputModeSwitchCssSelector);
478          }
479          [Test]
480          [TestCase(ColorPickerMode.HSL)]
481          [TestCase(ColorPickerMode.RGB)]
482          public void Toggle_Alpha(ColorPickerMode mode)
483          {
484              var color = new MudColor(12, 220, 124, 120);
485              var expectedColor = new MudColor(12, 220, 124, 120);
486              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
487              {
488                  p.Add(x => x.ColorPickerMode, mode);
489                  p.Add(x => x.DisableAlpha, false);
490                  p.Add(x => x.ColorValue, color);
491              });
492              _ = comp.Find(_alphaInputCssSelector);
493              comp.SetParametersAndRender(p => p.Add(x => x.DisableAlpha, true));
494              Assert.Throws<ElementNotFoundException>(() => comp.Find(_alphaInputCssSelector));
495              comp.Instance.ColorValue.Should().Be(expectedColor);
496              comp.Instance.TextValue.Should().Be(expectedColor.ToString(MudColorOutputFormats.Hex));
497              comp.SetParametersAndRender(p => p.Add(x => x.DisableAlpha, false));
498              _ = comp.Find(_alphaInputCssSelector);
499              comp.Instance.ColorValue.Should().Be(expectedColor);
500              comp.Instance.TextValue.Should().Be(expectedColor.ToString(MudColorOutputFormats.HexA));
501          }
502          [Test]
503          public void Toggle_Alpha_HexInputMode()
504          {
505              var color = new MudColor(12, 220, 124, 120);
506              var expectedColor = new MudColor(12, 220, 124, 120);
507              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
508              {
509                  p.Add(x => x.ColorPickerMode, ColorPickerMode.HEX);
510                  p.Add(x => x.DisableAlpha, false);
511                  p.Add(x => x.ColorValue, color);
512              });
513              Assert.Throws<ElementNotFoundException>(() => comp.Find(_alphaInputCssSelector));
514              comp.SetParametersAndRender(p => p.Add(x => x.DisableAlpha, true));
515              comp.Instance.ColorValue.Should().Be(expectedColor);
516              var inputs = comp.FindAll(".mud-picker-color-inputfield input");
517              inputs.Should().ContainSingle();
518              inputs.Should().AllBeAssignableTo<IHtmlInputElement>();
519              ((IHtmlInputElement)inputs[0]).Value.Should().Be("#0cdc7c");
520              ((IHtmlInputElement)inputs[0]).MaxLength.Should().Be(7);
521              comp.Instance.TextValue.Should().Be("#0cdc7c");
522              comp.SetParametersAndRender(p => p.Add(x => x.DisableAlpha, false));
523              comp.Instance.ColorValue.Should().Be(expectedColor);
524              inputs = comp.FindAll(".mud-picker-color-inputfield input");
525              inputs.Should().ContainSingle();
526              inputs.Should().AllBeAssignableTo<IHtmlInputElement>();
527              ((IHtmlInputElement)inputs[0]).Value.Should().Be("#0cdc7c78");
528              ((IHtmlInputElement)inputs[0]).MaxLength.Should().Be(9);
529              comp.Instance.TextValue.Should().Be("#0cdc7c78");
530          }
531          [Test]
532          public void ToggleViewMode()
533          {
534              var comp = Context.RenderComponent<MudColorPicker>(p =>
535              {
536                  p.Add(x => x.DisableToolbar, false);
537                  p.Add(x => x.PickerVariant, PickerVariant.Static);
538              });
539              var buttons = comp.FindAll(_mudToolbarButtonsCssSelector);
540              Dictionary<int, (ColorPickerView, string)> buttonMapper = new()
541              {
542                  { 2, (ColorPickerView.Palette, ".mud-picker-color-view-collection") },
543                  { 1, (ColorPickerView.Grid, ".mud-picker-color-grid") },
544                  { 0, (ColorPickerView.Spectrum, ".mud-picker-color-overlay") },
545              };
546              foreach (var item in buttonMapper)
547              {
548                  buttons[item.Key].Click();
549                  _ = comp.Find(item.Value.Item2);
550              }
551          }
552          [Test]
553          [TestCase(PickerVariant.Static, false)]
554          [TestCase(PickerVariant.Inline, true)]
555          [TestCase(PickerVariant.Dialog, true)]
556          public async Task CloseButtonInToolbarVisible(PickerVariant variant, bool expectedVisibility)
557          {
558              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
559              {
560                  p.Add(x => x.Variant, variant);
561                  p.Add(x => x.DisableToolbar, false);
562              });
563              if (variant is PickerVariant.Dialog or PickerVariant.Inline)
564              {
565                  await comp.Instance.OpenPicker();
566              }
567              if (expectedVisibility == false)
568              {
569                  Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-close-picker-button"));
570              }
571              else
572              {
573                  _ = comp.Find(".mud-close-picker-button");
574              }
575          }
576          [Test]
577          [TestCase(ColorPickerView.Spectrum, 0)]
578          [TestCase(ColorPickerView.Grid, 1)]
579          [TestCase(ColorPickerView.Palette, 2)]
580          public void ColorPickerView_Selection(ColorPickerView view, int index)
581          {
582              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
583              {
584                  p.Add(x => x.ViewMode, view);
585                  p.Add(x => x.DisableToolbar, false);
586              });
587              var toolbarButtons = comp.FindAll(".mud-toolbar .mud-icon-button button");
588              for (var i = 0; i < toolbarButtons.Count; i++)
589              {
590                  if (i == index)
591                  {
592                      toolbarButtons[i].ClassList.Should().Contain(".mud-icon-button-color-primary");
593                  }
594                  else
595                  {
596                      toolbarButtons[i].ClassList.Should().NotContain(".mud-icon-button-color-primary");
597                  }
598              }
599          }
600          [Test]
601          public void PaletteView()
602          {
603              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
604              {
605                  p.Add(x => x.ViewMode, ColorPickerView.Palette);
606                  p.Add(x => x.Palette, _mudGridPaletteDefaultClors);
607              });
608              var expectedColors = _mudGridPaletteDefaultClors;
609              var collectionView = comp.Find(".mud-picker-color-view-collection");
610              collectionView.Children.Should().HaveCount(expectedColors.Length);
611              for (var i = 0; i < collectionView.Children.Length; i++)
612              {
613                  var expectedColor = expectedColors[i];
614                  var colorElement = collectionView.Children[i];
615                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
616                  var style = colorElement.GetAttribute("style");
617                  style.Should().Be($"background: {expectedColor.ToString(MudColorOutputFormats.RGBA)};");
618              }
619          }
620          [Test]
621          public void PaletteView_ChooseColor()
622          {
623              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
624              {
625                  p.Add(x => x.ViewMode, ColorPickerView.Palette);
626                  p.Add(x => x.Palette, _mudGridPaletteDefaultClors);
627              });
628              var expectedColors = _mudGridPaletteDefaultClors;
629              var collectionView = comp.Find(".mud-picker-color-view-collection");
630              for (var i = 0; i < collectionView.Children.Length; i++)
631              {
632                  var expectedColor = expectedColors[i];
633                  var colorElement = collectionView.Children[i];
634                  colorElement.Click();
635                  comp.Instance.ColorValue.Should().Be(expectedColor);
636                  comp.Find(".mud-picker-color-view-collection").Children[i].ClassList.Should().BeEquivalentTo("mud-picker-color-dot", "selected");
637              }
638          }
639          [Test]
640          public void GridView()
641          {
642              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
643              {
644                  p.Add(x => x.ViewMode, ColorPickerView.Grid);
645              });
646              var expectedColors = _mudGridDefaultColors;
647              var collectionView = comp.Find(".mud-picker-color-grid");
648              collectionView.Children.Should().HaveCount(expectedColors.Length);
649              for (var i = 0; i < collectionView.Children.Length; i++)
650              {
651                  var expectedColor = expectedColors[i];
652                  var colorElement = collectionView.Children[i];
653                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
654                  var style = colorElement.GetAttribute("style");
655                  style.Should().Be($"background: {expectedColor.ToString(MudColorOutputFormats.RGBA)};");
656              }
657          }
658          [Test]
659          public void GridView_ChooseColor()
660          {
661              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
662              {
663                  p.Add(x => x.ViewMode, ColorPickerView.Grid);
664              });
665              var expectedColors = _mudGridDefaultColors;
666              var collectionView = comp.Find(".mud-picker-color-grid");
667              for (var i = 0; i < collectionView.Children.Length; i++)
668              {
669                  var expectedColor = expectedColors[i];
670                  var colorElement = collectionView.Children[i];
671                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
672                  colorElement.Click();
673                  comp.Instance.ColorValue.Should().Be(expectedColor);
674                  comp.Find(".mud-picker-color-grid").Children[i].ClassList.Should().BeEquivalentTo("mud-picker-color-dot", "selected");
675              }
676          }
677          [Test]
678          public void GridCompactView()
679          {
680              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
681              {
682                  p.Add(x => x.ViewMode, ColorPickerView.GridCompact);
683              });
684              var expectedColors = _mudGridDefaultColors;
685              var content = comp.Find(".mud-picker-content.mud-picker-color-content");
686              content.Children.Should().ContainSingle();
687              var gridView = comp.Find(".mud-picker-color-grid");
688              gridView.Children.Should().HaveCount(expectedColors.Length);
689              for (var i = 0; i < gridView.Children.Length; i++)
690              {
691                  var expectedColor = expectedColors[i];
692                  var colorElement = gridView.Children[i];
693                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
694                  var style = colorElement.GetAttribute("style");
695                  style.Should().Be($"background: {expectedColor.ToString(MudColorOutputFormats.RGBA)};");
696              }
697          }
698          [Test]
699          public void GridCompactView_ChooseColor()
700          {
701              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
702              {
703                  p.Add(x => x.ViewMode, ColorPickerView.GridCompact);
704              });
705              var expectedColors = _mudGridDefaultColors;
706              var gridView = comp.Find(".mud-picker-color-grid");
707              gridView.Children.Should().HaveCount(expectedColors.Length);
708              for (var i = 0; i < gridView.Children.Length; i++)
709              {
710                  var expectedColor = expectedColors[i];
711                  var colorElement = gridView.Children[i];
712                  colorElement.ClassList.Should().Contain("mud-picker-color-dot");
713                  colorElement.Click();
714                  comp.WaitForAssertion(() => comp.Instance.ColorValue.Should().Be(expectedColor));
715                  comp.Find(".mud-picker-color-grid").Children[i].ClassList.Should().BeEquivalentTo("mud-picker-color-dot", "selected");
716              }
717          }
718          [Test]
719          [TestCase(PickerVariant.Inline)]
720          [TestCase(PickerVariant.Dialog)]
721          public async Task GridCompact_CloseOnSelect(PickerVariant variant)
722          {
723              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
724              {
725                  p.Add(x => x.ViewMode, ColorPickerView.GridCompact);
726                  p.Add(x => x.Variant, variant);
727              });
728              await comp.Instance.OpenPicker();
729              var expectedColors = _mudGridDefaultColors;
730              var gridView = comp.Find(".mud-picker-color-grid");
731              gridView.Children[0].Click();
732              comp.Instance.ColorValue.Should().Be(expectedColors[0]);
733              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-container"));
734          }
735          [Test]
736          [TestCase(PickerVariant.Inline)]
737          [TestCase(PickerVariant.Dialog)]
738          public async Task Palette_CloseOnSelect(PickerVariant variant)
739          {
740              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
741              {
742                  p.Add(x => x.ViewMode, ColorPickerView.Palette);
743                  p.Add(x => x.Variant, variant);
744                  p.Add(x => x.Palette, _mudGridPaletteDefaultClors);
745              });
746              await comp.Instance.OpenPicker();
747              var expectedColors = _mudGridPaletteDefaultClors;
748              var gridView = comp.Find(".mud-picker-color-view-collection");
749              gridView.Children[0].Click();
750              comp.Instance.ColorValue.Should().Be(expectedColors[0]);
751              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-container"));
752          }
753          [Test]
754          [TestCase(PickerVariant.Inline, ColorPickerView.Grid)]
755          [TestCase(PickerVariant.Dialog, ColorPickerView.Grid)]
756          [TestCase(PickerVariant.Inline, ColorPickerView.Spectrum)]
757          [TestCase(PickerVariant.Dialog, ColorPickerView.Spectrum)]
758          public async Task NoControls_CloseOnSelect(PickerVariant variant, ColorPickerView view)
759          {
760              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
761              {
762                  p.Add(x => x.ViewMode, view);
763                  p.Add(x => x.Variant, variant);
764                  p.Add(x => x.DisablePreview, true);
765                  p.Add(x => x.DisableSliders, true);
766                  p.Add(x => x.DisableInput, true);
767              });
768              await comp.Instance.OpenPicker();
769              var expectedColors = view == ColorPickerView.Grid ? _mudGridDefaultColors : _mudGridPaletteDefaultClors;
770              IElement item;
771              if (view == ColorPickerView.Grid)
772              {
773                  item = comp.Find(".mud-picker-color-grid").Children[0];
774              }
775              else
776              {
777                  item = comp.Find("[class=\"mud-picker-color-overlay\"][id]");
778              }
779              item.Click();
780              comp.Instance.ColorValue.Should().NotBe(_defaultColor);
781              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-container"));
782          }
783          [Test]
784          [TestCase(ColorPickerView.Spectrum, false, "#78797aff")]
785          [TestCase(ColorPickerView.Grid, false, "#78797aff")]
786          [TestCase(ColorPickerView.Palette, false, "#78797a")]
787          [TestCase(ColorPickerView.GridCompact, false, "#78797a")]
788          [TestCase(ColorPickerView.Spectrum, true, "#78797a")]
789          [TestCase(ColorPickerView.Grid, true, "#78797a")]
790          [TestCase(ColorPickerView.Palette, true, "#78797a")]
791          [TestCase(ColorPickerView.GridCompact, true, "#78797a")]
792          public void TextOutput_Alpha(ColorPickerView view, bool disableAlpha, string expectedOutput)
793          {
794              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
795              {
796                  p.Add(x => x.ViewMode, view);
797                  p.Add(x => x.DisableAlpha, disableAlpha);
798                  p.Add(x => x.ColorValue, new MudColor(120, 121, 122, 1.0));
799              });
800              comp.Instance.TextValue.Should().Be(expectedOutput);
801          }
802          [Test]
803          public void SetNullColor_NothingChanged()
804          {
805              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
806              {
807                  p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL);
808              });
809              comp.SetParametersAndRender(p => p.Add(x => x.ColorValue, null));
810              var lColor = GetColorInput(comp, 2);
811              var expectedColor = _defaultColor;
812              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, expectedColor, ColorPickerMode.HSL, false);
813              comp.FindComponent<MudColorPicker>().Instance.Value.Should().Be(_defaultColor);
814          }
815          [Test]
816          public void SetHLS_NotChangeRBG_ButCallbackFired()
817          {
818              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
819              {
820                  p.Add(x => x.ColorPickerMode, ColorPickerMode.HSL);
821                  p.Add(x => x.AlwaysUpdateBinding, true);
822                  p.Add(x => x.ColorValue, new MudColor(245, 0.35, 0.95, 1.0));
823              });
824              var sColor = GetColorInput(comp, 1);
825              var colorValue = comp.Instance.ColorValue.ToString(MudColorOutputFormats.HexA);
826              CheckColorRelatedValues(comp, 11.37, 7.84, comp.Instance.ColorValue, ColorPickerMode.HSL);
827              var expectedColor = comp.Instance.ColorValue.SetS(comp.Instance.ColorValue.S - 0.01);
828              sColor.Change(expectedColor.S.ToString(CultureInfo.CurrentUICulture));
829              CheckColorRelatedValues(comp, 11.37, 7.84, expectedColor, ColorPickerMode.HSL);
830              var colorValueAfterChange = comp.Instance.ColorValue.ToString(MudColorOutputFormats.HexA);
831              colorValue.Should().Be(colorValueAfterChange);
832              comp.Instance.ValueChangeCallbackCounter.Should().Be(1);
833          }
834          [Test]
835          public void RTL_AlphaSliderInverseStyle()
836          {
837              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
838              {
839                  p.AddCascadingValue("RightToLeft", true);
840              });
841              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, comp.Instance.ColorValue, ColorPickerMode.RGB, true, true);
842          }
843          [Test]
844          public void AddAndRemoveEventListenerWhenChangingColorPickerView()
845          {
846              var comp = Context.RenderComponent<MudColorPicker>(p =>
847              {
848                  p.Add(x => x.DisableToolbar, false);
849                  p.Add(x => x.PickerVariant, PickerVariant.Static);
850                  p.Add(x => x.ColorPickerView, ColorPickerView.Spectrum);
851              });
852              var buttons = comp.FindAll(_mudToolbarButtonsCssSelector);
853              _eventListener.ElementIdMapper.Keys.Should().ContainSingle();
854              var value = _eventListener.ElementIdMapper.Values.First();
855              buttons[2].Click();
856              _eventListener.ElementIdMapper.Keys.Should().BeEmpty();
857              buttons[1].Click();
858              _eventListener.ElementIdMapper.Keys.Should().BeEmpty();
859              buttons[0].Click();
860              _eventListener.ElementIdMapper.Keys.Should().ContainSingle();
861              _eventListener.ElementIdMapper.Values.First().Should().Be(value);
862          }
863          [Test]
864          public void EventListenerNotAttachedWhenEnableDragEffectIsDisabled()
865          {
866              var comp = Context.RenderComponent<MudColorPicker>(p =>
867              {
868                  p.Add(x => x.DisableToolbar, false);
869                  p.Add(x => x.PickerVariant, PickerVariant.Static);
870                  p.Add(x => x.ColorPickerView, ColorPickerView.Spectrum);
871                  p.Add(x => x.DisableDragEffect, true);
872              });
873              var buttons = comp.FindAll(_mudToolbarButtonsCssSelector);
874              _eventListener.ElementIdMapper.Keys.Should().BeEmpty();
875              for (var i = 3 - 1; i >= 0; i--)
876              {
877                  buttons[i].Click();
878                  _eventListener.ElementIdMapper.Keys.Should().BeEmpty();
879              }
880          }
881          [Test]
882          public void StableHue_WhenColorSpectrumClicked()
883          {
884              var comp = Context.RenderComponent<MudColorPicker>(p =>
885              {
886                  p.Add(x => x.PickerVariant, PickerVariant.Static);
887                  p.Add(x => x.ColorPickerView, ColorPickerView.Spectrum);
888              });
889              var overlay = comp.Find(CssSelector);
890              double expectedHue = _defaultColor.H;
891              for (int x = 0; x < 312; x += 5)
892              {
893                  for (int y = 0; y < 250; y += 5)
894                  {
895                      overlay.Click(new MouseEventArgs { OffsetX = x, OffsetY = y });
896                      comp.Instance.Value.H.Should().Be(expectedHue);
897                  }
898              }
899          }
900          [Test]
901          public void Click_Selector_ColorPanel()
902          {
903              var comp = Context.RenderComponent<SimpleColorPickerTest>();
904              var overlay = comp.Find(CssSelector);
905              var x = 99.2;
906              var y = 200.98;
907              overlay.Click(new MouseEventArgs { OffsetX = x, OffsetY = y });
908              MudColor color = "#232232ff";
909              MudColor expectedColor = new MudColor(color.R, color.G, color.B, _defaultColor);
910              CheckColorRelatedValues(comp, x, y, expectedColor, ColorPickerMode.RGB);
911              var selector = comp.Find(".mud-picker-color-selector");
912              selector.Click(new MouseEventArgs { OffsetX = 13, OffsetY = 13 });
913              CheckColorRelatedValues(comp, x, y, expectedColor, ColorPickerMode.RGB);
914              selector.Click(new MouseEventArgs { OffsetX = 5, OffsetY = 20 });
915              MudColor secondExpectedColor = new MudColor(31, 30, 42, _defaultColor);
916              CheckColorRelatedValues(comp, x - 8, y + 7, secondExpectedColor, ColorPickerMode.RGB);
917          }
918          [Test]
919          public async Task CheckPickerPopover()
920          {
921              var comp = Context.RenderComponent<SimpleColorPickerTest>(p =>
922              {
923                  p.Add(x => x.Variant, PickerVariant.Inline);
924              });
925              await comp.Instance.OpenPicker();
926              var providerNode = comp.Find(".mud-popover-provider");
927              providerNode.Children.Should().ContainSingle();
928              var popoverNode = providerNode.Children[0];
929              popoverNode.ClassList.Should().BeEquivalentTo(new[]
930              {
931                  "mud-popover",
932                  "mud-popover-fixed",
933                  "mud-popover-open",
934                  "mud-popover-top-left",
935                  "mud-popover-anchor-top-left",
936                  "mud-popover-overflow-flip-onopen",
937              });
938          }
939          [Test]
940          public void DistingishBetweenInternalAndExternalView()
941          {
942              var comp = Context.RenderComponent<PickerWithFixedView>();
943              var inputField = comp.Find(".mud-input-slot");
944              inputField.Click();
945              var grid = comp.Find(".mud-picker-color-grid");
946              var spectrumButton = comp.FindAll(_mudToolbarButtonsCssSelector)[1];
947              spectrumButton.Click();
948              var overlay = comp.Find(CssSelector);
949              overlay.Click(new MouseEventArgs { OffsetX = 10.5, OffsetY = 10.5 });
950              _ = comp.Find(".mud-picker-color-overlay");
951              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-grid"));
952              comp.SetParametersAndRender(x => x.Add(y => y.ColorPickerView, ColorPickerView.GridCompact));
953              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-picker-color-overlay"));
954              _ = comp.Find(".mud-picker-color-grid");
955          }
956          [Test]
957          public void ColorPickerValueShouldUpdateOnTextTest()
958          {
959              var comp = Context.RenderComponent<MudColorPicker>(parameters => parameters
960              .Add(x => x.Editable, true));
961              comp.Find("input").Change("#180f6fff");
962              comp.Instance.Text.Should().Be("#180f6fff");
963              comp.Instance.Value.Should().Be(new MudColor("#180f6fff"));
964          }
965      }
966  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-ColorPickerTests.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-ColorPickerTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>249              var hexInput = GetColorInput(comp, 0, 1);
250              var expectedColor = _defaultColor;
251              hexInput.Change(colorHexString);
252              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, expectedColor, ColorPickerMode.HEX);
253          }
254          [Test]
255          public void SetAlphaSlider()
</pre></code></div>
                <div class="column column_space"><pre><code>249              var hexInput = GetColorInput(comp, 0, 1);
250              var expectedColor = _defaultColor;
251              hexInput.Change(colorHexString);
252              CheckColorRelatedValues(comp, _defaultXForColorPanel, _defaultYForColorPanel, expectedColor, ColorPickerMode.HEX);
253          }
254          [Test]
255          public void SetAlphaSlider()
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    