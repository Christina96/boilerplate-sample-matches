
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 24, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-PopoverTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  using System;
3  using System.Collections.Generic;
4  using System.Threading;
5  using System.Threading.Tasks;
6  using Bunit;
7  using FluentAssertions;
8  using Microsoft.AspNetCore.Components;
9  using Microsoft.AspNetCore.Components.Rendering;
10  using Microsoft.Extensions.DependencyInjection;
11  using Microsoft.Extensions.Options;
12  using Microsoft.JSInterop;
13  using Microsoft.JSInterop.Infrastructure;
14  using Moq;
15  using MudBlazor.UnitTests.TestComponents;
16  using MudBlazor.UnitTests.TestComponents.Popover;
17  using NUnit.Framework;
18  using static Bunit.ComponentParameterFactory;
19  namespace MudBlazor.UnitTests.Components
20  {
21      [TestFixture]
22      public class PopoverTests : BunitTest
23      {
24          [Test]
25          public void PopoverOptions_Defaults()
26          {
27              var options = new PopoverOptions();
28              options.ContainerClass.Should().Be("mudblazor-main-content");
29              options.FlipMargin.Should().Be(0);
30              options.ThrowOnDuplicateProvider.Should().Be(true);
31          }
32          [Test]
33          [Obsolete]
34          public void MudPopoverHandler_Constructor()
35          {
36              RenderFragment renderFragement = (tree) => { };
37              var mock = Mock.Of<IJSRuntime>();
38              Action updater = () => { };
39              var handler = new MudPopoverHandler(renderFragement, mock, updater);
40              handler.Id.Should().NotBe(default(Guid));
41              handler.UserAttributes.Should().BeEmpty();
42              handler.Class.Should().BeNull();
43              handler.Tag.Should().BeNull();
44              handler.Fragment.Should().BeSameAs(renderFragement);
45              handler.IsConnected.Should().BeFalse();
46              handler.ShowContent.Should().BeFalse();
47          }
48          [Test]
49          [Obsolete]
50          public void MudPopoverHandler_PreventNullValuesInConstructor()
51          {
52              RenderFragment renderFragement = (tree) => { };
53              var mock = Mock.Of<IJSRuntime>();
54              Action updater = () => { };
55              Assert.Throws<ArgumentNullException>(() => new MudPopoverHandler(null, mock, updater));
56              Assert.Throws<ArgumentNullException>(() => new MudPopoverHandler(renderFragement, null, updater));
57              Assert.Throws<ArgumentNullException>(() => new MudPopoverHandler(renderFragement, mock, null));
58          }
59          [Test]
60          [Obsolete]
61          public void MudPopoverHandler_SetComponentBaseParameters()
62          {
63              RenderFragment renderFragement = (tree) => { };
64              var mock = Mock.Of<IJSRuntime>();
65              Action updater = () => { };
66              var handler = new MudPopoverHandler(renderFragement, mock, updater);
67              var comp = Context.RenderComponent<MudBadge>(p =>
68              {
69                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
70                  p.Add(x => x.Tag, "my tag");
71              });
72              handler.SetComponentBaseParameters(comp.Instance, "my-extra-class", "my-extra-style:2px", true);
73              handler.Id.Should().NotBe(default(Guid));
74              handler.UserAttributes.Should().BeEquivalentTo(new Dictionary<string, object> { { "myprop1", "myValue1" } });
75              handler.Class.Should().Be("my-extra-class");
76              handler.Tag.Should().Be("my tag");
77              handler.Fragment.Should().BeSameAs(renderFragement);
78              handler.IsConnected.Should().BeFalse();
79              handler.ShowContent.Should().BeTrue();
80          }
81          [Test(Description = "Remove in v7")]
82          [Obsolete]
83          public void MudPopoverHandler_UpdateFragment()
84          {
85              RenderFragment initialRenderFragement = (tree) => { };
86              var mock = Mock.Of<IJSRuntime>();
87              var updateCounter = 0;
88              Action updater = () => { updateCounter++; };
89              var handler = new MudPopoverHandler(initialRenderFragement, mock, updater);
90              var comp = Context.RenderComponent<MudBadge>(p =>
91              {
92                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
93                  p.Add(x => x.Tag, "my tag");
94              });
95              RenderFragment newRenderFragement = (tree) => { };
96              handler.UpdateFragment(newRenderFragement, comp.Instance, "my-extra-class", "my-extra-style:2px", true);
97              handler.Id.Should().NotBe(default(Guid));
98              handler.UserAttributes.Should().BeEquivalentTo(new Dictionary<string, object> { { "myprop1", "myValue1" } });
99              handler.Class.Should().Be("my-extra-class");
100              handler.Style.Should().Be("my-extra-style:2px");
101              handler.Tag.Should().Be("my tag");
102              handler.Fragment.Should().BeSameAs(newRenderFragement);
103              handler.IsConnected.Should().BeFalse();
104              handler.ShowContent.Should().BeTrue();
105              updateCounter.Should().Be(1);
106          }
107          [Test]
108          [Obsolete]
109          public async Task MudPopoverHandler_UpdateFragmentAsync()
110          {
111              var mock = Mock.Of<IJSRuntime>();
112              var updateCounter = 0;
113              RenderFragment initialRenderFragment = _ => { };
114              RenderFragment newRenderFragment = _ => { };
115              void Updater() => updateCounter++;
116              var handler = new MudPopoverHandler(initialRenderFragment, mock, Updater);
117              var comp = Context.RenderComponent<MudBadge>(p =>
118              {
119                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
120                  p.Add(x => x.Tag, "my tag");
121              });
122              await handler.UpdateFragmentAsync(newRenderFragment, comp.Instance, "my-extra-class", "my-extra-style:2px", true);
123              handler.Id.Should().NotBe(default(Guid));
124              handler.UserAttributes.Should().BeEquivalentTo(new Dictionary<string, object> { { "myprop1", "myValue1" } });
125              handler.Class.Should().Be("my-extra-class");
126              handler.Style.Should().Be("my-extra-style:2px");
127              handler.Tag.Should().Be("my tag");
128              handler.Fragment.Should().BeSameAs(newRenderFragment);
129              handler.IsConnected.Should().BeFalse();
130              handler.ShowContent.Should().BeTrue();
131              updateCounter.Should().Be(1);
132          }
133          [Test]
134          [Obsolete]
135          public async Task MudPopoverHandler_DetachAndUpdateFragmentAsync()
136          {
137              var mock = Mock.Of<IJSRuntime>();
138              var updateCounter = 0;
139              RenderFragment initialRenderFragment = _ => { };
140              RenderFragment newRenderFragment = _ => { };
141              void Updater() => updateCounter++;
142              var handler = new MudPopoverHandler(initialRenderFragment, mock, Updater);
143              var comp = Context.RenderComponent<MudBadge>(p =>
144              {
145                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
146                  p.Add(x => x.Tag, "my tag");
147              });
148              await handler.Detach();
149              await handler.UpdateFragmentAsync(newRenderFragment, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
150              updateCounter.Should().Be(0);
151          }
152          [Test]
153          [Obsolete]
154          public async Task MudPopoverHandler_DetachAndUpdateFragmentConcurrent_UpdateFragmentDoesNotRunInTheSameTimeAsDetach()
155          {
156              var connectTcs = new TaskCompletionSource<IJSVoidResult>();
157              var mock = new Mock<IJSRuntime>();
158              var handler = new MudPopoverHandler((tree) => { }, mock.Object, () => { });
159              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.connect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
160                  .ReturnsAsync(Mock.Of<IJSVoidResult>())
161                  .Verifiable();
162              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.disconnect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
163                  .Returns(new ValueTask<IJSVoidResult>(connectTcs.Task))
164                  .Verifiable();
165              var comp = Context.RenderComponent<MudBadge>(p =>
166              {
167                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
168                  p.Add(x => x.Tag, "my tag");
169              });
170              RenderFragment newRenderFragement = (tree) => { };
171              await handler.Initialize();
172              _ = handler.Detach();
173              var task2 = handler.UpdateFragmentAsync(newRenderFragement, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
174              var completedTask = await Task.WhenAny(Task.Delay(50), task2);
175              completedTask.Should().NotBe(task2);
176              mock.Verify();
177              mock.VerifyNoOtherCalls();
178          }
179          [Test]
180          [Obsolete]
181          public async Task MudPopoverHandler_DetachAndUpdateFragmentConcurrent_UpdateFragmentAsyncShouldRunAfterDetach()
182          {
183              var connectTcs = new TaskCompletionSource<IJSVoidResult>();
184              var mock = new Mock<IJSRuntime>();
185              var handler = new MudPopoverHandler(_ => { }, mock.Object, () => { });
186              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.connect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
187                  .ReturnsAsync(Mock.Of<IJSVoidResult>())
188                  .Verifiable();
189              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.disconnect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
190                  .Returns(new ValueTask<IJSVoidResult>(connectTcs.Task))
191                  .Verifiable();
192              var comp = Context.RenderComponent<MudBadge>(p =>
193              {
194                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
195                  p.Add(x => x.Tag, "my tag");
196              });
197              RenderFragment newRenderFragement = (tree) => { };
198              await handler.Initialize();
199              var task1 = handler.Detach();
200              var task2 = handler.UpdateFragmentAsync(newRenderFragement, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
201              connectTcs.SetResult(Mock.Of<IJSVoidResult>());
202              await Task.WhenAll(task1, task2);
203              mock.Verify();
<span onclick='openModal()' class='match'>204              mock.VerifyNoOtherCalls();
205          }
206          [Test(Description = "Remove in v7")]
207          [Obsolete]
208          public void MudPopoverHandler_UpdaterInvokationTest()
209          {
210              RenderFragment initialRenderFragement = (tree) => { };
</span>211              var mock = Mock.Of<IJSRuntime>();
212              var updateCounter = 0;
213              Action updater = () => { updateCounter++; };
214              var handler = new MudPopoverHandler(initialRenderFragement, mock, updater);
215              var comp = Context.RenderComponent<MudBadge>(p =>
216              {
217                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
218                  p.Add(x => x.Tag, "my tag");
219              });
220              RenderFragment newRenderFragement = (tree) => { };
221              for (int i = 0; i < 4; i++)
222              {
223                  handler.UpdateFragment(newRenderFragement, comp.Instance, "my-extra-class", "my-extra-style:2px", i % 2 == 0);
224              }
225              updateCounter.Should().Be(4);
226              handler.UpdateFragment(newRenderFragement, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
227              updateCounter.Should().Be(5);
228              handler.Class.Should().Be("my-new-extra-class");
229              handler.Style.Should().Be("my-new-extra-style:2px");
230          }
231          [Test]
232          [Obsolete]
233          public async Task MudPopoverHandler_UpdaterInvocationAsync()
234          {
235              var mock = Mock.Of<IJSRuntime>();
236              var updateCounter = 0;
237              RenderFragment initialRenderFragment = _ => { };
238              RenderFragment newRenderFragment = _ => { };
239              void Updater() => updateCounter++;
240              var handler = new MudPopoverHandler(initialRenderFragment, mock, Updater);
241              var comp = Context.RenderComponent<MudBadge>(p =>
242              {
243                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
244                  p.Add(x => x.Tag, "my tag");
245              });
246              for (int i = 0; i < 4; i++)
247              {
248                 await handler.UpdateFragmentAsync(newRenderFragment, comp.Instance, "my-extra-class", "my-extra-style:2px", i % 2 == 0);
249              }
250              updateCounter.Should().Be(4);
251              await handler.UpdateFragmentAsync(newRenderFragment, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
252              updateCounter.Should().Be(5);
253              handler.Class.Should().Be("my-new-extra-class");
254              handler.Style.Should().Be("my-new-extra-style:2px");
255          }
256          [Test]
257          [Obsolete]
258          public async Task MudPopoverHandler_InitializeAndDetach()
259          {
260              var handlerId = Guid.NewGuid();
261              RenderFragment renderFragement = (tree) => { };
262              var mock = new Mock<IJSRuntime>();
263              mock.Setup(x =>
264              x.InvokeAsync<IJSVoidResult>(
265                  "mudPopover.connect",
266                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
267              mock.Setup(x =>
268              x.InvokeAsync<IJSVoidResult>(
269                  "mudPopover.disconnect",
270                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
271              var updateCounter = 0;
272              Action updater = () => { updateCounter++; };
273              var handler = new MudPopoverHandler(renderFragement, mock.Object, updater);
274              handlerId = handler.Id;
275              handler.IsConnected.Should().BeFalse();
276              await handler.Initialize();
277              handler.IsConnected.Should().BeTrue();
278              await handler.Detach();
279              handler.IsConnected.Should().BeFalse();
280          }
281          [Test]
282          [Obsolete]
283          public async Task MudPopoverHandler_InitializeAndDetach_DetachThrowsTaskCanceledException()
284          {
285              var handlerId = Guid.NewGuid();
286              RenderFragment renderFragement = (tree) => { };
287              var mock = new Mock<IJSRuntime>();
288              mock.Setup(x =>
289              x.InvokeAsync<IJSVoidResult>(
290                  "mudPopover.connect",
291                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
292              mock.Setup(x =>
293              x.InvokeAsync<IJSVoidResult>(
294                  "mudPopover.disconnect",
295                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ThrowsAsync(new TaskCanceledException()).Verifiable();
296              var updateCounter = 0;
297              Action updater = () => { updateCounter++; };
298              var handler = new MudPopoverHandler(renderFragement, mock.Object, updater);
299              handlerId = handler.Id;
300              await handler.Initialize();
301              await handler.Detach();
302              handler.IsConnected.Should().BeFalse();
303          }
304          [Test]
305          [Obsolete]
306          public async Task MudPopoverHandler_InitializeAndDetach_DetachThrowsNotTaskCanceledException()
307          {
308              var handlerId = Guid.NewGuid();
309              RenderFragment renderFragement = (tree) => { };
310              var mock = new Mock<IJSRuntime>();
311              mock.Setup(x =>
312              x.InvokeAsync<IJSVoidResult>(
313                  "mudPopover.connect",
314                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
315              mock.Setup(x =>
316              x.InvokeAsync<IJSVoidResult>(
317                  "mudPopover.disconnect",
318                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ThrowsAsync(new InvalidOperationException()).Verifiable();
319              var updateCounter = 0;
320              Action updater = () => { updateCounter++; };
321              var handler = new MudPopoverHandler(renderFragement, mock.Object, updater);
322              handlerId = handler.Id;
323              await handler.Initialize();
324              Assert.ThrowsAsync<InvalidOperationException>(async () => await handler.Detach());
325              handler.IsConnected.Should().BeFalse();
326          }
327          [Test]
328          [Obsolete]
329          public async Task MudPopoverHandler_InitializeAndDetachConcurrent_DetachDoesNotRunAtSameTimeAsInitialize()
330          {
331              var connectTcs = new TaskCompletionSource<IJSVoidResult>();
332              var mock = new Mock<IJSRuntime>();
333              var handler = new MudPopoverHandler(_ => { }, mock.Object, () => { });
334              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.connect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
335                  .Returns(new ValueTask<IJSVoidResult>(connectTcs.Task))
336                  .Verifiable();
337              _ = handler.Initialize();
338              var task2 = handler.Detach();
339              var completedTask = await Task.WhenAny(Task.Delay(50), task2);
340              completedTask.Should().NotBe(task2);
341              mock.Verify();
342              mock.VerifyNoOtherCalls();
343          }
344          [Test]
345          [Obsolete]
346          public async Task MudPopoverHandler_InitializeAndDetachConcurrent_DetachRunsAfterInitialize()
347          {
348              var connectTcs = new TaskCompletionSource<IJSVoidResult>();
349              var mock = new Mock<IJSRuntime>();
350              var handler = new MudPopoverHandler(_ => { }, mock.Object, () => { });
351              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.connect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
352                  .Returns(new ValueTask<IJSVoidResult>(connectTcs.Task))
353                  .Verifiable();
354              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.disconnect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
355                  .ReturnsAsync(Mock.Of<IJSVoidResult>())
356                  .Verifiable();
357              var task1 = handler.Initialize();
358              var task2 = handler.Detach();
359              connectTcs.SetResult(Mock.Of<IJSVoidResult>());
360              await Task.WhenAll(task1, task2);
361              mock.Verify();
362              mock.VerifyNoOtherCalls();
363          }
364          [Test]
365          [Obsolete]
366          public async Task MudPopoverHandler_DetachCalledBeforeInitialize_NoInteropShouldOccur()
367          {
368              var mock = new Mock<IJSRuntime>();
369              var handler = new MudPopoverHandler(_ => { }, mock.Object, () => { });
370              await handler.Detach();
371              handler.IsConnected.Should().BeFalse();
372              await handler.Initialize();
373              handler.IsConnected.Should().BeFalse();
374              mock.VerifyNoOtherCalls();
375          }
376          [Test]
377          [Obsolete]
378          public void MudPopoverService_Constructor_NoJsInterop()
379          {
380              Assert.Throws<ArgumentNullException>(() => _ = new MudPopoverService(null));
381          }
382          [Test]
383          [Obsolete]
384          public async Task MudPopoverService_Constructor_NullOption()
385          {
386              var mock = new Mock<IJSRuntime>();
387              mock.Setup(x =>
388             x.InvokeAsync<IJSVoidResult>(
389                 "mudPopover.initialize",
390                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
391              {
392                  var service = new MudPopoverService(mock.Object, null);
393                  await service.InitializeIfNeeded();
394              }
395              {
396                  var service = new MudPopoverService(mock.Object);
397                  await service.InitializeIfNeeded();
398              }
399              mock.Verify();
400          }
401          [Test]
402          [Obsolete]
403          public async Task MudPopoverService_Initialize_Catch_JSDisconnectedException()
404          {
405              var mock = new Mock<IJSRuntime>();
406              mock.Setup(x =>
407             x.InvokeAsync<IJSVoidResult>(
408                 "mudPopover.initialize",
409                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ThrowsAsync(new JSDisconnectedException("JSDisconnectedException")).Verifiable();
410              {
411                  var service = new MudPopoverService(mock.Object);
412                  await service.InitializeIfNeeded();
413              }
414              mock.Verify();
415          }
416          [Test]
417          [Obsolete]
418          public async Task MudPopoverService_Initialize_Catch_TaskCanceledException()
419          {
420              var mock = new Mock<IJSRuntime>();
421              mock.Setup(x =>
422             x.InvokeAsync<IJSVoidResult>(
423                 "mudPopover.initialize",
424                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ThrowsAsync(new TaskCanceledException()).Verifiable();
425              {
426                  var service = new MudPopoverService(mock.Object);
427                  await service.InitializeIfNeeded();
428              }
429              mock.Verify();
430          }
431          [Test]
432          [Obsolete]
433          public async Task MudPopoverService_Constructor_OptionWithCustomClass()
434          {
435              var mock = new Mock<IJSRuntime>();
436              var option = new PopoverOptions
437              {
438                  ContainerClass = "my-custom-class",
439                  FlipMargin = 12,
440              };
441              var optionMock = new Mock<IOptions<PopoverOptions>>();
442              optionMock.SetupGet(x => x.Value).Returns(option);
443              mock.Setup(x =>
444             x.InvokeAsync<IJSVoidResult>(
445                 "mudPopover.initialize",
446                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "my-custom-class" && (int)x[1] == 12))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
447              var service = new MudPopoverService(mock.Object, optionMock.Object);
448              await service.InitializeIfNeeded();
449              mock.Verify();
450          }
451          [Test]
452          [Obsolete]
453          public async Task MudPopoverService_CallInitializeOnlyOnce()
454          {
455              var mock = new Mock<IJSRuntime>();
456              mock.Setup(x =>
457             x.InvokeAsync<IJSVoidResult>(
458                 "mudPopover.initialize",
459                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>(), TimeSpan.FromMilliseconds(300)).Verifiable();
460              Task[] tasks = new Task[5];
461              var service = new MudPopoverService(mock.Object);
462              for (int i = 0; i < 5; i++)
463              {
464                  tasks[i] = Task.Run(async () => await service.InitializeIfNeeded());
465              }
466              Task.WaitAll(tasks);
467              mock.Verify(x =>
468             x.InvokeAsync<IJSVoidResult>(
469                 "mudPopover.initialize",
470                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0)), Times.Once());
471          }
472          [Test]
473          [Obsolete]
474          public async Task MudPopoverService_OnlyDisposeIfConnected()
475          {
476              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
477              await service.DisposeAsync();
478          }
479          [Test]
480          [Obsolete]
481          public async Task MudPopoverService_DisposeAsync()
482          {
483              var mock = new Mock<IJSRuntime>();
484              mock.Setup(x =>
485             x.InvokeAsync<IJSVoidResult>(
486                 "mudPopover.initialize",
487                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
488              mock.Setup(x =>
489              x.InvokeAsync<IJSVoidResult>(
490              "mudPopover.dispose",
491              It.Is<object[]>(x => x.Length == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
492              var service = new MudPopoverService(mock.Object);
493              await service.InitializeIfNeeded();
494              await service.DisposeAsync();
495              mock.Verify();
496          }
497          [Test]
498          [Obsolete]
499          public async Task MudPopoverService_DisposeAsync_WithTaskCancelException()
500          {
501              var mock = new Mock<IJSRuntime>();
502              mock.Setup(x =>
503             x.InvokeAsync<IJSVoidResult>(
504                 "mudPopover.initialize",
505                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
506              mock.Setup(x =>
507              x.InvokeAsync<IJSVoidResult>(
508              "mudPopover.dispose",
509              It.Is<object[]>(x => x.Length == 0))).ThrowsAsync(new TaskCanceledException()).Verifiable();
510              var service = new MudPopoverService(mock.Object);
511              await service.InitializeIfNeeded();
512              await service.DisposeAsync();
513              mock.Verify();
514          }
515          [Test(Description = "Remove in v7")]
516          [Obsolete]
517          public void MudPopoverService_RegisterAndUseHandler()
518          {
519              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
520              int fragmentChangedCounter = 0;
521              service.FragmentsChanged += (e, args) =>
522              {
523                  fragmentChangedCounter++;
524              };
525              RenderFragment fragment = (builder) => { };
526              var handler = service.Register(fragment);
527              handler.Should().NotBeNull();
528              fragmentChangedCounter.Should().Be(1);
529              RenderFragment changedFragment = (builder) => { };
530              var comp = Context.RenderComponent<MudBadge>(p =>
531              {
532                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
533                  p.Add(x => x.Tag, "my tag");
534              });
535              handler.UpdateFragment(changedFragment, comp.Instance, "my-class", "my-style", true);
536              fragmentChangedCounter.Should().Be(1);
537          }
538          [Test]
539          [Obsolete]
540          public async Task MudPopoverService_RegisterAndUseHandlerAsync()
541          {
542              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
543              int fragmentChangedCounter = 0;
544              service.FragmentsChanged += (_, _) =>
545              {
546                  fragmentChangedCounter++;
547              };
548              RenderFragment fragment = _ => { };
549              RenderFragment changedFragment = _ => { };
550              var handler = service.Register(fragment);
551              handler.Should().NotBeNull();
552              fragmentChangedCounter.Should().Be(1);
553              var comp = Context.RenderComponent<MudBadge>(p =>
554              {
555                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
556                  p.Add(x => x.Tag, "my tag");
557              });
558              await handler.UpdateFragmentAsync(changedFragment, comp.Instance, "my-class", "my-style", true);
559              fragmentChangedCounter.Should().Be(1);
560          }
561          [Test]
562          [Obsolete]
563          public async Task MudPopoverService_Unregister_NullFragment()
564          {
565              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
566              var result = await service.Unregister(null);
567              result.Should().BeFalse();
568          }
569          [Test]
570          [Obsolete]
571          public async Task MudPopoverService_Unregister_HandlerNotFound()
572          {
573              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
574              var handler = new MudPopoverHandler((tree) => { }, Mock.Of<IJSRuntime>(MockBehavior.Strict), () => { });
575              var result = await service.Unregister(handler);
576              result.Should().BeFalse();
577          }
578          [Test]
579          [Obsolete]
580          public async Task MudPopoverService_Unregister_NotConnected()
581          {
582              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
583              RenderFragment fragment = (builder) => { };
584              var handler = service.Register(fragment);
585              var result = await service.Unregister(handler);
586              result.Should().BeTrue();
587          }
588          [Test]
589          [Obsolete]
590          public async Task MudPopoverService_Unregister()
591          {
592              var handlerId = Guid.NewGuid();
593              var mock = new Mock<IJSRuntime>();
594              mock.Setup(jsRuntime =>
595                      jsRuntime.InvokeAsync<IJSVoidResult>(
596                          "mudPopover.connect",
597                          It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId)))
598                  .ReturnsAsync(Mock.Of<IJSVoidResult>)
599                  .Verifiable();
600              mock.Setup(jsRuntime =>
601                      jsRuntime.InvokeAsync<IJSVoidResult>(
602                          "mudPopover.disconnect",
603                          It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId)))
604                  .ReturnsAsync(Mock.Of<IJSVoidResult>)
605                  .Verifiable();
606              var service = new MudPopoverService(mock.Object);
607              await service.InitializeIfNeeded();
608              RenderFragment fragment = (builder) => { };
609              var handler = service.Register(fragment);
610              handlerId = handler.Id;
611              await handler.Initialize();
612              int fragmentChangedCounter = 0;
613              service.FragmentsChanged += (_, _) =>
614              {
615                  fragmentChangedCounter++;
616              };
617              var result = await service.Unregister(handler);
618              result.Should().BeTrue();
619              fragmentChangedCounter.Should().Be(1);
620              var secondResult = await service.Unregister(handler);
621              secondResult.Should().BeFalse();
622              mock.Verify();
623          }
624          [Test]
625          public void MudPopover_DefaultValues()
626          {
627              var popover = new MudPopover();
628              popover.MaxHeight.Should().BeNull();
629              popover.Paper.Should().BeTrue();
630              popover.Elevation.Should().Be(8);
631              popover.Square.Should().BeFalse();
632              popover.Open.Should().BeFalse();
633              popover.Fixed.Should().BeFalse();
634              popover.AnchorOrigin.Should().Be(Origin.TopLeft);
635              popover.TransformOrigin.Should().Be(Origin.TopLeft);
636              popover.RelativeWidth.Should().BeFalse();
637              popover.OverflowBehavior.Should().Be(OverflowBehavior.FlipOnOpen);
638              popover.Duration.Should().Be(251);
639          }
640          [Test]
641          public async Task MudPopover_OpenAndClose()
642          {
643              var comp = Context.RenderComponent<PopoverTest>();
644              var provider = comp.Find(".mud-popover-provider");
645              provider.Children.Should().ContainSingle();
646              var popoverNode = comp.Find(".popoverparent").Children[1];
647              popoverNode.Id.Should().StartWith("popover-");
648              var handlerId = Guid.Parse(popoverNode.Id.Substring(8));
649              handlerId.Should().NotBe(Guid.Empty);
650              provider.Children.Should().ContainSingle();
651              provider.FirstElementChild.Id.Should().Be($"popovercontent-{handlerId}");
652              provider.FirstElementChild.Children.Should().BeEmpty();
653              await comp.Instance.Open();
654              provider.FirstElementChild.Children.Should().ContainSingle();
655              provider.FirstElementChild.Children[0].TextContent.Should().Be("Popover content");
656              await comp.Instance.Close();
657              provider.FirstElementChild.Children.Should().BeEmpty();
658          }
659          [Test]
660          public void MudPopover_Property_MaxHeight()
661          {
662              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(x => x.MaxHeight, 100));
663              var popoverElement = comp.Find(".test-popover-content").ParentElement;
664              popoverElement.GetAttribute("style").Split(';', StringSplitOptions.RemoveEmptyEntries).Should().Contain(new[] { "max-height:100px", "my-custom-style:3px" });
665          }
666          [Test]
667          public void MudPopover_Property_TransitionDuration()
668          {
669              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(x => x.Duration, 100));
670              var popoverElement = comp.Find(".test-popover-content").ParentElement;
671              popoverElement.GetAttribute("style").Split(';', StringSplitOptions.RemoveEmptyEntries).Should().Contain(new[] { "transition-duration:100ms" });
672          }
673          [Test]
674          public void MudPopover_Property_Fixed()
675          {
676              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
677                  x => x.Fixed, true));
678              var popoverElement = comp.Find(".test-popover-content").ParentElement;
679              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-popover-fixed", "my-custom-class" });
680          }
681          [Test]
682          public void MudPopover_Property_RelativeWidth()
683          {
684              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
685                  x => x.RelativeWidth, true));
686              var popoverElement = comp.Find(".test-popover-content").ParentElement;
687              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-popover-relative-width", "my-custom-class" });
688          }
689          [Test]
690          public void MudPopover_Property_Paper()
691          {
692              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
693                  x => x.Paper, true));
694              var popoverElement = comp.Find(".test-popover-content").ParentElement;
695              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-paper", "mud-elevation-8", "my-custom-class" });
696          }
697          [Test]
698          public void MudPopover_Property_PaperAndSqaure()
699          {
700              var comp = Context.RenderComponent<PopoverPropertyTest>(p =>
701              {
702                  p.Add(x => x.Paper, true);
703                  p.Add(x => x.Square, true);
704              });
705              var popoverElement = comp.Find(".test-popover-content").ParentElement;
706              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-paper-square", "mud-elevation-8", "my-custom-class" });
707          }
708          [Test]
709          public void MudPopover_Property_Elevation()
710          {
711              var comp = Context.RenderComponent<PopoverPropertyTest>(p =>
712              {
713                  p.Add(x => x.Paper, true);
714                  p.Add(x => x.Elevation, 10);
715              });
716              var popoverElement = comp.Find(".test-popover-content").ParentElement;
717              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-paper", "mud-elevation-10", "my-custom-class" });
718          }
719          [Test]
720          [TestCase(Origin.BottomCenter, "bottom-center")]
721          [TestCase(Origin.BottomLeft, "bottom-left")]
722          [TestCase(Origin.BottomRight, "bottom-right")]
723          [TestCase(Origin.CenterCenter, "center-center")]
724          [TestCase(Origin.CenterLeft, "center-left")]
725          [TestCase(Origin.CenterRight, "center-right")]
726          [TestCase(Origin.TopCenter, "top-center")]
727          [TestCase(Origin.TopLeft, "top-left")]
728          [TestCase(Origin.TopRight, "top-right")]
729          public void MudPopover_Property_TransformOrigin(Origin transformOrigin, string expectedClass)
730          {
731              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
732                  x => x.TransformOrigin, transformOrigin));
733              var popoverElement = comp.Find(".test-popover-content").ParentElement;
734              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", $"mud-popover-{expectedClass}", "my-custom-class" });
735          }
736          [Test]
737          [TestCase(Origin.BottomCenter, "bottom-center")]
738          [TestCase(Origin.BottomLeft, "bottom-left")]
739          [TestCase(Origin.BottomRight, "bottom-right")]
740          [TestCase(Origin.CenterCenter, "center-center")]
741          [TestCase(Origin.CenterLeft, "center-left")]
742          [TestCase(Origin.CenterRight, "center-right")]
743          [TestCase(Origin.TopCenter, "top-center")]
744          [TestCase(Origin.TopLeft, "top-left")]
745          [TestCase(Origin.TopRight, "top-right")]
746          public void MudPopover_Property_AnchorOrigin(Origin anchorOrigin, string expectedClass)
747          {
748              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
749                  x => x.AnchorOrigin, anchorOrigin));
750              var popoverElement = comp.Find(".test-popover-content").ParentElement;
751              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", $"mud-popover-anchor-{expectedClass}", "my-custom-class" });
752          }
753          [Test]
754          [TestCase(OverflowBehavior.FlipNever, "flip-never")]
755          [TestCase(OverflowBehavior.FlipOnOpen, "flip-onopen")]
756          [TestCase(OverflowBehavior.FlipAlways, "flip-always")]
757          public void MudPopover_Property_OverflowBehavior(OverflowBehavior overflowBehavior, string expectedClass)
758          {
759              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
760                  x => x.OverflowBehavior, overflowBehavior));
761              var popoverElement = comp.Find(".test-popover-content").ParentElement;
762              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", $"mud-popover-overflow-{expectedClass}", "my-custom-class" });
763          }
764          [Test]
765          public async Task MudPopover_WithDynamicContent()
766          {
767              var comp = Context.RenderComponent<PopoverComplexContent>();
768              var dynamicContentElement = comp.Find(".dynamic-content");
769              dynamicContentElement.ChildNodes.Should().BeEmpty();
770              await comp.Instance.AddRow();
771              dynamicContentElement.ChildNodes.Should().ContainSingle();
772              dynamicContentElement.ChildNodes[0].TextContent.Should().Be("Popover content 0");
773              await comp.Instance.AddRow();
774              dynamicContentElement.ChildNodes.Should().HaveCount(2);
775              dynamicContentElement.ChildNodes[0].TextContent.Should().Be("Popover content 0");
776              dynamicContentElement.ChildNodes[1].TextContent.Should().Be("Popover content 1");
777              await comp.Instance.AddRow();
778              dynamicContentElement.ChildNodes.Should().HaveCount(3);
779              dynamicContentElement.ChildNodes[0].TextContent.Should().Be("Popover content 0");
780              dynamicContentElement.ChildNodes[1].TextContent.Should().Be("Popover content 1");
781              dynamicContentElement.ChildNodes[2].TextContent.Should().Be("Popover content 2");
782          }
783          [Test]
784          public void MudPopoverProvider_DefaultValue()
785          {
786              var provider = new MudPopoverProvider();
787              provider.IsEnabled.Should().BeTrue();
788          }
789          [Test]
790          public void MudPopoverProvider_RenderElementsBasedOnEnableState()
791          {
792              var comp = Context.RenderComponent<PopoverProviderTest>(p => p.Add(x => x.ProviderIsEnabled, true));
793              comp.Find("#my-content").TextContent.Should().Be("Popover content");
794              for (int i = 0; i < 3; i++)
795              {
796                  comp.SetParametersAndRender(p => p.Add(x => x.ProviderIsEnabled, false));
797                  Assert.Throws<ElementNotFoundException>(() => comp.Find("#my-content"));
798                  comp.SetParametersAndRender(p => p.Add(x => x.ProviderIsEnabled, true));
799                  comp.Find("#my-content").TextContent.Should().Be("Popover content");
800              }
801          }
802          [Test]
803          public void MudPopoverProvider_NoRenderWhenIsEnabledIsFalse()
804          {
805              var comp = Context.RenderComponent<PopoverProviderTest>(p => p.Add(x => x.ProviderIsEnabled, false));
806              Assert.Throws<ElementNotFoundException>(() => comp.Find("#my-content"));
807          }
808          [TestCase(false)]
809          [TestCase(true)]
810          public async Task MudPopoverProvider_ThrowOnDuplicate(bool ThrowOnDuplicateProvider)
811          {
812              var options = new PopoverOptions
813              {
814                  ThrowOnDuplicateProvider = ThrowOnDuplicateProvider
815              };
816              Context.Services.Configure<PopoverOptions>(x => x.ThrowOnDuplicateProvider = ThrowOnDuplicateProvider);
817              Context.JSInterop.Setup<int>("mudpopoverHelper.countProviders").SetResult(ThrowOnDuplicateProvider == true ? 2 : 1);
818              if (ThrowOnDuplicateProvider == true)
819              {
820                  var ex = Assert.Throws<InvalidOperationException>(() => Context.RenderComponent<PopoverDuplicationTest>());
821                  ex.Message.Should().StartWith("Duplicate MudPopoverProvider detected");
822              }
823              else
824              {
825                  var comp = Context.RenderComponent<PopoverDuplicationTest>();
826                  await comp.Instance.Open();
827                  await comp.Instance.Close();
828              }
829          }
830      }
831  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-PopoverTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  using System;
3  using System.Collections.Generic;
4  using System.Threading;
5  using System.Threading.Tasks;
6  using Bunit;
7  using FluentAssertions;
8  using Microsoft.AspNetCore.Components;
9  using Microsoft.AspNetCore.Components.Rendering;
10  using Microsoft.Extensions.DependencyInjection;
11  using Microsoft.Extensions.Options;
12  using Microsoft.JSInterop;
13  using Microsoft.JSInterop.Infrastructure;
14  using Moq;
15  using MudBlazor.UnitTests.TestComponents;
16  using MudBlazor.UnitTests.TestComponents.Popover;
17  using NUnit.Framework;
18  using static Bunit.ComponentParameterFactory;
19  namespace MudBlazor.UnitTests.Components
20  {
21      [TestFixture]
22      public class PopoverTests : BunitTest
23      {
24          [Test]
25          public void PopoverOptions_Defaults()
26          {
27              var options = new PopoverOptions();
28              options.ContainerClass.Should().Be("mudblazor-main-content");
29              options.FlipMargin.Should().Be(0);
30              options.ThrowOnDuplicateProvider.Should().Be(true);
31          }
32          [Test]
33          [Obsolete]
34          public void MudPopoverHandler_Constructor()
35          {
36              RenderFragment renderFragement = (tree) => { };
37              var mock = Mock.Of<IJSRuntime>();
38              Action updater = () => { };
39              var handler = new MudPopoverHandler(renderFragement, mock, updater);
40              handler.Id.Should().NotBe(default(Guid));
41              handler.UserAttributes.Should().BeEmpty();
42              handler.Class.Should().BeNull();
43              handler.Tag.Should().BeNull();
44              handler.Fragment.Should().BeSameAs(renderFragement);
45              handler.IsConnected.Should().BeFalse();
46              handler.ShowContent.Should().BeFalse();
47          }
48          [Test]
49          [Obsolete]
50          public void MudPopoverHandler_PreventNullValuesInConstructor()
51          {
52              RenderFragment renderFragement = (tree) => { };
53              var mock = Mock.Of<IJSRuntime>();
54              Action updater = () => { };
55              Assert.Throws<ArgumentNullException>(() => new MudPopoverHandler(null, mock, updater));
56              Assert.Throws<ArgumentNullException>(() => new MudPopoverHandler(renderFragement, null, updater));
57              Assert.Throws<ArgumentNullException>(() => new MudPopoverHandler(renderFragement, mock, null));
58          }
59          [Test]
60          [Obsolete]
61          public void MudPopoverHandler_SetComponentBaseParameters()
62          {
63              RenderFragment renderFragement = (tree) => { };
64              var mock = Mock.Of<IJSRuntime>();
65              Action updater = () => { };
66              var handler = new MudPopoverHandler(renderFragement, mock, updater);
67              var comp = Context.RenderComponent<MudBadge>(p =>
68              {
69                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
70                  p.Add(x => x.Tag, "my tag");
71              });
72              handler.SetComponentBaseParameters(comp.Instance, "my-extra-class", "my-extra-style:2px", true);
73              handler.Id.Should().NotBe(default(Guid));
74              handler.UserAttributes.Should().BeEquivalentTo(new Dictionary<string, object> { { "myprop1", "myValue1" } });
75              handler.Class.Should().Be("my-extra-class");
76              handler.Tag.Should().Be("my tag");
77              handler.Fragment.Should().BeSameAs(renderFragement);
78              handler.IsConnected.Should().BeFalse();
79              handler.ShowContent.Should().BeTrue();
80          }
81          [Test(Description = "Remove in v7")]
82          [Obsolete]
83          public void MudPopoverHandler_UpdateFragment()
84          {
85              RenderFragment initialRenderFragement = (tree) => { };
86              var mock = Mock.Of<IJSRuntime>();
87              var updateCounter = 0;
88              Action updater = () => { updateCounter++; };
89              var handler = new MudPopoverHandler(initialRenderFragement, mock, updater);
90              var comp = Context.RenderComponent<MudBadge>(p =>
91              {
92                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
93                  p.Add(x => x.Tag, "my tag");
94              });
95              RenderFragment newRenderFragement = (tree) => { };
96              handler.UpdateFragment(newRenderFragement, comp.Instance, "my-extra-class", "my-extra-style:2px", true);
97              handler.Id.Should().NotBe(default(Guid));
98              handler.UserAttributes.Should().BeEquivalentTo(new Dictionary<string, object> { { "myprop1", "myValue1" } });
99              handler.Class.Should().Be("my-extra-class");
100              handler.Style.Should().Be("my-extra-style:2px");
101              handler.Tag.Should().Be("my tag");
102              handler.Fragment.Should().BeSameAs(newRenderFragement);
103              handler.IsConnected.Should().BeFalse();
104              handler.ShowContent.Should().BeTrue();
105              updateCounter.Should().Be(1);
106          }
107          [Test]
108          [Obsolete]
109          public async Task MudPopoverHandler_UpdateFragmentAsync()
110          {
111              var mock = Mock.Of<IJSRuntime>();
112              var updateCounter = 0;
113              RenderFragment initialRenderFragment = _ => { };
114              RenderFragment newRenderFragment = _ => { };
115              void Updater() => updateCounter++;
116              var handler = new MudPopoverHandler(initialRenderFragment, mock, Updater);
117              var comp = Context.RenderComponent<MudBadge>(p =>
118              {
119                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
120                  p.Add(x => x.Tag, "my tag");
121              });
122              await handler.UpdateFragmentAsync(newRenderFragment, comp.Instance, "my-extra-class", "my-extra-style:2px", true);
123              handler.Id.Should().NotBe(default(Guid));
124              handler.UserAttributes.Should().BeEquivalentTo(new Dictionary<string, object> { { "myprop1", "myValue1" } });
125              handler.Class.Should().Be("my-extra-class");
126              handler.Style.Should().Be("my-extra-style:2px");
127              handler.Tag.Should().Be("my tag");
128              handler.Fragment.Should().BeSameAs(newRenderFragment);
129              handler.IsConnected.Should().BeFalse();
130              handler.ShowContent.Should().BeTrue();
131              updateCounter.Should().Be(1);
132          }
133          [Test]
134          [Obsolete]
135          public async Task MudPopoverHandler_DetachAndUpdateFragmentAsync()
136          {
137              var mock = Mock.Of<IJSRuntime>();
138              var updateCounter = 0;
139              RenderFragment initialRenderFragment = _ => { };
140              RenderFragment newRenderFragment = _ => { };
141              void Updater() => updateCounter++;
142              var handler = new MudPopoverHandler(initialRenderFragment, mock, Updater);
143              var comp = Context.RenderComponent<MudBadge>(p =>
144              {
145                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
146                  p.Add(x => x.Tag, "my tag");
147              });
148              await handler.Detach();
149              await handler.UpdateFragmentAsync(newRenderFragment, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
150              updateCounter.Should().Be(0);
151          }
152          [Test]
153          [Obsolete]
154          public async Task MudPopoverHandler_DetachAndUpdateFragmentConcurrent_UpdateFragmentDoesNotRunInTheSameTimeAsDetach()
155          {
156              var connectTcs = new TaskCompletionSource<IJSVoidResult>();
157              var mock = new Mock<IJSRuntime>();
158              var handler = new MudPopoverHandler((tree) => { }, mock.Object, () => { });
159              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.connect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
160                  .ReturnsAsync(Mock.Of<IJSVoidResult>())
161                  .Verifiable();
162              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.disconnect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
163                  .Returns(new ValueTask<IJSVoidResult>(connectTcs.Task))
164                  .Verifiable();
165              var comp = Context.RenderComponent<MudBadge>(p =>
166              {
167                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
168                  p.Add(x => x.Tag, "my tag");
169              });
170              RenderFragment newRenderFragement = (tree) => { };
171              await handler.Initialize();
172              _ = handler.Detach();
173              var task2 = handler.UpdateFragmentAsync(newRenderFragement, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
174              var completedTask = await Task.WhenAny(Task.Delay(50), task2);
175              completedTask.Should().NotBe(task2);
176              mock.Verify();
177              mock.VerifyNoOtherCalls();
178          }
179          [Test]
180          [Obsolete]
181          public async Task MudPopoverHandler_DetachAndUpdateFragmentConcurrent_UpdateFragmentAsyncShouldRunAfterDetach()
182          {
183              var connectTcs = new TaskCompletionSource<IJSVoidResult>();
184              var mock = new Mock<IJSRuntime>();
185              var handler = new MudPopoverHandler(_ => { }, mock.Object, () => { });
186              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.connect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
187                  .ReturnsAsync(Mock.Of<IJSVoidResult>())
188                  .Verifiable();
189              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.disconnect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
190                  .Returns(new ValueTask<IJSVoidResult>(connectTcs.Task))
191                  .Verifiable();
192              var comp = Context.RenderComponent<MudBadge>(p =>
193              {
194                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
195                  p.Add(x => x.Tag, "my tag");
196              });
197              RenderFragment newRenderFragement = (tree) => { };
198              await handler.Initialize();
199              var task1 = handler.Detach();
200              var task2 = handler.UpdateFragmentAsync(newRenderFragement, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
201              connectTcs.SetResult(Mock.Of<IJSVoidResult>());
202              await Task.WhenAll(task1, task2);
203              mock.Verify();
204              mock.VerifyNoOtherCalls();
205          }
206          [Test(Description = "Remove in v7")]
207          [Obsolete]
208          public void MudPopoverHandler_UpdaterInvokationTest()
209          {
210              RenderFragment initialRenderFragement = (tree) => { };
211              var mock = Mock.Of<IJSRuntime>();
212              var updateCounter = 0;
213              Action updater = () => { updateCounter++; };
214              var handler = new MudPopoverHandler(initialRenderFragement, mock, updater);
215              var comp = Context.RenderComponent<MudBadge>(p =>
216              {
217                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
218                  p.Add(x => x.Tag, "my tag");
219              });
220              RenderFragment newRenderFragement = (tree) => { };
221              for (int i = 0; i < 4; i++)
222              {
223                  handler.UpdateFragment(newRenderFragement, comp.Instance, "my-extra-class", "my-extra-style:2px", i % 2 == 0);
224              }
225              updateCounter.Should().Be(4);
226              handler.UpdateFragment(newRenderFragement, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
227              updateCounter.Should().Be(5);
228              handler.Class.Should().Be("my-new-extra-class");
229              handler.Style.Should().Be("my-new-extra-style:2px");
230          }
231          [Test]
232          [Obsolete]
233          public async Task MudPopoverHandler_UpdaterInvocationAsync()
234          {
235              var mock = Mock.Of<IJSRuntime>();
236              var updateCounter = 0;
237              RenderFragment initialRenderFragment = _ => { };
238              RenderFragment newRenderFragment = _ => { };
239              void Updater() => updateCounter++;
240              var handler = new MudPopoverHandler(initialRenderFragment, mock, Updater);
241              var comp = Context.RenderComponent<MudBadge>(p =>
242              {
243                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
244                  p.Add(x => x.Tag, "my tag");
245              });
246              for (int i = 0; i < 4; i++)
247              {
248                 await handler.UpdateFragmentAsync(newRenderFragment, comp.Instance, "my-extra-class", "my-extra-style:2px", i % 2 == 0);
249              }
250              updateCounter.Should().Be(4);
251              await handler.UpdateFragmentAsync(newRenderFragment, comp.Instance, "my-new-extra-class", "my-new-extra-style:2px", true);
252              updateCounter.Should().Be(5);
253              handler.Class.Should().Be("my-new-extra-class");
254              handler.Style.Should().Be("my-new-extra-style:2px");
255          }
256          [Test]
257          [Obsolete]
258          public async Task MudPopoverHandler_InitializeAndDetach()
259          {
260              var handlerId = Guid.NewGuid();
261              RenderFragment renderFragement = (tree) => { };
262              var mock = new Mock<IJSRuntime>();
263              mock.Setup(x =>
264              x.InvokeAsync<IJSVoidResult>(
265                  "mudPopover.connect",
266                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
267              mock.Setup(x =>
268              x.InvokeAsync<IJSVoidResult>(
269                  "mudPopover.disconnect",
270                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
271              var updateCounter = 0;
272              Action updater = () => { updateCounter++; };
273              var handler = new MudPopoverHandler(renderFragement, mock.Object, updater);
274              handlerId = handler.Id;
275              handler.IsConnected.Should().BeFalse();
276              await handler.Initialize();
277              handler.IsConnected.Should().BeTrue();
278              await handler.Detach();
279              handler.IsConnected.Should().BeFalse();
280          }
281          [Test]
282          [Obsolete]
283          public async Task MudPopoverHandler_InitializeAndDetach_DetachThrowsTaskCanceledException()
284          {
285              var handlerId = Guid.NewGuid();
286              RenderFragment renderFragement = (tree) => { };
287              var mock = new Mock<IJSRuntime>();
288              mock.Setup(x =>
289              x.InvokeAsync<IJSVoidResult>(
290                  "mudPopover.connect",
291                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
292              mock.Setup(x =>
293              x.InvokeAsync<IJSVoidResult>(
294                  "mudPopover.disconnect",
295                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ThrowsAsync(new TaskCanceledException()).Verifiable();
296              var updateCounter = 0;
297              Action updater = () => { updateCounter++; };
298              var handler = new MudPopoverHandler(renderFragement, mock.Object, updater);
299              handlerId = handler.Id;
300              await handler.Initialize();
301              await handler.Detach();
302              handler.IsConnected.Should().BeFalse();
303          }
304          [Test]
305          [Obsolete]
306          public async Task MudPopoverHandler_InitializeAndDetach_DetachThrowsNotTaskCanceledException()
307          {
308              var handlerId = Guid.NewGuid();
309              RenderFragment renderFragement = (tree) => { };
310              var mock = new Mock<IJSRuntime>();
311              mock.Setup(x =>
312              x.InvokeAsync<IJSVoidResult>(
313                  "mudPopover.connect",
314                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
315              mock.Setup(x =>
316              x.InvokeAsync<IJSVoidResult>(
317                  "mudPopover.disconnect",
318                  It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId))).ThrowsAsync(new InvalidOperationException()).Verifiable();
319              var updateCounter = 0;
320              Action updater = () => { updateCounter++; };
321              var handler = new MudPopoverHandler(renderFragement, mock.Object, updater);
322              handlerId = handler.Id;
323              await handler.Initialize();
324              Assert.ThrowsAsync<InvalidOperationException>(async () => await handler.Detach());
325              handler.IsConnected.Should().BeFalse();
326          }
327          [Test]
328          [Obsolete]
329          public async Task MudPopoverHandler_InitializeAndDetachConcurrent_DetachDoesNotRunAtSameTimeAsInitialize()
330          {
331              var connectTcs = new TaskCompletionSource<IJSVoidResult>();
332              var mock = new Mock<IJSRuntime>();
333              var handler = new MudPopoverHandler(_ => { }, mock.Object, () => { });
334              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.connect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
335                  .Returns(new ValueTask<IJSVoidResult>(connectTcs.Task))
336                  .Verifiable();
337              _ = handler.Initialize();
338              var task2 = handler.Detach();
339              var completedTask = await Task.WhenAny(Task.Delay(50), task2);
340              completedTask.Should().NotBe(task2);
341              mock.Verify();
342              mock.VerifyNoOtherCalls();
343          }
344          [Test]
345          [Obsolete]
346          public async Task MudPopoverHandler_InitializeAndDetachConcurrent_DetachRunsAfterInitialize()
347          {
348              var connectTcs = new TaskCompletionSource<IJSVoidResult>();
349              var mock = new Mock<IJSRuntime>();
350              var handler = new MudPopoverHandler(_ => { }, mock.Object, () => { });
351              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.connect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
352                  .Returns(new ValueTask<IJSVoidResult>(connectTcs.Task))
353                  .Verifiable();
354              mock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudPopover.disconnect", It.Is<object[]>(y => y.Length == 1 && (Guid)y[0] == handler.Id)))
355                  .ReturnsAsync(Mock.Of<IJSVoidResult>())
356                  .Verifiable();
357              var task1 = handler.Initialize();
358              var task2 = handler.Detach();
359              connectTcs.SetResult(Mock.Of<IJSVoidResult>());
360              await Task.WhenAll(task1, task2);
361              mock.Verify();
362              mock.VerifyNoOtherCalls();
363          }
364          [Test]
365          [Obsolete]
366          public async Task MudPopoverHandler_DetachCalledBeforeInitialize_NoInteropShouldOccur()
367          {
368              var mock = new Mock<IJSRuntime>();
369              var handler = new MudPopoverHandler(_ => { }, mock.Object, () => { });
370              await handler.Detach();
371              handler.IsConnected.Should().BeFalse();
372              await handler.Initialize();
373              handler.IsConnected.Should().BeFalse();
374              mock.VerifyNoOtherCalls();
375          }
376          [Test]
377          [Obsolete]
378          public void MudPopoverService_Constructor_NoJsInterop()
379          {
380              Assert.Throws<ArgumentNullException>(() => _ = new MudPopoverService(null));
381          }
382          [Test]
383          [Obsolete]
384          public async Task MudPopoverService_Constructor_NullOption()
385          {
386              var mock = new Mock<IJSRuntime>();
387              mock.Setup(x =>
388             x.InvokeAsync<IJSVoidResult>(
389                 "mudPopover.initialize",
390                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
391              {
392                  var service = new MudPopoverService(mock.Object, null);
393                  await service.InitializeIfNeeded();
394              }
395              {
396                  var service = new MudPopoverService(mock.Object);
397                  await service.InitializeIfNeeded();
398              }
399              mock.Verify();
400          }
401          [Test]
402          [Obsolete]
403          public async Task MudPopoverService_Initialize_Catch_JSDisconnectedException()
404          {
405              var mock = new Mock<IJSRuntime>();
406              mock.Setup(x =>
407             x.InvokeAsync<IJSVoidResult>(
408                 "mudPopover.initialize",
409                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ThrowsAsync(new JSDisconnectedException("JSDisconnectedException")).Verifiable();
410              {
411                  var service = new MudPopoverService(mock.Object);
412                  await service.InitializeIfNeeded();
413              }
414              mock.Verify();
415          }
416          [Test]
417          [Obsolete]
418          public async Task MudPopoverService_Initialize_Catch_TaskCanceledException()
419          {
420              var mock = new Mock<IJSRuntime>();
421              mock.Setup(x =>
422             x.InvokeAsync<IJSVoidResult>(
423                 "mudPopover.initialize",
424                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ThrowsAsync(new TaskCanceledException()).Verifiable();
425              {
426                  var service = new MudPopoverService(mock.Object);
427                  await service.InitializeIfNeeded();
428              }
429              mock.Verify();
430          }
431          [Test]
432          [Obsolete]
433          public async Task MudPopoverService_Constructor_OptionWithCustomClass()
434          {
435              var mock = new Mock<IJSRuntime>();
436              var option = new PopoverOptions
437              {
438                  ContainerClass = "my-custom-class",
439                  FlipMargin = 12,
440              };
441              var optionMock = new Mock<IOptions<PopoverOptions>>();
442              optionMock.SetupGet(x => x.Value).Returns(option);
443              mock.Setup(x =>
444             x.InvokeAsync<IJSVoidResult>(
445                 "mudPopover.initialize",
446                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "my-custom-class" && (int)x[1] == 12))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
447              var service = new MudPopoverService(mock.Object, optionMock.Object);
448              await service.InitializeIfNeeded();
449              mock.Verify();
450          }
451          [Test]
452          [Obsolete]
453          public async Task MudPopoverService_CallInitializeOnlyOnce()
454          {
455              var mock = new Mock<IJSRuntime>();
456              mock.Setup(x =>
457             x.InvokeAsync<IJSVoidResult>(
458                 "mudPopover.initialize",
459                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>(), TimeSpan.FromMilliseconds(300)).Verifiable();
460              Task[] tasks = new Task[5];
461              var service = new MudPopoverService(mock.Object);
462              for (int i = 0; i < 5; i++)
463              {
464                  tasks[i] = Task.Run(async () => await service.InitializeIfNeeded());
465              }
466              Task.WaitAll(tasks);
467              mock.Verify(x =>
468             x.InvokeAsync<IJSVoidResult>(
469                 "mudPopover.initialize",
470                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0)), Times.Once());
471          }
472          [Test]
473          [Obsolete]
474          public async Task MudPopoverService_OnlyDisposeIfConnected()
475          {
476              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
477              await service.DisposeAsync();
478          }
479          [Test]
480          [Obsolete]
481          public async Task MudPopoverService_DisposeAsync()
482          {
483              var mock = new Mock<IJSRuntime>();
484              mock.Setup(x =>
485             x.InvokeAsync<IJSVoidResult>(
486                 "mudPopover.initialize",
487                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
488              mock.Setup(x =>
489              x.InvokeAsync<IJSVoidResult>(
490              "mudPopover.dispose",
491              It.Is<object[]>(x => x.Length == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
492              var service = new MudPopoverService(mock.Object);
493              await service.InitializeIfNeeded();
494              await service.DisposeAsync();
495              mock.Verify();
496          }
497          [Test]
498          [Obsolete]
499          public async Task MudPopoverService_DisposeAsync_WithTaskCancelException()
500          {
501              var mock = new Mock<IJSRuntime>();
502              mock.Setup(x =>
503             x.InvokeAsync<IJSVoidResult>(
504                 "mudPopover.initialize",
505                 It.Is<object[]>(x => x.Length == 2 && (string)x[0] == "mudblazor-main-content" && (int)x[1] == 0))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
506              mock.Setup(x =>
507              x.InvokeAsync<IJSVoidResult>(
508              "mudPopover.dispose",
509              It.Is<object[]>(x => x.Length == 0))).ThrowsAsync(new TaskCanceledException()).Verifiable();
510              var service = new MudPopoverService(mock.Object);
511              await service.InitializeIfNeeded();
512              await service.DisposeAsync();
<span onclick='openModal()' class='match'>513              mock.Verify();
514          }
515          [Test(Description = "Remove in v7")]
516          [Obsolete]
517          public void MudPopoverService_RegisterAndUseHandler()
518          {
519              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
</span>520              int fragmentChangedCounter = 0;
521              service.FragmentsChanged += (e, args) =>
522              {
523                  fragmentChangedCounter++;
524              };
525              RenderFragment fragment = (builder) => { };
526              var handler = service.Register(fragment);
527              handler.Should().NotBeNull();
528              fragmentChangedCounter.Should().Be(1);
529              RenderFragment changedFragment = (builder) => { };
530              var comp = Context.RenderComponent<MudBadge>(p =>
531              {
532                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
533                  p.Add(x => x.Tag, "my tag");
534              });
535              handler.UpdateFragment(changedFragment, comp.Instance, "my-class", "my-style", true);
536              fragmentChangedCounter.Should().Be(1);
537          }
538          [Test]
539          [Obsolete]
540          public async Task MudPopoverService_RegisterAndUseHandlerAsync()
541          {
542              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
543              int fragmentChangedCounter = 0;
544              service.FragmentsChanged += (_, _) =>
545              {
546                  fragmentChangedCounter++;
547              };
548              RenderFragment fragment = _ => { };
549              RenderFragment changedFragment = _ => { };
550              var handler = service.Register(fragment);
551              handler.Should().NotBeNull();
552              fragmentChangedCounter.Should().Be(1);
553              var comp = Context.RenderComponent<MudBadge>(p =>
554              {
555                  p.Add(x => x.UserAttributes, new Dictionary<string, object> { { "myprop1", "myValue1" } });
556                  p.Add(x => x.Tag, "my tag");
557              });
558              await handler.UpdateFragmentAsync(changedFragment, comp.Instance, "my-class", "my-style", true);
559              fragmentChangedCounter.Should().Be(1);
560          }
561          [Test]
562          [Obsolete]
563          public async Task MudPopoverService_Unregister_NullFragment()
564          {
565              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
566              var result = await service.Unregister(null);
567              result.Should().BeFalse();
568          }
569          [Test]
570          [Obsolete]
571          public async Task MudPopoverService_Unregister_HandlerNotFound()
572          {
573              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
574              var handler = new MudPopoverHandler((tree) => { }, Mock.Of<IJSRuntime>(MockBehavior.Strict), () => { });
575              var result = await service.Unregister(handler);
576              result.Should().BeFalse();
577          }
578          [Test]
579          [Obsolete]
580          public async Task MudPopoverService_Unregister_NotConnected()
581          {
582              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
583              RenderFragment fragment = (builder) => { };
584              var handler = service.Register(fragment);
585              var result = await service.Unregister(handler);
586              result.Should().BeTrue();
587          }
588          [Test]
589          [Obsolete]
590          public async Task MudPopoverService_Unregister()
591          {
592              var handlerId = Guid.NewGuid();
593              var mock = new Mock<IJSRuntime>();
594              mock.Setup(jsRuntime =>
595                      jsRuntime.InvokeAsync<IJSVoidResult>(
596                          "mudPopover.connect",
597                          It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId)))
598                  .ReturnsAsync(Mock.Of<IJSVoidResult>)
599                  .Verifiable();
600              mock.Setup(jsRuntime =>
601                      jsRuntime.InvokeAsync<IJSVoidResult>(
602                          "mudPopover.disconnect",
603                          It.Is<object[]>(x => x.Length == 1 && (Guid)x[0] == handlerId)))
604                  .ReturnsAsync(Mock.Of<IJSVoidResult>)
605                  .Verifiable();
606              var service = new MudPopoverService(mock.Object);
607              await service.InitializeIfNeeded();
608              RenderFragment fragment = (builder) => { };
609              var handler = service.Register(fragment);
610              handlerId = handler.Id;
611              await handler.Initialize();
612              int fragmentChangedCounter = 0;
613              service.FragmentsChanged += (_, _) =>
614              {
615                  fragmentChangedCounter++;
616              };
617              var result = await service.Unregister(handler);
618              result.Should().BeTrue();
619              fragmentChangedCounter.Should().Be(1);
620              var secondResult = await service.Unregister(handler);
621              secondResult.Should().BeFalse();
622              mock.Verify();
623          }
624          [Test]
625          public void MudPopover_DefaultValues()
626          {
627              var popover = new MudPopover();
628              popover.MaxHeight.Should().BeNull();
629              popover.Paper.Should().BeTrue();
630              popover.Elevation.Should().Be(8);
631              popover.Square.Should().BeFalse();
632              popover.Open.Should().BeFalse();
633              popover.Fixed.Should().BeFalse();
634              popover.AnchorOrigin.Should().Be(Origin.TopLeft);
635              popover.TransformOrigin.Should().Be(Origin.TopLeft);
636              popover.RelativeWidth.Should().BeFalse();
637              popover.OverflowBehavior.Should().Be(OverflowBehavior.FlipOnOpen);
638              popover.Duration.Should().Be(251);
639          }
640          [Test]
641          public async Task MudPopover_OpenAndClose()
642          {
643              var comp = Context.RenderComponent<PopoverTest>();
644              var provider = comp.Find(".mud-popover-provider");
645              provider.Children.Should().ContainSingle();
646              var popoverNode = comp.Find(".popoverparent").Children[1];
647              popoverNode.Id.Should().StartWith("popover-");
648              var handlerId = Guid.Parse(popoverNode.Id.Substring(8));
649              handlerId.Should().NotBe(Guid.Empty);
650              provider.Children.Should().ContainSingle();
651              provider.FirstElementChild.Id.Should().Be($"popovercontent-{handlerId}");
652              provider.FirstElementChild.Children.Should().BeEmpty();
653              await comp.Instance.Open();
654              provider.FirstElementChild.Children.Should().ContainSingle();
655              provider.FirstElementChild.Children[0].TextContent.Should().Be("Popover content");
656              await comp.Instance.Close();
657              provider.FirstElementChild.Children.Should().BeEmpty();
658          }
659          [Test]
660          public void MudPopover_Property_MaxHeight()
661          {
662              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(x => x.MaxHeight, 100));
663              var popoverElement = comp.Find(".test-popover-content").ParentElement;
664              popoverElement.GetAttribute("style").Split(';', StringSplitOptions.RemoveEmptyEntries).Should().Contain(new[] { "max-height:100px", "my-custom-style:3px" });
665          }
666          [Test]
667          public void MudPopover_Property_TransitionDuration()
668          {
669              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(x => x.Duration, 100));
670              var popoverElement = comp.Find(".test-popover-content").ParentElement;
671              popoverElement.GetAttribute("style").Split(';', StringSplitOptions.RemoveEmptyEntries).Should().Contain(new[] { "transition-duration:100ms" });
672          }
673          [Test]
674          public void MudPopover_Property_Fixed()
675          {
676              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
677                  x => x.Fixed, true));
678              var popoverElement = comp.Find(".test-popover-content").ParentElement;
679              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-popover-fixed", "my-custom-class" });
680          }
681          [Test]
682          public void MudPopover_Property_RelativeWidth()
683          {
684              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
685                  x => x.RelativeWidth, true));
686              var popoverElement = comp.Find(".test-popover-content").ParentElement;
687              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-popover-relative-width", "my-custom-class" });
688          }
689          [Test]
690          public void MudPopover_Property_Paper()
691          {
692              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
693                  x => x.Paper, true));
694              var popoverElement = comp.Find(".test-popover-content").ParentElement;
695              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-paper", "mud-elevation-8", "my-custom-class" });
696          }
697          [Test]
698          public void MudPopover_Property_PaperAndSqaure()
699          {
700              var comp = Context.RenderComponent<PopoverPropertyTest>(p =>
701              {
702                  p.Add(x => x.Paper, true);
703                  p.Add(x => x.Square, true);
704              });
705              var popoverElement = comp.Find(".test-popover-content").ParentElement;
706              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-paper-square", "mud-elevation-8", "my-custom-class" });
707          }
708          [Test]
709          public void MudPopover_Property_Elevation()
710          {
711              var comp = Context.RenderComponent<PopoverPropertyTest>(p =>
712              {
713                  p.Add(x => x.Paper, true);
714                  p.Add(x => x.Elevation, 10);
715              });
716              var popoverElement = comp.Find(".test-popover-content").ParentElement;
717              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", "mud-paper", "mud-elevation-10", "my-custom-class" });
718          }
719          [Test]
720          [TestCase(Origin.BottomCenter, "bottom-center")]
721          [TestCase(Origin.BottomLeft, "bottom-left")]
722          [TestCase(Origin.BottomRight, "bottom-right")]
723          [TestCase(Origin.CenterCenter, "center-center")]
724          [TestCase(Origin.CenterLeft, "center-left")]
725          [TestCase(Origin.CenterRight, "center-right")]
726          [TestCase(Origin.TopCenter, "top-center")]
727          [TestCase(Origin.TopLeft, "top-left")]
728          [TestCase(Origin.TopRight, "top-right")]
729          public void MudPopover_Property_TransformOrigin(Origin transformOrigin, string expectedClass)
730          {
731              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
732                  x => x.TransformOrigin, transformOrigin));
733              var popoverElement = comp.Find(".test-popover-content").ParentElement;
734              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", $"mud-popover-{expectedClass}", "my-custom-class" });
735          }
736          [Test]
737          [TestCase(Origin.BottomCenter, "bottom-center")]
738          [TestCase(Origin.BottomLeft, "bottom-left")]
739          [TestCase(Origin.BottomRight, "bottom-right")]
740          [TestCase(Origin.CenterCenter, "center-center")]
741          [TestCase(Origin.CenterLeft, "center-left")]
742          [TestCase(Origin.CenterRight, "center-right")]
743          [TestCase(Origin.TopCenter, "top-center")]
744          [TestCase(Origin.TopLeft, "top-left")]
745          [TestCase(Origin.TopRight, "top-right")]
746          public void MudPopover_Property_AnchorOrigin(Origin anchorOrigin, string expectedClass)
747          {
748              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
749                  x => x.AnchorOrigin, anchorOrigin));
750              var popoverElement = comp.Find(".test-popover-content").ParentElement;
751              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", $"mud-popover-anchor-{expectedClass}", "my-custom-class" });
752          }
753          [Test]
754          [TestCase(OverflowBehavior.FlipNever, "flip-never")]
755          [TestCase(OverflowBehavior.FlipOnOpen, "flip-onopen")]
756          [TestCase(OverflowBehavior.FlipAlways, "flip-always")]
757          public void MudPopover_Property_OverflowBehavior(OverflowBehavior overflowBehavior, string expectedClass)
758          {
759              var comp = Context.RenderComponent<PopoverPropertyTest>(p => p.Add(
760                  x => x.OverflowBehavior, overflowBehavior));
761              var popoverElement = comp.Find(".test-popover-content").ParentElement;
762              popoverElement.ClassList.Should().Contain(new[] { "mud-popover-open", $"mud-popover-overflow-{expectedClass}", "my-custom-class" });
763          }
764          [Test]
765          public async Task MudPopover_WithDynamicContent()
766          {
767              var comp = Context.RenderComponent<PopoverComplexContent>();
768              var dynamicContentElement = comp.Find(".dynamic-content");
769              dynamicContentElement.ChildNodes.Should().BeEmpty();
770              await comp.Instance.AddRow();
771              dynamicContentElement.ChildNodes.Should().ContainSingle();
772              dynamicContentElement.ChildNodes[0].TextContent.Should().Be("Popover content 0");
773              await comp.Instance.AddRow();
774              dynamicContentElement.ChildNodes.Should().HaveCount(2);
775              dynamicContentElement.ChildNodes[0].TextContent.Should().Be("Popover content 0");
776              dynamicContentElement.ChildNodes[1].TextContent.Should().Be("Popover content 1");
777              await comp.Instance.AddRow();
778              dynamicContentElement.ChildNodes.Should().HaveCount(3);
779              dynamicContentElement.ChildNodes[0].TextContent.Should().Be("Popover content 0");
780              dynamicContentElement.ChildNodes[1].TextContent.Should().Be("Popover content 1");
781              dynamicContentElement.ChildNodes[2].TextContent.Should().Be("Popover content 2");
782          }
783          [Test]
784          public void MudPopoverProvider_DefaultValue()
785          {
786              var provider = new MudPopoverProvider();
787              provider.IsEnabled.Should().BeTrue();
788          }
789          [Test]
790          public void MudPopoverProvider_RenderElementsBasedOnEnableState()
791          {
792              var comp = Context.RenderComponent<PopoverProviderTest>(p => p.Add(x => x.ProviderIsEnabled, true));
793              comp.Find("#my-content").TextContent.Should().Be("Popover content");
794              for (int i = 0; i < 3; i++)
795              {
796                  comp.SetParametersAndRender(p => p.Add(x => x.ProviderIsEnabled, false));
797                  Assert.Throws<ElementNotFoundException>(() => comp.Find("#my-content"));
798                  comp.SetParametersAndRender(p => p.Add(x => x.ProviderIsEnabled, true));
799                  comp.Find("#my-content").TextContent.Should().Be("Popover content");
800              }
801          }
802          [Test]
803          public void MudPopoverProvider_NoRenderWhenIsEnabledIsFalse()
804          {
805              var comp = Context.RenderComponent<PopoverProviderTest>(p => p.Add(x => x.ProviderIsEnabled, false));
806              Assert.Throws<ElementNotFoundException>(() => comp.Find("#my-content"));
807          }
808          [TestCase(false)]
809          [TestCase(true)]
810          public async Task MudPopoverProvider_ThrowOnDuplicate(bool ThrowOnDuplicateProvider)
811          {
812              var options = new PopoverOptions
813              {
814                  ThrowOnDuplicateProvider = ThrowOnDuplicateProvider
815              };
816              Context.Services.Configure<PopoverOptions>(x => x.ThrowOnDuplicateProvider = ThrowOnDuplicateProvider);
817              Context.JSInterop.Setup<int>("mudpopoverHelper.countProviders").SetResult(ThrowOnDuplicateProvider == true ? 2 : 1);
818              if (ThrowOnDuplicateProvider == true)
819              {
820                  var ex = Assert.Throws<InvalidOperationException>(() => Context.RenderComponent<PopoverDuplicationTest>());
821                  ex.Message.Should().StartWith("Duplicate MudPopoverProvider detected");
822              }
823              else
824              {
825                  var comp = Context.RenderComponent<PopoverDuplicationTest>();
826                  await comp.Instance.Open();
827                  await comp.Instance.Close();
828              }
829          }
830      }
831  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-PopoverTests.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-PopoverTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>204              mock.VerifyNoOtherCalls();
205          }
206          [Test(Description = "Remove in v7")]
207          [Obsolete]
208          public void MudPopoverHandler_UpdaterInvokationTest()
209          {
210              RenderFragment initialRenderFragement = (tree) => { };
</pre></code></div>
                <div class="column column_space"><pre><code>513              mock.Verify();
514          }
515          [Test(Description = "Remove in v7")]
516          [Obsolete]
517          public void MudPopoverService_RegisterAndUseHandler()
518          {
519              var service = new MudPopoverService(Mock.Of<IJSRuntime>(MockBehavior.Strict));
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    