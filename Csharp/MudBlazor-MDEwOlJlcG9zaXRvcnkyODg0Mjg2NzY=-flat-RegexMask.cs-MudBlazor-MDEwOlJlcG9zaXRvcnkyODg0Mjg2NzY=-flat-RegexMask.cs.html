
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 67, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-RegexMask.cs</h3>
            <pre><code>1  using System.Collections.Generic;
2  using System.Linq;
3  using System.Text;
4  using System.Text.RegularExpressions;
5  namespace MudBlazor;
6  public class RegexMask : BaseMask
7  {
8      private const string WhiteSpaceFilter = "(?!\\s)";
9      public RegexMask(string regex, string mask = null)
10      {
11          _regexPattern = regex;
12          Mask = mask ?? regex;
13      }
14      protected string _regexPattern;
15      protected Regex  _regex; 
16      public string Delimiters { get; protected set; }
17      protected override void InitInternals()
18      {
19          base.InitInternals();
20          Delimiters ??= "";
21          _delimiters = new HashSet<char>(Delimiters);
22          InitRegex();
23      }
24      protected virtual void InitRegex()
25      {
26          _regex = new Regex(_regexPattern);
27      }
28      public override void Insert(string input)
29      {
30          Init();
31          DeleteSelection(align: false);
32          var text = Text ?? "";
33          var pos = ConsolidateCaret(text, CaretPos);
34          (var beforeText, var afterText) = SplitAt(text, pos);
35          var alignedInput = AlignAgainstMask(beforeText + input);
36          CaretPos = alignedInput.Length;
37          UpdateText(AlignAgainstMask(alignedInput + afterText));
38      }
39      protected override void DeleteSelection(bool align)
40      {
41          ConsolidateSelection();
42          if (Selection == null)
43              return;
44          var sel = Selection.Value;
45          (var s1, _, var s3) = SplitSelection(Text, sel);
46          Selection = null;
47          CaretPos = sel.Item1;
48          if (!align)
49              UpdateText(s1 + s3);
50          else
51              UpdateText(AlignAgainstMask(s1 + s3));
52      }
53      public override void Delete()
54      {
55          Init();
56          if (Selection != null)
57          {
58              DeleteSelection(align: true);
59              return;
60          }
61          var text = Text ?? "";
62          var pos = ConsolidateCaret(text, CaretPos);
63          if (pos >= text.Length)
64              return;
65          (var beforeText, var afterText) = SplitAt(text, pos);
66          var restText = new string(afterText.SkipWhile(IsDelimiter).Skip(1).ToArray());
67          UpdateText( AlignAgainstMask(beforeText + restText));
68          var numDeleted = afterText.Length - restText.Length;
69          if (numDeleted > 1)
70          {
71              CaretPos += (numDeleted - 1);
72          }
73      }
74      public override void Backspace()
75      {
76          Init();
77          if (Selection != null)
78          {
79              DeleteSelection(align: true);
80              return;
81          }
82          var text = Text ?? "";
83          var pos = ConsolidateCaret(text, CaretPos);
84          if (pos == 0)
85              return;
86          (var beforeText, var afterText) = SplitAt(text, pos);
87          var restText = new string(beforeText.Reverse().SkipWhile(IsDelimiter).Skip(1).Reverse().ToArray());
88          var numDeleted = beforeText.Length - restText.Length;
89          CaretPos -= numDeleted;
90          UpdateText(AlignAgainstMask(restText + afterText));
91      }
92      protected virtual string AlignAgainstMask(string text)
93      {
94          text ??= "";
95          var alignedText = "";
96          var textIndex = 0; 
97          while (textIndex < text.Length)
98          {
99              var textChar = text[textIndex];
100              if (_regex.IsMatch(alignedText + textChar))
101                  alignedText += textChar;
102              else if (Delimiters.Length > 0)
103              {
104                  foreach (var d in Delimiters)
105                  {
106                      if (_regex.IsMatch(alignedText + d + textChar))
107                      {
108                          alignedText += (d.ToString() + textChar);
109                          break;
110                      }
111                  }
112              }
113              textIndex++;
114          }
115          return alignedText;
116      }
117      public override void UpdateFrom(IMask other)
118      {
119          base.UpdateFrom(other);
120          var o = other as RegexMask;
121          if (o == null)
122              return;
123          if (Delimiters != o.Delimiters)
124          {
125              Delimiters = o.Delimiters;
126              _initialized = false;
127          }
128          Refresh();
129      }
130      public static RegexMask IPv4(bool includePort = false, char maskChar = '0')
131      {
132          const string Octet = "25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{0,2}";
133          var ipv4 = $"(?:{Octet})(?:\\.(?:{Octet})){{0,3}}";
134          var delimiters = ".";
135          var octetMask = new string(maskChar, 3);
136          var mask = string.Join(delimiters, Enumerable.Repeat(octetMask, 4));
137          if (includePort)
138          {
139              const string IpPort =
140                  "(:|:(6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3}))?";
141              ipv4 = $"{ipv4}{IpPort}";
142              mask = $"{mask}:{new string(maskChar, 5)}";
143              delimiters += ":";
144          }
145          var regex = $"^{ipv4}{WhiteSpaceFilter}$";
146          var regexMask = new RegexMask(regex, mask) { Delimiters = delimiters };
147          return regexMask;
148      }
149      public static RegexMask IPv6(bool includePort = false, char maskChar = 'X', char portMaskChar = '0')
150      {
151          const string Hex = "[0-9A-Fa-f]{0,4}";
152          const string IPv6Filter = "(?!.*?[:]{2}?:)";
153          var ipv6 = $"{Hex}(:{Hex}){{0,7}}";
<span onclick='openModal()' class='match'>154          var delimiters = ":";
155          var hexMask = new string(maskChar, 4);
156          var mask = string.Join(delimiters, Enumerable.Repeat(hexMask, 8));
157          if (includePort)
158          {
159              const string IpPort =
160                  "(\\]|\\]:|\\]:(6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3}))?";
161              ipv6 = $"((\\[{ipv6}){IpPort})";
162              mask = $"[{mask}]:{new(portMaskChar, 5)}";
163              delimiters += "[]";
164          }
165          var regex = $"^{IPv6Filter}{ipv6}{WhiteSpaceFilter}$";
166          var regexMask = new RegexMask(regex, mask) { Delimiters = delimiters, AllowOnlyDelimiters = true };
</span>167          return regexMask;
168      }
169      public static RegexMask Email(string mask = "Ex. user@domain.com")
170      {
171          const string Regex = $"^(?>[\\w\\-\\+]+\\.?)+(?>@?|@)(?<!(\\.@))(?>\\w+\\.)*(\\w+)?{WhiteSpaceFilter}$";
172          const string Delimiters = "@.";
173          var regexMask = new RegexMask(Regex, mask) { Delimiters = Delimiters };
174          return regexMask;
175      }
176  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-RegexMask.cs</h3>
            <pre><code>1  using System.Collections.Generic;
2  using System.Linq;
3  using System.Text;
4  using System.Text.RegularExpressions;
5  namespace MudBlazor;
6  public class RegexMask : BaseMask
7  {
8      private const string WhiteSpaceFilter = "(?!\\s)";
9      public RegexMask(string regex, string mask = null)
10      {
11          _regexPattern = regex;
12          Mask = mask ?? regex;
13      }
14      protected string _regexPattern;
15      protected Regex  _regex; 
16      public string Delimiters { get; protected set; }
17      protected override void InitInternals()
18      {
19          base.InitInternals();
20          Delimiters ??= "";
21          _delimiters = new HashSet<char>(Delimiters);
22          InitRegex();
23      }
24      protected virtual void InitRegex()
25      {
26          _regex = new Regex(_regexPattern);
27      }
28      public override void Insert(string input)
29      {
30          Init();
31          DeleteSelection(align: false);
32          var text = Text ?? "";
33          var pos = ConsolidateCaret(text, CaretPos);
34          (var beforeText, var afterText) = SplitAt(text, pos);
35          var alignedInput = AlignAgainstMask(beforeText + input);
36          CaretPos = alignedInput.Length;
37          UpdateText(AlignAgainstMask(alignedInput + afterText));
38      }
39      protected override void DeleteSelection(bool align)
40      {
41          ConsolidateSelection();
42          if (Selection == null)
43              return;
44          var sel = Selection.Value;
45          (var s1, _, var s3) = SplitSelection(Text, sel);
46          Selection = null;
47          CaretPos = sel.Item1;
48          if (!align)
49              UpdateText(s1 + s3);
50          else
51              UpdateText(AlignAgainstMask(s1 + s3));
52      }
53      public override void Delete()
54      {
55          Init();
56          if (Selection != null)
57          {
58              DeleteSelection(align: true);
59              return;
60          }
61          var text = Text ?? "";
62          var pos = ConsolidateCaret(text, CaretPos);
63          if (pos >= text.Length)
64              return;
65          (var beforeText, var afterText) = SplitAt(text, pos);
66          var restText = new string(afterText.SkipWhile(IsDelimiter).Skip(1).ToArray());
67          UpdateText( AlignAgainstMask(beforeText + restText));
68          var numDeleted = afterText.Length - restText.Length;
69          if (numDeleted > 1)
70          {
71              CaretPos += (numDeleted - 1);
72          }
73      }
74      public override void Backspace()
75      {
76          Init();
77          if (Selection != null)
78          {
79              DeleteSelection(align: true);
80              return;
81          }
82          var text = Text ?? "";
83          var pos = ConsolidateCaret(text, CaretPos);
84          if (pos == 0)
85              return;
86          (var beforeText, var afterText) = SplitAt(text, pos);
87          var restText = new string(beforeText.Reverse().SkipWhile(IsDelimiter).Skip(1).Reverse().ToArray());
88          var numDeleted = beforeText.Length - restText.Length;
89          CaretPos -= numDeleted;
90          UpdateText(AlignAgainstMask(restText + afterText));
91      }
92      protected virtual string AlignAgainstMask(string text)
93      {
94          text ??= "";
95          var alignedText = "";
96          var textIndex = 0; 
97          while (textIndex < text.Length)
98          {
99              var textChar = text[textIndex];
100              if (_regex.IsMatch(alignedText + textChar))
101                  alignedText += textChar;
102              else if (Delimiters.Length > 0)
103              {
104                  foreach (var d in Delimiters)
105                  {
106                      if (_regex.IsMatch(alignedText + d + textChar))
107                      {
108                          alignedText += (d.ToString() + textChar);
109                          break;
110                      }
111                  }
112              }
113              textIndex++;
114          }
115          return alignedText;
116      }
117      public override void UpdateFrom(IMask other)
118      {
119          base.UpdateFrom(other);
120          var o = other as RegexMask;
121          if (o == null)
122              return;
123          if (Delimiters != o.Delimiters)
124          {
125              Delimiters = o.Delimiters;
126              _initialized = false;
127          }
128          Refresh();
129      }
130      public static RegexMask IPv4(bool includePort = false, char maskChar = '0')
131      {
132          const string Octet = "25[0-5]|2[0-4][0-9]|[0-1]?[0-9]{0,2}";
133          var ipv4 = $"(?:{Octet})(?:\\.(?:{Octet})){{0,3}}";
134          var delimiters = ".";
135          var octetMask = new string(maskChar, 3);
136          var mask = string.Join(delimiters, Enumerable.Repeat(octetMask, 4));
137          if (includePort)
138          {
139              const string IpPort =
140                  "(:|:(6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3}))?";
141              ipv4 = $"{ipv4}{IpPort}";
142              mask = $"{mask}:{new string(maskChar, 5)}";
143              delimiters += ":";
144          }
145          var regex = $"^{ipv4}{WhiteSpaceFilter}$";
146          var regexMask = new RegexMask(regex, mask) { Delimiters = delimiters };
147          return regexMask;
148      }
149      public static RegexMask IPv6(bool includePort = false, char maskChar = 'X', char portMaskChar = '0')
150      {
151          const string Hex = "[0-9A-Fa-f]{0,4}";
152          const string IPv6Filter = "(?!.*?[:]{2}?:)";
153          var ipv6 = $"{Hex}(:{Hex}){{0,7}}";
<span onclick='openModal()' class='match'>154          var delimiters = ":";
155          var hexMask = new string(maskChar, 4);
156          var mask = string.Join(delimiters, Enumerable.Repeat(hexMask, 8));
157          if (includePort)
158          {
159              const string IpPort =
160                  "(\\]|\\]:|\\]:(6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3}))?";
161              ipv6 = $"((\\[{ipv6}){IpPort})";
162              mask = $"[{mask}]:{new(portMaskChar, 5)}";
163              delimiters += "[]";
164          }
165          var regex = $"^{IPv6Filter}{ipv6}{WhiteSpaceFilter}$";
166          var regexMask = new RegexMask(regex, mask) { Delimiters = delimiters, AllowOnlyDelimiters = true };
</span>167          return regexMask;
168      }
169      public static RegexMask Email(string mask = "Ex. user@domain.com")
170      {
171          const string Regex = $"^(?>[\\w\\-\\+]+\\.?)+(?>@?|@)(?<!(\\.@))(?>\\w+\\.)*(\\w+)?{WhiteSpaceFilter}$";
172          const string Delimiters = "@.";
173          var regexMask = new RegexMask(Regex, mask) { Delimiters = Delimiters };
174          return regexMask;
175      }
176  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-RegexMask.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-RegexMask.cs</div>
                </div>
                <div class="column column_space"><pre><code>154          var delimiters = ":";
155          var hexMask = new string(maskChar, 4);
156          var mask = string.Join(delimiters, Enumerable.Repeat(hexMask, 8));
157          if (includePort)
158          {
159              const string IpPort =
160                  "(\\]|\\]:|\\]:(6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3}))?";
161              ipv6 = $"((\\[{ipv6}){IpPort})";
162              mask = $"[{mask}]:{new(portMaskChar, 5)}";
163              delimiters += "[]";
164          }
165          var regex = $"^{IPv6Filter}{ipv6}{WhiteSpaceFilter}$";
166          var regexMask = new RegexMask(regex, mask) { Delimiters = delimiters, AllowOnlyDelimiters = true };
</pre></code></div>
                <div class="column column_space"><pre><code>154          var delimiters = ":";
155          var hexMask = new string(maskChar, 4);
156          var mask = string.Join(delimiters, Enumerable.Repeat(hexMask, 8));
157          if (includePort)
158          {
159              const string IpPort =
160                  "(\\]|\\]:|\\]:(6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{0,3}))?";
161              ipv6 = $"((\\[{ipv6}){IpPort})";
162              mask = $"[{mask}]:{new(portMaskChar, 5)}";
163              delimiters += "[]";
164          }
165          var regex = $"^{IPv6Filter}{ipv6}{WhiteSpaceFilter}$";
166          var regexMask = new RegexMask(regex, mask) { Delimiters = delimiters, AllowOnlyDelimiters = true };
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    