
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 43.36569579288026%, Tokens: 20, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-DatePickerTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  #pragma warning disable BL0005 
3  using System;
4  using System.Collections.Generic;
5  using System.Diagnostics;
6  using System.Globalization;
7  using System.Linq;
8  using System.Threading.Tasks;
9  using AngleSharp.Dom;
10  using AngleSharp.Html.Dom;
11  using Bunit;
12  using FluentAssertions;
13  using Microsoft.AspNetCore.Components.Web;
14  using MudBlazor.UnitTests.TestComponents;
15  using MudBlazor.UnitTests.TestComponents.DatePicker;
16  using NUnit.Framework;
17  using static Bunit.ComponentParameterFactory;
18  namespace MudBlazor.UnitTests.Components
19  {
20      [TestFixture]
21      public class DatePickerTests : BunitTest
22      {
23          [Test]
24          public void Default()
25          {
26              var comp = Context.RenderComponent<MudDatePicker>();
27              var picker = comp.Instance;
28              picker.Text.Should().Be(null);
29              picker.Date.Should().Be(null);
30              picker.MaxDate.Should().Be(null);
31              picker.MinDate.Should().Be(null);
32              picker.OpenTo.Should().Be(OpenTo.Date);
33              picker.FirstDayOfWeek.Should().Be(null);
34              picker.ClosingDelay.Should().Be(100);
35              picker.DisplayMonths.Should().Be(1);
36              picker.MaxMonthColumns.Should().Be(null);
37              picker.StartMonth.Should().Be(null);
38              picker.ShowWeekNumbers.Should().BeFalse();
39              picker.AutoClose.Should().BeFalse();
40              picker.FixYear.Should().Be(null);
41              picker.FixMonth.Should().Be(null);
42              picker.FixDay.Should().Be(null);
43          }
44          [Test]
45          public void DatePickerOpenButtonAriaLabel()
46          {
47              var comp = Context.RenderComponent<DatePickerValidationTest>();
48              var openButton = comp.Find(".mud-input-adornment button");
49              openButton.Attributes.GetNamedItem("aria-label")?.Value.Should().Be("Open Date Picker");
50          }
51          [Test]
52          public void DatePickerLabelFor()
53          {
54              var comp = Context.RenderComponent<DatePickerValidationTest>();
55              var label = comp.Find(".mud-input-label");
56              label.Attributes.GetNamedItem("for")?.Value.Should().Be("datePickerLabelTest");
57          }
58          [Test]
59          [Ignore("Unignore for performance measurements, not needed for code coverage")]
60          public void DatePicker_Render_Performance()
61          {
62              Context.RenderComponent<MudDatePicker>();
63              var watch = Stopwatch.StartNew();
64              for (var i = 0; i < 1000; i++)
65                  Context.RenderComponent<MudDatePicker>();
66              watch.Stop();
67              watch.Elapsed.Should().BeLessThan(TimeSpan.FromSeconds(10));
68          }
69          [Test]
70          public async Task DatePicker_OpenClose_Performance()
71          {
72              var comp = Context.RenderComponent<MudDatePicker>();
73              var datepicker = comp.Instance;
74              var watch = Stopwatch.StartNew();
75              for (var i = 0; i < 1000; i++)
76              {
77                  await comp.InvokeAsync(() => datepicker.Open());
78                  await comp.InvokeAsync(() => datepicker.Close());
79              }
80              watch.Stop();
81              watch.Elapsed.Should().BeLessThan(TimeSpan.FromSeconds(10));
82          }
83          [Test]
84          public async Task SetPickerValue_CheckDate_SetPickerDate_CheckValue()
85          {
86              var comp = Context.RenderComponent<MudDatePicker>();
87              var picker = comp.Instance;
88              picker.Text.Should().Be(null);
89              picker.Date.Should().Be(null);
90              comp.SetParam(p => p.Text, new DateTime(2020, 10, 23).ToShortDateString());
91              picker.Date.Should().Be(new DateTime(2020, 10, 23));
92              comp.SetParam(p => p.Date, new DateTime(2020, 10, 26));
93              picker.Text.Should().Be(new DateTime(2020, 10, 26).ToShortDateString());
94          }
95          [Test]
96          public async Task DatePicker_Should_ApplyDateFormat()
97          {
98              var comp = Context.RenderComponent<MudDatePicker>();
99              var picker = comp.Instance;
100              picker.Text.Should().Be(null);
101              picker.Date.Should().Be(null);
102              comp.SetParam(p => p.DateFormat, "dd/MM/yyyy");
103              comp.SetParam(p => p.Culture, CultureInfo.InvariantCulture); 
104              comp.SetParam(p => p.Text, "23/10/2020");
105              picker.Date.Should().Be(new DateTime(2020, 10, 23));
106              comp.SetParam(p => p.Date, new DateTime(2020, 10, 26));
107              picker.Text.Should().Be("26/10/2020");
108          }
109          [Test]
110          public async Task DatePicker_Should_ApplyDateFormatAfterDate()
111          {
112              var comp = Context.RenderComponent<MudDatePicker>();
113              var picker = comp.Instance;
114              picker.Text.Should().Be(null);
115              picker.Date.Should().Be(null);
116              comp.SetParam(p => p.DateFormat, "dd/MM/yyyy");
117              comp.SetParam(p => p.Culture, CultureInfo.InvariantCulture); 
118              comp.SetParam(p => p.Date, new DateTime(2020, 10, 26));
119              picker.Date.Should().Be(new DateTime(2020, 10, 26));
120              picker.Text.Should().Be("26/10/2020");
121          }
122          [Test]
123          public async Task DatePicker_Should_ApplyCultureDateFormat()
124          {
125              var comp = Context.RenderComponent<MudDatePicker>();
126              var picker = comp.Instance;
127              picker.Text.Should().Be(null);
128              picker.Date.Should().Be(null);
129              var customCulture = new CultureInfo("en-US");
130              customCulture.DateTimeFormat.ShortDatePattern.Should().Be("M/d/yyyy");
131              customCulture.DateTimeFormat.ShortDatePattern = "dd MM yyyy";
132              comp.SetParam(p => p.Culture, customCulture);
133              comp.SetParam(p => p.Text, "23 10 2020");
134              picker.Date.Should().Be(new DateTime(2020, 10, 23));
135              comp.SetParam(p => p.Date, new DateTime(2020, 10, 26));
136              picker.Text.Should().Be("26 10 2020");
137              customCulture.DateTimeFormat.ShortDatePattern = "yyyy-MM-dd";
138              comp.SetParam(p => p.Text, "13 10 2020");
139              picker.Date.Should().Be(new DateTime(2020, 10, 13));
140              comp.SetParam(p => p.Date, new DateTime(2020, 10, 16));
141              picker.Text.Should().Be("16 10 2020");
142          }
143          [Test]
144          public async Task DatePicker_Should_DateFormatTakesPrecedenceOverCulture()
145          {
146              var comp = Context.RenderComponent<MudDatePicker>();
147              var picker = comp.Instance;
148              picker.Text.Should().Be(null);
149              picker.Date.Should().Be(null);
150              comp.SetParam(p => p.DateFormat, "dd MM yyyy");
151              comp.SetParam(p => p.Culture, CultureInfo.InvariantCulture); 
152              comp.SetParam(p => p.Date, new DateTime(2020, 10, 26));
153              picker.Date.Should().Be(new DateTime(2020, 10, 26));
154              picker.Text.Should().Be("26 10 2020");
155          }
156          [Test]
157          public async Task DatePicker_Should_Clear()
158          {
159              var comp = Context.RenderComponent<MudDatePicker>();
160              var picker = comp.Instance;
161              picker.Text.Should().Be(null);
162              picker.Date.Should().Be(null);
163              comp.SetParam(p => p.Clearable, true);
164              comp.SetParam(p => p.Date, new DateTime(2020, 10, 26));
165              picker.Date.Should().Be(new DateTime(2020, 10, 26));
166              picker.Text.Should().Be(new DateTime(2020, 10, 26).ToShortDateString());
167              comp.Find("button").Click(); 
168              picker.Text.Should().Be(""); 
169              picker.Date.Should().Be(null);
170          }
171          [Test]
172          public void Check_Intial_Date_Format()
173          {
174              DateTime? date = new DateTime(2021, 1, 13);
175              var comp = Context.RenderComponent<MudDatePicker>(parameters => parameters
176                  .Add(p => p.Culture, CultureInfo.InvariantCulture)
177                  .Add(p => p.DateFormat, "dd/MM/yyyy")
178                  .Add(p => p.Date, date)
179              );
180              var picker = comp.Instance;
181              var instance = comp.Instance;
182              picker.Date.Should().Be(new DateTime(2021, 1, 13));
183              picker.Text.Should().Be("13/01/2021");
184          }
185          public IRenderedComponent<SimpleMudDatePickerTest> OpenPicker(ComponentParameter parameter)
186          {
187              return OpenPicker(new ComponentParameter[] { parameter });
188          }
189          public IRenderedComponent<SimpleMudDatePickerTest> OpenPicker(ComponentParameter[] parameters = null)
190          {
191              IRenderedComponent<SimpleMudDatePickerTest> comp;
192              if (parameters is null)
193              {
194                  comp = Context.RenderComponent<SimpleMudDatePickerTest>();
195              }
196              else
197              {
198                  comp = Context.RenderComponent<SimpleMudDatePickerTest>(parameters);
199              }
200              comp.FindAll("div.mud-picker-open").Count.Should().Be(0);
201              comp.Find("input").Click();
202              comp.FindAll("div.mud-picker-open").Count.Should().Be(1);
203              return comp;
204          }
205          [Test]
206          public void Open_CloseByClickingOutsidePicker_CheckClosed()
207          {
208              var comp = OpenPicker();
209              comp.Find("div.mud-overlay").Click();
210              comp.FindAll("div.mud-picker-open").Count.Should().Be(0);
211          }
212          [Test]
213          public void Open_CloseBySelectingADate_CheckClosed()
214          {
215              var comp = OpenPicker();
216              comp.FindAll("button.mud-picker-calendar-day")
217                  .Where(x => x.TrimmedText().Equals("23")).First().Click();
218              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0), TimeSpan.FromSeconds(5));
219              comp.Instance.Date.Should().NotBeNull();
220          }
221          [Test]
222          public void Open_CloseBySelectingADate_CheckClosed_Check_DateChangedCount()
223          {
224              var eventCount = 0;
225              DateTime? returnDate = null;
226              var comp = OpenPicker(EventCallback(nameof(MudDatePicker.DateChanged), (DateTime? date) => { eventCount++; returnDate = date; }));
227              comp.FindAll("button.mud-picker-calendar-day")
228                  .Where(x => x.TrimmedText().Equals("23")).First().Click();
229              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0), TimeSpan.FromSeconds(5));
230              comp.Instance.Date.Should().NotBeNull();
231              eventCount.Should().Be(1);
232              var now = DateTime.Now;
233              returnDate.Should().Be(new DateTime(now.Year, now.Month, 23));
234          }
235          [Test]
236          public void OpenToYear_CheckYearsShown()
237          {
238              var comp = OpenPicker(Parameter("OpenTo", OpenTo.Year));
239              comp.Instance.Date.Should().BeNull();
240              comp.FindAll("div.mud-picker-year-container").Count.Should().Be(1);
241          }
242          [Test]
243          public void OpenToYear_ClickYear_CheckMonthsShown()
244          {
245              var comp = OpenPicker(Parameter("OpenTo", OpenTo.Year));
246              comp.Instance.Date.Should().BeNull();
247              comp.FindAll("div.mud-picker-year-container").Count.Should().Be(1);
248              comp.FindAll("div.mud-picker-year")[0].Click();
249              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
250          }
251          [Test]
252          public void OpenToYear_ClickYear_CheckMonthsShown_Close_Reopen_CheckYearsShown()
253          {
254              var comp = OpenPicker(Parameter("OpenTo", OpenTo.Year));
255              comp.Instance.Date.Should().BeNull();
256              comp.FindAll("div.mud-picker-year-container").Count.Should().Be(1);
257              comp.FindAll("div.mud-picker-year")[0].Click();
258              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
259              comp.Find("div.mud-overlay").Click();
260              comp.FindAll("div.mud-picker-open").Count.Should().Be(0);
261              comp.Find("input").Click();
262              comp.FindAll("div.mud-picker-year-container").Count.Should().Be(1);
263          }
264          [Test]
265          public void OpenToMonth_CheckMonthsShown()
266          {
267              var comp = OpenPicker(Parameter("OpenTo", OpenTo.Month));
268              comp.Instance.Date.Should().BeNull();
269              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
270          }
271          [Test]
272          public void Open_ClickCalendarHeader_CheckMonthsShown()
273          {
274              var comp = OpenPicker();
275              comp.FindAll("button.mud-picker-calendar-header-transition")[0].Click();
276              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
277          }
278          [Test]
279          public void Open_ClickYear_CheckYearsShown()
280          {
281              var comp = OpenPicker(Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month));
282              comp.FindAll("button.mud-picker-calendar-header-transition")[0].Click();
283              comp.FindAll("div.mud-picker-year-container").Count.Should().Be(1);
284          }
285          [Test]
286          public void OpenToMonth_Select3rdMonth_Select2ndDay_CheckDate()
287          {
288              var comp = OpenPicker(Parameter("OpenTo", OpenTo.Month));
289              comp.Instance.Date.Should().BeNull();
290              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
291              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-month-container > button.mud-picker-month")
292                  [2].Click();
293              comp.FindAll("button.mud-picker-calendar-day")
294                  .Where(x => x.TrimmedText().Equals("2")).First().Click();
295              comp.Instance.Date.Value.Date.Should().Be(new DateTime(DateTime.Now.Year, 3, 2));
296          }
297          public IRenderedComponent<SimpleMudDatePickerTest> OpenTo12thMonth()
298          {
299              var comp = OpenPicker(Parameter("PickerMonth", new DateTime(DateTime.Now.Year, 12, 01)));
300              comp.Instance.PickerMonth.Value.Month.Should().Be(12);
301              return comp;
302          }
303          [Test]
304          public void Open_ClickCalendarHeader_Click4thMonth_Click23rdDay_CheckDate()
305          {
306              var comp = OpenPicker();
307              var picker = comp.Instance;
308              comp.Find("button.mud-picker-calendar-header-transition").Click();
309              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
310              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-month-container > button.mud-picker-month")
311                  [3].Click();
312              comp.FindAll("button.mud-picker-calendar-day")
313                  .Where(x => x.TrimmedText().Equals("23")).First().Click();
314              comp.Instance.Date.Value.Date.Should().Be(new DateTime(DateTime.Now.Year, 4, 23));
315          }
316          [Test]
317          public void DatePickerStaticWithPickerActionsDayClick_Test()
318          {
319              var comp = Context.RenderComponent<DatePickerStaticTest>();
320              var picker = comp.FindComponent<MudDatePicker>();
321              comp.FindAll("button.mud-picker-calendar-day")
322                  .Where(x => x.TrimmedText().Equals("23")).First().Click();
323              picker.Instance.Date.Should().Be(new DateTime(DateTime.Now.Year, DateTime.Now.Month, 23));
324          }
325          [Test]
326          public void OpenTo12thMonth_NavigateBack_CheckMonth()
327          {
328              var comp = OpenTo12thMonth();
329              var picker = comp.Instance;
330              comp.Find("div.mud-picker-calendar-header-switch > button:nth-child(1)").Click();
331              picker.PickerMonth.Value.Month.Should().Be(11);
332              picker.PickerMonth.Value.Year.Should().Be(DateTime.Now.Year);
333          }
334          [Test]
335          public void OpenTo12thMonth_NavigateForward_CheckYear()
336          {
337              var comp = OpenTo12thMonth();
338              var picker = comp.Instance;
339              comp.Find("div.mud-picker-calendar-header-switch > button:nth-child(3)").Click();
340              picker.PickerMonth.Value.Month.Should().Be(1);
341              picker.PickerMonth.Value.Year.Should().Be(DateTime.Now.Year + 1);
342          }
343          [Test]
344          public void Open_ClickYear_ClickCurrentYear_Click2ndMonth_Click1_CheckDate()
345          {
346              var comp = OpenPicker();
347              comp.Find("div.mud-picker-datepicker-toolbar > button.mud-button-year").Click();
348              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container").Count.Should().Be(1);
349              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container > div.mud-picker-year")
350                  .Where(x => x.TrimmedText().Contains("2022")).First().Click();
351              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
352              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-month-container > button.mud-picker-month")[1].Click();
353              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-calendar-header").Count.Should().Be(1);
354              comp.FindAll("button.mud-picker-calendar-day")
355                  .Where(x => x.TrimmedText().Equals("1")).First().Click();
356              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 2, 1));
357          }
358          [Test]
359          public void Open_FixYear_Click2ndMonth_Click3_CheckDate()
360          {
361              var comp = OpenPicker(ComponentParameter.CreateParameter("FixYear", 2021));
362              comp.Find("div.mud-picker-datepicker-toolbar > button.mud-button-year").Click();
363              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container").Count.Should().Be(0);
364              comp.Find("div.mud-picker-calendar-container > .mud-picker-calendar-header > .mud-picker-calendar-header-switch > .mud-button-month").Click();
365              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
366              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-month-container > button.mud-picker-month")[1].Click();
367              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-calendar-header").Count.Should().Be(1);
368              comp.FindAll("button.mud-picker-calendar-day")
369                  .Where(x => x.TrimmedText().Equals("3")).First().Click();
370              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2021, 2, 3));
371          }
372          [Test]
373          public void Open_FixDay_ClickYear_Click2ndMonth_CheckDate()
374          {
375              var comp = OpenPicker(ComponentParameter.CreateParameter("FixDay", 1));
376              comp.Find("div.mud-picker-datepicker-toolbar > button.mud-button-year").Click();
377              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container").Count.Should().Be(1);
378              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container > div.mud-picker-year")
379                  .Where(x => x.TrimmedText().Contains("2022")).First().Click();
380              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
381              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-month-container > button.mud-picker-month")[1].Click();
382              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 2, 1));
383          }
384          [Test]
385          public void Open_FixMonth_ClickYear_Click3_CheckDate()
386          {
387              var comp = OpenPicker(ComponentParameter.CreateParameter("FixMonth", 1));
388              comp.FindAll("div.mud-picker-calendar-container > .mud-picker-calendar-header > .mud-picker-calendar-header-switch > .mud-button-month").Count().Should().Be(0);
389              comp.Find("div.mud-picker-datepicker-toolbar > button.mud-button-year").Click();
390              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container").Count.Should().Be(1);
391              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container > div.mud-picker-year")
392                  .Where(x => x.TrimmedText().Contains("2022")).First().Click();
393              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(0);
394              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-calendar-header").Count.Should().Be(1);
395              comp.FindAll("button.mud-picker-calendar-day")
396                  .Where(x => x.TrimmedText().Equals("3")).First().Click();
397              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 1, 3));
398          }
399          [Test]
400          public void Open_FixYear_FixMonth_Click3_CheckDate()
401          {
402              var comp = OpenPicker(new ComponentParameter[] { ComponentParameter.CreateParameter("FixMonth", 1), ComponentParameter.CreateParameter("FixYear", 2022) });
403              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container").Count.Should().Be(0);
404              comp.Find("div.mud-picker-datepicker-toolbar > button.mud-button-year").Click();
405              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container").Count.Should().Be(0);
406              comp.FindAll("div.mud-picker-calendar-container > .mud-picker-calendar-header > .mud-picker-calendar-header-switch > .mud-button-month").Count().Should().Be(0);
407              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-calendar-header").Count.Should().Be(1);
408              comp.FindAll("button.mud-picker-calendar-day")
409                  .Where(x => x.TrimmedText().Equals("3")).First().Click();
410              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 1, 3));
411          }
412          [Test]
413          public void Open_FixMonth_FixDay_ClickYear2022_CheckDate()
414          {
415              var comp = OpenPicker(new ComponentParameter[] { ComponentParameter.CreateParameter("OpenTo", OpenTo.Year), ComponentParameter.CreateParameter("FixMonth", 1), ComponentParameter.CreateParameter("FixDay", 1) });
416              comp.FindAll("div.mud-picker-calendar-container > .mud-picker-calendar-header > .mud-picker-calendar-header-switch > .mud-button-month").Count().Should().Be(0);
417              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container").Count.Should().Be(1);
418              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container > div.mud-picker-year")
419                  .Where(x => x.TrimmedText().Contains("2022")).First().Click();
420              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 1, 1));
421          }
422          [Test]
423          public void Open_FixYear_FixDay_Click3rdMonth_CheckDate()
424          {
425              var comp = OpenPicker(new ComponentParameter[] { ComponentParameter.CreateParameter("OpenTo", OpenTo.Month), ComponentParameter.CreateParameter("FixYear", 2022), ComponentParameter.CreateParameter("FixDay", 1) });
426              comp.Find("div.mud-picker-datepicker-toolbar > button.mud-button-year").Click();
427              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-year-container").Count.Should().Be(0);
428              comp.FindAll("div.mud-picker-month-container").Count.Should().Be(1);
429              comp.FindAll("div.mud-picker-calendar-container > div.mud-picker-month-container > button.mud-picker-month")[2].Click();
430              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 3, 1));
431          }
432          [Test]
433          public async Task Open_Programmatically_CheckOpen_Close_Programmatically_CheckClosed()
434          {
<span onclick='openModal()' class='match'>435              var comp = Context.RenderComponent<SimpleMudDatePickerTest>();
436              comp.FindAll("div.mud-picker-content").Count.Should().Be(0);
437              await comp.InvokeAsync(() => comp.Instance.Open());
438              comp.FindAll("div.mud-picker-content").Count.Should().Be(1);
439              await comp.InvokeAsync(() => comp.Instance.Close());
440              comp.FindAll("div.mud-picker-content").Count.Should().Be(0);
441          }
442          [Test]
443          public async Task PersianCalendar()
444          {
445              var cal = new PersianCalendar();
</span>446              var date = new DateTime(2021, 02, 14);
447              cal.GetYear(date).Should().Be(1399);
448              cal.GetMonth(date).Should().Be(11);
449              cal.GetDayOfMonth(date).Should().Be(26);
450              var comp = Context.RenderComponent<PersianDatePickerTest>();
451              var datePicker = comp.FindComponent<MudDatePicker>();
452              await comp.InvokeAsync(() => datePicker.Instance.Open());
453          }
454          [Test]
455          public void SetPickerValue_CheckText()
456          {
457              var date = DateTime.Now;
458              var comp = Context.RenderComponent<MudDatePicker>(
459                  Parameter(nameof(MudDatePicker.Date), date));
460              var picker = comp.Instance;
461              var text = date.ToShortDateString();
462              picker.Text.Should().Be(text);
463              ((IHtmlInputElement)comp.FindAll("input")[0]).Value.Should().Be(text);
464          }
465          [Test]
466          public void IsDateDisabledFunc_DisablesCalendarDateButtons()
467          {
468              Func<DateTime, bool> isDisabledFunc = date => true;
469              var comp = OpenPicker(Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc));
470              comp.Instance.IsDateDisabledFunc.Should().Be(isDisabledFunc);
471              comp.FindAll("button.mud-picker-calendar-day").Select(button => ((IHtmlButtonElement)button).IsDisabled)
472                  .Should().OnlyContain(disabled => disabled == true);
473          }
474          [Test]
475          public void IsDateDisabledFunc_DisablesCalendarMonthButtons()
476          {
477              Func<DateTime, bool> isDisabledFunc = date => true;
478              var comp = OpenPicker(new[]
479              {
480                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
481                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
482                  Parameter(nameof(MudDatePicker.FixDay), 1)
483              });
484              comp.Instance.IsDateDisabledFunc.Should().Be(isDisabledFunc);
485              comp.FindAll("button.mud-picker-month").Select(button => ((IHtmlButtonElement)button).IsDisabled)
486                  .Should().OnlyContain(disabled => disabled == true);
487              comp.FindAll("button.mud-picker-month > .mud-typography").Select(
488                  text => ((IHtmlElement)text).ClassList.Any(cls => cls == "mud-picker-month-select" || cls == "mud-primary-text"))
489                  .Should().OnlyContain(selected => selected == false);
490          }
491          [Test]
492          public void IsDateDisabledFunc_DoesNotHaveEffectOnMonthsIfDayNotFixed()
493          {
494              Func<DateTime, bool> isDisabledFunc = date => true;
495              var comp = OpenPicker(new[]
496              {
497                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
498                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month)
499              });
500              comp.Instance.IsDateDisabledFunc.Should().Be(isDisabledFunc);
501              comp.FindAll("button.mud-picker-month").Select(button => ((IHtmlButtonElement)button).IsDisabled)
502                  .Should().OnlyContain(disabled => disabled == false);
503          }
504          [Test]
505          public void IsDateDisabledFunc_DoesNotHaveEffectOnMonthsIfFuncReturnsFalse()
506          {
507              Func<DateTime, bool> isDisabledFunc = date => false;
508              var comp = OpenPicker(new[]
509              {
510                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
511                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
512                  Parameter(nameof(MudDatePicker.FixDay), 1)
513              });
514              comp.Instance.IsDateDisabledFunc.Should().Be(isDisabledFunc);
515              comp.FindAll("button.mud-picker-month").Select(button => ((IHtmlButtonElement)button).IsDisabled)
516                  .Should().OnlyContain(disabled => disabled == false);
517          }
518          [TestCase(10, 8, 2, 2)]
519          [TestCase(10, 9, 2, 2)]
520          [TestCase(10, 10, 2, 1)]
521          [TestCase(10, 11, 2, 1)]
522          public void MinDateEffectOnDisablingMonthsIfDayFixed(int minDatesDay, int fixedDay,
523              int month, int disabledOnes)
524          {
525              var currentDate = DateTime.Now;
526              var minDate = new DateTime(currentDate.Year, month, minDatesDay);
527              var comp = OpenPicker(new[]
528              {
529                  Parameter(nameof(MudDatePicker.MinDate), minDate),
530                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
531                  Parameter(nameof(MudDatePicker.FixDay), fixedDay),
532              });
533              var expectedResult = new bool[12];
534              for (var i = 0; i < disabledOnes; ++i) expectedResult[i] = true;
535              comp.Instance.MinDate.Should().Be(minDate);
536              comp.FindAll("button.mud-picker-month").Select(button => ((IHtmlButtonElement)button).IsDisabled)
537                  .Should().ContainInConsecutiveOrder(expectedResult);
538          }
539          [TestCase(10, 9, 11, 1)]
540          [TestCase(10, 10, 11, 1)]
541          [TestCase(10, 11, 11, 2)]
542          [TestCase(10, 12, 11, 2)]
543          public void MaxDateEffectOnDisablingMonthsIfDayFixed(int maxDatesDay, int fixedDay,
544              int month, int disabledOnes)
545          {
546              var currentDate = DateTime.Now;
547              var maxDate = new DateTime(currentDate.Year, month, maxDatesDay);
548              var comp = OpenPicker(new[]
549              {
550                  Parameter(nameof(MudDatePicker.MaxDate), maxDate),
551                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
552                  Parameter(nameof(MudDatePicker.FixDay), fixedDay),
553              });
554              var expectedResult = new bool[12];
555              for (var i = 0; i < disabledOnes; ++i) expectedResult[11 - i] = true;
556              comp.Instance.MaxDate.Should().Be(maxDate);
557              comp.FindAll("button.mud-picker-month").Select(button => ((IHtmlButtonElement)button).IsDisabled)
558                  .Should().ContainInConsecutiveOrder(expectedResult);
559          }
560          [TestCase(30, 3, 2)]
561          [TestCase(31, 3, 2)]
562          [TestCase(1, 4, 3)]
563          [TestCase(2, 4, 3)]
564          public void MinDateEffectOnDisablingMonthsIfDayNotFixed(int minDatesDay, int month, int disabledOnes)
565          {
566              var currentYear = DateTime.Now.Year;
567              var minDate = new DateTime(currentYear, month, minDatesDay);
568              var comp = OpenPicker(new[]
569              {
570                  Parameter(nameof(MudDatePicker.MinDate), minDate),
571                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
572              });
573              var expectedResult = new bool[12];
574              for (var i = 0; i < disabledOnes; ++i) expectedResult[i] = true;
575              comp.Instance.MinDate.Should().Be(minDate);
576              comp.FindAll("button.mud-picker-month").Select(button => ((IHtmlButtonElement)button).IsDisabled)
577                  .Should().ContainInConsecutiveOrder(expectedResult);
578          }
579          [TestCase(1, 10, 2)]
580          [TestCase(2, 10, 2)]
581          [TestCase(30, 9, 3)]
582          [TestCase(29, 9, 3)]
583          public void MaxDateEffectOnDisablingMonthsIfDayNotFixed(int maxDatesDay, int month, int disabledOnes)
584          {
585              var currentYear = DateTime.Now.Year;
586              var maxDate = new DateTime(currentYear, month, maxDatesDay);
587              var comp = OpenPicker(new[]
588              {
589                  Parameter(nameof(MudDatePicker.MaxDate), maxDate),
590                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
591              });
592              var expectedResult = new bool[12];
593              for (var i = 0; i < disabledOnes; ++i) expectedResult[11 - i] = true;
594              comp.Instance.MaxDate.Should().Be(maxDate);
595              comp.FindAll("button.mud-picker-month").Select(button => ((IHtmlButtonElement)button).IsDisabled)
596                  .Should().ContainInConsecutiveOrder(expectedResult);
597          }
598          [Test]
599          public void IsDateDisabledFunc_SettingDateToADisabledDateYieldsNull()
600          {
601              var wasEventCallbackCalled = false;
602              Func<DateTime, bool> isDisabledFunc = date => true;
603              var comp = Context.RenderComponent<MudDatePicker>(
604                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
605                  EventCallback("DateChanged", (DateTime? _) => wasEventCallbackCalled = true)
606              );
607              comp.SetParam(picker => picker.Date, DateTime.Now);
608              comp.Instance.Date.Should().BeNull();
609              wasEventCallbackCalled.Should().BeFalse();
610          }
611          [Test]
612          public void IsDateDisabledFunc_SettingDateToAnEnabledDateYieldsTheDate()
613          {
614              var wasEventCallbackCalled = false;
615              var today = DateTime.Today;
616              Func<DateTime, bool> isDisabledFunc = date => date < today;
617              var comp = Context.RenderComponent<MudDatePicker>(
618                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
619                  EventCallback("DateChanged", (DateTime? _) => wasEventCallbackCalled = true)
620              );
621              comp.SetParam(picker => picker.Date, today);
622              comp.Instance.Date.Should().Be(today);
623              wasEventCallbackCalled.Should().BeTrue();
624          }
625          [Test]
626          public void IsDateDisabledFunc_NoDisabledDatesByDefault()
627          {
628              var comp = OpenPicker();
629              comp.FindAll("button.mud-picker-calendar-day").Select(button => ((IHtmlButtonElement)button).IsDisabled)
630                  .Should().OnlyContain(disabled => disabled == false);
631          }
632          [Test]
633          public void MonthButtons_ButtonRootClassPresent()
634          {
635              var comp = OpenPicker(Parameter(nameof(MudDatePicker.FixDay), 1));
636              var monthsCount = 12;
637              comp.FindAll("button.mud-picker-month").Select(button =>
638                  ((IHtmlButtonElement)button).ClassName.Contains("mud-button-root"))
639                  .Should().HaveCount(monthsCount);
640          }
641          [Test]
642          public void AdditionalDateClassesFunc_ClassIsAdded()
643          {
644              Func<DateTime, string> additionalDateClassesFunc = date => "__addedtestclass__";
645              var comp = Context.RenderComponent<MudDatePicker>(
646                  Parameter(nameof(MudDatePicker.AdditionalDateClassesFunc), additionalDateClassesFunc));
647              var daysCount = comp.FindAll("button.mud-picker-calendar-day").Select(button =>
648                  ((IHtmlBaseElement)button)).Count();
649              comp.FindAll("button.mud-picker-calendar-day").Select(button =>
650                  ((IHtmlBaseElement)button).ClassName.Contains("__addedtestclass__"))
651                  .Should().HaveCount(daysCount);
652          }
653          public async Task CheckAutoCloseDatePickerTest()
654          {
655              var now = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
656              var comp = Context.RenderComponent<AutoCompleteDatePickerTest>();
657              var datePicker = comp.FindComponent<MudDatePicker>();
658              await comp.InvokeAsync(() => datePicker.Instance.Open());
659              if (now.Day != 20)
660              {
661                  comp.FindAll("button.mud-picker-calendar-day")
662                      .Where(x => x.TrimmedText().Equals("20")).First().Click();
663              }
664              else
665              {
666                  comp.FindAll("button.mud-picker-calendar-day")
667                      .Where(x => x.TrimmedText().Equals("19")).First().Click();
668              }
669              datePicker.Instance.Date.Should().Be(now);
670              await comp.InvokeAsync(() => datePicker.Instance.Close(false));
671              await comp.InvokeAsync(() => datePicker.Instance.Open());
672              comp.WaitForAssertion(() => comp.FindAll("div.mud-popover").Count.Should().Be(1));
673              await comp.InvokeAsync(() => datePicker.Instance.Clear());
674              comp.WaitForAssertion(() => comp.FindAll("div.mud-popover").Count.Should().Be(1));
675              await comp.InvokeAsync(() => datePicker.Instance.Close(false));
676              datePicker.Instance.AutoClose = true;
677              await comp.InvokeAsync(() => datePicker.Instance.Open());
678              if (now.Day != 20)
679              {
680                  comp.FindAll("button.mud-picker-calendar-day")
681                      .Where(x => x.TrimmedText().Equals("20")).First().Click();
682              }
683              else
684              {
685                  comp.FindAll("button.mud-picker-calendar-day")
686                      .Where(x => x.TrimmedText().Equals("19")).First().Click();
687              }
688              if (now.Day != 20)
689              {
690                  datePicker.Instance.Date.Should().Be(new DateTime(now.Year, now.Month, 20));
691              }
692              else
693              {
694                  datePicker.Instance.Date.Should().Be(new DateTime(now.Year, now.Month, 19));
695              }
696              await comp.InvokeAsync(() => datePicker.Instance.Open());
697              comp.WaitForAssertion(() => comp.FindAll("div.mud-popover").Count.Should().Be(1));
698              await comp.InvokeAsync(() => datePicker.Instance.Clear());
699              comp.WaitForAssertion(() => comp.FindAll("div.mud-popover").Count.Should().Be(0));
700          }
701          [Test]
702          public async Task CheckReadOnlyTest()
703          {
704              var now = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
705              var comp = Context.RenderComponent<SimpleMudDatePickerTest>();
706              var picker = comp.Instance;
707              await picker.Open();
708              if (now.Day != 20)
709              {
710                  comp.FindAll("button.mud-picker-calendar-day")
711                      .Where(x => x.TrimmedText().Equals("20")).First().Click();
712              }
713              else
714              {
715                  comp.FindAll("button.mud-picker-calendar-day")
716                      .Where(x => x.TrimmedText().Equals("19")).First().Click();
717              }
718              await picker.Close();
719              if (now.Day != 20)
720              {
721                  picker.Date.Should().Be(new DateTime(now.Year, now.Month, 20));
722              }
723              else
724              {
725                  picker.Date.Should().Be(new DateTime(now.Year, now.Month, 19));
726              }
727              now = picker.Date.Value;
728              comp.SetParametersAndRender(p => p.Add(x => x.Readonly, true));
729              await picker.Open();
730              if (now.Day != 21)
731              {
732                  comp.FindAll("button.mud-picker-calendar-day")
733                      .Where(x => x.TrimmedText().Equals("22")).First().Click();
734              }
735              else
736              {
737                  comp.FindAll("button.mud-picker-calendar-day")
738                      .Where(x => x.TrimmedText().Equals("21")).First().Click();
739              }
740              await picker.Close();
741              picker.Date.Should().Be(now);
742          }
743          [Test]
744          public async Task CheckDateTimeMinValueTest()
745          {
746              var date = DateTime.MinValue;
747              var comp = Context.RenderComponent<DateTimeMinValueDatePickerTest>();
748              var datePicker = comp.FindComponent<MudDatePicker>();
749              var picker = comp.Instance;
750              await comp.InvokeAsync(() => datePicker.Instance.Open());
751              comp.FindAll("button.mud-picker-calendar-day").Where(x => x.TrimmedText().Equals("1")).First().Click();
752          }
753          [TestCase(false)]
754          [TestCase(true)]
755          [Test]
756          public void CheckButtonTypeTest(bool navigateToMonthSelection)
757          {
758              var dateComp = Context.RenderComponent<MudDatePicker>(p =>
759              p.Add(x => x.PickerVariant, PickerVariant.Dialog));
760              dateComp.Find(".mud-picker input").Click();
761              if (navigateToMonthSelection)
762              {
763                  dateComp.Find(".mud-picker button.mud-picker-calendar-header-transition").Click();
764              }
765              var buttons = dateComp.FindAll(".mud-picker button");
766              foreach (var button in buttons)
767              {
768                  button.ToMarkup().Contains("type=\"button\"").Should().BeTrue();
769              }
770          }
771          [Test]
772          public async Task DatePickerTest_Editable()
773          {
774              var comp = Context.RenderComponent<SimpleMudDatePickerTest>();
775              CultureInfo cultureInfo = new CultureInfo("en-US");
776              var datePicker = comp.FindComponent<MudDatePicker>().Instance;
777              datePicker.Editable = true;
778              datePicker.Culture = cultureInfo;
779              await comp.InvokeAsync(() => comp.Find("input").Change("10/10/2020"));
780              comp.WaitForAssertion(() => datePicker.Date.Should().Be(new DateTime(2020, 10, 10)));
781              comp.WaitForAssertion(() => datePicker.PickerMonth.Should().Be(null));
782              await comp.InvokeAsync(() => datePicker.Open());
783              comp.WaitForAssertion(() => datePicker.PickerMonth.Should().Be(new DateTime(2020, 10, 01)));
784          }
785          [Test]
786          public async Task DatePickerTest_KeyboardNavigation()
787          {
788              var comp = Context.RenderComponent<SimpleMudDatePickerTest>();
789              var datePicker = comp.FindComponent<MudDatePicker>().Instance;
790              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = "Enter", Type = "keydown", }));
791              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
792              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = "Escape", Type = "keydown", }));
793              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
794              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = " ", Type = "keydown", }));
795              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
796              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = " ", Type = "keydown", }));
797              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
798              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = "ArrowDown", AltKey = true, Type = "keydown", }));
799              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
800              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = "ArrowUp", AltKey = true, Type = "keydown", }));
801              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
802              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = "NumpadEnter", Type = "keydown", }));
803              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
804              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = "Tab", Type = "keydown", }));
805              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
806              datePicker.Disabled = true;
807              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = "Enter", Type = "keydown", }));
808              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
809              await comp.InvokeAsync(() => datePicker.ToggleOpen());
810              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
811              await comp.InvokeAsync(() => datePicker.ToggleOpen());
812              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
813              await comp.InvokeAsync(() => datePicker.ToggleState());
814              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
815              datePicker.Disabled = false;
816              await comp.InvokeAsync(() => datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = "NumpadEnter", Type = "keydown", }));
817              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
818              await comp.InvokeAsync(() => datePicker.ToggleState());
819              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
820          }
821          [Test]
822          public async Task DatePickerTest_GoToDate()
823          {
824              var comp = Context.RenderComponent<SimpleMudDatePickerTest>();
825              var datePicker = comp.FindComponent<MudDatePicker>().Instance;
826              await comp.InvokeAsync(() => datePicker.GoToDate(new DateTime(2022, 03, 20)));
827              comp.WaitForAssertion(() => datePicker.Date.Should().Be(new DateTime(2022, 03, 20)));
828              await comp.InvokeAsync(() => datePicker.GoToDate(new DateTime(2023, 04, 21), false));
829              comp.WaitForAssertion(() => datePicker.Date.Should().Be(new DateTime(2022, 03, 20)));
830              await comp.InvokeAsync(() => datePicker.GoToDate(new DateTime(2023, 04, 21)));
831              comp.WaitForAssertion(() => datePicker.Date.Should().Be(new DateTime(2023, 04, 21)));
832              await comp.InvokeAsync(() => datePicker.GoToDate());
833              comp.WaitForAssertion(() => datePicker.Date.Should().Be(new DateTime(2023, 04, 21)));
834          }
835          [Test]
836          public async Task DatePickerTest_CheckIfMonthsAreDisabled()
837          {
838              var comp = Context.RenderComponent<SimpleMudDatePickerTest>();
839              var datePicker = comp.FindComponent<MudDatePicker>().Instance;
840              datePicker.MinDate = DateTime.Now.AddDays(-1);
841              datePicker.MaxDate = DateTime.Now.AddDays(1);
842              await comp.InvokeAsync(datePicker.Open);
843              comp.Find("button.mud-button-month").Click();
844              comp.WaitForAssertion(() => comp.FindAll("button.mud-picker-month").Any(x => x.IsDisabled()).Should().Be(true));
845              comp.FindAll("button.mud-picker-month").First(x => x.IsDisabled()).Click();
846              var months = comp.FindAll("button.mud-picker-month");
847              months.Should().NotBeNull();
848              comp.Instance.Date.Should().BeNull();
849          }
850      }
851  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-FormTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  using System;
3  using System.Collections.Generic;
4  using System.Globalization;
5  using System.Linq;
6  using System.Linq.Expressions;
7  using System.Threading.Tasks;
8  using Bunit;
9  using FluentAssertions;
10  using Microsoft.AspNetCore.Components;
11  using Microsoft.AspNetCore.Components.Forms;
12  using MudBlazor.Docs.Examples;
13  using MudBlazor.UnitTests.TestComponents;
14  using MudBlazor.UnitTests.TestComponents.Form;
15  using MudBlazor.Utilities;
16  using NUnit.Framework;
17  namespace MudBlazor.UnitTests.Components
18  {
19      [TestFixture]
20      public class FormTests : BunitTest
21      {
22          [Test]
23          public async Task FormIsValidTest()
24          {
25              var comp = Context.RenderComponent<FormIsValidTest>();
26              var form = comp.FindComponent<MudForm>().Instance;
27              var textFieldcomp = comp.FindComponent<MudTextField<string>>();
28              var textField = textFieldcomp.Instance;
29              form.IsValid.Should().Be(false);
30              textField.Error.Should().BeFalse();
31              textField.ErrorText.Should().BeNullOrEmpty();
32              textFieldcomp.Find("input").Change("Marilyn Manson");
33              form.IsValid.Should().Be(true);
34              form.Errors.Length.Should().Be(0);
35              textField.Error.Should().BeFalse();
36              textField.ErrorText.Should().BeNullOrEmpty();
37              textFieldcomp.Find("input").Change(null);
38              form.IsValid.Should().Be(false);
39              form.Errors.Length.Should().Be(1);
40              form.Errors[0].Should().Be("Enter a rock star");
41              textField.Error.Should().BeTrue();
42              textField.ErrorText.Should().Be("Enter a rock star");
43              textFieldcomp.Find("input").Change("");
44              form.IsValid.Should().Be(false);
45              form.Errors.Length.Should().Be(1);
46              form.Errors[0].Should().Be("Enter a rock star");
47              textField.Error.Should().BeTrue();
48              textField.ErrorText.Should().Be("Enter a rock star");
49              textFieldcomp.Find("input").Change("Kurt Cobain");
50              form.IsValid.Should().Be(true);
51              form.Errors.Length.Should().Be(0);
52              textField.Error.Should().BeFalse();
53              textField.ErrorText.Should().BeNullOrEmpty();
54          }
55          [Test]
56          public async Task FormIsValidTest2()
57          {
58              var comp = Context.RenderComponent<FormIsValidTest2>();
59              var form = comp.FindComponent<MudForm>().Instance;
60              var textFieldcomp = comp.FindComponent<MudTextField<string>>();
61              form.IsValid.Should().Be(true);
62              textFieldcomp.Find("input").Change("This value doesn't matter");
63              form.IsValid.Should().Be(true);
64          }
65          [Test]
66          public async Task FormIsValidTest3()
67          {
68              var comp = Context.RenderComponent<FormIsValidTest3>();
69              var form = comp.FindComponent<MudForm>().Instance;
70              var textFields = comp.FindComponents<MudTextField<string>>();
71              form.IsValid.Should().Be(false);
72              form.IsTouched.Should().Be(false);
73              comp.FindComponents<MudSwitch<bool>>()[0].Instance.Checked.Should().Be(false);
74              comp.FindComponents<MudSwitch<bool>>()[1].Instance.Checked.Should().Be(false);
75              textFields[1].Find("input").Change("Fill in the required field to make this form valid");
76              form.IsValid.Should().Be(true);
77              comp.FindComponents<MudSwitch<bool>>()[0].Instance.Checked.Should().Be(true);
78              comp.FindComponents<MudSwitch<bool>>()[1].Instance.Checked.Should().Be(true);
79          }
80          [Test]
81          public async Task FormIsValidTest4()
82          {
83              var comp = Context.RenderComponent<FormIsValidTest4>();
84              var form = comp.FindComponent<MudForm>().Instance;
85              comp.WaitForAssertion(() => form.IsValid.Should().Be(true));
86              comp.WaitForAssertion(() => comp.FindComponent<MudSwitch<bool>>().Instance.Checked.Should().Be(true));
87          }
88          [Test]
89          public async Task FormIsTouchedTest()
90          {
91              var comp = Context.RenderComponent<FormIsTouchedTest>();
92              var form = comp.FindComponent<MudForm>().Instance;
93              var textFieldcomp = comp.FindComponent<MudTextField<string>>();
94              var textField = textFieldcomp.Instance;
95              var dateComp = comp.FindComponent<MudDatePicker>();
96              var dateField = dateComp.Instance;
97              form.IsTouched.Should().Be(false);
98              dateComp.Find("input").Change("2001-01-31");
99              form.IsTouched.Should().Be(true);
100              await comp.InvokeAsync(() => form.ResetAsync());
101              form.IsTouched.Should().Be(false);
102              textFieldcomp.Find("input").Change("value is changed");
103              form.IsTouched.Should().Be(true);
104              await comp.InvokeAsync(() => form.ResetValidation());
105              form.IsTouched.Should().Be(true);
106          }
107          [Test]
108          public async Task FormIsTouchedAndNestedFormIsNotTouchedWhenParentFormFieldIsTouchedTest()
109          {
110              var comp = Context.RenderComponent<FormIsTouchedNestedTest>();
111              var formsComp = comp.FindComponents<MudForm>();
112              var textCompFields = comp.FindComponents<MudTextField<string>>();
113              var dateCompFields = comp.FindComponents<MudDatePicker>();
114              var form = formsComp[0].Instance;
115              var textField = textCompFields[0].Instance;
116              var dateField = dateCompFields[0].Instance;
117              var nestedForm = formsComp[1].Instance;
118              var nestedFormTextField = textCompFields[1].Instance;
119              var nestedFormDateField = dateCompFields[1].Instance;
120              form.IsTouched.Should().Be(false);
121              nestedForm.IsTouched.Should().Be(false);
122              textCompFields[0].Find("input").Change("2001-01-31");
123              form.IsTouched.Should().Be(true);
124              nestedForm.IsTouched.Should().Be(false);
125              await comp.InvokeAsync(() => form.ResetAsync());
126              form.IsTouched.Should().Be(false);
127              nestedForm.IsTouched.Should().Be(false);
128              textCompFields[0].Find("input").Change("value is changed");
129              form.IsTouched.Should().Be(true);
130              nestedForm.IsTouched.Should().Be(false);
131              await comp.InvokeAsync(() => form.ResetValidation());
132              form.IsTouched.Should().Be(true);
133              nestedForm.IsTouched.Should().Be(false);
134          }
135          [Test]
136          public async Task FormIsUnTouchedWhenNestedFormTouchedTest()
137          {
138              var comp = Context.RenderComponent<FormIsTouchedNestedTest>();
139              var formsComp = comp.FindComponents<MudForm>();
140              var textCompFields = comp.FindComponents<MudTextField<string>>();
141              var dateCompFields = comp.FindComponents<MudDatePicker>();
142              var form = formsComp[0].Instance;
143              var textField = textCompFields[0].Instance;
144              var dateField = dateCompFields[0].Instance;
145              var nestedForm = formsComp[1].Instance;
146              var nestedFormTextField = textCompFields[1].Instance;
147              var nestedFormDateField = dateCompFields[1].Instance;
148              form.IsTouched.Should().Be(false);
149              nestedForm.IsTouched.Should().Be(false);
150              textCompFields[1].Find("input").Change("2001-01-31");
151              form.IsTouched.Should().Be(true);
152              nestedForm.IsTouched.Should().Be(true);
153              await comp.InvokeAsync(() => form.ResetAsync());
154              form.IsTouched.Should().Be(false);
155              nestedForm.IsTouched.Should().Be(false);
156              textCompFields[3].Find("input").Change("value is changed");
157              form.IsTouched.Should().Be(false);
158              nestedForm.IsTouched.Should().Be(true);
159              await comp.InvokeAsync(() => nestedFormDateField.ResetValidation());
160              form.IsTouched.Should().Be(false);
161              nestedForm.IsTouched.Should().Be(true);
162          }
163          [Test]
164          public async Task FormValidationTest1()
165          {
166              var validationFunc = new Func<string, bool>(x => x?.StartsWith("Marilyn") == true);
167              var comp = Context.RenderComponent<FormValidationTest>(ComponentParameter.CreateParameter("validation", validationFunc));
168              var form = comp.FindComponent<MudForm>().Instance;
169              var textFieldcomp = comp.FindComponent<MudTextField<string>>();
170              var textField = textFieldcomp.Instance;
171              form.IsValid.Should().Be(false);
172              textField.Error.Should().BeFalse();
173              textField.ErrorText.Should().BeNullOrEmpty();
174              textFieldcomp.Find("input").Change("Marilyn Manson");
175              form.IsValid.Should().Be(true);
176              form.Errors.Length.Should().Be(0);
177              textField.Error.Should().BeFalse();
178              textField.ErrorText.Should().BeNullOrEmpty();
179              textFieldcomp.Find("input").Change("Kurt Cobain");
180              form.IsValid.Should().Be(false);
181              form.Errors.Length.Should().Be(1);
182              textField.Error.Should().BeTrue();
183              textField.ErrorText.Should().Be("Invalid");
184              textFieldcomp.Find("input").Change("Marilyn Monroe");
185              form.IsValid.Should().Be(true);
186              form.Errors.Length.Should().Be(0);
187              textField.Error.Should().BeFalse();
188              textField.ErrorText.Should().BeNullOrEmpty();
189          }
190          [Test]
191          public async Task FormValidationTest2()
192          {
193              var validationFunc = new Func<string, string>(s =>
194              {
195                  if (!(s.StartsWith("Marilyn") || s.EndsWith("Manson")))
196                      return "Not a star!";
197                  return null;
198              });
199              var comp = Context.RenderComponent<FormValidationTest>(ComponentParameter.CreateParameter("validation", validationFunc));
200              var form = comp.FindComponent<MudForm>().Instance;
201              var textFieldcomp = comp.FindComponent<MudTextField<string>>();
202              form.IsValid.Should().Be(false);
203              textFieldcomp.Find("input").Change("Marilyn Manson");
204              form.IsValid.Should().Be(true);
205              textFieldcomp.Find("input").Change("Charles Manson");
206              form.IsValid.Should().Be(true);
207              textFieldcomp.Find("input").Change("Marilyn Monroe");
208              form.IsValid.Should().Be(true);
209              textFieldcomp.Find("input").Change("Manson Marilyn");
210              form.IsValid.Should().Be(false);
211          }
212          [Test]
213          public async Task FormValidationTest3()
214          {
215              var comp = Context.RenderComponent<FormValidationTest>();
216              var form = comp.FindComponent<MudForm>().Instance;
217              var textFieldcomp = comp.FindComponent<MudTextField<string>>();
<span onclick='openModal()' class='match'>218              var textField = textFieldcomp.Instance;
219              form.IsValid.Should().Be(false);
220              textFieldcomp.Find("input").Change("Some value");
221              form.IsValid.Should().Be(true);
222              await comp.InvokeAsync(() => form.ResetAsync());
223              textField.Value.Should().Be(null);
224              textField.Text.Should().Be(null);
225              form.IsValid.Should().Be(false); 
226          }
227          [Test]
228          public async Task FormAsyncValidationTest()
229          {
230              const int ValidDelay = 100;
231              const int InvalidDelay = 200;
232              var validationFunc = new Func<string, Task<string>>(async s =>
</span>233              {
234                  if (s == null)
235                      return null;
236                  var valid = (s == "abc");
237                  await Task.Delay(valid ? ValidDelay : InvalidDelay);
238                  return valid ? null : "invalid";
239              });
240              var comp = Context.RenderComponent<FormValidationTest>(ComponentParameter.CreateParameter("validation", validationFunc));
241              var textFieldComp = comp.FindComponent<MudTextField<string>>();
242              var textField = textFieldComp.Instance;
243              textField.ValidationErrors.Should().BeEmpty();
244              textFieldComp.Find("input").Change("def");
245              comp.WaitForAssertion(() => textField.ValidationErrors.Should().ContainSingle("invalid"), TimeSpan.FromSeconds(5));
246              textFieldComp.Find("input").Change("abc");
247              comp.WaitForAssertion(() => textField.ValidationErrors.Should().BeEmpty(), TimeSpan.FromSeconds(5));
248              textFieldComp.Find("input").Change("def");
249              textFieldComp.Find("input").Change("abc");
250              comp.WaitForAssertion(() => textField.ValidationErrors.Should().BeEmpty(), TimeSpan.FromSeconds(5));
251          }
252          [Test]
253          public async Task EditFormOnFieldChangedTest()
254          {
255              var comp = Context.RenderComponent<EditFormOnFieldChangedTest>();
256              var textFields = comp.FindAll("input");
257              textFields.Count.Should().Be(3);
258              var chips = comp.FindAll("span.mud-chip-content");
259              chips.Count.Should().Be(3);
260              foreach (var chip in chips)
261                  chip.TextContent.Trim().Should().EndWith("not changed");
262              comp.FindAll("input")[0].Change(new ChangeEventArgs() { Value = "asdf" });
263              comp.FindAll("input")[0].Blur();
264              comp.FindComponents<MudTextField<string>>()[0].Instance.Text.Should().Be("asdf");
265              comp.FindAll("span.mud-chip-content")[0].TextContent.Trim().Should().Be("Field1 changed");
266              comp.FindAll("span.mud-chip-content")[1].TextContent.Trim().Should().EndWith("not changed");
267              comp.FindAll("span.mud-chip-content")[2].TextContent.Trim().Should().EndWith("not changed");
268              comp.FindAll("input")[1].Change(new ChangeEventArgs() { Value = "yxcv" });
269              comp.FindAll("input")[1].Blur();
270              comp.FindComponents<MudTextField<string>>()[1].Instance.Text.Should().Be("yxcv");
271              comp.FindAll("span.mud-chip-content")[0].TextContent.Trim().Should().Be("Field1 changed");
272              comp.FindAll("span.mud-chip-content")[1].TextContent.Trim().Should().EndWith("not changed", "Because it has no For, so the change can not be forwarded to the edit context for lack of a FieldIdentifier");
273              comp.FindAll("span.mud-chip-content")[2].TextContent.Trim().Should().EndWith("not changed");
274              comp.FindAll("input")[2].Change(new ChangeEventArgs() { Value = "qwer" });
275              comp.FindAll("input")[2].Blur();
276              comp.FindComponents<MudTextField<string>>()[2].Instance.Text.Should().Be("qwer");
277              comp.FindAll("span.mud-chip-content")[0].TextContent.Trim().Should().Be("Field1 changed");
278              comp.FindAll("span.mud-chip-content")[1].TextContent.Trim().Should().EndWith("not changed");
279              comp.FindAll("span.mud-chip-content")[2].TextContent.Trim().Should().EndWith("Field3 changed");
280          }
281          [Test]
282          public async Task FormWithCheckboxTest()
283          {
284              var comp = Context.RenderComponent<FormWithCheckboxTest>();
285              var textFields = comp.FindAll("input");
286              textFields.Count.Should().Be(4); 
287              comp.FindAll("input")[0].Change("Garfield");
288              comp.FindAll("input")[0].Blur();
289              comp.FindAll("input")[1].Change("Jon");
290              comp.FindAll("input")[1].Blur();
291              comp.FindAll("input")[2].Change("17"); 
292              comp.FindAll("input")[2].Blur();
293              foreach (var tf in comp.FindComponents<MudTextField<string>>())
294                  tf.Instance.Text.Should().NotBeNullOrEmpty();
295              comp.FindComponent<MudTextField<int>>().Instance.Value.Should().Be(17);
296              comp.FindComponent<MudCheckBox<bool>>().Instance.Checked.Should().Be(true);
297              comp.FindAll("input")[3].Change(false); 
298              comp.FindComponent<MudCheckBox<bool>>().Instance.Checked.Should().Be(false);
299              foreach (var tf in comp.FindComponents<MudTextField<string>>())
300                  tf.Instance.Text.Should().NotBeNullOrEmpty();
301              comp.FindComponent<MudTextField<int>>().Instance.Value.Should().Be(17);
302          }
303          [Test]
304          public async Task FormWithCheckboxTest2()
305          {
306              var comp = Context.RenderComponent<FormWithCheckboxTest>();
307              var form = comp.FindComponent<MudForm>().Instance;
308              form.IsValid.Should().BeTrue(because: "none of the fields are required");
309          }
310          [Test]
311          public async Task Form_Should_BecomeValidIfUntouchedFieldsAreNotRequired()
312          {
313              var comp = Context.RenderComponent<FormValidationTest2>();
314              var form = comp.FindComponent<MudForm>().Instance;
315              form.IsValid.Should().BeFalse(because: "textfield is required");
316              var textfield = comp.FindComponent<MudTextField<string>>();
317              textfield.Find("input").Change("Moby Dick");
318              form.IsValid.Should().BeTrue(because: "select is not required");
319          }
320          [Test]
321          public async Task Form_Should_BecomeInValidWhenAConversionErrorOccurs()
322          {
323              var comp = Context.RenderComponent<FormConversionErrorTest>();
324              var form = comp.FindComponent<MudForm>().Instance;
325              form.IsValid.Should().BeTrue();
326              var textfield = comp.FindComponent<MudTextField<int>>();
327              textfield.Find("input").Input("Not and int");
328              form.IsValid.Should().BeFalse(because: "conversion error is forwarded to form");
329              textfield.Find("input").Input("17");
330              form.IsValid.Should().BeTrue(because: "conversion error is gone");
331          }
332          [Test]
333          public async Task MudFormExampleTest()
334          {
335              var comp = Context.RenderComponent<MudFormExample>();
336              var form = comp.FindComponent<MudForm>().Instance;
337              comp.FindComponent<MudForm>().SetParam(x => x.ValidationDelay, 0);
338              comp.WaitForAssertion(() => form.IsValid.Should().BeFalse(because: "it contains required fields that are not filled out"));
339              var buttons = comp.FindComponents<MudButton>();
340              var validateButton = buttons[1];
341              validateButton.Find("button").Click();
342              var textfields = comp.FindComponents<MudTextField<string>>();
343              comp.WaitForAssertion(() => textfields[0].Instance.HasErrors.Should().BeTrue());
344              textfields[0].Instance.ErrorText.Should().Be("User name is required!");
345              comp.WaitForAssertion(() => textfields[1].Instance.HasErrors.Should().BeTrue());
346              textfields[1].Instance.ErrorText.Should().Be("Email is required!");
347              comp.WaitForAssertion(() => textfields[2].Instance.HasErrors.Should().BeTrue());
348              textfields[2].Instance.ErrorText.Should().Be("Password is required!");
349              var checkbox = comp.FindComponent<MudCheckBox<bool>>();
350              comp.WaitForAssertion(() => checkbox.Instance.HasErrors.Should().BeTrue());
351              checkbox.Instance.ErrorText.Should().Be("You must agree");
352              var resetValidationButton = buttons[3];
353              resetValidationButton.Find("button").Click();
354              comp.WaitForState(() => form.Errors.Length == 0);
355              comp.WaitForAssertion(() => textfields[0].Instance.HasErrors.Should().BeFalse());
356              textfields[0].Instance.ErrorText.Should().BeNullOrEmpty();
357              comp.WaitForAssertion(() => textfields[1].Instance.HasErrors.Should().BeFalse());
358              textfields[1].Instance.ErrorText.Should().BeNullOrEmpty();
359              comp.WaitForAssertion(() => textfields[2].Instance.HasErrors.Should().BeFalse());
360              textfields[2].Instance.ErrorText.Should().BeNullOrEmpty();
361              comp.WaitForAssertion(() => checkbox.Instance.HasErrors.Should().BeFalse());
362              checkbox.Instance.ErrorText.Should().BeNullOrEmpty();
363              textfields[0].Find("input").Change("Rick Sanchez");
364              textfields[1].Find("input").Change("rick.sanchez@citadel-of-ricks.com");
365              textfields[2].Find("input").Change("Wabalabadubdub1234!");
366              textfields[3].Find("input").Change("Wabalabadubdub1234!");
367              checkbox.Find("input").Change(true);
368              comp.WaitForAssertion(() => form.IsValid.Should().BeTrue());
369              comp.WaitForState(() => form.Errors.Length == 0);
370              var resetButton = buttons[2];
371              resetButton.Find("button").Click();
372              comp.WaitForState(() => form.Errors.Length == 0);
373              comp.WaitForAssertion(() => textfields[0].Instance.HasErrors.Should().BeFalse());
374              textfields[0].Instance.ErrorText.Should().BeNullOrEmpty();
375              textfields[0].Instance.Text.Should().BeNullOrEmpty();
376              comp.WaitForAssertion(() => textfields[1].Instance.HasErrors.Should().BeFalse());
377              textfields[1].Instance.ErrorText.Should().BeNullOrEmpty();
378              textfields[1].Instance.Text.Should().BeNullOrEmpty();
379              comp.WaitForAssertion(() => textfields[2].Instance.HasErrors.Should().BeFalse());
380              textfields[2].Instance.ErrorText.Should().BeNullOrEmpty();
381              textfields[2].Instance.Text.Should().BeNullOrEmpty();
382              comp.WaitForAssertion(() => checkbox.Instance.HasErrors.Should().BeFalse());
383              checkbox.Instance.ErrorText.Should().BeNullOrEmpty();
384              comp.WaitForAssertion(() => checkbox.Instance.Checked.Should().BeFalse());
385          }
386          [Test]
387          public async Task FormWithRadioGroupIsValidTest()
388          {
389              var comp = Context.RenderComponent<FormWithRadioGroupTest>();
390              var form = comp.FindComponent<MudForm>().Instance;
391              var radioGroupcomp = comp.FindComponent<MudRadioGroup<string>>();
392              var radioGroup = radioGroupcomp.Instance;
393              form.IsValid.Should().Be(false);
394              radioGroup.Error.Should().BeFalse();
395              radioGroup.ErrorText.Should().BeNullOrEmpty();
396              radioGroupcomp.Find("input").Click();
397              form.IsValid.Should().Be(true);
398              form.Errors.Length.Should().Be(0);
399              radioGroup.Error.Should().BeFalse();
400              radioGroup.ErrorText.Should().BeNullOrEmpty();
401              comp.SetParam("Selected", null);
402              form.IsValid.Should().Be(false);
403              form.Errors.Length.Should().Be(1);
404              form.Errors[0].Should().Be("Required");
405              radioGroup.Error.Should().BeTrue();
406              radioGroup.ErrorText.Should().Be("Required");
407          }
408          [Test]
409          public async Task Form_Should_Validate_ColorPicker_When_ColorSelectedViaInputs()
410          {
411              var comp = Context.RenderComponent<FormWithColorPickerTest>();
412              var form = comp.FindComponent<MudForm>().Instance;
413              var colorPickerComp = comp.FindComponent<MudColorPicker>();
414              var colorPicker = comp.FindComponent<MudColorPicker>().Instance;
415              var forbiddenColor = colorPicker.Value;
416              colorPickerComp.SetParam(x => x.Validation, new Func<MudColor?, string>(color => color != null && color.Value == forbiddenColor.Value ? $"{forbiddenColor.Value} is not allowed" : null));
417              form.IsTouched.Should().BeFalse();
418              form.IsValid.Should().BeFalse();
419              colorPicker.Error.Should().BeFalse();
420              colorPicker.ErrorText.Should().BeNullOrEmpty();
421              await comp.InvokeAsync(() => colorPickerComp.FindAll("input")[0].Change("#111111"));
422              form.IsTouched.Should().BeTrue();
423              form.IsValid.Should().BeTrue();
424              form.Errors.Length.Should().Be(0);
425              colorPicker.Error.Should().BeFalse();
426              colorPicker.ErrorText.Should().BeNullOrEmpty();
427              comp.SetParam(x => x.ColorValue, forbiddenColor);
428              form.IsValid.Should().Be(false);
429              form.Errors.Length.Should().Be(1);
430              form.Errors[0].Should().Be($"{forbiddenColor.Value} is not allowed");
431              colorPicker.Error.Should().BeTrue();
432              colorPicker.ErrorText.Should().Be($"{forbiddenColor.Value} is not allowed");
433          }
434          [Test]
435          public async Task Form_Should_ValidateColorPickerTest_When_ColorSelectedViaPicker()
436          {
437              var comp = Context.RenderComponent<FormWithColorPickerTest>();
438              var form = comp.FindComponent<MudForm>().Instance;
439              var colorPickerComp = comp.FindComponent<MudColorPicker>();
440              var colorPicker = comp.FindComponent<MudColorPicker>().Instance;
441              var forbiddenColor = colorPicker.Palette.First();
442              colorPickerComp.SetParam(x => x.Validation, new Func<MudColor?, string>(color => color != null && color.Value == forbiddenColor.Value ? $"{forbiddenColor.Value} is not allowed" : null));
443              form.IsTouched.Should().BeFalse();
444              form.IsValid.Should().BeFalse();
445              await comp.InvokeAsync(() => comp.Find("input").Click());
446              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
447              await comp.InvokeAsync(() => comp.Find("div.mud-picker-color-dot-current").Click());
448              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-color-collection").Count.Should().Be(1));
449              await comp.InvokeAsync(() => comp.FindAll("div.mud-picker-color-collection>div.mud-picker-color-dot").Skip(1).First().Click());
450              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-color-collection").Count.Should().Be(0));
451              form.IsTouched.Should().BeTrue();
452              form.IsValid.Should().BeTrue();
453              form.Errors.Length.Should().Be(0);
454              colorPicker.Error.Should().BeFalse();
455              colorPicker.ErrorText.Should().BeNullOrEmpty();
456              await comp.InvokeAsync(() => comp.Find("div.mud-picker-color-dot-current").Click());
457              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-color-collection").Count.Should().Be(1));
458              await comp.InvokeAsync(() => comp.FindAll("div.mud-picker-color-collection>div.mud-picker-color-dot").First().Click());
459              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-color-collection").Count.Should().Be(0));
460              form.IsTouched.Should().BeTrue();
461              form.IsValid.Should().BeFalse();
462              form.Errors.Length.Should().Be(1);
463              form.Errors[0].Should().Be($"{forbiddenColor.Value} is not allowed");
464              colorPicker.Error.Should().BeTrue();
465              colorPicker.ErrorText.Should().Be($"{forbiddenColor.Value} is not allowed");
466          }
467          [Test]
468          public async Task FormWithDatePickerTest()
469          {
470              var comp = Context.RenderComponent<FormWithDatePickerTest>();
471              var form = comp.FindComponent<MudForm>().Instance;
472              var dateComp = comp.FindComponent<MudDatePicker>();
473              var datepicker = comp.FindComponent<MudDatePicker>().Instance;
474              form.IsValid.Should().Be(false);
475              datepicker.Error.Should().BeFalse();
476              datepicker.ErrorText.Should().BeNullOrEmpty();
477              dateComp.Find("input").Change(new DateTime(2001, 01, 31).ToShortDateString());
478              form.IsValid.Should().Be(true);
479              form.Errors.Length.Should().Be(0);
480              datepicker.Error.Should().BeFalse();
481              datepicker.ErrorText.Should().BeNullOrEmpty();
482              comp.SetParam(x => x.Date, null);
483              form.IsValid.Should().Be(false);
484              form.Errors.Length.Should().Be(1);
485              form.Errors[0].Should().Be("Required");
486              datepicker.Error.Should().BeTrue();
487              datepicker.ErrorText.Should().Be("Required");
488          }
489          [Test]
490          public async Task Form_Should_ValidateDatePickerTest()
491          {
492              var comp = Context.RenderComponent<FormWithDatePickerTest>();
493              var form = comp.FindComponent<MudForm>().Instance;
494              var dateComp = comp.FindComponent<MudDatePicker>();
495              var datepicker = comp.FindComponent<MudDatePicker>().Instance;
496              dateComp.SetParam(x => x.Validation, new Func<DateTime?, string>(date => date != null && date.Value.Year >= 2000 ? null : "Year must be >= 2000"));
497              dateComp.Find("input").Change(new DateTime(2001, 01, 31).ToShortDateString());
498              form.IsValid.Should().Be(true);
499              form.Errors.Length.Should().Be(0);
500              datepicker.Error.Should().BeFalse();
501              datepicker.ErrorText.Should().BeNullOrEmpty();
502              comp.SetParam(x => x.Date, (DateTime?)new DateTime(1999, 1, 1));
503              form.IsValid.Should().Be(false);
504              form.Errors.Length.Should().Be(1);
505              form.Errors[0].Should().Be("Year must be >= 2000");
506              datepicker.Error.Should().BeTrue();
507              datepicker.ErrorText.Should().Be("Year must be >= 2000");
508          }
509          [Test]
510          public async Task Form_Should_Validate_DateRangePicker_When_DateRangeSelectedViaInputs()
511          {
512              var comp = Context.RenderComponent<FormWithDateRangePickerTest>();
513              var form = comp.FindComponent<MudForm>().Instance;
514              var dateRangeComp = comp.FindComponent<MudDateRangePicker>();
515              var dateRangePicker = comp.FindComponent<MudDateRangePicker>().Instance;
516              var firstDateTime = new DateTime(2023, 01, 20);
517              var secondDateTime = new DateTime(2023, 02, 20);
518              form.IsValid.Should().Be(false);
519              dateRangePicker.Error.Should().BeFalse();
520              dateRangePicker.ErrorText.Should().BeNullOrEmpty();
521              await comp.InvokeAsync(() => dateRangeComp.FindAll("input")[0].Change(firstDateTime.ToString(CultureInfo.CurrentCulture.DateTimeFormat.ShortDatePattern)));
522              await comp.InvokeAsync(() => dateRangeComp.FindAll("input")[1].Change(secondDateTime.ToString(CultureInfo.CurrentCulture.DateTimeFormat.ShortDatePattern)));
523              form.IsValid.Should().Be(true);
524              form.Errors.Length.Should().Be(0);
525              dateRangePicker.Error.Should().BeFalse();
526              dateRangePicker.ErrorText.Should().BeNullOrEmpty();
527              comp.SetParam(x => x.DateRange, null);
528              form.IsValid.Should().Be(false);
529              form.Errors.Length.Should().Be(1);
530              form.Errors[0].Should().Be("Required");
531              dateRangePicker.Error.Should().BeTrue();
532              dateRangePicker.ErrorText.Should().Be("Required");
533          }
534          [Test]
535          public async Task Form_Should_Validate_DateRangePicker_When_DateRangeSelectedViaPicker()
536          {
537              var comp = Context.RenderComponent<FormWithDateRangePickerTest>();
538              var form = comp.FindComponent<MudForm>().Instance;
539              var dateRangePicker = comp.FindComponent<MudDateRangePicker>().Instance;
540              form.IsValid.Should().Be(false);
541              dateRangePicker.Error.Should().BeFalse();
542              dateRangePicker.ErrorText.Should().BeNullOrEmpty();
543              comp.Find("input").Click();
544              await comp.InvokeAsync(() => comp.FindAll("button.mud-picker-calendar-day").First(x => x.TrimmedText().Equals("10")).Click());
545              await comp.InvokeAsync(() => comp.FindAll("button.mud-picker-calendar-day").First(x => x.TrimmedText().Equals("11")).Click());
546              comp.WaitForAssertion(() => comp.FindAll("div.mud-popover-open").Count.Should().Be(0));
547              comp.WaitForAssertion(() => comp.FindAll("div.mud-popover").Count.Should().Be(1));
548              form.IsTouched.Should().Be(true);
549              form.IsValid.Should().Be(true);
550              form.Errors.Length.Should().Be(0);
551              dateRangePicker.Error.Should().BeFalse();
552              dateRangePicker.ErrorText.Should().BeNullOrEmpty();
553              comp.SetParam(x => x.DateRange, null);
554              form.IsValid.Should().Be(false);
555              form.Errors.Length.Should().Be(1);
556              form.Errors[0].Should().Be("Required");
557              dateRangePicker.Error.Should().BeTrue();
558              dateRangePicker.ErrorText.Should().Be("Required");
559          }
560          [Test]
561          public async Task FormWithTimePickerTest()
562          {
563              var comp = Context.RenderComponent<FormWithTimePickerTest>();
564              var form = comp.FindComponent<MudForm>().Instance;
565              var timePickerComp = comp.FindComponent<MudTimePicker>();
566              var timePicker = comp.FindComponent<MudTimePicker>().Instance;
567              form.IsValid.Should().Be(false);
568              timePicker.Error.Should().BeFalse();
569              timePicker.ErrorText.Should().BeNullOrEmpty();
570              timePickerComp.Find("input").Change("09:30");
571              form.IsValid.Should().Be(true);
572              form.Errors.Length.Should().Be(0);
573              timePicker.Error.Should().BeFalse();
574              timePicker.ErrorText.Should().BeNullOrEmpty();
575              comp.SetParam(x => x.Time, null);
576              form.IsValid.Should().Be(false);
577              form.Errors.Length.Should().Be(1);
578              form.Errors[0].Should().Be("Required");
579              timePicker.Error.Should().BeTrue();
580              timePicker.ErrorText.Should().Be("Required");
581          }
582          [Test]
583          public async Task Form_Should_ValidateTimePickerTest()
584          {
585              var comp = Context.RenderComponent<FormWithTimePickerTest>();
586              var form = comp.FindComponent<MudForm>().Instance;
587              var timeComp = comp.FindComponent<MudTimePicker>();
588              var timePicker = comp.FindComponent<MudTimePicker>().Instance;
589              timeComp.SetParam(x => x.Validation, new Func<TimeSpan?, string>(time => time != null && time.Value.Minutes == 0 ? null : "Only full hours allowed"));
590              timeComp.Find("input").Change("09:00");
591              form.IsValid.Should().Be(true);
592              form.Errors.Length.Should().Be(0);
593              timePicker.Error.Should().BeFalse();
594              timePicker.ErrorText.Should().BeNullOrEmpty();
595              comp.SetParam(x => x.Time, (TimeSpan?)new TimeSpan(0, 17, 05, 00)); 
596              form.IsValid.Should().Be(false);
597              form.Errors.Length.Should().Be(1);
598              form.Errors[0].Should().Be("Only full hours allowed");
599              timePicker.Error.Should().BeTrue();
600              timePicker.ErrorText.Should().Be("Only full hours allowed");
601          }
602          [Test]
603          public async Task FormWithTimePickerTest_When_TimeSelectedViaPicker()
604          {
605              var comp = Context.RenderComponent<FormWithTimePickerTest>();
606              var form = comp.FindComponent<MudForm>().Instance;
607              var timePicker = comp.FindComponent<MudTimePicker>().Instance;
608              form.IsValid.Should().Be(false);
609              timePicker.Error.Should().BeFalse();
610              timePicker.ErrorText.Should().BeNullOrEmpty();
611              comp.Find("input").Click();
612              comp.FindAll("div.mud-picker-stick-inner.mud-hour")[8].Click();
613              comp.FindAll("div.mud-minute")[30].Click();
614              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
615              form.IsTouched.Should().Be(true);
616              form.IsValid.Should().Be(true);
617              form.Errors.Length.Should().Be(0);
618              timePicker.Error.Should().BeFalse();
619              timePicker.ErrorText.Should().BeNullOrEmpty();
620              comp.SetParam(x => x.Time, null);
621              form.IsValid.Should().Be(false);
622              form.Errors.Length.Should().Be(1);
623              form.Errors[0].Should().Be("Required");
624              timePicker.Error.Should().BeTrue();
625              timePicker.ErrorText.Should().Be("Required");
626          }
627          [Test]
628          public async Task Form_Should_ValidateTimePickerTest_When_TimeSelectedViaPicker()
629          {
630              var comp = Context.RenderComponent<FormWithTimePickerTest>();
631              var form = comp.FindComponent<MudForm>().Instance;
632              var timePickerComp = comp.FindComponent<MudTimePicker>();
633              var timePicker = comp.FindComponent<MudTimePicker>().Instance;
634              timePickerComp.SetParam(x => x.Validation, new Func<TimeSpan?, string>(time => time != null && time.Value.Minutes == 0 ? null : "Only full hours allowed"));
635              await comp.InvokeAsync(() => comp.Find("input").Click());
636              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
637              await comp.InvokeAsync(() => comp.FindAll("div.mud-picker-stick-inner.mud-hour")[8].Click());
638              await comp.InvokeAsync(() => comp.FindAll("div.mud-minute")[0].Click());
639              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(0));
640              form.IsTouched.Should().Be(true);
641              form.IsValid.Should().Be(true);
642              form.Errors.Length.Should().Be(0);
643              timePicker.Error.Should().BeFalse();
644              timePicker.ErrorText.Should().BeNullOrEmpty();
645              await comp.InvokeAsync(() => comp.Find("input").Click());
646              comp.WaitForAssertion(() => comp.FindAll("div.mud-picker-open").Count.Should().Be(1));
647              await comp.InvokeAsync(() => comp.FindAll("div.mud-picker-stick-outer.mud-hour")[4].Click());
648              await comp.InvokeAsync(() => comp.FindAll("div.mud-minute")[5].Click());
649              form.IsValid.Should().Be(false);
650              form.Errors.Length.Should().Be(1);
651              form.Errors[0].Should().Be("Only full hours allowed");
652              timePicker.Error.Should().BeTrue();
653              timePicker.ErrorText.Should().Be("Only full hours allowed");
654          }
655          [Test]
656          public async Task EditFormExample_EmptyValidation()
657          {
658              var comp = Context.RenderComponent<EditFormExample>();
659              comp.Find("form").Submit();
660              var textfields = comp.FindComponents<MudTextField<string>>();
661              textfields[0].Instance.HasErrors.Should().BeTrue();
662              textfields[0].Instance.ErrorText.Should().Be("The Username field is required.");
663              textfields[1].Instance.HasErrors.Should().BeTrue();
664              textfields[1].Instance.ErrorText.Should().Be("The Email field is required.");
665              textfields[2].Instance.HasErrors.Should().BeTrue();
666              textfields[2].Instance.ErrorText.Should().Be("The Password field is required.");
667              textfields[3].Instance.HasErrors.Should().BeTrue();
668              textfields[3].Instance.ErrorText.Should().Be("The Password2 field is required.");
669          }
670          [Test]
671          public async Task EditFormExample_FillInValues()
672          {
673              var comp = Context.RenderComponent<EditFormExample>();
674              comp.FindAll("input")[0].Change("Rick Sanchez");
675              comp.FindAll("input")[0].Blur();
676              comp.FindAll("input")[1].Change("rick.sanchez@citadel-of-ricks.com");
677              comp.FindAll("input")[1].Blur();
678              comp.FindAll("input")[2].Change("Wabalabadubdub1234!");
679              comp.FindAll("input")[2].Blur();
680              comp.FindAll("input")[3].Change("Wabalabadubdub1234!");
681              comp.FindAll("input")[3].Blur();
682              comp.Find("form").Submit();
683              var textfields = comp.FindComponents<MudTextField<string>>();
684              textfields[0].Instance.ErrorText.Should().Be("Name length can't be more than 8.");
685              textfields[0].Instance.HasErrors.Should().BeTrue();
686              textfields[1].Instance.HasErrors.Should().BeFalse();
687              textfields[1].Instance.ErrorText.Should().BeNullOrEmpty();
688              textfields[2].Instance.HasErrors.Should().BeFalse();
689              textfields[2].Instance.ErrorText.Should().BeNullOrEmpty();
690              textfields[3].Instance.HasErrors.Should().BeFalse();
691              textfields[3].Instance.ErrorText.Should().BeNullOrEmpty();
692          }
693          [Test]
694          public async Task EditForm_Validation_NullContext()
695          {
696              var comp = Context.RenderComponent<EditFormIssue1229>();
697              EditFormIssue1229.TestAttribute.ValidationContextOnCall.Should().BeEmpty();
698              var input = comp.Find("input");
699              input.Change("Test");
700              input.Blur();
701              EditFormIssue1229.TestAttribute.ValidationContextOnCall.Should().NotBeEmpty();
702              foreach (var vc in EditFormIssue1229.TestAttribute.ValidationContextOnCall)
703              {
704                  vc.Should().NotBeNull();
705              }
706          }
707          [Test]
708          public async Task MudForm_MustNot_ValidateOnInitialRender()
709          {
710              var comp = Context.RenderComponent<MudFormExample>();
711              await Task.Delay(100);
712              var form = comp.FindComponent<MudForm>().Instance;
713              form.Errors.Should().BeEmpty();
714          }
715          [Test]
716          public async Task MudFormExample_FillInValuesRootForm()
717          {
718              var comp = Context.RenderComponent<FluentValidationComplexExample>();
719              comp.FindAll("input")[0].Input("Rick Sanchez");
720              comp.FindAll("input")[0].Blur();
721              comp.FindAll("input")[1].Input("rick.sanchez@citadel-of-ricks.com");
722              comp.FindAll("input")[1].Blur();
723              comp.FindAll("input")[3].Input("Wabalabadubdub1234!");
724              comp.FindAll("input")[3].Blur();
725              comp.FindAll("input")[4].Input("sdfsfsdf!");
726              comp.FindAll("input")[4].Blur();
727              comp.FindAll("input")[5].Input("adsadasad!");
728              comp.FindAll("input")[5].Blur();
729              var form = comp.FindComponent<MudForm>().Instance;
730              await comp.InvokeAsync(() => form.Validate());
731              form.IsValid.Should().BeFalse();
732              var textfields = comp.FindComponents<MudTextField<string>>();
733              var numericFields = comp.FindComponents<MudNumericField<decimal>>();
734              textfields[0].Instance.HasErrors.Should().BeFalse();
735              textfields[0].Instance.ErrorText.Should().BeNullOrEmpty();
736              textfields[1].Instance.HasErrors.Should().BeFalse();
737              textfields[1].Instance.ErrorText.Should().BeNullOrEmpty();
738              textfields[2].Instance.HasErrors.Should().BeFalse();
739              textfields[2].Instance.ErrorText.Should().BeNullOrEmpty();
740              textfields[3].Instance.HasErrors.Should().BeFalse();
741              textfields[3].Instance.ErrorText.Should().BeNullOrEmpty();
742              textfields[4].Instance.HasErrors.Should().BeFalse();
743              textfields[4].Instance.ErrorText.Should().BeNullOrEmpty();
744              textfields[5].Instance.HasErrors.Should().BeFalse();
745              textfields[5].Instance.ErrorText.Should().BeNullOrEmpty();
746              textfields[6].Instance.HasErrors.Should().BeFalse();
747              textfields[6].Instance.ErrorText.Should().BeNullOrEmpty();
748              numericFields[0].Instance.HasErrors.Should().BeFalse();
749              numericFields[0].Instance.ErrorText.Should().BeNullOrEmpty();
750              textfields[7].Instance.HasErrors.Should().BeTrue();
751              textfields[7].Instance.ErrorText.Should().NotBeNullOrEmpty();
752              numericFields[1].Instance.HasErrors.Should().BeTrue();
753              numericFields[1].Instance.ErrorText.Should().NotBeNullOrEmpty();
754          }
755          [Test]
756          public async Task MudFormExample_FillInValuesNestedForm()
757          {
758              var comp = Context.RenderComponent<FluentValidationComplexExample>();
759              comp.FindAll("input")[8].Change("SomeWork");
760              comp.FindAll("input")[8].Blur();
761              comp.FindAll("input")[9].Change("99");
762              comp.FindAll("input")[9].Blur();
763              var form = comp.FindComponent<MudForm>().Instance;
764              await comp.InvokeAsync(() => form.Validate());
765              form.IsValid.Should().BeFalse();
766              var textfields = comp.FindComponents<MudTextField<string>>();
767              var numericFields = comp.FindComponents<MudNumericField<decimal>>();
768              textfields[0].Instance.HasErrors.Should().BeTrue();
769              textfields[0].Instance.ErrorText.Should().NotBeNullOrEmpty();
770              textfields[1].Instance.HasErrors.Should().BeTrue();
771              textfields[1].Instance.ErrorText.Should().NotBeNullOrEmpty();
772              textfields[2].Instance.HasErrors.Should().BeFalse();
773              textfields[2].Instance.ErrorText.Should().BeNullOrEmpty();
774              textfields[3].Instance.HasErrors.Should().BeTrue();
775              textfields[3].Instance.ErrorText.Should().NotBeNullOrEmpty();
776              textfields[4].Instance.HasErrors.Should().BeTrue();
777              textfields[4].Instance.ErrorText.Should().NotBeNullOrEmpty();
778              textfields[5].Instance.HasErrors.Should().BeTrue();
779              textfields[5].Instance.ErrorText.Should().NotBeNullOrEmpty();
780              textfields[6].Instance.HasErrors.Should().BeFalse();
781              textfields[6].Instance.ErrorText.Should().BeNullOrEmpty();
782              numericFields[0].Instance.HasErrors.Should().BeFalse();
783              numericFields[0].Instance.ErrorText.Should().BeNullOrEmpty();
784              textfields[7].Instance.HasErrors.Should().BeFalse();
785              textfields[7].Instance.ErrorText.Should().BeNullOrEmpty();
786              numericFields[1].Instance.HasErrors.Should().BeFalse();
787              numericFields[1].Instance.ErrorText.Should().BeNullOrEmpty();
788          }
789          [Test]
790          public async Task MudFormExample_FillInValues()
791          {
792              var comp = Context.RenderComponent<FluentValidationComplexExample>();
793              comp.FindAll("input")[0].Input("Rick Sanchez");
794              comp.FindAll("input")[0].Blur();
795              comp.FindAll("input")[1].Input("rick.sanchez@citadel-of-ricks.com");
796              comp.FindAll("input")[1].Blur();
797              comp.FindAll("input")[3].Input("Wabalabadubdub1234!");
798              comp.FindAll("input")[3].Blur();
799              comp.FindAll("input")[4].Input("sdfsfsdf!");
800              comp.FindAll("input")[4].Blur();
801              comp.FindAll("input")[5].Input("adsadasad!");
802              comp.FindAll("input")[5].Blur();
803              comp.FindAll("input")[8].Change("SomeWork");
804              comp.FindAll("input")[8].Blur();
805              comp.FindAll("input")[9].Change("99");
806              comp.FindAll("input")[9].Blur();
807              var form = comp.FindComponent<MudForm>().Instance;
808              await comp.InvokeAsync(() => form.Validate());
809              form.IsValid.Should().BeTrue();
810              var textfields = comp.FindComponents<MudTextField<string>>();
811              var numericFields = comp.FindComponents<MudNumericField<decimal>>();
812              textfields[0].Instance.HasErrors.Should().BeFalse();
813              textfields[0].Instance.ErrorText.Should().BeNullOrEmpty();
814              textfields[1].Instance.HasErrors.Should().BeFalse();
815              textfields[1].Instance.ErrorText.Should().BeNullOrEmpty();
816              textfields[2].Instance.HasErrors.Should().BeFalse();
817              textfields[2].Instance.ErrorText.Should().BeNullOrEmpty();
818              textfields[3].Instance.HasErrors.Should().BeFalse();
819              textfields[3].Instance.ErrorText.Should().BeNullOrEmpty();
820              textfields[4].Instance.HasErrors.Should().BeFalse();
821              textfields[4].Instance.ErrorText.Should().BeNullOrEmpty();
822              textfields[5].Instance.HasErrors.Should().BeFalse();
823              textfields[5].Instance.ErrorText.Should().BeNullOrEmpty();
824              textfields[6].Instance.HasErrors.Should().BeFalse();
825              textfields[6].Instance.ErrorText.Should().BeNullOrEmpty();
826              numericFields[0].Instance.HasErrors.Should().BeFalse();
827              numericFields[0].Instance.ErrorText.Should().BeNullOrEmpty();
828              textfields[7].Instance.HasErrors.Should().BeFalse();
829              textfields[7].Instance.ErrorText.Should().BeNullOrEmpty();
830              numericFields[1].Instance.HasErrors.Should().BeFalse();
831              numericFields[1].Instance.ErrorText.Should().BeNullOrEmpty();
832          }
833          [Test]
834          public async Task MudFormComponent_ValidationWithModel_UnexpectedErrorInValidationFunc3()
835          {
836              var comp = Context.RenderComponent<FormWithSingleTextField>();
837              var form = comp.FindComponent<MudForm>();
838              var model = new { data = "asdf" };
839              form.SetParam(nameof(MudForm.Model), model);
840              var tf = comp.FindComponent<MudTextField<string>>();
841              var validationFunc = new Func<object, string, IEnumerable<string>>((obj, property) =>
842              {
843                  throw new InvalidOperationException("User error");
844              });
845              tf.SetParam(nameof(MudTextField<string>.Validation), validationFunc);
846              Expression<Func<string>> expression = () => model.data;
847              tf.SetParam(nameof(MudTextField<string>.For), expression);
848              await comp.InvokeAsync(tf.Instance.Validate);
849              tf.Instance.Error.Should().Be(true);
850              tf.Instance.ErrorText.Should().Be("Error in validation func: User error");
851          }
852          [Test]
853          public async Task MudFormComponent_ValidationWithModelWithNoFor_ShouldShow_ExpectedError()
854          {
855              var comp = Context.RenderComponent<FormWithSingleTextField>();
856              var form = comp.FindComponent<MudForm>();
857              var model = new { data = "asdf" };
858              form.SetParam(nameof(MudForm.Model), model);
859              var tf = comp.FindComponent<MudTextField<string>>();
860              var validationFunc = new Func<object, string, IEnumerable<string>>((obj, property) =>
861              {
862                  throw new InvalidOperationException("User error");
863              });
864              tf.SetParam(nameof(MudTextField<string>.Validation), validationFunc);
865              await comp.InvokeAsync(tf.Instance.Validate);
866              tf.Instance.Error.Should().Be(true);
867              tf.Instance.ErrorText.Should().Be("For is null, please set parameter For on the form input component of type MudTextField`1");
868          }
869          [Test]
870          public async Task MudFormComponent_AsyncValidationWithModelWithNoFor_ShouldShow_ExpectedError()
871          {
872              var comp = Context.RenderComponent<FormWithSingleTextField>();
873              var form = comp.FindComponent<MudForm>();
874              var model = new { data = "asdf" };
875              form.SetParam(nameof(MudForm.Model), model);
876              var tf = comp.FindComponent<MudTextField<string>>();
877              var validationFunc = new Func<object, string, Task<IEnumerable<string>>>((obj, property) =>
878              {
879                  throw new InvalidOperationException("User error");
880              });
881              tf.SetParam(nameof(MudTextField<string>.Validation), validationFunc);
882              await comp.InvokeAsync(tf.Instance.Validate);
883              tf.Instance.Error.Should().Be(true);
884              tf.Instance.ErrorText.Should().Be("For is null, please set parameter For on the form input component of type MudTextField`1");
885          }
886          [Test]
887          public async Task MudFormComponent_ValidationWithModel_UnexpectedErrorInValidationFunc5()
888          {
889              var comp = Context.RenderComponent<FormWithSingleTextField>();
890              var form = comp.FindComponent<MudForm>();
891              var model = new { data = "asdf" };
892              form.SetParam(nameof(MudForm.Model), model);
893              var tf = comp.FindComponent<MudTextField<string>>();
894              var validationFunc = new Func<object, string, IEnumerable<string>>((obj, property) =>
895              {
896                  obj.Should().Be(model);
897                  property.Should().Be("data");
898                  return new[] { "Error1", "Error2" };
899              });
900              tf.SetParam(nameof(MudTextField<string>.Validation), validationFunc);
901              Expression<Func<string>> expression = () => model.data;
902              tf.SetParam(nameof(MudTextField<string>.For), expression);
903              await comp.InvokeAsync(tf.Instance.Validate);
904              tf.Instance.Error.Should().Be(true);
905              tf.Instance.ErrorText.Should().Be("Error1");
906          }
907          [Test]
908          public async Task FormReset_Should_ClearTextField()
909          {
910              var comp = Context.RenderComponent<FormResetTest>();
911              var form = comp.FindComponent<MudForm>();
912              var textFieldComp = comp.FindComponents<MudTextField<string>>()[1]; 
913              var textField = textFieldComp.Instance;
914              textFieldComp.Find("input").Input("asdf");
915              textField.Value.Should().Be("asdf");
916              textField.Text.Should().Be("asdf");
917              await comp.InvokeAsync(() => form.Instance.ResetAsync());
918              textField.Value.Should().BeNullOrEmpty();
919              textField.Text.Should().BeNullOrEmpty();
920              textFieldComp.Find("input").Input("asdf");
921              textField.Value.Should().Be("asdf");
922              textField.Text.Should().Be("asdf");
923              comp.Find("button.reset").Click();
924              textField.Value.Should().BeNullOrEmpty();
925              textField.Text.Should().BeNullOrEmpty();
926          }
927          [Test]
928          public async Task FormReset_Should_ClearNumericField()
929          {
930              var comp = Context.RenderComponent<FormResetTest>();
931              var form = comp.FindComponent<MudForm>().Instance;
932              var numericFieldComp = comp.FindComponent<MudNumericField<int?>>();
933              var numericField = numericFieldComp.Instance;
934              numericFieldComp.Find("input").Input(10);
935              numericField.Value.Should().Be(10);
936              numericField.Text.Should().Be("10");
937              await comp.InvokeAsync(() => form.ResetAsync());
938              numericField.Value.Should().BeNull();
939              numericField.Text.Should().BeNullOrEmpty();
940              numericFieldComp.Find("input").Input(20);
941              numericField.Value.Should().Be(20);
942              numericField.Text.Should().Be("20");
943              comp.Find("button.reset").Click();
944              numericField.Value.Should().BeNull();
945              numericField.Text.Should().BeNullOrEmpty();
946          }
947          [Test]
948          public async Task FormReset_Should_ClearDatePicker()
949          {
950              var comp = Context.RenderComponent<FormResetTest>();
951              var form = comp.FindComponent<MudForm>().Instance;
952              var datePickerComp = comp.FindComponent<MudDatePicker>();
953              var datePicker = datePickerComp.Instance;
954              var testDate = new DateTime(2020, 05, 24);
955              var testDateString = testDate.ToShortDateString();  
956              datePickerComp.Find("input").Change(testDateString);
957              datePicker.Date.Should().Be(testDate);
958              datePicker.Text.Should().Be(testDateString);
959              await comp.InvokeAsync(() => form.ResetAsync());
960              datePicker.Date.Should().BeNull();
961              datePicker.Text.Should().BeNullOrEmpty();
962              datePickerComp.Find("input").Change(testDateString);
963              datePicker.Date.Should().Be(testDate);
964              datePicker.Text.Should().Be(testDateString);
965              comp.Find("button.reset").Click();
966              datePicker.Date.Should().BeNull();
967              datePicker.Text.Should().BeNullOrEmpty();
968          }
969          [Test]
970          public async Task FormReset_Should_ResetFormStateForFieldsThatWrapMudInput()
971          {
972              var comp = Context.RenderComponent<FormResetTest>();
973              var form = comp.FindComponent<MudForm>().Instance;
974              var datePickerComp = comp.FindComponent<MudDatePicker>();
975              var textFieldComp = comp.FindComponents<MudTextField<string>>()[1]; 
976              var numericFieldComp = comp.FindComponent<MudNumericField<int?>>();
977              var testDate = new DateTime(2022, 07, 29);
978              var testDateString = testDate.ToShortDateString();  
979              form.IsValid.Should().Be(false);
980              datePickerComp.Find("input").Change(testDateString);
981              form.IsValid.Should().Be(false);
982              textFieldComp.Find("input").Input("Some value");
983              form.IsValid.Should().Be(false);
984              numericFieldComp.Find("input").Input("1");
985              form.IsValid.Should().Be(true);
986              await comp.InvokeAsync(() => form.ResetAsync());
987              form.IsValid.Should().Be(false); 
988          }
989          [Test]
990          public async Task MudForm_Should_RegisterOnlyTopSubscribeToParentFormFormControls()
991          {
992              var comp = Context.RenderComponent<FormShouldRegisterOnlyTopSubscribeToParentFormFormControlsTest>();
993              var form = comp.FindComponent<MudFormTestable>().Instance;
994              Assert.AreEqual(14, form.FormControls.Count);
995          }
996          [Test]
997          public async Task MudForm_Validation_Should_OverrideFieldValidation()
998          {
999              var comp = Context.RenderComponent<FormValidationOverrideFieldValidationTest>();
1000              var textFields = comp.FindComponents<MudTextField<string>>();
1001              var numericFields = comp.FindComponents<MudNumericField<int>>();
1002              var defaultValidation = "v";
1003              textFields[0].Instance.Validation.Should().Be(defaultValidation);
1004              textFields[1].Instance.Validation.Should().Be(defaultValidation);
1005              textFields[2].Instance.Validation.Should().Be(defaultValidation);
1006              textFields[3].Instance.Validation.Should().Be("a");
1007              numericFields[0].Instance.Validation.Should().Be(defaultValidation);
1008              numericFields[1].Instance.Validation.Should().NotBe(defaultValidation);
1009              numericFields[2].Instance.Validation.Should().Be(defaultValidation);
1010              numericFields[3].Instance.Validation.Should().Be("b");
1011          }
1012          [Test]
1013          public async Task FieldValidationWithoutRequiredForm_ShouldNot_Validate()
1014          {
1015              var comp = Context.RenderComponent<FieldValidationWithoutRequiredFormTest>();
1016              Assert.Throws<ElementNotFoundException>(() => comp.Find(".mud-input-error"));
1017          }
1018          [Test]
1019          public async Task FieldChangedEventShouldTriggerTest()
1020          {
1021              var comp = Context.RenderComponent<FormFieldChangedTest>();
1022              var formsComp = comp.FindComponents<MudForm>();
1023              var textField = comp.FindComponent<MudTextField<string>>().Instance;
1024              var numeric = comp.FindComponent<MudNumericField<int>>().Instance;
1025              var radioGroup = comp.FindComponent<MudRadioGroup<string>>().Instance;
1026              comp.Instance.FormFieldChangedEventArgs.Should().BeNull();
1027              await comp.InvokeAsync(() => textField.SetText("new value"));
1028              comp.Instance.FormFieldChangedEventArgs.NewValue.Should().Be("new value");
1029              Assert.AreEqual(comp.Instance.FormFieldChangedEventArgs.Field, textField);
1030              numeric.Value.Should().Be(0);
1031              await comp.InvokeAsync(() => numeric.Increment());
1032              comp.Instance.FormFieldChangedEventArgs.NewValue.Should().Be(1);
1033              Assert.AreEqual(comp.Instance.FormFieldChangedEventArgs.Field, numeric);
1034              var inputs = comp.FindAll("input").ToArray();
1035              radioGroup.SelectedOption.Should().Be(null);
1036              inputs[2].Click();
1037              radioGroup.SelectedOption.Should().Be("1");
1038              comp.Instance.FormFieldChangedEventArgs.NewValue.Should().Be("1");
1039              Assert.AreEqual(comp.Instance.FormFieldChangedEventArgs.Field, radioGroup);
1040              var fileContent = InputFileContent.CreateFromText("", "upload.txt");
1041              var mudFile = comp.FindComponent<MudFileUpload<IBrowserFile>>().Instance;
1042              var input = comp.FindComponent<InputFile>();
1043              input.UploadFiles(fileContent);
1044              (comp.Instance.FormFieldChangedEventArgs.NewValue is IBrowserFile).Should().BeTrue();
1045              Assert.AreEqual(comp.Instance.FormFieldChangedEventArgs.Field, mudFile);
1046          }
1047          [Test]
1048          public async Task FieldChangedEventShouldTriggerPickerTest()
1049          {
1050              var comp = Context.RenderComponent<FormFieldChangedPickerTest>();
1051              var formsComp = comp.FindComponents<MudForm>();
1052              var datePicker = comp.FindComponent<MudDatePicker>();
1053              var timePicker = comp.FindComponent<MudTimePicker>();
1054              var colorPicker = comp.FindComponent<MudColorPicker>();
1055              comp.Instance.FormFieldChangedEventArgs.Should().BeNull();
1056              var dateString = new DateTime(2022, 04, 03).ToShortDateString();
1057              await comp.InvokeAsync(() => datePicker.Find("input").Change(dateString));
1058              comp.Instance.FormFieldChangedEventArgs.NewValue.Should().Be(new DateTime(2022, 04, 03));
1059              Assert.AreEqual(comp.Instance.FormFieldChangedEventArgs.Field, datePicker.Instance);
1060              await comp.InvokeAsync(() => timePicker.Find("input").Change("00:45"));
1061              comp.Instance.FormFieldChangedEventArgs.NewValue.Should().Be(new TimeSpan(00, 45, 00));
1062              Assert.AreEqual(comp.Instance.FormFieldChangedEventArgs.Field, timePicker.Instance);
1063              await comp.InvokeAsync(() => colorPicker.Find("input").Change("#180f6fff"));
1064              comp.Instance.FormFieldChangedEventArgs.NewValue.Should().Be(new MudColor("#180f6fff"));
1065              Assert.AreEqual(comp.Instance.FormFieldChangedEventArgs.Field, colorPicker.Instance);
1066          }
1067          [Test]
1068          public async Task FormAutoValidationSetTest()
1069          {
1070              var comp = Context.RenderComponent<FormAutomaticValidationTest>();
1071              var textComps = comp.FindComponents<MudTextField<string>>();
1072              var dateComps = comp.FindComponents<MudDatePicker>();
1073              textComps[0].Instance.For.Should().NotBeNull(); 
1074              textComps[1].Instance.For.Should().BeNull(); 
1075              dateComps[0].Instance.For.Should().NotBeNull(); 
1076              dateComps[1].Instance.For.Should().BeNull(); 
1077              textComps[0].Instance.Validation.Should().NotBeNull(); 
1078              textComps[1].Instance.Validation.Should().BeNull(); 
1079              dateComps[0].Instance.Validation.Should().NotBeNull(); 
1080              dateComps[1].Instance.Validation.Should().BeNull(); 
1081          }
1082          [Test]
1083          public async Task FormReadonlyTest()
1084          {
1085              var comp = Context.RenderComponent<FormReadOnlyDisabledTest>();
1086              var textField = comp.FindComponents<MudTextField<string>>()[0];
1087              var maskedTextField = comp.FindComponents<MudTextField<string>>()[1];
1088              var checkBox = comp.FindComponent<MudCheckBox<bool>>();
1089              var radioGroup = comp.FindComponent<MudRadioGroup<string>>();
1090              var switch_ = comp.FindComponent<MudSwitch<bool>>();
1091              var select = comp.FindComponent<MudSelect<string>>(); 
1092              var colorPicker = comp.FindComponent<MudColorPicker>();
1093              var datePicker = comp.FindComponent<MudDatePicker>();
1094              var dateRangePicker = comp.FindComponent<MudDateRangePicker>();
1095              var timePicker = comp.FindComponent<MudTimePicker>();
1096              var autocomplete = comp.FindComponent<MudAutocomplete<string>>();
1097              var numericField = comp.FindComponent<MudNumericField<int>>();
1098              var fileUpload = comp.FindComponent<MudFileUpload<IBrowserFile>>();
1099              textField.Find("input").HasAttribute("readonly").Should().BeFalse();
1100              maskedTextField.Find("input").HasAttribute("readonly").Should().BeFalse();
1101              checkBox.Find("label").ClassList.Should().NotContain("mud-readonly");
1102              radioGroup.Find("label").ClassList.Should().NotContain("mud-readonly");
1103              switch_.Find("label").ClassList.Should().NotContain("mud-readonly");
1104              autocomplete.Find("input").HasAttribute("readonly").Should().BeFalse();
1105              numericField.Find("input").HasAttribute("readonly").Should().BeFalse();
1106              fileUpload.Find("input").HasAttribute("disabled").Should().BeFalse(); 
1107              comp.SetParametersAndRender(parameters => parameters.Add(p => p.FormReadOnly, true).Add(p => p.CompReadOnly, false));
1108              textField.Find("input").HasAttribute("readonly").Should().BeTrue();
1109              maskedTextField.Find("input").HasAttribute("readonly").Should().BeTrue();
1110              checkBox.Find("label").ClassList.Should().Contain("mud-readonly");
1111              radioGroup.Find("label").ClassList.Should().Contain("mud-readonly");
1112              switch_.Find("label").ClassList.Should().Contain("mud-readonly");
1113              autocomplete.Find("input").HasAttribute("readonly").Should().BeTrue();
1114              numericField.Find("input").HasAttribute("readonly").Should().BeTrue();
1115              fileUpload.Find("input").HasAttribute("disabled").Should().BeTrue();
1116              comp.SetParametersAndRender(parameters => parameters.Add(p => p.FormReadOnly, false).Add(p => p.CompReadOnly, true));
1117              textField.Find("input").HasAttribute("readonly").Should().BeTrue();
1118              maskedTextField.Find("input").HasAttribute("readonly").Should().BeTrue();
1119              checkBox.Find("label").ClassList.Should().Contain("mud-readonly");
1120              radioGroup.Find("label").ClassList.Should().Contain("mud-readonly");
1121              switch_.Find("label").ClassList.Should().Contain("mud-readonly");
1122              autocomplete.Find("input").HasAttribute("readonly").Should().BeTrue();
1123              numericField.Find("input").HasAttribute("readonly").Should().BeTrue();
1124              fileUpload.Find("input").HasAttribute("disabled").Should().BeFalse(); 
1125              comp.SetParametersAndRender(parameters => parameters.Add(p => p.FormReadOnly, false).Add(p => p.CompReadOnly, false));
1126              textField.Find("input").HasAttribute("readonly").Should().BeFalse();
1127              maskedTextField.Find("input").HasAttribute("readonly").Should().BeFalse();
1128              checkBox.Find("label").ClassList.Should().NotContain("mud-readonly");
1129              radioGroup.Find("label").ClassList.Should().NotContain("mud-readonly");
1130              switch_.Find("label").ClassList.Should().NotContain("mud-readonly");
1131              autocomplete.Find("input").HasAttribute("readonly").Should().BeFalse();
1132              numericField.Find("input").HasAttribute("readonly").Should().BeFalse();
1133              fileUpload.Find("input").HasAttribute("disabled").Should().BeFalse();
1134          }
1135          [Test]
1136          public async Task FormDisabledTest()
1137          {
1138              var comp = Context.RenderComponent<FormReadOnlyDisabledTest>();
1139              var textField = comp.FindComponents<MudTextField<string>>()[0];
1140              var maskedTextField = comp.FindComponents<MudTextField<string>>()[1];
1141              var checkBox = comp.FindComponent<MudCheckBox<bool>>();
1142              var radioGroup = comp.FindComponent<MudRadioGroup<string>>();
1143              var switch_ = comp.FindComponent<MudSwitch<bool>>();
1144              var select = comp.FindComponent<MudSelect<string>>();
1145              var colorPicker = comp.FindComponent<MudColorPicker>();
1146              var datePicker = comp.FindComponent<MudDatePicker>();
1147              var dateRangePicker = comp.FindComponent<MudDateRangePicker>();
1148              var timePicker = comp.FindComponent<MudTimePicker>();
1149              var autocomplete = comp.FindComponent<MudAutocomplete<string>>();
1150              var numericField = comp.FindComponent<MudNumericField<int>>();
1151              var fileUpload = comp.FindComponent<MudFileUpload<IBrowserFile>>();
1152              textField.Find("input").HasAttribute("disabled").Should().BeFalse();
1153              maskedTextField.Find("input").HasAttribute("disabled").Should().BeFalse();
1154              checkBox.Find("input").HasAttribute("disabled").Should().BeFalse();
1155              radioGroup.Find("input").HasAttribute("disabled").Should().BeFalse();
1156              switch_.Find("input").HasAttribute("disabled").Should().BeFalse();
1157              select.Find("input").HasAttribute("disabled").Should().BeFalse();
1158              colorPicker.Find("input").HasAttribute("disabled").Should().BeFalse();
1159              datePicker.Find("input").HasAttribute("disabled").Should().BeFalse();
1160              dateRangePicker.Find("input").HasAttribute("disabled").Should().BeFalse();
1161              timePicker.Find("input").HasAttribute("disabled").Should().BeFalse();
1162              autocomplete.Find("input").HasAttribute("disabled").Should().BeFalse();
1163              numericField.Find("input").HasAttribute("disabled").Should().BeFalse();
1164              fileUpload.Find("input").HasAttribute("disabled").Should().BeFalse();
1165              comp.SetParametersAndRender(parameters => parameters.Add(p => p.FormDisabled, true).Add(p => p.CompDisabled, false));
1166              textField.Find("input").HasAttribute("disabled").Should().BeTrue();
1167              maskedTextField.Find("input").HasAttribute("disabled").Should().BeTrue();
1168              checkBox.Find("input").HasAttribute("disabled").Should().BeTrue();
1169              radioGroup.Find("input").HasAttribute("disabled").Should().BeTrue();
1170              switch_.Find("input").HasAttribute("disabled").Should().BeTrue();
1171              select.Find("input").HasAttribute("disabled").Should().BeTrue();
1172              colorPicker.Find("input").HasAttribute("disabled").Should().BeTrue();
1173              datePicker.Find("input").HasAttribute("disabled").Should().BeTrue();
1174              dateRangePicker.Find("input").HasAttribute("disabled").Should().BeTrue();
1175              timePicker.Find("input").HasAttribute("disabled").Should().BeTrue();
1176              autocomplete.Find("input").HasAttribute("disabled").Should().BeTrue();
1177              numericField.Find("input").HasAttribute("disabled").Should().BeTrue();
1178              fileUpload.Find("input").HasAttribute("disabled").Should().BeTrue();
1179              comp.SetParametersAndRender(parameters => parameters.Add(p => p.FormDisabled, false).Add(p => p.CompDisabled, true));
1180              textField.Find("input").HasAttribute("disabled").Should().BeTrue();
1181              maskedTextField.Find("input").HasAttribute("disabled").Should().BeTrue();
1182              checkBox.Find("input").HasAttribute("disabled").Should().BeTrue();
1183              radioGroup.Find("input").HasAttribute("disabled").Should().BeTrue();
1184              switch_.Find("input").HasAttribute("disabled").Should().BeTrue();
1185              select.Find("input").HasAttribute("disabled").Should().BeTrue();
1186              colorPicker.Find("input").HasAttribute("disabled").Should().BeTrue();
1187              datePicker.Find("input").HasAttribute("disabled").Should().BeTrue();
1188              dateRangePicker.Find("input").HasAttribute("disabled").Should().BeTrue();
1189              timePicker.Find("input").HasAttribute("disabled").Should().BeTrue();
1190              autocomplete.Find("input").HasAttribute("disabled").Should().BeTrue();
1191              numericField.Find("input").HasAttribute("disabled").Should().BeTrue();
1192              fileUpload.Find("input").HasAttribute("disabled").Should().BeTrue();
1193              comp.SetParametersAndRender(parameters => parameters.Add(p => p.FormDisabled, false).Add(p => p.CompDisabled, false));
1194              textField.Find("input").HasAttribute("disabled").Should().BeFalse();
1195              maskedTextField.Find("input").HasAttribute("disabled").Should().BeFalse();
1196              checkBox.Find("input").HasAttribute("disabled").Should().BeFalse();
1197              radioGroup.Find("input").HasAttribute("disabled").Should().BeFalse();
1198              switch_.Find("input").HasAttribute("disabled").Should().BeFalse();
1199              select.Find("input").HasAttribute("disabled").Should().BeFalse();
1200              colorPicker.Find("input").HasAttribute("disabled").Should().BeFalse();
1201              datePicker.Find("input").HasAttribute("disabled").Should().BeFalse();
1202              dateRangePicker.Find("input").HasAttribute("disabled").Should().BeFalse();
1203              timePicker.Find("input").HasAttribute("disabled").Should().BeFalse();
1204              autocomplete.Find("input").HasAttribute("disabled").Should().BeFalse();
1205              numericField.Find("input").HasAttribute("disabled").Should().BeFalse();
1206              fileUpload.Find("input").HasAttribute("disabled").Should().BeFalse();
1207          }
1208          [Test]
1209          public async Task FormNestedReadOnlyTest()
1210          {
1211              var comp = Context.RenderComponent<FormNestedReadOnlyDisabledTest>();
1212              comp.FindAll(".mud-checkbox.mud-readonly").Count.Should().Be(0);
1213              comp.SetParametersAndRender(parameters => parameters.Add(p => p.ReadOnly, true));
1214              comp.FindAll(".mud-checkbox.mud-readonly").Count.Should().Be(1);
1215              comp.SetParametersAndRender(parameters => parameters.Add(p => p.NestedReadOnly, true));
1216              comp.FindAll(".mud-checkbox.mud-readonly").Count.Should().Be(1);
1217              comp.SetParametersAndRender(parameters => parameters.Add(p => p.ReadOnly, true).Add(p => p.NestedReadOnly, true));
1218              comp.FindAll(".mud-checkbox.mud-readonly").Count.Should().Be(1);
1219              comp.SetParametersAndRender(parameters => parameters.Add(p => p.ReadOnly, false).Add(p => p.NestedReadOnly, false));
1220              comp.FindAll(".mud-checkbox.mud-readonly").Count.Should().Be(0);
1221          }
1222          [Test]
1223          public async Task FormNestedDisabledTest()
1224          {
1225              var comp = Context.RenderComponent<FormNestedReadOnlyDisabledTest>();
1226              comp.FindAll(".mud-checkbox.mud-disabled").Count.Should().Be(0);
1227              comp.SetParametersAndRender(parameters => parameters.Add(p => p.Disabled, true));
1228              comp.FindAll(".mud-checkbox.mud-disabled").Count.Should().Be(1);
1229              comp.SetParametersAndRender(parameters => parameters.Add(p => p.NestedDisabled, true));
1230              comp.FindAll(".mud-checkbox.mud-disabled").Count.Should().Be(1);
1231              comp.SetParametersAndRender(parameters => parameters.Add(p => p.Disabled, true).Add(p => p.NestedDisabled, true));
1232              comp.FindAll(".mud-checkbox.mud-disabled").Count.Should().Be(1);
1233              comp.SetParametersAndRender(parameters => parameters.Add(p => p.Disabled, false).Add(p => p.NestedDisabled, false));
1234              comp.FindAll(".mud-checkbox.mud-disabled").Count.Should().Be(0);
1235          }
1236      }
1237  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-DatePickerTests.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-FormTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>435              var comp = Context.RenderComponent<SimpleMudDatePickerTest>();
436              comp.FindAll("div.mud-picker-content").Count.Should().Be(0);
437              await comp.InvokeAsync(() => comp.Instance.Open());
438              comp.FindAll("div.mud-picker-content").Count.Should().Be(1);
439              await comp.InvokeAsync(() => comp.Instance.Close());
440              comp.FindAll("div.mud-picker-content").Count.Should().Be(0);
441          }
442          [Test]
443          public async Task PersianCalendar()
444          {
445              var cal = new PersianCalendar();
</pre></code></div>
                <div class="column column_space"><pre><code>218              var textField = textFieldcomp.Instance;
219              form.IsValid.Should().Be(false);
220              textFieldcomp.Find("input").Change("Some value");
221              form.IsValid.Should().Be(true);
222              await comp.InvokeAsync(() => form.ResetAsync());
223              textField.Value.Should().Be(null);
224              textField.Text.Should().Be(null);
225              form.IsValid.Should().Be(false); 
226          }
227          [Test]
228          public async Task FormAsyncValidationTest()
229          {
230              const int ValidDelay = 100;
231              const int InvalidDelay = 200;
232              var validationFunc = new Func<string, Task<string>>(async s =>
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    