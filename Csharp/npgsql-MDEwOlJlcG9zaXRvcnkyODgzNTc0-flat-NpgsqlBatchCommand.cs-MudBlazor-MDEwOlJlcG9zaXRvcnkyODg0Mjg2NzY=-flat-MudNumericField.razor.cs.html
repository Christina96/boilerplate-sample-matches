
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 15, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NpgsqlBatchCommand.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Data;
4  using System.Data.Common;
5  using System.Diagnostics;
6  using System.Diagnostics.CodeAnalysis;
7  using System.Runtime.CompilerServices;
8  using Npgsql.BackendMessages;
9  using Npgsql.Internal;
10  namespace Npgsql;
11  public sealed class NpgsqlBatchCommand : DbBatchCommand
12  {
13      string _commandText;
14      [AllowNull]
15      public override string CommandText
16      {
17          get => _commandText;
18          set
19          {
20              _commandText = value ?? string.Empty;
21              ResetPreparation();
22          }
23      }
<span onclick='openModal()' class='match'>24      public override CommandType CommandType { get; set; } = CommandType.Text;
25      protected override DbParameterCollection DbParameterCollection => Parameters;
</span>26      public new NpgsqlParameterCollection Parameters { get; } = new();
27      public bool? AppendErrorBarrier { get; set; }
28      public ulong Rows { get; internal set; }
29      public override int RecordsAffected
30      {
31          get
32          {
33              switch (StatementType)
34              {
35              case StatementType.Update:
36              case StatementType.Insert:
37              case StatementType.Delete:
38              case StatementType.Copy:
39              case StatementType.Move:
40              case StatementType.Merge:
41                  return Rows > int.MaxValue
42                      ? throw new OverflowException($"The number of records affected exceeds int.MaxValue. Use {nameof(Rows)}.")
43                      : (int)Rows;
44              default:
45                  return -1;
46              }
47          }
48      }
49      public StatementType StatementType { get; internal set; }
50      public uint OID { get; internal set; }
51      internal string? FinalCommandText { get; set; }
52      internal List<NpgsqlParameter> PositionalParameters
53      {
54          get => _inputParameters ??= _ownedInputParameters ??= new();
55          set => _inputParameters = value;
56      }
57      List<NpgsqlParameter>? _ownedInputParameters;
58      List<NpgsqlParameter>? _inputParameters;
59      internal RowDescriptionMessage? Description
60      {
61          get => PreparedStatement == null ? _description : PreparedStatement.Description;
62          set
63          {
64              if (PreparedStatement == null)
65                  _description = value;
66              else
67                  PreparedStatement.Description = value;
68          }
69      }
70      RowDescriptionMessage? _description;
71      internal PreparedStatement? PreparedStatement
72      {
73          get => _preparedStatement != null && _preparedStatement.State == PreparedState.Unprepared
74              ? _preparedStatement = null
75              : _preparedStatement;
76          set => _preparedStatement = value;
77      }
78      PreparedStatement? _preparedStatement;
79      internal NpgsqlConnector? ConnectorPreparedOn { get; set; }
80      internal bool IsPreparing;
81      internal string StatementName => PreparedStatement?.Name ?? "";
82      internal bool IsPrepared => PreparedStatement?.IsPrepared == true;
83      internal bool TryGetPrepared([NotNullWhen(true)] out PreparedStatement? preparedStatement)
84      {
85          preparedStatement = PreparedStatement;
86          return preparedStatement?.IsPrepared == true;
87      }
88      public NpgsqlBatchCommand() : this(string.Empty) {}
89      public NpgsqlBatchCommand(string commandText)
90          => _commandText = commandText;
91      internal bool ExplicitPrepare(NpgsqlConnector connector)
92      {
93          if (!IsPrepared)
94          {
95              PreparedStatement = connector.PreparedStatementManager.GetOrAddExplicit(this);
96              if (PreparedStatement?.State == PreparedState.NotPrepared)
97              {
98                  PreparedStatement.State = PreparedState.BeingPrepared;
99                  IsPreparing = true;
100                  return true;
101              }
102          }
103          return false;
104      }
105      [MethodImpl(MethodImplOptions.AggressiveInlining)]
106      internal bool TryAutoPrepare(NpgsqlConnector connector)
107      {
108          if (!TryGetPrepared(out var preparedStatement))
109              preparedStatement = PreparedStatement = connector.PreparedStatementManager.TryGetAutoPrepared(this);
110          if (preparedStatement is not null)
111          {
112              if (preparedStatement.State == PreparedState.NotPrepared)
113              {
114                  preparedStatement.State = PreparedState.BeingPrepared;
115                  IsPreparing = true;
116              }
117              return true;
118          }
119          return false;
120      }
121      internal void Reset()
122      {
123          CommandText = string.Empty;
124          StatementType = StatementType.Select;
125          _description = null;
126          Rows = 0;
127          OID = 0;
128          PreparedStatement = null;
129          if (ReferenceEquals(_inputParameters, _ownedInputParameters))
130              PositionalParameters.Clear();
131          else if (_inputParameters is not null)
132              _inputParameters = null; 
133          Debug.Assert(_inputParameters is null || _inputParameters.Count == 0);
134          Debug.Assert(_ownedInputParameters is null || _ownedInputParameters.Count == 0);
135      }
136      internal void ApplyCommandComplete(CommandCompleteMessage msg)
137      {
138          StatementType = msg.StatementType;
139          Rows = msg.Rows;
140          OID = msg.OID;
141      }
142      internal void ResetPreparation()
143      {
144          PreparedStatement = null;
145          ConnectorPreparedOn = null;
146      }
147      public override string ToString() => CommandText;
148  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudNumericField.razor.cs</h3>
            <pre><code>1  using System;
2  using System.Collections;
3  using System.Diagnostics.CodeAnalysis;
4  using System.Globalization;
5  using System.Text.RegularExpressions;
6  using System.Threading.Tasks;
7  using Microsoft.AspNetCore.Components;
8  using Microsoft.AspNetCore.Components.Web;
9  using MudBlazor.Services;
10  using MudBlazor.Utilities;
11  namespace MudBlazor
12  {
13      public partial class MudNumericField<T> : MudDebouncedInput<T>
14      {
15          private IKeyInterceptor _keyInterceptor;
16          private Comparer _comparer = new(CultureInfo.InvariantCulture);
17          public MudNumericField() : base()
18          {
19              Validation = new Func<T, Task<bool>>(ValidateInput);
20              #region parameters default depending on T
21              if (typeof(T) == typeof(sbyte) || typeof(T) == typeof(sbyte?))
22              {
23                  _minDefault = (T)(object)sbyte.MinValue;
24                  _maxDefault = (T)(object)sbyte.MaxValue;
25                  _stepDefault = (T)(object)(sbyte)1;
26              }
27              else if (typeof(T) == typeof(byte) || typeof(T) == typeof(byte?))
28              {
29                  _minDefault = (T)(object)byte.MinValue;
30                  _maxDefault = (T)(object)byte.MaxValue;
31                  _stepDefault = (T)(object)(byte)1;
32              }
33              else if (typeof(T) == typeof(short) || typeof(T) == typeof(short?))
34              {
35                  _minDefault = (T)(object)short.MinValue;
36                  _maxDefault = (T)(object)short.MaxValue;
37                  _stepDefault = (T)(object)(short)1;
38              }
39              else if (typeof(T) == typeof(ushort) || typeof(T) == typeof(ushort?))
40              {
41                  _minDefault = (T)(object)ushort.MinValue;
42                  _maxDefault = (T)(object)ushort.MaxValue;
43                  _stepDefault = (T)(object)(ushort)1;
44              }
45              else if (typeof(T) == typeof(int) || typeof(T) == typeof(int?))
46              {
47                  _minDefault = (T)(object)int.MinValue;
48                  _maxDefault = (T)(object)int.MaxValue;
49                  _stepDefault = (T)(object)1;
50              }
51              else if (typeof(T) == typeof(uint) || typeof(T) == typeof(uint?))
52              {
53                  _minDefault = (T)(object)uint.MinValue;
54                  _maxDefault = (T)(object)uint.MaxValue;
55                  _stepDefault = (T)(object)1u;
56              }
57              else if (typeof(T) == typeof(long) || typeof(T) == typeof(long?))
58              {
59                  _minDefault = (T)(object)long.MinValue;
60                  _maxDefault = (T)(object)long.MaxValue;
61                  _stepDefault = (T)(object)1L;
62              }
63              else if (typeof(T) == typeof(ulong) || typeof(T) == typeof(ulong?))
64              {
65                  _minDefault = (T)(object)ulong.MinValue;
66                  _maxDefault = (T)(object)ulong.MaxValue;
67                  _stepDefault = (T)(object)1ul;
68              }
69              else if (typeof(T) == typeof(float) || typeof(T) == typeof(float?))
70              {
71                  _minDefault = (T)(object)float.MinValue;
72                  _maxDefault = (T)(object)float.MaxValue;
73                  _stepDefault = (T)(object)1.0f;
74              }
75              else if (typeof(T) == typeof(double) || typeof(T) == typeof(double?))
76              {
77                  _minDefault = (T)(object)double.MinValue;
78                  _maxDefault = (T)(object)double.MaxValue;
79                  _stepDefault = (T)(object)1.0;
80              }
81              else if (typeof(T) == typeof(decimal) || typeof(T) == typeof(decimal?))
82              {
83                  _minDefault = (T)(object)decimal.MinValue;
84                  _maxDefault = (T)(object)decimal.MaxValue;
85                  _stepDefault = (T)(object)1M;
86              }
87              #endregion parameters default depending on T
88          }
89          protected string Classname =>
90              new CssBuilder("mud-input-input-control mud-input-number-control " +
91                             (HideSpinButtons ? "mud-input-nospin" : "mud-input-showspin"))
92                  .AddClass(Class)
93                  .Build();
94          [Inject] private IKeyInterceptorFactory _keyInterceptorFactory { get; set; }
95          private string _elementId = "numericField_" + Guid.NewGuid().ToString().Substring(0, 8);
96          private MudInput<string> _elementReference;
97          [ExcludeFromCodeCoverage]
98          public override ValueTask FocusAsync()
99          {
100              return _elementReference.FocusAsync();
101          }
102          [ExcludeFromCodeCoverage]
103          public override ValueTask BlurAsync()
104          {
105              return _elementReference.BlurAsync();
106          }
107          [ExcludeFromCodeCoverage]
108          public override ValueTask SelectAsync()
109          {
110              return _elementReference.SelectAsync();
111          }
112          [ExcludeFromCodeCoverage]
113          public override ValueTask SelectRangeAsync(int pos1, int pos2)
114          {
115              return _elementReference.SelectRangeAsync(pos1, pos2);
116          }
117          protected override Task SetValueAsync(T value, bool updateText = true, bool force = false)
118          {
119              bool valueChanged;
120              (value, valueChanged) = ConstrainBoundaries(value);
121              return base.SetValueAsync(value, valueChanged || updateText);
122          }
123          protected internal override async Task OnBlurredAsync(FocusEventArgs obj)
124          {
125              await base.OnBlurredAsync(obj);
126              await UpdateValuePropertyAsync(true); 
127              await UpdateTextPropertyAsync(false); 
128          }
129          protected async Task<bool> ValidateInput(T value)
130          {
131              bool valueChanged;
132              (value, valueChanged) = ConstrainBoundaries(value);
133              if (valueChanged)
134                  await SetValueAsync(value, true);
135              return true; 
136          }
137          [Parameter]
138          [Category(CategoryTypes.FormComponent.Behavior)]
139          public bool Clearable { get; set; } = false;
140          private async Task Change(double factor = 1)
141          {
142              try
143              {
144                  var nextValue = GetNextValue(factor);
145                  if (typeof(T).IsValueType)
146                  {
147                      if (factor > 0 && _comparer.Compare(nextValue, Value) < 0)
148                          nextValue = Max;
149                      else if (factor < 0 && (_comparer.Compare(nextValue, Value) > 0 || nextValue is null))
150                          nextValue = Min;
151                  }
152                  await SetValueAsync(ConstrainBoundaries(nextValue).value);
153                  _elementReference.SetText(Text).AndForget();
154              }
155              catch (OverflowException)
156              {
157                  await SetValueAsync(factor > 0 ? Max : Min, true);
158              }
159          }
160          private T GetNextValue(double factor)
161          {
162              if (typeof(T) == typeof(decimal) || typeof(T) == typeof(decimal?))
163                  return (T)(object)Convert.ToDecimal(FromDecimal(Value) + FromDecimal(Step) * (decimal)factor);
164              if (typeof(T) == typeof(long) || typeof(T) == typeof(long?))
165                  return (T)(object)Convert.ToInt64(FromInt64(Value) + FromInt64(Step) * factor);
166              if (typeof(T) == typeof(ulong) || typeof(T) == typeof(ulong?))
167                  return (T)(object)Convert.ToUInt64(FromUInt64(Value) + FromUInt64(Step) * factor);
168              return Num.To<T>(Num.From(Value) + Num.From(Step) * factor);
169          }
170          public Task Increment() => Change(factor: 1);
171          public Task Decrement() => Change(factor: -1);
172          protected (T value, bool changed) ConstrainBoundaries(T value)
173          {
174              if (value == null)
175                  return (default(T), false);
176              if (typeof(T).IsValueType)
177              {
178                  if (_comparer.Compare(value, Max) > 0)
179                      return (Max, true);
180                  if (_comparer.Compare(value, Min) < 0)
181                      return (Min, true);
182              };
183              return (value, false);
184          }
185          protected override async Task OnAfterRenderAsync(bool firstRender)
186          {
187              if (firstRender)
188              {
189                  _keyInterceptor = _keyInterceptorFactory.Create();
190                  await _keyInterceptor.Connect(_elementId, new KeyInterceptorOptions()
191                  {
192                      TargetClass = "mud-input-slot",
193                      Keys = {
194                          new KeyOptions { Key="ArrowUp", PreventDown = "key+none" }, 
195                          new KeyOptions { Key="ArrowDown", PreventDown = "key+none" }, 
196                          new KeyOptions { Key="Dead", PreventDown = "key+any" }, 
197                          new KeyOptions { Key="/^(?!"+(Pattern ?? "[0-9]").TrimEnd('*')+").$/", PreventDown = "key+none|key+shift|key+alt" }, 
198                      },
199                  });
200              }
201              await base.OnAfterRenderAsync(firstRender);
202          }
203          protected async Task HandleKeydown(KeyboardEventArgs obj)
204          {
205              if (GetDisabledState() || GetReadOnlyState())
206                  return;
207              switch (obj.Key)
208              {
209                  case "ArrowUp":
210                      await Increment();
211                      break;
212                  case "ArrowDown":
213                      await Decrement();
214                      break;
215              }
216              OnKeyDown.InvokeAsync(obj).AndForget();
217          }
218          protected Task HandleKeyUp(KeyboardEventArgs obj)
219          {
220              if (GetDisabledState() || GetReadOnlyState())
221                  return Task.CompletedTask;
222              OnKeyUp.InvokeAsync(obj).AndForget();
223              return Task.CompletedTask;
224          }
225          protected async Task OnMouseWheel(WheelEventArgs obj)
226          {
227              if (!obj.ShiftKey || GetDisabledState() || GetReadOnlyState())
228                  return;
229              if (obj.DeltaY < 0)
230              {
231                  if (InvertMouseWheel == false)
232                      await Increment();
233                  else
234                      await Decrement();
235              }
236              else if (obj.DeltaY > 0)
237              {
238                  if (InvertMouseWheel == false)
239                      await Decrement();
240                  else
241                      await Increment();
242              }
243          }
244          private bool _minHasValue = false;
245          [Parameter]
246          [Category(CategoryTypes.FormComponent.Behavior)]
247          public bool InvertMouseWheel { get; set; } = false;
248          private T _minDefault;
249          private T _min;
250          [Parameter]
251          [Category(CategoryTypes.FormComponent.Validation)]
252          public T Min
253          {
254              get => _minHasValue ? _min : _minDefault;
255              set
256              {
257                  _minHasValue = value != null;
258                  _min = value;
259              }
260          }
261          private bool _maxHasValue = false;
262          private T _maxDefault;
263          private T _max;
264          [Parameter]
265          [Category(CategoryTypes.FormComponent.Validation)]
266          public T Max
267          {
268              get => _maxHasValue ? _max : _maxDefault;
269              set
270              {
271                  _maxHasValue = value != null;
272                  _max = value;
273              }
274          }
275          private bool _stepHasValue = false;
276          private T _stepDefault;
277          private T _step;
278          [Parameter]
279          [Category(CategoryTypes.FormComponent.Behavior)]
280          public T Step
281          {
282              get => _stepHasValue ? _step : _stepDefault;
283              set
284              {
285                  _stepHasValue = value != null;
286                  _step = value;
287              }
288          }
289          [Parameter]
290          [Category(CategoryTypes.FormComponent.Appearance)]
291          public bool HideSpinButtons { get; set; }
292          [Parameter]
<span onclick='openModal()' class='match'>293          public override InputMode InputMode { get; set; } = InputMode.numeric;
294          [Parameter]
</span>295          public override string Pattern { get; set; } = @"[0-9,.\-]";
296          private string GetCounterText() => Counter == null ? string.Empty : (Counter == 0 ? (string.IsNullOrEmpty(Text) ? "0" : $"{Text.Length}") : ((string.IsNullOrEmpty(Text) ? "0" : $"{Text.Length}") + $" / {Counter}"));
297          private Task OnInputValueChanged(string text)
298          {
299              return SetTextAsync(text);
300          }
301          private const string TagFormat = "0.###################################################################################################################################################################################################################################################################################################################################################";
302          private string FormatParam(T value)
303          {
304              if (value is IFormattable f)
305                  return f.ToString(TagFormat, CultureInfo.InvariantCulture.NumberFormat);
306              else
307                  return null;
308          }
309          private decimal FromDecimal(T v)
310              => Convert.ToDecimal((decimal?)(object)v);
311          private long FromInt64(T v)
312              => Convert.ToInt64((long?)(object)v);
313          private ulong FromUInt64(T v)
314              => Convert.ToUInt64((ulong?)(object)v);
315          protected override void Dispose(bool disposing)
316          {
317              base.Dispose(disposing);
318              if (disposing == true)
319              {
320                  _keyInterceptor?.Dispose();
321              }
322          }
323      }
324  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NpgsqlBatchCommand.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudNumericField.razor.cs</div>
                </div>
                <div class="column column_space"><pre><code>24      public override CommandType CommandType { get; set; } = CommandType.Text;
25      protected override DbParameterCollection DbParameterCollection => Parameters;
</pre></code></div>
                <div class="column column_space"><pre><code>293          public override InputMode InputMode { get; set; } = InputMode.numeric;
294          [Parameter]
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    