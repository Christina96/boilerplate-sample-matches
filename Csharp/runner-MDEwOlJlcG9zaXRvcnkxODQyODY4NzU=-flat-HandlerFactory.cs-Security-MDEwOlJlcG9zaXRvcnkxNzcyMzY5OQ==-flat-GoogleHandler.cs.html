
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 14, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-HandlerFactory.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using GitHub.DistributedTask.WebApi;
4  using GitHub.Runner.Common.Util;
5  using Pipelines = GitHub.DistributedTask.Pipelines;
6  using GitHub.Runner.Common;
7  using GitHub.Runner.Sdk;
8  namespace GitHub.Runner.Worker.Handlers
9  {
10      [ServiceLocator(Default = typeof(HandlerFactory))]
11      public interface IHandlerFactory : IRunnerService
12      {
13          IHandler Create(
14              IExecutionContext executionContext,
15              Pipelines.ActionStepDefinitionReference action,
16              IStepHost stepHost,
17              ActionExecutionData data,
18              Dictionary<string, string> inputs,
19              Dictionary<string, string> environment,
20              Variables runtimeVariables,
21              string actionDirectory,
22              List<JobExtensionRunner> localActionContainerSetupSteps);
23      }
24      public sealed class HandlerFactory : RunnerService, IHandlerFactory
25      {
26          public IHandler Create(
27              IExecutionContext executionContext,
28              Pipelines.ActionStepDefinitionReference action,
29              IStepHost stepHost,
30              ActionExecutionData data,
31              Dictionary<string, string> inputs,
<span onclick='openModal()' class='match'>32              Dictionary<string, string> environment,
33              Variables runtimeVariables,
34              string actionDirectory,
35              List<JobExtensionRunner> localActionContainerSetupSteps)
</span>36          {
37              Trace.Entering();
38              ArgUtil.NotNull(executionContext, nameof(executionContext));
39              ArgUtil.NotNull(stepHost, nameof(stepHost));
40              ArgUtil.NotNull(data, nameof(data));
41              ArgUtil.NotNull(inputs, nameof(inputs));
42              ArgUtil.NotNull(environment, nameof(environment));
43              ArgUtil.NotNull(runtimeVariables, nameof(runtimeVariables));
44              IHandler handler;
45              if (data.ExecutionType == ActionExecutionType.Container)
46              {
47                  handler = HostContext.CreateService<IContainerActionHandler>();
48                  (handler as IContainerActionHandler).Data = data as ContainerActionExecutionData;
49              }
50              else if (data.ExecutionType == ActionExecutionType.NodeJS)
51              {
52                  handler = HostContext.CreateService<INodeScriptActionHandler>();
53                  var nodeData = data as NodeJSActionExecutionData;
54                  if (string.Equals(nodeData.NodeVersion, "node12", StringComparison.InvariantCultureIgnoreCase) &&
55                      (executionContext.Global.Variables.GetBoolean("DistributedTask.ForceGithubJavascriptActionsToNode16") ?? false))
56                  {
57                      executionContext.Global.EnvironmentVariables.TryGetValue(Constants.Variables.Actions.AllowActionsUseUnsecureNodeVersion, out var workflowOptOut);
58                      var isWorkflowOptOutSet = !string.IsNullOrEmpty(workflowOptOut);
59                      var isLocalOptOut = StringUtil.ConvertToBoolean(Environment.GetEnvironmentVariable(Constants.Variables.Actions.AllowActionsUseUnsecureNodeVersion));
60                      bool isOptOut = isWorkflowOptOutSet ? StringUtil.ConvertToBoolean(workflowOptOut) : isLocalOptOut;
61                      if (!isOptOut)
62                      {
63                          nodeData.NodeVersion = "node16";
64                      }
65                  }
66                  (handler as INodeScriptActionHandler).Data = nodeData;
67              }
68              else if (data.ExecutionType == ActionExecutionType.Script)
69              {
70                  handler = HostContext.CreateService<IScriptHandler>();
71                  (handler as IScriptHandler).Data = data as ScriptActionExecutionData;
72              }
73              else if (data.ExecutionType == ActionExecutionType.Plugin)
74              {
75                  handler = HostContext.CreateService<IRunnerPluginHandler>();
76                  (handler as IRunnerPluginHandler).Data = data as PluginActionExecutionData;
77              }
78              else if (data.ExecutionType == ActionExecutionType.Composite)
79              {
80                  handler = HostContext.CreateService<ICompositeActionHandler>();
81                  (handler as ICompositeActionHandler).Data = data as CompositeActionExecutionData;
82              }
83              else
84              {
85                  throw new NotSupportedException(data.ExecutionType.ToString());
86              }
87              handler.Action = action;
88              handler.Environment = environment;
89              handler.RuntimeVariables = runtimeVariables;
90              handler.ExecutionContext = executionContext;
91              handler.StepHost = stepHost;
92              handler.Inputs = inputs;
93              handler.ActionDirectory = actionDirectory;
94              handler.LocalActionContainerSetupSteps = localActionContainerSetupSteps;
95              return handler;
96          }
97      }
98  }
</code></pre>
        </div>
        <div class="column">
            <h3>Security-MDEwOlJlcG9zaXRvcnkxNzcyMzY5OQ==-flat-GoogleHandler.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Net.Http;
4  using System.Net.Http.Headers;
5  using System.Security.Claims;
6  using System.Text.Encodings.Web;
7  using System.Threading.Tasks;
8  using Microsoft.AspNetCore.Authentication.OAuth;
9  using Microsoft.AspNetCore.WebUtilities;
10  using Microsoft.Extensions.Logging;
11  using Microsoft.Extensions.Options;
12  using Newtonsoft.Json.Linq;
13  namespace Microsoft.AspNetCore.Authentication.Google
14  {
15      public class GoogleHandler : OAuthHandler<GoogleOptions>
16      {
17          public GoogleHandler(IOptionsMonitor<GoogleOptions> options, ILoggerFactory logger, UrlEncoder encoder, ISystemClock clock)
18              : base(options, logger, encoder, clock)
19          { }
20          protected override async Task<AuthenticationTicket> CreateTicketAsync(
21              ClaimsIdentity identity,
22              AuthenticationProperties properties,
23              OAuthTokenResponse tokens)
24          {
25              var request = new HttpRequestMessage(HttpMethod.Get, Options.UserInformationEndpoint);
26              request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", tokens.AccessToken);
27              var response = await Backchannel.SendAsync(request, Context.RequestAborted);
28              if (!response.IsSuccessStatusCode)
29              {
30                  throw new HttpRequestException($"An error occurred when retrieving Google user information ({response.StatusCode}). Please check if the authentication information is correct and the corresponding Google+ API is enabled.");
31              }
32              var payload = JObject.Parse(await response.Content.ReadAsStringAsync());
33              var context = new OAuthCreatingTicketContext(new ClaimsPrincipal(identity), properties, Context, Scheme, Options, Backchannel, tokens, payload);
34              context.RunClaimActions();
35              await Events.CreatingTicket(context);
36              return new AuthenticationTicket(context.Principal, context.Properties, Scheme.Name);
37          }
38          protected override string BuildChallengeUrl(AuthenticationProperties properties, string redirectUri)
39          {
40              var queryStrings = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase);
41              queryStrings.Add("response_type", "code");
42              queryStrings.Add("client_id", Options.ClientId);
43              queryStrings.Add("redirect_uri", redirectUri);
44              AddQueryString(queryStrings, properties, GoogleChallengeProperties.ScopeKey, FormatScope, Options.Scope);
45              AddQueryString(queryStrings, properties, GoogleChallengeProperties.AccessTypeKey, Options.AccessType);
46              AddQueryString(queryStrings, properties, GoogleChallengeProperties.ApprovalPromptKey);
47              AddQueryString(queryStrings, properties, GoogleChallengeProperties.PromptParameterKey);
48              AddQueryString(queryStrings, properties, GoogleChallengeProperties.LoginHintKey);
49              AddQueryString(queryStrings, properties, GoogleChallengeProperties.IncludeGrantedScopesKey, v => v?.ToString().ToLower(), (bool?)null);
50              var state = Options.StateDataFormat.Protect(properties);
51              queryStrings.Add("state", state);
52              var authorizationEndpoint = QueryHelpers.AddQueryString(Options.AuthorizationEndpoint, queryStrings);
53              return authorizationEndpoint;
54          }
55          private void AddQueryString<T>(
56              IDictionary<string, string> queryStrings,
57              AuthenticationProperties properties,
58              string name,
59              Func<T, string> formatter,
60              T defaultValue)
61          {
62              string value = null;
63              var parameterValue = properties.GetParameter<T>(name);
64              if (parameterValue != null)
65              {
66                  value = formatter(parameterValue);
67              }
68              else if (!properties.Items.TryGetValue(name, out value))
69              {
70                  value = formatter(defaultValue);
71              }
72              properties.Items.Remove(name);
73              if (value != null)
74              {
75                  queryStrings[name] = value;
76              }
77          }
78          private void AddQueryString(
<span onclick='openModal()' class='match'>79              IDictionary<string, string> queryStrings,
80              AuthenticationProperties properties,
81              string name,
82              string defaultValue = null)
</span>83              => AddQueryString(queryStrings, properties, name, x => x, defaultValue);
84      }
85  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-HandlerFactory.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Security-MDEwOlJlcG9zaXRvcnkxNzcyMzY5OQ==-flat-GoogleHandler.cs</div>
                </div>
                <div class="column column_space"><pre><code>32              Dictionary<string, string> environment,
33              Variables runtimeVariables,
34              string actionDirectory,
35              List<JobExtensionRunner> localActionContainerSetupSteps)
</pre></code></div>
                <div class="column column_space"><pre><code>79              IDictionary<string, string> queryStrings,
80              AuthenticationProperties properties,
81              string name,
82              string defaultValue = null)
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    