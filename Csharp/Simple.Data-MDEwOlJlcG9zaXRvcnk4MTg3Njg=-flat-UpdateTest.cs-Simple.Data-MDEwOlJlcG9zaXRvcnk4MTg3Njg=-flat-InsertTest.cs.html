
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 14, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-UpdateTest.cs</h3>
            <pre><code>1  using NUnit.Framework;
2  using Simple.Data.Mocking.Ado;
3  namespace Simple.Data.IntegrationTest
4  {
5      using System;
6      using System.Collections.Generic;
7      [TestFixture]
8      public class UpdateTest : DatabaseIntegrationContext
9      {
10          protected override void SetSchema(MockSchemaProvider schemaProvider)
11          {
12              schemaProvider.SetTables(new object[] { "dbo", "Users", "BASE TABLE" },
13                                       new object[] { "dbo", "UserHistory", "BASE TABLE"},
14                                       new object[] { "dbo", "AnnoyingMaster", "BASE TABLE"},
15                                       new[] { "dbo", "AnnoyingDetail", "BASE TABLE"},
16                                       new[] {"dbo", "USER_TABLE", "BASE TABLE"});
17              schemaProvider.SetColumns(new object[] { "dbo", "Users", "Id", true },
18                                        new[] { "dbo", "Users", "Name" },
19                                        new[] { "dbo", "Users", "Password" },
20                                        new[] { "dbo", "Users", "Age" },
21                                        new[] { "dbo", "UserHistory", "Id" },
22                                        new[] { "dbo", "UserHistory", "UserId" },
23                                        new[] { "dbo", "UserHistory", "LastSeen" },
24                                        new[] { "dbo", "AnnoyingMaster", "Id1" },
25                                        new[] { "dbo", "AnnoyingMaster", "Id2" },
26                                        new[] { "dbo", "AnnoyingMaster", "Text" },
27                                        new[] { "dbo", "AnnoyingDetail", "Id" },
28                                        new[] { "dbo", "AnnoyingDetail", "MasterId1" },
29                                        new[] { "dbo", "AnnoyingDetail", "MasterId2" },
30                                        new[] { "dbo", "AnnoyingDetail", "Value" },
31                                        new object[] { "dbo", "USER_TABLE", "ID", true },
32                                        new[] { "dbo", "USER_TABLE", "NAME" },
33                                        new[] { "dbo", "USER_TABLE", "PASSWORD" },
34                                        new[] { "dbo", "USER_TABLE", "AGE" });
35              schemaProvider.SetPrimaryKeys(new object[] { "dbo", "Users", "Id", 0 },
36                                            new object[] { "dbo", "UserHistory", "Id", 0 },
37                                            new object[] { "dbo", "AnnoyingMaster", "Id1", 0 },
38                                            new object[] { "dbo", "AnnoyingMaster", "Id2", 1 },
39                                            new object[] { "dbo", "AnnoyingDetail", "Id", 0 },
40                                            new object[] { "dbo", "USER_TABLE", "ID", 0 });
41              schemaProvider.SetForeignKeys(
42                  new object[] { "FK_UserHistory_User", "dbo", "UserHistory", "UserId", "dbo", "Users", "Id", 0 },
43                  new object[] { "FK_AnnoyingDetail_AnnoyingMaster", "dbo", "AnnoyingDetail", "MasterId1", "dbo", "AnnoyingMaster", "Id1", 0 },
44                  new object[] { "FK_AnnoyingDetail_AnnoyingMaster", "dbo", "AnnoyingDetail", "MasterId2", "dbo", "AnnoyingMaster", "Id2", 1 }
45                  );
46          }
47          [Test]
48          public void TestUpdateWithNamedArguments()
49          {
50              _db.Users.UpdateById(Id: 1, Name: "Steve", Age: 50);
51              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1, [Age] = @p2 where [dbo].[Users].[Id] = @p3");
52              Parameter(0).Is("Steve");
53              Parameter(1).Is(50);
54              Parameter(2).Is(1);
55          }
56          [Test]
57          public void TestUpdateWithNamedArgumentsUsingDifferentCase()
58          {
59              _db.Users.UpdateById(id: 1, Name: "Steve", Age: 50);
60              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1, [Age] = @p2 where [dbo].[Users].[Id] = @p3");
61              Parameter(0).Is("Steve");
62              Parameter(1).Is(50);
63              Parameter(2).Is(1);
64          }
65          [Test]
66          public void TestUpdateWithNamedArgumentsUsingExpression()
67          {
68              _db.Users.UpdateAll(Age: _db.Users.Age + 1);
69              GeneratedSqlIs("update [dbo].[Users] set [Age] = ([dbo].[Users].[Age] + @p1)");
70              Parameter(0).Is(1);
71          }
72          [Test]
73          public void TestUpdateWithDynamicObject()
74          {
75              dynamic record = new SimpleRecord();
76              record.Id = 1;
77              record.Name = "Steve";
78              record.Age = 50;
79              _db.Users.Update(record);
80              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1, [Age] = @p2 where [dbo].[Users].[Id] = @p3");
81              Parameter(0).Is("Steve");
82              Parameter(1).Is(50);
83              Parameter(2).Is(1);
84          }
85          [Test]
86          public void TestUpdateWithDynamicObjectAndOriginalValues()
87          {
88              dynamic newRecord = new SimpleRecord();
89              newRecord.Id = 1;
90              newRecord.Name = "Steve-o";
91              newRecord.Age = 50;
92              dynamic originalRecord = new SimpleRecord();
93              originalRecord.Id = 1;
94              originalRecord.Name = "Steve";
95              originalRecord.Age = 50;
96              _db.Users.Update(newRecord, originalRecord);
97              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where ([dbo].[Users].[Id] = @p2 and [dbo].[Users].[Name] = @p3)");
98              Parameter(0).Is("Steve-o");
99              Parameter(1).Is(1);
100              Parameter(2).Is("Steve");
101          }
102          [Test]
103          public void TestUpdateWithDynamicObjectsAndOriginalValues()
104          {
105              dynamic newRecord = new SimpleRecord();
106              newRecord.Id = 1;
107              newRecord.Name = "Steve-o";
108              newRecord.Age = 50;
109              dynamic originalRecord = new SimpleRecord();
110              originalRecord.Id = 1;
111              originalRecord.Name = "Steve";
112              originalRecord.Age = 50;
113              _db.Users.Update(new[] {newRecord}, new[] {originalRecord});
114              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where ([dbo].[Users].[Id] = @p2 and [dbo].[Users].[Name] = @p3)");
115              Parameter(0).Is("Steve-o");
116              Parameter(1).Is(1);
117              Parameter(2).Is("Steve");
118          }
119          [Test]
120          public void TestUpdateWithDynamicObjectList()
121          {
122              dynamic record1 = new SimpleRecord();
123              record1.Id = 1;
124              record1.Name = "Steve";
125              record1.Age = 50;
126              dynamic record2 = new SimpleRecord();
127              record2.Id = 2;
128              record2.Name = "Bob";
129              record2.Age = 42;
130              _db.Users.Update(new[] { record1, record2 });
131              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1, [Age] = @p2 where [dbo].[Users].[Id] = @p3");
132              Parameter(0).Is("Bob");
133              Parameter(1).Is(42);
134              Parameter(2).Is(2);
135          }
136          [Test]
137          public void TestUpdateByWithDynamicObjectList()
138          {
139              dynamic record1 = new SimpleRecord();
140              record1.Id = 1;
141              record1.Name = "Steve";
142              record1.Age = 50;
143              dynamic record2 = new SimpleRecord();
144              record2.Id = 2;
145              record2.Name = "Bob";
146              record2.Age = 42;
147              _db.Users.UpdateById(new[] { record1, record2 });
148              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1, [Age] = @p2 where [dbo].[Users].[Id] = @p3");
149              Parameter(0).Is("Bob");
150              Parameter(1).Is(42);
151              Parameter(2).Is(2);
152          }
153          [Test]
154          public void TestUpdateByWithDynamicObject()
155          {
156              dynamic record = new SimpleRecord();
157              record.Id = 1;
158              record.Name = "Steve";
159              record.Age = 50;
160              _db.Users.UpdateById(record);
161              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1, [Age] = @p2 where [dbo].[Users].[Id] = @p3");
162              Parameter(0).Is("Steve");
163              Parameter(1).Is(50);
164              Parameter(2).Is(1);
165          }
166          [Test]
167          public void TestUpdateWithStaticObject()
168          {
169              var user = new User
170                             {
171                                 Id = 1,
172                                 Name = "Steve",
173                                 Age = 50
174                             };
175              _db.Users.Update(user);
176              GeneratedSqlIs(
177                  "update [dbo].[Users] set [Name] = @p1, [Password] = @p2, [Age] = @p3 where [dbo].[Users].[Id] = @p4");
178              Parameter(0).Is("Steve");
179              Parameter(1).IsDBNull();
180              Parameter(2).Is(50);
181              Parameter(3).Is(1);
182          }
183          [Test]
184          public void TestUpdateWithStaticObjectAndOriginalObject()
185          {
186              var newUser = new User
187                             {
188                                 Id = 1,
189                                 Name = "Steve-o",
190                                 Age = 50
191                             };
192              var originalUser = new User {Id = 1, Name = "Steve", Age = 50};
193              _db.Users.Update(newUser, originalUser);
194              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where ([dbo].[Users].[Id] = @p2 and [dbo].[Users].[Name] = @p3)");
195              Parameter(0).Is("Steve-o");
196              Parameter(1).Is(1);
197              Parameter(2).Is("Steve");
198          }
199          [Test]
200          public void TestUpdateWithStaticObjectsAndOriginalObject()
201          {
202              var newUser = new User
203              {
204                  Id = 1,
205                  Name = "Steve-o",
206                  Age = 50
207              };
208              var originalUser = new User { Id = 1, Name = "Steve", Age = 50 };
209              _db.Users.Update(new[] {newUser}, new[] {originalUser});
210              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where ([dbo].[Users].[Id] = @p2 and [dbo].[Users].[Name] = @p3)");
211              Parameter(0).Is("Steve-o");
212              Parameter(1).Is(1);
213              Parameter(2).Is("Steve");
214          }
215          [Test]
216          public void TestUpdateWithStaticObjectWithShoutyCase()
217          {
218              var user = new User
219              {
220                  Id = 1,
221                  Name = "Steve",
222                  Age = 50
223              };
224              _db.UserTable.Update(user);
225              GeneratedSqlIs(
226                  "update [dbo].[USER_TABLE] set [NAME] = @p1, [PASSWORD] = @p2, [AGE] = @p3 where [dbo].[USER_TABLE].[ID] = @p4");
227              Parameter(0).Is("Steve");
228              Parameter(1).IsDBNull();
229              Parameter(2).Is(50);
230              Parameter(3).Is(1);
231          }
232          [Test]
233          public void TestUpdateWithStaticObjectWithAdditionalProperty()
234          {
235              var user = new RogueUser
236              {
237                  Id = 1,
238                  Name = "Steve",
239                  Age = 50,
240                  RogueProperty = 42
241              };
<span onclick='openModal()' class='match'>242              _db.Users.Update(user);
243              GeneratedSqlIs(
244                  "update [dbo].[Users] set [Name] = @p1, [Password] = @p2, [Age] = @p3 where [dbo].[Users].[Id] = @p4");
245              Parameter(0).Is("Steve");
</span>246              Parameter(1).IsDBNull();
247              Parameter(2).Is(50);
248              Parameter(3).Is(1);
249          }
250          [Test]
251          public void TestUpdateWithStaticObjectList()
252          {
253              var users = new[]
254                              {
255                                  new User { Id = 2, Name = "Bob", Age = 42 },
256                                  new User { Id = 1, Name = "Steve", Age = 50 }
257                              };
258              _db.Users.Update(users);
259              GeneratedSqlIs(
260                  "update [dbo].[Users] set [Name] = @p1, [Password] = @p2, [Age] = @p3 where [dbo].[Users].[Id] = @p4");
261              Parameter(0).Is("Steve");
262              Parameter(1).IsDBNull();
263              Parameter(2).Is(50);
264              Parameter(3).Is(1);
265          }
266          [Test]
267          public void TestUpdateByWithStaticObjectList()
268          {
269              var users = new[]
270                              {
271                                  new User { Id = 2, Name = "Bob", Age = 42 },
272                                  new User { Id = 1, Name = "Steve", Age = 50 }
273                              };
274              _db.Users.UpdateById(users);
275              GeneratedSqlIs(
276                  "update [dbo].[Users] set [Name] = @p1, [Password] = @p2, [Age] = @p3 where [dbo].[Users].[Id] = @p4");
277              Parameter(0).Is("Steve");
278              Parameter(1).IsDBNull();
279              Parameter(2).Is(50);
280              Parameter(3).Is(1);
281          }
282          [Test]
283          public void TestUpdateByWithStaticObject()
284          {
285              var user = new User
286                             {
287                                 Id = 1,
288                                 Name = "Steve",
289                                 Age = 50
290                             };
291              _db.Users.UpdateById(user);
292              GeneratedSqlIs(
293                  "update [dbo].[Users] set [Name] = @p1, [Password] = @p2, [Age] = @p3 where [dbo].[Users].[Id] = @p4");
294              Parameter(0).Is("Steve");
295              Parameter(1).IsDBNull();
296              Parameter(2).Is(50);
297              Parameter(3).Is(1);
298          }
299          [Test]
300          public void TestThatUpdateUsesDbNullForNullValues()
301          {
302              _db.Users.UpdateById(Id: 1, Name: null);
303              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where [dbo].[Users].[Id] = @p2");
304              Parameter(0).IsDBNull();
305          }
306          [Test]
307          public void TestUpdateAll()
308          {
309              _db.Users.UpdateAll(Name: "Steve");
310              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1");
311              Parameter(0).Is("Steve");
312          }
313          [Test]
314          public void TestUpdateWithCriteria()
315          {
316              _db.Users.UpdateAll(_db.Users.Age > 30, Name: "Steve");
317              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where [dbo].[Users].[Age] > @p2");
318              Parameter(0).Is("Steve");
319              Parameter(1).Is(30);
320          }
321          [Test]
322          public void TestUpdateWithCriteriaWithNaturalJoin()
323          {
324              var yearAgo = DateTime.Today.Subtract(TimeSpan.FromDays(365));
325              _db.Users.UpdateAll(_db.Users.UserHistory.LastSeen < yearAgo, Name: "Dead User");
326              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where [dbo].[Users].[Id] in " +
327                  "(select [dbo].[Users].[Id] from [dbo].[Users] join [dbo].[UserHistory] on ([dbo].[Users].[Id] = [dbo].[UserHistory].[UserId]) where [dbo].[UserHistory].[LastSeen] < @p2)");
328              Parameter(0).Is("Dead User");
329              Parameter(1).Is(yearAgo);
330          }
331          [Test]
332          public void TestUpdateWithCriteriaWithNaturalJoinOnCompoundKeyTable()
333          {
334              _db.AnnoyingMaster.UpdateAll(_db.AnnoyingMaster.AnnoyingDetail.Value < 42, Text: "Really annoying");
335              GeneratedSqlIs("update [dbo].[AnnoyingMaster] set [Text] = @p1 where exists " +
336                  "(select 1 from [dbo].[AnnoyingMaster] [_updatejoin] join [dbo].[AnnoyingDetail] on ([_updatejoin].[Id1] = [dbo].[AnnoyingDetail].[MasterId1] and [_updatejoin].[Id2] = [dbo].[AnnoyingDetail].[MasterId2]) "+
337                  "where [dbo].[AnnoyingDetail].[Value] < @p2 and ([_updatejoin].[Id1] = [dbo].[AnnoyingMaster].[Id1] and [_updatejoin].[Id2] = [dbo].[AnnoyingMaster].[Id2]))");
338              Parameter(0).Is("Really annoying");
339              Parameter(1).Is(42);
340          }
341          [Test]
342          public void TestUpdateWithCriteriaAndDictionary()
343          {
344              var data = new Dictionary<string, object> { { "Name", "Steve" } };
345              _db.Users.UpdateAll(_db.Users.Age > 30, data);
346              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where [dbo].[Users].[Age] > @p2");
347              Parameter(0).Is("Steve");
348              Parameter(1).Is(30);
349          }
350          [Test]
351          public void TestUpdateWithCriteriaAsNamedArg()
352          {
353              _db.Users.UpdateAll(Name: "Steve", Condition: _db.Users.Age > 30);
354              GeneratedSqlIs("update [dbo].[Users] set [Name] = @p1 where [dbo].[Users].[Age] > @p2");
355              Parameter(0).Is("Steve");
356              Parameter(1).Is(30);
357          }
358      }
359  }
</code></pre>
        </div>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-InsertTest.cs</h3>
            <pre><code>1  namespace Simple.Data.IntegrationTest
2  {
3      using System;
4      using System.Dynamic;
5      using Mocking.Ado;
6      using NUnit.Framework;
7      [TestFixture]
8      public class InsertTest: DatabaseIntegrationContext
9      {
10          protected override void SetSchema(MockSchemaProvider schemaProvider)
11          {
12              schemaProvider.SetTables(new[] { "dbo", "Users", "BASE TABLE" });
13              schemaProvider.SetColumns(new object[] { "dbo", "Users", "Id", true },
14                                        new[] { "dbo", "Users", "Name" },
15                                        new[] { "dbo", "Users", "Password" },
16                                        new[] { "dbo", "Users", "Age" });
17              schemaProvider.SetPrimaryKeys(new object[] { "dbo", "Users", "Id", 0 });
18          }
19          [Test]
20          public void TestInsertWithNamedArguments()
21          {
22              _db.Users.Insert(Name: "Steve", Age: 50);
23              GeneratedSqlIs("insert into [dbo].[Users] ([Name],[Age]) values (@p0,@p1)");
24              Parameter(0).Is("Steve");
25              Parameter(1).Is(50);
26          }
27          [Test]
28          public void TestInsertWithNamedArgumentsAndIdentityFunctionSelects()
29          {
30              _MockConnectionProvider.SetIdentityFunction("@@IDENTITY");
31              var u = _db.Users.Insert(Name: "Steve", Age: 50);
32              GeneratedSqlIs("insert into [dbo].[Users] ([Name],[Age]) values (@p0,@p1); select * from [dbo].[users] where [id] = @@identity");
33              Parameter(0).Is("Steve");
34              Parameter(1).Is(50);
35              _MockConnectionProvider.SetIdentityFunction(null);
36          }
37          [Test]
38          public void TestInsertWithNamedArgumentsAndIdentityFunctionThatExpectsNoReturnValueDoesNotSelect()
39          {
40              _MockConnectionProvider.SetIdentityFunction("@@IDENTITY");
41              _db.Users.Insert(Name: "Steve", Age: 50);
42              GeneratedSqlIs("insert into [dbo].[Users] ([Name],[Age]) values (@p0,@p1)");
43              Parameter(0).Is("Steve");
44              Parameter(1).Is(50);
45              _MockConnectionProvider.SetIdentityFunction(null);
46          }
47          [Test]
48          public void TestInsertWithStaticTypeObject()
49          {
50              var user = new User { Name = "Steve", Age = 50 };
<span onclick='openModal()' class='match'>51              _db.Users.Insert(user);
52              GeneratedSqlIs("insert into [dbo].[Users] ([Name],[Password],[Age]) values (@p0,@p1,@p2)");
53              Parameter(0).Is("Steve");
</span>54              Parameter(1).Is(DBNull.Value);
55              Parameter(2).Is(50);
56          }
57          [Test]
58          public void TestInsertWithDynamicObject()
59          {
60              dynamic person = new ExpandoObject();
61              person.Name = "Phil";
62              person.Age = 42;
63              _db.Users.Insert(person);
64              GeneratedSqlIs("insert into [dbo].[Users] ([Name],[Age]) values (@p0,@p1)");
65              Parameter(0).Is("Phil");
66              Parameter(1).Is(42);
67          }
68          [Test]
69          public void TestThatInsertUsesDBNull()
70          {
71              dynamic person = new ExpandoObject();
72              person.Name = null;
73              _db.Users.Insert(person);
74              Parameter(0).Is(DBNull.Value);
75          }
76      }
77  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-UpdateTest.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-InsertTest.cs</div>
                </div>
                <div class="column column_space"><pre><code>242              _db.Users.Update(user);
243              GeneratedSqlIs(
244                  "update [dbo].[Users] set [Name] = @p1, [Password] = @p2, [Age] = @p3 where [dbo].[Users].[Id] = @p4");
245              Parameter(0).Is("Steve");
</pre></code></div>
                <div class="column column_space"><pre><code>51              _db.Users.Insert(user);
52              GeneratedSqlIs("insert into [dbo].[Users] ([Name],[Password],[Age]) values (@p0,@p1,@p2)");
53              Parameter(0).Is("Steve");
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    