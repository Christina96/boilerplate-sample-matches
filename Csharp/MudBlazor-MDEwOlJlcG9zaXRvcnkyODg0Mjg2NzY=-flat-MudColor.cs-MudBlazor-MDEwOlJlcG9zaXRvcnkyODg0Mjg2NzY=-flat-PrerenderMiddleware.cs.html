
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 12, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColor.cs</h3>
            <pre><code>1  using System;
2  using System.Globalization;
3  using MudBlazor.Extensions;
4  namespace MudBlazor.Utilities
5  {
6      public enum MudColorOutputFormats
7      {
8          Hex,
9          HexA,
10          RGB,
11          RGBA,
12          ColorElements
13      }
14      public class MudColor : IEquatable<MudColor>
15      {
16          #region Fields and Properties
17          private const double EPSILON = 0.000000000000001;
18          private byte[] _valuesAsByte;
19          public string Value => $"#{R:x2}{G:x2}{B:x2}{A:x2}";
20          public byte R => _valuesAsByte[0];
21          public byte G => _valuesAsByte[1];
22          public byte B => _valuesAsByte[2];
23          public byte A => _valuesAsByte[3];
24          public double APercentage => Math.Round((A / 255.0), 2);
25          public double H { get; private set; }
26          public double L { get; private set; }
27          public double S { get; private set; }
28          #endregion
29          #region Constructor
30          public MudColor(double h, double s, double l, double a)
31           : this(h, s, l, (int)((a * 255.0).EnsureRange(255)))
32          {
33          }
34          public MudColor(double h, double s, double l, int a)
35          {
36              _valuesAsByte = new byte[4];
37              h = Math.Round(h.EnsureRange(360), 0);
38              s = Math.Round(s.EnsureRange(1), 2);
39              l = Math.Round(l.EnsureRange(1), 2);
40              a = a.EnsureRange(255);
41              if (Math.Abs(s) < EPSILON)
42              {
43                  _valuesAsByte[0] = (byte)Math.Max(0, Math.Min(255, (int)Math.Ceiling(l * 255D)));
44                  _valuesAsByte[1] = (byte)Math.Max(0, Math.Min(255, (int)Math.Ceiling(l * 255D)));
45                  _valuesAsByte[2] = (byte)Math.Max(0, Math.Min(255, (int)Math.Ceiling(l * 255D)));
46                  _valuesAsByte[3] = (byte)a;
47              }
48              else
49              {
50                  var q = l < .5D
51                          ? l * (1D + s)
52                          : (l + s) - (l * s);
53                  var p = (2D * l) - q;
54                  var hk = h / 360D;
55                  var T = new double[3];
56                  T[0] = hk + (1D / 3D); 
57                  T[1] = hk; 
58                  T[2] = hk - (1D / 3D); 
59                  for (var i = 0; i < 3; i++)
60                  {
61                      if (T[i] < 0D)
62                          T[i] += 1D;
63                      if (T[i] > 1D)
64                          T[i] -= 1D;
65                      if ((T[i] * 6D) < 1D)
66                          T[i] = p + ((q - p) * 6D * T[i]);
67                      else if ((T[i] * 2D) < 1)
68                          T[i] = q;
69                      else if ((T[i] * 3D) < 2)
70                          T[i] = p + ((q - p) * ((2D / 3D) - T[i]) * 6D);
71                      else
72                          T[i] = p;
73                  }
74                  _valuesAsByte[0] = ((int)Math.Round(T[0] * 255D)).EnsureRangeToByte();
75                  _valuesAsByte[1] = ((int)Math.Round(T[1] * 255D)).EnsureRangeToByte();
76                  _valuesAsByte[2] = ((int)Math.Round(T[2] * 255D)).EnsureRangeToByte();
77                  _valuesAsByte[3] = (byte)a;
78              }
79              H = Math.Round(h, 0);
80              S = Math.Round(s, 2);
81              L = Math.Round(l, 2);
82          }
83          public MudColor(byte r, byte g, byte b, byte a)
84          {
85              _valuesAsByte = new byte[4];
86              _valuesAsByte[0] = r;
87              _valuesAsByte[1] = g;
88              _valuesAsByte[2] = b;
89              _valuesAsByte[3] = a;
90              CalculateHSL();
91          }
92          public MudColor(byte r, byte g, byte b, MudColor color) : this(r,g,b,color.A)
93          {
94              H = color.H;
95          }
96          public MudColor(int r, int g, int b, double alpha) :
97           this(r, g, b, (byte)((alpha * 255.0).EnsureRange(255)))
98          {
99          }
100          public MudColor(int r, int g, int b, int alpha) :
101              this((byte)r.EnsureRange(255), (byte)g.EnsureRange(255), (byte)b.EnsureRange(255), (byte)alpha.EnsureRange(255))
102          {
103          }
104          public MudColor(string value)
105          {
106              value = value.Trim().ToLower();
<span onclick='openModal()' class='match'>107              if (value.StartsWith("rgba") == true)
108              {
109                  var parts = SplitInputIntoParts(value);
</span>110                  if (parts.Length != 4)
111                  {
112                      throw new ArgumentException("invalid color format");
113                  }
114                  _valuesAsByte = new byte[]
115                  {
116                      byte.Parse(parts[0],CultureInfo.InvariantCulture),
117                      byte.Parse(parts[1],CultureInfo.InvariantCulture),
118                      byte.Parse(parts[2],CultureInfo.InvariantCulture),
119                      (byte)Math.Max(0, Math.Min(255, 255 * double.Parse(parts[3],CultureInfo.InvariantCulture))),
120                  };
121              }
122              else if (value.StartsWith("rgb") == true)
123              {
124                  var parts = SplitInputIntoParts(value);
125                  if (parts.Length != 3)
126                  {
127                      throw new ArgumentException("invalid color format");
128                  }
129                  _valuesAsByte = new byte[]
130                  {
131                      byte.Parse(parts[0],CultureInfo.InvariantCulture),
132                      byte.Parse(parts[1],CultureInfo.InvariantCulture),
133                      byte.Parse(parts[2],CultureInfo.InvariantCulture),
134                      255
135                  };
136              }
137              else
138              {
139                  if (value.StartsWith("#"))
140                  {
141                      value = value.Substring(1);
142                  }
143                  switch (value.Length)
144                  {
145                      case 3:
146                          value = new string(new char[8] { value[0], value[0], value[1], value[1], value[2], value[2], 'F', 'F' });
147                          break;
148                      case 4:
149                          value = new string(new char[8] { value[0], value[0], value[1], value[1], value[2], value[2], value[3], value[3] });
150                          break;
151                      case 6:
152                          value += "FF";
153                          break;
154                      case 8:
155                          break;
156                      default:
157                          throw new ArgumentException("not a valid color", nameof(value));
158                  }
159                  _valuesAsByte = new byte[]
160                  {
161                      GetByteFromValuePart(value,0),
162                      GetByteFromValuePart(value,2),
163                      GetByteFromValuePart(value,4),
164                      GetByteFromValuePart(value,6),
165                  };
166                  CalculateHSL();
167              }
168          }
169          #endregion
170          #region Methods
171          private void CalculateHSL()
172          {
173              var h = 0D;
174              var s = 0D;
175              double l;
176              var r = R / 255D;
177              var g = G / 255D;
178              var b = B / 255D;
179              var max = Math.Max(r, Math.Max(g, b));
180              var min = Math.Min(r, Math.Min(g, b));
181              if (Math.Abs(max - min) < EPSILON)
182                  h = 0D; 
183              else if ((Math.Abs(max - r) < EPSILON)
184                      && (g >= b))
185                  h = (60D * (g - b)) / (max - min);
186              else if ((Math.Abs(max - r) < EPSILON)
187                      && (g < b))
188                  h = ((60D * (g - b)) / (max - min)) + 360D;
189              else if (Math.Abs(max - g) < EPSILON)
190                  h = ((60D * (b - r)) / (max - min)) + 120D;
191              else if (Math.Abs(max - b) < EPSILON)
192                  h = ((60D * (r - g)) / (max - min)) + 240D;
193              l = (max + min) / 2D;
194              if ((Math.Abs(l) < EPSILON)
195                      || (Math.Abs(max - min) < EPSILON))
196                  s = 0D;
197              else if ((0D < l)
198                      && (l <= .5D))
199                  s = (max - min) / (max + min);
200              else if (l > .5D)
201                  s = (max - min) / (2D - (max + min)); 
202              H = Math.Round(h.EnsureRange(360), 0);
203              S = Math.Round(s.EnsureRange(1), 2);
204              L = Math.Round(l.EnsureRange(1), 2);
205          }
206          public MudColor SetH(double h) => new(h, S, L, A);
207          public MudColor SetS(double s) => new(H, s, L, A);
208          public MudColor SetL(double l) => new(H, S, l, A);
209          public MudColor SetR(int r) => new(r, G, B, A);
210          public MudColor SetG(int g) => new(R, g, B, A);
211          public MudColor SetB(int b) => new(R, G, b, A);
212          public MudColor SetAlpha(int a) => new(R, G, B, a);
213          public MudColor SetAlpha(double a) => new(R, G, B, a);
214          public MudColor ChangeLightness(double amount) => new(H, S, Math.Max(0, Math.Min(1, L + amount)), A);
215          public MudColor ColorLighten(double amount) => ChangeLightness(+amount);
216          public MudColor ColorDarken(double amount) => ChangeLightness(-amount);
217          public MudColor ColorRgbLighten() => ColorLighten(0.075);
218          public MudColor ColorRgbDarken() => ColorDarken(0.075);
219          #endregion
220          #region Helper
221          private static string[] SplitInputIntoParts(string value)
222          {
223              var startIndex = value.IndexOf('(');
224              var lastIndex = value.LastIndexOf(')');
225              var subString = value[(startIndex + 1)..lastIndex];
226              var parts = subString.Split(',', StringSplitOptions.RemoveEmptyEntries);
227              for (var i = 0; i < parts.Length; i++)
228              {
229                  parts[i] = parts[i].Trim();
230              }
231              return parts;
232          }
233          private byte GetByteFromValuePart(string input, int index) => byte.Parse(new string(new char[] { input[index], input[index + 1] }), NumberStyles.HexNumber);
234          public bool HslChanged(MudColor value) => this.H != value.H || this.S != value.S || this.L != value.L;
235          #endregion
236          #region operators and object members
237          public static implicit operator MudColor(string input) => new(input);
238          public static explicit operator string(MudColor color) => color == null ? string.Empty : color.Value;
239          public override string ToString() => ToString(MudColorOutputFormats.HexA);
240          public string ToString(MudColorOutputFormats format) => format switch
241          {
242              MudColorOutputFormats.Hex => Value.Substring(0, 7),
243              MudColorOutputFormats.HexA => Value,
244              MudColorOutputFormats.RGB => $"rgb({R},{G},{B})",
245              MudColorOutputFormats.RGBA => $"rgba({R},{G},{B},{(A / 255.0).ToString(CultureInfo.InvariantCulture)})",
246              MudColorOutputFormats.ColorElements => $"{R},{G},{B}",
247              _ => Value,
248          };
249          public override bool Equals(object obj) => obj is MudColor color && Equals(color);
250          public bool Equals(MudColor other)
251          {
252              if (ReferenceEquals(other, null) == true) { return false; }
253              return
254                  _valuesAsByte[0] == other._valuesAsByte[0] &&
255                  _valuesAsByte[1] == other._valuesAsByte[1] &&
256                  _valuesAsByte[2] == other._valuesAsByte[2] &&
257                  _valuesAsByte[3] == other._valuesAsByte[3];
258          }
259          public override int GetHashCode() => _valuesAsByte[0] + _valuesAsByte[1] + _valuesAsByte[2] + _valuesAsByte[3];
260          public static bool operator ==(MudColor lhs, MudColor rhs)
261          {
262              var lhsIsNull = ReferenceEquals(null, lhs);
263              var rhsIsNull = ReferenceEquals(null, rhs);
264              if (lhsIsNull == true && rhsIsNull == true)
265              {
266                  return true;
267              }
268              else
269              {
270                  if ((lhsIsNull || rhsIsNull) == true)
271                  {
272                      return false;
273                  }
274                  else
275                  {
276                      return lhs.Equals(rhs);
277                  }
278              }
279          }
280          public static bool operator !=(MudColor lhs, MudColor rhs) => !(lhs == rhs);
281          #endregion
282      }
283  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-PrerenderMiddleware.cs</h3>
            <pre><code>1  using System.Collections.Concurrent;
2  using System.IO;
3  using System.Threading.Tasks;
4  using Microsoft.AspNetCore.Builder;
5  using Microsoft.AspNetCore.Http;
6  namespace MudBlazor.Docs.WasmHost.Prerender
7  {
8      public class PrerenderMiddleware
9      {
10          private static LimitedConcurrentDictionary<string, byte[]> _responseCache = new(1_000);
11          private readonly RequestDelegate _next;
12          private readonly ICrawlerIdentifier _crawlerIdentifier;
13          public PrerenderMiddleware(RequestDelegate next, ICrawlerIdentifier crawlerIdentifier)
14          {
15              _next = next;
16              _crawlerIdentifier = crawlerIdentifier;
17          }
18          public async Task Invoke(HttpContext context)
19          {
20              var path = context.Request.Path.ToString().ToLower();
<span onclick='openModal()' class='match'>21              if (path.Contains("webapi") == true)
22              {
23                  await _next(context);
</span>24                  return;
25              }
26              if (context.Request.Query.ContainsKey("force-prerender") == false && await _crawlerIdentifier.IsRequestByCrawler(context) == false)
27              {
28                  await _next(context);
29                  return;
30              }
31              else
32              {
33                  if (_responseCache.ContainsKey(path) == true)
34                  {
35                      context.Response.StatusCode = 200;
36                      context.Response.ContentType = "text/html; charset=utf-8";
37                      await context.Response.BodyWriter.WriteAsync(_responseCache[path]);
38                      return;
39                  }
40                  else
41                  {
42                      context.Request.Headers.Add("UsePrerender", "true");
43                      var originalBodyStream = context.Response.Body;
44                      byte[] cachedValue;
45                      using (var responseBody = new MemoryStream())
46                      {
47                          context.Response.Body = responseBody;
48                          await _next(context);
49                          if(context.Response.StatusCode != 200)
50                          {
51                              return;
52                          }
53                          responseBody.Seek(0, SeekOrigin.Begin);
54                          await responseBody.CopyToAsync(originalBodyStream);
55                          responseBody.Seek(0, SeekOrigin.Begin);
56                          cachedValue = responseBody.ToArray();
57                          _responseCache.TryAdd(path, cachedValue);
58                      }
59                  }
60              }
61          }
62      }
63      public static class PrerenderMiddlewareExtensions
64      {
65          public static IApplicationBuilder UsePrerenderMiddleware(this IApplicationBuilder builder)
66          {
67              return builder.UseMiddleware<PrerenderMiddleware>();
68          }
69      }
70  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColor.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-PrerenderMiddleware.cs</div>
                </div>
                <div class="column column_space"><pre><code>107              if (value.StartsWith("rgba") == true)
108              {
109                  var parts = SplitInputIntoParts(value);
</pre></code></div>
                <div class="column column_space"><pre><code>21              if (path.Contains("webapi") == true)
22              {
23                  await _next(context);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    