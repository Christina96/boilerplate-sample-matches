
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 15, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-CommandHelper.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Data;
4  using System.Dynamic;
5  using System.Text;
6  using System.Text.RegularExpressions;
7  using Simple.Data.Ado.Schema;
8  namespace Simple.Data.Ado
9  {
10      using System.Linq;
11      public class CommandHelper
12      {
13          private readonly AdoAdapter _adapter;
14          private readonly ISchemaProvider _schemaProvider;
15          public CommandHelper(AdoAdapter adapter)
16          {
17              _adapter = adapter;
18              _schemaProvider = adapter.SchemaProvider;
19          }
20          internal IDbCommand Create(IDbConnection connection, string sql, IList<object> values)
21          {
22              var command = connection.CreateCommand(_adapter.AdoOptions);
23              command.CommandText = PrepareCommand(sql, command);
24              command.ClearParameterValues();
25              command.SetParameterValues(values);
26              return command;
27          }
28          internal IDbCommand Create(IDbConnection connection, CommandBuilder commandBuilder)
29          {
30              var command = connection.CreateCommand(_adapter.AdoOptions);
31              command.CommandText = commandBuilder.Text;
32              PrepareCommand(commandBuilder, command);
33              return command;
34          }
35          private string PrepareCommand(IEnumerable<char> sql, IDbCommand command)
36          {
37              var parameterFactory = _adapter.ProviderHelper.GetCustomProvider<IDbParameterFactory>(_schemaProvider)
38                                     ?? new GenericDbParameterFactory(command);
39              int index = 0;
40              var sqlBuilder = new StringBuilder();
41              foreach (var c in sql)
42              {
43                  if (c == '?')
44                  {
45                      var parameter = parameterFactory.CreateParameter(_schemaProvider.NameParameter("p" + index));
46                      command.Parameters.Add(parameter);
47                      sqlBuilder.Append(parameter.ParameterName);
48                      index++;
49                  }
50                  else
51                  {
52                      sqlBuilder.Append(c);
53                  }
54              }
55              return sqlBuilder.ToString();
56          }
57          private string PrepareInsertCommand(string sql, IDbCommand command, IEnumerable<Column> columns)
58          {
59              var parameterFactory = _adapter.ProviderHelper.GetCustomProvider<IDbParameterFactory>(_schemaProvider)
60                                     ?? new GenericDbParameterFactory(command);
61              var columnLookup = columns.ToDictionary(c => c.QuotedName, c => c);
62              if (columnLookup.Count == 0) return PrepareCommand(sql, command);
63              int openParenIndex = sql.IndexOf('(');
64              int closeParenLength = sql.IndexOf(')') - openParenIndex;
65              var columnNameList = sql.Substring(openParenIndex, closeParenLength).Trim('(', ')').Split(',');
66              int index = 0;
67              var sqlBuilder = new StringBuilder();
68              foreach (var c in sql)
69              {
70                  if (c == '?')
71                  {
72                      var column = columnLookup[columnNameList[index]];
73                      var parameter = parameterFactory.CreateParameter(_schemaProvider.NameParameter("p" + index), column);
74                      command.Parameters.Add(parameter);
75                      sqlBuilder.Append(parameter.ParameterName);
76                      index++;
77                  }
78                  else
79                  {
80                      sqlBuilder.Append(c);
81                  }
82              }
83              return sqlBuilder.ToString();
84          }
85          private static void PrepareCommand(CommandBuilder commandBuilder, IDbCommand command)
86          {
87              foreach (var pair in commandBuilder.Parameters)
88              {
89                  var parameter = command.CreateParameter();
90                  parameter.ParameterName = pair.Key.Name;
91                  parameter.DbType = pair.Key.DbType;
92                  parameter.Size = pair.Key.MaxLength;
93                  parameter.Value = FixObjectType(pair.Value);
94                  command.Parameters.Add(parameter);
95              }
96          }
97          public static object FixObjectType(object value)
98          {
99              if (value == null) return DBNull.Value;
100              if (TypeHelper.IsKnownType(value.GetType())) return value;
101              if (value is Enum) return value;
102              var asString = value.ToString();
103              if (asString != value.GetType().FullName) return asString;
<span onclick='openModal()' class='match'>104              return value;
105          }
106          public IDbCommand Create(IDbConnection connection, string insertSql)
107          {
108              var command = connection.CreateCommand(_adapter.AdoOptions);
</span>109              command.CommandText = PrepareCommand(insertSql, command);
110              return command;
111          }
112          public IDbCommand CreateInsert(IDbConnection connection, string insertSql, IEnumerable<Column> columns)
113          {
114              var command = connection.CreateCommand(_adapter.AdoOptions);
115              command.CommandText = PrepareInsertCommand(insertSql, command, columns);
116              command.ClearParameterValues();
117              return command;
118          }
119          public IDbCommand CreateInsert(IDbConnection connection, string sql, IEnumerable<Column> columns, IList<object> values)
120          {
121              var command = connection.CreateCommand(_adapter.AdoOptions);
122              command.CommandText = PrepareInsertCommand(sql, command, columns);
123              command.ClearParameterValues();
124              command.SetParameterValues(values);
125              return command;
126          }       
127      }
128  }
</code></pre>
        </div>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-CommandHelper.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Data;
4  using System.Dynamic;
5  using System.Text;
6  using System.Text.RegularExpressions;
7  using Simple.Data.Ado.Schema;
8  namespace Simple.Data.Ado
9  {
10      using System.Linq;
11      public class CommandHelper
12      {
13          private readonly AdoAdapter _adapter;
14          private readonly ISchemaProvider _schemaProvider;
15          public CommandHelper(AdoAdapter adapter)
16          {
17              _adapter = adapter;
18              _schemaProvider = adapter.SchemaProvider;
19          }
20          internal IDbCommand Create(IDbConnection connection, string sql, IList<object> values)
21          {
22              var command = connection.CreateCommand(_adapter.AdoOptions);
23              command.CommandText = PrepareCommand(sql, command);
24              command.ClearParameterValues();
25              command.SetParameterValues(values);
26              return command;
27          }
28          internal IDbCommand Create(IDbConnection connection, CommandBuilder commandBuilder)
29          {
30              var command = connection.CreateCommand(_adapter.AdoOptions);
31              command.CommandText = commandBuilder.Text;
32              PrepareCommand(commandBuilder, command);
33              return command;
34          }
35          private string PrepareCommand(IEnumerable<char> sql, IDbCommand command)
36          {
37              var parameterFactory = _adapter.ProviderHelper.GetCustomProvider<IDbParameterFactory>(_schemaProvider)
38                                     ?? new GenericDbParameterFactory(command);
39              int index = 0;
40              var sqlBuilder = new StringBuilder();
41              foreach (var c in sql)
42              {
43                  if (c == '?')
44                  {
45                      var parameter = parameterFactory.CreateParameter(_schemaProvider.NameParameter("p" + index));
46                      command.Parameters.Add(parameter);
47                      sqlBuilder.Append(parameter.ParameterName);
48                      index++;
49                  }
50                  else
51                  {
52                      sqlBuilder.Append(c);
53                  }
54              }
55              return sqlBuilder.ToString();
56          }
57          private string PrepareInsertCommand(string sql, IDbCommand command, IEnumerable<Column> columns)
58          {
59              var parameterFactory = _adapter.ProviderHelper.GetCustomProvider<IDbParameterFactory>(_schemaProvider)
60                                     ?? new GenericDbParameterFactory(command);
61              var columnLookup = columns.ToDictionary(c => c.QuotedName, c => c);
62              if (columnLookup.Count == 0) return PrepareCommand(sql, command);
63              int openParenIndex = sql.IndexOf('(');
64              int closeParenLength = sql.IndexOf(')') - openParenIndex;
65              var columnNameList = sql.Substring(openParenIndex, closeParenLength).Trim('(', ')').Split(',');
66              int index = 0;
67              var sqlBuilder = new StringBuilder();
68              foreach (var c in sql)
69              {
70                  if (c == '?')
71                  {
72                      var column = columnLookup[columnNameList[index]];
73                      var parameter = parameterFactory.CreateParameter(_schemaProvider.NameParameter("p" + index), column);
74                      command.Parameters.Add(parameter);
75                      sqlBuilder.Append(parameter.ParameterName);
76                      index++;
77                  }
78                  else
79                  {
80                      sqlBuilder.Append(c);
81                  }
82              }
83              return sqlBuilder.ToString();
84          }
85          private static void PrepareCommand(CommandBuilder commandBuilder, IDbCommand command)
86          {
87              foreach (var pair in commandBuilder.Parameters)
88              {
89                  var parameter = command.CreateParameter();
90                  parameter.ParameterName = pair.Key.Name;
91                  parameter.DbType = pair.Key.DbType;
92                  parameter.Size = pair.Key.MaxLength;
93                  parameter.Value = FixObjectType(pair.Value);
94                  command.Parameters.Add(parameter);
95              }
96          }
97          public static object FixObjectType(object value)
98          {
99              if (value == null) return DBNull.Value;
100              if (TypeHelper.IsKnownType(value.GetType())) return value;
101              if (value is Enum) return value;
102              var asString = value.ToString();
103              if (asString != value.GetType().FullName) return asString;
<span onclick='openModal()' class='match'>104              return value;
105          }
106          public IDbCommand Create(IDbConnection connection, string insertSql)
107          {
108              var command = connection.CreateCommand(_adapter.AdoOptions);
</span>109              command.CommandText = PrepareCommand(insertSql, command);
110              return command;
111          }
112          public IDbCommand CreateInsert(IDbConnection connection, string insertSql, IEnumerable<Column> columns)
113          {
114              var command = connection.CreateCommand(_adapter.AdoOptions);
115              command.CommandText = PrepareInsertCommand(insertSql, command, columns);
116              command.ClearParameterValues();
117              return command;
118          }
119          public IDbCommand CreateInsert(IDbConnection connection, string sql, IEnumerable<Column> columns, IList<object> values)
120          {
121              var command = connection.CreateCommand(_adapter.AdoOptions);
122              command.CommandText = PrepareInsertCommand(sql, command, columns);
123              command.ClearParameterValues();
124              command.SetParameterValues(values);
125              return command;
126          }       
127      }
128  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-CommandHelper.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-CommandHelper.cs</div>
                </div>
                <div class="column column_space"><pre><code>104              return value;
105          }
106          public IDbCommand Create(IDbConnection connection, string insertSql)
107          {
108              var command = connection.CreateCommand(_adapter.AdoOptions);
</pre></code></div>
                <div class="column column_space"><pre><code>104              return value;
105          }
106          public IDbCommand Create(IDbConnection connection, string insertSql)
107          {
108              var command = connection.CreateCommand(_adapter.AdoOptions);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    