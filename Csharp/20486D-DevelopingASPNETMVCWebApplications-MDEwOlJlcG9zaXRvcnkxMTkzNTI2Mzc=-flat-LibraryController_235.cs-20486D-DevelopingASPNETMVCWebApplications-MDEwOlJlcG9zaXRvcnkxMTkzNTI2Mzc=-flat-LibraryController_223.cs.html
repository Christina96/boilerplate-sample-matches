
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 203, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>20486D-DevelopingASPNETMVCWebApplications-MDEwOlJlcG9zaXRvcnkxMTkzNTI2Mzc=-flat-LibraryController_235.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.IO;
4  using System.Linq;
5  using System.Threading.Tasks;
6  using Library.Data;
7  using Library.Models;
8  using Microsoft.AspNetCore.Hosting;
9  using Microsoft.AspNetCore.Mvc;
10  namespace Library.Controllers
11  {
12      public class LibraryController : Controller
13      {
14          private LibraryContext _context;
15          private IHostingEnvironment _environment;
16          public LibraryController(LibraryContext libraryContext, IHostingEnvironment environment)
17          {
18              _context = libraryContext;
19              _environment = environment;
20          }
21          public IActionResult Index()
22          {
23              var booksQuery = from b in _context.Books
24                               where b.Recommended == true
25                               orderby b.Author
26                               select b;
27              return View(booksQuery);
28          }
29          public IActionResult GetBooksByGener()
30          {
31              if (this.User.Identity.IsAuthenticated)
32              {
33                  var booksGenerQuery = from b in _context.Books
34                                        orderby b.Genre.Name
35                                        select b;
36                  return View(booksGenerQuery);
37              }
38              return RedirectToAction("Login", "Account");
39          }
40          public IActionResult LendingBook(int id)
41          {
42              Book book = _context.Books.FirstOrDefault(b => b.Id == id);
43              if (book == null)
44              {
45                  return NotFound();
46              }
47              return View(book);
48          }
49          [HttpPost, ActionName("LendingBook")]
50          public async Task<IActionResult> LendingBookPost(int id)
51          {
52              var bookToUpdate = _context.Books.FirstOrDefault(b => b.Id == id);
53              bookToUpdate.Available = false;
54              if (await TryUpdateModelAsync<Book>(
55                  bookToUpdate,
56                  "",
<span onclick='openModal()' class='match'>57                  b => b.Available))
58              {
59                  _context.SaveChanges();
60                  return RedirectToAction(nameof(Index));
61              }
62              return View(bookToUpdate);
63          }
64          public IActionResult GetImage(int id)
65          {
66              Book requestedBook = _context.Books.FirstOrDefault(b => b.Id == id);
67              if (requestedBook != null)
68              {
69                  string webRootpath = _environment.WebRootPath;
70                  string folderPath = "\\images\\";
71                  string fullPath = webRootpath + folderPath + requestedBook.ImageName;
72                  if (System.IO.File.Exists(fullPath))
73                  {
74                      FileStream fileOnDisk = new FileStream(fullPath, FileMode.Open);
75                      byte[] fileBytes;
76                      using (BinaryReader br = new BinaryReader(fileOnDisk))
77                      {
78                          fileBytes = br.ReadBytes((int)fileOnDisk.Length);
79                      }
80                      return File(fileBytes, requestedBook.ImageMimeType);
81                  }
82                  else
83                  {
84                      if (requestedBook.PhotoFile.Length > 0)
85                      {
86                          return File(requestedBook.PhotoFile, requestedBook.ImageMimeType);
87                      }
88                      else
89                      {
90                          return NotFound();
91                      }
92                  }
93              }
94              else
95              {
96                  return NotFound();
97              }
98          }
99      }
100  }
</span></code></pre>
        </div>
        <div class="column">
            <h3>20486D-DevelopingASPNETMVCWebApplications-MDEwOlJlcG9zaXRvcnkxMTkzNTI2Mzc=-flat-LibraryController_223.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.IO;
4  using System.Linq;
5  using System.Threading.Tasks;
6  using Library.Data;
7  using Library.Models;
8  using Microsoft.AspNetCore.Hosting;
9  using Microsoft.AspNetCore.Mvc;
10  using Microsoft.AspNetCore.Authorization;
11  namespace Library.Controllers
12  {
13      public class LibraryController : Controller
14      {
15          private LibraryContext _context;
16          private IHostingEnvironment _environment;
17          public LibraryController(LibraryContext libraryContext, IHostingEnvironment environment)
18          {
19              _context = libraryContext;
20              _environment = environment;
21          }
22          [AllowAnonymous]
23          public IActionResult Index()
24          {
25              var booksQuery = from b in _context.Books
26                               where b.Recommended == true
27                               orderby b.Author
28                               select b;
29              return View(booksQuery);
30          }
31          [Authorize]
32          public IActionResult GetBooksByGener()
33          {
34              var booksGenerQuery = from b in _context.Books
35                                    orderby b.Genre.Name
36                                    select b;
37              return View(booksGenerQuery);
38          }
39          [Authorize]
40          public IActionResult LendingBook(int id)
41          {
42              Book book = _context.Books.FirstOrDefault(b => b.Id == id);
43              if (book == null)
44              {
45                  return NotFound();
46              }
47              return View(book);
48          }
49          [Authorize]
50          [HttpPost, ActionName("LendingBook")]
51          [ValidateAntiForgeryToken]
52          public async Task<IActionResult> LendingBookPost(int id)
53          {
54              var bookToUpdate = _context.Books.FirstOrDefault(b => b.Id == id);
55              bookToUpdate.Available = false;
56              if (await TryUpdateModelAsync<Book>(
57                  bookToUpdate,
58                  "",
<span onclick='openModal()' class='match'>59                  b => b.Available))
60              {
61                  _context.SaveChanges();
62                  return RedirectToAction(nameof(Index));
63              }
64              return View(bookToUpdate);
65          }
66          public IActionResult GetImage(int id)
67          {
68              Book requestedBook = _context.Books.FirstOrDefault(b => b.Id == id);
69              if (requestedBook != null)
70              {
71                  string webRootpath = _environment.WebRootPath;
72                  string folderPath = "\\images\\";
73                  string fullPath = webRootpath + folderPath + requestedBook.ImageName;
74                  if (System.IO.File.Exists(fullPath))
75                  {
76                      FileStream fileOnDisk = new FileStream(fullPath, FileMode.Open);
77                      byte[] fileBytes;
78                      using (BinaryReader br = new BinaryReader(fileOnDisk))
79                      {
80                          fileBytes = br.ReadBytes((int)fileOnDisk.Length);
81                      }
82                      return File(fileBytes, requestedBook.ImageMimeType);
83                  }
84                  else
85                  {
86                      if (requestedBook.PhotoFile.Length > 0)
87                      {
88                          return File(requestedBook.PhotoFile, requestedBook.ImageMimeType);
89                      }
90                      else
91                      {
92                          return NotFound();
93                      }
94                  }
95              }
96              else
97              {
98                  return NotFound();
99              }
100          }
101      }
102  }
</span></code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from 20486D-DevelopingASPNETMVCWebApplications-MDEwOlJlcG9zaXRvcnkxMTkzNTI2Mzc=-flat-LibraryController_235.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from 20486D-DevelopingASPNETMVCWebApplications-MDEwOlJlcG9zaXRvcnkxMTkzNTI2Mzc=-flat-LibraryController_223.cs</div>
                </div>
                <div class="column column_space"><pre><code>57                  b => b.Available))
58              {
59                  _context.SaveChanges();
60                  return RedirectToAction(nameof(Index));
61              }
62              return View(bookToUpdate);
63          }
64          public IActionResult GetImage(int id)
65          {
66              Book requestedBook = _context.Books.FirstOrDefault(b => b.Id == id);
67              if (requestedBook != null)
68              {
69                  string webRootpath = _environment.WebRootPath;
70                  string folderPath = "\\images\\";
71                  string fullPath = webRootpath + folderPath + requestedBook.ImageName;
72                  if (System.IO.File.Exists(fullPath))
73                  {
74                      FileStream fileOnDisk = new FileStream(fullPath, FileMode.Open);
75                      byte[] fileBytes;
76                      using (BinaryReader br = new BinaryReader(fileOnDisk))
77                      {
78                          fileBytes = br.ReadBytes((int)fileOnDisk.Length);
79                      }
80                      return File(fileBytes, requestedBook.ImageMimeType);
81                  }
82                  else
83                  {
84                      if (requestedBook.PhotoFile.Length > 0)
85                      {
86                          return File(requestedBook.PhotoFile, requestedBook.ImageMimeType);
87                      }
88                      else
89                      {
90                          return NotFound();
91                      }
92                  }
93              }
94              else
95              {
96                  return NotFound();
97              }
98          }
99      }
100  }
</pre></code></div>
                <div class="column column_space"><pre><code>59                  b => b.Available))
60              {
61                  _context.SaveChanges();
62                  return RedirectToAction(nameof(Index));
63              }
64              return View(bookToUpdate);
65          }
66          public IActionResult GetImage(int id)
67          {
68              Book requestedBook = _context.Books.FirstOrDefault(b => b.Id == id);
69              if (requestedBook != null)
70              {
71                  string webRootpath = _environment.WebRootPath;
72                  string folderPath = "\\images\\";
73                  string fullPath = webRootpath + folderPath + requestedBook.ImageName;
74                  if (System.IO.File.Exists(fullPath))
75                  {
76                      FileStream fileOnDisk = new FileStream(fullPath, FileMode.Open);
77                      byte[] fileBytes;
78                      using (BinaryReader br = new BinaryReader(fileOnDisk))
79                      {
80                          fileBytes = br.ReadBytes((int)fileOnDisk.Length);
81                      }
82                      return File(fileBytes, requestedBook.ImageMimeType);
83                  }
84                  else
85                  {
86                      if (requestedBook.PhotoFile.Length > 0)
87                      {
88                          return File(requestedBook.PhotoFile, requestedBook.ImageMimeType);
89                      }
90                      else
91                      {
92                          return NotFound();
93                      }
94                  }
95              }
96              else
97              {
98                  return NotFound();
99              }
100          }
101      }
102  }
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    