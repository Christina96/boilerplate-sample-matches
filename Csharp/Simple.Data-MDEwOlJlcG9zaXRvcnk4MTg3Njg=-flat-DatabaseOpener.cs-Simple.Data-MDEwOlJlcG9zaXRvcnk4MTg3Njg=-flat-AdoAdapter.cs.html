
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 6.622516556291391%, Tokens: 15</h2>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-DatabaseOpener.cs</h3>
            <pre><code>1  namespace Simple.Data
2  {
3      using System;
4      using System.Threading;
5      internal class DatabaseOpener : IDatabaseOpener
6      {
7          private static readonly IAdapterFactory AdapterFactory = new CachingAdapterFactory();
8          private static readonly ThreadLocal<DatabaseOpenerMethods> LocalOpenMethods = new ThreadLocal<DatabaseOpenerMethods>(() => new DatabaseOpenerMethods());
9          protected static DatabaseOpenerMethods OpenMethods
10          {
11              get { return LocalOpenMethods.Value; }
12          }
13          public dynamic OpenDefault(string schemaName = null)
14          {
15              return OpenMethods.OpenDefaultImpl(schemaName);
<span onclick='openModal()' class='match'>16          }
17          public dynamic OpenFile(string filename)
18          {
19              return OpenMethods.OpenFileImpl(filename);
20          }
21          public dynamic OpenConnection(string connectionString)
22          {
23              return OpenMethods.OpenConnectionImpl(connectionString);
24          }
25          public dynamic OpenConnection(string connectionString, string providerName)
26          {
27              return OpenMethods.OpenConnectionWithProviderImpl(connectionString, providerName);
28          }
29          public dynamic OpenConnection(string connectionString, string providerName, string schemaName)
30          {
31              return OpenMethods.OpenConnectionWithProviderAndSchemaImpl(connectionString, providerName, schemaName);
</span>32          }
33          public dynamic Open(string adapterName, object settings)
34          {
35              return OpenMethods.OpenImpl(adapterName, settings);
36          }
37          public dynamic OpenNamedConnection(string connectionName)
38          {
39              return OpenMethods.OpenNamedConnectionImpl(connectionName);
40          }
41          public dynamic OpenNamedConnection(string connectionName, string schemaName)
42          {
43              return OpenMethods.OpenNamedConnectionAndSchemaImpl(connectionName, schemaName);
44          }
45          public void ClearAdapterCache()
46          {
47              ((CachingAdapterFactory) AdapterFactory).Reset();
48          }
49          public static void UseMockDatabase(Database database)
50          {
51              OpenMethods.UseMockDatabase(database);
52          }
53          public static void UseMockAdapter(Adapter adapter)
54          {
55              OpenMethods.UseMockAdapter(adapter);
56          }
57          public static void UseMockDatabase(Func<Database> databaseCreator)
58          {
59              OpenMethods.UseMockDatabase(databaseCreator);
60          }
61          public static void UseMockAdapter(Func<Adapter> adapterCreator)
62          {
63              OpenMethods.UseMockAdapter(adapterCreator);
64          }
65          internal static Database OpenDefaultMethod(string schemaName = null)
66          {
67              return new Database(AdapterFactory.Create("Ado", new { ConnectionName = "Simple.Data.Properties.Settings.DefaultConnectionString", SchemaName = schemaName }));
68          }
69          internal static Database OpenFileMethod(string filename)
70          {
71              return new Database(AdapterFactory.Create("Ado", new { Filename = filename }));
72          }
73          internal static Database OpenConnectionMethod(string connectionString)
74          {
75              return new Database(AdapterFactory.Create("Ado", new { ConnectionString = connectionString }));
76          }
77          internal static Database OpenConnectionMethod(string connectionString, string providerName)
78          {
79              return new Database(AdapterFactory.Create("Ado", new { ConnectionString = connectionString, ProviderName = providerName }));
80          }
81          internal static Database OpenConnectionAndSchemaMethod(string connectionString, string providerName, string schemaName)
82          {
83              return new Database(AdapterFactory.Create("Ado", new { ConnectionString = connectionString, ProviderName = providerName, SchemaName = schemaName }));
84          }
85          internal static Database OpenNamedConnectionMethod(string connectionName)
86          {
87              return new Database(AdapterFactory.Create("Ado", new { ConnectionName = connectionName }));
88          }
89          internal static Database OpenNamedConnectionAndSchemaMethod(string connectionName, string schemaName)
90          {
91              return new Database(AdapterFactory.Create("Ado", new { ConnectionName = connectionName, SchemaName = schemaName }));
92          }
93          internal static Database OpenMethod(string adapterName, object settings)
94          {
95              return new Database(AdapterFactory.Create(adapterName, settings));
96          }
97          public static void StopUsingMock()
98          {
99              OpenMethods.StopUsingMock();
100          }
101      }
102  }
</code></pre>
        </div>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-AdoAdapter.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.ComponentModel.Composition;
4  using System.Data;
5  using System.Linq;
6  using Simple.Data.Ado.Schema;
7  namespace Simple.Data.Ado
8  {
9      using Extensions;
10      [Export("Ado", typeof (Adapter))]
11      public partial class AdoAdapter : Adapter, ICloneable
12      {
13          private readonly AdoAdapterFinder _finder;
14          private readonly ProviderHelper _providerHelper = new ProviderHelper();
15          private CommandOptimizer _commandOptimizer = new CommandOptimizer();
16          private IConnectionProvider _connectionProvider;
17          private Lazy<AdoAdapterRelatedFinder> _relatedFinder;
18          private DatabaseSchema _schema;
19          private IDbConnection _sharedConnection;
20          private Func<IDbConnection, IDbConnection> _connectionModifier = connection => connection;
21          public AdoAdapter()
22          {
23              _finder = new AdoAdapterFinder(this);
24          }
25          internal AdoAdapter(IConnectionProvider connectionProvider) : this()
26          {
27              _connectionProvider = connectionProvider;
28              _schema = DatabaseSchema.Get(_connectionProvider, _providerHelper);
29              _relatedFinder = new Lazy<AdoAdapterRelatedFinder>(CreateRelatedFinder);
30              _commandOptimizer = ProviderHelper.GetCustomProvider<CommandOptimizer>(_connectionProvider) ??
31                                  new CommandOptimizer();
32          }
33          private AdoAdapter(IConnectionProvider connectionProvider, AdoAdapterFinder finder, ProviderHelper providerHelper,
34              Lazy<AdoAdapterRelatedFinder> relatedFinder, DatabaseSchema schema)
35          {
36              _connectionProvider = connectionProvider;
37              _finder = finder;
38              _providerHelper = providerHelper;
39              _relatedFinder = relatedFinder;
40              _schema = schema;
41          }
42          public AdoOptions AdoOptions
43          {
44              get { return Options as AdoOptions; }
45          }
46          public CommandOptimizer CommandOptimizer
47          {
48              get { return _commandOptimizer; }
49          }
50          public ProviderHelper ProviderHelper
51          {
52              get { return _providerHelper; }
53          }
54          public IConnectionProvider ConnectionProvider
55          {
56              get { return _connectionProvider; }
57          }
58          internal AdoAdapterFinder Finder
59          {
60              get { return _finder; }
61          }
62          public bool ProviderSupportsCompoundStatements
63          {
64              get { return _connectionProvider.SupportsCompoundStatements; }
65          }
66          public ISchemaProvider SchemaProvider
67          {
68              get { return _connectionProvider.GetSchemaProvider(); }
69          }
70          public override IDictionary<string, object> GetKey(string tableName, IDictionary<string, object> record)
71          {
72              var homogenizedRecord = new Dictionary<string, object>(record, HomogenizedEqualityComparer.DefaultInstance);
73              return GetKeyNames(tableName)
74                  .Select(k => k.Homogenize())
75                  .Where(homogenizedRecord.ContainsKey)
76                  .ToDictionary(key => key, key => homogenizedRecord[key]);
77          }
78          #region ICloneable Members
79          public object Clone()
80          {
81              return new AdoAdapter(_connectionProvider) {_connectionModifier = _connectionModifier};
82          }
83          #endregion
84          protected override void OnSetup()
85          {
86              ICollection<string> settingsKeys = ((IDictionary<string, object>) Settings).Keys;
87              if (settingsKeys.Contains("ConnectionString"))
88              {
89                  if (settingsKeys.Contains("ProviderName"))
90                  {
91                      if(settingsKeys.Contains("SchemaName"))
92                      {
93                          _connectionProvider = ProviderHelper.GetProviderByConnectionString(Settings.ConnectionString
94                              , Settings.ProviderName
95                              , Settings.SchemaName);
96                      }
97                      else
98                      {
99                          _connectionProvider = ProviderHelper.GetProviderByConnectionString(Settings.ConnectionString,
100                              Settings.ProviderName);
101                      }
102                  }
103                  else
104                  {
105                      _connectionProvider = ProviderHelper.GetProviderByConnectionString(Settings.ConnectionString);
106                  }
107              }
108              else if (settingsKeys.Contains("Filename"))
109              {
110                  _connectionProvider = ProviderHelper.GetProviderByFilename(Settings.Filename);
111              }
112              else if (settingsKeys.Contains("ConnectionName"))
113              {
114                  if (settingsKeys.Contains("SchemaName"))
115                  {
116                      _connectionProvider = ProviderHelper.GetProviderByConnectionName(Settings.ConnectionName, Settings.SchemaName);
117                  }
118                  else
119                  {
120                      _connectionProvider = ProviderHelper.GetProviderByConnectionName(Settings.ConnectionName);
121                  }
122              }
123              _schema = DatabaseSchema.Get(_connectionProvider, _providerHelper);
124              _relatedFinder = new Lazy<AdoAdapterRelatedFinder>(CreateRelatedFinder);
125              _commandOptimizer = ProviderHelper.GetCustomProvider<CommandOptimizer>(_connectionProvider) ??
126                                  new CommandOptimizer();
127          }
128          private AdoAdapterRelatedFinder CreateRelatedFinder()
129          {
130              return new AdoAdapterRelatedFinder(this);
131          }
132          public override IDictionary<string, object> Get(string tableName, params object[] keyValues)
133          {
134              throw new NotImplementedException();
<span onclick='openModal()' class='match'>135          }
136          public override IDictionary<string, object> FindOne(string tableName, SimpleExpression criteria)
137          {
138              return _finder.FindOne(tableName, criteria);
139          }
140          public override Func<object[], IDictionary<string, object>> CreateFindOneDelegate(string tableName,
141                                                                                            SimpleExpression criteria)
142          {
143              return _finder.CreateFindOneDelegate(tableName, criteria);
144          }
145          public override IEnumerable<IDictionary<string, object>> Find(string tableName, SimpleExpression criteria)
146          {
147              return _finder.Find(tableName, criteria);
148          }
149          public override IEnumerable<IDictionary<string, object>> RunQuery(SimpleQuery query,
150                                                                            out IEnumerable<SimpleQueryClauseBase>
151                                                                                unhandledClauses)
152          {
153              return new AdoAdapterQueryRunner(this).RunQuery(query, out unhandledClauses);
</span>154          }
155          public override IEnumerable<IEnumerable<IDictionary<string, object>>> RunQueries(SimpleQuery[] queries,
156                                                                                           List
157                                                                                               <
158                                                                                               IEnumerable
159                                                                                               <SimpleQueryClauseBase>>
160                                                                                               unhandledClauses)
161          {
162              return new AdoAdapterQueryRunner(this).RunQueries(queries, unhandledClauses);
163          }
164          public override bool IsExpressionFunction(string functionName, params object[] args)
165          {
166              return FunctionIsLikeOrNotLike(functionName, args);
167          }
168          private static bool FunctionIsLikeOrNotLike(string functionName, object[] args)
169          {
170              return ((functionName.Equals("like", StringComparison.OrdinalIgnoreCase)
171                       || functionName.Equals("notlike", StringComparison.OrdinalIgnoreCase))
172                      && args.Length == 1
173                      && args[0] is string);
174          }
175          public override IObservable<IDictionary<string, object>> RunQueryAsObservable(SimpleQuery query,
176                                                                                        out
177                                                                                            IEnumerable
178                                                                                            <SimpleQueryClauseBase>
179                                                                                            unhandledClauses)
180          {
181              return new AdoAdapterQueryRunner(this).RunQueryAsObservable(query, out unhandledClauses);
182          }
183          public override IDictionary<string, object> Insert(string tableName, IDictionary<string, object> data, bool resultRequired)
184          {
185              return new AdoAdapterInserter(this).Insert(tableName, data, resultRequired);
186          }
187          public override IEnumerable<IDictionary<string, object>> InsertMany(string tableName,
188                                                                              IEnumerable<IDictionary<string, object>>
189                                                                                  data, Func<IDictionary<string,object>, Exception, bool> onError, bool resultRequired)
190          {
191              return new AdoAdapterInserter(this).InsertMany(tableName, data, onError, resultRequired);
192          }
193          public override int UpdateMany(string tableName, IEnumerable<IDictionary<string, object>> data,
194                                         IEnumerable<string> criteriaFieldNames)
195          {
196              IBulkUpdater bulkUpdater = ProviderHelper.GetCustomProvider<IBulkUpdater>(ConnectionProvider) ??
197                                         new BulkUpdater();
198              return bulkUpdater.Update(this, tableName, data.ToList(), criteriaFieldNames, null);
199          }
200          public override int UpdateMany(string tableName, IEnumerable<IDictionary<string, object>> data)
201          {
202              IBulkUpdater bulkUpdater = ProviderHelper.GetCustomProvider<IBulkUpdater>(ConnectionProvider) ??
203                                         new BulkUpdater();
204              return bulkUpdater.Update(this, tableName, data.ToList(), null);
205          }
206          public override int Update(string tableName, IDictionary<string, object> data, SimpleExpression criteria)
207          {
208              ICommandBuilder commandBuilder = new UpdateHelper(_schema).GetUpdateCommand(tableName, data, criteria);
209              return Execute(commandBuilder);
210          }
211          public override int Delete(string tableName, SimpleExpression criteria)
212          {
213              ICommandBuilder commandBuilder = new DeleteHelper(_schema).GetDeleteCommand(tableName, criteria);
214              return Execute(commandBuilder);
215          }
216          public override IList<string> GetKeyNames(string tableName)
217          {
218              return _schema.FindTable(tableName).PrimaryKey.AsEnumerable().ToList();
219          }
220          public void SetConnectionModifier(Func<IDbConnection, IDbConnection> connectionModifer)
221          {
222              _connectionModifier = connectionModifer;
223          }
224          public void ClearConnectionModifier()
225          {
226              _connectionModifier = connection => connection;
227          }
228          private int Execute(ICommandBuilder commandBuilder)
229          {
230              IDbConnection connection = CreateConnection();
231              using (connection.MaybeDisposable())
232              {
233                  using (IDbCommand command = commandBuilder.GetCommand(connection, AdoOptions))
234                  {
235                      connection.OpenIfClosed();
236                      return command.TryExecuteNonQuery();
237                  }
238              }
239          }
240          internal int Execute(ICommandBuilder commandBuilder, IDbConnection connection)
241          {
242              using (connection.MaybeDisposable())
243              {
244                  using (IDbCommand command = commandBuilder.GetCommand(connection, AdoOptions))
245                  {
246                      connection.OpenIfClosed();
247                      return command.TryExecuteNonQuery();
248                  }
249              }
250          }
251          internal int Execute(ICommandBuilder commandBuilder, IAdapterTransaction transaction)
252          {
253              IDbTransaction dbTransaction = ((AdoAdapterTransaction) transaction).DbTransaction;
254              return Execute(commandBuilder, dbTransaction);
255          }
256          internal int Execute(ICommandBuilder commandBuilder, IDbTransaction dbTransaction)
257          {
258              using (IDbCommand command = commandBuilder.GetCommand(dbTransaction.Connection, AdoOptions))
259              {
260                  command.Transaction = dbTransaction;
261                  return command.TryExecuteNonQuery();
262              }
263          }
264          public void UseSharedConnection(IDbConnection connection)
265          {
266              _sharedConnection = connection;
267          }
268          public void StopUsingSharedConnection()
269          {
270              _sharedConnection = null;
271          }
272          public IDbConnection CreateConnection()
273          {
274              if (_sharedConnection != null) return _sharedConnection;
275              var connection = _connectionModifier(_connectionProvider.CreateConnection());
276              var args = ConnectionCreated.Raise(this, () => new ConnectionCreatedEventArgs(connection));
277              if (args != null && args.OverriddenConnection != null)
278              {
279                  return args.OverriddenConnection;
280              }
281              return connection;
282          }
283          public DatabaseSchema GetSchema()
284          {
285              return _schema ?? (_schema = DatabaseSchema.Get(_connectionProvider, _providerHelper));
286          }
287          public override IDictionary<string, object> Upsert(string tableName, IDictionary<string, object> data, SimpleExpression criteria, bool resultRequired)
288          {
289              return new AdoAdapterUpserter(this).Upsert(tableName, data, criteria, resultRequired);
290          }
291          public override IEnumerable<IDictionary<string, object>> UpsertMany(string tableName, IList<IDictionary<string, object>> list, bool isResultRequired, Func<IDictionary<string, object>, Exception, bool> errorCallback)
292          {
293              var upserter = new AdoAdapterUpserter(this);
294              return upserter.UpsertMany(tableName, list, isResultRequired, errorCallback);
295          }
296          public override IEnumerable<IDictionary<string, object>> UpsertMany(string tableName, IList<IDictionary<string, object>> list, IEnumerable<string> keyFieldNames, bool isResultRequired, Func<IDictionary<string, object>, Exception, bool> errorCallback)
297          {
298              return new AdoAdapterUpserter(this).UpsertMany(tableName, list, keyFieldNames.ToArray(), isResultRequired, errorCallback);
299          }
300          public string GetIdentityFunction()
301          {
302              return _connectionProvider.GetIdentityFunction();
303          }
304          protected override void OnReset()
305          {
306              DatabaseSchema.ClearCache();
307              _schema = DatabaseSchema.Get(_connectionProvider, _providerHelper);
308          }
309          public static event EventHandler<ConnectionCreatedEventArgs> ConnectionCreated;
310      }
311      public class ConnectionCreatedEventArgs : EventArgs
312      {
313          private readonly IDbConnection _connection;
314          public ConnectionCreatedEventArgs(IDbConnection connection)
315          {
316              _connection = connection;
317          }
318          public IDbConnection Connection
319          {
320              get { return _connection; }
321          }
322          internal IDbConnection OverriddenConnection { get; private set; }
323          public void OverrideConnection(IDbConnection overridingConnection)
324          {
325              OverriddenConnection = overridingConnection;
326          }
327      }
328  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-DatabaseOpener.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-AdoAdapter.cs</div>
                </div>
                <div class="column column_space"><pre><code>16          }
17          public dynamic OpenFile(string filename)
18          {
19              return OpenMethods.OpenFileImpl(filename);
20          }
21          public dynamic OpenConnection(string connectionString)
22          {
23              return OpenMethods.OpenConnectionImpl(connectionString);
24          }
25          public dynamic OpenConnection(string connectionString, string providerName)
26          {
27              return OpenMethods.OpenConnectionWithProviderImpl(connectionString, providerName);
28          }
29          public dynamic OpenConnection(string connectionString, string providerName, string schemaName)
30          {
31              return OpenMethods.OpenConnectionWithProviderAndSchemaImpl(connectionString, providerName, schemaName);
</pre></code></div>
                <div class="column column_space"><pre><code>135          }
136          public override IDictionary<string, object> FindOne(string tableName, SimpleExpression criteria)
137          {
138              return _finder.FindOne(tableName, criteria);
139          }
140          public override Func<object[], IDictionary<string, object>> CreateFindOneDelegate(string tableName,
141                                                                                            SimpleExpression criteria)
142          {
143              return _finder.CreateFindOneDelegate(tableName, criteria);
144          }
145          public override IEnumerable<IDictionary<string, object>> Find(string tableName, SimpleExpression criteria)
146          {
147              return _finder.Find(tableName, criteria);
148          }
149          public override IEnumerable<IDictionary<string, object>> RunQuery(SimpleQuery query,
150                                                                            out IEnumerable<SimpleQueryClauseBase>
151                                                                                unhandledClauses)
152          {
153              return new AdoAdapterQueryRunner(this).RunQuery(query, out unhandledClauses);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    