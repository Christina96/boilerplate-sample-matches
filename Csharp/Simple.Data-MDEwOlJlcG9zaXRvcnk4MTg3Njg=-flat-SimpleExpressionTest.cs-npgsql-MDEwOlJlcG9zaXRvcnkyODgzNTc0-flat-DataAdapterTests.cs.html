
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 7.467532467532467%, Tokens: 10</h2>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-SimpleExpressionTest.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Linq;
4  using System.Text;
5  using NUnit.Framework;
6  namespace Simple.Data.UnitTest
7  {
8      [TestFixture]
9      public class SimpleExpressionTest
10      {
11          [Test]
12          public void AndOperatorCombinesTwoExpressions()
13          {
14              var expr1 = new SimpleExpression(1, 1, SimpleExpressionType.Equal);
15              var expr2 = new SimpleExpression(2, 2, SimpleExpressionType.Equal);
16              var newExpr = expr1 && expr2;
17              Assert.AreEqual(expr1, newExpr.LeftOperand);
18              Assert.AreEqual(expr2, newExpr.RightOperand);
19              Assert.AreEqual(SimpleExpressionType.And, newExpr.Type);
20          }
21          [Test]
22          public void OrOperatorCombinesTwoExpressions()
23          {
24              var expr1 = new SimpleExpression(1, 1, SimpleExpressionType.Equal);
25              var expr2 = new SimpleExpression(2, 2, SimpleExpressionType.Equal);
26              var newExpr = expr1 || expr2;
27              Assert.AreEqual(expr1, newExpr.LeftOperand);
28              Assert.AreEqual(expr2, newExpr.RightOperand);
29              Assert.AreEqual(SimpleExpressionType.Or, newExpr.Type);
30          }
31          [Test]
32          public void CompoundOperatorsRespectParentheses_AndOrAnd()
33          {
34              var expr1 = new SimpleExpression(1, 1, SimpleExpressionType.Equal);
35              var expr2 = new SimpleExpression(2, 2, SimpleExpressionType.Equal);
36              var expr3 = new SimpleExpression(3, 3, SimpleExpressionType.Equal);
37              var expr4 = new SimpleExpression(4, 4, SimpleExpressionType.Equal);
38              var newExpr = (expr1 && expr2) || (expr3 && expr4);
39              var leftExpr = newExpr.LeftOperand as SimpleExpression;
40              var rightExpr = newExpr.RightOperand as SimpleExpression;
41              Assert.IsNotNull(leftExpr);
42              Assert.IsNotNull(rightExpr);
43              Assert.AreEqual(newExpr.Type, SimpleExpressionType.Or);
44              Assert.AreEqual(expr1, leftExpr.LeftOperand);
45              Assert.AreEqual(expr2, leftExpr.RightOperand);
46              Assert.AreEqual(expr3, rightExpr.LeftOperand);
47              Assert.AreEqual(expr4, rightExpr.RightOperand);
48          }
49          [Test]
50          public void CompoundExpressionsEvaluateAndOperatorsFirst()
51          {
52              var expr1 = new SimpleExpression(1, 1, SimpleExpressionType.Equal);
53              var expr2 = new SimpleExpression(2, 2, SimpleExpressionType.Equal);
54              var expr3 = new SimpleExpression(3, 3, SimpleExpressionType.Equal);
55              var expr4 = new SimpleExpression(4, 4, SimpleExpressionType.Equal);
<span onclick='openModal()' class='match'>56              var newExpr = expr1 && expr2 || expr3 && expr4;
57              var leftExpr = newExpr.LeftOperand as SimpleExpression;
58              var rightExpr = newExpr.RightOperand as SimpleExpression;
59              Assert.IsNotNull(leftExpr);
60              Assert.IsNotNull(rightExpr);
61              Assert.AreEqual(newExpr.Type, SimpleExpressionType.Or);
62              Assert.AreEqual(expr1, leftExpr.LeftOperand);
63              Assert.AreEqual(expr2, leftExpr.RightOperand);
64              Assert.AreEqual(expr3, rightExpr.LeftOperand);
65              Assert.AreEqual(expr4, rightExpr.RightOperand);
</span>66          }
67          private static void CompoundExpressionEvaluationOrderHelper(Func<SimpleExpression,SimpleExpression,SimpleExpression,SimpleExpression,SimpleExpression> actor)
68          {
69              var expr1 = new SimpleExpression(1, 1, SimpleExpressionType.Equal);
70              var expr2 = new SimpleExpression(2, 2, SimpleExpressionType.Equal);
71              var expr3 = new SimpleExpression(3, 3, SimpleExpressionType.Equal);
72              var expr4 = new SimpleExpression(4, 4, SimpleExpressionType.Equal);
73              var actual = actor(expr1, expr2, expr3, expr4);
74              Assert.AreEqual(expr4, GetExpression(actual, 0).RightOperand);
75              Assert.AreEqual(expr3, GetExpression(actual, 1).RightOperand);
76              Assert.AreEqual(expr2, GetExpression(actual, 2).RightOperand);
77              Assert.AreEqual(expr1, GetExpression(actual, 2).LeftOperand);
78          }
79          [Test]
80          public void CompoundExpressionsEvaluateRightToLeft_AndAndAnd()
81          {
82              CompoundExpressionEvaluationOrderHelper((e1,e2,e3,e4) => e1 & e2 & e3 & e4);
83          }
84          [Test]
85          public void CompoundExpressionsEvaluateRightToLeft_OrOrOr()
86          {
87              CompoundExpressionEvaluationOrderHelper((e1, e2, e3, e4) => e1 | e2 | e3 | e4);
88          }
89          private static SimpleExpression GetExpression(SimpleExpression expression, int nestLevel)
90          {
91              for (int i = 0; i < nestLevel; i++)
92              {
93                  expression = (SimpleExpression)expression.LeftOperand;
94              }
95              return expression;
96          }
97      }
98  }
</code></pre>
        </div>
        <div class="column">
            <h3>npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-DataAdapterTests.cs</h3>
            <pre><code>1  using System;
2  using System.Data;
3  using System.Threading.Tasks;
4  using NpgsqlTypes;
5  using NUnit.Framework;
6  using static Npgsql.Tests.TestUtil;
7  namespace Npgsql.Tests;
8  public class DataAdapterTests : TestBase
9  {
10      [Test]
11      public async Task DataAdapter_SelectCommand()
12      {
13          using var conn = await OpenConnectionAsync();
14          using var command = new NpgsqlCommand("SELECT 1", conn);
15          var da = new NpgsqlDataAdapter();
16          da.SelectCommand = command;
17          var ds = new DataSet();
18          da.Fill(ds);
19      }
20      [Test]
21      public async Task DataAdapter_NpgsqlCommand_in_constructor()
22      {
23          using var conn = await OpenConnectionAsync();
24          using var command = new NpgsqlCommand("SELECT 1", conn);
25          command.Connection = conn;
26          var da = new NpgsqlDataAdapter(command);
27          var ds = new DataSet();
28          da.Fill(ds);
29      }
30      [Test]
31      public async Task DataAdapter_string_command_in_constructor()
32      {
33          using var conn = await OpenConnectionAsync();
34          var da = new NpgsqlDataAdapter("SELECT 1", conn);
35          var ds = new DataSet();
36          da.Fill(ds);
37      }
38      [Test]
39      public void DataAdapter_connection_string_in_constructor()
40      {
41          var da = new NpgsqlDataAdapter("SELECT 1", ConnectionString);
42          var ds = new DataSet();
43          da.Fill(ds);
44      }
45      [Test]
46      public async Task Insert_with_DataSet()
47      {
48          using var conn = await OpenConnectionAsync();
49          var table = await SetupTempTable(conn);
50          var ds = new DataSet();
51          var da = new NpgsqlDataAdapter($"SELECT * FROM {table}", conn);
52          da.InsertCommand = new NpgsqlCommand($"INSERT INTO {table} (field_int2, field_timestamp, field_numeric) VALUES (:a, :b, :c)", conn);
53          da.InsertCommand.Parameters.Add(new NpgsqlParameter("a", DbType.Int16));
54          da.InsertCommand.Parameters.Add(new NpgsqlParameter("b", DbType.DateTime2));
55          da.InsertCommand.Parameters.Add(new NpgsqlParameter("c", DbType.Decimal));
56          da.InsertCommand.Parameters[0].Direction = ParameterDirection.Input;
57          da.InsertCommand.Parameters[1].Direction = ParameterDirection.Input;
58          da.InsertCommand.Parameters[2].Direction = ParameterDirection.Input;
59          da.InsertCommand.Parameters[0].SourceColumn = "field_int2";
60          da.InsertCommand.Parameters[1].SourceColumn = "field_timestamp";
61          da.InsertCommand.Parameters[2].SourceColumn = "field_numeric";
62          da.Fill(ds);
63          var dt = ds.Tables[0];
64          var dr = dt.NewRow();
65          dr["field_int2"] = 4;
66          dr["field_timestamp"] = new DateTime(2003, 01, 30, 14, 0, 0);
67          dr["field_numeric"] = 7.3M;
68          dt.Rows.Add(dr);
69          var ds2 = ds.GetChanges()!;
70          da.Update(ds2);
71          ds.Merge(ds2);
72          ds.AcceptChanges();
73          var dr2 = new NpgsqlCommand($"SELECT field_int2, field_numeric, field_timestamp FROM {table}", conn).ExecuteReader();
74          dr2.Read();
75          Assert.AreEqual(4, dr2[0]);
76          Assert.AreEqual(7.3000000M, dr2[1]);
77          dr2.Close();
78      }
79      [Test]
80      public async Task DataAdapter_update_return_value()
81      {
82          using var conn = await OpenConnectionAsync();
83          var table = await SetupTempTable(conn);
84          var ds = new DataSet();
85          var da = new NpgsqlDataAdapter($"SELECT * FROM {table}", conn);
86          da.InsertCommand = new NpgsqlCommand($@"INSERT INTO {table} (field_int2, field_timestamp, field_numeric) VALUES (:a, :b, :c)", conn);
87          da.InsertCommand.Parameters.Add(new NpgsqlParameter("a", DbType.Int16));
88          da.InsertCommand.Parameters.Add(new NpgsqlParameter("b", DbType.DateTime2));
89          da.InsertCommand.Parameters.Add(new NpgsqlParameter("c", DbType.Decimal));
90          da.InsertCommand.Parameters[0].Direction = ParameterDirection.Input;
91          da.InsertCommand.Parameters[1].Direction = ParameterDirection.Input;
92          da.InsertCommand.Parameters[2].Direction = ParameterDirection.Input;
93          da.InsertCommand.Parameters[0].SourceColumn = "field_int2";
94          da.InsertCommand.Parameters[1].SourceColumn = "field_timestamp";
95          da.InsertCommand.Parameters[2].SourceColumn = "field_numeric";
96          da.Fill(ds);
97          var dt = ds.Tables[0];
98          var dr = dt.NewRow();
99          dr["field_int2"] = 4;
100          dr["field_timestamp"] = new DateTime(2003, 01, 30, 14, 0, 0);
101          dr["field_numeric"] = 7.3M;
102          dt.Rows.Add(dr);
103          dr = dt.NewRow();
104          dr["field_int2"] = 4;
105          dr["field_timestamp"] = new DateTime(2003, 01, 30, 14, 0, 0);
106          dr["field_numeric"] = 7.3M;
107          dt.Rows.Add(dr);
108          var ds2 = ds.GetChanges()!;
109          var daupdate = da.Update(ds2);
110          Assert.AreEqual(2, daupdate);
111      }
112      [Test]
113      [Ignore("")]
114      public async Task DataAdapter_update_return_value2()
115      {
116          using var conn = await OpenConnectionAsync();
117          var table = await SetupTempTable(conn);
118          var cmd = conn.CreateCommand();
119          var da = new NpgsqlDataAdapter($"select * from {table}", conn);
120          var cb = new NpgsqlCommandBuilder(da);
121          var ds = new DataSet();
122          da.Fill(ds);
123          ds.Tables[0].Rows.Add(0.4, 0.5);
124          da.Update(ds);
125          cmd.CommandText = $"update {table} set field_float4 = 0.8";
126          cmd.ExecuteNonQuery();
127          ds.Tables[0].Rows[0][1] = 0.7;
128          var count = da.Update(ds);
129          Assert.AreEqual(0, count);
130      }
131      [Test]
132      public async Task Fill_with_empty_resultset()
133      {
134          using var conn = await OpenConnectionAsync();
135          var table = await SetupTempTable(conn);
136          var ds = new DataSet();
137          var da = new NpgsqlDataAdapter($"SELECT field_serial, field_int2, field_timestamp, field_numeric FROM {table} WHERE field_serial = -1", conn);
138          da.Fill(ds);
139          Assert.AreEqual(1, ds.Tables.Count);
140          Assert.AreEqual(4, ds.Tables[0].Columns.Count);
141          Assert.AreEqual("field_serial", ds.Tables[0].Columns[0].ColumnName);
142          Assert.AreEqual("field_int2", ds.Tables[0].Columns[1].ColumnName);
143          Assert.AreEqual("field_timestamp", ds.Tables[0].Columns[2].ColumnName);
144          Assert.AreEqual("field_numeric", ds.Tables[0].Columns[3].ColumnName);
145      }
146      [Test]
147      [Ignore("")]
148      public async Task Fill_add_with_key()
149      {
150          using var conn = await OpenConnectionAsync();
151          var table = await SetupTempTable(conn);
152          var ds = new DataSet();
153          var da = new NpgsqlDataAdapter($"select field_serial, field_int2, field_timestamp, field_numeric from {table}", conn);
154          da.MissingSchemaAction = MissingSchemaAction.AddWithKey;
155          da.Fill(ds);
156          var field_serial = ds.Tables[0].Columns[0];
<span onclick='openModal()' class='match'>157          var field_int2 = ds.Tables[0].Columns[1];
158          var field_timestamp = ds.Tables[0].Columns[2];
159          var field_numeric = ds.Tables[0].Columns[3];
160          Assert.IsFalse(field_serial.AllowDBNull);
161          Assert.IsTrue(field_serial.AutoIncrement);
162          Assert.AreEqual("field_serial", field_serial.ColumnName);
163          Assert.AreEqual(typeof(int), field_serial.DataType);
164          Assert.AreEqual(0, field_serial.Ordinal);
165          Assert.IsTrue(field_serial.Unique);
166          Assert.IsTrue(field_int2.AllowDBNull);
</span>167          Assert.IsFalse(field_int2.AutoIncrement);
168          Assert.AreEqual("field_int2", field_int2.ColumnName);
169          Assert.AreEqual(typeof(short), field_int2.DataType);
170          Assert.AreEqual(1, field_int2.Ordinal);
171          Assert.IsFalse(field_int2.Unique);
172          Assert.IsTrue(field_timestamp.AllowDBNull);
173          Assert.IsFalse(field_timestamp.AutoIncrement);
174          Assert.AreEqual("field_timestamp", field_timestamp.ColumnName);
175          Assert.AreEqual(typeof(DateTime), field_timestamp.DataType);
176          Assert.AreEqual(2, field_timestamp.Ordinal);
177          Assert.IsFalse(field_timestamp.Unique);
178          Assert.IsTrue(field_numeric.AllowDBNull);
179          Assert.IsFalse(field_numeric.AutoIncrement);
180          Assert.AreEqual("field_numeric", field_numeric.ColumnName);
181          Assert.AreEqual(typeof(decimal), field_numeric.DataType);
182          Assert.AreEqual(3, field_numeric.Ordinal);
183          Assert.IsFalse(field_numeric.Unique);
184      }
185      [Test]
186      public async Task Fill_add_columns()
187      {
188          using var conn = await OpenConnectionAsync();
189          var table = await SetupTempTable(conn);
190          var ds = new DataSet();
191          var da = new NpgsqlDataAdapter($"SELECT field_serial, field_int2, field_timestamp, field_numeric FROM {table}", conn);
192          da.MissingSchemaAction = MissingSchemaAction.Add;
193          da.Fill(ds);
194          var field_serial = ds.Tables[0].Columns[0];
195          var field_int2 = ds.Tables[0].Columns[1];
196          var field_timestamp = ds.Tables[0].Columns[2];
197          var field_numeric = ds.Tables[0].Columns[3];
198          Assert.AreEqual("field_serial", field_serial.ColumnName);
199          Assert.AreEqual(typeof(int), field_serial.DataType);
200          Assert.AreEqual(0, field_serial.Ordinal);
201          Assert.AreEqual("field_int2", field_int2.ColumnName);
202          Assert.AreEqual(typeof(short), field_int2.DataType);
203          Assert.AreEqual(1, field_int2.Ordinal);
204          Assert.AreEqual("field_timestamp", field_timestamp.ColumnName);
205          Assert.AreEqual(typeof(DateTime), field_timestamp.DataType);
206          Assert.AreEqual(2, field_timestamp.Ordinal);
207          Assert.AreEqual("field_numeric", field_numeric.ColumnName);
208          Assert.AreEqual(typeof(decimal), field_numeric.DataType);
209          Assert.AreEqual(3, field_numeric.Ordinal);
210      }
211      [Test]
212      public async Task Update_letting_null_field_falue()
213      {
214          using var conn = await OpenConnectionAsync();
215          var table = await SetupTempTable(conn);
216          var command = new NpgsqlCommand($"INSERT INTO {table} (field_int2) VALUES (2)", conn);
217          command.ExecuteNonQuery();
218          var ds = new DataSet();
219          var da = new NpgsqlDataAdapter($"SELECT * FROM {table}", conn);
220          da.InsertCommand = new NpgsqlCommand(";", conn);
221          da.UpdateCommand = new NpgsqlCommand($"UPDATE {table} SET field_int2 = :a, field_timestamp = :b, field_numeric = :c WHERE field_serial = :d", conn);
222          da.UpdateCommand.Parameters.Add(new NpgsqlParameter("a", DbType.Int16));
223          da.UpdateCommand.Parameters.Add(new NpgsqlParameter("b", DbType.DateTime));
224          da.UpdateCommand.Parameters.Add(new NpgsqlParameter("c", DbType.Decimal));
225          da.UpdateCommand.Parameters.Add(new NpgsqlParameter("d", NpgsqlDbType.Bigint));
226          da.UpdateCommand.Parameters[0].Direction = ParameterDirection.Input;
227          da.UpdateCommand.Parameters[1].Direction = ParameterDirection.Input;
228          da.UpdateCommand.Parameters[2].Direction = ParameterDirection.Input;
229          da.UpdateCommand.Parameters[3].Direction = ParameterDirection.Input;
230          da.UpdateCommand.Parameters[0].SourceColumn = "field_int2";
231          da.UpdateCommand.Parameters[1].SourceColumn = "field_timestamp";
232          da.UpdateCommand.Parameters[2].SourceColumn = "field_numeric";
233          da.UpdateCommand.Parameters[3].SourceColumn = "field_serial";
234          da.Fill(ds);
235          var dt = ds.Tables[0];
236          Assert.IsNotNull(dt);
237          var dr = ds.Tables[0].Rows[ds.Tables[0].Rows.Count - 1];
238          dr["field_int2"] = 4;
239          var ds2 = ds.GetChanges()!;
240          da.Update(ds2);
241          ds.Merge(ds2);
242          ds.AcceptChanges();
243          using var dr2 = new NpgsqlCommand($"SELECT field_int2 FROM {table}", conn).ExecuteReader();
244          dr2.Read();
245          Assert.AreEqual(4, dr2["field_int2"]);
246      }
247      [Test]
248      public async Task Fill_with_duplicate_column_name()
249      {
250          using var conn = await OpenConnectionAsync();
251          var table = await SetupTempTable(conn);
252          var ds = new DataSet();
253          var da = new NpgsqlDataAdapter($"SELECT field_serial, field_serial FROM {table}", conn);
254          da.Fill(ds);
255      }
256      [Test]
257      [Ignore("")]
258      public Task Update_with_DataSet() => DoUpdateWithDataSet();
259      public async Task DoUpdateWithDataSet()
260      {
261          using var conn = await OpenConnectionAsync();
262          var table = await SetupTempTable(conn);
263          var command = new NpgsqlCommand($"insert into {table} (field_int2) values (2)", conn);
264          command.ExecuteNonQuery();
265          var ds = new DataSet();
266          var da = new NpgsqlDataAdapter($"select * from {table}", conn);
267          var cb = new NpgsqlCommandBuilder(da);
268          Assert.IsNotNull(cb);
269          da.Fill(ds);
270          var dt = ds.Tables[0];
271          Assert.IsNotNull(dt);
272          var dr = ds.Tables[0].Rows[ds.Tables[0].Rows.Count - 1];
273          dr["field_int2"] = 4;
274          var ds2 = ds.GetChanges()!;
275          da.Update(ds2);
276          ds.Merge(ds2);
277          ds.AcceptChanges();
278          using var dr2 = new NpgsqlCommand($"select * from {table}", conn).ExecuteReader();
279          dr2.Read();
280          Assert.AreEqual(4, dr2["field_int2"]);
281      }
282      [Test]
283      [Ignore("")]
284      public async Task Insert_with_CommandBuilder_case_sensitive()
285      {
286          using var conn = await OpenConnectionAsync();
287          var table = await SetupTempTable(conn);
288          var ds = new DataSet();
289          var da = new NpgsqlDataAdapter($"select * from {table}", conn);
290          var builder = new NpgsqlCommandBuilder(da);
291          Assert.IsNotNull(builder);
292          da.Fill(ds);
293          var dt = ds.Tables[0];
294          var dr = dt.NewRow();
295          dr["Field_Case_Sensitive"] = 4;
296          dt.Rows.Add(dr);
297          var ds2 = ds.GetChanges()!;
298          da.Update(ds2);
299          ds.Merge(ds2);
300          ds.AcceptChanges();
301          using var dr2 = new NpgsqlCommand($"select * from {table}", conn).ExecuteReader();
302          dr2.Read();
303          Assert.AreEqual(4, dr2[1]);
304      }
305      [Test]
306      public async Task Interval_as_TimeSpan()
307      {
308          using var conn = await OpenConnectionAsync();
309          var table = await GetTempTableName(conn);
310          await conn.ExecuteNonQueryAsync($@"
311  CREATE TABLE {table} (
312      pk SERIAL PRIMARY KEY,
313      interval INTERVAL
314  );
315  INSERT INTO {table} (interval) VALUES ('1 hour'::INTERVAL);");
316          var dt = new DataTable("data");
317          var command = new NpgsqlCommand
318          {
319              CommandType = CommandType.Text,
320              CommandText = $"SELECT interval FROM {table}",
321              Connection = conn
322          };
323          var da = new NpgsqlDataAdapter { SelectCommand = command };
324          da.Fill(dt);
325      }
326      [Test]
327      public async Task Interval_as_TimeSpan2()
328      {
329          using var conn = await OpenConnectionAsync();
330          var table = await GetTempTableName(conn);
331          await conn.ExecuteNonQueryAsync($@"
332  CREATE TABLE {table} (
333      pk SERIAL PRIMARY KEY,
334      interval INTERVAL
335  );
336  INSERT INTO {table} (interval) VALUES ('1 hour'::INTERVAL);");
337          var dt = new DataTable("data");
338          var command = new NpgsqlCommand();
339          command.CommandType = CommandType.Text;
340          command.CommandText = $"SELECT interval FROM {table}";
341          command.Connection = conn;
342          var da = new NpgsqlDataAdapter();
343          da.SelectCommand = command;
344          da.Fill(dt);
345      }
346      [Test]
347      public async Task DataAdapter_command_access()
348      {
349          using var conn = await OpenConnectionAsync();
350          using var command = new NpgsqlCommand("SELECT CAST('1 hour' AS interval) AS dauer", conn);
351          var da = new NpgsqlDataAdapter();
352          da.SelectCommand = command;
353          System.Data.Common.DbDataAdapter common = da;
354          Assert.IsNotNull(common.SelectCommand);
355      }
356      [Test, Description("Makes sure that the INSERT/UPDATE/DELETE commands are auto-populated on NpgsqlDataAdapter")]
357      [IssueLink("https:&bsol;&bsol;github.com/npgsql/npgsql/issues/179")]
358      [Ignore("Somehow related to us using a temporary table???")]
359      public async Task Auto_populate_adapter_commands()
360      {
361          using var conn = await OpenConnectionAsync();
362          var table = await SetupTempTable(conn);
363          var da = new NpgsqlDataAdapter($"SELECT field_pk,field_int4 FROM {table}", conn);
364          var builder = new NpgsqlCommandBuilder(da);
365          var ds = new DataSet();
366          da.Fill(ds);
367          var t = ds.Tables[0];
368          var row = t.NewRow();
369          row["field_pk"] = 1;
370          row["field_int4"] = 8;
371          t.Rows.Add(row);
372          da.Update(ds);
373          Assert.That(await conn.ExecuteScalarAsync($"SELECT field_int4 FROM {table}"), Is.EqualTo(8));
374          row["field_int4"] = 9;
375          da.Update(ds);
376          Assert.That(await conn.ExecuteScalarAsync($"SELECT field_int4 FROM {table}"), Is.EqualTo(9));
377          row.Delete();
378          da.Update(ds);
379          Assert.That(await conn.ExecuteScalarAsync($"SELECT COUNT(*) FROM {table}"), Is.EqualTo(0));
380      }
381      [Test]
382      public void Command_builder_quoting()
383      {
384          var cb = new NpgsqlCommandBuilder();
385          const string orig = "some\"column";
386          var quoted = cb.QuoteIdentifier(orig);
387          Assert.That(quoted, Is.EqualTo("\"some\"\"column\""));
388          Assert.That(cb.UnquoteIdentifier(quoted), Is.EqualTo(orig));
389      }
390      [Test, Description("Makes sure a correct SQL string is built with GetUpdateCommand(true) using correct parameter names and placeholders")]
391      [IssueLink("https:&bsol;&bsol;github.com/npgsql/npgsql/issues/397")]
392      [Ignore("Somehow related to us using a temporary table???")]
393      public async Task Get_UpdateCommand()
394      {
395          using var conn = await OpenConnectionAsync();
396          var table = await SetupTempTable(conn);
397          using var da = new NpgsqlDataAdapter($"SELECT field_pk, field_int4 FROM {table}", conn);
398          using var cb = new NpgsqlCommandBuilder(da);
399          var updateCommand = cb.GetUpdateCommand(true);
400          da.UpdateCommand = updateCommand;
401          var ds = new DataSet();
402          da.Fill(ds);
403          var t = ds.Tables[0];
404          var row = t.Rows.Add();
405          row["field_pk"] = 1;
406          row["field_int4"] = 1;
407          da.Update(ds);
408          row["field_int4"] = 2;
409          da.Update(ds);
410          row.Delete();
411          da.Update(ds);
412      }
413      [Test]
414      public async Task Load_DataTable()
415      {
416          using var conn = await OpenConnectionAsync();
417          var table = await CreateTempTable(conn, "char5 CHAR(5), varchar5 VARCHAR(5)");
418          using var command = new NpgsqlCommand($"SELECT char5, varchar5 FROM {table}", conn);
419          using var dr = command.ExecuteReader();
420          var dt = new DataTable();
421          dt.Load(dr);
422          dr.Close();
423          Assert.AreEqual(5, dt.Columns[0].MaxLength);
424          Assert.AreEqual(5, dt.Columns[1].MaxLength);
425      }
426      public Task<string> SetupTempTable(NpgsqlConnection conn)
427          => CreateTempTable(conn, @"
428  field_pk SERIAL PRIMARY KEY,
429  field_serial SERIAL,
430  field_int2 SMALLINT,
431  field_int4 INTEGER,
432  field_numeric NUMERIC,
433  field_timestamp TIMESTAMP");
434  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-SimpleExpressionTest.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-DataAdapterTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>56              var newExpr = expr1 && expr2 || expr3 && expr4;
57              var leftExpr = newExpr.LeftOperand as SimpleExpression;
58              var rightExpr = newExpr.RightOperand as SimpleExpression;
59              Assert.IsNotNull(leftExpr);
60              Assert.IsNotNull(rightExpr);
61              Assert.AreEqual(newExpr.Type, SimpleExpressionType.Or);
62              Assert.AreEqual(expr1, leftExpr.LeftOperand);
63              Assert.AreEqual(expr2, leftExpr.RightOperand);
64              Assert.AreEqual(expr3, rightExpr.LeftOperand);
65              Assert.AreEqual(expr4, rightExpr.RightOperand);
</pre></code></div>
                <div class="column column_space"><pre><code>157          var field_int2 = ds.Tables[0].Columns[1];
158          var field_timestamp = ds.Tables[0].Columns[2];
159          var field_numeric = ds.Tables[0].Columns[3];
160          Assert.IsFalse(field_serial.AllowDBNull);
161          Assert.IsTrue(field_serial.AutoIncrement);
162          Assert.AreEqual("field_serial", field_serial.ColumnName);
163          Assert.AreEqual(typeof(int), field_serial.DataType);
164          Assert.AreEqual(0, field_serial.Ordinal);
165          Assert.IsTrue(field_serial.Unique);
166          Assert.IsTrue(field_int2.AllowDBNull);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    