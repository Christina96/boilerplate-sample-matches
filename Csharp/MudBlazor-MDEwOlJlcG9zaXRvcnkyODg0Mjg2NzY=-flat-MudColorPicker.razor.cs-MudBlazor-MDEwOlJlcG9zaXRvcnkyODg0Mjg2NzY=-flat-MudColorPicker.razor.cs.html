
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 12, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColorPicker.razor.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Globalization;
4  using System.Threading.Tasks;
5  using Microsoft.AspNetCore.Components;
6  using Microsoft.AspNetCore.Components.Web;
7  using MudBlazor.Extensions;
8  using MudBlazor.Utilities;
9  namespace MudBlazor
10  {
11      public partial class MudColorPicker : MudPicker<MudColor>, IAsyncDisposable
12      {
13          public MudColorPicker() : base(new DefaultConverter<MudColor>())
14          {
15              AdornmentIcon = Icons.Material.Outlined.Palette;
16              DisableToolbar = true;
17              Value = "#594ae2"; 
18              Text = GetColorTextValue();
19              AdornmentAriaLabel = "Open Color Picker";
20          }
21          #region Fields
22          private static Dictionary<int, (Func<int, int> r, Func<int, int> g, Func<int, int> b, string dominantColorPart)> _rgbToHueMapper = new()
23          {
24              { 0, ((x) => 255, x => x, x => 0, "rb") },
25              { 1, ((x) => 255 - x, x => 255, x => 0, "gb") },
26              { 2, ((x) => 0, x => 255, x => x, "gr") },
27              { 3, ((x) => 0, x => 255 - x, x => 255, "br") },
28              { 4, ((x) => x, x => 0, x => 255, "bg") },
29              { 5, ((x) => 255, x => 0, x => 255 - x, "rg") },
30          };
31          private const double _maxY = 250;
32          private const double _maxX = 312;
33          private const double _selctorSize = 26.0;
34          private double _selectorX;
35          private double _selectorY;
36          private bool _skipFeedback = false;
37          private MudColor _baseColor;
38          private bool _collectionOpen;
39          private readonly Guid _id = Guid.NewGuid();
40          private Guid _throttledMouseOverEventId;
41          private IEventListener _throttledEventManager;
42          [Inject] IEventListenerFactory ThrottledEventManagerFactory { get; set; }
43          #endregion
44          #region Parameters
45          [CascadingParameter(Name = "RightToLeft")] public bool RightToLeft { get; set; }
46          private bool _disableAlpha = false;
47          [Parameter]
48          [Category(CategoryTypes.FormComponent.PickerBehavior)]
49          public bool DisableAlpha
50          {
51              get => _disableAlpha;
52              set
53              {
54                  if (value != _disableAlpha)
55                  {
56                      _disableAlpha = value;
57                      if (value == true)
58                      {
59                          Value = Value.SetAlpha(1.0);
60                      }
61                      Text = GetColorTextValue();
62                  }
63              }
64          }
65          [Parameter]
66          [Category(CategoryTypes.FormComponent.PickerBehavior)]
67          public bool DisableColorField { get; set; } = false;
68          [Parameter]
69          [Category(CategoryTypes.FormComponent.PickerBehavior)]
70          public bool DisableModeSwitch { get; set; } = false;
71          [Parameter]
72          [Category(CategoryTypes.FormComponent.PickerBehavior)]
73          public bool DisableInputs { get; set; } = false;
74          [Parameter]
75          [Category(CategoryTypes.FormComponent.PickerBehavior)]
76          public bool DisableSliders { get; set; } = false;
77          [Parameter]
78          [Category(CategoryTypes.FormComponent.PickerBehavior)]
79          public bool DisablePreview { get; set; } = false;
80          [Parameter]
81          [Category(CategoryTypes.FormComponent.PickerBehavior)]
82          public ColorPickerMode ColorPickerMode { get; set; } = ColorPickerMode.RGB;
83          private ColorPickerView _colorPickerView = ColorPickerView.Spectrum;
84          private ColorPickerView _activeColorPickerView = ColorPickerView.Spectrum;
85          [Parameter]
86          [Category(CategoryTypes.FormComponent.PickerBehavior)]
87          public ColorPickerView ColorPickerView
88          {
89              get => _colorPickerView;
90              set
91              {
92                  if (value != _colorPickerView)
93                  {
94                      _colorPickerView = value;
95                      ChangeView(value).AndForget();
96                  }
97              }
98          }
99          [Parameter]
100          [Category(CategoryTypes.FormComponent.Behavior)]
101          public bool UpdateBindingIfOnlyHSLChanged { get; set; } = false;
102          [Parameter]
103          [Category(CategoryTypes.FormComponent.Data)]
104          public MudColor Value
105          {
106              get => _value;
107              set => SetColorAsync(value).AndForget();
108          }
109          [Parameter] public EventCallback<MudColor> ValueChanged { get; set; }
110          [Parameter]
111          [Category(CategoryTypes.FormComponent.PickerBehavior)]
112          public IEnumerable<MudColor> Palette { get; set; } = new MudColor[]
113          { "#424242", "#2196f3", "#00c853", "#ff9800", "#f44336",
114            "#f6f9fb", "#9df1fa", "#bdffcf", "#fff0a3", "#ffd254",
115            "#e6e9eb", "#27dbf5", "#7ef7a0", "#ffe273", "#ffb31f",
116            "#c9cccf", "#13b8e8", "#14dc71", "#fdd22f", "#ff9102",
117            "#858791", "#0989c2", "#1bbd66", "#ebb323", "#fe6800",
118            "#585b62", "#17698e", "#17a258", "#d9980d", "#dc3f11",
119            "#353940", "#113b53", "#127942", "#bf7d11", "#aa0000"
120          };
121          private IEnumerable<MudColor> _gridList = new MudColor[]
122          {
123              "#FFFFFF","#ebebeb","#d6d6d6","#c2c2c2","#adadad","#999999","#858586","#707070","#5c5c5c","#474747","#333333","#000000",
124              "#133648","#071d53","#0f0638","#2a093b","#370c1b","#541107","#532009","#53350d","#523e0f","#65611b","#505518","#2b3d16",
125              "#1e4c63","#0f2e76","#180b4e","#3f1256","#4e1629","#781e0e","#722f10","#734c16","#73591a","#8c8629","#707625","#3f5623",
126              "#2e6c8c","#1841a3","#280c72","#591e77","#6f223d","#a62c17","#a0451a","#a06b23","#9f7d28","#c3bc3c","#9da436","#587934",
127              "#3c8ab0","#2155ce","#331c8e","#702898","#8d2e4f","#d03a20","#ca5a24","#c8862e","#c99f35","#f3ec4e","#c6d047","#729b44",
128              "#479fd3","#2660f5","#4725ab","#8c33b5","#aa395d","#eb512e","#ed732e","#f3ae3d","#f5c944","#fefb67","#ddeb5c","#86b953",
129              "#59c4f7","#4e85f6","#5733e2","#af43eb","#d44a7a","#ed6c59","#ef8c56","#f3b757","#f6cd5b","#fef881","#e6ee7a","#a3d16e",
130              "#78d3f8","#7fa6f8","#7e52f5","#c45ff6","#de789d","#f09286","#f2a984","#f6c983","#f9da85","#fef9a1","#ebf29b","#badc94",
131              "#a5e1fa","#adc5fa","#ab8df7","#d696f8","#e8a7bf","#f4b8b1","#f6c7af","#f9daae","#fae5af","#fefbc0","#f3f7be","#d2e7ba",
132              "#d2effd","#d6e1fc","#d6c9fa","#e9cbfb","#f3d4df","#f9dcd9","#fae3d8","#fcecd7","#fdf2d8","#fefce0","#f7fade","#e3edd6"
133          };
134          [Parameter]
135          [Category(CategoryTypes.FormComponent.PickerBehavior)]
136          public bool DisableDragEffect { get; set; } = false;
137          [Parameter]
138          [Category(CategoryTypes.FormComponent.PickerAppearance)]
139          public string CloseIcon { get; set; } = Icons.Material.Filled.Close;
140          [Parameter]
141          [Category(CategoryTypes.FormComponent.PickerAppearance)]
142          public string SpectrumIcon { get; set; } = Icons.Material.Filled.Tune;
143          [Parameter]
144          [Category(CategoryTypes.FormComponent.PickerAppearance)]
145          public string GridIcon { get; set; } = Icons.Material.Filled.Apps;
146          [Parameter]
147          [Category(CategoryTypes.FormComponent.PickerAppearance)]
148          public string PaletteIcon { get; set; } = Icons.Material.Filled.Palette;
149          [Parameter]
150          [Category(CategoryTypes.FormComponent.PickerAppearance)]
151          public string ImportExportIcon { get; set; } = Icons.Material.Filled.ImportExport;
152          #endregion
153          private void ToggleCollection()
154          {
155              _collectionOpen = !_collectionOpen;
156          }
157          private void SelectPaletteColor(MudColor color)
158          {
159              Value = color;
160              _collectionOpen = false;
161              if (
162                  IsAnyControlVisible() == false || _activeColorPickerView is ColorPickerView.GridCompact or ColorPickerView.Palette)
163              {
164                  Close();
165              }
166          }
167          public void ChangeMode() =>
168              ColorPickerMode = ColorPickerMode switch
169              {
170                  ColorPickerMode.RGB => ColorPickerMode.HSL,
171                  ColorPickerMode.HSL => ColorPickerMode.HEX,
172                  ColorPickerMode.HEX => ColorPickerMode.RGB,
173                  _ => ColorPickerMode.RGB,
174              };
175          public async Task ChangeView(ColorPickerView value)
176          {
177              var oldValue = _activeColorPickerView;
178              _activeColorPickerView = value;
179              Text = GetColorTextValue();
180              if (oldValue == ColorPickerView.Spectrum)
181              {
182                  await RemoveMouseOverEvent();
183              }
184              if (value == ColorPickerView.Spectrum)
185              {
186                  _attachedMouseEvent = true;
187              }
188          }
189          private async Task SetColorAsync(MudColor value)
190          {
191              if (value == null) { return; }
192              var rgbChanged = value != _value;
193              var hslChanged = _value != null && value.HslChanged(_value);
194              var shouldUpdateBinding = _value != null 
195                                        && (rgbChanged || (UpdateBindingIfOnlyHSLChanged && hslChanged));
196              _value = value;
197              if (rgbChanged && _skipFeedback == false)
198              {
199                  UpdateBaseColor();
200                  UpdateColorSelectorBasedOnRgb();
201              }
202              if (shouldUpdateBinding)
203              {
204                  Touched = true;
205                  await SetTextAsync(GetColorTextValue(), false);
206                  await ValueChanged.InvokeAsync(value);
207                  await BeginValidateAsync();
208                  FieldChanged(value);
209              }
210          }
211          private void UpdateBaseColorSlider(int value)
212          {
213              var diff = Math.Abs(value - (int)Value.H);
214              if (diff == 0) { return; }
215              Value = Value.SetH(value);
216          }
217          private void UpdateBaseColor()
218          {
219              var index = (int)_value.H / 60;
220              if (index == 6)
221              {
222                  index = 5;
223              }
224              var valueInDeg = (int)_value.H - (index * 60);
225              var value = (int)(MathExtensions.Map(0, 60, 0, 255, valueInDeg));
226              var section = _rgbToHueMapper[index];
227              _baseColor = new(section.r(value), section.g(value), section.b(value), 255);
228          }
229          private void UpdateColorBaseOnSelection()
230          {
231              var x = _selectorX / _maxX;
232              var r_x = 255 - (int)((255 - _baseColor.R) * x);
233              var g_x = 255 - (int)((255 - _baseColor.G) * x);
234              var b_x = 255 - (int)((255 - _baseColor.B) * x);
235              var y = 1.0 - _selectorY / _maxY;
236              var r = r_x * y;
237              var g = g_x * y;
238              var b = b_x * y;
239              _skipFeedback = true;
240              Value = new MudColor((byte)r, (byte)g, (byte)b, _value);
241              _skipFeedback = false;
242          }
243          private void UpdateColorSelectorBasedOnRgb()
244          {
245              var hueValue = (int)MathExtensions.Map(0, 360, 0, 6 * 255, _value.H);
246              var index = hueValue / 255;
<span onclick='openModal()' class='match'>247              if (index == 6)
248              {
249                  index = 5;
250              }
251              var section = _rgbToHueMapper[index];
</span>252              var colorValues = section.dominantColorPart switch
253              {
254                  "rb" => (_value.R, _value.B),
255                  "rg" => (_value.R, _value.G),
256                  "gb" => (_value.G, _value.B),
257                  "gr" => (_value.G, _value.R),
258                  "br" => (_value.B, _value.R),
259                  "bg" => (_value.B, _value.G),
260                  _ => (255, 255)
261              };
262              var primaryDiff = 255 - colorValues.Item1;
263              var primaryDiffDelta = colorValues.Item1 / 255.0;
264              _selectorY = MathExtensions.Map(0, 255, 0, _maxY, primaryDiff);
265              var secondaryColorX = colorValues.Item2 * (1.0 / primaryDiffDelta);
266              var relation = (255 - secondaryColorX) / 255.0;
267              _selectorX = relation * _maxX;
268          }
269          #region mouse interactions
270          private void HandleColorOverlayClicked()
271          {
272              UpdateColorBaseOnSelection();
273              if (IsAnyControlVisible() == false)
274              {
275                  Close();
276              }
277          }
278          private void OnSelectorClicked(MouseEventArgs e)
279          {
280              SetSelectorBasedOnMouseEvents(e, false);
281              HandleColorOverlayClicked();
282          }
283          private void OnColorOverlayClick(MouseEventArgs e)
284          {
285              SetSelectorBasedOnMouseEvents(e, true);
286              HandleColorOverlayClicked();
287          }
288          private void OnMouseOver(MouseEventArgs e)
289          {
290              if (e.Buttons == 1)
291              {
292                  SetSelectorBasedOnMouseEvents(e, true);
293                  UpdateColorBaseOnSelection();
294              }
295          }
296          private void SetSelectorBasedOnMouseEvents(MouseEventArgs e, bool offsetIsAbsolute)
297          {
298              _selectorX = (offsetIsAbsolute == true ? e.OffsetX : (e.OffsetX - _selctorSize / 2.0) + _selectorX).EnsureRange(_maxX);
299              _selectorY = (offsetIsAbsolute == true ? e.OffsetY : (e.OffsetY - _selctorSize / 2.0) + _selectorY).EnsureRange(_maxY);
300          }
301          #endregion
302          #region updating inputs
303          public void SetR(int value) => Value = Value.SetR(value);
304          public void SetG(int value) => Value = Value.SetG(value);
305          public void SetB(int value) => Value = Value.SetB(value);
306          public void SetH(double value) => Value = Value.SetH(value);
307          public void SetS(double value) => Value = Value.SetS(value);
308          public void SetL(double value) => Value = Value.SetL(value);
309          public void SetAlpha(double value) => Value = Value.SetAlpha(value);
310          public void SetAlpha(int value) => Value = Value.SetAlpha(value);
311          public void SetInputString(string input)
312          {
313              MudColor color;
314              try
315              {
316                  color = new MudColor(input);
317              }
318              catch (Exception)
319              {
320                  return;
321              }
322              Value = color;
323          }
324          protected override Task StringValueChanged(string value)
325          {
326              SetInputString(value);
327              return Task.CompletedTask;
328          }
329          private bool _attachedMouseEvent = false;
330          protected override void OnPickerOpened()
331          {
332              base.OnPickerOpened();
333              _attachedMouseEvent = true;
334              StateHasChanged();
335          }
336          protected override void OnPickerClosed()
337          {
338              base.OnPickerClosed();
339              RemoveMouseOverEvent().AndForget();
340          }
341          #endregion
342          #region helper
343          private string GetSelectorLocation() => $"translate({Math.Round(_selectorX, 2).ToString(CultureInfo.InvariantCulture)}px, {Math.Round(_selectorY, 2).ToString(CultureInfo.InvariantCulture)}px);";
344          private string GetColorTextValue() => (DisableAlpha == true || _activeColorPickerView is ColorPickerView.Palette or ColorPickerView.GridCompact) ? _value.ToString(MudColorOutputFormats.Hex) : _value.ToString(MudColorOutputFormats.HexA);
345          private int GetHexColorInputMaxLength() => DisableAlpha ? 7 : 9;
346          private EventCallback<MouseEventArgs> GetEventCallback() => EventCallback.Factory.Create<MouseEventArgs>(this, () => Close());
347          private bool IsAnyControlVisible() => !(DisablePreview && DisableSliders && DisableInputs);
348          private EventCallback<MouseEventArgs> GetSelectPaletteColorCallback(MudColor color) => new EventCallbackFactory().Create(this, (MouseEventArgs e) => SelectPaletteColor(color));
349          private Color GetButtonColor(ColorPickerView view) => _activeColorPickerView == view ? Color.Primary : Color.Inherit;
350          private string GetColorDotClass(MudColor color) => new CssBuilder("mud-picker-color-dot").AddClass("selected", color == Value).ToString();
351          private string AlphaSliderStyle => new StyleBuilder().AddStyle($"background-image: linear-gradient(to {(RightToLeft ? "left" : "right")}, transparent, {_value.ToString(MudColorOutputFormats.RGB)})").Build();
352          #endregion
353          #region life cycle hooks
354          protected override async Task OnAfterRenderAsync(bool firstRender)
355          {
356              await base.OnAfterRenderAsync(firstRender);
357              if (firstRender == true)
358              {
359                  if (PickerVariant == PickerVariant.Static)
360                  {
361                      await AddMouseOverEvent();
362                  }
363              }
364              if (_attachedMouseEvent == true)
365              {
366                  _attachedMouseEvent = false;
367                  await AddMouseOverEvent();
368              }
369          }
370          private async Task AddMouseOverEvent()
371          {
372              if (DisableDragEffect == true) { return; }
373              if (_throttledEventManager == null)
374              {
375                  _throttledEventManager = ThrottledEventManagerFactory.Create();
376              }
377              _throttledMouseOverEventId = await
378                  _throttledEventManager.Subscribe<MouseEventArgs>("mousemove", _id.ToString(), "mudEventProjections.correctOffset", 10, async (x) =>
379                  {
380                      var e = x as MouseEventArgs;
381                      await InvokeAsync(() => OnMouseOver(e));
382                      StateHasChanged();
383                  });
384          }
385          private Task RemoveMouseOverEvent()
386          {
387              if (_throttledMouseOverEventId == default) { return Task.CompletedTask; }
388              return _throttledEventManager.Unsubscribe(_throttledMouseOverEventId);
389          }
390          public async ValueTask DisposeAsync()
391          {
392              if (_throttledEventManager == null) { return; }
393              await _throttledEventManager.DisposeAsync();
394          }
395          #endregion
396      }
397  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColorPicker.razor.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Globalization;
4  using System.Threading.Tasks;
5  using Microsoft.AspNetCore.Components;
6  using Microsoft.AspNetCore.Components.Web;
7  using MudBlazor.Extensions;
8  using MudBlazor.Utilities;
9  namespace MudBlazor
10  {
11      public partial class MudColorPicker : MudPicker<MudColor>, IAsyncDisposable
12      {
13          public MudColorPicker() : base(new DefaultConverter<MudColor>())
14          {
15              AdornmentIcon = Icons.Material.Outlined.Palette;
16              DisableToolbar = true;
17              Value = "#594ae2"; 
18              Text = GetColorTextValue();
19              AdornmentAriaLabel = "Open Color Picker";
20          }
21          #region Fields
22          private static Dictionary<int, (Func<int, int> r, Func<int, int> g, Func<int, int> b, string dominantColorPart)> _rgbToHueMapper = new()
23          {
24              { 0, ((x) => 255, x => x, x => 0, "rb") },
25              { 1, ((x) => 255 - x, x => 255, x => 0, "gb") },
26              { 2, ((x) => 0, x => 255, x => x, "gr") },
27              { 3, ((x) => 0, x => 255 - x, x => 255, "br") },
28              { 4, ((x) => x, x => 0, x => 255, "bg") },
29              { 5, ((x) => 255, x => 0, x => 255 - x, "rg") },
30          };
31          private const double _maxY = 250;
32          private const double _maxX = 312;
33          private const double _selctorSize = 26.0;
34          private double _selectorX;
35          private double _selectorY;
36          private bool _skipFeedback = false;
37          private MudColor _baseColor;
38          private bool _collectionOpen;
39          private readonly Guid _id = Guid.NewGuid();
40          private Guid _throttledMouseOverEventId;
41          private IEventListener _throttledEventManager;
42          [Inject] IEventListenerFactory ThrottledEventManagerFactory { get; set; }
43          #endregion
44          #region Parameters
45          [CascadingParameter(Name = "RightToLeft")] public bool RightToLeft { get; set; }
46          private bool _disableAlpha = false;
47          [Parameter]
48          [Category(CategoryTypes.FormComponent.PickerBehavior)]
49          public bool DisableAlpha
50          {
51              get => _disableAlpha;
52              set
53              {
54                  if (value != _disableAlpha)
55                  {
56                      _disableAlpha = value;
57                      if (value == true)
58                      {
59                          Value = Value.SetAlpha(1.0);
60                      }
61                      Text = GetColorTextValue();
62                  }
63              }
64          }
65          [Parameter]
66          [Category(CategoryTypes.FormComponent.PickerBehavior)]
67          public bool DisableColorField { get; set; } = false;
68          [Parameter]
69          [Category(CategoryTypes.FormComponent.PickerBehavior)]
70          public bool DisableModeSwitch { get; set; } = false;
71          [Parameter]
72          [Category(CategoryTypes.FormComponent.PickerBehavior)]
73          public bool DisableInputs { get; set; } = false;
74          [Parameter]
75          [Category(CategoryTypes.FormComponent.PickerBehavior)]
76          public bool DisableSliders { get; set; } = false;
77          [Parameter]
78          [Category(CategoryTypes.FormComponent.PickerBehavior)]
79          public bool DisablePreview { get; set; } = false;
80          [Parameter]
81          [Category(CategoryTypes.FormComponent.PickerBehavior)]
82          public ColorPickerMode ColorPickerMode { get; set; } = ColorPickerMode.RGB;
83          private ColorPickerView _colorPickerView = ColorPickerView.Spectrum;
84          private ColorPickerView _activeColorPickerView = ColorPickerView.Spectrum;
85          [Parameter]
86          [Category(CategoryTypes.FormComponent.PickerBehavior)]
87          public ColorPickerView ColorPickerView
88          {
89              get => _colorPickerView;
90              set
91              {
92                  if (value != _colorPickerView)
93                  {
94                      _colorPickerView = value;
95                      ChangeView(value).AndForget();
96                  }
97              }
98          }
99          [Parameter]
100          [Category(CategoryTypes.FormComponent.Behavior)]
101          public bool UpdateBindingIfOnlyHSLChanged { get; set; } = false;
102          [Parameter]
103          [Category(CategoryTypes.FormComponent.Data)]
104          public MudColor Value
105          {
106              get => _value;
107              set => SetColorAsync(value).AndForget();
108          }
109          [Parameter] public EventCallback<MudColor> ValueChanged { get; set; }
110          [Parameter]
111          [Category(CategoryTypes.FormComponent.PickerBehavior)]
112          public IEnumerable<MudColor> Palette { get; set; } = new MudColor[]
113          { "#424242", "#2196f3", "#00c853", "#ff9800", "#f44336",
114            "#f6f9fb", "#9df1fa", "#bdffcf", "#fff0a3", "#ffd254",
115            "#e6e9eb", "#27dbf5", "#7ef7a0", "#ffe273", "#ffb31f",
116            "#c9cccf", "#13b8e8", "#14dc71", "#fdd22f", "#ff9102",
117            "#858791", "#0989c2", "#1bbd66", "#ebb323", "#fe6800",
118            "#585b62", "#17698e", "#17a258", "#d9980d", "#dc3f11",
119            "#353940", "#113b53", "#127942", "#bf7d11", "#aa0000"
120          };
121          private IEnumerable<MudColor> _gridList = new MudColor[]
122          {
123              "#FFFFFF","#ebebeb","#d6d6d6","#c2c2c2","#adadad","#999999","#858586","#707070","#5c5c5c","#474747","#333333","#000000",
124              "#133648","#071d53","#0f0638","#2a093b","#370c1b","#541107","#532009","#53350d","#523e0f","#65611b","#505518","#2b3d16",
125              "#1e4c63","#0f2e76","#180b4e","#3f1256","#4e1629","#781e0e","#722f10","#734c16","#73591a","#8c8629","#707625","#3f5623",
126              "#2e6c8c","#1841a3","#280c72","#591e77","#6f223d","#a62c17","#a0451a","#a06b23","#9f7d28","#c3bc3c","#9da436","#587934",
127              "#3c8ab0","#2155ce","#331c8e","#702898","#8d2e4f","#d03a20","#ca5a24","#c8862e","#c99f35","#f3ec4e","#c6d047","#729b44",
128              "#479fd3","#2660f5","#4725ab","#8c33b5","#aa395d","#eb512e","#ed732e","#f3ae3d","#f5c944","#fefb67","#ddeb5c","#86b953",
129              "#59c4f7","#4e85f6","#5733e2","#af43eb","#d44a7a","#ed6c59","#ef8c56","#f3b757","#f6cd5b","#fef881","#e6ee7a","#a3d16e",
130              "#78d3f8","#7fa6f8","#7e52f5","#c45ff6","#de789d","#f09286","#f2a984","#f6c983","#f9da85","#fef9a1","#ebf29b","#badc94",
131              "#a5e1fa","#adc5fa","#ab8df7","#d696f8","#e8a7bf","#f4b8b1","#f6c7af","#f9daae","#fae5af","#fefbc0","#f3f7be","#d2e7ba",
132              "#d2effd","#d6e1fc","#d6c9fa","#e9cbfb","#f3d4df","#f9dcd9","#fae3d8","#fcecd7","#fdf2d8","#fefce0","#f7fade","#e3edd6"
133          };
134          [Parameter]
135          [Category(CategoryTypes.FormComponent.PickerBehavior)]
136          public bool DisableDragEffect { get; set; } = false;
137          [Parameter]
138          [Category(CategoryTypes.FormComponent.PickerAppearance)]
139          public string CloseIcon { get; set; } = Icons.Material.Filled.Close;
140          [Parameter]
141          [Category(CategoryTypes.FormComponent.PickerAppearance)]
142          public string SpectrumIcon { get; set; } = Icons.Material.Filled.Tune;
143          [Parameter]
144          [Category(CategoryTypes.FormComponent.PickerAppearance)]
145          public string GridIcon { get; set; } = Icons.Material.Filled.Apps;
146          [Parameter]
147          [Category(CategoryTypes.FormComponent.PickerAppearance)]
148          public string PaletteIcon { get; set; } = Icons.Material.Filled.Palette;
149          [Parameter]
150          [Category(CategoryTypes.FormComponent.PickerAppearance)]
151          public string ImportExportIcon { get; set; } = Icons.Material.Filled.ImportExport;
152          #endregion
153          private void ToggleCollection()
154          {
155              _collectionOpen = !_collectionOpen;
156          }
157          private void SelectPaletteColor(MudColor color)
158          {
159              Value = color;
160              _collectionOpen = false;
161              if (
162                  IsAnyControlVisible() == false || _activeColorPickerView is ColorPickerView.GridCompact or ColorPickerView.Palette)
163              {
164                  Close();
165              }
166          }
167          public void ChangeMode() =>
168              ColorPickerMode = ColorPickerMode switch
169              {
170                  ColorPickerMode.RGB => ColorPickerMode.HSL,
171                  ColorPickerMode.HSL => ColorPickerMode.HEX,
172                  ColorPickerMode.HEX => ColorPickerMode.RGB,
173                  _ => ColorPickerMode.RGB,
174              };
175          public async Task ChangeView(ColorPickerView value)
176          {
177              var oldValue = _activeColorPickerView;
178              _activeColorPickerView = value;
179              Text = GetColorTextValue();
180              if (oldValue == ColorPickerView.Spectrum)
181              {
182                  await RemoveMouseOverEvent();
183              }
184              if (value == ColorPickerView.Spectrum)
185              {
186                  _attachedMouseEvent = true;
187              }
188          }
189          private async Task SetColorAsync(MudColor value)
190          {
191              if (value == null) { return; }
192              var rgbChanged = value != _value;
193              var hslChanged = _value != null && value.HslChanged(_value);
194              var shouldUpdateBinding = _value != null 
195                                        && (rgbChanged || (UpdateBindingIfOnlyHSLChanged && hslChanged));
196              _value = value;
197              if (rgbChanged && _skipFeedback == false)
198              {
199                  UpdateBaseColor();
200                  UpdateColorSelectorBasedOnRgb();
201              }
202              if (shouldUpdateBinding)
203              {
204                  Touched = true;
205                  await SetTextAsync(GetColorTextValue(), false);
206                  await ValueChanged.InvokeAsync(value);
207                  await BeginValidateAsync();
208                  FieldChanged(value);
209              }
210          }
211          private void UpdateBaseColorSlider(int value)
212          {
213              var diff = Math.Abs(value - (int)Value.H);
214              if (diff == 0) { return; }
215              Value = Value.SetH(value);
216          }
217          private void UpdateBaseColor()
218          {
219              var index = (int)_value.H / 60;
<span onclick='openModal()' class='match'>220              if (index == 6)
221              {
222                  index = 5;
223              }
224              var valueInDeg = (int)_value.H - (index * 60);
</span>225              var value = (int)(MathExtensions.Map(0, 60, 0, 255, valueInDeg));
226              var section = _rgbToHueMapper[index];
227              _baseColor = new(section.r(value), section.g(value), section.b(value), 255);
228          }
229          private void UpdateColorBaseOnSelection()
230          {
231              var x = _selectorX / _maxX;
232              var r_x = 255 - (int)((255 - _baseColor.R) * x);
233              var g_x = 255 - (int)((255 - _baseColor.G) * x);
234              var b_x = 255 - (int)((255 - _baseColor.B) * x);
235              var y = 1.0 - _selectorY / _maxY;
236              var r = r_x * y;
237              var g = g_x * y;
238              var b = b_x * y;
239              _skipFeedback = true;
240              Value = new MudColor((byte)r, (byte)g, (byte)b, _value);
241              _skipFeedback = false;
242          }
243          private void UpdateColorSelectorBasedOnRgb()
244          {
245              var hueValue = (int)MathExtensions.Map(0, 360, 0, 6 * 255, _value.H);
246              var index = hueValue / 255;
247              if (index == 6)
248              {
249                  index = 5;
250              }
251              var section = _rgbToHueMapper[index];
252              var colorValues = section.dominantColorPart switch
253              {
254                  "rb" => (_value.R, _value.B),
255                  "rg" => (_value.R, _value.G),
256                  "gb" => (_value.G, _value.B),
257                  "gr" => (_value.G, _value.R),
258                  "br" => (_value.B, _value.R),
259                  "bg" => (_value.B, _value.G),
260                  _ => (255, 255)
261              };
262              var primaryDiff = 255 - colorValues.Item1;
263              var primaryDiffDelta = colorValues.Item1 / 255.0;
264              _selectorY = MathExtensions.Map(0, 255, 0, _maxY, primaryDiff);
265              var secondaryColorX = colorValues.Item2 * (1.0 / primaryDiffDelta);
266              var relation = (255 - secondaryColorX) / 255.0;
267              _selectorX = relation * _maxX;
268          }
269          #region mouse interactions
270          private void HandleColorOverlayClicked()
271          {
272              UpdateColorBaseOnSelection();
273              if (IsAnyControlVisible() == false)
274              {
275                  Close();
276              }
277          }
278          private void OnSelectorClicked(MouseEventArgs e)
279          {
280              SetSelectorBasedOnMouseEvents(e, false);
281              HandleColorOverlayClicked();
282          }
283          private void OnColorOverlayClick(MouseEventArgs e)
284          {
285              SetSelectorBasedOnMouseEvents(e, true);
286              HandleColorOverlayClicked();
287          }
288          private void OnMouseOver(MouseEventArgs e)
289          {
290              if (e.Buttons == 1)
291              {
292                  SetSelectorBasedOnMouseEvents(e, true);
293                  UpdateColorBaseOnSelection();
294              }
295          }
296          private void SetSelectorBasedOnMouseEvents(MouseEventArgs e, bool offsetIsAbsolute)
297          {
298              _selectorX = (offsetIsAbsolute == true ? e.OffsetX : (e.OffsetX - _selctorSize / 2.0) + _selectorX).EnsureRange(_maxX);
299              _selectorY = (offsetIsAbsolute == true ? e.OffsetY : (e.OffsetY - _selctorSize / 2.0) + _selectorY).EnsureRange(_maxY);
300          }
301          #endregion
302          #region updating inputs
303          public void SetR(int value) => Value = Value.SetR(value);
304          public void SetG(int value) => Value = Value.SetG(value);
305          public void SetB(int value) => Value = Value.SetB(value);
306          public void SetH(double value) => Value = Value.SetH(value);
307          public void SetS(double value) => Value = Value.SetS(value);
308          public void SetL(double value) => Value = Value.SetL(value);
309          public void SetAlpha(double value) => Value = Value.SetAlpha(value);
310          public void SetAlpha(int value) => Value = Value.SetAlpha(value);
311          public void SetInputString(string input)
312          {
313              MudColor color;
314              try
315              {
316                  color = new MudColor(input);
317              }
318              catch (Exception)
319              {
320                  return;
321              }
322              Value = color;
323          }
324          protected override Task StringValueChanged(string value)
325          {
326              SetInputString(value);
327              return Task.CompletedTask;
328          }
329          private bool _attachedMouseEvent = false;
330          protected override void OnPickerOpened()
331          {
332              base.OnPickerOpened();
333              _attachedMouseEvent = true;
334              StateHasChanged();
335          }
336          protected override void OnPickerClosed()
337          {
338              base.OnPickerClosed();
339              RemoveMouseOverEvent().AndForget();
340          }
341          #endregion
342          #region helper
343          private string GetSelectorLocation() => $"translate({Math.Round(_selectorX, 2).ToString(CultureInfo.InvariantCulture)}px, {Math.Round(_selectorY, 2).ToString(CultureInfo.InvariantCulture)}px);";
344          private string GetColorTextValue() => (DisableAlpha == true || _activeColorPickerView is ColorPickerView.Palette or ColorPickerView.GridCompact) ? _value.ToString(MudColorOutputFormats.Hex) : _value.ToString(MudColorOutputFormats.HexA);
345          private int GetHexColorInputMaxLength() => DisableAlpha ? 7 : 9;
346          private EventCallback<MouseEventArgs> GetEventCallback() => EventCallback.Factory.Create<MouseEventArgs>(this, () => Close());
347          private bool IsAnyControlVisible() => !(DisablePreview && DisableSliders && DisableInputs);
348          private EventCallback<MouseEventArgs> GetSelectPaletteColorCallback(MudColor color) => new EventCallbackFactory().Create(this, (MouseEventArgs e) => SelectPaletteColor(color));
349          private Color GetButtonColor(ColorPickerView view) => _activeColorPickerView == view ? Color.Primary : Color.Inherit;
350          private string GetColorDotClass(MudColor color) => new CssBuilder("mud-picker-color-dot").AddClass("selected", color == Value).ToString();
351          private string AlphaSliderStyle => new StyleBuilder().AddStyle($"background-image: linear-gradient(to {(RightToLeft ? "left" : "right")}, transparent, {_value.ToString(MudColorOutputFormats.RGB)})").Build();
352          #endregion
353          #region life cycle hooks
354          protected override async Task OnAfterRenderAsync(bool firstRender)
355          {
356              await base.OnAfterRenderAsync(firstRender);
357              if (firstRender == true)
358              {
359                  if (PickerVariant == PickerVariant.Static)
360                  {
361                      await AddMouseOverEvent();
362                  }
363              }
364              if (_attachedMouseEvent == true)
365              {
366                  _attachedMouseEvent = false;
367                  await AddMouseOverEvent();
368              }
369          }
370          private async Task AddMouseOverEvent()
371          {
372              if (DisableDragEffect == true) { return; }
373              if (_throttledEventManager == null)
374              {
375                  _throttledEventManager = ThrottledEventManagerFactory.Create();
376              }
377              _throttledMouseOverEventId = await
378                  _throttledEventManager.Subscribe<MouseEventArgs>("mousemove", _id.ToString(), "mudEventProjections.correctOffset", 10, async (x) =>
379                  {
380                      var e = x as MouseEventArgs;
381                      await InvokeAsync(() => OnMouseOver(e));
382                      StateHasChanged();
383                  });
384          }
385          private Task RemoveMouseOverEvent()
386          {
387              if (_throttledMouseOverEventId == default) { return Task.CompletedTask; }
388              return _throttledEventManager.Unsubscribe(_throttledMouseOverEventId);
389          }
390          public async ValueTask DisposeAsync()
391          {
392              if (_throttledEventManager == null) { return; }
393              await _throttledEventManager.DisposeAsync();
394          }
395          #endregion
396      }
397  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColorPicker.razor.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColorPicker.razor.cs</div>
                </div>
                <div class="column column_space"><pre><code>247              if (index == 6)
248              {
249                  index = 5;
250              }
251              var section = _rgbToHueMapper[index];
</pre></code></div>
                <div class="column column_space"><pre><code>220              if (index == 6)
221              {
222                  index = 5;
223              }
224              var valueInDeg = (int)_value.H - (index * 60);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    