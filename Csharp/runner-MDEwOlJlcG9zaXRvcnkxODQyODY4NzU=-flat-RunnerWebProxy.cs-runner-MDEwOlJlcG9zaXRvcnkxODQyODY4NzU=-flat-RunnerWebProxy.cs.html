
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 68, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-RunnerWebProxy.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Net;
4  using System.Text.RegularExpressions;
5  namespace GitHub.Runner.Sdk
6  {
7      public struct ByPassInfo
8      {
9          public string Host { get; set; }
10          public string Port { get; set; }
11      };
12      public class RunnerWebProxy : IWebProxy
13      {
14          private string _httpProxyAddress;
15          private string _httpProxyUsername;
16          private string _httpProxyPassword;
17          private string _httpsProxyAddress;
18          private string _httpsProxyUsername;
19          private string _httpsProxyPassword;
20          private string _noProxyString;
21          private readonly List<ByPassInfo> _noProxyList = new();
22          private readonly HashSet<string> _noProxyUnique = new(StringComparer.OrdinalIgnoreCase);
23          private readonly Regex _validIpRegex = new("^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$", RegexOptions.Compiled);
24          public string HttpProxyAddress => _httpProxyAddress;
25          public string HttpProxyUsername => _httpProxyUsername;
26          public string HttpProxyPassword => _httpProxyPassword;
27          public string HttpsProxyAddress => _httpsProxyAddress;
28          public string HttpsProxyUsername => _httpsProxyUsername;
29          public string HttpsProxyPassword => _httpsProxyPassword;
30          public string NoProxyString => _noProxyString;
31          public List<ByPassInfo> NoProxyList => _noProxyList;
32          public ICredentials Credentials { get; set; }
33          public RunnerWebProxy()
34          {
35              Credentials = new CredentialCache();
36              var httpProxyAddress = Environment.GetEnvironmentVariable("http_proxy");
37              if (string.IsNullOrEmpty(httpProxyAddress))
38              {
39                  httpProxyAddress = Environment.GetEnvironmentVariable("HTTP_PROXY");
40              }
41              httpProxyAddress = httpProxyAddress?.Trim();
42              var httpsProxyAddress = Environment.GetEnvironmentVariable("https_proxy");
43              if (string.IsNullOrEmpty(httpsProxyAddress))
44              {
45                  httpsProxyAddress = Environment.GetEnvironmentVariable("HTTPS_PROXY");
46              }
47              httpsProxyAddress = httpsProxyAddress?.Trim();
48              var noProxyList = Environment.GetEnvironmentVariable("no_proxy");
49              if (string.IsNullOrEmpty(noProxyList))
50              {
51                  noProxyList = Environment.GetEnvironmentVariable("NO_PROXY");
52              }
53              if (string.IsNullOrEmpty(httpProxyAddress) && string.IsNullOrEmpty(httpsProxyAddress))
54              {
55                  return;
56              }
57              if (!string.IsNullOrEmpty(httpProxyAddress) && !Uri.TryCreate(httpProxyAddress, UriKind.Absolute, out var _))
58              {
59                  httpProxyAddress = PrependHttpIfMissing(httpProxyAddress);
60              }
61              if (!string.IsNullOrEmpty(httpProxyAddress) && Uri.TryCreate(httpProxyAddress, UriKind.Absolute, out var proxyHttpUri))
62              {
63                  _httpProxyAddress = proxyHttpUri.OriginalString;
64                  Environment.SetEnvironmentVariable("HTTP_PROXY", _httpProxyAddress);
65                  Environment.SetEnvironmentVariable("http_proxy", _httpProxyAddress);
66                  var userInfo = Uri.UnescapeDataString(proxyHttpUri.UserInfo).Split(':', 2, StringSplitOptions.RemoveEmptyEntries);
67                  if (userInfo.Length == 2)
68                  {
69                      _httpProxyUsername = userInfo[0];
70                      _httpProxyPassword = userInfo[1];
71                  }
72                  else if (userInfo.Length == 1)
73                  {
<span onclick='openModal()' class='match'>74                      _httpProxyUsername = userInfo[0];
75                  }
76                  if (!string.IsNullOrEmpty(_httpProxyUsername) || !string.IsNullOrEmpty(_httpProxyPassword))
77                  {
78                      var credentials = new NetworkCredential(_httpProxyUsername, _httpProxyPassword);
79                      (Credentials as CredentialCache).Remove(proxyHttpUri, "Basic");
80                      (Credentials as CredentialCache).Add(proxyHttpUri, "Basic", credentials);
81                  }
82              }
83              if (!string.IsNullOrEmpty(httpsProxyAddress) && !Uri.TryCreate(httpsProxyAddress, UriKind.Absolute, out var _))
</span>84              {
85                  httpsProxyAddress = PrependHttpIfMissing(httpsProxyAddress);
86              }
87              if (!string.IsNullOrEmpty(httpsProxyAddress) && Uri.TryCreate(httpsProxyAddress, UriKind.Absolute, out var proxyHttpsUri))
88              {
89                  _httpsProxyAddress = proxyHttpsUri.OriginalString;
90                  Environment.SetEnvironmentVariable("HTTPS_PROXY", _httpsProxyAddress);
91                  Environment.SetEnvironmentVariable("https_proxy", _httpsProxyAddress);
92                  var userInfo = Uri.UnescapeDataString(proxyHttpsUri.UserInfo).Split(':', 2, StringSplitOptions.RemoveEmptyEntries);
93                  if (userInfo.Length == 2)
94                  {
95                      _httpsProxyUsername = userInfo[0];
96                      _httpsProxyPassword = userInfo[1];
97                  }
98                  else if (userInfo.Length == 1)
99                  {
100                      _httpsProxyUsername = userInfo[0];
101                  }
102                  if (!string.IsNullOrEmpty(_httpsProxyUsername) || !string.IsNullOrEmpty(_httpsProxyPassword))
103                  {
104                      var credentials = new NetworkCredential(_httpsProxyUsername, _httpsProxyPassword);
105                      (Credentials as CredentialCache).Remove(proxyHttpsUri, "Basic");
106                      (Credentials as CredentialCache).Add(proxyHttpsUri, "Basic", credentials);
107                  }
108              }
109              if (!string.IsNullOrEmpty(noProxyList))
110              {
111                  _noProxyString = noProxyList;
112                  Environment.SetEnvironmentVariable("NO_PROXY", noProxyList);
113                  Environment.SetEnvironmentVariable("no_proxy", noProxyList);
114                  var noProxyListSplit = noProxyList.Split(',', StringSplitOptions.RemoveEmptyEntries);
115                  foreach (string noProxy in noProxyListSplit)
116                  {
117                      var noProxyTrim = noProxy.Trim();
118                      if (string.IsNullOrEmpty(noProxyTrim))
119                      {
120                          continue;
121                      }
122                      else if (_noProxyUnique.Add(noProxyTrim))
123                      {
124                          var noProxyInfo = new ByPassInfo();
125                          var noProxyHostPort = noProxyTrim.Split(':', 2, StringSplitOptions.RemoveEmptyEntries);
126                          if (noProxyHostPort.Length == 1)
127                          {
128                              noProxyInfo.Host = noProxyHostPort[0];
129                          }
130                          else if (noProxyHostPort.Length == 2)
131                          {
132                              noProxyInfo.Host = noProxyHostPort[0];
133                              noProxyInfo.Port = noProxyHostPort[1];
134                          }
135                          if (_validIpRegex.IsMatch(noProxyInfo.Host))
136                          {
137                              continue;
138                          }
139                          _noProxyList.Add(noProxyInfo);
140                      }
141                  }
142              }
143          }
144          public Uri GetProxy(Uri destination)
145          {
146              if (IsBypassed(destination))
147              {
148                  return null;
149              }
150              if (destination.Scheme == Uri.UriSchemeHttps)
151              {
152                  return new Uri(_httpsProxyAddress);
153              }
154              else
155              {
156                  return new Uri(_httpProxyAddress);
157              }
158          }
159          public bool IsBypassed(Uri uri)
160          {
161              if (uri.Scheme == Uri.UriSchemeHttps && string.IsNullOrEmpty(_httpsProxyAddress))
162              {
163                  return true;
164              }
165              if (uri.Scheme == Uri.UriSchemeHttp && string.IsNullOrEmpty(_httpProxyAddress))
166              {
167                  return true;
168              }
169              return uri.IsLoopback || IsUriInBypassList(uri);
170          }
171          private bool IsUriInBypassList(Uri input)
172          {
173              foreach (var noProxy in _noProxyList)
174              {
175                  if (string.Equals(noProxy.Host, "*", StringComparison.OrdinalIgnoreCase))
176                  {
177                      return true;
178                  }
179                  var matchHost = false;
180                  var matchPort = false;
181                  if (string.IsNullOrEmpty(noProxy.Port))
182                  {
183                      matchPort = true;
184                  }
185                  else
186                  {
187                      matchPort = string.Equals(noProxy.Port, input.Port.ToString());
188                  }
189                  if (noProxy.Host.StartsWith('.'))
190                  {
191                      matchHost = input.Host.EndsWith(noProxy.Host, StringComparison.OrdinalIgnoreCase);
192                  }
193                  else
194                  {
195                      matchHost = string.Equals(input.Host, noProxy.Host, StringComparison.OrdinalIgnoreCase) || input.Host.EndsWith($".{noProxy.Host}", StringComparison.OrdinalIgnoreCase);
196                  }
197                  if (matchHost && matchPort)
198                  {
199                      return true;
200                  }
201              }
202              return false;
203          }
204          private string PrependHttpIfMissing(string proxyAddress)
205          {
206              if (!proxyAddress.StartsWith("http:&bsol;&bsol;", StringComparison.Ordinal) && !proxyAddress.StartsWith("https:&bsol;&bsol;", StringComparison.Ordinal))
207              {
208                  var prependedProxyAddress = "http:&bsol;&bsol;" + proxyAddress;
209                  if (Uri.TryCreate(prependedProxyAddress, UriKind.Absolute, out var _))
210                  {
211                      return prependedProxyAddress;
212                  }
213              }
214              return proxyAddress;
215          }
216      }
217  }
</code></pre>
        </div>
        <div class="column">
            <h3>runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-RunnerWebProxy.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Net;
4  using System.Text.RegularExpressions;
5  namespace GitHub.Runner.Sdk
6  {
7      public struct ByPassInfo
8      {
9          public string Host { get; set; }
10          public string Port { get; set; }
11      };
12      public class RunnerWebProxy : IWebProxy
13      {
14          private string _httpProxyAddress;
15          private string _httpProxyUsername;
16          private string _httpProxyPassword;
17          private string _httpsProxyAddress;
18          private string _httpsProxyUsername;
19          private string _httpsProxyPassword;
20          private string _noProxyString;
21          private readonly List<ByPassInfo> _noProxyList = new();
22          private readonly HashSet<string> _noProxyUnique = new(StringComparer.OrdinalIgnoreCase);
23          private readonly Regex _validIpRegex = new("^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$", RegexOptions.Compiled);
24          public string HttpProxyAddress => _httpProxyAddress;
25          public string HttpProxyUsername => _httpProxyUsername;
26          public string HttpProxyPassword => _httpProxyPassword;
27          public string HttpsProxyAddress => _httpsProxyAddress;
28          public string HttpsProxyUsername => _httpsProxyUsername;
29          public string HttpsProxyPassword => _httpsProxyPassword;
30          public string NoProxyString => _noProxyString;
31          public List<ByPassInfo> NoProxyList => _noProxyList;
32          public ICredentials Credentials { get; set; }
33          public RunnerWebProxy()
34          {
35              Credentials = new CredentialCache();
36              var httpProxyAddress = Environment.GetEnvironmentVariable("http_proxy");
37              if (string.IsNullOrEmpty(httpProxyAddress))
38              {
39                  httpProxyAddress = Environment.GetEnvironmentVariable("HTTP_PROXY");
40              }
41              httpProxyAddress = httpProxyAddress?.Trim();
42              var httpsProxyAddress = Environment.GetEnvironmentVariable("https_proxy");
43              if (string.IsNullOrEmpty(httpsProxyAddress))
44              {
45                  httpsProxyAddress = Environment.GetEnvironmentVariable("HTTPS_PROXY");
46              }
47              httpsProxyAddress = httpsProxyAddress?.Trim();
48              var noProxyList = Environment.GetEnvironmentVariable("no_proxy");
49              if (string.IsNullOrEmpty(noProxyList))
50              {
51                  noProxyList = Environment.GetEnvironmentVariable("NO_PROXY");
52              }
53              if (string.IsNullOrEmpty(httpProxyAddress) && string.IsNullOrEmpty(httpsProxyAddress))
54              {
55                  return;
56              }
57              if (!string.IsNullOrEmpty(httpProxyAddress) && !Uri.TryCreate(httpProxyAddress, UriKind.Absolute, out var _))
58              {
59                  httpProxyAddress = PrependHttpIfMissing(httpProxyAddress);
60              }
61              if (!string.IsNullOrEmpty(httpProxyAddress) && Uri.TryCreate(httpProxyAddress, UriKind.Absolute, out var proxyHttpUri))
62              {
63                  _httpProxyAddress = proxyHttpUri.OriginalString;
64                  Environment.SetEnvironmentVariable("HTTP_PROXY", _httpProxyAddress);
65                  Environment.SetEnvironmentVariable("http_proxy", _httpProxyAddress);
66                  var userInfo = Uri.UnescapeDataString(proxyHttpUri.UserInfo).Split(':', 2, StringSplitOptions.RemoveEmptyEntries);
67                  if (userInfo.Length == 2)
68                  {
69                      _httpProxyUsername = userInfo[0];
70                      _httpProxyPassword = userInfo[1];
71                  }
72                  else if (userInfo.Length == 1)
73                  {
<span onclick='openModal()' class='match'>74                      _httpProxyUsername = userInfo[0];
75                  }
76                  if (!string.IsNullOrEmpty(_httpProxyUsername) || !string.IsNullOrEmpty(_httpProxyPassword))
77                  {
78                      var credentials = new NetworkCredential(_httpProxyUsername, _httpProxyPassword);
79                      (Credentials as CredentialCache).Remove(proxyHttpUri, "Basic");
80                      (Credentials as CredentialCache).Add(proxyHttpUri, "Basic", credentials);
81                  }
82              }
83              if (!string.IsNullOrEmpty(httpsProxyAddress) && !Uri.TryCreate(httpsProxyAddress, UriKind.Absolute, out var _))
</span>84              {
85                  httpsProxyAddress = PrependHttpIfMissing(httpsProxyAddress);
86              }
87              if (!string.IsNullOrEmpty(httpsProxyAddress) && Uri.TryCreate(httpsProxyAddress, UriKind.Absolute, out var proxyHttpsUri))
88              {
89                  _httpsProxyAddress = proxyHttpsUri.OriginalString;
90                  Environment.SetEnvironmentVariable("HTTPS_PROXY", _httpsProxyAddress);
91                  Environment.SetEnvironmentVariable("https_proxy", _httpsProxyAddress);
92                  var userInfo = Uri.UnescapeDataString(proxyHttpsUri.UserInfo).Split(':', 2, StringSplitOptions.RemoveEmptyEntries);
93                  if (userInfo.Length == 2)
94                  {
95                      _httpsProxyUsername = userInfo[0];
96                      _httpsProxyPassword = userInfo[1];
97                  }
98                  else if (userInfo.Length == 1)
99                  {
100                      _httpsProxyUsername = userInfo[0];
101                  }
102                  if (!string.IsNullOrEmpty(_httpsProxyUsername) || !string.IsNullOrEmpty(_httpsProxyPassword))
103                  {
104                      var credentials = new NetworkCredential(_httpsProxyUsername, _httpsProxyPassword);
105                      (Credentials as CredentialCache).Remove(proxyHttpsUri, "Basic");
106                      (Credentials as CredentialCache).Add(proxyHttpsUri, "Basic", credentials);
107                  }
108              }
109              if (!string.IsNullOrEmpty(noProxyList))
110              {
111                  _noProxyString = noProxyList;
112                  Environment.SetEnvironmentVariable("NO_PROXY", noProxyList);
113                  Environment.SetEnvironmentVariable("no_proxy", noProxyList);
114                  var noProxyListSplit = noProxyList.Split(',', StringSplitOptions.RemoveEmptyEntries);
115                  foreach (string noProxy in noProxyListSplit)
116                  {
117                      var noProxyTrim = noProxy.Trim();
118                      if (string.IsNullOrEmpty(noProxyTrim))
119                      {
120                          continue;
121                      }
122                      else if (_noProxyUnique.Add(noProxyTrim))
123                      {
124                          var noProxyInfo = new ByPassInfo();
125                          var noProxyHostPort = noProxyTrim.Split(':', 2, StringSplitOptions.RemoveEmptyEntries);
126                          if (noProxyHostPort.Length == 1)
127                          {
128                              noProxyInfo.Host = noProxyHostPort[0];
129                          }
130                          else if (noProxyHostPort.Length == 2)
131                          {
132                              noProxyInfo.Host = noProxyHostPort[0];
133                              noProxyInfo.Port = noProxyHostPort[1];
134                          }
135                          if (_validIpRegex.IsMatch(noProxyInfo.Host))
136                          {
137                              continue;
138                          }
139                          _noProxyList.Add(noProxyInfo);
140                      }
141                  }
142              }
143          }
144          public Uri GetProxy(Uri destination)
145          {
146              if (IsBypassed(destination))
147              {
148                  return null;
149              }
150              if (destination.Scheme == Uri.UriSchemeHttps)
151              {
152                  return new Uri(_httpsProxyAddress);
153              }
154              else
155              {
156                  return new Uri(_httpProxyAddress);
157              }
158          }
159          public bool IsBypassed(Uri uri)
160          {
161              if (uri.Scheme == Uri.UriSchemeHttps && string.IsNullOrEmpty(_httpsProxyAddress))
162              {
163                  return true;
164              }
165              if (uri.Scheme == Uri.UriSchemeHttp && string.IsNullOrEmpty(_httpProxyAddress))
166              {
167                  return true;
168              }
169              return uri.IsLoopback || IsUriInBypassList(uri);
170          }
171          private bool IsUriInBypassList(Uri input)
172          {
173              foreach (var noProxy in _noProxyList)
174              {
175                  if (string.Equals(noProxy.Host, "*", StringComparison.OrdinalIgnoreCase))
176                  {
177                      return true;
178                  }
179                  var matchHost = false;
180                  var matchPort = false;
181                  if (string.IsNullOrEmpty(noProxy.Port))
182                  {
183                      matchPort = true;
184                  }
185                  else
186                  {
187                      matchPort = string.Equals(noProxy.Port, input.Port.ToString());
188                  }
189                  if (noProxy.Host.StartsWith('.'))
190                  {
191                      matchHost = input.Host.EndsWith(noProxy.Host, StringComparison.OrdinalIgnoreCase);
192                  }
193                  else
194                  {
195                      matchHost = string.Equals(input.Host, noProxy.Host, StringComparison.OrdinalIgnoreCase) || input.Host.EndsWith($".{noProxy.Host}", StringComparison.OrdinalIgnoreCase);
196                  }
197                  if (matchHost && matchPort)
198                  {
199                      return true;
200                  }
201              }
202              return false;
203          }
204          private string PrependHttpIfMissing(string proxyAddress)
205          {
206              if (!proxyAddress.StartsWith("http:&bsol;&bsol;", StringComparison.Ordinal) && !proxyAddress.StartsWith("https:&bsol;&bsol;", StringComparison.Ordinal))
207              {
208                  var prependedProxyAddress = "http:&bsol;&bsol;" + proxyAddress;
209                  if (Uri.TryCreate(prependedProxyAddress, UriKind.Absolute, out var _))
210                  {
211                      return prependedProxyAddress;
212                  }
213              }
214              return proxyAddress;
215          }
216      }
217  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-RunnerWebProxy.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-RunnerWebProxy.cs</div>
                </div>
                <div class="column column_space"><pre><code>74                      _httpProxyUsername = userInfo[0];
75                  }
76                  if (!string.IsNullOrEmpty(_httpProxyUsername) || !string.IsNullOrEmpty(_httpProxyPassword))
77                  {
78                      var credentials = new NetworkCredential(_httpProxyUsername, _httpProxyPassword);
79                      (Credentials as CredentialCache).Remove(proxyHttpUri, "Basic");
80                      (Credentials as CredentialCache).Add(proxyHttpUri, "Basic", credentials);
81                  }
82              }
83              if (!string.IsNullOrEmpty(httpsProxyAddress) && !Uri.TryCreate(httpsProxyAddress, UriKind.Absolute, out var _))
</pre></code></div>
                <div class="column column_space"><pre><code>74                      _httpProxyUsername = userInfo[0];
75                  }
76                  if (!string.IsNullOrEmpty(_httpProxyUsername) || !string.IsNullOrEmpty(_httpProxyPassword))
77                  {
78                      var credentials = new NetworkCredential(_httpProxyUsername, _httpProxyPassword);
79                      (Credentials as CredentialCache).Remove(proxyHttpUri, "Basic");
80                      (Credentials as CredentialCache).Add(proxyHttpUri, "Basic", credentials);
81                  }
82              }
83              if (!string.IsNullOrEmpty(httpsProxyAddress) && !Uri.TryCreate(httpsProxyAddress, UriKind.Absolute, out var _))
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    