
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 9.855072463768117%, Tokens: 17, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-IMask.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Linq;
4  using System.Text;
5  using System.Threading.Tasks;
6  namespace MudBlazor
7  {
8      public interface IMask
9      {
10          string Mask { get; }
<span onclick='openModal()' class='match'>11          string Text { get;  }
12          string GetCleanText() => Text;
13          int CaretPos { get; set; }
14          (int, int)? Selection { get; set; }
</span>15          void Insert(string input);
16          void Delete();
17          void Backspace();
18          void Clear();
19          void SetText(string text);
20          void UpdateFrom(IMask other);
21      }
22  }
</code></pre>
        </div>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-Program.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Data.SqlClient;
4  using System.Diagnostics;
5  using System.Linq;
6  using System.Reflection;
7  using System.Text;
8  namespace PerformanceTestConsole
9  {
10      using System.Data;
11      using Simple.Data.Ado;
12      class Post
13      {
<span onclick='openModal()' class='match'>14          public int Id { get; set; }
15          public string Text { get; set; }
16          public DateTime CreationDate { get; set; }
</span>17          public DateTime LastChangeDate { get; set; }
18          public int? Counter1 { get; set; }
19          public int? Counter2 { get; set; }
20          public int? Counter3 { get; set; }
21          public int? Counter4 { get; set; }
22          public int? Counter5 { get; set; }
23          public int? Counter6 { get; set; }
24          public int? Counter7 { get; set; }
25          public int? Counter8 { get; set; }
26          public int? Counter9 { get; set; }
27      }
28      class Program
29      {
30          public static readonly string ConnectionString = "Data Source=.;Initial Catalog=tempdb;Integrated Security=true";
31          public static SqlConnection GetOpenConnection()
32          {
33              var connection = new SqlConnection(ConnectionString);
34              connection.Open();
35              return connection;
36          }
37          static void RunPerformanceTests()
38          {
39              var test = new PerformanceTests();
40              Console.WriteLine("Running 500 iterations that load up a post entity");
41              test.Run(500);
42          }
43          static void Main(string[] args)
44          {
45              EnsureDBSetup();
46              RunPerformanceTests();
47              if (Debugger.IsAttached) Console.ReadKey();
48          }
49          private static void EnsureDBSetup()
50          {
51              using (var cnn = GetOpenConnection())
52              {
53                  var cmd = cnn.CreateCommand();
54                  cmd.CommandText = @"
55  if (OBJECT_ID('Posts') is null)
56  begin
57  	create table Posts
58  	(
59  		Id int identity primary key, 
60  		[Text] varchar(max) not null, 
61  		CreationDate datetime not null, 
62  		LastChangeDate datetime not null,
63  		Counter1 int,
64  		Counter2 int,
65  		Counter3 int,
66  		Counter4 int,
67  		Counter5 int,
68  		Counter6 int,
69  		Counter7 int,
70  		Counter8 int,
71  		Counter9 int
72  	)
73  	set nocount on 
74  	declare @i int
75  	declare @c int
76  	declare @id int
77  	set @i = 0
78  	while @i < 5000
79  	begin 
80  		insert Posts ([Text],CreationDate, LastChangeDate) values (replicate('x', 2000), GETDATE(), GETDATE())
81  		set @id = @@IDENTITY
82  		set @i = @i + 1
83  	end
84  end
85  ";
86                  cmd.Connection = cnn;
87                  cmd.ExecuteNonQuery();
88              }
89          }
90          private static void RunTests()
91          {
92              var tester = new Tests();
93              foreach (var method in typeof(Tests).GetMethods(BindingFlags.Public | BindingFlags.Instance | BindingFlags.DeclaredOnly))
94              {
95                  Console.Write("Running " + method.Name);
96                  method.Invoke(tester, null);
97                  Console.WriteLine(" - OK!");
98              }
99          }
100      }
101      class PerformanceTests
102      {
103          class Test
104          {
105              public static Test Create(Action<int> iteration, string name)
106              {
107                  return new Test { Iteration = iteration, Name = name };
108              }
109              public Action<int> Iteration { get; set; }
110              public string Name { get; set; }
111              public Stopwatch Watch { get; set; }
112          }
113          class Tests : List<Test>
114          {
115              public void Add(Action<int> iteration, string name)
116              {
117                  Add(Test.Create(iteration, name));
118              }
119              public void Run(int iterations)
120              {
121                  foreach (var test in this)
122                  {
123                      test.Iteration(iterations + 1);
124                      test.Watch = new Stopwatch();
125                      test.Watch.Reset();
126                  }
127                  var rand = new Random();
128                  for (int i = 1; i <= iterations; i++)
129                  {
130                      foreach (var test in this.OrderBy(ignore => rand.Next()))
131                      {
132                          test.Watch.Start();
133                          test.Iteration(i);
134                          test.Watch.Stop();
135                      }
136                  }
137                  foreach (var test in this.OrderBy(t => t.Watch.ElapsedMilliseconds))
138                  {
139                      Console.WriteLine(test.Name + " took " + test.Watch.ElapsedMilliseconds + "ms");
140                  }
141              }
142          }
143          public void Run(int iterations)
144          {
145              var tests = new Tests();
146              var simpleDb = Simple.Data.Database.OpenConnection(Program.ConnectionString);
147              SqlConnection connection = Program.GetOpenConnection();
148              simpleDb.UseSharedConnection(connection);
149              simpleDb.Posts.FindById(1);
150              tests.Add(id => simpleDb.Posts.FindById(id), "Dynamic Simple.Data Query");
151              var postCommand = new SqlCommand();
152              postCommand.Connection = connection;
153              postCommand.CommandText = @"select top 1 Id, [Text], [CreationDate], LastChangeDate, 
154                  Counter1,Counter2,Counter3,Counter4,Counter5,Counter6,Counter7,Counter8,Counter9 from Posts where Id = @Id";
155              var idParam = postCommand.Parameters.Add("@Id", System.Data.SqlDbType.Int);
156              tests.Add(id =>
157              {
158                  idParam.Value = id;
159                  using (var reader = postCommand.ExecuteReader())
160                  {
161                      reader.Read();
162                      var post = new Post();
163                      post.Id = reader.GetInt32(0);
164                      post.Text = reader.GetNullableString(1);
165                      post.CreationDate = reader.GetDateTime(2);
166                      post.LastChangeDate = reader.GetDateTime(3);
167                      post.Counter1 = reader.GetNullableValue<int>(4);
168                      post.Counter2 = reader.GetNullableValue<int>(5);
169                      post.Counter3 = reader.GetNullableValue<int>(6);
170                      post.Counter4 = reader.GetNullableValue<int>(7);
171                      post.Counter5 = reader.GetNullableValue<int>(8);
172                      post.Counter6 = reader.GetNullableValue<int>(9);
173                      post.Counter7 = reader.GetNullableValue<int>(10);
174                      post.Counter8 = reader.GetNullableValue<int>(11);
175                      post.Counter9 = reader.GetNullableValue<int>(12);
176                  }
177              }, "hand coded");
178              tests.Run(iterations);
179          }
180      }
181      static class TestAssertions
182      {
183          public static void IsEquals<T>(this T obj, T other)
184          {
185              if (!obj.Equals(other))
186              {
187                  throw new ApplicationException(string.Format("{0} should be equals to {1}", obj, other));
188              }
189          }
190          public static void IsSequenceEqual<T>(this IEnumerable<T> obj, IEnumerable<T> other)
191          {
192              if (!obj.SequenceEqual(other))
193              {
194                  throw new ApplicationException(string.Format("{0} should be equals to {1}", obj, other));
195              }
196          }
197          public static void IsFalse(this bool b)
198          {
199              if (b)
200              {
201                  throw new ApplicationException("Expected false");
202              }
203          }
204          public static void IsNull(this object obj)
205          {
206              if (obj != null)
207              {
208                  throw new ApplicationException("Expected null");
209              }
210          }
211      }
212      class Tests
213      {
214          SqlConnection connection = Program.GetOpenConnection();
215      }
216      static class SqlDataReaderHelper
217      {
218          public static string GetNullableString(this SqlDataReader reader, int index)
219          {
220              object tmp = reader.GetValue(index);
221              if (tmp != DBNull.Value)
222              {
223                  return (string)tmp;
224              }
225              return null;
226          }
227          public static Nullable<T> GetNullableValue<T>(this SqlDataReader reader, int index) where T : struct
228          {
229              object tmp = reader.GetValue(index);
230              if (tmp != DBNull.Value)
231              {
232                  return (T)tmp;
233              }
234              return null;
235          }
236      }
237  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-IMask.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-Program.cs</div>
                </div>
                <div class="column column_space"><pre><code>11          string Text { get;  }
12          string GetCleanText() => Text;
13          int CaretPos { get; set; }
14          (int, int)? Selection { get; set; }
</pre></code></div>
                <div class="column column_space"><pre><code>14          public int Id { get; set; }
15          public string Text { get; set; }
16          public DateTime CreationDate { get; set; }
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    