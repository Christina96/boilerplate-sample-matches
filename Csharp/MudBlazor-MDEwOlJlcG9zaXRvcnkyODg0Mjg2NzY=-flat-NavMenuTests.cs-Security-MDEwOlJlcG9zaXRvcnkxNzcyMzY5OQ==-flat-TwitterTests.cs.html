
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 5.655526992287918%, Tokens: 11, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-NavMenuTests.cs</h3>
            <pre><code>1  using System;
2  using Bunit;
3  using FluentAssertions;
4  using MudBlazor.UnitTests.TestComponents;
5  using NUnit.Framework;
6  namespace MudBlazor.UnitTests.Components
7  {
8      [TestFixture]
9      public class NavMenuTests : BunitTest
10      {
11          [Test]
12          public void NavMenuTests_DefaultValues()
13          {
14              var comp = Context.RenderComponent<MudNavMenu>();
15              comp.Instance.Bordered.Should().Be(false);
16              comp.Instance.Color.Should().Be(Color.Default);
17              comp.Instance.Dense.Should().Be(false);
18              comp.Instance.Margin.Should().Be(Margin.None);
19              comp.Instance.Rounded.Should().Be(false);
20              comp.FindAll("mud-navmenu-bordered").Count.Should().Be(0);
21              comp.FindAll("mud-navmenu-success").Count.Should().Be(0);
22              comp.FindAll("mud-navmenu-dense").Count.Should().Be(0);
23              comp.FindAll("mud-navmenu-margin-dense").Count.Should().Be(0);
24              comp.FindAll("mud-navmenu-rounded").Count.Should().Be(0);
25          }
26          [Test]
27          public void NavMenuTests_CheckAllStyling()
28          {
29              var comp = Context.RenderComponent<MudNavMenu>(x =>
30              {
31                  x.Add(p => p.Bordered, true);
32                  x.Add(p => p.Color, Color.Success);
33                  x.Add(p => p.Dense, true);
34                  x.Add(p => p.Margin, Margin.Dense);
35                  x.Add(p => p.Rounded, true);
36              });
37              comp.Markup.Should().Contain("mud-navmenu-bordered");
38              comp.Markup.Should().Contain("mud-navmenu-success");
39              comp.Markup.Should().Contain("mud-navmenu-dense");
40              comp.Markup.Should().Contain("mud-navmenu-margin-dense");
41              comp.Markup.Should().Contain("mud-navmenu-rounded");
42          }
43          [Test]
44          public void One_Way_Bindable()
45          {
46              var comp = Context.RenderComponent<NavMenuOneWay>();
<span onclick='openModal()' class='match'>47              comp.Markup.Should().Contain("expanded");
48              var navgroup = comp.Find(".mud-nav-group>button");
49              navgroup.Click();
50              comp.Markup.Should().NotContain("expanded");
51          }
52          [Test]
53          public void Two_Way_Bindable()
54          {
55              var comp = Context.RenderComponent<NavMenuTwoWay>();
</span>56              comp.Markup.Should().NotContain("expanded");
57              var isExpanded = comp.Instance._isExpanded;
58              isExpanded.Should().BeFalse();
59              var navgroup = comp.Find(".mud-nav-group>button");
60              navgroup.Click();
61              isExpanded = comp.Instance._isExpanded;
62              isExpanded.Should().BeTrue();
63              comp.Markup.Should().Contain("expanded");
64          }
65      }
66  }
</code></pre>
        </div>
        <div class="column">
            <h3>Security-MDEwOlJlcG9zaXRvcnkxNzcyMzY5OQ==-flat-TwitterTests.cs</h3>
            <pre><code>1  using Microsoft.AspNetCore.Builder;
2  using Microsoft.AspNetCore.Hosting;
3  using Microsoft.AspNetCore.Http;
4  using Microsoft.AspNetCore.TestHost;
5  using Microsoft.Extensions.DependencyInjection;
6  using Microsoft.Net.Http.Headers;
7  using System;
8  using System.Linq;
9  using System.Net;
10  using System.Net.Http;
11  using System.Security.Claims;
12  using System.Text;
13  using System.Threading.Tasks;
14  using Xunit;
15  namespace Microsoft.AspNetCore.Authentication.Twitter
16  {
17      public class TwitterTests : RemoteAuthenticationTests<TwitterOptions>
18      {
19          protected override string DefaultScheme => TwitterDefaults.AuthenticationScheme;
20          protected override Type HandlerType => typeof(TwitterHandler);
21          protected override bool SupportsSignIn { get => false; }
22          protected override bool SupportsSignOut { get => false; }
23          protected override void RegisterAuth(AuthenticationBuilder services, Action<TwitterOptions> configure)
24          {
25              services.AddTwitter(o =>
26              {
27                  ConfigureDefaults(o);
28                  configure.Invoke(o);
29              });
30          }
31          protected override void ConfigureDefaults(TwitterOptions o)
32          {
33              o.ConsumerKey = "whatever";
34              o.ConsumerSecret = "whatever";
35              o.SignInScheme = "auth1";
36          }
37          [Fact]
38          public async Task ChallengeWillTriggerApplyRedirectEvent()
39          {
40              var server = CreateServer(o =>
41              {
42                  o.ConsumerKey = "Test Consumer Key";
43                  o.ConsumerSecret = "Test Consumer Secret";
44                  o.Events = new TwitterEvents
45                  {
46                      OnRedirectToAuthorizationEndpoint = context =>
47                      {
48                          context.Response.Redirect(context.RedirectUri + "&custom=test");
49                          return Task.FromResult(0);
50                      }
51                  };
52                  o.BackchannelHttpHandler = new TestHttpMessageHandler
53                  {
54                      Sender = BackchannelRequestToken
55                  };
56              },
57              async context =>
58              {
59                  await context.ChallengeAsync("Twitter");
60                  return true;
61              });
62              var transaction = await server.SendAsync("http:&bsol;&bsol;example.com/challenge");
63              Assert.Equal(HttpStatusCode.Redirect, transaction.Response.StatusCode);
64              var query = transaction.Response.Headers.Location.Query;
65              Assert.Contains("custom=test", query);
66          }
67          [Fact]
68          public async Task ThrowsIfClientIdMissing()
69          {
70              var server = CreateServer(o =>
71              {
72                  o.ConsumerSecret = "Test Consumer Secret";
73              });
74              await Assert.ThrowsAsync<ArgumentException>("ConsumerKey", async () => await server.SendAsync("http:&bsol;&bsol;example.com/challenge"));
75          }
76          [Fact]
77          public async Task ThrowsIfClientSecretMissing()
78          {
79              var server = CreateServer(o =>
80              {
81                  o.ConsumerKey = "Test Consumer Key";
82              });
83              await Assert.ThrowsAsync<ArgumentException>("ConsumerSecret", async () => await server.SendAsync("http:&bsol;&bsol;example.com/challenge"));
84          }
85          [Fact]
86          public async Task BadSignInWillThrow()
87          {
88              var server = CreateServer(o =>
89              {
90                  o.ConsumerKey = "Test Consumer Key";
91                  o.ConsumerSecret = "Test Consumer Secret";
92              });
93              var error = await Assert.ThrowsAnyAsync<Exception>(() => server.SendAsync("https:&bsol;&bsol;example.com/signin-twitter"));
94              Assert.Equal("Invalid state cookie.", error.GetBaseException().Message);
95          }
96          [Fact]
97          public async Task SignInThrows()
98          {
99              var server = CreateServer(o =>
100              {
101                  o.ConsumerKey = "Test Consumer Key";
102                  o.ConsumerSecret = "Test Consumer Secret";
103              });
104              var transaction = await server.SendAsync("https:&bsol;&bsol;example.com/signIn");
105              Assert.Equal(HttpStatusCode.OK, transaction.Response.StatusCode);
106          }
107          [Fact]
108          public async Task SignOutThrows()
109          {
110              var server = CreateServer(o =>
111              {
112                  o.ConsumerKey = "Test Consumer Key";
113                  o.ConsumerSecret = "Test Consumer Secret";
114              });
115              var transaction = await server.SendAsync("https:&bsol;&bsol;example.com/signOut");
116              Assert.Equal(HttpStatusCode.OK, transaction.Response.StatusCode);
117          }
118          [Fact]
119          public async Task ForbidThrows()
120          {
121              var server = CreateServer(o =>
122              {
123                  o.ConsumerKey = "Test Consumer Key";
124                  o.ConsumerSecret = "Test Consumer Secret";
125              });
126              var transaction = await server.SendAsync("https:&bsol;&bsol;example.com/signOut");
127              Assert.Equal(HttpStatusCode.OK, transaction.Response.StatusCode);
128          }
129          [Fact]
130          public async Task ChallengeWillTriggerRedirection()
131          {
132              var server = CreateServer(o =>
133              {
134                  o.ConsumerKey = "Test Consumer Key";
135                  o.ConsumerSecret = "Test Consumer Secret";
136                  o.BackchannelHttpHandler = new TestHttpMessageHandler
137                  {
138                      Sender = BackchannelRequestToken
139                  };
140              },
141              async context =>
142              {
143                  await context.ChallengeAsync("Twitter");
144                  return true;
145              });
146              var transaction = await server.SendAsync("http:&bsol;&bsol;example.com/challenge");
147              Assert.Equal(HttpStatusCode.Redirect, transaction.Response.StatusCode);
148              var location = transaction.Response.Headers.Location.AbsoluteUri;
149              Assert.Contains("https:&bsol;&bsol;api.twitter.com/oauth/authenticate?oauth_token=", location);
150          }
151          [Fact]
152          public async Task HandleRequestAsync_RedirectsToAccessDeniedPathWhenExplicitlySet()
153          {
154              var server = CreateServer(o =>
155              {
156                  o.ConsumerKey = "Test Consumer Key";
157                  o.ConsumerSecret = "Test Consumer Secret";
158                  o.BackchannelHttpHandler = new TestHttpMessageHandler
159                  {
160                      Sender = BackchannelRequestToken
161                  };
162                  o.AccessDeniedPath = "/access-denied";
163                  o.Events.OnRemoteFailure = context => throw new InvalidOperationException("This event should not be called.");
164              },
165              async context =>
166              {
167                  var properties = new AuthenticationProperties();
168                  properties.Items["testkey"] = "testvalue";
169                  await context.ChallengeAsync("Twitter", properties);
170                  return true;
171              });
172              var transaction = await server.SendAsync("http:&bsol;&bsol;example.com/challenge");
173              Assert.Equal(HttpStatusCode.Redirect, transaction.Response.StatusCode);
174              var location = transaction.Response.Headers.Location.AbsoluteUri;
175              Assert.Contains("https:&bsol;&bsol;api.twitter.com/oauth/authenticate?oauth_token=", location);
176              Assert.True(transaction.Response.Headers.TryGetValues(HeaderNames.SetCookie, out var setCookie));
177              Assert.True(SetCookieHeaderValue.TryParseList(setCookie.ToList(), out var setCookieValues));
178              Assert.Single(setCookieValues);
179              var setCookieValue = setCookieValues.Single();
180              var cookie = new CookieHeaderValue(setCookieValue.Name, setCookieValue.Value);
181              var request = new HttpRequestMessage(HttpMethod.Get, "/signin-twitter?denied=ABCDEFG");
182              request.Headers.Add(HeaderNames.Cookie, cookie.ToString());
<span onclick='openModal()' class='match'>183              var client = server.CreateClient();
184              var response = await client.SendAsync(request);
185              Assert.Equal(HttpStatusCode.Redirect, response.StatusCode);
186              Assert.Equal("/access-denied?ReturnUrl=%2Fchallenge", response.Headers.Location.ToString());
187          }
188          [Fact]
189          public async Task BadCallbackCallsAccessDeniedWithState()
190          {
191              var server = CreateServer(o =>
</span>192              {
193                  o.ConsumerKey = "Test Consumer Key";
194                  o.ConsumerSecret = "Test Consumer Secret";
195                  o.BackchannelHttpHandler = new TestHttpMessageHandler
196                  {
197                      Sender = BackchannelRequestToken
198                  };
199                  o.Events = new TwitterEvents()
200                  {
201                      OnAccessDenied = context =>
202                      {
203                          Assert.NotNull(context.Properties);
204                          Assert.Equal("testvalue", context.Properties.Items["testkey"]);
205                          context.Response.StatusCode = StatusCodes.Status406NotAcceptable;
206                          context.HandleResponse();
207                          return Task.CompletedTask;
208                      }
209                  };
210              },
211              async context =>
212              {
213                  var properties = new AuthenticationProperties();
214                  properties.Items["testkey"] = "testvalue";
215                  await context.ChallengeAsync("Twitter", properties);
216                  return true;
217              });
218              var transaction = await server.SendAsync("http:&bsol;&bsol;example.com/challenge");
219              Assert.Equal(HttpStatusCode.Redirect, transaction.Response.StatusCode);
220              var location = transaction.Response.Headers.Location.AbsoluteUri;
221              Assert.Contains("https:&bsol;&bsol;api.twitter.com/oauth/authenticate?oauth_token=", location);
222              Assert.True(transaction.Response.Headers.TryGetValues(HeaderNames.SetCookie, out var setCookie));
223              Assert.True(SetCookieHeaderValue.TryParseList(setCookie.ToList(), out var setCookieValues));
224              Assert.Single(setCookieValues);
225              var setCookieValue = setCookieValues.Single();
226              var cookie = new CookieHeaderValue(setCookieValue.Name, setCookieValue.Value);
227              var request = new HttpRequestMessage(HttpMethod.Get, "/signin-twitter?denied=ABCDEFG");
228              request.Headers.Add(HeaderNames.Cookie, cookie.ToString());
229              var client = server.CreateClient();
230              var response = await client.SendAsync(request);
231              Assert.Equal(HttpStatusCode.NotAcceptable, response.StatusCode);
232          }
233          [Fact]
234          public async Task BadCallbackCallsRemoteAuthFailedWithState()
235          {
236              var server = CreateServer(o =>
237              {
238                  o.ConsumerKey = "Test Consumer Key";
239                  o.ConsumerSecret = "Test Consumer Secret";
240                  o.BackchannelHttpHandler = new TestHttpMessageHandler
241                  {
242                      Sender = BackchannelRequestToken
243                  };
244                  o.Events = new TwitterEvents()
245                  {
246                      OnRemoteFailure = context =>
247                      {
248                          Assert.NotNull(context.Failure);
249                          Assert.Equal("Access was denied by the resource owner or by the remote server.", context.Failure.Message);
250                          Assert.NotNull(context.Properties);
251                          Assert.Equal("testvalue", context.Properties.Items["testkey"]);
252                          context.Response.StatusCode = StatusCodes.Status406NotAcceptable;
253                          context.HandleResponse();
254                          return Task.CompletedTask;
255                      }
256                  };
257              },
258              async context =>
259              {
260                  var properties = new AuthenticationProperties();
261                  properties.Items["testkey"] = "testvalue";
262                  await context.ChallengeAsync("Twitter", properties);
263                  return true;
264              });
265              var transaction = await server.SendAsync("http:&bsol;&bsol;example.com/challenge");
266              Assert.Equal(HttpStatusCode.Redirect, transaction.Response.StatusCode);
267              var location = transaction.Response.Headers.Location.AbsoluteUri;
268              Assert.Contains("https:&bsol;&bsol;api.twitter.com/oauth/authenticate?oauth_token=", location);
269              Assert.True(transaction.Response.Headers.TryGetValues(HeaderNames.SetCookie, out var setCookie));
270              Assert.True(SetCookieHeaderValue.TryParseList(setCookie.ToList(), out var setCookieValues));
271              Assert.Single(setCookieValues);
272              var setCookieValue = setCookieValues.Single();
273              var cookie = new CookieHeaderValue(setCookieValue.Name, setCookieValue.Value);
274              var request = new HttpRequestMessage(HttpMethod.Get, "/signin-twitter?denied=ABCDEFG");
275              request.Headers.Add(HeaderNames.Cookie, cookie.ToString());
276              var client = server.CreateClient();
277              var response = await client.SendAsync(request);
278              Assert.Equal(HttpStatusCode.NotAcceptable, response.StatusCode);
279          }
280          private static TestServer CreateServer(Action<TwitterOptions> options, Func<HttpContext, Task<bool>> handler = null)
281          {
282              var builder = new WebHostBuilder()
283                  .Configure(app =>
284                  {
285                      app.UseAuthentication();
286                      app.Use(async (context, next) =>
287                      {
288                          var req = context.Request;
289                          var res = context.Response;
290                          if (req.Path == new PathString("/signIn"))
291                          {
292                              await Assert.ThrowsAsync<InvalidOperationException>(() => context.SignInAsync("Twitter", new ClaimsPrincipal()));
293                          }
294                          else if (req.Path == new PathString("/signOut"))
295                          {
296                              await Assert.ThrowsAsync<InvalidOperationException>(() => context.SignOutAsync("Twitter"));
297                          }
298                          else if (req.Path == new PathString("/forbid"))
299                          {
300                              await Assert.ThrowsAsync<InvalidOperationException>(() => context.ForbidAsync("Twitter"));
301                          }
302                          else if (handler == null || ! await handler(context))
303                          {
304                              await next();
305                          }
306                      });
307                  })
308                  .ConfigureServices(services =>
309                  {
310                      Action<TwitterOptions> wrapOptions = o =>
311                      {
312                          o.SignInScheme = "External";
313                          options(o);
314                      };
315                      services.AddAuthentication()
316                          .AddCookie("External", _ => { })
317                          .AddTwitter(wrapOptions);
318                  });
319              return new TestServer(builder);
320          }
321          private HttpResponseMessage BackchannelRequestToken(HttpRequestMessage req)
322          {
323              if (req.RequestUri.AbsoluteUri == "https:&bsol;&bsol;api.twitter.com/oauth/request_token")
324              {
325                  return new HttpResponseMessage(HttpStatusCode.OK)
326                  {
327                      Content =
328                          new StringContent("oauth_callback_confirmed=true&oauth_token=test_oauth_token&oauth_token_secret=test_oauth_token_secret",
329                              Encoding.UTF8,
330                              "application/x-www-form-urlencoded")
331                  };
332              }
333              throw new NotImplementedException(req.RequestUri.AbsoluteUri);
334          }
335      }
336  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-NavMenuTests.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Security-MDEwOlJlcG9zaXRvcnkxNzcyMzY5OQ==-flat-TwitterTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>47              comp.Markup.Should().Contain("expanded");
48              var navgroup = comp.Find(".mud-nav-group>button");
49              navgroup.Click();
50              comp.Markup.Should().NotContain("expanded");
51          }
52          [Test]
53          public void Two_Way_Bindable()
54          {
55              var comp = Context.RenderComponent<NavMenuTwoWay>();
</pre></code></div>
                <div class="column column_space"><pre><code>183              var client = server.CreateClient();
184              var response = await client.SendAsync(request);
185              Assert.Equal(HttpStatusCode.Redirect, response.StatusCode);
186              Assert.Equal("/access-denied?ReturnUrl=%2Fchallenge", response.Headers.Location.ToString());
187          }
188          [Fact]
189          public async Task BadCallbackCallsAccessDeniedWithState()
190          {
191              var server = CreateServer(o =>
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    