
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 6.811145510835913%, Tokens: 11</h2>
        <div class="column">
            <h3>runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-ExpressionResources.g.cs</h3>
            <pre><code>1  using System.Globalization;
2  namespace GitHub.DistributedTask.Expressions
3  {
4      public static class ExpressionResources
5      {
6          public static string ExceededAllowedMemory(object arg0)
7          {
8              const string Format = @"The maximum allowed memory size was exceeded while evaluating the following expression: {0}";
<span onclick='openModal()' class='match'>9              return string.Format(CultureInfo.CurrentCulture, Format, arg0);
10          }
11          public static string InvalidFormatArgIndex(object arg0)
12          {
13              const string Format = @"The following format string references more arguments than were supplied: {0}";
14              return string.Format(CultureInfo.CurrentCulture, Format, arg0);
15          }
16          public static string InvalidFormatSpecifiers(object arg0, object arg1)
17          {
18              const string Format = @"The format specifiers '{0}' are not valid for objects of type '{1}'";
19              return string.Format(CultureInfo.CurrentCulture, Format, arg0, arg1);
20          }
21          public static string InvalidFormatString(object arg0)
22          {
</span>23              const string Format = @"The following format string is invalid: {0}";
24              return string.Format(CultureInfo.CurrentCulture, Format, arg0);
25          }
26      }
27  }
</code></pre>
        </div>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-ProviderHelper.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Concurrent;
3  using System.Collections.Generic;
4  using System.ComponentModel.Composition;
5  using System.ComponentModel.Composition.Hosting;
6  using System.Configuration;
7  using System.Data.OleDb;
8  using System.Linq;
9  using System.Reflection;
10  using System.IO;
11  using System.Text.RegularExpressions;
12  namespace Simple.Data.Ado
13  {
14      using Schema;
15      public class ProviderHelper
16      {
17          private readonly ConcurrentDictionary<ConnectionToken, IConnectionProvider> _connectionProviderCache = new ConcurrentDictionary<ConnectionToken,IConnectionProvider>();
18          private readonly ConcurrentDictionary<Type, object> _customProviderCache = new ConcurrentDictionary<Type, object>();
19          public IConnectionProvider GetProviderByConnectionString(string connectionString)
20          {
21              var token = new ConnectionToken(connectionString, string.Empty);
22              return _connectionProviderCache.GetOrAdd(token, LoadProviderByConnectionString);
23          }
24          public IConnectionProvider GetProviderByFilename(string filename)
25          {
26              var token = new ConnectionToken(filename, "System.Data.SqlCeClient");
27              return _connectionProviderCache.GetOrAdd(token, LoadProviderByFilename);
28          }
29          private IConnectionProvider LoadProviderByConnectionString(ConnectionToken token)
30          {
31              var dataSource = GetDataSourceName(token.ConnectionString);
32              if (dataSource.EndsWith("sdf", StringComparison.CurrentCultureIgnoreCase) && File.Exists(dataSource))
33              {
34                  return GetProviderByFilename(dataSource);
35              }
36              var provider = ComposeProvider();
37              provider.SetConnectionString(token.ConnectionString);
38              return provider;
39          }
40          internal static string GetDataSourceName(string connectionString)
41          {
42              var match = Regex.Match(connectionString, @"data source=(.*?)(;|\z)");
43              if (match != null && match.Groups.Count > 1)
44              {
45                  return match.Groups[1].Value;
46              }
47              return string.Empty;
48          }
49          private static IConnectionProvider LoadProviderByFilename(ConnectionToken token)
50          {
51              string extension = GetFileExtension(token.ConnectionString);
52              var provider = ComposeProvider(extension);
53              provider.SetConnectionString(string.Format("data source={0}", token.ConnectionString));
54              return provider;
55          }
56          private static string GetFileExtension(string filename)
57          {
58              var extension = Path.GetExtension(filename);
59              if (extension == null) throw new ArgumentException(string.Format("Unrecognised file name '{0}': no extension.", filename), "filename");
<span onclick='openModal()' class='match'>60              return extension.TrimStart('.').ToLower();
61          }
62          private static IConnectionProvider ComposeProvider()
63          {
64              return Composer.Default.Compose<IConnectionProvider>();
65          }
66          private static IConnectionProvider ComposeProvider(string extension)
67          {
68              return Composer.Default.Compose<IConnectionProvider>(extension);
69          }
70          public IConnectionProvider GetProviderByConnectionName(string connectionName, string schemaName = null)
71          {
</span>72              var connectionSettings = ConfigurationManager.ConnectionStrings[connectionName];
73              if (connectionSettings == null)
74              {
75                  throw new ArgumentOutOfRangeException("connectionName");
76              }
77              return GetProviderByConnectionString(connectionSettings.ConnectionString, connectionSettings.ProviderName, schemaName);
78          }
79          public IConnectionProvider GetProviderByConnectionString(string connectionString, string providerName, string schemaName = null)
80          {
81              return _connectionProviderCache.GetOrAdd(new ConnectionToken(connectionString, providerName, schemaName),
82                                                       LoadProviderByConnectionToken);
83          }
84          private static IConnectionProvider LoadProviderByConnectionToken(ConnectionToken token)
85          {
86              IConnectionProvider provider;
87              if (TryLoadAssemblyUsingAttribute(token.ConnectionString, token.ProviderName, out provider))
88              {
89                  return provider;
90              }
91              provider = ComposeProvider(token.ProviderName);
92              if (provider == null)
93              {
94                  throw new InvalidOperationException(string.Format("Provider '{0}' could not be resolved.", token.ProviderName));
95              }
96              provider.SetConnectionString(token.ConnectionString);
97              var schemaConnectionProvider = provider as ISchemaConnectionProvider;
98              if(schemaConnectionProvider != null)
99                  schemaConnectionProvider.SetSchema(token.SchemaName);
100              return provider;
101          }
102          public T GetCustomProvider<T>(IConnectionProvider connectionProvider)
103          {
104              return (T)_customProviderCache.GetOrAdd(typeof (T), t => GetCustomProviderExport<T>(connectionProvider.GetType().Assembly) ??
105                                                                       GetCustomProviderServiceProvider(connectionProvider as IServiceProvider, t));
106          }
107          private static Object GetCustomProviderExport<T>(Assembly assembly)
108          {
109              using (var assemblyCatalog = new AssemblyCatalog(assembly))
110              {
111                  using (var container = new CompositionContainer(assemblyCatalog))
112                  {
113                      return container.GetExportedValueOrDefault<T>();
114                  }
115              }
116          }
117          private static Object GetCustomProviderServiceProvider(IServiceProvider serviceProvider, Type type)
118          {
119              if (serviceProvider != null)
120              {
121                  return serviceProvider.GetService(type);
122              }
123              return null;
124          }
125          public T GetCustomProvider<T>(ISchemaProvider schemaProvider)
126          {
127              return (T)_customProviderCache.GetOrAdd(typeof(T), t => GetCustomProviderExport<T>(schemaProvider));
128          }
129          private static T GetCustomProviderExport<T>(ISchemaProvider schemaProvider)
130          {
131              using (var assemblyCatalog = new AssemblyCatalog(schemaProvider.GetType().Assembly))
132              {
133                  using (var container = new CompositionContainer(assemblyCatalog))
134                  {
135                      return container.GetExportedValueOrDefault<T>();
136                  }
137              }
138          }
139          internal static bool TryLoadAssemblyUsingAttribute(string connectionString, string providerName, out IConnectionProvider connectionProvider)
140          {
141              var attributes = LoadAssemblyAttributes();
142              if (attributes.Count == 0)
143              {
144                  connectionProvider = null;
145                  return false;
146              }
147              if (!string.IsNullOrWhiteSpace(providerName))
148              {
149                  attributes = attributes.Where(a => a.IsForProviderName(providerName)).ToList();
150              }
151              if (attributes.Count == 0)
152              {
153                  connectionProvider = null;
154                  return false;
155              }
156              return LoadUsingAssemblyAttribute(connectionString, attributes, out connectionProvider);
157          }
158          private static bool LoadUsingAssemblyAttribute(string connectionString, ICollection<ProviderAssemblyAttributeBase> attributes,
159                                                         out IConnectionProvider connectionProvider)
160          {
161              if (attributes.Count == 0)
162              {
163                  {
164                      connectionProvider = null;
165                      return true;
166                  }
167              }
168              foreach (var attribute in attributes)
169              {
170                  Exception exception;
171                  if (attribute.TryGetProvider(connectionString, out connectionProvider, out exception))
172                  {
173                      return true;
174                  }
175              }
176              connectionProvider = null;
177              return false;
178          }
179          private static List<ProviderAssemblyAttributeBase> LoadAssemblyAttributes()
180          {
181              var attributes = AppDomain.CurrentDomain.GetAssemblies()
182                  .Where(a => a.GetFullName().StartsWith("Simple.Data.", StringComparison.OrdinalIgnoreCase))
183                  .SelectMany(ProviderAssemblyAttributeBase.Get)
184                  .ToList();
185              if (attributes.Count == 0)
186              {
187                  foreach (var file in Directory.EnumerateFiles(Composer.GetSimpleDataAssemblyPath(), "Simple.Data.*.dll"))
188                  {
189                      Assembly assembly;
190                      if (Composer.TryLoadAssembly(file, out assembly))
191                      {
192                          if (ProviderAssemblyAttributeBase.Get(assembly).Any())
193                          {
194                              assembly = Assembly.LoadFrom(file);
195                              attributes.AddRange(ProviderAssemblyAttributeBase.Get(assembly));
196                          }
197                      }
198                  }
199              }
200              return attributes;
201          }
202          private class ConnectionToken : IEquatable<ConnectionToken>
203          {
204              public bool Equals(ConnectionToken other)
205              {
206                  if (ReferenceEquals(null, other)) return false;
207                  if (ReferenceEquals(this, other)) return true;
208                  return Equals(other.ConnectionString, ConnectionString) && Equals(other.ProviderName, ProviderName);
209              }
210              public override bool Equals(object obj)
211              {
212                  if (ReferenceEquals(null, obj)) return false;
213                  if (ReferenceEquals(this, obj)) return true;
214                  if (obj.GetType() != typeof (ConnectionToken)) return false;
215                  return Equals((ConnectionToken) obj);
216              }
217              public override int GetHashCode()
218              {
219                  unchecked
220                  {
221                      return (ConnectionString.GetHashCode()*397) ^ (ProviderName.GetHashCode() * 397) ^ SchemaName.GetHashCode();
222                  }
223              }
224              public static bool operator ==(ConnectionToken left, ConnectionToken right)
225              {
226                  return Equals(left, right);
227              }
228              public static bool operator !=(ConnectionToken left, ConnectionToken right)
229              {
230                  return !Equals(left, right);
231              }
232              private readonly string _connectionString;
233              private readonly string _providerName;
234              private readonly string _schemaName;
235              public ConnectionToken(string connectionString, string providerName, string schemaName = null)
236              {
237                  if (connectionString == null) throw new ArgumentNullException("connectionString");
238                  _connectionString = connectionString;
239                  _providerName = providerName ?? string.Empty;
240                  _schemaName = schemaName ?? string.Empty;
241              }
242              public string ConnectionString
243              {
244                  get { return _connectionString; }
245              }
246              public string ProviderName
247              {
248                  get { return _providerName; }
249              }
250              public string SchemaName
251              {
252                  get { return _schemaName; }
253              }
254          }
255      }
256  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-ExpressionResources.g.cs</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-ProviderHelper.cs</div>
                <div class="column column_space"><pre><code>9              return string.Format(CultureInfo.CurrentCulture, Format, arg0);
10          }
11          public static string InvalidFormatArgIndex(object arg0)
12          {
13              const string Format = @"The following format string references more arguments than were supplied: {0}";
14              return string.Format(CultureInfo.CurrentCulture, Format, arg0);
15          }
16          public static string InvalidFormatSpecifiers(object arg0, object arg1)
17          {
18              const string Format = @"The format specifiers '{0}' are not valid for objects of type '{1}'";
19              return string.Format(CultureInfo.CurrentCulture, Format, arg0, arg1);
20          }
21          public static string InvalidFormatString(object arg0)
22          {
</pre></code></div>
                <div class="column column_space"><pre><code>60              return extension.TrimStart('.').ToLower();
61          }
62          private static IConnectionProvider ComposeProvider()
63          {
64              return Composer.Default.Compose<IConnectionProvider>();
65          }
66          private static IConnectionProvider ComposeProvider(string extension)
67          {
68              return Composer.Default.Compose<IConnectionProvider>(extension);
69          }
70          public IConnectionProvider GetProviderByConnectionName(string connectionName, string schemaName = null)
71          {
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    