
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 14, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-NumericFieldTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  #pragma warning disable BL0005 
3  using System;
4  using System.Collections.Generic;
5  using System.Globalization;
6  using System.Linq;
7  using System.Threading.Tasks;
8  using Bunit;
9  using FluentAssertions;
10  using FluentValidation;
11  using Microsoft.AspNetCore.Components;
12  using Microsoft.AspNetCore.Components.Web;
13  using MudBlazor.UnitTests.TestComponents.NumericField;
14  using NUnit.Framework;
15  using static Bunit.ComponentParameterFactory;
16  namespace MudBlazor.UnitTests.Components
17  {
18      [TestFixture]
19      public class NumericFieldTests : BunitTest
20      {
21          static object[] TypeCases =
22          {
23              new object[] { (byte)5 },
24              new object[] { (sbyte)5 },
25              new object[] { (short)5 },
26              new object[] { (ushort)5 },
27              new object[] { (int)5 },
28              new object[] { (uint)5 },
29              new object[] { (long)5 },
30              new object[] { (ulong)5 },
31              new object[] { (float)5 },
32              new object[] { (double)5 },
33              new object[] { (decimal)5 }
34          };
35          [Test]
36          public void NumericFieldLabelFor()
37          {
38              var comp = Context.RenderComponent<NumericFieldTest>();
39              var label = comp.FindAll(".mud-input-label");
40              label[0].Attributes.GetNamedItem("for")?.Value.Should().Be("numericFieldLabelTest");
41          }
42          [Test]
43          public async Task NumericFieldTest1()
44          {
45              var comp = Context.RenderComponent<MudNumericField<double>>();
46              var numericField = comp.Instance;
47              numericField.Value.Should().Be(0.0);
48              numericField.Text.Should().Be("0");
49              0.0.ToString("F1", CultureInfo.InvariantCulture).Should().Be("0.0");
50              await comp.InvokeAsync(() => numericField.Format = "F1");
51              await comp.InvokeAsync(() => numericField.Culture = CultureInfo.InvariantCulture);
52              numericField.Value.Should().Be(0.0);
53              numericField.Text.Should().Be("0.0");
54              comp.FindAll("div.mud-input-error").Count.Should().Be(0);
55          }
56          [Test]
57          public void NumericFieldTest2()
58          {
59              var comp = Context.RenderComponent<MudNumericField<double?>>();
60              var numericField = comp.Instance;
61              numericField.Value.Should().Be(null);
62              numericField.Text.Should().BeNullOrEmpty();
63              comp.FindAll("div.mud-input-error").Count.Should().Be(0);
64          }
65          [TestCaseSource(nameof(TypeCases))]
66          public async Task NumericField_WithNullableTypes_ShouldAllowNulls<T>(T value) where T : struct
67          {
68              var comp = Context.RenderComponent<MudNumericField<T?>>(ComponentParameter.CreateParameter("Value", value));
69              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Value", null));
70              comp.Find("input").Blur();
71              comp.FindAll("div.mud-input-error").Count.Should().Be(0);
72              comp.Find("input").Change("");
73              comp.Find("input").Blur();
74              comp.FindAll("div.mud-input-error").Count.Should().Be(0);
75          }
76          [Test]
77          public void WithNoDebounceIntervalValueShouldChangeImmediatelyTest()
78          {
79              var immediate = Parameter(nameof(MudNumericField<int?>.Immediate), true);
80              var comp = Context.RenderComponent<MudNumericField<int?>>(immediate);
81              var numericField = comp.Instance;
82              var input = comp.Find("input");
83              input.Input(new ChangeEventArgs() { Value = "100" });
84              numericField.Value.Should().Be(100);
85              numericField.Text.Should().Be("100");
86          }
87          [Test]
88          public async Task ShouldRespectDebounceIntervalPropertyInNumericFieldTest()
89          {
90              var interval = Parameter(nameof(MudNumericField<int?>.DebounceInterval), 200d);
91              var comp = Context.RenderComponent<MudNumericField<int?>>(interval);
92              var numericField = comp.Instance;
93              var input = comp.Find("input");
94              input.Input(new ChangeEventArgs() { Value = "100" });
95              numericField.Immediate.Should().BeTrue();
96              numericField.Value.Should().BeNull();
97              numericField.Text.Should().Be("100");
98              await Task.Delay(100);
99              numericField.Value.Should().BeNull();
100              numericField.Text.Should().Be("100");
101              await Task.Delay(150);
102              numericField.Value.Should().Be(100);
103              numericField.Text.Should().Be("100");
104          }
105          [Test]
106          public void LabelShouldShrinkWhenPlaceholderIsSet()
107          {
108              var label = Parameter(nameof(MudNumericField<int?>.Label), "label");
109              var placeholder = Parameter(nameof(MudNumericField<int?>.Placeholder), "placeholder");
110              var comp = Context.RenderComponent<MudNumericField<int?>>(label);
111              comp.Markup.Should().NotContain("shrink");
112              comp.SetParametersAndRender(placeholder);
113              comp.Markup.Should().Contain("shrink");
114          }
115          public class FluentValueValidator<T> : AbstractValidator<T>
116          {
117              public FluentValueValidator(Action<IRuleBuilderInitial<T, T>> rule)
118              {
119                  rule(RuleFor(x => x));
120              }
121              private IEnumerable<string> ValidateValue(T arg)
122              {
123                  var result = Validate(arg);
124                  if (result.IsValid)
125                      return Array.Empty<string>();
126                  return result.Errors.Select(e => e.ErrorMessage);
127              }
128              public Func<T, IEnumerable<string>> Validation => ValidateValue;
129          }
130          [Test]
131          public async Task NumericFieldFluentValidationTest1()
132          {
133              var validator = new FluentValueValidator<string>(x => x.Cascade(CascadeMode.Stop)
134                  .NotEmpty()
135                  .Length(1, 100));
136              var comp = Context.RenderComponent<MudNumericField<decimal>>(Parameter(nameof(MudNumericField<decimal>.Validation), validator.Validation), Parameter(nameof(MudNumericField<decimal>.Max), 100M));
137              var numericField = comp.Instance;
138              comp.Find("input").Change(99);
139              numericField.Error.Should().BeFalse(because: "The value is < 100");
140              numericField.ErrorText.Should().BeNullOrEmpty();
141              comp.Find("input").Change("100.1");
142              numericField.Error.Should().BeFalse(because: "The value should be set to Max (100)");
143              numericField.Value.Should().Be(100M);
144              numericField.ErrorText.Should().BeNullOrEmpty();
145          }
146          [Test]
147          public async Task NumericField_HandleDecimalPrecisionAndValues()
148          {
149              var comp = Context.RenderComponent<MudNumericField<decimal>>();
150              var numericField = comp.Instance;
151              comp.Find("input").Change(decimal.MaxValue);
152              numericField.Value.Should().Be(decimal.MaxValue);
153              numericField.ErrorText.Should().BeNullOrEmpty();
154              comp.Find("input").Change(decimal.MinValue);
155              numericField.Value.Should().Be(decimal.MinValue);
156              numericField.ErrorText.Should().BeNullOrEmpty();
157          }
158          [Test, Timeout(1000)]
159          public async Task NumericFieldUpdateLoopProtectionTest()
160          {
161              var comp = Context.RenderComponent<MudNumericField<int>>();
162              var numericField = comp.Instance;
163              numericField.Converter.SetFunc = s => s.ToString();
164              numericField.Converter.GetFunc = s => int.Parse(s);
<span onclick='openModal()' class='match'>165              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Value", 1));
166              numericField.Value.Should().Be(1);
</span>167              numericField.Text.Should().Be("1");
168              comp.Find("input").Change("3");
169              numericField.Value.Should().Be(3);
170              numericField.Text.Should().Be("3");
171          }
172          [Test]
173          public async Task NumericField_Should_FireValueChangedOnTextParameterChange()
174          {
175              var changed_value = 4;
176              var comp = Context.RenderComponent<MudNumericField<int>>(EventCallback<int>("ValueChanged", x => changed_value = x));
177              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Text", "4"));
178              changed_value.Should().Be(4);
179          }
180          [Test]
181          public async Task NumericField_Should_FireTextChangedOnValueParameterChange()
182          {
183              var changed_text = "4";
184              var comp = Context.RenderComponent<MudNumericField<int>>(EventCallback<string>("TextChanged", x => changed_text = x));
185              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Value", 4));
186              changed_text.Should().Be("4");
187          }
188          [Test]
189          public async Task NumericField_Should_FireTextAndValueChangedOnTextInput()
190          {
191              var changed_value = 4;
192              string changed_text = null;
193              var comp = Context.RenderComponent<MudNumericField<int>>(
194                  EventCallback<int>("ValueChanged", x => changed_value = x),
195                  EventCallback<string>("TextChanged", x => changed_text = x)
196              );
197              comp.Find("input").Change("4");
198              changed_value.Should().Be(4);
199              changed_text.Should().Be("4");
200          }
201          [Test]
202          public async Task NumericField_ShouldNot_ShowRequiredErrorWhenInitialTextIsEmpty()
203          {
204              var comp = Context.RenderComponent<NumericFieldRequiredTest>();
205              var numericField = comp.FindComponent<MudNumericField<int?>>().Instance;
206              numericField.Touched.Should().BeFalse();
207              numericField.ErrorText.Should().BeNullOrEmpty();
208              numericField.HasErrors.Should().Be(false);
209          }
210          [TestCaseSource(nameof(TypeCases))]
211          public async Task NumericField_OfAnyType_Should_Render<T>(T value)
212          {
213              Assert.DoesNotThrow(() => Context.RenderComponent<MudNumericField<T>>(), $"{typeof(MudNumericField<>)}<{typeof(T)}> render failed.");
214          }
215          [Test]
216          public async Task NumericFieldTest_KeyboardInput()
217          {
218              var comp = Context.RenderComponent<MudNumericField<double>>();
219              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
220              comp.SetParam(x => x.Format, "F2");
221              comp.SetParam(x => x.Value, 1234.56);
222              var numericField = comp.Instance;
223              numericField.Value.Should().Be(1234.56);
224              numericField.Text.Should().Be("1234.56");
225              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "ArrowUp", Type = "keydown", });
226              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "ArrowUp", Type = "keyup", });
227              comp.WaitForAssertion(() => numericField.Value.Should().Be(1235.56));
228              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "ArrowDown", Type = "keydown", });
229              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "ArrowDown", Type = "keyup", });
230              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
231              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "c", Type = "keydown", CtrlKey = false });
232              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "c", Type = "keyup", CtrlKey = false });
233              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
234              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "a", Type = "keydown", });
235              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "a", Type = "keyup", });
236              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
237              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "9", Type = "keydown", });
238              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "9", Type = "keyup", });
239              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
240          }
241          [Test]
242          public async Task NumericFieldTest_KeyboardInput_Disabled()
243          {
244              var comp = Context.RenderComponent<MudNumericField<double>>();
245              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
246              comp.SetParam(x => x.Format, "F2");
247              comp.SetParam(x => x.Value, 1234.56);
248              comp.SetParam(x => x.Disabled, true);
249              comp.Instance.Value.Should().Be(1234.56);
250              comp.Instance.Text.Should().Be("1234.56");
251              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "ArrowUp", Type = "keydown", });
252              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(1234.56));
253              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "9", Type = "keyup", });
254              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(1234.56));
255          }
256          [Test]
257          public async Task NumericFieldTest_KeyboardInput_Readonly()
258          {
259              var comp = Context.RenderComponent<MudNumericField<double>>();
260              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
261              comp.SetParam(x => x.Format, "F2");
262              comp.SetParam(x => x.Value, 1234.56);
263              comp.SetParam(x => x.ReadOnly, true);
264              comp.Instance.Value.Should().Be(1234.56);
265              comp.Instance.Text.Should().Be("1234.56");
266              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "ArrowUp", Type = "keydown", });
267              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(1234.56));
268              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "9", Type = "keyup", });
269              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(1234.56));
270          }
271          [Test]
272          public async Task NumericFieldTest_MouseWheel()
273          {
274              var comp = Context.RenderComponent<MudNumericField<double>>();
275              comp.SetParam(x => x.Value, 1234.56);
276              var numericField = comp.Instance;
277              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
278              comp.WaitForAssertion(() => numericField.Value.Should().Be(1235.56));
279              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
280              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
281              numericField.InvertMouseWheel = true;
282              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
283              comp.WaitForAssertion(() => numericField.Value.Should().Be(1233.56));
284              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
285              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
286              numericField.Step = 0.5;
287              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
288              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.06));
289              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
290              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
291              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = 77, ShiftKey = false });
292              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = -17, ShiftKey = false });
293              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
294          }
295          [Test]
296          public async Task NumericFieldTest_Wheel_Firefox()
297          {
298              var comp = Context.RenderComponent<MudNumericField<double>>();
299              comp.SetParam(x => x.Value, 1234.56);
300              var numericField = comp.Instance;
301              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
302              comp.WaitForAssertion(() => numericField.Value.Should().Be(1235.56));
303              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
304              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
305              numericField.InvertMouseWheel = true;
306              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
307              comp.WaitForAssertion(() => numericField.Value.Should().Be(1233.56));
308              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
309              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
310              numericField.Step = 0.5;
311              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
312              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.06));
313              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
314              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
315              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = 77, ShiftKey = false });
316              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = -17, ShiftKey = false });
317              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
318          }
319          [Test]
320          public async Task NumericFieldTestCultureFormat()
321          {
322              var comp = Context.RenderComponent<NumericFieldCultureTest>();
323              var inputs = comp.FindAll("input");
324              var immediate = inputs.First();
325              var notImmediate = inputs.Last();
326              notImmediate.Change("1234");
327              notImmediate.Blur();
328              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("1.234,00"));
329              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(1234.0));
330              notImmediate.Change("0");
331              notImmediate.Blur();
332              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("0,00"));
333              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(0.0));
334              notImmediate.Change("");
335              notImmediate.Blur();
336              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be(null));
337              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(null));
338              immediate.Input("1234");
339              immediate.Blur();
340              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("1,234.00"));
341              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(1234.0));
342              immediate.Input("0");
343              immediate.Blur();
344              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("0.00"));
345              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(0.0));
346              immediate.Input("");
347              immediate.Blur();
348              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be(null));
349              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(null));
350          }
351          [Test]
352          public async Task NumericField_should_RejectIllegalCharacters()
353          {
354              var comp = Context.RenderComponent<NumericFieldCultureTest>();
355              comp.FindAll("input").Last().Change("abcd");
356              comp.FindAll("input").Last().Blur();
357              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be(null));
358              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(null));
359              comp.FindAll("input").First().Input("abcd");
360              comp.FindAll("input").First().Blur();
361              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be(null));
362              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(null));
363              comp.FindAll("input").First().Input("-12-34abc.56");
364              comp.FindAll("input").First().Blur();
365              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be(null));
366              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(null));
367              comp.FindAll("input").First().Input("-1234.56");
368              comp.FindAll("input").First().Blur();
369              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("-1,234.56"));
370              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(-1234.56));
371              comp.FindAll("input").Last().Change("x+17,9y9z");
372              comp.FindAll("input").Last().Blur();
373              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be(null));
374              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(null));
375              comp.FindAll("input").Last().Change("17,99");
376              comp.FindAll("input").Last().Blur();
377              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("17,99"));
378              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(17.99));
379          }
380          [Test]
381          public async Task NumericField_should_ReformatTextOnBlur()
382          {
383              var comp = Context.RenderComponent<NumericFieldCultureTest>();
384              comp.FindAll("input").First().Input("1,234.56");
385              comp.FindAll("input").First().Blur();
386              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("1,234.56"));
387              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(1234.56));
388              comp.FindAll("input").First().Input("1234.56");
389              comp.FindAll("input").First().Blur();
390              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("1,234.56"));
391              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(1234.56));
392              comp.FindAll("input").Last().Change("7.000,99");
393              comp.FindAll("input").Last().Blur();
394              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("7.000,99"));
395              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(7000.99));
396              comp.FindAll("input").Last().Change("7000,99");
397              comp.FindAll("input").Last().Blur();
398              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("7.000,99"));
399              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(7000.99));
400          }
401          [TestCaseSource(nameof(TypeCases))]
402          public async Task NumericField_Validation<T>(T value)
403          {
404              var comp = Context.RenderComponent<MudNumericField<T>>();
405              comp.SetParam(x => x.Max, value);
406              comp.SetParam(x => x.Min, value);
407              comp.SetParam(x => x.Value, value);
408              var numericField = comp.Instance;
409              numericField.Value.Should().Be(value);
410              await comp.InvokeAsync(() =>
411              {
412                  numericField.Validate().Wait();
413              });
414              numericField.Value.Should().Be(value);
415          }
416          [TestCaseSource(nameof(TypeCases))]
417          public async Task NumericFieldMinMax<T>(T value)
418          {
419              var min = (T)Convert.ChangeType(1, typeof(T));
420              var max = (T)Convert.ChangeType(10, typeof(T));
421              var comp = Context.RenderComponent<MudNumericField<T>>();
422              comp.SetParam(x => x.Min, min);
423              comp.SetParam(x => x.Max, max);
424              comp.Find("input").Change("15");
425              comp.Find("input").Blur();
426              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(max));
427              comp.Find("input").Change("0");
428              comp.Find("input").Blur();
429              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(min));
430          }
431          [TestCaseSource(nameof(TypeCases))]
432          public async Task NumericFieldMinMaxNullable<T>(T value) where T : struct
433          {
434              var min = (T)Convert.ChangeType(1, typeof(T));
435              var max = (T)Convert.ChangeType(10, typeof(T));
436              var comp = Context.RenderComponent<MudNumericField<T?>>();
437              comp.SetParam(x => x.Min, min);
438              comp.SetParam(x => x.Max, max);
439              comp.Find("input").Change("15");
440              comp.Find("input").Blur();
441              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(max));
442              comp.Find("input").Change("0");
443              comp.Find("input").Blur();
444              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(min));
445          }
446          [TestCaseSource(nameof(TypeCases))]
447          public async Task NumericField_Increment_Decrement<T>(T value)
448          {
449              var comp = Context.RenderComponent<MudNumericField<T>>();
450              var max = Convert.ChangeType(10, typeof(T));
451              var min = Convert.ChangeType(0, typeof(T));
452              comp.SetParam(x => x.Max, max);
453              comp.SetParam(x => x.Min, min);
454              comp.SetParam(x => x.Step, value);
455              comp.SetParam(x => x.Value, value);
456              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
457              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
458              comp.Instance.Value.Should().Be(value);
459              comp.SetParam(x => x.Max, value);
460              comp.SetParam(x => x.Min, value);
461              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
462              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
463              comp.Instance.Value.Should().Be(value);
464          }
465          [TestCaseSource(nameof(TypeCases))]
466          public async Task NumericFieldNullable_Increment_Decrement<T>(T value) where T : struct
467          {
468              var comp = Context.RenderComponent<MudNumericField<T?>>();
469              var max = Convert.ChangeType(10, typeof(T));
470              var min = Convert.ChangeType(0, typeof(T));
471              comp.SetParam(x => x.Max, max);
472              comp.SetParam(x => x.Min, min);
473              comp.SetParam(x => x.Step, value);
474              comp.SetParam(x => x.Value, value);
475              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
476              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
477              comp.Instance.Value.Should().Be(value);
478              comp.SetParam(x => x.Max, value);
479              comp.SetParam(x => x.Min, value);
480              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
481              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
482              comp.Instance.Value.Should().Be(value);
483          }
484          [TestCaseSource(nameof(TypeCases))]
485          public async Task NumericField_Increment_Decrement_OverflowHandled<T>(T value)
486          {
487              var comp = Context.RenderComponent<MudNumericField<T>>();
488              comp.SetParam(x => x.Step, value);
489              comp.SetParam(x => x.Value, comp.Instance.Max);
490              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
491              comp.Instance.Value.Should().Be(comp.Instance.Max);
492              comp.SetParam(x => x.Value, comp.Instance.Min);
493              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
494              comp.Instance.Value.Should().Be(comp.Instance.Min);
495          }
496          [TestCaseSource(nameof(TypeCases))]
497          public async Task NumericFieldNullable_Increment_Decrement_OverflowHandled<T>(T value) where T : struct
498          {
499              var comp = Context.RenderComponent<MudNumericField<T?>>();
500              comp.SetParam(x => x.Step, value);
501              comp.SetParam(x => x.Value, comp.Instance.Max);
502              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
503              comp.Instance.Value.Should().Be(comp.Instance.Max);
504              comp.SetParam(x => x.Value, comp.Instance.Min);
505              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
506              comp.Instance.Value.Should().Be(comp.Instance.Min);
507          }
508          [TestCase(10, 20, 15)]
509          [TestCase(-20, -10, -15)]
510          public async Task NumericFieldCanBeCleared(int min, int max, int value)
511          {
512              var comp = Context.RenderComponent<MudNumericField<int?>>();
513              comp.SetParam(x => x.Min, min);
514              comp.SetParam(x => x.Max, max);
515              comp.SetParam(x => x.Value, value);
516              comp.Find("input").Change("");
517              comp.Find("input").Blur();
518              comp.WaitForAssertion(() => comp.Instance.Value.Should().BeNull());
519          }
520          [Test]
521          public async Task NumericFieldWithCurrencyFormat()
522          {
523              var comp = Context.RenderComponent<MudNumericField<int?>>();
524              comp.SetParam(x => x.Format, "€0");
525              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
526              var numericField = comp.Instance;
527              numericField.Value.Should().Be(null);
528              numericField.Text.Should().Be(null);
529              77.ToString("€0", CultureInfo.InvariantCulture).Should().Be("€77");
530              var conv = new DefaultConverter<int?>();
531              conv.Format = "€0";
532              conv.Culture = CultureInfo.InvariantCulture;
533              conv.Set(77).Should().Be("€77");
534              comp.FindAll("input").First().Change("1234");
535              comp.FindAll("input").First().Blur();
536              comp.WaitForAssertion(() => numericField.Text.Should().Be("€1234"));
537              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234));
538          }
539          [Test]
540          public async Task NumericFieldThousandsSeparator()
541          {
542              var comp = Context.RenderComponent<MudNumericField<int?>>();
543              var numericField = comp.Instance;
544              numericField.Value.Should().Be(null);
545              numericField.Text.Should().Be(null);
546              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
547              comp.FindAll("input").First().Change("1,000");
548              comp.FindAll("input").First().Blur();
549              comp.WaitForAssertion(() => numericField.Text.Should().Be("1000"));
550              comp.WaitForAssertion(() => numericField.Value.Should().Be(1000));
551              comp.SetParam(x => x.Culture, new CultureInfo("de-DE", false));
552              comp.FindAll("input").First().Change("1.000");
553              comp.FindAll("input").First().Blur();
554              comp.WaitForAssertion(() => numericField.Text.Should().Be("1000"));
555              comp.WaitForAssertion(() => numericField.Value.Should().Be(1000));
556          }
557      }
558  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-NumericFieldTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  #pragma warning disable BL0005 
3  using System;
4  using System.Collections.Generic;
5  using System.Globalization;
6  using System.Linq;
7  using System.Threading.Tasks;
8  using Bunit;
9  using FluentAssertions;
10  using FluentValidation;
11  using Microsoft.AspNetCore.Components;
12  using Microsoft.AspNetCore.Components.Web;
13  using MudBlazor.UnitTests.TestComponents.NumericField;
14  using NUnit.Framework;
15  using static Bunit.ComponentParameterFactory;
16  namespace MudBlazor.UnitTests.Components
17  {
18      [TestFixture]
19      public class NumericFieldTests : BunitTest
20      {
21          static object[] TypeCases =
22          {
23              new object[] { (byte)5 },
24              new object[] { (sbyte)5 },
25              new object[] { (short)5 },
26              new object[] { (ushort)5 },
27              new object[] { (int)5 },
28              new object[] { (uint)5 },
29              new object[] { (long)5 },
30              new object[] { (ulong)5 },
31              new object[] { (float)5 },
32              new object[] { (double)5 },
33              new object[] { (decimal)5 }
34          };
35          [Test]
36          public void NumericFieldLabelFor()
37          {
38              var comp = Context.RenderComponent<NumericFieldTest>();
39              var label = comp.FindAll(".mud-input-label");
40              label[0].Attributes.GetNamedItem("for")?.Value.Should().Be("numericFieldLabelTest");
41          }
42          [Test]
43          public async Task NumericFieldTest1()
44          {
45              var comp = Context.RenderComponent<MudNumericField<double>>();
46              var numericField = comp.Instance;
47              numericField.Value.Should().Be(0.0);
48              numericField.Text.Should().Be("0");
49              0.0.ToString("F1", CultureInfo.InvariantCulture).Should().Be("0.0");
50              await comp.InvokeAsync(() => numericField.Format = "F1");
51              await comp.InvokeAsync(() => numericField.Culture = CultureInfo.InvariantCulture);
52              numericField.Value.Should().Be(0.0);
53              numericField.Text.Should().Be("0.0");
54              comp.FindAll("div.mud-input-error").Count.Should().Be(0);
55          }
56          [Test]
57          public void NumericFieldTest2()
58          {
59              var comp = Context.RenderComponent<MudNumericField<double?>>();
60              var numericField = comp.Instance;
61              numericField.Value.Should().Be(null);
62              numericField.Text.Should().BeNullOrEmpty();
63              comp.FindAll("div.mud-input-error").Count.Should().Be(0);
64          }
65          [TestCaseSource(nameof(TypeCases))]
66          public async Task NumericField_WithNullableTypes_ShouldAllowNulls<T>(T value) where T : struct
67          {
68              var comp = Context.RenderComponent<MudNumericField<T?>>(ComponentParameter.CreateParameter("Value", value));
69              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Value", null));
70              comp.Find("input").Blur();
71              comp.FindAll("div.mud-input-error").Count.Should().Be(0);
72              comp.Find("input").Change("");
73              comp.Find("input").Blur();
74              comp.FindAll("div.mud-input-error").Count.Should().Be(0);
75          }
76          [Test]
77          public void WithNoDebounceIntervalValueShouldChangeImmediatelyTest()
78          {
79              var immediate = Parameter(nameof(MudNumericField<int?>.Immediate), true);
80              var comp = Context.RenderComponent<MudNumericField<int?>>(immediate);
81              var numericField = comp.Instance;
82              var input = comp.Find("input");
83              input.Input(new ChangeEventArgs() { Value = "100" });
84              numericField.Value.Should().Be(100);
85              numericField.Text.Should().Be("100");
86          }
87          [Test]
88          public async Task ShouldRespectDebounceIntervalPropertyInNumericFieldTest()
89          {
90              var interval = Parameter(nameof(MudNumericField<int?>.DebounceInterval), 200d);
91              var comp = Context.RenderComponent<MudNumericField<int?>>(interval);
92              var numericField = comp.Instance;
93              var input = comp.Find("input");
94              input.Input(new ChangeEventArgs() { Value = "100" });
95              numericField.Immediate.Should().BeTrue();
96              numericField.Value.Should().BeNull();
97              numericField.Text.Should().Be("100");
98              await Task.Delay(100);
99              numericField.Value.Should().BeNull();
100              numericField.Text.Should().Be("100");
101              await Task.Delay(150);
102              numericField.Value.Should().Be(100);
103              numericField.Text.Should().Be("100");
104          }
105          [Test]
106          public void LabelShouldShrinkWhenPlaceholderIsSet()
107          {
108              var label = Parameter(nameof(MudNumericField<int?>.Label), "label");
109              var placeholder = Parameter(nameof(MudNumericField<int?>.Placeholder), "placeholder");
110              var comp = Context.RenderComponent<MudNumericField<int?>>(label);
111              comp.Markup.Should().NotContain("shrink");
112              comp.SetParametersAndRender(placeholder);
113              comp.Markup.Should().Contain("shrink");
114          }
115          public class FluentValueValidator<T> : AbstractValidator<T>
116          {
117              public FluentValueValidator(Action<IRuleBuilderInitial<T, T>> rule)
118              {
119                  rule(RuleFor(x => x));
120              }
121              private IEnumerable<string> ValidateValue(T arg)
122              {
123                  var result = Validate(arg);
124                  if (result.IsValid)
125                      return Array.Empty<string>();
126                  return result.Errors.Select(e => e.ErrorMessage);
127              }
128              public Func<T, IEnumerable<string>> Validation => ValidateValue;
129          }
130          [Test]
131          public async Task NumericFieldFluentValidationTest1()
132          {
133              var validator = new FluentValueValidator<string>(x => x.Cascade(CascadeMode.Stop)
134                  .NotEmpty()
135                  .Length(1, 100));
136              var comp = Context.RenderComponent<MudNumericField<decimal>>(Parameter(nameof(MudNumericField<decimal>.Validation), validator.Validation), Parameter(nameof(MudNumericField<decimal>.Max), 100M));
137              var numericField = comp.Instance;
138              comp.Find("input").Change(99);
139              numericField.Error.Should().BeFalse(because: "The value is < 100");
140              numericField.ErrorText.Should().BeNullOrEmpty();
141              comp.Find("input").Change("100.1");
142              numericField.Error.Should().BeFalse(because: "The value should be set to Max (100)");
143              numericField.Value.Should().Be(100M);
144              numericField.ErrorText.Should().BeNullOrEmpty();
145          }
146          [Test]
147          public async Task NumericField_HandleDecimalPrecisionAndValues()
148          {
149              var comp = Context.RenderComponent<MudNumericField<decimal>>();
150              var numericField = comp.Instance;
151              comp.Find("input").Change(decimal.MaxValue);
152              numericField.Value.Should().Be(decimal.MaxValue);
153              numericField.ErrorText.Should().BeNullOrEmpty();
154              comp.Find("input").Change(decimal.MinValue);
155              numericField.Value.Should().Be(decimal.MinValue);
156              numericField.ErrorText.Should().BeNullOrEmpty();
157          }
158          [Test, Timeout(1000)]
159          public async Task NumericFieldUpdateLoopProtectionTest()
160          {
161              var comp = Context.RenderComponent<MudNumericField<int>>();
162              var numericField = comp.Instance;
163              numericField.Converter.SetFunc = s => s.ToString();
164              numericField.Converter.GetFunc = s => int.Parse(s);
165              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Value", 1));
166              numericField.Value.Should().Be(1);
167              numericField.Text.Should().Be("1");
168              comp.Find("input").Change("3");
169              numericField.Value.Should().Be(3);
170              numericField.Text.Should().Be("3");
171          }
172          [Test]
173          public async Task NumericField_Should_FireValueChangedOnTextParameterChange()
174          {
175              var changed_value = 4;
176              var comp = Context.RenderComponent<MudNumericField<int>>(EventCallback<int>("ValueChanged", x => changed_value = x));
177              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Text", "4"));
178              changed_value.Should().Be(4);
179          }
180          [Test]
181          public async Task NumericField_Should_FireTextChangedOnValueParameterChange()
182          {
183              var changed_text = "4";
184              var comp = Context.RenderComponent<MudNumericField<int>>(EventCallback<string>("TextChanged", x => changed_text = x));
<span onclick='openModal()' class='match'>185              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Value", 4));
186              changed_text.Should().Be("4");
</span>187          }
188          [Test]
189          public async Task NumericField_Should_FireTextAndValueChangedOnTextInput()
190          {
191              var changed_value = 4;
192              string changed_text = null;
193              var comp = Context.RenderComponent<MudNumericField<int>>(
194                  EventCallback<int>("ValueChanged", x => changed_value = x),
195                  EventCallback<string>("TextChanged", x => changed_text = x)
196              );
197              comp.Find("input").Change("4");
198              changed_value.Should().Be(4);
199              changed_text.Should().Be("4");
200          }
201          [Test]
202          public async Task NumericField_ShouldNot_ShowRequiredErrorWhenInitialTextIsEmpty()
203          {
204              var comp = Context.RenderComponent<NumericFieldRequiredTest>();
205              var numericField = comp.FindComponent<MudNumericField<int?>>().Instance;
206              numericField.Touched.Should().BeFalse();
207              numericField.ErrorText.Should().BeNullOrEmpty();
208              numericField.HasErrors.Should().Be(false);
209          }
210          [TestCaseSource(nameof(TypeCases))]
211          public async Task NumericField_OfAnyType_Should_Render<T>(T value)
212          {
213              Assert.DoesNotThrow(() => Context.RenderComponent<MudNumericField<T>>(), $"{typeof(MudNumericField<>)}<{typeof(T)}> render failed.");
214          }
215          [Test]
216          public async Task NumericFieldTest_KeyboardInput()
217          {
218              var comp = Context.RenderComponent<MudNumericField<double>>();
219              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
220              comp.SetParam(x => x.Format, "F2");
221              comp.SetParam(x => x.Value, 1234.56);
222              var numericField = comp.Instance;
223              numericField.Value.Should().Be(1234.56);
224              numericField.Text.Should().Be("1234.56");
225              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "ArrowUp", Type = "keydown", });
226              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "ArrowUp", Type = "keyup", });
227              comp.WaitForAssertion(() => numericField.Value.Should().Be(1235.56));
228              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "ArrowDown", Type = "keydown", });
229              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "ArrowDown", Type = "keyup", });
230              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
231              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "c", Type = "keydown", CtrlKey = false });
232              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "c", Type = "keyup", CtrlKey = false });
233              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
234              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "a", Type = "keydown", });
235              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "a", Type = "keyup", });
236              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
237              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "9", Type = "keydown", });
238              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "9", Type = "keyup", });
239              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
240          }
241          [Test]
242          public async Task NumericFieldTest_KeyboardInput_Disabled()
243          {
244              var comp = Context.RenderComponent<MudNumericField<double>>();
245              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
246              comp.SetParam(x => x.Format, "F2");
247              comp.SetParam(x => x.Value, 1234.56);
248              comp.SetParam(x => x.Disabled, true);
249              comp.Instance.Value.Should().Be(1234.56);
250              comp.Instance.Text.Should().Be("1234.56");
251              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "ArrowUp", Type = "keydown", });
252              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(1234.56));
253              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "9", Type = "keyup", });
254              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(1234.56));
255          }
256          [Test]
257          public async Task NumericFieldTest_KeyboardInput_Readonly()
258          {
259              var comp = Context.RenderComponent<MudNumericField<double>>();
260              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
261              comp.SetParam(x => x.Format, "F2");
262              comp.SetParam(x => x.Value, 1234.56);
263              comp.SetParam(x => x.ReadOnly, true);
264              comp.Instance.Value.Should().Be(1234.56);
265              comp.Instance.Text.Should().Be("1234.56");
266              comp.Find("input").KeyDown(new KeyboardEventArgs() { Key = "ArrowUp", Type = "keydown", });
267              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(1234.56));
268              comp.Find("input").KeyUp(new KeyboardEventArgs() { Key = "9", Type = "keyup", });
269              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(1234.56));
270          }
271          [Test]
272          public async Task NumericFieldTest_MouseWheel()
273          {
274              var comp = Context.RenderComponent<MudNumericField<double>>();
275              comp.SetParam(x => x.Value, 1234.56);
276              var numericField = comp.Instance;
277              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
278              comp.WaitForAssertion(() => numericField.Value.Should().Be(1235.56));
279              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
280              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
281              numericField.InvertMouseWheel = true;
282              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
283              comp.WaitForAssertion(() => numericField.Value.Should().Be(1233.56));
284              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
285              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
286              numericField.Step = 0.5;
287              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
288              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.06));
289              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
290              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
291              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = 77, ShiftKey = false });
292              comp.Find("input").MouseWheel(new WheelEventArgs() { DeltaY = -17, ShiftKey = false });
293              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
294          }
295          [Test]
296          public async Task NumericFieldTest_Wheel_Firefox()
297          {
298              var comp = Context.RenderComponent<MudNumericField<double>>();
299              comp.SetParam(x => x.Value, 1234.56);
300              var numericField = comp.Instance;
301              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
302              comp.WaitForAssertion(() => numericField.Value.Should().Be(1235.56));
303              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
304              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
305              numericField.InvertMouseWheel = true;
306              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
307              comp.WaitForAssertion(() => numericField.Value.Should().Be(1233.56));
308              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
309              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
310              numericField.Step = 0.5;
311              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = -1, ShiftKey = true });
312              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.06));
313              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = 1, ShiftKey = true });
314              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
315              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = 77, ShiftKey = false });
316              comp.Find("input").Wheel(new WheelEventArgs() { DeltaY = -17, ShiftKey = false });
317              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234.56));
318          }
319          [Test]
320          public async Task NumericFieldTestCultureFormat()
321          {
322              var comp = Context.RenderComponent<NumericFieldCultureTest>();
323              var inputs = comp.FindAll("input");
324              var immediate = inputs.First();
325              var notImmediate = inputs.Last();
326              notImmediate.Change("1234");
327              notImmediate.Blur();
328              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("1.234,00"));
329              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(1234.0));
330              notImmediate.Change("0");
331              notImmediate.Blur();
332              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("0,00"));
333              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(0.0));
334              notImmediate.Change("");
335              notImmediate.Blur();
336              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be(null));
337              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(null));
338              immediate.Input("1234");
339              immediate.Blur();
340              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("1,234.00"));
341              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(1234.0));
342              immediate.Input("0");
343              immediate.Blur();
344              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("0.00"));
345              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(0.0));
346              immediate.Input("");
347              immediate.Blur();
348              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be(null));
349              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(null));
350          }
351          [Test]
352          public async Task NumericField_should_RejectIllegalCharacters()
353          {
354              var comp = Context.RenderComponent<NumericFieldCultureTest>();
355              comp.FindAll("input").Last().Change("abcd");
356              comp.FindAll("input").Last().Blur();
357              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be(null));
358              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(null));
359              comp.FindAll("input").First().Input("abcd");
360              comp.FindAll("input").First().Blur();
361              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be(null));
362              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(null));
363              comp.FindAll("input").First().Input("-12-34abc.56");
364              comp.FindAll("input").First().Blur();
365              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be(null));
366              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(null));
367              comp.FindAll("input").First().Input("-1234.56");
368              comp.FindAll("input").First().Blur();
369              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("-1,234.56"));
370              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(-1234.56));
371              comp.FindAll("input").Last().Change("x+17,9y9z");
372              comp.FindAll("input").Last().Blur();
373              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be(null));
374              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(null));
375              comp.FindAll("input").Last().Change("17,99");
376              comp.FindAll("input").Last().Blur();
377              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("17,99"));
378              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(17.99));
379          }
380          [Test]
381          public async Task NumericField_should_ReformatTextOnBlur()
382          {
383              var comp = Context.RenderComponent<NumericFieldCultureTest>();
384              comp.FindAll("input").First().Input("1,234.56");
385              comp.FindAll("input").First().Blur();
386              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("1,234.56"));
387              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(1234.56));
388              comp.FindAll("input").First().Input("1234.56");
389              comp.FindAll("input").First().Blur();
390              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Text.Should().Be("1,234.56"));
391              comp.WaitForAssertion(() => comp.Instance.FieldImmediate.Value.Should().Be(1234.56));
392              comp.FindAll("input").Last().Change("7.000,99");
393              comp.FindAll("input").Last().Blur();
394              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("7.000,99"));
395              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(7000.99));
396              comp.FindAll("input").Last().Change("7000,99");
397              comp.FindAll("input").Last().Blur();
398              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Text.Should().Be("7.000,99"));
399              comp.WaitForAssertion(() => comp.Instance.FieldNotImmediate.Value.Should().Be(7000.99));
400          }
401          [TestCaseSource(nameof(TypeCases))]
402          public async Task NumericField_Validation<T>(T value)
403          {
404              var comp = Context.RenderComponent<MudNumericField<T>>();
405              comp.SetParam(x => x.Max, value);
406              comp.SetParam(x => x.Min, value);
407              comp.SetParam(x => x.Value, value);
408              var numericField = comp.Instance;
409              numericField.Value.Should().Be(value);
410              await comp.InvokeAsync(() =>
411              {
412                  numericField.Validate().Wait();
413              });
414              numericField.Value.Should().Be(value);
415          }
416          [TestCaseSource(nameof(TypeCases))]
417          public async Task NumericFieldMinMax<T>(T value)
418          {
419              var min = (T)Convert.ChangeType(1, typeof(T));
420              var max = (T)Convert.ChangeType(10, typeof(T));
421              var comp = Context.RenderComponent<MudNumericField<T>>();
422              comp.SetParam(x => x.Min, min);
423              comp.SetParam(x => x.Max, max);
424              comp.Find("input").Change("15");
425              comp.Find("input").Blur();
426              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(max));
427              comp.Find("input").Change("0");
428              comp.Find("input").Blur();
429              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(min));
430          }
431          [TestCaseSource(nameof(TypeCases))]
432          public async Task NumericFieldMinMaxNullable<T>(T value) where T : struct
433          {
434              var min = (T)Convert.ChangeType(1, typeof(T));
435              var max = (T)Convert.ChangeType(10, typeof(T));
436              var comp = Context.RenderComponent<MudNumericField<T?>>();
437              comp.SetParam(x => x.Min, min);
438              comp.SetParam(x => x.Max, max);
439              comp.Find("input").Change("15");
440              comp.Find("input").Blur();
441              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(max));
442              comp.Find("input").Change("0");
443              comp.Find("input").Blur();
444              comp.WaitForAssertion(() => comp.Instance.Value.Should().Be(min));
445          }
446          [TestCaseSource(nameof(TypeCases))]
447          public async Task NumericField_Increment_Decrement<T>(T value)
448          {
449              var comp = Context.RenderComponent<MudNumericField<T>>();
450              var max = Convert.ChangeType(10, typeof(T));
451              var min = Convert.ChangeType(0, typeof(T));
452              comp.SetParam(x => x.Max, max);
453              comp.SetParam(x => x.Min, min);
454              comp.SetParam(x => x.Step, value);
455              comp.SetParam(x => x.Value, value);
456              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
457              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
458              comp.Instance.Value.Should().Be(value);
459              comp.SetParam(x => x.Max, value);
460              comp.SetParam(x => x.Min, value);
461              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
462              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
463              comp.Instance.Value.Should().Be(value);
464          }
465          [TestCaseSource(nameof(TypeCases))]
466          public async Task NumericFieldNullable_Increment_Decrement<T>(T value) where T : struct
467          {
468              var comp = Context.RenderComponent<MudNumericField<T?>>();
469              var max = Convert.ChangeType(10, typeof(T));
470              var min = Convert.ChangeType(0, typeof(T));
471              comp.SetParam(x => x.Max, max);
472              comp.SetParam(x => x.Min, min);
473              comp.SetParam(x => x.Step, value);
474              comp.SetParam(x => x.Value, value);
475              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
476              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
477              comp.Instance.Value.Should().Be(value);
478              comp.SetParam(x => x.Max, value);
479              comp.SetParam(x => x.Min, value);
480              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
481              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
482              comp.Instance.Value.Should().Be(value);
483          }
484          [TestCaseSource(nameof(TypeCases))]
485          public async Task NumericField_Increment_Decrement_OverflowHandled<T>(T value)
486          {
487              var comp = Context.RenderComponent<MudNumericField<T>>();
488              comp.SetParam(x => x.Step, value);
489              comp.SetParam(x => x.Value, comp.Instance.Max);
490              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
491              comp.Instance.Value.Should().Be(comp.Instance.Max);
492              comp.SetParam(x => x.Value, comp.Instance.Min);
493              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
494              comp.Instance.Value.Should().Be(comp.Instance.Min);
495          }
496          [TestCaseSource(nameof(TypeCases))]
497          public async Task NumericFieldNullable_Increment_Decrement_OverflowHandled<T>(T value) where T : struct
498          {
499              var comp = Context.RenderComponent<MudNumericField<T?>>();
500              comp.SetParam(x => x.Step, value);
501              comp.SetParam(x => x.Value, comp.Instance.Max);
502              await comp.InvokeAsync(() => comp.Instance.Increment().Wait());
503              comp.Instance.Value.Should().Be(comp.Instance.Max);
504              comp.SetParam(x => x.Value, comp.Instance.Min);
505              await comp.InvokeAsync(() => comp.Instance.Decrement().Wait());
506              comp.Instance.Value.Should().Be(comp.Instance.Min);
507          }
508          [TestCase(10, 20, 15)]
509          [TestCase(-20, -10, -15)]
510          public async Task NumericFieldCanBeCleared(int min, int max, int value)
511          {
512              var comp = Context.RenderComponent<MudNumericField<int?>>();
513              comp.SetParam(x => x.Min, min);
514              comp.SetParam(x => x.Max, max);
515              comp.SetParam(x => x.Value, value);
516              comp.Find("input").Change("");
517              comp.Find("input").Blur();
518              comp.WaitForAssertion(() => comp.Instance.Value.Should().BeNull());
519          }
520          [Test]
521          public async Task NumericFieldWithCurrencyFormat()
522          {
523              var comp = Context.RenderComponent<MudNumericField<int?>>();
524              comp.SetParam(x => x.Format, "€0");
525              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
526              var numericField = comp.Instance;
527              numericField.Value.Should().Be(null);
528              numericField.Text.Should().Be(null);
529              77.ToString("€0", CultureInfo.InvariantCulture).Should().Be("€77");
530              var conv = new DefaultConverter<int?>();
531              conv.Format = "€0";
532              conv.Culture = CultureInfo.InvariantCulture;
533              conv.Set(77).Should().Be("€77");
534              comp.FindAll("input").First().Change("1234");
535              comp.FindAll("input").First().Blur();
536              comp.WaitForAssertion(() => numericField.Text.Should().Be("€1234"));
537              comp.WaitForAssertion(() => numericField.Value.Should().Be(1234));
538          }
539          [Test]
540          public async Task NumericFieldThousandsSeparator()
541          {
542              var comp = Context.RenderComponent<MudNumericField<int?>>();
543              var numericField = comp.Instance;
544              numericField.Value.Should().Be(null);
545              numericField.Text.Should().Be(null);
546              comp.SetParam(x => x.Culture, CultureInfo.InvariantCulture);
547              comp.FindAll("input").First().Change("1,000");
548              comp.FindAll("input").First().Blur();
549              comp.WaitForAssertion(() => numericField.Text.Should().Be("1000"));
550              comp.WaitForAssertion(() => numericField.Value.Should().Be(1000));
551              comp.SetParam(x => x.Culture, new CultureInfo("de-DE", false));
552              comp.FindAll("input").First().Change("1.000");
553              comp.FindAll("input").First().Blur();
554              comp.WaitForAssertion(() => numericField.Text.Should().Be("1000"));
555              comp.WaitForAssertion(() => numericField.Value.Should().Be(1000));
556          }
557      }
558  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-NumericFieldTests.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-NumericFieldTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>165              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Value", 1));
166              numericField.Value.Should().Be(1);
</pre></code></div>
                <div class="column column_space"><pre><code>185              comp.SetParametersAndRender(ComponentParameter.CreateParameter("Value", 4));
186              changed_text.Should().Be("4");
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    