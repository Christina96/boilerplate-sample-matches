
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 12, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColorPicker.razor.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Globalization;
4  using System.Threading.Tasks;
5  using Microsoft.AspNetCore.Components;
6  using Microsoft.AspNetCore.Components.Web;
7  using MudBlazor.Extensions;
8  using MudBlazor.Utilities;
9  namespace MudBlazor
10  {
11      public partial class MudColorPicker : MudPicker&lt;MudColor&gt;, IAsyncDisposable
12      {
13          public MudColorPicker() : base(new DefaultConverter&lt;MudColor&gt;())
14          {
15              AdornmentIcon = Icons.Material.Outlined.Palette;
16              DisableToolbar = true;
17              Value = &quot;#594ae2&quot;; 
18              Text = GetColorTextValue();
19              AdornmentAriaLabel = &quot;Open Color Picker&quot;;
20          }
21          #region Fields
22          private static Dictionary&lt;int, (Func&lt;int, int&gt; r, Func&lt;int, int&gt; g, Func&lt;int, int&gt; b, string dominantColorPart)&gt; _rgbToHueMapper = new()
23          {
24              { 0, ((x) =&gt; 255, x =&gt; x, x =&gt; 0, &quot;rb&quot;) },
25              { 1, ((x) =&gt; 255 - x, x =&gt; 255, x =&gt; 0, &quot;gb&quot;) },
26              { 2, ((x) =&gt; 0, x =&gt; 255, x =&gt; x, &quot;gr&quot;) },
27              { 3, ((x) =&gt; 0, x =&gt; 255 - x, x =&gt; 255, &quot;br&quot;) },
28              { 4, ((x) =&gt; x, x =&gt; 0, x =&gt; 255, &quot;bg&quot;) },
29              { 5, ((x) =&gt; 255, x =&gt; 0, x =&gt; 255 - x, &quot;rg&quot;) },
30          };
31          private const double _maxY = 250;
32          private const double _maxX = 312;
33          private const double _selctorSize = 26.0;
34          private double _selectorX;
35          private double _selectorY;
36          private bool _skipFeedback = false;
37          private MudColor _baseColor;
38          private bool _collectionOpen;
39          private readonly Guid _id = Guid.NewGuid();
40          private Guid _throttledMouseOverEventId;
41          private IEventListener _throttledEventManager;
42          [Inject] IEventListenerFactory ThrottledEventManagerFactory { get; set; }
43          #endregion
44          #region Parameters
45          [CascadingParameter(Name = &quot;RightToLeft&quot;)] public bool RightToLeft { get; set; }
46          private bool _disableAlpha = false;
47          [Parameter]
48          [Category(CategoryTypes.FormComponent.PickerBehavior)]
49          public bool DisableAlpha
50          {
51              get =&gt; _disableAlpha;
52              set
53              {
54                  if (value != _disableAlpha)
55                  {
56                      _disableAlpha = value;
57                      if (value == true)
58                      {
59                          Value = Value.SetAlpha(1.0);
60                      }
61                      Text = GetColorTextValue();
62                  }
63              }
64          }
65          [Parameter]
66          [Category(CategoryTypes.FormComponent.PickerBehavior)]
67          public bool DisableColorField { get; set; } = false;
68          [Parameter]
69          [Category(CategoryTypes.FormComponent.PickerBehavior)]
70          public bool DisableModeSwitch { get; set; } = false;
71          [Parameter]
72          [Category(CategoryTypes.FormComponent.PickerBehavior)]
73          public bool DisableInputs { get; set; } = false;
74          [Parameter]
75          [Category(CategoryTypes.FormComponent.PickerBehavior)]
76          public bool DisableSliders { get; set; } = false;
77          [Parameter]
78          [Category(CategoryTypes.FormComponent.PickerBehavior)]
79          public bool DisablePreview { get; set; } = false;
80          [Parameter]
81          [Category(CategoryTypes.FormComponent.PickerBehavior)]
82          public ColorPickerMode ColorPickerMode { get; set; } = ColorPickerMode.RGB;
83          private ColorPickerView _colorPickerView = ColorPickerView.Spectrum;
84          private ColorPickerView _activeColorPickerView = ColorPickerView.Spectrum;
85          [Parameter]
86          [Category(CategoryTypes.FormComponent.PickerBehavior)]
87          public ColorPickerView ColorPickerView
88          {
89              get =&gt; _colorPickerView;
90              set
91              {
92                  if (value != _colorPickerView)
93                  {
94                      _colorPickerView = value;
95                      ChangeView(value).AndForget();
96                  }
97              }
98          }
99          [Parameter]
100          [Category(CategoryTypes.FormComponent.Behavior)]
101          public bool UpdateBindingIfOnlyHSLChanged { get; set; } = false;
102          [Parameter]
103          [Category(CategoryTypes.FormComponent.Data)]
104          public MudColor Value
105          {
106              get =&gt; _value;
107              set =&gt; SetColorAsync(value).AndForget();
108          }
109          [Parameter] public EventCallback&lt;MudColor&gt; ValueChanged { get; set; }
110          [Parameter]
111          [Category(CategoryTypes.FormComponent.PickerBehavior)]
112          public IEnumerable&lt;MudColor&gt; Palette { get; set; } = new MudColor[]
113          { &quot;#424242&quot;, &quot;#2196f3&quot;, &quot;#00c853&quot;, &quot;#ff9800&quot;, &quot;#f44336&quot;,
114            &quot;#f6f9fb&quot;, &quot;#9df1fa&quot;, &quot;#bdffcf&quot;, &quot;#fff0a3&quot;, &quot;#ffd254&quot;,
115            &quot;#e6e9eb&quot;, &quot;#27dbf5&quot;, &quot;#7ef7a0&quot;, &quot;#ffe273&quot;, &quot;#ffb31f&quot;,
116            &quot;#c9cccf&quot;, &quot;#13b8e8&quot;, &quot;#14dc71&quot;, &quot;#fdd22f&quot;, &quot;#ff9102&quot;,
117            &quot;#858791&quot;, &quot;#0989c2&quot;, &quot;#1bbd66&quot;, &quot;#ebb323&quot;, &quot;#fe6800&quot;,
118            &quot;#585b62&quot;, &quot;#17698e&quot;, &quot;#17a258&quot;, &quot;#d9980d&quot;, &quot;#dc3f11&quot;,
119            &quot;#353940&quot;, &quot;#113b53&quot;, &quot;#127942&quot;, &quot;#bf7d11&quot;, &quot;#aa0000&quot;
120          };
121          private IEnumerable&lt;MudColor&gt; _gridList = new MudColor[]
122          {
123              &quot;#FFFFFF&quot;,&quot;#ebebeb&quot;,&quot;#d6d6d6&quot;,&quot;#c2c2c2&quot;,&quot;#adadad&quot;,&quot;#999999&quot;,&quot;#858586&quot;,&quot;#707070&quot;,&quot;#5c5c5c&quot;,&quot;#474747&quot;,&quot;#333333&quot;,&quot;#000000&quot;,
124              &quot;#133648&quot;,&quot;#071d53&quot;,&quot;#0f0638&quot;,&quot;#2a093b&quot;,&quot;#370c1b&quot;,&quot;#541107&quot;,&quot;#532009&quot;,&quot;#53350d&quot;,&quot;#523e0f&quot;,&quot;#65611b&quot;,&quot;#505518&quot;,&quot;#2b3d16&quot;,
125              &quot;#1e4c63&quot;,&quot;#0f2e76&quot;,&quot;#180b4e&quot;,&quot;#3f1256&quot;,&quot;#4e1629&quot;,&quot;#781e0e&quot;,&quot;#722f10&quot;,&quot;#734c16&quot;,&quot;#73591a&quot;,&quot;#8c8629&quot;,&quot;#707625&quot;,&quot;#3f5623&quot;,
126              &quot;#2e6c8c&quot;,&quot;#1841a3&quot;,&quot;#280c72&quot;,&quot;#591e77&quot;,&quot;#6f223d&quot;,&quot;#a62c17&quot;,&quot;#a0451a&quot;,&quot;#a06b23&quot;,&quot;#9f7d28&quot;,&quot;#c3bc3c&quot;,&quot;#9da436&quot;,&quot;#587934&quot;,
127              &quot;#3c8ab0&quot;,&quot;#2155ce&quot;,&quot;#331c8e&quot;,&quot;#702898&quot;,&quot;#8d2e4f&quot;,&quot;#d03a20&quot;,&quot;#ca5a24&quot;,&quot;#c8862e&quot;,&quot;#c99f35&quot;,&quot;#f3ec4e&quot;,&quot;#c6d047&quot;,&quot;#729b44&quot;,
128              &quot;#479fd3&quot;,&quot;#2660f5&quot;,&quot;#4725ab&quot;,&quot;#8c33b5&quot;,&quot;#aa395d&quot;,&quot;#eb512e&quot;,&quot;#ed732e&quot;,&quot;#f3ae3d&quot;,&quot;#f5c944&quot;,&quot;#fefb67&quot;,&quot;#ddeb5c&quot;,&quot;#86b953&quot;,
129              &quot;#59c4f7&quot;,&quot;#4e85f6&quot;,&quot;#5733e2&quot;,&quot;#af43eb&quot;,&quot;#d44a7a&quot;,&quot;#ed6c59&quot;,&quot;#ef8c56&quot;,&quot;#f3b757&quot;,&quot;#f6cd5b&quot;,&quot;#fef881&quot;,&quot;#e6ee7a&quot;,&quot;#a3d16e&quot;,
130              &quot;#78d3f8&quot;,&quot;#7fa6f8&quot;,&quot;#7e52f5&quot;,&quot;#c45ff6&quot;,&quot;#de789d&quot;,&quot;#f09286&quot;,&quot;#f2a984&quot;,&quot;#f6c983&quot;,&quot;#f9da85&quot;,&quot;#fef9a1&quot;,&quot;#ebf29b&quot;,&quot;#badc94&quot;,
131              &quot;#a5e1fa&quot;,&quot;#adc5fa&quot;,&quot;#ab8df7&quot;,&quot;#d696f8&quot;,&quot;#e8a7bf&quot;,&quot;#f4b8b1&quot;,&quot;#f6c7af&quot;,&quot;#f9daae&quot;,&quot;#fae5af&quot;,&quot;#fefbc0&quot;,&quot;#f3f7be&quot;,&quot;#d2e7ba&quot;,
132              &quot;#d2effd&quot;,&quot;#d6e1fc&quot;,&quot;#d6c9fa&quot;,&quot;#e9cbfb&quot;,&quot;#f3d4df&quot;,&quot;#f9dcd9&quot;,&quot;#fae3d8&quot;,&quot;#fcecd7&quot;,&quot;#fdf2d8&quot;,&quot;#fefce0&quot;,&quot;#f7fade&quot;,&quot;#e3edd6&quot;
133          };
134          [Parameter]
135          [Category(CategoryTypes.FormComponent.PickerBehavior)]
136          public bool DisableDragEffect { get; set; } = false;
137          [Parameter]
138          [Category(CategoryTypes.FormComponent.PickerAppearance)]
139          public string CloseIcon { get; set; } = Icons.Material.Filled.Close;
140          [Parameter]
141          [Category(CategoryTypes.FormComponent.PickerAppearance)]
142          public string SpectrumIcon { get; set; } = Icons.Material.Filled.Tune;
143          [Parameter]
144          [Category(CategoryTypes.FormComponent.PickerAppearance)]
145          public string GridIcon { get; set; } = Icons.Material.Filled.Apps;
146          [Parameter]
147          [Category(CategoryTypes.FormComponent.PickerAppearance)]
148          public string PaletteIcon { get; set; } = Icons.Material.Filled.Palette;
149          [Parameter]
150          [Category(CategoryTypes.FormComponent.PickerAppearance)]
151          public string ImportExportIcon { get; set; } = Icons.Material.Filled.ImportExport;
152          #endregion
153          private void ToggleCollection()
154          {
155              _collectionOpen = !_collectionOpen;
156          }
157          private void SelectPaletteColor(MudColor color)
158          {
159              Value = color;
160              _collectionOpen = false;
161              if (
162                  IsAnyControlVisible() == false || _activeColorPickerView is ColorPickerView.GridCompact or ColorPickerView.Palette)
163              {
164                  Close();
165              }
166          }
167          public void ChangeMode() =&gt;
168              ColorPickerMode = ColorPickerMode switch
169              {
170                  ColorPickerMode.RGB =&gt; ColorPickerMode.HSL,
171                  ColorPickerMode.HSL =&gt; ColorPickerMode.HEX,
172                  ColorPickerMode.HEX =&gt; ColorPickerMode.RGB,
173                  _ =&gt; ColorPickerMode.RGB,
174              };
175          public async Task ChangeView(ColorPickerView value)
176          {
177              var oldValue = _activeColorPickerView;
178              _activeColorPickerView = value;
179              Text = GetColorTextValue();
180              if (oldValue == ColorPickerView.Spectrum)
181              {
182                  await RemoveMouseOverEvent();
183              }
184              if (value == ColorPickerView.Spectrum)
185              {
186                  _attachedMouseEvent = true;
187              }
188          }
189          private async Task SetColorAsync(MudColor value)
190          {
191              if (value == null) { return; }
192              var rgbChanged = value != _value;
193              var hslChanged = _value != null &amp;&amp; value.HslChanged(_value);
194              var shouldUpdateBinding = _value != null 
195                                        &amp;&amp; (rgbChanged || (UpdateBindingIfOnlyHSLChanged &amp;&amp; hslChanged));
196              _value = value;
197              if (rgbChanged &amp;&amp; _skipFeedback == false)
198              {
199                  UpdateBaseColor();
200                  UpdateColorSelectorBasedOnRgb();
201              }
202              if (shouldUpdateBinding)
203              {
204                  Touched = true;
205                  await SetTextAsync(GetColorTextValue(), false);
206                  await ValueChanged.InvokeAsync(value);
207                  await BeginValidateAsync();
208                  FieldChanged(value);
209              }
210          }
211          private void UpdateBaseColorSlider(int value)
212          {
213              var diff = Math.Abs(value - (int)Value.H);
214              if (diff == 0) { return; }
215              Value = Value.SetH(value);
216          }
217          private void UpdateBaseColor()
218          {
219              var index = (int)_value.H / 60;
220              if (index == 6)
221              {
222                  index = 5;
223              }
224              var valueInDeg = (int)_value.H - (index * 60);
225              var value = (int)(MathExtensions.Map(0, 60, 0, 255, valueInDeg));
226              var section = _rgbToHueMapper[index];
227              _baseColor = new(section.r(value), section.g(value), section.b(value), 255);
228          }
229          private void UpdateColorBaseOnSelection()
230          {
231              var x = _selectorX / _maxX;
232              var r_x = 255 - (int)((255 - _baseColor.R) * x);
233              var g_x = 255 - (int)((255 - _baseColor.G) * x);
234              var b_x = 255 - (int)((255 - _baseColor.B) * x);
235              var y = 1.0 - _selectorY / _maxY;
236              var r = r_x * y;
237              var g = g_x * y;
238              var b = b_x * y;
239              _skipFeedback = true;
240              Value = new MudColor((byte)r, (byte)g, (byte)b, _value);
241              _skipFeedback = false;
242          }
243          private void UpdateColorSelectorBasedOnRgb()
244          {
245              var hueValue = (int)MathExtensions.Map(0, 360, 0, 6 * 255, _value.H);
246              var index = hueValue / 255;
<span onclick='openModal()' class='match'>247              if (index == 6)
248              {
249                  index = 5;
250              }
251              var section = _rgbToHueMapper[index];
</span>252              var colorValues = section.dominantColorPart switch
253              {
254                  &quot;rb&quot; =&gt; (_value.R, _value.B),
255                  &quot;rg&quot; =&gt; (_value.R, _value.G),
256                  &quot;gb&quot; =&gt; (_value.G, _value.B),
257                  &quot;gr&quot; =&gt; (_value.G, _value.R),
258                  &quot;br&quot; =&gt; (_value.B, _value.R),
259                  &quot;bg&quot; =&gt; (_value.B, _value.G),
260                  _ =&gt; (255, 255)
261              };
262              var primaryDiff = 255 - colorValues.Item1;
263              var primaryDiffDelta = colorValues.Item1 / 255.0;
264              _selectorY = MathExtensions.Map(0, 255, 0, _maxY, primaryDiff);
265              var secondaryColorX = colorValues.Item2 * (1.0 / primaryDiffDelta);
266              var relation = (255 - secondaryColorX) / 255.0;
267              _selectorX = relation * _maxX;
268          }
269          #region mouse interactions
270          private void HandleColorOverlayClicked()
271          {
272              UpdateColorBaseOnSelection();
273              if (IsAnyControlVisible() == false)
274              {
275                  Close();
276              }
277          }
278          private void OnSelectorClicked(MouseEventArgs e)
279          {
280              SetSelectorBasedOnMouseEvents(e, false);
281              HandleColorOverlayClicked();
282          }
283          private void OnColorOverlayClick(MouseEventArgs e)
284          {
285              SetSelectorBasedOnMouseEvents(e, true);
286              HandleColorOverlayClicked();
287          }
288          private void OnMouseOver(MouseEventArgs e)
289          {
290              if (e.Buttons == 1)
291              {
292                  SetSelectorBasedOnMouseEvents(e, true);
293                  UpdateColorBaseOnSelection();
294              }
295          }
296          private void SetSelectorBasedOnMouseEvents(MouseEventArgs e, bool offsetIsAbsolute)
297          {
298              _selectorX = (offsetIsAbsolute == true ? e.OffsetX : (e.OffsetX - _selctorSize / 2.0) + _selectorX).EnsureRange(_maxX);
299              _selectorY = (offsetIsAbsolute == true ? e.OffsetY : (e.OffsetY - _selctorSize / 2.0) + _selectorY).EnsureRange(_maxY);
300          }
301          #endregion
302          #region updating inputs
303          public void SetR(int value) =&gt; Value = Value.SetR(value);
304          public void SetG(int value) =&gt; Value = Value.SetG(value);
305          public void SetB(int value) =&gt; Value = Value.SetB(value);
306          public void SetH(double value) =&gt; Value = Value.SetH(value);
307          public void SetS(double value) =&gt; Value = Value.SetS(value);
308          public void SetL(double value) =&gt; Value = Value.SetL(value);
309          public void SetAlpha(double value) =&gt; Value = Value.SetAlpha(value);
310          public void SetAlpha(int value) =&gt; Value = Value.SetAlpha(value);
311          public void SetInputString(string input)
312          {
313              MudColor color;
314              try
315              {
316                  color = new MudColor(input);
317              }
318              catch (Exception)
319              {
320                  return;
321              }
322              Value = color;
323          }
324          protected override Task StringValueChanged(string value)
325          {
326              SetInputString(value);
327              return Task.CompletedTask;
328          }
329          private bool _attachedMouseEvent = false;
330          protected override void OnPickerOpened()
331          {
332              base.OnPickerOpened();
333              _attachedMouseEvent = true;
334              StateHasChanged();
335          }
336          protected override void OnPickerClosed()
337          {
338              base.OnPickerClosed();
339              RemoveMouseOverEvent().AndForget();
340          }
341          #endregion
342          #region helper
343          private string GetSelectorLocation() =&gt; $&quot;translate({Math.Round(_selectorX, 2).ToString(CultureInfo.InvariantCulture)}px, {Math.Round(_selectorY, 2).ToString(CultureInfo.InvariantCulture)}px);&quot;;
344          private string GetColorTextValue() =&gt; (DisableAlpha == true || _activeColorPickerView is ColorPickerView.Palette or ColorPickerView.GridCompact) ? _value.ToString(MudColorOutputFormats.Hex) : _value.ToString(MudColorOutputFormats.HexA);
345          private int GetHexColorInputMaxLength() =&gt; DisableAlpha ? 7 : 9;
346          private EventCallback&lt;MouseEventArgs&gt; GetEventCallback() =&gt; EventCallback.Factory.Create&lt;MouseEventArgs&gt;(this, () =&gt; Close());
347          private bool IsAnyControlVisible() =&gt; !(DisablePreview &amp;&amp; DisableSliders &amp;&amp; DisableInputs);
348          private EventCallback&lt;MouseEventArgs&gt; GetSelectPaletteColorCallback(MudColor color) =&gt; new EventCallbackFactory().Create(this, (MouseEventArgs e) =&gt; SelectPaletteColor(color));
349          private Color GetButtonColor(ColorPickerView view) =&gt; _activeColorPickerView == view ? Color.Primary : Color.Inherit;
350          private string GetColorDotClass(MudColor color) =&gt; new CssBuilder(&quot;mud-picker-color-dot&quot;).AddClass(&quot;selected&quot;, color == Value).ToString();
351          private string AlphaSliderStyle =&gt; new StyleBuilder().AddStyle($&quot;background-image: linear-gradient(to {(RightToLeft ? &quot;left&quot; : &quot;right&quot;)}, transparent, {_value.ToString(MudColorOutputFormats.RGB)})&quot;).Build();
352          #endregion
353          #region life cycle hooks
354          protected override async Task OnAfterRenderAsync(bool firstRender)
355          {
356              await base.OnAfterRenderAsync(firstRender);
357              if (firstRender == true)
358              {
359                  if (PickerVariant == PickerVariant.Static)
360                  {
361                      await AddMouseOverEvent();
362                  }
363              }
364              if (_attachedMouseEvent == true)
365              {
366                  _attachedMouseEvent = false;
367                  await AddMouseOverEvent();
368              }
369          }
370          private async Task AddMouseOverEvent()
371          {
372              if (DisableDragEffect == true) { return; }
373              if (_throttledEventManager == null)
374              {
375                  _throttledEventManager = ThrottledEventManagerFactory.Create();
376              }
377              _throttledMouseOverEventId = await
378                  _throttledEventManager.Subscribe&lt;MouseEventArgs&gt;(&quot;mousemove&quot;, _id.ToString(), &quot;mudEventProjections.correctOffset&quot;, 10, async (x) =&gt;
379                  {
380                      var e = x as MouseEventArgs;
381                      await InvokeAsync(() =&gt; OnMouseOver(e));
382                      StateHasChanged();
383                  });
384          }
385          private Task RemoveMouseOverEvent()
386          {
387              if (_throttledMouseOverEventId == default) { return Task.CompletedTask; }
388              return _throttledEventManager.Unsubscribe(_throttledMouseOverEventId);
389          }
390          public async ValueTask DisposeAsync()
391          {
392              if (_throttledEventManager == null) { return; }
393              await _throttledEventManager.DisposeAsync();
394          }
395          #endregion
396      }
397  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColorPicker.razor.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Globalization;
4  using System.Threading.Tasks;
5  using Microsoft.AspNetCore.Components;
6  using Microsoft.AspNetCore.Components.Web;
7  using MudBlazor.Extensions;
8  using MudBlazor.Utilities;
9  namespace MudBlazor
10  {
11      public partial class MudColorPicker : MudPicker&lt;MudColor&gt;, IAsyncDisposable
12      {
13          public MudColorPicker() : base(new DefaultConverter&lt;MudColor&gt;())
14          {
15              AdornmentIcon = Icons.Material.Outlined.Palette;
16              DisableToolbar = true;
17              Value = &quot;#594ae2&quot;; 
18              Text = GetColorTextValue();
19              AdornmentAriaLabel = &quot;Open Color Picker&quot;;
20          }
21          #region Fields
22          private static Dictionary&lt;int, (Func&lt;int, int&gt; r, Func&lt;int, int&gt; g, Func&lt;int, int&gt; b, string dominantColorPart)&gt; _rgbToHueMapper = new()
23          {
24              { 0, ((x) =&gt; 255, x =&gt; x, x =&gt; 0, &quot;rb&quot;) },
25              { 1, ((x) =&gt; 255 - x, x =&gt; 255, x =&gt; 0, &quot;gb&quot;) },
26              { 2, ((x) =&gt; 0, x =&gt; 255, x =&gt; x, &quot;gr&quot;) },
27              { 3, ((x) =&gt; 0, x =&gt; 255 - x, x =&gt; 255, &quot;br&quot;) },
28              { 4, ((x) =&gt; x, x =&gt; 0, x =&gt; 255, &quot;bg&quot;) },
29              { 5, ((x) =&gt; 255, x =&gt; 0, x =&gt; 255 - x, &quot;rg&quot;) },
30          };
31          private const double _maxY = 250;
32          private const double _maxX = 312;
33          private const double _selctorSize = 26.0;
34          private double _selectorX;
35          private double _selectorY;
36          private bool _skipFeedback = false;
37          private MudColor _baseColor;
38          private bool _collectionOpen;
39          private readonly Guid _id = Guid.NewGuid();
40          private Guid _throttledMouseOverEventId;
41          private IEventListener _throttledEventManager;
42          [Inject] IEventListenerFactory ThrottledEventManagerFactory { get; set; }
43          #endregion
44          #region Parameters
45          [CascadingParameter(Name = &quot;RightToLeft&quot;)] public bool RightToLeft { get; set; }
46          private bool _disableAlpha = false;
47          [Parameter]
48          [Category(CategoryTypes.FormComponent.PickerBehavior)]
49          public bool DisableAlpha
50          {
51              get =&gt; _disableAlpha;
52              set
53              {
54                  if (value != _disableAlpha)
55                  {
56                      _disableAlpha = value;
57                      if (value == true)
58                      {
59                          Value = Value.SetAlpha(1.0);
60                      }
61                      Text = GetColorTextValue();
62                  }
63              }
64          }
65          [Parameter]
66          [Category(CategoryTypes.FormComponent.PickerBehavior)]
67          public bool DisableColorField { get; set; } = false;
68          [Parameter]
69          [Category(CategoryTypes.FormComponent.PickerBehavior)]
70          public bool DisableModeSwitch { get; set; } = false;
71          [Parameter]
72          [Category(CategoryTypes.FormComponent.PickerBehavior)]
73          public bool DisableInputs { get; set; } = false;
74          [Parameter]
75          [Category(CategoryTypes.FormComponent.PickerBehavior)]
76          public bool DisableSliders { get; set; } = false;
77          [Parameter]
78          [Category(CategoryTypes.FormComponent.PickerBehavior)]
79          public bool DisablePreview { get; set; } = false;
80          [Parameter]
81          [Category(CategoryTypes.FormComponent.PickerBehavior)]
82          public ColorPickerMode ColorPickerMode { get; set; } = ColorPickerMode.RGB;
83          private ColorPickerView _colorPickerView = ColorPickerView.Spectrum;
84          private ColorPickerView _activeColorPickerView = ColorPickerView.Spectrum;
85          [Parameter]
86          [Category(CategoryTypes.FormComponent.PickerBehavior)]
87          public ColorPickerView ColorPickerView
88          {
89              get =&gt; _colorPickerView;
90              set
91              {
92                  if (value != _colorPickerView)
93                  {
94                      _colorPickerView = value;
95                      ChangeView(value).AndForget();
96                  }
97              }
98          }
99          [Parameter]
100          [Category(CategoryTypes.FormComponent.Behavior)]
101          public bool UpdateBindingIfOnlyHSLChanged { get; set; } = false;
102          [Parameter]
103          [Category(CategoryTypes.FormComponent.Data)]
104          public MudColor Value
105          {
106              get =&gt; _value;
107              set =&gt; SetColorAsync(value).AndForget();
108          }
109          [Parameter] public EventCallback&lt;MudColor&gt; ValueChanged { get; set; }
110          [Parameter]
111          [Category(CategoryTypes.FormComponent.PickerBehavior)]
112          public IEnumerable&lt;MudColor&gt; Palette { get; set; } = new MudColor[]
113          { &quot;#424242&quot;, &quot;#2196f3&quot;, &quot;#00c853&quot;, &quot;#ff9800&quot;, &quot;#f44336&quot;,
114            &quot;#f6f9fb&quot;, &quot;#9df1fa&quot;, &quot;#bdffcf&quot;, &quot;#fff0a3&quot;, &quot;#ffd254&quot;,
115            &quot;#e6e9eb&quot;, &quot;#27dbf5&quot;, &quot;#7ef7a0&quot;, &quot;#ffe273&quot;, &quot;#ffb31f&quot;,
116            &quot;#c9cccf&quot;, &quot;#13b8e8&quot;, &quot;#14dc71&quot;, &quot;#fdd22f&quot;, &quot;#ff9102&quot;,
117            &quot;#858791&quot;, &quot;#0989c2&quot;, &quot;#1bbd66&quot;, &quot;#ebb323&quot;, &quot;#fe6800&quot;,
118            &quot;#585b62&quot;, &quot;#17698e&quot;, &quot;#17a258&quot;, &quot;#d9980d&quot;, &quot;#dc3f11&quot;,
119            &quot;#353940&quot;, &quot;#113b53&quot;, &quot;#127942&quot;, &quot;#bf7d11&quot;, &quot;#aa0000&quot;
120          };
121          private IEnumerable&lt;MudColor&gt; _gridList = new MudColor[]
122          {
123              &quot;#FFFFFF&quot;,&quot;#ebebeb&quot;,&quot;#d6d6d6&quot;,&quot;#c2c2c2&quot;,&quot;#adadad&quot;,&quot;#999999&quot;,&quot;#858586&quot;,&quot;#707070&quot;,&quot;#5c5c5c&quot;,&quot;#474747&quot;,&quot;#333333&quot;,&quot;#000000&quot;,
124              &quot;#133648&quot;,&quot;#071d53&quot;,&quot;#0f0638&quot;,&quot;#2a093b&quot;,&quot;#370c1b&quot;,&quot;#541107&quot;,&quot;#532009&quot;,&quot;#53350d&quot;,&quot;#523e0f&quot;,&quot;#65611b&quot;,&quot;#505518&quot;,&quot;#2b3d16&quot;,
125              &quot;#1e4c63&quot;,&quot;#0f2e76&quot;,&quot;#180b4e&quot;,&quot;#3f1256&quot;,&quot;#4e1629&quot;,&quot;#781e0e&quot;,&quot;#722f10&quot;,&quot;#734c16&quot;,&quot;#73591a&quot;,&quot;#8c8629&quot;,&quot;#707625&quot;,&quot;#3f5623&quot;,
126              &quot;#2e6c8c&quot;,&quot;#1841a3&quot;,&quot;#280c72&quot;,&quot;#591e77&quot;,&quot;#6f223d&quot;,&quot;#a62c17&quot;,&quot;#a0451a&quot;,&quot;#a06b23&quot;,&quot;#9f7d28&quot;,&quot;#c3bc3c&quot;,&quot;#9da436&quot;,&quot;#587934&quot;,
127              &quot;#3c8ab0&quot;,&quot;#2155ce&quot;,&quot;#331c8e&quot;,&quot;#702898&quot;,&quot;#8d2e4f&quot;,&quot;#d03a20&quot;,&quot;#ca5a24&quot;,&quot;#c8862e&quot;,&quot;#c99f35&quot;,&quot;#f3ec4e&quot;,&quot;#c6d047&quot;,&quot;#729b44&quot;,
128              &quot;#479fd3&quot;,&quot;#2660f5&quot;,&quot;#4725ab&quot;,&quot;#8c33b5&quot;,&quot;#aa395d&quot;,&quot;#eb512e&quot;,&quot;#ed732e&quot;,&quot;#f3ae3d&quot;,&quot;#f5c944&quot;,&quot;#fefb67&quot;,&quot;#ddeb5c&quot;,&quot;#86b953&quot;,
129              &quot;#59c4f7&quot;,&quot;#4e85f6&quot;,&quot;#5733e2&quot;,&quot;#af43eb&quot;,&quot;#d44a7a&quot;,&quot;#ed6c59&quot;,&quot;#ef8c56&quot;,&quot;#f3b757&quot;,&quot;#f6cd5b&quot;,&quot;#fef881&quot;,&quot;#e6ee7a&quot;,&quot;#a3d16e&quot;,
130              &quot;#78d3f8&quot;,&quot;#7fa6f8&quot;,&quot;#7e52f5&quot;,&quot;#c45ff6&quot;,&quot;#de789d&quot;,&quot;#f09286&quot;,&quot;#f2a984&quot;,&quot;#f6c983&quot;,&quot;#f9da85&quot;,&quot;#fef9a1&quot;,&quot;#ebf29b&quot;,&quot;#badc94&quot;,
131              &quot;#a5e1fa&quot;,&quot;#adc5fa&quot;,&quot;#ab8df7&quot;,&quot;#d696f8&quot;,&quot;#e8a7bf&quot;,&quot;#f4b8b1&quot;,&quot;#f6c7af&quot;,&quot;#f9daae&quot;,&quot;#fae5af&quot;,&quot;#fefbc0&quot;,&quot;#f3f7be&quot;,&quot;#d2e7ba&quot;,
132              &quot;#d2effd&quot;,&quot;#d6e1fc&quot;,&quot;#d6c9fa&quot;,&quot;#e9cbfb&quot;,&quot;#f3d4df&quot;,&quot;#f9dcd9&quot;,&quot;#fae3d8&quot;,&quot;#fcecd7&quot;,&quot;#fdf2d8&quot;,&quot;#fefce0&quot;,&quot;#f7fade&quot;,&quot;#e3edd6&quot;
133          };
134          [Parameter]
135          [Category(CategoryTypes.FormComponent.PickerBehavior)]
136          public bool DisableDragEffect { get; set; } = false;
137          [Parameter]
138          [Category(CategoryTypes.FormComponent.PickerAppearance)]
139          public string CloseIcon { get; set; } = Icons.Material.Filled.Close;
140          [Parameter]
141          [Category(CategoryTypes.FormComponent.PickerAppearance)]
142          public string SpectrumIcon { get; set; } = Icons.Material.Filled.Tune;
143          [Parameter]
144          [Category(CategoryTypes.FormComponent.PickerAppearance)]
145          public string GridIcon { get; set; } = Icons.Material.Filled.Apps;
146          [Parameter]
147          [Category(CategoryTypes.FormComponent.PickerAppearance)]
148          public string PaletteIcon { get; set; } = Icons.Material.Filled.Palette;
149          [Parameter]
150          [Category(CategoryTypes.FormComponent.PickerAppearance)]
151          public string ImportExportIcon { get; set; } = Icons.Material.Filled.ImportExport;
152          #endregion
153          private void ToggleCollection()
154          {
155              _collectionOpen = !_collectionOpen;
156          }
157          private void SelectPaletteColor(MudColor color)
158          {
159              Value = color;
160              _collectionOpen = false;
161              if (
162                  IsAnyControlVisible() == false || _activeColorPickerView is ColorPickerView.GridCompact or ColorPickerView.Palette)
163              {
164                  Close();
165              }
166          }
167          public void ChangeMode() =&gt;
168              ColorPickerMode = ColorPickerMode switch
169              {
170                  ColorPickerMode.RGB =&gt; ColorPickerMode.HSL,
171                  ColorPickerMode.HSL =&gt; ColorPickerMode.HEX,
172                  ColorPickerMode.HEX =&gt; ColorPickerMode.RGB,
173                  _ =&gt; ColorPickerMode.RGB,
174              };
175          public async Task ChangeView(ColorPickerView value)
176          {
177              var oldValue = _activeColorPickerView;
178              _activeColorPickerView = value;
179              Text = GetColorTextValue();
180              if (oldValue == ColorPickerView.Spectrum)
181              {
182                  await RemoveMouseOverEvent();
183              }
184              if (value == ColorPickerView.Spectrum)
185              {
186                  _attachedMouseEvent = true;
187              }
188          }
189          private async Task SetColorAsync(MudColor value)
190          {
191              if (value == null) { return; }
192              var rgbChanged = value != _value;
193              var hslChanged = _value != null &amp;&amp; value.HslChanged(_value);
194              var shouldUpdateBinding = _value != null 
195                                        &amp;&amp; (rgbChanged || (UpdateBindingIfOnlyHSLChanged &amp;&amp; hslChanged));
196              _value = value;
197              if (rgbChanged &amp;&amp; _skipFeedback == false)
198              {
199                  UpdateBaseColor();
200                  UpdateColorSelectorBasedOnRgb();
201              }
202              if (shouldUpdateBinding)
203              {
204                  Touched = true;
205                  await SetTextAsync(GetColorTextValue(), false);
206                  await ValueChanged.InvokeAsync(value);
207                  await BeginValidateAsync();
208                  FieldChanged(value);
209              }
210          }
211          private void UpdateBaseColorSlider(int value)
212          {
213              var diff = Math.Abs(value - (int)Value.H);
214              if (diff == 0) { return; }
215              Value = Value.SetH(value);
216          }
217          private void UpdateBaseColor()
218          {
219              var index = (int)_value.H / 60;
<span onclick='openModal()' class='match'>220              if (index == 6)
221              {
222                  index = 5;
223              }
224              var valueInDeg = (int)_value.H - (index * 60);
</span>225              var value = (int)(MathExtensions.Map(0, 60, 0, 255, valueInDeg));
226              var section = _rgbToHueMapper[index];
227              _baseColor = new(section.r(value), section.g(value), section.b(value), 255);
228          }
229          private void UpdateColorBaseOnSelection()
230          {
231              var x = _selectorX / _maxX;
232              var r_x = 255 - (int)((255 - _baseColor.R) * x);
233              var g_x = 255 - (int)((255 - _baseColor.G) * x);
234              var b_x = 255 - (int)((255 - _baseColor.B) * x);
235              var y = 1.0 - _selectorY / _maxY;
236              var r = r_x * y;
237              var g = g_x * y;
238              var b = b_x * y;
239              _skipFeedback = true;
240              Value = new MudColor((byte)r, (byte)g, (byte)b, _value);
241              _skipFeedback = false;
242          }
243          private void UpdateColorSelectorBasedOnRgb()
244          {
245              var hueValue = (int)MathExtensions.Map(0, 360, 0, 6 * 255, _value.H);
246              var index = hueValue / 255;
247              if (index == 6)
248              {
249                  index = 5;
250              }
251              var section = _rgbToHueMapper[index];
252              var colorValues = section.dominantColorPart switch
253              {
254                  &quot;rb&quot; =&gt; (_value.R, _value.B),
255                  &quot;rg&quot; =&gt; (_value.R, _value.G),
256                  &quot;gb&quot; =&gt; (_value.G, _value.B),
257                  &quot;gr&quot; =&gt; (_value.G, _value.R),
258                  &quot;br&quot; =&gt; (_value.B, _value.R),
259                  &quot;bg&quot; =&gt; (_value.B, _value.G),
260                  _ =&gt; (255, 255)
261              };
262              var primaryDiff = 255 - colorValues.Item1;
263              var primaryDiffDelta = colorValues.Item1 / 255.0;
264              _selectorY = MathExtensions.Map(0, 255, 0, _maxY, primaryDiff);
265              var secondaryColorX = colorValues.Item2 * (1.0 / primaryDiffDelta);
266              var relation = (255 - secondaryColorX) / 255.0;
267              _selectorX = relation * _maxX;
268          }
269          #region mouse interactions
270          private void HandleColorOverlayClicked()
271          {
272              UpdateColorBaseOnSelection();
273              if (IsAnyControlVisible() == false)
274              {
275                  Close();
276              }
277          }
278          private void OnSelectorClicked(MouseEventArgs e)
279          {
280              SetSelectorBasedOnMouseEvents(e, false);
281              HandleColorOverlayClicked();
282          }
283          private void OnColorOverlayClick(MouseEventArgs e)
284          {
285              SetSelectorBasedOnMouseEvents(e, true);
286              HandleColorOverlayClicked();
287          }
288          private void OnMouseOver(MouseEventArgs e)
289          {
290              if (e.Buttons == 1)
291              {
292                  SetSelectorBasedOnMouseEvents(e, true);
293                  UpdateColorBaseOnSelection();
294              }
295          }
296          private void SetSelectorBasedOnMouseEvents(MouseEventArgs e, bool offsetIsAbsolute)
297          {
298              _selectorX = (offsetIsAbsolute == true ? e.OffsetX : (e.OffsetX - _selctorSize / 2.0) + _selectorX).EnsureRange(_maxX);
299              _selectorY = (offsetIsAbsolute == true ? e.OffsetY : (e.OffsetY - _selctorSize / 2.0) + _selectorY).EnsureRange(_maxY);
300          }
301          #endregion
302          #region updating inputs
303          public void SetR(int value) =&gt; Value = Value.SetR(value);
304          public void SetG(int value) =&gt; Value = Value.SetG(value);
305          public void SetB(int value) =&gt; Value = Value.SetB(value);
306          public void SetH(double value) =&gt; Value = Value.SetH(value);
307          public void SetS(double value) =&gt; Value = Value.SetS(value);
308          public void SetL(double value) =&gt; Value = Value.SetL(value);
309          public void SetAlpha(double value) =&gt; Value = Value.SetAlpha(value);
310          public void SetAlpha(int value) =&gt; Value = Value.SetAlpha(value);
311          public void SetInputString(string input)
312          {
313              MudColor color;
314              try
315              {
316                  color = new MudColor(input);
317              }
318              catch (Exception)
319              {
320                  return;
321              }
322              Value = color;
323          }
324          protected override Task StringValueChanged(string value)
325          {
326              SetInputString(value);
327              return Task.CompletedTask;
328          }
329          private bool _attachedMouseEvent = false;
330          protected override void OnPickerOpened()
331          {
332              base.OnPickerOpened();
333              _attachedMouseEvent = true;
334              StateHasChanged();
335          }
336          protected override void OnPickerClosed()
337          {
338              base.OnPickerClosed();
339              RemoveMouseOverEvent().AndForget();
340          }
341          #endregion
342          #region helper
343          private string GetSelectorLocation() =&gt; $&quot;translate({Math.Round(_selectorX, 2).ToString(CultureInfo.InvariantCulture)}px, {Math.Round(_selectorY, 2).ToString(CultureInfo.InvariantCulture)}px);&quot;;
344          private string GetColorTextValue() =&gt; (DisableAlpha == true || _activeColorPickerView is ColorPickerView.Palette or ColorPickerView.GridCompact) ? _value.ToString(MudColorOutputFormats.Hex) : _value.ToString(MudColorOutputFormats.HexA);
345          private int GetHexColorInputMaxLength() =&gt; DisableAlpha ? 7 : 9;
346          private EventCallback&lt;MouseEventArgs&gt; GetEventCallback() =&gt; EventCallback.Factory.Create&lt;MouseEventArgs&gt;(this, () =&gt; Close());
347          private bool IsAnyControlVisible() =&gt; !(DisablePreview &amp;&amp; DisableSliders &amp;&amp; DisableInputs);
348          private EventCallback&lt;MouseEventArgs&gt; GetSelectPaletteColorCallback(MudColor color) =&gt; new EventCallbackFactory().Create(this, (MouseEventArgs e) =&gt; SelectPaletteColor(color));
349          private Color GetButtonColor(ColorPickerView view) =&gt; _activeColorPickerView == view ? Color.Primary : Color.Inherit;
350          private string GetColorDotClass(MudColor color) =&gt; new CssBuilder(&quot;mud-picker-color-dot&quot;).AddClass(&quot;selected&quot;, color == Value).ToString();
351          private string AlphaSliderStyle =&gt; new StyleBuilder().AddStyle($&quot;background-image: linear-gradient(to {(RightToLeft ? &quot;left&quot; : &quot;right&quot;)}, transparent, {_value.ToString(MudColorOutputFormats.RGB)})&quot;).Build();
352          #endregion
353          #region life cycle hooks
354          protected override async Task OnAfterRenderAsync(bool firstRender)
355          {
356              await base.OnAfterRenderAsync(firstRender);
357              if (firstRender == true)
358              {
359                  if (PickerVariant == PickerVariant.Static)
360                  {
361                      await AddMouseOverEvent();
362                  }
363              }
364              if (_attachedMouseEvent == true)
365              {
366                  _attachedMouseEvent = false;
367                  await AddMouseOverEvent();
368              }
369          }
370          private async Task AddMouseOverEvent()
371          {
372              if (DisableDragEffect == true) { return; }
373              if (_throttledEventManager == null)
374              {
375                  _throttledEventManager = ThrottledEventManagerFactory.Create();
376              }
377              _throttledMouseOverEventId = await
378                  _throttledEventManager.Subscribe&lt;MouseEventArgs&gt;(&quot;mousemove&quot;, _id.ToString(), &quot;mudEventProjections.correctOffset&quot;, 10, async (x) =&gt;
379                  {
380                      var e = x as MouseEventArgs;
381                      await InvokeAsync(() =&gt; OnMouseOver(e));
382                      StateHasChanged();
383                  });
384          }
385          private Task RemoveMouseOverEvent()
386          {
387              if (_throttledMouseOverEventId == default) { return Task.CompletedTask; }
388              return _throttledEventManager.Unsubscribe(_throttledMouseOverEventId);
389          }
390          public async ValueTask DisposeAsync()
391          {
392              if (_throttledEventManager == null) { return; }
393              await _throttledEventManager.DisposeAsync();
394          }
395          #endregion
396      }
397  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColorPicker.razor.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudColorPicker.razor.cs</div>
                </div>
                <div class="column column_space"><pre><code>247              if (index == 6)
248              {
249                  index = 5;
250              }
251              var section = _rgbToHueMapper[index];
</pre></code></div>
                <div class="column column_space"><pre><code>220              if (index == 6)
221              {
222                  index = 5;
223              }
224              var valueInDeg = (int)_value.H - (index * 60);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    