
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 14, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-DatePickerTests.cs</h3>
            <pre><code>1  #pragma warning disable CS1998 
2  #pragma warning disable BL0005 
3  using System;
4  using System.Collections.Generic;
5  using System.Diagnostics;
6  using System.Globalization;
7  using System.Linq;
8  using System.Threading.Tasks;
9  using AngleSharp.Dom;
10  using AngleSharp.Html.Dom;
11  using Bunit;
12  using FluentAssertions;
13  using Microsoft.AspNetCore.Components.Web;
14  using MudBlazor.UnitTests.TestComponents;
15  using MudBlazor.UnitTests.TestComponents.DatePicker;
16  using NUnit.Framework;
17  using static Bunit.ComponentParameterFactory;
18  namespace MudBlazor.UnitTests.Components
19  {
20      [TestFixture]
21      public class DatePickerTests : BunitTest
22      {
23          [Test]
24          public void Default()
25          {
26              var comp = Context.RenderComponent&lt;MudDatePicker&gt;();
27              var picker = comp.Instance;
28              picker.Text.Should().Be(null);
29              picker.Date.Should().Be(null);
30              picker.MaxDate.Should().Be(null);
31              picker.MinDate.Should().Be(null);
32              picker.OpenTo.Should().Be(OpenTo.Date);
33              picker.FirstDayOfWeek.Should().Be(null);
34              picker.ClosingDelay.Should().Be(100);
35              picker.DisplayMonths.Should().Be(1);
36              picker.MaxMonthColumns.Should().Be(null);
37              picker.StartMonth.Should().Be(null);
38              picker.ShowWeekNumbers.Should().BeFalse();
39              picker.AutoClose.Should().BeFalse();
40              picker.FixYear.Should().Be(null);
41              picker.FixMonth.Should().Be(null);
42              picker.FixDay.Should().Be(null);
43          }
44          [Test]
45          public void DatePickerOpenButtonAriaLabel()
46          {
47              var comp = Context.RenderComponent&lt;DatePickerValidationTest&gt;();
48              var openButton = comp.Find(&quot;.mud-input-adornment button&quot;);
49              openButton.Attributes.GetNamedItem(&quot;aria-label&quot;)?.Value.Should().Be(&quot;Open Date Picker&quot;);
50          }
51          [Test]
52          public void DatePickerLabelFor()
53          {
54              var comp = Context.RenderComponent&lt;DatePickerValidationTest&gt;();
55              var label = comp.Find(&quot;.mud-input-label&quot;);
56              label.Attributes.GetNamedItem(&quot;for&quot;)?.Value.Should().Be(&quot;datePickerLabelTest&quot;);
57          }
58          [Test]
59          [Ignore(&quot;Unignore for performance measurements, not needed for code coverage&quot;)]
60          public void DatePicker_Render_Performance()
61          {
62              Context.RenderComponent&lt;MudDatePicker&gt;();
63              var watch = Stopwatch.StartNew();
64              for (var i = 0; i &lt; 1000; i++)
65                  Context.RenderComponent&lt;MudDatePicker&gt;();
66              watch.Stop();
67              watch.Elapsed.Should().BeLessThan(TimeSpan.FromSeconds(10));
68          }
69          [Test]
70          public async Task DatePicker_OpenClose_Performance()
71          {
72              var comp = Context.RenderComponent&lt;MudDatePicker&gt;();
73              var datepicker = comp.Instance;
74              var watch = Stopwatch.StartNew();
75              for (var i = 0; i &lt; 1000; i++)
76              {
77                  await comp.InvokeAsync(() =&gt; datepicker.Open());
78                  await comp.InvokeAsync(() =&gt; datepicker.Close());
79              }
80              watch.Stop();
81              watch.Elapsed.Should().BeLessThan(TimeSpan.FromSeconds(10));
82          }
83          [Test]
84          public async Task SetPickerValue_CheckDate_SetPickerDate_CheckValue()
85          {
86              var comp = Context.RenderComponent&lt;MudDatePicker&gt;();
87              var picker = comp.Instance;
88              picker.Text.Should().Be(null);
89              picker.Date.Should().Be(null);
90              comp.SetParam(p =&gt; p.Text, new DateTime(2020, 10, 23).ToShortDateString());
91              picker.Date.Should().Be(new DateTime(2020, 10, 23));
92              comp.SetParam(p =&gt; p.Date, new DateTime(2020, 10, 26));
93              picker.Text.Should().Be(new DateTime(2020, 10, 26).ToShortDateString());
94          }
95          [Test]
96          public async Task DatePicker_Should_ApplyDateFormat()
97          {
98              var comp = Context.RenderComponent&lt;MudDatePicker&gt;();
99              var picker = comp.Instance;
100              picker.Text.Should().Be(null);
101              picker.Date.Should().Be(null);
102              comp.SetParam(p =&gt; p.DateFormat, &quot;dd/MM/yyyy&quot;);
103              comp.SetParam(p =&gt; p.Culture, CultureInfo.InvariantCulture); 
104              comp.SetParam(p =&gt; p.Text, &quot;23/10/2020&quot;);
105              picker.Date.Should().Be(new DateTime(2020, 10, 23));
106              comp.SetParam(p =&gt; p.Date, new DateTime(2020, 10, 26));
107              picker.Text.Should().Be(&quot;26/10/2020&quot;);
108          }
109          [Test]
110          public async Task DatePicker_Should_ApplyDateFormatAfterDate()
111          {
112              var comp = Context.RenderComponent&lt;MudDatePicker&gt;();
113              var picker = comp.Instance;
114              picker.Text.Should().Be(null);
115              picker.Date.Should().Be(null);
116              comp.SetParam(p =&gt; p.DateFormat, &quot;dd/MM/yyyy&quot;);
117              comp.SetParam(p =&gt; p.Culture, CultureInfo.InvariantCulture); 
118              comp.SetParam(p =&gt; p.Date, new DateTime(2020, 10, 26));
119              picker.Date.Should().Be(new DateTime(2020, 10, 26));
120              picker.Text.Should().Be(&quot;26/10/2020&quot;);
121          }
122          [Test]
123          public async Task DatePicker_Should_ApplyCultureDateFormat()
124          {
125              var comp = Context.RenderComponent&lt;MudDatePicker&gt;();
126              var picker = comp.Instance;
127              picker.Text.Should().Be(null);
128              picker.Date.Should().Be(null);
129              var customCulture = new CultureInfo(&quot;en-US&quot;);
130              customCulture.DateTimeFormat.ShortDatePattern.Should().Be(&quot;M/d/yyyy&quot;);
131              customCulture.DateTimeFormat.ShortDatePattern = &quot;dd MM yyyy&quot;;
132              comp.SetParam(p =&gt; p.Culture, customCulture);
133              comp.SetParam(p =&gt; p.Text, &quot;23 10 2020&quot;);
134              picker.Date.Should().Be(new DateTime(2020, 10, 23));
135              comp.SetParam(p =&gt; p.Date, new DateTime(2020, 10, 26));
136              picker.Text.Should().Be(&quot;26 10 2020&quot;);
137              customCulture.DateTimeFormat.ShortDatePattern = &quot;yyyy-MM-dd&quot;;
138              comp.SetParam(p =&gt; p.Text, &quot;13 10 2020&quot;);
139              picker.Date.Should().Be(new DateTime(2020, 10, 13));
140              comp.SetParam(p =&gt; p.Date, new DateTime(2020, 10, 16));
141              picker.Text.Should().Be(&quot;16 10 2020&quot;);
142          }
143          [Test]
144          public async Task DatePicker_Should_DateFormatTakesPrecedenceOverCulture()
145          {
146              var comp = Context.RenderComponent&lt;MudDatePicker&gt;();
147              var picker = comp.Instance;
148              picker.Text.Should().Be(null);
149              picker.Date.Should().Be(null);
150              comp.SetParam(p =&gt; p.DateFormat, &quot;dd MM yyyy&quot;);
151              comp.SetParam(p =&gt; p.Culture, CultureInfo.InvariantCulture); 
152              comp.SetParam(p =&gt; p.Date, new DateTime(2020, 10, 26));
153              picker.Date.Should().Be(new DateTime(2020, 10, 26));
154              picker.Text.Should().Be(&quot;26 10 2020&quot;);
155          }
156          [Test]
157          public async Task DatePicker_Should_Clear()
158          {
159              var comp = Context.RenderComponent&lt;MudDatePicker&gt;();
160              var picker = comp.Instance;
161              picker.Text.Should().Be(null);
162              picker.Date.Should().Be(null);
163              comp.SetParam(p =&gt; p.Clearable, true);
164              comp.SetParam(p =&gt; p.Date, new DateTime(2020, 10, 26));
165              picker.Date.Should().Be(new DateTime(2020, 10, 26));
166              picker.Text.Should().Be(new DateTime(2020, 10, 26).ToShortDateString());
167              comp.Find(&quot;button&quot;).Click(); 
168              picker.Text.Should().Be(&quot;&quot;); 
169              picker.Date.Should().Be(null);
170          }
171          [Test]
172          public void Check_Intial_Date_Format()
173          {
174              DateTime? date = new DateTime(2021, 1, 13);
175              var comp = Context.RenderComponent&lt;MudDatePicker&gt;(parameters =&gt; parameters
176                  .Add(p =&gt; p.Culture, CultureInfo.InvariantCulture)
177                  .Add(p =&gt; p.DateFormat, &quot;dd/MM/yyyy&quot;)
178                  .Add(p =&gt; p.Date, date)
179              );
180              var picker = comp.Instance;
181              var instance = comp.Instance;
182              picker.Date.Should().Be(new DateTime(2021, 1, 13));
183              picker.Text.Should().Be(&quot;13/01/2021&quot;);
184          }
185          public IRenderedComponent&lt;SimpleMudDatePickerTest&gt; OpenPicker(ComponentParameter parameter)
186          {
187              return OpenPicker(new ComponentParameter[] { parameter });
188          }
189          public IRenderedComponent&lt;SimpleMudDatePickerTest&gt; OpenPicker(ComponentParameter[] parameters = null)
190          {
191              IRenderedComponent&lt;SimpleMudDatePickerTest&gt; comp;
192              if (parameters is null)
193              {
194                  comp = Context.RenderComponent&lt;SimpleMudDatePickerTest&gt;();
195              }
196              else
197              {
198                  comp = Context.RenderComponent&lt;SimpleMudDatePickerTest&gt;(parameters);
199              }
200              comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0);
201              comp.Find(&quot;input&quot;).Click();
202              comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(1);
203              return comp;
204          }
205          [Test]
206          public void Open_CloseByClickingOutsidePicker_CheckClosed()
207          {
208              var comp = OpenPicker();
209              comp.Find(&quot;div.mud-overlay&quot;).Click();
210              comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0);
211          }
212          [Test]
213          public void Open_CloseBySelectingADate_CheckClosed()
214          {
215              var comp = OpenPicker();
216              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
217                  .Where(x =&gt; x.TrimmedText().Equals(&quot;23&quot;)).First().Click();
218              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0), TimeSpan.FromSeconds(5));
219              comp.Instance.Date.Should().NotBeNull();
220          }
221          [Test]
222          public void Open_CloseBySelectingADate_CheckClosed_Check_DateChangedCount()
223          {
224              var eventCount = 0;
225              DateTime? returnDate = null;
226              var comp = OpenPicker(EventCallback(nameof(MudDatePicker.DateChanged), (DateTime? date) =&gt; { eventCount++; returnDate = date; }));
227              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
228                  .Where(x =&gt; x.TrimmedText().Equals(&quot;23&quot;)).First().Click();
229              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0), TimeSpan.FromSeconds(5));
230              comp.Instance.Date.Should().NotBeNull();
231              eventCount.Should().Be(1);
232              var now = DateTime.Now;
233              returnDate.Should().Be(new DateTime(now.Year, now.Month, 23));
234          }
235          [Test]
236          public void OpenToYear_CheckYearsShown()
237          {
238              var comp = OpenPicker(Parameter(&quot;OpenTo&quot;, OpenTo.Year));
239              comp.Instance.Date.Should().BeNull();
240              comp.FindAll(&quot;div.mud-picker-year-container&quot;).Count.Should().Be(1);
241          }
242          [Test]
243          public void OpenToYear_ClickYear_CheckMonthsShown()
244          {
245              var comp = OpenPicker(Parameter(&quot;OpenTo&quot;, OpenTo.Year));
246              comp.Instance.Date.Should().BeNull();
247              comp.FindAll(&quot;div.mud-picker-year-container&quot;).Count.Should().Be(1);
248              comp.FindAll(&quot;div.mud-picker-year&quot;)[0].Click();
249              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
250          }
251          [Test]
252          public void OpenToYear_ClickYear_CheckMonthsShown_Close_Reopen_CheckYearsShown()
253          {
254              var comp = OpenPicker(Parameter(&quot;OpenTo&quot;, OpenTo.Year));
255              comp.Instance.Date.Should().BeNull();
256              comp.FindAll(&quot;div.mud-picker-year-container&quot;).Count.Should().Be(1);
257              comp.FindAll(&quot;div.mud-picker-year&quot;)[0].Click();
258              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
259              comp.Find(&quot;div.mud-overlay&quot;).Click();
260              comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0);
261              comp.Find(&quot;input&quot;).Click();
262              comp.FindAll(&quot;div.mud-picker-year-container&quot;).Count.Should().Be(1);
263          }
264          [Test]
265          public void OpenToMonth_CheckMonthsShown()
266          {
267              var comp = OpenPicker(Parameter(&quot;OpenTo&quot;, OpenTo.Month));
268              comp.Instance.Date.Should().BeNull();
269              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
270          }
271          [Test]
272          public void Open_ClickCalendarHeader_CheckMonthsShown()
273          {
274              var comp = OpenPicker();
275              comp.FindAll(&quot;button.mud-picker-calendar-header-transition&quot;)[0].Click();
276              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
277          }
278          [Test]
279          public void Open_ClickYear_CheckYearsShown()
280          {
281              var comp = OpenPicker(Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month));
282              comp.FindAll(&quot;button.mud-picker-calendar-header-transition&quot;)[0].Click();
283              comp.FindAll(&quot;div.mud-picker-year-container&quot;).Count.Should().Be(1);
284          }
285          [Test]
286          public void OpenToMonth_Select3rdMonth_Select2ndDay_CheckDate()
287          {
288              var comp = OpenPicker(Parameter(&quot;OpenTo&quot;, OpenTo.Month));
289              comp.Instance.Date.Should().BeNull();
290              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
291              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-month-container &gt; button.mud-picker-month&quot;)
292                  [2].Click();
293              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
294                  .Where(x =&gt; x.TrimmedText().Equals(&quot;2&quot;)).First().Click();
295              comp.Instance.Date.Value.Date.Should().Be(new DateTime(DateTime.Now.Year, 3, 2));
296          }
297          public IRenderedComponent&lt;SimpleMudDatePickerTest&gt; OpenTo12thMonth()
298          {
299              var comp = OpenPicker(Parameter(&quot;PickerMonth&quot;, new DateTime(DateTime.Now.Year, 12, 01)));
300              comp.Instance.PickerMonth.Value.Month.Should().Be(12);
301              return comp;
302          }
303          [Test]
304          public void Open_ClickCalendarHeader_Click4thMonth_Click23rdDay_CheckDate()
305          {
306              var comp = OpenPicker();
307              var picker = comp.Instance;
308              comp.Find(&quot;button.mud-picker-calendar-header-transition&quot;).Click();
309              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
310              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-month-container &gt; button.mud-picker-month&quot;)
311                  [3].Click();
312              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
313                  .Where(x =&gt; x.TrimmedText().Equals(&quot;23&quot;)).First().Click();
314              comp.Instance.Date.Value.Date.Should().Be(new DateTime(DateTime.Now.Year, 4, 23));
315          }
316          [Test]
317          public void DatePickerStaticWithPickerActionsDayClick_Test()
318          {
319              var comp = Context.RenderComponent&lt;DatePickerStaticTest&gt;();
320              var picker = comp.FindComponent&lt;MudDatePicker&gt;();
321              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
322                  .Where(x =&gt; x.TrimmedText().Equals(&quot;23&quot;)).First().Click();
323              picker.Instance.Date.Should().Be(new DateTime(DateTime.Now.Year, DateTime.Now.Month, 23));
324          }
325          [Test]
326          public void OpenTo12thMonth_NavigateBack_CheckMonth()
327          {
328              var comp = OpenTo12thMonth();
329              var picker = comp.Instance;
330              comp.Find(&quot;div.mud-picker-calendar-header-switch &gt; button:nth-child(1)&quot;).Click();
331              picker.PickerMonth.Value.Month.Should().Be(11);
332              picker.PickerMonth.Value.Year.Should().Be(DateTime.Now.Year);
333          }
334          [Test]
335          public void OpenTo12thMonth_NavigateForward_CheckYear()
336          {
337              var comp = OpenTo12thMonth();
338              var picker = comp.Instance;
339              comp.Find(&quot;div.mud-picker-calendar-header-switch &gt; button:nth-child(3)&quot;).Click();
340              picker.PickerMonth.Value.Month.Should().Be(1);
341              picker.PickerMonth.Value.Year.Should().Be(DateTime.Now.Year + 1);
342          }
343          [Test]
344          public void Open_ClickYear_ClickCurrentYear_Click2ndMonth_Click1_CheckDate()
345          {
346              var comp = OpenPicker();
347              comp.Find(&quot;div.mud-picker-datepicker-toolbar &gt; button.mud-button-year&quot;).Click();
348              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container&quot;).Count.Should().Be(1);
349              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container &gt; div.mud-picker-year&quot;)
350                  .Where(x =&gt; x.TrimmedText().Contains(&quot;2022&quot;)).First().Click();
351              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
352              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-month-container &gt; button.mud-picker-month&quot;)[1].Click();
353              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-calendar-header&quot;).Count.Should().Be(1);
354              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
355                  .Where(x =&gt; x.TrimmedText().Equals(&quot;1&quot;)).First().Click();
356              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 2, 1));
357          }
358          [Test]
359          public void Open_FixYear_Click2ndMonth_Click3_CheckDate()
360          {
361              var comp = OpenPicker(ComponentParameter.CreateParameter(&quot;FixYear&quot;, 2021));
362              comp.Find(&quot;div.mud-picker-datepicker-toolbar &gt; button.mud-button-year&quot;).Click();
363              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container&quot;).Count.Should().Be(0);
364              comp.Find(&quot;div.mud-picker-calendar-container &gt; .mud-picker-calendar-header &gt; .mud-picker-calendar-header-switch &gt; .mud-button-month&quot;).Click();
365              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
366              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-month-container &gt; button.mud-picker-month&quot;)[1].Click();
367              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-calendar-header&quot;).Count.Should().Be(1);
368              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
369                  .Where(x =&gt; x.TrimmedText().Equals(&quot;3&quot;)).First().Click();
370              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2021, 2, 3));
371          }
372          [Test]
373          public void Open_FixDay_ClickYear_Click2ndMonth_CheckDate()
374          {
375              var comp = OpenPicker(ComponentParameter.CreateParameter(&quot;FixDay&quot;, 1));
376              comp.Find(&quot;div.mud-picker-datepicker-toolbar &gt; button.mud-button-year&quot;).Click();
377              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container&quot;).Count.Should().Be(1);
378              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container &gt; div.mud-picker-year&quot;)
379                  .Where(x =&gt; x.TrimmedText().Contains(&quot;2022&quot;)).First().Click();
380              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
381              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-month-container &gt; button.mud-picker-month&quot;)[1].Click();
382              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 2, 1));
383          }
384          [Test]
385          public void Open_FixMonth_ClickYear_Click3_CheckDate()
386          {
387              var comp = OpenPicker(ComponentParameter.CreateParameter(&quot;FixMonth&quot;, 1));
388              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; .mud-picker-calendar-header &gt; .mud-picker-calendar-header-switch &gt; .mud-button-month&quot;).Count().Should().Be(0);
389              comp.Find(&quot;div.mud-picker-datepicker-toolbar &gt; button.mud-button-year&quot;).Click();
390              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container&quot;).Count.Should().Be(1);
391              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container &gt; div.mud-picker-year&quot;)
392                  .Where(x =&gt; x.TrimmedText().Contains(&quot;2022&quot;)).First().Click();
393              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(0);
394              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-calendar-header&quot;).Count.Should().Be(1);
395              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
396                  .Where(x =&gt; x.TrimmedText().Equals(&quot;3&quot;)).First().Click();
397              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 1, 3));
398          }
399          [Test]
400          public void Open_FixYear_FixMonth_Click3_CheckDate()
401          {
402              var comp = OpenPicker(new ComponentParameter[] { ComponentParameter.CreateParameter(&quot;FixMonth&quot;, 1), ComponentParameter.CreateParameter(&quot;FixYear&quot;, 2022) });
403              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container&quot;).Count.Should().Be(0);
404              comp.Find(&quot;div.mud-picker-datepicker-toolbar &gt; button.mud-button-year&quot;).Click();
405              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container&quot;).Count.Should().Be(0);
406              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; .mud-picker-calendar-header &gt; .mud-picker-calendar-header-switch &gt; .mud-button-month&quot;).Count().Should().Be(0);
407              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-calendar-header&quot;).Count.Should().Be(1);
408              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
409                  .Where(x =&gt; x.TrimmedText().Equals(&quot;3&quot;)).First().Click();
410              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 1, 3));
411          }
412          [Test]
413          public void Open_FixMonth_FixDay_ClickYear2022_CheckDate()
414          {
415              var comp = OpenPicker(new ComponentParameter[] { ComponentParameter.CreateParameter(&quot;OpenTo&quot;, OpenTo.Year), ComponentParameter.CreateParameter(&quot;FixMonth&quot;, 1), ComponentParameter.CreateParameter(&quot;FixDay&quot;, 1) });
416              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; .mud-picker-calendar-header &gt; .mud-picker-calendar-header-switch &gt; .mud-button-month&quot;).Count().Should().Be(0);
417              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container&quot;).Count.Should().Be(1);
418              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container &gt; div.mud-picker-year&quot;)
419                  .Where(x =&gt; x.TrimmedText().Contains(&quot;2022&quot;)).First().Click();
420              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 1, 1));
421          }
422          [Test]
423          public void Open_FixYear_FixDay_Click3rdMonth_CheckDate()
424          {
425              var comp = OpenPicker(new ComponentParameter[] { ComponentParameter.CreateParameter(&quot;OpenTo&quot;, OpenTo.Month), ComponentParameter.CreateParameter(&quot;FixYear&quot;, 2022), ComponentParameter.CreateParameter(&quot;FixDay&quot;, 1) });
426              comp.Find(&quot;div.mud-picker-datepicker-toolbar &gt; button.mud-button-year&quot;).Click();
427              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-year-container&quot;).Count.Should().Be(0);
428              comp.FindAll(&quot;div.mud-picker-month-container&quot;).Count.Should().Be(1);
429              comp.FindAll(&quot;div.mud-picker-calendar-container &gt; div.mud-picker-month-container &gt; button.mud-picker-month&quot;)[2].Click();
430              comp.Instance.Date.Value.Date.Should().Be(new DateTime(2022, 3, 1));
431          }
432          [Test]
433          public async Task Open_Programmatically_CheckOpen_Close_Programmatically_CheckClosed()
434          {
435              var comp = Context.RenderComponent&lt;SimpleMudDatePickerTest&gt;();
436              comp.FindAll(&quot;div.mud-picker-content&quot;).Count.Should().Be(0);
437              await comp.InvokeAsync(() =&gt; comp.Instance.Open());
438              comp.FindAll(&quot;div.mud-picker-content&quot;).Count.Should().Be(1);
439              await comp.InvokeAsync(() =&gt; comp.Instance.Close());
440              comp.FindAll(&quot;div.mud-picker-content&quot;).Count.Should().Be(0);
441          }
442          [Test]
443          public async Task PersianCalendar()
444          {
445              var cal = new PersianCalendar();
446              var date = new DateTime(2021, 02, 14);
447              cal.GetYear(date).Should().Be(1399);
448              cal.GetMonth(date).Should().Be(11);
449              cal.GetDayOfMonth(date).Should().Be(26);
450              var comp = Context.RenderComponent&lt;PersianDatePickerTest&gt;();
451              var datePicker = comp.FindComponent&lt;MudDatePicker&gt;();
452              await comp.InvokeAsync(() =&gt; datePicker.Instance.Open());
453          }
454          [Test]
455          public void SetPickerValue_CheckText()
456          {
457              var date = DateTime.Now;
458              var comp = Context.RenderComponent&lt;MudDatePicker&gt;(
459                  Parameter(nameof(MudDatePicker.Date), date));
460              var picker = comp.Instance;
461              var text = date.ToShortDateString();
462              picker.Text.Should().Be(text);
463              ((IHtmlInputElement)comp.FindAll(&quot;input&quot;)[0]).Value.Should().Be(text);
464          }
465          [Test]
466          public void IsDateDisabledFunc_DisablesCalendarDateButtons()
467          {
468              Func&lt;DateTime, bool&gt; isDisabledFunc = date =&gt; true;
469              var comp = OpenPicker(Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc));
470              comp.Instance.IsDateDisabledFunc.Should().Be(isDisabledFunc);
471              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
472                  .Should().OnlyContain(disabled =&gt; disabled == true);
473          }
474          [Test]
475          public void IsDateDisabledFunc_DisablesCalendarMonthButtons()
476          {
477              Func&lt;DateTime, bool&gt; isDisabledFunc = date =&gt; true;
478              var comp = OpenPicker(new[]
479              {
480                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
481                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
482                  Parameter(nameof(MudDatePicker.FixDay), 1)
483              });
484              comp.Instance.IsDateDisabledFunc.Should().Be(isDisabledFunc);
485              comp.FindAll(&quot;button.mud-picker-month&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
486                  .Should().OnlyContain(disabled =&gt; disabled == true);
487              comp.FindAll(&quot;button.mud-picker-month &gt; .mud-typography&quot;).Select(
488                  text =&gt; ((IHtmlElement)text).ClassList.Any(cls =&gt; cls == &quot;mud-picker-month-select&quot; || cls == &quot;mud-primary-text&quot;))
489                  .Should().OnlyContain(selected =&gt; selected == false);
490          }
491          [Test]
492          public void IsDateDisabledFunc_DoesNotHaveEffectOnMonthsIfDayNotFixed()
493          {
494              Func&lt;DateTime, bool&gt; isDisabledFunc = date =&gt; true;
495              var comp = OpenPicker(new[]
496              {
497                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
498                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month)
499              });
500              comp.Instance.IsDateDisabledFunc.Should().Be(isDisabledFunc);
501              comp.FindAll(&quot;button.mud-picker-month&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
502                  .Should().OnlyContain(disabled =&gt; disabled == false);
503          }
504          [Test]
505          public void IsDateDisabledFunc_DoesNotHaveEffectOnMonthsIfFuncReturnsFalse()
506          {
507              Func&lt;DateTime, bool&gt; isDisabledFunc = date =&gt; false;
508              var comp = OpenPicker(new[]
509              {
510                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
511                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
512                  Parameter(nameof(MudDatePicker.FixDay), 1)
513              });
514              comp.Instance.IsDateDisabledFunc.Should().Be(isDisabledFunc);
515              comp.FindAll(&quot;button.mud-picker-month&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
516                  .Should().OnlyContain(disabled =&gt; disabled == false);
517          }
518          [TestCase(10, 8, 2, 2)]
519          [TestCase(10, 9, 2, 2)]
520          [TestCase(10, 10, 2, 1)]
521          [TestCase(10, 11, 2, 1)]
522          public void MinDateEffectOnDisablingMonthsIfDayFixed(int minDatesDay, int fixedDay,
523              int month, int disabledOnes)
524          {
525              var currentDate = DateTime.Now;
526              var minDate = new DateTime(currentDate.Year, month, minDatesDay);
527              var comp = OpenPicker(new[]
528              {
529                  Parameter(nameof(MudDatePicker.MinDate), minDate),
530                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
531                  Parameter(nameof(MudDatePicker.FixDay), fixedDay),
532              });
533              var expectedResult = new bool[12];
534              for (var i = 0; i &lt; disabledOnes; ++i) expectedResult[i] = true;
535              comp.Instance.MinDate.Should().Be(minDate);
536              comp.FindAll(&quot;button.mud-picker-month&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
537                  .Should().ContainInConsecutiveOrder(expectedResult);
538          }
539          [TestCase(10, 9, 11, 1)]
540          [TestCase(10, 10, 11, 1)]
541          [TestCase(10, 11, 11, 2)]
542          [TestCase(10, 12, 11, 2)]
543          public void MaxDateEffectOnDisablingMonthsIfDayFixed(int maxDatesDay, int fixedDay,
544              int month, int disabledOnes)
545          {
546              var currentDate = DateTime.Now;
547              var maxDate = new DateTime(currentDate.Year, month, maxDatesDay);
548              var comp = OpenPicker(new[]
549              {
550                  Parameter(nameof(MudDatePicker.MaxDate), maxDate),
551                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
552                  Parameter(nameof(MudDatePicker.FixDay), fixedDay),
553              });
554              var expectedResult = new bool[12];
555              for (var i = 0; i &lt; disabledOnes; ++i) expectedResult[11 - i] = true;
556              comp.Instance.MaxDate.Should().Be(maxDate);
557              comp.FindAll(&quot;button.mud-picker-month&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
558                  .Should().ContainInConsecutiveOrder(expectedResult);
559          }
560          [TestCase(30, 3, 2)]
561          [TestCase(31, 3, 2)]
562          [TestCase(1, 4, 3)]
563          [TestCase(2, 4, 3)]
564          public void MinDateEffectOnDisablingMonthsIfDayNotFixed(int minDatesDay, int month, int disabledOnes)
565          {
566              var currentYear = DateTime.Now.Year;
567              var minDate = new DateTime(currentYear, month, minDatesDay);
568              var comp = OpenPicker(new[]
569              {
570                  Parameter(nameof(MudDatePicker.MinDate), minDate),
571                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
572              });
573              var expectedResult = new bool[12];
574              for (var i = 0; i &lt; disabledOnes; ++i) expectedResult[i] = true;
575              comp.Instance.MinDate.Should().Be(minDate);
576              comp.FindAll(&quot;button.mud-picker-month&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
577                  .Should().ContainInConsecutiveOrder(expectedResult);
578          }
579          [TestCase(1, 10, 2)]
580          [TestCase(2, 10, 2)]
581          [TestCase(30, 9, 3)]
582          [TestCase(29, 9, 3)]
583          public void MaxDateEffectOnDisablingMonthsIfDayNotFixed(int maxDatesDay, int month, int disabledOnes)
584          {
585              var currentYear = DateTime.Now.Year;
586              var maxDate = new DateTime(currentYear, month, maxDatesDay);
587              var comp = OpenPicker(new[]
588              {
589                  Parameter(nameof(MudDatePicker.MaxDate), maxDate),
590                  Parameter(nameof(MudDatePicker.OpenTo), OpenTo.Month),
591              });
592              var expectedResult = new bool[12];
593              for (var i = 0; i &lt; disabledOnes; ++i) expectedResult[11 - i] = true;
594              comp.Instance.MaxDate.Should().Be(maxDate);
595              comp.FindAll(&quot;button.mud-picker-month&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
596                  .Should().ContainInConsecutiveOrder(expectedResult);
597          }
598          [Test]
599          public void IsDateDisabledFunc_SettingDateToADisabledDateYieldsNull()
600          {
601              var wasEventCallbackCalled = false;
602              Func&lt;DateTime, bool&gt; isDisabledFunc = date =&gt; true;
603              var comp = Context.RenderComponent&lt;MudDatePicker&gt;(
604                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
605                  EventCallback(&quot;DateChanged&quot;, (DateTime? _) =&gt; wasEventCallbackCalled = true)
606              );
607              comp.SetParam(picker =&gt; picker.Date, DateTime.Now);
608              comp.Instance.Date.Should().BeNull();
609              wasEventCallbackCalled.Should().BeFalse();
610          }
611          [Test]
612          public void IsDateDisabledFunc_SettingDateToAnEnabledDateYieldsTheDate()
613          {
614              var wasEventCallbackCalled = false;
615              var today = DateTime.Today;
616              Func&lt;DateTime, bool&gt; isDisabledFunc = date =&gt; date &lt; today;
617              var comp = Context.RenderComponent&lt;MudDatePicker&gt;(
618                  Parameter(nameof(MudDatePicker.IsDateDisabledFunc), isDisabledFunc),
619                  EventCallback(&quot;DateChanged&quot;, (DateTime? _) =&gt; wasEventCallbackCalled = true)
620              );
621              comp.SetParam(picker =&gt; picker.Date, today);
622              comp.Instance.Date.Should().Be(today);
623              wasEventCallbackCalled.Should().BeTrue();
624          }
625          [Test]
626          public void IsDateDisabledFunc_NoDisabledDatesByDefault()
627          {
628              var comp = OpenPicker();
629              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;).Select(button =&gt; ((IHtmlButtonElement)button).IsDisabled)
630                  .Should().OnlyContain(disabled =&gt; disabled == false);
631          }
632          [Test]
633          public void MonthButtons_ButtonRootClassPresent()
634          {
635              var comp = OpenPicker(Parameter(nameof(MudDatePicker.FixDay), 1));
636              var monthsCount = 12;
637              comp.FindAll(&quot;button.mud-picker-month&quot;).Select(button =&gt;
638                  ((IHtmlButtonElement)button).ClassName.Contains(&quot;mud-button-root&quot;))
639                  .Should().HaveCount(monthsCount);
640          }
641          [Test]
642          public void AdditionalDateClassesFunc_ClassIsAdded()
643          {
644              Func&lt;DateTime, string&gt; additionalDateClassesFunc = date =&gt; &quot;__addedtestclass__&quot;;
645              var comp = OpenPicker(Parameter(nameof(MudDatePicker.AdditionalDateClassesFunc), additionalDateClassesFunc));
646              var daysCount = comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
647                                  .Select(button =&gt; (IHtmlButtonElement)button)
648                                  .Count();
649              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
650                  .Where(button =&gt; ((IHtmlButtonElement)button).ClassName.Contains(&quot;__addedtestclass__&quot;))
651                  .Should().HaveCount(daysCount);
652          }
653          public async Task CheckAutoCloseDatePickerTest()
654          {
655              var now = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
656              var comp = Context.RenderComponent&lt;AutoCompleteDatePickerTest&gt;();
657              var datePicker = comp.FindComponent&lt;MudDatePicker&gt;();
658              await comp.InvokeAsync(() =&gt; datePicker.Instance.Open());
659              if (now.Day != 20)
660              {
661                  comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
662                      .Where(x =&gt; x.TrimmedText().Equals(&quot;20&quot;)).First().Click();
663              }
664              else
665              {
666                  comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
667                      .Where(x =&gt; x.TrimmedText().Equals(&quot;19&quot;)).First().Click();
668              }
669              datePicker.Instance.Date.Should().Be(now);
670              await comp.InvokeAsync(() =&gt; datePicker.Instance.Close(false));
671              await comp.InvokeAsync(() =&gt; datePicker.Instance.Open());
672              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-popover&quot;).Count.Should().Be(1));
673              await comp.InvokeAsync(() =&gt; datePicker.Instance.Clear());
674              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-popover&quot;).Count.Should().Be(1));
675              await comp.InvokeAsync(() =&gt; datePicker.Instance.Close(false));
676              datePicker.Instance.AutoClose = true;
677              await comp.InvokeAsync(() =&gt; datePicker.Instance.Open());
678              if (now.Day != 20)
679              {
680                  comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
681                      .Where(x =&gt; x.TrimmedText().Equals(&quot;20&quot;)).First().Click();
682              }
683              else
684              {
685                  comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
686                      .Where(x =&gt; x.TrimmedText().Equals(&quot;19&quot;)).First().Click();
687              }
688              if (now.Day != 20)
689              {
690                  datePicker.Instance.Date.Should().Be(new DateTime(now.Year, now.Month, 20));
691              }
692              else
693              {
694                  datePicker.Instance.Date.Should().Be(new DateTime(now.Year, now.Month, 19));
695              }
696              await comp.InvokeAsync(() =&gt; datePicker.Instance.Open());
697              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-popover&quot;).Count.Should().Be(1));
698              await comp.InvokeAsync(() =&gt; datePicker.Instance.Clear());
699              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-popover&quot;).Count.Should().Be(0));
700          }
701          [Test]
702          public async Task CheckReadOnlyTest()
703          {
704              var now = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
705              var comp = Context.RenderComponent&lt;SimpleMudDatePickerTest&gt;();
<span onclick='openModal()' class='match'>706              var picker = comp.Instance;
707              await picker.Open();
708              if (now.Day != 20)
</span>709              {
710                  comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
711                      .Where(x =&gt; x.TrimmedText().Equals(&quot;20&quot;)).First().Click();
712              }
713              else
714              {
715                  comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
716                      .Where(x =&gt; x.TrimmedText().Equals(&quot;19&quot;)).First().Click();
717              }
718              await picker.Close();
719              if (now.Day != 20)
720              {
721                  picker.Date.Should().Be(new DateTime(now.Year, now.Month, 20));
722              }
723              else
724              {
725                  picker.Date.Should().Be(new DateTime(now.Year, now.Month, 19));
726              }
727              now = picker.Date.Value;
728              comp.SetParametersAndRender(p =&gt; p.Add(x =&gt; x.Readonly, true));
729              await picker.Open();
730              if (now.Day != 21)
731              {
732                  comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
733                      .Where(x =&gt; x.TrimmedText().Equals(&quot;22&quot;)).First().Click();
734              }
735              else
736              {
737                  comp.FindAll(&quot;button.mud-picker-calendar-day&quot;)
738                      .Where(x =&gt; x.TrimmedText().Equals(&quot;21&quot;)).First().Click();
739              }
740              await picker.Close();
741              picker.Date.Should().Be(now);
742          }
743          [Test]
744          public async Task CheckDateTimeMinValueTest()
745          {
746              var date = DateTime.MinValue;
747              var comp = Context.RenderComponent&lt;DateTimeMinValueDatePickerTest&gt;();
748              var datePicker = comp.FindComponent&lt;MudDatePicker&gt;();
749              var picker = comp.Instance;
750              await comp.InvokeAsync(() =&gt; datePicker.Instance.Open());
751              comp.FindAll(&quot;button.mud-picker-calendar-day&quot;).Where(x =&gt; x.TrimmedText().Equals(&quot;1&quot;)).First().Click();
752          }
753          [TestCase(false)]
754          [TestCase(true)]
755          [Test]
756          public void CheckButtonTypeTest(bool navigateToMonthSelection)
757          {
758              var dateComp = Context.RenderComponent&lt;MudDatePicker&gt;(p =&gt;
759              p.Add(x =&gt; x.PickerVariant, PickerVariant.Dialog));
760              dateComp.Find(&quot;.mud-picker input&quot;).Click();
761              if (navigateToMonthSelection)
762              {
763                  dateComp.Find(&quot;.mud-picker button.mud-picker-calendar-header-transition&quot;).Click();
764              }
765              var buttons = dateComp.FindAll(&quot;.mud-picker button&quot;);
766              foreach (var button in buttons)
767              {
768                  button.ToMarkup().Contains(&quot;type=\&quot;button\&quot;&quot;).Should().BeTrue();
769              }
770          }
771          [Test]
772          public async Task DatePickerTest_Editable()
773          {
774              var comp = Context.RenderComponent&lt;SimpleMudDatePickerTest&gt;();
775              CultureInfo cultureInfo = new CultureInfo(&quot;en-US&quot;);
776              var datePicker = comp.FindComponent&lt;MudDatePicker&gt;().Instance;
777              datePicker.Editable = true;
778              datePicker.Culture = cultureInfo;
779              await comp.InvokeAsync(() =&gt; comp.Find(&quot;input&quot;).Change(&quot;10/10/2020&quot;));
780              comp.WaitForAssertion(() =&gt; datePicker.Date.Should().Be(new DateTime(2020, 10, 10)));
781              comp.WaitForAssertion(() =&gt; datePicker.PickerMonth.Should().Be(null));
782              await comp.InvokeAsync(() =&gt; datePicker.Open());
783              comp.WaitForAssertion(() =&gt; datePicker.PickerMonth.Should().Be(new DateTime(2020, 10, 01)));
784          }
785          [Test]
786          public async Task DatePickerTest_KeyboardNavigation()
787          {
788              var comp = Context.RenderComponent&lt;SimpleMudDatePickerTest&gt;();
789              var datePicker = comp.FindComponent&lt;MudDatePicker&gt;().Instance;
790              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot;Enter&quot;, Type = &quot;keydown&quot;, }));
791              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(1));
792              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot;Escape&quot;, Type = &quot;keydown&quot;, }));
793              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0));
794              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot; &quot;, Type = &quot;keydown&quot;, }));
795              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(1));
796              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot; &quot;, Type = &quot;keydown&quot;, }));
797              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0));
798              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot;ArrowDown&quot;, AltKey = true, Type = &quot;keydown&quot;, }));
799              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(1));
800              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot;ArrowUp&quot;, AltKey = true, Type = &quot;keydown&quot;, }));
801              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0));
802              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot;NumpadEnter&quot;, Type = &quot;keydown&quot;, }));
803              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(1));
804              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot;Tab&quot;, Type = &quot;keydown&quot;, }));
805              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0));
806              datePicker.Disabled = true;
807              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot;Enter&quot;, Type = &quot;keydown&quot;, }));
808              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0));
809              await comp.InvokeAsync(() =&gt; datePicker.ToggleOpen());
810              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(1));
811              await comp.InvokeAsync(() =&gt; datePicker.ToggleOpen());
812              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0));
813              await comp.InvokeAsync(() =&gt; datePicker.ToggleState());
814              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(0));
815              datePicker.Disabled = false;
816              await comp.InvokeAsync(() =&gt; datePicker.HandleKeyDown(new KeyboardEventArgs() { Key = &quot;NumpadEnter&quot;, Type = &quot;keydown&quot;, }));
817              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(1));
818              await comp.InvokeAsync(() =&gt; datePicker.ToggleState());
819              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;div.mud-picker-open&quot;).Count.Should().Be(1));
820          }
821          [Test]
822          public async Task DatePickerTest_GoToDate()
823          {
824              var comp = Context.RenderComponent&lt;SimpleMudDatePickerTest&gt;();
825              var datePicker = comp.FindComponent&lt;MudDatePicker&gt;().Instance;
826              await comp.InvokeAsync(() =&gt; datePicker.GoToDate(new DateTime(2022, 03, 20)));
827              comp.WaitForAssertion(() =&gt; datePicker.Date.Should().Be(new DateTime(2022, 03, 20)));
828              await comp.InvokeAsync(() =&gt; datePicker.GoToDate(new DateTime(2023, 04, 21), false));
829              comp.WaitForAssertion(() =&gt; datePicker.Date.Should().Be(new DateTime(2022, 03, 20)));
830              await comp.InvokeAsync(() =&gt; datePicker.GoToDate(new DateTime(2023, 04, 21)));
831              comp.WaitForAssertion(() =&gt; datePicker.Date.Should().Be(new DateTime(2023, 04, 21)));
832              await comp.InvokeAsync(() =&gt; datePicker.GoToDate());
833              comp.WaitForAssertion(() =&gt; datePicker.Date.Should().Be(new DateTime(2023, 04, 21)));
834          }
835          [Test]
836          public async Task DatePickerTest_CheckIfMonthsAreDisabled()
837          {
838              var comp = Context.RenderComponent&lt;SimpleMudDatePickerTest&gt;();
839              var datePicker = comp.FindComponent&lt;MudDatePicker&gt;().Instance;
840              datePicker.MinDate = DateTime.Now.AddDays(-1);
841              datePicker.MaxDate = DateTime.Now.AddDays(1);
842              await comp.InvokeAsync(datePicker.Open);
843              comp.Find(&quot;button.mud-button-month&quot;).Click();
844              comp.WaitForAssertion(() =&gt; comp.FindAll(&quot;button.mud-picker-month&quot;).Any(x =&gt; x.IsDisabled()).Should().Be(true));
845              comp.FindAll(&quot;button.mud-picker-month&quot;).First(x =&gt; x.IsDisabled()).Click();
846              var months = comp.FindAll(&quot;button.mud-picker-month&quot;);
847              months.Should().NotBeNull();
848              comp.Instance.Date.Should().BeNull();
849          }
850      }
851  }
</code></pre>
        </div>
        <div class="column">
            <h3>npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-TypeMapperTests.cs</h3>
            <pre><code>1  using Npgsql.Internal;
2  using Npgsql.Internal.TypeHandlers;
3  using Npgsql.Internal.TypeHandling;
4  using Npgsql.PostgresTypes;
5  using Npgsql.TypeMapping;
6  using NUnit.Framework;
7  using System;
8  using System.Threading.Tasks;
9  using Npgsql.Internal.TypeMapping;
10  using static Npgsql.Tests.TestUtil;
11  namespace Npgsql.Tests;
12  public class TypeMapperTests : TestBase
13  {
14  #pragma warning disable CS0618 
15      [Test, NonParallelizable]
16      public async Task Global_mapping()
17      {
18          await using var adminConnection = await OpenConnectionAsync();
19          var type = await GetTempTypeName(adminConnection);
20          NpgsqlConnection.GlobalTypeMapper.MapEnum&lt;Mood&gt;(type);
21          try
22          {
23              await using var dataSource1 = CreateDataSource();
24              await using (var connection = await dataSource1.OpenConnectionAsync())
25              {
26                  await connection.ExecuteNonQueryAsync($&quot;CREATE TYPE {type} AS ENUM (&#x27;sad&#x27;, &#x27;ok&#x27;, &#x27;happy&#x27;)&quot;);
27                  await connection.ReloadTypesAsync();
28                  await AssertType(connection, Mood.Happy, &quot;happy&quot;, type, npgsqlDbType: null);
29              }
30              NpgsqlConnection.GlobalTypeMapper.UnmapEnum&lt;Mood&gt;(type);
31              await AssertType(dataSource1, Mood.Happy, &quot;happy&quot;, type, npgsqlDbType: null);
32              await using var dataSource2 = CreateDataSource();
33              Assert.ThrowsAsync&lt;NotSupportedException&gt;(() =&gt; AssertType(dataSource2, Mood.Happy, &quot;happy&quot;, type, npgsqlDbType: null));
34          }
35          finally
36          {
37              NpgsqlConnection.GlobalTypeMapper.UnmapEnum&lt;Mood&gt;(type);
38          }
39      }
40      [Test, NonParallelizable]
41      public async Task Global_mapping_reset()
42      {
43          await using var adminConnection = await OpenConnectionAsync();
44          var type = await GetTempTypeName(adminConnection);
45          NpgsqlConnection.GlobalTypeMapper.MapEnum&lt;Mood&gt;(type);
46          try
47          {
48              await using var dataSource1 = CreateDataSource();
49              await using (var connection = await dataSource1.OpenConnectionAsync())
50              {
51                  await connection.ExecuteNonQueryAsync($&quot;CREATE TYPE {type} AS ENUM (&#x27;sad&#x27;, &#x27;ok&#x27;, &#x27;happy&#x27;)&quot;);
52                  await connection.ReloadTypesAsync();
53              }
54              NpgsqlConnection.GlobalTypeMapper.Reset();
55              await AssertType(dataSource1, Mood.Happy, &quot;happy&quot;, type, npgsqlDbType: null);
56              await using var dataSource2 = CreateDataSource();
57              Assert.ThrowsAsync&lt;NotSupportedException&gt;(() =&gt; AssertType(dataSource2, Mood.Happy, &quot;happy&quot;, type, npgsqlDbType: null));
58          }
59          finally
60          {
61              NpgsqlConnection.GlobalTypeMapper.Reset();
62          }
63      }
64  #pragma warning restore CS0618 
65      [Test]
66      public async Task ReloadTypes_across_connections_in_data_source()
67      {
68          await using var adminConnection = await OpenConnectionAsync();
69          var type = await GetTempTypeName(adminConnection);
70          var dataSourceBuilder = CreateDataSourceBuilder();
71          dataSourceBuilder.MapEnum&lt;Mood&gt;();
72          await using var dataSource = dataSourceBuilder.Build();
73          await using var connection1 = await dataSource.OpenConnectionAsync();
74          await using var connection2 = await dataSource.OpenConnectionAsync();
75          await connection1.ExecuteNonQueryAsync($&quot;CREATE TYPE {type} AS ENUM (&#x27;sad&#x27;, &#x27;ok&#x27;, &#x27;happy&#x27;)&quot;);
76          await connection1.ReloadTypesAsync();
77          Assert.DoesNotThrowAsync(async () =&gt; await connection1.ExecuteScalarAsync($&quot;SELECT &#x27;happy&#x27;::{type}&quot;));
78          Assert.ThrowsAsync&lt;NotSupportedException&gt;(async () =&gt; await connection2.ExecuteScalarAsync($&quot;SELECT &#x27;happy&#x27;::{type}&quot;));
<span onclick='openModal()' class='match'>79          var connId = connection2.ProcessID;
80          await connection2.CloseAsync();
81          await connection2.OpenAsync();
</span>82          Assert.That(connection2.ProcessID, Is.EqualTo(connId), &quot;Didn&#x27;t get the same connector back&quot;);
83          Assert.DoesNotThrowAsync(async () =&gt; await connection2.ExecuteScalarAsync($&quot;SELECT &#x27;happy&#x27;::{type}&quot;));
84      }
85      [Test]
86      [NonParallelizable] 
87      public async Task String_to_citext()
88      {
89          await using var adminConnection = await OpenConnectionAsync();
90          await EnsureExtensionAsync(adminConnection, &quot;citext&quot;);
91          var dataSourceBuilder = CreateDataSourceBuilder();
92          dataSourceBuilder.AddTypeResolverFactory(new CitextToStringTypeHandlerResolverFactory());
93          await using var dataSource = dataSourceBuilder.Build();
94          await using var connection = await dataSource.OpenConnectionAsync();
95          await using var command = new NpgsqlCommand(&quot;SELECT @p = &#x27;hello&#x27;::citext&quot;, connection);
96          command.Parameters.AddWithValue(&quot;p&quot;, &quot;HeLLo&quot;);
97          Assert.That(command.ExecuteScalar(), Is.True);
98      }
99      [Test, IssueLink(&quot;https:&amp;bsol;&amp;bsol;github.com/npgsql/npgsql/issues/4582&quot;)]
100      [NonParallelizable] 
101      public async Task Type_in_non_default_schema()
102      {
103          await using var conn = await OpenConnectionAsync();
104          var schemaName = await CreateTempSchema(conn);
105          await conn.ExecuteNonQueryAsync(@$&quot;
106  DROP EXTENSION IF EXISTS citext;
107  CREATE EXTENSION citext SCHEMA &quot;&quot;{schemaName}&quot;&quot;&quot;);
108          try
109          {
110              await conn.ReloadTypesAsync();
111              var tableName = await CreateTempTable(conn, $&quot;created_by {schemaName}.citext NOT NULL&quot;);
112              const string expected = &quot;SomeValue&quot;;
113              await conn.ExecuteNonQueryAsync($&quot;INSERT INTO \&quot;{tableName}\&quot; VALUES(&#x27;{expected}&#x27;)&quot;);
114              var value = (string?)await conn.ExecuteScalarAsync($&quot;SELECT created_by FROM \&quot;{tableName}\&quot; LIMIT 1&quot;);
115              Assert.That(value, Is.EqualTo(expected));
116          }
117          finally
118          {
119              await conn.ExecuteNonQueryAsync(@&quot;DROP EXTENSION citext CASCADE&quot;);
120          }
121      }
122      #region Support
123      class CitextToStringTypeHandlerResolverFactory : TypeHandlerResolverFactory
124      {
125          public override TypeHandlerResolver Create(TypeMapper typeMapper, NpgsqlConnector connector)
126              =&gt; new CitextToStringTypeHandlerResolver(connector);
127          class CitextToStringTypeHandlerResolver : TypeHandlerResolver
128          {
129              readonly NpgsqlConnector _connector;
130              readonly PostgresType _pgCitextType;
131              public CitextToStringTypeHandlerResolver(NpgsqlConnector connector)
132              {
133                  _connector = connector;
134                  _pgCitextType = connector.DatabaseInfo.GetPostgresTypeByName(&quot;citext&quot;);
135              }
136              public override NpgsqlTypeHandler? ResolveByClrType(Type type)
137                  =&gt; type == typeof(string) ? new TextHandler(_pgCitextType, _connector.TextEncoding) : null;
138              public override NpgsqlTypeHandler? ResolveByDataTypeName(string typeName) =&gt; null;
139          }
140      }
141      enum Mood { Sad, Ok, Happy }
142      #endregion Support
143  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-DatePickerTests.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-TypeMapperTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>706              var picker = comp.Instance;
707              await picker.Open();
708              if (now.Day != 20)
</pre></code></div>
                <div class="column column_space"><pre><code>79          var connId = connection2.ProcessID;
80          await connection2.CloseAsync();
81          await connection2.OpenAsync();
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    