
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 15, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudTimePicker.razor.cs</h3>
            <pre><code>1  using System;
2  using System.Diagnostics.CodeAnalysis;
3  using System.Globalization;
4  using System.Text.RegularExpressions;
5  using System.Threading.Tasks;
6  using Microsoft.AspNetCore.Components;
7  using Microsoft.AspNetCore.Components.Web;
8  using MudBlazor.Extensions;
9  using MudBlazor.Services;
10  using MudBlazor.Utilities;
11  namespace MudBlazor
12  {
13      public partial class MudTimePicker : MudPicker<TimeSpan?>
14      {
15          private const string format24Hours = "HH:mm";
16          private const string format12Hours = "hh:mm tt";
17          public MudTimePicker() : base(new DefaultConverter<TimeSpan?>())
18          {
19              Converter.GetFunc = OnGet;
20              Converter.SetFunc = OnSet;
21              ((DefaultConverter<TimeSpan?>)Converter).Format = format24Hours;
22              AdornmentIcon = Icons.Material.Filled.AccessTime;
23              AdornmentAriaLabel = "Open Time Picker";
24          }
25          private string OnSet(TimeSpan? timespan)
26          {
27              if (timespan == null)
28                  return string.Empty;
29              var time = DateTime.Today.Add(timespan.Value);
30              return time.ToString(((DefaultConverter<TimeSpan?>)Converter).Format, Culture);
31          }
32          private TimeSpan? OnGet(string value)
33          {
34              if (string.IsNullOrEmpty(value))
35                  return null;
36              if (DateTime.TryParseExact(value, ((DefaultConverter<TimeSpan?>)Converter).Format, Culture, DateTimeStyles.None, out var time))
37              {
38                  return time.TimeOfDay;
39              }
40              else
41              {
42                  var m = Regex.Match(value, "AM|PM", RegexOptions.IgnoreCase);
43                  if (m.Success)
44                  {
45                      return DateTime.ParseExact(value, format12Hours, CultureInfo.InvariantCulture).TimeOfDay;
46                  }
47                  else
48                  {
49                      return DateTime.ParseExact(value, format24Hours, CultureInfo.InvariantCulture).TimeOfDay;
50                  }
51              }
52          }
53          private bool _amPm = false;
54          private OpenTo _currentView;
55          private string _timeFormat = string.Empty;
56          internal TimeSpan? TimeIntermediate { get; private set; }
57          [Parameter]
58          [Category(CategoryTypes.FormComponent.PickerBehavior)]
59          public OpenTo OpenTo { get; set; } = OpenTo.Hours;
60          [Parameter]
61          [Category(CategoryTypes.FormComponent.PickerBehavior)]
62          public TimeEditMode TimeEditMode { get; set; } = TimeEditMode.Normal;
63          [Parameter]
64          [Category(CategoryTypes.FormComponent.PickerBehavior)]
65          public int ClosingDelay { get; set; } = 200;
66          [Parameter]
67          [Category(CategoryTypes.FormComponent.PickerBehavior)]
68          public bool AutoClose { get; set; }
69          [Parameter]
70          [Category(CategoryTypes.FormComponent.Behavior)]
71          public bool AmPm
72          {
73              get => _amPm;
74              set
75              {
76                  if (value == _amPm)
77                      return;
78                  _amPm = value;
79                  if (Converter is DefaultConverter<TimeSpan?> defaultConverter && string.IsNullOrWhiteSpace(_timeFormat))
80                  {
81                      defaultConverter.Format = AmPm ? format12Hours : format24Hours;
82                  }
83                  Touched = true;
84                  SetTextAsync(Converter.Set(_value), false).AndForget();
85              }
86          }
87          [Parameter]
88          [Category(CategoryTypes.FormComponent.Behavior)]
89          public string TimeFormat
90          {
91              get => _timeFormat;
92              set
93              {
94                  if (_timeFormat == value)
95                      return;
96                  _timeFormat = value;
97                  if (Converter is DefaultConverter<TimeSpan?> defaultConverter)
98                      defaultConverter.Format = _timeFormat;
99                  Touched = true;
100                  SetTextAsync(Converter.Set(_value), false).AndForget();
101              }
102          }
103          [Parameter]
104          [Category(CategoryTypes.FormComponent.Data)]
105          public TimeSpan? Time
106          {
107              get => _value;
108              set => SetTimeAsync(value, true).AndForget();
109          }
110          protected async Task SetTimeAsync(TimeSpan? time, bool updateValue)
111          {
112              if (_value != time)
113              {
114                  Touched = true;
115                  TimeIntermediate = time;
116                  _value = time;
117                  if (updateValue)
118                      await SetTextAsync(Converter.Set(_value), false);
119                  UpdateTimeSetFromTime();
120                  await TimeChanged.InvokeAsync(_value);
121                  await BeginValidateAsync();
122                  FieldChanged(_value);
123              }
124          }
125          [Parameter] public EventCallback<TimeSpan?> TimeChanged { get; set; }
126          protected override Task StringValueChanged(string value)
127          {
128              Touched = true;
129              return SetTimeAsync(Converter.Get(value), false);
130          }
131          [ExcludeFromCodeCoverage]
132          protected override void OnPickerOpened()
133          {
134              base.OnPickerOpened();
135              _currentView = TimeEditMode switch
136              {
137                  TimeEditMode.Normal => OpenTo,
138                  TimeEditMode.OnlyHours => OpenTo.Hours,
139                  TimeEditMode.OnlyMinutes => OpenTo.Minutes,
140                  _ => _currentView
141              };
142          }
143          protected internal override void Submit()
144          {
145              if (GetReadOnlyState())
146                  return;
147              Time = TimeIntermediate;
148          }
149          public override async void Clear(bool close = true)
150          {
151              TimeIntermediate = null;
152              await SetTimeAsync(null, true);
153              if (AutoClose == true)
154              {
155                  Close(false);
156              }
157          }
158          private string GetHourString()
159          {
160              if (TimeIntermediate == null)
161                  return "--";
162              var h = AmPm ? TimeIntermediate.Value.ToAmPmHour() : TimeIntermediate.Value.Hours;
163              return Math.Min(23, Math.Max(0, h)).ToString(CultureInfo.InvariantCulture);
164          }
165          private string GetMinuteString()
166          {
167              if (TimeIntermediate == null)
168                  return "--";
169              return $"{Math.Min(59, Math.Max(0, TimeIntermediate.Value.Minutes)):D2}";
170          }
171          private void UpdateTime()
172          {
173              TimeIntermediate = new TimeSpan(_timeSet.Hour, _timeSet.Minute, 0);
174              if((PickerVariant == PickerVariant.Static && PickerActions == null) || (PickerActions != null && AutoClose))
175              {
176                  Submit();
177              }
178          }
179          private void OnHourClick()
180          {
181              _currentView = OpenTo.Hours;
<span onclick='openModal()' class='match'>182              FocusAsync().AndForget();
183          }
184          private void OnMinutesClick()
185          {
186              _currentView = OpenTo.Minutes;
</span>187              FocusAsync().AndForget();
188          }
189          private void OnAmClicked()
190          {
191              _timeSet.Hour %= 12;  
192              UpdateTime();
193              FocusAsync().AndForget();
194          }
195          private void OnPmClicked()
196          {
197              if (_timeSet.Hour <= 12) 
198                  _timeSet.Hour += 12;
199              _timeSet.Hour %= 24;
200              UpdateTime();
201              FocusAsync().AndForget();
202          }
203          protected string ToolbarClass =>
204          new CssBuilder("mud-picker-timepicker-toolbar")
205            .AddClass($"mud-picker-timepicker-toolbar-landscape", Orientation == Orientation.Landscape && PickerVariant == PickerVariant.Static)
206            .AddClass(Class)
207          .Build();
208          protected string HoursButtonClass =>
209          new CssBuilder("mud-timepicker-button")
210            .AddClass($"mud-timepicker-toolbar-text", _currentView == OpenTo.Minutes)
211          .Build();
212          protected string MinuteButtonClass =>
213          new CssBuilder("mud-timepicker-button")
214            .AddClass($"mud-timepicker-toolbar-text", _currentView == OpenTo.Hours)
215          .Build();
216          protected string AmButtonClass =>
217          new CssBuilder("mud-timepicker-button")
218            .AddClass($"mud-timepicker-toolbar-text", !IsAm) 
219          .Build();
220          protected string PmButtonClass =>
221          new CssBuilder("mud-timepicker-button")
222            .AddClass($"mud-timepicker-toolbar-text", !IsPm) 
223          .Build();
224          private string HourDialClass =>
225          new CssBuilder("mud-time-picker-hour")
226            .AddClass($"mud-time-picker-dial")
227            .AddClass($"mud-time-picker-dial-out", _currentView != OpenTo.Hours)
228            .AddClass($"mud-time-picker-dial-hidden", _currentView != OpenTo.Hours)
229          .Build();
230          private string MinuteDialClass =>
231          new CssBuilder("mud-time-picker-minute")
232            .AddClass($"mud-time-picker-dial")
233            .AddClass($"mud-time-picker-dial-out", _currentView != OpenTo.Minutes)
234            .AddClass($"mud-time-picker-dial-hidden", _currentView != OpenTo.Minutes)
235          .Build();
236          private bool IsAm => _timeSet.Hour >= 00 && _timeSet.Hour < 12; 
237          private bool IsPm => _timeSet.Hour >= 12 && _timeSet.Hour < 24; 
238          private string GetClockPinColor()
239          {
240              return $"mud-picker-time-clock-pin mud-{Color.ToDescriptionString()}";
241          }
242          private string GetClockPointerColor()
243          {
244              if (MouseDown)
245                  return $"mud-picker-time-clock-pointer mud-{Color.ToDescriptionString()}";
246              else
247                  return $"mud-picker-time-clock-pointer mud-picker-time-clock-pointer-animation mud-{Color.ToDescriptionString()}";
248          }
249          private string GetClockPointerThumbColor()
250          {
251              var deg = GetDeg();
252              if (deg % 30 == 0)
253                  return $"mud-picker-time-clock-pointer-thumb mud-onclock-text mud-onclock-primary mud-{Color.ToDescriptionString()}";
254              else
255                  return $"mud-picker-time-clock-pointer-thumb mud-onclock-minute mud-{Color.ToDescriptionString()}-text";
256          }
257          private string GetNumberColor(int value)
258          {
259              if (_currentView == OpenTo.Hours)
260              {
261                  var h = _timeSet.Hour;
262                  if (AmPm)
263                  {
264                      h = _timeSet.Hour % 12;
265                      if (_timeSet.Hour % 12 == 0)
266                          h = 12;
267                  }
268                  if (h == value)
269                      return $"mud-clock-number mud-theme-{Color.ToDescriptionString()}";
270              }
271              else if (_currentView == OpenTo.Minutes && _timeSet.Minute == value)
272              {
273                  return $"mud-clock-number mud-theme-{Color.ToDescriptionString()}";
274              }
275              return $"mud-clock-number";
276          }
277          private double GetDeg()
278          {
279              double deg = 0;
280              if (_currentView == OpenTo.Hours)
281                  deg = (_timeSet.Hour * 30) % 360;
282              if (_currentView == OpenTo.Minutes)
283                  deg = (_timeSet.Minute * 6) % 360;
284              return deg;
285          }
286          private string GetTransform(double angle, double radius, double offsetX, double offsetY)
287          {
288              angle = angle / 180 * Math.PI;
289              var x = (Math.Sin(angle) * radius + offsetX).ToString("F3", CultureInfo.InvariantCulture);
290              var y = ((Math.Cos(angle) + 1) * radius + offsetY).ToString("F3", CultureInfo.InvariantCulture);
291              return $"transform: translate({x}px, {y}px);";
292          }
293          private string GetPointerRotation()
294          {
295              double deg = 0;
296              if (_currentView == OpenTo.Hours)
297                  deg = (_timeSet.Hour * 30) % 360;
298              if (_currentView == OpenTo.Minutes)
299                  deg = (_timeSet.Minute * 6) % 360;
300              return $"rotateZ({deg}deg);";
301          }
302          private string GetPointerHeight()
303          {
304              var height = 40;
305              if (_currentView == OpenTo.Minutes)
306                  height = 40;
307              if (_currentView == OpenTo.Hours)
308              {
309                  if (!AmPm && _timeSet.Hour > 0 && _timeSet.Hour < 13)
310                      height = 26;
311                  else
312                      height = 40;
313              }
314              return $"{height}%;";
315          }
316          private readonly SetTime _timeSet = new();
317          private int _initialHour;
318          private int _initialMinute;
319          protected override void OnInitialized()
320          {
321              base.OnInitialized();
322              UpdateTimeSetFromTime();
323              _currentView = OpenTo;
324              _initialHour = _timeSet.Hour;
325              _initialMinute = _timeSet.Minute;
326          }
327          private void UpdateTimeSetFromTime()
328          {
329              if (TimeIntermediate == null)
330              {
331                  _timeSet.Hour = 0;
332                  _timeSet.Minute = 0;
333                  return;
334              }
335              _timeSet.Hour = TimeIntermediate.Value.Hours;
336              _timeSet.Minute = TimeIntermediate.Value.Minutes;
337          }
338          public bool MouseDown { get; set; }
339          private void OnMouseDown(MouseEventArgs e)
340          {
341              MouseDown = true;
342          }
343          private void OnMouseUp(MouseEventArgs e)
344          {
345              if (MouseDown && _currentView == OpenTo.Minutes && _timeSet.Minute != _initialMinute || _currentView == OpenTo.Hours && _timeSet.Hour != _initialHour && TimeEditMode == TimeEditMode.OnlyHours)
346              {
347                  MouseDown = false;
348                  SubmitAndClose();
349              }
350              MouseDown = false;
351              if (_currentView == OpenTo.Hours && _timeSet.Hour != _initialHour && TimeEditMode == TimeEditMode.Normal)
352              {
353                  _currentView = OpenTo.Minutes;
354              }
355          }
356          private void OnMouseOverHour(int value)
357          {
358              if (MouseDown)
359              {
360                  _timeSet.Hour = value;
361                  UpdateTime();
362              }
363          }
364          private void OnMouseClickHour(int value)
365          {
366              var h = value;
367              if (AmPm)
368              {
369                  if (IsAm && value == 12)
370                      h = 0;
371                  else if (IsPm && value < 12)
372                      h = value + 12;
373              }
374              _timeSet.Hour = h;
375              if(_currentView == OpenTo.Hours)
376              {
377                  UpdateTime();
378              }
379              if (TimeEditMode == TimeEditMode.Normal)
380              {
381                  _currentView = OpenTo.Minutes;
382              }
383              else if (TimeEditMode == TimeEditMode.OnlyHours)
384              {
385                  SubmitAndClose();
386              }
387          }
388          private void OnMouseOverMinute(int value)
389          {
390              if (MouseDown)
391              {
392                  _timeSet.Minute = value;
393                  UpdateTime();
394              }
395          }
396          private void OnMouseClickMinute(int value)
397          {
398              _timeSet.Minute = value;
399              UpdateTime();
400              SubmitAndClose();
401          }
402          protected async void SubmitAndClose()
403          {
404              if (PickerActions == null || AutoClose)
405              {
406                  Submit();
407                  if (PickerVariant != PickerVariant.Static)
408                  {
409                      await Task.Delay(ClosingDelay);
410                      Close(false);
411                  }
412              }
413          }
414          protected internal override void HandleKeyDown(KeyboardEventArgs obj)
415          {
416              if (GetDisabledState() || GetReadOnlyState())
417                  return;
418              base.HandleKeyDown(obj);
419              switch (obj.Key)
420              {
421                  case "ArrowRight":
422                      if (IsOpen)
423                      {
424                          if (obj.CtrlKey == true)
425                          {
426                              ChangeHour(1);
427                          }
428                          else if (obj.ShiftKey == true)
429                          {
430                              if (_timeSet.Minute > 55)
431                              {
432                                  ChangeHour(1);
433                              }
434                              ChangeMinute(5);
435                          }
436                          else
437                          {
438                              if (_timeSet.Minute == 59)
439                              {
440                                  ChangeHour(1);
441                              }
442                              ChangeMinute(1);
443                          }
444                      }
445                      break;
446                  case "ArrowLeft":
447                      if (IsOpen)
448                      {
449                          if (obj.CtrlKey == true)
450                          {
451                              ChangeHour(-1);
452                          }
453                          else if (obj.ShiftKey == true)
454                          {
455                              if (_timeSet.Minute < 5)
456                              {
457                                  ChangeHour(-1);
458                              }
459                              ChangeMinute(-5);
460                          }
461                          else
462                          {
463                              if (_timeSet.Minute == 0)
464                              {
465                                  ChangeHour(-1);
466                              }
467                              ChangeMinute(-1);
468                          }
469                      }
470                      break;
471                  case "ArrowUp":
472                      if (IsOpen == false && Editable == false)
473                      {
474                          IsOpen = true;
475                      }
476                      else if (obj.AltKey == true)
477                      {
478                          IsOpen = false;
479                      }
480                      else if (obj.ShiftKey == true)
481                      {
482                          ChangeHour(5);
483                      }
484                      else
485                      {
486                          ChangeHour(1);
487                      }
488                      break;
489                  case "ArrowDown":
490                      if (IsOpen == false && Editable == false)
491                      {
492                          IsOpen = true;
493                      }
494                      else if (obj.ShiftKey == true)
495                      {
496                          ChangeHour(-5);
497                      }
498                      else
499                      {
500                          ChangeHour(-1);
501                      }
502                      break;
503                  case "Escape":
504                      ReturnTimeBackUp();
505                      break;
506                  case "Enter":
507                  case "NumpadEnter":
508                      if (!IsOpen)
509                      {
510                          Open();
511                      }
512                      else
513                      {
514                          Submit();
515                          Close();
516                          _inputReference?.SetText(Text);
517                      }
518                      break;
519                  case " ":
520                      if (!Editable)
521                      {
522                          if (!IsOpen)
523                          {
524                              Open();
525                          }
526                          else
527                          {
528                              Submit();
529                              Close();
530                              _inputReference?.SetText(Text);
531                          }
532                      }
533                      break;
534              }
535              StateHasChanged();
536          }
537          protected void ChangeMinute(int val)
538          {
539              _currentView = OpenTo.Minutes;
540              _timeSet.Minute = (_timeSet.Minute + val + 60) % 60;
541              UpdateTime();
542          }
543          protected void ChangeHour(int val)
544          {
545              _currentView = OpenTo.Hours;
546              _timeSet.Hour = (_timeSet.Hour + val + 24) % 24;
547              UpdateTime();
548          }
549          protected void ReturnTimeBackUp()
550          {
551              if (Time == null)
552              {
553                  TimeIntermediate = null;
554              }
555              else
556              {
557                  _timeSet.Hour = Time.Value.Hours;
558                  _timeSet.Minute = Time.Value.Minutes;
559                  UpdateTime();
560              }
561          }
562          private class SetTime
563          {
564              public int Hour { get; set; }
565              public int Minute { get; set; }
566          }
567      }
568  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudTimePicker.razor.cs</h3>
            <pre><code>1  using System;
2  using System.Diagnostics.CodeAnalysis;
3  using System.Globalization;
4  using System.Text.RegularExpressions;
5  using System.Threading.Tasks;
6  using Microsoft.AspNetCore.Components;
7  using Microsoft.AspNetCore.Components.Web;
8  using MudBlazor.Extensions;
9  using MudBlazor.Services;
10  using MudBlazor.Utilities;
11  namespace MudBlazor
12  {
13      public partial class MudTimePicker : MudPicker<TimeSpan?>
14      {
15          private const string format24Hours = "HH:mm";
16          private const string format12Hours = "hh:mm tt";
17          public MudTimePicker() : base(new DefaultConverter<TimeSpan?>())
18          {
19              Converter.GetFunc = OnGet;
20              Converter.SetFunc = OnSet;
21              ((DefaultConverter<TimeSpan?>)Converter).Format = format24Hours;
22              AdornmentIcon = Icons.Material.Filled.AccessTime;
23              AdornmentAriaLabel = "Open Time Picker";
24          }
25          private string OnSet(TimeSpan? timespan)
26          {
27              if (timespan == null)
28                  return string.Empty;
29              var time = DateTime.Today.Add(timespan.Value);
30              return time.ToString(((DefaultConverter<TimeSpan?>)Converter).Format, Culture);
31          }
32          private TimeSpan? OnGet(string value)
33          {
34              if (string.IsNullOrEmpty(value))
35                  return null;
36              if (DateTime.TryParseExact(value, ((DefaultConverter<TimeSpan?>)Converter).Format, Culture, DateTimeStyles.None, out var time))
37              {
38                  return time.TimeOfDay;
39              }
40              else
41              {
42                  var m = Regex.Match(value, "AM|PM", RegexOptions.IgnoreCase);
43                  if (m.Success)
44                  {
45                      return DateTime.ParseExact(value, format12Hours, CultureInfo.InvariantCulture).TimeOfDay;
46                  }
47                  else
48                  {
49                      return DateTime.ParseExact(value, format24Hours, CultureInfo.InvariantCulture).TimeOfDay;
50                  }
51              }
52          }
53          private bool _amPm = false;
54          private OpenTo _currentView;
55          private string _timeFormat = string.Empty;
56          internal TimeSpan? TimeIntermediate { get; private set; }
57          [Parameter]
58          [Category(CategoryTypes.FormComponent.PickerBehavior)]
59          public OpenTo OpenTo { get; set; } = OpenTo.Hours;
60          [Parameter]
61          [Category(CategoryTypes.FormComponent.PickerBehavior)]
62          public TimeEditMode TimeEditMode { get; set; } = TimeEditMode.Normal;
63          [Parameter]
64          [Category(CategoryTypes.FormComponent.PickerBehavior)]
65          public int ClosingDelay { get; set; } = 200;
66          [Parameter]
67          [Category(CategoryTypes.FormComponent.PickerBehavior)]
68          public bool AutoClose { get; set; }
69          [Parameter]
70          [Category(CategoryTypes.FormComponent.Behavior)]
71          public bool AmPm
72          {
73              get => _amPm;
74              set
75              {
76                  if (value == _amPm)
77                      return;
78                  _amPm = value;
79                  if (Converter is DefaultConverter<TimeSpan?> defaultConverter && string.IsNullOrWhiteSpace(_timeFormat))
80                  {
81                      defaultConverter.Format = AmPm ? format12Hours : format24Hours;
82                  }
83                  Touched = true;
84                  SetTextAsync(Converter.Set(_value), false).AndForget();
85              }
86          }
87          [Parameter]
88          [Category(CategoryTypes.FormComponent.Behavior)]
89          public string TimeFormat
90          {
91              get => _timeFormat;
92              set
93              {
94                  if (_timeFormat == value)
95                      return;
96                  _timeFormat = value;
97                  if (Converter is DefaultConverter<TimeSpan?> defaultConverter)
98                      defaultConverter.Format = _timeFormat;
99                  Touched = true;
100                  SetTextAsync(Converter.Set(_value), false).AndForget();
101              }
102          }
103          [Parameter]
104          [Category(CategoryTypes.FormComponent.Data)]
105          public TimeSpan? Time
106          {
107              get => _value;
108              set => SetTimeAsync(value, true).AndForget();
109          }
110          protected async Task SetTimeAsync(TimeSpan? time, bool updateValue)
111          {
112              if (_value != time)
113              {
114                  Touched = true;
115                  TimeIntermediate = time;
116                  _value = time;
117                  if (updateValue)
118                      await SetTextAsync(Converter.Set(_value), false);
119                  UpdateTimeSetFromTime();
120                  await TimeChanged.InvokeAsync(_value);
121                  await BeginValidateAsync();
122                  FieldChanged(_value);
123              }
124          }
125          [Parameter] public EventCallback<TimeSpan?> TimeChanged { get; set; }
126          protected override Task StringValueChanged(string value)
127          {
128              Touched = true;
129              return SetTimeAsync(Converter.Get(value), false);
130          }
131          [ExcludeFromCodeCoverage]
132          protected override void OnPickerOpened()
133          {
134              base.OnPickerOpened();
135              _currentView = TimeEditMode switch
136              {
137                  TimeEditMode.Normal => OpenTo,
138                  TimeEditMode.OnlyHours => OpenTo.Hours,
139                  TimeEditMode.OnlyMinutes => OpenTo.Minutes,
140                  _ => _currentView
141              };
142          }
143          protected internal override void Submit()
144          {
145              if (GetReadOnlyState())
146                  return;
147              Time = TimeIntermediate;
148          }
149          public override async void Clear(bool close = true)
150          {
151              TimeIntermediate = null;
152              await SetTimeAsync(null, true);
153              if (AutoClose == true)
154              {
155                  Close(false);
156              }
157          }
158          private string GetHourString()
159          {
160              if (TimeIntermediate == null)
161                  return "--";
162              var h = AmPm ? TimeIntermediate.Value.ToAmPmHour() : TimeIntermediate.Value.Hours;
163              return Math.Min(23, Math.Max(0, h)).ToString(CultureInfo.InvariantCulture);
164          }
165          private string GetMinuteString()
166          {
167              if (TimeIntermediate == null)
168                  return "--";
169              return $"{Math.Min(59, Math.Max(0, TimeIntermediate.Value.Minutes)):D2}";
170          }
171          private void UpdateTime()
172          {
173              TimeIntermediate = new TimeSpan(_timeSet.Hour, _timeSet.Minute, 0);
174              if((PickerVariant == PickerVariant.Static && PickerActions == null) || (PickerActions != null && AutoClose))
175              {
176                  Submit();
177              }
178          }
179          private void OnHourClick()
180          {
181              _currentView = OpenTo.Hours;
182              FocusAsync().AndForget();
183          }
184          private void OnMinutesClick()
185          {
186              _currentView = OpenTo.Minutes;
187              FocusAsync().AndForget();
188          }
189          private void OnAmClicked()
190          {
191              _timeSet.Hour %= 12;  
192              UpdateTime();
<span onclick='openModal()' class='match'>193              FocusAsync().AndForget();
194          }
195          private void OnPmClicked()
196          {
197              if (_timeSet.Hour <= 12) 
</span>198                  _timeSet.Hour += 12;
199              _timeSet.Hour %= 24;
200              UpdateTime();
201              FocusAsync().AndForget();
202          }
203          protected string ToolbarClass =>
204          new CssBuilder("mud-picker-timepicker-toolbar")
205            .AddClass($"mud-picker-timepicker-toolbar-landscape", Orientation == Orientation.Landscape && PickerVariant == PickerVariant.Static)
206            .AddClass(Class)
207          .Build();
208          protected string HoursButtonClass =>
209          new CssBuilder("mud-timepicker-button")
210            .AddClass($"mud-timepicker-toolbar-text", _currentView == OpenTo.Minutes)
211          .Build();
212          protected string MinuteButtonClass =>
213          new CssBuilder("mud-timepicker-button")
214            .AddClass($"mud-timepicker-toolbar-text", _currentView == OpenTo.Hours)
215          .Build();
216          protected string AmButtonClass =>
217          new CssBuilder("mud-timepicker-button")
218            .AddClass($"mud-timepicker-toolbar-text", !IsAm) 
219          .Build();
220          protected string PmButtonClass =>
221          new CssBuilder("mud-timepicker-button")
222            .AddClass($"mud-timepicker-toolbar-text", !IsPm) 
223          .Build();
224          private string HourDialClass =>
225          new CssBuilder("mud-time-picker-hour")
226            .AddClass($"mud-time-picker-dial")
227            .AddClass($"mud-time-picker-dial-out", _currentView != OpenTo.Hours)
228            .AddClass($"mud-time-picker-dial-hidden", _currentView != OpenTo.Hours)
229          .Build();
230          private string MinuteDialClass =>
231          new CssBuilder("mud-time-picker-minute")
232            .AddClass($"mud-time-picker-dial")
233            .AddClass($"mud-time-picker-dial-out", _currentView != OpenTo.Minutes)
234            .AddClass($"mud-time-picker-dial-hidden", _currentView != OpenTo.Minutes)
235          .Build();
236          private bool IsAm => _timeSet.Hour >= 00 && _timeSet.Hour < 12; 
237          private bool IsPm => _timeSet.Hour >= 12 && _timeSet.Hour < 24; 
238          private string GetClockPinColor()
239          {
240              return $"mud-picker-time-clock-pin mud-{Color.ToDescriptionString()}";
241          }
242          private string GetClockPointerColor()
243          {
244              if (MouseDown)
245                  return $"mud-picker-time-clock-pointer mud-{Color.ToDescriptionString()}";
246              else
247                  return $"mud-picker-time-clock-pointer mud-picker-time-clock-pointer-animation mud-{Color.ToDescriptionString()}";
248          }
249          private string GetClockPointerThumbColor()
250          {
251              var deg = GetDeg();
252              if (deg % 30 == 0)
253                  return $"mud-picker-time-clock-pointer-thumb mud-onclock-text mud-onclock-primary mud-{Color.ToDescriptionString()}";
254              else
255                  return $"mud-picker-time-clock-pointer-thumb mud-onclock-minute mud-{Color.ToDescriptionString()}-text";
256          }
257          private string GetNumberColor(int value)
258          {
259              if (_currentView == OpenTo.Hours)
260              {
261                  var h = _timeSet.Hour;
262                  if (AmPm)
263                  {
264                      h = _timeSet.Hour % 12;
265                      if (_timeSet.Hour % 12 == 0)
266                          h = 12;
267                  }
268                  if (h == value)
269                      return $"mud-clock-number mud-theme-{Color.ToDescriptionString()}";
270              }
271              else if (_currentView == OpenTo.Minutes && _timeSet.Minute == value)
272              {
273                  return $"mud-clock-number mud-theme-{Color.ToDescriptionString()}";
274              }
275              return $"mud-clock-number";
276          }
277          private double GetDeg()
278          {
279              double deg = 0;
280              if (_currentView == OpenTo.Hours)
281                  deg = (_timeSet.Hour * 30) % 360;
282              if (_currentView == OpenTo.Minutes)
283                  deg = (_timeSet.Minute * 6) % 360;
284              return deg;
285          }
286          private string GetTransform(double angle, double radius, double offsetX, double offsetY)
287          {
288              angle = angle / 180 * Math.PI;
289              var x = (Math.Sin(angle) * radius + offsetX).ToString("F3", CultureInfo.InvariantCulture);
290              var y = ((Math.Cos(angle) + 1) * radius + offsetY).ToString("F3", CultureInfo.InvariantCulture);
291              return $"transform: translate({x}px, {y}px);";
292          }
293          private string GetPointerRotation()
294          {
295              double deg = 0;
296              if (_currentView == OpenTo.Hours)
297                  deg = (_timeSet.Hour * 30) % 360;
298              if (_currentView == OpenTo.Minutes)
299                  deg = (_timeSet.Minute * 6) % 360;
300              return $"rotateZ({deg}deg);";
301          }
302          private string GetPointerHeight()
303          {
304              var height = 40;
305              if (_currentView == OpenTo.Minutes)
306                  height = 40;
307              if (_currentView == OpenTo.Hours)
308              {
309                  if (!AmPm && _timeSet.Hour > 0 && _timeSet.Hour < 13)
310                      height = 26;
311                  else
312                      height = 40;
313              }
314              return $"{height}%;";
315          }
316          private readonly SetTime _timeSet = new();
317          private int _initialHour;
318          private int _initialMinute;
319          protected override void OnInitialized()
320          {
321              base.OnInitialized();
322              UpdateTimeSetFromTime();
323              _currentView = OpenTo;
324              _initialHour = _timeSet.Hour;
325              _initialMinute = _timeSet.Minute;
326          }
327          private void UpdateTimeSetFromTime()
328          {
329              if (TimeIntermediate == null)
330              {
331                  _timeSet.Hour = 0;
332                  _timeSet.Minute = 0;
333                  return;
334              }
335              _timeSet.Hour = TimeIntermediate.Value.Hours;
336              _timeSet.Minute = TimeIntermediate.Value.Minutes;
337          }
338          public bool MouseDown { get; set; }
339          private void OnMouseDown(MouseEventArgs e)
340          {
341              MouseDown = true;
342          }
343          private void OnMouseUp(MouseEventArgs e)
344          {
345              if (MouseDown && _currentView == OpenTo.Minutes && _timeSet.Minute != _initialMinute || _currentView == OpenTo.Hours && _timeSet.Hour != _initialHour && TimeEditMode == TimeEditMode.OnlyHours)
346              {
347                  MouseDown = false;
348                  SubmitAndClose();
349              }
350              MouseDown = false;
351              if (_currentView == OpenTo.Hours && _timeSet.Hour != _initialHour && TimeEditMode == TimeEditMode.Normal)
352              {
353                  _currentView = OpenTo.Minutes;
354              }
355          }
356          private void OnMouseOverHour(int value)
357          {
358              if (MouseDown)
359              {
360                  _timeSet.Hour = value;
361                  UpdateTime();
362              }
363          }
364          private void OnMouseClickHour(int value)
365          {
366              var h = value;
367              if (AmPm)
368              {
369                  if (IsAm && value == 12)
370                      h = 0;
371                  else if (IsPm && value < 12)
372                      h = value + 12;
373              }
374              _timeSet.Hour = h;
375              if(_currentView == OpenTo.Hours)
376              {
377                  UpdateTime();
378              }
379              if (TimeEditMode == TimeEditMode.Normal)
380              {
381                  _currentView = OpenTo.Minutes;
382              }
383              else if (TimeEditMode == TimeEditMode.OnlyHours)
384              {
385                  SubmitAndClose();
386              }
387          }
388          private void OnMouseOverMinute(int value)
389          {
390              if (MouseDown)
391              {
392                  _timeSet.Minute = value;
393                  UpdateTime();
394              }
395          }
396          private void OnMouseClickMinute(int value)
397          {
398              _timeSet.Minute = value;
399              UpdateTime();
400              SubmitAndClose();
401          }
402          protected async void SubmitAndClose()
403          {
404              if (PickerActions == null || AutoClose)
405              {
406                  Submit();
407                  if (PickerVariant != PickerVariant.Static)
408                  {
409                      await Task.Delay(ClosingDelay);
410                      Close(false);
411                  }
412              }
413          }
414          protected internal override void HandleKeyDown(KeyboardEventArgs obj)
415          {
416              if (GetDisabledState() || GetReadOnlyState())
417                  return;
418              base.HandleKeyDown(obj);
419              switch (obj.Key)
420              {
421                  case "ArrowRight":
422                      if (IsOpen)
423                      {
424                          if (obj.CtrlKey == true)
425                          {
426                              ChangeHour(1);
427                          }
428                          else if (obj.ShiftKey == true)
429                          {
430                              if (_timeSet.Minute > 55)
431                              {
432                                  ChangeHour(1);
433                              }
434                              ChangeMinute(5);
435                          }
436                          else
437                          {
438                              if (_timeSet.Minute == 59)
439                              {
440                                  ChangeHour(1);
441                              }
442                              ChangeMinute(1);
443                          }
444                      }
445                      break;
446                  case "ArrowLeft":
447                      if (IsOpen)
448                      {
449                          if (obj.CtrlKey == true)
450                          {
451                              ChangeHour(-1);
452                          }
453                          else if (obj.ShiftKey == true)
454                          {
455                              if (_timeSet.Minute < 5)
456                              {
457                                  ChangeHour(-1);
458                              }
459                              ChangeMinute(-5);
460                          }
461                          else
462                          {
463                              if (_timeSet.Minute == 0)
464                              {
465                                  ChangeHour(-1);
466                              }
467                              ChangeMinute(-1);
468                          }
469                      }
470                      break;
471                  case "ArrowUp":
472                      if (IsOpen == false && Editable == false)
473                      {
474                          IsOpen = true;
475                      }
476                      else if (obj.AltKey == true)
477                      {
478                          IsOpen = false;
479                      }
480                      else if (obj.ShiftKey == true)
481                      {
482                          ChangeHour(5);
483                      }
484                      else
485                      {
486                          ChangeHour(1);
487                      }
488                      break;
489                  case "ArrowDown":
490                      if (IsOpen == false && Editable == false)
491                      {
492                          IsOpen = true;
493                      }
494                      else if (obj.ShiftKey == true)
495                      {
496                          ChangeHour(-5);
497                      }
498                      else
499                      {
500                          ChangeHour(-1);
501                      }
502                      break;
503                  case "Escape":
504                      ReturnTimeBackUp();
505                      break;
506                  case "Enter":
507                  case "NumpadEnter":
508                      if (!IsOpen)
509                      {
510                          Open();
511                      }
512                      else
513                      {
514                          Submit();
515                          Close();
516                          _inputReference?.SetText(Text);
517                      }
518                      break;
519                  case " ":
520                      if (!Editable)
521                      {
522                          if (!IsOpen)
523                          {
524                              Open();
525                          }
526                          else
527                          {
528                              Submit();
529                              Close();
530                              _inputReference?.SetText(Text);
531                          }
532                      }
533                      break;
534              }
535              StateHasChanged();
536          }
537          protected void ChangeMinute(int val)
538          {
539              _currentView = OpenTo.Minutes;
540              _timeSet.Minute = (_timeSet.Minute + val + 60) % 60;
541              UpdateTime();
542          }
543          protected void ChangeHour(int val)
544          {
545              _currentView = OpenTo.Hours;
546              _timeSet.Hour = (_timeSet.Hour + val + 24) % 24;
547              UpdateTime();
548          }
549          protected void ReturnTimeBackUp()
550          {
551              if (Time == null)
552              {
553                  TimeIntermediate = null;
554              }
555              else
556              {
557                  _timeSet.Hour = Time.Value.Hours;
558                  _timeSet.Minute = Time.Value.Minutes;
559                  UpdateTime();
560              }
561          }
562          private class SetTime
563          {
564              public int Hour { get; set; }
565              public int Minute { get; set; }
566          }
567      }
568  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudTimePicker.razor.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-MudTimePicker.razor.cs</div>
                </div>
                <div class="column column_space"><pre><code>182              FocusAsync().AndForget();
183          }
184          private void OnMinutesClick()
185          {
186              _currentView = OpenTo.Minutes;
</pre></code></div>
                <div class="column column_space"><pre><code>193              FocusAsync().AndForget();
194          }
195          private void OnPmClicked()
196          {
197              if (_timeSet.Hour <= 12) 
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    