
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 15, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NpgsqlSchema.cs</h3>
            <pre><code>1  using System;
2  using System.Data;
3  using System.Data.Common;
4  using System.Globalization;
5  using System.Linq;
6  using System.Text;
7  using System.Threading;
8  using System.Threading.Tasks;
9  using Npgsql.PostgresTypes;
10  using NpgsqlTypes;
11  namespace Npgsql;
12  static class NpgsqlSchema
13  {
14      public static Task<DataTable> GetSchema(NpgsqlConnection conn, string? collectionName, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
15      {
16          if (collectionName is null)
17              throw new ArgumentNullException(nameof(collectionName));
18          if (collectionName.Length == 0)
19              throw new ArgumentException("Collection name cannot be empty.", nameof(collectionName));
20          return collectionName.ToUpperInvariant() switch
21          {
22              "METADATACOLLECTIONS"   => Task.FromResult(GetMetaDataCollections()),
23              "RESTRICTIONS"          => Task.FromResult(GetRestrictions()),
24              "DATASOURCEINFORMATION" => Task.FromResult(GetDataSourceInformation(conn)),
25              "DATATYPES"             => Task.FromResult(GetDataTypes(conn)),
26              "RESERVEDWORDS"         => Task.FromResult(GetReservedWords()),
27              "DATABASES"             => GetDatabases(conn, restrictions, async, cancellationToken),
28              "SCHEMATA"              => GetSchemata(conn, restrictions, async, cancellationToken),
29              "TABLES"                => GetTables(conn, restrictions, async, cancellationToken),
30              "COLUMNS"               => GetColumns(conn, restrictions, async, cancellationToken),
31              "VIEWS"                 => GetViews(conn, restrictions, async, cancellationToken),
32              "USERS"                 => GetUsers(conn, restrictions, async, cancellationToken),
33              "INDEXES"               => GetIndexes(conn, restrictions, async, cancellationToken),
34              "INDEXCOLUMNS"          => GetIndexColumns(conn, restrictions, async, cancellationToken),
35              "CONSTRAINTS"           => GetConstraints(conn, restrictions, collectionName, async, cancellationToken),
36              "PRIMARYKEY"            => GetConstraints(conn, restrictions, collectionName, async, cancellationToken),
37              "UNIQUEKEYS"            => GetConstraints(conn, restrictions, collectionName, async, cancellationToken),
38              "FOREIGNKEYS"           => GetConstraints(conn, restrictions, collectionName, async, cancellationToken),
39              "CONSTRAINTCOLUMNS"     => GetConstraintColumns(conn, restrictions, async, cancellationToken),
40              _ => throw new ArgumentOutOfRangeException(nameof(collectionName), collectionName, "Invalid collection name.")
41          };
42      }
43      static DataTable GetMetaDataCollections()
44      {
45          var table = new DataTable("MetaDataCollections");
46          table.Columns.Add("CollectionName", typeof(string));
47          table.Columns.Add("NumberOfRestrictions", typeof(int));
48          table.Columns.Add("NumberOfIdentifierParts", typeof(int));
49          table.Rows.Add("MetaDataCollections", 0, 0);
50          table.Rows.Add("DataSourceInformation", 0, 0);
51          table.Rows.Add("Restrictions", 0, 0);
52          table.Rows.Add("DataTypes", 0, 0);  
53          table.Rows.Add("Databases", 1, 1);
54          table.Rows.Add("Tables", 4, 3);
55          table.Rows.Add("Columns", 4, 4);
56          table.Rows.Add("Views", 3, 3);
57          table.Rows.Add("Users", 1, 1);
58          table.Rows.Add("Indexes", 4, 4);
59          table.Rows.Add("IndexColumns", 5, 5);
60          return table;
61      }
62      static DataTable GetRestrictions()
63      {
64          var table = new DataTable("Restrictions");
65          table.Columns.Add("CollectionName", typeof(string));
66          table.Columns.Add("RestrictionName", typeof(string));
67          table.Columns.Add("RestrictionDefault", typeof(string));
68          table.Columns.Add("RestrictionNumber", typeof(int));
69          table.Rows.Add("Database", "Name", "Name", 1);
70          table.Rows.Add("Tables", "Catalog", "table_catalog", 1);
71          table.Rows.Add("Tables", "Schema", "schema_catalog", 2);
72          table.Rows.Add("Tables", "Table", "table_name", 3);
73          table.Rows.Add("Tables", "TableType", "table_type", 4);
74          table.Rows.Add("Columns", "Catalog", "table_catalog", 1);
75          table.Rows.Add("Columns", "Schema", "table_schema", 2);
76          table.Rows.Add("Columns", "TableName", "table_name", 3);
77          table.Rows.Add("Columns", "Column", "column_name", 4);
78          table.Rows.Add("Views", "Catalog", "table_catalog", 1);
79          table.Rows.Add("Views", "Schema", "table_schema", 2);
80          table.Rows.Add("Views", "Table", "table_name", 3);
81          table.Rows.Add("Users", "User", "user_name", 1);
82          table.Rows.Add("Indexes", "Catalog", "table_catalog", 1);
83          table.Rows.Add("Indexes", "Schema", "table_schema", 2);
84          table.Rows.Add("Indexes", "Table", "table_name", 3);
<span onclick='openModal()' class='match'>85          table.Rows.Add("Indexes", "Index", "index_name", 4);
86          table.Rows.Add("IndexColumns", "Catalog", "table_catalog", 1);
</span>87          table.Rows.Add("IndexColumns", "Schema", "table_schema", 2);
88          table.Rows.Add("IndexColumns", "Table", "table_name", 3);
89          table.Rows.Add("IndexColumns", "Index", "index_name", 4);
90          table.Rows.Add("IndexColumns", "Column", "column_name", 5);
91          return table;
92      }
93      static NpgsqlCommand BuildCommand(NpgsqlConnection conn, StringBuilder query, string?[]? restrictions, params string[]? names)
94          => BuildCommand(conn, query, restrictions, true, names);
95      static NpgsqlCommand BuildCommand(NpgsqlConnection conn, StringBuilder query, string?[]? restrictions, bool addWhere, params string[]? names)
96      {
97          var command = new NpgsqlCommand();
98          if (restrictions != null && names != null)
99          {
100              for (var i = 0; i < restrictions.Length && i < names.Length; ++i)
101              {
102                  if (restrictions[i] is string restriction && restriction.Length != 0)
103                  {
104                      if (addWhere)
105                      {
106                          query.Append(" WHERE ");
107                          addWhere = false;
108                      }
109                      else
110                      {
111                          query.Append(" AND ");
112                      }
113                      var paramName = RemoveSpecialChars(names[i]);
114                      query.AppendFormat("{0} = :{1}", names[i], paramName);
115                      command.Parameters.Add(new NpgsqlParameter(paramName, restriction));
116                  }
117              }
118          }
119          command.CommandText = query.ToString();
120          command.Connection = conn;
121          return command;
122      }
123      static string RemoveSpecialChars(string paramName)
124          => paramName.Replace("(", "").Replace(")", "").Replace(".", "");
125      static async Task<DataTable> GetDatabases(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
126      {
127          var databases = new DataTable("Databases") { Locale = CultureInfo.InvariantCulture };
128          databases.Columns.AddRange(new[] {
129              new DataColumn("database_name"),
130              new DataColumn("owner"),
131              new DataColumn("encoding")
132          });
133          var getDatabases = new StringBuilder();
134          getDatabases.Append("SELECT d.datname AS database_name, u.usename AS owner, pg_catalog.pg_encoding_to_char(d.encoding) AS encoding FROM pg_catalog.pg_database d LEFT JOIN pg_catalog.pg_user u ON d.datdba = u.usesysid");
135          using var command = BuildCommand(conn, getDatabases, restrictions, "datname");
136          using var adapter = new NpgsqlDataAdapter(command);
137          await adapter.Fill(databases, async, cancellationToken);
138          return databases;
139      }
140      static async Task<DataTable> GetSchemata(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
141      {
142          var schemata = new DataTable("Schemata") { Locale = CultureInfo.InvariantCulture };
143          schemata.Columns.AddRange(new[] {
144              new DataColumn("catalog_name"),
145              new DataColumn("schema_name"),
146              new DataColumn("schema_owner")
147          });
148          var getSchemata = new StringBuilder(@"
149  SELECT * FROM (
150      SELECT current_database() AS catalog_name,
151          nspname AS schema_name,
152          r.rolname AS schema_owner
153      FROM
154          pg_catalog.pg_namespace LEFT JOIN pg_catalog.pg_roles r ON r.oid = nspowner
155      ) tmp");
156          using var command = BuildCommand(conn, getSchemata, restrictions, "catalog_name", "schema_name", "schema_owner");
157          using var adapter = new NpgsqlDataAdapter(command);
158          await adapter.Fill(schemata, async, cancellationToken);
159          return schemata;
160      }
161      static async Task<DataTable> GetTables(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
162      {
163          var tables = new DataTable("Tables") { Locale = CultureInfo.InvariantCulture };
164          tables.Columns.AddRange(new[] {
165              new DataColumn("table_catalog"),
166              new DataColumn("table_schema"),
167              new DataColumn("table_name"),
168              new DataColumn("table_type")
169          });
170          var getTables = new StringBuilder();
171          getTables.Append(@"
172  SELECT table_catalog, table_schema, table_name, table_type
173  FROM information_schema.tables
174  WHERE
175      table_type IN ('BASE TABLE', 'FOREIGN', 'FOREIGN TABLE') AND
176      table_schema NOT IN ('pg_catalog', 'information_schema')");
177          using var command = BuildCommand(conn, getTables, restrictions, false, "table_catalog", "table_schema", "table_name", "table_type");
178          using var adapter = new NpgsqlDataAdapter(command);
179          await adapter.Fill(tables, async, cancellationToken);
180          return tables;
181      }
182      static async Task<DataTable> GetColumns(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
183      {
184          var columns = new DataTable("Columns") { Locale = CultureInfo.InvariantCulture };
185          columns.Columns.AddRange(new DataColumn[] {
186              new("table_catalog"), new("table_schema"), new("table_name"), new("column_name"),
187              new("ordinal_position", typeof(int)),
188              new("column_default"),
189              new("is_nullable"),
190              new("data_type"),
191              new("character_maximum_length", typeof(int)), new("character_octet_length", typeof(int)),
192              new("numeric_precision", typeof(int)), new("numeric_precision_radix", typeof(int)), new("numeric_scale", typeof(int)),
193              new("datetime_precision", typeof(int)),
194              new("character_set_catalog"), new("character_set_schema"), new("character_set_name"),
195              new("collation_catalog")
196          });
197          var getColumns = new StringBuilder(@"
198  SELECT
199      table_catalog, table_schema, table_name, column_name,
200      ordinal_position,
201      column_default,
202      is_nullable,
203      CASE WHEN udt_schema is NULL THEN udt_name ELSE format_type(typ.oid, NULL) END AS data_type,
204      character_maximum_length, character_octet_length,
205      numeric_precision, numeric_precision_radix, numeric_scale,
206      datetime_precision,
207      character_set_catalog, character_set_schema, character_set_name,
208      collation_catalog
209  FROM information_schema.columns
210  JOIN pg_namespace AS ns ON ns.nspname = udt_schema
211  JOIN pg_type AS typ ON typnamespace = ns.oid AND typname = udt_name");
212          using var command = BuildCommand(conn, getColumns, restrictions, "table_catalog", "table_schema", "table_name", "column_name");
213          using var adapter = new NpgsqlDataAdapter(command);
214          await adapter.Fill(columns, async, cancellationToken);
215          return columns;
216      }
217      static async Task<DataTable> GetViews(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
218      {
219          var views = new DataTable("Views") { Locale = CultureInfo.InvariantCulture };
220          views.Columns.AddRange(new[] {
221              new DataColumn("table_catalog"), new DataColumn("table_schema"), new DataColumn("table_name"),
222              new DataColumn("check_option"), new DataColumn("is_updatable")
223          });
224          var getViews = new StringBuilder(@"
225  SELECT table_catalog, table_schema, table_name, check_option, is_updatable
226  FROM information_schema.views
227  WHERE table_schema NOT IN ('pg_catalog', 'information_schema')");
228          using var command = BuildCommand(conn, getViews, restrictions, false, "table_catalog", "table_schema", "table_name");
229          using var adapter = new NpgsqlDataAdapter(command);
230          await adapter.Fill(views, async, cancellationToken);
231          return views;
232      }
233      static async Task<DataTable> GetUsers(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
234      {
235          var users = new DataTable("Users") { Locale = CultureInfo.InvariantCulture };
236          users.Columns.AddRange(new[] { new DataColumn("user_name"), new DataColumn("user_sysid", typeof(uint)) });
237          var getUsers = new StringBuilder();
238          getUsers.Append("SELECT usename as user_name, usesysid as user_sysid FROM pg_catalog.pg_user");
239          using var command = BuildCommand(conn, getUsers, restrictions, "usename");
240          using var adapter = new NpgsqlDataAdapter(command);
241          await adapter.Fill(users, async, cancellationToken);
242          return users;
243      }
244      static async Task<DataTable> GetIndexes(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
245      {
246          var indexes = new DataTable("Indexes") { Locale = CultureInfo.InvariantCulture };
247          indexes.Columns.AddRange(new[] {
248              new DataColumn("table_catalog"), new DataColumn("table_schema"), new DataColumn("table_name"),
249              new DataColumn("index_name"), new DataColumn("type_desc")
250          });
251          var getIndexes = new StringBuilder(@"
252  SELECT current_database() AS table_catalog,
253      n.nspname AS table_schema,
254      t.relname AS table_name,
255      i.relname AS index_name,
256      '' AS type_desc
257  FROM
258      pg_catalog.pg_class i
259      JOIN pg_catalog.pg_index ix ON ix.indexrelid = i.oid
260      JOIN pg_catalog.pg_class t ON ix.indrelid = t.oid
261      LEFT JOIN pg_catalog.pg_user u ON u.usesysid = i.relowner
262      LEFT JOIN pg_catalog.pg_namespace n ON n.oid = i.relnamespace
263  WHERE
264      i.relkind = 'i' AND
265      n.nspname NOT IN ('pg_catalog', 'pg_toast') AND
266      t.relkind = 'r'");
267          using var command = BuildCommand(conn, getIndexes, restrictions, false, "current_database()", "n.nspname", "t.relname", "i.relname");
268          using var adapter = new NpgsqlDataAdapter(command);
269          await adapter.Fill(indexes, async, cancellationToken);
270          return indexes;
271      }
272      static async Task<DataTable> GetIndexColumns(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
273      {
274          var indexColumns = new DataTable("IndexColumns") { Locale = CultureInfo.InvariantCulture };
275          indexColumns.Columns.AddRange(new[] {
276              new DataColumn("constraint_catalog"), new DataColumn("constraint_schema"), new DataColumn("constraint_name"),
277              new DataColumn("table_catalog"), new DataColumn("table_schema"), new DataColumn("table_name"),
278              new DataColumn("column_name"), new DataColumn("index_name")
279          });
280          var getIndexColumns = new StringBuilder(@"
281  SELECT
282      current_database() AS constraint_catalog,
283      t_ns.nspname AS constraint_schema,
284      ix_cls.relname AS constraint_name,
285      current_database() AS table_catalog,
286      ix_ns.nspname AS table_schema,
287      t.relname AS table_name,
288      a.attname AS column_name,
289      ix_cls.relname AS index_name
290  FROM
291      pg_class t
292      JOIN pg_index ix ON t.oid = ix.indrelid
293      JOIN pg_class ix_cls ON ix.indexrelid = ix_cls.oid
294      JOIN pg_attribute a ON t.oid = a.attrelid
295      LEFT JOIN pg_namespace t_ns ON t.relnamespace = t_ns.oid
296      LEFT JOIN pg_namespace ix_ns ON ix_cls.relnamespace = ix_ns.oid
297  WHERE
298      ix_cls.relkind = 'i' AND
299      t_ns.nspname NOT IN ('pg_catalog', 'pg_toast') AND
300      a.attnum = ANY(ix.indkey) AND
301      t.relkind = 'r'");
302          using var command = BuildCommand(conn, getIndexColumns, restrictions, false, "current_database()", "t_ns.nspname", "t.relname", "ix_cls.relname", "a.attname");
303          using var adapter = new NpgsqlDataAdapter(command);
304          await adapter.Fill(indexColumns, async, cancellationToken);
305          return indexColumns;
306      }
307      static async Task<DataTable> GetConstraints(NpgsqlConnection conn, string?[]? restrictions, string? constraintType, bool async, CancellationToken cancellationToken = default)
308      {
309          var getConstraints = new StringBuilder(@"
310  SELECT
311      current_database() AS ""CONSTRAINT_CATALOG"",
312      pgn.nspname AS ""CONSTRAINT_SCHEMA"",
313      pgc.conname AS ""CONSTRAINT_NAME"",
314      current_database() AS ""TABLE_CATALOG"",
315      pgtn.nspname AS ""TABLE_SCHEMA"",
316      pgt.relname AS ""TABLE_NAME"",
317      ""CONSTRAINT_TYPE"",
318      pgc.condeferrable AS ""IS_DEFERRABLE"",
319      pgc.condeferred AS ""INITIALLY_DEFERRED""
320  FROM
321      pg_catalog.pg_constraint pgc
322      JOIN pg_catalog.pg_namespace pgn ON pgc.connamespace = pgn.oid
323      JOIN pg_catalog.pg_class pgt ON pgc.conrelid = pgt.oid
324      JOIN pg_catalog.pg_namespace pgtn ON pgt.relnamespace = pgtn.oid
325      JOIN (
326          SELECT 'PRIMARY KEY' AS ""CONSTRAINT_TYPE"", 'p' AS ""contype""
327          UNION ALL
328          SELECT 'FOREIGN KEY' AS ""CONSTRAINT_TYPE"", 'f' AS ""contype""
329          UNION ALL
330          SELECT 'UNIQUE KEY' AS ""CONSTRAINT_TYPE"", 'u' AS ""contype""
331  ) mapping_table ON mapping_table.contype = pgc.contype");
332          if ("ForeignKeys".Equals(constraintType))
333              getConstraints.Append(" and pgc.contype='f'");
334          else if ("PrimaryKey".Equals(constraintType))
335              getConstraints.Append(" and pgc.contype='p'");
336          else if ("UniqueKeys".Equals(constraintType))
337              getConstraints.Append(" and pgc.contype='u'");
338          else
339              constraintType = "Constraints";
340          using var command = BuildCommand(conn, getConstraints, restrictions, false, "current_database()", "pgtn.nspname", "pgt.relname", "pgc.conname");
341          using var adapter = new NpgsqlDataAdapter(command);
342          var table = new DataTable(constraintType) { Locale = CultureInfo.InvariantCulture };
343          await adapter.Fill(table, async, cancellationToken);
344          return table;
345      }
346      static async Task<DataTable> GetConstraintColumns(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
347      {
348          var getConstraintColumns = new StringBuilder(@"
349  SELECT current_database() AS constraint_catalog,
350      n.nspname AS constraint_schema,
351      c.conname AS constraint_name,
352      current_database() AS table_catalog,
353      n.nspname AS table_schema,
354      t.relname AS table_name,
355      a.attname AS column_name,
356      a.attnum AS ordinal_number,
357      mapping_table.constraint_type
358  FROM pg_constraint c
359      JOIN pg_namespace n on n.oid = c.connamespace
360      JOIN pg_class t on t.oid = c.conrelid AND t.relkind = 'r'
361      JOIN pg_attribute a on t.oid = a.attrelid AND a.attnum = ANY(c.conkey)
362      JOIN (
363          SELECT 'PRIMARY KEY' AS constraint_type, 'p' AS contype
364          UNION ALL
365          SELECT 'FOREIGN KEY' AS constraint_type, 'f' AS contype
366          UNION ALL
367          SELECT 'UNIQUE KEY' AS constraint_type, 'u' AS contype
368  ) mapping_table ON
369      mapping_table.contype = c.contype
370      AND n.nspname NOT IN ('pg_catalog', 'pg_toast')");
371          using var command = BuildCommand(conn, getConstraintColumns, restrictions, false, "current_database()", "n.nspname", "t.relname", "c.conname", "a.attname");
372          using var adapter = new NpgsqlDataAdapter(command);
373          var table = new DataTable("ConstraintColumns") { Locale = CultureInfo.InvariantCulture };
374          await adapter.Fill(table, async, cancellationToken);
375          return table;
376      }
377      static DataTable GetDataSourceInformation(NpgsqlConnection conn)
378      {
379          var table = new DataTable("DataSourceInformation");
380          var row = table.Rows.Add();
381          table.Columns.Add("CompositeIdentifierSeparatorPattern", typeof(string));
382          table.Columns.Add("DataSourceProductName", typeof(string));
383          table.Columns.Add("DataSourceProductVersion", typeof(string));
384          table.Columns.Add("DataSourceProductVersionNormalized", typeof(string));
385          table.Columns.Add("GroupByBehavior", typeof(GroupByBehavior));
386          table.Columns.Add("IdentifierPattern", typeof(string));
387          table.Columns.Add("IdentifierCase", typeof(IdentifierCase));
388          table.Columns.Add("OrderByColumnsInSelect", typeof(bool));
389          table.Columns.Add("ParameterMarkerFormat", typeof(string));
390          table.Columns.Add("ParameterMarkerPattern", typeof(string));
391          table.Columns.Add("ParameterNameMaxLength", typeof(int));
392          table.Columns.Add("QuotedIdentifierPattern", typeof(string));
393          table.Columns.Add("QuotedIdentifierCase", typeof(IdentifierCase));
394          table.Columns.Add("ParameterNamePattern", typeof(string));
395          table.Columns.Add("StatementSeparatorPattern", typeof(string));
396          table.Columns.Add("StringLiteralPattern", typeof(string));
397          table.Columns.Add("SupportedJoinOperators", typeof(SupportedJoinOperators));
398          var version = conn.PostgreSqlVersion;
399          var normalizedVersion = $"{version.Major:00}.{version.Minor:00}";
400          if (version.Build >= 0)
401              normalizedVersion += $".{version.Build:00}";
402          row["CompositeIdentifierSeparatorPattern"] = @"\.";
403          row["DataSourceProductName"] = "Npgsql";
404          row["DataSourceProductVersion"] = version.ToString();
405          row["DataSourceProductVersionNormalized"] = normalizedVersion;
406          row["GroupByBehavior"] = GroupByBehavior.Unrelated;
407          row["IdentifierPattern"] = @"(^\[\p{Lo}\p{Lu}\p{Ll}_@#][\p{Lo}\p{Lu}\p{Ll}\p{Nd}@$#_]*$)|(^\[[^\]\0]|\]\]+\]$)|(^\""[^\""\0]|\""\""+\""$)";
408          row["IdentifierCase"] = IdentifierCase.Insensitive;
409          row["OrderByColumnsInSelect"] = false;
410          row["QuotedIdentifierPattern"] = @"""(([^\""]|\""\"")*)""";
411          row["QuotedIdentifierCase"] = IdentifierCase.Sensitive;
412          row["StatementSeparatorPattern"] = ";";
413          row["StringLiteralPattern"] = @"'(([^']|'')*)'";
414          row["SupportedJoinOperators"] =
415              SupportedJoinOperators.FullOuter |
416              SupportedJoinOperators.Inner |
417              SupportedJoinOperators.LeftOuter |
418              SupportedJoinOperators.RightOuter;
419          row["ParameterNameMaxLength"] = 63; 
420          row["ParameterMarkerFormat"] = @"{0}";  
421          if (NpgsqlCommand.EnableSqlRewriting)
422          {
423              row["ParameterMarkerPattern"] = @"@[\p{Lo}\p{Lu}\p{Ll}\p{Lm}_@#][\p{Lo}\p{Lu}\p{Ll}\p{Lm}\p{Nd}\uff3f_@#\$]*(?=\s+|$)";
424              row["ParameterNamePattern"] = @"^[\p{Lo}\p{Lu}\p{Ll}\p{Lm}_@#][\p{Lo}\p{Lu}\p{Ll}\p{Lm}\p{Nd}\uff3f_@#\$]*(?=\s+|$)";
425          }
426          else
427          {
428              row["ParameterMarkerPattern"] = @"$\d+";
429              row["ParameterNamePattern"] = @"\d+";
430          }
431          return table;
432      }
433      #region DataTypes
434      static DataTable GetDataTypes(NpgsqlConnection conn)
435      {
436          using var _ = conn.StartTemporaryBindingScope(out var connector);
437          var table = new DataTable("DataTypes");
438          table.Columns.Add("TypeName", typeof(string));
439          table.Columns.Add("ColumnSize", typeof(long));
440          table.Columns.Add("CreateFormat", typeof(string));
441          table.Columns.Add("CreateParameters", typeof(string));
442          table.Columns.Add("DataType", typeof(string));
443          table.Columns.Add("IsAutoIncrementable", typeof(bool));
444          table.Columns.Add("IsBestMatch", typeof(bool));
445          table.Columns.Add("IsCaseSensitive", typeof(bool));
446          table.Columns.Add("IsConcurrencyType", typeof(bool));
447          table.Columns.Add("IsFixedLength", typeof(bool));
448          table.Columns.Add("IsFixedPrecisionAndScale", typeof(bool));
449          table.Columns.Add("IsLiteralSupported", typeof(bool));
450          table.Columns.Add("IsLong", typeof(bool));
451          table.Columns.Add("IsNullable", typeof(bool));
452          table.Columns.Add("IsSearchable", typeof(bool));
453          table.Columns.Add("IsSearchableWithLike", typeof(bool));
454          table.Columns.Add("IsUnsigned", typeof(bool));
455          table.Columns.Add("LiteralPrefix", typeof(string));
456          table.Columns.Add("LiteralSuffix", typeof(string));
457          table.Columns.Add("MaximumScale", typeof(short));
458          table.Columns.Add("MinimumScale", typeof(short));
459          table.Columns.Add("NativeDataType", typeof(string));
460          table.Columns.Add("ProviderDbType", typeof(int));
461          table.Columns.Add("OID", typeof(uint));
462          foreach (var baseType in connector.DatabaseInfo.BaseTypes.Cast<PostgresType>()
463                       .Concat(connector.DatabaseInfo.EnumTypes)
464                       .Concat(connector.DatabaseInfo.CompositeTypes))
465          {
466              if (!connector.TypeMapper.TryGetMapping(baseType, out var mapping))
467                  continue;
468              var row = table.Rows.Add();
469              PopulateDefaultDataTypeInfo(row, baseType);
470              PopulateHardcodedDataTypeInfo(row, baseType);
471              if (mapping.ClrTypes.Length > 0)
472                  row["DataType"] = mapping.ClrTypes[0].FullName;
473              if (mapping.NpgsqlDbType.HasValue)
474                  row["ProviderDbType"] = (int)mapping.NpgsqlDbType.Value;
475          }
476          foreach (var arrayType in connector.DatabaseInfo.ArrayTypes)
477          {
478              if (!connector.TypeMapper.TryGetMapping(arrayType.Element, out var elementMapping))
479                  continue;
480              var row = table.Rows.Add();
481              PopulateDefaultDataTypeInfo(row, arrayType.Element);
482              PopulateHardcodedDataTypeInfo(row, arrayType.Element);
483              row["TypeName"] = arrayType.DisplayName;
484              row["OID"] = arrayType.OID;
485              row["CreateFormat"] += "[]";
486              if (elementMapping.ClrTypes.Length > 0)
487                  row["DataType"] = elementMapping.ClrTypes[0].MakeArrayType().FullName;
488              if (elementMapping.NpgsqlDbType.HasValue)
489                  row["ProviderDbType"] = (int)(elementMapping.NpgsqlDbType.Value | NpgsqlDbType.Array);
490          }
491          foreach (var rangeType in connector.DatabaseInfo.RangeTypes)
492          {
493              if (!connector.TypeMapper.TryGetMapping(rangeType.Subtype, out var subtypeMapping))
494                  continue;
495              var row = table.Rows.Add();
496              PopulateDefaultDataTypeInfo(row, rangeType.Subtype);
497              PopulateHardcodedDataTypeInfo(row, rangeType.Subtype);
498              row["TypeName"] = rangeType.DisplayName;
499              row["OID"] = rangeType.OID;
500              row["CreateFormat"] = rangeType.DisplayName.ToUpperInvariant();
501              if (subtypeMapping.ClrTypes.Length > 0)
502                  row["DataType"] = typeof(NpgsqlRange<>).MakeGenericType(subtypeMapping.ClrTypes[0]).FullName;
503              if (subtypeMapping.NpgsqlDbType.HasValue)
504                  row["ProviderDbType"] = (int)(subtypeMapping.NpgsqlDbType.Value | NpgsqlDbType.Range);
505          }
506          foreach (var multirangeType in connector.DatabaseInfo.MultirangeTypes)
507          {
508              var subtypeType = multirangeType.Subrange.Subtype;
509              if (!connector.TypeMapper.TryGetMapping(subtypeType, out var subtypeMapping))
510                  continue;
511              var row = table.Rows.Add();
512              PopulateDefaultDataTypeInfo(row, subtypeType);
513              PopulateHardcodedDataTypeInfo(row, subtypeType);
514              row["TypeName"] = multirangeType.DisplayName;
515              row["OID"] = multirangeType.OID;
516              row["CreateFormat"] = multirangeType.DisplayName.ToUpperInvariant();
517              if (subtypeMapping.ClrTypes.Length > 0)
518                  row["DataType"] = typeof(NpgsqlRange<>).MakeGenericType(subtypeMapping.ClrTypes[0]).FullName;
519              if (subtypeMapping.NpgsqlDbType.HasValue)
520                  row["ProviderDbType"] = (int)(subtypeMapping.NpgsqlDbType.Value | NpgsqlDbType.Range);
521          }
522          foreach (var domainType in connector.DatabaseInfo.DomainTypes)
523          {
524              if (!connector.TypeMapper.TryGetMapping(domainType, out var baseMapping))
525                  continue;
526              var row = table.Rows.Add();
527              PopulateDefaultDataTypeInfo(row, domainType.BaseType);
528              PopulateHardcodedDataTypeInfo(row, domainType.BaseType);
529              row["TypeName"] = domainType.DisplayName;
530              row["OID"] = domainType.OID;
531              row["IsBestMatch"] = false;
532              if (baseMapping.ClrTypes.Length > 0)
533                  row["DataType"] = baseMapping.ClrTypes[0].FullName;
534              if (baseMapping.NpgsqlDbType.HasValue)
535                  row["ProviderDbType"] = (int)baseMapping.NpgsqlDbType.Value;
536          }
537          return table;
538      }
539      static void PopulateDefaultDataTypeInfo(DataRow row, PostgresType type)
540      {
541          row["TypeName"] = type.DisplayName;
542          row["CreateFormat"] = type.DisplayName.ToUpperInvariant();
543          row["CreateParameters"] = "";
544          row["IsAutoIncrementable"] = false;
545          row["IsBestMatch"] = true;
546          row["IsCaseSensitive"] = true;
547          row["IsConcurrencyType"] = false;
548          row["IsFixedLength"] = false;
549          row["IsFixedPrecisionAndScale"] = false;
550          row["IsLiteralSupported"] = false;  
551          row["IsLong"] = false;
552          row["IsNullable"] = true;
553          row["IsSearchable"] = true;
554          row["IsSearchableWithLike"] = false;
555          row["IsUnsigned"] = DBNull.Value; 
556          row["MaximumScale"] = DBNull.Value;
557          row["MinimumScale"] = DBNull.Value;
558          row["OID"] = type.OID;
559      }
560      static void PopulateHardcodedDataTypeInfo(DataRow row, PostgresType type)
561      {
562          switch (type.Name)
563          {
564          case "varchar":
565          case "char":
566              row["DataType"] = "String";
567              row["IsBestMatch"] = false;
568              goto case "text";
569          case "text":
570              row["CreateFormat"] += "({0})";
571              row["CreateParameters"] = "size";
572              row["IsSearchableWithLike"] = true;
573              row["IsLiteralSupported"] = true;
574              row["LiteralPrefix"] = "'";
575              row["LiteralSuffix"] = "'";
576              return;
577          case "numeric":
578              row["CreateFormat"] += "({0},{1})";
579              row["CreateParameters"] = "precision, scale";
580              row["MaximumScale"] = 16383;
581              row["MinimumScale"] = 16383;
582              row["IsUnsigned"] = false;
583              return;
584          case "bytea":
585              row["IsLong"] = true;
586              return;
587          case "citext":
588              row["IsCaseSensitive"] = false;
589              return;
590          case "integer":
591          case "smallint":
592          case "bigint":
593          case "double precision":
594          case "real":
595          case "money":
596              row["IsUnsigned"] = false;
597              return;
598          case "oid":
599          case "cid":
600          case "regtype":
601          case "regconfig":
602              row["IsUnsigned"] = true;
603              return;
604          case "xid":
605              row["IsUnsigned"] = true;
606              row["IsConcurrencyType"] = true;
607              return;
608          }
609      }
610      #endregion DataTypes
611      #region Reserved Keywords
612      static DataTable GetReservedWords()
613      {
614          var table = new DataTable("ReservedWords") { Locale = CultureInfo.InvariantCulture };
615          table.Columns.Add("ReservedWord", typeof(string));
616          foreach (var keyword in ReservedKeywords)
617              table.Rows.Add(keyword);
618          return table;
619      }
620      static readonly string[] ReservedKeywords =
621      {
622          "ALL",
623          "ANALYSE",
624          "ANALYZE",
625          "AND",
626          "ANY",
627          "ARRAY",
628          "AS",
629          "ASC",
630          "ASYMMETRIC",
631          "AUTHORIZATION",
632          "BINARY",
633          "BOTH",
634          "CASE",
635          "CAST",
636          "CHECK",
637          "COLLATE",
638          "COLUMN",
639          "CONCURRENTLY",
640          "CONSTRAINT",
641          "CREATE",
642          "CROSS",
643          "CURRENT_CATALOG",
644          "CURRENT_DATE",
645          "CURRENT_ROLE",
646          "CURRENT_SCHEMA",
647          "CURRENT_TIME",
648          "CURRENT_TIMESTAMP",
649          "CURRENT_USER",
650          "DEFAULT",
651          "DEFERRABLE",
652          "DESC",
653          "DISTINCT",
654          "DO",
655          "ELSE",
656          "END",
657          "EXCEPT",
658          "FALSE",
659          "FETCH",
660          "FOR",
661          "FOREIGN",
662          "FREEZE",
663          "FROM",
664          "FULL",
665          "GRANT",
666          "GROUP",
667          "HAVING",
668          "ILIKE",
669          "IN",
670          "INITIALLY",
671          "INNER",
672          "INTERSECT",
673          "INTO",
674          "IS",
675          "ISNULL",
676          "JOIN",
677          "LATERAL",
678          "LEADING",
679          "LEFT",
680          "LIKE",
681          "LIMIT",
682          "LOCALTIME",
683          "LOCALTIMESTAMP",
684          "NATURAL",
685          "NOT",
686          "NOTNULL",
687          "NULL",
688          "OFFSET",
689          "ON",
690          "ONLY",
691          "OR",
692          "ORDER",
693          "OUTER",
694          "OVER",
695          "OVERLAPS",
696          "PLACING",
697          "PRIMARY",
698          "REFERENCES",
699          "RETURNING",
700          "RIGHT",
701          "SELECT",
702          "SESSION_USER",
703          "SIMILAR",
704          "SOME",
705          "SYMMETRIC",
706          "TABLE",
707          "THEN",
708          "TO",
709          "TRAILING",
710          "TRUE",
711          "UNION",
712          "UNIQUE",
713          "USER",
714          "USING",
715          "VARIADIC",
716          "VERBOSE",
717          "WHEN",
718          "WHERE",
719          "WINDOW",
720          "WITH"
721      };
722      #endregion Reserved Keywords
723  }
</code></pre>
        </div>
        <div class="column">
            <h3>npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NpgsqlSchema.cs</h3>
            <pre><code>1  using System;
2  using System.Data;
3  using System.Data.Common;
4  using System.Globalization;
5  using System.Linq;
6  using System.Text;
7  using System.Threading;
8  using System.Threading.Tasks;
9  using Npgsql.PostgresTypes;
10  using NpgsqlTypes;
11  namespace Npgsql;
12  static class NpgsqlSchema
13  {
14      public static Task<DataTable> GetSchema(NpgsqlConnection conn, string? collectionName, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
15      {
16          if (collectionName is null)
17              throw new ArgumentNullException(nameof(collectionName));
18          if (collectionName.Length == 0)
19              throw new ArgumentException("Collection name cannot be empty.", nameof(collectionName));
20          return collectionName.ToUpperInvariant() switch
21          {
22              "METADATACOLLECTIONS"   => Task.FromResult(GetMetaDataCollections()),
23              "RESTRICTIONS"          => Task.FromResult(GetRestrictions()),
24              "DATASOURCEINFORMATION" => Task.FromResult(GetDataSourceInformation(conn)),
25              "DATATYPES"             => Task.FromResult(GetDataTypes(conn)),
26              "RESERVEDWORDS"         => Task.FromResult(GetReservedWords()),
27              "DATABASES"             => GetDatabases(conn, restrictions, async, cancellationToken),
28              "SCHEMATA"              => GetSchemata(conn, restrictions, async, cancellationToken),
29              "TABLES"                => GetTables(conn, restrictions, async, cancellationToken),
30              "COLUMNS"               => GetColumns(conn, restrictions, async, cancellationToken),
31              "VIEWS"                 => GetViews(conn, restrictions, async, cancellationToken),
32              "USERS"                 => GetUsers(conn, restrictions, async, cancellationToken),
33              "INDEXES"               => GetIndexes(conn, restrictions, async, cancellationToken),
34              "INDEXCOLUMNS"          => GetIndexColumns(conn, restrictions, async, cancellationToken),
35              "CONSTRAINTS"           => GetConstraints(conn, restrictions, collectionName, async, cancellationToken),
36              "PRIMARYKEY"            => GetConstraints(conn, restrictions, collectionName, async, cancellationToken),
37              "UNIQUEKEYS"            => GetConstraints(conn, restrictions, collectionName, async, cancellationToken),
38              "FOREIGNKEYS"           => GetConstraints(conn, restrictions, collectionName, async, cancellationToken),
39              "CONSTRAINTCOLUMNS"     => GetConstraintColumns(conn, restrictions, async, cancellationToken),
40              _ => throw new ArgumentOutOfRangeException(nameof(collectionName), collectionName, "Invalid collection name.")
41          };
42      }
43      static DataTable GetMetaDataCollections()
44      {
45          var table = new DataTable("MetaDataCollections");
46          table.Columns.Add("CollectionName", typeof(string));
47          table.Columns.Add("NumberOfRestrictions", typeof(int));
48          table.Columns.Add("NumberOfIdentifierParts", typeof(int));
49          table.Rows.Add("MetaDataCollections", 0, 0);
50          table.Rows.Add("DataSourceInformation", 0, 0);
51          table.Rows.Add("Restrictions", 0, 0);
52          table.Rows.Add("DataTypes", 0, 0);  
53          table.Rows.Add("Databases", 1, 1);
54          table.Rows.Add("Tables", 4, 3);
55          table.Rows.Add("Columns", 4, 4);
56          table.Rows.Add("Views", 3, 3);
57          table.Rows.Add("Users", 1, 1);
58          table.Rows.Add("Indexes", 4, 4);
59          table.Rows.Add("IndexColumns", 5, 5);
60          return table;
61      }
62      static DataTable GetRestrictions()
63      {
64          var table = new DataTable("Restrictions");
65          table.Columns.Add("CollectionName", typeof(string));
66          table.Columns.Add("RestrictionName", typeof(string));
67          table.Columns.Add("RestrictionDefault", typeof(string));
68          table.Columns.Add("RestrictionNumber", typeof(int));
69          table.Rows.Add("Database", "Name", "Name", 1);
70          table.Rows.Add("Tables", "Catalog", "table_catalog", 1);
71          table.Rows.Add("Tables", "Schema", "schema_catalog", 2);
72          table.Rows.Add("Tables", "Table", "table_name", 3);
73          table.Rows.Add("Tables", "TableType", "table_type", 4);
74          table.Rows.Add("Columns", "Catalog", "table_catalog", 1);
75          table.Rows.Add("Columns", "Schema", "table_schema", 2);
76          table.Rows.Add("Columns", "TableName", "table_name", 3);
77          table.Rows.Add("Columns", "Column", "column_name", 4);
78          table.Rows.Add("Views", "Catalog", "table_catalog", 1);
79          table.Rows.Add("Views", "Schema", "table_schema", 2);
80          table.Rows.Add("Views", "Table", "table_name", 3);
<span onclick='openModal()' class='match'>81          table.Rows.Add("Users", "User", "user_name", 1);
82          table.Rows.Add("Indexes", "Catalog", "table_catalog", 1);
</span>83          table.Rows.Add("Indexes", "Schema", "table_schema", 2);
84          table.Rows.Add("Indexes", "Table", "table_name", 3);
85          table.Rows.Add("Indexes", "Index", "index_name", 4);
86          table.Rows.Add("IndexColumns", "Catalog", "table_catalog", 1);
87          table.Rows.Add("IndexColumns", "Schema", "table_schema", 2);
88          table.Rows.Add("IndexColumns", "Table", "table_name", 3);
89          table.Rows.Add("IndexColumns", "Index", "index_name", 4);
90          table.Rows.Add("IndexColumns", "Column", "column_name", 5);
91          return table;
92      }
93      static NpgsqlCommand BuildCommand(NpgsqlConnection conn, StringBuilder query, string?[]? restrictions, params string[]? names)
94          => BuildCommand(conn, query, restrictions, true, names);
95      static NpgsqlCommand BuildCommand(NpgsqlConnection conn, StringBuilder query, string?[]? restrictions, bool addWhere, params string[]? names)
96      {
97          var command = new NpgsqlCommand();
98          if (restrictions != null && names != null)
99          {
100              for (var i = 0; i < restrictions.Length && i < names.Length; ++i)
101              {
102                  if (restrictions[i] is string restriction && restriction.Length != 0)
103                  {
104                      if (addWhere)
105                      {
106                          query.Append(" WHERE ");
107                          addWhere = false;
108                      }
109                      else
110                      {
111                          query.Append(" AND ");
112                      }
113                      var paramName = RemoveSpecialChars(names[i]);
114                      query.AppendFormat("{0} = :{1}", names[i], paramName);
115                      command.Parameters.Add(new NpgsqlParameter(paramName, restriction));
116                  }
117              }
118          }
119          command.CommandText = query.ToString();
120          command.Connection = conn;
121          return command;
122      }
123      static string RemoveSpecialChars(string paramName)
124          => paramName.Replace("(", "").Replace(")", "").Replace(".", "");
125      static async Task<DataTable> GetDatabases(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
126      {
127          var databases = new DataTable("Databases") { Locale = CultureInfo.InvariantCulture };
128          databases.Columns.AddRange(new[] {
129              new DataColumn("database_name"),
130              new DataColumn("owner"),
131              new DataColumn("encoding")
132          });
133          var getDatabases = new StringBuilder();
134          getDatabases.Append("SELECT d.datname AS database_name, u.usename AS owner, pg_catalog.pg_encoding_to_char(d.encoding) AS encoding FROM pg_catalog.pg_database d LEFT JOIN pg_catalog.pg_user u ON d.datdba = u.usesysid");
135          using var command = BuildCommand(conn, getDatabases, restrictions, "datname");
136          using var adapter = new NpgsqlDataAdapter(command);
137          await adapter.Fill(databases, async, cancellationToken);
138          return databases;
139      }
140      static async Task<DataTable> GetSchemata(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
141      {
142          var schemata = new DataTable("Schemata") { Locale = CultureInfo.InvariantCulture };
143          schemata.Columns.AddRange(new[] {
144              new DataColumn("catalog_name"),
145              new DataColumn("schema_name"),
146              new DataColumn("schema_owner")
147          });
148          var getSchemata = new StringBuilder(@"
149  SELECT * FROM (
150      SELECT current_database() AS catalog_name,
151          nspname AS schema_name,
152          r.rolname AS schema_owner
153      FROM
154          pg_catalog.pg_namespace LEFT JOIN pg_catalog.pg_roles r ON r.oid = nspowner
155      ) tmp");
156          using var command = BuildCommand(conn, getSchemata, restrictions, "catalog_name", "schema_name", "schema_owner");
157          using var adapter = new NpgsqlDataAdapter(command);
158          await adapter.Fill(schemata, async, cancellationToken);
159          return schemata;
160      }
161      static async Task<DataTable> GetTables(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
162      {
163          var tables = new DataTable("Tables") { Locale = CultureInfo.InvariantCulture };
164          tables.Columns.AddRange(new[] {
165              new DataColumn("table_catalog"),
166              new DataColumn("table_schema"),
167              new DataColumn("table_name"),
168              new DataColumn("table_type")
169          });
170          var getTables = new StringBuilder();
171          getTables.Append(@"
172  SELECT table_catalog, table_schema, table_name, table_type
173  FROM information_schema.tables
174  WHERE
175      table_type IN ('BASE TABLE', 'FOREIGN', 'FOREIGN TABLE') AND
176      table_schema NOT IN ('pg_catalog', 'information_schema')");
177          using var command = BuildCommand(conn, getTables, restrictions, false, "table_catalog", "table_schema", "table_name", "table_type");
178          using var adapter = new NpgsqlDataAdapter(command);
179          await adapter.Fill(tables, async, cancellationToken);
180          return tables;
181      }
182      static async Task<DataTable> GetColumns(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
183      {
184          var columns = new DataTable("Columns") { Locale = CultureInfo.InvariantCulture };
185          columns.Columns.AddRange(new DataColumn[] {
186              new("table_catalog"), new("table_schema"), new("table_name"), new("column_name"),
187              new("ordinal_position", typeof(int)),
188              new("column_default"),
189              new("is_nullable"),
190              new("data_type"),
191              new("character_maximum_length", typeof(int)), new("character_octet_length", typeof(int)),
192              new("numeric_precision", typeof(int)), new("numeric_precision_radix", typeof(int)), new("numeric_scale", typeof(int)),
193              new("datetime_precision", typeof(int)),
194              new("character_set_catalog"), new("character_set_schema"), new("character_set_name"),
195              new("collation_catalog")
196          });
197          var getColumns = new StringBuilder(@"
198  SELECT
199      table_catalog, table_schema, table_name, column_name,
200      ordinal_position,
201      column_default,
202      is_nullable,
203      CASE WHEN udt_schema is NULL THEN udt_name ELSE format_type(typ.oid, NULL) END AS data_type,
204      character_maximum_length, character_octet_length,
205      numeric_precision, numeric_precision_radix, numeric_scale,
206      datetime_precision,
207      character_set_catalog, character_set_schema, character_set_name,
208      collation_catalog
209  FROM information_schema.columns
210  JOIN pg_namespace AS ns ON ns.nspname = udt_schema
211  JOIN pg_type AS typ ON typnamespace = ns.oid AND typname = udt_name");
212          using var command = BuildCommand(conn, getColumns, restrictions, "table_catalog", "table_schema", "table_name", "column_name");
213          using var adapter = new NpgsqlDataAdapter(command);
214          await adapter.Fill(columns, async, cancellationToken);
215          return columns;
216      }
217      static async Task<DataTable> GetViews(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
218      {
219          var views = new DataTable("Views") { Locale = CultureInfo.InvariantCulture };
220          views.Columns.AddRange(new[] {
221              new DataColumn("table_catalog"), new DataColumn("table_schema"), new DataColumn("table_name"),
222              new DataColumn("check_option"), new DataColumn("is_updatable")
223          });
224          var getViews = new StringBuilder(@"
225  SELECT table_catalog, table_schema, table_name, check_option, is_updatable
226  FROM information_schema.views
227  WHERE table_schema NOT IN ('pg_catalog', 'information_schema')");
228          using var command = BuildCommand(conn, getViews, restrictions, false, "table_catalog", "table_schema", "table_name");
229          using var adapter = new NpgsqlDataAdapter(command);
230          await adapter.Fill(views, async, cancellationToken);
231          return views;
232      }
233      static async Task<DataTable> GetUsers(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
234      {
235          var users = new DataTable("Users") { Locale = CultureInfo.InvariantCulture };
236          users.Columns.AddRange(new[] { new DataColumn("user_name"), new DataColumn("user_sysid", typeof(uint)) });
237          var getUsers = new StringBuilder();
238          getUsers.Append("SELECT usename as user_name, usesysid as user_sysid FROM pg_catalog.pg_user");
239          using var command = BuildCommand(conn, getUsers, restrictions, "usename");
240          using var adapter = new NpgsqlDataAdapter(command);
241          await adapter.Fill(users, async, cancellationToken);
242          return users;
243      }
244      static async Task<DataTable> GetIndexes(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
245      {
246          var indexes = new DataTable("Indexes") { Locale = CultureInfo.InvariantCulture };
247          indexes.Columns.AddRange(new[] {
248              new DataColumn("table_catalog"), new DataColumn("table_schema"), new DataColumn("table_name"),
249              new DataColumn("index_name"), new DataColumn("type_desc")
250          });
251          var getIndexes = new StringBuilder(@"
252  SELECT current_database() AS table_catalog,
253      n.nspname AS table_schema,
254      t.relname AS table_name,
255      i.relname AS index_name,
256      '' AS type_desc
257  FROM
258      pg_catalog.pg_class i
259      JOIN pg_catalog.pg_index ix ON ix.indexrelid = i.oid
260      JOIN pg_catalog.pg_class t ON ix.indrelid = t.oid
261      LEFT JOIN pg_catalog.pg_user u ON u.usesysid = i.relowner
262      LEFT JOIN pg_catalog.pg_namespace n ON n.oid = i.relnamespace
263  WHERE
264      i.relkind = 'i' AND
265      n.nspname NOT IN ('pg_catalog', 'pg_toast') AND
266      t.relkind = 'r'");
267          using var command = BuildCommand(conn, getIndexes, restrictions, false, "current_database()", "n.nspname", "t.relname", "i.relname");
268          using var adapter = new NpgsqlDataAdapter(command);
269          await adapter.Fill(indexes, async, cancellationToken);
270          return indexes;
271      }
272      static async Task<DataTable> GetIndexColumns(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
273      {
274          var indexColumns = new DataTable("IndexColumns") { Locale = CultureInfo.InvariantCulture };
275          indexColumns.Columns.AddRange(new[] {
276              new DataColumn("constraint_catalog"), new DataColumn("constraint_schema"), new DataColumn("constraint_name"),
277              new DataColumn("table_catalog"), new DataColumn("table_schema"), new DataColumn("table_name"),
278              new DataColumn("column_name"), new DataColumn("index_name")
279          });
280          var getIndexColumns = new StringBuilder(@"
281  SELECT
282      current_database() AS constraint_catalog,
283      t_ns.nspname AS constraint_schema,
284      ix_cls.relname AS constraint_name,
285      current_database() AS table_catalog,
286      ix_ns.nspname AS table_schema,
287      t.relname AS table_name,
288      a.attname AS column_name,
289      ix_cls.relname AS index_name
290  FROM
291      pg_class t
292      JOIN pg_index ix ON t.oid = ix.indrelid
293      JOIN pg_class ix_cls ON ix.indexrelid = ix_cls.oid
294      JOIN pg_attribute a ON t.oid = a.attrelid
295      LEFT JOIN pg_namespace t_ns ON t.relnamespace = t_ns.oid
296      LEFT JOIN pg_namespace ix_ns ON ix_cls.relnamespace = ix_ns.oid
297  WHERE
298      ix_cls.relkind = 'i' AND
299      t_ns.nspname NOT IN ('pg_catalog', 'pg_toast') AND
300      a.attnum = ANY(ix.indkey) AND
301      t.relkind = 'r'");
302          using var command = BuildCommand(conn, getIndexColumns, restrictions, false, "current_database()", "t_ns.nspname", "t.relname", "ix_cls.relname", "a.attname");
303          using var adapter = new NpgsqlDataAdapter(command);
304          await adapter.Fill(indexColumns, async, cancellationToken);
305          return indexColumns;
306      }
307      static async Task<DataTable> GetConstraints(NpgsqlConnection conn, string?[]? restrictions, string? constraintType, bool async, CancellationToken cancellationToken = default)
308      {
309          var getConstraints = new StringBuilder(@"
310  SELECT
311      current_database() AS ""CONSTRAINT_CATALOG"",
312      pgn.nspname AS ""CONSTRAINT_SCHEMA"",
313      pgc.conname AS ""CONSTRAINT_NAME"",
314      current_database() AS ""TABLE_CATALOG"",
315      pgtn.nspname AS ""TABLE_SCHEMA"",
316      pgt.relname AS ""TABLE_NAME"",
317      ""CONSTRAINT_TYPE"",
318      pgc.condeferrable AS ""IS_DEFERRABLE"",
319      pgc.condeferred AS ""INITIALLY_DEFERRED""
320  FROM
321      pg_catalog.pg_constraint pgc
322      JOIN pg_catalog.pg_namespace pgn ON pgc.connamespace = pgn.oid
323      JOIN pg_catalog.pg_class pgt ON pgc.conrelid = pgt.oid
324      JOIN pg_catalog.pg_namespace pgtn ON pgt.relnamespace = pgtn.oid
325      JOIN (
326          SELECT 'PRIMARY KEY' AS ""CONSTRAINT_TYPE"", 'p' AS ""contype""
327          UNION ALL
328          SELECT 'FOREIGN KEY' AS ""CONSTRAINT_TYPE"", 'f' AS ""contype""
329          UNION ALL
330          SELECT 'UNIQUE KEY' AS ""CONSTRAINT_TYPE"", 'u' AS ""contype""
331  ) mapping_table ON mapping_table.contype = pgc.contype");
332          if ("ForeignKeys".Equals(constraintType))
333              getConstraints.Append(" and pgc.contype='f'");
334          else if ("PrimaryKey".Equals(constraintType))
335              getConstraints.Append(" and pgc.contype='p'");
336          else if ("UniqueKeys".Equals(constraintType))
337              getConstraints.Append(" and pgc.contype='u'");
338          else
339              constraintType = "Constraints";
340          using var command = BuildCommand(conn, getConstraints, restrictions, false, "current_database()", "pgtn.nspname", "pgt.relname", "pgc.conname");
341          using var adapter = new NpgsqlDataAdapter(command);
342          var table = new DataTable(constraintType) { Locale = CultureInfo.InvariantCulture };
343          await adapter.Fill(table, async, cancellationToken);
344          return table;
345      }
346      static async Task<DataTable> GetConstraintColumns(NpgsqlConnection conn, string?[]? restrictions, bool async, CancellationToken cancellationToken = default)
347      {
348          var getConstraintColumns = new StringBuilder(@"
349  SELECT current_database() AS constraint_catalog,
350      n.nspname AS constraint_schema,
351      c.conname AS constraint_name,
352      current_database() AS table_catalog,
353      n.nspname AS table_schema,
354      t.relname AS table_name,
355      a.attname AS column_name,
356      a.attnum AS ordinal_number,
357      mapping_table.constraint_type
358  FROM pg_constraint c
359      JOIN pg_namespace n on n.oid = c.connamespace
360      JOIN pg_class t on t.oid = c.conrelid AND t.relkind = 'r'
361      JOIN pg_attribute a on t.oid = a.attrelid AND a.attnum = ANY(c.conkey)
362      JOIN (
363          SELECT 'PRIMARY KEY' AS constraint_type, 'p' AS contype
364          UNION ALL
365          SELECT 'FOREIGN KEY' AS constraint_type, 'f' AS contype
366          UNION ALL
367          SELECT 'UNIQUE KEY' AS constraint_type, 'u' AS contype
368  ) mapping_table ON
369      mapping_table.contype = c.contype
370      AND n.nspname NOT IN ('pg_catalog', 'pg_toast')");
371          using var command = BuildCommand(conn, getConstraintColumns, restrictions, false, "current_database()", "n.nspname", "t.relname", "c.conname", "a.attname");
372          using var adapter = new NpgsqlDataAdapter(command);
373          var table = new DataTable("ConstraintColumns") { Locale = CultureInfo.InvariantCulture };
374          await adapter.Fill(table, async, cancellationToken);
375          return table;
376      }
377      static DataTable GetDataSourceInformation(NpgsqlConnection conn)
378      {
379          var table = new DataTable("DataSourceInformation");
380          var row = table.Rows.Add();
381          table.Columns.Add("CompositeIdentifierSeparatorPattern", typeof(string));
382          table.Columns.Add("DataSourceProductName", typeof(string));
383          table.Columns.Add("DataSourceProductVersion", typeof(string));
384          table.Columns.Add("DataSourceProductVersionNormalized", typeof(string));
385          table.Columns.Add("GroupByBehavior", typeof(GroupByBehavior));
386          table.Columns.Add("IdentifierPattern", typeof(string));
387          table.Columns.Add("IdentifierCase", typeof(IdentifierCase));
388          table.Columns.Add("OrderByColumnsInSelect", typeof(bool));
389          table.Columns.Add("ParameterMarkerFormat", typeof(string));
390          table.Columns.Add("ParameterMarkerPattern", typeof(string));
391          table.Columns.Add("ParameterNameMaxLength", typeof(int));
392          table.Columns.Add("QuotedIdentifierPattern", typeof(string));
393          table.Columns.Add("QuotedIdentifierCase", typeof(IdentifierCase));
394          table.Columns.Add("ParameterNamePattern", typeof(string));
395          table.Columns.Add("StatementSeparatorPattern", typeof(string));
396          table.Columns.Add("StringLiteralPattern", typeof(string));
397          table.Columns.Add("SupportedJoinOperators", typeof(SupportedJoinOperators));
398          var version = conn.PostgreSqlVersion;
399          var normalizedVersion = $"{version.Major:00}.{version.Minor:00}";
400          if (version.Build >= 0)
401              normalizedVersion += $".{version.Build:00}";
402          row["CompositeIdentifierSeparatorPattern"] = @"\.";
403          row["DataSourceProductName"] = "Npgsql";
404          row["DataSourceProductVersion"] = version.ToString();
405          row["DataSourceProductVersionNormalized"] = normalizedVersion;
406          row["GroupByBehavior"] = GroupByBehavior.Unrelated;
407          row["IdentifierPattern"] = @"(^\[\p{Lo}\p{Lu}\p{Ll}_@#][\p{Lo}\p{Lu}\p{Ll}\p{Nd}@$#_]*$)|(^\[[^\]\0]|\]\]+\]$)|(^\""[^\""\0]|\""\""+\""$)";
408          row["IdentifierCase"] = IdentifierCase.Insensitive;
409          row["OrderByColumnsInSelect"] = false;
410          row["QuotedIdentifierPattern"] = @"""(([^\""]|\""\"")*)""";
411          row["QuotedIdentifierCase"] = IdentifierCase.Sensitive;
412          row["StatementSeparatorPattern"] = ";";
413          row["StringLiteralPattern"] = @"'(([^']|'')*)'";
414          row["SupportedJoinOperators"] =
415              SupportedJoinOperators.FullOuter |
416              SupportedJoinOperators.Inner |
417              SupportedJoinOperators.LeftOuter |
418              SupportedJoinOperators.RightOuter;
419          row["ParameterNameMaxLength"] = 63; 
420          row["ParameterMarkerFormat"] = @"{0}";  
421          if (NpgsqlCommand.EnableSqlRewriting)
422          {
423              row["ParameterMarkerPattern"] = @"@[\p{Lo}\p{Lu}\p{Ll}\p{Lm}_@#][\p{Lo}\p{Lu}\p{Ll}\p{Lm}\p{Nd}\uff3f_@#\$]*(?=\s+|$)";
424              row["ParameterNamePattern"] = @"^[\p{Lo}\p{Lu}\p{Ll}\p{Lm}_@#][\p{Lo}\p{Lu}\p{Ll}\p{Lm}\p{Nd}\uff3f_@#\$]*(?=\s+|$)";
425          }
426          else
427          {
428              row["ParameterMarkerPattern"] = @"$\d+";
429              row["ParameterNamePattern"] = @"\d+";
430          }
431          return table;
432      }
433      #region DataTypes
434      static DataTable GetDataTypes(NpgsqlConnection conn)
435      {
436          using var _ = conn.StartTemporaryBindingScope(out var connector);
437          var table = new DataTable("DataTypes");
438          table.Columns.Add("TypeName", typeof(string));
439          table.Columns.Add("ColumnSize", typeof(long));
440          table.Columns.Add("CreateFormat", typeof(string));
441          table.Columns.Add("CreateParameters", typeof(string));
442          table.Columns.Add("DataType", typeof(string));
443          table.Columns.Add("IsAutoIncrementable", typeof(bool));
444          table.Columns.Add("IsBestMatch", typeof(bool));
445          table.Columns.Add("IsCaseSensitive", typeof(bool));
446          table.Columns.Add("IsConcurrencyType", typeof(bool));
447          table.Columns.Add("IsFixedLength", typeof(bool));
448          table.Columns.Add("IsFixedPrecisionAndScale", typeof(bool));
449          table.Columns.Add("IsLiteralSupported", typeof(bool));
450          table.Columns.Add("IsLong", typeof(bool));
451          table.Columns.Add("IsNullable", typeof(bool));
452          table.Columns.Add("IsSearchable", typeof(bool));
453          table.Columns.Add("IsSearchableWithLike", typeof(bool));
454          table.Columns.Add("IsUnsigned", typeof(bool));
455          table.Columns.Add("LiteralPrefix", typeof(string));
456          table.Columns.Add("LiteralSuffix", typeof(string));
457          table.Columns.Add("MaximumScale", typeof(short));
458          table.Columns.Add("MinimumScale", typeof(short));
459          table.Columns.Add("NativeDataType", typeof(string));
460          table.Columns.Add("ProviderDbType", typeof(int));
461          table.Columns.Add("OID", typeof(uint));
462          foreach (var baseType in connector.DatabaseInfo.BaseTypes.Cast<PostgresType>()
463                       .Concat(connector.DatabaseInfo.EnumTypes)
464                       .Concat(connector.DatabaseInfo.CompositeTypes))
465          {
466              if (!connector.TypeMapper.TryGetMapping(baseType, out var mapping))
467                  continue;
468              var row = table.Rows.Add();
469              PopulateDefaultDataTypeInfo(row, baseType);
470              PopulateHardcodedDataTypeInfo(row, baseType);
471              if (mapping.ClrTypes.Length > 0)
472                  row["DataType"] = mapping.ClrTypes[0].FullName;
473              if (mapping.NpgsqlDbType.HasValue)
474                  row["ProviderDbType"] = (int)mapping.NpgsqlDbType.Value;
475          }
476          foreach (var arrayType in connector.DatabaseInfo.ArrayTypes)
477          {
478              if (!connector.TypeMapper.TryGetMapping(arrayType.Element, out var elementMapping))
479                  continue;
480              var row = table.Rows.Add();
481              PopulateDefaultDataTypeInfo(row, arrayType.Element);
482              PopulateHardcodedDataTypeInfo(row, arrayType.Element);
483              row["TypeName"] = arrayType.DisplayName;
484              row["OID"] = arrayType.OID;
485              row["CreateFormat"] += "[]";
486              if (elementMapping.ClrTypes.Length > 0)
487                  row["DataType"] = elementMapping.ClrTypes[0].MakeArrayType().FullName;
488              if (elementMapping.NpgsqlDbType.HasValue)
489                  row["ProviderDbType"] = (int)(elementMapping.NpgsqlDbType.Value | NpgsqlDbType.Array);
490          }
491          foreach (var rangeType in connector.DatabaseInfo.RangeTypes)
492          {
493              if (!connector.TypeMapper.TryGetMapping(rangeType.Subtype, out var subtypeMapping))
494                  continue;
495              var row = table.Rows.Add();
496              PopulateDefaultDataTypeInfo(row, rangeType.Subtype);
497              PopulateHardcodedDataTypeInfo(row, rangeType.Subtype);
498              row["TypeName"] = rangeType.DisplayName;
499              row["OID"] = rangeType.OID;
500              row["CreateFormat"] = rangeType.DisplayName.ToUpperInvariant();
501              if (subtypeMapping.ClrTypes.Length > 0)
502                  row["DataType"] = typeof(NpgsqlRange<>).MakeGenericType(subtypeMapping.ClrTypes[0]).FullName;
503              if (subtypeMapping.NpgsqlDbType.HasValue)
504                  row["ProviderDbType"] = (int)(subtypeMapping.NpgsqlDbType.Value | NpgsqlDbType.Range);
505          }
506          foreach (var multirangeType in connector.DatabaseInfo.MultirangeTypes)
507          {
508              var subtypeType = multirangeType.Subrange.Subtype;
509              if (!connector.TypeMapper.TryGetMapping(subtypeType, out var subtypeMapping))
510                  continue;
511              var row = table.Rows.Add();
512              PopulateDefaultDataTypeInfo(row, subtypeType);
513              PopulateHardcodedDataTypeInfo(row, subtypeType);
514              row["TypeName"] = multirangeType.DisplayName;
515              row["OID"] = multirangeType.OID;
516              row["CreateFormat"] = multirangeType.DisplayName.ToUpperInvariant();
517              if (subtypeMapping.ClrTypes.Length > 0)
518                  row["DataType"] = typeof(NpgsqlRange<>).MakeGenericType(subtypeMapping.ClrTypes[0]).FullName;
519              if (subtypeMapping.NpgsqlDbType.HasValue)
520                  row["ProviderDbType"] = (int)(subtypeMapping.NpgsqlDbType.Value | NpgsqlDbType.Range);
521          }
522          foreach (var domainType in connector.DatabaseInfo.DomainTypes)
523          {
524              if (!connector.TypeMapper.TryGetMapping(domainType, out var baseMapping))
525                  continue;
526              var row = table.Rows.Add();
527              PopulateDefaultDataTypeInfo(row, domainType.BaseType);
528              PopulateHardcodedDataTypeInfo(row, domainType.BaseType);
529              row["TypeName"] = domainType.DisplayName;
530              row["OID"] = domainType.OID;
531              row["IsBestMatch"] = false;
532              if (baseMapping.ClrTypes.Length > 0)
533                  row["DataType"] = baseMapping.ClrTypes[0].FullName;
534              if (baseMapping.NpgsqlDbType.HasValue)
535                  row["ProviderDbType"] = (int)baseMapping.NpgsqlDbType.Value;
536          }
537          return table;
538      }
539      static void PopulateDefaultDataTypeInfo(DataRow row, PostgresType type)
540      {
541          row["TypeName"] = type.DisplayName;
542          row["CreateFormat"] = type.DisplayName.ToUpperInvariant();
543          row["CreateParameters"] = "";
544          row["IsAutoIncrementable"] = false;
545          row["IsBestMatch"] = true;
546          row["IsCaseSensitive"] = true;
547          row["IsConcurrencyType"] = false;
548          row["IsFixedLength"] = false;
549          row["IsFixedPrecisionAndScale"] = false;
550          row["IsLiteralSupported"] = false;  
551          row["IsLong"] = false;
552          row["IsNullable"] = true;
553          row["IsSearchable"] = true;
554          row["IsSearchableWithLike"] = false;
555          row["IsUnsigned"] = DBNull.Value; 
556          row["MaximumScale"] = DBNull.Value;
557          row["MinimumScale"] = DBNull.Value;
558          row["OID"] = type.OID;
559      }
560      static void PopulateHardcodedDataTypeInfo(DataRow row, PostgresType type)
561      {
562          switch (type.Name)
563          {
564          case "varchar":
565          case "char":
566              row["DataType"] = "String";
567              row["IsBestMatch"] = false;
568              goto case "text";
569          case "text":
570              row["CreateFormat"] += "({0})";
571              row["CreateParameters"] = "size";
572              row["IsSearchableWithLike"] = true;
573              row["IsLiteralSupported"] = true;
574              row["LiteralPrefix"] = "'";
575              row["LiteralSuffix"] = "'";
576              return;
577          case "numeric":
578              row["CreateFormat"] += "({0},{1})";
579              row["CreateParameters"] = "precision, scale";
580              row["MaximumScale"] = 16383;
581              row["MinimumScale"] = 16383;
582              row["IsUnsigned"] = false;
583              return;
584          case "bytea":
585              row["IsLong"] = true;
586              return;
587          case "citext":
588              row["IsCaseSensitive"] = false;
589              return;
590          case "integer":
591          case "smallint":
592          case "bigint":
593          case "double precision":
594          case "real":
595          case "money":
596              row["IsUnsigned"] = false;
597              return;
598          case "oid":
599          case "cid":
600          case "regtype":
601          case "regconfig":
602              row["IsUnsigned"] = true;
603              return;
604          case "xid":
605              row["IsUnsigned"] = true;
606              row["IsConcurrencyType"] = true;
607              return;
608          }
609      }
610      #endregion DataTypes
611      #region Reserved Keywords
612      static DataTable GetReservedWords()
613      {
614          var table = new DataTable("ReservedWords") { Locale = CultureInfo.InvariantCulture };
615          table.Columns.Add("ReservedWord", typeof(string));
616          foreach (var keyword in ReservedKeywords)
617              table.Rows.Add(keyword);
618          return table;
619      }
620      static readonly string[] ReservedKeywords =
621      {
622          "ALL",
623          "ANALYSE",
624          "ANALYZE",
625          "AND",
626          "ANY",
627          "ARRAY",
628          "AS",
629          "ASC",
630          "ASYMMETRIC",
631          "AUTHORIZATION",
632          "BINARY",
633          "BOTH",
634          "CASE",
635          "CAST",
636          "CHECK",
637          "COLLATE",
638          "COLUMN",
639          "CONCURRENTLY",
640          "CONSTRAINT",
641          "CREATE",
642          "CROSS",
643          "CURRENT_CATALOG",
644          "CURRENT_DATE",
645          "CURRENT_ROLE",
646          "CURRENT_SCHEMA",
647          "CURRENT_TIME",
648          "CURRENT_TIMESTAMP",
649          "CURRENT_USER",
650          "DEFAULT",
651          "DEFERRABLE",
652          "DESC",
653          "DISTINCT",
654          "DO",
655          "ELSE",
656          "END",
657          "EXCEPT",
658          "FALSE",
659          "FETCH",
660          "FOR",
661          "FOREIGN",
662          "FREEZE",
663          "FROM",
664          "FULL",
665          "GRANT",
666          "GROUP",
667          "HAVING",
668          "ILIKE",
669          "IN",
670          "INITIALLY",
671          "INNER",
672          "INTERSECT",
673          "INTO",
674          "IS",
675          "ISNULL",
676          "JOIN",
677          "LATERAL",
678          "LEADING",
679          "LEFT",
680          "LIKE",
681          "LIMIT",
682          "LOCALTIME",
683          "LOCALTIMESTAMP",
684          "NATURAL",
685          "NOT",
686          "NOTNULL",
687          "NULL",
688          "OFFSET",
689          "ON",
690          "ONLY",
691          "OR",
692          "ORDER",
693          "OUTER",
694          "OVER",
695          "OVERLAPS",
696          "PLACING",
697          "PRIMARY",
698          "REFERENCES",
699          "RETURNING",
700          "RIGHT",
701          "SELECT",
702          "SESSION_USER",
703          "SIMILAR",
704          "SOME",
705          "SYMMETRIC",
706          "TABLE",
707          "THEN",
708          "TO",
709          "TRAILING",
710          "TRUE",
711          "UNION",
712          "UNIQUE",
713          "USER",
714          "USING",
715          "VARIADIC",
716          "VERBOSE",
717          "WHEN",
718          "WHERE",
719          "WINDOW",
720          "WITH"
721      };
722      #endregion Reserved Keywords
723  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NpgsqlSchema.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NpgsqlSchema.cs</div>
                </div>
                <div class="column column_space"><pre><code>85          table.Rows.Add("Indexes", "Index", "index_name", 4);
86          table.Rows.Add("IndexColumns", "Catalog", "table_catalog", 1);
</pre></code></div>
                <div class="column column_space"><pre><code>81          table.Rows.Add("Users", "User", "user_name", 1);
82          table.Rows.Add("Indexes", "Catalog", "table_catalog", 1);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    