
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 9.163802978235967%, Tokens: 12</h2>
        <div class="column">
            <h3>NetCoreServer-MDEwOlJlcG9zaXRvcnkxNjYxMjMxNjQ=-flat-UdsTests.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.IO;
4  using System.Net.Sockets;
5  using System.Threading;
6  using NetCoreServer;
7  using Xunit;
8  namespace tests
9  {
10      class EchoUdsClient : NetCoreServer.UdsClient
11      {
12          public bool Connected { get; set; }
13          public bool Disconnected { get; set; }
14          public bool Errors { get; set; }
15          public EchoUdsClient(string path) : base(path) {}
16          protected override void OnConnected() { Connected = true; }
17          protected override void OnDisconnected() { Disconnected = true; }
18          protected override void OnError(SocketError error) { Errors = true; }
19      }
20      class EchoUdsSession : UdsSession
21      {
22          public bool Connected { get; set; }
23          public bool Disconnected { get; set; }
24          public bool Errors { get; set; }
25          public EchoUdsSession(UdsServer server) : base(server) {}
26          protected override void OnConnected() { Connected = true; }
27          protected override void OnDisconnected() { Disconnected = true; }
28          protected override void OnReceived(byte[] buffer, long offset, long size) { SendAsync(buffer, offset, size); }
29          protected override void OnError(SocketError error) { Errors = true; }
30      }
31      class EchoUdsServer : UdsServer
32      {
33          public bool Started { get; set; }
34          public bool Stopped { get; set; }
35          public bool Connected { get; set; }
36          public bool Disconnected { get; set; }
37          public int Clients { get; set; }
38          public bool Errors { get; set; }
39          public EchoUdsServer(string path) : base(path) {}
40          protected override UdsSession CreateSession() { return new EchoUdsSession(this); }
41          protected override void OnStarted() { Started = true; }
42          protected override void OnStopped() { Stopped = true; }
43          protected override void OnConnected(UdsSession session) { Connected = true; Clients++; }
44          protected override void OnDisconnected(UdsSession session) { Disconnected = true; Clients--; }
45          protected override void OnError(SocketError error) { Errors = true; }
46      }
47      public class UdsTests
48      {
49          [Fact(DisplayName = "Unix Domain Socket server test")]
50          public void UdsServerTest()
51          {
52              string path = Path.Combine(Path.GetTempPath(), "test.sock");
53              var server = new EchoUdsServer(path);
54              Assert.True(server.Start());
55              while (!server.IsStarted)
56                  Thread.Yield();
57              var client = new EchoUdsClient(path);
58              Assert.True(client.ConnectAsync());
59              while (!client.IsConnected || (server.Clients != 1))
60                  Thread.Yield();
61              client.SendAsync("test");
62              while (client.BytesReceived != 4)
63                  Thread.Yield();
64              Assert.True(client.DisconnectAsync());
65              while (client.IsConnected || (server.Clients != 0))
66                  Thread.Yield();
67              Assert.True(server.Stop());
68              while (server.IsStarted)
69                  Thread.Yield();
70              Assert.True(server.Started);
71              Assert.True(server.Stopped);
72              Assert.True(server.Connected);
73              Assert.True(server.Disconnected);
74              Assert.True(server.BytesSent == 4);
75              Assert.True(server.BytesReceived == 4);
76              Assert.True(!server.Errors);
77              Assert.True(client.Connected);
78              Assert.True(client.Disconnected);
79              Assert.True(client.BytesSent == 4);
80              Assert.True(client.BytesReceived == 4);
81              Assert.True(!client.Errors);
82          }
83          [Fact(DisplayName = "Unix Domain Socket server multicast test")]
84          public void UdsServerMulticastTest()
85          {
86              string path = Path.Combine(Path.GetTempPath(), "test.sock");
87              var server = new EchoUdsServer(path);
88              Assert.True(server.Start());
89              while (!server.IsStarted)
90                  Thread.Yield();
91              var client1 = new EchoUdsClient(path);
92              Assert.True(client1.ConnectAsync());
93              while (!client1.IsConnected || (server.Clients != 1))
94                  Thread.Yield();
95              server.Multicast("test");
96              while (client1.BytesReceived != 4)
97                  Thread.Yield();
98              var client2 = new EchoUdsClient(path);
99              Assert.True(client2.ConnectAsync());
100              while (!client2.IsConnected || (server.Clients != 2))
101                  Thread.Yield();
102              server.Multicast("test");
103              while ((client1.BytesReceived != 8) || (client2.BytesReceived != 4))
104                  Thread.Yield();
105              var client3 = new EchoUdsClient(path);
106              Assert.True(client3.ConnectAsync());
107              while (!client3.IsConnected || (server.Clients != 3))
108                  Thread.Yield();
109              server.Multicast("test");
110              while ((client1.BytesReceived != 12) || (client2.BytesReceived != 8) || (client3.BytesReceived != 4))
111                  Thread.Yield();
112              Assert.True(client1.DisconnectAsync());
113              while (client1.IsConnected || (server.Clients != 2))
114                  Thread.Yield();
115              server.Multicast("test");
116              while ((client1.BytesReceived != 12) || (client2.BytesReceived != 12) || (client3.BytesReceived != 8))
117                  Thread.Yield();
118              Assert.True(client2.DisconnectAsync());
119              while (client2.IsConnected || (server.Clients != 1))
120                  Thread.Yield();
121              server.Multicast("test");
122              while ((client1.BytesReceived != 12) || (client2.BytesReceived != 12) || (client3.BytesReceived != 12))
123                  Thread.Yield();
124              Assert.True(client3.DisconnectAsync());
125              while (client3.IsConnected || (server.Clients != 0))
126                  Thread.Yield();
127              Assert.True(server.Stop());
128              while (server.IsStarted)
129                  Thread.Yield();
130              Assert.True(server.Started);
131              Assert.True(server.Stopped);
132              Assert.True(server.Connected);
133              Assert.True(server.Disconnected);
134              Assert.True(server.BytesSent > 0);
135              Assert.True(server.BytesReceived == 0);
<span onclick='openModal()' class='match'>136              Assert.True(!server.Errors);
137              Assert.True(client1.BytesSent == 0);
138              Assert.True(client2.BytesSent == 0);
139              Assert.True(client3.BytesSent == 0);
140              Assert.True(client1.BytesReceived == 12);
141              Assert.True(client2.BytesReceived == 12);
142              Assert.True(client3.BytesReceived == 12);
143              Assert.True(!client1.Errors);
144              Assert.True(!client2.Errors);
145              Assert.True(!client3.Errors);
146          }
147          [Fact(DisplayName = "Unix Domain Socket server random test")]
</span>148          public void UdsServerRandomTest()
149          {
150              string path = Path.Combine(Path.GetTempPath(), "test.sock");
151              var server = new EchoUdsServer(path);
152              Assert.True(server.Start());
153              while (!server.IsStarted)
154                  Thread.Yield();
155              int duration = 10;
156              var clients = new List<EchoUdsClient>();
157              var rand = new Random();
158              var start = DateTime.UtcNow;
159              while ((DateTime.UtcNow - start).TotalSeconds < duration)
160              {
161                  if ((rand.Next() % 1000) == 0)
162                  {
163                      server.DisconnectAll();
164                  }
165                  else if ((rand.Next() % 100) == 0)
166                  {
167                      if (clients.Count < 100)
168                      {
169                          var client = new EchoUdsClient(path);
170                          clients.Add(client);
171                          client.ConnectAsync();
172                          while (!client.IsConnected)
173                              Thread.Yield();
174                      }
175                  }
176                  else if ((rand.Next() % 100) == 0)
177                  {
178                      if (clients.Count > 0)
179                      {
180                          int index = rand.Next() % clients.Count;
181                          var client = clients[index];
182                          if (client.IsConnected)
183                          {
184                              client.DisconnectAsync();
185                              while (client.IsConnected)
186                                  Thread.Yield();
187                          }
188                          else
189                          {
190                              client.ConnectAsync();
191                              while (!client.IsConnected)
192                                  Thread.Yield();
193                          }
194                      }
195                  }
196                  else if ((rand.Next() % 100) == 0)
197                  {
198                      if (clients.Count > 0)
199                      {
200                          int index = rand.Next() % clients.Count;
201                          var client = clients[index];
202                          if (client.IsConnected)
203                          {
204                              client.ReconnectAsync();
205                              while (!client.IsConnected)
206                                  Thread.Yield();
207                          }
208                      }
209                  }
210                  else if ((rand.Next() % 10) == 0)
211                  {
212                      server.Multicast("test");
213                  }
214                  else if ((rand.Next() % 1) == 0)
215                  {
216                      if (clients.Count > 0)
217                      {
218                          int index = rand.Next() % clients.Count;
219                          var client = clients[index];
220                          if (client.IsConnected)
221                              client.SendAsync("test");
222                      }
223                  }
224                  Thread.Sleep(1);
225              }
226              foreach (var client in clients)
227              {
228                  client.DisconnectAsync();
229                  while (client.IsConnected)
230                      Thread.Yield();
231              }
232              Assert.True(server.Stop());
233              while (server.IsStarted)
234                  Thread.Yield();
235              Assert.True(server.Started);
236              Assert.True(server.Stopped);
237              Assert.True(server.Connected);
238              Assert.True(server.Disconnected);
239              Assert.True(server.BytesSent > 0);
240              Assert.True(server.BytesReceived > 0);
241              Assert.True(!server.Errors);
242          }
243      }
244  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-BreakpointServiceTests.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Linq;
4  using System.Text;
5  using System.Threading.Tasks;
6  using FluentAssertions;
7  using Microsoft.Extensions.Options;
8  using Microsoft.JSInterop;
9  using Microsoft.JSInterop.Infrastructure;
10  using Moq;
11  using MudBlazor.Services;
12  using NUnit.Framework;
13  namespace MudBlazor.UnitTests.Services
14  {
15      [TestFixture]
16      public class BreakpointServiceTests
17      {
18          private Mock<IBrowserWindowSizeProvider> _browserWindowSizeProvider;
19          private Mock<IJSRuntime> _jsruntimeMock;
20          private BreakpointService _service;
21          [SetUp]
22          public void SetUp()
23          {
24              _browserWindowSizeProvider = new Mock<IBrowserWindowSizeProvider>();
25              _browserWindowSizeProvider.Setup(x => x.GetBrowserWindowSize()).ReturnsAsync(new BrowserWindowSize { Width = 970, Height = 30 }).Verifiable();
26              _jsruntimeMock = new Mock<IJSRuntime>();
27              _service = new BreakpointService(_jsruntimeMock.Object, _browserWindowSizeProvider.Object);
28          }
29          private record ListenForResizeCallbackInfo(
30              DotNetObjectReference<BreakpointService> DotnetRef, ResizeOptions options, Guid ListenerId);
31          private void SetupJsMockForSubscription(ResizeOptions expectedOptions, bool setBreakpoints, Action<ListenForResizeCallbackInfo> callbackInfo = null)
32          {
33              if (setBreakpoints == true)
34              {
35                  expectedOptions.BreakpointDefinitions = BreakpointService.DefaultBreakpointDefinitions.ToDictionary(x => x.Key.ToString(), x => x.Value);
36              }
37              _jsruntimeMock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.listenForResize",
38                 It.Is<object[]>(z =>
39                     z[0] is DotNetObjectReference<BreakpointService> == true &&
40                     (ResizeOptions)z[1] == expectedOptions &&
41                     (Guid)z[2] != default
42                 ))).ReturnsAsync(Mock.Of<IJSVoidResult>).Callback<string, object[]>((x, z) => callbackInfo?.Invoke(new ListenForResizeCallbackInfo(
43                      (DotNetObjectReference<BreakpointService>)z[0],
44                      (ResizeOptions)z[1], (Guid)z[2]
45                     ))).Verifiable();
46          }
47          private void SetupJsMockForUnsubscription(Guid listenerId)
48          {
49              _jsruntimeMock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.cancelListener",
50                 It.Is<object[]>(z =>
51                     (Guid)z[0] == listenerId
52                 ))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
53          }
54          private async Task CheckSubscriptionOptions(ResizeOptions expectedOptions, bool setBreakpoint)
55          {
56              SetupJsMockForSubscription(expectedOptions, setBreakpoint);
57              var subscriptionResult = await _service.SubscribeAsync((Breakpoint size) => { }, expectedOptions);
58              subscriptionResult.Should().NotBeNull();
59              subscriptionResult.SubscriptionId.Should().NotBe(Guid.Empty);
60              subscriptionResult.Breakpoint.Should().Be(Breakpoint.Md);
61              _jsruntimeMock.Verify();
62          }
63          [Test]
64          public async Task Subscribe_WithDefaultOptions()
65          {
66              await CheckSubscriptionOptions(new ResizeOptions(), true);
67          }
68          [Test]
69          public async Task Subscribe_WithDefaultOptions_SetBreakpoint()
70          {
71              var option = new ResizeOptions();
72              await CheckSubscriptionOptions(option, true);
73              option.BreakpointDefinitions.Should().NotBeNull();
74              option.BreakpointDefinitions.Should().NotBeNull();
75              option.BreakpointDefinitions.Keys.Should().BeEquivalentTo(BreakpointService.DefaultBreakpointDefinitions.Keys.Select(x => x.ToString()).ToList());
76              option.BreakpointDefinitions.Values.Should().BeEquivalentTo(BreakpointService.DefaultBreakpointDefinitions.Values);
77          }
78          [Test]
79          public async Task Subscribe_WithDefaultOptions_DontSetBreakpoint()
80          {
81              var breakpointDict = new Dictionary<string, int>
82                  {
83                      { "something", 12 },
84                  };
85              var option = new ResizeOptions
86              {
87                  BreakpointDefinitions = breakpointDict
88              };
89              await CheckSubscriptionOptions(option, false);
90              option.BreakpointDefinitions.Should().BeEquivalentTo(breakpointDict);
91          }
92          [Test]
93          public async Task Subscribe_WithOptionsSetInConstructor()
94          {
95              var customResizeOptioons = new ResizeOptions
96              {
97                  ReportRate = 120,
98              };
99              var optionGetter = new Mock<IOptions<ResizeOptions>>();
100              optionGetter.SetupGet(x => x.Value).Returns(customResizeOptioons);
101              _service = new BreakpointService(_jsruntimeMock.Object, _browserWindowSizeProvider.Object, optionGetter.Object);
102              await CheckSubscriptionOptions(customResizeOptioons, true);
103          }
104          [Test]
105          public async Task Subscribe_WithPerCallOption()
106          {
107              var customResizeOptioons = new ResizeOptions
108              {
109                  ReportRate = 130,
110              };
111              SetupJsMockForSubscription(customResizeOptioons, true);
112              var subscriptionResult = await _service.SubscribeAsync((Breakpoint size) => { }, customResizeOptioons);
113              subscriptionResult.Should().NotBeNull();
114              subscriptionResult.SubscriptionId.Should().NotBe(Guid.Empty);
115              subscriptionResult.Breakpoint.Should().Be(Breakpoint.Md);
116              _jsruntimeMock.Verify();
117          }
118          [Test]
119          public async Task Subscribe_WithPerCallOptionSetAsNull()
120          {
121              var customResizeOptioons = new ResizeOptions();
122              SetupJsMockForSubscription(customResizeOptioons, true);
123              var subscriptionResult = await _service.SubscribeAsync((Breakpoint size) => { }, null);
124              subscriptionResult.Should().NotBeNull();
125              subscriptionResult.SubscriptionId.Should().NotBe(Guid.Empty);
126              subscriptionResult.Breakpoint.Should().Be(Breakpoint.Md);
127              _jsruntimeMock.Verify();
128          }
129          [Test]
130          public void Subscribe_Failed_NullCallback()
131          {
132              Assert.ThrowsAsync<ArgumentNullException>(() => _service.SubscribeAsync(null));
133              Assert.ThrowsAsync<ArgumentNullException>(() => _service.SubscribeAsync(null, new ResizeOptions()));
134          }
135          [Test]
136          public async Task SubscribeAndUnsubcribe_SingleSubscription()
137          {
138              var customResizeOptioons = new ResizeOptions();
139              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
140              {
141                  if (x.ListenerId == default)
142                  {
143                      throw new ArgumentException();
144                  }
145                  SetupJsMockForUnsubscription(x.ListenerId);
146              };
147              SetupJsMockForSubscription(customResizeOptioons, true, feedbackCaller);
148              var subscriptionId = await _service.SubscribeAsync((Breakpoint size) => { }, null);
149              var result = await _service.UnsubscribeAsync(subscriptionId.SubscriptionId);
150              result.Should().BeTrue();
151              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
152              _jsruntimeMock.Verify();
153          }
154          [Test]
155          public async Task SubscribeAndUnsubcribe_DisposeOfDotNet()
156          {
157              var customResizeOptioons = new ResizeOptions();
158              for (int i = 0; i < 4; i++)
159              {
160                  var lastDotnetRefHashCode = 0;
161                  Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
162                  {
163                      if (x.ListenerId == default)
164                      {
165                          throw new ArgumentException();
166                      }
167                      if (x.DotnetRef.GetHashCode() == lastDotnetRefHashCode)
168                      {
169                          throw new ArgumentException();
170                      }
171                      lastDotnetRefHashCode = x.DotnetRef.GetHashCode();
172                      SetupJsMockForUnsubscription(x.ListenerId);
173                  };
174                  SetupJsMockForSubscription(customResizeOptioons, true, feedbackCaller);
175                  var subscritionResult = await _service.SubscribeAsync((Breakpoint size) => { }, null);
176                  var result = await _service.UnsubscribeAsync(subscritionResult.SubscriptionId);
177                  result.Should().BeTrue();
178                  _jsruntimeMock.Verify();
179              }
180          }
181          [Test]
182          public async Task SubscribeAndUnsubcribe_MultipleSubscription()
183          {
184              var customResizeOptioons = new ResizeOptions();
185              var feedbackCallerCount = 0;
186              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
187              {
188                  if (x.ListenerId == default)
189                  {
190                      throw new ArgumentException();
191                  }
192                  feedbackCallerCount++;
193              };
194              SetupJsMockForSubscription(customResizeOptioons, true, feedbackCaller);
195              HashSet<Guid> subscriptionIds = new HashSet<Guid>();
196              for (int i = 0; i < 10; i++)
197              {
<span onclick='openModal()' class='match'>198                  var subscritionResult = await _service.SubscribeAsync((Breakpoint size) => { });
199                  subscriptionIds.Add(subscritionResult.SubscriptionId);
200              }
201              feedbackCallerCount.Should().Be(1);
202              subscriptionIds.Should().HaveCount(10);
203              _jsruntimeMock.Verify();
204              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
205          }
206          [Test]
</span>207          public async Task SubscribeAndUnsubcribe_MultipleSubscription_WithMultipleOptions()
208          {
209              List<ListenForResizeCallbackInfo> callerFeedbacks = new();
210              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
211              {
212                  if (x.ListenerId == default)
213                  {
214                      throw new ArgumentException();
215                  }
216                  callerFeedbacks.Add(x);
217              };
218              var options = new[]
219              {
220                  new ResizeOptions(),
221                  new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) },
222                  new ResizeOptions { ReportRate = 50 },
223                  new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) },
224              };
225              foreach (var item in options)
226              {
227                  SetupJsMockForSubscription(item, true, feedbackCaller);
228              }
229              var subscriptionIds = options.ToDictionary(x => x, x => new HashSet<Guid>());
230              for (int i = 0; i < 40; i++)
231              {
232                  var index = i % 4;
233                  var option = options[index];
234                  var subscritionResult = await _service.SubscribeAsync((Breakpoint size) => { }, option);
235                  subscriptionIds[option].Add(subscritionResult.SubscriptionId);
236              }
237              foreach (var item in subscriptionIds)
238              {
239                  item.Value.Should().HaveCount(10);
240              }
241              callerFeedbacks.Should().HaveCount(4);
242              for (int i = 0; i < callerFeedbacks.Count; i++)
243              {
244                  var feedback = callerFeedbacks[i];
245                  feedback.options.Should().Be(options[i]);
246              }
247              callerFeedbacks.Select(x => x.ListenerId).ToHashSet().Should().HaveCount(4);
248              _jsruntimeMock.Verify();
249              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
250          }
251          [Test]
252          public async Task Unsubscribe_Failed_NoActiveSubscription()
253          {
254              var result = await _service.UnsubscribeAsync(Guid.NewGuid());
255              result.Should().BeFalse();
256          }
257          [Test]
258          public async Task Unsubscribe_Failed_SubscriptioonIdNotFound()
259          {
260              var customResizeOptioons = new ResizeOptions();
261              SetupJsMockForSubscription(customResizeOptioons, true);
262              var subscriptionId = await _service.SubscribeAsync((Breakpoint size) => { }, null);
263              var result = await _service.UnsubscribeAsync(Guid.NewGuid());
264              result.Should().BeFalse();
265          }
266          [Test]
267          public async Task DisposeAsync_Failed_NoActiveSubscription()
268          {
269              await _service.DisposeAsync();
270          }
271          [Test]
272          public async Task DisposeAsync_MultipleSubscription_WithMultipleOptions()
273          {
274              List<Guid> callerIds = new();
275              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
276              {
277                  if (x.ListenerId == default)
278                  {
279                      throw new ArgumentException();
280                  }
281                  callerIds.Add(x.ListenerId);
282              };
283              var options = new[]
284              {
285                  new ResizeOptions(),
286                  new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) },
287                  new ResizeOptions { ReportRate = 50 },
288                  new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) },
289              };
290              foreach (var item in options)
291              {
292                  SetupJsMockForSubscription(item, true, feedbackCaller);
293              }
294              for (int i = 0; i < 40; i++)
295              {
296                  var index = i % 4;
297                  var option = options[index];
298                  await _service.SubscribeAsync((Breakpoint size) => { }, option);
299              }
300              Func<IEnumerable<Guid>, bool> idChecker = (ids) =>
301               {
302                   try
303                   {
304                       ids.Should().BeEquivalentTo(callerIds);
305                       return true;
306                   }
307                   catch (Exception)
308                   {
309                       return false;
310                   }
311               };
312              _jsruntimeMock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.cancelListeners",
313               It.Is<object[]>(z =>
314                   z[0] is IEnumerable<Guid> &&
315                   idChecker((IEnumerable<Guid>)z[0]) == true
316               ))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
317              await _service.DisposeAsync();
318              _jsruntimeMock.Verify();
319          }
320          private class FakeSubscriber
321          {
322              public Guid SubscriptionId { get; private set; }
323              public Breakpoint ActualSize { get; private set; } = Breakpoint.None;
324              public async Task Subscribe(BreakpointService service,
325                  ResizeOptions options)
326              {
327                  var result = await service.SubscribeAsync((x) => ActualSize = x, options);
328                  SubscriptionId = result.SubscriptionId;
329              }
330          }
331          [Test]
332          public async Task RaiseOnResized_MultipleSubscription_WithMultipleOptions()
333          {
334              Dictionary<ResizeOptions, Guid> listenerIds = new();
335              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) => listenerIds.Add(x.options, x.ListenerId); ;
336              var options = new[]
337              {
338                  (new ResizeOptions(), Breakpoint.Xl ),
339                  (new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) }, Breakpoint.Sm),
340                  (new ResizeOptions { ReportRate = 50 },Breakpoint.Xs),
341                  (new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) }, Breakpoint.Lg)
342              };
343              Dictionary<FakeSubscriber, Breakpoint> subscribers = new();
344              foreach (var item in options)
345              {
346                  SetupJsMockForSubscription(item.Item1, true, feedbackCaller);
347              }
348              for (int i = 0; i < 40; i++)
349              {
350                  var index = i % 4;
351                  var option = options[index];
352                  var subscriber = new FakeSubscriber();
353                  await subscriber.Subscribe(_service, option.Item1);
354                  subscribers.Add(subscriber, option.Item2);
355              }
356              foreach (var item in options)
357              {
358                  var listenerId = listenerIds[item.Item1];
359                  _service.RaiseOnResized(new BrowserWindowSize { }, item.Item2, listenerId);
360              }
361              foreach (var item in subscribers)
362              {
363                  item.Key.ActualSize.Should().Be(item.Value);
364              }
365              _jsruntimeMock.Verify();
366              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
367          }
368          [Test]
369          public async Task RaiseOnResized_InvalidListenerId()
370          {
371              var customResizeOptions = new ResizeOptions();
372              SetupJsMockForSubscription(customResizeOptions, true);
373              FakeSubscriber subscriber = new FakeSubscriber();
374              await subscriber.Subscribe(_service, customResizeOptions);
375              _service.RaiseOnResized(new BrowserWindowSize { }, Breakpoint.Xl, Guid.NewGuid());
376              subscriber.ActualSize.Should().Be(Breakpoint.None);
377          }
378          [Test]
379          public async Task Subscribe_ChangeHappens_SecondSubscriptionGetNewValue()
380          {
381              var customResizeOptioons = new ResizeOptions();
382              SetupJsMockForSubscription(customResizeOptioons, true);
383              var firstSubscribeResult = await _service.SubscribeAsync((Breakpoint size) => { }, customResizeOptioons);
384              firstSubscribeResult.Breakpoint.Should().Be(Breakpoint.Md);
385              _service.RaiseOnResized(new BrowserWindowSize { }, Breakpoint.Xl, Guid.NewGuid());
386              var secondSubscribeResult = await _service.SubscribeAsync((Breakpoint size) => { }, customResizeOptioons);
387              secondSubscribeResult.Breakpoint.Should().Be(Breakpoint.Xl);
388              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
389              _jsruntimeMock.Verify();
390          }
391          [Test]
392          [TestCase(true)]
393          [TestCase(false)]
394          public async Task MatchMedia(bool interopResult)
395          {
396              var input = "some input, not relevant for test";
397              _jsruntimeMock.Setup(x => x.InvokeAsync<bool>("mudResizeListener.matchMedia",
398              It.Is<object[]>(z =>
399                  z[0] is string &&
400                  (string)z[0] == input
401              ))).ReturnsAsync(interopResult).Verifiable();
402              var result = await _service.MatchMedia(input);
403              result.Should().Be(interopResult);
404          }
405          [Test]
406          public void DefaultBreakpointDefinitions()
407          {
408              BreakpointService.DefaultBreakpointDefinitions.Keys.Should().BeEquivalentTo(new[] {
409                  Breakpoint.Xl, Breakpoint.Lg, Breakpoint.Md, Breakpoint.Sm, Breakpoint.Xs });
410              BreakpointService.DefaultBreakpointDefinitions.Values.Should().BeEquivalentTo(new[] {
411                  1920, 1280, 960, 600, 0 });
412          }
413          [TestCase(Breakpoint.Xs, 0, true)]
414          [TestCase(Breakpoint.Xs, 599, true)]
415          [TestCase(Breakpoint.Xs, 600, false)]
416          [TestCase(Breakpoint.Sm, 599, false)]
417          [TestCase(Breakpoint.Sm, 600, true)]
418          [TestCase(Breakpoint.Sm, 959, true)]
419          [TestCase(Breakpoint.Sm, 960, false)]
420          [TestCase(Breakpoint.Md, 959, false)]
421          [TestCase(Breakpoint.Md, 960, true)]
422          [TestCase(Breakpoint.Md, 1279, true)]
423          [TestCase(Breakpoint.Md, 1280, false)]
424          [TestCase(Breakpoint.Lg, 1279, false)]
425          [TestCase(Breakpoint.Lg, 1280, true)]
426          [TestCase(Breakpoint.Lg, 1919, true)]
427          [TestCase(Breakpoint.Lg, 1920, false)]
428          [TestCase(Breakpoint.Xl, 1919, false)]
429          [TestCase(Breakpoint.Xl, 1920, true)]
430          [TestCase(Breakpoint.Xl, 9999, true)]
431          [TestCase(Breakpoint.SmAndUp, 599, false)]
432          [TestCase(Breakpoint.SmAndUp, 600, true)]
433          [TestCase(Breakpoint.SmAndUp, 9999, true)]
434          [TestCase(Breakpoint.MdAndUp, 959, false)]
435          [TestCase(Breakpoint.MdAndUp, 960, true)]
436          [TestCase(Breakpoint.MdAndUp, 9999, true)]
437          [TestCase(Breakpoint.LgAndUp, 1279, false)]
438          [TestCase(Breakpoint.LgAndUp, 1280, true)]
439          [TestCase(Breakpoint.LgAndUp, 9999, true)]
440          [TestCase(Breakpoint.SmAndDown, 960, false)]
441          [TestCase(Breakpoint.SmAndDown, 959, true)]
442          [TestCase(Breakpoint.SmAndDown, 0, true)]
443          [TestCase(Breakpoint.MdAndDown, 1280, false)]
444          [TestCase(Breakpoint.MdAndDown, 1279, true)]
445          [TestCase(Breakpoint.MdAndDown, 0, true)]
446          [TestCase(Breakpoint.LgAndDown, 1920, false)]
447          [TestCase(Breakpoint.LgAndDown, 1919, true)]
448          [TestCase(Breakpoint.LgAndDown, 0, true)]
449          public async Task IsMediaSizeReturnsCorrectValue(Breakpoint breakpoint, int browserWidth, bool expectedValue)
450          {
451              _browserWindowSizeProvider
452                  .Setup(p => p.GetBrowserWindowSize())
453                  .ReturnsAsync(new BrowserWindowSize { Width = browserWidth })
454                  .Verifiable();
455              var actual = await _service.IsMediaSize(breakpoint);
456              actual.Should().Be(expectedValue);
457              _browserWindowSizeProvider.Verify();
458          }
459          [Test]
460          public async Task IsMediaSize_ReturnFalseForNoneBreakpoint()
461          {
462              var actual = await _service.IsMediaSize(Breakpoint.None);
463              actual.Should().BeFalse();
464          }
465          [Test]
466          public async Task IsMediaSize_ReturnTrueForAlwaysBreakpoint()
467          {
468              var actual = await _service.IsMediaSize(Breakpoint.Always);
469              actual.Should().BeTrue();
470          }
471      }
472  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from NetCoreServer-MDEwOlJlcG9zaXRvcnkxNjYxMjMxNjQ=-flat-UdsTests.cs</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-BreakpointServiceTests.cs</div>
                <div class="column column_space"><pre><code>136              Assert.True(!server.Errors);
137              Assert.True(client1.BytesSent == 0);
138              Assert.True(client2.BytesSent == 0);
139              Assert.True(client3.BytesSent == 0);
140              Assert.True(client1.BytesReceived == 12);
141              Assert.True(client2.BytesReceived == 12);
142              Assert.True(client3.BytesReceived == 12);
143              Assert.True(!client1.Errors);
144              Assert.True(!client2.Errors);
145              Assert.True(!client3.Errors);
146          }
147          [Fact(DisplayName = "Unix Domain Socket server random test")]
</pre></code></div>
                <div class="column column_space"><pre><code>198                  var subscritionResult = await _service.SubscribeAsync((Breakpoint size) => { });
199                  subscriptionIds.Add(subscritionResult.SubscriptionId);
200              }
201              feedbackCallerCount.Should().Be(1);
202              subscriptionIds.Should().HaveCount(10);
203              _jsruntimeMock.Verify();
204              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
205          }
206          [Test]
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    