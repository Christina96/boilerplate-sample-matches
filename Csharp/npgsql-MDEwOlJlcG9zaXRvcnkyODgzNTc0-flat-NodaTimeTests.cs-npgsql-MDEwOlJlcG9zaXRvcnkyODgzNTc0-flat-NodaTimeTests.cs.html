
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 16, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NodaTimeTests.cs</h3>
            <pre><code>1  using System;
2  using System.Data;
3  using System.Threading.Tasks;
4  using NodaTime;
5  using Npgsql.Tests;
6  using NpgsqlTypes;
7  using NUnit.Framework;
8  using static Npgsql.Tests.TestUtil;
9  namespace Npgsql.NodaTime.Tests;
10  public class NodaTimeTests : TestBase
11  {
12      #region Timestamp without time zone
13      static readonly TestCaseData[] TimestampValues =
14      {
15          new TestCaseData(new LocalDateTime(1998, 4, 12, 13, 26, 38, 789), "1998-04-12 13:26:38.789")
16              .SetName("Timestamp_pre2000"),
17          new TestCaseData(new LocalDateTime(2015, 1, 27, 8, 45, 12, 345), "2015-01-27 08:45:12.345")
18              .SetName("Timestamp_post2000"),
19          new TestCaseData(new LocalDateTime(1999, 12, 31, 23, 59, 59, 999).PlusNanoseconds(456000), "1999-12-31 23:59:59.999456")
20              .SetName("Timestamp_with_microseconds")
21      };
22      [Test, TestCaseSource(nameof(TimestampValues))]
23      public Task Timestamp_as_LocalDateTime(LocalDateTime localDateTime, string sqlLiteral)
24          => AssertType(localDateTime, sqlLiteral, "timestamp without time zone", NpgsqlDbType.Timestamp, DbType.DateTime2);
25      [Test]
26      public Task Timestamp_as_unspecified_DateTime()
27          => AssertType(
28              new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Unspecified),
29              "1998-04-12 13:26:38",
30              "timestamp without time zone",
31              NpgsqlDbType.Timestamp,
32              DbType.DateTime2,
33              isDefaultForReading: false);
34      [Test]
35      public Task Timestamp_as_long()
36          => AssertType(
37              -54297202000000,
38              "1998-04-12 13:26:38",
39              "timestamp without time zone",
40              NpgsqlDbType.Timestamp,
41              DbType.DateTime2,
42              isDefault: false);
43      [Test]
44      public Task Timestamp_cannot_use_as_Instant()
45          => AssertTypeUnsupported(
46              new LocalDateTime(1998, 4, 12, 13, 26, 38, 789).InUtc().ToInstant(),
47              "1998-04-12 13:26:38.789",
48              "timestamp without time zone");
49      [Test]
50      public Task Timestamp_cannot_use_as_ZonedDateTime()
51          => AssertTypeUnsupported(
52              new LocalDateTime(1998, 4, 12, 13, 26, 38, 789).InUtc(),
53              "1998-04-12 13:26:38.789",
54              "timestamp without time zone");
55      [Test]
56      public Task Timestamp_cannot_use_as_OffsetDateTime()
57          => AssertTypeUnsupported(
58              new LocalDateTime(1998, 4, 12, 13, 26, 38, 789).WithOffset(Offset.FromHours(2)),
59              "1998-04-12 13:26:38.789",
60              "timestamp without time zone");
61      [Test]
62      public Task Timestamp_cannot_use_as_DateTimeOffset()
63          => AssertTypeUnsupported(
64              new DateTimeOffset(1998, 4, 12, 13, 26, 38, TimeSpan.Zero),
65              "1998-04-12 13:26:38",
66              "timestamp without time zone");
67      [Test]
68      public Task Timestamp_cannot_write_utc_DateTime()
69          => AssertTypeUnsupportedWrite(new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Utc), "timestamp without time zone");
70      [Test]
71      public Task Tsrange_as_NpgsqlRange_of_LocalDateTime()
72          => AssertType(
73              new NpgsqlRange<LocalDateTime>(
74                  new(1998, 4, 12, 13, 26, 38),
75                  new(1998, 4, 12, 15, 26, 38)),
76              @"[""1998-04-12 13:26:38"",""1998-04-12 15:26:38""]",
77              "tsrange",
78              NpgsqlDbType.TimestampRange);
79      [Test]
80      public async Task Tsmultirange_as_array_of_NpgsqlRange_of_LocalDateTime()
81      {
82          await using var conn = await OpenConnectionAsync();
83          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
84          await AssertType(
85              new[]
86              {
87                  new NpgsqlRange<LocalDateTime>(
88                      new(1998, 4, 12, 13, 26, 38),
89                      new(1998, 4, 12, 15, 26, 38)),
90                  new NpgsqlRange<LocalDateTime>(
91                      new(1998, 4, 13, 13, 26, 38),
92                      new(1998, 4, 13, 15, 26, 38)),
93              },
94              @"{[""1998-04-12 13:26:38"",""1998-04-12 15:26:38""],[""1998-04-13 13:26:38"",""1998-04-13 15:26:38""]}",
95              "tsmultirange",
96              NpgsqlDbType.TimestampMultirange);
97      }
98      #endregion Timestamp without time zone
99      #region Timestamp with time zone
100      static readonly TestCaseData[] TimestamptzValues =
101      {
102          new TestCaseData(new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(), "1998-04-12 15:26:38+02")
103              .SetName("Timestamptz_pre2000"),
104          new TestCaseData(new LocalDateTime(2015, 1, 27, 8, 45, 12, 345).InUtc().ToInstant(), "2015-01-27 09:45:12.345+01")
105              .SetName("Timestamptz_post2000"),
106          new TestCaseData(new LocalDateTime(2013, 7, 25, 0, 0, 0).InUtc().ToInstant(), "2013-07-25 02:00:00+02")
107              .SetName("Timestamptz_write_date_only"),
108          new TestCaseData(new LocalDateTime(1999, 12, 31, 23, 59, 59, 999).PlusNanoseconds(456000).InUtc().ToInstant(), "2000-01-01 00:59:59.999456+01")
109              .SetName("Timestamptz_with_microseconds")
110      };
111      [Test, TestCaseSource(nameof(TimestamptzValues))]
112      public Task Timestamptz_as_Instant(Instant instant, string sqlLiteral)
113          => AssertType(instant, sqlLiteral, "timestamp with time zone", NpgsqlDbType.TimestampTz, DbType.DateTime);
114      [Test]
115      public Task Timestamptz_as_ZonedDateTime()
116          => AssertType(
117              new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc(),
118              "1998-04-12 15:26:38+02",
119              "timestamp with time zone",
120              NpgsqlDbType.TimestampTz,
121              DbType.DateTime,
122              isDefaultForReading: false);
123      [Test]
124      public Task Timestamptz_as_OffsetDateTime()
125          => AssertType(
126              new LocalDateTime(1998, 4, 12, 13, 26, 38).WithOffset(Offset.Zero),
127              "1998-04-12 15:26:38+02",
128              "timestamp with time zone",
129              NpgsqlDbType.TimestampTz,
130              DbType.DateTime,
131              isDefaultForReading: false);
132      [Test]
133      public Task Timestamptz_as_utc_DateTime()
134          => AssertType(
135              new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Utc),
136              "1998-04-12 15:26:38+02",
137              "timestamp with time zone",
138              NpgsqlDbType.TimestampTz,
139              DbType.DateTime,
140              isDefaultForReading: false);
141      [Test]
142      public Task Timestamptz_as_DateTimeOffset()
143          => AssertType(
144              new DateTimeOffset(1998, 4, 12, 13, 26, 38, TimeSpan.Zero),
145              "1998-04-12 15:26:38+02",
146              "timestamp with time zone",
147              NpgsqlDbType.TimestampTz,
148              DbType.DateTime,
149              isDefaultForReading: false);
150      [Test]
151      public Task Timestamptz_as_long()
152          => AssertType(
153              -54297202000000,
154              "1998-04-12 15:26:38+02",
155              "timestamp with time zone",
156              NpgsqlDbType.TimestampTz,
157              DbType.DateTime,
158              isDefault: false);
159      [Test]
160      public Task Timestamptz_cannot_use_as_LocalDateTime()
161          => AssertTypeUnsupported(new LocalDateTime(1998, 4, 12, 13, 26, 38), "1998-04-12 13:26:38Z", "timestamp with time zone");
162      [Test]
163      public async Task Timestamptz_cannot_write_non_utc_ZonedDateTime()
164          => await AssertTypeUnsupportedWrite(
165              new LocalDateTime().InUtc().ToInstant().InZone(DateTimeZoneProviders.Tzdb["Europe/Berlin"]),
166              "timestamp with time zone");
167      [Test]
168      public async Task Timestamptz_cannot_write_non_utc_OffsetDateTime()
169          => await AssertTypeUnsupportedWrite(new LocalDateTime().WithOffset(Offset.FromHours(2)), "timestamp with time zone");
170      [Test]
171      public async Task Timestamptz_cannot_write_non_utc_DateTime()
172      {
173          await AssertTypeUnsupportedWrite(new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Unspecified), "timestamp with time zone");
174          await AssertTypeUnsupportedWrite(new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Local), "timestamp with time zone");
175      }
176      [Test]
177      public Task Tstzrange_as_Interval()
178          => AssertType(
179              new Interval(
180                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
181                  new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
182              @"[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02"")",
183              "tstzrange",
184              NpgsqlDbType.TimestampTzRange);
185      [Test]
186      public Task Tstzrange_with_no_end_as_Interval()
187          => AssertType(
188              new Interval(
189                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(), null),
190              @"[""1998-04-12 15:26:38+02"",)",
191              "tstzrange",
192              NpgsqlDbType.TimestampTzRange);
193      [Test]
194      public Task Tstzrange_with_no_start_as_Interval()
195          => AssertType(
196              new Interval( null,
197                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant()),
198              @"(,""1998-04-12 15:26:38+02"")",
199              "tstzrange",
200              NpgsqlDbType.TimestampTzRange);
201      [Test]
202      public Task Tstzrange_with_no_start_or_end_as_Interval()
203          => AssertType(
204              new Interval(null, null),
205              @"(,)",
206              "tstzrange",
207              NpgsqlDbType.TimestampTzRange);
208      [Test]
209      public Task Tstzrange_as_NpgsqlRange_of_Instant()
210          => AssertType(
211              new NpgsqlRange<Instant>(
212                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
213                  new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
214              @"[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""]",
215              "tstzrange",
216              NpgsqlDbType.TimestampTzRange,
217              isDefaultForReading: false);
218      [Test]
219      public Task Tstzrange_as_NpgsqlRange_of_ZonedDateTime()
220          => AssertType(
221              new NpgsqlRange<ZonedDateTime>(
222                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc(),
223                  new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc()),
224              @"[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""]",
225              "tstzrange",
226              NpgsqlDbType.TimestampTzRange,
227              isDefaultForReading: false);
228      [Test]
229      public Task Tstzrange_as_NpgsqlRange_of_OffsetDateTime()
230          => AssertType(
231              new NpgsqlRange<OffsetDateTime>(
232                  new LocalDateTime(1998, 4, 12, 13, 26, 38).WithOffset(Offset.Zero),
233                  new LocalDateTime(1998, 4, 12, 15, 26, 38).WithOffset(Offset.Zero)),
234              @"[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""]",
235              "tstzrange",
236              NpgsqlDbType.TimestampTzRange,
237              isDefaultForReading: false);
238      [Test]
239      public async Task Tstzmultirange_as_array_of_Interval()
240      {
241          await using var conn = await OpenConnectionAsync();
242          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
243          await AssertType(
244              new[]
245              {
246                  new Interval(
247                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
248                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
249                  new Interval(
250                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
251                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc().ToInstant()),
252              },
253              @"{[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""),[""1998-04-13 15:26:38+02"",""1998-04-13 17:26:38+02"")}",
254              "tstzmultirange",
255              NpgsqlDbType.TimestampTzMultirange);
256      }
257      [Test]
258      public async Task Tstzmultirange_as_array_of_NpgsqlRange_of_Instant()
259      {
260          await using var conn = await OpenConnectionAsync();
261          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
262          await AssertType(
263              new[]
264              {
265                  new NpgsqlRange<Instant>(
266                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
267                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
268                  new NpgsqlRange<Instant>(
269                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
270                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc().ToInstant()),
271              },
272              @"{[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""],[""1998-04-13 15:26:38+02"",""1998-04-13 17:26:38+02""]}",
273              "tstzmultirange",
274              NpgsqlDbType.TimestampTzMultirange,
275              isDefaultForReading: false);
276      }
277      [Test]
278      public async Task Tstzmultirange_as_array_of_NpgsqlRange_of_ZonedDateTime()
279      {
280          await using var conn = await OpenConnectionAsync();
281          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
282          await AssertType(
283              new[]
284              {
285                  new NpgsqlRange<ZonedDateTime>(
286                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc(),
287                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc()),
288                  new NpgsqlRange<ZonedDateTime>(
289                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc(),
290                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc()),
291              },
292              @"{[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""],[""1998-04-13 15:26:38+02"",""1998-04-13 17:26:38+02""]}",
293              "tstzmultirange",
294              NpgsqlDbType.TimestampTzMultirange,
295              isDefaultForReading: false);
296      }
297      [Test]
298      public async Task Tstzmultirange_as_array_of_NpgsqlRange_of_OffsetDateTime()
299      {
300          await using var conn = await OpenConnectionAsync();
301          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
302          await AssertType(
303              new[]
304              {
305                  new NpgsqlRange<OffsetDateTime>(
306                      new LocalDateTime(1998, 4, 12, 13, 26, 38).WithOffset(Offset.Zero),
307                      new LocalDateTime(1998, 4, 12, 15, 26, 38).WithOffset(Offset.Zero)),
308                  new NpgsqlRange<OffsetDateTime>(
309                      new LocalDateTime(1998, 4, 13, 13, 26, 38).WithOffset(Offset.Zero),
310                      new LocalDateTime(1998, 4, 13, 15, 26, 38).WithOffset(Offset.Zero)),
311              },
312              @"{[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""],[""1998-04-13 15:26:38+02"",""1998-04-13 17:26:38+02""]}",
313              "tstzmultirange",
314              NpgsqlDbType.TimestampTzMultirange,
315              isDefaultForReading: false);
316      }
317      [Test]
318      public async Task Tstzrange_array_as_array_of_Interval()
319      {
320          await using var conn = await OpenConnectionAsync();
321          await AssertType<Array>(
322              new[]
323              {
324                  new Interval(
325                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
326                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
327                  new Interval(
328                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
329                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc().ToInstant()),
330                  new Interval(
331                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
332                      null),
333                  new Interval(
334                      null,
335                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant()),
336                  new Interval(
337                      null,
338                      null)
339              },
340              @"{""[\""1998-04-12 15:26:38+02\"",\""1998-04-12 17:26:38+02\"")"",""[\""1998-04-13 15:26:38+02\"",\""1998-04-13 17:26:38+02\"")"",""[\""1998-04-13 15:26:38+02\"",)"",""(,\""1998-04-13 15:26:38+02\"")"",""(,)""}",
341              "tstzrange[]",
342              NpgsqlDbType.TimestampTzRange | NpgsqlDbType.Array,
343              isDefaultForWriting: false);
344      }
345      [Test]
346      public async Task Tstzrange_array_as_array_of_NpgsqlRange_of_Instant()
347      {
348          await using var conn = await OpenConnectionAsync();
349          await AssertType(
350              new[]
351              {
352                  new NpgsqlRange<Instant>(
353                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
354                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
355                  new NpgsqlRange<Instant>(
356                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
357                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc().ToInstant()),
358              },
359              @"{""[\""1998-04-12 15:26:38+02\"",\""1998-04-12 17:26:38+02\""]"",""[\""1998-04-13 15:26:38+02\"",\""1998-04-13 17:26:38+02\""]""}",
360              "tstzrange[]",
361              NpgsqlDbType.TimestampTzRange | NpgsqlDbType.Array,
362              isDefault: false);
363      }
364      #endregion Timestamp with time zone
365      #region Date
366      [Test]
367      public Task Date_as_LocalDate()
368          => AssertType(new LocalDate(2020, 10, 1), "2020-10-01", "date", NpgsqlDbType.Date, DbType.Date);
369      [Test]
370      public Task Date_as_DateTime()
371          => AssertType(new DateTime(2020, 10, 1), "2020-10-01", "date", NpgsqlDbType.Date, DbType.Date, isDefault: false);
372      [Test]
373      public Task Date_as_int()
374          => AssertType(7579, "2020-10-01", "date", NpgsqlDbType.Date, DbType.Date, isDefault: false);
375      [Test]
376      public Task Daterange_as_DateInterval()
377          => AssertType(
378              new DateInterval(new(2002, 3, 4), new(2002, 3, 6)),
379              "[2002-03-04,2002-03-07)",
380              "daterange",
381              NpgsqlDbType.DateRange);
382      [Test]
383      public Task Daterange_as_NpgsqlRange_of_LocalDate()
384          => AssertType(
385              new NpgsqlRange<LocalDate>(new(2002, 3, 4), true, new(2002, 3, 6), false),
<span onclick='openModal()' class='match'>386              "[2002-03-04,2002-03-06)",
387              "daterange",
388              NpgsqlDbType.DateRange,
389              isDefaultForReading: false);
390      [Test]
391      public async Task Datemultirange_as_array_of_DateInterval()
392      {
393          await using var conn = await OpenConnectionAsync();
394          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
</span>395          await AssertType(
396              new[]
397              {
398                  new DateInterval(new(2002, 3, 4), new(2002, 3, 5)),
399                  new DateInterval(new(2002, 3, 8), new(2002, 3, 10))
400              },
401              "{[2002-03-04,2002-03-06),[2002-03-08,2002-03-11)}",
402              "datemultirange",
403              NpgsqlDbType.DateMultirange);
404      }
405      [Test]
406      public async Task Datemultirange_as_array_of_NpgsqlRange_of_LocalDate()
407      {
408          await using var conn = await OpenConnectionAsync();
409          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
410          await AssertType(
411              new[]
412              {
413                  new NpgsqlRange<LocalDate>(new(2002, 3, 4), true, new(2002, 3, 6), false),
414                  new NpgsqlRange<LocalDate>(new(2002, 3, 8), true, new(2002, 3, 11), false)
415              },
416              "{[2002-03-04,2002-03-06),[2002-03-08,2002-03-11)}",
417              "datemultirange",
418              NpgsqlDbType.DateMultirange,
419              isDefaultForReading: false);
420      }
421  #if NET6_0_OR_GREATER
422      [Test]
423      public Task Date_as_DateOnly()
424          => AssertType(new DateOnly(2020, 10, 1), "2020-10-01", "date", NpgsqlDbType.Date, DbType.Date, isDefaultForReading: false);
425      [Test]
426      public Task Daterange_as_NpgsqlRange_of_DateOnly()
427          => AssertType(
428              new NpgsqlRange<DateOnly>(new(2002, 3, 4), true, new(2002, 3, 6), false),
429              "[2002-03-04,2002-03-06)",
430              "daterange",
431              NpgsqlDbType.DateRange,
432              isDefaultForReading: false);
433  #endif
434      [Test]
435      public async Task Daterange_array_as_array_of_DateInterval()
436      {
437          await using var conn = await OpenConnectionAsync();
438          await AssertType<Array>(
439              new[]
440              {
441                  new DateInterval(new(2002, 3, 4), new(2002, 3, 5)),
442                  new DateInterval(new(2002, 3, 8), new(2002, 3, 10))
443              },
444              @"{""[2002-03-04,2002-03-06)"",""[2002-03-08,2002-03-11)""}",
445              "daterange[]",
446              NpgsqlDbType.DateRange | NpgsqlDbType.Array,
447              isDefaultForWriting: false);
448      }
449      [Test]
450      public async Task Daterange_array_as_array_of_NpgsqlRange_of_LocalDate()
451      {
452          await using var conn = await OpenConnectionAsync();
453          await AssertType(
454              new[]
455              {
456                  new NpgsqlRange<LocalDate>(new(2002, 3, 4), true, new(2002, 3, 6), false),
457                  new NpgsqlRange<LocalDate>(new(2002, 3, 8), true, new(2002, 3, 11), false)
458              },
459              @"{""[2002-03-04,2002-03-06)"",""[2002-03-08,2002-03-11)""}",
460              "daterange[]",
461              NpgsqlDbType.DateRange | NpgsqlDbType.Array,
462              isDefault: false);
463      }
464      #endregion Date
465      #region Time
466      [Test]
467      public Task Time_as_LocalTime()
468          => AssertType(new LocalTime(10, 45, 34, 500), "10:45:34.5", "time without time zone", NpgsqlDbType.Time, DbType.Time);
469      [Test]
470      public Task Time_as_TimeSpan()
471          => AssertType(
472              new TimeSpan(0, 10, 45, 34, 500),
473              "10:45:34.5",
474              "time without time zone",
475              NpgsqlDbType.Time,
476              DbType.Time,
477              isDefault: false);
478  #if NET6_0_OR_GREATER
479      [Test]
480      public Task Time_as_TimeOnly()
481          => AssertType(
482              new TimeOnly(10, 45, 34, 500),
483              "10:45:34.5",
484              "time without time zone",
485              NpgsqlDbType.Time,
486              DbType.Time,
487              isDefaultForReading: false);
488  #endif
489      #endregion Time
490      #region Time with time zone
491      [Test]
492      public Task TimeTz_as_OffsetTime()
493          => AssertType(
494              new OffsetTime(new LocalTime(1, 2, 3, 4).PlusNanoseconds(5000), Offset.FromHoursAndMinutes(3, 30) + Offset.FromSeconds(5)),
495              "01:02:03.004005+03:30:05",
496              "time with time zone",
497              NpgsqlDbType.TimeTz);
498      [Test]
499      public async Task TimeTz_as_DateTimeOffset()
500      {
501          await AssertTypeRead(
502              "13:03:45.51+02",
503              "time with time zone",
504              new DateTimeOffset(1, 1, 2, 13, 3, 45, 510, TimeSpan.FromHours(2)), isDefault: false);
505          await AssertTypeWrite(
506              new DateTimeOffset(1, 1, 1, 13, 3, 45, 510, TimeSpan.FromHours(2)),
507              "13:03:45.51+02",
508              "time with time zone",
509              NpgsqlDbType.TimeTz,
510              isDefault: false);
511      }
512      #endregion Time with time zone
513      #region Interval
514      [Test]
515      public Task Interval_as_Period()
516          => AssertType(
517              new PeriodBuilder
518              {
519                  Years = 1,
520                  Months = 2,
521                  Weeks = 3,
522                  Days = 4,
523                  Hours = 5,
524                  Minutes = 6,
525                  Seconds = 7,
526                  Milliseconds = 8,
527                  Nanoseconds = 9000
528              }.Build().Normalize(),
529              "1 year 2 mons 25 days 05:06:07.008009",
530              "interval",
531              NpgsqlDbType.Interval);
532      [Test]
533      public Task Interval_as_Duration()
534          => AssertType(
535              Duration.FromDays(5) + Duration.FromMinutes(4) + Duration.FromSeconds(3) + Duration.FromMilliseconds(2) +
536              Duration.FromNanoseconds(1000),
537              "5 days 00:04:03.002001",
538              "interval",
539              NpgsqlDbType.Interval,
540              isDefaultForReading: false);
541      [Test]
542      public Task Interval_as_Duration_with_months_fails()
543          => AssertTypeUnsupportedRead<Duration, NpgsqlException>("2 months", "interval");
544      [Test, IssueLink("https:&bsol;&bsol;github.com/npgsql/npgsql/issues/3438")]
545      public async Task Bug3438()
546      {
547          await using var conn = await OpenConnectionAsync();
548          using var cmd = new NpgsqlCommand("SELECT @p1, @p2", conn);
549          var expected = Duration.FromSeconds(2148);
550          cmd.Parameters.Add(new NpgsqlParameter("p1", NpgsqlDbType.Interval) { Value = expected });
551          cmd.Parameters.AddWithValue("p2", expected);
552          using var reader = cmd.ExecuteReader();
553          reader.Read();
554          for (var i = 0; i < 2; i++)
555          {
556              Assert.That(reader.GetFieldType(i), Is.EqualTo(typeof(Period)));
557          }
558      }
559      #endregion Interval
560      #region Support
561      protected override async ValueTask<NpgsqlConnection> OpenConnectionAsync()
562      {
563          var conn = await base.OpenConnectionAsync();
564          await conn.ExecuteNonQueryAsync("SET TimeZone='Europe/Berlin'");
565          return conn;
566      }
567      protected override NpgsqlConnection OpenConnection()
568          => throw new NotSupportedException();
569      #endregion Support
570  }
</code></pre>
        </div>
        <div class="column">
            <h3>npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NodaTimeTests.cs</h3>
            <pre><code>1  using System;
2  using System.Data;
3  using System.Threading.Tasks;
4  using NodaTime;
5  using Npgsql.Tests;
6  using NpgsqlTypes;
7  using NUnit.Framework;
8  using static Npgsql.Tests.TestUtil;
9  namespace Npgsql.NodaTime.Tests;
10  public class NodaTimeTests : TestBase
11  {
12      #region Timestamp without time zone
13      static readonly TestCaseData[] TimestampValues =
14      {
15          new TestCaseData(new LocalDateTime(1998, 4, 12, 13, 26, 38, 789), "1998-04-12 13:26:38.789")
16              .SetName("Timestamp_pre2000"),
17          new TestCaseData(new LocalDateTime(2015, 1, 27, 8, 45, 12, 345), "2015-01-27 08:45:12.345")
18              .SetName("Timestamp_post2000"),
19          new TestCaseData(new LocalDateTime(1999, 12, 31, 23, 59, 59, 999).PlusNanoseconds(456000), "1999-12-31 23:59:59.999456")
20              .SetName("Timestamp_with_microseconds")
21      };
22      [Test, TestCaseSource(nameof(TimestampValues))]
23      public Task Timestamp_as_LocalDateTime(LocalDateTime localDateTime, string sqlLiteral)
24          => AssertType(localDateTime, sqlLiteral, "timestamp without time zone", NpgsqlDbType.Timestamp, DbType.DateTime2);
25      [Test]
26      public Task Timestamp_as_unspecified_DateTime()
27          => AssertType(
28              new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Unspecified),
29              "1998-04-12 13:26:38",
30              "timestamp without time zone",
31              NpgsqlDbType.Timestamp,
32              DbType.DateTime2,
33              isDefaultForReading: false);
34      [Test]
35      public Task Timestamp_as_long()
36          => AssertType(
37              -54297202000000,
38              "1998-04-12 13:26:38",
39              "timestamp without time zone",
40              NpgsqlDbType.Timestamp,
41              DbType.DateTime2,
42              isDefault: false);
43      [Test]
44      public Task Timestamp_cannot_use_as_Instant()
45          => AssertTypeUnsupported(
46              new LocalDateTime(1998, 4, 12, 13, 26, 38, 789).InUtc().ToInstant(),
47              "1998-04-12 13:26:38.789",
48              "timestamp without time zone");
49      [Test]
50      public Task Timestamp_cannot_use_as_ZonedDateTime()
51          => AssertTypeUnsupported(
52              new LocalDateTime(1998, 4, 12, 13, 26, 38, 789).InUtc(),
53              "1998-04-12 13:26:38.789",
54              "timestamp without time zone");
55      [Test]
56      public Task Timestamp_cannot_use_as_OffsetDateTime()
57          => AssertTypeUnsupported(
58              new LocalDateTime(1998, 4, 12, 13, 26, 38, 789).WithOffset(Offset.FromHours(2)),
59              "1998-04-12 13:26:38.789",
60              "timestamp without time zone");
61      [Test]
62      public Task Timestamp_cannot_use_as_DateTimeOffset()
63          => AssertTypeUnsupported(
64              new DateTimeOffset(1998, 4, 12, 13, 26, 38, TimeSpan.Zero),
65              "1998-04-12 13:26:38",
66              "timestamp without time zone");
67      [Test]
68      public Task Timestamp_cannot_write_utc_DateTime()
69          => AssertTypeUnsupportedWrite(new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Utc), "timestamp without time zone");
70      [Test]
71      public Task Tsrange_as_NpgsqlRange_of_LocalDateTime()
72          => AssertType(
73              new NpgsqlRange<LocalDateTime>(
74                  new(1998, 4, 12, 13, 26, 38),
75                  new(1998, 4, 12, 15, 26, 38)),
76              @"[""1998-04-12 13:26:38"",""1998-04-12 15:26:38""]",
77              "tsrange",
78              NpgsqlDbType.TimestampRange);
79      [Test]
80      public async Task Tsmultirange_as_array_of_NpgsqlRange_of_LocalDateTime()
81      {
82          await using var conn = await OpenConnectionAsync();
83          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
84          await AssertType(
85              new[]
86              {
87                  new NpgsqlRange<LocalDateTime>(
88                      new(1998, 4, 12, 13, 26, 38),
89                      new(1998, 4, 12, 15, 26, 38)),
90                  new NpgsqlRange<LocalDateTime>(
91                      new(1998, 4, 13, 13, 26, 38),
92                      new(1998, 4, 13, 15, 26, 38)),
93              },
94              @"{[""1998-04-12 13:26:38"",""1998-04-12 15:26:38""],[""1998-04-13 13:26:38"",""1998-04-13 15:26:38""]}",
95              "tsmultirange",
96              NpgsqlDbType.TimestampMultirange);
97      }
98      #endregion Timestamp without time zone
99      #region Timestamp with time zone
100      static readonly TestCaseData[] TimestamptzValues =
101      {
102          new TestCaseData(new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(), "1998-04-12 15:26:38+02")
103              .SetName("Timestamptz_pre2000"),
104          new TestCaseData(new LocalDateTime(2015, 1, 27, 8, 45, 12, 345).InUtc().ToInstant(), "2015-01-27 09:45:12.345+01")
105              .SetName("Timestamptz_post2000"),
106          new TestCaseData(new LocalDateTime(2013, 7, 25, 0, 0, 0).InUtc().ToInstant(), "2013-07-25 02:00:00+02")
107              .SetName("Timestamptz_write_date_only"),
108          new TestCaseData(new LocalDateTime(1999, 12, 31, 23, 59, 59, 999).PlusNanoseconds(456000).InUtc().ToInstant(), "2000-01-01 00:59:59.999456+01")
109              .SetName("Timestamptz_with_microseconds")
110      };
111      [Test, TestCaseSource(nameof(TimestamptzValues))]
112      public Task Timestamptz_as_Instant(Instant instant, string sqlLiteral)
113          => AssertType(instant, sqlLiteral, "timestamp with time zone", NpgsqlDbType.TimestampTz, DbType.DateTime);
114      [Test]
115      public Task Timestamptz_as_ZonedDateTime()
116          => AssertType(
117              new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc(),
118              "1998-04-12 15:26:38+02",
119              "timestamp with time zone",
120              NpgsqlDbType.TimestampTz,
121              DbType.DateTime,
122              isDefaultForReading: false);
123      [Test]
124      public Task Timestamptz_as_OffsetDateTime()
125          => AssertType(
126              new LocalDateTime(1998, 4, 12, 13, 26, 38).WithOffset(Offset.Zero),
127              "1998-04-12 15:26:38+02",
128              "timestamp with time zone",
129              NpgsqlDbType.TimestampTz,
130              DbType.DateTime,
131              isDefaultForReading: false);
132      [Test]
133      public Task Timestamptz_as_utc_DateTime()
134          => AssertType(
135              new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Utc),
136              "1998-04-12 15:26:38+02",
137              "timestamp with time zone",
138              NpgsqlDbType.TimestampTz,
139              DbType.DateTime,
140              isDefaultForReading: false);
141      [Test]
142      public Task Timestamptz_as_DateTimeOffset()
143          => AssertType(
144              new DateTimeOffset(1998, 4, 12, 13, 26, 38, TimeSpan.Zero),
145              "1998-04-12 15:26:38+02",
146              "timestamp with time zone",
147              NpgsqlDbType.TimestampTz,
148              DbType.DateTime,
149              isDefaultForReading: false);
150      [Test]
151      public Task Timestamptz_as_long()
152          => AssertType(
153              -54297202000000,
154              "1998-04-12 15:26:38+02",
155              "timestamp with time zone",
156              NpgsqlDbType.TimestampTz,
157              DbType.DateTime,
158              isDefault: false);
159      [Test]
160      public Task Timestamptz_cannot_use_as_LocalDateTime()
161          => AssertTypeUnsupported(new LocalDateTime(1998, 4, 12, 13, 26, 38), "1998-04-12 13:26:38Z", "timestamp with time zone");
162      [Test]
163      public async Task Timestamptz_cannot_write_non_utc_ZonedDateTime()
164          => await AssertTypeUnsupportedWrite(
165              new LocalDateTime().InUtc().ToInstant().InZone(DateTimeZoneProviders.Tzdb["Europe/Berlin"]),
166              "timestamp with time zone");
167      [Test]
168      public async Task Timestamptz_cannot_write_non_utc_OffsetDateTime()
169          => await AssertTypeUnsupportedWrite(new LocalDateTime().WithOffset(Offset.FromHours(2)), "timestamp with time zone");
170      [Test]
171      public async Task Timestamptz_cannot_write_non_utc_DateTime()
172      {
173          await AssertTypeUnsupportedWrite(new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Unspecified), "timestamp with time zone");
174          await AssertTypeUnsupportedWrite(new DateTime(1998, 4, 12, 13, 26, 38, DateTimeKind.Local), "timestamp with time zone");
175      }
176      [Test]
177      public Task Tstzrange_as_Interval()
178          => AssertType(
179              new Interval(
180                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
181                  new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
182              @"[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02"")",
183              "tstzrange",
184              NpgsqlDbType.TimestampTzRange);
185      [Test]
186      public Task Tstzrange_with_no_end_as_Interval()
187          => AssertType(
188              new Interval(
189                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(), null),
190              @"[""1998-04-12 15:26:38+02"",)",
191              "tstzrange",
192              NpgsqlDbType.TimestampTzRange);
193      [Test]
194      public Task Tstzrange_with_no_start_as_Interval()
195          => AssertType(
196              new Interval( null,
197                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant()),
198              @"(,""1998-04-12 15:26:38+02"")",
199              "tstzrange",
200              NpgsqlDbType.TimestampTzRange);
201      [Test]
202      public Task Tstzrange_with_no_start_or_end_as_Interval()
203          => AssertType(
204              new Interval(null, null),
205              @"(,)",
206              "tstzrange",
207              NpgsqlDbType.TimestampTzRange);
208      [Test]
209      public Task Tstzrange_as_NpgsqlRange_of_Instant()
210          => AssertType(
211              new NpgsqlRange<Instant>(
212                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
213                  new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
214              @"[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""]",
215              "tstzrange",
216              NpgsqlDbType.TimestampTzRange,
217              isDefaultForReading: false);
218      [Test]
219      public Task Tstzrange_as_NpgsqlRange_of_ZonedDateTime()
220          => AssertType(
221              new NpgsqlRange<ZonedDateTime>(
222                  new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc(),
223                  new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc()),
224              @"[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""]",
225              "tstzrange",
226              NpgsqlDbType.TimestampTzRange,
227              isDefaultForReading: false);
228      [Test]
229      public Task Tstzrange_as_NpgsqlRange_of_OffsetDateTime()
230          => AssertType(
231              new NpgsqlRange<OffsetDateTime>(
232                  new LocalDateTime(1998, 4, 12, 13, 26, 38).WithOffset(Offset.Zero),
233                  new LocalDateTime(1998, 4, 12, 15, 26, 38).WithOffset(Offset.Zero)),
234              @"[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""]",
235              "tstzrange",
236              NpgsqlDbType.TimestampTzRange,
237              isDefaultForReading: false);
238      [Test]
239      public async Task Tstzmultirange_as_array_of_Interval()
240      {
241          await using var conn = await OpenConnectionAsync();
242          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
243          await AssertType(
244              new[]
245              {
246                  new Interval(
247                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
248                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
249                  new Interval(
250                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
251                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc().ToInstant()),
252              },
253              @"{[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""),[""1998-04-13 15:26:38+02"",""1998-04-13 17:26:38+02"")}",
254              "tstzmultirange",
255              NpgsqlDbType.TimestampTzMultirange);
256      }
257      [Test]
258      public async Task Tstzmultirange_as_array_of_NpgsqlRange_of_Instant()
259      {
260          await using var conn = await OpenConnectionAsync();
261          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
262          await AssertType(
263              new[]
264              {
265                  new NpgsqlRange<Instant>(
266                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
267                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
268                  new NpgsqlRange<Instant>(
269                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
270                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc().ToInstant()),
271              },
272              @"{[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""],[""1998-04-13 15:26:38+02"",""1998-04-13 17:26:38+02""]}",
273              "tstzmultirange",
274              NpgsqlDbType.TimestampTzMultirange,
275              isDefaultForReading: false);
276      }
277      [Test]
278      public async Task Tstzmultirange_as_array_of_NpgsqlRange_of_ZonedDateTime()
279      {
280          await using var conn = await OpenConnectionAsync();
281          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
282          await AssertType(
283              new[]
284              {
285                  new NpgsqlRange<ZonedDateTime>(
286                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc(),
287                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc()),
288                  new NpgsqlRange<ZonedDateTime>(
289                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc(),
290                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc()),
291              },
292              @"{[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""],[""1998-04-13 15:26:38+02"",""1998-04-13 17:26:38+02""]}",
293              "tstzmultirange",
294              NpgsqlDbType.TimestampTzMultirange,
295              isDefaultForReading: false);
296      }
297      [Test]
298      public async Task Tstzmultirange_as_array_of_NpgsqlRange_of_OffsetDateTime()
299      {
300          await using var conn = await OpenConnectionAsync();
301          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
302          await AssertType(
303              new[]
304              {
305                  new NpgsqlRange<OffsetDateTime>(
306                      new LocalDateTime(1998, 4, 12, 13, 26, 38).WithOffset(Offset.Zero),
307                      new LocalDateTime(1998, 4, 12, 15, 26, 38).WithOffset(Offset.Zero)),
308                  new NpgsqlRange<OffsetDateTime>(
309                      new LocalDateTime(1998, 4, 13, 13, 26, 38).WithOffset(Offset.Zero),
310                      new LocalDateTime(1998, 4, 13, 15, 26, 38).WithOffset(Offset.Zero)),
311              },
312              @"{[""1998-04-12 15:26:38+02"",""1998-04-12 17:26:38+02""],[""1998-04-13 15:26:38+02"",""1998-04-13 17:26:38+02""]}",
313              "tstzmultirange",
314              NpgsqlDbType.TimestampTzMultirange,
315              isDefaultForReading: false);
316      }
317      [Test]
318      public async Task Tstzrange_array_as_array_of_Interval()
319      {
320          await using var conn = await OpenConnectionAsync();
321          await AssertType<Array>(
322              new[]
323              {
324                  new Interval(
325                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
326                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
327                  new Interval(
328                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
329                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc().ToInstant()),
330                  new Interval(
331                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
332                      null),
333                  new Interval(
334                      null,
335                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant()),
336                  new Interval(
337                      null,
338                      null)
339              },
340              @"{""[\""1998-04-12 15:26:38+02\"",\""1998-04-12 17:26:38+02\"")"",""[\""1998-04-13 15:26:38+02\"",\""1998-04-13 17:26:38+02\"")"",""[\""1998-04-13 15:26:38+02\"",)"",""(,\""1998-04-13 15:26:38+02\"")"",""(,)""}",
341              "tstzrange[]",
342              NpgsqlDbType.TimestampTzRange | NpgsqlDbType.Array,
343              isDefaultForWriting: false);
344      }
345      [Test]
346      public async Task Tstzrange_array_as_array_of_NpgsqlRange_of_Instant()
347      {
348          await using var conn = await OpenConnectionAsync();
349          await AssertType(
350              new[]
351              {
352                  new NpgsqlRange<Instant>(
353                      new LocalDateTime(1998, 4, 12, 13, 26, 38).InUtc().ToInstant(),
354                      new LocalDateTime(1998, 4, 12, 15, 26, 38).InUtc().ToInstant()),
355                  new NpgsqlRange<Instant>(
356                      new LocalDateTime(1998, 4, 13, 13, 26, 38).InUtc().ToInstant(),
357                      new LocalDateTime(1998, 4, 13, 15, 26, 38).InUtc().ToInstant()),
358              },
359              @"{""[\""1998-04-12 15:26:38+02\"",\""1998-04-12 17:26:38+02\""]"",""[\""1998-04-13 15:26:38+02\"",\""1998-04-13 17:26:38+02\""]""}",
360              "tstzrange[]",
361              NpgsqlDbType.TimestampTzRange | NpgsqlDbType.Array,
362              isDefault: false);
363      }
364      #endregion Timestamp with time zone
365      #region Date
366      [Test]
367      public Task Date_as_LocalDate()
368          => AssertType(new LocalDate(2020, 10, 1), "2020-10-01", "date", NpgsqlDbType.Date, DbType.Date);
369      [Test]
370      public Task Date_as_DateTime()
371          => AssertType(new DateTime(2020, 10, 1), "2020-10-01", "date", NpgsqlDbType.Date, DbType.Date, isDefault: false);
372      [Test]
373      public Task Date_as_int()
374          => AssertType(7579, "2020-10-01", "date", NpgsqlDbType.Date, DbType.Date, isDefault: false);
375      [Test]
376      public Task Daterange_as_DateInterval()
377          => AssertType(
378              new DateInterval(new(2002, 3, 4), new(2002, 3, 6)),
379              "[2002-03-04,2002-03-07)",
380              "daterange",
381              NpgsqlDbType.DateRange);
382      [Test]
383      public Task Daterange_as_NpgsqlRange_of_LocalDate()
384          => AssertType(
385              new NpgsqlRange<LocalDate>(new(2002, 3, 4), true, new(2002, 3, 6), false),
386              "[2002-03-04,2002-03-06)",
387              "daterange",
388              NpgsqlDbType.DateRange,
389              isDefaultForReading: false);
390      [Test]
391      public async Task Datemultirange_as_array_of_DateInterval()
392      {
393          await using var conn = await OpenConnectionAsync();
394          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
395          await AssertType(
396              new[]
397              {
398                  new DateInterval(new(2002, 3, 4), new(2002, 3, 5)),
399                  new DateInterval(new(2002, 3, 8), new(2002, 3, 10))
400              },
401              "{[2002-03-04,2002-03-06),[2002-03-08,2002-03-11)}",
402              "datemultirange",
403              NpgsqlDbType.DateMultirange);
404      }
405      [Test]
406      public async Task Datemultirange_as_array_of_NpgsqlRange_of_LocalDate()
407      {
408          await using var conn = await OpenConnectionAsync();
409          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
410          await AssertType(
411              new[]
412              {
413                  new NpgsqlRange<LocalDate>(new(2002, 3, 4), true, new(2002, 3, 6), false),
414                  new NpgsqlRange<LocalDate>(new(2002, 3, 8), true, new(2002, 3, 11), false)
415              },
416              "{[2002-03-04,2002-03-06),[2002-03-08,2002-03-11)}",
417              "datemultirange",
418              NpgsqlDbType.DateMultirange,
419              isDefaultForReading: false);
420      }
421  #if NET6_0_OR_GREATER
422      [Test]
423      public Task Date_as_DateOnly()
424          => AssertType(new DateOnly(2020, 10, 1), "2020-10-01", "date", NpgsqlDbType.Date, DbType.Date, isDefaultForReading: false);
425      [Test]
426      public Task Daterange_as_NpgsqlRange_of_DateOnly()
427          => AssertType(
428              new NpgsqlRange<DateOnly>(new(2002, 3, 4), true, new(2002, 3, 6), false),
<span onclick='openModal()' class='match'>429              "[2002-03-04,2002-03-06)",
430              "daterange",
431              NpgsqlDbType.DateRange,
432              isDefaultForReading: false);
433  #endif
434      [Test]
435      public async Task Daterange_array_as_array_of_DateInterval()
436      {
437          await using var conn = await OpenConnectionAsync();
438          await AssertType<Array>(
439              new[]
440              {
441                  new DateInterval(new(2002, 3, 4), new(2002, 3, 5)),
442                  new DateInterval(new(2002, 3, 8), new(2002, 3, 10))
443              },
444              @"{""[2002-03-04,2002-03-06)"",""[2002-03-08,2002-03-11)""}",
</span>445              "daterange[]",
446              NpgsqlDbType.DateRange | NpgsqlDbType.Array,
447              isDefaultForWriting: false);
448      }
449      [Test]
450      public async Task Daterange_array_as_array_of_NpgsqlRange_of_LocalDate()
451      {
452          await using var conn = await OpenConnectionAsync();
453          await AssertType(
454              new[]
455              {
456                  new NpgsqlRange<LocalDate>(new(2002, 3, 4), true, new(2002, 3, 6), false),
457                  new NpgsqlRange<LocalDate>(new(2002, 3, 8), true, new(2002, 3, 11), false)
458              },
459              @"{""[2002-03-04,2002-03-06)"",""[2002-03-08,2002-03-11)""}",
460              "daterange[]",
461              NpgsqlDbType.DateRange | NpgsqlDbType.Array,
462              isDefault: false);
463      }
464      #endregion Date
465      #region Time
466      [Test]
467      public Task Time_as_LocalTime()
468          => AssertType(new LocalTime(10, 45, 34, 500), "10:45:34.5", "time without time zone", NpgsqlDbType.Time, DbType.Time);
469      [Test]
470      public Task Time_as_TimeSpan()
471          => AssertType(
472              new TimeSpan(0, 10, 45, 34, 500),
473              "10:45:34.5",
474              "time without time zone",
475              NpgsqlDbType.Time,
476              DbType.Time,
477              isDefault: false);
478  #if NET6_0_OR_GREATER
479      [Test]
480      public Task Time_as_TimeOnly()
481          => AssertType(
482              new TimeOnly(10, 45, 34, 500),
483              "10:45:34.5",
484              "time without time zone",
485              NpgsqlDbType.Time,
486              DbType.Time,
487              isDefaultForReading: false);
488  #endif
489      #endregion Time
490      #region Time with time zone
491      [Test]
492      public Task TimeTz_as_OffsetTime()
493          => AssertType(
494              new OffsetTime(new LocalTime(1, 2, 3, 4).PlusNanoseconds(5000), Offset.FromHoursAndMinutes(3, 30) + Offset.FromSeconds(5)),
495              "01:02:03.004005+03:30:05",
496              "time with time zone",
497              NpgsqlDbType.TimeTz);
498      [Test]
499      public async Task TimeTz_as_DateTimeOffset()
500      {
501          await AssertTypeRead(
502              "13:03:45.51+02",
503              "time with time zone",
504              new DateTimeOffset(1, 1, 2, 13, 3, 45, 510, TimeSpan.FromHours(2)), isDefault: false);
505          await AssertTypeWrite(
506              new DateTimeOffset(1, 1, 1, 13, 3, 45, 510, TimeSpan.FromHours(2)),
507              "13:03:45.51+02",
508              "time with time zone",
509              NpgsqlDbType.TimeTz,
510              isDefault: false);
511      }
512      #endregion Time with time zone
513      #region Interval
514      [Test]
515      public Task Interval_as_Period()
516          => AssertType(
517              new PeriodBuilder
518              {
519                  Years = 1,
520                  Months = 2,
521                  Weeks = 3,
522                  Days = 4,
523                  Hours = 5,
524                  Minutes = 6,
525                  Seconds = 7,
526                  Milliseconds = 8,
527                  Nanoseconds = 9000
528              }.Build().Normalize(),
529              "1 year 2 mons 25 days 05:06:07.008009",
530              "interval",
531              NpgsqlDbType.Interval);
532      [Test]
533      public Task Interval_as_Duration()
534          => AssertType(
535              Duration.FromDays(5) + Duration.FromMinutes(4) + Duration.FromSeconds(3) + Duration.FromMilliseconds(2) +
536              Duration.FromNanoseconds(1000),
537              "5 days 00:04:03.002001",
538              "interval",
539              NpgsqlDbType.Interval,
540              isDefaultForReading: false);
541      [Test]
542      public Task Interval_as_Duration_with_months_fails()
543          => AssertTypeUnsupportedRead<Duration, NpgsqlException>("2 months", "interval");
544      [Test, IssueLink("https:&bsol;&bsol;github.com/npgsql/npgsql/issues/3438")]
545      public async Task Bug3438()
546      {
547          await using var conn = await OpenConnectionAsync();
548          using var cmd = new NpgsqlCommand("SELECT @p1, @p2", conn);
549          var expected = Duration.FromSeconds(2148);
550          cmd.Parameters.Add(new NpgsqlParameter("p1", NpgsqlDbType.Interval) { Value = expected });
551          cmd.Parameters.AddWithValue("p2", expected);
552          using var reader = cmd.ExecuteReader();
553          reader.Read();
554          for (var i = 0; i < 2; i++)
555          {
556              Assert.That(reader.GetFieldType(i), Is.EqualTo(typeof(Period)));
557          }
558      }
559      #endregion Interval
560      #region Support
561      protected override async ValueTask<NpgsqlConnection> OpenConnectionAsync()
562      {
563          var conn = await base.OpenConnectionAsync();
564          await conn.ExecuteNonQueryAsync("SET TimeZone='Europe/Berlin'");
565          return conn;
566      }
567      protected override NpgsqlConnection OpenConnection()
568          => throw new NotSupportedException();
569      #endregion Support
570  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NodaTimeTests.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from npgsql-MDEwOlJlcG9zaXRvcnkyODgzNTc0-flat-NodaTimeTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>386              "[2002-03-04,2002-03-06)",
387              "daterange",
388              NpgsqlDbType.DateRange,
389              isDefaultForReading: false);
390      [Test]
391      public async Task Datemultirange_as_array_of_DateInterval()
392      {
393          await using var conn = await OpenConnectionAsync();
394          MinimumPgVersion(conn, "14.0", "Multirange types were introduced in PostgreSQL 14");
</pre></code></div>
                <div class="column column_space"><pre><code>429              "[2002-03-04,2002-03-06)",
430              "daterange",
431              NpgsqlDbType.DateRange,
432              isDefaultForReading: false);
433  #endif
434      [Test]
435      public async Task Daterange_array_as_array_of_DateInterval()
436      {
437          await using var conn = await OpenConnectionAsync();
438          await AssertType<Array>(
439              new[]
440              {
441                  new DateInterval(new(2002, 3, 4), new(2002, 3, 5)),
442                  new DateInterval(new(2002, 3, 8), new(2002, 3, 10))
443              },
444              @"{""[2002-03-04,2002-03-06)"",""[2002-03-08,2002-03-11)""}",
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    