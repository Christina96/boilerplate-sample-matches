
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 15, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-ConfigurationManagerL0.cs</h3>
            <pre><code>1  using GitHub.DistributedTask.WebApi;
2  using GitHub.Runner.Listener;
3  using GitHub.Runner.Listener.Configuration;
4  using GitHub.Runner.Common.Util;
5  using GitHub.Services.WebApi;
6  using Moq;
7  using System;
8  using System.Collections.Generic;
9  using System.Linq;
10  using System.Runtime.CompilerServices;
11  using System.Security.Cryptography;
12  using System.Threading.Tasks;
13  using Xunit;
14  using GitHub.Services.Location;
15  using GitHub.Services.Common;
16  namespace GitHub.Runner.Common.Tests.Listener.Configuration
17  {
18      public class ConfigurationManagerL0
19      {
20          private Mock&lt;IRunnerServer&gt; _runnerServer;
21          private Mock&lt;IRunnerDotcomServer&gt; _dotcomServer;
22          private Mock&lt;ILocationServer&gt; _locationServer;
23          private Mock&lt;ICredentialManager&gt; _credMgr;
24          private Mock&lt;IPromptManager&gt; _promptManager;
25          private Mock&lt;IConfigurationStore&gt; _store;
26          private Mock&lt;IExtensionManager&gt; _extnMgr;
27  #if OS_WINDOWS
28          private Mock&lt;IWindowsServiceControlManager&gt; _serviceControlManager;
29  #endif
30  #if !OS_WINDOWS
31          private Mock&lt;ILinuxServiceControlManager&gt; _serviceControlManager;
32  #endif
33          private Mock&lt;IRSAKeyManager&gt; _rsaKeyManager;
34          private string _expectedToken = &quot;expectedToken&quot;;
35          private string _expectedServerUrl = &quot;https:&amp;bsol;&amp;bsol;codedev.ms&quot;;
36          private string _expectedAgentName = &quot;expectedAgentName&quot;;
37          private string _defaultRunnerGroupName = &quot;defaultRunnerGroup&quot;;
38          private string _secondRunnerGroupName = &quot;secondRunnerGroup&quot;;
39          private string _expectedAuthType = &quot;pat&quot;;
40          private string _expectedWorkFolder = &quot;_work&quot;;
41          private int _defaultRunnerGroupId = 1;
42          private int _secondRunnerGroupId = 2;
43          private RSACryptoServiceProvider rsa = null;
44          private RunnerSettings _configMgrAgentSettings = new();
45          public ConfigurationManagerL0()
46          {
47              _runnerServer = new Mock&lt;IRunnerServer&gt;();
48              _locationServer = new Mock&lt;ILocationServer&gt;();
49              _credMgr = new Mock&lt;ICredentialManager&gt;();
50              _promptManager = new Mock&lt;IPromptManager&gt;();
51              _store = new Mock&lt;IConfigurationStore&gt;();
52              _extnMgr = new Mock&lt;IExtensionManager&gt;();
53              _rsaKeyManager = new Mock&lt;IRSAKeyManager&gt;();
54              _dotcomServer = new Mock&lt;IRunnerDotcomServer&gt;();
55  #if OS_WINDOWS
56              _serviceControlManager = new Mock&lt;IWindowsServiceControlManager&gt;();
57  #endif
58  #if !OS_WINDOWS
59              _serviceControlManager = new Mock&lt;ILinuxServiceControlManager&gt;();
60  #endif
61              var expectedAgent = new TaskAgent(_expectedAgentName) { Id = 1, Ephemeral = true, DisableUpdate = true };
62              expectedAgent.Authorization = new TaskAgentAuthorization
63              {
64                  ClientId = Guid.NewGuid(),
65                  AuthorizationUrl = new Uri(&quot;http:&amp;bsol;&amp;bsol;localhost:8080/pipelines&quot;),
66              };
67              var expectedRunner = new GitHub.DistributedTask.WebApi.Runner() { Name = expectedAgent.Name, Id = 1 };
68              expectedRunner.RunnerAuthorization = new GitHub.DistributedTask.WebApi.Runner.Authorization
69              {
70                  ClientId = expectedAgent.Authorization.ClientId.ToString(),
71                  AuthorizationUrl = new Uri(&quot;http:&amp;bsol;&amp;bsol;localhost:8080/pipelines&quot;),
72              };
73              var connectionData = new ConnectionData()
74              {
75                  InstanceId = Guid.NewGuid(),
76                  DeploymentType = DeploymentFlags.Hosted,
77                  DeploymentId = Guid.NewGuid()
78              };
79              _runnerServer.Setup(x =&gt; x.ConnectAsync(It.IsAny&lt;Uri&gt;(), It.IsAny&lt;VssCredentials&gt;())).Returns(Task.FromResult&lt;object&gt;(null));
80              _locationServer.Setup(x =&gt; x.ConnectAsync(It.IsAny&lt;VssConnection&gt;())).Returns(Task.FromResult&lt;object&gt;(null));
81              _locationServer.Setup(x =&gt; x.GetConnectionDataAsync()).Returns(Task.FromResult&lt;ConnectionData&gt;(connectionData));
82              _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
83              _store.Setup(x =&gt; x.HasCredentials()).Returns(false);
84              _store.Setup(x =&gt; x.GetSettings()).Returns(() =&gt; _configMgrAgentSettings);
85              _store.Setup(x =&gt; x.SaveSettings(It.IsAny&lt;RunnerSettings&gt;()))
86                  .Callback((RunnerSettings settings) =&gt;
87                  {
88                      _configMgrAgentSettings = settings;
89                  });
90              _credMgr.Setup(x =&gt; x.GetCredentialProvider(It.IsAny&lt;string&gt;())).Returns(new TestRunnerCredential());
91  #if !OS_WINDOWS
92              _serviceControlManager.Setup(x =&gt; x.GenerateScripts(It.IsAny&lt;RunnerSettings&gt;()));
93  #endif
94              var expectedPools = new List&lt;TaskAgentPool&gt;() { new TaskAgentPool(_defaultRunnerGroupName) { Id = _defaultRunnerGroupId, IsInternal = true }, new TaskAgentPool(_secondRunnerGroupName) { Id = _secondRunnerGroupId } };
95              _runnerServer.Setup(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;TaskAgentPoolType&gt;())).Returns(Task.FromResult(expectedPools));
96              var expectedAgents = new List&lt;TaskAgent&gt;();
97              _runnerServer.Setup(x =&gt; x.GetAgentsAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;string&gt;())).Returns(Task.FromResult(expectedAgents));
98              _runnerServer.Setup(x =&gt; x.AddAgentAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;TaskAgent&gt;())).Returns(Task.FromResult(expectedAgent));
99              _runnerServer.Setup(x =&gt; x.ReplaceAgentAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;TaskAgent&gt;())).Returns(Task.FromResult(expectedAgent));
100              _dotcomServer.Setup(x =&gt; x.GetRunnersAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Returns(Task.FromResult(expectedAgents));
101              _dotcomServer.Setup(x =&gt; x.GetRunnerGroupsAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Returns(Task.FromResult(expectedPools));
102              _dotcomServer.Setup(x =&gt; x.AddRunnerAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;TaskAgent&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Returns(Task.FromResult(expectedRunner));
103              rsa = new RSACryptoServiceProvider(2048);
104              _rsaKeyManager.Setup(x =&gt; x.CreateKey()).Returns(rsa);
105          }
106          private TestHostContext CreateTestContext([CallerMemberName] String testName = &quot;&quot;)
107          {
108              TestHostContext tc = new(this, testName);
109              tc.SetSingleton&lt;ICredentialManager&gt;(_credMgr.Object);
110              tc.SetSingleton&lt;IPromptManager&gt;(_promptManager.Object);
111              tc.SetSingleton&lt;IConfigurationStore&gt;(_store.Object);
112              tc.SetSingleton&lt;IExtensionManager&gt;(_extnMgr.Object);
113              tc.SetSingleton&lt;IRunnerServer&gt;(_runnerServer.Object);
114              tc.SetSingleton&lt;IRunnerDotcomServer&gt;(_dotcomServer.Object);
115              tc.SetSingleton&lt;ILocationServer&gt;(_locationServer.Object);
116  #if OS_WINDOWS
117              tc.SetSingleton&lt;IWindowsServiceControlManager&gt;(_serviceControlManager.Object);
118  #else
119              tc.SetSingleton&lt;ILinuxServiceControlManager&gt;(_serviceControlManager.Object);
120  #endif
121              tc.SetSingleton&lt;IRSAKeyManager&gt;(_rsaKeyManager.Object);
122              return tc;
123          }
124          [Fact]
125          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
126          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
127          public async Task CanEnsureConfigure()
128          {
129              using (TestHostContext tc = CreateTestContext())
130              {
131                  Tracing trace = tc.GetTrace();
<span onclick='openModal()' class='match'>132                  trace.Info(&quot;Creating config manager&quot;);
133                  IConfigurationManager configManager = new ConfigurationManager();
134                  configManager.Initialize(tc);
</span>135                  var userLabels = &quot;userlabel1,userlabel2&quot;;
136                  trace.Info(&quot;Preparing command line arguments&quot;);
137                  var command = new CommandSettings(
138                      tc,
139                      new[]
140                      {
141                         &quot;configure&quot;,
142                         &quot;--url&quot;, _expectedServerUrl,
143                         &quot;--name&quot;, _expectedAgentName,
144                         &quot;--runnergroup&quot;, _secondRunnerGroupName,
145                         &quot;--work&quot;, _expectedWorkFolder,
146                         &quot;--auth&quot;, _expectedAuthType,
147                         &quot;--token&quot;, _expectedToken,
148                         &quot;--labels&quot;, userLabels,
149                         &quot;--ephemeral&quot;,
150                         &quot;--disableupdate&quot;,
151                         &quot;--unattended&quot;,
152                      });
153                  trace.Info(&quot;Constructed.&quot;);
154                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
155                  _configMgrAgentSettings = null;
156                  trace.Info(&quot;Ensuring all the required parameters are available in the command line parameter&quot;);
157                  await configManager.ConfigureAsync(command);
158                  _store.Setup(x =&gt; x.IsConfigured()).Returns(true);
159                  trace.Info(&quot;Configured, verifying all the parameter value&quot;);
160                  var s = configManager.LoadSettings();
161                  Assert.NotNull(s);
162                  Assert.True(s.ServerUrl.Equals(_expectedServerUrl));
163                  Assert.True(s.AgentName.Equals(_expectedAgentName));
164                  Assert.True(s.PoolId.Equals(_secondRunnerGroupId));
165                  Assert.True(s.WorkFolder.Equals(_expectedWorkFolder));
166                  Assert.True(s.Ephemeral.Equals(true));
167                  _runnerServer.Verify(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.Is&lt;TaskAgentPoolType&gt;(p =&gt; p == TaskAgentPoolType.Automation)), Times.Exactly(2));
168                  var expectedLabels = new List&lt;string&gt;() { &quot;self-hosted&quot;, VarUtil.OS, VarUtil.OSArchitecture };
169                  expectedLabels.AddRange(userLabels.Split(&quot;,&quot;).ToList());
170                  _runnerServer.Verify(x =&gt; x.AddAgentAsync(It.IsAny&lt;int&gt;(), It.Is&lt;TaskAgent&gt;(a =&gt; a.Labels.Select(x =&gt; x.Name).ToHashSet().SetEquals(expectedLabels))), Times.Once);
171              }
172          }
173          [Fact]
174          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
175          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
176          public async Task ConfigureErrorDefaultLabelsDisabledWithNoCustomLabels()
177          {
178              using (TestHostContext tc = CreateTestContext())
179              {
180                  Tracing trace = tc.GetTrace();
181                  trace.Info(&quot;Creating config manager&quot;);
182                  IConfigurationManager configManager = new ConfigurationManager();
183                  configManager.Initialize(tc);
184                  trace.Info(&quot;Preparing command line arguments&quot;);
185                  var command = new CommandSettings(
186                      tc,
187                      new[]
188                      {
189                         &quot;configure&quot;,
190                         &quot;--url&quot;, _expectedServerUrl,
191                         &quot;--name&quot;, _expectedAgentName,
192                         &quot;--runnergroup&quot;, _secondRunnerGroupName,
193                         &quot;--work&quot;, _expectedWorkFolder,
194                         &quot;--auth&quot;, _expectedAuthType,
195                         &quot;--token&quot;, _expectedToken,
196                         &quot;--no-default-labels&quot;,
197                         &quot;--ephemeral&quot;,
198                         &quot;--disableupdate&quot;,
199                         &quot;--unattended&quot;,
200                      });
201                  trace.Info(&quot;Constructed.&quot;);
202                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
203                  _configMgrAgentSettings = null;
204                  trace.Info(&quot;Ensuring configure fails if default labels are disabled and no custom labels are set&quot;);
205                  var ex = await Assert.ThrowsAsync&lt;NotSupportedException&gt;(() =&gt; configManager.ConfigureAsync(command));
206                  Assert.Contains(&quot;--no-default-labels without specifying --labels is not supported&quot;, ex.Message);
207              }
208          }
209          [Fact]
210          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
211          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
212          public async Task ConfigureDefaultLabelsDisabledWithCustomLabels()
213          {
214              using (TestHostContext tc = CreateTestContext())
215              {
216                  Tracing trace = tc.GetTrace();
217                  trace.Info(&quot;Creating config manager&quot;);
218                  IConfigurationManager configManager = new ConfigurationManager();
219                  configManager.Initialize(tc);
220                  var userLabels = &quot;userlabel1,userlabel2&quot;;
221                  trace.Info(&quot;Preparing command line arguments&quot;);
222                  var command = new CommandSettings(
223                      tc,
224                      new[]
225                      {
226                         &quot;configure&quot;,
227                         &quot;--url&quot;, _expectedServerUrl,
228                         &quot;--name&quot;, _expectedAgentName,
229                         &quot;--runnergroup&quot;, _secondRunnerGroupName,
230                         &quot;--work&quot;, _expectedWorkFolder,
231                         &quot;--auth&quot;, _expectedAuthType,
232                         &quot;--token&quot;, _expectedToken,
233                         &quot;--labels&quot;, userLabels,
234                         &quot;--no-default-labels&quot;,
235                         &quot;--ephemeral&quot;,
236                         &quot;--disableupdate&quot;,
237                         &quot;--unattended&quot;,
238                      });
239                  trace.Info(&quot;Constructed.&quot;);
240                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
241                  _configMgrAgentSettings = null;
242                  trace.Info(&quot;Ensuring all the required parameters are available in the command line parameter&quot;);
243                  await configManager.ConfigureAsync(command);
244                  _store.Setup(x =&gt; x.IsConfigured()).Returns(true);
245                  trace.Info(&quot;Configured, verifying all the parameter value&quot;);
246                  var s = configManager.LoadSettings();
247                  Assert.NotNull(s);
248                  Assert.True(s.ServerUrl.Equals(_expectedServerUrl));
249                  Assert.True(s.AgentName.Equals(_expectedAgentName));
250                  Assert.True(s.PoolId.Equals(_secondRunnerGroupId));
251                  Assert.True(s.WorkFolder.Equals(_expectedWorkFolder));
252                  Assert.True(s.Ephemeral.Equals(true));
253                  _runnerServer.Verify(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.Is&lt;TaskAgentPoolType&gt;(p =&gt; p == TaskAgentPoolType.Automation)), Times.Exactly(2));
254                  var expectedLabels = userLabels.Split(&quot;,&quot;).ToList();
255                  _runnerServer.Verify(x =&gt; x.AddAgentAsync(It.IsAny&lt;int&gt;(), It.Is&lt;TaskAgent&gt;(a =&gt; a.Labels.Select(x =&gt; x.Name).ToHashSet().SetEquals(expectedLabels))), Times.Once);
256              }
257          }
258          [Fact]
259          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
260          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
261          public async Task ConfigureErrorOnMissingRunnerGroup()
262          {
263              using (TestHostContext tc = CreateTestContext())
264              {
265                  var expectedPools = new List&lt;TaskAgentPool&gt;() { new TaskAgentPool(_defaultRunnerGroupName) { Id = _defaultRunnerGroupId, IsInternal = true } };
266                  _runnerServer.Setup(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;TaskAgentPoolType&gt;())).Returns(Task.FromResult(expectedPools));
267                  Tracing trace = tc.GetTrace();
268                  trace.Info(&quot;Creating config manager&quot;);
269                  IConfigurationManager configManager = new ConfigurationManager();
270                  configManager.Initialize(tc);
271                  trace.Info(&quot;Preparing command line arguments&quot;);
272                  var command = new CommandSettings(
273                      tc,
274                      new[]
275                      {
276                         &quot;configure&quot;,
277                         &quot;--url&quot;, _expectedServerUrl,
278                         &quot;--name&quot;, _expectedAgentName,
279                         &quot;--runnergroup&quot;, &quot;notexists&quot;,
280                         &quot;--work&quot;, _expectedWorkFolder,
281                         &quot;--auth&quot;, _expectedAuthType,
282                         &quot;--token&quot;, _expectedToken,
283                      });
284                  trace.Info(&quot;Constructed.&quot;);
285                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
286                  _configMgrAgentSettings = null;
287                  trace.Info(&quot;Ensuring all the required parameters are available in the command line parameter&quot;);
288                  var ex = await Assert.ThrowsAsync&lt;TaskAgentPoolNotFoundException&gt;(() =&gt; configManager.ConfigureAsync(command));
289                  Assert.Contains(&quot;notexists&quot;, ex.Message);
290                  _runnerServer.Verify(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.Is&lt;TaskAgentPoolType&gt;(p =&gt; p == TaskAgentPoolType.Automation)), Times.Exactly(1));
291              }
292          }
293  #if OS_LINUX
294          [Fact]
295          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
296          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
297          public async Task ConfigureRunnerServiceFailsOnUnconfiguredRunners()
298          {
299              using (TestHostContext tc = CreateTestContext())
300              {
301                  Tracing trace = tc.GetTrace();
302                  trace.Info(&quot;Creating config manager&quot;);
303                  IConfigurationManager configManager = new ConfigurationManager();
304                  configManager.Initialize(tc);
305                  trace.Info(&quot;Preparing command line arguments&quot;);
306                  var command = new CommandSettings(
307                      tc,
308                      new[]
309                      {
310                         &quot;configure&quot;,
311                         &quot;--generateServiceConfig&quot;,
312                      });
313                  trace.Info(&quot;Constructed&quot;);
314                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
315                  trace.Info(&quot;Ensuring service generation mode fails when on un-configured runners&quot;);
316                  var ex = await Assert.ThrowsAsync&lt;InvalidOperationException&gt;(() =&gt; configManager.ConfigureAsync(command));
317                  Assert.Contains(&quot;requires that the runner is already configured&quot;, ex.Message);
318              }
319          }
320          [Fact]
321          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
322          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
323          public async Task ConfigureRunnerServiceCreatesService()
324          {
325              using (TestHostContext tc = CreateTestContext())
326              {
327                  Tracing trace = tc.GetTrace();
328                  trace.Info(&quot;Creating config manager&quot;);
329                  IConfigurationManager configManager = new ConfigurationManager();
330                  configManager.Initialize(tc);
331                  trace.Info(&quot;Preparing command line arguments&quot;);
332                  var command = new CommandSettings(
333                      tc,
334                      new[]
335                      {
336                         &quot;configure&quot;,
337                         &quot;--generateServiceConfig&quot;,
338                      });
339                  trace.Info(&quot;Constructed&quot;);
340                  _store.Setup(x =&gt; x.IsConfigured()).Returns(true);
341                  trace.Info(&quot;Ensuring service generation mode fails when on un-configured runners&quot;);
342                  await configManager.ConfigureAsync(command);
343                  _serviceControlManager.Verify(x =&gt; x.GenerateScripts(It.IsAny&lt;RunnerSettings&gt;()), Times.Once);
344              }
345          }
346  #endif
347  #if !OS_LINUX
348          [Fact]
349          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
350          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
351          public async Task ConfigureRunnerServiceFailsOnUnsupportedPlatforms()
352          {
353              using (TestHostContext tc = CreateTestContext())
354              {
355                  Tracing trace = tc.GetTrace();
356                  trace.Info(&quot;Creating config manager&quot;);
357                  IConfigurationManager configManager = new ConfigurationManager();
358                  configManager.Initialize(tc);
359                  trace.Info(&quot;Preparing command line arguments&quot;);
360                  var command = new CommandSettings(
361                      tc,
362                      new[]
363                      {
364                         &quot;configure&quot;,
365                         &quot;--generateServiceConfig&quot;,
366                      });
367                  trace.Info(&quot;Constructed&quot;);
368                  _store.Setup(x =&gt; x.IsConfigured()).Returns(true);
369                  trace.Info(&quot;Ensuring service generation mode fails on unsupported runner platforms&quot;);
370                  var ex = await Assert.ThrowsAsync&lt;NotSupportedException&gt;(() =&gt; configManager.ConfigureAsync(command));
371                  Assert.Contains(&quot;only supported on Linux&quot;, ex.Message);
372              }
373          }
374  #endif
375      }
376  }
</code></pre>
        </div>
        <div class="column">
            <h3>runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-ConfigurationManagerL0.cs</h3>
            <pre><code>1  using GitHub.DistributedTask.WebApi;
2  using GitHub.Runner.Listener;
3  using GitHub.Runner.Listener.Configuration;
4  using GitHub.Runner.Common.Util;
5  using GitHub.Services.WebApi;
6  using Moq;
7  using System;
8  using System.Collections.Generic;
9  using System.Linq;
10  using System.Runtime.CompilerServices;
11  using System.Security.Cryptography;
12  using System.Threading.Tasks;
13  using Xunit;
14  using GitHub.Services.Location;
15  using GitHub.Services.Common;
16  namespace GitHub.Runner.Common.Tests.Listener.Configuration
17  {
18      public class ConfigurationManagerL0
19      {
20          private Mock&lt;IRunnerServer&gt; _runnerServer;
21          private Mock&lt;IRunnerDotcomServer&gt; _dotcomServer;
22          private Mock&lt;ILocationServer&gt; _locationServer;
23          private Mock&lt;ICredentialManager&gt; _credMgr;
24          private Mock&lt;IPromptManager&gt; _promptManager;
25          private Mock&lt;IConfigurationStore&gt; _store;
26          private Mock&lt;IExtensionManager&gt; _extnMgr;
27  #if OS_WINDOWS
28          private Mock&lt;IWindowsServiceControlManager&gt; _serviceControlManager;
29  #endif
30  #if !OS_WINDOWS
31          private Mock&lt;ILinuxServiceControlManager&gt; _serviceControlManager;
32  #endif
33          private Mock&lt;IRSAKeyManager&gt; _rsaKeyManager;
34          private string _expectedToken = &quot;expectedToken&quot;;
35          private string _expectedServerUrl = &quot;https:&amp;bsol;&amp;bsol;codedev.ms&quot;;
36          private string _expectedAgentName = &quot;expectedAgentName&quot;;
37          private string _defaultRunnerGroupName = &quot;defaultRunnerGroup&quot;;
38          private string _secondRunnerGroupName = &quot;secondRunnerGroup&quot;;
39          private string _expectedAuthType = &quot;pat&quot;;
40          private string _expectedWorkFolder = &quot;_work&quot;;
41          private int _defaultRunnerGroupId = 1;
42          private int _secondRunnerGroupId = 2;
43          private RSACryptoServiceProvider rsa = null;
44          private RunnerSettings _configMgrAgentSettings = new();
45          public ConfigurationManagerL0()
46          {
47              _runnerServer = new Mock&lt;IRunnerServer&gt;();
48              _locationServer = new Mock&lt;ILocationServer&gt;();
49              _credMgr = new Mock&lt;ICredentialManager&gt;();
50              _promptManager = new Mock&lt;IPromptManager&gt;();
51              _store = new Mock&lt;IConfigurationStore&gt;();
52              _extnMgr = new Mock&lt;IExtensionManager&gt;();
53              _rsaKeyManager = new Mock&lt;IRSAKeyManager&gt;();
54              _dotcomServer = new Mock&lt;IRunnerDotcomServer&gt;();
55  #if OS_WINDOWS
56              _serviceControlManager = new Mock&lt;IWindowsServiceControlManager&gt;();
57  #endif
58  #if !OS_WINDOWS
59              _serviceControlManager = new Mock&lt;ILinuxServiceControlManager&gt;();
60  #endif
61              var expectedAgent = new TaskAgent(_expectedAgentName) { Id = 1, Ephemeral = true, DisableUpdate = true };
62              expectedAgent.Authorization = new TaskAgentAuthorization
63              {
64                  ClientId = Guid.NewGuid(),
65                  AuthorizationUrl = new Uri(&quot;http:&amp;bsol;&amp;bsol;localhost:8080/pipelines&quot;),
66              };
67              var expectedRunner = new GitHub.DistributedTask.WebApi.Runner() { Name = expectedAgent.Name, Id = 1 };
68              expectedRunner.RunnerAuthorization = new GitHub.DistributedTask.WebApi.Runner.Authorization
69              {
70                  ClientId = expectedAgent.Authorization.ClientId.ToString(),
71                  AuthorizationUrl = new Uri(&quot;http:&amp;bsol;&amp;bsol;localhost:8080/pipelines&quot;),
72              };
73              var connectionData = new ConnectionData()
74              {
75                  InstanceId = Guid.NewGuid(),
76                  DeploymentType = DeploymentFlags.Hosted,
77                  DeploymentId = Guid.NewGuid()
78              };
79              _runnerServer.Setup(x =&gt; x.ConnectAsync(It.IsAny&lt;Uri&gt;(), It.IsAny&lt;VssCredentials&gt;())).Returns(Task.FromResult&lt;object&gt;(null));
80              _locationServer.Setup(x =&gt; x.ConnectAsync(It.IsAny&lt;VssConnection&gt;())).Returns(Task.FromResult&lt;object&gt;(null));
81              _locationServer.Setup(x =&gt; x.GetConnectionDataAsync()).Returns(Task.FromResult&lt;ConnectionData&gt;(connectionData));
82              _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
83              _store.Setup(x =&gt; x.HasCredentials()).Returns(false);
84              _store.Setup(x =&gt; x.GetSettings()).Returns(() =&gt; _configMgrAgentSettings);
85              _store.Setup(x =&gt; x.SaveSettings(It.IsAny&lt;RunnerSettings&gt;()))
86                  .Callback((RunnerSettings settings) =&gt;
87                  {
88                      _configMgrAgentSettings = settings;
89                  });
90              _credMgr.Setup(x =&gt; x.GetCredentialProvider(It.IsAny&lt;string&gt;())).Returns(new TestRunnerCredential());
91  #if !OS_WINDOWS
92              _serviceControlManager.Setup(x =&gt; x.GenerateScripts(It.IsAny&lt;RunnerSettings&gt;()));
93  #endif
94              var expectedPools = new List&lt;TaskAgentPool&gt;() { new TaskAgentPool(_defaultRunnerGroupName) { Id = _defaultRunnerGroupId, IsInternal = true }, new TaskAgentPool(_secondRunnerGroupName) { Id = _secondRunnerGroupId } };
95              _runnerServer.Setup(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;TaskAgentPoolType&gt;())).Returns(Task.FromResult(expectedPools));
96              var expectedAgents = new List&lt;TaskAgent&gt;();
97              _runnerServer.Setup(x =&gt; x.GetAgentsAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;string&gt;())).Returns(Task.FromResult(expectedAgents));
98              _runnerServer.Setup(x =&gt; x.AddAgentAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;TaskAgent&gt;())).Returns(Task.FromResult(expectedAgent));
99              _runnerServer.Setup(x =&gt; x.ReplaceAgentAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;TaskAgent&gt;())).Returns(Task.FromResult(expectedAgent));
100              _dotcomServer.Setup(x =&gt; x.GetRunnersAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Returns(Task.FromResult(expectedAgents));
101              _dotcomServer.Setup(x =&gt; x.GetRunnerGroupsAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Returns(Task.FromResult(expectedPools));
102              _dotcomServer.Setup(x =&gt; x.AddRunnerAsync(It.IsAny&lt;int&gt;(), It.IsAny&lt;TaskAgent&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;(), It.IsAny&lt;string&gt;())).Returns(Task.FromResult(expectedRunner));
103              rsa = new RSACryptoServiceProvider(2048);
104              _rsaKeyManager.Setup(x =&gt; x.CreateKey()).Returns(rsa);
105          }
106          private TestHostContext CreateTestContext([CallerMemberName] String testName = &quot;&quot;)
107          {
108              TestHostContext tc = new(this, testName);
109              tc.SetSingleton&lt;ICredentialManager&gt;(_credMgr.Object);
110              tc.SetSingleton&lt;IPromptManager&gt;(_promptManager.Object);
111              tc.SetSingleton&lt;IConfigurationStore&gt;(_store.Object);
112              tc.SetSingleton&lt;IExtensionManager&gt;(_extnMgr.Object);
113              tc.SetSingleton&lt;IRunnerServer&gt;(_runnerServer.Object);
114              tc.SetSingleton&lt;IRunnerDotcomServer&gt;(_dotcomServer.Object);
115              tc.SetSingleton&lt;ILocationServer&gt;(_locationServer.Object);
116  #if OS_WINDOWS
117              tc.SetSingleton&lt;IWindowsServiceControlManager&gt;(_serviceControlManager.Object);
118  #else
119              tc.SetSingleton&lt;ILinuxServiceControlManager&gt;(_serviceControlManager.Object);
120  #endif
121              tc.SetSingleton&lt;IRSAKeyManager&gt;(_rsaKeyManager.Object);
122              return tc;
123          }
124          [Fact]
125          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
126          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
127          public async Task CanEnsureConfigure()
128          {
129              using (TestHostContext tc = CreateTestContext())
130              {
131                  Tracing trace = tc.GetTrace();
132                  trace.Info(&quot;Creating config manager&quot;);
133                  IConfigurationManager configManager = new ConfigurationManager();
134                  configManager.Initialize(tc);
135                  var userLabels = &quot;userlabel1,userlabel2&quot;;
136                  trace.Info(&quot;Preparing command line arguments&quot;);
137                  var command = new CommandSettings(
138                      tc,
139                      new[]
140                      {
141                         &quot;configure&quot;,
142                         &quot;--url&quot;, _expectedServerUrl,
143                         &quot;--name&quot;, _expectedAgentName,
144                         &quot;--runnergroup&quot;, _secondRunnerGroupName,
145                         &quot;--work&quot;, _expectedWorkFolder,
146                         &quot;--auth&quot;, _expectedAuthType,
147                         &quot;--token&quot;, _expectedToken,
148                         &quot;--labels&quot;, userLabels,
149                         &quot;--ephemeral&quot;,
150                         &quot;--disableupdate&quot;,
151                         &quot;--unattended&quot;,
152                      });
153                  trace.Info(&quot;Constructed.&quot;);
154                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
155                  _configMgrAgentSettings = null;
156                  trace.Info(&quot;Ensuring all the required parameters are available in the command line parameter&quot;);
157                  await configManager.ConfigureAsync(command);
158                  _store.Setup(x =&gt; x.IsConfigured()).Returns(true);
159                  trace.Info(&quot;Configured, verifying all the parameter value&quot;);
160                  var s = configManager.LoadSettings();
161                  Assert.NotNull(s);
162                  Assert.True(s.ServerUrl.Equals(_expectedServerUrl));
163                  Assert.True(s.AgentName.Equals(_expectedAgentName));
164                  Assert.True(s.PoolId.Equals(_secondRunnerGroupId));
165                  Assert.True(s.WorkFolder.Equals(_expectedWorkFolder));
166                  Assert.True(s.Ephemeral.Equals(true));
167                  _runnerServer.Verify(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.Is&lt;TaskAgentPoolType&gt;(p =&gt; p == TaskAgentPoolType.Automation)), Times.Exactly(2));
168                  var expectedLabels = new List&lt;string&gt;() { &quot;self-hosted&quot;, VarUtil.OS, VarUtil.OSArchitecture };
169                  expectedLabels.AddRange(userLabels.Split(&quot;,&quot;).ToList());
170                  _runnerServer.Verify(x =&gt; x.AddAgentAsync(It.IsAny&lt;int&gt;(), It.Is&lt;TaskAgent&gt;(a =&gt; a.Labels.Select(x =&gt; x.Name).ToHashSet().SetEquals(expectedLabels))), Times.Once);
171              }
172          }
173          [Fact]
174          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
175          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
176          public async Task ConfigureErrorDefaultLabelsDisabledWithNoCustomLabels()
177          {
178              using (TestHostContext tc = CreateTestContext())
179              {
180                  Tracing trace = tc.GetTrace();
181                  trace.Info(&quot;Creating config manager&quot;);
182                  IConfigurationManager configManager = new ConfigurationManager();
183                  configManager.Initialize(tc);
184                  trace.Info(&quot;Preparing command line arguments&quot;);
185                  var command = new CommandSettings(
186                      tc,
187                      new[]
188                      {
189                         &quot;configure&quot;,
190                         &quot;--url&quot;, _expectedServerUrl,
191                         &quot;--name&quot;, _expectedAgentName,
192                         &quot;--runnergroup&quot;, _secondRunnerGroupName,
193                         &quot;--work&quot;, _expectedWorkFolder,
194                         &quot;--auth&quot;, _expectedAuthType,
195                         &quot;--token&quot;, _expectedToken,
196                         &quot;--no-default-labels&quot;,
197                         &quot;--ephemeral&quot;,
198                         &quot;--disableupdate&quot;,
199                         &quot;--unattended&quot;,
200                      });
201                  trace.Info(&quot;Constructed.&quot;);
202                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
203                  _configMgrAgentSettings = null;
204                  trace.Info(&quot;Ensuring configure fails if default labels are disabled and no custom labels are set&quot;);
205                  var ex = await Assert.ThrowsAsync&lt;NotSupportedException&gt;(() =&gt; configManager.ConfigureAsync(command));
206                  Assert.Contains(&quot;--no-default-labels without specifying --labels is not supported&quot;, ex.Message);
207              }
208          }
209          [Fact]
210          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
211          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
212          public async Task ConfigureDefaultLabelsDisabledWithCustomLabels()
213          {
214              using (TestHostContext tc = CreateTestContext())
215              {
216                  Tracing trace = tc.GetTrace();
217                  trace.Info(&quot;Creating config manager&quot;);
218                  IConfigurationManager configManager = new ConfigurationManager();
219                  configManager.Initialize(tc);
220                  var userLabels = &quot;userlabel1,userlabel2&quot;;
221                  trace.Info(&quot;Preparing command line arguments&quot;);
222                  var command = new CommandSettings(
223                      tc,
224                      new[]
225                      {
226                         &quot;configure&quot;,
227                         &quot;--url&quot;, _expectedServerUrl,
228                         &quot;--name&quot;, _expectedAgentName,
229                         &quot;--runnergroup&quot;, _secondRunnerGroupName,
230                         &quot;--work&quot;, _expectedWorkFolder,
231                         &quot;--auth&quot;, _expectedAuthType,
232                         &quot;--token&quot;, _expectedToken,
233                         &quot;--labels&quot;, userLabels,
234                         &quot;--no-default-labels&quot;,
235                         &quot;--ephemeral&quot;,
236                         &quot;--disableupdate&quot;,
237                         &quot;--unattended&quot;,
238                      });
239                  trace.Info(&quot;Constructed.&quot;);
240                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
241                  _configMgrAgentSettings = null;
242                  trace.Info(&quot;Ensuring all the required parameters are available in the command line parameter&quot;);
243                  await configManager.ConfigureAsync(command);
244                  _store.Setup(x =&gt; x.IsConfigured()).Returns(true);
245                  trace.Info(&quot;Configured, verifying all the parameter value&quot;);
246                  var s = configManager.LoadSettings();
247                  Assert.NotNull(s);
248                  Assert.True(s.ServerUrl.Equals(_expectedServerUrl));
249                  Assert.True(s.AgentName.Equals(_expectedAgentName));
250                  Assert.True(s.PoolId.Equals(_secondRunnerGroupId));
251                  Assert.True(s.WorkFolder.Equals(_expectedWorkFolder));
252                  Assert.True(s.Ephemeral.Equals(true));
253                  _runnerServer.Verify(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.Is&lt;TaskAgentPoolType&gt;(p =&gt; p == TaskAgentPoolType.Automation)), Times.Exactly(2));
254                  var expectedLabels = userLabels.Split(&quot;,&quot;).ToList();
255                  _runnerServer.Verify(x =&gt; x.AddAgentAsync(It.IsAny&lt;int&gt;(), It.Is&lt;TaskAgent&gt;(a =&gt; a.Labels.Select(x =&gt; x.Name).ToHashSet().SetEquals(expectedLabels))), Times.Once);
256              }
257          }
258          [Fact]
259          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
260          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
261          public async Task ConfigureErrorOnMissingRunnerGroup()
262          {
263              using (TestHostContext tc = CreateTestContext())
264              {
265                  var expectedPools = new List&lt;TaskAgentPool&gt;() { new TaskAgentPool(_defaultRunnerGroupName) { Id = _defaultRunnerGroupId, IsInternal = true } };
266                  _runnerServer.Setup(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.IsAny&lt;TaskAgentPoolType&gt;())).Returns(Task.FromResult(expectedPools));
267                  Tracing trace = tc.GetTrace();
<span onclick='openModal()' class='match'>268                  trace.Info(&quot;Creating config manager&quot;);
269                  IConfigurationManager configManager = new ConfigurationManager();
270                  configManager.Initialize(tc);
</span>271                  trace.Info(&quot;Preparing command line arguments&quot;);
272                  var command = new CommandSettings(
273                      tc,
274                      new[]
275                      {
276                         &quot;configure&quot;,
277                         &quot;--url&quot;, _expectedServerUrl,
278                         &quot;--name&quot;, _expectedAgentName,
279                         &quot;--runnergroup&quot;, &quot;notexists&quot;,
280                         &quot;--work&quot;, _expectedWorkFolder,
281                         &quot;--auth&quot;, _expectedAuthType,
282                         &quot;--token&quot;, _expectedToken,
283                      });
284                  trace.Info(&quot;Constructed.&quot;);
285                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
286                  _configMgrAgentSettings = null;
287                  trace.Info(&quot;Ensuring all the required parameters are available in the command line parameter&quot;);
288                  var ex = await Assert.ThrowsAsync&lt;TaskAgentPoolNotFoundException&gt;(() =&gt; configManager.ConfigureAsync(command));
289                  Assert.Contains(&quot;notexists&quot;, ex.Message);
290                  _runnerServer.Verify(x =&gt; x.GetAgentPoolsAsync(It.IsAny&lt;string&gt;(), It.Is&lt;TaskAgentPoolType&gt;(p =&gt; p == TaskAgentPoolType.Automation)), Times.Exactly(1));
291              }
292          }
293  #if OS_LINUX
294          [Fact]
295          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
296          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
297          public async Task ConfigureRunnerServiceFailsOnUnconfiguredRunners()
298          {
299              using (TestHostContext tc = CreateTestContext())
300              {
301                  Tracing trace = tc.GetTrace();
302                  trace.Info(&quot;Creating config manager&quot;);
303                  IConfigurationManager configManager = new ConfigurationManager();
304                  configManager.Initialize(tc);
305                  trace.Info(&quot;Preparing command line arguments&quot;);
306                  var command = new CommandSettings(
307                      tc,
308                      new[]
309                      {
310                         &quot;configure&quot;,
311                         &quot;--generateServiceConfig&quot;,
312                      });
313                  trace.Info(&quot;Constructed&quot;);
314                  _store.Setup(x =&gt; x.IsConfigured()).Returns(false);
315                  trace.Info(&quot;Ensuring service generation mode fails when on un-configured runners&quot;);
316                  var ex = await Assert.ThrowsAsync&lt;InvalidOperationException&gt;(() =&gt; configManager.ConfigureAsync(command));
317                  Assert.Contains(&quot;requires that the runner is already configured&quot;, ex.Message);
318              }
319          }
320          [Fact]
321          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
322          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
323          public async Task ConfigureRunnerServiceCreatesService()
324          {
325              using (TestHostContext tc = CreateTestContext())
326              {
327                  Tracing trace = tc.GetTrace();
328                  trace.Info(&quot;Creating config manager&quot;);
329                  IConfigurationManager configManager = new ConfigurationManager();
330                  configManager.Initialize(tc);
331                  trace.Info(&quot;Preparing command line arguments&quot;);
332                  var command = new CommandSettings(
333                      tc,
334                      new[]
335                      {
336                         &quot;configure&quot;,
337                         &quot;--generateServiceConfig&quot;,
338                      });
339                  trace.Info(&quot;Constructed&quot;);
340                  _store.Setup(x =&gt; x.IsConfigured()).Returns(true);
341                  trace.Info(&quot;Ensuring service generation mode fails when on un-configured runners&quot;);
342                  await configManager.ConfigureAsync(command);
343                  _serviceControlManager.Verify(x =&gt; x.GenerateScripts(It.IsAny&lt;RunnerSettings&gt;()), Times.Once);
344              }
345          }
346  #endif
347  #if !OS_LINUX
348          [Fact]
349          [Trait(&quot;Level&quot;, &quot;L0&quot;)]
350          [Trait(&quot;Category&quot;, &quot;ConfigurationManagement&quot;)]
351          public async Task ConfigureRunnerServiceFailsOnUnsupportedPlatforms()
352          {
353              using (TestHostContext tc = CreateTestContext())
354              {
355                  Tracing trace = tc.GetTrace();
356                  trace.Info(&quot;Creating config manager&quot;);
357                  IConfigurationManager configManager = new ConfigurationManager();
358                  configManager.Initialize(tc);
359                  trace.Info(&quot;Preparing command line arguments&quot;);
360                  var command = new CommandSettings(
361                      tc,
362                      new[]
363                      {
364                         &quot;configure&quot;,
365                         &quot;--generateServiceConfig&quot;,
366                      });
367                  trace.Info(&quot;Constructed&quot;);
368                  _store.Setup(x =&gt; x.IsConfigured()).Returns(true);
369                  trace.Info(&quot;Ensuring service generation mode fails on unsupported runner platforms&quot;);
370                  var ex = await Assert.ThrowsAsync&lt;NotSupportedException&gt;(() =&gt; configManager.ConfigureAsync(command));
371                  Assert.Contains(&quot;only supported on Linux&quot;, ex.Message);
372              }
373          }
374  #endif
375      }
376  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-ConfigurationManagerL0.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from runner-MDEwOlJlcG9zaXRvcnkxODQyODY4NzU=-flat-ConfigurationManagerL0.cs</div>
                </div>
                <div class="column column_space"><pre><code>132                  trace.Info(&quot;Creating config manager&quot;);
133                  IConfigurationManager configManager = new ConfigurationManager();
134                  configManager.Initialize(tc);
</pre></code></div>
                <div class="column column_space"><pre><code>268                  trace.Info(&quot;Creating config manager&quot;);
269                  IConfigurationManager configManager = new ConfigurationManager();
270                  configManager.Initialize(tc);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    