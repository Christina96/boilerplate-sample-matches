
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 19, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-ResizeBasedServiceTests.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Linq;
4  using System.Text;
5  using System.Threading.Tasks;
6  using FluentAssertions;
7  using Microsoft.Extensions.Options;
8  using Microsoft.JSInterop;
9  using Microsoft.JSInterop.Infrastructure;
10  using Moq;
11  using MudBlazor.Services;
12  using NUnit.Framework;
13  namespace MudBlazor.UnitTests.Services
14  {
15      [TestFixture]
16      public class ResizeBasedServiceTests
17      {
18          private Mock<IBrowserWindowSizeProvider> _browserWindowSizeProvider;
19          private Mock<IJSRuntime> _jsruntimeMock;
20          private ResizeService _service;
21          [SetUp]
22          public void SetUp()
23          {
24              _browserWindowSizeProvider = new Mock<IBrowserWindowSizeProvider>();
25              _jsruntimeMock = new Mock<IJSRuntime>();
26              _service = new ResizeService(_jsruntimeMock.Object, _browserWindowSizeProvider.Object);
27          }
28          [Test]
29          public async Task GetBrowserWindowSize()
30          {
31              var size = new BrowserWindowSize
32              {
33                  Height = 200,
34                  Width = 200,
35              };
36              _browserWindowSizeProvider.Setup(x => x.GetBrowserWindowSize()).ReturnsAsync(size);
37              var actualSize = await _service.GetBrowserWindowSize();
38              actualSize.Should().Be(size);
<span onclick='openModal()' class='match'>39              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
40          }
</span>41          private record ListenForResizeCallbackInfo(
42              DotNetObjectReference<ResizeService> DotnetRef, ResizeOptions options, Guid ListenerId);
43          private void SetupJsMockForSubscription(ResizeOptions expectedOptions, Action<ListenForResizeCallbackInfo> callbackInfo = null)
44          {
45              _jsruntimeMock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.listenForResize",
46                 It.Is<object[]>(z =>
47                     z[0] is DotNetObjectReference<ResizeService> == true &&
48                     (ResizeOptions)z[1] == expectedOptions &&
49                     (Guid)z[2] != default
50                 ))).ReturnsAsync(Mock.Of<IJSVoidResult>).Callback<string, object[]>((x, z) => callbackInfo?.Invoke(new ListenForResizeCallbackInfo(
51                      (DotNetObjectReference<ResizeService>)z[0],
52                      (ResizeOptions)z[1], (Guid)z[2]
53                     ))).Verifiable();
54          }
55          private void SetupJsMockForUnsubscription(Guid listenerId)
56          {
57              _jsruntimeMock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.cancelListener",
58                 It.Is<object[]>(z =>
59                     (Guid)z[0] == listenerId
60                 ))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
61          }
62          private async Task CheckSubscriptionOptions(ResizeOptions expectedOptions)
63          {
64              SetupJsMockForSubscription(expectedOptions);
65              var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { });
66              subscriptionId.Should().NotBe(Guid.Empty);
67              _jsruntimeMock.Verify();
68          }
69          [Test]
70          public async Task Subscribe_WithDefaultOptions()
71          {
72              await CheckSubscriptionOptions(new ResizeOptions());
73          }
74          [Test]
75          public async Task Subscribe_WithOptionsSetInConstructor()
76          {
77              var customResizeOptioons = new ResizeOptions
78              {
79                  ReportRate = 120,
80              };
81              var optionGetter = new Mock<IOptions<ResizeOptions>>();
82              optionGetter.SetupGet(x => x.Value).Returns(customResizeOptioons);
83              _service = new ResizeService(_jsruntimeMock.Object, _browserWindowSizeProvider.Object, optionGetter.Object);
84              await CheckSubscriptionOptions(customResizeOptioons);
85          }
86          [Test]
87          public async Task Subscribe_WithPerCallOption()
88          {
89              var customResizeOptioons = new ResizeOptions
90              {
91                  ReportRate = 130,
92              };
93              SetupJsMockForSubscription(customResizeOptioons);
94              var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { }, customResizeOptioons);
95              subscriptionId.Should().NotBe(Guid.Empty);
96              _jsruntimeMock.Verify();
97          }
98          [Test]
99          public async Task Subscribe_WithPerCallOptionSetAsNull()
100          {
101              var customResizeOptioons = new ResizeOptions();
102              SetupJsMockForSubscription(customResizeOptioons);
103              var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { }, null);
104              subscriptionId.Should().NotBe(Guid.Empty);
105              _jsruntimeMock.Verify();
106          }
107          [Test]
108          public void Subscribe_Failed_NullCallback()
109          {
110              Assert.ThrowsAsync<ArgumentNullException>(() => _service.SubscribeAsync(null!));
111              Assert.ThrowsAsync<ArgumentNullException>(() => _service.SubscribeAsync(null!, new ResizeOptions()));
112          }
113          [Test]
114          public async Task SubscribeAndUnsubcribe_SingleSubscription()
115          {
116              var customResizeOptioons = new ResizeOptions();
117              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
118              {
119                  if (x.ListenerId == default)
120                  {
121                      throw new ArgumentException();
122                  }
123                  SetupJsMockForUnsubscription(x.ListenerId);
124              };
125              SetupJsMockForSubscription(customResizeOptioons, feedbackCaller);
126              var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { }, null);
127              var result = await _service.UnsubscribeAsync(subscriptionId);
128              result.Should().BeTrue();
129              _jsruntimeMock.Verify();
130          }
131          [Test]
132          public async Task SubscribeAndUnsubcribe_DisposeOfDotNet()
133          {
134              var customResizeOptioons = new ResizeOptions();
135              for (int i = 0; i < 4; i++)
136              {
137                  var lastDotnetRefHashCode = 0;
138                  Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
139                  {
140                      if (x.ListenerId == default)
141                      {
142                          throw new ArgumentException();
143                      }
144                      if (x.DotnetRef.GetHashCode() == lastDotnetRefHashCode)
145                      {
146                          throw new ArgumentException();
147                      }
148                      lastDotnetRefHashCode = x.DotnetRef.GetHashCode();
149                      SetupJsMockForUnsubscription(x.ListenerId);
150                  };
151                  SetupJsMockForSubscription(customResizeOptioons, feedbackCaller);
152                  var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { }, null);
153                  var result = await _service.UnsubscribeAsync(subscriptionId);
154                  result.Should().BeTrue();
155                  _jsruntimeMock.Verify();
156              }
157          }
158          [Test]
159          public async Task SubscribeAndUnsubcribe_MultipleSubscription()
160          {
161              var customResizeOptioons = new ResizeOptions();
162              var feedbackCallerCount = 0;
163              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
164              {
165                  if (x.ListenerId == default)
166                  {
167                      throw new ArgumentException();
168                  }
169                  feedbackCallerCount++;
170              };
171              SetupJsMockForSubscription(customResizeOptioons, feedbackCaller);
172              HashSet<Guid> subscriptionIds = new HashSet<Guid>();
173              for (int i = 0; i < 10; i++)
174              {
175                  var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { });
176                  subscriptionIds.Add(subscriptionId);
177              }
178              feedbackCallerCount.Should().Be(1);
179              subscriptionIds.Should().HaveCount(10);
180              _jsruntimeMock.Verify();
181          }
182          [Test]
183          public async Task SubscribeAndUnsubcribe_MultipleSubscription_WithMultipleOptions()
184          {
185              List<ListenForResizeCallbackInfo> callerFeedbacks = new();
186              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
187              {
188                  if (x.ListenerId == default)
189                  {
190                      throw new ArgumentException();
191                  }
192                  callerFeedbacks.Add(x);
193              };
194              var options = new[]
195              {
196                  new ResizeOptions(),
197                  new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) },
198                  new ResizeOptions { ReportRate = 50 },
199                  new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) },
200              };
201              foreach (var item in options)
202              {
203                  SetupJsMockForSubscription(item, feedbackCaller);
204              }
205              var subscriptionIds = options.ToDictionary(x => x, x => new HashSet<Guid>());
206              for (int i = 0; i < 40; i++)
207              {
208                  var index = i % 4;
209                  var option = options[index];
210                  var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { }, option);
211                  subscriptionIds[option].Add(subscriptionId);
212              }
213              foreach (var item in subscriptionIds)
214              {
215                  item.Value.Should().HaveCount(10);
216              }
217              callerFeedbacks.Should().HaveCount(4);
218              for (int i = 0; i < callerFeedbacks.Count; i++)
219              {
220                  var feedback = callerFeedbacks[i];
221                  feedback.options.Should().Be(options[i]);
222              }
223              callerFeedbacks.Select(x => x.ListenerId).ToHashSet().Should().HaveCount(4);
224              _jsruntimeMock.Verify();
225          }
226          [Test]
227          public async Task Unsubscribe_Failed_NoActiveSubscription()
228          {
229              var result = await _service.UnsubscribeAsync(Guid.NewGuid());
230              result.Should().BeFalse();
231          }
232          [Test]
233          public async Task Unsubscribe_Failed_SubscriptioonIdNotFound()
234          {
235              var customResizeOptioons = new ResizeOptions();
236              SetupJsMockForSubscription(customResizeOptioons);
237              var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { }, null);
238              var result = await _service.UnsubscribeAsync(Guid.NewGuid());
239              result.Should().BeFalse();
240          }
241          [Test]
242          public async Task DisposeAsync_Failed_NoActiveSubscription()
243          {
244              await _service.DisposeAsync();
245          }
246          [Test]
247          public async Task DisposeAsync_MultipleSubscription_WithMultipleOptions()
248          {
249              List<Guid> callerIds = new();
250              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
251              {
252                  if (x.ListenerId == default)
253                  {
254                      throw new ArgumentException();
255                  }
256                  callerIds.Add(x.ListenerId);
257              };
258              var options = new[]
259              {
260                  new ResizeOptions(),
261                  new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) },
262                  new ResizeOptions { ReportRate = 50 },
263                  new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) },
264              };
265              foreach (var item in options)
266              {
267                  SetupJsMockForSubscription(item, feedbackCaller);
268              }
269              for (int i = 0; i < 40; i++)
270              {
271                  var index = i % 4;
272                  var option = options[index];
273                  await _service.SubscribeAsync((BrowserWindowSize size) => { }, option);
274              }
275              Func<IEnumerable<Guid>, bool> idChecker = (ids) =>
276               {
277                   try
278                   {
279                       ids.Should().BeEquivalentTo(callerIds);
280                       return true;
281                   }
282                   catch (Exception)
283                   {
284                       return false;
285                   }
286               };
287              _jsruntimeMock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.cancelListeners",
288               It.Is<object[]>(z =>
289                   z[0] is IEnumerable<Guid> &&
290                   idChecker((IEnumerable<Guid>)z[0]) == true
291               ))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
292              await _service.DisposeAsync();
293              _jsruntimeMock.Verify();
294          }
295          private class FakeSubscriber
296          {
297              public Guid SubscriptionId { get; set; }
298              public BrowserWindowSize ActualSize { get; set; } = new BrowserWindowSize { };
299              public async Task Subscribe(ResizeService service,
300                  ResizeOptions options)
301              {
302                  SubscriptionId = await service.SubscribeAsync((x) => ActualSize = x, options);
303              }
304          }
305          [Test]
306          public async Task RaiseOnResized_MultipleSubscription_WithMultipleOptions()
307          {
308              Dictionary<ResizeOptions, Guid> listenerIds = new();
309              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) => listenerIds.Add(x.options, x.ListenerId); ;
310              var options = new[]
311              {
312                  (new ResizeOptions(),new BrowserWindowSize { Height = 20,  Width = 200 }),
313                  (new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) }, new BrowserWindowSize { Height = 30,  Width = 300 }),
314                  (new ResizeOptions { ReportRate = 50 },new BrowserWindowSize { Height = 40,  Width = 400 }),
315                  (new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) },new BrowserWindowSize { Height = 50,  Width = 500 })
316              };
317              Dictionary<FakeSubscriber, BrowserWindowSize> subscribers = new();
318              foreach (var item in options)
319              {
320                  SetupJsMockForSubscription(item.Item1, feedbackCaller);
321              }
322              for (int i = 0; i < 40; i++)
323              {
324                  var index = i % 4;
325                  var option = options[index];
326                  var subscriber = new FakeSubscriber();
327                  await subscriber.Subscribe(_service, option.Item1);
328                  subscribers.Add(subscriber, option.Item2);
329              }
330              foreach (var item in options)
331              {
332                  var listenerId = listenerIds[item.Item1];
333                  _service.RaiseOnResized(item.Item2, Breakpoint.None, listenerId);
334              }
335              foreach (var item in subscribers)
336              {
337                  item.Key.ActualSize.Should().Be(item.Value);
338              }
339              _jsruntimeMock.Verify();
340          }
341          [Test]
342          public async Task RaiseOnResized_InvalidListenerId()
343          {
344              var customResizeOptions = new ResizeOptions();
345              SetupJsMockForSubscription(customResizeOptions);
346              FakeSubscriber subscriber = new FakeSubscriber();
347              await subscriber.Subscribe(_service, customResizeOptions);
348              _service.RaiseOnResized(new BrowserWindowSize { Height = 2000 }, Breakpoint.None, Guid.NewGuid());
349              subscriber.ActualSize.Height.Should().NotBe(2000);
350          }
351          [Test]
352          public async Task Unsubcribe_MultipleSubscription_InParallel()
353          {
354              var customResizeOptioons = new ResizeOptions();
355              var feedbackCallerCount = 0;
356              var listenerId = Guid.Empty;
357              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
358              {
359                  if (x.ListenerId == default)
360                  {
361                      throw new ArgumentException();
362                  }
363                  feedbackCallerCount++;
364                  listenerId = x.ListenerId;
365              };
366              SetupJsMockForSubscription(customResizeOptioons, feedbackCaller);
367              var subscriptionIds = new HashSet<Guid>();
368              for (int i = 0; i < 40; i++)
369              {
370                  var subscriptionId = await _service.SubscribeAsync((BrowserWindowSize size) => { });
371                  subscriptionIds.Add(subscriptionId);
372              }
373              subscriptionIds.Should().HaveCount(40);
374              feedbackCallerCount.Should().Be(1);
375              SetupJsMockForUnsubscription(listenerId);
376              var tasksToExecute = new Task[subscriptionIds.Count];
377              for (int i = 0; i < subscriptionIds.Count; i++)
378              {
379                  var temp = i;
380                  var task = Task.Run(async () =>
381                  {
382                      _ = await _service.UnsubscribeAsync(subscriptionIds.ElementAt(temp));
383                  });
384                  tasksToExecute[i] = task;
385              }
386              Task.WaitAll(tasksToExecute);
387              _jsruntimeMock.Verify((x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.cancelListener",
388                 It.Is<object[]>(z =>
389                     (Guid)z[0] == listenerId
390                 ))), Times.Once());
391          }
392      }
393  }
</code></pre>
        </div>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-BreakpointServiceTests.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Linq;
4  using System.Threading.Tasks;
5  using FluentAssertions;
6  using Microsoft.Extensions.Options;
7  using Microsoft.JSInterop;
8  using Microsoft.JSInterop.Infrastructure;
9  using Moq;
10  using MudBlazor.Services;
11  using NUnit.Framework;
12  namespace MudBlazor.UnitTests.Services
13  {
14      [TestFixture]
15      public class BreakpointServiceTests
16      {
17          private Mock<IBrowserWindowSizeProvider> _browserWindowSizeProvider;
18          private Mock<IJSRuntime> _jsRuntimeMock;
19          private BreakpointService _service;
20          [SetUp]
21          public void SetUp()
22          {
23              _browserWindowSizeProvider = new Mock<IBrowserWindowSizeProvider>();
24              _browserWindowSizeProvider.Setup(x => x.GetBrowserWindowSize()).ReturnsAsync(new BrowserWindowSize { Width = 970, Height = 30 }).Verifiable();
25              _jsRuntimeMock = new Mock<IJSRuntime>();
26              _service = new BreakpointService(_jsRuntimeMock.Object, _browserWindowSizeProvider.Object);
27          }
28          private record ListenForResizeCallbackInfo(DotNetObjectReference<BreakpointService> DotnetRef, ResizeOptions Options, Guid ListenerId);
29          private void SetupJsMockForSubscription(ResizeOptions expectedOptions, bool setBreakpoints, Action<ListenForResizeCallbackInfo> callbackInfo = null)
30          {
31              if (setBreakpoints)
32              {
33                  expectedOptions.BreakpointDefinitions = BreakpointGlobalOptions.DefaultBreakpointDefinitions.ToDictionary(x => x.Key, x => x.Value);
34              }
35              _jsRuntimeMock
36                  .Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.listenForResize",
37                      It.Is<object[]>(args =>
38                          args[0] is DotNetObjectReference<BreakpointService> == true &&
39                          (ResizeOptions)args[1] == expectedOptions &&
40                          (Guid)args[2] != default
41                      )))
42                  .ReturnsAsync(Mock.Of<IJSVoidResult>)
43                  .Callback<string, object[]>((_, args) =>
44                  {
45                      var dotnetReference = (DotNetObjectReference<BreakpointService>)args[0];
46                      var resizeOptions = (ResizeOptions)args[1];
47                      var listenerId = (Guid)args[2];
48                      callbackInfo?.Invoke(new ListenForResizeCallbackInfo(dotnetReference, resizeOptions, listenerId));
49                  })
50                  .Verifiable();
51          }
52          private void SetupJsMockForUnsubscription(Guid listenerId)
53          {
54              _jsRuntimeMock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.cancelListener",
55                 It.Is<object[]>(z =>
56                     (Guid)z[0] == listenerId
57                 ))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
58          }
59          private async Task CheckSubscriptionOptions(ResizeOptions expectedOptions, bool setBreakpoint)
60          {
61              SetupJsMockForSubscription(expectedOptions, setBreakpoint);
62              var subscriptionResult = await _service.SubscribeAsync((Breakpoint size) => { }, expectedOptions);
63              subscriptionResult.Should().NotBeNull();
64              subscriptionResult.SubscriptionId.Should().NotBe(Guid.Empty);
65              subscriptionResult.Breakpoint.Should().Be(Breakpoint.Md);
66              _jsRuntimeMock.Verify();
67          }
68          [Test]
69          public async Task Subscribe_WithDefaultOptions()
70          {
71              await CheckSubscriptionOptions(new ResizeOptions(), true);
72          }
73          [Test]
74          public async Task Subscribe_WithDefaultOptions_SetBreakpoint()
75          {
76              var option = new ResizeOptions();
77              await CheckSubscriptionOptions(option, true);
78              option.BreakpointDefinitions.Should().NotBeNull();
79              option.BreakpointDefinitions.Should().NotBeNull();
80              option.BreakpointDefinitions.Should().BeEquivalentTo(BreakpointGlobalOptions.DefaultBreakpointDefinitions);
81          }
82          [Test]
83          public async Task Subscribe_WithDefaultOptions_DontSetBreakpoint()
84          {
85              var breakpointDict = new Dictionary<Breakpoint, int>
86              {
87                  { Breakpoint.Xl, 12 },
88              };
89              var option = new ResizeOptions
90              {
91                  BreakpointDefinitions = breakpointDict
92              };
93              await CheckSubscriptionOptions(option, false);
94              option.BreakpointDefinitions.Should().BeEquivalentTo(breakpointDict);
95          }
96          [Test]
97          public async Task Subscribe_WithOptionsSetInConstructor()
98          {
99              var customResizeOptions = new ResizeOptions
100              {
101                  ReportRate = 120,
102              };
103              var optionGetter = new Mock<IOptions<ResizeOptions>>();
104              optionGetter.SetupGet(x => x.Value).Returns(customResizeOptions);
105              _service = new BreakpointService(_jsRuntimeMock.Object, _browserWindowSizeProvider.Object, optionGetter.Object);
106              await CheckSubscriptionOptions(customResizeOptions, true);
107          }
108          [Test]
109          public async Task Subscribe_WithPerCallOption()
110          {
111              var customResizeOptions = new ResizeOptions
112              {
113                  ReportRate = 130,
114              };
115              SetupJsMockForSubscription(customResizeOptions, true);
116              var subscriptionResult = await _service.SubscribeAsync((Breakpoint size) => { }, customResizeOptions);
117              subscriptionResult.Should().NotBeNull();
118              subscriptionResult.SubscriptionId.Should().NotBe(Guid.Empty);
119              subscriptionResult.Breakpoint.Should().Be(Breakpoint.Md);
120              _jsRuntimeMock.Verify();
121          }
122          [Test]
123          public async Task Subscribe_WithPerCallOptionSetAsNull()
124          {
125              var customResizeOptions = new ResizeOptions();
126              SetupJsMockForSubscription(customResizeOptions, true);
127              var subscriptionResult = await _service.SubscribeAsync((Breakpoint size) => { }, null);
128              subscriptionResult.Should().NotBeNull();
129              subscriptionResult.SubscriptionId.Should().NotBe(Guid.Empty);
130              subscriptionResult.Breakpoint.Should().Be(Breakpoint.Md);
131              _jsRuntimeMock.Verify();
132          }
133          [Test]
134          public void Subscribe_Failed_NullCallback()
135          {
136              Assert.ThrowsAsync<ArgumentNullException>(() => _service.SubscribeAsync(null!));
137              Assert.ThrowsAsync<ArgumentNullException>(() => _service.SubscribeAsync(null!, new ResizeOptions()));
138          }
139          [Test]
140          public async Task SubscribeAndUnsubscribe_SingleSubscription()
141          {
142              var customResizeOptions = new ResizeOptions();
143              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
144              {
145                  if (x.ListenerId == default)
146                  {
147                      throw new ArgumentException();
148                  }
149                  SetupJsMockForUnsubscription(x.ListenerId);
150              };
151              SetupJsMockForSubscription(customResizeOptions, true, feedbackCaller);
152              var subscriptionId = await _service.SubscribeAsync((Breakpoint size) => { }, null);
153              var result = await _service.UnsubscribeAsync(subscriptionId.SubscriptionId);
154              result.Should().BeTrue();
<span onclick='openModal()' class='match'>155              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
156              _jsRuntimeMock.Verify();
</span>157          }
158          [Test]
159          public async Task SubscribeAndUnsubscribe_DisposeOfDotNet()
160          {
161              var customResizeOptions = new ResizeOptions();
162              for (int i = 0; i < 4; i++)
163              {
164                  var lastDotnetRefHashCode = 0;
165                  Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
166                  {
167                      if (x.ListenerId == default)
168                      {
169                          throw new ArgumentException();
170                      }
171                      if (x.DotnetRef.GetHashCode() == lastDotnetRefHashCode)
172                      {
173                          throw new ArgumentException();
174                      }
175                      lastDotnetRefHashCode = x.DotnetRef.GetHashCode();
176                      SetupJsMockForUnsubscription(x.ListenerId);
177                  };
178                  SetupJsMockForSubscription(customResizeOptions, true, feedbackCaller);
179                  var subscritionResult = await _service.SubscribeAsync((Breakpoint size) => { }, null);
180                  var result = await _service.UnsubscribeAsync(subscritionResult.SubscriptionId);
181                  result.Should().BeTrue();
182                  _jsRuntimeMock.Verify();
183              }
184          }
185          [Test]
186          public async Task SubscribeAndUnsubscribe_MultipleSubscription()
187          {
188              var customResizeOptions = new ResizeOptions();
189              var feedbackCallerCount = 0;
190              void FeedbackCaller(ListenForResizeCallbackInfo callbackInfo)
191              {
192                  if (callbackInfo.ListenerId == default)
193                  {
194                      throw new ArgumentException();
195                  }
196                  feedbackCallerCount++;
197              }
198              SetupJsMockForSubscription(customResizeOptions, true, FeedbackCaller);
199              var subscriptionIds = new HashSet<Guid>();
200              for (int i = 0; i < 10; i++)
201              {
202                  var subscriptionResult = await _service.SubscribeAsync((Breakpoint size) => { });
203                  subscriptionIds.Add(subscriptionResult.SubscriptionId);
204              }
205              feedbackCallerCount.Should().Be(1);
206              subscriptionIds.Should().HaveCount(10);
207              _jsRuntimeMock.Verify();
208              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
209          }
210          [Test]
211          public async Task SubscribeAndUnsubscribe_MultipleSubscription_WithMultipleOptions()
212          {
213              List<ListenForResizeCallbackInfo> callerFeedbacks = new();
214              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
215              {
216                  if (x.ListenerId == default)
217                  {
218                      throw new ArgumentException();
219                  }
220                  callerFeedbacks.Add(x);
221              };
222              var options = new[]
223              {
224                  new ResizeOptions(),
225                  new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) },
226                  new ResizeOptions { ReportRate = 50 },
227                  new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) },
228              };
229              foreach (var item in options)
230              {
231                  SetupJsMockForSubscription(item, true, feedbackCaller);
232              }
233              var subscriptionIds = options.ToDictionary(x => x, x => new HashSet<Guid>());
234              for (int i = 0; i < 40; i++)
235              {
236                  var index = i % 4;
237                  var option = options[index];
238                  var subscritionResult = await _service.SubscribeAsync((Breakpoint size) => { }, option);
239                  subscriptionIds[option].Add(subscritionResult.SubscriptionId);
240              }
241              foreach (var item in subscriptionIds)
242              {
243                  item.Value.Should().HaveCount(10);
244              }
245              callerFeedbacks.Should().HaveCount(4);
246              for (int i = 0; i < callerFeedbacks.Count; i++)
247              {
248                  var feedback = callerFeedbacks[i];
249                  feedback.Options.Should().Be(options[i]);
250              }
251              callerFeedbacks.Select(x => x.ListenerId).ToHashSet().Should().HaveCount(4);
252              _jsRuntimeMock.Verify();
253              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
254          }
255          [Test]
256          public async Task Unsubscribe_Failed_NoActiveSubscription()
257          {
258              var result = await _service.UnsubscribeAsync(Guid.NewGuid());
259              result.Should().BeFalse();
260          }
261          [Test]
262          public async Task Unsubscribe_Failed_SubscriptionIdNotFound()
263          {
264              var customResizeOptions = new ResizeOptions();
265              SetupJsMockForSubscription(customResizeOptions, true);
266              var subscriptionId = await _service.SubscribeAsync((Breakpoint size) => { }, null);
267              var result = await _service.UnsubscribeAsync(Guid.NewGuid());
268              result.Should().BeFalse();
269          }
270          [Test]
271          public async Task DisposeAsync_Failed_NoActiveSubscription()
272          {
273              await _service.DisposeAsync();
274          }
275          [Test]
276          public async Task DisposeAsync_MultipleSubscription_WithMultipleOptions()
277          {
278              List<Guid> callerIds = new();
279              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) =>
280              {
281                  if (x.ListenerId == default)
282                  {
283                      throw new ArgumentException();
284                  }
285                  callerIds.Add(x.ListenerId);
286              };
287              var options = new[]
288              {
289                  new ResizeOptions(),
290                  new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) },
291                  new ResizeOptions { ReportRate = 50 },
292                  new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) },
293              };
294              foreach (var item in options)
295              {
296                  SetupJsMockForSubscription(item, true, feedbackCaller);
297              }
298              for (int i = 0; i < 40; i++)
299              {
300                  var index = i % 4;
301                  var option = options[index];
302                  await _service.SubscribeAsync((Breakpoint size) => { }, option);
303              }
304              Func<IEnumerable<Guid>, bool> idChecker = (ids) =>
305               {
306                   try
307                   {
308                       ids.Should().BeEquivalentTo(callerIds);
309                       return true;
310                   }
311                   catch (Exception)
312                   {
313                       return false;
314                   }
315               };
316              _jsRuntimeMock.Setup(x => x.InvokeAsync<IJSVoidResult>("mudResizeListenerFactory.cancelListeners",
317               It.Is<object[]>(z =>
318                   z[0] is IEnumerable<Guid> &&
319                   idChecker((IEnumerable<Guid>)z[0]) == true
320               ))).ReturnsAsync(Mock.Of<IJSVoidResult>).Verifiable();
321              await _service.DisposeAsync();
322              _jsRuntimeMock.Verify();
323          }
324          private class FakeSubscriber
325          {
326              public Guid SubscriptionId { get; private set; }
327              public Breakpoint ActualSize { get; private set; } = Breakpoint.None;
328              public async Task Subscribe(BreakpointService service,
329                  ResizeOptions options)
330              {
331                  var result = await service.SubscribeAsync((x) => ActualSize = x, options);
332                  SubscriptionId = result.SubscriptionId;
333              }
334          }
335          [Test]
336          public async Task RaiseOnResized_MultipleSubscription_WithMultipleOptions()
337          {
338              Dictionary<ResizeOptions, Guid> listenerIds = new();
339              Action<ListenForResizeCallbackInfo> feedbackCaller = (x) => listenerIds.Add(x.Options, x.ListenerId);
340              var options = new[]
341              {
342                  (new ResizeOptions(), Breakpoint.Xl ),
343                  (new ResizeOptions { EnableLogging = !(new ResizeOptions().EnableLogging) }, Breakpoint.Sm),
344                  (new ResizeOptions { ReportRate = 50 },Breakpoint.Xs),
345                  (new ResizeOptions { SuppressInitEvent = !(new ResizeOptions().SuppressInitEvent) }, Breakpoint.Lg)
346              };
347              Dictionary<FakeSubscriber, Breakpoint> subscribers = new();
348              foreach (var item in options)
349              {
350                  SetupJsMockForSubscription(item.Item1, true, feedbackCaller);
351              }
352              for (int i = 0; i < 40; i++)
353              {
354                  var index = i % 4;
355                  var option = options[index];
356                  var subscriber = new FakeSubscriber();
357                  await subscriber.Subscribe(_service, option.Item1);
358                  subscribers.Add(subscriber, option.Item2);
359              }
360              foreach (var item in options)
361              {
362                  var listenerId = listenerIds[item.Item1];
363                  _service.RaiseOnResized(new BrowserWindowSize { }, item.Item2, listenerId);
364              }
365              foreach (var item in subscribers)
366              {
367                  item.Key.ActualSize.Should().Be(item.Value);
368              }
369              _jsRuntimeMock.Verify();
370              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
371          }
372          [Test]
373          public async Task RaiseOnResized_InvalidListenerId()
374          {
375              var customResizeOptions = new ResizeOptions();
376              SetupJsMockForSubscription(customResizeOptions, true);
377              var subscriber = new FakeSubscriber();
378              await subscriber.Subscribe(_service, customResizeOptions);
379              _service.RaiseOnResized(new BrowserWindowSize { }, Breakpoint.Xl, Guid.NewGuid());
380              subscriber.ActualSize.Should().Be(Breakpoint.None);
381          }
382          [Test]
383          public async Task Subscribe_ChangeHappens_SecondSubscriptionGetNewValue()
384          {
385              var customResizeOptions = new ResizeOptions();
386              SetupJsMockForSubscription(customResizeOptions, true);
387              var firstSubscribeResult = await _service.SubscribeAsync((Breakpoint size) => { }, customResizeOptions);
388              firstSubscribeResult.Breakpoint.Should().Be(Breakpoint.Md);
389              _service.RaiseOnResized(new BrowserWindowSize { }, Breakpoint.Xl, Guid.NewGuid());
390              var secondSubscribeResult = await _service.SubscribeAsync((Breakpoint size) => { }, customResizeOptions);
391              secondSubscribeResult.Breakpoint.Should().Be(Breakpoint.Xl);
392              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
393              _jsRuntimeMock.Verify();
394          }
395          [Test]
396          [TestCase(true)]
397          [TestCase(false)]
398          public async Task MatchMedia(bool interopResult)
399          {
400              var input = "some input, not relevant for test";
401              _jsRuntimeMock.Setup(x => x.InvokeAsync<bool>("mudResizeListener.matchMedia",
402              It.Is<object[]>(z =>
403                  z[0] is string &&
404                  (string)z[0] == input
405              ))).ReturnsAsync(interopResult).Verifiable();
406              var result = await _service.MatchMedia(input);
407              result.Should().Be(interopResult);
408          }
409          [Test]
410          public void DefaultBreakpointDefinitions()
411          {
412              BreakpointGlobalOptions.DefaultBreakpointDefinitions.Keys.Should().BeEquivalentTo(new[] {
413                  Breakpoint.Xxl, Breakpoint.Xl, Breakpoint.Lg, Breakpoint.Md, Breakpoint.Sm, Breakpoint.Xs });
414              BreakpointGlobalOptions.DefaultBreakpointDefinitions.Values.Should().BeEquivalentTo(new[] {
415                  2560, 1920, 1280, 960, 600, 0 });
416          }
417          [TestCase(Breakpoint.Xs, 0, true)]
418          [TestCase(Breakpoint.Xs, 599, true)]
419          [TestCase(Breakpoint.Xs, 600, false)]
420          [TestCase(Breakpoint.Sm, 599, false)]
421          [TestCase(Breakpoint.Sm, 600, true)]
422          [TestCase(Breakpoint.Sm, 959, true)]
423          [TestCase(Breakpoint.Sm, 960, false)]
424          [TestCase(Breakpoint.Md, 959, false)]
425          [TestCase(Breakpoint.Md, 960, true)]
426          [TestCase(Breakpoint.Md, 1279, true)]
427          [TestCase(Breakpoint.Md, 1280, false)]
428          [TestCase(Breakpoint.Lg, 1279, false)]
429          [TestCase(Breakpoint.Lg, 1280, true)]
430          [TestCase(Breakpoint.Lg, 1919, true)]
431          [TestCase(Breakpoint.Lg, 1920, false)]
432          [TestCase(Breakpoint.Xl, 1919, false)]
433          [TestCase(Breakpoint.Xl, 1920, true)]
434          [TestCase(Breakpoint.Xl, 9999, true)]
435          [TestCase(Breakpoint.SmAndUp, 599, false)]
436          [TestCase(Breakpoint.SmAndUp, 600, true)]
437          [TestCase(Breakpoint.SmAndUp, 9999, true)]
438          [TestCase(Breakpoint.MdAndUp, 959, false)]
439          [TestCase(Breakpoint.MdAndUp, 960, true)]
440          [TestCase(Breakpoint.MdAndUp, 9999, true)]
441          [TestCase(Breakpoint.LgAndUp, 1279, false)]
442          [TestCase(Breakpoint.LgAndUp, 1280, true)]
443          [TestCase(Breakpoint.LgAndUp, 9999, true)]
444          [TestCase(Breakpoint.SmAndDown, 960, false)]
445          [TestCase(Breakpoint.SmAndDown, 959, true)]
446          [TestCase(Breakpoint.SmAndDown, 0, true)]
447          [TestCase(Breakpoint.MdAndDown, 1280, false)]
448          [TestCase(Breakpoint.MdAndDown, 1279, true)]
449          [TestCase(Breakpoint.MdAndDown, 0, true)]
450          [TestCase(Breakpoint.LgAndDown, 1920, false)]
451          [TestCase(Breakpoint.LgAndDown, 1919, true)]
452          [TestCase(Breakpoint.LgAndDown, 0, true)]
453          public async Task IsMediaSizeReturnsCorrectValue(Breakpoint breakpoint, int browserWidth, bool expectedValue)
454          {
455              _browserWindowSizeProvider
456                  .Setup(p => p.GetBrowserWindowSize())
457                  .ReturnsAsync(new BrowserWindowSize { Width = browserWidth })
458                  .Verifiable();
459              var actual = await _service.IsMediaSize(breakpoint);
460              actual.Should().Be(expectedValue);
461              _browserWindowSizeProvider.Verify();
462          }
463          [Test]
464          public async Task IsMediaSize_ReturnFalseForNoneBreakpoint()
465          {
466              var actual = await _service.IsMediaSize(Breakpoint.None);
467              actual.Should().BeFalse();
468          }
469          [Test]
470          public async Task IsMediaSize_ReturnTrueForAlwaysBreakpoint()
471          {
472              var actual = await _service.IsMediaSize(Breakpoint.Always);
473              actual.Should().BeTrue();
474          }
475      }
476  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-ResizeBasedServiceTests.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-BreakpointServiceTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>39              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
40          }
</pre></code></div>
                <div class="column column_space"><pre><code>155              _browserWindowSizeProvider.Verify(x => x.GetBrowserWindowSize(), Times.Once());
156              _jsRuntimeMock.Verify();
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    