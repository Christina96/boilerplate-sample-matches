
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 8.596713021491782%, Tokens: 17, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-DictionaryQueryRunnerTest.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Linq;
4  using System.Text;
5  namespace Simple.Data.UnitTest
6  {
7      using NUnit.Framework;
8      using QueryPolyfills;
9      [TestFixture]
10      public class DictionaryQueryRunnerTest
11      {
12          [Test]
13          public void DistinctShouldRemoveDuplicateRows()
14          {
15              var runner = new DictionaryQueryRunner("FooTable", DuplicatingSource(), new DistinctClause());
16              var actual = runner.Run().ToList();
17              Assert.AreEqual(2, actual.Count);
18              Assert.AreEqual(1, actual.Count(d => d.ContainsKey("Foo") && (string)d["Foo"] == "bar"));
19              Assert.AreEqual(1, actual.Count(d => d.ContainsKey("Quux") && (string)d["Quux"] == "baz"));
20          }
21          [Test]
22          public void ShouldNotRemoveDistinctRows()
23          {
24              var runner = new DictionaryQueryRunner("FooTable", NonDuplicatingSource(), new DistinctClause());
25              var actual = runner.Run().ToList();
26              Assert.AreEqual(2, actual.Count);
27              Assert.AreEqual(1, actual.Count(d => d.ContainsKey("Foo") && (string)d["Foo"] == "bar"));
28              Assert.AreEqual(1, actual.Count(d => d.ContainsKey("Quux") && (string)d["Quux"] == "baz"));
29          }
30          [Test]
31          public void SkipShouldSkip()
32          {
33              var runner = new DictionaryQueryRunner("FooTable", SkipTakeSource(), new SkipClause(1));
34              var actual = runner.Run().ToList();
35              Assert.AreEqual(2, actual.Count);
36              Assert.AreEqual(1, actual[0]["Row"]);
37              Assert.AreEqual(2, actual[1]["Row"]);
38          }
39          [Test]
40          public void TakeShouldTake()
41          {
42              var runner = new DictionaryQueryRunner("FooTable", SkipTakeSource(), new TakeClause(2));
43              var actual = runner.Run().ToList();
44              Assert.AreEqual(2, actual.Count);
45              Assert.AreEqual(0, actual[0]["Row"]);
46              Assert.AreEqual(1, actual[1]["Row"]);
47          }
48          [Test]
49          public void SkipAndTakeShouldSkipAndTake()
50          {
51              var runner = new DictionaryQueryRunner("FooTable", SkipTakeSource(), new SkipClause(1), new TakeClause(1));
52              var actual = runner.Run().ToList();
53              Assert.AreEqual(1, actual.Count);
54              Assert.AreEqual(1, actual[0]["Row"]);
55          }
56          [Test]
57          public void SkipAndTakeWithCountShouldSkipAndTakeAndGiveCount()
58          {
59              int count = 0;
60              var runner = new DictionaryQueryRunner("FooTable", SkipTakeSource(), new WithCountClause(n => count = n), new SkipClause(1), new TakeClause(1));
61              var actual = runner.Run().ToList();
62              Assert.AreEqual(3, count);
63              Assert.AreEqual(1, actual.Count);
64              Assert.AreEqual(1, actual[0]["Row"]);
65          }
66          [Test]
67          public void SelectShouldRestrictColumnList()
68          {
69              var tableRef = new ObjectReference("FooTable");
70              var selectClause = new SelectClause(new SimpleReference[] { new ObjectReference("Id", tableRef), new ObjectReference("Name", tableRef) });
71              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), selectClause);
<span onclick='openModal()' class='match'>72              var actual = runner.Run().ToList();
73              Assert.AreEqual(4, actual.Count);
74              Assert.AreEqual(2, actual[0].Count);
75              Assert.AreEqual(1, actual[0]["Id"]);
76              Assert.AreEqual("Alice", actual[0]["Name"]);
77              Assert.AreEqual(2, actual[1].Count);
78              Assert.AreEqual(2, actual[1]["Id"]);
79              Assert.AreEqual("Bob", actual[1]["Name"]);
80              Assert.AreEqual(2, actual[2].Count);
81              Assert.AreEqual(3, actual[2]["Id"]);
82              Assert.AreEqual("Charlie", actual[2]["Name"]);
83              Assert.AreEqual(2, actual[3].Count);
84              Assert.AreEqual(4, actual[3]["Id"]);
85              Assert.AreEqual("David", actual[3]["Name"]);
86          }
87          [Test]
</span>88          public void SelectLengthShouldUseLengthFunction()
89          {
90              var tableRef = new ObjectReference("FooTable");
91              var function = new FunctionReference("Length", new ObjectReference("Name", tableRef)).As("NameLength");
92              var selectClause = new SelectClause(new SimpleReference[] { new ObjectReference("Name", tableRef), function });
93              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), selectClause);
94              var actual = runner.Run().ToList();
95              Assert.AreEqual(4, actual.Count);
96              Assert.AreEqual(2, actual[0].Count);
97              Assert.AreEqual("Alice", actual[0]["Name"]);
98              Assert.AreEqual(5, actual[0]["NameLength"]);
99              Assert.AreEqual(2, actual[1].Count);
100              Assert.AreEqual("Bob", actual[1]["Name"]);
101              Assert.AreEqual(3, actual[1]["NameLength"]);
102              Assert.AreEqual(2, actual[2].Count);
103              Assert.AreEqual("Charlie", actual[2]["Name"]);
104              Assert.AreEqual(7, actual[2]["NameLength"]);
105              Assert.AreEqual(2, actual[3].Count);
106              Assert.AreEqual("David", actual[3]["Name"]);
107              Assert.AreEqual(5, actual[3]["NameLength"]);
108          }
109          [Test]
110          public void BasicWhereEqualShouldWork()
111          {
112              var tableRef = new ObjectReference("FooTable");
113              var whereClause = new WhereClause(new ObjectReference("Name", tableRef) == "Alice");
114              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), whereClause);
115              var actual = runner.Run().ToList();
116              Assert.AreEqual(1, actual.Count);
117              Assert.AreEqual("Alice", actual[0]["Name"]);
118          }
119          [Test]
120          public void WhereNullShouldWorkWhenValueExistsAndIsNull()
121          {
122              var tableRef = new ObjectReference("FooTable");
123              var whereClause = new WhereClause(new ObjectReference("Value", tableRef) == null);
124              var data = new List<IDictionary<string, object>>
125                             {
126                                 new Dictionary<string, object>
127                                     {
128                                         {"Name", "Steve"}, { "Value", null }
129                                     },
130                                 new Dictionary<string, object>
131                                     {
132                                         {"Name", "Dave"}, { "Value", 42 }
133                                     },
134                             };
135              var runner = new DictionaryQueryRunner("FooTable", data, whereClause);
136              var actual = runner.Run().ToList();
137              Assert.AreEqual(1, actual.Count);
138              Assert.AreEqual("Steve", actual[0]["Name"]);
139          }
140          [Test]
141          public void WhereNullShouldWorkWhenValueDoesNotExist()
142          {
143              var tableRef = new ObjectReference("FooTable");
144              var whereClause = new WhereClause(new ObjectReference("Value", tableRef) == null);
145              var data = new List<IDictionary<string, object>>
146                             {
147                                 new Dictionary<string, object>
148                                     {
149                                         {"Name", "Steve"}
150                                     },
151                                 new Dictionary<string, object>
152                                     {
153                                         {"Name", "Dave"}, { "Value", 42 }
154                                     },
155                             };
156              var runner = new DictionaryQueryRunner("FooTable", data, whereClause);
157              var actual = runner.Run().ToList();
158              Assert.AreEqual(1, actual.Count);
159              Assert.AreEqual("Steve", actual[0]["Name"]);
160          }
161          [Test]
162          public void WhereEqualWithByteArrayShouldWork()
163          {
164              var tableRef = new ObjectReference("FooTable");
165              var whereClause = new WhereClause(new ObjectReference("Array", tableRef) == new byte[] { 1, 2, 3, 4});
166              var data = new List<IDictionary<string, object>>
167                             {
168                                 new Dictionary<string, object>
169                                     {
170                                         {"Name", "Steve"}, { "Array", new byte[] { 1, 2, 3, 4}}
171                                     },
172                                 new Dictionary<string, object>
173                                     {
174                                         {"Name", "Dave"}, { "Array", new byte[] { 2, 3, 4}}
175                                     },
176                             };
177              var runner = new DictionaryQueryRunner("FooTable", data, whereClause);
178              var actual = runner.Run().ToList();
179              Assert.AreEqual(1, actual.Count);
180              Assert.AreEqual("Steve", actual[0]["Name"]);
181          }
182          [Test]
183          public void BasicWhereNotEqualShouldWork()
184          {
185              var tableRef = new ObjectReference("FooTable");
186              var whereClause = new WhereClause(new ObjectReference("Name", tableRef) != "Alice");
187              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), whereClause);
188              var actual = runner.Run().ToList();
189              Assert.AreEqual(3, actual.Count);
190              Assert.False(actual.Any(a => (string)a["Name"] == "Alice"));
191          }
192          [Test]
193          public void WhereNotNullShouldWork()
194          {
195              var tableRef = new ObjectReference("FooTable");
196              var whereClause = new WhereClause(new ObjectReference("Value", tableRef) != null);
197              var data = new List<IDictionary<string, object>>
198                             {
199                                 new Dictionary<string, object>
200                                     {
201                                         {"Name", "Steve"}, { "Value", null }
202                                     },
203                                 new Dictionary<string, object>
204                                     {
205                                         {"Name", "Dave"}, { "Value", 42 }
206                                     },
207                             };
208              var runner = new DictionaryQueryRunner("FooTable", data, whereClause);
209              var actual = runner.Run().ToList();
210              Assert.AreEqual(1, actual.Count);
211              Assert.AreEqual("Dave", actual[0]["Name"]);
212          }
213          [Test]
214          public void WhereNotEqualWithByteArrayShouldWork()
215          {
216              var tableRef = new ObjectReference("FooTable");
217              var whereClause = new WhereClause(new ObjectReference("Array", tableRef) != new byte[] { 1, 2, 3, 4 });
218              var data = new List<IDictionary<string, object>>
219                             {
220                                 new Dictionary<string, object>
221                                     {
222                                         {"Name", "Steve"}, { "Array", new byte[] { 1, 2, 3, 4}}
223                                     },
224                                 new Dictionary<string, object>
225                                     {
226                                         {"Name", "Dave"}, { "Array", new byte[] { 2, 3, 4}}
227                                     },
228                             };
229              var runner = new DictionaryQueryRunner("FooTable", data, whereClause);
230              var actual = runner.Run().ToList();
231              Assert.AreEqual(1, actual.Count);
232              Assert.AreEqual("Dave", actual[0]["Name"]);
233          }
234          [Test]
235          public void BasicWhereGreaterThanShouldWork()
236          {
237              var tableRef = new ObjectReference("FooTable");
238              var whereClause = new WhereClause(new ObjectReference("Weight", tableRef) > 200M);
239              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), whereClause);
240              var actual = runner.Run().ToList();
241              Assert.AreEqual(1, actual.Count);
242              Assert.AreEqual("David", actual[0]["Name"]);
243          }
244          [Test]
245          public void BasicWhereLessThanShouldWork()
246          {
247              var tableRef = new ObjectReference("FooTable");
248              var whereClause = new WhereClause(new ObjectReference("Weight", tableRef) < 150M);
249              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), whereClause);
250              var actual = runner.Run().ToList();
251              Assert.AreEqual(1, actual.Count);
252              Assert.AreEqual("Alice", actual[0]["Name"]);
253          }
254          [Test]
255          public void BasicWhereGreaterThanOrEqualShouldWork()
256          {
257              var tableRef = new ObjectReference("FooTable");
258              var whereClause = new WhereClause(new ObjectReference("Weight", tableRef) >= 250M);
259              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), whereClause);
260              var actual = runner.Run().ToList();
261              Assert.AreEqual(1, actual.Count);
262              Assert.AreEqual("David", actual[0]["Name"]);
263          }
264          [Test]
265          public void BasicWhereLessThanOrEqualShouldWork()
266          {
267              var tableRef = new ObjectReference("FooTable");
268              var whereClause = new WhereClause(new ObjectReference("Weight", tableRef) <= 100M);
269              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), whereClause);
270              var actual = runner.Run().ToList();
271              Assert.AreEqual(1, actual.Count);
272              Assert.AreEqual("Alice", actual[0]["Name"]);
273          }
274          [Test]
275          public void BasicLikeShouldWork()
276          {
277              var tableRef = new ObjectReference("FooTable");
278              dynamic objRef = new ObjectReference("Name", tableRef);
279              var expression = new SimpleExpression(objRef, new SimpleFunction("like", new[] {"A%"}), SimpleExpressionType.Function);
280              var whereClause = new WhereClause(expression);
281              var runner = new DictionaryQueryRunner("FooTable", SelectSource(), whereClause);
282              var actual = runner.Run().ToList();
283              Assert.AreEqual(1, actual.Count);
284              Assert.AreEqual("Alice", actual[0]["Name"]);
285          }
286          #region Distinct sources
287          private static IEnumerable<IDictionary<string, object>> DuplicatingSource()
288          {
289              yield return new Dictionary<string, object>
290                               {
291                                   { "Foo", "bar" },
292                               };
293              yield return new Dictionary<string, object>
294                               {
295                                   { "Quux", "baz" },
296                               };
297              yield return new Dictionary<string, object>
298                               {
299                                   { "Quux", "baz" },
300                               };
301          }
302          private static IEnumerable<IDictionary<string, object>> NonDuplicatingSource()
303          {
304              yield return new Dictionary<string, object>
305                               {
306                                   { "Foo", "bar" },
307                               };
308              yield return new Dictionary<string, object>
309                               {
310                                   { "Quux", "baz" },
311                               };
312          }
313          #endregion
314          #region Skip/Take/WithCount sources
315          private static IEnumerable<IDictionary<string, object>> SkipTakeSource()
316          {
317              yield return new Dictionary<string, object>
318                               {
319                                   { "Row", 0 },
320                               };
321              yield return new Dictionary<string, object>
322                               {
323                                   { "Row", 1 },
324                               };
325              yield return new Dictionary<string, object>
326                               {
327                                   { "Row", 2 }
328                               };
329          }
330          #endregion
331          private static IEnumerable<IDictionary<string,object>> SelectSource()
332          {
333              yield return new Dictionary<string, object>
334                               {
335                                  {"Id", 1}, { "Type", "A"}, {"Name","Alice"}, {"Weight", 100M}
336                               };
337              yield return new Dictionary<string, object>
338                               {
339                                  {"Id", 2}, { "Type", "A"}, {"Name","Bob"}, {"Weight", 150M}
340                               };
341              yield return new Dictionary<string, object>
342                               {
343                                  {"Id", 3}, { "Type", "B"}, {"Name","Charlie"}, {"Weight", 200M}
344                               };
345              yield return new Dictionary<string, object>
346                               {
347                                  {"Id", 4}, { "Type", "B"}, {"Name","David"}, {"Weight", 250M}
348                               };
349          }
350      }
351  }
</code></pre>
        </div>
        <div class="column">
            <h3>NetCoreServer-MDEwOlJlcG9zaXRvcnkxNjYxMjMxNjQ=-flat-SslTests.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Net;
4  using System.Net.Sockets;
5  using System.Security.Authentication;
6  using System.Security.Cryptography.X509Certificates;
7  using System.Threading;
8  using NetCoreServer;
9  using Xunit;
10  namespace tests
11  {
12      class EchoSslClient : SslClient
13      {
14          public bool Connected { get; set; }
15          public bool Handshaked { get; set; }
16          public bool Disconnected { get; set; }
17          public bool Errors { get; set; }
18          public EchoSslClient(SslContext context, string address, int port) : base(context, address, port) {}
19          public static SslContext CreateContext()
20          {
21              return new SslContext(SslProtocols.Tls13, new X509Certificate2("client.pfx", "qwerty"), (sender, certificate, chain, sslPolicyErrors) => true);
22          }
23          protected override void OnConnected() { Connected = true; }
24          protected override void OnHandshaked() { Handshaked = true; }
25          protected override void OnDisconnected() { Disconnected = true; }
26          protected override void OnError(SocketError error) { Errors = true; }
27      }
28      class EchoSslSession : SslSession
29      {
30          public bool Connected { get; set; }
31          public bool Handshaked { get; set; }
32          public bool Disconnected { get; set; }
33          public bool Errors { get; set; }
34          public EchoSslSession(SslServer server) : base(server) {}
35          protected override void OnConnected() { Connected = true; }
36          protected override void OnHandshaked() { Handshaked = true; }
37          protected override void OnDisconnected() { Disconnected = true; }
38          protected override void OnReceived(byte[] buffer, long offset, long size) { SendAsync(buffer, offset, size); }
39          protected override void OnError(SocketError error) { Errors = true; }
40      }
41      class EchoSslServer : SslServer
42      {
43          public bool Started { get; set; }
44          public bool Stopped { get; set; }
45          public bool Connected { get; set; }
46          public bool Handshaked { get; set; }
47          public bool Disconnected { get; set; }
48          public int Clients { get; set; }
49          public bool Errors { get; set; }
50          public EchoSslServer(SslContext context, IPAddress address, int port) : base(context, address, port) {}
51          public static SslContext CreateContext()
52          {
53              return new SslContext(SslProtocols.Tls13, new X509Certificate2("server.pfx", "qwerty"));
54          }
55          protected override SslSession CreateSession() { return new EchoSslSession(this); }
56          protected override void OnStarted() { Started = true; }
57          protected override void OnStopped() { Stopped = true; }
58          protected override void OnConnected(SslSession session) { Connected = true; }
59          protected override void OnHandshaked(SslSession session) { Handshaked = true; Clients++; }
60          protected override void OnDisconnected(SslSession session) { Disconnected = true; Clients--; }
61          protected override void OnError(SocketError error) { Errors = true; }
62      }
63      public class SslTests
64      {
65          [Fact(DisplayName = "SSL server test")]
66          public void SslServerTest()
67          {
68              string address = "127.0.0.1";
69              int port = 2222;
70              var serverContext = EchoSslServer.CreateContext();
71              var server = new EchoSslServer(serverContext, IPAddress.Any, port);
72              Assert.True(server.Start());
73              while (!server.IsStarted)
74                  Thread.Yield();
75              var clientContext = EchoSslClient.CreateContext();
76              var client = new EchoSslClient(clientContext, address, port);
77              Assert.True(client.ConnectAsync());
78              while (!client.IsConnected || !client.IsHandshaked || (server.Clients != 1))
79                  Thread.Yield();
80              client.SendAsync("test");
81              while (client.BytesReceived != 4)
82                  Thread.Yield();
83              Assert.True(client.DisconnectAsync());
84              while (client.IsConnected || client.IsHandshaked || (server.Clients != 0))
85                  Thread.Yield();
86              Assert.True(server.Stop());
87              while (server.IsStarted)
<span onclick='openModal()' class='match'>88                  Thread.Yield();
89              Assert.True(server.Started);
90              Assert.True(server.Stopped);
91              Assert.True(server.Connected);
92              Assert.True(server.Handshaked);
93              Assert.True(server.Disconnected);
94              Assert.True(server.BytesSent == 4);
95              Assert.True(server.BytesReceived == 4);
96              Assert.True(!server.Errors);
97              Assert.True(client.Connected);
98              Assert.True(client.Handshaked);
99              Assert.True(client.Disconnected);
100              Assert.True(client.BytesSent == 4);
101              Assert.True(client.BytesReceived == 4);
102              Assert.True(!client.Errors);
103          }
104          [Fact(DisplayName = "SSL server multicast test")]
</span>105          public void SslServerMulticastTest()
106          {
107              string address = "127.0.0.1";
108              int port = 2223;
109              var serverContext = EchoSslServer.CreateContext();
110              var server = new EchoSslServer(serverContext, IPAddress.Any, port);
111              Assert.True(server.Start());
112              while (!server.IsStarted)
113                  Thread.Yield();
114              var clientContext = EchoSslClient.CreateContext();
115              var client1 = new EchoSslClient(clientContext, address, port);
116              Assert.True(client1.ConnectAsync());
117              while (!client1.IsConnected || !client1.IsHandshaked || (server.Clients != 1))
118                  Thread.Yield();
119              server.Multicast("test");
120              while (client1.BytesReceived != 4)
121                  Thread.Yield();
122              var client2 = new EchoSslClient(clientContext, address, port);
123              Assert.True(client2.ConnectAsync());
124              while (!client2.IsConnected || !client2.IsHandshaked || (server.Clients != 2))
125                  Thread.Yield();
126              server.Multicast("test");
127              while ((client1.BytesReceived != 8) || (client2.BytesReceived != 4))
128                  Thread.Yield();
129              var client3 = new EchoSslClient(clientContext, address, port);
130              Assert.True(client3.ConnectAsync());
131              while (!client3.IsConnected || !client3.IsHandshaked || (server.Clients != 3))
132                  Thread.Yield();
133              server.Multicast("test");
134              while ((client1.BytesReceived != 12) || (client2.BytesReceived != 8) || (client3.BytesReceived != 4))
135                  Thread.Yield();
136              Assert.True(client1.DisconnectAsync());
137              while (client1.IsConnected || client1.IsHandshaked || (server.Clients != 2))
138                  Thread.Yield();
139              server.Multicast("test");
140              while ((client1.BytesReceived != 12) || (client2.BytesReceived != 12) || (client3.BytesReceived != 8))
141                  Thread.Yield();
142              Assert.True(client2.DisconnectAsync());
143              while (client2.IsConnected || client2.IsHandshaked || (server.Clients != 1))
144                  Thread.Yield();
145              server.Multicast("test");
146              while ((client1.BytesReceived != 12) || (client2.BytesReceived != 12) || (client3.BytesReceived != 12))
147                  Thread.Yield();
148              Assert.True(client3.DisconnectAsync());
149              while (client3.IsConnected || client3.IsHandshaked || (server.Clients != 0))
150                  Thread.Yield();
151              Assert.True(server.Stop());
152              while (server.IsStarted)
153                  Thread.Yield();
154              Assert.True(server.Started);
155              Assert.True(server.Stopped);
156              Assert.True(server.Connected);
157              Assert.True(server.Handshaked);
158              Assert.True(server.Disconnected);
159              Assert.True(server.BytesSent > 0);
160              Assert.True(server.BytesReceived == 0);
161              Assert.True(!server.Errors);
162              Assert.True(client1.BytesSent == 0);
163              Assert.True(client2.BytesSent == 0);
164              Assert.True(client3.BytesSent == 0);
165              Assert.True(client1.BytesReceived == 12);
166              Assert.True(client2.BytesReceived == 12);
167              Assert.True(client3.BytesReceived == 12);
168              Assert.True(!client1.Errors);
169              Assert.True(!client2.Errors);
170              Assert.True(!client3.Errors);
171          }
172          [Fact(DisplayName = "SSL server random test")]
173          public void SslServerRandomTest()
174          {
175              string address = "127.0.0.1";
176              int port = 2224;
177              var serverContext = EchoSslServer.CreateContext();
178              var server = new EchoSslServer(serverContext, IPAddress.Any, port);
179              Assert.True(server.Start());
180              while (!server.IsStarted)
181                  Thread.Yield();
182              int duration = 10;
183              var clientContext = EchoSslClient.CreateContext();
184              var clients = new List<EchoSslClient>();
185              var rand = new Random();
186              var start = DateTime.UtcNow;
187              while ((DateTime.UtcNow - start).TotalSeconds < duration)
188              {
189                  if ((rand.Next() % 1000) == 0)
190                  {
191                      server.DisconnectAll();
192                  }
193                  else if ((rand.Next() % 100) == 0)
194                  {
195                      if (clients.Count < 100)
196                      {
197                          var client = new EchoSslClient(clientContext, address, port);
198                          clients.Add(client);
199                          client.ConnectAsync();
200                          while (!client.IsHandshaked)
201                              Thread.Yield();
202                      }
203                  }
204                  else if ((rand.Next() % 100) == 0)
205                  {
206                      if (clients.Count > 0)
207                      {
208                          int index = rand.Next() % clients.Count;
209                          var client = clients[index];
210                          if (client.IsHandshaked)
211                          {
212                              client.DisconnectAsync();
213                              while (client.IsConnected)
214                                  Thread.Yield();
215                          }
216                          else if (!client.IsConnected)
217                          {
218                              client.ConnectAsync();
219                              while (!client.IsHandshaked)
220                                  Thread.Yield();
221                          }
222                      }
223                  }
224                  else if ((rand.Next() % 100) == 0)
225                  {
226                      if (clients.Count > 0)
227                      {
228                          int index = rand.Next() % clients.Count;
229                          var client = clients[index];
230                          if (client.IsHandshaked)
231                          {
232                              client.ReconnectAsync();
233                              while (!client.IsHandshaked)
234                                  Thread.Yield();
235                          }
236                      }
237                  }
238                  else if ((rand.Next() % 10) == 0)
239                  {
240                      server.Multicast("test");
241                  }
242                  else if ((rand.Next() % 1) == 0)
243                  {
244                      if (clients.Count > 0)
245                      {
246                          int index = rand.Next() % clients.Count;
247                          var client = clients[index];
248                          if (client.IsHandshaked)
249                              client.SendAsync("test");
250                      }
251                  }
252                  Thread.Sleep(1);
253              }
254              foreach (var client in clients)
255              {
256                  client.DisconnectAsync();
257                  while (client.IsConnected)
258                      Thread.Yield();
259              }
260              Assert.True(server.Stop());
261              while (server.IsStarted)
262                  Thread.Yield();
263              Assert.True(server.Started);
264              Assert.True(server.Stopped);
265              Assert.True(server.Connected);
266              Assert.True(server.Handshaked);
267              Assert.True(server.Disconnected);
268              Assert.True(server.BytesSent > 0);
269              Assert.True(server.BytesReceived > 0);
270              Assert.True(!server.Errors);
271          }
272      }
273  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Simple.Data-MDEwOlJlcG9zaXRvcnk4MTg3Njg=-flat-DictionaryQueryRunnerTest.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from NetCoreServer-MDEwOlJlcG9zaXRvcnkxNjYxMjMxNjQ=-flat-SslTests.cs</div>
                </div>
                <div class="column column_space"><pre><code>72              var actual = runner.Run().ToList();
73              Assert.AreEqual(4, actual.Count);
74              Assert.AreEqual(2, actual[0].Count);
75              Assert.AreEqual(1, actual[0]["Id"]);
76              Assert.AreEqual("Alice", actual[0]["Name"]);
77              Assert.AreEqual(2, actual[1].Count);
78              Assert.AreEqual(2, actual[1]["Id"]);
79              Assert.AreEqual("Bob", actual[1]["Name"]);
80              Assert.AreEqual(2, actual[2].Count);
81              Assert.AreEqual(3, actual[2]["Id"]);
82              Assert.AreEqual("Charlie", actual[2]["Name"]);
83              Assert.AreEqual(2, actual[3].Count);
84              Assert.AreEqual(4, actual[3]["Id"]);
85              Assert.AreEqual("David", actual[3]["Name"]);
86          }
87          [Test]
</pre></code></div>
                <div class="column column_space"><pre><code>88                  Thread.Yield();
89              Assert.True(server.Started);
90              Assert.True(server.Stopped);
91              Assert.True(server.Connected);
92              Assert.True(server.Handshaked);
93              Assert.True(server.Disconnected);
94              Assert.True(server.BytesSent == 4);
95              Assert.True(server.BytesReceived == 4);
96              Assert.True(!server.Errors);
97              Assert.True(client.Connected);
98              Assert.True(client.Handshaked);
99              Assert.True(client.Disconnected);
100              Assert.True(client.BytesSent == 4);
101              Assert.True(client.BytesReceived == 4);
102              Assert.True(!client.Errors);
103          }
104          [Fact(DisplayName = "SSL server multicast test")]
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    