
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 5.641025641025641%, Tokens: 11, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-IForm.cs</h3>
            <pre><code>1  namespace MudBlazor.Interfaces
2  {
3      public interface IForm
4      {
5          public bool IsValid { get; }
<span onclick='openModal()' class='match'>6          public string[] Errors { get; }
7  #nullable enable
8          public object? Model { get; set; }
9          public void FieldChanged(IFormComponent formControl, object? newValue);
</span>10  #nullable disable
11          internal void Add(IFormComponent formControl);
12          internal void Remove(IFormComponent formControl);
13          internal void Update(IFormComponent formControl);
14      }
15  }
</code></pre>
        </div>
        <div class="column">
            <h3>ZXing.Net.Mobile-MDEwOlJlcG9zaXRvcnk2MTYwNjcz-flat-CameraController.android.cs</h3>
            <pre><code>1  using System;
2  using System.Collections.Generic;
3  using System.Linq;
4  using Android.Content;
5  using Android.Graphics;
6  using Android.Hardware;
7  using Android.OS;
8  using Android.Runtime;
9  using Android.Views;
10  using ApxLabs.FastAndroidCamera;
11  using Camera = Android.Hardware.Camera;
12  namespace ZXing.Mobile.CameraAccess
13  {
14  	public class CameraController
15  	{
16  		readonly Context context;
17  		readonly ISurfaceHolder holder;
18  		readonly SurfaceView surfaceView;
19  		readonly CameraEventsListener cameraEventListener;
20  		int cameraId;
21  		IScannerSessionHost scannerHost;
22  		public CameraController(SurfaceView surfaceView, CameraEventsListener cameraEventListener, IScannerSessionHost scannerHost)
23  		{
24  			context = surfaceView.Context;
25  			holder = surfaceView.Holder;
26  			this.surfaceView = surfaceView;
27  			this.cameraEventListener = cameraEventListener;
28  			this.scannerHost = scannerHost;
29  		}
30  		public Camera Camera { get; private set; }
<span onclick='openModal()' class='match'>31  		public CameraResolution CameraResolution { get; private set; }
32  		public int LastCameraDisplayOrientationDegree { get; private set; }
33  		public void RefreshCamera()
34  		{
</span>35  			if (holder == null) return;
36  			ApplyCameraSettings();
37  			try
38  			{
39  				Camera.SetPreviewDisplay(holder);
40  				Camera.StartPreview();
41  			}
42  			catch (Exception ex)
43  			{
44  				Android.Util.Log.Debug(MobileBarcodeScanner.TAG, ex.ToString());
45  			}
46  		}
47  		public void SetupCamera()
48  		{
49  			if (Camera != null)
50  				return;
51  			var perf = PerformanceCounter.Start();
52  			OpenCamera();
53  			PerformanceCounter.Stop(perf, "Setup Camera took {0}ms");
54  			if (Camera == null) return;
55  			perf = PerformanceCounter.Start();
56  			ApplyCameraSettings();
57  			try
58  			{
59  				Camera.SetPreviewDisplay(holder);
60  				var previewParameters = Camera.GetParameters();
61  				var previewSize = previewParameters.PreviewSize;
62  				var bitsPerPixel = ImageFormat.GetBitsPerPixel(previewParameters.PreviewFormat);
63  				var bufferSize = (previewSize.Width * previewSize.Height * bitsPerPixel) / 8;
64  				const int NUM_PREVIEW_BUFFERS = 5;
65  				for (uint i = 0; i < NUM_PREVIEW_BUFFERS; ++i)
66  				{
67  					using (var buffer = new FastJavaByteArray(bufferSize))
68  						Camera.AddCallbackBuffer(buffer);
69  				}
70  				Camera.StartPreview();
71  				Camera.SetNonMarshalingPreviewCallback(cameraEventListener);
72  			}
73  			catch (Exception ex)
74  			{
75  				Android.Util.Log.Debug(MobileBarcodeScanner.TAG, ex.ToString());
76  				return;
77  			}
78  			finally
79  			{
80  				PerformanceCounter.Stop(perf, "Setup Camera Parameters took {0}ms");
81  			}
82  			var currentFocusMode = Camera.GetParameters().FocusMode;
83  			if (currentFocusMode == Camera.Parameters.FocusModeAuto
84  				|| currentFocusMode == Camera.Parameters.FocusModeMacro)
85  				AutoFocus();
86  		}
87  		public void AutoFocus()
88  		{
89  			AutoFocus(0, 0, false);
90  		}
91  		public void AutoFocus(int x, int y)
92  		{
93  			var focusX = x / surfaceView.Width * 2000 - 1000;
94  			var focusY = y / surfaceView.Height * 2000 - 1000;
95  			AutoFocus(focusX, focusY, true);
96  		}
97  		public void ShutdownCamera()
98  		{
99  			if (Camera == null) return;
100  			var perf = PerformanceCounter.Start();
101  			try
102  			{
103  				try
104  				{
105  					Camera.StopPreview();
106  					Camera.SetNonMarshalingPreviewCallback(null);
107  					Android.Util.Log.Debug(MobileBarcodeScanner.TAG, $"Calling SetPreviewDisplay: null");
108  					Camera.SetPreviewDisplay(null);
109  				}
110  				catch (Exception ex)
111  				{
112  					Android.Util.Log.Error(MobileBarcodeScanner.TAG, ex.ToString());
113  				}
114  				Camera.Release();
115  				Camera = null;
116  			}
117  			catch (Exception e)
118  			{
119  				Android.Util.Log.Error(MobileBarcodeScanner.TAG, e.ToString());
120  			}
121  			PerformanceCounter.Stop(perf, "Shutdown camera took {0}ms");
122  		}
123  		void OpenCamera()
124  		{
125  			try
126  			{
127  				var version = Build.VERSION.SdkInt;
128  				if (version >= BuildVersionCodes.Gingerbread)
129  				{
130  					Android.Util.Log.Debug(MobileBarcodeScanner.TAG, "Checking Number of cameras...");
131  					var numCameras = Camera.NumberOfCameras;
132  					var camInfo = new Camera.CameraInfo();
133  					var found = false;
134  					Android.Util.Log.Debug(MobileBarcodeScanner.TAG, "Found " + numCameras + " cameras...");
135  					var whichCamera = CameraFacing.Back;
136  					if (scannerHost.ScanningOptions.UseFrontCameraIfAvailable.HasValue &&
137  						scannerHost.ScanningOptions.UseFrontCameraIfAvailable.Value)
138  						whichCamera = CameraFacing.Front;
139  					for (var i = 0; i < numCameras; i++)
140  					{
141  						Camera.GetCameraInfo(i, camInfo);
142  						if (camInfo.Facing == whichCamera)
143  						{
144  							Android.Util.Log.Debug(MobileBarcodeScanner.TAG,
145  								"Found " + whichCamera + " Camera, opening...");
146  							Camera = Camera.Open(i);
147  							cameraId = i;
148  							found = true;
149  							break;
150  						}
151  					}
152  					if (!found)
153  					{
154  						Android.Util.Log.Debug(MobileBarcodeScanner.TAG,
155  							"Finding " + whichCamera + " camera failed, opening camera 0...");
156  						Camera = Camera.Open(0);
157  						cameraId = 0;
158  					}
159  				}
160  				else
161  				{
162  					Camera = Camera.Open();
163  				}
164  			}
165  			catch (Exception ex)
166  			{
167  				ShutdownCamera();
168  				MobileBarcodeScanner.LogError("Setup Error: {0}", ex);
169  			}
170  		}
171  		void ApplyCameraSettings()
172  		{
173  			if (Camera == null)
174  			{
175  				OpenCamera();
176  			}
177  			if (Camera == null) return;
178  			var parameters = Camera.GetParameters();
179  			parameters.PreviewFormat = ImageFormatType.Nv21;
180  			var supportedFocusModes = parameters.SupportedFocusModes;
181  			if (scannerHost.ScanningOptions.DisableAutofocus)
182  				parameters.FocusMode = Camera.Parameters.FocusModeFixed;
183  			else if (Build.VERSION.SdkInt >= BuildVersionCodes.IceCreamSandwich &&
184  				supportedFocusModes.Contains(Camera.Parameters.FocusModeContinuousPicture))
185  				parameters.FocusMode = Camera.Parameters.FocusModeContinuousPicture;
186  			else if (supportedFocusModes.Contains(Camera.Parameters.FocusModeContinuousVideo))
187  				parameters.FocusMode = Camera.Parameters.FocusModeContinuousVideo;
188  			else if (supportedFocusModes.Contains(Camera.Parameters.FocusModeAuto))
189  				parameters.FocusMode = Camera.Parameters.FocusModeAuto;
190  			else if (supportedFocusModes.Contains(Camera.Parameters.FocusModeFixed))
191  				parameters.FocusMode = Camera.Parameters.FocusModeFixed;
192  			var selectedFps = parameters.SupportedPreviewFpsRange.FirstOrDefault();
193  			if (selectedFps != null)
194  			{
195  				foreach (var fpsRange in parameters.SupportedPreviewFpsRange)
196  				{
197  					if (fpsRange[1] > selectedFps[1] || fpsRange[1] == selectedFps[1] && fpsRange[0] < selectedFps[0])
198  						selectedFps = fpsRange;
199  				}
200  				parameters.SetPreviewFpsRange(selectedFps[0], selectedFps[1]);
201  			}
202  			CameraResolution resolution = null;
203  			var supportedPreviewSizes = parameters.SupportedPreviewSizes;
204  			if (supportedPreviewSizes != null)
205  			{
206  				var availableResolutions = supportedPreviewSizes.Select(sps => new CameraResolution
207  				{
208  					Width = sps.Width,
209  					Height = sps.Height
210  				});
211  				resolution = scannerHost.ScanningOptions.GetResolution(availableResolutions.ToList());
212  				if (resolution == null)
213  				{
214  					foreach (var sps in supportedPreviewSizes)
215  					{
216  						if (sps.Width >= 640 && sps.Width <= 1000 && sps.Height >= 360 && sps.Height <= 1000)
217  						{
218  							resolution = new CameraResolution
219  							{
220  								Width = sps.Width,
221  								Height = sps.Height
222  							};
223  							break;
224  						}
225  					}
226  				}
227  			}
228  			if (Build.Model.Contains("Glass"))
229  			{
230  				resolution = new CameraResolution
231  				{
232  					Width = 640,
233  					Height = 360
234  				};
235  				parameters.SetPreviewFpsRange(30000, 30000);
236  			}
237  			if (resolution != null)
238  			{
239  				Android.Util.Log.Debug(MobileBarcodeScanner.TAG,
240  					"Selected Resolution: " + resolution.Width + "x" + resolution.Height);
241  				CameraResolution = resolution;
242  				parameters.SetPreviewSize(resolution.Width, resolution.Height);
243  			}
244  			Camera.SetParameters(parameters);
245  			SetCameraDisplayOrientation();
246  		}
247  		void AutoFocus(int x, int y, bool useCoordinates)
248  		{
249  			if (Camera == null) return;
250  			if (scannerHost.ScanningOptions.DisableAutofocus)
251  			{
252  				Android.Util.Log.Debug(MobileBarcodeScanner.TAG, "AutoFocus Disabled");
253  				return;
254  			}
255  			var cameraParams = Camera.GetParameters();
256  			Android.Util.Log.Debug(MobileBarcodeScanner.TAG, "AutoFocus Requested");
257  			Camera.CancelAutoFocus();
258  			try
259  			{
260  				if (useCoordinates
261  					&& cameraParams.SupportedFocusModes.Contains(Camera.Parameters.FocusModeAuto))
262  				{
263  					x = x - 10;
264  					y = y - 10;
265  					if (x >= 1000)
266  						x = 980;
267  					if (x < -1000)
268  						x = -1000;
269  					if (y >= 1000)
270  						y = 980;
271  					if (y < -1000)
272  						y = -1000;
273  					cameraParams.FocusMode = Camera.Parameters.FocusModeAuto;
274  					cameraParams.FocusAreas = new List<Camera.Area>
275  					{
276  						new Camera.Area(new Rect(x, y, x + 20, y + 20), 1000)
277  					};
278  					Camera.SetParameters(cameraParams);
279  				}
280  				Camera.AutoFocus(cameraEventListener);
281  			}
282  			catch (Exception ex)
283  			{
284  				Android.Util.Log.Debug(MobileBarcodeScanner.TAG, "AutoFocus Failed: {0}", ex);
285  			}
286  		}
287  		void SetCameraDisplayOrientation()
288  		{
289  			var degrees = GetCameraDisplayOrientation();
290  			LastCameraDisplayOrientationDegree = degrees;
291  			Android.Util.Log.Debug(MobileBarcodeScanner.TAG, "Changing Camera Orientation to: " + degrees);
292  			try
293  			{
294  				Camera.SetDisplayOrientation(degrees);
295  			}
296  			catch (Exception ex)
297  			{
298  				Android.Util.Log.Error(MobileBarcodeScanner.TAG, ex.ToString());
299  			}
300  		}
301  		int GetCameraDisplayOrientation()
302  		{
303  			int degrees;
304  			var windowManager = context.GetSystemService(Context.WindowService).JavaCast<IWindowManager>();
305  			var display = windowManager.DefaultDisplay;
306  			var rotation = display.Rotation;
307  			switch (rotation)
308  			{
309  				case SurfaceOrientation.Rotation0:
310  					degrees = 0;
311  					break;
312  				case SurfaceOrientation.Rotation90:
313  					degrees = 90;
314  					break;
315  				case SurfaceOrientation.Rotation180:
316  					degrees = 180;
317  					break;
318  				case SurfaceOrientation.Rotation270:
319  					degrees = 270;
320  					break;
321  				default:
322  					throw new ArgumentOutOfRangeException();
323  			}
324  			var info = new Camera.CameraInfo();
325  			Camera.GetCameraInfo(cameraId, info);
326  			int correctedDegrees;
327  			if (info.Facing == CameraFacing.Front)
328  			{
329  				correctedDegrees = (info.Orientation + degrees) % 360;
330  				correctedDegrees = (360 - correctedDegrees) % 360; 
331  			}
332  			else
333  			{
334  				correctedDegrees = (info.Orientation - degrees + 360) % 360;
335  			}
336  			return correctedDegrees;
337  		}
338  	}
339  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from MudBlazor-MDEwOlJlcG9zaXRvcnkyODg0Mjg2NzY=-flat-IForm.cs</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from ZXing.Net.Mobile-MDEwOlJlcG9zaXRvcnk2MTYwNjcz-flat-CameraController.android.cs</div>
                </div>
                <div class="column column_space"><pre><code>6          public string[] Errors { get; }
7  #nullable enable
8          public object? Model { get; set; }
9          public void FieldChanged(IFormComponent formControl, object? newValue);
</pre></code></div>
                <div class="column column_space"><pre><code>31  		public CameraResolution CameraResolution { get; private set; }
32  		public int LastCameraDisplayOrientationDegree { get; private set; }
33  		public void RefreshCamera()
34  		{
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    