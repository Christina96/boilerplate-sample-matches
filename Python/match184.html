<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for typepad.py & imgbox.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for typepad.py & imgbox.py
      </h3>
      <h1 align="center">
        67.2%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>typepad.py (71.28713%)<TH>imgbox.py (63.716816%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match184-0.html#0',2,'match184-1.html#0',3)" NAME="0">(36-51)<TD><A HREF="javascript:ZweiFrames('match184-0.html#0',2,'match184-1.html#0',3)" NAME="0">(46-61)</A><TD ALIGN=center><FONT COLOR="#ff0000">29</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match184-0.html#1',2,'match184-1.html#1',3)" NAME="1">(57-73)<TD><A HREF="javascript:ZweiFrames('match184-0.html#1',2,'match184-1.html#1',3)" NAME="1">(64-80)</A><TD ALIGN=center><FONT COLOR="#ed0000">27</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match184-0.html#2',2,'match184-1.html#2',3)" NAME="2">(27-35)<TD><A HREF="javascript:ZweiFrames('match184-0.html#2',2,'match184-1.html#2',3)" NAME="2">(29-37)</A><TD ALIGN=center><FONT COLOR="#8c0000">16</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>typepad.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
#!/usr/bin/env python2
# -*- coding: utf-8 -*-
###############################################################################
# Copyright (c) 2008-2015, Gianluca Fiore
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
###############################################################################



__author__ = &quot;Gianluca Fiore&quot;
__license__ = &quot;GPL&quot;
__email__ = &quot;forod.g@gmail.com&quot;

import re
from urllib import urlretrieve
from os.path import join
import lxml.html
import logging
<A NAME="2"></A>import http_connector


<FONT color="#980517"><A HREF="javascript:ZweiFrames('match184-1.html#2',3,'match184-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>class TypepadParse():

    def __init__(self, link, basedir):
        self.link = link
        self.basedir = basedir
        self.connector = http_connector.Connector()
<A NAME="0"></A>        self.logger = logging.getLogger('pyimagedownloader')

    def</B></FONT> process_url(self, url):
        response <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match184-1.html#0',3,'match184-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= self.connector.reqhandler(url)

        try:
            self.page = lxml.html.fromstring(response)
        except lxml.etree.XMLSyntaxError as e:
            # most of the time we can simply ignore parsing errors
            self.logger.error(&quot;XMLSyntaxError at %s&quot; % url)
            return

        return self.page

    def typepad_get_image_src(self, page):
        # find the src attribute which contains the real url
        src_links = page.xpath(&quot;//body/p/img[@src]&quot;)

        typepad_src = [li.get(</B></FONT>'src', None) for li in src_links]

        return typepad_src
<A NAME="1"></A>
    def typepad_get_image_name(self, link):
        # generate just the filename of the image to be locally saved
        imagename = re<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match184-1.html#1',3,'match184-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.split('.a/', link)

        return imagename

    def typepad_save_image(self, src, imagename):
        download_url = src[0]
        try:
            savefile = join(self.basedir, str(imagename[1]) + '.jpg')
            urlretrieve(download_url, savefile)
        except IndexError:
            self.logger.error(&quot;IndexError in %s&quot; % imagename)
            pass

    def parse(self):
        self.page = self.process_url(self.link)

        self.</B></FONT>typepad_src = self.typepad_get_image_src(self.page)

        self.imagename = self.typepad_get_image_name(self.typepad_src[0])

        self.typepad_save_image(self.typepad_src, self.imagename)
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>imgbox.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
#!/usr/bin/env python2
# -*- coding: utf-8 -*-
###############################################################################
# Copyright (c) 2008-2015, Gianluca Fiore
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
###############################################################################



__author__ = &quot;Gianluca Fiore&quot;
__license__ = &quot;GPL&quot;
__email__ = &quot;forod.g@gmail.com&quot;

from urllib import urlretrieve
from os.path import join
import re
import lxml.html
import logging
import http_connector

<A NAME="2"></A># Regexp for imgbox gallery images' thumbnails
rIMGBOXTHUMB = re.compile(&quot;http://t\.imgbox\.com&quot;, re.IGNORECASE)

<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match184-0.html#2',2,'match184-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>class ImgboxParse():

    def __init__(self, link, basedir):
        self.link = link
        self.basedir = basedir
        self.connector = http_connector.Connector()
        self.logger = logging.getLogger('pyimagedownloader')

    def</B></FONT> process_url(self, url):
        if re.search(rIMGBOXTHUMB, url):
            # if we are dealing with an imgbox gallery with just thumbs, split their urls
            # and reconstruct the single urls for each image; then resubmit each one to the parser
            split_url = re.split('\.|\/', url)
            new_url = 'http://imgbox.com/' + split_url[-2]
<A NAME="0"></A>            self.page = self.process_url(new_url)
            return self.page

        response <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match184-0.html#0',2,'match184-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= self.connector.reqhandler(url)

        try:
            self.page = lxml.html.fromstring(response)
        except lxml.etree.XMLSyntaxError as e:
            # most of the time we can simply ignore parsing errors
            self.logger.error(&quot;XMLSyntaxError at %s&quot; % url)
            return

        return self.page

    def imgbox_get_image_src_and_name(self, page):
        # find the src attribute which contains the real url
        src_links = page.xpath(&quot;//div[@class='image-container']/img&quot;)

<A NAME="1"></A>        imgbox_src = [li.get(</B></FONT>'src', None) for li in src_links]

        # extract also the filename of the image
        imagename = [li<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match184-0.html#1',2,'match184-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.get('title', None) for li in src_links]

        return imgbox_src, imagename

    def imgbox_save_image(self, src, imagename):
        download_url = src[0]
        try:
            savefile = join(self.basedir, str(imagename[-1]))
            urlretrieve(download_url, savefile)
        except IndexError as e:
            self.logger.error(&quot;IndexError in %s&quot; % imagename)
            pass

    def parse(self):
        self.page = self.process_url(self.link)

        self.</B></FONT>imgbox_src, self.imagename = self.imgbox_get_image_src_and_name(self.page)

        self.imgbox_save_image(self.imgbox_src, self.imagename)
</PRE>
</div>
  </div>
</body>
</html>
