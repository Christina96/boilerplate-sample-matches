<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for boto_cognitoidentity_1.py &amp; user_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for boto_cognitoidentity_1.py &amp; user_1.py
      </h3>
<h1 align="center">
        1.5%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>boto_cognitoidentity_1.py (3.125%)<th>user_1.py (1.038961%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(393-430)<td><a href="#" name="0">(47-61)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_cognitoidentity_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import logging
import salt.utils.compat
import salt.utils.versions
log = logging.getLogger(__name__)
try:
    import boto
    import boto3
    from botocore.exceptions import ClientError
    logging.getLogger("boto").setLevel(logging.CRITICAL)
    logging.getLogger("boto3").setLevel(logging.CRITICAL)
    HAS_BOTO = True
except ImportError:
    HAS_BOTO = False
def __virtual__():
    return salt.utils.versions.check_boto_reqs(boto_ver="2.8.0", boto3_ver="1.2.1")
def __init__(opts):
    if HAS_BOTO:
        __utils__["boto3.assign_funcs"](__name__, "cognito-identity")
def _find_identity_pool_ids(name, pool_id, conn):
    ids = []
    if pool_id is None:
        for pools in __utils__["boto3.paged_call"](
            conn.list_identity_pools,
            marker_flag="NextToken",
            marker_arg="NextToken",
            MaxResults=25,
        ):
            for pool in pools["IdentityPools"]:
                if pool["IdentityPoolName"] == name:
                    ids.append(pool["IdentityPoolId"])
    else:
        ids.append(pool_id)
    return ids
def describe_identity_pools(
    IdentityPoolName,
    IdentityPoolId=None,
    region=None,
    key=None,
    keyid=None,
    profile=None,
):
    conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
    try:
        ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
        if ids:
            results = []
            for pool_id in ids:
                response = conn.describe_identity_pool(IdentityPoolId=pool_id)
                response.pop("ResponseMetadata", None)
                results.append(response)
            return {"identity_pools": results}
        else:
            return {"identity_pools": None}
    except ClientError as e:
        return {"error": __utils__["boto3.get_error"](e)}
def create_identity_pool(
    IdentityPoolName,
    AllowUnauthenticatedIdentities=False,
    SupportedLoginProviders=None,
    DeveloperProviderName=None,
    OpenIdConnectProviderARNs=None,
    region=None,
    key=None,
    keyid=None,
    profile=None,
):
    SupportedLoginProviders = (
        dict() if SupportedLoginProviders is None else SupportedLoginProviders
    )
    OpenIdConnectProviderARNs = (
        list() if OpenIdConnectProviderARNs is None else OpenIdConnectProviderARNs
    )
    conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
    try:
        request_params = dict(
            IdentityPoolName=IdentityPoolName,
            AllowUnauthenticatedIdentities=AllowUnauthenticatedIdentities,
            SupportedLoginProviders=SupportedLoginProviders,
            OpenIdConnectProviderARNs=OpenIdConnectProviderARNs,
        )
        if DeveloperProviderName:
            request_params["DeveloperProviderName"] = DeveloperProviderName
        response = conn.create_identity_pool(**request_params)
        response.pop("ResponseMetadata", None)
        return {"created": True, "identity_pool": response}
    except ClientError as e:
        return {"created": False, "error": __utils__["boto3.get_error"](e)}
def delete_identity_pools(
    IdentityPoolName,
    IdentityPoolId=None,
    region=None,
    key=None,
    keyid=None,
    profile=None,
):
    conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
    try:
        ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
        count = 0
        if ids:
            for pool_id in ids:
                conn.delete_identity_pool(IdentityPoolId=pool_id)
                count += 1
            return {"deleted": True, "count": count}
        else:
            return {"deleted": False, "count": count}
    except ClientError as e:
        return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
def get_identity_pool_roles(
    IdentityPoolName,
    IdentityPoolId=None,
    region=None,
    key=None,
    keyid=None,
    profile=None,
):
    conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
    try:
        ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
        if ids:
            results = []
            for pool_id in ids:
                response = conn.get_identity_pool_roles(IdentityPoolId=pool_id)
                response.pop("ResponseMetadata", None)
                results.append(response)
            return {"identity_pool_roles": results}
        else:
            return {"identity_pool_roles": None}
    except ClientError as e:
        return {"error": __utils__["boto3.get_error"](e)}
def _get_role_arn(name, **conn_params):
    if name.startswith("arn:aws:iam"):
        return name
    role = __salt__["boto_iam.describe_role"](name, **conn_params)
    rolearn = role.get("arn") if role else None
    return rolearn
def set_identity_pool_roles(
    IdentityPoolId,
    AuthenticatedRole=None,
    UnauthenticatedRole=None,
    region=None,
    key=None,
    keyid=None,
    profile=None,
):
    conn_params = dict(region=region, key=key, keyid=keyid, profile=profile)
    conn = _get_conn(**conn_params)
    try:
        if AuthenticatedRole:
            role_arn = _get_role_arn(AuthenticatedRole, **conn_params)
            if role_arn is None:
                return {
                    "set": False,
                    "error": "invalid AuthenticatedRole {}".format(AuthenticatedRole),
                }
            AuthenticatedRole = role_arn
        if UnauthenticatedRole:
            role_arn = _get_role_arn(UnauthenticatedRole, **conn_params)
            if role_arn is None:
                return {
                    "set": False,
                    "error": "invalid UnauthenticatedRole {}".format(
                        UnauthenticatedRole
                    ),
                }
            UnauthenticatedRole = role_arn
        Roles = dict()
        if AuthenticatedRole:
            Roles["authenticated"] = AuthenticatedRole
        if UnauthenticatedRole:
            Roles["unauthenticated"] = UnauthenticatedRole
        conn.set_identity_pool_roles(IdentityPoolId=IdentityPoolId, Roles=Roles)
<a name="0"></a>
        return {"set": True, "roles": Roles}
    except ClientError as e:
        return {"set": False, "error": __utils__["boto3.get_error"](<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>e)}
def update_identity_pool(
    IdentityPoolId,
    IdentityPoolName=None,
    AllowUnauthenticatedIdentities=False,
    SupportedLoginProviders=None,
    DeveloperProviderName=None,
    OpenIdConnectProviderARNs=None,
    region=None,
    key=None,
    keyid=None,
    profile=None,
):
    conn_params =</b></font> dict(region=region, key=key, keyid=keyid, profile=profile)
    response = describe_identity_pools("", IdentityPoolId=IdentityPoolId, **conn_params)
    error = response.get("error")
    if error is None:
        error = "No matching pool" if response.get("identity_pools") is None else None
    if error:
        return {"updated": False, "error": error}
    id_pool = response.get("identity_pools")[0]
    request_params = id_pool.copy()
    if IdentityPoolName is not None and IdentityPoolName != request_params.get(
        "IdentityPoolName"
    ):
        request_params["IdentityPoolName"] = IdentityPoolName
    if AllowUnauthenticatedIdentities != request_params.get(
        "AllowUnauthenticatedIdentities"
    ):
        request_params[
            "AllowUnauthenticatedIdentities"
        ] = AllowUnauthenticatedIdentities
    current_val = request_params.pop("SupportedLoginProviders", None)
    if SupportedLoginProviders is not None and SupportedLoginProviders != current_val:
        request_params["SupportedLoginProviders"] = SupportedLoginProviders
    current_val = request_params.pop("DeveloperProviderName", None)
    if current_val is None and DeveloperProviderName is not None:
        request_params["DeveloperProviderName"] = DeveloperProviderName
    current_val = request_params.pop("OpenIdConnectProviderARNs", None)
    if (
        OpenIdConnectProviderARNs is not None
        and OpenIdConnectProviderARNs != current_val
    ):
        request_params["OpenIdConnectProviderARNs"] = OpenIdConnectProviderARNs
    conn = _get_conn(**conn_params)
    try:
        response = conn.update_identity_pool(**request_params)
        response.pop("ResponseMetadata", None)
        return {"updated": True, "identity_pool": response}
    except ClientError as e:
        return {"updated": False, "error": __utils__["boto3.get_error"](e)}
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>user_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import logging
import os
import salt.utils.data
import salt.utils.dateutils
import salt.utils.platform
import salt.utils.user
import salt.utils.versions
from salt.exceptions import CommandExecutionError
log = logging.getLogger(__name__)
def _group_changes(cur, wanted, remove=False):
    old = set(cur)
<a name="0"></a>    new = set(wanted)
    if (remove and old != new) or (not remove and not new.issubset(old)):
        return True
    r<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>eturn False
def _changes(
    name,
    uid=None,
    gid=None,
    groups=None,
    optional_groups=None,
    remove_groups=True,
    home=None,
    createhome=True,
    password=None,
    enforce_password=True,
    empty_password=</b></font>False,
    shell=None,
    fullname="",
    roomnumber="",
    workphone="",
    homephone="",
    other="",
    loginclass=None,
    date=None,
    mindays=0,
    maxdays=999999,
    inactdays=0,
    warndays=7,
    expire=None,
    win_homedrive=None,
    win_profile=None,
    win_logonscript=None,
    win_description=None,
    allow_uid_change=False,
    allow_gid_change=False,
):
    if "shadow.info" in __salt__:
        lshad = __salt__["shadow.info"](name)
    lusr = __salt__["user.info"](name)
    if not lusr:
        return False
    change = {}
    if groups is None:
        groups = lusr["groups"]
    wanted_groups = sorted(set((groups or []) + (optional_groups or [])))
    if uid and lusr["uid"] != uid:
        change["uid"] = uid
    if gid is not None and lusr["gid"] not in (gid, __salt__["file.group_to_gid"](gid)):
        change["gid"] = gid
    default_grp = __salt__["file.gid_to_group"](gid if gid is not None else lusr["gid"])
    old_default_grp = __salt__["file.gid_to_group"](lusr["gid"])
    if default_grp in lusr["groups"]:
        lusr["groups"].remove(default_grp)
    if old_default_grp != default_grp and old_default_grp in lusr["groups"]:
        lusr["groups"].remove(old_default_grp)
    if name in lusr["groups"] and name not in wanted_groups:
        lusr["groups"].remove(name)
    if default_grp in wanted_groups:
        wanted_groups.remove(default_grp)
    if _group_changes(lusr["groups"], wanted_groups, remove_groups):
        change["groups"] = wanted_groups
    if home and lusr["home"] != home:
        change["home"] = home
    if createhome:
        newhome = home if home else lusr["home"]
        if newhome is not None and not os.path.isdir(newhome):
            change["homeDoesNotExist"] = newhome
    if shell and lusr["shell"] != shell:
        change["shell"] = shell
    if "shadow.info" in __salt__ and "shadow.default_hash" in __salt__:
        if password and not empty_password:
            default_hash = __salt__["shadow.default_hash"]()
            if (
                lshad["passwd"] == default_hash
                or lshad["passwd"] != default_hash
                and enforce_password
            ):
                if lshad["passwd"] != password:
                    change["passwd"] = password
        if empty_password and lshad["passwd"] != "":
            change["empty_password"] = True
        if date is not None and lshad["lstchg"] != date:
            change["date"] = date
        if mindays is not None and lshad["min"] != mindays:
            change["mindays"] = mindays
        if maxdays is not None and lshad["max"] != maxdays:
            change["maxdays"] = maxdays
        if inactdays is not None and lshad["inact"] != inactdays:
            change["inactdays"] = inactdays
        if warndays is not None and lshad["warn"] != warndays:
            change["warndays"] = warndays
        if expire and lshad["expire"] != expire:
            change["expire"] = expire
    elif "shadow.info" in __salt__ and salt.utils.platform.is_windows():
        if (
            expire
            and expire != -1
            and salt.utils.dateutils.strftime(lshad["expire"])
            != salt.utils.dateutils.strftime(expire)
        ):
            change["expire"] = expire
    fullname = salt.utils.data.decode(fullname)
    lusr["fullname"] = salt.utils.data.decode(lusr["fullname"])
    if fullname is not None and lusr["fullname"] != fullname:
        change["fullname"] = fullname
    if win_homedrive and lusr["homedrive"] != win_homedrive:
        change["win_homedrive"] = win_homedrive
    if win_profile and lusr["profile"] != win_profile:
        change["win_profile"] = win_profile
    if win_logonscript and lusr["logonscript"] != win_logonscript:
        change["win_logonscript"] = win_logonscript
    if win_description and lusr["description"] != win_description:
        change["win_description"] = win_description
    if "user.chroomnumber" in __salt__ and roomnumber is not None:
        roomnumber = salt.utils.data.decode(roomnumber)
        lusr["roomnumber"] = salt.utils.data.decode(lusr["roomnumber"])
        if lusr["roomnumber"] != roomnumber:
            change["roomnumber"] = roomnumber
    if "user.chworkphone" in __salt__ and workphone is not None:
        workphone = salt.utils.data.decode(workphone)
        lusr["workphone"] = salt.utils.data.decode(lusr["workphone"])
        if lusr["workphone"] != workphone:
            change["workphone"] = workphone
    if "user.chhomephone" in __salt__ and homephone is not None:
        homephone = salt.utils.data.decode(homephone)
        lusr["homephone"] = salt.utils.data.decode(lusr["homephone"])
        if lusr["homephone"] != homephone:
            change["homephone"] = homephone
    if "user.chother" in __salt__ and other is not None:
        other = salt.utils.data.decode(other)
        lusr["other"] = salt.utils.data.decode(lusr["other"])
        if lusr["other"] != other:
            change["other"] = other
    if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
        if loginclass:
            if __salt__["user.get_loginclass"](name) != loginclass:
                change["loginclass"] = loginclass
    errors = []
    if not allow_uid_change and "uid" in change:
        errors.append(
            "Changing uid ({} -&gt; {}) not permitted, set allow_uid_change to "
            "True to force this change. Note that this will not change file "
            "ownership.".format(lusr["uid"], uid)
        )
    if not allow_gid_change and "gid" in change:
        errors.append(
            "Changing gid ({} -&gt; {}) not permitted, set allow_gid_change to "
            "True to force this change. Note that this will not change file "
            "ownership.".format(lusr["gid"], gid)
        )
    if errors:
        raise CommandExecutionError(
            "Encountered error checking for needed changes", info=errors
        )
    return change
def present(
    name,
    uid=None,
    gid=None,
    usergroup=None,
    groups=None,
    optional_groups=None,
    remove_groups=True,
    home=None,
    createhome=True,
    password=None,
    hash_password=False,
    enforce_password=True,
    empty_password=False,
    shell=None,
    unique=True,
    system=False,
    fullname=None,
    roomnumber=None,
    workphone=None,
    homephone=None,
    other=None,
    loginclass=None,
    date=None,
    mindays=None,
    maxdays=None,
    inactdays=None,
    warndays=None,
    expire=None,
    win_homedrive=None,
    win_profile=None,
    win_logonscript=None,
    win_description=None,
    nologinit=False,
    allow_uid_change=False,
    allow_gid_change=False,
):
    if password and hash_password:
        log.debug("Hashing a clear text password")
        algorithms = {
            "1": "md5",
            "2a": "blowfish",
            "5": "sha256",
            "6": "sha512",
        }
        try:
            _, algo, shadow_salt, shadow_hash = __salt__["shadow.info"](name)[
                "passwd"
            ].split("$", 4)
            if algo == "1":
                log.warning("Using MD5 for hashing passwords is considered insecure!")
            log.debug(
                "Re-using existing shadow salt for hashing password using %s",
                algorithms.get(algo),
            )
            password = __salt__["shadow.gen_password"](
                password, crypt_salt=shadow_salt, algorithm=algorithms.get(algo)
            )
        except ValueError:
            log.info(
                "No existing shadow salt found, defaulting to a randomly generated"
                " new one"
            )
            password = __salt__["shadow.gen_password"](password)
    if fullname is not None:
        fullname = salt.utils.data.decode(str(fullname))
    if roomnumber is not None:
        roomnumber = salt.utils.data.decode(str(roomnumber))
    if workphone is not None:
        workphone = salt.utils.data.decode(str(workphone))
    if homephone is not None:
        homephone = salt.utils.data.decode(str(homephone))
    if other is not None:
        other = salt.utils.data.decode(str(other))
    if __grains__["kernel"] == "Windows":
        createhome = False
    ret = {
        "name": name,
        "changes": {},
        "result": True,
        "comment": "User {} is present and up to date".format(name),
    }
    for gecos_field in [fullname, roomnumber, workphone]:
        if isinstance(gecos_field, str) and "," in gecos_field:
            ret["comment"] = "Unsupported char ',' in {}".format(gecos_field)
            ret["result"] = False
            return ret
    if groups:
        missing_groups = [x for x in groups if not __salt__["group.info"](x)]
        if missing_groups:
            ret["comment"] = "The following group(s) are not present: {}".format(
                ",".join(missing_groups)
            )
            ret["result"] = False
            return ret
    if optional_groups:
        present_optgroups = [x for x in optional_groups if __salt__["group.info"](x)]
        for missing_optgroup in [
            x for x in optional_groups if x not in present_optgroups
        ]:
            log.debug(
                'Optional group "%s" for user "%s" is not present',
                missing_optgroup,
                name,
            )
    else:
        present_optgroups = None
    if groups and optional_groups:
        for isected in set(groups).intersection(optional_groups):
            log.warning(
                'Group "%s" specified in both groups and optional_groups for user %s',
                isected,
                name,
            )
    if usergroup and __salt__["file.group_to_gid"](name) != "":
        changes_gid = name
    else:
        changes_gid = gid
    try:
        changes = _changes(
            name,
            uid,
            changes_gid,
            groups,
            present_optgroups,
            remove_groups,
            home,
            createhome,
            password,
            enforce_password,
            empty_password,
            shell,
            fullname,
            roomnumber,
            workphone,
            homephone,
            other,
            loginclass,
            date,
            mindays,
            maxdays,
            inactdays,
            warndays,
            expire,
            win_homedrive,
            win_profile,
            win_logonscript,
            win_description,
            allow_uid_change,
            allow_gid_change,
        )
    except CommandExecutionError as exc:
        ret["result"] = False
        ret["comment"] = exc.strerror
        return ret
    if changes:
        if __opts__["test"]:
            ret["result"] = None
            ret["comment"] = "The following user attributes are set to be changed:\n"
            for key, val in changes.items():
                if key == "passwd":
                    val = "XXX-REDACTED-XXX"
                elif key == "group" and not remove_groups:
                    key = "ensure groups"
                ret["comment"] += "{}: {}\n".format(key, val)
            return ret
        if "shadow.info" in __salt__:
            lshad = __salt__["shadow.info"](name)
        if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
            lcpre = __salt__["user.get_loginclass"](name)
        pre = __salt__["user.info"](name)
        if "passwd" in changes:
            del changes["passwd"]
            if not empty_password:
                __salt__["shadow.set_password"](name, password)
            else:
                log.warning("No password will be set when empty_password=True")
        if changes.pop("empty_password", False) is True:
            __salt__["shadow.del_password"](name)
        if "date" in changes:
            del changes["date"]
            __salt__["shadow.set_date"](name, date)
        def _change_homedir(name, val):
            if __grains__["kernel"] in ("Darwin", "Windows"):
                __salt__["user.chhome"](name, val)
            else:
                __salt__["user.chhome"](name, val, persist=False)
        _homedir_changed = False
        if "home" in changes:
            val = changes.pop("home")
            if "homeDoesNotExist" not in changes:
                _change_homedir(name, val)
                _homedir_changed = True
        if "homeDoesNotExist" in changes:
            val = changes.pop("homeDoesNotExist")
            if not _homedir_changed:
                _change_homedir(name, val)
            if not os.path.isdir(val):
                __salt__["file.mkdir"](val, pre["uid"], pre["gid"], 0o755)
        if "mindays" in changes:
            del changes["mindays"]
            __salt__["shadow.set_mindays"](name, mindays)
        if "maxdays" in changes:
            del changes["maxdays"]
            __salt__["shadow.set_maxdays"](name, maxdays)
        if "inactdays" in changes:
            del changes["inactdays"]
            __salt__["shadow.set_inactdays"](name, inactdays)
        if "warndays" in changes:
            del changes["warndays"]
            __salt__["shadow.set_warndays"](name, warndays)
        if "expire" in changes:
            del changes["expire"]
            __salt__["shadow.set_expire"](name, expire)
        if "win_homedrive" in changes:
            __salt__["user.update"](name=name, homedrive=changes.pop("win_homedrive"))
        if "win_profile" in changes:
            __salt__["user.update"](name=name, profile=changes.pop("win_profile"))
        if "win_logonscript" in changes:
            __salt__["user.update"](
                name=name, logonscript=changes.pop("win_logonscript")
            )
        if "win_description" in changes:
            __salt__["user.update"](
                name=name, description=changes.pop("win_description")
            )
        for key in [
            x
            for x in list(changes)
            if x != "groups" and "user.ch{}".format(x) in __salt__
        ]:
            __salt__["user.ch{}".format(key)](name, changes.pop(key))
        if "groups" in changes:
            __salt__["user.chgroups"](name, changes.pop("groups"), not remove_groups)
        if changes:
            ret.get("warnings", []).append(
                "Unhandled changes: {}".format(", ".join(changes))
            )
        post = __salt__["user.info"](name)
        spost = {}
        if "shadow.info" in __salt__ and lshad["passwd"] != password:
            spost = __salt__["shadow.info"](name)
        if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
            lcpost = __salt__["user.get_loginclass"](name)
        for key in post:
            if post[key] != pre[key]:
                ret["changes"][key] = post[key]
        if "shadow.info" in __salt__:
            for key in spost:
                if lshad[key] != spost[key]:
                    if key == "passwd":
                        ret["changes"][key] = "XXX-REDACTED-XXX"
                    else:
                        ret["changes"][key] = spost[key]
        if __grains__["kernel"] in ("OpenBSD", "FreeBSD") and lcpost != lcpre:
            ret["changes"]["loginclass"] = lcpost
        if ret["changes"]:
            ret["comment"] = "Updated user {}".format(name)
        changes = _changes(
            name,
            uid,
            gid,
            groups,
            present_optgroups,
            remove_groups,
            home,
            createhome,
            password,
            enforce_password,
            empty_password,
            shell,
            fullname,
            roomnumber,
            workphone,
            homephone,
            other,
            loginclass,
            date,
            mindays,
            maxdays,
            inactdays,
            warndays,
            expire,
            win_homedrive,
            win_profile,
            win_logonscript,
            win_description,
            allow_uid_change=True,
            allow_gid_change=True,
        )
        if changes:
            ret["comment"] = "These values could not be changed: {}".format(changes)
            ret["result"] = False
        return ret
    if changes is False:
        if __opts__["test"]:
            ret["result"] = None
            ret["comment"] = "User {} set to be added".format(name)
            return ret
        if groups and present_optgroups:
            groups.extend(present_optgroups)
        elif present_optgroups:
            groups = present_optgroups[:]
        if not salt.utils.platform.is_windows():
            params = {
                "name": name,
                "uid": uid,
                "gid": gid,
                "groups": groups,
                "home": home,
                "shell": shell,
                "unique": unique,
                "system": system,
                "fullname": fullname,
                "roomnumber": roomnumber,
                "workphone": workphone,
                "homephone": homephone,
                "other": other,
                "createhome": createhome,
                "nologinit": nologinit,
                "loginclass": loginclass,
                "usergroup": usergroup,
            }
        else:
            params = {
                "name": name,
                "password": password,
                "fullname": fullname,
                "description": win_description,
                "groups": groups,
                "home": home,
                "homedrive": win_homedrive,
                "profile": win_profile,
                "logonscript": win_logonscript,
            }
        result = __salt__["user.add"](**params)
        if result is True:
            ret["comment"] = "New user {} created".format(name)
            ret["changes"] = __salt__["user.info"](name)
            if not createhome:
                ret["changes"]["home"] = ""
            if (
                "shadow.info" in __salt__
                and not salt.utils.platform.is_windows()
                and not salt.utils.platform.is_darwin()
            ):
                if password and not empty_password:
                    __salt__["shadow.set_password"](name, password)
                    spost = __salt__["shadow.info"](name)
                    if spost["passwd"] != password:
                        ret[
                            "comment"
                        ] = "User {} created but failed to set password to {}".format(
                            name, "XXX-REDACTED-XXX"
                        )
                        ret["result"] = False
                    ret["changes"]["password"] = "XXX-REDACTED-XXX"
                if empty_password and not password:
                    __salt__["shadow.del_password"](name)
                    spost = __salt__["shadow.info"](name)
                    if spost["passwd"] != "":
                        ret[
                            "comment"
                        ] = "User {} created but failed to empty password".format(name)
                        ret["result"] = False
                    ret["changes"]["password"] = ""
                if date is not None:
                    __salt__["shadow.set_date"](name, date)
                    spost = __salt__["shadow.info"](name)
                    if spost["lstchg"] != date:
                        ret["comment"] = (
                            "User {} created but failed to set"
                            " last change date to"
                            " {}".format(name, date)
                        )
                        ret["result"] = False
                    ret["changes"]["date"] = date
                if mindays:
                    __salt__["shadow.set_mindays"](name, mindays)
                    spost = __salt__["shadow.info"](name)
                    if spost["min"] != mindays:
                        ret["comment"] = (
                            "User {} created but failed to set"
                            " minimum days to"
                            " {}".format(name, mindays)
                        )
                        ret["result"] = False
                    ret["changes"]["mindays"] = mindays
                if maxdays:
                    __salt__["shadow.set_maxdays"](name, maxdays)
                    spost = __salt__["shadow.info"](name)
                    if spost["max"] != maxdays:
                        ret["comment"] = (
                            "User {} created but failed to set"
                            " maximum days to"
                            " {}".format(name, maxdays)
                        )
                        ret["result"] = False
                    ret["changes"]["maxdays"] = maxdays
                if inactdays:
                    __salt__["shadow.set_inactdays"](name, inactdays)
                    spost = __salt__["shadow.info"](name)
                    if spost["inact"] != inactdays:
                        ret["comment"] = (
                            "User {} created but failed to set"
                            " inactive days to"
                            " {}".format(name, inactdays)
                        )
                        ret["result"] = False
                    ret["changes"]["inactdays"] = inactdays
                if warndays:
                    __salt__["shadow.set_warndays"](name, warndays)
                    spost = __salt__["shadow.info"](name)
                    if spost["warn"] != warndays:
                        ret[
                            "comment"
                        ] = "User {} created but failed to set warn days to {}".format(
                            name, warndays
                        )
                        ret["result"] = False
                    ret["changes"]["warndays"] = warndays
                if expire:
                    __salt__["shadow.set_expire"](name, expire)
                    spost = __salt__["shadow.info"](name)
                    if spost["expire"] != expire:
                        ret["comment"] = (
                            "User {} created but failed to set"
                            " expire days to"
                            " {}".format(name, expire)
                        )
                        ret["result"] = False
                    ret["changes"]["expire"] = expire
            elif salt.utils.platform.is_windows():
                if password and not empty_password:
                    if not __salt__["user.setpassword"](name, password):
                        ret[
                            "comment"
                        ] = "User {} created but failed to set password to {}".format(
                            name, "XXX-REDACTED-XXX"
                        )
                        ret["result"] = False
                    ret["changes"]["passwd"] = "XXX-REDACTED-XXX"
                if expire:
                    __salt__["shadow.set_expire"](name, expire)
                    spost = __salt__["shadow.info"](name)
                    if salt.utils.dateutils.strftime(
                        spost["expire"]
                    ) != salt.utils.dateutils.strftime(expire):
                        ret["comment"] = (
                            "User {} created but failed to set"
                            " expire days to"
                            " {}".format(name, expire)
                        )
                        ret["result"] = False
                    ret["changes"]["expiration_date"] = spost["expire"]
            elif salt.utils.platform.is_darwin() and password and not empty_password:
                if not __salt__["shadow.set_password"](name, password):
                    ret[
                        "comment"
                    ] = "User {} created but failed to set password to {}".format(
                        name, "XXX-REDACTED-XXX"
                    )
                    ret["result"] = False
                ret["changes"]["passwd"] = "XXX-REDACTED-XXX"
        else:
            if isinstance(result, str):
                ret["comment"] = result
            else:
                ret["comment"] = "Failed to create new user {}".format(name)
            ret["result"] = False
    return ret
def absent(name, purge=False, force=False):
    ret = {"name": name, "changes": {}, "result": True, "comment": ""}
    lusr = __salt__["user.info"](name)
    if lusr:
        if __opts__["test"]:
            ret["result"] = None
            ret["comment"] = "User {} set for removal".format(name)
            return ret
        beforegroups = set(salt.utils.user.get_group_list(name))
        ret["result"] = __salt__["user.delete"](name, purge, force)
        aftergroups = {g for g in beforegroups if __salt__["group.info"](g)}
        if ret["result"]:
            ret["changes"] = {}
            for g in beforegroups - aftergroups:
                ret["changes"]["{} group".format(g)] = "removed"
            ret["changes"][name] = "removed"
            ret["comment"] = "Removed user {}".format(name)
        else:
            ret["result"] = False
            ret["comment"] = "Failed to remove user {}".format(name)
        return ret
    ret["comment"] = "User {} is not present".format(name)
    return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
