<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for boto_cognitoidentity_1.py &amp; user_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for boto_cognitoidentity_1.py &amp; user_1.py
      </h3>
<h1 align="center">
        1.5%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>boto_cognitoidentity_1.py (3.125%)<th>user_1.py (1.038961%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(393-430)<td><a href="#" name="0">(47-61)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_cognitoidentity_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import salt.utils.compat
3 import salt.utils.versions
4 log = logging.getLogger(__name__)
5 try:
6     import boto
7     import boto3
8     from botocore.exceptions import ClientError
9     logging.getLogger("boto").setLevel(logging.CRITICAL)
10     logging.getLogger("boto3").setLevel(logging.CRITICAL)
11     HAS_BOTO = True
12 except ImportError:
13     HAS_BOTO = False
14 def __virtual__():
15     return salt.utils.versions.check_boto_reqs(boto_ver="2.8.0", boto3_ver="1.2.1")
16 def __init__(opts):
17     if HAS_BOTO:
18         __utils__["boto3.assign_funcs"](__name__, "cognito-identity")
19 def _find_identity_pool_ids(name, pool_id, conn):
20     ids = []
21     if pool_id is None:
22         for pools in __utils__["boto3.paged_call"](
23             conn.list_identity_pools,
24             marker_flag="NextToken",
25             marker_arg="NextToken",
26             MaxResults=25,
27         ):
28             for pool in pools["IdentityPools"]:
29                 if pool["IdentityPoolName"] == name:
30                     ids.append(pool["IdentityPoolId"])
31     else:
32         ids.append(pool_id)
33     return ids
34 def describe_identity_pools(
35     IdentityPoolName,
36     IdentityPoolId=None,
37     region=None,
38     key=None,
39     keyid=None,
40     profile=None,
41 ):
42     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
43     try:
44         ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
45         if ids:
46             results = []
47             for pool_id in ids:
48                 response = conn.describe_identity_pool(IdentityPoolId=pool_id)
49                 response.pop("ResponseMetadata", None)
50                 results.append(response)
51             return {"identity_pools": results}
52         else:
53             return {"identity_pools": None}
54     except ClientError as e:
55         return {"error": __utils__["boto3.get_error"](e)}
56 def create_identity_pool(
57     IdentityPoolName,
58     AllowUnauthenticatedIdentities=False,
59     SupportedLoginProviders=None,
60     DeveloperProviderName=None,
61     OpenIdConnectProviderARNs=None,
62     region=None,
63     key=None,
64     keyid=None,
65     profile=None,
66 ):
67     SupportedLoginProviders = (
68         dict() if SupportedLoginProviders is None else SupportedLoginProviders
69     )
70     OpenIdConnectProviderARNs = (
71         list() if OpenIdConnectProviderARNs is None else OpenIdConnectProviderARNs
72     )
73     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
74     try:
75         request_params = dict(
76             IdentityPoolName=IdentityPoolName,
77             AllowUnauthenticatedIdentities=AllowUnauthenticatedIdentities,
78             SupportedLoginProviders=SupportedLoginProviders,
79             OpenIdConnectProviderARNs=OpenIdConnectProviderARNs,
80         )
81         if DeveloperProviderName:
82             request_params["DeveloperProviderName"] = DeveloperProviderName
83         response = conn.create_identity_pool(**request_params)
84         response.pop("ResponseMetadata", None)
85         return {"created": True, "identity_pool": response}
86     except ClientError as e:
87         return {"created": False, "error": __utils__["boto3.get_error"](e)}
88 def delete_identity_pools(
89     IdentityPoolName,
90     IdentityPoolId=None,
91     region=None,
92     key=None,
93     keyid=None,
94     profile=None,
95 ):
96     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
97     try:
98         ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
99         count = 0
100         if ids:
101             for pool_id in ids:
102                 conn.delete_identity_pool(IdentityPoolId=pool_id)
103                 count += 1
104             return {"deleted": True, "count": count}
105         else:
106             return {"deleted": False, "count": count}
107     except ClientError as e:
108         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
109 def get_identity_pool_roles(
110     IdentityPoolName,
111     IdentityPoolId=None,
112     region=None,
113     key=None,
114     keyid=None,
115     profile=None,
116 ):
117     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
118     try:
119         ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
120         if ids:
121             results = []
122             for pool_id in ids:
123                 response = conn.get_identity_pool_roles(IdentityPoolId=pool_id)
124                 response.pop("ResponseMetadata", None)
125                 results.append(response)
126             return {"identity_pool_roles": results}
127         else:
128             return {"identity_pool_roles": None}
129     except ClientError as e:
130         return {"error": __utils__["boto3.get_error"](e)}
131 def _get_role_arn(name, **conn_params):
132     if name.startswith("arn:aws:iam"):
133         return name
134     role = __salt__["boto_iam.describe_role"](name, **conn_params)
135     rolearn = role.get("arn") if role else None
136     return rolearn
137 def set_identity_pool_roles(
138     IdentityPoolId,
139     AuthenticatedRole=None,
140     UnauthenticatedRole=None,
141     region=None,
142     key=None,
143     keyid=None,
144     profile=None,
145 ):
146     conn_params = dict(region=region, key=key, keyid=keyid, profile=profile)
147     conn = _get_conn(**conn_params)
148     try:
149         if AuthenticatedRole:
150             role_arn = _get_role_arn(AuthenticatedRole, **conn_params)
151             if role_arn is None:
152                 return {
153                     "set": False,
154                     "error": "invalid AuthenticatedRole {}".format(AuthenticatedRole),
155                 }
156             AuthenticatedRole = role_arn
157         if UnauthenticatedRole:
158             role_arn = _get_role_arn(UnauthenticatedRole, **conn_params)
159             if role_arn is None:
160                 return {
161                     "set": False,
162                     "error": "invalid UnauthenticatedRole {}".format(
163                         UnauthenticatedRole
164                     ),
165                 }
166             UnauthenticatedRole = role_arn
167         Roles = dict()
168         if AuthenticatedRole:
169             Roles["authenticated"] = AuthenticatedRole
170         if UnauthenticatedRole:
171             Roles["unauthenticated"] = UnauthenticatedRole
172         conn.set_identity_pool_roles(IdentityPoolId=IdentityPoolId, Roles=Roles)
173         return {"set": True, "roles": Roles}
174     except ClientError as e:
175         return {"set": False, "error": __utils__["boto3.get_error"](<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>e)}
176 def update_identity_pool(
177     IdentityPoolId,
178     IdentityPoolName=None,
179     AllowUnauthenticatedIdentities=False,
180     SupportedLoginProviders=None,
181     DeveloperProviderName=None,
182     OpenIdConnectProviderARNs=None,
183     region=None,
184     key=None,
185     keyid=None,
186     profile=None,
187 ):
188     conn_params =</b></font> dict(region=region, key=key, keyid=keyid, profile=profile)
189     response = describe_identity_pools("", IdentityPoolId=IdentityPoolId, **conn_params)
190     error = response.get("error")
191     if error is None:
192         error = "No matching pool" if response.get("identity_pools") is None else None
193     if error:
194         return {"updated": False, "error": error}
195     id_pool = response.get("identity_pools")[0]
196     request_params = id_pool.copy()
197     if IdentityPoolName is not None and IdentityPoolName != request_params.get(
198         "IdentityPoolName"
199     ):
200         request_params["IdentityPoolName"] = IdentityPoolName
201     if AllowUnauthenticatedIdentities != request_params.get(
202         "AllowUnauthenticatedIdentities"
203     ):
204         request_params[
205             "AllowUnauthenticatedIdentities"
206         ] = AllowUnauthenticatedIdentities
207     current_val = request_params.pop("SupportedLoginProviders", None)
208     if SupportedLoginProviders is not None and SupportedLoginProviders != current_val:
209         request_params["SupportedLoginProviders"] = SupportedLoginProviders
210     current_val = request_params.pop("DeveloperProviderName", None)
211     if current_val is None and DeveloperProviderName is not None:
212         request_params["DeveloperProviderName"] = DeveloperProviderName
213     current_val = request_params.pop("OpenIdConnectProviderARNs", None)
214     if (
215         OpenIdConnectProviderARNs is not None
216         and OpenIdConnectProviderARNs != current_val
217     ):
218         request_params["OpenIdConnectProviderARNs"] = OpenIdConnectProviderARNs
219     conn = _get_conn(**conn_params)
220     try:
221         response = conn.update_identity_pool(**request_params)
222         response.pop("ResponseMetadata", None)
223         return {"updated": True, "identity_pool": response}
224     except ClientError as e:
225         return {"updated": False, "error": __utils__["boto3.get_error"](e)}
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>user_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import salt.utils.data
4 import salt.utils.dateutils
5 import salt.utils.platform
6 import salt.utils.user
7 import salt.utils.versions
8 from salt.exceptions import CommandExecutionError
9 log = logging.getLogger(__name__)
10 def _group_changes(cur, wanted, remove=False):
11     old = set(cur)
12     if (remove and old != new) or (not remove and not new.issubset(old)):
13         return True
14     r<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>eturn False
15 def _changes(
16     name,
17     uid=None,
18     gid=None,
19     groups=None,
20     optional_groups=None,
21     remove_groups=True,
22     home=None,
23     createhome=True,
24     password=None,
25     enforce_password=True,
26     empty_password=</b></font>False,
27     shell=None,
28     fullname="",
29     roomnumber="",
30     workphone="",
31     homephone="",
32     other="",
33     loginclass=None,
34     date=None,
35     mindays=0,
36     maxdays=999999,
37     inactdays=0,
38     warndays=7,
39     expire=None,
40     win_homedrive=None,
41     win_profile=None,
42     win_logonscript=None,
43     win_description=None,
44     allow_uid_change=False,
45     allow_gid_change=False,
46 ):
47     if "shadow.info" in __salt__:
48         lshad = __salt__["shadow.info"](name)
49     lusr = __salt__["user.info"](name)
50     if not lusr:
51         return False
52     change = {}
53     if groups is None:
54         groups = lusr["groups"]
55     wanted_groups = sorted(set((groups or []) + (optional_groups or [])))
56     if uid and lusr["uid"] != uid:
57         change["uid"] = uid
58     if gid is not None and lusr["gid"] not in (gid, __salt__["file.group_to_gid"](gid)):
59         change["gid"] = gid
60     default_grp = __salt__["file.gid_to_group"](gid if gid is not None else lusr["gid"])
61     old_default_grp = __salt__["file.gid_to_group"](lusr["gid"])
62     if default_grp in lusr["groups"]:
63         lusr["groups"].remove(default_grp)
64     if old_default_grp != default_grp and old_default_grp in lusr["groups"]:
65         lusr["groups"].remove(old_default_grp)
66     if name in lusr["groups"] and name not in wanted_groups:
67         lusr["groups"].remove(name)
68     if default_grp in wanted_groups:
69         wanted_groups.remove(default_grp)
70     if _group_changes(lusr["groups"], wanted_groups, remove_groups):
71         change["groups"] = wanted_groups
72     if home and lusr["home"] != home:
73         change["home"] = home
74     if createhome:
75         newhome = home if home else lusr["home"]
76         if newhome is not None and not os.path.isdir(newhome):
77             change["homeDoesNotExist"] = newhome
78     if shell and lusr["shell"] != shell:
79         change["shell"] = shell
80     if "shadow.info" in __salt__ and "shadow.default_hash" in __salt__:
81         if password and not empty_password:
82             default_hash = __salt__["shadow.default_hash"]()
83             if (
84                 lshad["passwd"] == default_hash
85                 or lshad["passwd"] != default_hash
86                 and enforce_password
87             ):
88                 if lshad["passwd"] != password:
89                     change["passwd"] = password
90         if empty_password and lshad["passwd"] != "":
91             change["empty_password"] = True
92         if date is not None and lshad["lstchg"] != date:
93             change["date"] = date
94         if mindays is not None and lshad["min"] != mindays:
95             change["mindays"] = mindays
96         if maxdays is not None and lshad["max"] != maxdays:
97             change["maxdays"] = maxdays
98         if inactdays is not None and lshad["inact"] != inactdays:
99             change["inactdays"] = inactdays
100         if warndays is not None and lshad["warn"] != warndays:
101             change["warndays"] = warndays
102         if expire and lshad["expire"] != expire:
103             change["expire"] = expire
104     elif "shadow.info" in __salt__ and salt.utils.platform.is_windows():
105         if (
106             expire
107             and expire != -1
108             and salt.utils.dateutils.strftime(lshad["expire"])
109             != salt.utils.dateutils.strftime(expire)
110         ):
111             change["expire"] = expire
112     fullname = salt.utils.data.decode(fullname)
113     lusr["fullname"] = salt.utils.data.decode(lusr["fullname"])
114     if fullname is not None and lusr["fullname"] != fullname:
115         change["fullname"] = fullname
116     if win_homedrive and lusr["homedrive"] != win_homedrive:
117         change["win_homedrive"] = win_homedrive
118     if win_profile and lusr["profile"] != win_profile:
119         change["win_profile"] = win_profile
120     if win_logonscript and lusr["logonscript"] != win_logonscript:
121         change["win_logonscript"] = win_logonscript
122     if win_description and lusr["description"] != win_description:
123         change["win_description"] = win_description
124     if "user.chroomnumber" in __salt__ and roomnumber is not None:
125         roomnumber = salt.utils.data.decode(roomnumber)
126         lusr["roomnumber"] = salt.utils.data.decode(lusr["roomnumber"])
127         if lusr["roomnumber"] != roomnumber:
128             change["roomnumber"] = roomnumber
129     if "user.chworkphone" in __salt__ and workphone is not None:
130         workphone = salt.utils.data.decode(workphone)
131         lusr["workphone"] = salt.utils.data.decode(lusr["workphone"])
132         if lusr["workphone"] != workphone:
133             change["workphone"] = workphone
134     if "user.chhomephone" in __salt__ and homephone is not None:
135         homephone = salt.utils.data.decode(homephone)
136         lusr["homephone"] = salt.utils.data.decode(lusr["homephone"])
137         if lusr["homephone"] != homephone:
138             change["homephone"] = homephone
139     if "user.chother" in __salt__ and other is not None:
140         other = salt.utils.data.decode(other)
141         lusr["other"] = salt.utils.data.decode(lusr["other"])
142         if lusr["other"] != other:
143             change["other"] = other
144     if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
145         if loginclass:
146             if __salt__["user.get_loginclass"](name) != loginclass:
147                 change["loginclass"] = loginclass
148     errors = []
149     if not allow_uid_change and "uid" in change:
150         errors.append(
151             "Changing uid ({} -&gt; {}) not permitted, set allow_uid_change to "
152             "True to force this change. Note that this will not change file "
153             "ownership.".format(lusr["uid"], uid)
154         )
155     if not allow_gid_change and "gid" in change:
156         errors.append(
157             "Changing gid ({} -&gt; {}) not permitted, set allow_gid_change to "
158             "True to force this change. Note that this will not change file "
159             "ownership.".format(lusr["gid"], gid)
160         )
161     if errors:
162         raise CommandExecutionError(
163             "Encountered error checking for needed changes", info=errors
164         )
165     return change
166 def present(
167     name,
168     uid=None,
169     gid=None,
170     usergroup=None,
171     groups=None,
172     optional_groups=None,
173     remove_groups=True,
174     home=None,
175     createhome=True,
176     password=None,
177     hash_password=False,
178     enforce_password=True,
179     empty_password=False,
180     shell=None,
181     unique=True,
182     system=False,
183     fullname=None,
184     roomnumber=None,
185     workphone=None,
186     homephone=None,
187     other=None,
188     loginclass=None,
189     date=None,
190     mindays=None,
191     maxdays=None,
192     inactdays=None,
193     warndays=None,
194     expire=None,
195     win_homedrive=None,
196     win_profile=None,
197     win_logonscript=None,
198     win_description=None,
199     nologinit=False,
200     allow_uid_change=False,
201     allow_gid_change=False,
202 ):
203     if password and hash_password:
204         log.debug("Hashing a clear text password")
205         algorithms = {
206             "1": "md5",
207             "2a": "blowfish",
208             "5": "sha256",
209             "6": "sha512",
210         }
211         try:
212             _, algo, shadow_salt, shadow_hash = __salt__["shadow.info"](name)[
213                 "passwd"
214             ].split("$", 4)
215             if algo == "1":
216                 log.warning("Using MD5 for hashing passwords is considered insecure!")
217             log.debug(
218                 "Re-using existing shadow salt for hashing password using %s",
219                 algorithms.get(algo),
220             )
221             password = __salt__["shadow.gen_password"](
222                 password, crypt_salt=shadow_salt, algorithm=algorithms.get(algo)
223             )
224         except ValueError:
225             log.info(
226                 "No existing shadow salt found, defaulting to a randomly generated"
227                 " new one"
228             )
229             password = __salt__["shadow.gen_password"](password)
230     if fullname is not None:
231         fullname = salt.utils.data.decode(str(fullname))
232     if roomnumber is not None:
233         roomnumber = salt.utils.data.decode(str(roomnumber))
234     if workphone is not None:
235         workphone = salt.utils.data.decode(str(workphone))
236     if homephone is not None:
237         homephone = salt.utils.data.decode(str(homephone))
238     if other is not None:
239         other = salt.utils.data.decode(str(other))
240     if __grains__["kernel"] == "Windows":
241         createhome = False
242     ret = {
243         "name": name,
244         "changes": {},
245         "result": True,
246         "comment": "User {} is present and up to date".format(name),
247     }
248     for gecos_field in [fullname, roomnumber, workphone]:
249         if isinstance(gecos_field, str) and "," in gecos_field:
250             ret["comment"] = "Unsupported char ',' in {}".format(gecos_field)
251             ret["result"] = False
252             return ret
253     if groups:
254         missing_groups = [x for x in groups if not __salt__["group.info"](x)]
255         if missing_groups:
256             ret["comment"] = "The following group(s) are not present: {}".format(
257                 ",".join(missing_groups)
258             )
259             ret["result"] = False
260             return ret
261     if optional_groups:
262         present_optgroups = [x for x in optional_groups if __salt__["group.info"](x)]
263         for missing_optgroup in [
264             x for x in optional_groups if x not in present_optgroups
265         ]:
266             log.debug(
267                 'Optional group "%s" for user "%s" is not present',
268                 missing_optgroup,
269                 name,
270             )
271     else:
272         present_optgroups = None
273     if groups and optional_groups:
274         for isected in set(groups).intersection(optional_groups):
275             log.warning(
276                 'Group "%s" specified in both groups and optional_groups for user %s',
277                 isected,
278                 name,
279             )
280     if usergroup and __salt__["file.group_to_gid"](name) != "":
281         changes_gid = name
282     else:
283         changes_gid = gid
284     try:
285         changes = _changes(
286             name,
287             uid,
288             changes_gid,
289             groups,
290             present_optgroups,
291             remove_groups,
292             home,
293             createhome,
294             password,
295             enforce_password,
296             empty_password,
297             shell,
298             fullname,
299             roomnumber,
300             workphone,
301             homephone,
302             other,
303             loginclass,
304             date,
305             mindays,
306             maxdays,
307             inactdays,
308             warndays,
309             expire,
310             win_homedrive,
311             win_profile,
312             win_logonscript,
313             win_description,
314             allow_uid_change,
315             allow_gid_change,
316         )
317     except CommandExecutionError as exc:
318         ret["result"] = False
319         ret["comment"] = exc.strerror
320         return ret
321     if changes:
322         if __opts__["test"]:
323             ret["result"] = None
324             ret["comment"] = "The following user attributes are set to be changed:\n"
325             for key, val in changes.items():
326                 if key == "passwd":
327                     val = "XXX-REDACTED-XXX"
328                 elif key == "group" and not remove_groups:
329                     key = "ensure groups"
330                 ret["comment"] += "{}: {}\n".format(key, val)
331             return ret
332         if "shadow.info" in __salt__:
333             lshad = __salt__["shadow.info"](name)
334         if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
335             lcpre = __salt__["user.get_loginclass"](name)
336         pre = __salt__["user.info"](name)
337         if "passwd" in changes:
338             del changes["passwd"]
339             if not empty_password:
340                 __salt__["shadow.set_password"](name, password)
341             else:
342                 log.warning("No password will be set when empty_password=True")
343         if changes.pop("empty_password", False) is True:
344             __salt__["shadow.del_password"](name)
345         if "date" in changes:
346             del changes["date"]
347             __salt__["shadow.set_date"](name, date)
348         def _change_homedir(name, val):
349             if __grains__["kernel"] in ("Darwin", "Windows"):
350                 __salt__["user.chhome"](name, val)
351             else:
352                 __salt__["user.chhome"](name, val, persist=False)
353         _homedir_changed = False
354         if "home" in changes:
355             val = changes.pop("home")
356             if "homeDoesNotExist" not in changes:
357                 _change_homedir(name, val)
358                 _homedir_changed = True
359         if "homeDoesNotExist" in changes:
360             val = changes.pop("homeDoesNotExist")
361             if not _homedir_changed:
362                 _change_homedir(name, val)
363             if not os.path.isdir(val):
364                 __salt__["file.mkdir"](val, pre["uid"], pre["gid"], 0o755)
365         if "mindays" in changes:
366             del changes["mindays"]
367             __salt__["shadow.set_mindays"](name, mindays)
368         if "maxdays" in changes:
369             del changes["maxdays"]
370             __salt__["shadow.set_maxdays"](name, maxdays)
371         if "inactdays" in changes:
372             del changes["inactdays"]
373             __salt__["shadow.set_inactdays"](name, inactdays)
374         if "warndays" in changes:
375             del changes["warndays"]
376             __salt__["shadow.set_warndays"](name, warndays)
377         if "expire" in changes:
378             del changes["expire"]
379             __salt__["shadow.set_expire"](name, expire)
380         if "win_homedrive" in changes:
381             __salt__["user.update"](name=name, homedrive=changes.pop("win_homedrive"))
382         if "win_profile" in changes:
383             __salt__["user.update"](name=name, profile=changes.pop("win_profile"))
384         if "win_logonscript" in changes:
385             __salt__["user.update"](
386                 name=name, logonscript=changes.pop("win_logonscript")
387             )
388         if "win_description" in changes:
389             __salt__["user.update"](
390                 name=name, description=changes.pop("win_description")
391             )
392         for key in [
393             x
394             for x in list(changes)
395             if x != "groups" and "user.ch{}".format(x) in __salt__
396         ]:
397             __salt__["user.ch{}".format(key)](name, changes.pop(key))
398         if "groups" in changes:
399             __salt__["user.chgroups"](name, changes.pop("groups"), not remove_groups)
400         if changes:
401             ret.get("warnings", []).append(
402                 "Unhandled changes: {}".format(", ".join(changes))
403             )
404         post = __salt__["user.info"](name)
405         spost = {}
406         if "shadow.info" in __salt__ and lshad["passwd"] != password:
407             spost = __salt__["shadow.info"](name)
408         if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
409             lcpost = __salt__["user.get_loginclass"](name)
410         for key in post:
411             if post[key] != pre[key]:
412                 ret["changes"][key] = post[key]
413         if "shadow.info" in __salt__:
414             for key in spost:
415                 if lshad[key] != spost[key]:
416                     if key == "passwd":
417                         ret["changes"][key] = "XXX-REDACTED-XXX"
418                     else:
419                         ret["changes"][key] = spost[key]
420         if __grains__["kernel"] in ("OpenBSD", "FreeBSD") and lcpost != lcpre:
421             ret["changes"]["loginclass"] = lcpost
422         if ret["changes"]:
423             ret["comment"] = "Updated user {}".format(name)
424         changes = _changes(
425             name,
426             uid,
427             gid,
428             groups,
429             present_optgroups,
430             remove_groups,
431             home,
432             createhome,
433             password,
434             enforce_password,
435             empty_password,
436             shell,
437             fullname,
438             roomnumber,
439             workphone,
440             homephone,
441             other,
442             loginclass,
443             date,
444             mindays,
445             maxdays,
446             inactdays,
447             warndays,
448             expire,
449             win_homedrive,
450             win_profile,
451             win_logonscript,
452             win_description,
453             allow_uid_change=True,
454             allow_gid_change=True,
455         )
456         if changes:
457             ret["comment"] = "These values could not be changed: {}".format(changes)
458             ret["result"] = False
459         return ret
460     if changes is False:
461         if __opts__["test"]:
462             ret["result"] = None
463             ret["comment"] = "User {} set to be added".format(name)
464             return ret
465         if groups and present_optgroups:
466             groups.extend(present_optgroups)
467         elif present_optgroups:
468             groups = present_optgroups[:]
469         if not salt.utils.platform.is_windows():
470             params = {
471                 "name": name,
472                 "uid": uid,
473                 "gid": gid,
474                 "groups": groups,
475                 "home": home,
476                 "shell": shell,
477                 "unique": unique,
478                 "system": system,
479                 "fullname": fullname,
480                 "roomnumber": roomnumber,
481                 "workphone": workphone,
482                 "homephone": homephone,
483                 "other": other,
484                 "createhome": createhome,
485                 "nologinit": nologinit,
486                 "loginclass": loginclass,
487                 "usergroup": usergroup,
488             }
489         else:
490             params = {
491                 "name": name,
492                 "password": password,
493                 "fullname": fullname,
494                 "description": win_description,
495                 "groups": groups,
496                 "home": home,
497                 "homedrive": win_homedrive,
498                 "profile": win_profile,
499                 "logonscript": win_logonscript,
500             }
501         result = __salt__["user.add"](**params)
502         if result is True:
503             ret["comment"] = "New user {} created".format(name)
504             ret["changes"] = __salt__["user.info"](name)
505             if not createhome:
506                 ret["changes"]["home"] = ""
507             if (
508                 "shadow.info" in __salt__
509                 and not salt.utils.platform.is_windows()
510                 and not salt.utils.platform.is_darwin()
511             ):
512                 if password and not empty_password:
513                     __salt__["shadow.set_password"](name, password)
514                     spost = __salt__["shadow.info"](name)
515                     if spost["passwd"] != password:
516                         ret[
517                             "comment"
518                         ] = "User {} created but failed to set password to {}".format(
519                             name, "XXX-REDACTED-XXX"
520                         )
521                         ret["result"] = False
522                     ret["changes"]["password"] = "XXX-REDACTED-XXX"
523                 if empty_password and not password:
524                     __salt__["shadow.del_password"](name)
525                     spost = __salt__["shadow.info"](name)
526                     if spost["passwd"] != "":
527                         ret[
528                             "comment"
529                         ] = "User {} created but failed to empty password".format(name)
530                         ret["result"] = False
531                     ret["changes"]["password"] = ""
532                 if date is not None:
533                     __salt__["shadow.set_date"](name, date)
534                     spost = __salt__["shadow.info"](name)
535                     if spost["lstchg"] != date:
536                         ret["comment"] = (
537                             "User {} created but failed to set"
538                             " last change date to"
539                             " {}".format(name, date)
540                         )
541                         ret["result"] = False
542                     ret["changes"]["date"] = date
543                 if mindays:
544                     __salt__["shadow.set_mindays"](name, mindays)
545                     spost = __salt__["shadow.info"](name)
546                     if spost["min"] != mindays:
547                         ret["comment"] = (
548                             "User {} created but failed to set"
549                             " minimum days to"
550                             " {}".format(name, mindays)
551                         )
552                         ret["result"] = False
553                     ret["changes"]["mindays"] = mindays
554                 if maxdays:
555                     __salt__["shadow.set_maxdays"](name, maxdays)
556                     spost = __salt__["shadow.info"](name)
557                     if spost["max"] != maxdays:
558                         ret["comment"] = (
559                             "User {} created but failed to set"
560                             " maximum days to"
561                             " {}".format(name, maxdays)
562                         )
563                         ret["result"] = False
564                     ret["changes"]["maxdays"] = maxdays
565                 if inactdays:
566                     __salt__["shadow.set_inactdays"](name, inactdays)
567                     spost = __salt__["shadow.info"](name)
568                     if spost["inact"] != inactdays:
569                         ret["comment"] = (
570                             "User {} created but failed to set"
571                             " inactive days to"
572                             " {}".format(name, inactdays)
573                         )
574                         ret["result"] = False
575                     ret["changes"]["inactdays"] = inactdays
576                 if warndays:
577                     __salt__["shadow.set_warndays"](name, warndays)
578                     spost = __salt__["shadow.info"](name)
579                     if spost["warn"] != warndays:
580                         ret[
581                             "comment"
582                         ] = "User {} created but failed to set warn days to {}".format(
583                             name, warndays
584                         )
585                         ret["result"] = False
586                     ret["changes"]["warndays"] = warndays
587                 if expire:
588                     __salt__["shadow.set_expire"](name, expire)
589                     spost = __salt__["shadow.info"](name)
590                     if spost["expire"] != expire:
591                         ret["comment"] = (
592                             "User {} created but failed to set"
593                             " expire days to"
594                             " {}".format(name, expire)
595                         )
596                         ret["result"] = False
597                     ret["changes"]["expire"] = expire
598             elif salt.utils.platform.is_windows():
599                 if password and not empty_password:
600                     if not __salt__["user.setpassword"](name, password):
601                         ret[
602                             "comment"
603                         ] = "User {} created but failed to set password to {}".format(
604                             name, "XXX-REDACTED-XXX"
605                         )
606                         ret["result"] = False
607                     ret["changes"]["passwd"] = "XXX-REDACTED-XXX"
608                 if expire:
609                     __salt__["shadow.set_expire"](name, expire)
610                     spost = __salt__["shadow.info"](name)
611                     if salt.utils.dateutils.strftime(
612                         spost["expire"]
613                     ) != salt.utils.dateutils.strftime(expire):
614                         ret["comment"] = (
615                             "User {} created but failed to set"
616                             " expire days to"
617                             " {}".format(name, expire)
618                         )
619                         ret["result"] = False
620                     ret["changes"]["expiration_date"] = spost["expire"]
621             elif salt.utils.platform.is_darwin() and password and not empty_password:
622                 if not __salt__["shadow.set_password"](name, password):
623                     ret[
624                         "comment"
625                     ] = "User {} created but failed to set password to {}".format(
626                         name, "XXX-REDACTED-XXX"
627                     )
628                     ret["result"] = False
629                 ret["changes"]["passwd"] = "XXX-REDACTED-XXX"
630         else:
631             if isinstance(result, str):
632                 ret["comment"] = result
633             else:
634                 ret["comment"] = "Failed to create new user {}".format(name)
635             ret["result"] = False
636     return ret
637 def absent(name, purge=False, force=False):
638     ret = {"name": name, "changes": {}, "result": True, "comment": ""}
639     lusr = __salt__["user.info"](name)
640     if lusr:
641         if __opts__["test"]:
642             ret["result"] = None
643             ret["comment"] = "User {} set for removal".format(name)
644             return ret
645         beforegroups = set(salt.utils.user.get_group_list(name))
646         ret["result"] = __salt__["user.delete"](name, purge, force)
647         aftergroups = {g for g in beforegroups if __salt__["group.info"](g)}
648         if ret["result"]:
649             ret["changes"] = {}
650             for g in beforegroups - aftergroups:
651                 ret["changes"]["{} group".format(g)] = "removed"
652             ret["changes"][name] = "removed"
653             ret["comment"] = "Removed user {}".format(name)
654         else:
655             ret["result"] = False
656             ret["comment"] = "Failed to remove user {}".format(name)
657         return ret
658     ret["comment"] = "User {} is not present".format(name)
659     return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
