<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for boto_cognitoidentity_1.py &amp; user_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for boto_cognitoidentity_1.py &amp; user_1.py
      </h3>
<h1 align="center">
        1.5%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>boto_cognitoidentity_1.py (3.125%)<th>user_1.py (1.038961%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(393-430)<td><a href="#" name="0">(47-61)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_cognitoidentity_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import salt.utils.compat
3 import salt.utils.versions
4 log = logging.getLogger(__name__)
5 try:
6     import boto
7     import boto3
8     from botocore.exceptions import ClientError
9     logging.getLogger("boto").setLevel(logging.CRITICAL)
10     logging.getLogger("boto3").setLevel(logging.CRITICAL)
11     HAS_BOTO = True
12 except ImportError:
13     HAS_BOTO = False
14 def __virtual__():
15     return salt.utils.versions.check_boto_reqs(boto_ver="2.8.0", boto3_ver="1.2.1")
16 def __init__(opts):
17     if HAS_BOTO:
18         __utils__["boto3.assign_funcs"](__name__, "cognito-identity")
19 def _find_identity_pool_ids(name, pool_id, conn):
20     ids = []
21     if pool_id is None:
22         for pools in __utils__["boto3.paged_call"](
23             conn.list_identity_pools,
24             marker_flag="NextToken",
25             marker_arg="NextToken",
26             MaxResults=25,
27         ):
28             for pool in pools["IdentityPools"]:
29                 if pool["IdentityPoolName"] == name:
30                     ids.append(pool["IdentityPoolId"])
31     else:
32         ids.append(pool_id)
33     return ids
34 def describe_identity_pools(
35     IdentityPoolName,
36     IdentityPoolId=None,
37     region=None,
38     key=None,
39     keyid=None,
40     profile=None,
41 ):
42     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
43     try:
44         ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
45         if ids:
46             results = []
47             for pool_id in ids:
48                 response = conn.describe_identity_pool(IdentityPoolId=pool_id)
49                 response.pop("ResponseMetadata", None)
50                 results.append(response)
51             return {"identity_pools": results}
52         else:
53             return {"identity_pools": None}
54     except ClientError as e:
55         return {"error": __utils__["boto3.get_error"](e)}
56 def create_identity_pool(
57     IdentityPoolName,
58     AllowUnauthenticatedIdentities=False,
59     SupportedLoginProviders=None,
60     DeveloperProviderName=None,
61     OpenIdConnectProviderARNs=None,
62     region=None,
63     key=None,
64     keyid=None,
65     profile=None,
66 ):
67     SupportedLoginProviders = (
68         dict() if SupportedLoginProviders is None else SupportedLoginProviders
69     )
70     OpenIdConnectProviderARNs = (
71         list() if OpenIdConnectProviderARNs is None else OpenIdConnectProviderARNs
72     )
73     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
74     try:
75         request_params = dict(
76             IdentityPoolName=IdentityPoolName,
77             AllowUnauthenticatedIdentities=AllowUnauthenticatedIdentities,
78             SupportedLoginProviders=SupportedLoginProviders,
79             OpenIdConnectProviderARNs=OpenIdConnectProviderARNs,
80         )
81         if DeveloperProviderName:
82             request_params["DeveloperProviderName"] = DeveloperProviderName
83         response = conn.create_identity_pool(**request_params)
84         response.pop("ResponseMetadata", None)
85         return {"created": True, "identity_pool": response}
86     except ClientError as e:
87         return {"created": False, "error": __utils__["boto3.get_error"](e)}
88 def delete_identity_pools(
89     IdentityPoolName,
90     IdentityPoolId=None,
91     region=None,
92     key=None,
93     keyid=None,
94     profile=None,
95 ):
96     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
97     try:
98         ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
99         count = 0
100         if ids:
101             for pool_id in ids:
102                 conn.delete_identity_pool(IdentityPoolId=pool_id)
103                 count += 1
104             return {"deleted": True, "count": count}
105         else:
106             return {"deleted": False, "count": count}
107     except ClientError as e:
108         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
109 def get_identity_pool_roles(
110     IdentityPoolName,
111     IdentityPoolId=None,
112     region=None,
113     key=None,
114     keyid=None,
115     profile=None,
116 ):
117     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
118     try:
119         ids = _find_identity_pool_ids(IdentityPoolName, IdentityPoolId, conn)
120         if ids:
121             results = []
122             for pool_id in ids:
123                 response = conn.get_identity_pool_roles(IdentityPoolId=pool_id)
124                 response.pop("ResponseMetadata", None)
125                 results.append(response)
126             return {"identity_pool_roles": results}
127         else:
128             return {"identity_pool_roles": None}
129     except ClientError as e:
130         return {"error": __utils__["boto3.get_error"](e)}
131 def _get_role_arn(name, **conn_params):
132     if name.startswith("arn:aws:iam"):
133         return name
134     role = __salt__["boto_iam.describe_role"](name, **conn_params)
135     rolearn = role.get("arn") if role else None
136     return rolearn
137 def set_identity_pool_roles(
138     IdentityPoolId,
139     AuthenticatedRole=None,
140     UnauthenticatedRole=None,
141     region=None,
142     key=None,
143     keyid=None,
144     profile=None,
145 ):
146     conn_params = dict(region=region, key=key, keyid=keyid, profile=profile)
147     conn = _get_conn(**conn_params)
148     try:
149         if AuthenticatedRole:
150             role_arn = _get_role_arn(AuthenticatedRole, **conn_params)
151             if role_arn is None:
152                 return {
153                     "set": False,
154                     "error": "invalid AuthenticatedRole {}".format(AuthenticatedRole),
155                 }
156             AuthenticatedRole = role_arn
157         if UnauthenticatedRole:
158             role_arn = _get_role_arn(UnauthenticatedRole, **conn_params)
159             if role_arn is None:
160                 return {
161                     "set": False,
162                     "error": "invalid UnauthenticatedRole {}".format(
163                         UnauthenticatedRole
164                     ),
165                 }
166             UnauthenticatedRole = role_arn
167         Roles = dict()
168         if AuthenticatedRole:
169             Roles["authenticated"] = AuthenticatedRole
170         if UnauthenticatedRole:
171             Roles["unauthenticated"] = UnauthenticatedRole
172         conn.set_identity_pool_roles(IdentityPoolId=IdentityPoolId, Roles=Roles)
173 <a name="0"></a>
174         return {"set": True, "roles": Roles}
175     except ClientError as e:
176         return {"set": False, "error": __utils__["boto3.get_error"](<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>e)}
177 def update_identity_pool(
178     IdentityPoolId,
179     IdentityPoolName=None,
180     AllowUnauthenticatedIdentities=False,
181     SupportedLoginProviders=None,
182     DeveloperProviderName=None,
183     OpenIdConnectProviderARNs=None,
184     region=None,
185     key=None,
186     keyid=None,
187     profile=None,
188 ):
189     conn_params =</b></font> dict(region=region, key=key, keyid=keyid, profile=profile)
190     response = describe_identity_pools("", IdentityPoolId=IdentityPoolId, **conn_params)
191     error = response.get("error")
192     if error is None:
193         error = "No matching pool" if response.get("identity_pools") is None else None
194     if error:
195         return {"updated": False, "error": error}
196     id_pool = response.get("identity_pools")[0]
197     request_params = id_pool.copy()
198     if IdentityPoolName is not None and IdentityPoolName != request_params.get(
199         "IdentityPoolName"
200     ):
201         request_params["IdentityPoolName"] = IdentityPoolName
202     if AllowUnauthenticatedIdentities != request_params.get(
203         "AllowUnauthenticatedIdentities"
204     ):
205         request_params[
206             "AllowUnauthenticatedIdentities"
207         ] = AllowUnauthenticatedIdentities
208     current_val = request_params.pop("SupportedLoginProviders", None)
209     if SupportedLoginProviders is not None and SupportedLoginProviders != current_val:
210         request_params["SupportedLoginProviders"] = SupportedLoginProviders
211     current_val = request_params.pop("DeveloperProviderName", None)
212     if current_val is None and DeveloperProviderName is not None:
213         request_params["DeveloperProviderName"] = DeveloperProviderName
214     current_val = request_params.pop("OpenIdConnectProviderARNs", None)
215     if (
216         OpenIdConnectProviderARNs is not None
217         and OpenIdConnectProviderARNs != current_val
218     ):
219         request_params["OpenIdConnectProviderARNs"] = OpenIdConnectProviderARNs
220     conn = _get_conn(**conn_params)
221     try:
222         response = conn.update_identity_pool(**request_params)
223         response.pop("ResponseMetadata", None)
224         return {"updated": True, "identity_pool": response}
225     except ClientError as e:
226         return {"updated": False, "error": __utils__["boto3.get_error"](e)}
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>user_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import salt.utils.data
4 import salt.utils.dateutils
5 import salt.utils.platform
6 import salt.utils.user
7 import salt.utils.versions
8 from salt.exceptions import CommandExecutionError
9 log = logging.getLogger(__name__)
10 def _group_changes(cur, wanted, remove=False):
11     old = set(cur)
12 <a name="0"></a>    new = set(wanted)
13     if (remove and old != new) or (not remove and not new.issubset(old)):
14         return True
15     r<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>eturn False
16 def _changes(
17     name,
18     uid=None,
19     gid=None,
20     groups=None,
21     optional_groups=None,
22     remove_groups=True,
23     home=None,
24     createhome=True,
25     password=None,
26     enforce_password=True,
27     empty_password=</b></font>False,
28     shell=None,
29     fullname="",
30     roomnumber="",
31     workphone="",
32     homephone="",
33     other="",
34     loginclass=None,
35     date=None,
36     mindays=0,
37     maxdays=999999,
38     inactdays=0,
39     warndays=7,
40     expire=None,
41     win_homedrive=None,
42     win_profile=None,
43     win_logonscript=None,
44     win_description=None,
45     allow_uid_change=False,
46     allow_gid_change=False,
47 ):
48     if "shadow.info" in __salt__:
49         lshad = __salt__["shadow.info"](name)
50     lusr = __salt__["user.info"](name)
51     if not lusr:
52         return False
53     change = {}
54     if groups is None:
55         groups = lusr["groups"]
56     wanted_groups = sorted(set((groups or []) + (optional_groups or [])))
57     if uid and lusr["uid"] != uid:
58         change["uid"] = uid
59     if gid is not None and lusr["gid"] not in (gid, __salt__["file.group_to_gid"](gid)):
60         change["gid"] = gid
61     default_grp = __salt__["file.gid_to_group"](gid if gid is not None else lusr["gid"])
62     old_default_grp = __salt__["file.gid_to_group"](lusr["gid"])
63     if default_grp in lusr["groups"]:
64         lusr["groups"].remove(default_grp)
65     if old_default_grp != default_grp and old_default_grp in lusr["groups"]:
66         lusr["groups"].remove(old_default_grp)
67     if name in lusr["groups"] and name not in wanted_groups:
68         lusr["groups"].remove(name)
69     if default_grp in wanted_groups:
70         wanted_groups.remove(default_grp)
71     if _group_changes(lusr["groups"], wanted_groups, remove_groups):
72         change["groups"] = wanted_groups
73     if home and lusr["home"] != home:
74         change["home"] = home
75     if createhome:
76         newhome = home if home else lusr["home"]
77         if newhome is not None and not os.path.isdir(newhome):
78             change["homeDoesNotExist"] = newhome
79     if shell and lusr["shell"] != shell:
80         change["shell"] = shell
81     if "shadow.info" in __salt__ and "shadow.default_hash" in __salt__:
82         if password and not empty_password:
83             default_hash = __salt__["shadow.default_hash"]()
84             if (
85                 lshad["passwd"] == default_hash
86                 or lshad["passwd"] != default_hash
87                 and enforce_password
88             ):
89                 if lshad["passwd"] != password:
90                     change["passwd"] = password
91         if empty_password and lshad["passwd"] != "":
92             change["empty_password"] = True
93         if date is not None and lshad["lstchg"] != date:
94             change["date"] = date
95         if mindays is not None and lshad["min"] != mindays:
96             change["mindays"] = mindays
97         if maxdays is not None and lshad["max"] != maxdays:
98             change["maxdays"] = maxdays
99         if inactdays is not None and lshad["inact"] != inactdays:
100             change["inactdays"] = inactdays
101         if warndays is not None and lshad["warn"] != warndays:
102             change["warndays"] = warndays
103         if expire and lshad["expire"] != expire:
104             change["expire"] = expire
105     elif "shadow.info" in __salt__ and salt.utils.platform.is_windows():
106         if (
107             expire
108             and expire != -1
109             and salt.utils.dateutils.strftime(lshad["expire"])
110             != salt.utils.dateutils.strftime(expire)
111         ):
112             change["expire"] = expire
113     fullname = salt.utils.data.decode(fullname)
114     lusr["fullname"] = salt.utils.data.decode(lusr["fullname"])
115     if fullname is not None and lusr["fullname"] != fullname:
116         change["fullname"] = fullname
117     if win_homedrive and lusr["homedrive"] != win_homedrive:
118         change["win_homedrive"] = win_homedrive
119     if win_profile and lusr["profile"] != win_profile:
120         change["win_profile"] = win_profile
121     if win_logonscript and lusr["logonscript"] != win_logonscript:
122         change["win_logonscript"] = win_logonscript
123     if win_description and lusr["description"] != win_description:
124         change["win_description"] = win_description
125     if "user.chroomnumber" in __salt__ and roomnumber is not None:
126         roomnumber = salt.utils.data.decode(roomnumber)
127         lusr["roomnumber"] = salt.utils.data.decode(lusr["roomnumber"])
128         if lusr["roomnumber"] != roomnumber:
129             change["roomnumber"] = roomnumber
130     if "user.chworkphone" in __salt__ and workphone is not None:
131         workphone = salt.utils.data.decode(workphone)
132         lusr["workphone"] = salt.utils.data.decode(lusr["workphone"])
133         if lusr["workphone"] != workphone:
134             change["workphone"] = workphone
135     if "user.chhomephone" in __salt__ and homephone is not None:
136         homephone = salt.utils.data.decode(homephone)
137         lusr["homephone"] = salt.utils.data.decode(lusr["homephone"])
138         if lusr["homephone"] != homephone:
139             change["homephone"] = homephone
140     if "user.chother" in __salt__ and other is not None:
141         other = salt.utils.data.decode(other)
142         lusr["other"] = salt.utils.data.decode(lusr["other"])
143         if lusr["other"] != other:
144             change["other"] = other
145     if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
146         if loginclass:
147             if __salt__["user.get_loginclass"](name) != loginclass:
148                 change["loginclass"] = loginclass
149     errors = []
150     if not allow_uid_change and "uid" in change:
151         errors.append(
152             "Changing uid ({} -&gt; {}) not permitted, set allow_uid_change to "
153             "True to force this change. Note that this will not change file "
154             "ownership.".format(lusr["uid"], uid)
155         )
156     if not allow_gid_change and "gid" in change:
157         errors.append(
158             "Changing gid ({} -&gt; {}) not permitted, set allow_gid_change to "
159             "True to force this change. Note that this will not change file "
160             "ownership.".format(lusr["gid"], gid)
161         )
162     if errors:
163         raise CommandExecutionError(
164             "Encountered error checking for needed changes", info=errors
165         )
166     return change
167 def present(
168     name,
169     uid=None,
170     gid=None,
171     usergroup=None,
172     groups=None,
173     optional_groups=None,
174     remove_groups=True,
175     home=None,
176     createhome=True,
177     password=None,
178     hash_password=False,
179     enforce_password=True,
180     empty_password=False,
181     shell=None,
182     unique=True,
183     system=False,
184     fullname=None,
185     roomnumber=None,
186     workphone=None,
187     homephone=None,
188     other=None,
189     loginclass=None,
190     date=None,
191     mindays=None,
192     maxdays=None,
193     inactdays=None,
194     warndays=None,
195     expire=None,
196     win_homedrive=None,
197     win_profile=None,
198     win_logonscript=None,
199     win_description=None,
200     nologinit=False,
201     allow_uid_change=False,
202     allow_gid_change=False,
203 ):
204     if password and hash_password:
205         log.debug("Hashing a clear text password")
206         algorithms = {
207             "1": "md5",
208             "2a": "blowfish",
209             "5": "sha256",
210             "6": "sha512",
211         }
212         try:
213             _, algo, shadow_salt, shadow_hash = __salt__["shadow.info"](name)[
214                 "passwd"
215             ].split("$", 4)
216             if algo == "1":
217                 log.warning("Using MD5 for hashing passwords is considered insecure!")
218             log.debug(
219                 "Re-using existing shadow salt for hashing password using %s",
220                 algorithms.get(algo),
221             )
222             password = __salt__["shadow.gen_password"](
223                 password, crypt_salt=shadow_salt, algorithm=algorithms.get(algo)
224             )
225         except ValueError:
226             log.info(
227                 "No existing shadow salt found, defaulting to a randomly generated"
228                 " new one"
229             )
230             password = __salt__["shadow.gen_password"](password)
231     if fullname is not None:
232         fullname = salt.utils.data.decode(str(fullname))
233     if roomnumber is not None:
234         roomnumber = salt.utils.data.decode(str(roomnumber))
235     if workphone is not None:
236         workphone = salt.utils.data.decode(str(workphone))
237     if homephone is not None:
238         homephone = salt.utils.data.decode(str(homephone))
239     if other is not None:
240         other = salt.utils.data.decode(str(other))
241     if __grains__["kernel"] == "Windows":
242         createhome = False
243     ret = {
244         "name": name,
245         "changes": {},
246         "result": True,
247         "comment": "User {} is present and up to date".format(name),
248     }
249     for gecos_field in [fullname, roomnumber, workphone]:
250         if isinstance(gecos_field, str) and "," in gecos_field:
251             ret["comment"] = "Unsupported char ',' in {}".format(gecos_field)
252             ret["result"] = False
253             return ret
254     if groups:
255         missing_groups = [x for x in groups if not __salt__["group.info"](x)]
256         if missing_groups:
257             ret["comment"] = "The following group(s) are not present: {}".format(
258                 ",".join(missing_groups)
259             )
260             ret["result"] = False
261             return ret
262     if optional_groups:
263         present_optgroups = [x for x in optional_groups if __salt__["group.info"](x)]
264         for missing_optgroup in [
265             x for x in optional_groups if x not in present_optgroups
266         ]:
267             log.debug(
268                 'Optional group "%s" for user "%s" is not present',
269                 missing_optgroup,
270                 name,
271             )
272     else:
273         present_optgroups = None
274     if groups and optional_groups:
275         for isected in set(groups).intersection(optional_groups):
276             log.warning(
277                 'Group "%s" specified in both groups and optional_groups for user %s',
278                 isected,
279                 name,
280             )
281     if usergroup and __salt__["file.group_to_gid"](name) != "":
282         changes_gid = name
283     else:
284         changes_gid = gid
285     try:
286         changes = _changes(
287             name,
288             uid,
289             changes_gid,
290             groups,
291             present_optgroups,
292             remove_groups,
293             home,
294             createhome,
295             password,
296             enforce_password,
297             empty_password,
298             shell,
299             fullname,
300             roomnumber,
301             workphone,
302             homephone,
303             other,
304             loginclass,
305             date,
306             mindays,
307             maxdays,
308             inactdays,
309             warndays,
310             expire,
311             win_homedrive,
312             win_profile,
313             win_logonscript,
314             win_description,
315             allow_uid_change,
316             allow_gid_change,
317         )
318     except CommandExecutionError as exc:
319         ret["result"] = False
320         ret["comment"] = exc.strerror
321         return ret
322     if changes:
323         if __opts__["test"]:
324             ret["result"] = None
325             ret["comment"] = "The following user attributes are set to be changed:\n"
326             for key, val in changes.items():
327                 if key == "passwd":
328                     val = "XXX-REDACTED-XXX"
329                 elif key == "group" and not remove_groups:
330                     key = "ensure groups"
331                 ret["comment"] += "{}: {}\n".format(key, val)
332             return ret
333         if "shadow.info" in __salt__:
334             lshad = __salt__["shadow.info"](name)
335         if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
336             lcpre = __salt__["user.get_loginclass"](name)
337         pre = __salt__["user.info"](name)
338         if "passwd" in changes:
339             del changes["passwd"]
340             if not empty_password:
341                 __salt__["shadow.set_password"](name, password)
342             else:
343                 log.warning("No password will be set when empty_password=True")
344         if changes.pop("empty_password", False) is True:
345             __salt__["shadow.del_password"](name)
346         if "date" in changes:
347             del changes["date"]
348             __salt__["shadow.set_date"](name, date)
349         def _change_homedir(name, val):
350             if __grains__["kernel"] in ("Darwin", "Windows"):
351                 __salt__["user.chhome"](name, val)
352             else:
353                 __salt__["user.chhome"](name, val, persist=False)
354         _homedir_changed = False
355         if "home" in changes:
356             val = changes.pop("home")
357             if "homeDoesNotExist" not in changes:
358                 _change_homedir(name, val)
359                 _homedir_changed = True
360         if "homeDoesNotExist" in changes:
361             val = changes.pop("homeDoesNotExist")
362             if not _homedir_changed:
363                 _change_homedir(name, val)
364             if not os.path.isdir(val):
365                 __salt__["file.mkdir"](val, pre["uid"], pre["gid"], 0o755)
366         if "mindays" in changes:
367             del changes["mindays"]
368             __salt__["shadow.set_mindays"](name, mindays)
369         if "maxdays" in changes:
370             del changes["maxdays"]
371             __salt__["shadow.set_maxdays"](name, maxdays)
372         if "inactdays" in changes:
373             del changes["inactdays"]
374             __salt__["shadow.set_inactdays"](name, inactdays)
375         if "warndays" in changes:
376             del changes["warndays"]
377             __salt__["shadow.set_warndays"](name, warndays)
378         if "expire" in changes:
379             del changes["expire"]
380             __salt__["shadow.set_expire"](name, expire)
381         if "win_homedrive" in changes:
382             __salt__["user.update"](name=name, homedrive=changes.pop("win_homedrive"))
383         if "win_profile" in changes:
384             __salt__["user.update"](name=name, profile=changes.pop("win_profile"))
385         if "win_logonscript" in changes:
386             __salt__["user.update"](
387                 name=name, logonscript=changes.pop("win_logonscript")
388             )
389         if "win_description" in changes:
390             __salt__["user.update"](
391                 name=name, description=changes.pop("win_description")
392             )
393         for key in [
394             x
395             for x in list(changes)
396             if x != "groups" and "user.ch{}".format(x) in __salt__
397         ]:
398             __salt__["user.ch{}".format(key)](name, changes.pop(key))
399         if "groups" in changes:
400             __salt__["user.chgroups"](name, changes.pop("groups"), not remove_groups)
401         if changes:
402             ret.get("warnings", []).append(
403                 "Unhandled changes: {}".format(", ".join(changes))
404             )
405         post = __salt__["user.info"](name)
406         spost = {}
407         if "shadow.info" in __salt__ and lshad["passwd"] != password:
408             spost = __salt__["shadow.info"](name)
409         if __grains__["kernel"] in ("OpenBSD", "FreeBSD"):
410             lcpost = __salt__["user.get_loginclass"](name)
411         for key in post:
412             if post[key] != pre[key]:
413                 ret["changes"][key] = post[key]
414         if "shadow.info" in __salt__:
415             for key in spost:
416                 if lshad[key] != spost[key]:
417                     if key == "passwd":
418                         ret["changes"][key] = "XXX-REDACTED-XXX"
419                     else:
420                         ret["changes"][key] = spost[key]
421         if __grains__["kernel"] in ("OpenBSD", "FreeBSD") and lcpost != lcpre:
422             ret["changes"]["loginclass"] = lcpost
423         if ret["changes"]:
424             ret["comment"] = "Updated user {}".format(name)
425         changes = _changes(
426             name,
427             uid,
428             gid,
429             groups,
430             present_optgroups,
431             remove_groups,
432             home,
433             createhome,
434             password,
435             enforce_password,
436             empty_password,
437             shell,
438             fullname,
439             roomnumber,
440             workphone,
441             homephone,
442             other,
443             loginclass,
444             date,
445             mindays,
446             maxdays,
447             inactdays,
448             warndays,
449             expire,
450             win_homedrive,
451             win_profile,
452             win_logonscript,
453             win_description,
454             allow_uid_change=True,
455             allow_gid_change=True,
456         )
457         if changes:
458             ret["comment"] = "These values could not be changed: {}".format(changes)
459             ret["result"] = False
460         return ret
461     if changes is False:
462         if __opts__["test"]:
463             ret["result"] = None
464             ret["comment"] = "User {} set to be added".format(name)
465             return ret
466         if groups and present_optgroups:
467             groups.extend(present_optgroups)
468         elif present_optgroups:
469             groups = present_optgroups[:]
470         if not salt.utils.platform.is_windows():
471             params = {
472                 "name": name,
473                 "uid": uid,
474                 "gid": gid,
475                 "groups": groups,
476                 "home": home,
477                 "shell": shell,
478                 "unique": unique,
479                 "system": system,
480                 "fullname": fullname,
481                 "roomnumber": roomnumber,
482                 "workphone": workphone,
483                 "homephone": homephone,
484                 "other": other,
485                 "createhome": createhome,
486                 "nologinit": nologinit,
487                 "loginclass": loginclass,
488                 "usergroup": usergroup,
489             }
490         else:
491             params = {
492                 "name": name,
493                 "password": password,
494                 "fullname": fullname,
495                 "description": win_description,
496                 "groups": groups,
497                 "home": home,
498                 "homedrive": win_homedrive,
499                 "profile": win_profile,
500                 "logonscript": win_logonscript,
501             }
502         result = __salt__["user.add"](**params)
503         if result is True:
504             ret["comment"] = "New user {} created".format(name)
505             ret["changes"] = __salt__["user.info"](name)
506             if not createhome:
507                 ret["changes"]["home"] = ""
508             if (
509                 "shadow.info" in __salt__
510                 and not salt.utils.platform.is_windows()
511                 and not salt.utils.platform.is_darwin()
512             ):
513                 if password and not empty_password:
514                     __salt__["shadow.set_password"](name, password)
515                     spost = __salt__["shadow.info"](name)
516                     if spost["passwd"] != password:
517                         ret[
518                             "comment"
519                         ] = "User {} created but failed to set password to {}".format(
520                             name, "XXX-REDACTED-XXX"
521                         )
522                         ret["result"] = False
523                     ret["changes"]["password"] = "XXX-REDACTED-XXX"
524                 if empty_password and not password:
525                     __salt__["shadow.del_password"](name)
526                     spost = __salt__["shadow.info"](name)
527                     if spost["passwd"] != "":
528                         ret[
529                             "comment"
530                         ] = "User {} created but failed to empty password".format(name)
531                         ret["result"] = False
532                     ret["changes"]["password"] = ""
533                 if date is not None:
534                     __salt__["shadow.set_date"](name, date)
535                     spost = __salt__["shadow.info"](name)
536                     if spost["lstchg"] != date:
537                         ret["comment"] = (
538                             "User {} created but failed to set"
539                             " last change date to"
540                             " {}".format(name, date)
541                         )
542                         ret["result"] = False
543                     ret["changes"]["date"] = date
544                 if mindays:
545                     __salt__["shadow.set_mindays"](name, mindays)
546                     spost = __salt__["shadow.info"](name)
547                     if spost["min"] != mindays:
548                         ret["comment"] = (
549                             "User {} created but failed to set"
550                             " minimum days to"
551                             " {}".format(name, mindays)
552                         )
553                         ret["result"] = False
554                     ret["changes"]["mindays"] = mindays
555                 if maxdays:
556                     __salt__["shadow.set_maxdays"](name, maxdays)
557                     spost = __salt__["shadow.info"](name)
558                     if spost["max"] != maxdays:
559                         ret["comment"] = (
560                             "User {} created but failed to set"
561                             " maximum days to"
562                             " {}".format(name, maxdays)
563                         )
564                         ret["result"] = False
565                     ret["changes"]["maxdays"] = maxdays
566                 if inactdays:
567                     __salt__["shadow.set_inactdays"](name, inactdays)
568                     spost = __salt__["shadow.info"](name)
569                     if spost["inact"] != inactdays:
570                         ret["comment"] = (
571                             "User {} created but failed to set"
572                             " inactive days to"
573                             " {}".format(name, inactdays)
574                         )
575                         ret["result"] = False
576                     ret["changes"]["inactdays"] = inactdays
577                 if warndays:
578                     __salt__["shadow.set_warndays"](name, warndays)
579                     spost = __salt__["shadow.info"](name)
580                     if spost["warn"] != warndays:
581                         ret[
582                             "comment"
583                         ] = "User {} created but failed to set warn days to {}".format(
584                             name, warndays
585                         )
586                         ret["result"] = False
587                     ret["changes"]["warndays"] = warndays
588                 if expire:
589                     __salt__["shadow.set_expire"](name, expire)
590                     spost = __salt__["shadow.info"](name)
591                     if spost["expire"] != expire:
592                         ret["comment"] = (
593                             "User {} created but failed to set"
594                             " expire days to"
595                             " {}".format(name, expire)
596                         )
597                         ret["result"] = False
598                     ret["changes"]["expire"] = expire
599             elif salt.utils.platform.is_windows():
600                 if password and not empty_password:
601                     if not __salt__["user.setpassword"](name, password):
602                         ret[
603                             "comment"
604                         ] = "User {} created but failed to set password to {}".format(
605                             name, "XXX-REDACTED-XXX"
606                         )
607                         ret["result"] = False
608                     ret["changes"]["passwd"] = "XXX-REDACTED-XXX"
609                 if expire:
610                     __salt__["shadow.set_expire"](name, expire)
611                     spost = __salt__["shadow.info"](name)
612                     if salt.utils.dateutils.strftime(
613                         spost["expire"]
614                     ) != salt.utils.dateutils.strftime(expire):
615                         ret["comment"] = (
616                             "User {} created but failed to set"
617                             " expire days to"
618                             " {}".format(name, expire)
619                         )
620                         ret["result"] = False
621                     ret["changes"]["expiration_date"] = spost["expire"]
622             elif salt.utils.platform.is_darwin() and password and not empty_password:
623                 if not __salt__["shadow.set_password"](name, password):
624                     ret[
625                         "comment"
626                     ] = "User {} created but failed to set password to {}".format(
627                         name, "XXX-REDACTED-XXX"
628                     )
629                     ret["result"] = False
630                 ret["changes"]["passwd"] = "XXX-REDACTED-XXX"
631         else:
632             if isinstance(result, str):
633                 ret["comment"] = result
634             else:
635                 ret["comment"] = "Failed to create new user {}".format(name)
636             ret["result"] = False
637     return ret
638 def absent(name, purge=False, force=False):
639     ret = {"name": name, "changes": {}, "result": True, "comment": ""}
640     lusr = __salt__["user.info"](name)
641     if lusr:
642         if __opts__["test"]:
643             ret["result"] = None
644             ret["comment"] = "User {} set for removal".format(name)
645             return ret
646         beforegroups = set(salt.utils.user.get_group_list(name))
647         ret["result"] = __salt__["user.delete"](name, purge, force)
648         aftergroups = {g for g in beforegroups if __salt__["group.info"](g)}
649         if ret["result"]:
650             ret["changes"] = {}
651             for g in beforegroups - aftergroups:
652                 ret["changes"]["{} group".format(g)] = "removed"
653             ret["changes"][name] = "removed"
654             ret["comment"] = "Removed user {}".format(name)
655         else:
656             ret["result"] = False
657             ret["comment"] = "Failed to remove user {}".format(name)
658         return ret
659     ret["comment"] = "User {} is not present".format(name)
660     return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
