<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_composer_1.py &amp; test_mount.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_composer_1.py &amp; test_mount.py
      </h3>
<h1 align="center">
        18.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_composer_1.py (52.33918%)<th>test_mount.py (10.961421%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(178-183)<td><a href="#" name="0">(313-318)</a><td align="center"><font color="#ff0000">17</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(43-49)<td><a href="#" name="1">(269-274)</a><td align="center"><font color="#ff0000">17</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(128-131)<td><a href="#" name="2">(584-587)</a><td align="center"><font color="#e10000">15</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(105-108)<td><a href="#" name="3">(574-577)</a><td align="center"><font color="#e10000">15</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(96-99)<td><a href="#" name="4">(562-565)</a><td align="center"><font color="#e10000">15</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(166-174)<td><a href="#" name="5">(254-264)</a><td align="center"><font color="#d20000">14</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(74-84)<td><a href="#" name="6">(850-859)</a><td align="center"><font color="#c30000">13</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(71-74)<td><a href="#" name="7">(147-151)</a><td align="center"><font color="#c30000">13</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(191-193)<td><a href="#" name="8">(205-208)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(159-162)<td><a href="#" name="9">(549-552)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#ad5910")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#ad5910"><font color="#ad5910">-</font><td><a href="#" name="10">(154-156)<td><a href="#" name="10">(178-181)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#b041ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#b041ff"><font color="#b041ff">-</font><td><a href="#" name="11">(149-152)<td><a href="#" name="11">(542-545)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#571b7e")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#571b7e"><font color="#571b7e">-</font><td><a href="#" name="12">(87-90)<td><a href="#" name="12">(535-538)</a><td align="center"><font color="#b40000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_composer_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.composer as composer
2 from salt.exceptions import (
3     CommandExecutionError,
4     CommandNotFoundError,
5     SaltInvocationError,
6 )
7 from tests.support.mixins import LoaderModuleMockMixin
8 from tests.support.mock import MagicMock, patch
9 from tests.support.unit import TestCase
10 class ComposerTestCase(TestCase, LoaderModuleMockMixin):
11     def setup_loader_modules(self):
12         return {composer: {}}
13     def test_install(self):
14         mock = MagicMock(return_value=False)
15         with patch.object(composer, "_valid_composer", mock):
16             self.assertRaises(CommandNotFoundError, composer.install, "d")
17         mock = MagicMock(return_value=True)
18         with patch.object(composer, "_valid_composer", mock):
19             self.assertRaises(SaltInvocationError, composer.install, None)
20         mock = MagicMock(return_value=True)
21         with patch.object(composer, "_valid_composer", mock):
22             mock = MagicMock(return_value={<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"retcode": 1, "stderr": "A"})
23             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
24                 self.assertRaises(CommandExecutionError, composer.install, "d")
25         mock = MagicMock(return_value=True)
26         with patch.object(</b></font>composer, "_valid_composer", mock):
27             mock = MagicMock(return_value={"retcode": 0, "stderr": "A"})
28             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
29                 self.assertTrue(
30                     composer.install(
31                         "dir",
32                         None,
33                         None,
34                         None,
35                         None,
36                         None,
37                         None,
38                         None,
39                         None,
40                         None,
41                         True,
42                     )
43                 )
44         mock = MagicMock(return_value=True)
45         with patch.object(composer, "_valid_composer", mock):
46 <a name="6"></a>            rval = {<font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"retcode": 0, "stderr": "A", "stdout": "B"}
47             mock = MagicMock(return_value=rval)
48             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
49                 self.assertEqual(composer.install(</b></font><font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"dir"), rval)
50     def test_update(self):
51         mock = MagicMock(return_value=False)
52         with patch.object(composer, "_valid_composer", mock):
53 <a name="12"></a>            self.assertRaises(CommandNotFoundError, composer.</b></font>update, "d")
54         mock <font color="#571b7e"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
55         with patch.object(composer, "_valid_composer", mock):
56             mock = MagicMock(return_value=True)
57             with patch.object(</b></font>composer, "did_composer_install", mock):
58                 self.assertRaises(SaltInvocationError, composer.update, None)
59         mock = MagicMock(return_value=True)
60         with patch.object(composer, "_valid_composer", mock):
61             mock <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
62             with patch.object(composer, "did_composer_install", mock):
63                 mock = MagicMock(return_value={"retcode": 1, "stderr": "A"})
64                 with patch.dict(composer.__salt__, {"cmd.run_all"</b></font>: mock}):
65                     self.assertRaises(CommandExecutionError, composer.update, "d")
66         mock = MagicMock(return_value=True)
67         with patch.object(composer, "_valid_composer", mock):
68             mock <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
69             with patch.object(composer, "did_composer_install", mock):
70                 mock = MagicMock(return_value={"retcode": 0, "stderr": "A"})
71                 with patch.dict(composer.__salt__, {"cmd.run_all"</b></font>: mock}):
72                     self.assertTrue(
73                         composer.update(
74                             "dir",
75                             None,
76                             None,
77                             None,
78                             None,
79                             None,
80                             None,
81                             None,
82                             None,
83                             None,
84                             True,
85                         )
86                     )
87         mock = MagicMock(return_value=True)
88         with patch.object(composer, "_valid_composer", mock):
89             mock <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=False)
90             with patch.object(composer, "did_composer_install", mock):
91                 mock = MagicMock(return_value={"retcode": 0, "stderr": "A"})
92                 with patch.dict(composer.__salt__, {"cmd.run_all"</b></font>: mock}):
93                     self.assertTrue(
94                         composer.update(
95                             "dir",
96                             None,
97                             None,
98                             None,
99                             None,
100                             None,
101                             None,
102                             None,
103                             None,
104                             None,
105                             True,
106                         )
107 <a name="11"></a>                    )
108         mock <font color="#b041ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
109         with patch.object(composer, "_valid_composer", mock):
110 <a name="10"></a>            mock = MagicMock(return_value=True)
111             with patch.object(</b></font>composer, "did_composer_install", mock):
112                 rval = {"retcode": 0, "stderr": "A", "stdout": "B"}
113                 mock <font color="#ad5910"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=rval)
114                 with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
115 <a name="9"></a>                    self.assertEqual(composer.update(</b></font>"dir"), rval)
116         mock <font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
117         with patch.object(composer, "_valid_composer", mock):
118             mock = MagicMock(return_value=False)
119             with patch.object(</b></font>composer, "did_composer_install", mock):
120 <a name="5"></a>                rval = {"retcode": 0, "stderr": "A", "stdout": "B"}
121                 mock = MagicMock(return_value=rval)
122                 with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
123                     self.assertEqual(composer<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.update("dir"), rval)
124     def test_selfupdate(self):
125         mock = MagicMock(return_value=False)
126         with patch.object(composer, "_valid_composer", mock):
127             self.</b></font>assertRaises(CommandNotFoundError, composer.selfupdate)
128 <a name="0"></a>
129         mock = MagicMock(return_value=True)
130         with patch.object(composer, "_valid_composer", mock):
131             mock = MagicMock(return_value={<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"retcode": 1, "stderr": "A"})
132             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
133                 self.assertRaises(CommandExecutionError, composer.selfupdate)
134         mock = MagicMock(return_value=True)
135         with patch.object(</b></font>composer, "_valid_composer", mock):
136             mock = MagicMock(return_value={"retcode": 0, "stderr": "A"})
137             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
138                 self.assertTrue(composer.selfupdate(quiet=True))
139 <a name="8"></a>        mock = MagicMock(return_value=True)
140         with patch.object(composer, "_valid_composer", mock):
141             rval = {"retcode": 0, "stderr": "A", "stdout": "B"}
142             mock <font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=rval)
143             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
144                 self.assertEqual(composer.selfupdate(</b></font>), rval)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_mount.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import shutil
4 import sys
5 import textwrap
6 import pytest
7 import salt.modules.mount as mount
8 import salt.utils.files
9 import salt.utils.path
10 from salt.exceptions import CommandExecutionError
11 from tests.support.mock import MagicMock, mock_open, patch
12 log = logging.getLogger(__name__)
13 @pytest.fixture
14 def mock_shell_file():
15     return "A B C D F G\n"
16 @pytest.fixture
17 def config_initial_file():
18     inital_fsystem = [
19         "/:\n",
20         "\tdev\t\t= /dev/hd4\n",
21         "\tvfs\t\t= jfs2\n",
22         "\tlog\t\t= /dev/hd8\n",
23         "\tmount \t\t= automatic\n",
24         "\tcheck\t\t= false\n",
25         "\ttype\t\t= bootfs\n",
26         "\tvol\t\t= root\n",
27         "\tfree\t\t= true\n",
28         "\n",
29         "/home:\n",
30         "\tdev\t\t= /dev/hd1\n",
31         "\tvfs\t\t= jfs2\n",
32         "\tlog\t\t= /dev/hd8\n",
33         "\tmount\t\t= true\n",
34         "\tcheck\t\t= true\n",
35         "\tvol\t\t= /home\n",
36         "\tfree\t\t= false\n",
37         "\n",
38     ]
39     return inital_fsystem
40 @pytest.fixture
41 def configure_loader_modules():
42     return {mount: {}}
43 @pytest.fixture
44 def tmp_sub_dir(tmp_path):
45     directory = tmp_path / "filesystems-dir"
46     directory.mkdir()
47     yield directory
48     shutil.rmtree(str(directory))
49 @pytest.fixture
50 def config_file(tmp_sub_dir, config_initial_file):
51     filename = str(tmp_sub_dir / "filesystems")
52     with salt.utils.files.fopen(filename, "wb") as fp:
53         fp.writelines(salt.utils.data.encode(config_initial_file))
54     yield filename
55     os.remove(filename)
56 def test_active():
57     with patch.dict(mount.__grains__, {"os": "FreeBSD", "kernel": "FreeBSD"}):
58         mock = MagicMock(return_value="A B C D,E,F,uid=user1,gid=grp1")
59         mock_user = MagicMock(return_value={"uid": "100"})
60         mock_group = MagicMock(return_value={"gid": "100"})
61         with patch.dict(
62             mount.__salt__,
63             {
64                 "cmd.run_stdout": mock,
65                 "user.info": mock_user,
66                 "group.info": mock_group,
67             },
68         ):
69             assert mount.active() == {
70                 "B": {
71                     "device": "A",
72                     "opts": ["D", "E", "F", "uid=100", "gid=100"],
73                     "fstype": "C",
74                 }
75             }
76     with patch.dict(mount.__grains__, {"os": "Solaris", "kernel": "SunOS"}):
77         mock = MagicMock(return_value="A * B * C D/E/F")
78         with patch.dict(mount.__salt__, {"cmd.run_stdout": mock}):
79             assert mount.active() == {
80                 "B": {"device": "A", "opts": ["D", "E", "F"], "fstype": "C"}
81             }
82     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}):
83         mock = MagicMock(return_value="A * B * C D/E/F")
84         with patch.dict(mount.__salt__, {"cmd.run_stdout": mock}):
85             assert mount.active() == {"B": {"node": "A", "device": "*", "fstype": "*"}}
86     with patch.dict(mount.__grains__, {"os": "OpenBSD", "kernel": "OpenBSD"}):
87         mock = MagicMock(return_value={})
88         with patch.object(mount, "_active_mounts_openbsd", mock):
89             assert mount.active() == {}
90     with patch.dict(mount.__grains__, {"os": "MacOS", "kernel": "Darwin"}):
91         mock = MagicMock(return_value={})
92         with patch.object(mount, "_active_mounts_darwin", mock):
93             assert mount.active() == {}
94     with patch.dict(mount.__grains__, {"os": "MacOS", "kernel": "Darwin"}):
95         mock = MagicMock(return_value={})
96         with patch.object(mount, "_active_mountinfo", mock):
97             with patch.object(mount, "_active_mounts_darwin", mock):
98                 assert mount.active(extended=True) == {}
99     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}):
100         mock = MagicMock(return_value={})
101         with patch.object(mount, "_active_mounts_aix", mock):
102             assert mount.active() == {}
103 def test_fstab():
104     mock = MagicMock(return_value=False)
105 <a name="7"></a>    with patch.object(os.path, "isfile", mock):
106         assert mount.fstab() == {}
107     file_data = "\n".join([<font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>"#", "A B C D,E,F G H"])
108     mock = MagicMock(return_value=True)
109     with patch.dict(mount.__grains__, {"kernel": ""}), patch.object(
110         os.path, "isfile", mock
111     ), patch(</b></font>"salt.utils.files.fopen", mock_open(read_data=file_data)):
112         fstab = mount.fstab()
113         assert fstab == {
114             "B": {
115                 "device": "A",
116                 "dump": "G",
117                 "fstype": "C",
118                 "opts": ["D", "E", "F"],
119                 "pass": "H",
120             }
121         }, fstab
122 def test_vfstab():
123     mock = MagicMock(return_value=False)
124     with patch.object(os.path, "isfile", mock):
125         assert mount.vfstab() == {}
126     file_data = textwrap.dedent(
127     )
128     mock <font color="#ad5910"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=True)
129     with patch.dict(mount.__grains__, {"kernel": "SunOS"}), patch.object(
130         os.path, "isfile", mock
131     ), patch(</b></font>"salt.utils.files.fopen", mock_open(read_data=file_data)):
132         vfstab = mount.vfstab()
133         assert vfstab == {
134             "/tmp": {
135                 "device": "swap",
136                 "device_fsck": "-",
137                 "fstype": "tmpfs",
138                 "mount_at_boot": "yes",
139                 "opts": ["size=2048m"],
140                 "pass_fsck": "-",
141             }
142         }, vfstab
143 def test_filesystems():
144     file_data = textwrap.dedent(
145     )
146     mock <font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=True)
147     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.object(
148         os.path, "isfile", mock
149     ), patch(</b></font>"salt.utils.files.fopen", mock_open(read_data=file_data)):
150         assert mount.filesystems() == {}
151     file_data = textwrap.dedent(
152     )
153     mock = MagicMock(return_value=True)
154     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.object(
155         os.path, "isfile", mock
156     ), patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
157         fsyst = mount.filesystems()
158         test_fsyst = {
159             "/home": {
160                 "dev": "/dev/hd1",
161                 "vfs": "jfs2",
162                 "log": "/dev/hd8",
163                 "mount": "true",
164                 "check": "true",
165                 "vol": "/home",
166                 "free": "false",
167                 "quota": "no",
168             }
169         }
170         assert test_fsyst == fsyst
171 def test_rm_fstab():
172     mock_fstab = MagicMock(return_value={})
173 <a name="5"></a>    with patch.dict(mount.__grains__, {"kernel": ""}):
174         with patch.object(mount, "fstab", mock_fstab):
175             with patch("salt.utils.files.fopen", mock_open()):
176                 assert mount<font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.rm_fstab("name", "device")
177 def test_set_fstab(mock_shell_file):
178     mock = MagicMock(return_value=False)
179     with patch.object(os.</b></font>path, "isfile", mock):
180         pytest.raises(CommandExecutionError, mount.set_fstab, "A", "B", "C")
181 <a name="1"></a>
182     mock = MagicMock(return_value=True)
183     mock_read = MagicMock(side_effect=OSError)
184     with patch.object(os<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.path, "isfile", mock):
185         with patch.object(salt.utils.files, "fopen", mock_read):
186             pytest.raises(CommandExecutionError, mount.set_fstab, "A", "B", "C")
187     mock = MagicMock(return_value=True)
188     with patch.object(</b></font>os.path, "isfile", mock):
189         with patch("salt.utils.files.fopen", mock_open(read_data=mock_shell_file)):
190             assert mount.set_fstab("A", "B", "C") == "new"
191     mock = MagicMock(return_value=True)
192     with patch.object(os.path, "isfile", mock):
193         with patch("salt.utils.files.fopen", mock_open(read_data=mock_shell_file)):
194             assert mount.set_fstab("B", "A", "C", "D", "F", "G") == "present"
195     mock = MagicMock(return_value=True)
196     with patch.object(os.path, "isfile", mock):
197         with patch("salt.utils.files.fopen", mock_open(read_data=mock_shell_file)):
198             assert mount.set_fstab("B", "A", "C", not_change=True) == "present"
199 def test_rm_automaster():
200     mock = MagicMock(return_value={})
201     with patch.object(mount, "automaster", mock):
202         assert mount.rm_automaster("name", "device")
203     mock = MagicMock(return_value={"name": "name"})
204     with patch.object(mount, "fstab", mock):
205         assert mount.rm_automaster("name", "device")
206 def test_set_automaster(mock_shell_file):
207     mock = MagicMock(return_value=True)
208     with patch.object(os.path, "isfile", mock):
209         pytest.raises(CommandExecutionError, mount.set_automaster, "A", "B", "C")
210 <a name="0"></a>
211     mock = MagicMock(return_value=True)
212     mock_read = MagicMock(side_effect=OSError)
213     with patch.object(os<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.path, "isfile", mock):
214         with patch.object(salt.utils.files, "fopen", mock_read):
215             pytest.raises(CommandExecutionError, mount.set_automaster, "A", "B", "C")
216     mock = MagicMock(return_value=True)
217     with patch.object(</b></font>os.path, "isfile", mock):
218         with patch("salt.utils.files.fopen", mock_open(read_data=mock_shell_file)):
219             assert mount.set_automaster("A", "B", "C") == "new"
220     mock = MagicMock(return_value=True)
221     with patch.object(os.path, "isfile", mock):
222         with patch(
223             "salt.utils.files.fopen", mock_open(read_data="/..A -fstype=C,D C:B")
224         ):
225             assert mount.set_automaster("A", "B", "C", "D") == "present"
226     mock = MagicMock(return_value=True)
227     with patch.object(os.path, "isfile", mock):
228         with patch(
229             "salt.utils.files.fopen", mock_open(read_data="/..A -fstype=XX C:B")
230         ):
231             assert (
232                 mount.set_automaster("A", "B", "C", "D", not_change=True) == "present"
233             )
234 def test_automaster():
235     assert mount.automaster() == {}
236 def test_rm_filesystems():
237     file_data = textwrap.dedent(
238     )
239     mock = MagicMock(return_value=True)
240     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.object(
241         os.path, "isfile", mock
242     ), patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
243         assert not mount.rm_filesystems("name", "device")
244     file_data = textwrap.dedent(
245     )
246     mock = MagicMock(return_value=True)
247     mock_fsyst = MagicMock(return_value=True)
248     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.object(
249         os.path, "isfile", mock
250     ), patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
251         assert mount.rm_filesystems("/name", "device")
252 def test_set_filesystems():
253     mock = MagicMock(return_value=False)
254     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}):
255         with patch.object(os.path, "isfile", mock):
256             pytest.raises(CommandExecutionError, mount.set_filesystems, "A", "B", "C")
257         mock_read = MagicMock(side_effect=OSError)
258         with patch.object(os.path, "isfile", mock):
259             with patch.object(salt.utils.files, "fopen", mock_read):
260                 pytest.raises(
261                     CommandExecutionError, mount.set_filesystems, "A", "B", "C"
262                 )
263 @pytest.mark.skipif(
264     sys.version_info[0] == 3 and sys.version_info[1] &lt;= 5,
265     reason="run on Python 3.6 or greater where OrderedDict is default",
266 )
267 @pytest.mark.skip_on_windows(
268     reason="Not supported on Windows, does not handle tabs well"
269 )
270 def test_set_filesystems_with_data(tmp_sub_dir, config_file):
271     config_filepath = str(tmp_sub_dir / "filesystems")
272     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}):
273         mount.set_filesystems(
274             "/test_mount", "/dev/hd3", "jsf2", "-", "true", config_filepath
275         )
276         with salt.utils.files.fopen(config_filepath, "r") as fp:
277             fsys_content = fp.read()
278         test_fsyst = """/:
279 	dev		= /dev/hd4
280 	vfs		= jfs2
281 	log		= /dev/hd8
282 	mount		= automatic
283 	check		= false
284 	type		= bootfs
285 	vol		= root
286 	free		= true
287 /home:
288 	dev		= /dev/hd1
289 	vfs		= jfs2
290 	log		= /dev/hd8
291 	mount		= true
292 	check		= true
293 	vol		= /home
294 	free		= false
295 /test_mount:
296 	dev		= /dev/hd3
297 	vfstype		= jsf2
298 	opts		= -
299 	mount		= true
300     Mount a device
301     Attempt to remount a device, if the device is not already mounted, mount
302 <a name="12"></a>    is called
303         mock <font color="#571b7e"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=[])
304         with patch.object(mount, "active", mock):
305             mock = MagicMock(return_value=True)
306             with patch.object(</b></font>mount, "mount", mock):
307 <a name="11"></a>                assert mount.remount("name", "device")
308     with patch.dict(mount.__grains__, {"os": "AIX"}):
309         mock <font color="#b041ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=[])
310         with patch.object(mount, "active", mock):
311             mock = MagicMock(return_value=True)
312             with patch.object(</b></font>mount, "mount", mock):
313 <a name="9"></a>                assert mount.remount("name", "device")
314     with patch.dict(mount.__grains__, {"os": "Linux"}):
315         mock <font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=[])
316         with patch.object(mount, "active", mock):
317             mock = MagicMock(return_value=True)
318             with patch.object(</b></font>mount, "mount", mock):
319                 assert mount.remount("name", "device")
320 def test_remount_already_mounted_no_fstype():
321     with patch.dict(mount.__grains__, {"os": "MacOS"}):
322         mock <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=["name"])
323         with patch.object(mount, "active", mock):
324             mock = MagicMock(return_value={"retcode": 0})
325             with patch.dict(mount.__salt__, {"cmd.run_all"</b></font>: mock}):
326                 assert mount.remount("name", "device")
327                 mock.assert_called_with(
328                     "mount -u -o noowners device name ",
329                     python_shell=False,
330                     runas=None,
331 <a name="3"></a>                )
332     with patch.dict(mount.__grains__, {"os": "AIX"}):
333         mock <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=["name"])
334         with patch.object(mount, "active", mock):
335             mock = MagicMock(return_value={"retcode": 0})
336             with patch.dict(mount.__salt__, {"cmd.run_all"</b></font>: mock}):
337                 assert mount.remount("name", "device")
338                 mock.assert_called_with(
339                     "mount -o remount device name ", python_shell=False, runas=None
340 <a name="2"></a>                )
341     with patch.dict(mount.__grains__, {"os": "Linux"}):
342         mock <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=["name"])
343         with patch.object(mount, "active", mock):
344             mock = MagicMock(return_value={"retcode": 0})
345             with patch.dict(mount.__salt__, {"cmd.run_all"</b></font>: mock}):
346                 assert mount.remount("name", "device")
347                 mock.assert_called_with(
348                     "mount -o defaults,remount device name ",
349                     python_shell=False,
350                     runas=None,
351                 )
352 def test_remount_already_mounted_with_fstype():
353     with patch.dict(mount.__grains__, {"os": "MacOS"}):
354         mock = MagicMock(return_value=["name"])
355         with patch.object(mount, "active", mock):
356             mock = MagicMock(return_value={"retcode": 0})
357             with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
358                 assert mount.remount("name", "device", fstype="type")
359                 mock.assert_called_with(
360                     "mount -u -o noowners -t type device name ",
361                     python_shell=False,
362                     runas=None,
363                 )
364     with patch.dict(mount.__grains__, {"os": "AIX"}):
365         mock = MagicMock(return_value=["name"])
366         with patch.object(mount, "active", mock):
367             mock = MagicMock(return_value={"retcode": 0})
368             with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
369                 assert mount.remount("name", "device", fstype="type")
370                 mock.assert_called_with(
371                     "mount -o remount -v type device name ",
372                     python_shell=False,
373                     runas=None,
374                 )
375     with patch.dict(mount.__grains__, {"os": "Linux"}):
376         mock = MagicMock(return_value=["name"])
377         with patch.object(mount, "active", mock):
378             mock = MagicMock(return_value={"retcode": 0})
379             with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
380                 assert mount.remount("name", "device", fstype="type")
381                 mock.assert_called_with(
382                     "mount -o defaults,remount -t type device name ",
383                     python_shell=False,
384                     runas=None,
385                 )
386 def test_umount():
387     mock = MagicMock(return_value={})
388     with patch.object(mount, "active", mock):
389         assert mount.umount("name") == "name does not have anything mounted"
390     mock = MagicMock(return_value={"name": "name"})
391     with patch.object(mount, "active", mock):
392         mock = MagicMock(return_value={"retcode": True, "stderr": True})
393         with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
394             assert mount.umount("name")
395         mock = MagicMock(return_value={"retcode": False})
396         with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
397             assert mount.umount("name")
398     mock = MagicMock()
399     with patch.dict(mount.__salt__, {"guestfs.umount": mock}):
400         mount.umount("/mountpoint", device="/path/to/my.qcow", util="guestfs")
401         mock.assert_called_once_with("/mountpoint", disk="/path/to/my.qcow")
402 def test_is_fuse_exec():
403     with patch.object(salt.utils.path, "which", return_value=None):
404         assert not mount.is_fuse_exec("cmd")
405     def _ldd_side_effect(cmd, *args, **kwargs):
406         return {
407             "ldd cmd1": textwrap.dedent(
408             ),
409             "ldd cmd2": textwrap.dedent(
410             ),
411         }[cmd]
412     which_mock = MagicMock(side_effect=lambda x: x)
413     ldd_mock = MagicMock(side_effect=_ldd_side_effect)
414     with patch.object(salt.utils.path, "which", which_mock):
415         with patch.dict(mount.__salt__, {"cmd.run": _ldd_side_effect}):
416             assert mount.is_fuse_exec("cmd1")
417             assert not mount.is_fuse_exec("cmd2")
418 def test_swaps():
419     file_data = textwrap.dedent(
420     )
421     with patch.dict(mount.__grains__, {"os": "", "kernel": ""}):
422         with patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
423             swaps = mount.swaps()
424             assert swaps == {
425                 "/dev/sda1": {
426                     "priority": "-1",
427                     "size": "31249404",
428                     "type": "partition",
429                     "used": "4100",
430                 }
431             }, swaps
432     file_data = textwrap.dedent(
433     )
434     mock = MagicMock(return_value=file_data)
435     with patch.dict(
436         mount.__grains__, {"os": "OpenBSD", "kernel": "OpenBSD"}
437     ), patch.dict(mount.__salt__, {"cmd.run_stdout": mock}):
438         swaps = mount.swaps()
439         assert swaps == {
440             "/dev/sda1": {
441                 "priority": "-1",
442                 "size": "31249404",
443                 "type": "partition",
444                 "used": "4100",
445             }
446         }, swaps
447     file_data = textwrap.dedent(
448     )
449     mock = MagicMock(return_value=file_data)
450     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.dict(
451         mount.__salt__, {"cmd.run_stdout": mock}
452     ):
453         swaps = mount.swaps()
454         assert swaps == {
455             "/dev/hd6": {
456                 "priority": "-",
457                 "size": 12058624,
458                 "type": "device",
459                 "used": 11264,
460             }
461         }, swaps
462 def test_swapon():
463     mock = MagicMock(return_value={"name": "name"})
464     with patch.dict(mount.__grains__, {"kernel": ""}):
465         with patch.object(mount, "swaps", mock):
466             assert mount.swapon("name") == {"stats": "name", "new": False}
467     mock = MagicMock(return_value={})
468     with patch.dict(mount.__grains__, {"kernel": ""}):
469         with patch.object(mount, "swaps", mock):
470             mock = MagicMock(return_value=None)
471             with patch.dict(mount.__salt__, {"cmd.run": mock}):
472                 assert mount.swapon("name", False) == {}
473     mock = MagicMock(side_effect=[{}, {"name": "name"}])
474     with patch.dict(mount.__grains__, {"kernel": ""}):
475         with patch.object(mount, "swaps", mock):
476             mock = MagicMock(return_value=None)
477             with patch.dict(mount.__salt__, {"cmd.run": mock}):
478                 assert mount.swapon("name") == {"stats": "name", "new": True}
479     mock = MagicMock(return_value={"name": "name"})
480     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
481         with patch.object(mount, "swaps", mock):
482             assert mount.swapon("name") == {"stats": "name", "new": False}
483     mock = MagicMock(return_value={})
484     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
485         with patch.object(mount, "swaps", mock):
486             mock = MagicMock(return_value=None)
487             with patch.dict(mount.__salt__, {"cmd.run": mock}):
488                 assert mount.swapon("name", False) == {}
489     mock = MagicMock(side_effect=[{}, {"name": "name"}])
490     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
491         with patch.object(mount, "swaps", mock):
492             mock = MagicMock(return_value=None)
493             with patch.dict(mount.__salt__, {"cmd.run": mock}):
494                 assert mount.swapon("name") == {"stats": "name", "new": True}
495 def test_swapoff():
496     mock = MagicMock(return_value={})
497     with patch.dict(mount.__grains__, {"kernel": ""}):
498         with patch.object(mount, "swaps", mock):
499             assert mount.swapoff("name") is None
500     mock = MagicMock(return_value={"name": "name"})
501     with patch.dict(mount.__grains__, {"kernel": ""}):
502         with patch.object(mount, "swaps", mock):
503             with patch.dict(mount.__grains__, {"os": "test"}):
504                 mock = MagicMock(return_value=None)
505                 with patch.dict(mount.__salt__, {"cmd.run": mock}):
506                     assert not mount.swapoff("name")
507     mock = MagicMock(side_effect=[{"name": "name"}, {}])
508     with patch.dict(mount.__grains__, {"kernel": ""}):
509         with patch.object(mount, "swaps", mock):
510             with patch.dict(mount.__grains__, {"os": "test"}):
511                 mock = MagicMock(return_value=None)
512                 with patch.dict(mount.__salt__, {"cmd.run": mock}):
513                     assert mount.swapoff("name")
514     mock = MagicMock(return_value={})
515     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
516         with patch.object(mount, "swaps", mock):
517             assert mount.swapoff("name") is None
518     mock = MagicMock(return_value={"name": "name"})
519     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
520         with patch.object(mount, "swaps", mock):
521             with patch.dict(mount.__grains__, {"os": "test"}):
522                 mock = MagicMock(return_value=None)
523                 with patch.dict(mount.__salt__, {"cmd.run": mock}):
524                     assert not mount.swapoff("name")
525     mock = MagicMock(side_effect=[{"name": "name"}, {}])
526     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
527         with patch.object(mount, "swaps", mock):
528 <a name="6"></a>            with patch.dict(mount.__grains__, {"os": "test"}):
529                 mock = MagicMock(return_value=None)
530                 with patch.dict(mount.__salt__, {"cmd.run": mock}):
531                     assert mount.swapoff("n<font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ame")
532 def test_is_mounted():
533     mock = MagicMock(return_value={})
534     with patch.object(mount, "active", mock), patch.dict(
535         mount.</b></font>__grains__, {"kernel": ""}
536     ):
537         assert not mount.is_mounted("name")
538     mock = MagicMock(return_value={"name": "name"})
539     with patch.object(mount, "active", mock), patch.dict(
540         mount.__grains__, {"kernel": ""}
541     ):
542         assert mount.is_mounted("name")
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
