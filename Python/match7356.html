<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_composer_1.py &amp; test_mount.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_composer_1.py &amp; test_mount.py
      </h3>
<h1 align="center">
        18.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_composer_1.py (52.33918%)<th>test_mount.py (10.961421%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(178-183)<td><a href="#" name="0">(313-318)</a><td align="center"><font color="#ff0000">17</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(43-49)<td><a href="#" name="1">(269-274)</a><td align="center"><font color="#ff0000">17</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(128-131)<td><a href="#" name="2">(584-587)</a><td align="center"><font color="#e10000">15</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(105-108)<td><a href="#" name="3">(574-577)</a><td align="center"><font color="#e10000">15</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(96-99)<td><a href="#" name="4">(562-565)</a><td align="center"><font color="#e10000">15</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(166-174)<td><a href="#" name="5">(254-264)</a><td align="center"><font color="#d20000">14</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(74-84)<td><a href="#" name="6">(850-859)</a><td align="center"><font color="#c30000">13</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(71-74)<td><a href="#" name="7">(147-151)</a><td align="center"><font color="#c30000">13</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(191-193)<td><a href="#" name="8">(205-208)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(159-162)<td><a href="#" name="9">(549-552)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#ad5910")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#ad5910"><font color="#ad5910">-</font><td><a href="#" name="10">(154-156)<td><a href="#" name="10">(178-181)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#b041ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#b041ff"><font color="#b041ff">-</font><td><a href="#" name="11">(149-152)<td><a href="#" name="11">(542-545)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#571b7e")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#571b7e"><font color="#571b7e">-</font><td><a href="#" name="12">(87-90)<td><a href="#" name="12">(535-538)</a><td align="center"><font color="#b40000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_composer_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.composer as composer
2 from salt.exceptions import (
3     CommandExecutionError,
4     CommandNotFoundError,
5     SaltInvocationError,
6 )
7 from tests.support.mixins import LoaderModuleMockMixin
8 from tests.support.mock import MagicMock, patch
9 from tests.support.unit import TestCase
10 class ComposerTestCase(TestCase, LoaderModuleMockMixin):
11     def setup_loader_modules(self):
12         return {composer: {}}
13     def test_install(self):
14         mock = MagicMock(return_value=False)
15         with patch.object(composer, "_valid_composer", mock):
16             self.assertRaises(CommandNotFoundError, composer.install, "d")
17         mock = MagicMock(return_value=True)
18         with patch.object(composer, "_valid_composer", mock):
19             self.assertRaises(SaltInvocationError, composer.install, None)
20         mock = MagicMock(return_value=True)
21         with patch.object(composer, "_valid_composer", mock):
22             mock = MagicMock(return_value={<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"retcode": 1, "stderr": "A"})
23             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
24                 self.assertRaises(CommandExecutionError, composer.install, "d")
25         mock = MagicMock(return_value=True)
26         with patch.object(</b></font>composer, "_valid_composer", mock):
27             mock = MagicMock(return_value={"retcode": 0, "stderr": "A"})
28             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
29                 self.assertTrue(
30                     composer.install(
31                         "dir",
32                         None,
33                         None,
34                         None,
35                         None,
36                         None,
37                         None,
38                         None,
39                         None,
40                         None,
41                         True,
42                     )
43                 )
44         mock = MagicMock(return_value=True)
45         with patch.object(composer, "_valid_composer", mock):
46             mock = MagicMock(return_value=rval)
47             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
48                 self.assertEqual(composer.install(</b></font><font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"dir"), rval)
49     def test_update(self):
50         mock = MagicMock(return_value=False)
51         with patch.object(composer, "_valid_composer", mock):
52         mock <font color="#571b7e"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
53         with patch.object(composer, "_valid_composer", mock):
54             mock = MagicMock(return_value=True)
55             with patch.object(</b></font>composer, "did_composer_install", mock):
56                 self.assertRaises(SaltInvocationError, composer.update, None)
57         mock = MagicMock(return_value=True)
58         with patch.object(composer, "_valid_composer", mock):
59             mock <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
60             with patch.object(composer, "did_composer_install", mock):
61                 mock = MagicMock(return_value={"retcode": 1, "stderr": "A"})
62                 with patch.dict(composer.__salt__, {"cmd.run_all"</b></font>: mock}):
63                     self.assertRaises(CommandExecutionError, composer.update, "d")
64         mock = MagicMock(return_value=True)
65         with patch.object(composer, "_valid_composer", mock):
66             mock <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
67             with patch.object(composer, "did_composer_install", mock):
68                 mock = MagicMock(return_value={"retcode": 0, "stderr": "A"})
69                 with patch.dict(composer.__salt__, {"cmd.run_all"</b></font>: mock}):
70                     self.assertTrue(
71                         composer.update(
72                             "dir",
73                             None,
74                             None,
75                             None,
76                             None,
77                             None,
78                             None,
79                             None,
80                             None,
81                             None,
82                             True,
83                         )
84                     )
85         mock = MagicMock(return_value=True)
86         with patch.object(composer, "_valid_composer", mock):
87             mock <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=False)
88             with patch.object(composer, "did_composer_install", mock):
89                 mock = MagicMock(return_value={"retcode": 0, "stderr": "A"})
90                 with patch.dict(composer.__salt__, {"cmd.run_all"</b></font>: mock}):
91                     self.assertTrue(
92                         composer.update(
93                             "dir",
94                             None,
95                             None,
96                             None,
97                             None,
98                             None,
99                             None,
100                             None,
101                             None,
102                             None,
103                             True,
104                         )
105         mock <font color="#b041ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
106         with patch.object(composer, "_valid_composer", mock):
107             with patch.object(</b></font>composer, "did_composer_install", mock):
108                 rval = {"retcode": 0, "stderr": "A", "stdout": "B"}
109                 mock <font color="#ad5910"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=rval)
110                 with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
111         mock <font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
112         with patch.object(composer, "_valid_composer", mock):
113             mock = MagicMock(return_value=False)
114             with patch.object(</b></font>composer, "did_composer_install", mock):
115                 mock = MagicMock(return_value=rval)
116                 with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
117                     self.assertEqual(composer<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.update("dir"), rval)
118     def test_selfupdate(self):
119         mock = MagicMock(return_value=False)
120         with patch.object(composer, "_valid_composer", mock):
121             self.</b></font>assertRaises(CommandNotFoundError, composer.selfupdate)
122         mock = MagicMock(return_value=True)
123         with patch.object(composer, "_valid_composer", mock):
124             mock = MagicMock(return_value={<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"retcode": 1, "stderr": "A"})
125             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
126                 self.assertRaises(CommandExecutionError, composer.selfupdate)
127         mock = MagicMock(return_value=True)
128         with patch.object(</b></font>composer, "_valid_composer", mock):
129             mock = MagicMock(return_value={"retcode": 0, "stderr": "A"})
130             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
131                 self.assertTrue(composer.selfupdate(quiet=True))
132         with patch.object(composer, "_valid_composer", mock):
133             rval = {"retcode": 0, "stderr": "A", "stdout": "B"}
134             mock <font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=rval)
135             with patch.dict(composer.__salt__, {"cmd.run_all": mock}):
136                 self.assertEqual(composer.selfupdate(</b></font>), rval)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_mount.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import shutil
4 import sys
5 import textwrap
6 import pytest
7 import salt.modules.mount as mount
8 import salt.utils.files
9 import salt.utils.path
10 from salt.exceptions import CommandExecutionError
11 from tests.support.mock import MagicMock, mock_open, patch
12 log = logging.getLogger(__name__)
13 @pytest.fixture
14 def mock_shell_file():
15     return "A B C D F G\n"
16 @pytest.fixture
17 def config_initial_file():
18     inital_fsystem = [
19         "/:\n",
20         "\tdev\t\t= /dev/hd4\n",
21         "\tvfs\t\t= jfs2\n",
22         "\tlog\t\t= /dev/hd8\n",
23         "\tmount \t\t= automatic\n",
24         "\tcheck\t\t= false\n",
25         "\ttype\t\t= bootfs\n",
26         "\tvol\t\t= root\n",
27         "\tfree\t\t= true\n",
28         "\n",
29         "/home:\n",
30         "\tdev\t\t= /dev/hd1\n",
31         "\tvfs\t\t= jfs2\n",
32         "\tlog\t\t= /dev/hd8\n",
33         "\tmount\t\t= true\n",
34         "\tcheck\t\t= true\n",
35         "\tvol\t\t= /home\n",
36         "\tfree\t\t= false\n",
37         "\n",
38     ]
39     return inital_fsystem
40 @pytest.fixture
41 def configure_loader_modules():
42     return {mount: {}}
43 @pytest.fixture
44 def tmp_sub_dir(tmp_path):
45     directory = tmp_path / "filesystems-dir"
46     directory.mkdir()
47     yield directory
48     shutil.rmtree(str(directory))
49 @pytest.fixture
50 def config_file(tmp_sub_dir, config_initial_file):
51     filename = str(tmp_sub_dir / "filesystems")
52     with salt.utils.files.fopen(filename, "wb") as fp:
53         fp.writelines(salt.utils.data.encode(config_initial_file))
54     yield filename
55     os.remove(filename)
56 def test_active():
57     with patch.dict(mount.__grains__, {"os": "FreeBSD", "kernel": "FreeBSD"}):
58         mock = MagicMock(return_value="A B C D,E,F,uid=user1,gid=grp1")
59         mock_user = MagicMock(return_value={"uid": "100"})
60         mock_group = MagicMock(return_value={"gid": "100"})
61         with patch.dict(
62             mount.__salt__,
63             {
64                 "cmd.run_stdout": mock,
65                 "user.info": mock_user,
66                 "group.info": mock_group,
67             },
68         ):
69             assert mount.active() == {
70                 "B": {
71                     "device": "A",
72                     "opts": ["D", "E", "F", "uid=100", "gid=100"],
73                     "fstype": "C",
74                 }
75             }
76     with patch.dict(mount.__grains__, {"os": "Solaris", "kernel": "SunOS"}):
77         mock = MagicMock(return_value="A * B * C D/E/F")
78         with patch.dict(mount.__salt__, {"cmd.run_stdout": mock}):
79             assert mount.active() == {
80                 "B": {"device": "A", "opts": ["D", "E", "F"], "fstype": "C"}
81             }
82     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}):
83         mock = MagicMock(return_value="A * B * C D/E/F")
84         with patch.dict(mount.__salt__, {"cmd.run_stdout": mock}):
85             assert mount.active() == {"B": {"node": "A", "device": "*", "fstype": "*"}}
86     with patch.dict(mount.__grains__, {"os": "OpenBSD", "kernel": "OpenBSD"}):
87         mock = MagicMock(return_value={})
88         with patch.object(mount, "_active_mounts_openbsd", mock):
89             assert mount.active() == {}
90     with patch.dict(mount.__grains__, {"os": "MacOS", "kernel": "Darwin"}):
91         mock = MagicMock(return_value={})
92         with patch.object(mount, "_active_mounts_darwin", mock):
93             assert mount.active() == {}
94     with patch.dict(mount.__grains__, {"os": "MacOS", "kernel": "Darwin"}):
95         mock = MagicMock(return_value={})
96         with patch.object(mount, "_active_mountinfo", mock):
97             with patch.object(mount, "_active_mounts_darwin", mock):
98                 assert mount.active(extended=True) == {}
99     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}):
100         mock = MagicMock(return_value={})
101         with patch.object(mount, "_active_mounts_aix", mock):
102             assert mount.active() == {}
103 def test_fstab():
104     mock = MagicMock(return_value=False)
105         assert mount.fstab() == {}
106     file_data = "\n".join([<font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>"#", "A B C D,E,F G H"])
107     mock = MagicMock(return_value=True)
108     with patch.dict(mount.__grains__, {"kernel": ""}), patch.object(
109         os.path, "isfile", mock
110     ), patch(</b></font>"salt.utils.files.fopen", mock_open(read_data=file_data)):
111         fstab = mount.fstab()
112         assert fstab == {
113             "B": {
114                 "device": "A",
115                 "dump": "G",
116                 "fstype": "C",
117                 "opts": ["D", "E", "F"],
118                 "pass": "H",
119             }
120         }, fstab
121 def test_vfstab():
122     mock = MagicMock(return_value=False)
123     with patch.object(os.path, "isfile", mock):
124         assert mount.vfstab() == {}
125     file_data = textwrap.dedent(
126     )
127     mock <font color="#ad5910"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=True)
128     with patch.dict(mount.__grains__, {"kernel": "SunOS"}), patch.object(
129         os.path, "isfile", mock
130     ), patch(</b></font>"salt.utils.files.fopen", mock_open(read_data=file_data)):
131         vfstab = mount.vfstab()
132         assert vfstab == {
133             "/tmp": {
134                 "device": "swap",
135                 "device_fsck": "-",
136                 "fstype": "tmpfs",
137                 "mount_at_boot": "yes",
138                 "opts": ["size=2048m"],
139                 "pass_fsck": "-",
140             }
141         }, vfstab
142 def test_filesystems():
143     file_data = textwrap.dedent(
144     )
145     mock <font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=True)
146     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.object(
147         os.path, "isfile", mock
148     ), patch(</b></font>"salt.utils.files.fopen", mock_open(read_data=file_data)):
149         assert mount.filesystems() == {}
150     file_data = textwrap.dedent(
151     )
152     mock = MagicMock(return_value=True)
153     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.object(
154         os.path, "isfile", mock
155     ), patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
156         fsyst = mount.filesystems()
157         test_fsyst = {
158             "/home": {
159                 "dev": "/dev/hd1",
160                 "vfs": "jfs2",
161                 "log": "/dev/hd8",
162                 "mount": "true",
163                 "check": "true",
164                 "vol": "/home",
165                 "free": "false",
166                 "quota": "no",
167             }
168         }
169         assert test_fsyst == fsyst
170 def test_rm_fstab():
171     mock_fstab = MagicMock(return_value={})
172         with patch.object(mount, "fstab", mock_fstab):
173             with patch("salt.utils.files.fopen", mock_open()):
174                 assert mount<font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.rm_fstab("name", "device")
175 def test_set_fstab(mock_shell_file):
176     mock = MagicMock(return_value=False)
177     with patch.object(os.</b></font>path, "isfile", mock):
178         pytest.raises(CommandExecutionError, mount.set_fstab, "A", "B", "C")
179     mock = MagicMock(return_value=True)
180     mock_read = MagicMock(side_effect=OSError)
181     with patch.object(os<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.path, "isfile", mock):
182         with patch.object(salt.utils.files, "fopen", mock_read):
183             pytest.raises(CommandExecutionError, mount.set_fstab, "A", "B", "C")
184     mock = MagicMock(return_value=True)
185     with patch.object(</b></font>os.path, "isfile", mock):
186         with patch("salt.utils.files.fopen", mock_open(read_data=mock_shell_file)):
187             assert mount.set_fstab("A", "B", "C") == "new"
188     mock = MagicMock(return_value=True)
189     with patch.object(os.path, "isfile", mock):
190         with patch("salt.utils.files.fopen", mock_open(read_data=mock_shell_file)):
191             assert mount.set_fstab("B", "A", "C", "D", "F", "G") == "present"
192     mock = MagicMock(return_value=True)
193     with patch.object(os.path, "isfile", mock):
194         with patch("salt.utils.files.fopen", mock_open(read_data=mock_shell_file)):
195             assert mount.set_fstab("B", "A", "C", not_change=True) == "present"
196 def test_rm_automaster():
197     mock = MagicMock(return_value={})
198     with patch.object(mount, "automaster", mock):
199         assert mount.rm_automaster("name", "device")
200     mock = MagicMock(return_value={"name": "name"})
201     with patch.object(mount, "fstab", mock):
202         assert mount.rm_automaster("name", "device")
203 def test_set_automaster(mock_shell_file):
204     mock = MagicMock(return_value=True)
205     with patch.object(os.path, "isfile", mock):
206         pytest.raises(CommandExecutionError, mount.set_automaster, "A", "B", "C")
207     mock = MagicMock(return_value=True)
208     mock_read = MagicMock(side_effect=OSError)
209     with patch.object(os<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.path, "isfile", mock):
210         with patch.object(salt.utils.files, "fopen", mock_read):
211             pytest.raises(CommandExecutionError, mount.set_automaster, "A", "B", "C")
212     mock = MagicMock(return_value=True)
213     with patch.object(</b></font>os.path, "isfile", mock):
214         with patch("salt.utils.files.fopen", mock_open(read_data=mock_shell_file)):
215             assert mount.set_automaster("A", "B", "C") == "new"
216     mock = MagicMock(return_value=True)
217     with patch.object(os.path, "isfile", mock):
218         with patch(
219             "salt.utils.files.fopen", mock_open(read_data="/..A -fstype=C,D C:B")
220         ):
221             assert mount.set_automaster("A", "B", "C", "D") == "present"
222     mock = MagicMock(return_value=True)
223     with patch.object(os.path, "isfile", mock):
224         with patch(
225             "salt.utils.files.fopen", mock_open(read_data="/..A -fstype=XX C:B")
226         ):
227             assert (
228                 mount.set_automaster("A", "B", "C", "D", not_change=True) == "present"
229             )
230 def test_automaster():
231     assert mount.automaster() == {}
232 def test_rm_filesystems():
233     file_data = textwrap.dedent(
234     )
235     mock = MagicMock(return_value=True)
236     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.object(
237         os.path, "isfile", mock
238     ), patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
239         assert not mount.rm_filesystems("name", "device")
240     file_data = textwrap.dedent(
241     )
242     mock = MagicMock(return_value=True)
243     mock_fsyst = MagicMock(return_value=True)
244     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.object(
245         os.path, "isfile", mock
246     ), patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
247         assert mount.rm_filesystems("/name", "device")
248 def test_set_filesystems():
249     mock = MagicMock(return_value=False)
250     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}):
251         with patch.object(os.path, "isfile", mock):
252             pytest.raises(CommandExecutionError, mount.set_filesystems, "A", "B", "C")
253         mock_read = MagicMock(side_effect=OSError)
254         with patch.object(os.path, "isfile", mock):
255             with patch.object(salt.utils.files, "fopen", mock_read):
256                 pytest.raises(
257                     CommandExecutionError, mount.set_filesystems, "A", "B", "C"
258                 )
259 @pytest.mark.skipif(
260     sys.version_info[0] == 3 and sys.version_info[1] &lt;= 5,
261     reason="run on Python 3.6 or greater where OrderedDict is default",
262 )
263 @pytest.mark.skip_on_windows(
264     reason="Not supported on Windows, does not handle tabs well"
265 )
266 def test_set_filesystems_with_data(tmp_sub_dir, config_file):
267     config_filepath = str(tmp_sub_dir / "filesystems")
268     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}):
269         mount.set_filesystems(
270             "/test_mount", "/dev/hd3", "jsf2", "-", "true", config_filepath
271         )
272         with salt.utils.files.fopen(config_filepath, "r") as fp:
273             fsys_content = fp.read()
274         test_fsyst = """/:
275 	dev		= /dev/hd4
276 	vfs		= jfs2
277 	log		= /dev/hd8
278 	mount		= automatic
279 	check		= false
280 	type		= bootfs
281 	vol		= root
282 	free		= true
283 /home:
284 	dev		= /dev/hd1
285 	vfs		= jfs2
286 	log		= /dev/hd8
287 	mount		= true
288 	check		= true
289 	vol		= /home
290 	free		= false
291 /test_mount:
292 	dev		= /dev/hd3
293 	vfstype		= jsf2
294 	opts		= -
295 	mount		= true
296     Mount a device
297     Attempt to remount a device, if the device is not already mounted, mount
298     """
299         mock <font color="#571b7e"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=[])
300         with patch.object(mount, "active", mock):
301             mock = MagicMock(return_value=True)
302             with patch.object(</b></font>mount, "mount", mock):
303     with patch.dict(mount.__grains__, {"os": "AIX"}):
304         mock <font color="#b041ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=[])
305         with patch.object(mount, "active", mock):
306             mock = MagicMock(return_value=True)
307             with patch.object(</b></font>mount, "mount", mock):
308     with patch.dict(mount.__grains__, {"os": "Linux"}):
309         mock <font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=[])
310         with patch.object(mount, "active", mock):
311             mock = MagicMock(return_value=True)
312             with patch.object(</b></font>mount, "mount", mock):
313                 assert mount.remount("name", "device")
314 def test_remount_already_mounted_no_fstype():
315     """
316     Attempt to remount a device already mounted that do not provides
317     """
318     with patch.dict(mount.__grains__, {"os": "MacOS"}):
319         mock <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=["name"])
320         with patch.object(mount, "active", mock):
321             mock = MagicMock(return_value={"retcode": 0})
322             with patch.dict(mount.__salt__, {"cmd.run_all"</b></font>: mock}):
323                 assert mount.remount("name", "device")
324                 mock.assert_called_with(
325                     "mount -u -o noowners device name ",
326                     python_shell=False,
327                     runas=None,
328     with patch.dict(mount.__grains__, {"os": "AIX"}):
329         mock <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=["name"])
330         with patch.object(mount, "active", mock):
331             mock = MagicMock(return_value={"retcode": 0})
332             with patch.dict(mount.__salt__, {"cmd.run_all"</b></font>: mock}):
333                 assert mount.remount("name", "device")
334                 mock.assert_called_with(
335                     "mount -o remount device name ", python_shell=False, runas=None
336     with patch.dict(mount.__grains__, {"os": "Linux"}):
337         mock <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=["name"])
338         with patch.object(mount, "active", mock):
339             mock = MagicMock(return_value={"retcode": 0})
340             with patch.dict(mount.__salt__, {"cmd.run_all"</b></font>: mock}):
341                 assert mount.remount("name", "device")
342                 mock.assert_called_with(
343                     "mount -o defaults,remount device name ",
344                     python_shell=False,
345                     runas=None,
346                 )
347 def test_remount_already_mounted_with_fstype():
348     """
349     Attempt to remount a device already mounted that do not provides
350     fstype
351     """
352     with patch.dict(mount.__grains__, {"os": "MacOS"}):
353         mock = MagicMock(return_value=["name"])
354         with patch.object(mount, "active", mock):
355             mock = MagicMock(return_value={"retcode": 0})
356             with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
357                 assert mount.remount("name", "device", fstype="type")
358                 mock.assert_called_with(
359                     "mount -u -o noowners -t type device name ",
360                     python_shell=False,
361                     runas=None,
362                 )
363     with patch.dict(mount.__grains__, {"os": "AIX"}):
364         mock = MagicMock(return_value=["name"])
365         with patch.object(mount, "active", mock):
366             mock = MagicMock(return_value={"retcode": 0})
367             with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
368                 assert mount.remount("name", "device", fstype="type")
369                 mock.assert_called_with(
370                     "mount -o remount -v type device name ",
371                     python_shell=False,
372                     runas=None,
373                 )
374     with patch.dict(mount.__grains__, {"os": "Linux"}):
375         mock = MagicMock(return_value=["name"])
376         with patch.object(mount, "active", mock):
377             mock = MagicMock(return_value={"retcode": 0})
378             with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
379                 assert mount.remount("name", "device", fstype="type")
380                 mock.assert_called_with(
381                     "mount -o defaults,remount -t type device name ",
382                     python_shell=False,
383                     runas=None,
384                 )
385 def test_umount():
386     """
387     Attempt to unmount a device by specifying the directory it is
388     mounted on
389     """
390     mock = MagicMock(return_value={})
391     with patch.object(mount, "active", mock):
392         assert mount.umount("name") == "name does not have anything mounted"
393     mock = MagicMock(return_value={"name": "name"})
394     with patch.object(mount, "active", mock):
395         mock = MagicMock(return_value={"retcode": True, "stderr": True})
396         with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
397             assert mount.umount("name")
398         mock = MagicMock(return_value={"retcode": False})
399         with patch.dict(mount.__salt__, {"cmd.run_all": mock}):
400             assert mount.umount("name")
401     mock = MagicMock()
402     with patch.dict(mount.__salt__, {"guestfs.umount": mock}):
403         mount.umount("/mountpoint", device="/path/to/my.qcow", util="guestfs")
404         mock.assert_called_once_with("/mountpoint", disk="/path/to/my.qcow")
405 def test_is_fuse_exec():
406     """
407     Returns true if the command passed is a fuse mountable application
408     """
409     with patch.object(salt.utils.path, "which", return_value=None):
410         assert not mount.is_fuse_exec("cmd")
411     def _ldd_side_effect(cmd, *args, **kwargs):
412         """
413         Neither of these are full ldd output, but what is_fuse_exec is
414         looking for is 'libfuse' in the ldd output, so these examples
415         should be sufficient enough to test both the True and False cases.
416         """
417         return {
418             "ldd cmd1": textwrap.dedent(
419                 """\
420                 linux-vdso.so.1 (0x00007ffeaf5fb000)
421                 libfuse3.so.3 =&gt; /usr/lib/libfuse3.so.3 (0x00007f91e66ac000)
422                 """
423             ),
424             "ldd cmd2": textwrap.dedent(
425                 """\
426                 linux-vdso.so.1 (0x00007ffeaf5fb000)
427                 """
428             ),
429         }[cmd]
430     which_mock = MagicMock(side_effect=lambda x: x)
431     ldd_mock = MagicMock(side_effect=_ldd_side_effect)
432     with patch.object(salt.utils.path, "which", which_mock):
433         with patch.dict(mount.__salt__, {"cmd.run": _ldd_side_effect}):
434             assert mount.is_fuse_exec("cmd1")
435             assert not mount.is_fuse_exec("cmd2")
436 def test_swaps():
437     """
438     Return a dict containing information on active swap
439     """
440     file_data = textwrap.dedent(
441         """\
442         Filename Type Size Used Priority
443         /dev/sda1 partition 31249404 4100 -1
444         """
445     )
446     with patch.dict(mount.__grains__, {"os": "", "kernel": ""}):
447         with patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
448             swaps = mount.swaps()
449             assert swaps == {
450                 "/dev/sda1": {
451                     "priority": "-1",
452                     "size": "31249404",
453                     "type": "partition",
454                     "used": "4100",
455                 }
456             }, swaps
457     file_data = textwrap.dedent(
458         """\
459         Device Size Used Unknown Unknown Priority
460         /dev/sda1 31249404 4100 unknown unknown -1
461         """
462     )
463     mock = MagicMock(return_value=file_data)
464     with patch.dict(
465         mount.__grains__, {"os": "OpenBSD", "kernel": "OpenBSD"}
466     ), patch.dict(mount.__salt__, {"cmd.run_stdout": mock}):
467         swaps = mount.swaps()
468         assert swaps == {
469             "/dev/sda1": {
470                 "priority": "-1",
471                 "size": "31249404",
472                 "type": "partition",
473                 "used": "4100",
474             }
475         }, swaps
476     file_data = textwrap.dedent(
477         """\
478         device              maj,min        total       free
479         /dev/hd6              10,  2     11776MB     11765MB
480         """
481     )
482     mock = MagicMock(return_value=file_data)
483     with patch.dict(mount.__grains__, {"os": "AIX", "kernel": "AIX"}), patch.dict(
484         mount.__salt__, {"cmd.run_stdout": mock}
485     ):
486         swaps = mount.swaps()
487         assert swaps == {
488             "/dev/hd6": {
489                 "priority": "-",
490                 "size": 12058624,
491                 "type": "device",
492                 "used": 11264,
493             }
494         }, swaps
495 def test_swapon():
496     """
497     Activate a swap disk
498     """
499     mock = MagicMock(return_value={"name": "name"})
500     with patch.dict(mount.__grains__, {"kernel": ""}):
501         with patch.object(mount, "swaps", mock):
502             assert mount.swapon("name") == {"stats": "name", "new": False}
503     mock = MagicMock(return_value={})
504     with patch.dict(mount.__grains__, {"kernel": ""}):
505         with patch.object(mount, "swaps", mock):
506             mock = MagicMock(return_value=None)
507             with patch.dict(mount.__salt__, {"cmd.run": mock}):
508                 assert mount.swapon("name", False) == {}
509     mock = MagicMock(side_effect=[{}, {"name": "name"}])
510     with patch.dict(mount.__grains__, {"kernel": ""}):
511         with patch.object(mount, "swaps", mock):
512             mock = MagicMock(return_value=None)
513             with patch.dict(mount.__salt__, {"cmd.run": mock}):
514                 assert mount.swapon("name") == {"stats": "name", "new": True}
515     mock = MagicMock(return_value={"name": "name"})
516     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
517         with patch.object(mount, "swaps", mock):
518             assert mount.swapon("name") == {"stats": "name", "new": False}
519     mock = MagicMock(return_value={})
520     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
521         with patch.object(mount, "swaps", mock):
522             mock = MagicMock(return_value=None)
523             with patch.dict(mount.__salt__, {"cmd.run": mock}):
524                 assert mount.swapon("name", False) == {}
525     mock = MagicMock(side_effect=[{}, {"name": "name"}])
526     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
527         with patch.object(mount, "swaps", mock):
528             mock = MagicMock(return_value=None)
529             with patch.dict(mount.__salt__, {"cmd.run": mock}):
530                 assert mount.swapon("name") == {"stats": "name", "new": True}
531 def test_swapoff():
532     """
533     Deactivate a named swap mount
534     """
535     mock = MagicMock(return_value={})
536     with patch.dict(mount.__grains__, {"kernel": ""}):
537         with patch.object(mount, "swaps", mock):
538             assert mount.swapoff("name") is None
539     mock = MagicMock(return_value={"name": "name"})
540     with patch.dict(mount.__grains__, {"kernel": ""}):
541         with patch.object(mount, "swaps", mock):
542             with patch.dict(mount.__grains__, {"os": "test"}):
543                 mock = MagicMock(return_value=None)
544                 with patch.dict(mount.__salt__, {"cmd.run": mock}):
545                     assert not mount.swapoff("name")
546     mock = MagicMock(side_effect=[{"name": "name"}, {}])
547     with patch.dict(mount.__grains__, {"kernel": ""}):
548         with patch.object(mount, "swaps", mock):
549             with patch.dict(mount.__grains__, {"os": "test"}):
550                 mock = MagicMock(return_value=None)
551                 with patch.dict(mount.__salt__, {"cmd.run": mock}):
552                     assert mount.swapoff("name")
553     mock = MagicMock(return_value={})
554     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
555         with patch.object(mount, "swaps", mock):
556             assert mount.swapoff("name") is None
557     mock = MagicMock(return_value={"name": "name"})
558     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
559         with patch.object(mount, "swaps", mock):
560             with patch.dict(mount.__grains__, {"os": "test"}):
561                 mock = MagicMock(return_value=None)
562                 with patch.dict(mount.__salt__, {"cmd.run": mock}):
563                     assert not mount.swapoff("name")
564     mock = MagicMock(side_effect=[{"name": "name"}, {}])
565     with patch.dict(mount.__grains__, {"kernel": "AIX"}):
566         with patch.object(mount, "swaps", mock):
567                 mock = MagicMock(return_value=None)
568                 with patch.dict(mount.__salt__, {"cmd.run": mock}):
569                     assert mount.swapoff("n<font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ame")
570 def test_is_mounted():
571     """
572     Provide information if the path is mounted
573     """
574     mock = MagicMock(return_value={})
575     with patch.object(mount, "active", mock), patch.dict(
576         mount.</b></font>__grains__, {"kernel": ""}
577     ):
578         assert not mount.is_mounted("name")
579     mock = MagicMock(return_value={"name": "name"})
580     with patch.object(mount, "active", mock), patch.dict(
581         mount.__grains__, {"kernel": ""}
582     ):
583         assert mount.is_mounted("name")
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
