<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_vmware_1.py &amp; test_virtualbox.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_vmware_1.py &amp; test_virtualbox.py
      </h3>
<h1 align="center">
        3.4%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_vmware_1.py (10.909091%)<th>test_virtualbox.py (2.0725389%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(94-105)<td><a href="#" name="0">(231-240)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_vmware_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import socket
2 from tests.integration.cloud.helpers.cloud_test_base import TIMEOUT, CloudTest
3 class VMWareTest(CloudTest):
4     PROVIDER = "vmware"
5     REQUIRED_PROVIDER_CONFIG_ITEMS = ("password", "user", "url")
6     def setUp(self):
7         super().setUp()
8         test_host = self.provider_config["url"]
9         try:
10             socket.gethostbyname_ex(test_host)
11         except OSError as exc:
12             self.skipTest(
13                 "The required vmware host at {} is not available: {}".format(
14                     test_host, exc
15                 )
16             )
17     def test_instance(self):
18         disk_datastore = self.config["vmware-test"]["devices"]["disk"]["Hard disk 2"][
19             "datastore"
20         ]
21         ret_val = self.run_cloud(
22             "-p vmware-test {}".format(self.instance_name), timeout=TIMEOUT
23         )
24         disk_datastore_str = "                [{}] {}/Hard disk 2-flat.vmdk".format(
25             disk_datastore, self.instance_name
26         )
27         self.assertInstanceExists(ret_val)
28         self.assertIn(
29             disk_datastore_str,
30             ret_val,
31             msg="Hard Disk 2 did not use the Datastore {} ".format(disk_datastore),
32         )
33         self.assertDestroyInstance()
34     def test_snapshot(self):
35         ret_val = self.run_cloud(
36             "-p vmware-test {} --no-deploy".format(self.instance_name), timeout=TIMEOUT
37         )
38         self.assertInstanceExists(ret_val)
39         create_snapshot = self.run_cloud(
40             "-a create_snapshot {} snapshot_name='Test Cloud' memdump=True -y".format(
41                 self.instance_name
42             ),
43             timeout=TIMEOUT,
44         )
45         s_ret_str = "Snapshot created successfully"
46         self.assertIn(s_ret_str, str(create_snapshot))
47         self.assertDestroyInstance()
48     def test_verify_ssl_false(self):
49         profile_name = "vmware_verify_ssl"
50         self.add_profile_config(
51             "vmware-test", {"verify_ssl": False}, "vmware.conf", profile_name
52         )
53         ret_val = self.run_cloud(
54         )
55         self<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertInstanceExists(ret_val)
56         self.assertDestroyInstance()
57     def test_instant_clone(self):
58         profile_name = "vmware-test-instant-clone"
59         ret_val = self.run_cloud(
60             "-p {} {}".format(</b></font>profile_name, self.instance_name), timeout=TIMEOUT
61         )
62         i_clone_str = "Instant Clone created successfully"
63         self.assertIn(i_clone_str, str(ret_val))
64         self.assertDestroyInstance()
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_virtualbox.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import socket
4 from salt.config import cloud_providers_config, vm_profiles_config
5 from salt.utils.virtualbox import (
6     HAS_LIBS,
7     XPCOM_ATTRIBUTES,
8     machine_get_machinestate_str,
9     vb_clone_vm,
10     vb_create_machine,
11     vb_destroy_machine,
12     vb_get_box,
13     vb_get_network_addresses,
14     vb_machine_exists,
15     vb_start_vm,
16     vb_stop_vm,
17     vb_wait_for_network_address,
18     vb_xpcom_to_attribute_dict,
19 )
20 from tests.integration.cloud.helpers.virtualbox import (
21     BASE_BOX_NAME,
22     BOOTABLE_BASE_BOX_NAME,
23     CONFIG_NAME,
24     DEPLOY_PROFILE_NAME,
25     INSTANCE_NAME,
26     PROFILE_NAME,
27     PROVIDER_NAME,
28     VirtualboxCloudTestCase,
29     VirtualboxTestCase,
30 )
31 from tests.support.runtests import RUNTIME_VARS
32 from tests.support.unit import TestCase, skipIf
33 log = logging.getLogger(__name__)
34 MINIMAL_MACHINE_ATTRIBUTES = [
35     "id",
36     "image",
37     "size",
38     "state",
39     "private_ips",
40     "public_ips",
41 ]
42 class VirtualboxProviderTest(VirtualboxCloudTestCase):
43     def run_cloud_destroy(self, machine_name):
44         output = self.run_cloud(
45             "-d {} --assume-yes --log-level=debug".format(machine_name)
46         )
47         return output.get(CONFIG_NAME, {}).get(PROVIDER_NAME, {})
48     def setUp(self):
49         super().setUp()
50         profile_str = "virtualbox-config"
51         providers = self.run_cloud("--list-providers")
52         log.debug("providers: %s", providers)
53         if profile_str not in providers:
54             self.skipTest(
55                 "Configuration file for {0} was not found. Check {0}.conf files "
56                 "in tests/integration/files/conf/cloud.*.d/ to run these tests.".format(
57                     PROVIDER_NAME
58                 )
59             )
60         config_path = os.path.join(
61             RUNTIME_VARS.FILES, "conf", "cloud.providers.d", PROVIDER_NAME + ".conf"
62         )
63         log.debug("config_path: %s", config_path)
64         providers = cloud_providers_config(config_path)
65         log.debug("config: %s", providers)
66         config_path = os.path.join(
67             RUNTIME_VARS.FILES, "conf", "cloud.profiles.d", PROVIDER_NAME + ".conf"
68         )
69         profiles = vm_profiles_config(config_path, providers)
70         profile = profiles.get(PROFILE_NAME)
71         if not profile:
72             self.skipTest(
73                 "Profile {} was not found. Check {}.conf files "
74                 "in tests/integration/files/conf/cloud.profiles.d/ to run these tests.".format(
75                     PROFILE_NAME, PROVIDER_NAME
76                 )
77             )
78         base_box_name = profile.get("clonefrom")
79         if base_box_name != BASE_BOX_NAME:
80             self.skipTest(
81                 "Profile {} does not have a base box to clone from. Check {}.conf files"
82                 " in tests/integration/files/conf/cloud.profiles.d/ to run these"
83                 ' tests.And add a "clone_from: {}" to the profile'.format(
84                     PROFILE_NAME, PROVIDER_NAME, BASE_BOX_NAME
85                 )
86             )
87     @classmethod
88     def setUpClass(cls):
89         vb_create_machine(BASE_BOX_NAME)
90     @classmethod
91     def tearDownClass(cls):
92         vb_destroy_machine(BASE_BOX_NAME)
93     def test_cloud_create(self):
94         machines = self.run_cloud(
95             "-p {} {} --log-level=debug".format(PROFILE_NAME, INSTANCE_NAME)
96         )
97         self.assertIn(INSTANCE_NAME, machines.keys())
98     def test_cloud_list(self):
99         machines = self.run_cloud_function("list_nodes")
100         expected_attributes = MINIMAL_MACHINE_ATTRIBUTES
101         names = machines.keys()
102         self.assertGreaterEqual(len(names), 1, "No machines found")
103         for name, machine in machines.items():
104             self.assertCountEqual(expected_attributes, machine.keys())
105         self.assertIn(BASE_BOX_NAME, names)
106     def test_cloud_list_full(self):
107         machines = self.run_cloud_function("list_nodes_full")
108         expected_minimal_attribute_count = len(MINIMAL_MACHINE_ATTRIBUTES)
109         names = machines.keys()
110         self.assertGreaterEqual(len(names), 1, "No machines found")
111         for name, machine in machines.items():
112             self.assertGreaterEqual(
113                 len(machine.keys()), expected_minimal_attribute_count
114             )
115         self.assertIn(BASE_BOX_NAME, names)
116     def test_cloud_list_select(self):
117         machines = self.run_cloud_function("list_nodes_select")
118         expected_attributes = ["id"]
119         names = machines.keys()
120         self.assertGreaterEqual(len(names), 1, "No machines found")
121         for name, machine in machines.items():
122             self.assertCountEqual(expected_attributes, machine.keys())
123         self.assertIn(BASE_BOX_NAME, names)
124     def test_cloud_destroy(self):
125         self.test_cloud_create()
126         ret = self.run_cloud_destroy(INSTANCE_NAME)
127         self.assertIn(INSTANCE_NAME, ret.keys())
128     def test_function_show_instance(self):
129         kw_function_args = {"image": BASE_BOX_NAME}
130         machines = self.run_cloud_function("show_image", kw_function_args, timeout=30)
131         expected_minimal_attribute_count = len(MINIMAL_MACHINE_ATTRIBUTES)
132         self.assertIn(BASE_BOX_NAME, machines)
133         machine = machines[BASE_BOX_NAME]
134         self.assertGreaterEqual(len(machine.keys()), expected_minimal_attribute_count)
135     def tearDown(self):
136         if vb_machine_exists(INSTANCE_NAME):
137             vb_destroy_machine(INSTANCE_NAME)
138 @skipIf(
139     HAS_LIBS and vb_machine_exists(BOOTABLE_BASE_BOX_NAME) is False,
140     "Bootable VM '{}' not found. Cannot run tests.".format(BOOTABLE_BASE_BOX_NAME),
141 )
142 class VirtualboxProviderHeavyTests(VirtualboxCloudTestCase):
143     def assertIsIpAddress(self, ip_str):
144         try:
145             socket.inet_aton(ip_str)
146         except Exception:  # pylint: disable=broad-except
147                 socket.inet_pton(socket.AF_INET6, ip_str)
148             except Exception:  # pylint: disable=broad-except
149                 self<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.fail("{} is not a valid IP address".format(ip_str))
150     def setUp(self):
151         provider_str = CONFIG_NAME
152         providers = self.run_cloud("--list-providers")
153         log.debug(</b></font>"providers: %s", providers)
154         if provider_str not in providers:
155             self.skipTest(
156                 "Configuration file for {0} was not found. Check {0}.conf files "
157                 "in tests/integration/files/conf/cloud.*.d/ to run these tests.".format(
158                     PROVIDER_NAME
159                 )
160             )
161         config_path = os.path.join(
162             RUNTIME_VARS.FILES, "conf", "cloud.providers.d", PROVIDER_NAME + ".conf"
163         )
164         log.debug("config_path: %s", config_path)
165         providers = cloud_providers_config(config_path)
166         log.debug("config: %s", providers)
167         config_path = os.path.join(
168             RUNTIME_VARS.FILES, "conf", "cloud.profiles.d", PROVIDER_NAME + ".conf"
169         )
170         profiles = vm_profiles_config(config_path, providers)
171         profile = profiles.get(DEPLOY_PROFILE_NAME)
172         if not profile:
173             self.skipTest(
174                 "Profile {} was not found. Check {}.conf files "
175                 "in tests/integration/files/conf/cloud.profiles.d/ to run these tests.".format(
176                     DEPLOY_PROFILE_NAME, PROVIDER_NAME
177                 )
178             )
179         base_box_name = profile.get("clonefrom")
180         if base_box_name != BOOTABLE_BASE_BOX_NAME:
181             self.skipTest(
182                 "Profile {} does not have a base box to clone from. Check {}.conf files"
183                 " in tests/integration/files/conf/cloud.profiles.d/ to run these"
184                 ' tests.And add a "clone_from: {}" to the profile'.format(
185                     PROFILE_NAME, PROVIDER_NAME, BOOTABLE_BASE_BOX_NAME
186                 )
187             )
188     def tearDown(self):
189         try:
190             vb_stop_vm(BOOTABLE_BASE_BOX_NAME)
191         except Exception:  # pylint: disable=broad-except
192             pass
193         if vb_machine_exists(INSTANCE_NAME):
194             try:
195                 vb_stop_vm(INSTANCE_NAME)
196                 vb_destroy_machine(INSTANCE_NAME)
197             except Exception as e:  # pylint: disable=broad-except
198                 log.warning("Possibly dirty state after exception", exc_info=True)
199     def test_deploy(self):
200         machines = self.run_cloud(
201             "-p {} {} --log-level=debug".format(DEPLOY_PROFILE_NAME, INSTANCE_NAME)
202         )
203         self.assertIn(INSTANCE_NAME, machines.keys())
204         machine = machines[INSTANCE_NAME]
205         self.assertIn("deployed", machine)
206         self.assertTrue(machine["deployed"], "Machine wasn't deployed :(")
207     def test_start_stop_action(self):
208         res = self.run_cloud_action("start", BOOTABLE_BASE_BOX_NAME, timeout=10)
209         log.info(res)
210         machine = res.get(BOOTABLE_BASE_BOX_NAME)
211         self.assertIsNotNone(machine)
212         expected_state = "Running"
213         state = machine.get("state")
214         self.assertEqual(state, expected_state)
215         res = self.run_cloud_action("stop", BOOTABLE_BASE_BOX_NAME, timeout=10)
216         log.info(res)
217         machine = res.get(BOOTABLE_BASE_BOX_NAME)
218         self.assertIsNotNone(machine)
219         expected_state = "PoweredOff"
220         state = machine.get("state")
221         self.assertEqual(state, expected_state)
222     def test_restart_action(self):
223         pass
224     def test_network_addresses(self):
225         ip_addresses = vb_get_network_addresses(machine_name=BOOTABLE_BASE_BOX_NAME)
226         network_count = len(ip_addresses)
227         self.assertEqual(network_count, 0)
228         vb_start_vm(BOOTABLE_BASE_BOX_NAME)
229         ip_addresses = vb_wait_for_network_address(
230             20, machine_name=BOOTABLE_BASE_BOX_NAME
231         )
232         network_count = len(ip_addresses)
233         self.assertGreater(network_count, 0)
234         for ip_address in ip_addresses:
235             self.assertIsIpAddress(ip_address)
236 @skipIf(HAS_LIBS is False, "The 'vboxapi' library is not available")
237 class BaseVirtualboxTests(TestCase):
238     def test_get_manager(self):
239         self.assertIsNotNone(vb_get_box())
240 class CreationDestructionVirtualboxTests(VirtualboxTestCase):
241     def test_vm_creation_and_destruction(self):
242         vm_name = BASE_BOX_NAME
243         vb_create_machine(vm_name)
244         self.assertMachineExists(vm_name)
245         vb_destroy_machine(vm_name)
246         self.assertMachineDoesNotExist(vm_name)
247 class CloneVirtualboxTests(VirtualboxTestCase):
248     def setUp(self):
249         self.vbox = vb_get_box()
250         self.name = "SaltCloudVirtualboxTestVM"
251         vb_create_machine(self.name)
252         self.assertMachineExists(self.name)
253     def tearDown(self):
254         vb_destroy_machine(self.name)
255         self.assertMachineDoesNotExist(self.name)
256     def test_create_machine(self):
257         vb_name = "NewTestMachine"
258         machine = vb_clone_vm(name=vb_name, clone_from=self.name)
259         self.assertEqual(machine.get("name"), vb_name)
260         self.assertMachineExists(vb_name)
261         vb_destroy_machine(vb_name)
262         self.assertMachineDoesNotExist(vb_name)
263 @skipIf(
264     HAS_LIBS and vb_machine_exists(BOOTABLE_BASE_BOX_NAME) is False,
265     "Bootable VM '{}' not found. Cannot run tests.".format(BOOTABLE_BASE_BOX_NAME),
266 )
267 class BootVirtualboxTests(VirtualboxTestCase):
268     def test_start_stop(self):
269         for i in range(2):
270             machine = vb_start_vm(BOOTABLE_BASE_BOX_NAME, 20000)
271             self.assertEqual(machine_get_machinestate_str(machine), "Running")
272             machine = vb_stop_vm(BOOTABLE_BASE_BOX_NAME)
273             self.assertEqual(machine_get_machinestate_str(machine), "PoweredOff")
274 class XpcomConversionTests(TestCase):
275     @classmethod
276     def _mock_xpcom_object(cls, interface_name=None, attributes=None):
277         class XPCOM:
278             def __str__(self):
279                 return "&lt;XPCOM component '&lt;unknown&gt;' (implementing {})&gt;".format(
280                     interface_name
281                 )
282         o = XPCOM()
283         if attributes and isinstance(attributes, dict):
284             for key, value in attributes.items():
285                 setattr(o, key, value)
286         return o
287     def test_unknown_object(self):
288         xpcom = XpcomConversionTests._mock_xpcom_object()
289         ret = vb_xpcom_to_attribute_dict(xpcom)
290         self.assertDictEqual(ret, dict())
291     def test_imachine_object_default(self):
292         interface = "IMachine"
293         imachine = XpcomConversionTests._mock_xpcom_object(interface)
294         ret = vb_xpcom_to_attribute_dict(imachine, interface_name=interface)
295         expected_attributes = XPCOM_ATTRIBUTES[interface]
296         self.assertIsNotNone(expected_attributes, "%s is unknown")
297         for key in ret:
298             self.assertIn(key, expected_attributes)
299     def test_override_attributes(self):
300         expected_dict = {"herp": "derp", "lol": "rofl", "something": 12345}
301         xpc = XpcomConversionTests._mock_xpcom_object(attributes=expected_dict)
302         ret = vb_xpcom_to_attribute_dict(xpc, attributes=expected_dict.keys())
303         self.assertDictEqual(ret, expected_dict)
304     def test_extra_attributes(self):
305         interface = "IMachine"
306         expected_extras = {
307             "extra": "extra",
308         }
309         expected_machine = {
310             attribute: attribute for attribute in XPCOM_ATTRIBUTES[interface]
311         }
312         expected_machine.update(expected_extras)
313         imachine = XpcomConversionTests._mock_xpcom_object(
314             interface, attributes=expected_machine
315         )
316         ret = vb_xpcom_to_attribute_dict(
317             imachine, interface_name=interface, extra_attributes=expected_extras.keys()
318         )
319         self.assertDictEqual(ret, expected_machine)
320         ret_keys = ret.keys()
321         for key in expected_extras:
322             self.assertIn(key, ret_keys)
323     def test_extra_nonexistent_attributes(self):
324         expected_extra_dict = {"nonexistent": ""}
325         xpcom = XpcomConversionTests._mock_xpcom_object()
326         ret = vb_xpcom_to_attribute_dict(
327             xpcom, extra_attributes=expected_extra_dict.keys()
328         )
329         self.assertDictEqual(ret, expected_extra_dict)
330     def test_extra_nonexistent_attribute_with_default(self):
331         expected_extras = [("nonexistent", list)]
332         expected_extra_dict = {"nonexistent": []}
333         xpcom = XpcomConversionTests._mock_xpcom_object()
334         ret = vb_xpcom_to_attribute_dict(xpcom, extra_attributes=expected_extras)
335         self.assertDictEqual(ret, expected_extra_dict)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
