<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_vmware_1.py &amp; test_virtualbox.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_vmware_1.py &amp; test_virtualbox.py
      </h3>
<h1 align="center">
        3.4%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_vmware_1.py (10.909091%)<th>test_virtualbox.py (2.0725389%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(94-105)<td><a href="#" name="0">(231-240)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_vmware_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import socket
2 from tests.integration.cloud.helpers.cloud_test_base import TIMEOUT, CloudTest
3 class VMWareTest(CloudTest):
4     PROVIDER = "vmware"
5     REQUIRED_PROVIDER_CONFIG_ITEMS = ("password", "user", "url")
6     def setUp(self):
7         super().setUp()
8         test_host = self.provider_config["url"]
9         try:
10             socket.gethostbyname_ex(test_host)
11         except OSError as exc:
12             self.skipTest(
13                 "The required vmware host at {} is not available: {}".format(
14                     test_host, exc
15                 )
16             )
17     def test_instance(self):
18         disk_datastore = self.config["vmware-test"]["devices"]["disk"]["Hard disk 2"][
19             "datastore"
20         ]
21         ret_val = self.run_cloud(
22             "-p vmware-test {}".format(self.instance_name), timeout=TIMEOUT
23         )
24         disk_datastore_str = "                [{}] {}/Hard disk 2-flat.vmdk".format(
25             disk_datastore, self.instance_name
26         )
27         self.assertInstanceExists(ret_val)
28         self.assertIn(
29             disk_datastore_str,
30             ret_val,
31             msg="Hard Disk 2 did not use the Datastore {} ".format(disk_datastore),
32         )
33         self.assertDestroyInstance()
34     def test_snapshot(self):
35         ret_val = self.run_cloud(
36             "-p vmware-test {} --no-deploy".format(self.instance_name), timeout=TIMEOUT
37         )
38         self.assertInstanceExists(ret_val)
39         create_snapshot = self.run_cloud(
40             "-a create_snapshot {} snapshot_name='Test Cloud' memdump=True -y".format(
41                 self.instance_name
42             ),
43             timeout=TIMEOUT,
44         )
45         s_ret_str = "Snapshot created successfully"
46         self.assertIn(s_ret_str, str(create_snapshot))
47         self.assertDestroyInstance()
48     def test_verify_ssl_false(self):
49         profile_name = "vmware_verify_ssl"
50         self.add_profile_config(
51             "vmware-test", {"verify_ssl": False}, "vmware.conf", profile_name
52         )
53         ret_val = self.run_cloud(
54 <a name="0"></a>            "-p {} {}".format(profile_name, self.instance_name), timeout=TIMEOUT
55         )
56         self<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertInstanceExists(ret_val)
57         self.assertDestroyInstance()
58     def test_instant_clone(self):
59         profile_name = "vmware-test-instant-clone"
60         ret_val = self.run_cloud(
61             "-p {} {}".format(</b></font>profile_name, self.instance_name), timeout=TIMEOUT
62         )
63         i_clone_str = "Instant Clone created successfully"
64         self.assertIn(i_clone_str, str(ret_val))
65         self.assertDestroyInstance()
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_virtualbox.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import socket
4 from salt.config import cloud_providers_config, vm_profiles_config
5 from salt.utils.virtualbox import (
6     HAS_LIBS,
7     XPCOM_ATTRIBUTES,
8     machine_get_machinestate_str,
9     vb_clone_vm,
10     vb_create_machine,
11     vb_destroy_machine,
12     vb_get_box,
13     vb_get_network_addresses,
14     vb_machine_exists,
15     vb_start_vm,
16     vb_stop_vm,
17     vb_wait_for_network_address,
18     vb_xpcom_to_attribute_dict,
19 )
20 from tests.integration.cloud.helpers.virtualbox import (
21     BASE_BOX_NAME,
22     BOOTABLE_BASE_BOX_NAME,
23     CONFIG_NAME,
24     DEPLOY_PROFILE_NAME,
25     INSTANCE_NAME,
26     PROFILE_NAME,
27     PROVIDER_NAME,
28     VirtualboxCloudTestCase,
29     VirtualboxTestCase,
30 )
31 from tests.support.runtests import RUNTIME_VARS
32 from tests.support.unit import TestCase, skipIf
33 log = logging.getLogger(__name__)
34 MINIMAL_MACHINE_ATTRIBUTES = [
35     "id",
36     "image",
37     "size",
38     "state",
39     "private_ips",
40     "public_ips",
41 ]
42 class VirtualboxProviderTest(VirtualboxCloudTestCase):
43     def run_cloud_destroy(self, machine_name):
44         output = self.run_cloud(
45             "-d {} --assume-yes --log-level=debug".format(machine_name)
46         )
47         return output.get(CONFIG_NAME, {}).get(PROVIDER_NAME, {})
48     def setUp(self):
49         super().setUp()
50         profile_str = "virtualbox-config"
51         providers = self.run_cloud("--list-providers")
52         log.debug("providers: %s", providers)
53         if profile_str not in providers:
54             self.skipTest(
55                 "Configuration file for {0} was not found. Check {0}.conf files "
56                 "in tests/integration/files/conf/cloud.*.d/ to run these tests.".format(
57                     PROVIDER_NAME
58                 )
59             )
60         config_path = os.path.join(
61             RUNTIME_VARS.FILES, "conf", "cloud.providers.d", PROVIDER_NAME + ".conf"
62         )
63         log.debug("config_path: %s", config_path)
64         providers = cloud_providers_config(config_path)
65         log.debug("config: %s", providers)
66         config_path = os.path.join(
67             RUNTIME_VARS.FILES, "conf", "cloud.profiles.d", PROVIDER_NAME + ".conf"
68         )
69         profiles = vm_profiles_config(config_path, providers)
70         profile = profiles.get(PROFILE_NAME)
71         if not profile:
72             self.skipTest(
73                 "Profile {} was not found. Check {}.conf files "
74                 "in tests/integration/files/conf/cloud.profiles.d/ to run these tests.".format(
75                     PROFILE_NAME, PROVIDER_NAME
76                 )
77             )
78         base_box_name = profile.get("clonefrom")
79         if base_box_name != BASE_BOX_NAME:
80             self.skipTest(
81                 "Profile {} does not have a base box to clone from. Check {}.conf files"
82                 " in tests/integration/files/conf/cloud.profiles.d/ to run these"
83                 ' tests.And add a "clone_from: {}" to the profile'.format(
84                     PROFILE_NAME, PROVIDER_NAME, BASE_BOX_NAME
85                 )
86             )
87     @classmethod
88     def setUpClass(cls):
89         vb_create_machine(BASE_BOX_NAME)
90     @classmethod
91     def tearDownClass(cls):
92         vb_destroy_machine(BASE_BOX_NAME)
93     def test_cloud_create(self):
94         machines = self.run_cloud(
95             "-p {} {} --log-level=debug".format(PROFILE_NAME, INSTANCE_NAME)
96         )
97         self.assertIn(INSTANCE_NAME, machines.keys())
98     def test_cloud_list(self):
99         machines = self.run_cloud_function("list_nodes")
100         expected_attributes = MINIMAL_MACHINE_ATTRIBUTES
101         names = machines.keys()
102         self.assertGreaterEqual(len(names), 1, "No machines found")
103         for name, machine in machines.items():
104             self.assertCountEqual(expected_attributes, machine.keys())
105         self.assertIn(BASE_BOX_NAME, names)
106     def test_cloud_list_full(self):
107         machines = self.run_cloud_function("list_nodes_full")
108         expected_minimal_attribute_count = len(MINIMAL_MACHINE_ATTRIBUTES)
109         names = machines.keys()
110         self.assertGreaterEqual(len(names), 1, "No machines found")
111         for name, machine in machines.items():
112             self.assertGreaterEqual(
113                 len(machine.keys()), expected_minimal_attribute_count
114             )
115         self.assertIn(BASE_BOX_NAME, names)
116     def test_cloud_list_select(self):
117         machines = self.run_cloud_function("list_nodes_select")
118         expected_attributes = ["id"]
119         names = machines.keys()
120         self.assertGreaterEqual(len(names), 1, "No machines found")
121         for name, machine in machines.items():
122             self.assertCountEqual(expected_attributes, machine.keys())
123         self.assertIn(BASE_BOX_NAME, names)
124     def test_cloud_destroy(self):
125         self.test_cloud_create()
126         ret = self.run_cloud_destroy(INSTANCE_NAME)
127         self.assertIn(INSTANCE_NAME, ret.keys())
128     def test_function_show_instance(self):
129         kw_function_args = {"image": BASE_BOX_NAME}
130         machines = self.run_cloud_function("show_image", kw_function_args, timeout=30)
131         expected_minimal_attribute_count = len(MINIMAL_MACHINE_ATTRIBUTES)
132         self.assertIn(BASE_BOX_NAME, machines)
133         machine = machines[BASE_BOX_NAME]
134         self.assertGreaterEqual(len(machine.keys()), expected_minimal_attribute_count)
135     def tearDown(self):
136         if vb_machine_exists(INSTANCE_NAME):
137             vb_destroy_machine(INSTANCE_NAME)
138 @skipIf(
139     HAS_LIBS and vb_machine_exists(BOOTABLE_BASE_BOX_NAME) is False,
140     "Bootable VM '{}' not found. Cannot run tests.".format(BOOTABLE_BASE_BOX_NAME),
141 )
142 class VirtualboxProviderHeavyTests(VirtualboxCloudTestCase):
143     def assertIsIpAddress(self, ip_str):
144         try:
145             socket.inet_aton(ip_str)
146         except Exception:  # pylint: disable=broad-except
147 <a name="0"></a>            try:
148                 socket.inet_pton(socket.AF_INET6, ip_str)
149             except Exception:  # pylint: disable=broad-except
150                 self<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.fail("{} is not a valid IP address".format(ip_str))
151     def setUp(self):
152         provider_str = CONFIG_NAME
153         providers = self.run_cloud("--list-providers")
154         log.debug(</b></font>"providers: %s", providers)
155         if provider_str not in providers:
156             self.skipTest(
157                 "Configuration file for {0} was not found. Check {0}.conf files "
158                 "in tests/integration/files/conf/cloud.*.d/ to run these tests.".format(
159                     PROVIDER_NAME
160                 )
161             )
162         config_path = os.path.join(
163             RUNTIME_VARS.FILES, "conf", "cloud.providers.d", PROVIDER_NAME + ".conf"
164         )
165         log.debug("config_path: %s", config_path)
166         providers = cloud_providers_config(config_path)
167         log.debug("config: %s", providers)
168         config_path = os.path.join(
169             RUNTIME_VARS.FILES, "conf", "cloud.profiles.d", PROVIDER_NAME + ".conf"
170         )
171         profiles = vm_profiles_config(config_path, providers)
172         profile = profiles.get(DEPLOY_PROFILE_NAME)
173         if not profile:
174             self.skipTest(
175                 "Profile {} was not found. Check {}.conf files "
176                 "in tests/integration/files/conf/cloud.profiles.d/ to run these tests.".format(
177                     DEPLOY_PROFILE_NAME, PROVIDER_NAME
178                 )
179             )
180         base_box_name = profile.get("clonefrom")
181         if base_box_name != BOOTABLE_BASE_BOX_NAME:
182             self.skipTest(
183                 "Profile {} does not have a base box to clone from. Check {}.conf files"
184                 " in tests/integration/files/conf/cloud.profiles.d/ to run these"
185                 ' tests.And add a "clone_from: {}" to the profile'.format(
186                     PROFILE_NAME, PROVIDER_NAME, BOOTABLE_BASE_BOX_NAME
187                 )
188             )
189     def tearDown(self):
190         try:
191             vb_stop_vm(BOOTABLE_BASE_BOX_NAME)
192         except Exception:  # pylint: disable=broad-except
193             pass
194         if vb_machine_exists(INSTANCE_NAME):
195             try:
196                 vb_stop_vm(INSTANCE_NAME)
197                 vb_destroy_machine(INSTANCE_NAME)
198             except Exception as e:  # pylint: disable=broad-except
199                 log.warning("Possibly dirty state after exception", exc_info=True)
200     def test_deploy(self):
201         machines = self.run_cloud(
202             "-p {} {} --log-level=debug".format(DEPLOY_PROFILE_NAME, INSTANCE_NAME)
203         )
204         self.assertIn(INSTANCE_NAME, machines.keys())
205         machine = machines[INSTANCE_NAME]
206         self.assertIn("deployed", machine)
207         self.assertTrue(machine["deployed"], "Machine wasn't deployed :(")
208     def test_start_stop_action(self):
209         res = self.run_cloud_action("start", BOOTABLE_BASE_BOX_NAME, timeout=10)
210         log.info(res)
211         machine = res.get(BOOTABLE_BASE_BOX_NAME)
212         self.assertIsNotNone(machine)
213         expected_state = "Running"
214         state = machine.get("state")
215         self.assertEqual(state, expected_state)
216         res = self.run_cloud_action("stop", BOOTABLE_BASE_BOX_NAME, timeout=10)
217         log.info(res)
218         machine = res.get(BOOTABLE_BASE_BOX_NAME)
219         self.assertIsNotNone(machine)
220         expected_state = "PoweredOff"
221         state = machine.get("state")
222         self.assertEqual(state, expected_state)
223     def test_restart_action(self):
224         pass
225     def test_network_addresses(self):
226         ip_addresses = vb_get_network_addresses(machine_name=BOOTABLE_BASE_BOX_NAME)
227         network_count = len(ip_addresses)
228         self.assertEqual(network_count, 0)
229         vb_start_vm(BOOTABLE_BASE_BOX_NAME)
230         ip_addresses = vb_wait_for_network_address(
231             20, machine_name=BOOTABLE_BASE_BOX_NAME
232         )
233         network_count = len(ip_addresses)
234         self.assertGreater(network_count, 0)
235         for ip_address in ip_addresses:
236             self.assertIsIpAddress(ip_address)
237 @skipIf(HAS_LIBS is False, "The 'vboxapi' library is not available")
238 class BaseVirtualboxTests(TestCase):
239     def test_get_manager(self):
240         self.assertIsNotNone(vb_get_box())
241 class CreationDestructionVirtualboxTests(VirtualboxTestCase):
242     def test_vm_creation_and_destruction(self):
243         vm_name = BASE_BOX_NAME
244         vb_create_machine(vm_name)
245         self.assertMachineExists(vm_name)
246         vb_destroy_machine(vm_name)
247         self.assertMachineDoesNotExist(vm_name)
248 class CloneVirtualboxTests(VirtualboxTestCase):
249     def setUp(self):
250         self.vbox = vb_get_box()
251         self.name = "SaltCloudVirtualboxTestVM"
252         vb_create_machine(self.name)
253         self.assertMachineExists(self.name)
254     def tearDown(self):
255         vb_destroy_machine(self.name)
256         self.assertMachineDoesNotExist(self.name)
257     def test_create_machine(self):
258         vb_name = "NewTestMachine"
259         machine = vb_clone_vm(name=vb_name, clone_from=self.name)
260         self.assertEqual(machine.get("name"), vb_name)
261         self.assertMachineExists(vb_name)
262         vb_destroy_machine(vb_name)
263         self.assertMachineDoesNotExist(vb_name)
264 @skipIf(
265     HAS_LIBS and vb_machine_exists(BOOTABLE_BASE_BOX_NAME) is False,
266     "Bootable VM '{}' not found. Cannot run tests.".format(BOOTABLE_BASE_BOX_NAME),
267 )
268 class BootVirtualboxTests(VirtualboxTestCase):
269     def test_start_stop(self):
270         for i in range(2):
271             machine = vb_start_vm(BOOTABLE_BASE_BOX_NAME, 20000)
272             self.assertEqual(machine_get_machinestate_str(machine), "Running")
273             machine = vb_stop_vm(BOOTABLE_BASE_BOX_NAME)
274             self.assertEqual(machine_get_machinestate_str(machine), "PoweredOff")
275 class XpcomConversionTests(TestCase):
276     @classmethod
277     def _mock_xpcom_object(cls, interface_name=None, attributes=None):
278         class XPCOM:
279             def __str__(self):
280                 return "&lt;XPCOM component '&lt;unknown&gt;' (implementing {})&gt;".format(
281                     interface_name
282                 )
283         o = XPCOM()
284         if attributes and isinstance(attributes, dict):
285             for key, value in attributes.items():
286                 setattr(o, key, value)
287         return o
288     def test_unknown_object(self):
289         xpcom = XpcomConversionTests._mock_xpcom_object()
290         ret = vb_xpcom_to_attribute_dict(xpcom)
291         self.assertDictEqual(ret, dict())
292     def test_imachine_object_default(self):
293         interface = "IMachine"
294         imachine = XpcomConversionTests._mock_xpcom_object(interface)
295         ret = vb_xpcom_to_attribute_dict(imachine, interface_name=interface)
296         expected_attributes = XPCOM_ATTRIBUTES[interface]
297         self.assertIsNotNone(expected_attributes, "%s is unknown")
298         for key in ret:
299             self.assertIn(key, expected_attributes)
300     def test_override_attributes(self):
301         expected_dict = {"herp": "derp", "lol": "rofl", "something": 12345}
302         xpc = XpcomConversionTests._mock_xpcom_object(attributes=expected_dict)
303         ret = vb_xpcom_to_attribute_dict(xpc, attributes=expected_dict.keys())
304         self.assertDictEqual(ret, expected_dict)
305     def test_extra_attributes(self):
306         interface = "IMachine"
307         expected_extras = {
308             "extra": "extra",
309         }
310         expected_machine = {
311             attribute: attribute for attribute in XPCOM_ATTRIBUTES[interface]
312         }
313         expected_machine.update(expected_extras)
314         imachine = XpcomConversionTests._mock_xpcom_object(
315             interface, attributes=expected_machine
316         )
317         ret = vb_xpcom_to_attribute_dict(
318             imachine, interface_name=interface, extra_attributes=expected_extras.keys()
319         )
320         self.assertDictEqual(ret, expected_machine)
321         ret_keys = ret.keys()
322         for key in expected_extras:
323             self.assertIn(key, ret_keys)
324     def test_extra_nonexistent_attributes(self):
325         expected_extra_dict = {"nonexistent": ""}
326         xpcom = XpcomConversionTests._mock_xpcom_object()
327         ret = vb_xpcom_to_attribute_dict(
328             xpcom, extra_attributes=expected_extra_dict.keys()
329         )
330         self.assertDictEqual(ret, expected_extra_dict)
331     def test_extra_nonexistent_attribute_with_default(self):
332         expected_extras = [("nonexistent", list)]
333         expected_extra_dict = {"nonexistent": []}
334         xpcom = XpcomConversionTests._mock_xpcom_object()
335         ret = vb_xpcom_to_attribute_dict(xpcom, extra_attributes=expected_extras)
336         self.assertDictEqual(ret, expected_extra_dict)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
