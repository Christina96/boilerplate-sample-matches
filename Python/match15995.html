<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_linux_lvm.py &amp; test_useradd_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_linux_lvm.py &amp; test_useradd_1.py
      </h3>
<h1 align="center">
        11.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_linux_lvm.py (14.375%)<th>test_useradd_1.py (9.808103%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(119-125)<td><a href="#" name="0">(204-210)</a><td align="center"><font color="#ff0000">27</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(61-67)<td><a href="#" name="1">(56-62)</a><td align="center"><font color="#ff0000">27</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(266-273)<td><a href="#" name="2">(240-249)</a><td align="center"><font color="#7a0000">13</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(165-170)<td><a href="#" name="3">(220-224)</a><td align="center"><font color="#7a0000">13</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(370-379)<td><a href="#" name="4">(121-131)</a><td align="center"><font color="#710000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_linux_lvm.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import os.path
2 import salt.modules.linux_lvm as linux_lvm
3 from tests.support.mixins import LoaderModuleMockMixin
4 from tests.support.mock import MagicMock, patch
5 from tests.support.unit import TestCase
6 class LinuxLVMTestCase(TestCase, LoaderModuleMockMixin):
7     def setup_loader_modules(self):
8         return {linux_lvm: {}}
9     def test_version(self):
10         mock = MagicMock(
11             return_value=(
12                 "  LVM version:     2.02.168(2) (2016-11-30)\n"
13                 "  Library version: 1.03.01 (2016-11-30)\n"
14                 "  Driver version:  4.35.0\n"
15             )
16         )
17         with patch.dict(linux_lvm.__salt__, {"cmd.run": mock}):
18             self.assertEqual(linux_lvm.version(), "2.02.168(2) (2016-11-30)")
19     def test_fullversion(self):
20         mock = MagicMock(
21             return_value=(
22                 "  LVM version:     2.02.168(2) (2016-11-30)\n"
23                 "  Library version: 1.03.01 (2016-11-30)\n"
24                 "  Driver version:  4.35.0\n"
25             )
26         )
27         with patch.dict(linux_lvm.__salt__, {"cmd.run": mock}):
28             self.assertDictEqual(
29                 linux_lvm.fullversion(),
30                 {
31                     "LVM version": "2.02.168(2) (2016-11-30)",
32                     "Library version": "1.03.01 (2016-11-30)",
33                     "Driver version": "4.35.0",
34                 },
35             )
36     def test_pvdisplay(self):
37         Tests information about the physical volume(s)
38         """
39         mock <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value={"retcode": 1})
40         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
41             self.assertDictEqual(linux_lvm.pvdisplay(), {})
42         mock = MagicMock(return_value={"retcode": 1})
43         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
44             self.assertDictEqual(linux_lvm.pvdisplay(</b></font>quiet=True), {})
45             mock.assert_called_with(
46                 ["pvdisplay", "-c"], ignore_retcode=True, python_shell=False
47             )
48         mock = MagicMock(return_value={"retcode": 0, "stdout": "A:B:C:D:E:F:G:H:I:J:K"})
49         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
50             self.assertDictEqual(
51                 linux_lvm.pvdisplay(),
52                 {
53                     "A": {
54                         "Allocated Physical Extents": "K",
55                         "Current Logical Volumes Here": "G",
56                         "Free Physical Extents": "J",
57                         "Internal Physical Volume Number": "D",
58                         "Physical Extent Size (kB)": "H",
59                         "Physical Volume (not) Allocatable": "F",
60                         "Physical Volume Device": "A",
61                         "Physical Volume Size (kB)": "C",
62                         "Physical Volume Status": "E",
63                         "Total Physical Extents": "I",
64                         "Volume Group Name": "B",
65                     }
66                 },
67             )
68             mockpath = MagicMock(return_value="Z")
69             with patch.object(os.path, "realpath", mockpath):
70                 self.assertDictEqual(
71                     linux_lvm.pvdisplay(real=True),
72                     {
73                         "Z": {
74                             "Allocated Physical Extents": "K",
75                             "Current Logical Volumes Here": "G",
76                             "Free Physical Extents": "J",
77                             "Internal Physical Volume Number": "D",
78                             "Physical Extent Size (kB)": "H",
79                             "Physical Volume (not) Allocatable": "F",
80                             "Physical Volume Device": "A",
81                             "Physical Volume Size (kB)": "C",
82                             "Physical Volume Status": "E",
83                             "Real Physical Volume Device": "Z",
84                             "Total Physical Extents": "I",
85                             "Volume Group Name": "B",
86                         }
87                     },
88                 )
89     def test_vgdisplay(self):
90         Tests information about the volume group(s)
91         """
92         mock <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value={"retcode": 1})
93         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
94             self.assertDictEqual(linux_lvm.vgdisplay(), {})
95         mock = MagicMock(return_value={"retcode": 1})
96         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
97             self.assertDictEqual(linux_lvm.vgdisplay(</b></font>quiet=True), {})
98             mock.assert_called_with(
99                 ["vgdisplay", "-c"], ignore_retcode=True, python_shell=False
100             )
101         mock = MagicMock(
102             return_value={"retcode": 0, "stdout": "A:B:C:D:E:F:G:H:I:J:K:L:M:N:O:P:Q"}
103         )
104         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
105             self.assertDictEqual(
106                 linux_lvm.vgdisplay(),
107                 {
108                     "A": {
109                         "Actual Physical Volumes": "K",
110                         "Allocated Physical Extents": "O",
111                         "Current Logical Volumes": "F",
112                         "Current Physical Volumes": "J",
113                         "Free Physical Extents": "P",
114                         "Internal Volume Group Number": "D",
115                         "Maximum Logical Volume Size": "H",
116                         "Maximum Logical Volumes": "E",
117                         "Maximum Physical Volumes": "I",
118                         "Open Logical Volumes": "G",
119                         "Physical Extent Size (kB)": "M",
120                         "Total Physical Extents": "N",
121                         "UUID": "Q",
122                         "Volume Group Access": "B",
123                         "Volume Group Name": "A",
124                         "Volume Group Size (kB)": "L",
125                         "Volume Group Status": "C",
126                     }
127                 },
128             )
129     def test_lvdisplay(self):
130         """
131         Return information about the logical volume(s)
132         mock = MagicMock(return_value={"retcode": 1})
133         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
134             self<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertDictEqual(linux_lvm.lvdisplay(), {})
135         mock = MagicMock(
136             return_value={"retcode": 0, "stdout": "A:B:C:D:E:F:G:H:I:J:K:L:M"}
137         )
138         with patch.dict(linux_lvm.</b></font>__salt__, {"cmd.run_all": mock}):
139             self.assertDictEqual(
140                 linux_lvm.lvdisplay(),
141                 {
142                     "A": {
143                         "Allocated Logical Extents": "I",
144                         "Allocation Policy": "J",
145                         "Current Logical Extents Associated": "H",
146                         "Internal Logical Volume Number": "E",
147                         "Logical Volume Access": "C",
148                         "Logical Volume Name": "A",
149                         "Logical Volume Size": "G",
150                         "Logical Volume Status": "D",
151                         "Major Device Number": "L",
152                         "Minor Device Number": "M",
153                         "Open Logical Volumes": "F",
154                         "Read Ahead Sectors": "K",
155                         "Volume Group Name": "B",
156                     }
157                 },
158             )
159     def test_pvcreate(self):
160         """
161         Tests for set a physical device to be used as an LVM physical volume
162         """
163         self.assertEqual(
164             linux_lvm.pvcreate(""), "Error: at least one device is required"
165         )
166         self.assertEqual(linux_lvm.pvcreate("A"), "A does not exist")
167         pvdisplay = MagicMock(side_effect=[False, True])
168         with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
169             with patch.object(os.path, "exists", return_value=True):
170                 ret = {
171                     "stdout": "saltines",
172                     "stderr": "cheese",
173                     "retcode": 0,
174                     "pid": "1337",
175                 }
176                 mock = MagicMock(return_value=ret)
177                 with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
178                     self.assertEqual(linux_lvm.pvcreate("A", metadatasize=1000), True)
179     def test_pvcreate_existing_pvs(self):
180         """
181         Test a scenario when all the submitted devices are already LVM PVs.
182         """
183         pvdisplay = MagicMock(return_value=True)
184         with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
185             with patch.object(os.path, "exists", return_value=True):
186                 ret = {
187                     "stdout": "saltines",
188                     "stderr": "cheese",
189                     "retcode": 0,
190                     "pid": "1337",
191                 }
192                 cmd_mock = MagicMock(return_value=ret)
193                 with patch.dict(linux_lvm.__salt__, {"cmd.run_all": cmd_mock}):
194                     self.assertEqual(linux_lvm.pvcreate("A", metadatasize=1000), True)
195                     self.assertTrue(cmd_mock.call_count == 0)
196     def test_pvremove_not_pv(self):
197         """
198         Tests for remove a physical device not being used as an LVM physical volume
199         """
200         pvdisplay = MagicMock(return_value=False)
201         with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
202             self.assertEqual(
203                 linux_lvm.pvremove("A", override=False), "A is not a physical volume"
204             )
205         pvdisplay = MagicMock(return_value=False)
206         with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
207             self.assertEqual(linux_lvm.pvremove("A"), True)
208     def test_pvremove(self):
209         """
210         Tests for remove a physical device being used as an LVM physical volume
211         """
212         pvdisplay = MagicMock(return_value=False)
213         with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
214             mock = MagicMock(return_value=True)
215             with patch.dict(linux_lvm.__salt__, {"lvm.pvdisplay": mock}):
216                 ret = {
217                     "stdout": "saltines",
218                     "stderr": "cheese",
219                     "retcode": 0,
220                     "pid": "1337",
221                 mock = MagicMock(return_value=ret)
222                 with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
223                     self<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertEqual(linux_lvm.pvremove("A"), True)
224     def test_pvresize_not_pv(self):
225         """
226         Tests for resize a physical device not being used as an LVM physical volume
227         """
228         pvdisplay = MagicMock(return_value=False)
229         with</b></font> patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
230             self.assertEqual(
231                 linux_lvm.pvresize("A", override=False), "A is not a physical volume"
232             )
233         pvdisplay = MagicMock(return_value=False)
234         with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
235             self.assertEqual(linux_lvm.pvresize("A"), True)
236     def test_pvresize(self):
237         """
238         Tests for resize a physical device being used as an LVM physical volume
239         """
240         pvdisplay = MagicMock(return_value=False)
241         with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
242             mock = MagicMock(return_value=True)
243             with patch.dict(linux_lvm.__salt__, {"lvm.pvdisplay": mock}):
244                 ret = {
245                     "stdout": "saltines",
246                     "stderr": "cheese",
247                     "retcode": 0,
248                     "pid": "1337",
249                 }
250                 mock = MagicMock(return_value=ret)
251                 with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
252                     self.assertEqual(linux_lvm.pvresize("A"), True)
253     def test_vgcreate(self):
254         """
255         Tests create an LVM volume group
256         """
257         self.assertEqual(
258             linux_lvm.vgcreate("", ""), "Error: vgname and device(s) are both required"
259         )
260         mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
261         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
262             with patch.object(linux_lvm, "vgdisplay", return_value={}):
263                 self.assertDictEqual(
264                     linux_lvm.vgcreate("fakevg", "B"),
265                     {
266                         "Output from vgcreate": (
267                             'Volume group "fakevg" successfully created'
268                         )
269                     },
270                 )
271     def test_vgextend(self):
272         """
273         Tests add physical volumes to an LVM volume group
274         """
275         self.assertEqual(
276             linux_lvm.vgextend("", ""), "Error: vgname and device(s) are both required"
277         )
278         mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
279         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
280             with patch.object(linux_lvm, "vgdisplay", return_value={}):
281                 self.assertDictEqual(
282                     linux_lvm.vgextend("fakevg", "B"),
283                     {
284                         "Output from vgextend": (
285                             'Volume group "fakevg" successfully extended'
286                         )
287                     },
288                 )
289     def test_lvcreate(self):
290         """
291         Test create a new logical volume, with option
292         for which physical volume to be used
293         """
294         self.assertEqual(
295             linux_lvm.lvcreate(None, None, 1, 1),
296             "Error: Please specify only one of size or extents",
297         )
298         self.assertEqual(
299             linux_lvm.lvcreate(None, None, None, None),
300             "Error: Either size or extents must be specified",
301         )
302         self.assertEqual(
303             linux_lvm.lvcreate(None, None, thinvolume=True, thinpool=True),
304             "Error: Please set only one of thinvolume or thinpool to True",
305         )
306         self.assertEqual(
307             linux_lvm.lvcreate(None, None, thinvolume=True, extents=1),
308             "Error: Thin volume size cannot be specified as extents",
309         )
310         mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
311         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
312                 self.assertDictEqual(
313                     linux_lvm.lvcreate(None, None, None, 1),
314                     {"<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>Output from lvcreate": 'Logical volume "None" created.'},
315                 )
316     def test_lvcreate_with_force(self):
317         """
318         Test create a new logical volume, with option
319         for which physical volume to be used
320         """
321         mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
322         with patch.dict(linux_lvm.</b></font>__salt__, {"cmd.run_all": mock}):
323             with patch.object(linux_lvm, "lvdisplay", return_value={}):
324                 self.assertDictEqual(
325                     linux_lvm.lvcreate(None, None, None, 1, force=True),
326                     {"Output from lvcreate": 'Logical volume "None" created.'},
327                 )
328     def test_lvcreate_extra_arguments_no_parameter(self):
329         extra_args = {
330             "nosync": None,
331             "noudevsync": None,
332             "ignoremonitoring": None,
333             "thin": None,
334         }
335         mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
336         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
337             with patch.object(linux_lvm, "lvdisplay", return_value={}):
338                 self.assertDictEqual(
339                     linux_lvm.lvcreate(None, None, None, 1, **extra_args),
340                     {"Output from lvcreate": 'Logical volume "None" created.'},
341                 )
342         expected_args = ["--{}".format(arg) for arg in extra_args]
343         processed_extra_args = mock.call_args.args[0][-(len(extra_args) + 1) : -1]
344         self.assertTrue(all([arg in expected_args for arg in processed_extra_args]))
345     def test_lvcreate_invalid_extra_parameter(self):
346         invalid_parameter = {"foo": "bar"}
347         mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
348         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
349             with patch.object(linux_lvm, "lvdisplay", return_value={}):
350                 self.assertDictEqual(
351                     linux_lvm.lvcreate(None, None, None, 1, **invalid_parameter),
352                     {"Output from lvcreate": 'Logical volume "None" created.'},
353                 )
354         processed_command = mock.call_args.args[0]
355         self.assertFalse("--foo" in processed_command)
356     def test_vgremove(self):
357         """
358         Tests to remove an LVM volume group
359         """
360         mock = MagicMock(
361             return_value={
362                 "retcode": 0,
363                 "stdout": '  Volume group "fakevg" successfully removed',
364             }
365         )
366         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
367             self.assertEqual(
368                 linux_lvm.vgremove("fakevg"),
369                 'Volume group "fakevg" successfully removed',
370             )
371     def test_lvremove(self):
372         """
373         Test to remove a given existing logical volume
374         from a named existing volume group
375         """
376         mock = MagicMock(
377             return_value={
378                 "retcode": 0,
379                 "stdout": '  Logical volume "lvtest" successfully removed',
380             }
381         )
382         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
383             self.assertEqual(
384                 linux_lvm.lvremove("fakelv", "fakevg"),
385                 'Logical volume "fakelv" successfully removed',
386             )
387     def test_lvresize(self):
388         """
389         Tests to resize an LVM logical volume
390         """
391         self.assertEqual(linux_lvm.lvresize(1, None, 1), {})
392         self.assertEqual(linux_lvm.lvresize(None, None, None), {})
393         mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
394         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
395             self.assertDictEqual(
396                 linux_lvm.lvresize(12, "/dev/fakevg/fakelv"),
397                 {
398                     "Output from lvresize": (
399                         'Logical volume "/dev/fakevg/fakelv" successfully resized.'
400                     )
401                 },
402             )
403     def test_lvextend(self):
404         """
405         Tests to extend an LVM logical volume
406         """
407         self.assertEqual(linux_lvm.lvextend(1, None, 1), {})
408         self.assertEqual(linux_lvm.lvextend(None, None, None), {})
409         mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
410         with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
411             self.assertDictEqual(
412                 linux_lvm.lvextend(12, "/dev/fakevg/fakelv"),
413                 {
414                     "Output from lvextend": (
415                         'Logical volume "/dev/fakevg/fakelv" successfully extended.'
416                     )
417                 },
418             )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_useradd_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 """
2     :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
3 """
4 import salt.modules.useradd as useradd
5 from salt.exceptions import CommandExecutionError
6 from tests.support.mixins import LoaderModuleMockMixin
7 from tests.support.mock import MagicMock, patch
8 from tests.support.unit import TestCase, skipIf
9 try:
10     import pwd
11     HAS_PWD = True
12 except ImportError:
13     HAS_PWD = False
14 class UserAddTestCase(TestCase, LoaderModuleMockMixin):
15     """
16     Test cases for salt.modules.useradd
17     """
18     def setup_loader_modules(self):
19         return {useradd: {}}
20     @classmethod
21     def setUpClass(cls):
22         cls.mock_pwall = {
23             "gid": 0,
24             "groups": ["root"],
25             "home": "/root",
26             "name": "root",
27             "passwd": "x",
28             "shell": "/bin/bash",
29             "uid": 0,
30             "fullname": "root",
31             "roomnumber": "",
32             "workphone": "",
33             "homephone": "",
34             "other": "",
35         }
36     @classmethod
37     def tearDownClass(cls):
38         del cls.mock_pwall
39     def test_add(self):
40         """
41         """
42         with patch.dict(useradd.__grains__, {"kernel": "OpenBSD"}):
43             mock <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value={"retcode": 0})
44             with patch.dict(useradd.__salt__, {"cmd.run_all": mock}):
45                 self.assertTrue(useradd.add("Salt"))
46             mock = MagicMock(return_value={"retcode": 1})
47             with patch.dict(useradd.__salt__, {"cmd.run_all": mock}):
48                 self.assertFalse(useradd.add(</b></font>"Salt"))
49     @skipIf(HAS_PWD is False, "The pwd module is not available")
50     def test_getent(self):
51         """
52         Test if user.getent already have a value
53         """
54         with patch("salt.modules.useradd.__context__", MagicMock(return_value="Salt")):
55             self.assertTrue(useradd.getent())
56     @skipIf(HAS_PWD is False, "The pwd module is not available")
57     def test_getent_user(self):
58         """
59         Tests the return information on all users
60         """
61         with patch("pwd.getpwall", MagicMock(return_value=[""])):
62             ret = [
63                 {
64                     "gid": 0,
65                     "groups": ["root"],
66                     "home": "/root",
67                     "name": "root",
68                     "passwd": "x",
69                     "shell": "/bin/bash",
70                     "uid": 0,
71                     "fullname": "root",
72                     "roomnumber": "",
73                     "workphone": "",
74                     "homephone": "",
75                     "other": "",
76                 }
77             ]
78             with patch(
79                 "salt.modules.useradd._format_info",
80                 MagicMock(return_value=self.mock_pwall),
81             ):
82                 self.assertEqual(useradd.getent(), ret)
83     def test_chuid(self):
84         """
85         Test if the uid of a user change
86         """
87         mock = MagicMock(return_value={"uid": 11})
88         with patch.object(useradd, "info", mock):
89             self.assertTrue(useradd.chuid("name", 11))
90         mock_run = MagicMock(return_value=None)
91         with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
92             mock = MagicMock(side_effect=[{"uid": 11}, {"uid": 11}])
93             with patch.object(useradd, "info", mock):
94                 self.assertFalse(useradd.chuid("name", 22))
95             mock = MagicMock(side_effect=[{"uid": 11}, {"uid": 22}])
96             with patch.object(useradd, "info", mock):
97                 self.assertTrue(useradd.chuid(<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>"name", 11))
98     def test_chgid(self):
99         """
100         Test the default group of the user
101         """
102         mock = MagicMock(return_value={"gid": 11})
103         with patch.object(useradd, "info", mock):
104             self.</b></font>assertTrue(useradd.chgid("name", 11))
105         mock_run = MagicMock(return_value=None)
106         with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
107             mock = MagicMock(side_effect=[{"gid": 22}, {"gid": 22}])
108             with patch.object(useradd, "info", mock):
109                 self.assertFalse(useradd.chgid("name", 11))
110         with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
111             mock = MagicMock(side_effect=[{"gid": 11}, {"gid": 22}])
112             with patch.object(useradd, "info", mock):
113                 self.assertTrue(useradd.chgid("name", 11))
114     def test_chshell(self):
115         """
116         Test the default shell of user
117         """
118         mock = MagicMock(return_value={"shell": "/bin/bash"})
119         with patch.object(useradd, "info", mock):
120             self.assertTrue(useradd.chshell("name", "/bin/bash"))
121         mock_run = MagicMock(return_value=None)
122         with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
123             mock = MagicMock(
124                 side_effect=[{"shell": "/bin/bash"}, {"shell": "/bin/bash"}]
125             )
126             with patch.object(useradd, "info", mock):
127                 self.assertFalse(useradd.chshell("name", "/usr/bash"))
128         with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
129             mock = MagicMock(
130                 side_effect=[{"shell": "/bin/bash"}, {"shell": "/usr/bash"}]
131             )
132             with patch.object(useradd, "info", mock):
133                 self.assertTrue(useradd.chshell("name", "/bin/bash"))
134     def test_chhome(self):
135         """
136         Test if home directory given is same as previous home directory
137         """
138         mock = MagicMock(return_value={"home": "/root"})
139         with patch.object(useradd, "info", mock):
140             self.assertTrue(useradd.chhome("name", "/root"))
141         mock = MagicMock(return_value=None)
142         with patch.dict(useradd.__salt__, {"cmd.run": mock}):
143             mock = MagicMock(side_effect=[{"home": "/root"}, {"home": "/root"}])
144             with patch.object(useradd, "info", mock):
145                 self.assertFalse(useradd.chhome("name", "/user"))
146         mock = MagicMock(return_value=None)
147         with patch.dict(useradd.__salt__, {"cmd.run": mock}):
148             mock = MagicMock(side_effect=[{"home": "/root"}, {"home": "/root"}])
149             with patch.object(useradd, "info", mock):
150                 self.assertTrue(useradd.chhome("name", "/root"))
151     def test_chgroups(self):
152         """
153         Test if user groups changed
154         """
155         mock = MagicMock(return_value=["wheel", "root"])
156         with patch.object(useradd, "list_groups", mock):
157             self.assertTrue(useradd.chgroups("foo", "wheel,root"))
158         with patch.object(useradd, "list_groups", mock):
159             with patch.dict(useradd.__grains__, {"kernel": "OpenBSD"}):
160                 mock_runall <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value={"retcode": False, "stderr": ""})
161                 with patch.dict(useradd.__salt__, {"cmd.run_all": mock_runall}):
162                     self.assertTrue(useradd.chgroups("foo", "wheel,test,root"))
163                 mock_runall = MagicMock(return_value={"retcode": True, "stderr": ""})
164                 with patch.dict(useradd.__salt__, {"cmd.run_all": mock_runall}):
165                     self.assertFalse(useradd.chgroups(</b></font>"foo", "wheel,test,root"))
166     def test_chfullname(self):
167         """
168         Test if the user's Full Name is changed
169         mock = MagicMock(return_value=False)
170         with patch.object(useradd, "_get_gecos", mock):
171             self<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertFalse(useradd.chfullname("Salt", "SaltStack"))
172         mock = MagicMock(return_value={"fullname": "SaltStack"})
173         with patch.object(useradd, "_get_gecos", mock):
174             self.</b></font>assertTrue(useradd.chfullname("Salt", "SaltStack"))
175         mock = MagicMock(return_value={"fullname": "SaltStack"})
176         with patch.object(useradd, "_get_gecos", mock):
177             mock = MagicMock(return_value=None)
178             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
179                 mock = MagicMock(return_value={"fullname": "SaltStack2"})
180                 with patch.object(useradd, "info", mock):
181                     self.assertFalse(useradd.chfullname("Salt", "SaltStack1"))
182         mock = MagicMock(return_value={"fullname": "SaltStack2"})
183         with patch.object(useradd, "_get_gecos", mock):
184             mock = MagicMock(return_value=None)
185                 mock = MagicMock(return_value={"fullname": "SaltStack2"})
186                 with patch.object(useradd, "info", mock):
187                     self<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertFalse(useradd.chfullname("Salt", "SaltStack1"))
188     def test_chroomnumber(self):
189         """
190         Test if the user's Room Number is changed
191         """
192         mock = MagicMock(return_value=False)
193         with</b></font> patch.object(useradd, "_get_gecos", mock):
194             self.assertFalse(useradd.chroomnumber("salt", 1))
195         mock = MagicMock(return_value={"roomnumber": "1"})
196         with patch.object(useradd, "_get_gecos", mock):
197             self.assertTrue(useradd.chroomnumber("salt", 1))
198         mock = MagicMock(return_value={"roomnumber": "2"})
199         with patch.object(useradd, "_get_gecos", mock):
200             mock = MagicMock(return_value=None)
201             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
202                 mock = MagicMock(return_value={"roomnumber": "3"})
203                 with patch.object(useradd, "info", mock):
204                     self.assertFalse(useradd.chroomnumber("salt", 1))
205         mock = MagicMock(return_value={"roomnumber": "3"})
206         with patch.object(useradd, "_get_gecos", mock):
207             mock = MagicMock(return_value=None)
208             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
209                 mock = MagicMock(return_value={"roomnumber": "3"})
210                 with patch.object(useradd, "info", mock):
211                     self.assertFalse(useradd.chroomnumber("salt", 1))
212     def test_chworkphone(self):
213         """
214         Test if the user's Work Phone is changed
215         """
216         mock = MagicMock(return_value=False)
217         with patch.object(useradd, "_get_gecos", mock):
218             self.assertFalse(useradd.chworkphone("salt", 1))
219         mock = MagicMock(return_value={"workphone": "1"})
220         with patch.object(useradd, "_get_gecos", mock):
221             self.assertTrue(useradd.chworkphone("salt", 1))
222         mock = MagicMock(return_value={"workphone": "2"})
223         with patch.object(useradd, "_get_gecos", mock):
224             mock = MagicMock(return_value=None)
225             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
226                 mock = MagicMock(return_value={"workphone": "3"})
227                 with patch.object(useradd, "info", mock):
228                     self.assertFalse(useradd.chworkphone("salt", 1))
229         mock = MagicMock(return_value={"workphone": "3"})
230         with patch.object(useradd, "_get_gecos", mock):
231             mock = MagicMock(return_value=None)
232             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
233                 mock = MagicMock(return_value={"workphone": "3"})
234                 with patch.object(useradd, "info", mock):
235                     self.assertFalse(useradd.chworkphone("salt", 1))
236     def test_chhomephone(self):
237         """
238         Test if the user's Home Phone is changed
239         """
240         mock = MagicMock(return_value=False)
241         with patch.object(useradd, "_get_gecos", mock):
242             self.assertFalse(useradd.chhomephone("salt", 1))
243         mock = MagicMock(return_value={"homephone": "1"})
244         with patch.object(useradd, "_get_gecos", mock):
245             self.assertTrue(useradd.chhomephone("salt", 1))
246         mock = MagicMock(return_value={"homephone": "2"})
247         with patch.object(useradd, "_get_gecos", mock):
248             mock = MagicMock(return_value=None)
249             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
250                 mock = MagicMock(return_value={"homephone": "3"})
251                 with patch.object(useradd, "info", mock):
252                     self.assertFalse(useradd.chhomephone("salt", 1))
253         mock = MagicMock(return_value={"homephone": "3"})
254         with patch.object(useradd, "_get_gecos", mock):
255             mock = MagicMock(return_value=None)
256             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
257                 mock = MagicMock(return_value={"homephone": "3"})
258                 with patch.object(useradd, "info", mock):
259                     self.assertFalse(useradd.chhomephone("salt", 1))
260     def test_chother(self):
261         """
262         Test if the user's other GECOS attribute is changed
263         """
264         mock = MagicMock(return_value=False)
265         with patch.object(useradd, "_get_gecos", mock):
266             self.assertFalse(useradd.chother("salt", 1))
267         mock = MagicMock(return_value={"other": "foobar"})
268         with patch.object(useradd, "_get_gecos", mock):
269             self.assertTrue(useradd.chother("salt", "foobar"))
270         mock = MagicMock(return_value={"other": "foobar2"})
271         with patch.object(useradd, "_get_gecos", mock):
272             mock = MagicMock(return_value=None)
273             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
274                 mock = MagicMock(return_value={"other": "foobar3"})
275                 with patch.object(useradd, "info", mock):
276                     self.assertFalse(useradd.chother("salt", "foobar"))
277         mock = MagicMock(return_value={"other": "foobar3"})
278         with patch.object(useradd, "_get_gecos", mock):
279             mock = MagicMock(return_value=None)
280             with patch.dict(useradd.__salt__, {"cmd.run": mock}):
281                 mock = MagicMock(return_value={"other": "foobar3"})
282                 with patch.object(useradd, "info", mock):
283                     self.assertFalse(useradd.chother("salt", "foobar"))
284     @skipIf(HAS_PWD is False, "The pwd module is not available")
285     def test_info(self):
286         """
287         Test the user information
288         """
289         self.assertEqual(useradd.info("username-that-does-not-exist"), {})
290         mock = MagicMock(
291             return_value=pwd.struct_passwd(
292                 (
293                     "_TEST_GROUP",
294                     "*",
295                     83,
296                     83,
297                     "AMaViS Daemon",
298                     "/var/virusmails",
299                     "/usr/bin/false",
300                 )
301             )
302         )
303         with patch.object(pwd, "getpwnam", mock):
304             self.assertEqual(
305                 useradd.info("username-that-does-not-exist")["name"], "_TEST_GROUP"
306             )
307     def test_list_groups(self):
308         """
309         Test if it return a list of groups the named user belongs to
310         """
311         with patch("salt.utils.user.get_group_list", MagicMock(return_value="Salt")):
312             self.assertEqual(useradd.list_groups("name"), "Salt")
313     @skipIf(HAS_PWD is False, "The pwd module is not available")
314     def test_list_users(self):
315         """
316         Test if it returns a list of all users
317         """
318         self.assertTrue(useradd.list_users())
319     def test_rename(self):
320         """
321         Test if the username for a named user changed
322         """
323         mock = MagicMock(return_value=False)
324         with patch.object(useradd, "info", mock):
325             self.assertRaises(CommandExecutionError, useradd.rename, "salt", 1)
326         mock = MagicMock(return_value=True)
327         with patch.object(useradd, "info", mock):
328             self.assertRaises(CommandExecutionError, useradd.rename, "salt", 1)
329         mock = MagicMock(return_value=None)
330         with patch.dict(useradd.__salt__, {"cmd.run": mock}):
331             mock = MagicMock(side_effect=[False, {"name": ""}, {"name": "salt"}])
332             with patch.object(useradd, "info", mock):
333                 self.assertTrue(useradd.rename("name", "salt"))
334         mock = MagicMock(return_value=None)
335         with patch.dict(useradd.__salt__, {"cmd.run": mock}):
336             mock = MagicMock(side_effect=[False, {"name": ""}, {"name": ""}])
337             with patch.object(useradd, "info", mock):
338                 self.assertFalse(useradd.rename("salt", "salt"))
339     def test_build_gecos_field(self):
340         """
341         Test if gecos fields are built correctly (removing trailing commas)
342         """
343         test_gecos = {
344             "fullname": "Testing",
345             "roomnumber": 1234,
346             "workphone": 22222,
347             "homephone": 99999,
348         }
349         expected_gecos_fields = "Testing,1234,22222,99999"
350         self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
351         test_gecos.pop("roomnumber")
352         test_gecos.pop("workphone")
353         expected_gecos_fields = "Testing,,,99999"
354         self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
355         test_gecos.pop("homephone")
356         expected_gecos_fields = "Testing"
357         self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
