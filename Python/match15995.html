<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html><head><title>Matches for test_linux_lvm.py &amp; test_useradd_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_linux_lvm.py &amp; test_useradd_1.py
      </h3>
<h1 align="center">
        11.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_linux_lvm.py (14.375%)<th>test_useradd_1.py (9.808103%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(119-125)<td><a href="#" name="0">(204-210)</a><td align="center"><font color="#ff0000">27</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(61-67)<td><a href="#" name="1">(56-62)</a><td align="center"><font color="#ff0000">27</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(266-273)<td><a href="#" name="2">(240-249)</a><td align="center"><font color="#7a0000">13</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(165-170)<td><a href="#" name="3">(220-224)</a><td align="center"><font color="#7a0000">13</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(370-379)<td><a href="#" name="4">(121-131)</a><td align="center"><font color="#710000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_linux_lvm.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
"""
    :codeauthor: Rupesh Tare &lt;rupesht@saltstack.com&gt;
"""


import os.path

import salt.modules.linux_lvm as linux_lvm
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase


class LinuxLVMTestCase(TestCase, LoaderModuleMockMixin):
    """
    TestCase for the salt.modules.linux_lvm module
    """

    def setup_loader_modules(self):
        return {linux_lvm: {}}

    def test_version(self):
        """
        Tests LVM version info from lvm version
        """
        mock = MagicMock(
            return_value=(
                "  LVM version:     2.02.168(2) (2016-11-30)\n"
                "  Library version: 1.03.01 (2016-11-30)\n"
                "  Driver version:  4.35.0\n"
            )
        )
        with patch.dict(linux_lvm.__salt__, {"cmd.run": mock}):
            self.assertEqual(linux_lvm.version(), "2.02.168(2) (2016-11-30)")

    def test_fullversion(self):
        """
        Tests all version info from lvm version
        """
        mock = MagicMock(
            return_value=(
                "  LVM version:     2.02.168(2) (2016-11-30)\n"
                "  Library version: 1.03.01 (2016-11-30)\n"
                "  Driver version:  4.35.0\n"
            )
        )
        with patch.dict(linux_lvm.__salt__, {"cmd.run": mock}):
            self.assertDictEqual(
                linux_lvm.fullversion(),
                {
                    "LVM version": "2.02.168(2) (2016-11-30)",
                    "Library version": "1.03.01 (2016-11-30)",
                    "Driver version": "4.35.0",
                },
            )

    def test_pvdisplay(self):
<a name="1"></a>        """
        Tests information about the physical volume(s)
        """
        mock <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value={"retcode": 1})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(linux_lvm.pvdisplay(), {})

        mock = MagicMock(return_value={"retcode": 1})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(linux_lvm.pvdisplay(</b></font>quiet=True), {})
            mock.assert_called_with(
                ["pvdisplay", "-c"], ignore_retcode=True, python_shell=False
            )

        mock = MagicMock(return_value={"retcode": 0, "stdout": "A:B:C:D:E:F:G:H:I:J:K"})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(
                linux_lvm.pvdisplay(),
                {
                    "A": {
                        "Allocated Physical Extents": "K",
                        "Current Logical Volumes Here": "G",
                        "Free Physical Extents": "J",
                        "Internal Physical Volume Number": "D",
                        "Physical Extent Size (kB)": "H",
                        "Physical Volume (not) Allocatable": "F",
                        "Physical Volume Device": "A",
                        "Physical Volume Size (kB)": "C",
                        "Physical Volume Status": "E",
                        "Total Physical Extents": "I",
                        "Volume Group Name": "B",
                    }
                },
            )

            mockpath = MagicMock(return_value="Z")
            with patch.object(os.path, "realpath", mockpath):
                self.assertDictEqual(
                    linux_lvm.pvdisplay(real=True),
                    {
                        "Z": {
                            "Allocated Physical Extents": "K",
                            "Current Logical Volumes Here": "G",
                            "Free Physical Extents": "J",
                            "Internal Physical Volume Number": "D",
                            "Physical Extent Size (kB)": "H",
                            "Physical Volume (not) Allocatable": "F",
                            "Physical Volume Device": "A",
                            "Physical Volume Size (kB)": "C",
                            "Physical Volume Status": "E",
                            "Real Physical Volume Device": "Z",
                            "Total Physical Extents": "I",
                            "Volume Group Name": "B",
                        }
                    },
                )

    def test_vgdisplay(self):
<a name="0"></a>        """
        Tests information about the volume group(s)
        """
        mock <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value={"retcode": 1})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(linux_lvm.vgdisplay(), {})

        mock = MagicMock(return_value={"retcode": 1})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(linux_lvm.vgdisplay(</b></font>quiet=True), {})
            mock.assert_called_with(
                ["vgdisplay", "-c"], ignore_retcode=True, python_shell=False
            )

        mock = MagicMock(
            return_value={"retcode": 0, "stdout": "A:B:C:D:E:F:G:H:I:J:K:L:M:N:O:P:Q"}
        )
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(
                linux_lvm.vgdisplay(),
                {
                    "A": {
                        "Actual Physical Volumes": "K",
                        "Allocated Physical Extents": "O",
                        "Current Logical Volumes": "F",
                        "Current Physical Volumes": "J",
                        "Free Physical Extents": "P",
                        "Internal Volume Group Number": "D",
                        "Maximum Logical Volume Size": "H",
                        "Maximum Logical Volumes": "E",
                        "Maximum Physical Volumes": "I",
                        "Open Logical Volumes": "G",
                        "Physical Extent Size (kB)": "M",
                        "Total Physical Extents": "N",
                        "UUID": "Q",
                        "Volume Group Access": "B",
                        "Volume Group Name": "A",
                        "Volume Group Size (kB)": "L",
                        "Volume Group Status": "C",
                    }
                },
            )

    def test_lvdisplay(self):
        """
        Return information about the logical volume(s)
<a name="3"></a>        """
        mock = MagicMock(return_value={"retcode": 1})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertDictEqual(linux_lvm.lvdisplay(), {})

        mock = MagicMock(
            return_value={"retcode": 0, "stdout": "A:B:C:D:E:F:G:H:I:J:K:L:M"}
        )
        with patch.dict(linux_lvm.</b></font>__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(
                linux_lvm.lvdisplay(),
                {
                    "A": {
                        "Allocated Logical Extents": "I",
                        "Allocation Policy": "J",
                        "Current Logical Extents Associated": "H",
                        "Internal Logical Volume Number": "E",
                        "Logical Volume Access": "C",
                        "Logical Volume Name": "A",
                        "Logical Volume Size": "G",
                        "Logical Volume Status": "D",
                        "Major Device Number": "L",
                        "Minor Device Number": "M",
                        "Open Logical Volumes": "F",
                        "Read Ahead Sectors": "K",
                        "Volume Group Name": "B",
                    }
                },
            )

    def test_pvcreate(self):
        """
        Tests for set a physical device to be used as an LVM physical volume
        """
        self.assertEqual(
            linux_lvm.pvcreate(""), "Error: at least one device is required"
        )

        self.assertEqual(linux_lvm.pvcreate("A"), "A does not exist")

        # pvdisplay() would be called by pvcreate() twice: firstly to check
        # whether a device is already initialized for use by LVM and then to
        # ensure that the pvcreate executable did its job correctly.
        pvdisplay = MagicMock(side_effect=[False, True])
        with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
            with patch.object(os.path, "exists", return_value=True):
                ret = {
                    "stdout": "saltines",
                    "stderr": "cheese",
                    "retcode": 0,
                    "pid": "1337",
                }
                mock = MagicMock(return_value=ret)
                with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
                    self.assertEqual(linux_lvm.pvcreate("A", metadatasize=1000), True)

    def test_pvcreate_existing_pvs(self):
        """
        Test a scenario when all the submitted devices are already LVM PVs.
        """
        pvdisplay = MagicMock(return_value=True)
        with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
            with patch.object(os.path, "exists", return_value=True):
                ret = {
                    "stdout": "saltines",
                    "stderr": "cheese",
                    "retcode": 0,
                    "pid": "1337",
                }
                cmd_mock = MagicMock(return_value=ret)
                with patch.dict(linux_lvm.__salt__, {"cmd.run_all": cmd_mock}):
                    self.assertEqual(linux_lvm.pvcreate("A", metadatasize=1000), True)
                    self.assertTrue(cmd_mock.call_count == 0)

    def test_pvremove_not_pv(self):
        """
        Tests for remove a physical device not being used as an LVM physical volume
        """
        pvdisplay = MagicMock(return_value=False)
        with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
            self.assertEqual(
                linux_lvm.pvremove("A", override=False), "A is not a physical volume"
            )

        pvdisplay = MagicMock(return_value=False)
        with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
            self.assertEqual(linux_lvm.pvremove("A"), True)

    def test_pvremove(self):
        """
        Tests for remove a physical device being used as an LVM physical volume
        """
        pvdisplay = MagicMock(return_value=False)
        with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
            mock = MagicMock(return_value=True)
            with patch.dict(linux_lvm.__salt__, {"lvm.pvdisplay": mock}):
                ret = {
                    "stdout": "saltines",
                    "stderr": "cheese",
                    "retcode": 0,
                    "pid": "1337",
<a name="2"></a>                }
                mock = MagicMock(return_value=ret)
                with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
                    self<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertEqual(linux_lvm.pvremove("A"), True)

    def test_pvresize_not_pv(self):
        """
        Tests for resize a physical device not being used as an LVM physical volume
        """
        pvdisplay = MagicMock(return_value=False)
        with</b></font> patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
            self.assertEqual(
                linux_lvm.pvresize("A", override=False), "A is not a physical volume"
            )

        pvdisplay = MagicMock(return_value=False)
        with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
            self.assertEqual(linux_lvm.pvresize("A"), True)

    def test_pvresize(self):
        """
        Tests for resize a physical device being used as an LVM physical volume
        """
        pvdisplay = MagicMock(return_value=False)
        with patch("salt.modules.linux_lvm.pvdisplay", pvdisplay):
            mock = MagicMock(return_value=True)
            with patch.dict(linux_lvm.__salt__, {"lvm.pvdisplay": mock}):
                ret = {
                    "stdout": "saltines",
                    "stderr": "cheese",
                    "retcode": 0,
                    "pid": "1337",
                }
                mock = MagicMock(return_value=ret)
                with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
                    self.assertEqual(linux_lvm.pvresize("A"), True)

    def test_vgcreate(self):
        """
        Tests create an LVM volume group
        """
        self.assertEqual(
            linux_lvm.vgcreate("", ""), "Error: vgname and device(s) are both required"
        )

        mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            with patch.object(linux_lvm, "vgdisplay", return_value={}):
                self.assertDictEqual(
                    linux_lvm.vgcreate("fakevg", "B"),
                    {
                        "Output from vgcreate": (
                            'Volume group "fakevg" successfully created'
                        )
                    },
                )

    def test_vgextend(self):
        """
        Tests add physical volumes to an LVM volume group
        """
        self.assertEqual(
            linux_lvm.vgextend("", ""), "Error: vgname and device(s) are both required"
        )

        mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            with patch.object(linux_lvm, "vgdisplay", return_value={}):
                self.assertDictEqual(
                    linux_lvm.vgextend("fakevg", "B"),
                    {
                        "Output from vgextend": (
                            'Volume group "fakevg" successfully extended'
                        )
                    },
                )

    def test_lvcreate(self):
        """
        Test create a new logical volume, with option
        for which physical volume to be used
        """
        self.assertEqual(
            linux_lvm.lvcreate(None, None, 1, 1),
            "Error: Please specify only one of size or extents",
        )

        self.assertEqual(
            linux_lvm.lvcreate(None, None, None, None),
            "Error: Either size or extents must be specified",
        )

        self.assertEqual(
            linux_lvm.lvcreate(None, None, thinvolume=True, thinpool=True),
            "Error: Please set only one of thinvolume or thinpool to True",
        )

        self.assertEqual(
            linux_lvm.lvcreate(None, None, thinvolume=True, extents=1),
            "Error: Thin volume size cannot be specified as extents",
        )

        mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
<a name="4"></a>            with patch.object(linux_lvm, "lvdisplay", return_value={}):
                self.assertDictEqual(
                    linux_lvm.lvcreate(None, None, None, 1),
                    {"<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>Output from lvcreate": 'Logical volume "None" created.'},
                )

    def test_lvcreate_with_force(self):
        """
        Test create a new logical volume, with option
        for which physical volume to be used
        """
        mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
        with patch.dict(linux_lvm.</b></font>__salt__, {"cmd.run_all": mock}):
            with patch.object(linux_lvm, "lvdisplay", return_value={}):
                self.assertDictEqual(
                    linux_lvm.lvcreate(None, None, None, 1, force=True),
                    {"Output from lvcreate": 'Logical volume "None" created.'},
                )

    def test_lvcreate_extra_arguments_no_parameter(self):
        extra_args = {
            "nosync": None,
            "noudevsync": None,
            "ignoremonitoring": None,
            "thin": None,
        }
        mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            with patch.object(linux_lvm, "lvdisplay", return_value={}):
                self.assertDictEqual(
                    linux_lvm.lvcreate(None, None, None, 1, **extra_args),
                    {"Output from lvcreate": 'Logical volume "None" created.'},
                )
        expected_args = ["--{}".format(arg) for arg in extra_args]
        processed_extra_args = mock.call_args.args[0][-(len(extra_args) + 1) : -1]
        self.assertTrue(all([arg in expected_args for arg in processed_extra_args]))

    def test_lvcreate_invalid_extra_parameter(self):
        invalid_parameter = {"foo": "bar"}
        mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            with patch.object(linux_lvm, "lvdisplay", return_value={}):
                self.assertDictEqual(
                    linux_lvm.lvcreate(None, None, None, 1, **invalid_parameter),
                    {"Output from lvcreate": 'Logical volume "None" created.'},
                )
        processed_command = mock.call_args.args[0]
        self.assertFalse("--foo" in processed_command)

    def test_vgremove(self):
        """
        Tests to remove an LVM volume group
        """
        mock = MagicMock(
            return_value={
                "retcode": 0,
                "stdout": '  Volume group "fakevg" successfully removed',
            }
        )
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertEqual(
                linux_lvm.vgremove("fakevg"),
                'Volume group "fakevg" successfully removed',
            )

    def test_lvremove(self):
        """
        Test to remove a given existing logical volume
        from a named existing volume group
        """
        mock = MagicMock(
            return_value={
                "retcode": 0,
                "stdout": '  Logical volume "lvtest" successfully removed',
            }
        )
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertEqual(
                linux_lvm.lvremove("fakelv", "fakevg"),
                'Logical volume "fakelv" successfully removed',
            )

    def test_lvresize(self):
        """
        Tests to resize an LVM logical volume
        """
        self.assertEqual(linux_lvm.lvresize(1, None, 1), {})

        self.assertEqual(linux_lvm.lvresize(None, None, None), {})

        mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(
                linux_lvm.lvresize(12, "/dev/fakevg/fakelv"),
                {
                    "Output from lvresize": (
                        'Logical volume "/dev/fakevg/fakelv" successfully resized.'
                    )
                },
            )

    def test_lvextend(self):
        """
        Tests to extend an LVM logical volume
        """
        self.assertEqual(linux_lvm.lvextend(1, None, 1), {})

        self.assertEqual(linux_lvm.lvextend(None, None, None), {})

        mock = MagicMock(return_value={"retcode": 0, "stderr": ""})
        with patch.dict(linux_lvm.__salt__, {"cmd.run_all": mock}):
            self.assertDictEqual(
                linux_lvm.lvextend(12, "/dev/fakevg/fakelv"),
                {
                    "Output from lvextend": (
                        'Logical volume "/dev/fakevg/fakelv" successfully extended.'
                    )
                },
            )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_useradd_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
"""
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
"""


import salt.modules.useradd as useradd
from salt.exceptions import CommandExecutionError
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase, skipIf

try:
    import pwd

    HAS_PWD = True
except ImportError:
    HAS_PWD = False


class UserAddTestCase(TestCase, LoaderModuleMockMixin):
    """
    Test cases for salt.modules.useradd
    """

    def setup_loader_modules(self):
        return {useradd: {}}

    @classmethod
    def setUpClass(cls):
        cls.mock_pwall = {
            "gid": 0,
            "groups": ["root"],
            "home": "/root",
            "name": "root",
            "passwd": "x",
            "shell": "/bin/bash",
            "uid": 0,
            "fullname": "root",
            "roomnumber": "",
            "workphone": "",
            "homephone": "",
            "other": "",
        }

    @classmethod
    def tearDownClass(cls):
        del cls.mock_pwall

    # 'add' function tests: 1

    def test_add(self):
        """
<a name="1"></a>        Test for adding a user
        """
        with patch.dict(useradd.__grains__, {"kernel": "OpenBSD"}):
            mock <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value={"retcode": 0})
            with patch.dict(useradd.__salt__, {"cmd.run_all": mock}):
                self.assertTrue(useradd.add("Salt"))

            mock = MagicMock(return_value={"retcode": 1})
            with patch.dict(useradd.__salt__, {"cmd.run_all": mock}):
                self.assertFalse(useradd.add(</b></font>"Salt"))

    # 'getent' function tests: 2

    @skipIf(HAS_PWD is False, "The pwd module is not available")
    def test_getent(self):
        """
        Test if user.getent already have a value
        """
        with patch("salt.modules.useradd.__context__", MagicMock(return_value="Salt")):
            self.assertTrue(useradd.getent())

    @skipIf(HAS_PWD is False, "The pwd module is not available")
    def test_getent_user(self):
        """
        Tests the return information on all users
        """
        with patch("pwd.getpwall", MagicMock(return_value=[""])):
            ret = [
                {
                    "gid": 0,
                    "groups": ["root"],
                    "home": "/root",
                    "name": "root",
                    "passwd": "x",
                    "shell": "/bin/bash",
                    "uid": 0,
                    "fullname": "root",
                    "roomnumber": "",
                    "workphone": "",
                    "homephone": "",
                    "other": "",
                }
            ]
            with patch(
                "salt.modules.useradd._format_info",
                MagicMock(return_value=self.mock_pwall),
            ):
                self.assertEqual(useradd.getent(), ret)

    # 'chuid' function tests: 1

    def test_chuid(self):
        """
        Test if the uid of a user change
        """
        mock = MagicMock(return_value={"uid": 11})
        with patch.object(useradd, "info", mock):
            self.assertTrue(useradd.chuid("name", 11))

        mock_run = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
            mock = MagicMock(side_effect=[{"uid": 11}, {"uid": 11}])
            with patch.object(useradd, "info", mock):
                self.assertFalse(useradd.chuid("name", 22))

<a name="4"></a>        with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
            mock = MagicMock(side_effect=[{"uid": 11}, {"uid": 22}])
            with patch.object(useradd, "info", mock):
                self.assertTrue(useradd.chuid(<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>"name", 11))

    # 'chgid' function tests: 1

    def test_chgid(self):
        """
        Test the default group of the user
        """
        mock = MagicMock(return_value={"gid": 11})
        with patch.object(useradd, "info", mock):
            self.</b></font>assertTrue(useradd.chgid("name", 11))

        mock_run = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
            mock = MagicMock(side_effect=[{"gid": 22}, {"gid": 22}])
            with patch.object(useradd, "info", mock):
                self.assertFalse(useradd.chgid("name", 11))

        with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
            mock = MagicMock(side_effect=[{"gid": 11}, {"gid": 22}])
            with patch.object(useradd, "info", mock):
                self.assertTrue(useradd.chgid("name", 11))

    # 'chshell' function tests: 1

    def test_chshell(self):
        """
        Test the default shell of user
        """
        mock = MagicMock(return_value={"shell": "/bin/bash"})
        with patch.object(useradd, "info", mock):
            self.assertTrue(useradd.chshell("name", "/bin/bash"))

        mock_run = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
            mock = MagicMock(
                side_effect=[{"shell": "/bin/bash"}, {"shell": "/bin/bash"}]
            )
            with patch.object(useradd, "info", mock):
                self.assertFalse(useradd.chshell("name", "/usr/bash"))

        with patch.dict(useradd.__salt__, {"cmd.run": mock_run}):
            mock = MagicMock(
                side_effect=[{"shell": "/bin/bash"}, {"shell": "/usr/bash"}]
            )
            with patch.object(useradd, "info", mock):
                self.assertTrue(useradd.chshell("name", "/bin/bash"))

    # 'chhome' function tests: 1

    def test_chhome(self):
        """
        Test if home directory given is same as previous home directory
        """
        mock = MagicMock(return_value={"home": "/root"})
        with patch.object(useradd, "info", mock):
            self.assertTrue(useradd.chhome("name", "/root"))

        mock = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {"cmd.run": mock}):
            mock = MagicMock(side_effect=[{"home": "/root"}, {"home": "/root"}])
            with patch.object(useradd, "info", mock):
                self.assertFalse(useradd.chhome("name", "/user"))

        mock = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {"cmd.run": mock}):
            mock = MagicMock(side_effect=[{"home": "/root"}, {"home": "/root"}])
            with patch.object(useradd, "info", mock):
                self.assertTrue(useradd.chhome("name", "/root"))

    # 'chgroups' function tests: 1

    def test_chgroups(self):
        """
        Test if user groups changed
        """
        mock = MagicMock(return_value=["wheel", "root"])
        with patch.object(useradd, "list_groups", mock):
            self.assertTrue(useradd.chgroups("foo", "wheel,root"))

<a name="0"></a>        mock = MagicMock(return_value=["wheel", "root"])
        with patch.object(useradd, "list_groups", mock):
            with patch.dict(useradd.__grains__, {"kernel": "OpenBSD"}):
                mock_runall <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value={"retcode": False, "stderr": ""})
                with patch.dict(useradd.__salt__, {"cmd.run_all": mock_runall}):
                    self.assertTrue(useradd.chgroups("foo", "wheel,test,root"))

                mock_runall = MagicMock(return_value={"retcode": True, "stderr": ""})
                with patch.dict(useradd.__salt__, {"cmd.run_all": mock_runall}):
                    self.assertFalse(useradd.chgroups(</b></font>"foo", "wheel,test,root"))

    # 'chfullname' function tests: 1

    def test_chfullname(self):
        """
        Test if the user's Full Name is changed
<a name="3"></a>        """
        mock = MagicMock(return_value=False)
        with patch.object(useradd, "_get_gecos", mock):
            self<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertFalse(useradd.chfullname("Salt", "SaltStack"))

        mock = MagicMock(return_value={"fullname": "SaltStack"})
        with patch.object(useradd, "_get_gecos", mock):
            self.</b></font>assertTrue(useradd.chfullname("Salt", "SaltStack"))

        mock = MagicMock(return_value={"fullname": "SaltStack"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"fullname": "SaltStack2"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chfullname("Salt", "SaltStack1"))

        mock = MagicMock(return_value={"fullname": "SaltStack2"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
<a name="2"></a>            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"fullname": "SaltStack2"})
                with patch.object(useradd, "info", mock):
                    self<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertFalse(useradd.chfullname("Salt", "SaltStack1"))

    # 'chroomnumber' function tests: 1

    def test_chroomnumber(self):
        """
        Test if the user's Room Number is changed
        """
        mock = MagicMock(return_value=False)
        with</b></font> patch.object(useradd, "_get_gecos", mock):
            self.assertFalse(useradd.chroomnumber("salt", 1))

        mock = MagicMock(return_value={"roomnumber": "1"})
        with patch.object(useradd, "_get_gecos", mock):
            self.assertTrue(useradd.chroomnumber("salt", 1))

        mock = MagicMock(return_value={"roomnumber": "2"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"roomnumber": "3"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chroomnumber("salt", 1))

        mock = MagicMock(return_value={"roomnumber": "3"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"roomnumber": "3"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chroomnumber("salt", 1))

    # 'chworkphone' function tests: 1

    def test_chworkphone(self):
        """
        Test if the user's Work Phone is changed
        """
        mock = MagicMock(return_value=False)
        with patch.object(useradd, "_get_gecos", mock):
            self.assertFalse(useradd.chworkphone("salt", 1))

        mock = MagicMock(return_value={"workphone": "1"})
        with patch.object(useradd, "_get_gecos", mock):
            self.assertTrue(useradd.chworkphone("salt", 1))

        mock = MagicMock(return_value={"workphone": "2"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"workphone": "3"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chworkphone("salt", 1))

        mock = MagicMock(return_value={"workphone": "3"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"workphone": "3"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chworkphone("salt", 1))

    # 'chhomephone' function tests: 1

    def test_chhomephone(self):
        """
        Test if the user's Home Phone is changed
        """
        mock = MagicMock(return_value=False)
        with patch.object(useradd, "_get_gecos", mock):
            self.assertFalse(useradd.chhomephone("salt", 1))

        mock = MagicMock(return_value={"homephone": "1"})
        with patch.object(useradd, "_get_gecos", mock):
            self.assertTrue(useradd.chhomephone("salt", 1))

        mock = MagicMock(return_value={"homephone": "2"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"homephone": "3"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chhomephone("salt", 1))

        mock = MagicMock(return_value={"homephone": "3"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"homephone": "3"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chhomephone("salt", 1))

    # 'chother' function tests: 1

    def test_chother(self):
        """
        Test if the user's other GECOS attribute is changed
        """
        mock = MagicMock(return_value=False)
        with patch.object(useradd, "_get_gecos", mock):
            self.assertFalse(useradd.chother("salt", 1))

        mock = MagicMock(return_value={"other": "foobar"})
        with patch.object(useradd, "_get_gecos", mock):
            self.assertTrue(useradd.chother("salt", "foobar"))

        mock = MagicMock(return_value={"other": "foobar2"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"other": "foobar3"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chother("salt", "foobar"))

        mock = MagicMock(return_value={"other": "foobar3"})
        with patch.object(useradd, "_get_gecos", mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {"cmd.run": mock}):
                mock = MagicMock(return_value={"other": "foobar3"})
                with patch.object(useradd, "info", mock):
                    self.assertFalse(useradd.chother("salt", "foobar"))

    # 'info' function tests: 1

    @skipIf(HAS_PWD is False, "The pwd module is not available")
    def test_info(self):
        """
        Test the user information
        """
        self.assertEqual(useradd.info("username-that-does-not-exist"), {})

        mock = MagicMock(
            return_value=pwd.struct_passwd(
                (
                    "_TEST_GROUP",
                    "*",
                    83,
                    83,
                    "AMaViS Daemon",
                    "/var/virusmails",
                    "/usr/bin/false",
                )
            )
        )
        with patch.object(pwd, "getpwnam", mock):
            self.assertEqual(
                useradd.info("username-that-does-not-exist")["name"], "_TEST_GROUP"
            )

    # 'list_groups' function tests: 1

    def test_list_groups(self):
        """
        Test if it return a list of groups the named user belongs to
        """
        with patch("salt.utils.user.get_group_list", MagicMock(return_value="Salt")):
            self.assertEqual(useradd.list_groups("name"), "Salt")

    # 'list_users' function tests: 1

    @skipIf(HAS_PWD is False, "The pwd module is not available")
    def test_list_users(self):
        """
        Test if it returns a list of all users
        """
        self.assertTrue(useradd.list_users())

    # 'list_users' function tests: 1

    def test_rename(self):
        """
        Test if the username for a named user changed
        """
        mock = MagicMock(return_value=False)
        with patch.object(useradd, "info", mock):
            self.assertRaises(CommandExecutionError, useradd.rename, "salt", 1)

        mock = MagicMock(return_value=True)
        with patch.object(useradd, "info", mock):
            self.assertRaises(CommandExecutionError, useradd.rename, "salt", 1)

        mock = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {"cmd.run": mock}):
            mock = MagicMock(side_effect=[False, {"name": ""}, {"name": "salt"}])
            with patch.object(useradd, "info", mock):
                self.assertTrue(useradd.rename("name", "salt"))

        mock = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {"cmd.run": mock}):
            mock = MagicMock(side_effect=[False, {"name": ""}, {"name": ""}])
            with patch.object(useradd, "info", mock):
                self.assertFalse(useradd.rename("salt", "salt"))

    def test_build_gecos_field(self):
        """
        Test if gecos fields are built correctly (removing trailing commas)
        """
        test_gecos = {
            "fullname": "Testing",
            "roomnumber": 1234,
            "workphone": 22222,
            "homephone": 99999,
        }
        expected_gecos_fields = "Testing,1234,22222,99999"
        self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
        test_gecos.pop("roomnumber")
        test_gecos.pop("workphone")
        expected_gecos_fields = "Testing,,,99999"
        self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
        test_gecos.pop("homephone")
        expected_gecos_fields = "Testing"
        self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
