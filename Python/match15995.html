<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_linux_lvm.py & test_useradd_1.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_linux_lvm.py & test_useradd_1.py
      </h3>
      <h1 align="center">
        11.6%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_linux_lvm.py (14.375%)<TH>test_useradd_1.py (9.808103%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match15995-0.html#0',2,'match15995-1.html#0',3)" NAME="0">(119-125)<TD><A HREF="javascript:ZweiFrames('match15995-0.html#0',2,'match15995-1.html#0',3)" NAME="0">(204-210)</A><TD ALIGN=center><FONT COLOR="#ff0000">27</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match15995-0.html#1',2,'match15995-1.html#1',3)" NAME="1">(61-67)<TD><A HREF="javascript:ZweiFrames('match15995-0.html#1',2,'match15995-1.html#1',3)" NAME="1">(56-62)</A><TD ALIGN=center><FONT COLOR="#ff0000">27</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match15995-0.html#2',2,'match15995-1.html#2',3)" NAME="2">(266-273)<TD><A HREF="javascript:ZweiFrames('match15995-0.html#2',2,'match15995-1.html#2',3)" NAME="2">(240-249)</A><TD ALIGN=center><FONT COLOR="#7a0000">13</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match15995-0.html#3',2,'match15995-1.html#3',3)" NAME="3">(165-170)<TD><A HREF="javascript:ZweiFrames('match15995-0.html#3',2,'match15995-1.html#3',3)" NAME="3">(220-224)</A><TD ALIGN=center><FONT COLOR="#7a0000">13</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match15995-0.html#4',2,'match15995-1.html#4',3)" NAME="4">(370-379)<TD><A HREF="javascript:ZweiFrames('match15995-0.html#4',2,'match15995-1.html#4',3)" NAME="4">(121-131)</A><TD ALIGN=center><FONT COLOR="#710000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_linux_lvm.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Rupesh Tare &lt;rupesht@saltstack.com&gt;
&quot;&quot;&quot;


import os.path

import salt.modules.linux_lvm as linux_lvm
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase


class LinuxLVMTestCase(TestCase, LoaderModuleMockMixin):
    &quot;&quot;&quot;
    TestCase for the salt.modules.linux_lvm module
    &quot;&quot;&quot;

    def setup_loader_modules(self):
        return {linux_lvm: {}}

    def test_version(self):
        &quot;&quot;&quot;
        Tests LVM version info from lvm version
        &quot;&quot;&quot;
        mock = MagicMock(
            return_value=(
                &quot;  LVM version:     2.02.168(2) (2016-11-30)\n&quot;
                &quot;  Library version: 1.03.01 (2016-11-30)\n&quot;
                &quot;  Driver version:  4.35.0\n&quot;
            )
        )
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run&quot;: mock}):
            self.assertEqual(linux_lvm.version(), &quot;2.02.168(2) (2016-11-30)&quot;)

    def test_fullversion(self):
        &quot;&quot;&quot;
        Tests all version info from lvm version
        &quot;&quot;&quot;
        mock = MagicMock(
            return_value=(
                &quot;  LVM version:     2.02.168(2) (2016-11-30)\n&quot;
                &quot;  Library version: 1.03.01 (2016-11-30)\n&quot;
                &quot;  Driver version:  4.35.0\n&quot;
            )
        )
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run&quot;: mock}):
            self.assertDictEqual(
                linux_lvm.fullversion(),
                {
                    &quot;LVM version&quot;: &quot;2.02.168(2) (2016-11-30)&quot;,
                    &quot;Library version&quot;: &quot;1.03.01 (2016-11-30)&quot;,
                    &quot;Driver version&quot;: &quot;4.35.0&quot;,
                },
            )

    def test_pvdisplay(self):
<A NAME="1"></A>        &quot;&quot;&quot;
        Tests information about the physical volume(s)
        &quot;&quot;&quot;
        mock <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match15995-1.html#1',3,'match15995-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= MagicMock(return_value={&quot;retcode&quot;: 1})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(linux_lvm.pvdisplay(), {})

        mock = MagicMock(return_value={&quot;retcode&quot;: 1})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(linux_lvm.pvdisplay(</B></FONT>quiet=True), {})
            mock.assert_called_with(
                [&quot;pvdisplay&quot;, &quot;-c&quot;], ignore_retcode=True, python_shell=False
            )

        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stdout&quot;: &quot;A:B:C:D:E:F:G:H:I:J:K&quot;})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(
                linux_lvm.pvdisplay(),
                {
                    &quot;A&quot;: {
                        &quot;Allocated Physical Extents&quot;: &quot;K&quot;,
                        &quot;Current Logical Volumes Here&quot;: &quot;G&quot;,
                        &quot;Free Physical Extents&quot;: &quot;J&quot;,
                        &quot;Internal Physical Volume Number&quot;: &quot;D&quot;,
                        &quot;Physical Extent Size (kB)&quot;: &quot;H&quot;,
                        &quot;Physical Volume (not) Allocatable&quot;: &quot;F&quot;,
                        &quot;Physical Volume Device&quot;: &quot;A&quot;,
                        &quot;Physical Volume Size (kB)&quot;: &quot;C&quot;,
                        &quot;Physical Volume Status&quot;: &quot;E&quot;,
                        &quot;Total Physical Extents&quot;: &quot;I&quot;,
                        &quot;Volume Group Name&quot;: &quot;B&quot;,
                    }
                },
            )

            mockpath = MagicMock(return_value=&quot;Z&quot;)
            with patch.object(os.path, &quot;realpath&quot;, mockpath):
                self.assertDictEqual(
                    linux_lvm.pvdisplay(real=True),
                    {
                        &quot;Z&quot;: {
                            &quot;Allocated Physical Extents&quot;: &quot;K&quot;,
                            &quot;Current Logical Volumes Here&quot;: &quot;G&quot;,
                            &quot;Free Physical Extents&quot;: &quot;J&quot;,
                            &quot;Internal Physical Volume Number&quot;: &quot;D&quot;,
                            &quot;Physical Extent Size (kB)&quot;: &quot;H&quot;,
                            &quot;Physical Volume (not) Allocatable&quot;: &quot;F&quot;,
                            &quot;Physical Volume Device&quot;: &quot;A&quot;,
                            &quot;Physical Volume Size (kB)&quot;: &quot;C&quot;,
                            &quot;Physical Volume Status&quot;: &quot;E&quot;,
                            &quot;Real Physical Volume Device&quot;: &quot;Z&quot;,
                            &quot;Total Physical Extents&quot;: &quot;I&quot;,
                            &quot;Volume Group Name&quot;: &quot;B&quot;,
                        }
                    },
                )

    def test_vgdisplay(self):
<A NAME="0"></A>        &quot;&quot;&quot;
        Tests information about the volume group(s)
        &quot;&quot;&quot;
        mock <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match15995-1.html#0',3,'match15995-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= MagicMock(return_value={&quot;retcode&quot;: 1})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(linux_lvm.vgdisplay(), {})

        mock = MagicMock(return_value={&quot;retcode&quot;: 1})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(linux_lvm.vgdisplay(</B></FONT>quiet=True), {})
            mock.assert_called_with(
                [&quot;vgdisplay&quot;, &quot;-c&quot;], ignore_retcode=True, python_shell=False
            )

        mock = MagicMock(
            return_value={&quot;retcode&quot;: 0, &quot;stdout&quot;: &quot;A:B:C:D:E:F:G:H:I:J:K:L:M:N:O:P:Q&quot;}
        )
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(
                linux_lvm.vgdisplay(),
                {
                    &quot;A&quot;: {
                        &quot;Actual Physical Volumes&quot;: &quot;K&quot;,
                        &quot;Allocated Physical Extents&quot;: &quot;O&quot;,
                        &quot;Current Logical Volumes&quot;: &quot;F&quot;,
                        &quot;Current Physical Volumes&quot;: &quot;J&quot;,
                        &quot;Free Physical Extents&quot;: &quot;P&quot;,
                        &quot;Internal Volume Group Number&quot;: &quot;D&quot;,
                        &quot;Maximum Logical Volume Size&quot;: &quot;H&quot;,
                        &quot;Maximum Logical Volumes&quot;: &quot;E&quot;,
                        &quot;Maximum Physical Volumes&quot;: &quot;I&quot;,
                        &quot;Open Logical Volumes&quot;: &quot;G&quot;,
                        &quot;Physical Extent Size (kB)&quot;: &quot;M&quot;,
                        &quot;Total Physical Extents&quot;: &quot;N&quot;,
                        &quot;UUID&quot;: &quot;Q&quot;,
                        &quot;Volume Group Access&quot;: &quot;B&quot;,
                        &quot;Volume Group Name&quot;: &quot;A&quot;,
                        &quot;Volume Group Size (kB)&quot;: &quot;L&quot;,
                        &quot;Volume Group Status&quot;: &quot;C&quot;,
                    }
                },
            )

    def test_lvdisplay(self):
        &quot;&quot;&quot;
        Return information about the logical volume(s)
<A NAME="3"></A>        &quot;&quot;&quot;
        mock = MagicMock(return_value={&quot;retcode&quot;: 1})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match15995-1.html#3',3,'match15995-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.assertDictEqual(linux_lvm.lvdisplay(), {})

        mock = MagicMock(
            return_value={&quot;retcode&quot;: 0, &quot;stdout&quot;: &quot;A:B:C:D:E:F:G:H:I:J:K:L:M&quot;}
        )
        with patch.dict(linux_lvm.</B></FONT>__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(
                linux_lvm.lvdisplay(),
                {
                    &quot;A&quot;: {
                        &quot;Allocated Logical Extents&quot;: &quot;I&quot;,
                        &quot;Allocation Policy&quot;: &quot;J&quot;,
                        &quot;Current Logical Extents Associated&quot;: &quot;H&quot;,
                        &quot;Internal Logical Volume Number&quot;: &quot;E&quot;,
                        &quot;Logical Volume Access&quot;: &quot;C&quot;,
                        &quot;Logical Volume Name&quot;: &quot;A&quot;,
                        &quot;Logical Volume Size&quot;: &quot;G&quot;,
                        &quot;Logical Volume Status&quot;: &quot;D&quot;,
                        &quot;Major Device Number&quot;: &quot;L&quot;,
                        &quot;Minor Device Number&quot;: &quot;M&quot;,
                        &quot;Open Logical Volumes&quot;: &quot;F&quot;,
                        &quot;Read Ahead Sectors&quot;: &quot;K&quot;,
                        &quot;Volume Group Name&quot;: &quot;B&quot;,
                    }
                },
            )

    def test_pvcreate(self):
        &quot;&quot;&quot;
        Tests for set a physical device to be used as an LVM physical volume
        &quot;&quot;&quot;
        self.assertEqual(
            linux_lvm.pvcreate(&quot;&quot;), &quot;Error: at least one device is required&quot;
        )

        self.assertEqual(linux_lvm.pvcreate(&quot;A&quot;), &quot;A does not exist&quot;)

        # pvdisplay() would be called by pvcreate() twice: firstly to check
        # whether a device is already initialized for use by LVM and then to
        # ensure that the pvcreate executable did its job correctly.
        pvdisplay = MagicMock(side_effect=[False, True])
        with patch(&quot;salt.modules.linux_lvm.pvdisplay&quot;, pvdisplay):
            with patch.object(os.path, &quot;exists&quot;, return_value=True):
                ret = {
                    &quot;stdout&quot;: &quot;saltines&quot;,
                    &quot;stderr&quot;: &quot;cheese&quot;,
                    &quot;retcode&quot;: 0,
                    &quot;pid&quot;: &quot;1337&quot;,
                }
                mock = MagicMock(return_value=ret)
                with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    self.assertEqual(linux_lvm.pvcreate(&quot;A&quot;, metadatasize=1000), True)

    def test_pvcreate_existing_pvs(self):
        &quot;&quot;&quot;
        Test a scenario when all the submitted devices are already LVM PVs.
        &quot;&quot;&quot;
        pvdisplay = MagicMock(return_value=True)
        with patch(&quot;salt.modules.linux_lvm.pvdisplay&quot;, pvdisplay):
            with patch.object(os.path, &quot;exists&quot;, return_value=True):
                ret = {
                    &quot;stdout&quot;: &quot;saltines&quot;,
                    &quot;stderr&quot;: &quot;cheese&quot;,
                    &quot;retcode&quot;: 0,
                    &quot;pid&quot;: &quot;1337&quot;,
                }
                cmd_mock = MagicMock(return_value=ret)
                with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: cmd_mock}):
                    self.assertEqual(linux_lvm.pvcreate(&quot;A&quot;, metadatasize=1000), True)
                    self.assertTrue(cmd_mock.call_count == 0)

    def test_pvremove_not_pv(self):
        &quot;&quot;&quot;
        Tests for remove a physical device not being used as an LVM physical volume
        &quot;&quot;&quot;
        pvdisplay = MagicMock(return_value=False)
        with patch(&quot;salt.modules.linux_lvm.pvdisplay&quot;, pvdisplay):
            self.assertEqual(
                linux_lvm.pvremove(&quot;A&quot;, override=False), &quot;A is not a physical volume&quot;
            )

        pvdisplay = MagicMock(return_value=False)
        with patch(&quot;salt.modules.linux_lvm.pvdisplay&quot;, pvdisplay):
            self.assertEqual(linux_lvm.pvremove(&quot;A&quot;), True)

    def test_pvremove(self):
        &quot;&quot;&quot;
        Tests for remove a physical device being used as an LVM physical volume
        &quot;&quot;&quot;
        pvdisplay = MagicMock(return_value=False)
        with patch(&quot;salt.modules.linux_lvm.pvdisplay&quot;, pvdisplay):
            mock = MagicMock(return_value=True)
            with patch.dict(linux_lvm.__salt__, {&quot;lvm.pvdisplay&quot;: mock}):
                ret = {
                    &quot;stdout&quot;: &quot;saltines&quot;,
                    &quot;stderr&quot;: &quot;cheese&quot;,
                    &quot;retcode&quot;: 0,
                    &quot;pid&quot;: &quot;1337&quot;,
<A NAME="2"></A>                }
                mock = MagicMock(return_value=ret)
                with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    self<FONT color="#980517"><A HREF="javascript:ZweiFrames('match15995-1.html#2',3,'match15995-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.assertEqual(linux_lvm.pvremove(&quot;A&quot;), True)

    def test_pvresize_not_pv(self):
        &quot;&quot;&quot;
        Tests for resize a physical device not being used as an LVM physical volume
        &quot;&quot;&quot;
        pvdisplay = MagicMock(return_value=False)
        with</B></FONT> patch(&quot;salt.modules.linux_lvm.pvdisplay&quot;, pvdisplay):
            self.assertEqual(
                linux_lvm.pvresize(&quot;A&quot;, override=False), &quot;A is not a physical volume&quot;
            )

        pvdisplay = MagicMock(return_value=False)
        with patch(&quot;salt.modules.linux_lvm.pvdisplay&quot;, pvdisplay):
            self.assertEqual(linux_lvm.pvresize(&quot;A&quot;), True)

    def test_pvresize(self):
        &quot;&quot;&quot;
        Tests for resize a physical device being used as an LVM physical volume
        &quot;&quot;&quot;
        pvdisplay = MagicMock(return_value=False)
        with patch(&quot;salt.modules.linux_lvm.pvdisplay&quot;, pvdisplay):
            mock = MagicMock(return_value=True)
            with patch.dict(linux_lvm.__salt__, {&quot;lvm.pvdisplay&quot;: mock}):
                ret = {
                    &quot;stdout&quot;: &quot;saltines&quot;,
                    &quot;stderr&quot;: &quot;cheese&quot;,
                    &quot;retcode&quot;: 0,
                    &quot;pid&quot;: &quot;1337&quot;,
                }
                mock = MagicMock(return_value=ret)
                with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    self.assertEqual(linux_lvm.pvresize(&quot;A&quot;), True)

    def test_vgcreate(self):
        &quot;&quot;&quot;
        Tests create an LVM volume group
        &quot;&quot;&quot;
        self.assertEqual(
            linux_lvm.vgcreate(&quot;&quot;, &quot;&quot;), &quot;Error: vgname and device(s) are both required&quot;
        )

        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stderr&quot;: &quot;&quot;})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            with patch.object(linux_lvm, &quot;vgdisplay&quot;, return_value={}):
                self.assertDictEqual(
                    linux_lvm.vgcreate(&quot;fakevg&quot;, &quot;B&quot;),
                    {
                        &quot;Output from vgcreate&quot;: (
                            'Volume group &quot;fakevg&quot; successfully created'
                        )
                    },
                )

    def test_vgextend(self):
        &quot;&quot;&quot;
        Tests add physical volumes to an LVM volume group
        &quot;&quot;&quot;
        self.assertEqual(
            linux_lvm.vgextend(&quot;&quot;, &quot;&quot;), &quot;Error: vgname and device(s) are both required&quot;
        )

        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stderr&quot;: &quot;&quot;})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            with patch.object(linux_lvm, &quot;vgdisplay&quot;, return_value={}):
                self.assertDictEqual(
                    linux_lvm.vgextend(&quot;fakevg&quot;, &quot;B&quot;),
                    {
                        &quot;Output from vgextend&quot;: (
                            'Volume group &quot;fakevg&quot; successfully extended'
                        )
                    },
                )

    def test_lvcreate(self):
        &quot;&quot;&quot;
        Test create a new logical volume, with option
        for which physical volume to be used
        &quot;&quot;&quot;
        self.assertEqual(
            linux_lvm.lvcreate(None, None, 1, 1),
            &quot;Error: Please specify only one of size or extents&quot;,
        )

        self.assertEqual(
            linux_lvm.lvcreate(None, None, None, None),
            &quot;Error: Either size or extents must be specified&quot;,
        )

        self.assertEqual(
            linux_lvm.lvcreate(None, None, thinvolume=True, thinpool=True),
            &quot;Error: Please set only one of thinvolume or thinpool to True&quot;,
        )

        self.assertEqual(
            linux_lvm.lvcreate(None, None, thinvolume=True, extents=1),
            &quot;Error: Thin volume size cannot be specified as extents&quot;,
        )

        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stderr&quot;: &quot;&quot;})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
<A NAME="4"></A>            with patch.object(linux_lvm, &quot;lvdisplay&quot;, return_value={}):
                self.assertDictEqual(
                    linux_lvm.lvcreate(None, None, None, 1),
                    {&quot;<FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match15995-1.html#4',3,'match15995-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Output from lvcreate&quot;: 'Logical volume &quot;None&quot; created.'},
                )

    def test_lvcreate_with_force(self):
        &quot;&quot;&quot;
        Test create a new logical volume, with option
        for which physical volume to be used
        &quot;&quot;&quot;
        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stderr&quot;: &quot;&quot;})
        with patch.dict(linux_lvm.</B></FONT>__salt__, {&quot;cmd.run_all&quot;: mock}):
            with patch.object(linux_lvm, &quot;lvdisplay&quot;, return_value={}):
                self.assertDictEqual(
                    linux_lvm.lvcreate(None, None, None, 1, force=True),
                    {&quot;Output from lvcreate&quot;: 'Logical volume &quot;None&quot; created.'},
                )

    def test_lvcreate_extra_arguments_no_parameter(self):
        extra_args = {
            &quot;nosync&quot;: None,
            &quot;noudevsync&quot;: None,
            &quot;ignoremonitoring&quot;: None,
            &quot;thin&quot;: None,
        }
        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stderr&quot;: &quot;&quot;})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            with patch.object(linux_lvm, &quot;lvdisplay&quot;, return_value={}):
                self.assertDictEqual(
                    linux_lvm.lvcreate(None, None, None, 1, **extra_args),
                    {&quot;Output from lvcreate&quot;: 'Logical volume &quot;None&quot; created.'},
                )
        expected_args = [&quot;--{}&quot;.format(arg) for arg in extra_args]
        processed_extra_args = mock.call_args.args[0][-(len(extra_args) + 1) : -1]
        self.assertTrue(all([arg in expected_args for arg in processed_extra_args]))

    def test_lvcreate_invalid_extra_parameter(self):
        invalid_parameter = {&quot;foo&quot;: &quot;bar&quot;}
        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stderr&quot;: &quot;&quot;})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            with patch.object(linux_lvm, &quot;lvdisplay&quot;, return_value={}):
                self.assertDictEqual(
                    linux_lvm.lvcreate(None, None, None, 1, **invalid_parameter),
                    {&quot;Output from lvcreate&quot;: 'Logical volume &quot;None&quot; created.'},
                )
        processed_command = mock.call_args.args[0]
        self.assertFalse(&quot;--foo&quot; in processed_command)

    def test_vgremove(self):
        &quot;&quot;&quot;
        Tests to remove an LVM volume group
        &quot;&quot;&quot;
        mock = MagicMock(
            return_value={
                &quot;retcode&quot;: 0,
                &quot;stdout&quot;: '  Volume group &quot;fakevg&quot; successfully removed',
            }
        )
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertEqual(
                linux_lvm.vgremove(&quot;fakevg&quot;),
                'Volume group &quot;fakevg&quot; successfully removed',
            )

    def test_lvremove(self):
        &quot;&quot;&quot;
        Test to remove a given existing logical volume
        from a named existing volume group
        &quot;&quot;&quot;
        mock = MagicMock(
            return_value={
                &quot;retcode&quot;: 0,
                &quot;stdout&quot;: '  Logical volume &quot;lvtest&quot; successfully removed',
            }
        )
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertEqual(
                linux_lvm.lvremove(&quot;fakelv&quot;, &quot;fakevg&quot;),
                'Logical volume &quot;fakelv&quot; successfully removed',
            )

    def test_lvresize(self):
        &quot;&quot;&quot;
        Tests to resize an LVM logical volume
        &quot;&quot;&quot;
        self.assertEqual(linux_lvm.lvresize(1, None, 1), {})

        self.assertEqual(linux_lvm.lvresize(None, None, None), {})

        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stderr&quot;: &quot;&quot;})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(
                linux_lvm.lvresize(12, &quot;/dev/fakevg/fakelv&quot;),
                {
                    &quot;Output from lvresize&quot;: (
                        'Logical volume &quot;/dev/fakevg/fakelv&quot; successfully resized.'
                    )
                },
            )

    def test_lvextend(self):
        &quot;&quot;&quot;
        Tests to extend an LVM logical volume
        &quot;&quot;&quot;
        self.assertEqual(linux_lvm.lvextend(1, None, 1), {})

        self.assertEqual(linux_lvm.lvextend(None, None, None), {})

        mock = MagicMock(return_value={&quot;retcode&quot;: 0, &quot;stderr&quot;: &quot;&quot;})
        with patch.dict(linux_lvm.__salt__, {&quot;cmd.run_all&quot;: mock}):
            self.assertDictEqual(
                linux_lvm.lvextend(12, &quot;/dev/fakevg/fakelv&quot;),
                {
                    &quot;Output from lvextend&quot;: (
                        'Logical volume &quot;/dev/fakevg/fakelv&quot; successfully extended.'
                    )
                },
            )
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_useradd_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;


import salt.modules.useradd as useradd
from salt.exceptions import CommandExecutionError
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase, skipIf

try:
    import pwd

    HAS_PWD = True
except ImportError:
    HAS_PWD = False


class UserAddTestCase(TestCase, LoaderModuleMockMixin):
    &quot;&quot;&quot;
    Test cases for salt.modules.useradd
    &quot;&quot;&quot;

    def setup_loader_modules(self):
        return {useradd: {}}

    @classmethod
    def setUpClass(cls):
        cls.mock_pwall = {
            &quot;gid&quot;: 0,
            &quot;groups&quot;: [&quot;root&quot;],
            &quot;home&quot;: &quot;/root&quot;,
            &quot;name&quot;: &quot;root&quot;,
            &quot;passwd&quot;: &quot;x&quot;,
            &quot;shell&quot;: &quot;/bin/bash&quot;,
            &quot;uid&quot;: 0,
            &quot;fullname&quot;: &quot;root&quot;,
            &quot;roomnumber&quot;: &quot;&quot;,
            &quot;workphone&quot;: &quot;&quot;,
            &quot;homephone&quot;: &quot;&quot;,
            &quot;other&quot;: &quot;&quot;,
        }

    @classmethod
    def tearDownClass(cls):
        del cls.mock_pwall

    # 'add' function tests: 1

    def test_add(self):
        &quot;&quot;&quot;
<A NAME="1"></A>        Test for adding a user
        &quot;&quot;&quot;
        with patch.dict(useradd.__grains__, {&quot;kernel&quot;: &quot;OpenBSD&quot;}):
            mock <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match15995-0.html#1',2,'match15995-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= MagicMock(return_value={&quot;retcode&quot;: 0})
            with patch.dict(useradd.__salt__, {&quot;cmd.run_all&quot;: mock}):
                self.assertTrue(useradd.add(&quot;Salt&quot;))

            mock = MagicMock(return_value={&quot;retcode&quot;: 1})
            with patch.dict(useradd.__salt__, {&quot;cmd.run_all&quot;: mock}):
                self.assertFalse(useradd.add(</B></FONT>&quot;Salt&quot;))

    # 'getent' function tests: 2

    @skipIf(HAS_PWD is False, &quot;The pwd module is not available&quot;)
    def test_getent(self):
        &quot;&quot;&quot;
        Test if user.getent already have a value
        &quot;&quot;&quot;
        with patch(&quot;salt.modules.useradd.__context__&quot;, MagicMock(return_value=&quot;Salt&quot;)):
            self.assertTrue(useradd.getent())

    @skipIf(HAS_PWD is False, &quot;The pwd module is not available&quot;)
    def test_getent_user(self):
        &quot;&quot;&quot;
        Tests the return information on all users
        &quot;&quot;&quot;
        with patch(&quot;pwd.getpwall&quot;, MagicMock(return_value=[&quot;&quot;])):
            ret = [
                {
                    &quot;gid&quot;: 0,
                    &quot;groups&quot;: [&quot;root&quot;],
                    &quot;home&quot;: &quot;/root&quot;,
                    &quot;name&quot;: &quot;root&quot;,
                    &quot;passwd&quot;: &quot;x&quot;,
                    &quot;shell&quot;: &quot;/bin/bash&quot;,
                    &quot;uid&quot;: 0,
                    &quot;fullname&quot;: &quot;root&quot;,
                    &quot;roomnumber&quot;: &quot;&quot;,
                    &quot;workphone&quot;: &quot;&quot;,
                    &quot;homephone&quot;: &quot;&quot;,
                    &quot;other&quot;: &quot;&quot;,
                }
            ]
            with patch(
                &quot;salt.modules.useradd._format_info&quot;,
                MagicMock(return_value=self.mock_pwall),
            ):
                self.assertEqual(useradd.getent(), ret)

    # 'chuid' function tests: 1

    def test_chuid(self):
        &quot;&quot;&quot;
        Test if the uid of a user change
        &quot;&quot;&quot;
        mock = MagicMock(return_value={&quot;uid&quot;: 11})
        with patch.object(useradd, &quot;info&quot;, mock):
            self.assertTrue(useradd.chuid(&quot;name&quot;, 11))

        mock_run = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock_run}):
            mock = MagicMock(side_effect=[{&quot;uid&quot;: 11}, {&quot;uid&quot;: 11}])
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertFalse(useradd.chuid(&quot;name&quot;, 22))

<A NAME="4"></A>        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock_run}):
            mock = MagicMock(side_effect=[{&quot;uid&quot;: 11}, {&quot;uid&quot;: 22}])
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertTrue(useradd.chuid(<FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match15995-0.html#4',2,'match15995-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>&quot;name&quot;, 11))

    # 'chgid' function tests: 1

    def test_chgid(self):
        &quot;&quot;&quot;
        Test the default group of the user
        &quot;&quot;&quot;
        mock = MagicMock(return_value={&quot;gid&quot;: 11})
        with patch.object(useradd, &quot;info&quot;, mock):
            self.</B></FONT>assertTrue(useradd.chgid(&quot;name&quot;, 11))

        mock_run = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock_run}):
            mock = MagicMock(side_effect=[{&quot;gid&quot;: 22}, {&quot;gid&quot;: 22}])
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertFalse(useradd.chgid(&quot;name&quot;, 11))

        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock_run}):
            mock = MagicMock(side_effect=[{&quot;gid&quot;: 11}, {&quot;gid&quot;: 22}])
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertTrue(useradd.chgid(&quot;name&quot;, 11))

    # 'chshell' function tests: 1

    def test_chshell(self):
        &quot;&quot;&quot;
        Test the default shell of user
        &quot;&quot;&quot;
        mock = MagicMock(return_value={&quot;shell&quot;: &quot;/bin/bash&quot;})
        with patch.object(useradd, &quot;info&quot;, mock):
            self.assertTrue(useradd.chshell(&quot;name&quot;, &quot;/bin/bash&quot;))

        mock_run = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock_run}):
            mock = MagicMock(
                side_effect=[{&quot;shell&quot;: &quot;/bin/bash&quot;}, {&quot;shell&quot;: &quot;/bin/bash&quot;}]
            )
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertFalse(useradd.chshell(&quot;name&quot;, &quot;/usr/bash&quot;))

        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock_run}):
            mock = MagicMock(
                side_effect=[{&quot;shell&quot;: &quot;/bin/bash&quot;}, {&quot;shell&quot;: &quot;/usr/bash&quot;}]
            )
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertTrue(useradd.chshell(&quot;name&quot;, &quot;/bin/bash&quot;))

    # 'chhome' function tests: 1

    def test_chhome(self):
        &quot;&quot;&quot;
        Test if home directory given is same as previous home directory
        &quot;&quot;&quot;
        mock = MagicMock(return_value={&quot;home&quot;: &quot;/root&quot;})
        with patch.object(useradd, &quot;info&quot;, mock):
            self.assertTrue(useradd.chhome(&quot;name&quot;, &quot;/root&quot;))

        mock = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
            mock = MagicMock(side_effect=[{&quot;home&quot;: &quot;/root&quot;}, {&quot;home&quot;: &quot;/root&quot;}])
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertFalse(useradd.chhome(&quot;name&quot;, &quot;/user&quot;))

        mock = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
            mock = MagicMock(side_effect=[{&quot;home&quot;: &quot;/root&quot;}, {&quot;home&quot;: &quot;/root&quot;}])
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertTrue(useradd.chhome(&quot;name&quot;, &quot;/root&quot;))

    # 'chgroups' function tests: 1

    def test_chgroups(self):
        &quot;&quot;&quot;
        Test if user groups changed
        &quot;&quot;&quot;
        mock = MagicMock(return_value=[&quot;wheel&quot;, &quot;root&quot;])
        with patch.object(useradd, &quot;list_groups&quot;, mock):
            self.assertTrue(useradd.chgroups(&quot;foo&quot;, &quot;wheel,root&quot;))

<A NAME="0"></A>        mock = MagicMock(return_value=[&quot;wheel&quot;, &quot;root&quot;])
        with patch.object(useradd, &quot;list_groups&quot;, mock):
            with patch.dict(useradd.__grains__, {&quot;kernel&quot;: &quot;OpenBSD&quot;}):
                mock_runall <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match15995-0.html#0',2,'match15995-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= MagicMock(return_value={&quot;retcode&quot;: False, &quot;stderr&quot;: &quot;&quot;})
                with patch.dict(useradd.__salt__, {&quot;cmd.run_all&quot;: mock_runall}):
                    self.assertTrue(useradd.chgroups(&quot;foo&quot;, &quot;wheel,test,root&quot;))

                mock_runall = MagicMock(return_value={&quot;retcode&quot;: True, &quot;stderr&quot;: &quot;&quot;})
                with patch.dict(useradd.__salt__, {&quot;cmd.run_all&quot;: mock_runall}):
                    self.assertFalse(useradd.chgroups(</B></FONT>&quot;foo&quot;, &quot;wheel,test,root&quot;))

    # 'chfullname' function tests: 1

    def test_chfullname(self):
        &quot;&quot;&quot;
        Test if the user's Full Name is changed
<A NAME="3"></A>        &quot;&quot;&quot;
        mock = MagicMock(return_value=False)
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match15995-0.html#3',2,'match15995-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.assertFalse(useradd.chfullname(&quot;Salt&quot;, &quot;SaltStack&quot;))

        mock = MagicMock(return_value={&quot;fullname&quot;: &quot;SaltStack&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.</B></FONT>assertTrue(useradd.chfullname(&quot;Salt&quot;, &quot;SaltStack&quot;))

        mock = MagicMock(return_value={&quot;fullname&quot;: &quot;SaltStack&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;fullname&quot;: &quot;SaltStack2&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chfullname(&quot;Salt&quot;, &quot;SaltStack1&quot;))

        mock = MagicMock(return_value={&quot;fullname&quot;: &quot;SaltStack2&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
<A NAME="2"></A>            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;fullname&quot;: &quot;SaltStack2&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match15995-0.html#2',2,'match15995-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.assertFalse(useradd.chfullname(&quot;Salt&quot;, &quot;SaltStack1&quot;))

    # 'chroomnumber' function tests: 1

    def test_chroomnumber(self):
        &quot;&quot;&quot;
        Test if the user's Room Number is changed
        &quot;&quot;&quot;
        mock = MagicMock(return_value=False)
        with</B></FONT> patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.assertFalse(useradd.chroomnumber(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;roomnumber&quot;: &quot;1&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.assertTrue(useradd.chroomnumber(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;roomnumber&quot;: &quot;2&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;roomnumber&quot;: &quot;3&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chroomnumber(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;roomnumber&quot;: &quot;3&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;roomnumber&quot;: &quot;3&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chroomnumber(&quot;salt&quot;, 1))

    # 'chworkphone' function tests: 1

    def test_chworkphone(self):
        &quot;&quot;&quot;
        Test if the user's Work Phone is changed
        &quot;&quot;&quot;
        mock = MagicMock(return_value=False)
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.assertFalse(useradd.chworkphone(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;workphone&quot;: &quot;1&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.assertTrue(useradd.chworkphone(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;workphone&quot;: &quot;2&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;workphone&quot;: &quot;3&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chworkphone(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;workphone&quot;: &quot;3&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;workphone&quot;: &quot;3&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chworkphone(&quot;salt&quot;, 1))

    # 'chhomephone' function tests: 1

    def test_chhomephone(self):
        &quot;&quot;&quot;
        Test if the user's Home Phone is changed
        &quot;&quot;&quot;
        mock = MagicMock(return_value=False)
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.assertFalse(useradd.chhomephone(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;homephone&quot;: &quot;1&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.assertTrue(useradd.chhomephone(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;homephone&quot;: &quot;2&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;homephone&quot;: &quot;3&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chhomephone(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;homephone&quot;: &quot;3&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;homephone&quot;: &quot;3&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chhomephone(&quot;salt&quot;, 1))

    # 'chother' function tests: 1

    def test_chother(self):
        &quot;&quot;&quot;
        Test if the user's other GECOS attribute is changed
        &quot;&quot;&quot;
        mock = MagicMock(return_value=False)
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.assertFalse(useradd.chother(&quot;salt&quot;, 1))

        mock = MagicMock(return_value={&quot;other&quot;: &quot;foobar&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            self.assertTrue(useradd.chother(&quot;salt&quot;, &quot;foobar&quot;))

        mock = MagicMock(return_value={&quot;other&quot;: &quot;foobar2&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;other&quot;: &quot;foobar3&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chother(&quot;salt&quot;, &quot;foobar&quot;))

        mock = MagicMock(return_value={&quot;other&quot;: &quot;foobar3&quot;})
        with patch.object(useradd, &quot;_get_gecos&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
                mock = MagicMock(return_value={&quot;other&quot;: &quot;foobar3&quot;})
                with patch.object(useradd, &quot;info&quot;, mock):
                    self.assertFalse(useradd.chother(&quot;salt&quot;, &quot;foobar&quot;))

    # 'info' function tests: 1

    @skipIf(HAS_PWD is False, &quot;The pwd module is not available&quot;)
    def test_info(self):
        &quot;&quot;&quot;
        Test the user information
        &quot;&quot;&quot;
        self.assertEqual(useradd.info(&quot;username-that-does-not-exist&quot;), {})

        mock = MagicMock(
            return_value=pwd.struct_passwd(
                (
                    &quot;_TEST_GROUP&quot;,
                    &quot;*&quot;,
                    83,
                    83,
                    &quot;AMaViS Daemon&quot;,
                    &quot;/var/virusmails&quot;,
                    &quot;/usr/bin/false&quot;,
                )
            )
        )
        with patch.object(pwd, &quot;getpwnam&quot;, mock):
            self.assertEqual(
                useradd.info(&quot;username-that-does-not-exist&quot;)[&quot;name&quot;], &quot;_TEST_GROUP&quot;
            )

    # 'list_groups' function tests: 1

    def test_list_groups(self):
        &quot;&quot;&quot;
        Test if it return a list of groups the named user belongs to
        &quot;&quot;&quot;
        with patch(&quot;salt.utils.user.get_group_list&quot;, MagicMock(return_value=&quot;Salt&quot;)):
            self.assertEqual(useradd.list_groups(&quot;name&quot;), &quot;Salt&quot;)

    # 'list_users' function tests: 1

    @skipIf(HAS_PWD is False, &quot;The pwd module is not available&quot;)
    def test_list_users(self):
        &quot;&quot;&quot;
        Test if it returns a list of all users
        &quot;&quot;&quot;
        self.assertTrue(useradd.list_users())

    # 'list_users' function tests: 1

    def test_rename(self):
        &quot;&quot;&quot;
        Test if the username for a named user changed
        &quot;&quot;&quot;
        mock = MagicMock(return_value=False)
        with patch.object(useradd, &quot;info&quot;, mock):
            self.assertRaises(CommandExecutionError, useradd.rename, &quot;salt&quot;, 1)

        mock = MagicMock(return_value=True)
        with patch.object(useradd, &quot;info&quot;, mock):
            self.assertRaises(CommandExecutionError, useradd.rename, &quot;salt&quot;, 1)

        mock = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
            mock = MagicMock(side_effect=[False, {&quot;name&quot;: &quot;&quot;}, {&quot;name&quot;: &quot;salt&quot;}])
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertTrue(useradd.rename(&quot;name&quot;, &quot;salt&quot;))

        mock = MagicMock(return_value=None)
        with patch.dict(useradd.__salt__, {&quot;cmd.run&quot;: mock}):
            mock = MagicMock(side_effect=[False, {&quot;name&quot;: &quot;&quot;}, {&quot;name&quot;: &quot;&quot;}])
            with patch.object(useradd, &quot;info&quot;, mock):
                self.assertFalse(useradd.rename(&quot;salt&quot;, &quot;salt&quot;))

    def test_build_gecos_field(self):
        &quot;&quot;&quot;
        Test if gecos fields are built correctly (removing trailing commas)
        &quot;&quot;&quot;
        test_gecos = {
            &quot;fullname&quot;: &quot;Testing&quot;,
            &quot;roomnumber&quot;: 1234,
            &quot;workphone&quot;: 22222,
            &quot;homephone&quot;: 99999,
        }
        expected_gecos_fields = &quot;Testing,1234,22222,99999&quot;
        self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
        test_gecos.pop(&quot;roomnumber&quot;)
        test_gecos.pop(&quot;workphone&quot;)
        expected_gecos_fields = &quot;Testing,,,99999&quot;
        self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
        test_gecos.pop(&quot;homephone&quot;)
        expected_gecos_fields = &quot;Testing&quot;
        self.assertEqual(useradd._build_gecos(test_gecos), expected_gecos_fields)
</PRE>
</div>
  </div>
</body>
</html>
