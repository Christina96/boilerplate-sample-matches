<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_salt_auth.py &amp; test_stringutils.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_salt_auth.py &amp; test_stringutils.py
      </h3>
<h1 align="center">
        2.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_salt_auth.py (9.523809%)<th>test_stringutils.py (1.6073478%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(33-36)<td><a href="#" name="0">(192-199)</a><td align="center"><font color="#ff0000">14</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_salt_auth.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import pytest
3 import salt.utils.platform
4 import salt.utils.pycrypto
5 log = logging.getLogger(__name__)
6 pytestmark = [
7     pytest.mark.slow_test,
8     pytest.mark.skip_if_not_root,
9     pytest.mark.destructive_test,
10     pytest.mark.skip_on_windows,
11 ]
12 USERA = "saltdev-auth"
13 USERA_PWD = "saltdev"
14 @pytest.fixture(scope="module")
15 def saltdev_account(sminion):
16     try:
17         assert sminion.functions.user.add(USERA, createhome=False)
18             USERA,
19             USERA_PWD
20             if salt<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.utils.platform.is_darwin()
21             else salt.utils.pycrypto.gen_hash(password=USERA_PWD),
22         )
23         assert USERA in sminion.functions.user.list_users(</b></font>)
24         yield
25     finally:
26         sminion.functions.user.delete(USERA, remove=True)
27 SALTOPS = "saltops"
28 @pytest.fixture(scope="module")
29 def saltops_group(sminion):
30     try:
31         assert sminion.functions.group.add(SALTOPS)
32         yield
33     finally:
34         sminion.functions.group.delete(SALTOPS)
35 USERB = "saltdev-adm"
36 USERB_PWD = USERA_PWD
37 @pytest.fixture(scope="module")
38 def saltadm_account(sminion, saltops_group):
39     try:
40         assert sminion.functions.user.add(USERB, groups=[SALTOPS], createhome=False)
41         assert sminion.functions.shadow.set_password(
42             USERB,
43             USERB_PWD
44             if salt.utils.platform.is_darwin()
45             else salt.utils.pycrypto.gen_hash(password=USERB_PWD),
46         )
47         assert USERB in sminion.functions.user.list_users()
48         yield
49     finally:
50         sminion.functions.user.delete(USERB, remove=True)
51 def test_pam_auth_valid_user(salt_minion, salt_cli, saltdev_account):
52     ret = salt_cli.run(
53         "-a",
54         "pam",
55         "--username",
56         USERA,
57         "--password",
58         USERA_PWD,
59         "test.ping",
60         minion_tgt=salt_minion.id,
61     )
62     assert ret.exitcode == 0
63     assert ret.json is True
64 def test_pam_auth_invalid_user(salt_minion, salt_cli, saltdev_account):
65     ret = salt_cli.run(
66         "-a",
67         "pam",
68         "--username",
69         "nouser",
70         "--password",
71         "1234",
72         "test.ping",
73         minion_tgt=salt_minion.id,
74     )
75     assert ret.stdout == "Authentication error occurred."
76 def test_pam_auth_valid_group(salt_minion, salt_cli, saltadm_account):
77     ret = salt_cli.run(
78         "-a",
79         "pam",
80         "--username",
81         USERB,
82         "--password",
83         USERB_PWD,
84         "test.ping",
85         minion_tgt=salt_minion.id,
86     )
87     assert ret.exitcode == 0
88     assert ret.json is True
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_stringutils.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import builtins
2 import re
3 import sys
4 import textwrap
5 import pytest
6 import salt.utils.stringutils
7 from tests.support.mock import patch
8 from tests.support.unit import LOREM_IPSUM
9 @pytest.fixture(scope="function")
10 def unicode():
11     UNICODE = "中国語 (繁体)"
12     STR = BYTES = UNICODE.encode("utf-8")
13     return UNICODE, STR, BYTES
14 @pytest.fixture(scope="function")
15 def eggs():
16     eggs = "\u044f\u0438\u0306\u0446\u0430"
17     return eggs
18 @pytest.fixture(scope="function")
19 def latin1_unicode():
20     LATIN1_UNICODE = "räksmörgås"
21     LATIN1_BYTES = LATIN1_UNICODE.encode("latin-1")
22     return LATIN1_UNICODE, LATIN1_BYTES
23 @pytest.fixture()
24 def single_txt():
25     return """
26 if [ -z '$debian_chroot' ] &amp;&amp; [ -r /etc/debian_chroot ]; then
27     debian_chroot=$(cat /etc/debian_chroot)
28 fi
29 @pytest.fixture()
30 def single_double_txt():
31     return """
32 if [ -z '$debian_chroot' ] &amp;&amp; [ -r /etc/debian_chroot ]; then
33     debian_chroot=$(cat /etc/debian_chroot)
34 fi
35 if [ -z "$debian_chroot" ] &amp;&amp; [ -r /etc/debian_chroot ]; then
36     debian_chroot=$(cat /etc/debian_chroot)
37 fi
38 @pytest.fixture()
39 def match():
40     return """
41 if [ -z '$debian_chroot' ] &amp;&amp; [ -r /etc/debian_chroot ]; then
42     debian_chroot=$(cat /etc/debian_chroot)
43 fi
44 if [ -z "$debian_chroot" ] &amp;&amp; [ -r /etc/debian_chroot ]; then
45     debian_chroot=$(cat /etc/debian_chroot)
46 fi
47 if [ -z "$debian_chroot" ] &amp;&amp; [ -r /etc/debian_chroot ]; then
48     debian_chroot=$(cat /etc/debian_chroot)
49 fi
50 if [ -z '$debian_chroot' ] &amp;&amp; [ -r /etc/debian_chroot ]; then
51     debian_chroot=$(cat /etc/debian_chroot)
52 fi
53 if [ -z '$debian_chroot' ] &amp;&amp; [ -r "/etc/debian_chroot" ]; then
54     debian_chroot=$(cat /etc/debian_chroot)
55 fi
56 """
57         salt<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.utils.stringutils.is_binary(
58             salt.utils.stringutils.to_bytes(almost_bin_str)
59         )
60         is False
61     )
62     bin_str = almost_bin_str + "\x01"
63     assert salt.utils.stringutils.is_binary(</b></font>bin_str) is True
64     assert (
65         salt.utils.stringutils.is_binary(salt.utils.stringutils.to_bytes(bin_str))
66         is True
67     )
68 def test_to_str(unicode):
69     UNICODE = unicode[0]
70     BYTES = unicode[2]
71     for x in (123, (1, 2, 3), [1, 2, 3], {1: 23}, None):
72         assert pytest.raises(TypeError, salt.utils.stringutils.to_str, x)
73     assert salt.utils.stringutils.to_str("plugh") == "plugh"
74     assert salt.utils.stringutils.to_str("áéíóúý", "utf-8") == "áéíóúý"
75     assert salt.utils.stringutils.to_str(BYTES, "utf-8") == UNICODE
76     assert salt.utils.stringutils.to_str(bytearray(BYTES), "utf-8") == UNICODE
77     ut2 = b"\x9c"
78     assert pytest.raises(
79         UnicodeDecodeError, salt.utils.stringutils.to_str, ut2, "utf-8"
80     )
81     assert salt.utils.stringutils.to_str(ut2, "utf-8", "replace") == "\ufffd"
82     assert pytest.raises(
83         UnicodeDecodeError,
84         salt.utils.stringutils.to_str,
85         bytearray(ut2),
86         "utf-8",
87     )
88     assert salt.utils.stringutils.to_str(bytearray(ut2), "utf-8", "replace") == "\ufffd"
89 def test_to_bytes(unicode):
90     UNICODE = unicode[0]
91     BYTES = unicode[2]
92     for x in (123, (1, 2, 3), [1, 2, 3], {1: 23}, None):
93         assert pytest.raises(TypeError, salt.utils.stringutils.to_bytes, x)
94     assert salt.utils.stringutils.to_bytes("xyzzy") == b"xyzzy"
95     assert salt.utils.stringutils.to_bytes(BYTES) == BYTES
96     assert salt.utils.stringutils.to_bytes(bytearray(BYTES)) == BYTES
97     assert salt.utils.stringutils.to_bytes(UNICODE, "utf-8") == BYTES
98     with patch.object(builtins, "__salt_system_encoding__", "ascii"):
99         assert salt.utils.stringutils.to_bytes("Ψ") == b"\xce\xa8"
100 def test_to_unicode(eggs, unicode, latin1_unicode):
101     UNICODE = unicode[0]
102     BYTES = unicode[2]
103     LATIN1_UNICODE = latin1_unicode[0]
104     LATIN1_BYTES = latin1_unicode[1]
105     assert salt.utils.stringutils.to_unicode(eggs, normalize=True) == "яйца"
106     assert salt.utils.stringutils.to_unicode(eggs, normalize=False) != "яйца"
107     assert (
108         salt.utils.stringutils.to_unicode(LATIN1_BYTES, encoding="latin-1")
109         == LATIN1_UNICODE
110     )
111     assert salt.utils.stringutils.to_unicode("plugh") == "plugh"
112     assert salt.utils.stringutils.to_unicode("áéíóúý") == "áéíóúý"
113     assert salt.utils.stringutils.to_unicode(BYTES, "utf-8") == UNICODE
114     assert salt.utils.stringutils.to_unicode(bytearray(BYTES), "utf-8") == UNICODE
115 def test_to_unicode_multi_encoding(latin1_unicode):
116     LATIN1_UNICODE = latin1_unicode[0]
117     LATIN1_BYTES = latin1_unicode[1]
118     assert (
119         salt.utils.stringutils.to_unicode(LATIN1_BYTES, encoding=("utf-8", "latin1"))
120         == LATIN1_UNICODE
121     )
122 def test_build_whitespace_split_regex():
123     if sys.version_info &gt;= (3, 7):
124         expected_regex = (
125             "(?m)^(?:[\\s]+)?Lorem(?:[\\s]+)?ipsum(?:[\\s]+)?dolor(?:[\\s]+)?sit(?:[\\s]+)?amet,"
126             "(?:[\\s]+)?$"
127         )
128     else:
129         expected_regex = (
130             "(?m)^(?:[\\s]+)?Lorem(?:[\\s]+)?ipsum(?:[\\s]+)?dolor(?:[\\s]+)?sit(?:[\\s]+)?amet\\,"
131             "(?:[\\s]+)?$"
132         )
133     assert (
134         salt.utils.stringutils.build_whitespace_split_regex(
135             " ".join(LOREM_IPSUM.split()[:5])
136         )
137         == expected_regex
138     )
139 def test_get_context():
140     expected_context = textwrap.dedent(
141         """\
142         ---
143         Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque eget urna a arcu lacinia sagittis.
144         Sed scelerisque, lacus eget malesuada vestibulum, justo diam facilisis tortor, in sodales dolor
145         [...]
146         ---"""
147     )
148     assert (
149         salt.utils.stringutils.get_context(LOREM_IPSUM, 1, num_lines=1)
150         == expected_context
151     )
152 def test_get_context_has_enough_context():
153     template = "1\n2\n3\n4\n5\n6\n7\n8\n9\na\nb\nc\nd\ne\nf"
154     context = salt.utils.stringutils.get_context(template, 8)
155     expected = "---\n[...]\n3\n4\n5\n6\n7\n8\n9\na\nb\nc\nd\n[...]\n---"
156     assert expected == context
157 def test_get_context_at_top_of_file():
158     template = "1\n2\n3\n4\n5\n6\n7\n8\n9\na\nb\nc\nd\ne\nf"
159     context = salt.utils.stringutils.get_context(template, 1)
160     expected = "---\n1\n2\n3\n4\n5\n6\n[...]\n---"
161     assert expected == context
162 def test_get_context_at_bottom_of_file():
163     template = "1\n2\n3\n4\n5\n6\n7\n8\n9\na\nb\nc\nd\ne\nf"
164     context = salt.utils.stringutils.get_context(template, 15)
165     expected = "---\n[...]\na\nb\nc\nd\ne\nf\n---"
166     assert expected == context
167 def test_get_context_2_context_lines():
168     template = "1\n2\n3\n4\n5\n6\n7\n8\n9\na\nb\nc\nd\ne\nf"
169     context = salt.utils.stringutils.get_context(template, 8, num_lines=2)
170     expected = "---\n[...]\n6\n7\n8\n9\na\n[...]\n---"
171     assert expected == context
172 def test_get_context_with_marker():
173     template = "1\n2\n3\n4\n5\n6\n7\n8\n9\na\nb\nc\nd\ne\nf"
174     context = salt.utils.stringutils.get_context(
175         template, 8, num_lines=2, marker=" &lt;---"
176     )
177     expected = "---\n[...]\n6\n7\n8 &lt;---\n9\na\n[...]\n---"
178     assert expected == context
179 def test_expr_match():
180     val = "foo/bar/baz"
181     assert salt.utils.stringutils.expr_match(val, val) is True
182     assert salt.utils.stringutils.expr_match(val, "foo/*/baz") is True
183     assert salt.utils.stringutils.expr_match(val, "foo/*/bar") is False
184     assert salt.utils.stringutils.expr_match(val, r"foo/\w+/baz") is True
185     assert salt.utils.stringutils.expr_match(val, r"foo/\w/baz") is False
186 def test_check_whitelist_blacklist():
187     """
188     Ensure that whitelist matching works on both PY2 and PY3
189     """
190     whitelist = ["one/two/three", r"web[0-9]"]
191     blacklist = ["four/five/six", r"web[5-9]"]
192     assert (
193         salt.utils.stringutils.check_whitelist_blacklist(
194             "web_one",
195             whitelist=whitelist[1],
196             blacklist=None,
197         )
198         is False
199     )
200     assert (
201         salt.utils.stringutils.check_whitelist_blacklist(
202             "web_one",
203             whitelist=whitelist[1],
204             blacklist=[],
205         )
206         is False
207     )
208     assert (
209         salt.utils.stringutils.check_whitelist_blacklist(
210             "web1",
211             whitelist=whitelist[1],
212             blacklist=None,
213         )
214         is True
215     )
216     assert (
217         salt.utils.stringutils.check_whitelist_blacklist(
218             "web1",
219             whitelist=whitelist[1],
220             blacklist=[],
221         )
222         is True
223     )
224     assert (
225         salt.utils.stringutils.check_whitelist_blacklist(
226             "web5",
227             whitelist=None,
228             blacklist=blacklist[1],
229         )
230         is False
231     )
232     assert (
233         salt.utils.stringutils.check_whitelist_blacklist(
234             "web5",
235             whitelist=[],
236             blacklist=blacklist[1],
237         )
238         is False
239     )
240     assert (
241         salt.utils.stringutils.check_whitelist_blacklist(
242             "web_five",
243             whitelist=None,
244             blacklist=blacklist[1],
245         )
246         is True
247     )
248     assert (
249         salt.utils.stringutils.check_whitelist_blacklist(
250             "web_five",
251             whitelist=[],
252             blacklist=blacklist[1],
253         )
254         is True
255     )
256     assert (
257         salt.utils.stringutils.check_whitelist_blacklist(
258             "web5",
259             whitelist=whitelist[1],
260             blacklist=blacklist[1],
261         )
262         is False
263     )
264     assert (
265         salt.utils.stringutils.check_whitelist_blacklist(
266             "web4",
267             whitelist=whitelist[1],
268             blacklist=blacklist[1],
269         )
270         is True
271     )
272     assert (
273         salt.utils.stringutils.check_whitelist_blacklist(
274             "web_one",
275             whitelist=whitelist,
276             blacklist=None,
277         )
278         is False
279     )
280     assert (
281         salt.utils.stringutils.check_whitelist_blacklist(
282             "web_one",
283             whitelist=whitelist,
284             blacklist=[],
285         )
286         is False
287     )
288     assert (
289         salt.utils.stringutils.check_whitelist_blacklist(
290             "web1",
291             whitelist=whitelist,
292             blacklist=None,
293         )
294         is True
295     )
296     assert salt.utils.stringutils.check_whitelist_blacklist(
297         "web1",
298         whitelist=whitelist,
299         blacklist=[],
300     )
301     assert (
302         salt.utils.stringutils.check_whitelist_blacklist(
303             "web5",
304             whitelist=None,
305             blacklist=blacklist,
306         )
307         is False
308     )
309     assert (
310         salt.utils.stringutils.check_whitelist_blacklist(
311             "web5",
312             whitelist=[],
313             blacklist=blacklist,
314         )
315         is False
316     )
317     assert (
318         salt.utils.stringutils.check_whitelist_blacklist(
319             "web_five",
320             whitelist=None,
321             blacklist=blacklist,
322         )
323         is True
324     )
325     assert (
326         salt.utils.stringutils.check_whitelist_blacklist(
327             "web_five",
328             whitelist=[],
329             blacklist=blacklist,
330         )
331         is True
332     )
333     assert (
334         salt.utils.stringutils.check_whitelist_blacklist(
335             "web5",
336             whitelist=whitelist,
337             blacklist=blacklist,
338         )
339         is False
340     )
341     assert (
342         salt.utils.stringutils.check_whitelist_blacklist(
343             "web4",
344             whitelist=whitelist,
345             blacklist=blacklist,
346         )
347         is True
348     )
349     assert (
350         salt.utils.stringutils.check_whitelist_blacklist(
351             "web_one",
352             whitelist=set(whitelist),
353             blacklist=None,
354         )
355         is False
356     )
357     assert (
358         salt.utils.stringutils.check_whitelist_blacklist(
359             "web_one",
360             whitelist=set(whitelist),
361             blacklist=set(),
362         )
363         is False
364     )
365     assert (
366         salt.utils.stringutils.check_whitelist_blacklist(
367             "web1",
368             whitelist=set(whitelist),
369             blacklist=None,
370         )
371         is True
372     )
373     assert (
374         salt.utils.stringutils.check_whitelist_blacklist(
375             "web1",
376             whitelist=set(whitelist),
377             blacklist=set(),
378         )
379         is True
380     )
381     assert (
382         salt.utils.stringutils.check_whitelist_blacklist(
383             "web5",
384             whitelist=None,
385             blacklist=set(blacklist),
386         )
387         is False
388     )
389     assert (
390         salt.utils.stringutils.check_whitelist_blacklist(
391             "web5",
392             whitelist=set(),
393             blacklist=set(blacklist),
394         )
395         is False
396     )
397     assert (
398         salt.utils.stringutils.check_whitelist_blacklist(
399             "web_five",
400             whitelist=None,
401             blacklist=set(blacklist),
402         )
403         is True
404     )
405     assert (
406         salt.utils.stringutils.check_whitelist_blacklist(
407             "web_five",
408             whitelist=set(),
409             blacklist=set(blacklist),
410         )
411         is True
412     )
413     assert (
414         salt.utils.stringutils.check_whitelist_blacklist(
415             "web5",
416             whitelist=set(whitelist),
417             blacklist=set(blacklist),
418         )
419         is False
420     )
421     assert (
422         salt.utils.stringutils.check_whitelist_blacklist(
423             "web4",
424             whitelist=set(whitelist),
425             blacklist=set(blacklist),
426         )
427         is True
428     )
429     assert pytest.raises(
430         TypeError,
431         salt.utils.stringutils.check_whitelist_blacklist,
432         "foo",
433         whitelist=123,
434     )
435     assert pytest.raises(
436         TypeError,
437         salt.utils.stringutils.check_whitelist_blacklist,
438         "foo",
439         blacklist=123,
440     )
441 def test_check_include_exclude_empty():
442     assert salt.utils.stringutils.check_include_exclude("/some/test") is True
443 def test_check_include_exclude_exclude():
444     assert (
445         salt.utils.stringutils.check_include_exclude("/some/test", None, "*test*")
446         is False
447     )
448 def test_check_include_exclude_exclude_list():
449     assert (
450         salt.utils.stringutils.check_include_exclude("/some/test", None, ["*test"])
451         is False
452     )
453 def test_check_include_exclude_exclude_include():
454     assert (
455         salt.utils.stringutils.check_include_exclude("/some/test", "*test*", "/some/")
456         is True
457     )
458 def test_check_include_exclude_regex():
459     assert (
460         salt.utils.stringutils.check_include_exclude(
461             "/some/test", None, "E@/some/(test|other)"
462         )
463         is False
464     )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
