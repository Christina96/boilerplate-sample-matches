<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_svn_2.py & test_scsi.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_svn_2.py & test_scsi.py
      </h3>
      <h1 align="center">
        14.6%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_svn_2.py (10.408922%)<TH>test_scsi.py (24.561403%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match10849-0.html#0',2,'match10849-1.html#0',3)" NAME="0">(51-54)<TD><A HREF="javascript:ZweiFrames('match10849-0.html#0',2,'match10849-1.html#0',3)" NAME="0">(49-54)</A><TD ALIGN=center><FONT COLOR="#ff0000">16</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match10849-0.html#1',2,'match10849-1.html#1',3)" NAME="1">(5-22)<TD><A HREF="javascript:ZweiFrames('match10849-0.html#1',2,'match10849-1.html#1',3)" NAME="1">(8-23)</A><TD ALIGN=center><FONT COLOR="#bf0000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_svn_2.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
<A NAME="1"></A>    :codeauthor: Rahul Handay &lt;rahulha@saltstack.com&gt;
&quot;&quot;&quot;

<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match10849-1.html#1',3,'match10849-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>import os

import pytest
import salt.states.svn as svn
from tests.support.mock import MagicMock, patch


@pytest.fixture
def configure_loader_modules():
    return {svn: {}}


def test_latest():
    &quot;&quot;&quot;
    Checkout or update the working directory to
    the latest revision from the remote repository.
    &quot;&quot;&quot;
    mock =</B></FONT> MagicMock(return_value=True)
    with patch.object(svn, &quot;_fail&quot;, mock):
        assert svn.latest(&quot;salt&quot;)

    mock = MagicMock(side_effect=[True, False, False, False])
    with patch.object(os.path, &quot;exists&quot;, mock):
        mock = MagicMock(return_value=False)
        with patch.object(os.path, &quot;isdir&quot;, mock):
            with patch.object(svn, &quot;_fail&quot;, mock):
                assert not svn.latest(&quot;salt&quot;, &quot;c://salt&quot;)

        with patch.dict(svn.__opts__, {&quot;test&quot;: True}):
            mock = MagicMock(return_value=[&quot;salt&quot;])
            with patch.object(svn, &quot;_neutral_test&quot;, mock):
                assert svn.latest(&quot;salt&quot;, &quot;c://salt&quot;) == [&quot;salt&quot;]

            mock = MagicMock(side_effect=[False, True])
            with patch.object(os.path, &quot;exists&quot;, mock):
                mock = MagicMock(return_value=True)
                info_mock = MagicMock(return_value=[{&quot;Revision&quot;: &quot;mocked&quot;}])
                with patch.dict(
                    svn.__salt__, {&quot;svn.diff&quot;: mock, &quot;svn.info&quot;: info_mock}
                ):
                    mock = MagicMock(return_value=[&quot;Dude&quot;])
                    with patch.object(svn, &quot;_neutral_test&quot;, mock):
                        assert svn.latest(&quot;salt&quot;, &quot;c://salt&quot;) == [&quot;Dude&quot;]
<A NAME="0"></A>
        with patch.dict(svn.__opts__, {&quot;test&quot;: False}):
            mock = MagicMock(return_value=[{&quot;Revision&quot;: &quot;a&quot;}])
            <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match10849-1.html#0',3,'match10849-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>with patch.dict(svn.__salt__, {&quot;svn.info&quot;: mock}):
                mock = MagicMock(return_value=True)
                with patch.dict(svn.__salt__, {&quot;svn.update&quot;: mock}):
                    assert svn.latest(</B></FONT>&quot;salt&quot;, &quot;c://salt&quot;) == {
                        &quot;changes&quot;: {},
                        &quot;comment&quot;: True,
                        &quot;name&quot;: &quot;salt&quot;,
                        &quot;result&quot;: True,
                    }


def test_latest_trust_failures():
    &quot;&quot;&quot;
    Test that checks that the trust_failures option is handled
    correctly when running svn.latest in test mode. This tests for the
    bug reported as #59069.
    &quot;&quot;&quot;
    os_path_exists_mock = MagicMock(side_effect=[False, True])
    svn_info_mock = MagicMock(return_value=[{&quot;Revision&quot;: &quot;42&quot;}])
    svn_diff_mock = MagicMock()
    svn_neutral_test_mock = MagicMock()
    with patch.object(os.path, &quot;exists&quot;, os_path_exists_mock), patch.dict(
        svn.__opts__, {&quot;test&quot;: True}
    ), patch.dict(
        svn.__salt__, {&quot;svn.diff&quot;: svn_diff_mock, &quot;svn.info&quot;: svn_info_mock}
    ), patch.object(
        svn, &quot;_neutral_test&quot;, svn_neutral_test_mock
    ):
        svn.latest(&quot;salt&quot;, &quot;/my/test/dir&quot;, trust_failures=&quot;unknown-ca&quot;)
        svn_diff_mock.assert_called_with(
            &quot;/my/test&quot;,
            &quot;/my/test/dir&quot;,
            None,
            None,
            None,
            &quot;-r&quot;,
            &quot;42:HEAD&quot;,
            &quot;--trust-server-cert-failures&quot;,
            &quot;unknown-ca&quot;,
        )


def test_export():
    &quot;&quot;&quot;
    Test to export a file or directory from an SVN repository
    &quot;&quot;&quot;
    mock = MagicMock(return_value=True)
    with patch.object(svn, &quot;_fail&quot;, mock):
        assert svn.export(&quot;salt&quot;)

    mock = MagicMock(side_effect=[True, False, False, False])
    with patch.object(os.path, &quot;exists&quot;, mock):
        mock = MagicMock(return_value=False)
        with patch.object(os.path, &quot;isdir&quot;, mock):
            with patch.object(svn, &quot;_fail&quot;, mock):
                assert not svn.export(&quot;salt&quot;, &quot;c://salt&quot;)

        with patch.dict(svn.__opts__, {&quot;test&quot;: True}):
            mock = MagicMock(return_value=[&quot;salt&quot;])
            with patch.object(svn, &quot;_neutral_test&quot;, mock):
                assert svn.export(&quot;salt&quot;, &quot;c://salt&quot;) == [&quot;salt&quot;]

            mock = MagicMock(side_effect=[False, True])
            with patch.object(os.path, &quot;exists&quot;, mock):
                mock = MagicMock(return_value=True)
                with patch.dict(svn.__salt__, {&quot;svn.list&quot;: mock}):
                    mock = MagicMock(return_value=[&quot;Dude&quot;])
                    with patch.object(svn, &quot;_neutral_test&quot;, mock):
                        assert svn.export(&quot;salt&quot;, &quot;c://salt&quot;) == [&quot;Dude&quot;]

        with patch.dict(svn.__opts__, {&quot;test&quot;: False}):
            mock = MagicMock(return_value=True)
            with patch.dict(svn.__salt__, {&quot;svn.export&quot;: mock}):
                assert svn.export(&quot;salt&quot;, &quot;c://salt&quot;) == {
                    &quot;changes&quot;: {
                        &quot;new&quot;: &quot;salt&quot;,
                        &quot;comment&quot;: &quot;salt was Exported to c://salt&quot;,
                    },
                    &quot;comment&quot;: True,
                    &quot;name&quot;: &quot;salt&quot;,
                    &quot;result&quot;: True,
                }


def test_dirty():
    &quot;&quot;&quot;
    Test to determine if the working directory has been changed.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=True)
    with patch.object(svn, &quot;_fail&quot;, mock):
        assert svn.dirty(&quot;salt&quot;, &quot;c://salt&quot;)
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_scsi.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;

<A NAME="1"></A>import copy
import os

<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match10849-0.html#1',2,'match10849-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>import pytest
import salt.modules.scsi as scsi
import salt.utils.path
from tests.support.mock import MagicMock, patch


@pytest.fixture
def configure_loader_modules():
    return {scsi: {}}


def test_ls_():
    &quot;&quot;&quot;
    Test for list SCSI devices, with details
    &quot;&quot;&quot;
    lsscsi =</B></FONT> {
        &quot;stdout&quot;: &quot;[0:0:0:0] disk HP LOGICAL VOLUME 6.68 /dev/sda [8:0]&quot;,
        &quot;stderr&quot;: &quot;&quot;,
        &quot;retcode&quot;: 0,
    }

    lsscsi_size = {
        &quot;stdout&quot;: &quot;[0:0:0:0] disk HP LOGICAL VOLUME 6.68 /dev/sda [8:0] 1.20TB&quot;,
        &quot;stderr&quot;: &quot;&quot;,
        &quot;retcode&quot;: 0,
    }

    result = {
        &quot;[0:0:0:0]&quot;: {
            &quot;major&quot;: &quot;8&quot;,
            &quot;lun&quot;: &quot;0:0:0:0&quot;,
            &quot;device&quot;: &quot;/dev/sda&quot;,
            &quot;model&quot;: &quot;LOGICAL VOLUME 6.68&quot;,
            &quot;minor&quot;: &quot;0&quot;,
            &quot;size&quot;: None,
        }
    }
    result_size = copy.deepcopy(result)
<A NAME="0"></A>    result_size[&quot;[0:0:0:0]&quot;][&quot;size&quot;] = &quot;1.20TB&quot;

    mock = MagicMock(return_value=&quot;/usr/bin/lsscsi&quot;)
    <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match10849-0.html#0',2,'match10849-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>with patch.object(salt.utils.path, &quot;which&quot;, mock):
        # get_size = True

        cmd_mock = MagicMock(return_value=lsscsi_size)
        with patch.dict(scsi.__salt__, {&quot;cmd.run_all&quot;: cmd_mock}):
            assert scsi.ls_(</B></FONT>) == result_size
            with patch.dict(lsscsi_size, {&quot;retcode&quot;: 1, &quot;stderr&quot;: &quot;An error occurred&quot;}):
                assert scsi.ls_() == &quot;An error occurred&quot;
            with patch.dict(
                lsscsi_size,
                {&quot;retcode&quot;: 1, &quot;stderr&quot;: &quot;lsscsi: invalid option -- 's'\nUsage:&quot;},
            ):
                assert (
                    scsi.ls_() == &quot;lsscsi: invalid option -- 's' - try get_size=False&quot;
                )

        # get_size = False
        cmd_mock = MagicMock(return_value=lsscsi)
        with patch.dict(scsi.__salt__, {&quot;cmd.run_all&quot;: cmd_mock}):
            assert scsi.ls_(get_size=False) == result

    mock = MagicMock(return_value=None)
    with patch.object(salt.utils.path, &quot;which&quot;, mock):
        assert scsi.ls_() == &quot;scsi.ls not available - lsscsi command not found&quot;


def test_rescan_all():
    &quot;&quot;&quot;
    Test for list scsi devices
    &quot;&quot;&quot;
    mock = MagicMock(side_effect=[False, True])
    with patch.object(os.path, &quot;isdir&quot;, mock):
        assert scsi.rescan_all(&quot;host&quot;) == &quot;Host host does not exist&quot;

        with patch.dict(scsi.__salt__, {&quot;cmd.run&quot;: MagicMock(return_value=&quot;A&quot;)}):
            assert scsi.rescan_all(&quot;host&quot;) == [&quot;A&quot;]
</PRE>
</div>
  </div>
</body>
</html>
