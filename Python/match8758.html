<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for main.py &amp; test_shared_randomstreams.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for main.py &amp; test_shared_randomstreams.py
      </h3>
<h1 align="center">
        1.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>main.py (8.441559%)<th>test_shared_randomstreams.py (0.62469965%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(157-160)<td><a href="#" name="0">(85-90)</a><td align="center"><font color="#ff0000">13</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>main.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, print_function, division
2 import os
3 import unittest
4 import sys
5 from numpy.testing.nosetester import NoseTester
6 class TheanoNoseTester(NoseTester):
7     def _test_argv(self, verbose, extra_argv):
8         argv = [__file__, self.package_path]
9         argv += ['--verbosity', str(verbose)]
10         if extra_argv:
11             argv += extra_argv
12         return argv
13     def _show_system_info(self):
14         import theano
15         print("Theano version %s" % theano.__version__)
16         theano_dir = os.path.dirname(theano.__file__)
17         print("theano is installed in %s" % theano_dir)
18         super(TheanoNoseTester, self)._show_system_info()
19     def prepare_test_args(self, verbose=1, extra_argv=None, coverage=False,
20                           capture=True, knownfailure=True):
21         import nose.plugins.builtin
22         argv = self._test_argv(verbose, extra_argv)
23         if coverage:
24             argv += ['--cover-package=%s' % self.package_name,
25                      '--with-coverage', '--cover-tests',
26                      '--cover-inclusive', '--cover-erase']
27         if not capture:
28             argv += ['-s']
29         plugins = []
30         if knownfailure:
31             from numpy.testing.noseclasses import KnownFailure
32             plugins.append(KnownFailure())
33         plugins += [p() for p in nose.plugins.builtin.plugins]
34         return argv, plugins
35     def test(self, verbose=1, extra_argv=None, coverage=False, capture=True,
36              knownfailure=True):
37         from nose.config import Config
38         from nose.plugins.manager import PluginManager
39         from numpy.testing.noseclasses import NumpyTestProgram
40         if not os.path.exists('theano/__init__.py'):
41             try:
42                 from theano import config
43                 if config.device != "cpu":
44                     raise ValueError("Theano tests must be run with device=cpu."
45                                      " This will also run GPU tests when possible.\n"
46                                      " If you want GPU-related tests to run on a"
47                                      " specific GPU device, and not the default one,"
48                                      " you should use the init_gpu_device theano flag.")
49             except ImportError:
50                 pass
51         verbose = min(verbose, 3)
52         self._show_system_info()
53         cwd = os.getcwd()
54         if self.package_path in os.listdir(cwd):
55             raise RuntimeError((
56                 "This function does not run correctly when, at the time "
57                 "theano was imported, the working directory was theano's "
58                 "parent directory. You should exit your Python prompt, change "
59                 "directory, then launch Python again, import theano, then "
60                 "launch theano.test()."))
61         argv, plugins = self.prepare_test_args(verbose, extra_argv, coverage,
62                                                capture, knownfailure)
63         cfg = Config(includeExe=True, plugins=PluginManager(plugins=plugins))
64         t = NumpyTestProgram(argv=argv, exit=False, config=cfg)
65         return t.result
66 def main(modulename):
67     if 0:
68         unittest.main()
69     elif len(sys.argv) == 2 and sys.argv[1] == "--debug":
70         tests = unittest.TestLoader().loadTestsFromModule(module)
71         tests.debug()
72     elif len<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(sys.argv) == 1:
73         module = __import__(modulename)
74         tests = unittest.TestLoader().loadTestsFromModule(module)
75         unittest.TextTestRunner(verbosity=2).</b></font>run(tests)
76     else:
77         print("options: [--debug]")
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_shared_randomstreams.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, print_function, division
2 __docformat__ = "restructuredtext en"
3 import sys
4 import unittest
5 import numpy as np
6 from theano.tensor import raw_random
7 from theano.tensor.shared_randomstreams import RandomStreams
8 from theano import function, shared
9 from theano import tensor
10 from theano import compile, config, gof
11 from theano.tests import unittest_tools as utt
12 class T_SharedRandomStreams(unittest.TestCase):
13     def setUp(self):
14         utt.seed_rng()
15     def test_tutorial(self):
16         srng = RandomStreams(seed=234)
17         rv_u = srng.uniform((2, 2))
18         rv_n = srng.normal((2, 2))
19         f = function([], rv_u)
20         g = function([], rv_n, no_default_updates=True)    #Not updating rv_n.rng
21         nearly_zeros = function([], rv_u + rv_u - 2 * rv_u)
22         assert np.all(f() != f())
23         assert np.all(g() == g())
24         assert np.all(abs(nearly_zeros()) &lt; 1e-5)
25         assert isinstance(rv_u.rng.get_value(borrow=True),
26                 np.random.RandomState)
27     def test_basics(self):
28         random = RandomStreams(utt.fetch_seed())
29         fn = function([], random.uniform((2, 2)), updates=random.updates())
30         gn = function([], random.normal((2, 2)), updates=random.updates())
31         fn_val0 = fn()
32         fn_val1 = fn()
33         gn_val0 = gn()
34         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
35         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
36         numpy_val0 = rng.uniform(size=(2, 2))
37         numpy_val1 = rng.uniform(size=(2, 2))
38         assert np.allclose(fn_val0, numpy_val0)
39         print(fn_val0)
40         print(numpy_val0)
41         print(fn_val1)
42         print(numpy_val1)
43         assert np.allclose(fn_val1, numpy_val1)
44     def test_seed_fn(self):
45         random = RandomStreams(234)
46         fn = function([], random.uniform((2, 2)), updates=random.updates())
47         random.seed(utt.fetch_seed())
48         fn_val0 = fn()
49         fn_val1 = fn()
50         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
51         rng = np.random.RandomState(int(rng_seed))  #int() is for 32bit
52         numpy_val0 = rng.uniform(size=(2, 2))
53         numpy_val1 = rng.uniform(size=(2, 2))
54         assert np.allclose(fn_val0, numpy_val0)
55         assert np.allclose(fn_val1, numpy_val1)
56         random = RandomStreams(234)
57         out = random.uniform<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>((2, 2))
58         fn = function([], out, updates=random.updates())
59         random.seed(utt.fetch_seed())
60         rng = np.</b></font>random.RandomState()
61         rng.set_state(random[out.rng].get_state())  # tests getitem
62         fn_val0 = fn()
63         fn_val1 = fn()
64         numpy_val0 = rng.uniform(size=(2, 2))
65         numpy_val1 = rng.uniform(size=(2, 2))
66         assert np.allclose(fn_val0, numpy_val0)
67         assert np.allclose(fn_val1, numpy_val1)
68     def test_setitem(self):
69         random = RandomStreams(234)
70         out = random.uniform((2, 2))
71         fn = function([], out, updates=random.updates())
72         random.seed(888)
73         rng = np.random.RandomState(utt.fetch_seed())
74         random[out.rng] = np.random.RandomState(utt.fetch_seed())
75         fn_val0 = fn()
76         fn_val1 = fn()
77         numpy_val0 = rng.uniform(size=(2, 2))
78         numpy_val1 = rng.uniform(size=(2, 2))
79         assert np.allclose(fn_val0, numpy_val0)
80         assert np.allclose(fn_val1, numpy_val1)
81     def test_ndim(self):
82         random = RandomStreams(utt.fetch_seed())
83         fn = function([], random.uniform((2, 2)))
84         random2 = RandomStreams(utt.fetch_seed())
85         fn2 = function([], random2.uniform((2, 2), ndim=2))
86         val1 = fn()
87         val2 = fn2()
88         assert np.all(val1 == val2)
89         random3 = RandomStreams(utt.fetch_seed())
90         self.assertRaises(ValueError, random3.uniform, (2, 2), ndim=1)
91     def test_uniform(self):
92         random = RandomStreams(utt.fetch_seed())
93         fn = function([], random.uniform((2, 2), -1, 1))
94         fn_val0 = fn()
95         fn_val1 = fn()
96         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
97         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
98         numpy_val0 = rng.uniform(-1, 1, size=(2, 2))
99         numpy_val1 = rng.uniform(-1, 1, size=(2, 2))
100         assert np.allclose(fn_val0, numpy_val0)
101         assert np.allclose(fn_val1, numpy_val1)
102     def test_normal(self):
103         random = RandomStreams(utt.fetch_seed())
104         fn = function([], random.normal((2, 2), -1, 2))
105         fn_val0 = fn()
106         fn_val1 = fn()
107         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
108         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
109         numpy_val0 = rng.normal(-1, 2, size=(2, 2))
110         numpy_val1 = rng.normal(-1, 2, size=(2, 2))
111         assert np.allclose(fn_val0, numpy_val0)
112         assert np.allclose(fn_val1, numpy_val1)
113     def test_random_integers(self):
114         random = RandomStreams(utt.fetch_seed())
115         fn = function([], random.random_integers((20, 20), -5, 5))
116         fn_val0 = fn()
117         fn_val1 = fn()
118         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
119         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
120         numpy_val0 = rng.randint(-5, 6, size=(20, 20))
121         numpy_val1 = rng.randint(-5, 6, size=(20, 20))
122         assert np.all(fn_val0 == numpy_val0)
123         assert np.all(fn_val1 == numpy_val1)
124     def test_choice(self):
125         random = RandomStreams(utt.fetch_seed())
126         fn = function([], random.choice((11, 8), 10, 1, 0))
127         fn_val0 = fn()
128         fn_val1 = fn()
129         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
130         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
131         numpy_val0 = rng.choice(10, (11, 8), True, None)
132         numpy_val1 = rng.choice(10, (11, 8), True, None)
133         assert np.all(fn_val0 == numpy_val0)
134         assert np.all(fn_val1 == numpy_val1)
135     def test_poisson(self):
136         random = RandomStreams(utt.fetch_seed())
137         fn = function([], random.poisson(lam=5, size=(11, 8)))
138         fn_val0 = fn()
139         fn_val1 = fn()
140         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
141         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
142         numpy_val0 = rng.poisson(lam=5, size=(11, 8))
143         numpy_val1 = rng.poisson(lam=5, size=(11, 8))
144         assert np.all(fn_val0 == numpy_val0)
145         assert np.all(fn_val1 == numpy_val1)
146     def test_permutation(self):
147         random = RandomStreams(utt.fetch_seed())
148         fn = function([], random.permutation((20,), 10), updates=random.updates())
149         fn_val0 = fn()
150         fn_val1 = fn()
151         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
152         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
153         numpy_val0 = np.asarray([rng.permutation(10) for i in range(20)])
154         numpy_val1 = np.asarray([rng.permutation(10) for i in range(20)])
155         assert np.all(fn_val0 == numpy_val0)
156         assert np.all(fn_val1 == numpy_val1)
157     def test_multinomial(self):
158         random = RandomStreams(utt.fetch_seed())
159         fn = function([], random.multinomial((4, 4), 1, [0.1]*10), updates=random.updates())
160         fn_val0 = fn()
161         fn_val1 = fn()
162         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
163         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
164         numpy_val0 = rng.multinomial(1, [0.1]*10, size=(4, 4))
165         numpy_val1 = rng.multinomial(1, [0.1]*10, size=(4, 4))
166         assert np.all(fn_val0 == numpy_val0)
167         assert np.all(fn_val1 == numpy_val1)
168     def test_shuffle_row_elements(self):
169         random = RandomStreams(utt.fetch_seed())
170         m_input = tensor.dmatrix()
171         f = function([m_input], random.shuffle_row_elements(m_input), updates=random.updates())
172         val_rng = np.random.RandomState(utt.fetch_seed()+42)
173         in_mval = val_rng.uniform(-2, 2, size=(20, 5))
174         fn_mval0 = f(in_mval)
175         fn_mval1 = f(in_mval)
176         print(in_mval[0])
177         print(fn_mval0[0])
178         print(fn_mval1[0])
179         assert not np.all(in_mval == fn_mval0)
180         assert not np.all(in_mval == fn_mval1)
181         assert not np.all(fn_mval0 == fn_mval1)
182         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
183         rng = np.random.RandomState(int(rng_seed))
184         numpy_mval0 = in_mval.copy()
185         numpy_mval1 = in_mval.copy()
186         for row in numpy_mval0:
187             rng.shuffle(row)
188         for row in numpy_mval1:
189             rng.shuffle(row)
190         assert np.all(numpy_mval0 == fn_mval0)
191         assert np.all(numpy_mval1 == fn_mval1)
192         random1 = RandomStreams(utt.fetch_seed())
193         v_input = tensor.dvector()
194         f1 = function([v_input], random1.shuffle_row_elements(v_input))
195         in_vval = val_rng.uniform(-3, 3, size=(12,))
196         fn_vval = f1(in_vval)
197         numpy_vval = in_vval.copy()
198         vrng = np.random.RandomState(int(rng_seed))
199         vrng.shuffle(numpy_vval)
200         print(in_vval)
201         print(fn_vval)
202         print(numpy_vval)
203         assert np.all(numpy_vval == fn_vval)
204         self.assertRaises(TypeError, f1, in_mval)
205         self.assertRaises(TypeError, f, in_vval)
206     def test_default_updates(self):
207         random_a = RandomStreams(utt.fetch_seed())
208         out_a = random_a.uniform((2, 2))
209         fn_a = function([], out_a)
210         fn_a_val0 = fn_a()
211         fn_a_val1 = fn_a()
212         assert not np.all(fn_a_val0 == fn_a_val1)
213         nearly_zeros = function([], out_a + out_a - 2 * out_a)
214         assert np.all(abs(nearly_zeros()) &lt; 1e-5)
215         random_b = RandomStreams(utt.fetch_seed())
216         out_b = random_b.uniform((2, 2))
217         fn_b = function([], out_b, updates=random_b.updates())
218         fn_b_val0 = fn_b()
219         fn_b_val1 = fn_b()
220         assert np.all(fn_b_val0 == fn_a_val0)
221         assert np.all(fn_b_val1 == fn_a_val1)
222         random_c = RandomStreams(utt.fetch_seed())
223         out_c = random_c.uniform((2, 2))
224         fn_c = function([], out_c, updates=[out_c.update])
225         fn_c_val0 = fn_c()
226         fn_c_val1 = fn_c()
227         assert np.all(fn_c_val0 == fn_a_val0)
228         assert np.all(fn_c_val1 == fn_a_val1)
229         random_d = RandomStreams(utt.fetch_seed())
230         out_d = random_d.uniform((2, 2))
231         fn_d = function([], out_d, no_default_updates=True)
232         fn_d_val0 = fn_d()
233         fn_d_val1 = fn_d()
234         assert np.all(fn_d_val0 == fn_a_val0)
235         assert np.all(fn_d_val1 == fn_d_val0)
236         random_e = RandomStreams(utt.fetch_seed())
237         out_e = random_e.uniform((2, 2))
238         fn_e = function([], out_e, no_default_updates=[out_e.rng])
239         fn_e_val0 = fn_e()
240         fn_e_val1 = fn_e()
241         assert np.all(fn_e_val0 == fn_a_val0)
242         assert np.all(fn_e_val1 == fn_e_val0)
243     def test_symbolic_shape(self):
244         random = RandomStreams(utt.fetch_seed())
245         shape = tensor.lvector()
246         f = function([shape], random.uniform(size=shape, ndim=2))
247         assert f([2, 3]).shape == (2, 3)
248         assert f([4, 8]).shape == (4, 8)
249         self.assertRaises(ValueError, f, [4])
250         self.assertRaises(ValueError, f, [4, 3, 4, 5])
251     def test_mixed_shape(self):
252         random = RandomStreams(utt.fetch_seed())
253         shape0 = tensor.lscalar()
254         shape = (shape0, 3)
255         f = function([shape0], random.uniform(size=shape, ndim=2))
256         assert f(2).shape == (2, 3)
257         assert f(8).shape == (8, 3)
258         g = function([shape0], random.uniform(size=shape))
259         assert g(2).shape == (2, 3)
260         assert g(8).shape == (8, 3)
261     def test_mixed_shape_bcastable(self):
262         random = RandomStreams(utt.fetch_seed())
263         shape0 = tensor.lscalar()
264         shape = (shape0, 1)
265         u = random.uniform(size=shape, ndim=2)
266         assert u.broadcastable == (False, True)
267         f = function([shape0], u)
268         assert f(2).shape == (2, 1)
269         assert f(8).shape == (8, 1)
270         v = random.uniform(size=shape)
271         assert v.broadcastable == (False, True)
272         g = function([shape0], v)
273         assert g(2).shape == (2, 1)
274         assert g(8).shape == (8, 1)
275     def test_default_shape(self):
276         random = RandomStreams(utt.fetch_seed())
277         f = function([], random.uniform())
278         g = function([], random.multinomial())
279         seed_rng = np.random.RandomState(utt.fetch_seed())
280         uniform_rng = np.random.RandomState(int(seed_rng.randint(2**30)))
281         multinomial_rng = np.random.RandomState(int(seed_rng.randint(2**30)))
282         val0 = f()
283         val1 = f()
284         numpy_val0 = uniform_rng.uniform()
285         numpy_val1 = uniform_rng.uniform()
286         assert np.allclose(val0, numpy_val0)
287         assert np.allclose(val1, numpy_val1)
288         for i in range(10):  # every test has 50% chance of passing even with non-matching random states
289             val2 = g()
290             numpy_val2 = multinomial_rng.multinomial(n=1, pvals=[.5, .5])
291             assert np.all(val2 == numpy_val2)
292     def test_vector_arguments(self):
293         random = RandomStreams(utt.fetch_seed())
294         low = tensor.dvector()
295         out = random.uniform(low=low, high=1)
296         assert out.ndim == 1
297         f = function([low], out)
298         seed_gen = np.random.RandomState(utt.fetch_seed())
299         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
300         val0 = f([-5, .5, 0, 1])
301         val1 = f([.9])
302         numpy_val0 = numpy_rng.uniform(low=[-5, .5, 0, 1], high=1)
303         numpy_val1 = numpy_rng.uniform(low=[.9], high=1)
304         assert np.all(val0 == numpy_val0)
305         assert np.all(val1 == numpy_val1)
306         high = tensor.vector()
307         outb = random.uniform(low=low, high=high)
308         assert outb.ndim == 1
309         fb = function([low, high], outb)
310         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
311         val0b = fb([-4., -2], [-1, 0])
312         val1b = fb([-4.], [-1])
313         numpy_val0b = numpy_rng.uniform(low=[-4., -2], high=[-1, 0])
314         numpy_val1b = numpy_rng.uniform(low=[-4.], high=[-1])
315         assert np.all(val0b == numpy_val0b)
316         assert np.all(val1b == numpy_val1b)
317         self.assertRaises(ValueError, fb, [-4., -2], [-1, 0, 1])
318         size = tensor.lvector()
319         outc = random.uniform(low=low, high=high, size=size, ndim=1)
320         fc = function([low, high, size], outc)
321         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
322         val0c = fc([-4., -2], [-1, 0], [2])
323         val1c = fc([-4.], [-1], [1])
324         numpy_val0c = numpy_rng.uniform(low=[-4., -2], high=[-1, 0])
325         numpy_val1c = numpy_rng.uniform(low=[-4.], high=[-1])
326         assert np.all(val0c == numpy_val0c)
327         assert np.all(val1c == numpy_val1c)
328         self.assertRaises(ValueError, fc, [-4., -2], [-1, 0], [1, 2])
329         self.assertRaises(ValueError, fc, [-4., -2], [-1, 0], [2, 1])
330     def test_broadcast_arguments(self):
331         random = RandomStreams(utt.fetch_seed())
332         low = tensor.dvector()
333         high = tensor.dcol()
334         out = random.uniform(low=low, high=high)
335         assert out.ndim == 2
336         f = function([low, high], out)
337         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
338         numpy_rng = np.random.RandomState(int(rng_seed))
339         val0 = f([-5, .5, 0, 1], [[1.]])
340         val1 = f([.9], [[1.], [1.1], [1.5]])
341         val2 = f([-5, .5, 0, 1], [[1.], [1.1], [1.5]])
342         numpy_val0 = numpy_rng.uniform(low=[-5, .5, 0, 1], high=[1.])
343         numpy_val1 = numpy_rng.uniform(low=[.9], high=[[1.], [1.1], [1.5]])
344         numpy_val2 = numpy_rng.uniform(low=[-5, .5, 0, 1], high=[[1.], [1.1], [1.5]])
345         assert np.all(val0 == numpy_val0)
346         assert np.all(val1 == numpy_val1)
347         assert np.all(val2 == numpy_val2)
348     def test_uniform_vector(self):
349         random = RandomStreams(utt.fetch_seed())
350         low = tensor.dvector()
351         high = tensor.dvector()
352         out = random.uniform(low=low, high=high)
353         assert out.ndim == 1
354         f = function([low, high], out)
355         low_val = [.1, .2, .3]
356         high_val = [1.1, 2.2, 3.3]
357         seed_gen = np.random.RandomState(utt.fetch_seed())
358         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
359         val0 = f(low_val, high_val)
360         numpy_val0 = numpy_rng.uniform(low=low_val, high=high_val)
361         print('THEANO', val0)
362         print('NUMPY', numpy_val0)
363         assert np.all(val0 == numpy_val0)
364         val1 = f(low_val[:-1], high_val[:-1])
365         numpy_val1 = numpy_rng.uniform(low=low_val[:-1], high=high_val[:-1])
366         print('THEANO', val1)
367         print('NUMPY', numpy_val1)
368         assert np.all(val1 == numpy_val1)
369         g = function([low, high], random.uniform(low=low, high=high, size=(3,)))
370         val2 = g(low_val, high_val)
371         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
372         numpy_val2 = numpy_rng.uniform(low=low_val, high=high_val, size=(3,))
373         assert np.all(val2 == numpy_val2)
374         self.assertRaises(ValueError, g, low_val[:-1], high_val[:-1])
375     def test_binomial_vector(self):
376         random = RandomStreams(utt.fetch_seed())
377         n = tensor.lvector()
378         prob = tensor.vector()
379         out = random.binomial(n=n, p=prob)
380         assert out.ndim == 1
381         f = function([n, prob], out)
382         n_val = [1, 2, 3]
383         prob_val = np.asarray([.1, .2, .3], dtype=config.floatX)
384         seed_gen = np.random.RandomState(utt.fetch_seed())
385         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
386         val0 = f(n_val, prob_val)
387         numpy_val0 = numpy_rng.binomial(n=n_val, p=prob_val)
388         assert np.all(val0 == numpy_val0)
389         val1 = f(n_val[:-1], prob_val[:-1])
390         numpy_val1 = numpy_rng.binomial(n=n_val[:-1], p=prob_val[:-1])
391         assert np.all(val1 == numpy_val1)
392         g = function([n, prob], random.binomial(n=n, p=prob, size=(3,)))
393         val2 = g(n_val, prob_val)
394         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
395         numpy_val2 = numpy_rng.binomial(n=n_val, p=prob_val, size=(3,))
396         assert np.all(val2 == numpy_val2)
397         self.assertRaises(ValueError, g, n_val[:-1], prob_val[:-1])
398     def test_normal_vector(self):
399         random = RandomStreams(utt.fetch_seed())
400         avg = tensor.dvector()
401         std = tensor.dvector()
402         out = random.normal(avg=avg, std=std)
403         assert out.ndim == 1
404         f = function([avg, std], out)
405         avg_val = [1, 2, 3]
406         std_val = [.1, .2, .3]
407         seed_gen = np.random.RandomState(utt.fetch_seed())
408         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
409         val0 = f(avg_val, std_val)
410         numpy_val0 = numpy_rng.normal(loc=avg_val, scale=std_val)
411         assert np.allclose(val0, numpy_val0)
412         val1 = f(avg_val[:-1], std_val[:-1])
413         numpy_val1 = numpy_rng.normal(loc=avg_val[:-1], scale=std_val[:-1])
414         assert np.allclose(val1, numpy_val1)
415         g = function([avg, std], random.normal(avg=avg, std=std, size=(3,)))
416         val2 = g(avg_val, std_val)
417         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
418         numpy_val2 = numpy_rng.normal(loc=avg_val, scale=std_val, size=(3,))
419         assert np.allclose(val2, numpy_val2)
420         self.assertRaises(ValueError, g, avg_val[:-1], std_val[:-1])
421     def test_random_integers_vector(self):
422         random = RandomStreams(utt.fetch_seed())
423         low = tensor.lvector()
424         high = tensor.lvector()
425         out = random.random_integers(low=low, high=high)
426         assert out.ndim == 1
427         f = function([low, high], out)
428         low_val = [100, 200, 300]
429         high_val = [110, 220, 330]
430         seed_gen = np.random.RandomState(utt.fetch_seed())
431         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
432         val0 = f(low_val, high_val)
433         numpy_val0 = np.asarray([numpy_rng.randint(low=lv, high=hv+1)
434             for lv, hv in zip(low_val, high_val)])
435         assert np.all(val0 == numpy_val0)
436         val1 = f(low_val[:-1], high_val[:-1])
437         numpy_val1 = np.asarray([numpy_rng.randint(low=lv, high=hv+1)
438             for lv, hv in zip(low_val[:-1], high_val[:-1])])
439         assert np.all(val1 == numpy_val1)
440         g = function([low, high], random.random_integers(low=low, high=high, size=(3,)))
441         val2 = g(low_val, high_val)
442         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
443         numpy_val2 = np.asarray([numpy_rng.randint(low=lv, high=hv+1)
444             for lv, hv in zip(low_val, high_val)])
445         assert np.all(val2 == numpy_val2)
446         self.assertRaises(ValueError, g, low_val[:-1], high_val[:-1])
447     def test_multinomial_vector(self):
448         random = RandomStreams(utt.fetch_seed())
449         n = tensor.lvector()
450         pvals = tensor.matrix()
451         out = random.multinomial(n=n, pvals=pvals)
452         assert out.ndim == 2
453         f = function([n, pvals], out)
454         n_val = [1, 2, 3]
455         pvals_val = [[.1, .9], [.2, .8], [.3, .7]]
456         pvals_val = np.asarray(pvals_val, dtype=config.floatX)
457         seed_gen = np.random.RandomState(utt.fetch_seed())
458         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
459         val0 = f(n_val, pvals_val)
460         numpy_val0 = np.asarray([numpy_rng.multinomial(n=nv, pvals=pv)
461             for nv, pv in zip(n_val, pvals_val)])
462         assert np.all(val0 == numpy_val0)
463         val1 = f(n_val[:-1], pvals_val[:-1])
464         numpy_val1 = np.asarray([numpy_rng.multinomial(n=nv, pvals=pv)
465             for nv, pv in zip(n_val[:-1], pvals_val[:-1])])
466         assert np.all(val1 == numpy_val1)
467         g = function([n, pvals], random.multinomial(n=n, pvals=pvals, size=(3,)))
468         val2 = g(n_val, pvals_val)
469         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
470         numpy_val2 = np.asarray([numpy_rng.multinomial(n=nv, pvals=pv)
471             for nv, pv in zip(n_val, pvals_val)])
472         assert np.all(val2 == numpy_val2)
473         self.assertRaises(ValueError, g, n_val[:-1], pvals_val[:-1])
474     def test_dtype(self):
475         random = RandomStreams(utt.fetch_seed())
476         low = tensor.lscalar()
477         high = tensor.lscalar()
478         out = random.random_integers(low=low, high=high, size=(20,), dtype='int8')
479         assert out.dtype == 'int8'
480         f = function([low, high], out)
481         val0 = f(0, 9)
482         assert val0.dtype == 'int8'
483         val1 = f(255, 257)
484         assert val1.dtype == 'int8'
485         assert np.all(abs(val1) &lt;= 1)
486     def test_default_dtype(self):
487         random = RandomStreams(utt.fetch_seed())
488         low = tensor.dscalar()
489         high = tensor.dscalar()
490         out0 = random.uniform(low=low, high=high, size=(42,))
491         assert out0.dtype == 'float64'
492         f0 = function([low, high], out0)
493         val0 = f0(-2.1, 3.1)
494         assert val0.dtype == 'float64'
495         out1 = random.uniform(low=low, high=high, size=(42,), dtype='float32')
496         assert out1.dtype == 'float32'
497         f1 = function([low, high], out1)
498         val1 = f1(-1.1, 1.1)
499         assert val1.dtype == 'float32'
500         lowf = tensor.fscalar()
501         highf = tensor.fscalar()
502         outf = random.uniform(low=lowf, high=highf, size=(42,))
503         assert outf.dtype == config.floatX
504         ff = function([lowf, highf], outf)
505         valf = ff(np.float32(-0.1), np.float32(0.3))
506         assert valf.dtype == config.floatX
507     def test_shared_constructor_borrow(self):
508         rng = np.random.RandomState(123)
509         s_rng_default = shared(rng)
510         s_rng_True = shared(rng, borrow=True)
511         s_rng_False = shared(rng, borrow=False)
512         assert s_rng_default.container.storage[0] is not rng
513         assert s_rng_False.container.storage[0] is not rng
514         assert s_rng_True.container.storage[0] is rng
515         v = rng.randn()
516         v0 = s_rng_default.container.storage[0].randn()
517         v1 = s_rng_False.container.storage[0].randn()
518         assert v == v0 == v1
519     def test_get_value_borrow(self):
520         rng = np.random.RandomState(123)
521         s_rng = shared(rng)
522         r_ = s_rng.container.storage[0]
523         r_T = s_rng.get_value(borrow=True)
524         r_F = s_rng.get_value(borrow=False)
525         assert r_ is not r_F
526         assert r_ is r_T
527         assert r_.rand() == r_F.rand()
528     def test_get_value_internal_type(self):
529         rng = np.random.RandomState(123)
530         s_rng = shared(rng)
531         r_ = s_rng.container.storage[0]
532         r_T = s_rng.get_value(borrow=True, return_internal_type=True)
533         r_F = s_rng.get_value(borrow=False, return_internal_type=True)
534         assert r_ is not r_F
535         assert r_ is r_T
536         assert r_.rand() == r_F.rand()
537     def test_set_value_borrow(self):
538         rng = np.random.RandomState(123)
539         s_rng = shared(rng)
540         new_rng = np.random.RandomState(234234)
541         s_rng.set_value(new_rng, borrow=False)
542         assert new_rng is not s_rng.container.storage[0]
543         assert new_rng.randn() == s_rng.container.storage[0].randn()
544         rr = np.random.RandomState(33)
545         s_rng.set_value(rr, borrow=True)
546         assert rr is s_rng.container.storage[0]
547     def test_multiple_rng_aliasing(self):
548         rng1 = RandomStreams(1234)
549         rng2 = RandomStreams(2392)
550         assert rng1.state_updates is not rng2.state_updates
551         assert rng1.gen_seedgen is not rng2.gen_seedgen
552     def test_random_state_transfer(self):
553         class Graph:
554             def __init__(self, seed=123):
555                 self.rng = RandomStreams(seed)
556                 self.y = self.rng.uniform(size=(1,))
557         g1 = Graph(seed=123)
558         f1 = function([], g1.y)
559         g2 = Graph(seed=987)
560         f2 = function([], g2.y)
561         for (su1, su2) in zip(g1.rng.state_updates, g2.rng.state_updates):
562             su2[0].set_value(su1[0].get_value())
563         np.testing.assert_array_almost_equal(f1(), f2(), decimal=6)
564 if __name__ == '__main__':
565     from theano.tests import main
566     main("test_shared_randomstreams")
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
