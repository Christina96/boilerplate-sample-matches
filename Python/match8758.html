<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for main.py &amp; test_shared_randomstreams.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for main.py &amp; test_shared_randomstreams.py
      </h3>
<h1 align="center">
        1.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>main.py (8.441559%)<th>test_shared_randomstreams.py (0.62469965%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(157-160)<td><a href="#" name="0">(85-90)</a><td align="center"><font color="#ff0000">13</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>main.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, print_function, division
2 import os
3 import unittest
4 import sys
5 from numpy.testing.nosetester import NoseTester
6 class TheanoNoseTester(NoseTester):
7     def _test_argv(self, verbose, extra_argv):
8         argv = [__file__, self.package_path]
9         argv += ['--verbosity', str(verbose)]
10         if extra_argv:
11             argv += extra_argv
12         return argv
13     def _show_system_info(self):
14         import theano
15         print("Theano version %s" % theano.__version__)
16         theano_dir = os.path.dirname(theano.__file__)
17         print("theano is installed in %s" % theano_dir)
18         super(TheanoNoseTester, self)._show_system_info()
19     def prepare_test_args(self, verbose=1, extra_argv=None, coverage=False,
20                           capture=True, knownfailure=True):
21         import nose.plugins.builtin
22         argv = self._test_argv(verbose, extra_argv)
23         if coverage:
24             argv += ['--cover-package=%s' % self.package_name,
25                      '--with-coverage', '--cover-tests',
26                      '--cover-inclusive', '--cover-erase']
27         if not capture:
28             argv += ['-s']
29         plugins = []
30         if knownfailure:
31             from numpy.testing.noseclasses import KnownFailure
32             plugins.append(KnownFailure())
33         plugins += [p() for p in nose.plugins.builtin.plugins]
34         return argv, plugins
35     def test(self, verbose=1, extra_argv=None, coverage=False, capture=True,
36              knownfailure=True):
37         from nose.config import Config
38         from nose.plugins.manager import PluginManager
39         from numpy.testing.noseclasses import NumpyTestProgram
40         if not os.path.exists('theano/__init__.py'):
41             try:
42                 from theano import config
43                 if config.device != "cpu":
44                     raise ValueError("Theano tests must be run with device=cpu."
45                                      " This will also run GPU tests when possible.\n"
46                                      " If you want GPU-related tests to run on a"
47                                      " specific GPU device, and not the default one,"
48                                      " you should use the init_gpu_device theano flag.")
49             except ImportError:
50                 pass
51         verbose = min(verbose, 3)
52         self._show_system_info()
53         cwd = os.getcwd()
54         if self.package_path in os.listdir(cwd):
55             raise RuntimeError((
56                 "This function does not run correctly when, at the time "
57                 "theano was imported, the working directory was theano's "
58                 "parent directory. You should exit your Python prompt, change "
59                 "directory, then launch Python again, import theano, then "
60                 "launch theano.test()."))
61         argv, plugins = self.prepare_test_args(verbose, extra_argv, coverage,
62                                                capture, knownfailure)
63         cfg = Config(includeExe=True, plugins=PluginManager(plugins=plugins))
64         t = NumpyTestProgram(argv=argv, exit=False, config=cfg)
65         return t.result
66 def main(modulename):
67     if 0:
68         unittest.main()
69     elif len(sys.argv) == 2 and sys.argv[1] == "--debug":
70 <a name="0"></a>        module = __import__(modulename)
71         tests = unittest.TestLoader().loadTestsFromModule(module)
72         tests.debug()
73     elif len<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(sys.argv) == 1:
74         module = __import__(modulename)
75         tests = unittest.TestLoader().loadTestsFromModule(module)
76         unittest.TextTestRunner(verbosity=2).</b></font>run(tests)
77     else:
78         print("options: [--debug]")
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_shared_randomstreams.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, print_function, division
2 __docformat__ = "restructuredtext en"
3 import sys
4 import unittest
5 import numpy as np
6 from theano.tensor import raw_random
7 from theano.tensor.shared_randomstreams import RandomStreams
8 from theano import function, shared
9 from theano import tensor
10 from theano import compile, config, gof
11 from theano.tests import unittest_tools as utt
12 class T_SharedRandomStreams(unittest.TestCase):
13     def setUp(self):
14         utt.seed_rng()
15     def test_tutorial(self):
16         srng = RandomStreams(seed=234)
17         rv_u = srng.uniform((2, 2))
18         rv_n = srng.normal((2, 2))
19         f = function([], rv_u)
20         g = function([], rv_n, no_default_updates=True)    #Not updating rv_n.rng
21         nearly_zeros = function([], rv_u + rv_u - 2 * rv_u)
22         assert np.all(f() != f())
23         assert np.all(g() == g())
24         assert np.all(abs(nearly_zeros()) &lt; 1e-5)
25         assert isinstance(rv_u.rng.get_value(borrow=True),
26                 np.random.RandomState)
27     def test_basics(self):
28         random = RandomStreams(utt.fetch_seed())
29         fn = function([], random.uniform((2, 2)), updates=random.updates())
30         gn = function([], random.normal((2, 2)), updates=random.updates())
31         fn_val0 = fn()
32         fn_val1 = fn()
33         gn_val0 = gn()
34         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
35         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
36         numpy_val0 = rng.uniform(size=(2, 2))
37         numpy_val1 = rng.uniform(size=(2, 2))
38         assert np.allclose(fn_val0, numpy_val0)
39         print(fn_val0)
40         print(numpy_val0)
41         print(fn_val1)
42         print(numpy_val1)
43         assert np.allclose(fn_val1, numpy_val1)
44     def test_seed_fn(self):
45         random = RandomStreams(234)
46         fn = function([], random.uniform((2, 2)), updates=random.updates())
47         random.seed(utt.fetch_seed())
48         fn_val0 = fn()
49         fn_val1 = fn()
50         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
51         rng = np.random.RandomState(int(rng_seed))  #int() is for 32bit
52         numpy_val0 = rng.uniform(size=(2, 2))
53         numpy_val1 = rng.uniform(size=(2, 2))
54         assert np.allclose(fn_val0, numpy_val0)
55         assert np.allclose(fn_val1, numpy_val1)
56 <a name="0"></a>    def test_getitem(self):
57         random = RandomStreams(234)
58         out = random.uniform<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>((2, 2))
59         fn = function([], out, updates=random.updates())
60         random.seed(utt.fetch_seed())
61         rng = np.</b></font>random.RandomState()
62         rng.set_state(random[out.rng].get_state())  # tests getitem
63         fn_val0 = fn()
64         fn_val1 = fn()
65         numpy_val0 = rng.uniform(size=(2, 2))
66         numpy_val1 = rng.uniform(size=(2, 2))
67         assert np.allclose(fn_val0, numpy_val0)
68         assert np.allclose(fn_val1, numpy_val1)
69     def test_setitem(self):
70         random = RandomStreams(234)
71         out = random.uniform((2, 2))
72         fn = function([], out, updates=random.updates())
73         random.seed(888)
74         rng = np.random.RandomState(utt.fetch_seed())
75         random[out.rng] = np.random.RandomState(utt.fetch_seed())
76         fn_val0 = fn()
77         fn_val1 = fn()
78         numpy_val0 = rng.uniform(size=(2, 2))
79         numpy_val1 = rng.uniform(size=(2, 2))
80         assert np.allclose(fn_val0, numpy_val0)
81         assert np.allclose(fn_val1, numpy_val1)
82     def test_ndim(self):
83         random = RandomStreams(utt.fetch_seed())
84         fn = function([], random.uniform((2, 2)))
85         random2 = RandomStreams(utt.fetch_seed())
86         fn2 = function([], random2.uniform((2, 2), ndim=2))
87         val1 = fn()
88         val2 = fn2()
89         assert np.all(val1 == val2)
90         random3 = RandomStreams(utt.fetch_seed())
91         self.assertRaises(ValueError, random3.uniform, (2, 2), ndim=1)
92     def test_uniform(self):
93         random = RandomStreams(utt.fetch_seed())
94         fn = function([], random.uniform((2, 2), -1, 1))
95         fn_val0 = fn()
96         fn_val1 = fn()
97         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
98         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
99         numpy_val0 = rng.uniform(-1, 1, size=(2, 2))
100         numpy_val1 = rng.uniform(-1, 1, size=(2, 2))
101         assert np.allclose(fn_val0, numpy_val0)
102         assert np.allclose(fn_val1, numpy_val1)
103     def test_normal(self):
104         random = RandomStreams(utt.fetch_seed())
105         fn = function([], random.normal((2, 2), -1, 2))
106         fn_val0 = fn()
107         fn_val1 = fn()
108         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
109         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
110         numpy_val0 = rng.normal(-1, 2, size=(2, 2))
111         numpy_val1 = rng.normal(-1, 2, size=(2, 2))
112         assert np.allclose(fn_val0, numpy_val0)
113         assert np.allclose(fn_val1, numpy_val1)
114     def test_random_integers(self):
115         random = RandomStreams(utt.fetch_seed())
116         fn = function([], random.random_integers((20, 20), -5, 5))
117         fn_val0 = fn()
118         fn_val1 = fn()
119         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
120         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
121         numpy_val0 = rng.randint(-5, 6, size=(20, 20))
122         numpy_val1 = rng.randint(-5, 6, size=(20, 20))
123         assert np.all(fn_val0 == numpy_val0)
124         assert np.all(fn_val1 == numpy_val1)
125     def test_choice(self):
126         random = RandomStreams(utt.fetch_seed())
127         fn = function([], random.choice((11, 8), 10, 1, 0))
128         fn_val0 = fn()
129         fn_val1 = fn()
130         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
131         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
132         numpy_val0 = rng.choice(10, (11, 8), True, None)
133         numpy_val1 = rng.choice(10, (11, 8), True, None)
134         assert np.all(fn_val0 == numpy_val0)
135         assert np.all(fn_val1 == numpy_val1)
136     def test_poisson(self):
137         random = RandomStreams(utt.fetch_seed())
138         fn = function([], random.poisson(lam=5, size=(11, 8)))
139         fn_val0 = fn()
140         fn_val1 = fn()
141         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
142         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
143         numpy_val0 = rng.poisson(lam=5, size=(11, 8))
144         numpy_val1 = rng.poisson(lam=5, size=(11, 8))
145         assert np.all(fn_val0 == numpy_val0)
146         assert np.all(fn_val1 == numpy_val1)
147     def test_permutation(self):
148         random = RandomStreams(utt.fetch_seed())
149         fn = function([], random.permutation((20,), 10), updates=random.updates())
150         fn_val0 = fn()
151         fn_val1 = fn()
152         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
153         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
154         numpy_val0 = np.asarray([rng.permutation(10) for i in range(20)])
155         numpy_val1 = np.asarray([rng.permutation(10) for i in range(20)])
156         assert np.all(fn_val0 == numpy_val0)
157         assert np.all(fn_val1 == numpy_val1)
158     def test_multinomial(self):
159         random = RandomStreams(utt.fetch_seed())
160         fn = function([], random.multinomial((4, 4), 1, [0.1]*10), updates=random.updates())
161         fn_val0 = fn()
162         fn_val1 = fn()
163         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
164         rng = np.random.RandomState(int(rng_seed))  # int() is for 32bit
165         numpy_val0 = rng.multinomial(1, [0.1]*10, size=(4, 4))
166         numpy_val1 = rng.multinomial(1, [0.1]*10, size=(4, 4))
167         assert np.all(fn_val0 == numpy_val0)
168         assert np.all(fn_val1 == numpy_val1)
169     def test_shuffle_row_elements(self):
170         random = RandomStreams(utt.fetch_seed())
171         m_input = tensor.dmatrix()
172         f = function([m_input], random.shuffle_row_elements(m_input), updates=random.updates())
173         val_rng = np.random.RandomState(utt.fetch_seed()+42)
174         in_mval = val_rng.uniform(-2, 2, size=(20, 5))
175         fn_mval0 = f(in_mval)
176         fn_mval1 = f(in_mval)
177         print(in_mval[0])
178         print(fn_mval0[0])
179         print(fn_mval1[0])
180         assert not np.all(in_mval == fn_mval0)
181         assert not np.all(in_mval == fn_mval1)
182         assert not np.all(fn_mval0 == fn_mval1)
183         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
184         rng = np.random.RandomState(int(rng_seed))
185         numpy_mval0 = in_mval.copy()
186         numpy_mval1 = in_mval.copy()
187         for row in numpy_mval0:
188             rng.shuffle(row)
189         for row in numpy_mval1:
190             rng.shuffle(row)
191         assert np.all(numpy_mval0 == fn_mval0)
192         assert np.all(numpy_mval1 == fn_mval1)
193         random1 = RandomStreams(utt.fetch_seed())
194         v_input = tensor.dvector()
195         f1 = function([v_input], random1.shuffle_row_elements(v_input))
196         in_vval = val_rng.uniform(-3, 3, size=(12,))
197         fn_vval = f1(in_vval)
198         numpy_vval = in_vval.copy()
199         vrng = np.random.RandomState(int(rng_seed))
200         vrng.shuffle(numpy_vval)
201         print(in_vval)
202         print(fn_vval)
203         print(numpy_vval)
204         assert np.all(numpy_vval == fn_vval)
205         self.assertRaises(TypeError, f1, in_mval)
206         self.assertRaises(TypeError, f, in_vval)
207     def test_default_updates(self):
208         random_a = RandomStreams(utt.fetch_seed())
209         out_a = random_a.uniform((2, 2))
210         fn_a = function([], out_a)
211         fn_a_val0 = fn_a()
212         fn_a_val1 = fn_a()
213         assert not np.all(fn_a_val0 == fn_a_val1)
214         nearly_zeros = function([], out_a + out_a - 2 * out_a)
215         assert np.all(abs(nearly_zeros()) &lt; 1e-5)
216         random_b = RandomStreams(utt.fetch_seed())
217         out_b = random_b.uniform((2, 2))
218         fn_b = function([], out_b, updates=random_b.updates())
219         fn_b_val0 = fn_b()
220         fn_b_val1 = fn_b()
221         assert np.all(fn_b_val0 == fn_a_val0)
222         assert np.all(fn_b_val1 == fn_a_val1)
223         random_c = RandomStreams(utt.fetch_seed())
224         out_c = random_c.uniform((2, 2))
225         fn_c = function([], out_c, updates=[out_c.update])
226         fn_c_val0 = fn_c()
227         fn_c_val1 = fn_c()
228         assert np.all(fn_c_val0 == fn_a_val0)
229         assert np.all(fn_c_val1 == fn_a_val1)
230         random_d = RandomStreams(utt.fetch_seed())
231         out_d = random_d.uniform((2, 2))
232         fn_d = function([], out_d, no_default_updates=True)
233         fn_d_val0 = fn_d()
234         fn_d_val1 = fn_d()
235         assert np.all(fn_d_val0 == fn_a_val0)
236         assert np.all(fn_d_val1 == fn_d_val0)
237         random_e = RandomStreams(utt.fetch_seed())
238         out_e = random_e.uniform((2, 2))
239         fn_e = function([], out_e, no_default_updates=[out_e.rng])
240         fn_e_val0 = fn_e()
241         fn_e_val1 = fn_e()
242         assert np.all(fn_e_val0 == fn_a_val0)
243         assert np.all(fn_e_val1 == fn_e_val0)
244     def test_symbolic_shape(self):
245         random = RandomStreams(utt.fetch_seed())
246         shape = tensor.lvector()
247         f = function([shape], random.uniform(size=shape, ndim=2))
248         assert f([2, 3]).shape == (2, 3)
249         assert f([4, 8]).shape == (4, 8)
250         self.assertRaises(ValueError, f, [4])
251         self.assertRaises(ValueError, f, [4, 3, 4, 5])
252     def test_mixed_shape(self):
253         random = RandomStreams(utt.fetch_seed())
254         shape0 = tensor.lscalar()
255         shape = (shape0, 3)
256         f = function([shape0], random.uniform(size=shape, ndim=2))
257         assert f(2).shape == (2, 3)
258         assert f(8).shape == (8, 3)
259         g = function([shape0], random.uniform(size=shape))
260         assert g(2).shape == (2, 3)
261         assert g(8).shape == (8, 3)
262     def test_mixed_shape_bcastable(self):
263         random = RandomStreams(utt.fetch_seed())
264         shape0 = tensor.lscalar()
265         shape = (shape0, 1)
266         u = random.uniform(size=shape, ndim=2)
267         assert u.broadcastable == (False, True)
268         f = function([shape0], u)
269         assert f(2).shape == (2, 1)
270         assert f(8).shape == (8, 1)
271         v = random.uniform(size=shape)
272         assert v.broadcastable == (False, True)
273         g = function([shape0], v)
274         assert g(2).shape == (2, 1)
275         assert g(8).shape == (8, 1)
276     def test_default_shape(self):
277         random = RandomStreams(utt.fetch_seed())
278         f = function([], random.uniform())
279         g = function([], random.multinomial())
280         seed_rng = np.random.RandomState(utt.fetch_seed())
281         uniform_rng = np.random.RandomState(int(seed_rng.randint(2**30)))
282         multinomial_rng = np.random.RandomState(int(seed_rng.randint(2**30)))
283         val0 = f()
284         val1 = f()
285         numpy_val0 = uniform_rng.uniform()
286         numpy_val1 = uniform_rng.uniform()
287         assert np.allclose(val0, numpy_val0)
288         assert np.allclose(val1, numpy_val1)
289         for i in range(10):  # every test has 50% chance of passing even with non-matching random states
290             val2 = g()
291             numpy_val2 = multinomial_rng.multinomial(n=1, pvals=[.5, .5])
292             assert np.all(val2 == numpy_val2)
293     def test_vector_arguments(self):
294         random = RandomStreams(utt.fetch_seed())
295         low = tensor.dvector()
296         out = random.uniform(low=low, high=1)
297         assert out.ndim == 1
298         f = function([low], out)
299         seed_gen = np.random.RandomState(utt.fetch_seed())
300         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
301         val0 = f([-5, .5, 0, 1])
302         val1 = f([.9])
303         numpy_val0 = numpy_rng.uniform(low=[-5, .5, 0, 1], high=1)
304         numpy_val1 = numpy_rng.uniform(low=[.9], high=1)
305         assert np.all(val0 == numpy_val0)
306         assert np.all(val1 == numpy_val1)
307         high = tensor.vector()
308         outb = random.uniform(low=low, high=high)
309         assert outb.ndim == 1
310         fb = function([low, high], outb)
311         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
312         val0b = fb([-4., -2], [-1, 0])
313         val1b = fb([-4.], [-1])
314         numpy_val0b = numpy_rng.uniform(low=[-4., -2], high=[-1, 0])
315         numpy_val1b = numpy_rng.uniform(low=[-4.], high=[-1])
316         assert np.all(val0b == numpy_val0b)
317         assert np.all(val1b == numpy_val1b)
318         self.assertRaises(ValueError, fb, [-4., -2], [-1, 0, 1])
319         size = tensor.lvector()
320         outc = random.uniform(low=low, high=high, size=size, ndim=1)
321         fc = function([low, high, size], outc)
322         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
323         val0c = fc([-4., -2], [-1, 0], [2])
324         val1c = fc([-4.], [-1], [1])
325         numpy_val0c = numpy_rng.uniform(low=[-4., -2], high=[-1, 0])
326         numpy_val1c = numpy_rng.uniform(low=[-4.], high=[-1])
327         assert np.all(val0c == numpy_val0c)
328         assert np.all(val1c == numpy_val1c)
329         self.assertRaises(ValueError, fc, [-4., -2], [-1, 0], [1, 2])
330         self.assertRaises(ValueError, fc, [-4., -2], [-1, 0], [2, 1])
331     def test_broadcast_arguments(self):
332         random = RandomStreams(utt.fetch_seed())
333         low = tensor.dvector()
334         high = tensor.dcol()
335         out = random.uniform(low=low, high=high)
336         assert out.ndim == 2
337         f = function([low, high], out)
338         rng_seed = np.random.RandomState(utt.fetch_seed()).randint(2**30)
339         numpy_rng = np.random.RandomState(int(rng_seed))
340         val0 = f([-5, .5, 0, 1], [[1.]])
341         val1 = f([.9], [[1.], [1.1], [1.5]])
342         val2 = f([-5, .5, 0, 1], [[1.], [1.1], [1.5]])
343         numpy_val0 = numpy_rng.uniform(low=[-5, .5, 0, 1], high=[1.])
344         numpy_val1 = numpy_rng.uniform(low=[.9], high=[[1.], [1.1], [1.5]])
345         numpy_val2 = numpy_rng.uniform(low=[-5, .5, 0, 1], high=[[1.], [1.1], [1.5]])
346         assert np.all(val0 == numpy_val0)
347         assert np.all(val1 == numpy_val1)
348         assert np.all(val2 == numpy_val2)
349     def test_uniform_vector(self):
350         random = RandomStreams(utt.fetch_seed())
351         low = tensor.dvector()
352         high = tensor.dvector()
353         out = random.uniform(low=low, high=high)
354         assert out.ndim == 1
355         f = function([low, high], out)
356         low_val = [.1, .2, .3]
357         high_val = [1.1, 2.2, 3.3]
358         seed_gen = np.random.RandomState(utt.fetch_seed())
359         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
360         val0 = f(low_val, high_val)
361         numpy_val0 = numpy_rng.uniform(low=low_val, high=high_val)
362         print('THEANO', val0)
363         print('NUMPY', numpy_val0)
364         assert np.all(val0 == numpy_val0)
365         val1 = f(low_val[:-1], high_val[:-1])
366         numpy_val1 = numpy_rng.uniform(low=low_val[:-1], high=high_val[:-1])
367         print('THEANO', val1)
368         print('NUMPY', numpy_val1)
369         assert np.all(val1 == numpy_val1)
370         g = function([low, high], random.uniform(low=low, high=high, size=(3,)))
371         val2 = g(low_val, high_val)
372         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
373         numpy_val2 = numpy_rng.uniform(low=low_val, high=high_val, size=(3,))
374         assert np.all(val2 == numpy_val2)
375         self.assertRaises(ValueError, g, low_val[:-1], high_val[:-1])
376     def test_binomial_vector(self):
377         random = RandomStreams(utt.fetch_seed())
378         n = tensor.lvector()
379         prob = tensor.vector()
380         out = random.binomial(n=n, p=prob)
381         assert out.ndim == 1
382         f = function([n, prob], out)
383         n_val = [1, 2, 3]
384         prob_val = np.asarray([.1, .2, .3], dtype=config.floatX)
385         seed_gen = np.random.RandomState(utt.fetch_seed())
386         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
387         val0 = f(n_val, prob_val)
388         numpy_val0 = numpy_rng.binomial(n=n_val, p=prob_val)
389         assert np.all(val0 == numpy_val0)
390         val1 = f(n_val[:-1], prob_val[:-1])
391         numpy_val1 = numpy_rng.binomial(n=n_val[:-1], p=prob_val[:-1])
392         assert np.all(val1 == numpy_val1)
393         g = function([n, prob], random.binomial(n=n, p=prob, size=(3,)))
394         val2 = g(n_val, prob_val)
395         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
396         numpy_val2 = numpy_rng.binomial(n=n_val, p=prob_val, size=(3,))
397         assert np.all(val2 == numpy_val2)
398         self.assertRaises(ValueError, g, n_val[:-1], prob_val[:-1])
399     def test_normal_vector(self):
400         random = RandomStreams(utt.fetch_seed())
401         avg = tensor.dvector()
402         std = tensor.dvector()
403         out = random.normal(avg=avg, std=std)
404         assert out.ndim == 1
405         f = function([avg, std], out)
406         avg_val = [1, 2, 3]
407         std_val = [.1, .2, .3]
408         seed_gen = np.random.RandomState(utt.fetch_seed())
409         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
410         val0 = f(avg_val, std_val)
411         numpy_val0 = numpy_rng.normal(loc=avg_val, scale=std_val)
412         assert np.allclose(val0, numpy_val0)
413         val1 = f(avg_val[:-1], std_val[:-1])
414         numpy_val1 = numpy_rng.normal(loc=avg_val[:-1], scale=std_val[:-1])
415         assert np.allclose(val1, numpy_val1)
416         g = function([avg, std], random.normal(avg=avg, std=std, size=(3,)))
417         val2 = g(avg_val, std_val)
418         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
419         numpy_val2 = numpy_rng.normal(loc=avg_val, scale=std_val, size=(3,))
420         assert np.allclose(val2, numpy_val2)
421         self.assertRaises(ValueError, g, avg_val[:-1], std_val[:-1])
422     def test_random_integers_vector(self):
423         random = RandomStreams(utt.fetch_seed())
424         low = tensor.lvector()
425         high = tensor.lvector()
426         out = random.random_integers(low=low, high=high)
427         assert out.ndim == 1
428         f = function([low, high], out)
429         low_val = [100, 200, 300]
430         high_val = [110, 220, 330]
431         seed_gen = np.random.RandomState(utt.fetch_seed())
432         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
433         val0 = f(low_val, high_val)
434         numpy_val0 = np.asarray([numpy_rng.randint(low=lv, high=hv+1)
435             for lv, hv in zip(low_val, high_val)])
436         assert np.all(val0 == numpy_val0)
437         val1 = f(low_val[:-1], high_val[:-1])
438         numpy_val1 = np.asarray([numpy_rng.randint(low=lv, high=hv+1)
439             for lv, hv in zip(low_val[:-1], high_val[:-1])])
440         assert np.all(val1 == numpy_val1)
441         g = function([low, high], random.random_integers(low=low, high=high, size=(3,)))
442         val2 = g(low_val, high_val)
443         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
444         numpy_val2 = np.asarray([numpy_rng.randint(low=lv, high=hv+1)
445             for lv, hv in zip(low_val, high_val)])
446         assert np.all(val2 == numpy_val2)
447         self.assertRaises(ValueError, g, low_val[:-1], high_val[:-1])
448     def test_multinomial_vector(self):
449         random = RandomStreams(utt.fetch_seed())
450         n = tensor.lvector()
451         pvals = tensor.matrix()
452         out = random.multinomial(n=n, pvals=pvals)
453         assert out.ndim == 2
454         f = function([n, pvals], out)
455         n_val = [1, 2, 3]
456         pvals_val = [[.1, .9], [.2, .8], [.3, .7]]
457         pvals_val = np.asarray(pvals_val, dtype=config.floatX)
458         seed_gen = np.random.RandomState(utt.fetch_seed())
459         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
460         val0 = f(n_val, pvals_val)
461         numpy_val0 = np.asarray([numpy_rng.multinomial(n=nv, pvals=pv)
462             for nv, pv in zip(n_val, pvals_val)])
463         assert np.all(val0 == numpy_val0)
464         val1 = f(n_val[:-1], pvals_val[:-1])
465         numpy_val1 = np.asarray([numpy_rng.multinomial(n=nv, pvals=pv)
466             for nv, pv in zip(n_val[:-1], pvals_val[:-1])])
467         assert np.all(val1 == numpy_val1)
468         g = function([n, pvals], random.multinomial(n=n, pvals=pvals, size=(3,)))
469         val2 = g(n_val, pvals_val)
470         numpy_rng = np.random.RandomState(int(seed_gen.randint(2**30)))
471         numpy_val2 = np.asarray([numpy_rng.multinomial(n=nv, pvals=pv)
472             for nv, pv in zip(n_val, pvals_val)])
473         assert np.all(val2 == numpy_val2)
474         self.assertRaises(ValueError, g, n_val[:-1], pvals_val[:-1])
475     def test_dtype(self):
476         random = RandomStreams(utt.fetch_seed())
477         low = tensor.lscalar()
478         high = tensor.lscalar()
479         out = random.random_integers(low=low, high=high, size=(20,), dtype='int8')
480         assert out.dtype == 'int8'
481         f = function([low, high], out)
482         val0 = f(0, 9)
483         assert val0.dtype == 'int8'
484         val1 = f(255, 257)
485         assert val1.dtype == 'int8'
486         assert np.all(abs(val1) &lt;= 1)
487     def test_default_dtype(self):
488         random = RandomStreams(utt.fetch_seed())
489         low = tensor.dscalar()
490         high = tensor.dscalar()
491         out0 = random.uniform(low=low, high=high, size=(42,))
492         assert out0.dtype == 'float64'
493         f0 = function([low, high], out0)
494         val0 = f0(-2.1, 3.1)
495         assert val0.dtype == 'float64'
496         out1 = random.uniform(low=low, high=high, size=(42,), dtype='float32')
497         assert out1.dtype == 'float32'
498         f1 = function([low, high], out1)
499         val1 = f1(-1.1, 1.1)
500         assert val1.dtype == 'float32'
501         lowf = tensor.fscalar()
502         highf = tensor.fscalar()
503         outf = random.uniform(low=lowf, high=highf, size=(42,))
504         assert outf.dtype == config.floatX
505         ff = function([lowf, highf], outf)
506         valf = ff(np.float32(-0.1), np.float32(0.3))
507         assert valf.dtype == config.floatX
508     def test_shared_constructor_borrow(self):
509         rng = np.random.RandomState(123)
510         s_rng_default = shared(rng)
511         s_rng_True = shared(rng, borrow=True)
512         s_rng_False = shared(rng, borrow=False)
513         assert s_rng_default.container.storage[0] is not rng
514         assert s_rng_False.container.storage[0] is not rng
515         assert s_rng_True.container.storage[0] is rng
516         v = rng.randn()
517         v0 = s_rng_default.container.storage[0].randn()
518         v1 = s_rng_False.container.storage[0].randn()
519         assert v == v0 == v1
520     def test_get_value_borrow(self):
521         rng = np.random.RandomState(123)
522         s_rng = shared(rng)
523         r_ = s_rng.container.storage[0]
524         r_T = s_rng.get_value(borrow=True)
525         r_F = s_rng.get_value(borrow=False)
526         assert r_ is not r_F
527         assert r_ is r_T
528         assert r_.rand() == r_F.rand()
529     def test_get_value_internal_type(self):
530         rng = np.random.RandomState(123)
531         s_rng = shared(rng)
532         r_ = s_rng.container.storage[0]
533         r_T = s_rng.get_value(borrow=True, return_internal_type=True)
534         r_F = s_rng.get_value(borrow=False, return_internal_type=True)
535         assert r_ is not r_F
536         assert r_ is r_T
537         assert r_.rand() == r_F.rand()
538     def test_set_value_borrow(self):
539         rng = np.random.RandomState(123)
540         s_rng = shared(rng)
541         new_rng = np.random.RandomState(234234)
542         s_rng.set_value(new_rng, borrow=False)
543         assert new_rng is not s_rng.container.storage[0]
544         assert new_rng.randn() == s_rng.container.storage[0].randn()
545         rr = np.random.RandomState(33)
546         s_rng.set_value(rr, borrow=True)
547         assert rr is s_rng.container.storage[0]
548     def test_multiple_rng_aliasing(self):
549         rng1 = RandomStreams(1234)
550         rng2 = RandomStreams(2392)
551         assert rng1.state_updates is not rng2.state_updates
552         assert rng1.gen_seedgen is not rng2.gen_seedgen
553     def test_random_state_transfer(self):
554         class Graph:
555             def __init__(self, seed=123):
556                 self.rng = RandomStreams(seed)
557                 self.y = self.rng.uniform(size=(1,))
558         g1 = Graph(seed=123)
559         f1 = function([], g1.y)
560         g2 = Graph(seed=987)
561         f2 = function([], g2.y)
562         for (su1, su2) in zip(g1.rng.state_updates, g2.rng.state_updates):
563             su2[0].set_value(su1[0].get_value())
564         np.testing.assert_array_almost_equal(f1(), f2(), decimal=6)
565 if __name__ == '__main__':
566     from theano.tests import main
567     main("test_shared_randomstreams")
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
