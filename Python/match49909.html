<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_debian_ip_1.py &amp; test_sysctl.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_debian_ip_1.py &amp; test_sysctl.py
      </h3>
<h1 align="center">
        5.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_debian_ip_1.py (3.860294%)<th>test_sysctl.py (11.4754095%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(867-871)<td><a href="#" name="0">(27-30)</a><td align="center"><font color="#ff0000">16</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(1176-1183)<td><a href="#" name="1">(73-75)</a><td align="center"><font color="#cf0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(1148-1155)<td><a href="#" name="2">(48-50)</a><td align="center"><font color="#cf0000">13</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_debian_ip_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import tempfile
2 import jinja2.exceptions
3 import pytest
4 import salt.modules.debian_ip as debian_ip
5 import salt.utils.files
6 import salt.utils.platform
7 from tests.support.mixins import LoaderModuleMockMixin
8 from tests.support.mock import MagicMock, patch
9 from tests.support.unit import TestCase, skipIf
10 try:
11     from salt.utils.odict import OrderedDict as odict
12 except ImportError:
13     from collections import OrderedDict as odict
14 test_interfaces = [
15         {'iface_name': 'eth1', 'iface_type': 'eth', 'enabled': True,
16             'build_interface': {
17                 'proto': 'static',
18                 'ipaddr': '192.168.4.9',
19                 'netmask': '255.255.255.0',
20                 'gateway': '192.168.4.1',
21                 'enable_ipv6': False,
22                 'noifupdown': True,
23                 },
24             'get_interface': odict([('eth1', odict([('enabled', True), ('data', odict([
25                 ('inet', odict([
26                     ('addrfam', 'inet'),
27                     ('proto', 'static'),
28                     ('filename', None),
29                     ('address', '192.168.4.9'),
30                     ('netmask', '255.255.255.0'),
31                     ('gateway', '192.168.4.1'),
32                     ])),
33                 ]))]))]),
34             'return': [
35                 'auto eth1\n',
36                 'iface eth1 inet static\n',
37                 '    address 192.168.4.9\n',
38                 '    netmask 255.255.255.0\n',
39                 '    gateway 192.168.4.1\n',
40                 '\n']},
41         {'iface_name': 'eth2', 'iface_type': 'eth', 'enabled': True,
42             'build_interface': {
43                 'ipv6proto': 'static',
44                 'ipv6ipaddr': '2001:db8:dead:beef::3',
45                 'ipv6netmask': '64',
46                 'ipv6gateway': '2001:db8:dead:beef::1',
47                 'enable_ipv6': True,
48                 'noifupdown': True,
49                 },
50             'get_interface': odict([('eth2', odict([('enabled', True), ('data', odict([
51                 ('inet6', odict([
52                     ('addrfam', 'inet6'),
53                     ('proto', 'static'),
54                     ('filename', None),
55                     ('address', '2001:db8:dead:beef::3'),
56                     ('netmask', 64),
57                     ('gateway', '2001:db8:dead:beef::1'),
58                     ])),
59                 ]))]))]),
60             'return': [
61                 'auto eth2\n',
62                 'iface eth2 inet6 static\n',
63                 '    address 2001:db8:dead:beef::3\n',
64                 '    netmask 64\n',
65                 '    gateway 2001:db8:dead:beef::1\n',
66                 '\n']},
67         {'iface_name': 'eth3', 'iface_type': 'eth', 'enabled': True,
68             'build_interface': {
69                 'ipv6proto': 'static',
70                 'ipv6ipaddr': '2001:db8:dead:beef::5/64',
71                 'ipv6ipaddrs': [
72                     '2001:db8:dead:beef::7/64',
73                     '2001:db8:dead:beef::8/64',
74                     '2001:db8:dead:beef::9/64'],
75                 'enable_ipv6': True,
76                 'noifupdown': True,
77                 },
78             'get_interface': odict([('eth3', odict([('enabled', True), ('data', odict([
79                 ('inet6', odict([
80                     ('addrfam', 'inet6'),
81                     ('proto', 'static'),
82                     ('filename', None),
83                     ('address', '2001:db8:dead:beef::5/64'),
84                     ('addresses', [
85                         '2001:db8:dead:beef::7/64',
86                         '2001:db8:dead:beef::8/64',
87                         '2001:db8:dead:beef::9/64',
88                         ]),
89                     ])),
90                 ]))]))]),
91             'return': [
92                 'auto eth3\n',
93                 'iface eth3 inet6 static\n',
94                 '    address 2001:db8:dead:beef::5/64\n',
95                 '    address 2001:db8:dead:beef::7/64\n',
96                 '    address 2001:db8:dead:beef::8/64\n',
97                 '    address 2001:db8:dead:beef::9/64\n',
98                 '\n']},
99         {'iface_name': 'eth4', 'iface_type': 'eth', 'enabled': True,
100             'build_interface': {
101                 'ipv6proto': 'static',
102                 'ipv6ipaddrs': [
103                     '2001:db8:dead:beef::5/64',
104                     '2001:db8:dead:beef::7/64',
105                     '2001:db8:dead:beef::8/64',
106                     '2001:db8:dead:beef::9/64'],
107                 'ipv6gateway': '2001:db8:dead:beef::1',
108                 'enable_ipv6': True,
109                 'noifupdown': True,
110                 },
111             'get_interface': odict([('eth4', odict([('enabled', True), ('data', odict([
112                 ('inet6', odict([
113                     ('addrfam', 'inet6'),
114                     ('proto', 'static'),
115                     ('filename', None),
116                     ('address', '2001:db8:dead:beef::5/64'),
117                     ('addresses', [
118                         '2001:db8:dead:beef::7/64',
119                         '2001:db8:dead:beef::8/64',
120                         '2001:db8:dead:beef::9/64',
121                         ]),
122                     ('gateway', '2001:db8:dead:beef::1'),
123                     ])),
124                 ]))]))]),
125             'return': [
126                 'auto eth4\n',
127                 'iface eth4 inet6 static\n',
128                 '    address 2001:db8:dead:beef::5/64\n',
129                 '    address 2001:db8:dead:beef::7/64\n',
130                 '    address 2001:db8:dead:beef::8/64\n',
131                 '    address 2001:db8:dead:beef::9/64\n',
132                 '    gateway 2001:db8:dead:beef::1\n',
133                 '\n']},
134         {'iface_name': 'eth5', 'iface_type': 'eth', 'enabled': True,
135             'build_interface': {
136                 'proto': 'static',
137                 'ipaddr': '192.168.4.9',
138                 'netmask': '255.255.255.0',
139                 'gateway': '192.168.4.1',
140                 'ipv6proto': 'static',
141                 'ipv6ipaddr': '2001:db8:dead:beef::3',
142                 'ipv6netmask': '64',
143                 'ipv6gateway': '2001:db8:dead:beef::1',
144                 'enable_ipv4': False,
145                 'noifupdown': True,
146                 },
147             'get_interface': odict([('eth5', odict([('enabled', True), ('data', odict([
148                 ('inet6', odict([
149                     ('addrfam', 'inet6'),
150                     ('proto', 'static'),
151                     ('filename', None),
152                     ('address', '2001:db8:dead:beef::3'),
153                     ('netmask', 64),
154                     ('gateway', '2001:db8:dead:beef::1'),
155                     ])),
156                 ]))]))]),
157             'return': [
158                 'auto eth5\n',
159                 'iface eth5 inet6 static\n',
160                 '    address 2001:db8:dead:beef::3\n',
161                 '    netmask 64\n',
162                 '    gateway 2001:db8:dead:beef::1\n',
163                 '\n']},
164         {'iface_name': 'eth6', 'iface_type': 'eth', 'enabled': True,
165             'build_interface': {
166                 'proto': 'static',
167                 'ipaddr': '192.168.4.9',
168                 'netmask': '255.255.255.0',
169                 'gateway': '192.168.4.1',
170                 'ipv6proto': 'static',
171                 'ipv6ipaddr': '2001:db8:dead:beef::3',
172                 'ipv6netmask': '64',
173                 'ipv6gateway': '2001:db8:dead:beef::1',
174                 'enable_ipv6': False,
175                 'noifupdown': True,
176                 },
177             'get_interface': odict([('eth6', odict([('enabled', True), ('data', odict([
178                 ('inet', odict([
179                     ('addrfam', 'inet'),
180                     ('proto', 'static'),
181                     ('filename', None),
182                     ('address', '192.168.4.9'),
183                     ('netmask', '255.255.255.0'),
184                     ('gateway', '192.168.4.1'),
185                     ])),
186                 ]))]))]),
187             'return': [
188                 'auto eth6\n',
189                 'iface eth6 inet static\n',
190                 '    address 192.168.4.9\n',
191                 '    netmask 255.255.255.0\n',
192                 '    gateway 192.168.4.1\n',
193                 '\n']},
194         {'iface_name': 'eth7', 'iface_type': 'eth', 'enabled': True,
195             'build_interface': {
196                 'proto': 'static',
197                 'ipaddr': '192.168.4.9',
198                 'netmask': '255.255.255.0',
199                 'gateway': '192.168.4.1',
200                 'ipv6proto': 'static',
201                 'ipv6ipaddr': '2001:db8:dead:beef::3',
202                 'ipv6netmask': '64',
203                 'ipv6gateway': '2001:db8:dead:beef::1',
204                 'ttl': '18',  # shared
205                 'ipv6ttl': '15',  # overridden for v6
206                 'mtu': '1480',  # shared
207                 'enable_ipv6': True,
208                 'noifupdown': True,
209                 },
210             'get_interface': odict([('eth7', odict([('enabled', True), ('data', odict([
211                 ('inet', odict([
212                     ('addrfam', 'inet'),
213                     ('proto', 'static'),
214                     ('filename', None),
215                     ('address', '192.168.4.9'),
216                     ('netmask', '255.255.255.0'),
217                     ('gateway', '192.168.4.1'),
218                     ('ttl', 18),
219                     ('mtu', 1480),
220                     ])),
221                 ('inet6', odict([
222                     ('addrfam', 'inet6'),
223                     ('proto', 'static'),
224                     ('filename', None),
225                     ('address', '2001:db8:dead:beef::3'),
226                     ('netmask', 64),
227                     ('gateway', '2001:db8:dead:beef::1'),
228                     ('ttl', 15),
229                     ('mtu', 1480),
230                     ])),
231                 ]))]))]),
232             'return': [
233                 'auto eth7\n',
234                 'iface eth7 inet static\n',
235                 '    address 192.168.4.9\n',
236                 '    netmask 255.255.255.0\n',
237                 '    gateway 192.168.4.1\n',
238                 '    ttl 18\n',
239                 '    mtu 1480\n',
240                 'iface eth7 inet6 static\n',
241                 '    address 2001:db8:dead:beef::3\n',
242                 '    netmask 64\n',
243                 '    gateway 2001:db8:dead:beef::1\n',
244                 '    ttl 15\n',
245                 '    mtu 1480\n',
246                 '\n']},
247         {'iface_name': 'eth8', 'iface_type': 'slave', 'enabled': True,
248             'build_interface': {
249                 'master': 'bond0',
250                 'noifupdown': True,
251                 },
252             'get_interface': odict([('eth8', odict([('enabled', True), ('data', odict([
253                 ('inet', odict([
254                     ('addrfam', 'inet'),
255                     ('proto', 'manual'),
256                     ('filename', None),
257                     ('bonding', odict([
258                         ('master', 'bond0'),
259                         ])),
260                     ('bonding_keys', ['master']),
261                     ])),
262                 ]))]))]),
263             'return': [
264                 'auto eth8\n',
265                 'iface eth8 inet manual\n',
266                 '    bond-master bond0\n',
267                 '\n']},
268         {'iface_name': 'bond9', 'iface_type': 'bond', 'enabled': True,
269             'build_interface': {
270                 'proto': 'static',
271                 'ipaddr': '10.1.0.14',
272                 'netmask': '255.255.255.0',
273                 'gateway': '10.1.0.1',
274                 'ipv6proto': 'static',
275                 'ipv6ipaddr': '2001:db8:dead:c0::3',
276                 'ipv6netmask': '64',
277                 'ipv6gateway': '2001:db8:dead:c0::1',
278                 'mode': '802.3ad',
279                 'slaves': 'eth4 eth5',
280                 'enable_ipv6': True,
281                 'noifupdown': True,
282                 },
283             'get_interface': odict([('bond9', odict([('enabled', True), ('data', odict([
284                 ('inet', odict([
285                     ('addrfam', 'inet'),
286                     ('proto', 'static'),
287                     ('filename', None),
288                     ('address', '10.1.0.14'),
289                     ('netmask', '255.255.255.0'),
290                     ('gateway', '10.1.0.1'),
291                     ('bonding', odict([
292                         ('ad_select', '0'),
293                         ('downdelay', '200'),
294                         ('lacp_rate', '0'),
295                         ('miimon', '100'),
296                         ('mode', '4'),
297                         ('slaves', 'eth4 eth5'),
298                         ('updelay', '0'),
299                         ('use_carrier', 'on'),
300                         ])),
301                     ('bonding_keys', [
302                         'ad_select',
303                         'downdelay',
304                         'lacp_rate',
305                         'miimon',
306                         'mode',
307                         'slaves',
308                         'updelay',
309                         'use_carrier',
310                         ]),
311                     ])),
312                 ('inet6', odict([
313                     ('addrfam', 'inet6'),
314                     ('proto', 'static'),
315                     ('filename', None),
316                     ('address', '2001:db8:dead:c0::3'),
317                     ('netmask', 64),
318                     ('gateway', '2001:db8:dead:c0::1'),
319                     ('bonding', odict([
320                         ('ad_select', '0'),
321                         ('downdelay', '200'),
322                         ('lacp_rate', '0'),
323                         ('miimon', '100'),
324                         ('mode', '4'),
325                         ('slaves', 'eth4 eth5'),
326                         ('updelay', '0'),
327                         ('use_carrier', 'on'),
328                         ])),
329                     ('bonding_keys', [
330                         'ad_select',
331                         'downdelay',
332                         'lacp_rate',
333                         'miimon',
334                         'mode',
335                         'slaves',
336                         'updelay',
337                         'use_carrier',
338                         ]),
339                     ])),
340                 ]))]))]),
341             'return': [
342                 'auto bond9\n',
343                 'iface bond9 inet static\n',
344                 '    address 10.1.0.14\n',
345                 '    netmask 255.255.255.0\n',
346                 '    gateway 10.1.0.1\n',
347                 '    bond-ad_select 0\n',
348                 '    bond-downdelay 200\n',
349                 '    bond-lacp_rate 0\n',
350                 '    bond-miimon 100\n',
351                 '    bond-mode 4\n',
352                 '    bond-slaves eth4 eth5\n',
353                 '    bond-updelay 0\n',
354                 '    bond-use_carrier on\n',
355                 'iface bond9 inet6 static\n',
356                 '    address 2001:db8:dead:c0::3\n',
357                 '    netmask 64\n',
358                 '    gateway 2001:db8:dead:c0::1\n',
359                 '    bond-ad_select 0\n',
360                 '    bond-downdelay 200\n',
361                 '    bond-lacp_rate 0\n',
362                 '    bond-miimon 100\n',
363                 '    bond-mode 4\n',
364                 '    bond-slaves eth4 eth5\n',
365                 '    bond-updelay 0\n',
366                 '    bond-use_carrier on\n',
367                 '\n']},
368         {'iface_name': 'bond10', 'iface_type': 'bond', 'enabled': True,
369             'build_interface': {
370                 'proto': 'static',
371                 'ipaddr': '10.1.0.14',
372                 'netmask': '255.255.255.0',
373                 'gateway': '10.1.0.1',
374                 'ipv6proto': 'static',
375                 'ipv6ipaddr': '2001:db8:dead:c0::3',
376                 'ipv6netmask': '64',
377                 'ipv6gateway': '2001:db8:dead:c0::1',
378                 'mode': '802.3ad',
379                 'slaves': ['eth4', 'eth5'],
380                 'enable_ipv6': True,
381                 'noifupdown': True,
382                 },
383             'get_interface': odict([('bond10', odict([('enabled', True), ('data', odict([
384                 ('inet', odict([
385                     ('addrfam', 'inet'),
386                     ('proto', 'static'),
387                     ('filename', None),
388                     ('address', '10.1.0.14'),
389                     ('netmask', '255.255.255.0'),
390                     ('gateway', '10.1.0.1'),
391                     ('bonding', odict([
392                         ('ad_select', '0'),
393                         ('downdelay', '200'),
394                         ('lacp_rate', '0'),
395                         ('miimon', '100'),
396                         ('mode', '4'),
397                         ('slaves', 'eth4 eth5'),
398                         ('updelay', '0'),
399                         ('use_carrier', 'on'),
400                         ])),
401                     ('bonding_keys', [
402                         'ad_select',
403                         'downdelay',
404                         'lacp_rate',
405                         'miimon',
406                         'mode',
407                         'slaves',
408                         'updelay',
409                         'use_carrier',
410                         ]),
411                     ])),
412                 ('inet6', odict([
413                     ('addrfam', 'inet6'),
414                     ('proto', 'static'),
415                     ('filename', None),
416                     ('address', '2001:db8:dead:c0::3'),
417                     ('netmask', 64),
418                     ('gateway', '2001:db8:dead:c0::1'),
419                     ('bonding', odict([
420                         ('ad_select', '0'),
421                         ('downdelay', '200'),
422                         ('lacp_rate', '0'),
423                         ('miimon', '100'),
424                         ('mode', '4'),
425                         ('slaves', 'eth4 eth5'),
426                         ('updelay', '0'),
427                         ('use_carrier', 'on'),
428                         ])),
429                     ('bonding_keys', [
430                         'ad_select',
431                         'downdelay',
432                         'lacp_rate',
433                         'miimon',
434                         'mode',
435                         'slaves',
436                         'updelay',
437                         'use_carrier',
438                         ]),
439                     ])),
440                 ]))]))]),
441             'return': [
442                 'auto bond10\n',
443                 'iface bond10 inet static\n',
444                 '    address 10.1.0.14\n',
445                 '    netmask 255.255.255.0\n',
446                 '    gateway 10.1.0.1\n',
447                 '    bond-ad_select 0\n',
448                 '    bond-downdelay 200\n',
449                 '    bond-lacp_rate 0\n',
450                 '    bond-miimon 100\n',
451                 '    bond-mode 4\n',
452                 '    bond-slaves eth4 eth5\n',
453                 '    bond-updelay 0\n',
454                 '    bond-use_carrier on\n',
455                 'iface bond10 inet6 static\n',
456                 '    address 2001:db8:dead:c0::3\n',
457                 '    netmask 64\n',
458                 '    gateway 2001:db8:dead:c0::1\n',
459                 '    bond-ad_select 0\n',
460                 '    bond-downdelay 200\n',
461                 '    bond-lacp_rate 0\n',
462                 '    bond-miimon 100\n',
463                 '    bond-mode 4\n',
464                 '    bond-slaves eth4 eth5\n',
465                 '    bond-updelay 0\n',
466                 '    bond-use_carrier on\n',
467                 '\n']},
468         {'iface_name': 'bond0.11', 'iface_type': 'vlan', 'enabled': True,
469             'build_interface': {
470                 'proto': 'static',
471                 'ipaddr': '10.7.0.8',
472                 'netmask': '255.255.255.0',
473                 'gateway': '10.7.0.1',
474                 'slaves': 'eth6 eth7',
475                 'mode': '802.3ad',
476                 'enable_ipv6': False,
477                 'noifupdown': True,
478                 },
479             'get_interface': odict([('bond0.11', odict([('enabled', True), ('data', odict([
480                 ('inet', odict([
481                     ('addrfam', 'inet'),
482                     ('proto', 'static'),
483                     ('filename', None),
484                     ('vlan_raw_device', 'bond1'),
485                     ('address', '10.7.0.8'),
486                     ('netmask', '255.255.255.0'),
487                     ('gateway', '10.7.0.1'),
488                     ('mode', '802.3ad'),
489                     ])),
490                 ]))]))]),
491             'return': [
492                 'auto bond0.11\n',
493                 'iface bond0.11 inet static\n',
494                 '    vlan-raw-device bond1\n',
495                 '    address 10.7.0.8\n',
496                 '    netmask 255.255.255.0\n',
497                 '    gateway 10.7.0.1\n',
498                 '    mode 802.3ad\n',
499                 '\n']},
500         {'iface_name': 'bond0.12', 'iface_type': 'vlan', 'enabled': True,
501             'build_interface': {
502                 'proto': 'static',
503                 'slaves': 'eth6 eth7',
504                 'mode': '802.3ad',
505                 'enable_ipv6': False,
506                 'noifupdown': True,
507                 },
508             'get_interface': odict([('bond0.12', odict([('enabled', True), ('data', odict([
509                 ('inet', odict([
510                     ('addrfam', 'inet'),
511                     ('proto', 'static'),
512                     ('filename', None),
513                     ('vlan_raw_device', 'bond1'),
514                     ('mode', '802.3ad'),
515                     ])),
516                 ]))]))]),
517             'return': [
518                 'auto bond0.12\n',
519                 'iface bond0.12 inet static\n',
520                 '    vlan-raw-device bond1\n',
521                 '    mode 802.3ad\n',
522                 '\n']},
523         {'iface_name': 'br0', 'iface_type': 'bridge', 'enabled': True,
524             'build_interface': {
525                 'proto': 'static',
526                 'ipaddr': '192.168.4.10',
527                 'netmask': '255.255.255.0',
528                 'gateway': '192.168.4.1',
529                 'bridge_ports': 'eth1',
530                 'enable_ipv6': False,
531                 'noifupdown': True,
532                 },
533            'get_interface': odict([('br0', odict([('enabled', True), ('data', odict([
534                 ('inet', odict([
535                     ('addrfam', 'inet'),
536                     ('proto', 'static'),
537                     ('filename', None),
538                     ('address', '192.168.4.10'),
539                     ('netmask', '255.255.255.0'),
540                     ('gateway', '192.168.4.1'),
541                     ('bridging', odict([
542                         ('ports', 'eth1'),
543                     ])),
544                     ('bridging_keys', ['ports']),
545                     ])),
546                 ]))]))]),
547             'return': [
548                 'auto br0\n',
549                 'iface br0 inet static\n',
550                 '    address 192.168.4.10\n',
551                 '    netmask 255.255.255.0\n',
552                 '    gateway 192.168.4.1\n',
553                 '    bridge_ports eth1\n',
554                 '\n']},
555         {'iface_name': 'eth13', 'iface_type': 'eth', 'enabled': True,
556             'build_interface': {
557                 'proto': 'static',
558                 'ipaddr': '192.168.4.9',
559                 'netmask': '255.255.255.0',
560                 'gateway': '192.168.4.1',
561                 'enable_ipv6': False,
562                 'noifupdown': True,
563                 'dns': ['8.8.8.8', '8.8.4.4'],
564                 },
565             'get_interface': odict([('eth13', odict([('enabled', True), ('data', odict([
566                 ('inet', odict([
567                     ('addrfam', 'inet'),
568                     ('proto', 'static'),
569                     ('filename', None),
570                     ('address', '192.168.4.9'),
571                     ('netmask', '255.255.255.0'),
572                     ('gateway', '192.168.4.1'),
573                     ('dns_nameservers', ['8.8.8.8', '8.8.4.4']),
574                     ])),
575                 ]))]))]),
576             'return': [
577                 'auto eth13\n',
578                 'iface eth13 inet static\n',
579                 '    address 192.168.4.9\n',
580                 '    netmask 255.255.255.0\n',
581                 '    gateway 192.168.4.1\n',
582                 '    dns-nameservers 8.8.8.8 8.8.4.4\n',
583                 '\n']},
584         {'iface_name': 'eth14', 'iface_type': 'eth', 'enabled': True,
585             'build_interface': {
586                 'proto': 'static',
587                 'ipaddr': '192.168.4.9',
588                 'netmask': '255.255.255.0',
589                 'gateway': '192.168.4.1',
590                 'enable_ipv6': False,
591                 'noifupdown': True,
592                 'dns': '8.8.8.8 8.8.4.4',
593                 },
594             'get_interface': odict([('eth14', odict([('enabled', True), ('data', odict([
595                 ('inet', odict([
596                     ('addrfam', 'inet'),
597                     ('proto', 'static'),
598                     ('filename', None),
599                     ('address', '192.168.4.9'),
600                     ('netmask', '255.255.255.0'),
601                     ('gateway', '192.168.4.1'),
602                     ('dns_nameservers', ['8.8.8.8', '8.8.4.4']),
603                     ])),
604                 ]))]))]),
605             'return': [
606                 'auto eth14\n',
607                 'iface eth14 inet static\n',
608                 '    address 192.168.4.9\n',
609                 '    netmask 255.255.255.0\n',
610                 '    gateway 192.168.4.1\n',
611                 '    dns-nameservers 8.8.8.8 8.8.4.4\n',
612                 '\n']},
613         {'iface_name': 'lo15', 'iface_type': 'eth', 'enabled': True,
614             'build_interface': {
615                 'proto': 'loopback',
616                 'ipaddr': '192.168.4.9',
617                 'netmask': '255.255.255.0',
618                 'gateway': '192.168.4.1',
619                 'enable_ipv6': True,
620                 'ipv6proto': 'loopback',
621                 'ipv6ipaddr': 'fc00::1',
622                 'ipv6netmask': '128',
623                 'ipv6_autoconf': False,
624                 'noifupdown': True,
625                 },
626             'get_interface': odict([('lo15', odict([('enabled', True), ('data', odict([
627                 ('inet', odict([
628                     ('addrfam', 'inet'),
629                     ('proto', 'loopback'),
630                     ('filename', None),
631                     ('address', '192.168.4.9'),
632                     ('netmask', '255.255.255.0'),
633                     ('gateway', '192.168.4.1'),
634                     ])),
635                 ('inet6', odict([
636                     ('addrfam', 'inet6'),
637                     ('proto', 'loopback'),
638                     ('filename', None),
639                     ('address', 'fc00::1'),
640                     ('netmask', 128),
641                     ])),
642                 ]))]))]),
643             'return': [
644                 'auto lo15\n',
645                 'iface lo15 inet loopback\n',
646                 '    address 192.168.4.9\n',
647                 '    netmask 255.255.255.0\n',
648                 '    gateway 192.168.4.1\n',
649                 'iface lo15 inet6 loopback\n',
650                 '    address fc00::1\n',
651                 '    netmask 128\n',
652                 '\n']},
653         {'iface_name': 'lo16', 'iface_type': 'eth', 'enabled': False,
654             'build_interface': {
655                 'enable_ipv6': True,
656                 'ipv6proto': 'loopback',
657                 'ipv6ipaddr': 'fc00::1',
658                 'ipv6netmask': '128',
659                 'ipv6_autoconf': False,
660                 'noifupdown': True,
661                 },
662             'get_interface': odict([('lo16', odict([('data', odict([
663                 ('inet6', odict([
664                     ('addrfam', 'inet6'),
665                     ('proto', 'loopback'),
666                     ('filename', None),
667                     ('address', 'fc00::1'),
668                     ('netmask', 128),
669                     ])),
670                 ]))]))]),
671             'return': [
672                 'iface lo16 inet6 loopback\n',
673                 '    address fc00::1\n',
674                 '    netmask 128\n',
675                 '\n']},
676         {'iface_name': 'lo17', 'iface_type': 'eth', 'enabled': True,
677             'build_interface': {
678                 'proto': 'loopback',
679                 'enable_ipv6': False,
680                 'noifupdown': True,
681                 },
682             'get_interface': odict([('lo17', odict([('enabled', True), ('data', odict([
683                 ('inet', odict([
684                     ('addrfam', 'inet'),
685                     ('proto', 'loopback'),
686                     ('filename', None),
687                     ])),
688                 ]))]))]),
689             'return': [
690                 'auto lo17\n',
691                 'iface lo17 inet loopback\n',
692                 '\n']},
693         {'iface_name': 'eth18', 'iface_type': 'eth', 'enabled': True,
694             'build_interface': {
695                 'proto': 'dhcp',
696                 'enable_ipv6': True,
697                 'ipv6proto': 'static',
698                 'ipv6ipaddr': '2001:db8:dead:c0::3',
699                 'ipv6netmask': '64',
700                 'ipv6gateway': '2001:db8:dead:c0::1',
701                 'noifupdown': True,
702                 },
703             'get_interface': odict([('eth18', odict([('enabled', True), ('data', odict([
704                 ('inet', odict([
705                     ('addrfam', 'inet'),
706                     ('proto', 'dhcp'),
707                     ('filename', None),
708                     ])),
709                 ('inet6', odict([
710                     ('addrfam', 'inet6'),
711                     ('proto', 'static'),
712                     ('filename', None),
713                     ('address', '2001:db8:dead:c0::3'),
714                     ('netmask', 64),
715                     ('gateway', '2001:db8:dead:c0::1'),
716                     ])),
717                 ]))]))]),
718             'return': [
719                 'auto eth18\n',
720                 'iface eth18 inet dhcp\n',
721                 'iface eth18 inet6 static\n',
722                 '    address 2001:db8:dead:c0::3\n',
723                 '    netmask 64\n',
724                 '    gateway 2001:db8:dead:c0::1\n',
725                 '\n']},
726         {'iface_name': 'eth19', 'iface_type': 'eth', 'enabled': True,
727             'build_interface': {
728                 'proto': 'dhcp',
729                 'enable_ipv6': True,
730                 'ipv6proto': 'static',
731                 'ipv6ipaddr': '2001:db8:dead:c0::3/64',
732                 'ipv6gateway': '2001:db8:dead:c0::1',
733                 'noifupdown': True,
734                 },
735             'get_interface': odict([('eth19', odict([('enabled', True), ('data', odict([
736                 ('inet', odict([
737                     ('addrfam', 'inet'),
738                     ('proto', 'dhcp'),
739                     ('filename', None),
740                     ])),
741                 ('inet6', odict([
742                     ('addrfam', 'inet6'),
743                     ('proto', 'static'),
744                     ('filename', None),
745                     ('address', '2001:db8:dead:c0::3/64'),
746                     ('gateway', '2001:db8:dead:c0::1'),
747                     ])),
748                 ]))]))]),
749             'return': [
750                 'auto eth19\n',
751                 'iface eth19 inet dhcp\n',
752                 'iface eth19 inet6 static\n',
753                 '    address 2001:db8:dead:c0::3/64\n',
754                 '    gateway 2001:db8:dead:c0::1\n',
755                 '\n']},
756         {'iface_name': 'eth20', 'iface_type': 'eth', 'enabled': True,
757             'build_interface': {
758                 'ipv6proto': 'static',
759                 'ipv6ipaddr': '2001:db8:dead:beef::3/64',
760                 'ipv6gateway': '2001:db8:dead:beef::1',
761                 'enable_ipv6': True,
762                 'autoconf': 1,
763                 'accept_ra': 2,
764                 'noifupdown': True,
765                 },
766             'get_interface': odict([('eth20', odict([('enabled', True), ('data', odict([
767                 ('inet6', odict([
768                     ('addrfam', 'inet6'),
769                     ('proto', 'static'),
770                     ('filename', None),
771                     ('autoconf', 1),
772                     ('address', '2001:db8:dead:beef::3/64'),
773                     ('gateway', '2001:db8:dead:beef::1'),
774                     ('accept_ra', 2),
775                     ])),
776                 ]))]))]),
777             'return': [
778                 'auto eth20\n',
779                 'iface eth20 inet6 static\n',
780                 '    autoconf 1\n',
781                 '    address 2001:db8:dead:beef::3/64\n',
782                 '    gateway 2001:db8:dead:beef::1\n',
783                 '    accept_ra 2\n',
784                 '\n']},
785         ]
786 @skipIf(salt.utils.platform.is_windows(), "Do not run these tests on Windows")
787 class DebianIpTestCase(TestCase, LoaderModuleMockMixin):
788     def setup_loader_modules(self):
789         return {debian_ip: {}}
790     def test_build_bond(self):
791 <a name="0"></a>        with patch(
792             "salt.modules.debian_ip._parse_settings_bond", MagicMock(return_value={})
793         ), patch("salt.modules.debian_ip._write_file", MagicMock(return_value=True)):
794             mock <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=1)
795             with patch.dict(debian_ip.__grains__, {"osrelease": mock}):
796                 mock = MagicMock(return_value=True)
797                 with patch.dict(
798                     debian_ip.__salt__, {"kmod.load"</b></font>: mock, "pkg.install": mock}
799                 ):
800                     self.assertEqual(debian_ip.build_bond("bond0"), "")
801     def test_error_message_iface_should_process_non_str_expected(self):
802         values = [1, True, False, "no-kaboom"]
803         iface = "ethtest"
804         option = "test"
805         msg = debian_ip._error_msg_iface(iface, option, values)
806         self.assertTrue(msg.endswith("[1|True|False|no-kaboom]"), msg)
807     def test_error_message_network_should_process_non_str_expected(self):
808         values = [1, True, False, "no-kaboom"]
809         msg = debian_ip._error_msg_network("fnord", values)
810         self.assertTrue(msg.endswith("[1|True|False|no-kaboom]"), msg)
811     def test_build_bond_exception(self):
812         with patch(
813             "salt.modules.debian_ip._parse_settings_bond", MagicMock(return_value={})
814         ):
815             mock = MagicMock(return_value=1)
816             with patch.dict(debian_ip.__grains__, {"osrelease": mock}):
817                 mock = MagicMock(
818                     side_effect=jinja2.exceptions.TemplateNotFound("error")
819                 )
820                 with patch.object(jinja2.Environment, "get_template", mock):
821                     self.assertEqual(debian_ip.build_bond("bond0"), "")
822     def test_build_bond_data(self):
823         with patch(
824             "salt.modules.debian_ip._parse_settings_bond", MagicMock(return_value={})
825         ), patch("salt.modules.debian_ip._read_temp", MagicMock(return_value=True)):
826             mock = MagicMock(return_value=1)
827             with patch.dict(debian_ip.__grains__, {"osrelease": mock}):
828                 self.assertTrue(debian_ip.build_bond("bond0", test="True"))
829     def test_build_routes(self):
830         with patch(
831             "salt.modules.debian_ip._parse_routes",
832             MagicMock(return_value={"routes": []}),
833         ), patch(
834             "salt.modules.debian_ip._write_file_routes", MagicMock(return_value=True)
835         ), patch(
836             "salt.modules.debian_ip._read_file", MagicMock(return_value="salt")
837         ):
838             self.assertEqual(debian_ip.build_routes("eth0"), "saltsalt")
839     def test_build_routes_exception(self):
840         with patch(
841             "salt.modules.debian_ip._parse_routes",
842             MagicMock(return_value={"routes": []}),
843         ):
844             self.assertTrue(debian_ip.build_routes("eth0", test="True"))
845             mock = MagicMock(side_effect=jinja2.exceptions.TemplateNotFound("err"))
846             with patch.object(jinja2.Environment, "get_template", mock):
847                 self.assertEqual(debian_ip.build_routes("eth0"), "")
848     def test_down(self):
849         self.assertEqual(debian_ip.down("eth0", "slave"), None)
850         mock = MagicMock(return_value="Salt")
851         with patch.dict(debian_ip.__salt__, {"cmd.run": mock}):
852             self.assertEqual(debian_ip.down("eth0", "eth"), "Salt")
853     def test_get_bond(self):
854         self.assertEqual(debian_ip.get_bond("bond0"), "")
855     def test_parse_interfaces(self):
856         with tempfile.NamedTemporaryFile(mode="r", delete=True) as tfile:
857             for iface in test_interfaces:
858                 iname = iface["iface_name"]
859                 if iface.get("skip_test", False):
860                     continue
861                 with salt.utils.files.fopen(str(tfile.name), "w") as fh:
862                     fh.writelines(iface["return"])
863                 for inet in ["inet", "inet6"]:
864                     if inet in iface["get_interface"][iname]["data"]:
865                         iface["get_interface"][iname]["data"][inet]["filename"] = str(
866                             tfile.name
867                         )
868                 self.assertDictEqual(
869                     debian_ip._parse_interfaces([str(tfile.name)]),
870                     iface["get_interface"],
871                 )
872     def test_get_interface(self):
873         for iface in test_interfaces:
874             if iface.get("skip_test", False):
875                 continue
876             with patch.object(
877                 debian_ip,
878                 "_parse_interfaces",
879                 MagicMock(return_value=iface["get_interface"]),
880             ):
881                 self.assertListEqual(
882                     debian_ip.get_interface(iface["iface_name"]), iface["return"]
883                 )
884     def test_build_interface(self):
885         with patch(
886             "salt.modules.debian_ip._write_file_ifaces", MagicMock(return_value="salt")
887         ):
888             self.assertEqual(
889                 debian_ip.build_interface("eth0", "eth", "enabled"),
890                 ["s\n", "a\n", "l\n", "t\n"],
891             )
892             self.assertTrue(
893                 debian_ip.build_interface("eth0", "eth", "enabled", test="True")
894             )
895             with patch.object(
896                 debian_ip, "_parse_settings_eth", MagicMock(return_value={"routes": []})
897             ):
898                 for eth_t in ["bridge", "slave", "bond"]:
899                     self.assertRaises(
900                         AttributeError,
901                         debian_ip.build_interface,
902                         "eth0",
903                         eth_t,
904                         "enabled",
905                     )
906             self.assertTrue(
907                 debian_ip.build_interface("eth0", "eth", "enabled", test="True")
908             )
909         with tempfile.NamedTemporaryFile(mode="r", delete=True) as tfile:
910             with patch("salt.modules.debian_ip._DEB_NETWORK_FILE", str(tfile.name)):
911                 for iface in test_interfaces:
912                     if iface.get("skip_test", False):
913                         continue
914                     if iface["iface_type"] in ["bridge", "pppoe", "vlan"]:
915                         continue
916                     self.assertListEqual(
917                         debian_ip.build_interface(
918                             iface=iface["iface_name"],
919                             iface_type=iface["iface_type"],
920                             enabled=iface["enabled"],
921                             interface_file=tfile.name,
922                             **iface["build_interface"]
923                         ),
924                         iface["return"],
925                     )
926     def test_up(self):
927         self.assertEqual(debian_ip.down("eth0", "slave"), None)
928         mock = MagicMock(return_value="Salt")
929         with patch.dict(debian_ip.__salt__, {"cmd.run": mock}):
930             self.assertEqual(debian_ip.up("eth0", "eth"), "Salt")
931     def test_get_network_settings(self):
932         with patch.dict(
933             debian_ip.__grains__, {"osfullname": "Ubuntu", "osrelease": "14"}
934         ), patch(
935             "salt.modules.debian_ip._parse_hostname",
936             MagicMock(return_value="SaltStack"),
937         ), patch(
938             "salt.modules.debian_ip._parse_domainname",
939             MagicMock(return_value="saltstack.com"),
940         ):
941             mock_avai = MagicMock(return_value=True)
942             with patch.dict(
943                 debian_ip.__salt__,
944                 {"service.available": mock_avai, "service.status": mock_avai},
945             ):
946                 self.assertEqual(
947                     debian_ip.get_network_settings(),
948                     [
949                         "NETWORKING=yes\n",
950                         "HOSTNAME=SaltStack\n",
951                         "DOMAIN=saltstack.com\n",
952                     ],
953                 )
954                 mock = MagicMock(
955                     side_effect=jinja2.exceptions.TemplateNotFound("error")
956                 )
957                 with patch.object(jinja2.Environment, "get_template", mock):
958                     self.assertEqual(debian_ip.get_network_settings(), "")
959     def test_get_routes(self):
960         with patch("salt.modules.debian_ip._read_file", MagicMock(return_value="salt")):
961             self.assertEqual(debian_ip.get_routes("eth0"), "saltsalt")
962     @pytest.mark.slow_test
963     def test_apply_network_settings(self):
964         mock = MagicMock(return_value=True)
965         with patch.dict(
966             debian_ip.__salt__,
967             {"network.mod_hostname": mock, "service.stop": mock, "service.start": mock},
968         ):
969             self.assertEqual(debian_ip.apply_network_settings(), True)
970     def test_build_network_settings(self):
971         with patch(
972             "salt.modules.debian_ip._parse_network_settings",
973             MagicMock(
974                 return_value={
975                     "networking": "yes",
976                     "hostname": "Salt.saltstack.com",
977                     "domainname": "saltstack.com",
978                     "search": "test.saltstack.com",
979                 }
980             ),
981 <a name="2"></a>        ), patch(
982             "salt.modules.debian_ip._write_file_network", MagicMock(return_value=True)
983         ):
984             <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
985                 debian_ip.__grains__, {"osfullname": "Ubuntu", "osrelease": "14"}
986             ):
987                 mock = MagicMock(return_value=True)
988                 with patch.dict(
989                     debian_ip.__salt__,
990                     {
991                         "service.available"</b></font>: mock,
992                         "service.disable": mock,
993                         "service.enable": mock,
994                     },
995                 ):
996                     self.assertEqual(
997                         debian_ip.build_network_settings(),
998                         [
999                             "NETWORKING=yes\n",
1000                             "HOSTNAME=Salt\n",
1001                             "DOMAIN=saltstack.com\n",
1002                             "SEARCH=test.saltstack.com\n",
1003                         ],
1004                     )
1005                     mock = MagicMock(
1006                         side_effect=jinja2.exceptions.TemplateNotFound("error")
1007                     )
1008 <a name="1"></a>                    with patch.object(jinja2.Environment, "get_template", mock):
1009                         self.assertEqual(debian_ip.build_network_settings(), "")
1010             <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
1011                 debian_ip.__grains__, {"osfullname": "Ubuntu", "osrelease": "10"}
1012             ):
1013                 mock = MagicMock(return_value=True)
1014                 with patch.dict(
1015                     debian_ip.__salt__,
1016                     {
1017                         "service.available"</b></font>: mock,
1018                         "service.disable": mock,
1019                         "service.enable": mock,
1020                     },
1021                 ):
1022                     mock = MagicMock(
1023                         side_effect=jinja2.exceptions.TemplateNotFound("error")
1024                     )
1025                     with patch.object(jinja2.Environment, "get_template", mock):
1026                         self.assertEqual(debian_ip.build_network_settings(), "")
1027                     with patch.object(
1028                         debian_ip, "_read_temp", MagicMock(return_value=True)
1029                     ):
1030                         self.assertTrue(debian_ip.build_network_settings(test="True"))
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_sysctl.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import pytest
2 import salt.states.sysctl as sysctl
3 from salt.exceptions import CommandExecutionError
4 from tests.support.mock import MagicMock, patch
5 @pytest.fixture
6 def configure_loader_modules():
7     return {sysctl: {}}
8 def test_empty_config_file_and_value_not_found():
9     name = "some.unknown.oid"
10     value = "1"
11     comment = "Sysctl option {} would be changed to {}".format(name, value)
12 <a name="0"></a>    ret = {"name": name, "result": None, "changes": {}, "comment": comment}
13     with patch.dict(sysctl.__opts__, {"test": True}):
14         mock_show <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value={})
15         with patch.dict(sysctl.__salt__, {"sysctl.show": mock_show}):
16             mock_get = MagicMock(return_value="")
17             with patch.dict(sysctl.__salt__, {"sysctl.get"</b></font>: mock_get}):
18                 assert sysctl.present(name, value) == ret
19 def test_inaccessible_config_file():
20     name = "some.unknown.oid"
21     value = "1"
22     config = "/etc/sysctl.conf"
23     comment = (
24         "Sysctl option {} might be changed, we failed to check "
25         "config file at {}. The file is either unreadable, or "
26         "missing.".format(name, config)
27 <a name="2"></a>    )
28     ret = {"name": name, "result": None, "changes": {}, "comment": comment}
29     <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(sysctl.__opts__, {"test": True}):
30         mock = MagicMock(return_value=None)
31         with patch.dict(sysctl.__salt__, {"sysctl.show"</b></font>: mock}):
32             assert sysctl.present(name, value) == ret
33 def test_to_be_changed_not_configured():
34     name = "vfs.usermount"
35     value = "1"
36     comment = "Sysctl option {} set to be changed to {}".format(name, value)
37     ret = {"name": name, "result": None, "changes": {}, "comment": comment}
38     def mock_current(config_file=None):
39         if config_file is None:
40             return {name: "0"}
41 <a name="1"></a>        return {}
42     with patch.dict(sysctl.__opts__, {"test": True}):
43         <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(sysctl.__salt__, {"sysctl.show": mock_current}):
44             mock_get = MagicMock(return_value="0")
45             with patch.dict(sysctl.__salt__, {"sysctl.get"</b></font>: mock_get}):
46                 assert sysctl.present(name, value) == ret
47 def test_not_to_be_changed_not_configured():
48     name = "some.unknown.oid"
49     value = "1"
50     comment = (
51         "Sysctl value is currently set on the running system but "
52         "not in a config file. Sysctl option {} set to be "
53         "changed to 1 in config file.".format(name)
54     )
55     ret = {"name": name, "result": None, "changes": {}, "comment": comment}
56     def mock_current(config_file=None):
57         if config_file is None:
58             return {name: value}
59         return {}
60     with patch.dict(sysctl.__opts__, {"test": True}):
61         with patch.dict(sysctl.__salt__, {"sysctl.show": mock_current}):
62             mock_get = MagicMock(return_value=value)
63             with patch.dict(sysctl.__salt__, {"sysctl.get": mock_get}):
64                 assert sysctl.present(name, value) == ret
65 def test_configured_but_unknown():
66     name = "vfs.usermount"
67     value = "1"
68     comment = (
69         "Sysctl value {0} is present in configuration file but is not "
70         "present in the running config. The value {0} is set to be "
71         "changed to {1}".format(name, value)
72     )
73     ret = {"name": name, "result": None, "changes": {}, "comment": comment}
74     def mock_config(config_file=None):
75         if config_file is None:
76             return {}
77         return {name: value}
78     with patch.dict(sysctl.__opts__, {"test": True}):
79         with patch.dict(sysctl.__salt__, {"sysctl.show": mock_config}):
80             mock_get = MagicMock(return_value="")
81             with patch.dict(sysctl.__salt__, {"sysctl.get": mock_get}):
82                 assert sysctl.present(name, value) == ret
83 def test_no_change():
84     name = "vfs.usermount"
85     value = "1"
86     comment = "Sysctl value {} = {} is already set".format(name, value)
87     ret = {"name": name, "result": True, "changes": {}, "comment": comment}
88     def mock_config(config_file=None):
89         if config_file is None:
90             return {}
91         return {name: value}
92     with patch.dict(sysctl.__opts__, {"test": True}):
93         with patch.dict(sysctl.__salt__, {"sysctl.show": mock_config}):
94             mock_get = MagicMock(return_value=value)
95             with patch.dict(sysctl.__salt__, {"sysctl.get": mock_get}):
96                 assert sysctl.present(name, value) == ret
97 def test_change():
98     name = "vfs.usermount"
99     old_value = "2"
100     value = "1"
101     comment = "Sysctl option {} would be changed to {}".format(name, value)
102     ret = {"name": name, "result": None, "changes": {}, "comment": comment}
103     def mock_config(config_file=None):
104         if config_file is None:
105             return {name: old_value}
106         return {name: old_value}
107     with patch.dict(sysctl.__opts__, {"test": True}):
108         with patch.dict(sysctl.__salt__, {"sysctl.show": mock_config}):
109             mock_get = MagicMock(return_value=old_value)
110             with patch.dict(sysctl.__salt__, {"sysctl.get": mock_get}):
111                 assert sysctl.present(name, value) == ret
112 def test_failed_to_set():
113     name = "net.isr.maxthreads"
114     value = "8"
115     comment = "Failed to set {} to {}: ".format(name, value)
116     ret = {"name": name, "result": False, "changes": {}, "comment": comment}
117     with patch.dict(sysctl.__opts__, {"test": False}):
118         mock = MagicMock(side_effect=CommandExecutionError)
119         with patch.dict(sysctl.__salt__, {"sysctl.persist": mock}):
120             assert sysctl.present(name, value) == ret
121 def test_already_set():
122     name = "vfs.usermount"
123     value = "1"
124     comment = "Sysctl value {} = {} is already set".format(name, value)
125     ret = {"name": name, "result": True, "changes": {}, "comment": comment}
126     with patch.dict(sysctl.__opts__, {"test": False}):
127         mock = MagicMock(return_value="Already set")
128         with patch.dict(sysctl.__salt__, {"sysctl.persist": mock}):
129             assert sysctl.present(name, value) == ret
130 def test_updated():
131     name = "vfs.usermount"
132     value = "1"
133     comment = "Updated sysctl value {} = {}".format(name, value)
134     changes = {name: value}
135     ret = {"name": name, "result": True, "changes": changes, "comment": comment}
136     with patch.dict(sysctl.__opts__, {"test": False}):
137         mock = MagicMock(return_value="Updated")
138         with patch.dict(sysctl.__salt__, {"sysctl.persist": mock}):
139             assert sysctl.present(name, value) == ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
