<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for yandexvideo.py &amp; qqmusic.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for yandexvideo.py &amp; qqmusic.py
      </h3>
<h1 align="center">
        4.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>yandexvideo.py (9.022556%)<th>qqmusic.py (3.2432432%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(40-68)<td><a href="#" name="0">(278-307)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>yandexvideo.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 from .common import InfoExtractor
3 from ..utils import (
4     determine_ext,
5     int_or_none,
6     try_get,
7     url_or_none,
8 )
9 class YandexVideoIE(InfoExtractor):
10     _VALID_URL = r'''(?x)
11                     https?://
12                         (?:
13                             yandex\.ru(?:/(?:portal/(?:video|efir)|efir))?/?\?.*?stream_id=|
14                             frontend\.vh\.yandex\.ru/player/
15                         )
16                         (?P&lt;id&gt;(?:[\da-f]{32}|[\w-]{12}))
17                     '''
18     _TESTS = [{
19         'url': 'https://yandex.ru/portal/video?stream_id=4dbb36ec4e0526d58f9f2dc8f0ecf374',
20         'md5': 'e02a05bfaf0d9615ef07ae3a10f4faf4',
21         'info_dict': {
22             'id': '4dbb36ec4e0526d58f9f2dc8f0ecf374',
23             'ext': 'mp4',
24             'title': 'Русский Вудсток - главный рок-фест в истории СССР / вДудь',
25             'description': 'md5:7d6b8d4bc4a3b9a56499916c1ea5b5fa',
26             'thumbnail': r're:^https?://',
27             'timestamp': 1549972939,
28             'duration': 5575,
29             'age_limit': 18,
30             'upload_date': '20190212',
31             'view_count': int,
32             'like_count': int,
33         },
34     }, {
35         <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>'url': 'https://yandex.ru/portal/efir?stream_id=4dbb262b4fe5cf15a215de4f34eee34d&amp;from=morda',
36         'only_matching': True,
37     }, {
38         'url': 'https://yandex.ru/?stream_id=4dbb262b4fe5cf15a215de4f34eee34d',
39         'only_matching': True,
40     }, {
41         'url': 'https://frontend.vh.yandex.ru/player/4dbb262b4fe5cf15a215de4f34eee34d?from=morda',
42         'only_matching': True,
43     }, {
44         'url': 'https://yandex.ru/portal/video?stream_id=45b11db6e4b68797919c93751a938cee',
45         'only_matching': True,
46     }, {
47         'url': 'https://yandex.ru/?stream_channel=1538487871&amp;stream_id=4132a07f71fb0396be93d74b3477131d',
48         'only_matching': True,
49     }, {
50         'url': 'https://yandex.ru/portal/video?from=morda&amp;stream_id=485a92d94518d73a9d0ff778e13505f8',
51         'only_matching': True,
52     }, {
53         'url': 'https://yandex.ru/efir?stream_active=watching&amp;stream_id=v7a2dZ-v5mSI&amp;from_block=efir_newtab',
54         'only_matching': True,
55     }]
56     def _real_extract(self, url):
57         video_id = self._match_id(url)
58         player =</b></font> try_get((self._download_json(
59             'https://frontend.vh.yandex.ru/graphql', video_id, data=('''{
60   player(content_id: "%s") {
61     computed_title
62     content_url
63     description
64     dislikes
65     duration
66     likes
67     program_title
68     release_date
69     release_date_ut
70     release_year
71     restriction_age
72     season
73     start_time
74     streams
75     thumbnail
76     title
77     views_count
78   }
79 }''' % video_id).encode(), fatal=False)), lambda x: x['player']['content'])
80         if not player or player.get('error'):
81             player = self._download_json(
82                 'https://frontend.vh.yandex.ru/v23/player/%s.json' % video_id,
83                 video_id, query={
84                     'stream_options': 'hires',
85                     'disable_trackings': 1,
86                 })
87         content = player['content']
88         title = content.get('title') or content['computed_title']
89         formats = []
90         streams = content.get('streams') or []
91         streams.append({'url': content.get('content_url')})
92         for stream in streams:
93             content_url = url_or_none(stream.get('url'))
94             if not content_url:
95                 continue
96             ext = determine_ext(content_url)
97             if ext == 'ismc':
98                 continue
99             elif ext == 'm3u8':
100                 formats.extend(self._extract_m3u8_formats(
101                     content_url, video_id, 'mp4',
102                     'm3u8_native', m3u8_id='hls', fatal=False))
103             elif ext == 'mpd':
104                 formats.extend(self._extract_mpd_formats(
105                     content_url, video_id, mpd_id='dash', fatal=False))
106             else:
107                 formats.append({'url': content_url})
108         self._sort_formats(formats)
109         timestamp = (int_or_none(content.get('release_date'))
110                      or int_or_none(content.get('release_date_ut'))
111                      or int_or_none(content.get('start_time')))
112         season = content.get('season') or {}
113         return {
114             'id': video_id,
115             'title': title,
116             'description': content.get('description'),
117             'thumbnail': content.get('thumbnail'),
118             'timestamp': timestamp,
119             'duration': int_or_none(content.get('duration')),
120             'series': content.get('program_title'),
121             'age_limit': int_or_none(content.get('restriction_age')),
122             'view_count': int_or_none(content.get('views_count')),
123             'like_count': int_or_none(content.get('likes')),
124             'dislike_count': int_or_none(content.get('dislikes')),
125             'season_number': int_or_none(season.get('season_number')),
126             'season_id': season.get('id'),
127             'release_year': int_or_none(content.get('release_year')),
128             'formats': formats,
129         }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>qqmusic.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 import random
3 import re
4 import time
5 from .common import InfoExtractor
6 from ..utils import (
7     clean_html,
8     ExtractorError,
9     strip_jsonp,
10     unescapeHTML,
11 )
12 class QQMusicIE(InfoExtractor):
13     IE_NAME = 'qqmusic'
14     IE_DESC = 'QQ音乐'
15     _VALID_URL = r'https?://y\.qq\.com/n/yqq/song/(?P&lt;id&gt;[0-9A-Za-z]+)\.html'
16     _TESTS = [{
17         'url': 'https://y.qq.com/n/yqq/song/004295Et37taLD.html',
18         'md5': '5f1e6cea39e182857da7ffc5ef5e6bb8',
19         'info_dict': {
20             'id': '004295Et37taLD',
21             'ext': 'mp3',
22             'title': '可惜没如果',
23             'release_date': '20141227',
24             'creator': '林俊杰',
25             'description': 'md5:d85afb3051952ecc50a1ee8a286d1eac',
26             'thumbnail': r're:^https?://.*\.jpg$',
27         }
28     }, {
29         'note': 'There is no mp3-320 version of this song.',
30         'url': 'https://y.qq.com/n/yqq/song/004MsGEo3DdNxV.html',
31         'md5': 'fa3926f0c585cda0af8fa4f796482e3e',
32         'info_dict': {
33             'id': '004MsGEo3DdNxV',
34             'ext': 'mp3',
35             'title': '如果',
36             'release_date': '20050626',
37             'creator': '李季美',
38             'description': 'md5:46857d5ed62bc4ba84607a805dccf437',
39             'thumbnail': r're:^https?://.*\.jpg$',
40         }
41     }, {
42         'note': 'lyrics not in .lrc format',
43         'url': 'https://y.qq.com/n/yqq/song/001JyApY11tIp6.html',
44         'info_dict': {
45             'id': '001JyApY11tIp6',
46             'ext': 'mp3',
47             'title': 'Shadows Over Transylvania',
48             'release_date': '19970225',
49             'creator': 'Dark Funeral',
50             'description': 'md5:c9b20210587cbcd6836a1c597bab4525',
51             'thumbnail': r're:^https?://.*\.jpg$',
52         },
53         'params': {
54             'skip_download': True,
55         },
56     }]
57     _FORMATS = {
58         'mp3-320': {'prefix': 'M800', 'ext': 'mp3', 'preference': 40, 'abr': 320},
59         'mp3-128': {'prefix': 'M500', 'ext': 'mp3', 'preference': 30, 'abr': 128},
60         'm4a': {'prefix': 'C200', 'ext': 'm4a', 'preference': 10}
61     }
62     @staticmethod
63     def m_r_get_ruin():
64         curMs = int(time.time() * 1000) % 1000
65         return int(round(random.random() * 2147483647) * curMs % 1E10)
66     def _real_extract(self, url):
67         mid = self._match_id(url)
68         detail_info_page = self._download_webpage(
69             'http://s.plcloud.music.qq.com/fcgi-bin/fcg_yqq_song_detail_info.fcg?songmid=%s&amp;play=0' % mid,
70             mid, note='Download song detail info',
71             errnote='Unable to get song detail info', encoding='gbk')
72         song_name = self._html_search_regex(
73             r"songname:\s*'([^']+)'", detail_info_page, 'song name')
74         publish_time = self._html_search_regex(
75             r'发行时间：(\d{4}-\d{2}-\d{2})', detail_info_page,
76             'publish time', default=None)
77         if publish_time:
78             publish_time = publish_time.replace('-', '')
79         singer = self._html_search_regex(
80             r"singer:\s*'([^']+)", detail_info_page, 'singer', default=None)
81         lrc_content = self._html_search_regex(
82             r'&lt;div class="content" id="lrc_content"[^&lt;&gt;]*&gt;([^&lt;&gt;]+)&lt;/div&gt;',
83             detail_info_page, 'LRC lyrics', default=None)
84         if lrc_content:
85             lrc_content = lrc_content.replace('\\n', '\n')
86         thumbnail_url = None
87         albummid = self._search_regex(
88             [r'albummid:\'([0-9a-zA-Z]+)\'', r'"albummid":"([0-9a-zA-Z]+)"'],
89             detail_info_page, 'album mid', default=None)
90         if albummid:
91             thumbnail_url = 'http://i.gtimg.cn/music/photo/mid_album_500/%s/%s/%s.jpg' \
92                             % (albummid[-2:-1], albummid[-1], albummid)
93         guid = self.m_r_get_ruin()
94         vkey = self._download_json(
95             'http://base.music.qq.com/fcgi-bin/fcg_musicexpress.fcg?json=3&amp;guid=%s' % guid,
96             mid, note='Retrieve vkey', errnote='Unable to get vkey',
97             transform_source=strip_jsonp)['key']
98         formats = []
99         for format_id, details in self._FORMATS.items():
100             formats.append({
101                 'url': 'http://cc.stream.qqmusic.qq.com/%s%s.%s?vkey=%s&amp;guid=%s&amp;fromtag=0'
102                        % (details['prefix'], mid, details['ext'], vkey, guid),
103                 'format': format_id,
104                 'format_id': format_id,
105                 'preference': details['preference'],
106                 'abr': details.get('abr'),
107             })
108         self._check_formats(formats, mid)
109         self._sort_formats(formats)
110         actual_lrc_lyrics = ''.join(
111             line + '\n' for line in re.findall(
112                 r'(?m)^(\[[0-9]{2}:[0-9]{2}(?:\.[0-9]{2,})?\][^\n]*|\[[^\]]*\])', lrc_content))
113         info_dict = {
114             'id': mid,
115             'formats': formats,
116             'title': song_name,
117             'release_date': publish_time,
118             'creator': singer,
119             'description': lrc_content,
120             'thumbnail': thumbnail_url
121         }
122         if actual_lrc_lyrics:
123             info_dict['subtitles'] = {
124                 'origin': [{
125                     'ext': 'lrc',
126                     'data': actual_lrc_lyrics,
127                 }]
128             }
129         return info_dict
130 class QQPlaylistBaseIE(InfoExtractor):
131     @staticmethod
132     def qq_static_url(category, mid):
133         return 'http://y.qq.com/y/static/%s/%s/%s/%s.html' % (category, mid[-2], mid[-1], mid)
134     def get_singer_all_songs(self, singmid, num):
135         return self._download_webpage(
136             r'https://c.y.qq.com/v8/fcg-bin/fcg_v8_singer_track_cp.fcg', singmid,
137             query={
138                 'format': 'json',
139                 'inCharset': 'utf8',
140                 'outCharset': 'utf-8',
141                 'platform': 'yqq',
142                 'needNewCode': 0,
143                 'singermid': singmid,
144                 'order': 'listen',
145                 'begin': 0,
146                 'num': num,
147                 'songstatus': 1,
148             })
149     def get_entries_from_page(self, singmid):
150         entries = []
151         default_num = 1
152         json_text = self.get_singer_all_songs(singmid, default_num)
153         json_obj_all_songs = self._parse_json(json_text, singmid)
154         if json_obj_all_songs['code'] == 0:
155             total = json_obj_all_songs['data']['total']
156             json_text = self.get_singer_all_songs(singmid, total)
157             json_obj_all_songs = self._parse_json(json_text, singmid)
158         for item in json_obj_all_songs['data']['list']:
159             if item['musicData'].get('songmid') is not None:
160                 songmid = item['musicData']['songmid']
161                 entries.append(self.url_result(
162                     r'https://y.qq.com/n/yqq/song/%s.html' % songmid, 'QQMusic', songmid))
163         return entries
164 class QQMusicSingerIE(QQPlaylistBaseIE):
165     IE_NAME = 'qqmusic:singer'
166     IE_DESC = 'QQ音乐 - 歌手'
167     _VALID_URL = r'https?://y\.qq\.com/n/yqq/singer/(?P&lt;id&gt;[0-9A-Za-z]+)\.html'
168     _TEST = {
169         'url': 'https://y.qq.com/n/yqq/singer/001BLpXF2DyJe2.html',
170         'info_dict': {
171             'id': '001BLpXF2DyJe2',
172             'title': '林俊杰',
173             'description': 'md5:870ec08f7d8547c29c93010899103751',
174         },
175         'playlist_mincount': 12,
176     }
177     def _real_extract(self, url):
178         mid = self._match_id(url)
179         entries = self.get_entries_from_page(mid)
180         singer_page = self._download_webpage(url, mid, 'Download singer page')
181         singer_name = self._html_search_regex(
182             r"singername\s*:\s*'(.*?)'", singer_page, 'singer name', default=None)
183         singer_desc = None
184         if mid:
185             singer_desc_page = self._download_xml(
186                 'http://s.plcloud.music.qq.com/fcgi-bin/fcg_get_singer_desc.fcg', mid,
187                 'Donwload singer description XML',
188                 query={'utf8': 1, 'outCharset': 'utf-8', 'format': 'xml', 'singermid': mid},
189                 headers={'Referer': 'https://y.qq.com/n/yqq/singer/'})
190             singer_desc = singer_desc_page.find('./data/info/desc').text
191         return self.playlist_result(entries, mid, singer_name, singer_desc)
192 class QQMusicAlbumIE(QQPlaylistBaseIE):
193     IE_NAME = 'qqmusic:album'
194     IE_DESC = 'QQ音乐 - 专辑'
195     _VALID_URL = r'https?://y\.qq\.com/n/yqq/album/(?P&lt;id&gt;[0-9A-Za-z]+)\.html'
196     _TESTS = [{
197         'url': 'https://y.qq.com/n/yqq/album/000gXCTb2AhRR1.html',
198         'info_dict': {
199             'id': '000gXCTb2AhRR1',
200             'title': '我们都是这样长大的',
201             'description': 'md5:179c5dce203a5931970d306aa9607ea6',
202         },
203         'playlist_count': 4,
204     }, {
205         'url': 'https://y.qq.com/n/yqq/album/002Y5a3b3AlCu3.html',
206         'info_dict': {
207             'id': '002Y5a3b3AlCu3',
208             'title': '그리고...',
209             'description': 'md5:a48823755615508a95080e81b51ba729',
210         },
211         'playlist_count': 8,
212     }]
213     def _real_extract(self, url):
214         mid = self._match_id(url)
215         album = self._download_json(
216             'http://i.y.qq.com/v8/fcg-bin/fcg_v8_album_info_cp.fcg?albummid=%s&amp;format=json' % mid,
217             mid, 'Download album page')['data']
218         entries = [
219             self.url_result(
220                 'https://y.qq.com/n/yqq/song/' + song['songmid'] + '.html', 'QQMusic', song['songmid']
221             ) for song in album['list']
222         ]
223         album_name = album.get('name')
224         album_detail = album.get('desc')
225         if album_detail is not None:
226             album_detail = album_detail.strip()
227         return self.playlist_result(entries, mid, album_name, album_detail)
228 class QQMusicToplistIE(QQPlaylistBaseIE):
229     IE_NAME = 'qqmusic:toplist'
230     _VALID_URL = r'https?://y\.qq\.com/n/yqq/toplist/(?P&lt;id&gt;[0-9]+)\.html'
231     _TESTS = [<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>{
232         'url': 'https://y.qq.com/n/yqq/toplist/123.html',
233         'info_dict': {
234             'id': '123',
235             'title': '美国iTunes榜',
236             'description': 'md5:89db2335fdbb10678dee2d43fe9aba08',
237         },
238         'playlist_count': 100,
239     }, {
240         'url': 'https://y.qq.com/n/yqq/toplist/3.html',
241         'info_dict': {
242             'id': '3',
243             'title': '巅峰榜·欧美',
244             'description': 'md5:5a600d42c01696b26b71f8c4d43407da',
245         },
246         'playlist_count': 100,
247     }, {
248         'url': 'https://y.qq.com/n/yqq/toplist/106.html',
249         'info_dict': {
250             'id': '106',
251             'title': '韩国Mnet榜',
252             'description': 'md5:cb84b325215e1d21708c615cac82a6e7',
253         },
254         'playlist_count': 50,
255     }]
256     def _real_extract(self, url):
257         list_id = self._match_id(url)
258         toplist_json =</b></font> self._download_json(
259             'http://i.y.qq.com/v8/fcg-bin/fcg_v8_toplist_cp.fcg', list_id,
260             note='Download toplist page',
261             query={'type': 'toplist', 'topid': list_id, 'format': 'json'})
262         entries = [self.url_result(
263             'https://y.qq.com/n/yqq/song/' + song['data']['songmid'] + '.html', 'QQMusic',
264             song['data']['songmid'])
265             for song in toplist_json['songlist']]
266         topinfo = toplist_json.get('topinfo', {})
267         list_name = topinfo.get('ListName')
268         list_description = topinfo.get('info')
269         return self.playlist_result(entries, list_id, list_name, list_description)
270 class QQMusicPlaylistIE(QQPlaylistBaseIE):
271     IE_NAME = 'qqmusic:playlist'
272     IE_DESC = 'QQ音乐 - 歌单'
273     _VALID_URL = r'https?://y\.qq\.com/n/yqq/playlist/(?P&lt;id&gt;[0-9]+)\.html'
274     _TESTS = [{
275         'url': 'http://y.qq.com/n/yqq/playlist/3462654915.html',
276         'info_dict': {
277             'id': '3462654915',
278             'title': '韩国5月新歌精选下旬',
279             'description': 'md5:d2c9d758a96b9888cf4fe82f603121d4',
280         },
281         'playlist_count': 40,
282         'skip': 'playlist gone',
283     }, {
284         'url': 'https://y.qq.com/n/yqq/playlist/1374105607.html',
285         'info_dict': {
286             'id': '1374105607',
287             'title': '易入人心的华语民谣',
288             'description': '民谣的歌曲易于传唱、、歌词朗朗伤口、旋律简单温馨。属于那种才入耳孔。却上心头的感觉。没有太多的复杂情绪。简单而直接地表达乐者的情绪，就是这样的简单才易入人心。',
289         },
290         'playlist_count': 20,
291     }]
292     def _real_extract(self, url):
293         list_id = self._match_id(url)
294         list_json = self._download_json(
295             'http://i.y.qq.com/qzone-music/fcg-bin/fcg_ucc_getcdinfo_byids_cp.fcg',
296             list_id, 'Download list page',
297             query={'type': 1, 'json': 1, 'utf8': 1, 'onlysong': 0, 'disstid': list_id},
298             transform_source=strip_jsonp)
299         if not len(list_json.get('cdlist', [])):
300             if list_json.get('code'):
301                 raise ExtractorError(
302                     'QQ Music said: error %d in fetching playlist info' % list_json['code'],
303                     expected=True)
304             raise ExtractorError('Unable to get playlist info')
305         cdlist = list_json['cdlist'][0]
306         entries = [self.url_result(
307             'https://y.qq.com/n/yqq/song/' + song['songmid'] + '.html', 'QQMusic', song['songmid'])
308             for song in cdlist['songlist']]
309         list_name = cdlist.get('dissname')
310         list_description = clean_html(unescapeHTML(cdlist.get('desc')))
311         return self.playlist_result(entries, list_id, list_name, list_description)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
