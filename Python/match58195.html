<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_boto_route53.py &amp; test_elasticsearch.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_boto_route53.py &amp; test_elasticsearch.py
      </h3>
<h1 align="center">
        5.2%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_boto_route53.py (21.367521%)<th>test_elasticsearch.py (2.9620852%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(61-65)<td><a href="#" name="0">(61-72)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(45-55)<td><a href="#" name="1">(151-162)</a><td align="center"><font color="#eb0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_boto_route53.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import pytest
2 import salt.states.boto_route53 as boto_route53
3 from tests.support.mock import MagicMock, patch
4 @pytest.fixture
5 def configure_loader_modules():
6     return {boto_route53: {}}
7 def test_present():
8     name = "test.example.com."
9     value = "1.1.1.1"
10     zone = "example.com."
11     record_type = "A"
12     ret = {"name": name, "result": False, "changes": {}, "comment": ""}
13     mock = MagicMock(side_effect=[{}, {}, {"value": ""}, False])
14     mock_bool = MagicMock(return_value=False)
15     with patch.dict(
16         boto_route53.__salt__,
17         {"boto_route53.get_record": mock, "boto_route53.add_record": mock_bool},
18     ):
19         with patch.dict(boto_route53.__opts__, {"test": False}):
20             comt = "Failed to add {} Route53 record.".format(name)
21             ret.update({"comment": comt})
22             assert boto_route53.present(name, value, zone, record_type) == ret
23         with patch.dict(boto_route53.__opts__, {"test": True}):
24             comt = "Route53 record {} set to be added.".format(name)
25             ret.update({"comment": comt, "result": None})
26             assert boto_route53.present(name, value, zone, record_type) == ret
27             comt = "Route53 record {} set to be updated.".format(name)
28 <a name="1"></a>            ret.update({"comment": comt})
29             assert boto_route53.present(name, value, zone, record_type) == ret
30         ret<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.update({"comment": "", "result": True})
31         assert boto_route53.present(name, value, zone, record_type) == ret
32 def test_absent():
33     name = "test.example.com."
34     zone = "example.com."
35     record_type =</b></font> "A"
36     ret = {"name": name, "result": True, "changes": {}, "comment": ""}
37 <a name="0"></a>
38     mock = MagicMock(side_effect=[False, True])
39     with patch.dict(boto_route53.__salt__, {"boto_route53.get_record": mock}):
40         comt = "{} does not exist."<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(name)
41         ret.update({"comment": comt})
42         assert boto_route53.absent(name, zone, record_type) == ret
43         with patch.dict(boto_route53.__opts__, {"test"</b></font>: True}):
44             comt = "Route53 record {} set to be deleted.".format(name)
45             ret.update({"comment": comt, "result": None})
46             assert boto_route53.absent(name, zone, record_type) == ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_elasticsearch.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import pytest
2 import salt.utils.dictdiffer as dictdiffer
3 from salt.exceptions import CommandExecutionError
4 from salt.states import elasticsearch
5 from tests.support.mock import MagicMock, patch
6 @pytest.fixture
7 def configure_loader_modules():
8     return {
9         elasticsearch: {
10             "__opts__": {"test": False},
11             "__utils__": {"dictdiffer.deep_diff": dictdiffer.deep_diff},
12         }
13     }
14 def test_index_absent():
15     name = "foo"
16     ret = {
17         "name": name,
18         "result": True,
19         "comment": "Index foo is already absent",
20         "changes": {},
21     }
22     mock_get = MagicMock(
23         side_effect=[
24             None,
25             {name: {"test": "key"}},
26             {name: {}},
27             {name: {"test": "key"}},
28             CommandExecutionError,
29             {name: {"test": "key"}},
30         ]
31     )
32     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
33     with patch.dict(
34         elasticsearch.__salt__,
35         {
36             "elasticsearch.index_get": mock_get,
37             "elasticsearch.index_delete": mock_delete,
38         },
39     ):
40         assert elasticsearch.index_absent(name) == ret
41         ret.update(
42             {
43                 "comment": "Successfully removed index foo",
44 <a name="0"></a>                "changes": {"old": {"test": "key"}},
45             }
46         )
47         assert elasticsearch<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.index_absent(name) == ret
48         ret.update(
49             {
50                 "comment": "Failed to remove index foo for unknown reasons",
51                 "result": False,
52                 "changes": {},
53             }
54         )
55         assert elasticsearch.index_absent(name) == ret
56         with patch.dict(elasticsearch.__opts__, {"test"</b></font>: True}):
57             ret.update(
58                 {
59                     "comment": "Index foo will be removed",
60                     "result": None,
61                     "changes": {"old": {"test": "key"}},
62                 }
63             )
64             assert elasticsearch.index_absent(name) == ret
65         ret.update({"comment": "", "result": False, "changes": {}})
66         assert elasticsearch.index_absent(name) == ret
67         ret.update({"comment": "", "result": False, "changes": {}})
68         assert elasticsearch.index_absent(name) == ret
69 def test_index_present():
70     name = "foo"
71     ret = {
72         "name": name,
73         "result": True,
74         "comment": "Index foo is already present",
75         "changes": {},
76     }
77     mock_exists = MagicMock(
78         side_effect=[True, False, False, False, CommandExecutionError, False, False]
79     )
80     mock_get = MagicMock(side_effect=[{name: {"test": "key"}}, CommandExecutionError])
81     mock_create = MagicMock(side_effect=[True, False, CommandExecutionError, True])
82     with patch.dict(
83         elasticsearch.__salt__,
84         {
85             "elasticsearch.index_get": mock_get,
86             "elasticsearch.index_exists": mock_exists,
87             "elasticsearch.index_create": mock_create,
88         },
89     ):
90         assert elasticsearch.index_present(name) == ret
91         ret.update(
92             {
93                 "comment": "Successfully created index foo",
94                 "changes": {"new": {"test": "key"}},
95             }
96         )
97         assert elasticsearch.index_present(name) == ret
98         ret.update(
99             {
100                 "comment": "Cannot create index foo, False",
101                 "result": False,
102                 "changes": {},
103             }
104         )
105         assert elasticsearch.index_present(name) == ret
106         with patch.dict(elasticsearch.__opts__, {"test": True}):
107             ret.update(
108                 {
109                     "comment": "Index foo does not exist and will be created",
110                     "result": None,
111                     "changes": {"new": {"test2": "key"}},
112                 }
113             )
114             assert elasticsearch.index_present(name, {"test2": "key"}) == ret
115         ret.update({"comment": "", "result": False, "changes": {}})
116         assert elasticsearch.index_absent(name) == ret
117 <a name="1"></a>        ret.update({"comment": "", "result": False, "changes": {}})
118         assert elasticsearch.index_absent(name) == ret
119         ret<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.update({"comment": "", "result": False, "changes": {}})
120         assert elasticsearch.index_absent(name) == ret
121 def test_alias_absent():
122     name = "foo"
123     index = "bar"
124     alias =</b></font> {index: {"aliases": {name: {"test": "key"}}}}
125     ret = {
126         "name": name,
127         "result": True,
128         "comment": "Alias foo for index bar is already absent",
129         "changes": {},
130     }
131     mock_get = MagicMock(
132         side_effect=[
133             None,
134             {"foo2": {}},
135             alias,
136             alias,
137             alias,
138             CommandExecutionError,
139             alias,
140         ]
141     )
142     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
143     with patch.dict(
144         elasticsearch.__salt__,
145         {
146             "elasticsearch.alias_get": mock_get,
147             "elasticsearch.alias_delete": mock_delete,
148         },
149     ):
150         assert elasticsearch.alias_absent(name, index) == ret
151         assert elasticsearch.alias_absent(name, index) == ret
152         ret.update(
153             {
154                 "comment": "Successfully removed alias foo for index bar",
155                 "changes": {"old": {"test": "key"}},
156             }
157         )
158         assert elasticsearch.alias_absent(name, index) == ret
159         ret.update(
160             {
161                 "comment": (
162                     "Failed to remove alias foo for index bar for unknown reasons"
163                 ),
164                 "result": False,
165                 "changes": {},
166             }
167         )
168         assert elasticsearch.alias_absent(name, index) == ret
169         with patch.dict(elasticsearch.__opts__, {"test": True}):
170             ret.update(
171                 {
172                     "comment": "Alias foo for index bar will be removed",
173                     "result": None,
174                     "changes": {"old": {"test": "key"}},
175                 }
176             )
177             assert elasticsearch.alias_absent(name, index) == ret
178         ret.update({"comment": "", "result": False, "changes": {}})
179         assert elasticsearch.alias_absent(name, index) == ret
180         ret.update({"comment": "", "result": False, "changes": {}})
181         assert elasticsearch.alias_absent(name, index) == ret
182 def test_alias_present():
183     name = "foo"
184     index = "bar"
185     alias = {index: {"aliases": {name: {"test": "key"}}}}
186     ret = {
187         "name": name,
188         "result": True,
189         "comment": "Alias foo for index bar is already present",
190         "changes": {},
191     }
192     mock_get = MagicMock(
193         side_effect=[
194             alias,
195             alias,
196             None,
197             None,
198             None,
199             alias,
200             CommandExecutionError,
201             None,
202         ]
203     )
204     mock_create = MagicMock(side_effect=[True, True, False, CommandExecutionError])
205     with patch.dict(
206         elasticsearch.__salt__,
207         {
208             "elasticsearch.alias_get": mock_get,
209             "elasticsearch.alias_create": mock_create,
210         },
211     ):
212         assert elasticsearch.alias_present(name, index, {"test": "key"}) == ret
213         ret.update(
214             {
215                 "comment": "Successfully replaced alias foo for index bar",
216                 "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
217             }
218         )
219         assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
220         ret.update(
221             {
222                 "comment": "Successfully created alias foo for index bar",
223                 "changes": {"new": {"test2": "key"}},
224             }
225         )
226         assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
227         ret.update(
228             {
229                 "comment": "Cannot create alias foo for index bar, False",
230                 "result": False,
231             }
232         )
233         assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
234         with patch.dict(elasticsearch.__opts__, {"test": True}):
235             ret.update(
236                 {
237                     "comment": (
238                         "Alias foo for index bar does not exist and will be created"
239                     ),
240                     "result": None,
241                     "changes": {"new": {"test2": "key"}},
242                 }
243             )
244             assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
245             ret.update(
246                 {
247                     "comment": (
248                         "Alias foo for index bar exists with wrong configuration and"
249                         " will be overridden"
250                     ),
251                     "result": None,
252                     "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
253                 }
254             )
255             assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
256         ret.update({"comment": "", "result": False, "changes": {}})
257         assert elasticsearch.alias_present(name, index) == ret
258         ret.update({"comment": "", "result": False, "changes": {}})
259         assert elasticsearch.alias_present(name, index) == ret
260 def test_index_template_absent():
261     name = "foo"
262     index_template = {name: {"test": "key"}}
263     ret = {
264         "name": name,
265         "result": True,
266         "comment": "Index template foo is already absent",
267         "changes": {},
268     }
269     mock_get = MagicMock(
270         side_effect=[
271             None,
272             {"bar": {}},
273             index_template,
274             index_template,
275             index_template,
276             CommandExecutionError,
277             index_template,
278         ]
279     )
280     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
281     with patch.dict(
282         elasticsearch.__salt__,
283         {
284             "elasticsearch.index_template_get": mock_get,
285             "elasticsearch.index_template_delete": mock_delete,
286         },
287     ):
288         assert elasticsearch.index_template_absent(name) == ret
289         assert elasticsearch.index_template_absent(name) == ret
290         ret.update(
291             {
292                 "comment": "Successfully removed index template foo",
293                 "changes": {"old": {"test": "key"}},
294             }
295         )
296         assert elasticsearch.index_template_absent(name) == ret
297         ret.update(
298             {
299                 "comment": "Failed to remove index template foo for unknown reasons",
300                 "result": False,
301                 "changes": {},
302             }
303         )
304         assert elasticsearch.index_template_absent(name) == ret
305         with patch.dict(elasticsearch.__opts__, {"test": True}):
306             ret.update(
307                 {
308                     "comment": "Index template foo will be removed",
309                     "result": None,
310                     "changes": {"old": {"test": "key"}},
311                 }
312             )
313             assert elasticsearch.index_template_absent(name) == ret
314         ret.update({"comment": "", "result": False, "changes": {}})
315         assert elasticsearch.index_template_absent(name) == ret
316         ret.update({"comment": "", "result": False, "changes": {}})
317         assert elasticsearch.index_template_absent(name) == ret
318 def test_index_template_present():
319     name = "foo"
320     index_template = {name: {"test": "key"}}
321     ret = {
322         "name": name,
323         "result": True,
324         "comment": "Index template foo is already present",
325         "changes": {},
326     }
327     mock_exists = MagicMock(
328         side_effect=[True, False, False, False, CommandExecutionError, False, False]
329     )
330     mock_create = MagicMock(side_effect=[True, False, CommandExecutionError, True])
331     mock_get = MagicMock(side_effect=[index_template, CommandExecutionError])
332     with patch.dict(
333         elasticsearch.__salt__,
334         {
335             "elasticsearch.index_template_get": mock_get,
336             "elasticsearch.index_template_create": mock_create,
337             "elasticsearch.index_template_exists": mock_exists,
338         },
339     ):
340         assert elasticsearch.index_template_present(name, {"test2": "key"}) == ret
341         ret.update(
342             {
343                 "comment": "Successfully created index template foo",
344                 "changes": {"new": {"test": "key"}},
345             }
346         )
347         assert elasticsearch.index_template_present(name, {"test2": "key"}) == ret
348         ret.update(
349             {
350                 "comment": "Cannot create index template foo, False",
351                 "result": False,
352                 "changes": {},
353             }
354         )
355         assert elasticsearch.index_template_present(name, {"test2": "key"}) == ret
356         with patch.dict(elasticsearch.__opts__, {"test": True}):
357             ret.update(
358                 {
359                     "comment": "Index template foo does not exist and will be created",
360                     "result": None,
361                     "changes": {"new": {"test2": "key"}},
362                 }
363             )
364             assert elasticsearch.index_template_present(name, {"test2": "key"}) == ret
365         ret.update({"comment": "", "result": False, "changes": {}})
366         assert elasticsearch.index_template_present(name, {}) == ret
367         ret.update({"comment": "", "result": False, "changes": {}})
368         assert elasticsearch.index_template_present(name, {}) == ret
369         ret.update({"comment": "", "result": False, "changes": {}})
370         assert elasticsearch.index_template_present(name, {}) == ret
371 def test_index_template_present_check_definition():
372     name = "foo"
373     index_template = {
374         name: {"test2": "key", "aliases": {}, "mappings": {}, "settings": {}}
375     }
376     expected = {
377         "name": name,
378         "result": True,
379         "comment": "Index template foo is already present and up to date",
380         "changes": {},
381     }
382     mock_exists = MagicMock(side_effect=[True])
383     mock_create = MagicMock(side_effect=[True])
384     mock_get = MagicMock(side_effect=[index_template])
385     with patch.dict(
386         elasticsearch.__salt__,
387         {
388             "elasticsearch.index_template_get": mock_get,
389             "elasticsearch.index_template_create": mock_create,
390             "elasticsearch.index_template_exists": mock_exists,
391         },
392     ):
393         ret = elasticsearch.index_template_present(
394             name, {"test2": "key", "aliases": {}}, check_definition=True
395         )
396         assert expected == ret
397 def test_index_template_present_check_definition_alias_not_empty():
398     name = "foo"
399     index_template = {
400         name: {"test2": "key", "aliases": {}, "mappings": {}, "settings": {}}
401     }
402     expected = {
403         "name": name,
404         "result": True,
405         "comment": "Successfully updated index template foo",
406         "changes": {"new": {"aliases": {"alias1": {}}}, "old": {"aliases": {}}},
407     }
408     mock_exists = MagicMock(side_effect=[True])
409     mock_create = MagicMock(side_effect=[True])
410     mock_get = MagicMock(side_effect=[index_template])
411     with patch.dict(
412         elasticsearch.__salt__,
413         {
414             "elasticsearch.index_template_get": mock_get,
415             "elasticsearch.index_template_create": mock_create,
416             "elasticsearch.index_template_exists": mock_exists,
417         },
418     ):
419         ret = elasticsearch.index_template_present(
420             name, {"test2": "key", "aliases": {"alias1": {}}}, check_definition=True
421         )
422         assert expected == ret
423 def test_pipeline_absent():
424     name = "foo"
425     pipeline = {name: {"test": "key"}}
426     ret = {
427         "name": name,
428         "result": True,
429         "comment": "Pipeline foo is already absent",
430         "changes": {},
431     }
432     mock_get = MagicMock(
433         side_effect=[
434             None,
435             {"foo2": {}},
436             pipeline,
437             pipeline,
438             pipeline,
439             CommandExecutionError,
440             pipeline,
441         ]
442     )
443     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
444     with patch.dict(
445         elasticsearch.__salt__,
446         {
447             "elasticsearch.pipeline_get": mock_get,
448             "elasticsearch.pipeline_delete": mock_delete,
449         },
450     ):
451         assert elasticsearch.pipeline_absent(name) == ret
452         assert elasticsearch.pipeline_absent(name) == ret
453         ret.update(
454             {
455                 "comment": "Successfully removed pipeline foo",
456                 "changes": {"old": {"test": "key"}},
457             }
458         )
459         assert elasticsearch.pipeline_absent(name) == ret
460         ret.update(
461             {
462                 "comment": "Failed to remove pipeline foo for unknown reasons",
463                 "result": False,
464                 "changes": {},
465             }
466         )
467         assert elasticsearch.pipeline_absent(name) == ret
468         with patch.dict(elasticsearch.__opts__, {"test": True}):
469             ret.update(
470                 {
471                     "comment": "Pipeline foo will be removed",
472                     "result": None,
473                     "changes": {"old": {"test": "key"}},
474                 }
475             )
476             assert elasticsearch.pipeline_absent(name) == ret
477         ret.update({"comment": "", "result": False, "changes": {}})
478         assert elasticsearch.pipeline_absent(name) == ret
479         ret.update({"comment": "", "result": False, "changes": {}})
480         assert elasticsearch.pipeline_absent(name) == ret
481 def test_pipeline_present():
482     name = "foo"
483     pipeline = {name: {"test": "key"}}
484     ret = {
485         "name": name,
486         "result": True,
487         "comment": "Pipeline foo is already present",
488         "changes": {},
489     }
490     mock_get = MagicMock(
491         side_effect=[
492             pipeline,
493             pipeline,
494             None,
495             None,
496             None,
497             pipeline,
498             CommandExecutionError,
499             None,
500         ]
501     )
502     mock_create = MagicMock(side_effect=[True, True, False, CommandExecutionError])
503     with patch.dict(
504         elasticsearch.__salt__,
505         {
506             "elasticsearch.pipeline_get": mock_get,
507             "elasticsearch.pipeline_create": mock_create,
508         },
509     ):
510         assert elasticsearch.pipeline_present(name, {"test": "key"}) == ret
511         ret.update(
512             {
513                 "comment": "Successfully replaced pipeline foo",
514                 "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
515             }
516         )
517         assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
518         ret.update(
519             {
520                 "comment": "Successfully created pipeline foo",
521                 "changes": {"new": {"test2": "key"}},
522             }
523         )
524         assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
525         ret.update({"comment": "Cannot create pipeline foo, False", "result": False})
526         assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
527         with patch.dict(elasticsearch.__opts__, {"test": True}):
528             ret.update(
529                 {
530                     "comment": "Pipeline foo does not exist and will be created",
531                     "result": None,
532                     "changes": {"new": {"test2": "key"}},
533                 }
534             )
535             assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
536             ret.update(
537                 {
538                     "comment": (
539                         "Pipeline foo exists with wrong configuration and will be"
540                         " overridden"
541                     ),
542                     "result": None,
543                     "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
544                 }
545             )
546             assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
547         ret.update({"comment": "", "result": False, "changes": {}})
548         assert elasticsearch.pipeline_present(name, {}) == ret
549         ret.update({"comment": "", "result": False, "changes": {}})
550         assert elasticsearch.pipeline_present(name, {}) == ret
551 def test_search_template_absent():
552     name = "foo"
553     template = {"template": '{"test": "key"}'}
554     ret = {
555         "name": name,
556         "result": True,
557         "comment": "Search template foo is already absent",
558         "changes": {},
559     }
560     mock_get = MagicMock(
561         side_effect=[
562             None,
563             template,
564             template,
565             template,
566             CommandExecutionError,
567             template,
568         ]
569     )
570     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
571     with patch.dict(
572         elasticsearch.__salt__,
573         {
574             "elasticsearch.search_template_get": mock_get,
575             "elasticsearch.search_template_delete": mock_delete,
576         },
577     ):
578         assert elasticsearch.search_template_absent(name) == ret
579         ret.update(
580             {
581                 "comment": "Successfully removed search template foo",
582                 "changes": {"old": {"test": "key"}},
583             }
584         )
585         assert elasticsearch.search_template_absent(name) == ret
586         ret.update(
587             {
588                 "comment": "Failed to remove search template foo for unknown reasons",
589                 "result": False,
590                 "changes": {},
591             }
592         )
593         assert elasticsearch.search_template_absent(name) == ret
594         with patch.dict(elasticsearch.__opts__, {"test": True}):
595             ret.update(
596                 {
597                     "comment": "Search template foo will be removed",
598                     "result": None,
599                     "changes": {"old": {"test": "key"}},
600                 }
601             )
602             assert elasticsearch.search_template_absent(name) == ret
603         ret.update({"comment": "", "result": False, "changes": {}})
604         assert elasticsearch.search_template_absent(name) == ret
605         ret.update({"comment": "", "result": False, "changes": {}})
606         assert elasticsearch.search_template_absent(name) == ret
607 def test_search_template_present():
608     name = "foo"
609     template = {"template": '{"test": "key"}'}
610     ret = {
611         "name": name,
612         "result": True,
613         "comment": "Search template foo is already present",
614         "changes": {},
615     }
616     mock_get = MagicMock(
617         side_effect=[
618             template,
619             template,
620             None,
621             None,
622             None,
623             template,
624             CommandExecutionError,
625             None,
626         ]
627     )
628     mock_create = MagicMock(side_effect=[True, True, False, CommandExecutionError])
629     with patch.dict(
630         elasticsearch.__salt__,
631         {
632             "elasticsearch.search_template_get": mock_get,
633             "elasticsearch.search_template_create": mock_create,
634         },
635     ):
636         assert elasticsearch.search_template_present(name, {"test": "key"}) == ret
637         ret.update(
638             {
639                 "comment": "Successfully replaced search template foo",
640                 "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
641             }
642         )
643         assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
644         ret.update(
645             {
646                 "comment": "Successfully created search template foo",
647                 "changes": {"new": {"test2": "key"}},
648             }
649         )
650         assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
651         ret.update(
652             {"comment": "Cannot create search template foo, False", "result": False}
653         )
654         assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
655         with patch.dict(elasticsearch.__opts__, {"test": True}):
656             ret.update(
657                 {
658                     "comment": "Search template foo does not exist and will be created",
659                     "result": None,
660                     "changes": {"new": {"test2": "key"}},
661                 }
662             )
663             assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
664             ret.update(
665                 {
666                     "comment": (
667                         "Search template foo exists with wrong configuration and will"
668                         " be overridden"
669                     ),
670                     "result": None,
671                     "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
672                 }
673             )
674             assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
675         ret.update({"comment": "", "result": False, "changes": {}})
676         assert elasticsearch.search_template_present(name, {}) == ret
677         ret.update({"comment": "", "result": False, "changes": {}})
678         assert elasticsearch.search_template_present(name, {}) == ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
