<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_boto_route53.py &amp; test_elasticsearch.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_boto_route53.py &amp; test_elasticsearch.py
      </h3>
<h1 align="center">
        5.2%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_boto_route53.py (21.367521%)<th>test_elasticsearch.py (2.9620852%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(61-65)<td><a href="#" name="0">(61-72)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(45-55)<td><a href="#" name="1">(151-162)</a><td align="center"><font color="#eb0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_boto_route53.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import pytest
2 import salt.states.boto_route53 as boto_route53
3 from tests.support.mock import MagicMock, patch
4 @pytest.fixture
5 def configure_loader_modules():
6     return {boto_route53: {}}
7 def test_present():
8     name = "test.example.com."
9     value = "1.1.1.1"
10     zone = "example.com."
11     record_type = "A"
12     ret = {"name": name, "result": False, "changes": {}, "comment": ""}
13     mock = MagicMock(side_effect=[{}, {}, {"value": ""}, False])
14     mock_bool = MagicMock(return_value=False)
15     with patch.dict(
16         boto_route53.__salt__,
17         {"boto_route53.get_record": mock, "boto_route53.add_record": mock_bool},
18     ):
19         with patch.dict(boto_route53.__opts__, {"test": False}):
20             comt = "Failed to add {} Route53 record.".format(name)
21             ret.update({"comment": comt})
22             assert boto_route53.present(name, value, zone, record_type) == ret
23         with patch.dict(boto_route53.__opts__, {"test": True}):
24             comt = "Route53 record {} set to be added.".format(name)
25             ret.update({"comment": comt, "result": None})
26             assert boto_route53.present(name, value, zone, record_type) == ret
27             comt = "Route53 record {} set to be updated.".format(name)
28             assert boto_route53.present(name, value, zone, record_type) == ret
29         ret<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.update({"comment": "", "result": True})
30         assert boto_route53.present(name, value, zone, record_type) == ret
31 def test_absent():
32     name = "test.example.com."
33     zone = "example.com."
34     record_type =</b></font> "A"
35     ret = {"name": name, "result": True, "changes": {}, "comment": ""}
36     mock = MagicMock(side_effect=[False, True])
37     with patch.dict(boto_route53.__salt__, {"boto_route53.get_record": mock}):
38         comt = "{} does not exist."<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(name)
39         ret.update({"comment": comt})
40         assert boto_route53.absent(name, zone, record_type) == ret
41         with patch.dict(boto_route53.__opts__, {"test"</b></font>: True}):
42             comt = "Route53 record {} set to be deleted.".format(name)
43             ret.update({"comment": comt, "result": None})
44             assert boto_route53.absent(name, zone, record_type) == ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_elasticsearch.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import pytest
2 import salt.utils.dictdiffer as dictdiffer
3 from salt.exceptions import CommandExecutionError
4 from salt.states import elasticsearch
5 from tests.support.mock import MagicMock, patch
6 @pytest.fixture
7 def configure_loader_modules():
8     return {
9         elasticsearch: {
10             "__opts__": {"test": False},
11             "__utils__": {"dictdiffer.deep_diff": dictdiffer.deep_diff},
12         }
13     }
14 def test_index_absent():
15     name = "foo"
16     ret = {
17         "name": name,
18         "result": True,
19         "comment": "Index foo is already absent",
20         "changes": {},
21     }
22     mock_get = MagicMock(
23         side_effect=[
24             None,
25             {name: {"test": "key"}},
26             {name: {}},
27             {name: {"test": "key"}},
28             CommandExecutionError,
29             {name: {"test": "key"}},
30         ]
31     )
32     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
33     with patch.dict(
34         elasticsearch.__salt__,
35         {
36             "elasticsearch.index_get": mock_get,
37             "elasticsearch.index_delete": mock_delete,
38         },
39     ):
40         assert elasticsearch.index_absent(name) == ret
41         ret.update(
42             {
43                 "comment": "Successfully removed index foo",
44             }
45         )
46         assert elasticsearch<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.index_absent(name) == ret
47         ret.update(
48             {
49                 "comment": "Failed to remove index foo for unknown reasons",
50                 "result": False,
51                 "changes": {},
52             }
53         )
54         assert elasticsearch.index_absent(name) == ret
55         with patch.dict(elasticsearch.__opts__, {"test"</b></font>: True}):
56             ret.update(
57                 {
58                     "comment": "Index foo will be removed",
59                     "result": None,
60                     "changes": {"old": {"test": "key"}},
61                 }
62             )
63             assert elasticsearch.index_absent(name) == ret
64         ret.update({"comment": "", "result": False, "changes": {}})
65         assert elasticsearch.index_absent(name) == ret
66         ret.update({"comment": "", "result": False, "changes": {}})
67         assert elasticsearch.index_absent(name) == ret
68 def test_index_present():
69     name = "foo"
70     ret = {
71         "name": name,
72         "result": True,
73         "comment": "Index foo is already present",
74         "changes": {},
75     }
76     mock_exists = MagicMock(
77         side_effect=[True, False, False, False, CommandExecutionError, False, False]
78     )
79     mock_get = MagicMock(side_effect=[{name: {"test": "key"}}, CommandExecutionError])
80     mock_create = MagicMock(side_effect=[True, False, CommandExecutionError, True])
81     with patch.dict(
82         elasticsearch.__salt__,
83         {
84             "elasticsearch.index_get": mock_get,
85             "elasticsearch.index_exists": mock_exists,
86             "elasticsearch.index_create": mock_create,
87         },
88     ):
89         assert elasticsearch.index_present(name) == ret
90         ret.update(
91             {
92                 "comment": "Successfully created index foo",
93                 "changes": {"new": {"test": "key"}},
94             }
95         )
96         assert elasticsearch.index_present(name) == ret
97         ret.update(
98             {
99                 "comment": "Cannot create index foo, False",
100                 "result": False,
101                 "changes": {},
102             }
103         )
104         assert elasticsearch.index_present(name) == ret
105         with patch.dict(elasticsearch.__opts__, {"test": True}):
106             ret.update(
107                 {
108                     "comment": "Index foo does not exist and will be created",
109                     "result": None,
110                     "changes": {"new": {"test2": "key"}},
111                 }
112             )
113             assert elasticsearch.index_present(name, {"test2": "key"}) == ret
114         ret.update({"comment": "", "result": False, "changes": {}})
115         assert elasticsearch.index_absent(name) == ret
116         assert elasticsearch.index_absent(name) == ret
117         ret<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.update({"comment": "", "result": False, "changes": {}})
118         assert elasticsearch.index_absent(name) == ret
119 def test_alias_absent():
120     name = "foo"
121     index = "bar"
122     alias =</b></font> {index: {"aliases": {name: {"test": "key"}}}}
123     ret = {
124         "name": name,
125         "result": True,
126         "comment": "Alias foo for index bar is already absent",
127         "changes": {},
128     }
129     mock_get = MagicMock(
130         side_effect=[
131             None,
132             {"foo2": {}},
133             alias,
134             alias,
135             alias,
136             CommandExecutionError,
137             alias,
138         ]
139     )
140     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
141     with patch.dict(
142         elasticsearch.__salt__,
143         {
144             "elasticsearch.alias_get": mock_get,
145             "elasticsearch.alias_delete": mock_delete,
146         },
147     ):
148         assert elasticsearch.alias_absent(name, index) == ret
149         assert elasticsearch.alias_absent(name, index) == ret
150         ret.update(
151             {
152                 "comment": "Successfully removed alias foo for index bar",
153                 "changes": {"old": {"test": "key"}},
154             }
155         )
156         assert elasticsearch.alias_absent(name, index) == ret
157         ret.update(
158             {
159                 "comment": (
160                     "Failed to remove alias foo for index bar for unknown reasons"
161                 ),
162                 "result": False,
163                 "changes": {},
164             }
165         )
166         assert elasticsearch.alias_absent(name, index) == ret
167         with patch.dict(elasticsearch.__opts__, {"test": True}):
168             ret.update(
169                 {
170                     "comment": "Alias foo for index bar will be removed",
171                     "result": None,
172                     "changes": {"old": {"test": "key"}},
173                 }
174             )
175             assert elasticsearch.alias_absent(name, index) == ret
176         ret.update({"comment": "", "result": False, "changes": {}})
177         assert elasticsearch.alias_absent(name, index) == ret
178         ret.update({"comment": "", "result": False, "changes": {}})
179         assert elasticsearch.alias_absent(name, index) == ret
180 def test_alias_present():
181     name = "foo"
182     index = "bar"
183     alias = {index: {"aliases": {name: {"test": "key"}}}}
184     ret = {
185         "name": name,
186         "result": True,
187         "comment": "Alias foo for index bar is already present",
188         "changes": {},
189     }
190     mock_get = MagicMock(
191         side_effect=[
192             alias,
193             alias,
194             None,
195             None,
196             None,
197             alias,
198             CommandExecutionError,
199             None,
200         ]
201     )
202     mock_create = MagicMock(side_effect=[True, True, False, CommandExecutionError])
203     with patch.dict(
204         elasticsearch.__salt__,
205         {
206             "elasticsearch.alias_get": mock_get,
207             "elasticsearch.alias_create": mock_create,
208         },
209     ):
210         assert elasticsearch.alias_present(name, index, {"test": "key"}) == ret
211         ret.update(
212             {
213                 "comment": "Successfully replaced alias foo for index bar",
214                 "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
215             }
216         )
217         assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
218         ret.update(
219             {
220                 "comment": "Successfully created alias foo for index bar",
221                 "changes": {"new": {"test2": "key"}},
222             }
223         )
224         assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
225         ret.update(
226             {
227                 "comment": "Cannot create alias foo for index bar, False",
228                 "result": False,
229             }
230         )
231         assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
232         with patch.dict(elasticsearch.__opts__, {"test": True}):
233             ret.update(
234                 {
235                     "comment": (
236                         "Alias foo for index bar does not exist and will be created"
237                     ),
238                     "result": None,
239                     "changes": {"new": {"test2": "key"}},
240                 }
241             )
242             assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
243             ret.update(
244                 {
245                     "comment": (
246                         "Alias foo for index bar exists with wrong configuration and"
247                         " will be overridden"
248                     ),
249                     "result": None,
250                     "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
251                 }
252             )
253             assert elasticsearch.alias_present(name, index, {"test2": "key"}) == ret
254         ret.update({"comment": "", "result": False, "changes": {}})
255         assert elasticsearch.alias_present(name, index) == ret
256         ret.update({"comment": "", "result": False, "changes": {}})
257         assert elasticsearch.alias_present(name, index) == ret
258 def test_index_template_absent():
259     name = "foo"
260     index_template = {name: {"test": "key"}}
261     ret = {
262         "name": name,
263         "result": True,
264         "comment": "Index template foo is already absent",
265         "changes": {},
266     }
267     mock_get = MagicMock(
268         side_effect=[
269             None,
270             {"bar": {}},
271             index_template,
272             index_template,
273             index_template,
274             CommandExecutionError,
275             index_template,
276         ]
277     )
278     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
279     with patch.dict(
280         elasticsearch.__salt__,
281         {
282             "elasticsearch.index_template_get": mock_get,
283             "elasticsearch.index_template_delete": mock_delete,
284         },
285     ):
286         assert elasticsearch.index_template_absent(name) == ret
287         assert elasticsearch.index_template_absent(name) == ret
288         ret.update(
289             {
290                 "comment": "Successfully removed index template foo",
291                 "changes": {"old": {"test": "key"}},
292             }
293         )
294         assert elasticsearch.index_template_absent(name) == ret
295         ret.update(
296             {
297                 "comment": "Failed to remove index template foo for unknown reasons",
298                 "result": False,
299                 "changes": {},
300             }
301         )
302         assert elasticsearch.index_template_absent(name) == ret
303         with patch.dict(elasticsearch.__opts__, {"test": True}):
304             ret.update(
305                 {
306                     "comment": "Index template foo will be removed",
307                     "result": None,
308                     "changes": {"old": {"test": "key"}},
309                 }
310             )
311             assert elasticsearch.index_template_absent(name) == ret
312         ret.update({"comment": "", "result": False, "changes": {}})
313         assert elasticsearch.index_template_absent(name) == ret
314         ret.update({"comment": "", "result": False, "changes": {}})
315         assert elasticsearch.index_template_absent(name) == ret
316 def test_index_template_present():
317     name = "foo"
318     index_template = {name: {"test": "key"}}
319     ret = {
320         "name": name,
321         "result": True,
322         "comment": "Index template foo is already present",
323         "changes": {},
324     }
325     mock_exists = MagicMock(
326         side_effect=[True, False, False, False, CommandExecutionError, False, False]
327     )
328     mock_create = MagicMock(side_effect=[True, False, CommandExecutionError, True])
329     mock_get = MagicMock(side_effect=[index_template, CommandExecutionError])
330     with patch.dict(
331         elasticsearch.__salt__,
332         {
333             "elasticsearch.index_template_get": mock_get,
334             "elasticsearch.index_template_create": mock_create,
335             "elasticsearch.index_template_exists": mock_exists,
336         },
337     ):
338         assert elasticsearch.index_template_present(name, {"test2": "key"}) == ret
339         ret.update(
340             {
341                 "comment": "Successfully created index template foo",
342                 "changes": {"new": {"test": "key"}},
343             }
344         )
345         assert elasticsearch.index_template_present(name, {"test2": "key"}) == ret
346         ret.update(
347             {
348                 "comment": "Cannot create index template foo, False",
349                 "result": False,
350                 "changes": {},
351             }
352         )
353         assert elasticsearch.index_template_present(name, {"test2": "key"}) == ret
354         with patch.dict(elasticsearch.__opts__, {"test": True}):
355             ret.update(
356                 {
357                     "comment": "Index template foo does not exist and will be created",
358                     "result": None,
359                     "changes": {"new": {"test2": "key"}},
360                 }
361             )
362             assert elasticsearch.index_template_present(name, {"test2": "key"}) == ret
363         ret.update({"comment": "", "result": False, "changes": {}})
364         assert elasticsearch.index_template_present(name, {}) == ret
365         ret.update({"comment": "", "result": False, "changes": {}})
366         assert elasticsearch.index_template_present(name, {}) == ret
367         ret.update({"comment": "", "result": False, "changes": {}})
368         assert elasticsearch.index_template_present(name, {}) == ret
369 def test_index_template_present_check_definition():
370     name = "foo"
371     index_template = {
372         name: {"test2": "key", "aliases": {}, "mappings": {}, "settings": {}}
373     }
374     expected = {
375         "name": name,
376         "result": True,
377         "comment": "Index template foo is already present and up to date",
378         "changes": {},
379     }
380     mock_exists = MagicMock(side_effect=[True])
381     mock_create = MagicMock(side_effect=[True])
382     mock_get = MagicMock(side_effect=[index_template])
383     with patch.dict(
384         elasticsearch.__salt__,
385         {
386             "elasticsearch.index_template_get": mock_get,
387             "elasticsearch.index_template_create": mock_create,
388             "elasticsearch.index_template_exists": mock_exists,
389         },
390     ):
391         ret = elasticsearch.index_template_present(
392             name, {"test2": "key", "aliases": {}}, check_definition=True
393         )
394         assert expected == ret
395 def test_index_template_present_check_definition_alias_not_empty():
396     name = "foo"
397     index_template = {
398         name: {"test2": "key", "aliases": {}, "mappings": {}, "settings": {}}
399     }
400     expected = {
401         "name": name,
402         "result": True,
403         "comment": "Successfully updated index template foo",
404         "changes": {"new": {"aliases": {"alias1": {}}}, "old": {"aliases": {}}},
405     }
406     mock_exists = MagicMock(side_effect=[True])
407     mock_create = MagicMock(side_effect=[True])
408     mock_get = MagicMock(side_effect=[index_template])
409     with patch.dict(
410         elasticsearch.__salt__,
411         {
412             "elasticsearch.index_template_get": mock_get,
413             "elasticsearch.index_template_create": mock_create,
414             "elasticsearch.index_template_exists": mock_exists,
415         },
416     ):
417         ret = elasticsearch.index_template_present(
418             name, {"test2": "key", "aliases": {"alias1": {}}}, check_definition=True
419         )
420         assert expected == ret
421 def test_pipeline_absent():
422     name = "foo"
423     pipeline = {name: {"test": "key"}}
424     ret = {
425         "name": name,
426         "result": True,
427         "comment": "Pipeline foo is already absent",
428         "changes": {},
429     }
430     mock_get = MagicMock(
431         side_effect=[
432             None,
433             {"foo2": {}},
434             pipeline,
435             pipeline,
436             pipeline,
437             CommandExecutionError,
438             pipeline,
439         ]
440     )
441     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
442     with patch.dict(
443         elasticsearch.__salt__,
444         {
445             "elasticsearch.pipeline_get": mock_get,
446             "elasticsearch.pipeline_delete": mock_delete,
447         },
448     ):
449         assert elasticsearch.pipeline_absent(name) == ret
450         assert elasticsearch.pipeline_absent(name) == ret
451         ret.update(
452             {
453                 "comment": "Successfully removed pipeline foo",
454                 "changes": {"old": {"test": "key"}},
455             }
456         )
457         assert elasticsearch.pipeline_absent(name) == ret
458         ret.update(
459             {
460                 "comment": "Failed to remove pipeline foo for unknown reasons",
461                 "result": False,
462                 "changes": {},
463             }
464         )
465         assert elasticsearch.pipeline_absent(name) == ret
466         with patch.dict(elasticsearch.__opts__, {"test": True}):
467             ret.update(
468                 {
469                     "comment": "Pipeline foo will be removed",
470                     "result": None,
471                     "changes": {"old": {"test": "key"}},
472                 }
473             )
474             assert elasticsearch.pipeline_absent(name) == ret
475         ret.update({"comment": "", "result": False, "changes": {}})
476         assert elasticsearch.pipeline_absent(name) == ret
477         ret.update({"comment": "", "result": False, "changes": {}})
478         assert elasticsearch.pipeline_absent(name) == ret
479 def test_pipeline_present():
480     name = "foo"
481     pipeline = {name: {"test": "key"}}
482     ret = {
483         "name": name,
484         "result": True,
485         "comment": "Pipeline foo is already present",
486         "changes": {},
487     }
488     mock_get = MagicMock(
489         side_effect=[
490             pipeline,
491             pipeline,
492             None,
493             None,
494             None,
495             pipeline,
496             CommandExecutionError,
497             None,
498         ]
499     )
500     mock_create = MagicMock(side_effect=[True, True, False, CommandExecutionError])
501     with patch.dict(
502         elasticsearch.__salt__,
503         {
504             "elasticsearch.pipeline_get": mock_get,
505             "elasticsearch.pipeline_create": mock_create,
506         },
507     ):
508         assert elasticsearch.pipeline_present(name, {"test": "key"}) == ret
509         ret.update(
510             {
511                 "comment": "Successfully replaced pipeline foo",
512                 "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
513             }
514         )
515         assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
516         ret.update(
517             {
518                 "comment": "Successfully created pipeline foo",
519                 "changes": {"new": {"test2": "key"}},
520             }
521         )
522         assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
523         ret.update({"comment": "Cannot create pipeline foo, False", "result": False})
524         assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
525         with patch.dict(elasticsearch.__opts__, {"test": True}):
526             ret.update(
527                 {
528                     "comment": "Pipeline foo does not exist and will be created",
529                     "result": None,
530                     "changes": {"new": {"test2": "key"}},
531                 }
532             )
533             assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
534             ret.update(
535                 {
536                     "comment": (
537                         "Pipeline foo exists with wrong configuration and will be"
538                         " overridden"
539                     ),
540                     "result": None,
541                     "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
542                 }
543             )
544             assert elasticsearch.pipeline_present(name, {"test2": "key"}) == ret
545         ret.update({"comment": "", "result": False, "changes": {}})
546         assert elasticsearch.pipeline_present(name, {}) == ret
547         ret.update({"comment": "", "result": False, "changes": {}})
548         assert elasticsearch.pipeline_present(name, {}) == ret
549 def test_search_template_absent():
550     name = "foo"
551     template = {"template": '{"test": "key"}'}
552     ret = {
553         "name": name,
554         "result": True,
555         "comment": "Search template foo is already absent",
556         "changes": {},
557     }
558     mock_get = MagicMock(
559         side_effect=[
560             None,
561             template,
562             template,
563             template,
564             CommandExecutionError,
565             template,
566         ]
567     )
568     mock_delete = MagicMock(side_effect=[True, False, CommandExecutionError])
569     with patch.dict(
570         elasticsearch.__salt__,
571         {
572             "elasticsearch.search_template_get": mock_get,
573             "elasticsearch.search_template_delete": mock_delete,
574         },
575     ):
576         assert elasticsearch.search_template_absent(name) == ret
577         ret.update(
578             {
579                 "comment": "Successfully removed search template foo",
580                 "changes": {"old": {"test": "key"}},
581             }
582         )
583         assert elasticsearch.search_template_absent(name) == ret
584         ret.update(
585             {
586                 "comment": "Failed to remove search template foo for unknown reasons",
587                 "result": False,
588                 "changes": {},
589             }
590         )
591         assert elasticsearch.search_template_absent(name) == ret
592         with patch.dict(elasticsearch.__opts__, {"test": True}):
593             ret.update(
594                 {
595                     "comment": "Search template foo will be removed",
596                     "result": None,
597                     "changes": {"old": {"test": "key"}},
598                 }
599             )
600             assert elasticsearch.search_template_absent(name) == ret
601         ret.update({"comment": "", "result": False, "changes": {}})
602         assert elasticsearch.search_template_absent(name) == ret
603         ret.update({"comment": "", "result": False, "changes": {}})
604         assert elasticsearch.search_template_absent(name) == ret
605 def test_search_template_present():
606     name = "foo"
607     template = {"template": '{"test": "key"}'}
608     ret = {
609         "name": name,
610         "result": True,
611         "comment": "Search template foo is already present",
612         "changes": {},
613     }
614     mock_get = MagicMock(
615         side_effect=[
616             template,
617             template,
618             None,
619             None,
620             None,
621             template,
622             CommandExecutionError,
623             None,
624         ]
625     )
626     mock_create = MagicMock(side_effect=[True, True, False, CommandExecutionError])
627     with patch.dict(
628         elasticsearch.__salt__,
629         {
630             "elasticsearch.search_template_get": mock_get,
631             "elasticsearch.search_template_create": mock_create,
632         },
633     ):
634         assert elasticsearch.search_template_present(name, {"test": "key"}) == ret
635         ret.update(
636             {
637                 "comment": "Successfully replaced search template foo",
638                 "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
639             }
640         )
641         assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
642         ret.update(
643             {
644                 "comment": "Successfully created search template foo",
645                 "changes": {"new": {"test2": "key"}},
646             }
647         )
648         assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
649         ret.update(
650             {"comment": "Cannot create search template foo, False", "result": False}
651         )
652         assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
653         with patch.dict(elasticsearch.__opts__, {"test": True}):
654             ret.update(
655                 {
656                     "comment": "Search template foo does not exist and will be created",
657                     "result": None,
658                     "changes": {"new": {"test2": "key"}},
659                 }
660             )
661             assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
662             ret.update(
663                 {
664                     "comment": (
665                         "Search template foo exists with wrong configuration and will"
666                         " be overridden"
667                     ),
668                     "result": None,
669                     "changes": {"old": {"test": "key"}, "new": {"test2": "key"}},
670                 }
671             )
672             assert elasticsearch.search_template_present(name, {"test2": "key"}) == ret
673         ret.update({"comment": "", "result": False, "changes": {}})
674         assert elasticsearch.search_template_present(name, {}) == ret
675         ret.update({"comment": "", "result": False, "changes": {}})
676         assert elasticsearch.search_template_present(name, {}) == ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
