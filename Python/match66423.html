<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for conftest_16.py &amp; collector.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for conftest_16.py &amp; collector.py
      </h3>
<h1 align="center">
        4.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>conftest_16.py (9.202454%)<th>collector.py (3.177966%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(84-93)<td><a href="#" name="0">(269-275)</a><td align="center"><font color="#ff0000">17</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(181-186)<td><a href="#" name="1">(583-589)</a><td align="center"><font color="#c30000">13</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>conftest_16.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import shutil
4 import subprocess
5 import time
6 import pytest
7 import salt.utils.platform
8 from saltfactories.exceptions import FactoryNotStarted, FactoryTimeout
9 log = logging.getLogger(__name__)
10 @pytest.fixture(scope="package")
11 def salt_mm_failover_master_1(request, salt_factories):
12     config_defaults = {
13         "open_mode": True,
14         "transport": request.config.getoption("--transport"),
15     }
16     config_overrides = {
17         "interface": "127.0.0.1",
18         "master_sign_pubkey": True,
19     }
20     factory = salt_factories.salt_master_daemon(
21         "mm-failover-master-1",
22         defaults=config_defaults,
23         overrides=config_overrides,
24         extra_cli_arguments_after_first_start_failure=["--log-level=debug"],
25     )
26     with factory.started(start_timeout=120):
27         yield factory
28 @pytest.fixture(scope="package")
29 def mm_failover_master_1_salt_cli(salt_mm_failover_master_1):
30     return salt_mm_failover_master_1.salt_cli(timeout=120)
31 @pytest.fixture(scope="package")
32 def salt_mm_failover_master_2(salt_factories, salt_mm_failover_master_1):
33     if salt.utils.platform.is_darwin() or salt.utils.platform.is_freebsd():
34         subprocess.check_output(["ifconfig", "lo0", "alias", "127.0.0.2", "up"])
35     config_defaults = {
36         "open_mode": True,
37         "transport": salt_mm_failover_master_1.config["transport"],
38     }
39     config_overrides = {
40         "interface": "127.0.0.2",
41         "master_sign_pubkey": True,
42     }
43     for key in (
44         "ret_port",
45         "publish_port",
46     ):
47         config_overrides[key] = salt_mm_failover_master_1.config[key]
48     factory = salt_factories.salt_master_daemon(
49         "mm-failover-master-2",
50         defaults=config_defaults,
51         overrides=config_overrides,
52         extra_cli_arguments_after_first_start_failure=["--log-level=debug"],
53     )
54     for keyfile in ("master_sign.pem", "master_sign.pub"):
55         shutil.copyfile(
56             os.path.join(salt_mm_failover_master_1.config["pki_dir"], keyfile),
57             os.path.join(factory.config["pki_dir"], keyfile),
58         )
59     with factory.started(start_timeout=120):
60         yield factory
61 @pytest.fixture(scope="package")
62 def mm_failover_master_2_salt_cli(salt_mm_failover_master_2):
63     return salt_mm_failover_master_2.salt_cli(timeout=120)
64 <a name="0"></a>@pytest.fixture(scope="package")
65 def salt_mm_failover_minion_1(salt_mm_failover_master_1, salt_mm_failover_master_2):
66     config_defaults = {
67         "transport": salt_mm_failover_master_1<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.config["transport"],
68     }
69     mm_master_1_port = salt_mm_failover_master_1.config["ret_port"]
70     mm_master_1_addr = salt_mm_failover_master_1.config["interface"]
71     mm_master_2_port = salt_mm_failover_master_2.config["ret_port"]
72     mm_master_2_addr = salt_mm_failover_master_2.config["interface"]
73     config_overrides = {
74         "master": [
75             "{}:{}"</b></font>.format(mm_master_1_addr, mm_master_1_port),
76             "{}:{}".format(mm_master_2_addr, mm_master_2_port),
77         ],
78         "publish_port": salt_mm_failover_master_1.config["publish_port"],
79         "master_type": "failover",
80         "master_alive_interval": 10,
81         "master_tries": -1,
82         "verify_master_pubkey_sign": True,
83         "retry_dns": 1,
84     }
85     factory = salt_mm_failover_master_1.salt_minion_daemon(
86         "mm-failover-minion-1",
87         defaults=config_defaults,
88         overrides=config_overrides,
89         extra_cli_arguments_after_first_start_failure=["--log-level=debug"],
90     )
91     shutil.copyfile(
92         os.path.join(salt_mm_failover_master_1.config["pki_dir"], "master_sign.pub"),
93         os.path.join(factory.config["pki_dir"], "master_sign.pub"),
94     )
95     with factory.started(start_timeout=120):
96         yield factory
97 @pytest.fixture(scope="package")
98 def salt_mm_failover_minion_2(salt_mm_failover_master_1, salt_mm_failover_master_2):
99     config_defaults = {
100         "transport": salt_mm_failover_master_1.config["transport"],
101     }
102     mm_master_1_port = salt_mm_failover_master_1.config["ret_port"]
103     mm_master_1_addr = salt_mm_failover_master_1.config["interface"]
104     mm_master_2_port = salt_mm_failover_master_2.config["ret_port"]
105     mm_master_2_addr = salt_mm_failover_master_2.config["interface"]
106     config_overrides = {
107         "master": [
108             "{}:{}".format(mm_master_2_addr, mm_master_2_port),
109             "{}:{}".format(mm_master_1_addr, mm_master_1_port),
110         ],
111         "publish_port": salt_mm_failover_master_1.config["publish_port"],
112         "master_type": "failover",
113         "master_alive_interval": 10,
114         "master_tries": -1,
115         "verify_master_pubkey_sign": True,
116         "retry_dns": 1,
117     }
118     factory = salt_mm_failover_master_2.salt_minion_daemon(
119         "mm-failover-minion-2",
120         defaults=config_defaults,
121         overrides=config_overrides,
122         extra_cli_arguments_after_first_start_failure=["--log-level=debug"],
123     )
124     shutil.copyfile(
125         os.path.join(salt_mm_failover_master_1.config["pki_dir"], "master_sign.pub"),
126         os.path.join(factory.config["pki_dir"], "master_sign.pub"),
127     )
128     with factory.started(start_timeout=120):
129         yield factory
130 @pytest.fixture(scope="package")
131 def run_salt_cmds():
132     def _run_salt_cmds_fn(clis, minions):
133         returned_minions = []
134         minions_to_check = {minion.id: minion for minion in minions}
135         attempts = 6
136         timeout = 5
137         if salt.utils.platform.spawning_platform():
138             timeout *= 2
139         while attempts:
140             if not minions_to_check:
141                 break
142             for cli in clis:
143                 for minion in list(minions_to_check):
144                     try:
145                         ret = cli.run(
146                             "--timeout={}".format(timeout),
147                             "test.ping",
148 <a name="1"></a>                            minion_tgt=minion,
149                         )
150                         if ret.exitcode == 0 and ret.json is True:
151                             returned_minions<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.append((cli, minions_to_check[minion]))
152                             minions_to_check.pop(minion)
153                     except FactoryTimeout:
154                         log.debug(
155                             "Failed to execute test.ping from %s to %s.",
156                             cli.get_display_name(</b></font>),
157                             minion,
158                         )
159             time.sleep(1)
160             attempts -= 1
161         return returned_minions
162     return _run_salt_cmds_fn
163 @pytest.fixture(autouse=True)
164 def ensure_connections(
165     salt_mm_failover_master_1,
166     salt_mm_failover_master_2,
167     mm_failover_master_1_salt_cli,
168     mm_failover_master_2_salt_cli,
169     salt_mm_failover_minion_1,
170     salt_mm_failover_minion_2,
171     run_salt_cmds,
172 ):
173     def _ensure_connections_fn(
174         salt_mm_failover_master_1,
175         salt_mm_failover_master_2,
176         mm_failover_master_1_salt_cli,
177         mm_failover_master_2_salt_cli,
178         salt_mm_failover_minion_1,
179         salt_mm_failover_minion_2,
180         run_salt_cmds,
181     ):
182         retries = 3
183         while retries:
184             try:
185                 minion_1_alive = run_salt_cmds(
186                     [mm_failover_master_1_salt_cli], [salt_mm_failover_minion_1]
187                 )
188                 minion_2_alive = run_salt_cmds(
189                     [mm_failover_master_2_salt_cli], [salt_mm_failover_minion_2]
190                 )
191                 if not (minion_1_alive and minion_2_alive):
192                     with salt_mm_failover_minion_1.stopped(), salt_mm_failover_minion_2.stopped():
193                         with salt_mm_failover_master_1.stopped(), salt_mm_failover_master_2.stopped():
194                             log.debug(
195                                 "All masters and minions are shutdown. Restarting."
196                             )
197             except FactoryNotStarted:
198                 log.debug("One or more minions failed to start, retrying")
199             else:
200                 if minion_1_alive and minion_2_alive:
201                     break
202             time.sleep(10)
203             retries -= 1
204         else:
205             pytest.fail("Could not ensure the connections were okay.")
206     _ensure_connections_fn(
207         salt_mm_failover_master_1,
208         salt_mm_failover_master_2,
209         mm_failover_master_1_salt_cli,
210         mm_failover_master_2_salt_cli,
211         salt_mm_failover_minion_1,
212         salt_mm_failover_minion_2,
213         run_salt_cmds,
214     )
215     return _ensure_connections_fn
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>collector.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import subprocess
4 import sys
5 import salt.utils.crypt
6 import salt.utils.files
7 import salt.utils.fsutils
8 import salt.utils.path
9 import salt.utils.stringutils
10 from salt.exceptions import CommandExecutionError
11 from salt.modules.inspectlib import EnvLoader, kiwiproc
12 from salt.modules.inspectlib.entities import (
13     AllowedDir,
14     IgnoredDir,
15     Package,
16     PackageCfgFile,
17     PayloadFile,
18 )
19 from salt.modules.inspectlib.exceptions import InspectorSnapshotException
20 try:
21     import kiwi
22 except ImportError:
23     kiwi = None
24 log = logging.getLogger(__name__)
25 class Inspector(EnvLoader):
26     DEFAULT_MINION_CONFIG_PATH = "/etc/salt/minion"
27     MODE = ["configuration", "payload", "all"]
28     IGNORE_MOUNTS = ["proc", "sysfs", "devtmpfs", "tmpfs", "fuse.gvfs-fuse-daemon"]
29     IGNORE_FS_TYPES = ["autofs", "cifs", "nfs", "nfs4"]
30     IGNORE_PATHS = [
31         "/tmp",
32         "/var/tmp",
33         "/lost+found",
34         "/var/run",
35         "/var/lib/rpm",
36         "/.snapshots",
37         "/.zfs",
38         "/etc/ssh",
39         "/root",
40         "/home",
41     ]
42     def __init__(self, cachedir=None, piddir=None, pidfilename=None):
43         EnvLoader.__init__(
44             self, cachedir=cachedir, piddir=piddir, pidfilename=pidfilename
45         )
46     def create_snapshot(self):
47         self.db.open(new=True)
48         return self
49     def reuse_snapshot(self):
50         self.db.open()
51         return self
52     def _syscall(self, command, input=None, env=None, *params):
53         return subprocess.Popen(
54             [command] + list(params),
55             stdout=subprocess.PIPE,
56             stdin=subprocess.PIPE,
57             stderr=subprocess.STDOUT,
58             env=env or os.environ,
59         ).communicate(input=input)
60     def _get_cfg_pkgs(self):
61         if self.grains_core.os_data().get("os_family") == "Debian":
62             return self.__get_cfg_pkgs_dpkg()
63         elif self.grains_core.os_data().get("os_family") in ["Suse", "redhat"]:
64             return self.__get_cfg_pkgs_rpm()
65         else:
66             return dict()
67     def __get_cfg_pkgs_dpkg(self):
68         data = dict()
69         for pkg_name in salt.utils.stringutils.to_str(
70             self._syscall("dpkg-query", None, None, "-Wf", "${binary:Package}\\n")[0]
71         ).split(os.linesep):
72             pkg_name = pkg_name.strip()
73             if not pkg_name:
74                 continue
75             data[pkg_name] = list()
76             for pkg_cfg_item in salt.utils.stringutils.to_str(
77                 self._syscall(
78                     "dpkg-query", None, None, "-Wf", "${Conffiles}\\n", pkg_name
79                 )[0]
80             ).split(os.linesep):
81                 pkg_cfg_item = pkg_cfg_item.strip()
82                 if not pkg_cfg_item:
83                     continue
84                 pkg_cfg_file, pkg_cfg_sum = pkg_cfg_item.strip().split(" ", 1)
85                 data[pkg_name].append(pkg_cfg_file)
86             if not data[pkg_name]:
87                 data.pop(pkg_name)
88         return data
89     def __get_cfg_pkgs_rpm(self):
90         out, err = self._syscall(
91             "rpm",
92             None,
93             None,
94             "-qa",
95             "--configfiles",
96             "--queryformat",
97             "%{name}-%{version}-%{release}\\n",
98         )
99         data = dict()
100         pkg_name = None
101         pkg_configs = []
102         out = salt.utils.stringutils.to_str(out)
103         for line in out.split(os.linesep):
104             line = line.strip()
105             if not line:
106                 continue
107             if not line.startswith("/"):
108                 if pkg_name and pkg_configs:
109                     data[pkg_name] = pkg_configs
110                 pkg_name = line
111                 pkg_configs = []
112             else:
113                 pkg_configs.append(line)
114         if pkg_name and pkg_configs:
115             data[pkg_name] = pkg_configs
116         return data
117     def _get_changed_cfg_pkgs(self, data):
118         f_data = dict()
119         for pkg_name, pkg_files in data.items():
120             cfgs = list()
121             cfg_data = list()
122             if self.grains_core.os_data().get("os_family") == "Debian":
123                 cfg_data = salt.utils.stringutils.to_str(
124                     self._syscall("dpkg", None, None, "--verify", pkg_name)[0]
125                 ).split(os.linesep)
126             elif self.grains_core.os_data().get("os_family") in ["Suse", "redhat"]:
127                 cfg_data = salt.utils.stringutils.to_str(
128                     self._syscall(
129                         "rpm",
130                         None,
131                         None,
132                         "-V",
133                         "--nodeps",
134                         "--nodigest",
135                         "--nosignature",
136                         "--nomtime",
137                         "--nolinkto",
138                         pkg_name,
139                     )[0]
140                 ).split(os.linesep)
141             for line in cfg_data:
142                 line = line.strip()
143                 if not line or line.find(" c ") &lt; 0 or line.split(" ")[0].find("5") &lt; 0:
144                     continue
145                 cfg_file = line.split(" ")[-1]
146                 if cfg_file in pkg_files:
147                     cfgs.append(cfg_file)
148             if cfgs:
149                 f_data[pkg_name] = cfgs
150         return f_data
151     def _save_cfg_packages(self, data):
152         pkg_id = 0
153         pkg_cfg_id = 0
154         for pkg_name, pkg_configs in data.items():
155             pkg = Package()
156             pkg.id = pkg_id
157             pkg.name = pkg_name
158             self.db.store(pkg)
159             for pkg_config in pkg_configs:
160                 cfg = PackageCfgFile()
161                 cfg.id = pkg_cfg_id
162                 cfg.pkgid = pkg_id
163                 cfg.path = pkg_config
164                 self.db.store(cfg)
165                 pkg_cfg_id += 1
166             pkg_id += 1
167     def _save_payload(self, files, directories, links):
168         idx = 0
169         for p_type, p_list in (
170             ("f", files),
171             ("d", directories),
172             ("l", links),
173         ):
174             for p_obj in p_list:
175                 stats = os.stat(p_obj)
176                 payload = PayloadFile()
177 <a name="0"></a>                payload.id = idx
178                 payload.path = p_obj
179                 payload.p_type = p_type
180                 payload.mode = stats<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.st_mode
181                 payload.uid = stats.st_uid
182                 payload.gid = stats.st_gid
183                 payload.p_size = stats.st_size
184                 payload.atime = stats.st_atime
185                 payload.mtime = stats.st_mtime
186                 payload.</b></font>ctime = stats.st_ctime
187                 idx += 1
188                 self.db.store(payload)
189     def _get_managed_files(self):
190         if self.grains_core.os_data().get("os_family") == "Debian":
191             return self.__get_managed_files_dpkg()
192         elif self.grains_core.os_data().get("os_family") in ["Suse", "redhat"]:
193             return self.__get_managed_files_rpm()
194         return list(), list(), list()
195     def __get_managed_files_dpkg(self):
196         dirs = set()
197         links = set()
198         files = set()
199         for pkg_name in salt.utils.stringutils.to_str(
200             self._syscall("dpkg-query", None, None, "-Wf", "${binary:Package}\\n")[0]
201         ).split(os.linesep):
202             pkg_name = pkg_name.strip()
203             if not pkg_name:
204                 continue
205             for resource in salt.utils.stringutils.to_str(
206                 self._syscall("dpkg", None, None, "-L", pkg_name)[0]
207             ).split(os.linesep):
208                 resource = resource.strip()
209                 if not resource or resource in ["/", "./", "."]:
210                     continue
211                 if os.path.isdir(resource):
212                     dirs.add(resource)
213                 elif os.path.islink(resource):
214                     links.add(resource)
215                 elif os.path.isfile(resource):
216                     files.add(resource)
217         return sorted(files), sorted(dirs), sorted(links)
218     def __get_managed_files_rpm(self):
219         dirs = set()
220         links = set()
221         files = set()
222         for line in salt.utils.stringutils.to_str(
223             self._syscall("rpm", None, None, "-qlav")[0]
224         ).split(os.linesep):
225             line = line.strip()
226             if not line:
227                 continue
228             line = line.replace("\t", " ").split(" ")
229             if line[0][0] == "d":
230                 dirs.add(line[-1])
231             elif line[0][0] == "l":
232                 links.add(line[-1])
233             elif line[0][0] == "-":
234                 files.add(line[-1])
235         return sorted(files), sorted(dirs), sorted(links)
236     def _get_all_files(self, path, *exclude):
237         files = list()
238         dirs = list()
239         links = list()
240         if os.access(path, os.R_OK):
241             for obj in os.listdir(path):
242                 obj = os.path.join(path, obj)
243                 valid = True
244                 for ex_obj in exclude:
245                     if obj.startswith(str(ex_obj)):
246                         valid = False
247                         continue
248                 if not valid or not os.path.exists(obj) or not os.access(obj, os.R_OK):
249                     continue
250                 if salt.utils.path.islink(obj):
251                     links.append(obj)
252                 elif os.path.isdir(obj):
253                     dirs.append(obj)
254                     f_obj, d_obj, l_obj = self._get_all_files(obj, *exclude)
255                     files.extend(f_obj)
256                     dirs.extend(d_obj)
257                     links.extend(l_obj)
258                 elif os.path.isfile(obj):
259                     files.append(obj)
260         return sorted(files), sorted(dirs), sorted(links)
261     def _get_unmanaged_files(self, managed, system_all):
262         m_files, m_dirs, m_links = managed
263         s_files, s_dirs, s_links = system_all
264         return (
265             sorted(list(set(s_files).difference(m_files))),
266             sorted(list(set(s_dirs).difference(m_dirs))),
267             sorted(list(set(s_links).difference(m_links))),
268         )
269     def _scan_payload(self):
270         allowed = list()
271         for allowed_dir in self.db.get(AllowedDir):
272             if os.path.exists(allowed_dir.path):
273                 allowed.append(allowed_dir.path)
274         ignored = list()
275         if not allowed:
276             for ignored_dir in self.db.get(IgnoredDir):
277                 if os.path.exists(ignored_dir.path):
278                     ignored.append(ignored_dir.path)
279         all_files = list()
280         all_dirs = list()
281         all_links = list()
282         for entry_path in [pth for pth in (allowed or os.listdir("/")) if pth]:
283             if entry_path[0] != "/":
284                 entry_path = "/{}".format(entry_path)
285             if entry_path in ignored or os.path.islink(entry_path):
286                 continue
287             e_files, e_dirs, e_links = self._get_all_files(entry_path, *ignored)
288             all_files.extend(e_files)
289             all_dirs.extend(e_dirs)
290             all_links.extend(e_links)
291         return self._get_unmanaged_files(
292             self._get_managed_files(),
293             (
294                 all_files,
295                 all_dirs,
296                 all_links,
297             ),
298         )
299     def _prepare_full_scan(self, **kwargs):
300         self.db.open(new=True)
301         ignored_fs = set()
302         ignored_fs |= set(self.IGNORE_PATHS)
303         mounts = salt.utils.fsutils._get_mounts()
304         for device, data in mounts.items():
305             if device in self.IGNORE_MOUNTS:
306                 for mpt in data:
307                     ignored_fs.add(mpt["mount_point"])
308                 continue
309             for mpt in data:
310                 if mpt["type"] in self.IGNORE_FS_TYPES:
311                     ignored_fs.add(mpt["mount_point"])
312         ignored_all = list()
313         for entry in sorted(list(ignored_fs)):
314             valid = True
315             for e_entry in ignored_all:
316                 if entry.startswith(e_entry):
317                     valid = False
318                     break
319             if valid:
320                 ignored_all.append(entry)
321         for ignored_dir in ignored_all:
322             dir_obj = IgnoredDir()
323             dir_obj.path = ignored_dir
324             self.db.store(dir_obj)
325         allowed = [elm for elm in kwargs.get("filter", "").split(",") if elm]
326         for allowed_dir in allowed:
327             dir_obj = AllowedDir()
328             dir_obj.path = allowed_dir
329             self.db.store(dir_obj)
330         return ignored_all
331     def _init_env(self):
332         from salt.config import minion_config
333         from salt.grains import core as g_core
334         g_core.__opts__ = minion_config(self.DEFAULT_MINION_CONFIG_PATH)
335         self.grains_core = g_core
336     def snapshot(self, mode):
337         self._init_env()
338         self._save_cfg_packages(self._get_changed_cfg_pkgs(self._get_cfg_pkgs()))
339         self._save_payload(*self._scan_payload())
340     def request_snapshot(self, mode, priority=19, **kwargs):
341         if mode not in self.MODE:
342             raise InspectorSnapshotException("Unknown mode: '{}'".format(mode))
343         if is_alive(self.pidfile):
344             raise CommandExecutionError("Inspection already in progress.")
345         self._prepare_full_scan(**kwargs)
346         subprocess.run(
347             [
348                 "nice",
349                 "-{}".format(priority),
350                 "python",
351                 __file__,
352                 os.path.dirname(self.pidfile),
353                 os.path.dirname(self.dbfile),
354                 mode,
355             ],
356             check=False,
357             stdout=subprocess.DEVNULL,
358             stderr=subprocess.DEVNULL,
359         )
360     def export(self, description, local=False, path="/tmp", format="qcow2"):
361         kiwiproc.__salt__ = __salt__
362         return (
363             kiwiproc.KiwiExporter(grains=__grains__, format=format)
364             .load(**description)
365             .export("something")
366         )
367     def build(self, format="qcow2", path="/tmp"):
368         if kiwi is None:
369             msg = (
370                 "Unable to build the image due to the missing dependencies: Kiwi module"
371                 " is not available."
372             )
373             log.error(msg)
374             raise CommandExecutionError(msg)
375         raise CommandExecutionError("Build is not yet implemented")
376 def is_alive(pidfile):
377     try:
378         with salt.utils.files.fopen(pidfile) as fp_:
379             os.kill(int(fp_.read().strip()), 0)
380         return True
381     except Exception as ex:  # pylint: disable=broad-except
382         if os.access(pidfile, os.W_OK) and os.path.isfile(pidfile):
383             os.unlink(pidfile)
384         return False
385 def main(dbfile, pidfile, mode):
386     Inspector(dbfile, pidfile).reuse_snapshot().snapshot(mode)
387 if __name__ == "__main__":
388     if len(sys.argv) != 4:
389         print("This module is not intended to use directly!", file=sys.stderr)
390         sys.exit(1)
391     pidfile, dbfile, mode = sys.argv[1:]  # pylint: disable=unbalanced-tuple-unpacking
392     if is_alive(pidfile):
393         sys.exit(1)
394 <a name="1"></a>    try:
395         if os.fork() &gt; 0:
396             salt.utils.crypt.reinit_crypto()
397             sys<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.exit(0)
398         else:
399             salt.utils.crypt.reinit_crypto()
400     except OSError as ex:
401         sys.exit(1)
402     os.setsid(</b></font>)
403     os.umask(0o000)  # pylint: disable=blacklisted-function
404     try:
405         pid = os.fork()
406         if pid &gt; 0:
407             salt.utils.crypt.reinit_crypto()
408             with salt.utils.files.fopen(
409                 os.path.join(pidfile, EnvLoader.PID_FILE), "w"
410             ) as fp_:
411                 fp_.write("{}\n".format(pid))
412             sys.exit(0)
413     except OSError as ex:
414         sys.exit(1)
415     salt.utils.crypt.reinit_crypto()
416     main(dbfile, pidfile, mode)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
