<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for conftest_16.py &amp; collector.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for conftest_16.py &amp; collector.py
      </h3>
<h1 align="center">
        4.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>conftest_16.py (9.202454%)<th>collector.py (3.177966%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(84-93)<td><a href="#" name="0">(269-275)</a><td align="center"><font color="#ff0000">17</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(181-186)<td><a href="#" name="1">(583-589)</a><td align="center"><font color="#c30000">13</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>conftest_16.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import shutil
4 import subprocess
5 import time
6 import pytest
7 import salt.utils.platform
8 from saltfactories.exceptions import FactoryNotStarted, FactoryTimeout
9 log = logging.getLogger(__name__)
10 @pytest.fixture(scope="package")
11 def salt_mm_failover_master_1(request, salt_factories):
12     config_defaults = {
13         "open_mode": True,
14         "transport": request.config.getoption("--transport"),
15     }
16     config_overrides = {
17         "interface": "127.0.0.1",
18         "master_sign_pubkey": True,
19     }
20     factory = salt_factories.salt_master_daemon(
21         "mm-failover-master-1",
22         defaults=config_defaults,
23         overrides=config_overrides,
24         extra_cli_arguments_after_first_start_failure=["--log-level=debug"],
25     )
26     with factory.started(start_timeout=120):
27         yield factory
28 @pytest.fixture(scope="package")
29 def mm_failover_master_1_salt_cli(salt_mm_failover_master_1):
30     return salt_mm_failover_master_1.salt_cli(timeout=120)
31 @pytest.fixture(scope="package")
32 def salt_mm_failover_master_2(salt_factories, salt_mm_failover_master_1):
33     if salt.utils.platform.is_darwin() or salt.utils.platform.is_freebsd():
34         subprocess.check_output(["ifconfig", "lo0", "alias", "127.0.0.2", "up"])
35     config_defaults = {
36         "open_mode": True,
37         "transport": salt_mm_failover_master_1.config["transport"],
38     }
39     config_overrides = {
40         "interface": "127.0.0.2",
41         "master_sign_pubkey": True,
42     }
43     for key in (
44         "ret_port",
45         "publish_port",
46     ):
47         config_overrides[key] = salt_mm_failover_master_1.config[key]
48     factory = salt_factories.salt_master_daemon(
49         "mm-failover-master-2",
50         defaults=config_defaults,
51         overrides=config_overrides,
52         extra_cli_arguments_after_first_start_failure=["--log-level=debug"],
53     )
54     for keyfile in ("master_sign.pem", "master_sign.pub"):
55         shutil.copyfile(
56             os.path.join(salt_mm_failover_master_1.config["pki_dir"], keyfile),
57             os.path.join(factory.config["pki_dir"], keyfile),
58         )
59     with factory.started(start_timeout=120):
60         yield factory
61 @pytest.fixture(scope="package")
62 def mm_failover_master_2_salt_cli(salt_mm_failover_master_2):
63     return salt_mm_failover_master_2.salt_cli(timeout=120)
64 def salt_mm_failover_minion_1(salt_mm_failover_master_1, salt_mm_failover_master_2):
65     config_defaults = {
66         "transport": salt_mm_failover_master_1<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.config["transport"],
67     }
68     mm_master_1_port = salt_mm_failover_master_1.config["ret_port"]
69     mm_master_1_addr = salt_mm_failover_master_1.config["interface"]
70     mm_master_2_port = salt_mm_failover_master_2.config["ret_port"]
71     mm_master_2_addr = salt_mm_failover_master_2.config["interface"]
72     config_overrides = {
73         "master": [
74             "{}:{}"</b></font>.format(mm_master_1_addr, mm_master_1_port),
75             "{}:{}".format(mm_master_2_addr, mm_master_2_port),
76         ],
77         "publish_port": salt_mm_failover_master_1.config["publish_port"],
78         "master_type": "failover",
79         "master_alive_interval": 10,
80         "master_tries": -1,
81         "verify_master_pubkey_sign": True,
82         "retry_dns": 1,
83     }
84     factory = salt_mm_failover_master_1.salt_minion_daemon(
85         "mm-failover-minion-1",
86         defaults=config_defaults,
87         overrides=config_overrides,
88         extra_cli_arguments_after_first_start_failure=["--log-level=debug"],
89     )
90     shutil.copyfile(
91         os.path.join(salt_mm_failover_master_1.config["pki_dir"], "master_sign.pub"),
92         os.path.join(factory.config["pki_dir"], "master_sign.pub"),
93     )
94     with factory.started(start_timeout=120):
95         yield factory
96 @pytest.fixture(scope="package")
97 def salt_mm_failover_minion_2(salt_mm_failover_master_1, salt_mm_failover_master_2):
98     config_defaults = {
99         "transport": salt_mm_failover_master_1.config["transport"],
100     }
101     mm_master_1_port = salt_mm_failover_master_1.config["ret_port"]
102     mm_master_1_addr = salt_mm_failover_master_1.config["interface"]
103     mm_master_2_port = salt_mm_failover_master_2.config["ret_port"]
104     mm_master_2_addr = salt_mm_failover_master_2.config["interface"]
105     config_overrides = {
106         "master": [
107             "{}:{}".format(mm_master_2_addr, mm_master_2_port),
108             "{}:{}".format(mm_master_1_addr, mm_master_1_port),
109         ],
110         "publish_port": salt_mm_failover_master_1.config["publish_port"],
111         "master_type": "failover",
112         "master_alive_interval": 10,
113         "master_tries": -1,
114         "verify_master_pubkey_sign": True,
115         "retry_dns": 1,
116     }
117     factory = salt_mm_failover_master_2.salt_minion_daemon(
118         "mm-failover-minion-2",
119         defaults=config_defaults,
120         overrides=config_overrides,
121         extra_cli_arguments_after_first_start_failure=["--log-level=debug"],
122     )
123     shutil.copyfile(
124         os.path.join(salt_mm_failover_master_1.config["pki_dir"], "master_sign.pub"),
125         os.path.join(factory.config["pki_dir"], "master_sign.pub"),
126     )
127     with factory.started(start_timeout=120):
128         yield factory
129 @pytest.fixture(scope="package")
130 def run_salt_cmds():
131     def _run_salt_cmds_fn(clis, minions):
132         returned_minions = []
133         minions_to_check = {minion.id: minion for minion in minions}
134         attempts = 6
135         timeout = 5
136         if salt.utils.platform.spawning_platform():
137             timeout *= 2
138         while attempts:
139             if not minions_to_check:
140                 break
141             for cli in clis:
142                 for minion in list(minions_to_check):
143                     try:
144                         ret = cli.run(
145                             "--timeout={}".format(timeout),
146                             "test.ping",
147                         )
148                         if ret.exitcode == 0 and ret.json is True:
149                             returned_minions<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.append((cli, minions_to_check[minion]))
150                             minions_to_check.pop(minion)
151                     except FactoryTimeout:
152                         log.debug(
153                             "Failed to execute test.ping from %s to %s.",
154                             cli.get_display_name(</b></font>),
155                             minion,
156                         )
157             time.sleep(1)
158             attempts -= 1
159         return returned_minions
160     return _run_salt_cmds_fn
161 @pytest.fixture(autouse=True)
162 def ensure_connections(
163     salt_mm_failover_master_1,
164     salt_mm_failover_master_2,
165     mm_failover_master_1_salt_cli,
166     mm_failover_master_2_salt_cli,
167     salt_mm_failover_minion_1,
168     salt_mm_failover_minion_2,
169     run_salt_cmds,
170 ):
171     def _ensure_connections_fn(
172         salt_mm_failover_master_1,
173         salt_mm_failover_master_2,
174         mm_failover_master_1_salt_cli,
175         mm_failover_master_2_salt_cli,
176         salt_mm_failover_minion_1,
177         salt_mm_failover_minion_2,
178         run_salt_cmds,
179     ):
180         retries = 3
181         while retries:
182             try:
183                 minion_1_alive = run_salt_cmds(
184                     [mm_failover_master_1_salt_cli], [salt_mm_failover_minion_1]
185                 )
186                 minion_2_alive = run_salt_cmds(
187                     [mm_failover_master_2_salt_cli], [salt_mm_failover_minion_2]
188                 )
189                 if not (minion_1_alive and minion_2_alive):
190                     with salt_mm_failover_minion_1.stopped(), salt_mm_failover_minion_2.stopped():
191                         with salt_mm_failover_master_1.stopped(), salt_mm_failover_master_2.stopped():
192                             log.debug(
193                                 "All masters and minions are shutdown. Restarting."
194                             )
195             except FactoryNotStarted:
196                 log.debug("One or more minions failed to start, retrying")
197             else:
198                 if minion_1_alive and minion_2_alive:
199                     break
200             time.sleep(10)
201             retries -= 1
202         else:
203             pytest.fail("Could not ensure the connections were okay.")
204     _ensure_connections_fn(
205         salt_mm_failover_master_1,
206         salt_mm_failover_master_2,
207         mm_failover_master_1_salt_cli,
208         mm_failover_master_2_salt_cli,
209         salt_mm_failover_minion_1,
210         salt_mm_failover_minion_2,
211         run_salt_cmds,
212     )
213     return _ensure_connections_fn
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>collector.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import subprocess
4 import sys
5 import salt.utils.crypt
6 import salt.utils.files
7 import salt.utils.fsutils
8 import salt.utils.path
9 import salt.utils.stringutils
10 from salt.exceptions import CommandExecutionError
11 from salt.modules.inspectlib import EnvLoader, kiwiproc
12 from salt.modules.inspectlib.entities import (
13     AllowedDir,
14     IgnoredDir,
15     Package,
16     PackageCfgFile,
17     PayloadFile,
18 )
19 from salt.modules.inspectlib.exceptions import InspectorSnapshotException
20 try:
21     import kiwi
22 except ImportError:
23     kiwi = None
24 log = logging.getLogger(__name__)
25 class Inspector(EnvLoader):
26     DEFAULT_MINION_CONFIG_PATH = "/etc/salt/minion"
27     MODE = ["configuration", "payload", "all"]
28     IGNORE_MOUNTS = ["proc", "sysfs", "devtmpfs", "tmpfs", "fuse.gvfs-fuse-daemon"]
29     IGNORE_FS_TYPES = ["autofs", "cifs", "nfs", "nfs4"]
30     IGNORE_PATHS = [
31         "/tmp",
32         "/var/tmp",
33         "/lost+found",
34         "/var/run",
35         "/var/lib/rpm",
36         "/.snapshots",
37         "/.zfs",
38         "/etc/ssh",
39         "/root",
40         "/home",
41     ]
42     def __init__(self, cachedir=None, piddir=None, pidfilename=None):
43         EnvLoader.__init__(
44             self, cachedir=cachedir, piddir=piddir, pidfilename=pidfilename
45         )
46     def create_snapshot(self):
47         self.db.open(new=True)
48         return self
49     def reuse_snapshot(self):
50         self.db.open()
51         return self
52     def _syscall(self, command, input=None, env=None, *params):
53         return subprocess.Popen(
54             [command] + list(params),
55             stdout=subprocess.PIPE,
56             stdin=subprocess.PIPE,
57             stderr=subprocess.STDOUT,
58             env=env or os.environ,
59         ).communicate(input=input)
60     def _get_cfg_pkgs(self):
61         if self.grains_core.os_data().get("os_family") == "Debian":
62             return self.__get_cfg_pkgs_dpkg()
63         elif self.grains_core.os_data().get("os_family") in ["Suse", "redhat"]:
64             return self.__get_cfg_pkgs_rpm()
65         else:
66             return dict()
67     def __get_cfg_pkgs_dpkg(self):
68         data = dict()
69         for pkg_name in salt.utils.stringutils.to_str(
70             self._syscall("dpkg-query", None, None, "-Wf", "${binary:Package}\\n")[0]
71         ).split(os.linesep):
72             pkg_name = pkg_name.strip()
73             if not pkg_name:
74                 continue
75             data[pkg_name] = list()
76             for pkg_cfg_item in salt.utils.stringutils.to_str(
77                 self._syscall(
78                     "dpkg-query", None, None, "-Wf", "${Conffiles}\\n", pkg_name
79                 )[0]
80             ).split(os.linesep):
81                 pkg_cfg_item = pkg_cfg_item.strip()
82                 if not pkg_cfg_item:
83                     continue
84                 pkg_cfg_file, pkg_cfg_sum = pkg_cfg_item.strip().split(" ", 1)
85                 data[pkg_name].append(pkg_cfg_file)
86             if not data[pkg_name]:
87                 data.pop(pkg_name)
88         return data
89     def __get_cfg_pkgs_rpm(self):
90         out, err = self._syscall(
91             "rpm",
92             None,
93             None,
94             "-qa",
95             "--configfiles",
96             "--queryformat",
97             "%{name}-%{version}-%{release}\\n",
98         )
99         data = dict()
100         pkg_name = None
101         pkg_configs = []
102         out = salt.utils.stringutils.to_str(out)
103         for line in out.split(os.linesep):
104             line = line.strip()
105             if not line:
106                 continue
107             if not line.startswith("/"):
108                 if pkg_name and pkg_configs:
109                     data[pkg_name] = pkg_configs
110                 pkg_name = line
111                 pkg_configs = []
112             else:
113                 pkg_configs.append(line)
114         if pkg_name and pkg_configs:
115             data[pkg_name] = pkg_configs
116         return data
117     def _get_changed_cfg_pkgs(self, data):
118         f_data = dict()
119         for pkg_name, pkg_files in data.items():
120             cfgs = list()
121             cfg_data = list()
122             if self.grains_core.os_data().get("os_family") == "Debian":
123                 cfg_data = salt.utils.stringutils.to_str(
124                     self._syscall("dpkg", None, None, "--verify", pkg_name)[0]
125                 ).split(os.linesep)
126             elif self.grains_core.os_data().get("os_family") in ["Suse", "redhat"]:
127                 cfg_data = salt.utils.stringutils.to_str(
128                     self._syscall(
129                         "rpm",
130                         None,
131                         None,
132                         "-V",
133                         "--nodeps",
134                         "--nodigest",
135                         "--nosignature",
136                         "--nomtime",
137                         "--nolinkto",
138                         pkg_name,
139                     )[0]
140                 ).split(os.linesep)
141             for line in cfg_data:
142                 line = line.strip()
143                 if not line or line.find(" c ") &lt; 0 or line.split(" ")[0].find("5") &lt; 0:
144                     continue
145                 cfg_file = line.split(" ")[-1]
146                 if cfg_file in pkg_files:
147                     cfgs.append(cfg_file)
148             if cfgs:
149                 f_data[pkg_name] = cfgs
150         return f_data
151     def _save_cfg_packages(self, data):
152         pkg_id = 0
153         pkg_cfg_id = 0
154         for pkg_name, pkg_configs in data.items():
155             pkg = Package()
156             pkg.id = pkg_id
157             pkg.name = pkg_name
158             self.db.store(pkg)
159             for pkg_config in pkg_configs:
160                 cfg = PackageCfgFile()
161                 cfg.id = pkg_cfg_id
162                 cfg.pkgid = pkg_id
163                 cfg.path = pkg_config
164                 self.db.store(cfg)
165                 pkg_cfg_id += 1
166             pkg_id += 1
167     def _save_payload(self, files, directories, links):
168         idx = 0
169         for p_type, p_list in (
170             ("f", files),
171             ("d", directories),
172             ("l", links),
173         ):
174             for p_obj in p_list:
175                 stats = os.stat(p_obj)
176                 payload = PayloadFile()
177                 payload.path = p_obj
178                 payload.p_type = p_type
179                 payload.mode = stats<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.st_mode
180                 payload.uid = stats.st_uid
181                 payload.gid = stats.st_gid
182                 payload.p_size = stats.st_size
183                 payload.atime = stats.st_atime
184                 payload.mtime = stats.st_mtime
185                 payload.</b></font>ctime = stats.st_ctime
186                 idx += 1
187                 self.db.store(payload)
188     def _get_managed_files(self):
189         if self.grains_core.os_data().get("os_family") == "Debian":
190             return self.__get_managed_files_dpkg()
191         elif self.grains_core.os_data().get("os_family") in ["Suse", "redhat"]:
192             return self.__get_managed_files_rpm()
193         return list(), list(), list()
194     def __get_managed_files_dpkg(self):
195         dirs = set()
196         links = set()
197         files = set()
198         for pkg_name in salt.utils.stringutils.to_str(
199             self._syscall("dpkg-query", None, None, "-Wf", "${binary:Package}\\n")[0]
200         ).split(os.linesep):
201             pkg_name = pkg_name.strip()
202             if not pkg_name:
203                 continue
204             for resource in salt.utils.stringutils.to_str(
205                 self._syscall("dpkg", None, None, "-L", pkg_name)[0]
206             ).split(os.linesep):
207                 resource = resource.strip()
208                 if not resource or resource in ["/", "./", "."]:
209                     continue
210                 if os.path.isdir(resource):
211                     dirs.add(resource)
212                 elif os.path.islink(resource):
213                     links.add(resource)
214                 elif os.path.isfile(resource):
215                     files.add(resource)
216         return sorted(files), sorted(dirs), sorted(links)
217     def __get_managed_files_rpm(self):
218         dirs = set()
219         links = set()
220         files = set()
221         for line in salt.utils.stringutils.to_str(
222             self._syscall("rpm", None, None, "-qlav")[0]
223         ).split(os.linesep):
224             line = line.strip()
225             if not line:
226                 continue
227             line = line.replace("\t", " ").split(" ")
228             if line[0][0] == "d":
229                 dirs.add(line[-1])
230             elif line[0][0] == "l":
231                 links.add(line[-1])
232             elif line[0][0] == "-":
233                 files.add(line[-1])
234         return sorted(files), sorted(dirs), sorted(links)
235     def _get_all_files(self, path, *exclude):
236         files = list()
237         dirs = list()
238         links = list()
239         if os.access(path, os.R_OK):
240             for obj in os.listdir(path):
241                 obj = os.path.join(path, obj)
242                 valid = True
243                 for ex_obj in exclude:
244                     if obj.startswith(str(ex_obj)):
245                         valid = False
246                         continue
247                 if not valid or not os.path.exists(obj) or not os.access(obj, os.R_OK):
248                     continue
249                 if salt.utils.path.islink(obj):
250                     links.append(obj)
251                 elif os.path.isdir(obj):
252                     dirs.append(obj)
253                     f_obj, d_obj, l_obj = self._get_all_files(obj, *exclude)
254                     files.extend(f_obj)
255                     dirs.extend(d_obj)
256                     links.extend(l_obj)
257                 elif os.path.isfile(obj):
258                     files.append(obj)
259         return sorted(files), sorted(dirs), sorted(links)
260     def _get_unmanaged_files(self, managed, system_all):
261         m_files, m_dirs, m_links = managed
262         s_files, s_dirs, s_links = system_all
263         return (
264             sorted(list(set(s_files).difference(m_files))),
265             sorted(list(set(s_dirs).difference(m_dirs))),
266             sorted(list(set(s_links).difference(m_links))),
267         )
268     def _scan_payload(self):
269         allowed = list()
270         for allowed_dir in self.db.get(AllowedDir):
271             if os.path.exists(allowed_dir.path):
272                 allowed.append(allowed_dir.path)
273         ignored = list()
274         if not allowed:
275             for ignored_dir in self.db.get(IgnoredDir):
276                 if os.path.exists(ignored_dir.path):
277                     ignored.append(ignored_dir.path)
278         all_files = list()
279         all_dirs = list()
280         all_links = list()
281         for entry_path in [pth for pth in (allowed or os.listdir("/")) if pth]:
282             if entry_path[0] != "/":
283                 entry_path = "/{}".format(entry_path)
284             if entry_path in ignored or os.path.islink(entry_path):
285                 continue
286             e_files, e_dirs, e_links = self._get_all_files(entry_path, *ignored)
287             all_files.extend(e_files)
288             all_dirs.extend(e_dirs)
289             all_links.extend(e_links)
290         return self._get_unmanaged_files(
291             self._get_managed_files(),
292             (
293                 all_files,
294                 all_dirs,
295                 all_links,
296             ),
297         )
298     def _prepare_full_scan(self, **kwargs):
299         self.db.open(new=True)
300         ignored_fs = set()
301         ignored_fs |= set(self.IGNORE_PATHS)
302         mounts = salt.utils.fsutils._get_mounts()
303         for device, data in mounts.items():
304             if device in self.IGNORE_MOUNTS:
305                 for mpt in data:
306                     ignored_fs.add(mpt["mount_point"])
307                 continue
308             for mpt in data:
309                 if mpt["type"] in self.IGNORE_FS_TYPES:
310                     ignored_fs.add(mpt["mount_point"])
311         ignored_all = list()
312         for entry in sorted(list(ignored_fs)):
313             valid = True
314             for e_entry in ignored_all:
315                 if entry.startswith(e_entry):
316                     valid = False
317                     break
318             if valid:
319                 ignored_all.append(entry)
320         for ignored_dir in ignored_all:
321             dir_obj = IgnoredDir()
322             dir_obj.path = ignored_dir
323             self.db.store(dir_obj)
324         allowed = [elm for elm in kwargs.get("filter", "").split(",") if elm]
325         for allowed_dir in allowed:
326             dir_obj = AllowedDir()
327             dir_obj.path = allowed_dir
328             self.db.store(dir_obj)
329         return ignored_all
330     def _init_env(self):
331         from salt.config import minion_config
332         from salt.grains import core as g_core
333         g_core.__opts__ = minion_config(self.DEFAULT_MINION_CONFIG_PATH)
334         self.grains_core = g_core
335     def snapshot(self, mode):
336         self._init_env()
337         self._save_cfg_packages(self._get_changed_cfg_pkgs(self._get_cfg_pkgs()))
338         self._save_payload(*self._scan_payload())
339     def request_snapshot(self, mode, priority=19, **kwargs):
340         if mode not in self.MODE:
341             raise InspectorSnapshotException("Unknown mode: '{}'".format(mode))
342         if is_alive(self.pidfile):
343             raise CommandExecutionError("Inspection already in progress.")
344         self._prepare_full_scan(**kwargs)
345         subprocess.run(
346             [
347                 "nice",
348                 "-{}".format(priority),
349                 "python",
350                 __file__,
351                 os.path.dirname(self.pidfile),
352                 os.path.dirname(self.dbfile),
353                 mode,
354             ],
355             check=False,
356             stdout=subprocess.DEVNULL,
357             stderr=subprocess.DEVNULL,
358         )
359     def export(self, description, local=False, path="/tmp", format="qcow2"):
360         kiwiproc.__salt__ = __salt__
361         return (
362             kiwiproc.KiwiExporter(grains=__grains__, format=format)
363             .load(**description)
364             .export("something")
365         )
366     def build(self, format="qcow2", path="/tmp"):
367         if kiwi is None:
368             msg = (
369                 "Unable to build the image due to the missing dependencies: Kiwi module"
370                 " is not available."
371             )
372             log.error(msg)
373             raise CommandExecutionError(msg)
374         raise CommandExecutionError("Build is not yet implemented")
375 def is_alive(pidfile):
376     try:
377         with salt.utils.files.fopen(pidfile) as fp_:
378             os.kill(int(fp_.read().strip()), 0)
379         return True
380     except Exception as ex:  # pylint: disable=broad-except
381         if os.access(pidfile, os.W_OK) and os.path.isfile(pidfile):
382             os.unlink(pidfile)
383         return False
384 def main(dbfile, pidfile, mode):
385     Inspector(dbfile, pidfile).reuse_snapshot().snapshot(mode)
386 if __name__ == "__main__":
387     if len(sys.argv) != 4:
388         print("This module is not intended to use directly!", file=sys.stderr)
389         sys.exit(1)
390     pidfile, dbfile, mode = sys.argv[1:]  # pylint: disable=unbalanced-tuple-unpacking
391     if is_alive(pidfile):
392         sys.exit(1)
393         if os.fork() &gt; 0:
394             salt.utils.crypt.reinit_crypto()
395             sys<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.exit(0)
396         else:
397             salt.utils.crypt.reinit_crypto()
398     except OSError as ex:
399         sys.exit(1)
400     os.setsid(</b></font>)
401     os.umask(0o000)  # pylint: disable=blacklisted-function
402     try:
403         pid = os.fork()
404         if pid &gt; 0:
405             salt.utils.crypt.reinit_crypto()
406             with salt.utils.files.fopen(
407                 os.path.join(pidfile, EnvLoader.PID_FILE), "w"
408             ) as fp_:
409                 fp_.write("{}\n".format(pid))
410             sys.exit(0)
411     except OSError as ex:
412         sys.exit(1)
413     salt.utils.crypt.reinit_crypto()
414     main(dbfile, pidfile, mode)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
