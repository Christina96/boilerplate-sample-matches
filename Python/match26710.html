<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for rdp_1.py &amp; rabbitmq_policy.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for rdp_1.py &amp; rabbitmq_policy.py
      </h3>
<h1 align="center">
        8.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>rdp_1.py (8.5561495%)<th>rabbitmq_policy.py (8.695652%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(19-36)<td><a href="#" name="0">(25-38)</a><td align="center"><font color="#ff0000">16</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>rdp_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import re
3 import salt.utils.platform
4 from salt.utils.decorators import depends
5 try:
6     from pywintypes import error as PyWinError
7     import win32ts
8     _HAS_WIN32TS_DEPENDENCIES = True
9     _HAS_WIN32TS_DEPENDENCIES = False
10 _LOG <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= logging.getLogger(__name__)
11 def __virtual__():
12     if salt.utils.platform.is_windows():
13         return "rdp"
14     return (False, "Module only works on Windows.")
15 def _parse_return_code_powershell(string):
16     regex =</b></font> re.search(r"ReturnValue\s*: (\d*)", string)
17     if not regex:
18         return (False, "Could not parse PowerShell return code.")
19     else:
20         return int(regex.group(1))
21 def _psrdp(cmd):
22     rdp = (
23         "$RDP = Get-WmiObject -Class Win32_TerminalServiceSetting "
24         "-Namespace root\\CIMV2\\TerminalServices -Computer . "
25         "-Authentication 6 -ErrorAction Stop"
26     )
27     return __salt__["cmd.run"](
28         "{} ; {}".format(rdp, cmd), shell="powershell", python_shell=True
29     )
30 def enable():
31     return _parse_return_code_powershell(_psrdp("$RDP.SetAllowTsConnections(1,1)")) == 0
32 def disable():
33     return _parse_return_code_powershell(_psrdp("$RDP.SetAllowTsConnections(0,1)")) == 0
34 def status():
35     out = int(_psrdp("echo $RDP.AllowTSConnections").strip())
36     return out != 0
37 @depends(_HAS_WIN32TS_DEPENDENCIES)
38 def list_sessions(logged_in_users_only=False):
39     ret = list()
40     server = win32ts.WTS_CURRENT_SERVER_HANDLE
41     protocols = {
42         win32ts.WTS_PROTOCOL_TYPE_CONSOLE: "console",
43         win32ts.WTS_PROTOCOL_TYPE_ICA: "citrix",
44         win32ts.WTS_PROTOCOL_TYPE_RDP: "rdp",
45     }
46     statuses = {
47         win32ts.WTSActive: "active",
48         win32ts.WTSConnected: "connected",
49         win32ts.WTSConnectQuery: "connect_query",
50         win32ts.WTSShadow: "shadow",
51         win32ts.WTSDisconnected: "disconnected",
52         win32ts.WTSIdle: "idle",
53         win32ts.WTSListen: "listen",
54         win32ts.WTSReset: "reset",
55         win32ts.WTSDown: "down",
56         win32ts.WTSInit: "init",
57     }
58     for session in win32ts.WTSEnumerateSessions(server):
59         user = (
60             win32ts.WTSQuerySessionInformation(
61                 server, session["SessionId"], win32ts.WTSUserName
62             )
63             or None
64         )
65         protocol_id = win32ts.WTSQuerySessionInformation(
66             server, session["SessionId"], win32ts.WTSClientProtocolType
67         )
68         status_id = win32ts.WTSQuerySessionInformation(
69             server, session["SessionId"], win32ts.WTSConnectState
70         )
71         protocol = protocols.get(protocol_id, "unknown")
72         connection_status = statuses.get(status_id, "unknown")
73         station = session["WinStationName"] or "Disconnected"
74         connection_info = {
75             "connection_status": connection_status,
76             "protocol": protocol,
77             "session_id": session["SessionId"],
78             "station": station,
79             "user": user,
80         }
81         if logged_in_users_only:
82             if user:
83                 ret.append(connection_info)
84         else:
85             ret.append(connection_info)
86     if not ret:
87         _LOG.warning("No sessions found.")
88     return sorted(ret, key=lambda k: k["session_id"])
89 @depends(_HAS_WIN32TS_DEPENDENCIES)
90 def get_session(session_id):
91     ret = dict()
92     sessions = list_sessions()
93     session = [item for item in sessions if item["session_id"] == session_id]
94     if session:
95         ret = session[0]
96     if not ret:
97         _LOG.warning("No session found for id: %s", session_id)
98     return ret
99 @depends(_HAS_WIN32TS_DEPENDENCIES)
100 def disconnect_session(session_id):
101     try:
102         win32ts.WTSDisconnectSession(
103             win32ts.WTS_CURRENT_SERVER_HANDLE, session_id, True
104         )
105     except PyWinError as error:
106         _LOG.error("Error calling WTSDisconnectSession: %s", error)
107         return False
108     return True
109 @depends(_HAS_WIN32TS_DEPENDENCIES)
110 def logoff_session(session_id):
111     try:
112         win32ts.WTSLogoffSession(win32ts.WTS_CURRENT_SERVER_HANDLE, session_id, True)
113     except PyWinError as error:
114         _LOG.error("Error calling WTSLogoffSession: %s", error)
115         return False
116     return True
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>rabbitmq_policy.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import json
2 import logging
3 import salt.utils.path
4 log <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= logging.getLogger(__name__)
5 def __virtual__():
6     if salt.utils.path.which("rabbitmqctl"):
7         return True
8     return (False, "Command not found: rabbitmqctl")
9 def present(
10     name, pattern, definition, priority=</b></font>0, vhost="/", runas=None, apply_to=None
11 ):
12     ret = {"name": name, "result": True, "comment": "", "changes": {}}
13     result = {}
14     policies = __salt__["rabbitmq.list_policies"](vhost=vhost, runas=runas)
15     policy = policies.get(vhost, {}).get(name)
16     updates = []
17     if policy:
18         if policy.get("pattern") != pattern:
19             updates.append("Pattern")
20         current_definition = policy.get("definition")
21         current_definition = (
22             json.loads(current_definition) if current_definition else ""
23         )
24         new_definition = json.loads(definition) if definition else ""
25         if current_definition != new_definition:
26             updates.append("Definition")
27         if apply_to and (policy.get("apply-to") != apply_to):
28             updates.append("Applyto")
29         if int(policy.get("priority")) != priority:
30             updates.append("Priority")
31     if policy and not updates:
32         ret["comment"] = "Policy {} {} is already present".format(vhost, name)
33         return ret
34     if not policy:
35         ret["changes"].update({"old": {}, "new": name})
36         if __opts__["test"]:
37             ret["comment"] = "Policy {} {} is set to be created".format(vhost, name)
38         else:
39             log.debug("Policy doesn't exist - Creating")
40             result = __salt__["rabbitmq.set_policy"](
41                 vhost,
42                 name,
43                 pattern,
44                 definition,
45                 priority=priority,
46                 runas=runas,
47                 apply_to=apply_to,
48             )
49     elif updates:
50         ret["changes"].update({"old": policy, "new": updates})
51         if __opts__["test"]:
52             ret["comment"] = "Policy {} {} is set to be updated".format(vhost, name)
53         else:
54             log.debug("Policy exists but needs updating")
55             result = __salt__["rabbitmq.set_policy"](
56                 vhost,
57                 name,
58                 pattern,
59                 definition,
60                 priority=priority,
61                 runas=runas,
62                 apply_to=apply_to,
63             )
64     if "Error" in result:
65         ret["result"] = False
66         ret["comment"] = result["Error"]
67     elif ret["changes"] == {}:
68         ret["comment"] = "'{}' is already in the desired state.".format(name)
69     elif __opts__["test"]:
70         ret["result"] = None
71     elif "Set" in result:
72         ret["comment"] = result["Set"]
73     return ret
74 def absent(name, vhost="/", runas=None):
75     ret = {"name": name, "result": True, "comment": "", "changes": {}}
76     policy_exists = __salt__["rabbitmq.policy_exists"](vhost, name, runas=runas)
77     if not policy_exists:
78         ret["comment"] = "Policy '{} {}' is not present.".format(vhost, name)
79         return ret
80     if not __opts__["test"]:
81         result = __salt__["rabbitmq.delete_policy"](vhost, name, runas=runas)
82         if "Error" in result:
83             ret["result"] = False
84             ret["comment"] = result["Error"]
85             return ret
86         elif "Deleted" in result:
87             ret["comment"] = "Deleted"
88     ret["changes"] = {"new": "", "old": name}
89     if __opts__["test"]:
90         ret["result"] = None
91         ret["comment"] = "Policy '{} {}' will be removed.".format(vhost, name)
92     return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
