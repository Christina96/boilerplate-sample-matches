<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for rdp_1.py &amp; rabbitmq_policy.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for rdp_1.py &amp; rabbitmq_policy.py
      </h3>
<h1 align="center">
        8.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>rdp_1.py (8.5561495%)<th>rabbitmq_policy.py (8.695652%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(19-36)<td><a href="#" name="0">(25-38)</a><td align="center"><font color="#ff0000">16</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>rdp_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import re
3 import salt.utils.platform
4 from salt.utils.decorators import depends
5 try:
6     from pywintypes import error as PyWinError
7     import win32ts
8     _HAS_WIN32TS_DEPENDENCIES = True
9 <a name="0"></a>except ImportError:
10     _HAS_WIN32TS_DEPENDENCIES = False
11 _LOG <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= logging.getLogger(__name__)
12 def __virtual__():
13     if salt.utils.platform.is_windows():
14         return "rdp"
15     return (False, "Module only works on Windows.")
16 def _parse_return_code_powershell(string):
17     regex =</b></font> re.search(r"ReturnValue\s*: (\d*)", string)
18     if not regex:
19         return (False, "Could not parse PowerShell return code.")
20     else:
21         return int(regex.group(1))
22 def _psrdp(cmd):
23     rdp = (
24         "$RDP = Get-WmiObject -Class Win32_TerminalServiceSetting "
25         "-Namespace root\\CIMV2\\TerminalServices -Computer . "
26         "-Authentication 6 -ErrorAction Stop"
27     )
28     return __salt__["cmd.run"](
29         "{} ; {}".format(rdp, cmd), shell="powershell", python_shell=True
30     )
31 def enable():
32     return _parse_return_code_powershell(_psrdp("$RDP.SetAllowTsConnections(1,1)")) == 0
33 def disable():
34     return _parse_return_code_powershell(_psrdp("$RDP.SetAllowTsConnections(0,1)")) == 0
35 def status():
36     out = int(_psrdp("echo $RDP.AllowTSConnections").strip())
37     return out != 0
38 @depends(_HAS_WIN32TS_DEPENDENCIES)
39 def list_sessions(logged_in_users_only=False):
40     ret = list()
41     server = win32ts.WTS_CURRENT_SERVER_HANDLE
42     protocols = {
43         win32ts.WTS_PROTOCOL_TYPE_CONSOLE: "console",
44         win32ts.WTS_PROTOCOL_TYPE_ICA: "citrix",
45         win32ts.WTS_PROTOCOL_TYPE_RDP: "rdp",
46     }
47     statuses = {
48         win32ts.WTSActive: "active",
49         win32ts.WTSConnected: "connected",
50         win32ts.WTSConnectQuery: "connect_query",
51         win32ts.WTSShadow: "shadow",
52         win32ts.WTSDisconnected: "disconnected",
53         win32ts.WTSIdle: "idle",
54         win32ts.WTSListen: "listen",
55         win32ts.WTSReset: "reset",
56         win32ts.WTSDown: "down",
57         win32ts.WTSInit: "init",
58     }
59     for session in win32ts.WTSEnumerateSessions(server):
60         user = (
61             win32ts.WTSQuerySessionInformation(
62                 server, session["SessionId"], win32ts.WTSUserName
63             )
64             or None
65         )
66         protocol_id = win32ts.WTSQuerySessionInformation(
67             server, session["SessionId"], win32ts.WTSClientProtocolType
68         )
69         status_id = win32ts.WTSQuerySessionInformation(
70             server, session["SessionId"], win32ts.WTSConnectState
71         )
72         protocol = protocols.get(protocol_id, "unknown")
73         connection_status = statuses.get(status_id, "unknown")
74         station = session["WinStationName"] or "Disconnected"
75         connection_info = {
76             "connection_status": connection_status,
77             "protocol": protocol,
78             "session_id": session["SessionId"],
79             "station": station,
80             "user": user,
81         }
82         if logged_in_users_only:
83             if user:
84                 ret.append(connection_info)
85         else:
86             ret.append(connection_info)
87     if not ret:
88         _LOG.warning("No sessions found.")
89     return sorted(ret, key=lambda k: k["session_id"])
90 @depends(_HAS_WIN32TS_DEPENDENCIES)
91 def get_session(session_id):
92     ret = dict()
93     sessions = list_sessions()
94     session = [item for item in sessions if item["session_id"] == session_id]
95     if session:
96         ret = session[0]
97     if not ret:
98         _LOG.warning("No session found for id: %s", session_id)
99     return ret
100 @depends(_HAS_WIN32TS_DEPENDENCIES)
101 def disconnect_session(session_id):
102     try:
103         win32ts.WTSDisconnectSession(
104             win32ts.WTS_CURRENT_SERVER_HANDLE, session_id, True
105         )
106     except PyWinError as error:
107         _LOG.error("Error calling WTSDisconnectSession: %s", error)
108         return False
109     return True
110 @depends(_HAS_WIN32TS_DEPENDENCIES)
111 def logoff_session(session_id):
112     try:
113         win32ts.WTSLogoffSession(win32ts.WTS_CURRENT_SERVER_HANDLE, session_id, True)
114     except PyWinError as error:
115         _LOG.error("Error calling WTSLogoffSession: %s", error)
116         return False
117     return True
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>rabbitmq_policy.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import json
2 import logging
3 <a name="0"></a>
4 import salt.utils.path
5 log <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= logging.getLogger(__name__)
6 def __virtual__():
7     if salt.utils.path.which("rabbitmqctl"):
8         return True
9     return (False, "Command not found: rabbitmqctl")
10 def present(
11     name, pattern, definition, priority=</b></font>0, vhost="/", runas=None, apply_to=None
12 ):
13     ret = {"name": name, "result": True, "comment": "", "changes": {}}
14     result = {}
15     policies = __salt__["rabbitmq.list_policies"](vhost=vhost, runas=runas)
16     policy = policies.get(vhost, {}).get(name)
17     updates = []
18     if policy:
19         if policy.get("pattern") != pattern:
20             updates.append("Pattern")
21         current_definition = policy.get("definition")
22         current_definition = (
23             json.loads(current_definition) if current_definition else ""
24         )
25         new_definition = json.loads(definition) if definition else ""
26         if current_definition != new_definition:
27             updates.append("Definition")
28         if apply_to and (policy.get("apply-to") != apply_to):
29             updates.append("Applyto")
30         if int(policy.get("priority")) != priority:
31             updates.append("Priority")
32     if policy and not updates:
33         ret["comment"] = "Policy {} {} is already present".format(vhost, name)
34         return ret
35     if not policy:
36         ret["changes"].update({"old": {}, "new": name})
37         if __opts__["test"]:
38             ret["comment"] = "Policy {} {} is set to be created".format(vhost, name)
39         else:
40             log.debug("Policy doesn't exist - Creating")
41             result = __salt__["rabbitmq.set_policy"](
42                 vhost,
43                 name,
44                 pattern,
45                 definition,
46                 priority=priority,
47                 runas=runas,
48                 apply_to=apply_to,
49             )
50     elif updates:
51         ret["changes"].update({"old": policy, "new": updates})
52         if __opts__["test"]:
53             ret["comment"] = "Policy {} {} is set to be updated".format(vhost, name)
54         else:
55             log.debug("Policy exists but needs updating")
56             result = __salt__["rabbitmq.set_policy"](
57                 vhost,
58                 name,
59                 pattern,
60                 definition,
61                 priority=priority,
62                 runas=runas,
63                 apply_to=apply_to,
64             )
65     if "Error" in result:
66         ret["result"] = False
67         ret["comment"] = result["Error"]
68     elif ret["changes"] == {}:
69         ret["comment"] = "'{}' is already in the desired state.".format(name)
70     elif __opts__["test"]:
71         ret["result"] = None
72     elif "Set" in result:
73         ret["comment"] = result["Set"]
74     return ret
75 def absent(name, vhost="/", runas=None):
76     ret = {"name": name, "result": True, "comment": "", "changes": {}}
77     policy_exists = __salt__["rabbitmq.policy_exists"](vhost, name, runas=runas)
78     if not policy_exists:
79         ret["comment"] = "Policy '{} {}' is not present.".format(vhost, name)
80         return ret
81     if not __opts__["test"]:
82         result = __salt__["rabbitmq.delete_policy"](vhost, name, runas=runas)
83         if "Error" in result:
84             ret["result"] = False
85             ret["comment"] = result["Error"]
86             return ret
87         elif "Deleted" in result:
88             ret["comment"] = "Deleted"
89     ret["changes"] = {"new": "", "old": name}
90     if __opts__["test"]:
91         ret["result"] = None
92         ret["comment"] = "Policy '{} {}' will be removed.".format(vhost, name)
93     return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
