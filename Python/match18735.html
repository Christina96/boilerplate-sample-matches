<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for napalm_network.py &amp; netacl.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for napalm_network.py &amp; netacl.py
      </h3>
<h1 align="center">
        10.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>napalm_network.py (5.949198%)<th>netacl.py (50.857143%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(2346-2470)<td><a href="#" name="0">(448-659)</a><td align="center"><font color="#ff0000">18</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(2027-2040)<td><a href="#" name="1">(429-444)</a><td align="center"><font color="#e20000">16</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(1599-1614)<td><a href="#" name="2">(92-425)</a><td align="center"><font color="#e20000">16</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(1339-1548)<td><a href="#" name="3">(686-701)</a><td align="center"><font color="#d40000">15</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(2498-2585)<td><a href="#" name="4">(965-976)</a><td align="center"><font color="#aa0000">12</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(2474-2486)<td><a href="#" name="5">(665-675)</a><td align="center"><font color="#aa0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>napalm_network.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import datetime
import logging
import time
import salt.utils.files
import salt.utils.napalm
import salt.utils.templates
import salt.utils.versions
log = logging.getLogger(__name__)
try:
    import jxmlease  # pylint: disable=unused-import
    HAS_JXMLEASE = True
except ImportError:
    HAS_JXMLEASE = False
__virtualname__ = "net"
__proxyenabled__ = ["*"]
__virtual_aliases__ = ("napalm_net",)
def __virtual__():
    return salt.utils.napalm.virtual(__opts__, __virtualname__, __file__)
def _filter_list(input_list, search_key, search_value):
    output_list = list()
    for dictionary in input_list:
        if dictionary.get(search_key) == search_value:
            output_list.append(dictionary)
    return output_list
def _filter_dict(input_dict, search_key, search_value):
    output_dict = dict()
    for key, key_list in input_dict.items():
        key_list_filtered = _filter_list(key_list, search_key, search_value)
        if key_list_filtered:
            output_dict[key] = key_list_filtered
    return output_dict
def _safe_commit_config(loaded_result, napalm_device):
    _commit = commit(
        inherit_napalm_device=napalm_device
    )  # calls the function commit, defined below
    if not _commit.get("result", False):
        loaded_result["comment"] += (
            _commit["comment"] if _commit.get("comment") else "Unable to commit."
        )
        loaded_result["result"] = False
        discarded = _safe_dicard_config(loaded_result, napalm_device)
        if not discarded["result"]:
            return loaded_result
    return _commit
def _safe_dicard_config(loaded_result, napalm_device):
    log.debug("Discarding the config")
    log.debug(loaded_result)
    _discarded = discard_config(inherit_napalm_device=napalm_device)
    if not _discarded.get("result", False):
        loaded_result["comment"] += (
            _discarded["comment"]
            if _discarded.get("comment")
            else "Unable to discard config."
        )
        loaded_result["result"] = False
        _explicit_close(napalm_device)
        __context__["retcode"] = 1
        return loaded_result
    return _discarded
def _explicit_close(napalm_device):
    if salt.utils.napalm.not_always_alive(__opts__):
        try:
            napalm_device["DRIVER"].close()
        except Exception as err:  # pylint: disable=broad-except
            log.error("Unable to close the temp connection with the device:")
            log.error(err)
            log.error("Please report.")
def _config_logic(
    napalm_device,
    loaded_result,
    test=False,
    debug=False,
    replace=False,
    commit_config=True,
    loaded_config=None,
    commit_in=None,
    commit_at=None,
    revert_in=None,
    revert_at=None,
    commit_jid=None,
    **kwargs
):
    current_jid = kwargs.get("__pub_jid")
    if not current_jid:
        current_jid = "{:%Y%m%d%H%M%S%f}".format(datetime.datetime.now())
    loaded_result["already_configured"] = False
    loaded_result["loaded_config"] = ""
    if debug:
        loaded_result["loaded_config"] = loaded_config
    _compare = compare_config(inherit_napalm_device=napalm_device)
    if _compare.get("result", False):
        loaded_result["diff"] = _compare.get("out")
        loaded_result.pop("out", "")  # not needed
    else:
        loaded_result["diff"] = None
        loaded_result["result"] = False
        loaded_result["comment"] = _compare.get("comment")
        __context__["retcode"] = 1
        return loaded_result
    _loaded_res = loaded_result.get("result", False)
    if not _loaded_res or test:
        if loaded_result["comment"]:
            loaded_result["comment"] += "\n"
        if not len(loaded_result.get("diff", "")) &gt; 0:
            loaded_result["already_configured"] = True
        discarded = _safe_dicard_config(loaded_result, napalm_device)
        if not discarded["result"]:
            return loaded_result
        loaded_result["comment"] += "Configuration discarded."
        _explicit_close(napalm_device)
        if not loaded_result["result"]:
            __context__["retcode"] = 1
        return loaded_result
    if not test and commit_config:
        if commit_jid:
            log.info("Committing the JID: %s", str(commit_jid))
            removed = cancel_commit(commit_jid)
            log.debug("Cleaned up the commit from the schedule")
            log.debug(removed["comment"])
        if len(loaded_result.get("diff", "")) &gt; 0:
            if commit_in or commit_at:
                commit_time = __utils__["timeutil.get_time_at"](
                    time_in=commit_in, time_at=commit_in
                )
                scheduled_job_name = "__napalm_commit_{}".format(current_jid)
                temp_file = salt.utils.files.mkstemp()
                with salt.utils.files.fopen(temp_file, "w") as fp_:
                    fp_.write(loaded_config)
                scheduled = __salt__["schedule.add"](
                    scheduled_job_name,
                    function="net.load_config",
                    job_kwargs={
                        "filename": temp_file,
                        "commit_jid": current_jid,
                        "replace": replace,
                    },
                    once=commit_time,
                )
                log.debug("Scheduling job")
                log.debug(scheduled)
                saved = __salt__["schedule.save"]()  # ensure the schedule is
                discarded = _safe_dicard_config(loaded_result, napalm_device)
                if not discarded["result"]:
                    discarded["comment"] += (
                        "Scheduled the job to be executed at {schedule_ts}, "
                        "but was unable to discard the config: \n".format(
                            schedule_ts=commit_time
                        )
                    )
                    return discarded
                loaded_result["comment"] = (
                    "Changes discarded for now, and scheduled commit at:"
                    " {schedule_ts}.\nThe commit ID is: {current_jid}.\nTo discard this"
                    " commit, you can execute: \n\nsalt {min_id} net.cancel_commit"
                    " {current_jid}".format(
                        schedule_ts=commit_time,
                        min_id=__opts__["id"],
                        current_jid=current_jid,
                    )
                )
                loaded_result["commit_id"] = current_jid
                return loaded_result
            log.debug("About to commit:")
            log.debug(loaded_result["diff"])
            if revert_in or revert_at:
                revert_time = __utils__["timeutil.get_time_at"](
                    time_in=revert_in, time_at=revert_at
                )
                if __grains__["os"] == "junos":
                    if not HAS_JXMLEASE:
                        loaded_result["comment"] = (
                            "This feature requires the library jxmlease to be"
                            " installed.\nTo install, please execute: ``pip install"
                            " jxmlease``."
                        )
                        loaded_result["result"] = False
                        return loaded_result
                    timestamp_at = __utils__["timeutil.get_timestamp_at"](
                        time_in=revert_in, time_at=revert_at
                    )
                    minutes = int((timestamp_at - time.time()) / 60)
                    _comm = __salt__["napalm.junos_commit"](confirm=minutes)
                    if not _comm["out"]:
                        loaded_result[
                            "comment"
                        ] = "Unable to commit confirm: {}".format(_comm["message"])
                        loaded_result["result"] = False
                        discarded = _safe_dicard_config(loaded_result, napalm_device)
                        if not discarded["result"]:
                            return loaded_result
                else:
                    temp_file = salt.utils.files.mkstemp()
                    running_config = __salt__["net.config"](source="running")["out"][
                        "running"
                    ]
                    with salt.utils.files.fopen(temp_file, "w") as fp_:
                        fp_.write(running_config)
                    committed = _safe_commit_config(loaded_result, napalm_device)
                    if not committed["result"]:
                        return loaded_result
                    scheduled_job_name = "__napalm_commit_{}".format(current_jid)
                    scheduled = __salt__["schedule.add"](
                        scheduled_job_name,
                        function="net.load_config",
                        job_kwargs={
                            "filename": temp_file,
                            "commit_jid": current_jid,
                            "replace": True,
                        },
                        once=revert_time,
                    )
                    log.debug("Scheduling commit confirmed")
                    log.debug(scheduled)
                    saved = __salt__["schedule.save"]()
                loaded_result["comment"] = (
                    "The commit ID is: {current_jid}.\nThis commit will be reverted at:"
                    " {schedule_ts}, unless confirmed.\nTo confirm the commit and avoid"
                    " reverting, you can execute:\n\nsalt {min_id} net.confirm_commit"
                    " {current_jid}".format(
                        schedule_ts=revert_time,
                        min_id=__opts__["id"],
                        current_jid=current_jid,
                    )
                )
                loaded_result["commit_id"] = current_jid
                return loaded_result
            committed = _safe_commit_config(loaded_result, napalm_device)
            if not committed["result"]:
                return loaded_result
        else:
            discarded = _safe_dicard_config(loaded_result, napalm_device)
            if not discarded["result"]:
                return loaded_result
            loaded_result["already_configured"] = True
            loaded_result["comment"] = "Already configured."
    _explicit_close(napalm_device)
    if not loaded_result["result"]:
        __context__["retcode"] = 1
    return loaded_result
@salt.utils.napalm.proxy_napalm_wrap
def connected(**kwargs):  # pylint: disable=unused-argument
    return {"out": napalm_device.get("UP", False)}  # pylint: disable=undefined-variable
@salt.utils.napalm.proxy_napalm_wrap
def facts(**kwargs):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "get_facts", **{}  # pylint: disable=undefined-variable
    )
@salt.utils.napalm.proxy_napalm_wrap
def environment(**kwargs):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "get_environment", **{}  # pylint: disable=undefined-variable
    )
@salt.utils.napalm.proxy_napalm_wrap
def cli(*commands, **kwargs):  # pylint: disable=unused-argument
    raw_cli_outputs = salt.utils.napalm.call(
        napalm_device,  # pylint: disable=undefined-variable
        "cli",
        **{"commands": list(commands)}
    )
    if not raw_cli_outputs["result"]:
        return raw_cli_outputs
    textfsm_parse = (
        kwargs.get("textfsm_parse")
        or __opts__.get("napalm_cli_textfsm_parse")
        or __pillar__.get("napalm_cli_textfsm_parse", False)
    )
    if not textfsm_parse:
        log.debug("No TextFSM parsing requested.")
        return raw_cli_outputs
    if "textfsm.extract" not in __salt__ or "textfsm.index" not in __salt__:
        raw_cli_outputs["comment"] += "Unable to process: is TextFSM installed?"
        log.error(raw_cli_outputs["comment"])
        return raw_cli_outputs
    textfsm_template = kwargs.get("textfsm_template")
    log.debug("textfsm_template: %s", textfsm_template)
    textfsm_path = (
        kwargs.get("textfsm_path")
        or __opts__.get("textfsm_path")
        or __pillar__.get("textfsm_path")
    )
    log.debug("textfsm_path: %s", textfsm_path)
    textfsm_template_dict = (
        kwargs.get("textfsm_template_dict")
        or __opts__.get("napalm_cli_textfsm_template_dict")
        or __pillar__.get("napalm_cli_textfsm_template_dict", {})
    )
    log.debug("TextFSM command-template mapping: %s", textfsm_template_dict)
    index_file = (
        kwargs.get("index_file")
        or __opts__.get("textfsm_index_file")
        or __pillar__.get("textfsm_index_file")
    )
    log.debug("index_file: %s", index_file)
    platform_grain_name = (
        kwargs.get("platform_grain_name")
        or __opts__.get("textfsm_platform_grain")
        or __pillar__.get("textfsm_platform_grain", "os")
    )
    log.debug("platform_grain_name: %s", platform_grain_name)
    platform_column_name = (
        kwargs.get("platform_column_name")
        or __opts__.get("textfsm_platform_column_name")
        or __pillar__.get("textfsm_platform_column_name", "Platform")
    )
    log.debug("platform_column_name: %s", platform_column_name)
    saltenv = kwargs.get("saltenv", "base")
    include_empty = kwargs.get("include_empty", False)
    include_pat = kwargs.get("include_pat")
    exclude_pat = kwargs.get("exclude_pat")
    processed_cli_outputs = {
        "comment": raw_cli_outputs.get("comment", ""),
        "result": raw_cli_outputs["result"],
        "out": {},
    }
    log.debug("Starting to analyse the raw outputs")
    for command in list(commands):
        command_output = raw_cli_outputs["out"][command]
        log.debug("Output from command: %s", command)
        log.debug(command_output)
        processed_command_output = None
        if textfsm_path:
            log.debug("Using the templates under %s", textfsm_path)
            processed_cli_output = __salt__["textfsm.index"](
                command,
                platform_grain_name=platform_grain_name,
                platform_column_name=platform_column_name,
                output=command_output.strip(),
                textfsm_path=textfsm_path,
                saltenv=saltenv,
                include_empty=include_empty,
                include_pat=include_pat,
                exclude_pat=exclude_pat,
            )
            log.debug("Processed CLI output:")
            log.debug(processed_cli_output)
            if not processed_cli_output["result"]:
                log.debug("Apparently this did not work, returning the raw output")
                processed_command_output = command_output
                processed_cli_outputs[
                    "comment"
                ] += "\nUnable to process the output from {}: {}.".format(
                    command, processed_cli_output["comment"]
                )
                log.error(processed_cli_outputs["comment"])
            elif processed_cli_output["out"]:
                log.debug("All good, %s has a nice output!", command)
                processed_command_output = processed_cli_output["out"]
            else:
                comment = """\nProcessing "{}" didn't fail, but didn't return anything either. Dumping raw.""".format(
                    command
                )
                processed_cli_outputs["comment"] += comment
                log.error(comment)
                processed_command_output = command_output
        elif textfsm_template or command in textfsm_template_dict:
            if command in textfsm_template_dict:
                textfsm_template = textfsm_template_dict[command]
            log.debug("Using %s to process the command: %s", textfsm_template, command)
            processed_cli_output = __salt__["textfsm.extract"](
                textfsm_template, raw_text=command_output, saltenv=saltenv
            )
            log.debug("Processed CLI output:")
            log.debug(processed_cli_output)
            if not processed_cli_output["result"]:
                log.debug("Apparently this did not work, returning the raw output")
                processed_command_output = command_output
                processed_cli_outputs[
                    "comment"
                ] += "\nUnable to process the output from {}: {}".format(
                    command, processed_cli_output["comment"]
                )
                log.error(processed_cli_outputs["comment"])
            elif processed_cli_output["out"]:
                log.debug("All good, %s has a nice output!", command)
                processed_command_output = processed_cli_output["out"]
            else:
                log.debug(
                    "Processing %s did not fail, but did not return"
                    " anything either. Dumping raw.",
                    command,
                )
                processed_command_output = command_output
        else:
            log.error("No TextFSM template specified, or no TextFSM path defined")
            processed_command_output = command_output
            processed_cli_outputs[
                "comment"
            ] += "\nUnable to process the output from {}.".format(command)
        processed_cli_outputs["out"][command] = processed_command_output
    processed_cli_outputs["comment"] = processed_cli_outputs["comment"].strip()
    return processed_cli_outputs
@salt.utils.napalm.proxy_napalm_wrap
def traceroute(
    destination, source=None, ttl=None, timeout=None, vrf=None, **kwargs
):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device,  # pylint: disable=undefined-variable
        "traceroute",
        **{
            "destination": destination,
            "source": source,
            "ttl": ttl,
            "timeout": timeout,
            "vrf": vrf,
        }
    )
@salt.utils.napalm.proxy_napalm_wrap
def ping(
    destination,
    source=None,
    ttl=None,
    timeout=None,
    size=None,
    count=None,
    vrf=None,
    **kwargs
):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device,  # pylint: disable=undefined-variable
        "ping",
        **{
            "destination": destination,
            "source": source,
            "ttl": ttl,
            "timeout": timeout,
            "size": size,
            "count": count,
            "vrf": vrf,
        }
    )
@salt.utils.napalm.proxy_napalm_wrap
def arp(
    interface="", ipaddr="", macaddr="", **kwargs
):  # pylint: disable=unused-argument
    proxy_output = salt.utils.napalm.call(
        napalm_device, "get_arp_table", **{}  # pylint: disable=undefined-variable
    )
    if not proxy_output.get("result"):
        return proxy_output
    arp_table = proxy_output.get("out")
    if interface:
        arp_table = _filter_list(arp_table, "interface", interface)
    if ipaddr:
        arp_table = _filter_list(arp_table, "ip", ipaddr)
    if macaddr:
        arp_table = _filter_list(arp_table, "mac", macaddr)
    proxy_output.update({"out": arp_table})
    return proxy_output
@salt.utils.napalm.proxy_napalm_wrap
def ipaddrs(**kwargs):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "get_interfaces_ip", **{}  # pylint: disable=undefined-variable
    )
@salt.utils.napalm.proxy_napalm_wrap
def interfaces(**kwargs):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "get_interfaces", **{}  # pylint: disable=undefined-variable
    )
@salt.utils.napalm.proxy_napalm_wrap
def lldp(interface="", **kwargs):  # pylint: disable=unused-argument
    proxy_output = salt.utils.napalm.call(
        napalm_device,  # pylint: disable=undefined-variable
        "get_lldp_neighbors_detail",
        **{}
    )
    if not proxy_output.get("result"):
        return proxy_output
    lldp_neighbors = proxy_output.get("out")
    if interface:
        lldp_neighbors = {interface: lldp_neighbors.get(interface)}
    proxy_output.update({"out": lldp_neighbors})
    return proxy_output
@salt.utils.napalm.proxy_napalm_wrap
def mac(address="", interface="", vlan=0, **kwargs):  # pylint: disable=unused-argument
    proxy_output = salt.utils.napalm.call(
        napalm_device,  # pylint: disable=undefined-variable
        "get_mac_address_table",
        **{}
    )
    if not proxy_output.get("result"):
        return proxy_output
    mac_address_table = proxy_output.get("out")
    if vlan and isinstance(vlan, int):
        mac_address_table = _filter_list(mac_address_table, "vlan", vlan)
    if address:
        mac_address_table = _filter_list(mac_address_table, "mac", address)
    if interface:
        mac_address_table = _filter_list(mac_address_table, "interface", interface)
    proxy_output.update({"out": mac_address_table})
    return proxy_output
@salt.utils.napalm.proxy_napalm_wrap
def config(source=None, **kwargs):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device,  # pylint: disable=undefined-variable
        "get_config",
        **{"retrieve": source}
    )
@salt.utils.napalm.proxy_napalm_wrap
def optics(**kwargs):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "get_optics", **{}  # pylint: disable=undefined-variable
    )
<a name="3"></a>
@salt.utils.napalm.proxy_napalm_wrap
<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>def load_config(
    filename=None,
    text=None,
    test=False,
    commit=True,
    debug=False,
    replace=False,
    commit_in=None,
    commit_at=None,
    revert_in=None,
    revert_at=None,
    commit_jid=None,
    inherit_napalm_device=None,
    saltenv="base",
    **kwargs
):  # pylint: disable=unused-argument
    fun =</b></font> "load_merge_candidate"
    if replace:
        fun = "load_replace_candidate"
    if salt.utils.napalm.not_always_alive(__opts__):
        napalm_device["CLOSE"] = False  # pylint: disable=undefined-variable
    if filename:
        text = __salt__["cp.get_file_str"](filename, saltenv=saltenv)
        if text is False:
            ret = {"result": False, "out": None}
            ret[
                "comment"
            ] = "Unable to read from {}. Please specify a valid file or text.".format(
                filename
            )
            log.error(ret["comment"])
            return ret
        if commit_jid:
            salt.utils.files.safe_rm(filename)
    _loaded = salt.utils.napalm.call(
        napalm_device, fun, **{"config": text}  # pylint: disable=undefined-variable
    )
    return _config_logic(
        napalm_device,  # pylint: disable=undefined-variable
        _loaded,
        test=test,
        debug=debug,
        replace=replace,
        commit_config=commit,
        loaded_config=text,
        commit_at=commit_at,
        commit_in=commit_in,
        revert_in=revert_in,
        revert_at=revert_at,
        commit_jid=commit_jid,
        **kwargs
    )
<a name="2"></a>
@salt.utils.napalm.proxy_napalm_wrap
<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>def load_template(
    template_name=None,
    template_source=None,
    context=None,
    defaults=None,
    template_engine="jinja",
    saltenv="base",
    template_hash=None,
    template_hash_name=None,
    skip_verify=False,
    test=False,
    commit=True,
    debug=False,
    replace=False,
    commit_in=None,
    commit_at=</b></font>None,
    revert_in=None,
    revert_at=None,
    inherit_napalm_device=None,  # pylint: disable=unused-argument
    **template_vars
):
    _rendered = ""
    _loaded = {"result": True, "comment": "", "out": None}
    loaded_config = None
    if template_engine not in salt.utils.templates.TEMPLATE_REGISTRY:
        _loaded.update(
            {
                "result": False,
                "comment": (
                    "Invalid templating engine! Choose between: {tpl_eng_opts}".format(
                        tpl_eng_opts=", ".join(
                            list(salt.utils.templates.TEMPLATE_REGISTRY.keys())
                        )
                    )
                ),
            }
        )
        return _loaded  # exit
    salt_render_prefixes = ("salt://", "http://", "https://", "ftp://")
    salt_render = False
    file_exists = False
    if not isinstance(template_name, (tuple, list)):
        for salt_render_prefix in salt_render_prefixes:
            if not salt_render:
                salt_render = salt_render or template_name.startswith(
                    salt_render_prefix
                )
        file_exists = __salt__["file.file_exists"](template_name)
    if context is None:
        context = {}
    context.update(template_vars)
    if template_source:
        _rendered = __salt__["file.apply_template_on_contents"](
            contents=template_source,
            template=template_engine,
            context=context,
            defaults=defaults,
            saltenv=saltenv,
        )
        if not isinstance(_rendered, str):
            if "result" in _rendered:
                _loaded["result"] = _rendered["result"]
            else:
                _loaded["result"] = False
            if "comment" in _rendered:
                _loaded["comment"] = _rendered["comment"]
            else:
                _loaded["comment"] = "Error while rendering the template."
            return _loaded
    else:
        if not isinstance(template_name, (list, tuple)):
            template_name = [template_name]
        if template_hash_name and not isinstance(template_hash_name, (list, tuple)):
            template_hash_name = [template_hash_name]
        elif not template_hash_name:
            template_hash_name = [None] * len(template_name)
        if (
            template_hash
            and isinstance(template_hash, str)
            and not (
                template_hash.startswith("salt://")
                or template_hash.startswith("file://")
            )
        ):
            template_hash = [template_hash]
        elif (
            template_hash
            and isinstance(template_hash, str)
            and (
                template_hash.startswith("salt://")
                or template_hash.startswith("file://")
            )
        ):
            template_hash = [template_hash] * len(template_name)
        elif not template_hash:
            template_hash = [None] * len(template_name)
        for tpl_index, tpl_name in enumerate(template_name):
            tpl_hash = template_hash[tpl_index]
<a name="1"></a>            tpl_hash_name = template_hash_name[tpl_index]
            _rand_filename = __salt__["random.hash"](tpl_name, "md5")
            _temp_file = __salt__["file.join"]("/tmp", _rand_filename)
            _managed <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= __salt__["file.get_managed"](
                name=_temp_file,
                source=tpl_name,
                source_hash=tpl_hash,
                source_hash_name=tpl_hash_name,
                user=None,
                group=None,
                mode=None,
                attrs=None,
                template=template_engine,
                context=context,
                defaults=defaults,
                saltenv=saltenv,
                skip_verify=</b></font>skip_verify,
            )
            if not isinstance(_managed, (list, tuple)) and isinstance(_managed, str):
                _loaded["comment"] += _managed
                _loaded["result"] = False
            elif isinstance(_managed, (list, tuple)) and not len(_managed) &gt; 0:
                _loaded["result"] = False
                _loaded["comment"] += "Error while rendering the template."
            elif isinstance(_managed, (list, tuple)) and not len(_managed[0]) &gt; 0:
                _loaded["result"] = False
                _loaded["comment"] += _managed[-1]  # contains the error message
            if _loaded["result"]:  # all good
                _temp_tpl_file = _managed[0]
                _temp_tpl_file_exists = __salt__["file.file_exists"](_temp_tpl_file)
                if not _temp_tpl_file_exists:
                    _loaded["result"] = False
                    _loaded["comment"] += "Error while rendering the template."
                    return _loaded
                _rendered += __salt__["file.read"](_temp_tpl_file)
                __salt__["file.remove"](_temp_tpl_file)
            else:
                return _loaded  # exit
    loaded_config = _rendered
    if _loaded["result"]:  # all good
        fun = "load_merge_candidate"
        if replace:  # replace requested
            fun = "load_replace_candidate"
        if salt.utils.napalm.not_always_alive(__opts__):
            napalm_device["CLOSE"] = False  # pylint: disable=undefined-variable
        _loaded = salt.utils.napalm.call(
            napalm_device,  # pylint: disable=undefined-variable
            fun,
            **{"config": _rendered}
        )
    return _config_logic(
        napalm_device,  # pylint: disable=undefined-variable
        _loaded,
        test=test,
        debug=debug,
        replace=replace,
        commit_config=commit,
        loaded_config=loaded_config,
        commit_at=commit_at,
        commit_in=commit_in,
        revert_in=revert_in,
        revert_at=revert_at,
        **template_vars
    )
@salt.utils.napalm.proxy_napalm_wrap
def commit(inherit_napalm_device=None, **kwargs):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "commit_config", **{}  # pylint: disable=undefined-variable
    )
@salt.utils.napalm.proxy_napalm_wrap
def discard_config(
    inherit_napalm_device=None, **kwargs
):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "discard_config", **{}  # pylint: disable=undefined-variable
    )
@salt.utils.napalm.proxy_napalm_wrap
def compare_config(
    inherit_napalm_device=None, **kwargs
):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "compare_config", **{}  # pylint: disable=undefined-variable
    )
@salt.utils.napalm.proxy_napalm_wrap
def rollback(inherit_napalm_device=None, **kwargs):  # pylint: disable=unused-argument
    return salt.utils.napalm.call(
        napalm_device, "rollback", **{}  # pylint: disable=undefined-variable
    )
@salt.utils.napalm.proxy_napalm_wrap
def config_changed(
    inherit_napalm_device=None, **kwargs
):  # pylint: disable=unused-argument
    is_config_changed = False
    reason = ""
    try_compare = compare_config(inherit_napalm_device=napalm_device)
    if try_compare.get("result"):
        if try_compare.get("out"):
            is_config_changed = True
        else:
            reason = "Configuration was not changed on the device."
    else:
        reason = try_compare.get("comment")
    return is_config_changed, reason
@salt.utils.napalm.proxy_napalm_wrap
def config_control(
    inherit_napalm_device=None, **kwargs
):  # pylint: disable=unused-argument
    result = True
    comment = ""
    changed, not_changed_rsn = config_changed(inherit_napalm_device=napalm_device)
    if not changed:
        return (changed, not_changed_rsn)
    try_commit = commit()
    if not try_commit.get("result"):
        result = False
        comment = (
            "Unable to commit the changes: {reason}.\nWill try to rollback now!".format(
                reason=try_commit.get("comment")
            )
        )
        try_rollback = rollback()
        if not try_rollback.get("result"):
            comment += "\nCannot rollback! {reason}".format(
                reason=try_rollback.get("comment")
            )
    return result, comment
def cancel_commit(jid):
    job_name = "__napalm_commit_{}".format(jid)
    removed = __salt__["schedule.delete"](job_name)
    if removed["result"]:
        saved = __salt__["schedule.save"]()
        removed["comment"] = "Commit #{jid} cancelled.".format(jid=jid)
    else:
        removed["comment"] = "Unable to find commit #{jid}.".format(jid=jid)
    return removed
def confirm_commit(jid):
    if __grains__["os"] == "junos":
        confirmed = __salt__["napalm.junos_commit"]()
        confirmed["result"] = confirmed.pop("out")
        confirmed["comment"] = confirmed.pop("message")
    else:
        confirmed = cancel_commit(jid)
    if confirmed["result"]:
        confirmed["comment"] = "Commit #{jid} confirmed.".format(jid=jid)
    return confirmed
def save_config(source=None, path=None):
    if not source:
        source = "running"
    if not path:
        path = salt.utils.files.mkstemp()
    running_config = __salt__["net.config"](source=source)
    if not running_config or not running_config["result"]:
        log.error("Unable to retrieve the config")
        return running_config
    with salt.utils.files.fopen(path, "w") as fh_:
        fh_.write(running_config["out"][source])
<a name="0"></a>    return {
        "result": True,
        "out": path,
        "comment": "{source} config saved to {path}".format(source=source, path=<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>path),
    }
def replace_pattern(
    pattern,
    repl,
    count=0,
    flags=8,
    bufsize=1,
    append_if_not_found=False,
    prepend_if_not_found=False,
    not_found_content=None,
    search_only=False,
    show_changes=True,
    backslash_literal=False,
    source=None,
    path=None,
    test=False,
    replace=True,
    debug=False,
    commit=True,
):
    config_saved =</b></font> save_config(source=source, path=path)
<a name="5"></a>    if not config_saved or not config_saved["result"]:
        return config_saved
    path = config_saved["out"]
    replace_pattern <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= __salt__["file.replace"](
        path,
        pattern,
        repl,
        count=count,
        flags=flags,
        bufsize=bufsize,
        append_if_not_found=append_if_not_found,
        prepend_if_not_found=prepend_if_not_found,
        not_found_content=not_found_content,
        search_only=search_only,
        show_changes=show_changes,
        backslash_literal=</b></font>backslash_literal,
    )
    with salt.utils.files.fopen(path, "r") as fh_:
        updated_config = fh_.read()
    return __salt__["net.load_config"](
        text=updated_config, test=test, debug=debug, replace=replace, commit=commit
    )
<a name="4"></a>def blockreplace(
    marker_start,
    marker_end,
    content<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="",
    append_if_not_found=False,
    prepend_if_not_found=False,
    show_changes=True,
    append_newline=False,
    source="running",
    path=None,
    test=False,
    commit=True,
    debug=False,
    replace=True,
):
    config_saved =</b></font> save_config(source=source, path=path)
    if not config_saved or not config_saved["result"]:
        return config_saved
    path = config_saved["out"]
    replace_pattern = __salt__["file.blockreplace"](
        path,
        marker_start=marker_start,
        marker_end=marker_end,
        content=content,
        append_if_not_found=append_if_not_found,
        prepend_if_not_found=prepend_if_not_found,
        show_changes=show_changes,
        append_newline=append_newline,
    )
    with salt.utils.files.fopen(path, "r") as fh_:
        updated_config = fh_.read()
    return __salt__["net.load_config"](
        text=updated_config, test=test, debug=debug, replace=replace, commit=commit
    )
def patch(
    patchfile,
    options="",
    saltenv="base",
    source_hash=None,
    show_changes=True,
    source="running",
    path=None,
    test=False,
    commit=True,
    debug=False,
    replace=True,
):
    config_saved = save_config(source=source, path=path)
    if not config_saved or not config_saved["result"]:
        return config_saved
    path = config_saved["out"]
    patchfile_cache = __salt__["cp.cache_file"](patchfile)
    if patchfile_cache is False:
        return {
            "out": None,
            "result": False,
            "comment": 'The file "{}" does not exist.'.format(patchfile),
        }
    replace_pattern = __salt__["file.patch"](path, patchfile_cache, options=options)
    with salt.utils.files.fopen(path, "r") as fh_:
        updated_config = fh_.read()
    return __salt__["net.load_config"](
        text=updated_config, test=test, debug=debug, replace=replace, commit=commit
    )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>netacl.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import logging
import salt.utils.napalm
log = logging.getLogger(__file__)
try:
    import capirca
    import capirca.aclgen
    import capirca.lib.policy
    import capirca.lib.aclgenerator
    HAS_CAPIRCA = True
except ImportError:
    HAS_CAPIRCA = False
__virtualname__ = "netacl"
def __virtual__():
    if HAS_CAPIRCA and salt.utils.napalm.virtual(__opts__, __virtualname__, __file__):
        return __virtualname__
    else:
        return (
            False,
            "The netacl state cannot be loaded: Please install capirca and napalm.",
        )
<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>def term(
    name,
    filter_name,
    term_name,
    filter_options=None,
    pillar_key="acl",
    pillarenv=None,
    saltenv=None,
    merge_pillar=False,
    revision_id=None,
    revision_no=None,
    revision_date=True,
    revision_date_format="%Y/%m/%d",
    test=False,
    commit=True,
    debug=False,
    source_service=None,
    destination_service=None,
    **term_fields
):
    ret =</b></font> salt.utils.napalm.default_ret(name)
<a name="1"></a>    test = __opts__["test"] or test
    if not filter_options:
        filter_options = []
    loaded <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= __salt__["netacl.load_term_config"](
        filter_name,
        term_name,
        filter_options=filter_options,
        pillar_key=pillar_key,
        pillarenv=pillarenv,
        saltenv=saltenv,
        merge_pillar=merge_pillar,
        revision_id=revision_id if revision_id else name,
        revision_no=revision_no,
        revision_date=revision_date,
        revision_date_format=revision_date_format,
        source_service=source_service,
        destination_service=destination_service,
        test=test,
        commit=</b></font>commit,
<a name="0"></a>        debug=debug,
        **term_fields
    )
    return salt.utils.napalm.loaded_ret(<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ret, loaded, test, debug)
def filter(
    name,  # pylint: disable=redefined-builtin
    filter_name,
    filter_options=None,
    terms=None,
    prepend=True,
    pillar_key="acl",
    pillarenv=None,
    saltenv=None,
    merge_pillar=False,
    only_lower_merge=False,
    revision_id=None,
    revision_no=None,
    revision_date=True,
    revision_date_format="%Y/%m/%d",
    test=False,
    commit=True,
    debug=False,
):
    ret =</b></font> salt.utils.napalm.default_ret(name)
    test = __opts__["test"] or test
    if not filter_options:
<a name="5"></a>        filter_options = []
    if not terms:
        terms = []
    loaded <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= __salt__["netacl.load_filter_config"](
        filter_name,
        filter_options=filter_options,
        terms=terms,
        prepend=prepend,
        pillar_key=pillar_key,
        pillarenv=pillarenv,
        saltenv=saltenv,
        merge_pillar=merge_pillar,
        only_lower_merge=only_lower_merge,
        revision_id=</b></font>revision_id if revision_id else name,
        revision_no=revision_no,
        revision_date=revision_date,
        revision_date_format=revision_date_format,
        test=test,
        commit=commit,
        debug=debug,
    )
<a name="3"></a>    return salt.utils.napalm.loaded_ret(ret, loaded, test, debug)
<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>def managed(
    name,
    filters=None,
    prepend=True,
    pillar_key="acl",
    pillarenv=None,
    saltenv=None,
    merge_pillar=False,
    only_lower_merge=False,
    revision_id=None,
    revision_no=None,
    revision_date=True,
    revision_date_format="%Y/%m/%d",
    test=False,
    commit=True,
    debug=</b></font>False,
):
    ret = salt.utils.napalm.default_ret(name)
    test = __opts__["test"] or test
<a name="4"></a>    if not filters:
        filters = []
    loaded = __salt__["netacl.load_policy_config"](
        filters<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=filters,
        prepend=prepend,
        pillar_key=pillar_key,
        pillarenv=pillarenv,
        saltenv=saltenv,
        merge_pillar=merge_pillar,
        only_lower_merge=only_lower_merge,
        revision_id=revision_id if revision_id else name,
        revision_no=revision_no,
        revision_date=revision_date,
        revision_date_format=revision_date_format,
        test=</b></font>test,
        commit=commit,
        debug=debug,
    )
    return salt.utils.napalm.loaded_ret(ret, loaded, test, debug)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
