<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_composer.py &amp; test_network_3.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_composer.py &amp; test_network_3.py
      </h3>
<h1 align="center">
        18.9%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_composer.py (32.142857%)<th>test_network_3.py (13.432836%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(38-43)<td><a href="#" name="0">(253-258)</a><td align="center"><font color="#ff0000">16</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(69-73)<td><a href="#" name="1">(130-136)</a><td align="center"><font color="#ef0000">15</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(76-78)<td><a href="#" name="2">(221-223)</a><td align="center"><font color="#df0000">14</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_composer.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
"""
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
"""
import pytest
import salt.states.composer as composer
from salt.exceptions import SaltException
from tests.support.mock import MagicMock, patch
@pytest.fixture
def configure_loader_modules():
    return {composer: {}}
def test_installed():
    """
    Test to verify that the correct versions of composer
    dependencies are present.
    """
    name = "CURL"
    ret = {"name": name, "result": True, "comment": "", "changes": {}}
    mock = MagicMock(return_value=True)
    with patch.dict(composer.__salt__, {"composer.did_composer_install": mock}):
        comt = "Composer already installed this directory"
        ret.update({"comment": comt})
        assert composer.installed(name, always_check=False) == ret
        with patch.dict(composer.__opts__, {"test": True}):
            comt = 'The state of "CURL" will be changed.'
            changes = {
                "new": "composer install will be run in CURL",
            }
            ret.update({"comment": comt, "result": None, "changes": changes})
            assert composer.installed(<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>name) == ret
        with patch.dict(composer.__opts__, {"test": False}):
            mock = MagicMock(side_effect=[SaltException, {}])
            with patch.dict(composer.__salt__, {"composer.install": mock}):
                comt =</b></font> "Error executing composer in 'CURL': "
                ret.update({"comment": comt, "result": False, "changes": {}})
                assert composer.installed(name) == ret
                comt = (
                    "Composer install completed successfully, output silenced by quiet"
                    " flag"
                )
                ret.update({"comment": comt, "result": True})
                assert composer.installed(name, quiet=True) == ret
def test_update():
    """
    Test to composer update the directory to ensure we have
    the latest versions of all project dependencies.
    """
    name = "CURL"
    ret = {"name": name, "result": True, "comment": "", "changes": {}}
    changes = {
        "new": "composer install/update will be run in CURL",
    }
    mock <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=True)
    with patch.dict(composer.__salt__, {"composer.did_composer_install": mock}):
        with patch.dict(composer.__opts__, {"test": True}):
            comt = 'The state of "CURL" will be changed.'
            assert composer.update(name) == ret
        <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(composer.__opts__, {"test": False}):
            mock = MagicMock(side_effect=[SaltException, {}])
            with patch.dict(composer.__salt__, {"composer.update"</b></font>: mock}):
                comt = "Error executing composer in 'CURL': "
                ret.update({"comment": comt, "result": False, "changes": {}})
                assert composer.update(name) == ret
                comt = (
                    "Composer update completed successfully, output silenced by quiet"
                    " flag"
                )
                ret.update({"comment": comt, "result": True})
                assert composer.update(name, quiet=True) == ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_network_3.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
"""
    :codeauthor: Rahul Handay &lt;rahulha@saltstack.com&gt;
"""
import logging
import salt.states.network as network
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase
log = logging.getLogger(__name__)
class MockNetwork:
    """
    Mock network class
    """
    def __init__(self):
        pass
    @staticmethod
    def interfaces():
        """
        Mock interface method
        """
        ifaces = {
            "salt": {"up": 1},
            "lo": {"up": 1, "inet": [{"label": "lo"}, {"label": "lo:alias1"}]},
        }
        return ifaces
class MockGrains:
    """
    Mock Grains class
    """
    def __init__(self):
        pass
    @staticmethod
    def grains(lis, bol):
        """
        Mock grains method
        """
        return {"A": "B"}
class NetworkTestCase(TestCase, LoaderModuleMockMixin):
    """
    Validate the network state
    """
    def setup_loader_modules(self):
        return {network: {}}
    def test_managed(self):
        """
        Test to ensure that the named interface is configured properly
        """
        with patch("salt.states.network.salt.utils.network", MockNetwork()), patch(
            "salt.states.network.salt.loader", MockGrains()
        ):
            ret = {"name": "salt", "changes": {}, "result": False, "comment": ""}
            change = {
                "interface": "--- \n+++ \n@@ -1 +1 @@\n-A\n+B",
                "status": "Interface salt restart to validate",
            }
            dunder_salt = {
                "ip.get_interface": MagicMock(
                    side_effect=[AttributeError, "A", "A", "A", "A", "A"]
                ),
                "ip.build_interface": MagicMock(return_value="B"),
                "saltutil.refresh_grains": MagicMock(return_value=True),
            }
            with patch.dict(network.__salt__, dunder_salt):
                with patch.dict(
                    network.__salt__,
                    {"ip.get_bond": MagicMock(side_effect=AttributeError)},
                ):
                    self.assertDictEqual(
                        network.managed("salt", type="bond", test=True), ret
                    )
                ret.update(
                    {
                        "comment": (
                            "Interface salt is set to be"
                            " updated:\n--- \n+++ \n@@ -1 +1 @@\n-A\n+B"
                        ),
                        "result": None,
                    }
                )
                self.assertDictEqual(
                    network.managed("salt", type="stack", test=True), ret
                )
                ipupdown = MagicMock(return_value=True)
                with patch.dict(
                    network.__salt__, {"ip.down": ipupdown, "ip.up": ipupdown}
                ):
                    ret.update(
                        {
                            "comment": "Interface salt updated.",
                            "result": True,
                            "changes": change,
                        }
                    )
                    self.assertDictEqual(network.managed("salt", type="stack"), ret)
                    with patch.dict(network.__grains__, {"A": True}):
                        ret.update(
                            {
                                "result": True,
                                "changes": {
                                    "interface": "--- \n+++ \n@@ -1 +1 @@\n-A\n+B",
                                    "status": "Interface salt down",
                                },
                            }
                        )
                        self.assertDictEqual(
                        )
                    mock <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=True)
                    with patch.dict(network.__salt__, {"ip.down": mock}):
                        with patch.dict(
                            network.__salt__, {"saltutil.refresh_modules": mock}
                        ):
                            change = {
                                "interface"</b></font>: "--- \n+++ \n@@ -1 +1 @@\n-A\n+B",
                                "status": "Interface lo:alias1 down",
                            }
                            ret.update(
                                {
                                    "name": "lo:alias1",
                                    "comment": "Interface lo:alias1 updated.",
                                    "result": True,
                                    "changes": change,
                                }
                            )
                            self.assertDictEqual(
                                network.managed("lo:alias1", type="eth", enabled=False),
                                ret,
                            )
    def test_routes(self):
        """
        Test to manage network interface static routes.
        """
        ret = {"name": "salt", "changes": {}, "result": False, "comment": ""}
        mock = MagicMock(
            side_effect=[AttributeError, False, False, "True", False, False]
        )
        with patch.dict(network.__salt__, {"ip.get_routes": mock}):
            self.assertDictEqual(network.routes("salt"), ret)
            mock = MagicMock(side_effect=[False, True, "", True, True])
            with patch.dict(network.__salt__, {"ip.build_routes": mock}):
                ret.update(
                    {"result": True, "comment": "Interface salt routes are up to date."}
                )
                self.assertDictEqual(network.routes("salt", test="a"), ret)
                ret.update(
                    {
                        "comment": "Interface salt routes are set to be added.",
                        "result": None,
                    }
                )
                self.assertDictEqual(network.routes("salt", test="a"), ret)
                ret.update(
                    {
                        "comment": (
                            "Interface salt routes are set to be"
                            " updated:\n--- \n+++ \n@@ -1,4 +0,0 @@\n-T\n-r"
                            "\n-u\n-e"
                        )
                    }
                )
                self.assertDictEqual(network.routes("salt", test="a"), ret)
                mock = MagicMock(side_effect=[AttributeError, True])
                with patch.dict(network.__salt__, {"ip.apply_network_settings": mock}):
                    ret.update(
                        {
                            "changes": {
                                "network_routes": "Added interface salt routes."
                            },
                            "comment": "",
                            "result": False,
                        }
                    )
                    self.assertDictEqual(network.routes("salt"), ret)
                    ret.update(
                        {
                            "changes": {
                                "network_routes": "Added interface salt routes."
                            },
                            "comment": "Interface salt routes added.",
                            "result": True,
                        }
                    )
                    self.assertDictEqual(network.routes("salt"), ret)
    def test_system(self):
        """
        Test to ensure that global network settings
        are configured properly
        ret = {"name": "salt", "changes": {}, "result": False, "comment": ""}
        <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(network.__opts__, {"test": True}):
            mock = MagicMock(side_effect=[AttributeError, False, False, "As"])
            with patch.dict(network.__salt__, {"ip.get_network_settings"</b></font>: mock}):
                self.assertDictEqual(network.system("salt"), ret)
                mock = MagicMock(side_effect=[False, True, ""])
                with patch.dict(network.__salt__, {"ip.build_network_settings": mock}):
                    ret.update(
                        {
                            "comment": "Global network settings are up to date.",
                            "result": True,
                        }
                    )
                    self.assertDictEqual(network.system("salt"), ret)
                    ret.update(
                        {
                            "comment": "Global network settings are set to be added.",
                            "result": None,
                        }
                    )
                    self.assertDictEqual(network.system("salt"), ret)
                    ret.update(
                        {
                            "comment": (
                                "Global network settings are set to"
                                " be updated:\n--- \n+++ \n@@ -1,2 +0,0"
                                " @@\n-A\n-s"
                        }
                    )
                    self.assertDictEqual(network.system("s<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>alt"), ret)
        with patch.dict(network.__opts__, {"test": False}):
            mock = MagicMock(side_effect=[False, False])
            with patch.dict(network.__salt__, {"ip.get_network_settings": mock}):
                mock =</b></font> MagicMock(side_effect=[True, True])
                with patch.dict(network.__salt__, {"ip.build_network_settings": mock}):
                    mock = MagicMock(side_effect=[AttributeError, True])
                    with patch.dict(
                        network.__salt__, {"ip.apply_network_settings": mock}
                    ):
                        ret.update(
                            {
                                "changes": {
                                    "network_settings": "Added global network settings."
                                },
                                "comment": "",
                                "result": False,
                            }
                        )
                        self.assertDictEqual(network.system("salt"), ret)
                        ret.update(
                            {
                                "changes": {
                                    "network_settings": "Added global network settings."
                                },
                                "comment": "Global network settings are up to date.",
                                "result": True,
                            }
                        )
                        self.assertDictEqual(network.system("salt"), ret)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
