<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_composer.py & test_network_3.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_composer.py & test_network_3.py
      </h3>
      <h1 align="center">
        18.9%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_composer.py (32.142857%)<TH>test_network_3.py (13.432836%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match6775-0.html#0',2,'match6775-1.html#0',3)" NAME="0">(38-43)<TD><A HREF="javascript:ZweiFrames('match6775-0.html#0',2,'match6775-1.html#0',3)" NAME="0">(253-258)</A><TD ALIGN=center><FONT COLOR="#ff0000">16</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match6775-0.html#1',2,'match6775-1.html#1',3)" NAME="1">(69-73)<TD><A HREF="javascript:ZweiFrames('match6775-0.html#1',2,'match6775-1.html#1',3)" NAME="1">(130-136)</A><TD ALIGN=center><FONT COLOR="#ef0000">15</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match6775-0.html#2',2,'match6775-1.html#2',3)" NAME="2">(76-78)<TD><A HREF="javascript:ZweiFrames('match6775-0.html#2',2,'match6775-1.html#2',3)" NAME="2">(221-223)</A><TD ALIGN=center><FONT COLOR="#df0000">14</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_composer.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;

import pytest
import salt.states.composer as composer
from salt.exceptions import SaltException
from tests.support.mock import MagicMock, patch


@pytest.fixture
def configure_loader_modules():
    return {composer: {}}


def test_installed():
    &quot;&quot;&quot;
    Test to verify that the correct versions of composer
    dependencies are present.
    &quot;&quot;&quot;
    name = &quot;CURL&quot;

    ret = {&quot;name&quot;: name, &quot;result&quot;: True, &quot;comment&quot;: &quot;&quot;, &quot;changes&quot;: {}}

    mock = MagicMock(return_value=True)
    with patch.dict(composer.__salt__, {&quot;composer.did_composer_install&quot;: mock}):
        comt = &quot;Composer already installed this directory&quot;
        ret.update({&quot;comment&quot;: comt})
        assert composer.installed(name, always_check=False) == ret

        with patch.dict(composer.__opts__, {&quot;test&quot;: True}):
            comt = 'The state of &quot;CURL&quot; will be changed.'
            changes = {
                &quot;new&quot;: &quot;composer install will be run in CURL&quot;,
<A NAME="0"></A>                &quot;old&quot;: &quot;composer install has been run in CURL&quot;,
            }
            ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None, &quot;changes&quot;: changes})
            assert composer.installed(<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match6775-1.html#0',3,'match6775-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>name) == ret

        with patch.dict(composer.__opts__, {&quot;test&quot;: False}):
            mock = MagicMock(side_effect=[SaltException, {}])
            with patch.dict(composer.__salt__, {&quot;composer.install&quot;: mock}):
                comt =</B></FONT> &quot;Error executing composer in 'CURL': &quot;
                ret.update({&quot;comment&quot;: comt, &quot;result&quot;: False, &quot;changes&quot;: {}})
                assert composer.installed(name) == ret

                comt = (
                    &quot;Composer install completed successfully, output silenced by quiet&quot;
                    &quot; flag&quot;
                )
                ret.update({&quot;comment&quot;: comt, &quot;result&quot;: True})
                assert composer.installed(name, quiet=True) == ret


def test_update():
    &quot;&quot;&quot;
    Test to composer update the directory to ensure we have
    the latest versions of all project dependencies.
    &quot;&quot;&quot;
    name = &quot;CURL&quot;

    ret = {&quot;name&quot;: name, &quot;result&quot;: True, &quot;comment&quot;: &quot;&quot;, &quot;changes&quot;: {}}

    changes = {
        &quot;new&quot;: &quot;composer install/update will be run in CURL&quot;,
<A NAME="1"></A>        &quot;old&quot;: &quot;composer install has not yet been run in CURL&quot;,
    }

    mock <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match6775-1.html#1',3,'match6775-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= MagicMock(return_value=True)
    with patch.dict(composer.__salt__, {&quot;composer.did_composer_install&quot;: mock}):
        with patch.dict(composer.__opts__, {&quot;test&quot;: True}):
            comt = 'The state of &quot;CURL&quot; will be changed.'
<A NAME="2"></A>            ret.</B></FONT>update({&quot;comment&quot;: comt, &quot;result&quot;: None, &quot;changes&quot;: changes})
            assert composer.update(name) == ret

        <FONT color="#980517"><A HREF="javascript:ZweiFrames('match6775-1.html#2',3,'match6775-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>with patch.dict(composer.__opts__, {&quot;test&quot;: False}):
            mock = MagicMock(side_effect=[SaltException, {}])
            with patch.dict(composer.__salt__, {&quot;composer.update&quot;</B></FONT>: mock}):
                comt = &quot;Error executing composer in 'CURL': &quot;
                ret.update({&quot;comment&quot;: comt, &quot;result&quot;: False, &quot;changes&quot;: {}})
                assert composer.update(name) == ret

                comt = (
                    &quot;Composer update completed successfully, output silenced by quiet&quot;
                    &quot; flag&quot;
                )
                ret.update({&quot;comment&quot;: comt, &quot;result&quot;: True})
                assert composer.update(name, quiet=True) == ret
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_network_3.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Rahul Handay &lt;rahulha@saltstack.com&gt;
&quot;&quot;&quot;

import logging

import salt.states.network as network
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase

log = logging.getLogger(__name__)


class MockNetwork:
    &quot;&quot;&quot;
    Mock network class
    &quot;&quot;&quot;

    def __init__(self):
        pass

    @staticmethod
    def interfaces():
        &quot;&quot;&quot;
        Mock interface method
        &quot;&quot;&quot;
        ifaces = {
            &quot;salt&quot;: {&quot;up&quot;: 1},
            &quot;lo&quot;: {&quot;up&quot;: 1, &quot;inet&quot;: [{&quot;label&quot;: &quot;lo&quot;}, {&quot;label&quot;: &quot;lo:alias1&quot;}]},
        }
        return ifaces


class MockGrains:
    &quot;&quot;&quot;
    Mock Grains class
    &quot;&quot;&quot;

    def __init__(self):
        pass

    @staticmethod
    def grains(lis, bol):
        &quot;&quot;&quot;
        Mock grains method
        &quot;&quot;&quot;
        return {&quot;A&quot;: &quot;B&quot;}


class NetworkTestCase(TestCase, LoaderModuleMockMixin):
    &quot;&quot;&quot;
    Validate the network state
    &quot;&quot;&quot;

    def setup_loader_modules(self):
        return {network: {}}

    def test_managed(self):
        &quot;&quot;&quot;
        Test to ensure that the named interface is configured properly
        &quot;&quot;&quot;
        with patch(&quot;salt.states.network.salt.utils.network&quot;, MockNetwork()), patch(
            &quot;salt.states.network.salt.loader&quot;, MockGrains()
        ):
            ret = {&quot;name&quot;: &quot;salt&quot;, &quot;changes&quot;: {}, &quot;result&quot;: False, &quot;comment&quot;: &quot;&quot;}

            change = {
                &quot;interface&quot;: &quot;--- \n+++ \n@@ -1 +1 @@\n-A\n+B&quot;,
                &quot;status&quot;: &quot;Interface salt restart to validate&quot;,
            }

            dunder_salt = {
                &quot;ip.get_interface&quot;: MagicMock(
                    side_effect=[AttributeError, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;]
                ),
                &quot;ip.build_interface&quot;: MagicMock(return_value=&quot;B&quot;),
                &quot;saltutil.refresh_grains&quot;: MagicMock(return_value=True),
            }

            with patch.dict(network.__salt__, dunder_salt):
                with patch.dict(
                    network.__salt__,
                    {&quot;ip.get_bond&quot;: MagicMock(side_effect=AttributeError)},
                ):
                    self.assertDictEqual(
                        network.managed(&quot;salt&quot;, type=&quot;bond&quot;, test=True), ret
                    )

                ret.update(
                    {
                        &quot;comment&quot;: (
                            &quot;Interface salt is set to be&quot;
                            &quot; updated:\n--- \n+++ \n@@ -1 +1 @@\n-A\n+B&quot;
                        ),
                        &quot;result&quot;: None,
                    }
                )
                self.assertDictEqual(
                    network.managed(&quot;salt&quot;, type=&quot;stack&quot;, test=True), ret
                )

                ipupdown = MagicMock(return_value=True)
                with patch.dict(
                    network.__salt__, {&quot;ip.down&quot;: ipupdown, &quot;ip.up&quot;: ipupdown}
                ):
                    ret.update(
                        {
                            &quot;comment&quot;: &quot;Interface salt updated.&quot;,
                            &quot;result&quot;: True,
                            &quot;changes&quot;: change,
                        }
                    )
                    self.assertDictEqual(network.managed(&quot;salt&quot;, type=&quot;stack&quot;), ret)

                    with patch.dict(network.__grains__, {&quot;A&quot;: True}):
                        ret.update(
                            {
                                &quot;result&quot;: True,
                                &quot;changes&quot;: {
                                    &quot;interface&quot;: &quot;--- \n+++ \n@@ -1 +1 @@\n-A\n+B&quot;,
                                    &quot;status&quot;: &quot;Interface salt down&quot;,
                                },
                            }
                        )
                        self.assertDictEqual(
<A NAME="1"></A>                            network.managed(&quot;salt&quot;, type=&quot;stack&quot;, enabled=False), ret
                        )

                    mock <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match6775-0.html#1',2,'match6775-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= MagicMock(return_value=True)
                    with patch.dict(network.__salt__, {&quot;ip.down&quot;: mock}):
                        with patch.dict(
                            network.__salt__, {&quot;saltutil.refresh_modules&quot;: mock}
                        ):
                            change = {
                                &quot;interface&quot;</B></FONT>: &quot;--- \n+++ \n@@ -1 +1 @@\n-A\n+B&quot;,
                                &quot;status&quot;: &quot;Interface lo:alias1 down&quot;,
                            }
                            ret.update(
                                {
                                    &quot;name&quot;: &quot;lo:alias1&quot;,
                                    &quot;comment&quot;: &quot;Interface lo:alias1 updated.&quot;,
                                    &quot;result&quot;: True,
                                    &quot;changes&quot;: change,
                                }
                            )
                            self.assertDictEqual(
                                network.managed(&quot;lo:alias1&quot;, type=&quot;eth&quot;, enabled=False),
                                ret,
                            )

    def test_routes(self):
        &quot;&quot;&quot;
        Test to manage network interface static routes.
        &quot;&quot;&quot;
        ret = {&quot;name&quot;: &quot;salt&quot;, &quot;changes&quot;: {}, &quot;result&quot;: False, &quot;comment&quot;: &quot;&quot;}

        mock = MagicMock(
            side_effect=[AttributeError, False, False, &quot;True&quot;, False, False]
        )
        with patch.dict(network.__salt__, {&quot;ip.get_routes&quot;: mock}):
            self.assertDictEqual(network.routes(&quot;salt&quot;), ret)

            mock = MagicMock(side_effect=[False, True, &quot;&quot;, True, True])
            with patch.dict(network.__salt__, {&quot;ip.build_routes&quot;: mock}):
                ret.update(
                    {&quot;result&quot;: True, &quot;comment&quot;: &quot;Interface salt routes are up to date.&quot;}
                )
                self.assertDictEqual(network.routes(&quot;salt&quot;, test=&quot;a&quot;), ret)

                ret.update(
                    {
                        &quot;comment&quot;: &quot;Interface salt routes are set to be added.&quot;,
                        &quot;result&quot;: None,
                    }
                )
                self.assertDictEqual(network.routes(&quot;salt&quot;, test=&quot;a&quot;), ret)

                ret.update(
                    {
                        &quot;comment&quot;: (
                            &quot;Interface salt routes are set to be&quot;
                            &quot; updated:\n--- \n+++ \n@@ -1,4 +0,0 @@\n-T\n-r&quot;
                            &quot;\n-u\n-e&quot;
                        )
                    }
                )
                self.assertDictEqual(network.routes(&quot;salt&quot;, test=&quot;a&quot;), ret)

                mock = MagicMock(side_effect=[AttributeError, True])
                with patch.dict(network.__salt__, {&quot;ip.apply_network_settings&quot;: mock}):
                    ret.update(
                        {
                            &quot;changes&quot;: {
                                &quot;network_routes&quot;: &quot;Added interface salt routes.&quot;
                            },
                            &quot;comment&quot;: &quot;&quot;,
                            &quot;result&quot;: False,
                        }
                    )
                    self.assertDictEqual(network.routes(&quot;salt&quot;), ret)

                    ret.update(
                        {
                            &quot;changes&quot;: {
                                &quot;network_routes&quot;: &quot;Added interface salt routes.&quot;
                            },
                            &quot;comment&quot;: &quot;Interface salt routes added.&quot;,
                            &quot;result&quot;: True,
                        }
                    )
                    self.assertDictEqual(network.routes(&quot;salt&quot;), ret)

    def test_system(self):
        &quot;&quot;&quot;
        Test to ensure that global network settings
        are configured properly
<A NAME="2"></A>        &quot;&quot;&quot;
        ret = {&quot;name&quot;: &quot;salt&quot;, &quot;changes&quot;: {}, &quot;result&quot;: False, &quot;comment&quot;: &quot;&quot;}

        <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match6775-0.html#2',2,'match6775-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>with patch.dict(network.__opts__, {&quot;test&quot;: True}):
            mock = MagicMock(side_effect=[AttributeError, False, False, &quot;As&quot;])
            with patch.dict(network.__salt__, {&quot;ip.get_network_settings&quot;</B></FONT>: mock}):
                self.assertDictEqual(network.system(&quot;salt&quot;), ret)

                mock = MagicMock(side_effect=[False, True, &quot;&quot;])
                with patch.dict(network.__salt__, {&quot;ip.build_network_settings&quot;: mock}):
                    ret.update(
                        {
                            &quot;comment&quot;: &quot;Global network settings are up to date.&quot;,
                            &quot;result&quot;: True,
                        }
                    )
                    self.assertDictEqual(network.system(&quot;salt&quot;), ret)

                    ret.update(
                        {
                            &quot;comment&quot;: &quot;Global network settings are set to be added.&quot;,
                            &quot;result&quot;: None,
                        }
                    )
                    self.assertDictEqual(network.system(&quot;salt&quot;), ret)

                    ret.update(
                        {
                            &quot;comment&quot;: (
                                &quot;Global network settings are set to&quot;
                                &quot; be updated:\n--- \n+++ \n@@ -1,2 +0,0&quot;
                                &quot; @@\n-A\n-s&quot;
<A NAME="0"></A>                            )
                        }
                    )
                    self.assertDictEqual(network.system(&quot;s<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match6775-0.html#0',2,'match6775-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>alt&quot;), ret)

        with patch.dict(network.__opts__, {&quot;test&quot;: False}):
            mock = MagicMock(side_effect=[False, False])
            with patch.dict(network.__salt__, {&quot;ip.get_network_settings&quot;: mock}):
                mock =</B></FONT> MagicMock(side_effect=[True, True])
                with patch.dict(network.__salt__, {&quot;ip.build_network_settings&quot;: mock}):
                    mock = MagicMock(side_effect=[AttributeError, True])
                    with patch.dict(
                        network.__salt__, {&quot;ip.apply_network_settings&quot;: mock}
                    ):
                        ret.update(
                            {
                                &quot;changes&quot;: {
                                    &quot;network_settings&quot;: &quot;Added global network settings.&quot;
                                },
                                &quot;comment&quot;: &quot;&quot;,
                                &quot;result&quot;: False,
                            }
                        )
                        self.assertDictEqual(network.system(&quot;salt&quot;), ret)

                        ret.update(
                            {
                                &quot;changes&quot;: {
                                    &quot;network_settings&quot;: &quot;Added global network settings.&quot;
                                },
                                &quot;comment&quot;: &quot;Global network settings are up to date.&quot;,
                                &quot;result&quot;: True,
                            }
                        )
                        self.assertDictEqual(network.system(&quot;salt&quot;), ret)
</PRE>
</div>
  </div>
</body>
</html>
