
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 7.011070110701106%, Tokens: 10</h2>
        <div class="column">
            <h3>esphome-docs-MDEwOlJlcG9zaXRvcnkxMzMyMjM0NjE=-flat-seo.py</h3>
            <pre><code>1  import re
2  from pathlib import Path
3  from docutils import nodes
4  from docutils.parsers.rst import Directive, directives
5  from docutils.writers._html_base import HTMLTranslator
6  class SEONode(nodes.General, nodes.Element):
7      def __init__(
8          self,
9          title=None,
10          description=None,
11          image=None,
12          author=None,
13          author_twitter=None,
14          keywords=None,
15      ):
16          super(SEONode, self).__init__()
17          self.title = title
18          self.description = description.replace("\n", " ")
19          self.image = image
20          self.author = author
21          self.author_twitter = author_twitter
22          self.keywords = keywords
23  class RedirectNode(nodes.General, nodes.Element):
24      def __init__(self, url=None):
25          super(RedirectNode, self).__init__()
26          self.url = url
27  def seo_visit(self: HTMLTranslator, node: SEONode):
28      def encode_text(text):
29          special_characters = {
30              ord("&"): "&amp;",
31              ord("<"): "&lt;",
32              ord('"'): "&quot;",
33              ord(">"): "&gt;",
34          }
35          return text.translate(special_characters)
36      def create_content_meta(name, content):
37          if content is None:
38              return
39          self.meta.append(
40              '<meta name="{}" content="{}">\n'.format(name, encode_text(content))
41          )
42      def create_itemprop_meta(name, content):
43          if content is None:
44              return
45          self.meta.append(
46              '<meta itemprop="{}" content="{}">\n'.format(name, encode_text(content))
47          )
48      def create_property_meta(name, content):
49          if content is None:
50              return
51          self.meta.append(
52              '<meta property="{}" content="{}">\n'.format(name, encode_text(content))
53          )
54      create_content_meta("description", node.description)
55      create_content_meta("keywords", node.keywords)
56      create_itemprop_meta("name", node.title)
57      create_itemprop_meta("description", node.description)
58      create_itemprop_meta("image", node.image)
59      create_content_meta("twitter:title", node.title)
60      create_content_meta("twitter:image:src", node.image)
61      if node.author:
62          create_content_meta("twitter:card", "summary_large_image")
63      else:
64          create_content_meta("twitter:card", "summary")
65      create_content_meta("twitter:site", "@OttoWinter_")
66      create_content_meta("twitter:creator", node.author_twitter)
67      create_content_meta("twitter:description", node.description)
68      create_property_meta("og:title", node.title)
69      create_property_meta("og:image", node.image)
70      create_property_meta("og:type", "article" if node.author is not None else "website")
71      create_property_meta("og:description", node.description)
72  def redirect_visit(self: HTMLTranslator, node: RedirectNode):
73      self.meta.append('<meta http-equiv="refresh" content="0; url={}">'.format(node.url))
74      self.body.append(
75          self.starttag(
76              node, "p", 'Redirecting to <a href="{0}">{0}</a>'.format(node.url)
77          )
78      )
79  def seo_depart(self, _):
80      pass
81  def redirect_depart(self, _):
82      self.body.append("</p>")
83  class SEODirective(Directive):
84      option_spec = {
85          "title": directives.unchanged,
86          "description": directives.unchanged,
87          "image": directives.path,
88          "author": directives.unchanged,
89          "author_twitter": directives.unchanged,
90          "keywords": directives.unchanged,
91      }
92      def run(self):
93          env = self.state.document.settings.env
94          title_match = re.match(r".+<title>(.+)</title>.+", str(self.state.document))
95          if title_match is not None and "title" not in self.options:
96              self.options["title"] = title_match.group(1)
97          image = self.options.get("image")
98          if image is not None:
99              local_img = image
100              if not image.startswith("/"):
101                  local_img = f"/images/{image}"
102                  image = "/_images/" + image
103              p = Path(__file__).parent / local_img[1:]
104              if not p.is_file():
105                  raise ValueError(f"File {p} for seo tag does not exist {self.state.document}")
106              if image.endswith(".svg"):
107                  image = image[:-len(".svg")] + ".png"
108              self.options["image"] = env.config.html_baseurl + image
109          return [SEONode(**self.options)]
110  class RedirectDirective(Directive):
111      option_spec = {
112          "url": directives.unchanged,
113      }
114      def run(self):
115          return [RedirectNode(**self.options)]
116  def setup(app):
<span onclick='openModal()' class='match'>117      app.add_directive("seo", SEODirective)
118      app.add_node(SEONode, html=(seo_visit, seo_depart))
119      app.add_directive("redirect", RedirectDirective)
120      app.add_node(RedirectNode, html=(redirect_visit, redirect_depart))
</span>121      return {"version": "1.0.0", "parallel_read_safe": True, "parallel_write_safe": True}
</code></pre>
        </div>
        <div class="column">
            <h3>sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-distributed_batch_norm_test.py</h3>
            <pre><code>1  from absl import logging
2  from absl.testing import parameterized
3  from sonnet.src import test_utils
4  from sonnet.src.distribute import distributed_batch_norm as batch_norm
5  from sonnet.src.distribute import replicator
6  import tensorflow as tf
7  class CrossReplicaBatchNormTest(test_utils.TestCase, parameterized.TestCase):
8    ENTER_PRIMARY_DEVICE = False
9    def testDefaultReplicaContext(self):
10      layer = batch_norm.CrossReplicaBatchNorm(False, False, TestMetric(),
11                                               TestMetric())
12      inputs = tf.ones([2, 3, 3, 5])
13      scale = tf.constant(0.5, shape=(5,))
14      offset = tf.constant(2.0, shape=(5,))
15      outputs = layer(inputs, True, scale=scale, offset=offset).numpy()
16      self.assertAllEqual(outputs, tf.fill(inputs.shape, 2.0))
17    def testWithMultipleDevicesMirrored(self):
18      if self.primary_device == "CPU":
19        self.skipTest("No devices to mirror across.")
20      elif self.primary_device == "GPU":
21        devices = tf.config.experimental.list_logical_devices("GPU")
22      else:
23        devices = tf.config.experimental.list_logical_devices("TPU")
24      strategy = replicator.Replicator([device.name for device in devices])
25      with strategy.scope():
26        mean_metric = TestMetric()
27        var_metric = TestMetric()
28        layer = batch_norm.CrossReplicaBatchNorm(False, False, mean_metric,
29                                                 var_metric)
30      scale = tf.constant(0.5, shape=(5,))
31      offset = tf.constant(2.0, shape=(5,))
32      def foo():
33        inputs = tf.random.normal([2, 3, 3, 5])
34        outputs = layer(inputs, True, False, scale, offset)
35        return inputs, outputs
36      inputs, outputs = strategy.run(foo)
37      local_mean_metric = strategy.experimental_local_results(mean_metric.value)
38      local_var_metric = strategy.experimental_local_results(var_metric.value)
39      self.assertAllEqual(local_mean_metric[0].numpy(),
40                          local_mean_metric[1].numpy())
41      self.assertAllEqual(local_var_metric[0].numpy(),
42                          local_var_metric[1].numpy())
43      mean = local_mean_metric[0]
44      var = local_var_metric[0]
45      for inp, out in zip(
<span onclick='openModal()' class='match'>46          strategy.experimental_local_results(inputs),
47          strategy.experimental_local_results(outputs)):
48        expected_out = (inp - mean) * tf.math.rsqrt(var + 1e-5) * scale + offset
49        self.assertAllClose(out, expected_out)
</span>50    def testWithTpuStrategy(self):
51      if self.primary_device != "TPU":
52        self.skipTest("TPU strategy only runs on TPU's")
53      strategy = replicator.TpuReplicator()
54      with strategy.scope():
55        mean_metric = TestMetric()
56        var_metric = TestMetric()
57        layer = batch_norm.CrossReplicaBatchNorm(False, False,
58                                                 mean_metric, var_metric)
59      scale = tf.constant(0.5, shape=(5,))
60      offset = tf.constant(2.0, shape=(5,))
61      @tf.function
62      def run():
63        def compute():
64          inputs = tf.ones([2, 3, 3, 5])
65          outputs = layer(inputs, True, False, scale, offset)
66          return inputs, outputs
67        return strategy.run(compute)
68      inputs, outputs = run()
69      local_mean_metric = strategy.experimental_local_results(mean_metric.value)
70      local_var_metric = strategy.experimental_local_results(var_metric.value)
71      self.assertAllEqual(local_mean_metric[0].numpy(),
72                          local_mean_metric[1].numpy())
73      self.assertAllEqual(local_var_metric[0].numpy(),
74                          local_var_metric[1].numpy())
75      mean = local_mean_metric[0]
76      var = local_var_metric[0]
77      for inp, out in zip(
78          strategy.experimental_local_results(inputs),
79          strategy.experimental_local_results(outputs)):
80        expected_out = (inp - mean) * tf.math.rsqrt(var + 1e-5) * scale + offset
81        self.assertAllClose(out, expected_out)
82  class TestMetric:
83    def __init__(self):
84      self._foo = None
85      self._built = False
86    def update(self, x):
87      if self._built:
88        self._foo.assign(x)
89      else:
90        self._foo = tf.Variable(x)
91        self._built = True
92    @property
93    def value(self):
94      return self._foo
95    def initialize(self, x):
96      self._foo = tf.Variable(x)
97      self._built = True
98  def setUpModule():
99    gpus = tf.config.experimental.list_physical_devices(device_type="GPU")
100    if len(gpus) == 1:
101      logging.info("Splitting one physical GPU into two logical GPUs.")
102      tf.config.experimental.set_virtual_device_configuration(
103          gpus[0], [
104              tf.config.experimental.VirtualDeviceConfiguration(
105                  memory_limit=1024),
106              tf.config.experimental.VirtualDeviceConfiguration(memory_limit=1024)
107          ])
108  if __name__ == "__main__":
109    tf.test.main()
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from esphome-docs-MDEwOlJlcG9zaXRvcnkxMzMyMjM0NjE=-flat-seo.py</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-distributed_batch_norm_test.py</div>
                </div>
                <div class="column column_space"><pre><code>117      app.add_directive("seo", SEODirective)
118      app.add_node(SEONode, html=(seo_visit, seo_depart))
119      app.add_directive("redirect", RedirectDirective)
120      app.add_node(RedirectNode, html=(redirect_visit, redirect_depart))
</pre></code></div>
                <div class="column column_space"><pre><code>46          strategy.experimental_local_results(inputs),
47          strategy.experimental_local_results(outputs)):
48        expected_out = (inp - mean) * tf.math.rsqrt(var + 1e-5) * scale + offset
49        self.assertAllClose(out, expected_out)
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    