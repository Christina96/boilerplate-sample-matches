<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_win_dotnet.py &amp; test_saltcheck.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_win_dotnet.py &amp; test_saltcheck.py
      </h3>
<h1 align="center">
        4.2%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_win_dotnet.py (17.834394%)<th>test_saltcheck.py (2.413793%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(83-103)<td><a href="#" name="0">(777-789)</a><td align="center"><font color="#ff0000">14</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(28-44)<td><a href="#" name="1">(893-926)</a><td align="center"><font color="#ff0000">14</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_win_dotnet.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.utils.platform
2 import salt.utils.win_dotnet as win_dotnet
3 from tests.support.mock import MagicMock, patch
4 from tests.support.unit import TestCase, skipIf
5 @skipIf(not salt.utils.platform.is_windows(), "System is not Windows")
6 class WinDotNetTestCase(TestCase):
7     def setUp(self):
8         self.mock_reg_list = MagicMock(
9             return_value=["CDF", "v2.0.50727", "v3.0", "v3.5", "v4", "v4.0"]
10         )
11         self.mock_reg_exists = MagicMock(
12             side_effect=[
13                 True,  # Version exists in v2.0.50727
14                 True,  # Version exists in v3.0
15                 True,  # Version exists in v3.5
16                 False,  # Version not in v4
17                 True,  # Release exists in v4
18                 False,  # Version not in v4.0
19             ]
20         )
21         self.mock_reg_read = MagicMock<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(
22             side_effect=[
23                 {"vdata": 1},
24                 {"vdata": "2.0.50727.4927"},
25                 {"vdata": 2},
26                 {"vdata": 1},
27                 {"vdata": "3.0.30729.4926"},
28                 {"vdata": 2},
29                 {"vdata": 1},
30                 {"vdata": "3.5.30729.4926"},
31                 {"vdata": 1},
32                 {"vdata": 1},
33                 {"vdata"</b></font>: 461814},
34             ]
35         )
36     def test_versions(self):
37         expected = {
38             "details": {
39                 "v2.0.50727": {
40                     "full": "2.0.50727.4927 SP2",
41                     "service_pack": 2,
42                     "version": "2.0.50727.4927",
43                 },
44                 "v3.0": {
45                     "full": "3.0.30729.4926 SP2",
46                     "service_pack": 2,
47                     "version": "3.0.30729.4926",
48                 },
49                 "v3.5": {
50                     "full": "3.5.30729.4926 SP1",
51                     "service_pack": 1,
52                     "version": "3.5.30729.4926",
53                 },
54                 "v4": {"full": "4.7.2", "service_pack": "N/A", "version": "4.7.2"},
55             },
56             "versions": ["2.0.50727.4927", "3.0.30729.4926", "3.5.30729.4926", "4.7.2"],
57         }
58         with patch("salt.utils.win_reg.list_keys", self.mock_reg_list), patch(
59             "salt.utils.win_reg.value_exists", self.mock_reg_exists
60         ), patch("salt.utils.win_reg.read_value", self.mock_reg_read):
61             result = win_dotnet.versions()
62             self.assertDictEqual(result, expected)
63     def test_versions_list(self):
64 <a name="0"></a>        expected = ["2.0.50727.4927", "3.0.30729.4926", "3.5.30729.4926", "4.7.2"]
65         with patch("salt.utils.win_reg.list_keys", self.mock_reg_list), patch(
66             "salt.utils.win_reg.value_exists", self.mock_reg_exists
67         ), patch("salt.utils.win_reg.read_value", self<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.mock_reg_read):
68             result = win_dotnet.versions_list()
69             self.assertListEqual(result, expected)
70     def test_versions_details(self):
71         expected = {
72             "v2.0.50727": {
73                 "full": "2.0.50727.4927 SP2",
74                 "service_pack": 2,
75                 "version": "2.0.50727.4927",
76             },
77             "v3.0": {
78                 "full": "3.0.30729.4926 SP2",
79                 "service_pack": 2,
80                 "version": "3.0.30729.4926",
81             },
82             "v3.5": {
83                 "full"</b></font>: "3.5.30729.4926 SP1",
84                 "service_pack": 1,
85                 "version": "3.5.30729.4926",
86             },
87             "v4": {"full": "4.7.2", "service_pack": "N/A", "version": "4.7.2"},
88         }
89         with patch("salt.utils.win_reg.list_keys", self.mock_reg_list), patch(
90             "salt.utils.win_reg.value_exists", self.mock_reg_exists
91         ), patch("salt.utils.win_reg.read_value", self.mock_reg_read):
92             result = win_dotnet.versions_details()
93             self.assertDictEqual(result, expected)
94     def test_version_atleast_35(self):
95         with patch("salt.utils.win_reg.list_keys", self.mock_reg_list), patch(
96             "salt.utils.win_reg.value_exists", self.mock_reg_exists
97         ), patch("salt.utils.win_reg.read_value", self.mock_reg_read):
98             self.assertTrue(win_dotnet.version_at_least("3.5"))
99     def test_version_atleast_47(self):
100         with patch("salt.utils.win_reg.list_keys", self.mock_reg_list), patch(
101             "salt.utils.win_reg.value_exists", self.mock_reg_exists
102         ), patch("salt.utils.win_reg.read_value", self.mock_reg_read):
103             self.assertTrue(win_dotnet.version_at_least("4.7"))
104     def test_version_atleast_472(self):
105         with patch("salt.utils.win_reg.list_keys", self.mock_reg_list), patch(
106             "salt.utils.win_reg.value_exists", self.mock_reg_exists
107         ), patch("salt.utils.win_reg.read_value", self.mock_reg_read):
108             self.assertTrue(win_dotnet.version_at_least("4.7.2"))
109     def test_version_not_atleast_473(self):
110         with patch("salt.utils.win_reg.list_keys", self.mock_reg_list), patch(
111             "salt.utils.win_reg.value_exists", self.mock_reg_exists
112         ), patch("salt.utils.win_reg.read_value", self.mock_reg_read):
113             self.assertFalse(win_dotnet.version_at_least("4.7.3"))
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_saltcheck.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import os.path
2 import pytest
3 import salt.config
4 import salt.modules.saltcheck as saltcheck
5 import salt.syspaths as syspaths
6 from tests.support.mixins import LoaderModuleMockMixin
7 from tests.support.mock import MagicMock, patch
8 from tests.support.unit import TestCase
9 class SaltcheckTestCase(TestCase, LoaderModuleMockMixin):
10     def setup_loader_modules(self):
11         local_opts = salt.config.minion_config(
12             os.path.join(syspaths.CONFIG_DIR, "minion")
13         )
14         local_opts["file_client"] = "local"
15         local_opts["conf_file"] = "/etc/salt/minion"
16         patcher = patch("salt.config.minion_config", MagicMock(return_value=local_opts))
17         patcher.start()
18         self.addCleanup(patcher.stop)
19         return {saltcheck: {"__opts__": local_opts}}
20     @pytest.mark.slow_test
21     def test_call_salt_command(self):
22         with patch.dict(
23             saltcheck.__salt__,
24             {
25                 "config.get": MagicMock(return_value=True),
26                 "sys.list_modules": MagicMock(return_value=["module1"]),
27                 "cp.cache_master": MagicMock(return_value=[True]),
28             },
29         ):
30             sc_instance = saltcheck.SaltCheck()
31             returned = sc_instance._call_salt_command(
32                 fun="test.echo", args=["hello"], kwargs=None
33             )
34             self.assertEqual(returned, "hello")
35     @pytest.mark.slow_test
36     def test_call_salt_command2(self):
37         with patch.dict(
38             saltcheck.__salt__,
39             {
40                 "config.get": MagicMock(return_value=True),
41                 "sys.list_modules": MagicMock(return_value=["module1"]),
42                 "cp.cache_master": MagicMock(return_value=[True]),
43             },
44         ):
45             sc_instance = saltcheck.SaltCheck()
46             returned = sc_instance._call_salt_command(
47                 fun="test.echo", args=["hello"], kwargs=None
48             )
49             self.assertNotEqual(returned, "not-hello")
50     def test_call_saltcheck_with_proxy(self):
51         with patch.dict(
52             saltcheck.__salt__,
53             {
54                 "config.get": MagicMock(return_value=True),
55                 "sys.list_modules": MagicMock(return_value=["module1"]),
56                 "cp.cache_master": MagicMock(return_value=[True]),
57             },
58         ), patch("salt.utils.platform.is_proxy", MagicMock(return_value=[True])):
59             ret, message = saltcheck.__virtual__()
60             self.assertFalse(ret)
61             self.assertEqual(
62                 message,
63                 "The saltcheck execution module failed to load: only available on"
64                 " minions.",
65             )
66     def test__assert_equal1(self):
67         with patch.dict(
68             saltcheck.__salt__,
69             {
70                 "config.get": MagicMock(return_value=True),
71                 "cp.cache_master": MagicMock(return_value=[True]),
72             },
73         ):
74             sc_instance = saltcheck.SaltCheck()
75             aaa = {"a": 1, "b": 2}
76             bbb = {"a": 1, "b": 2}
77             mybool = sc_instance._SaltCheck__assert_equal(aaa, bbb)
78             self.assertTrue(mybool)
79     def test__assert_equal2(self):
80         with patch.dict(
81             saltcheck.__salt__,
82             {
83                 "config.get": MagicMock(return_value=True),
84                 "cp.cache_master": MagicMock(return_value=[True]),
85             },
86         ):
87             sc_instance = saltcheck.SaltCheck()
88             mybool = sc_instance._SaltCheck__assert_equal(False, True)
89             self.assertNotEqual(mybool, True)
90     def test__assert_not_equal1(self):
91         with patch.dict(
92             saltcheck.__salt__,
93             {
94                 "config.get": MagicMock(return_value=True),
95                 "cp.cache_master": MagicMock(return_value=[True]),
96             },
97         ):
98             sc_instance = saltcheck.SaltCheck()
99             aaa = {"a": 1, "b": 2}
100             bbb = {"a": 1, "b": 2, "c": 3}
101             mybool = sc_instance._SaltCheck__assert_not_equal(aaa, bbb)
102             self.assertTrue(mybool)
103     def test__assert_not_equal2(self):
104         with patch.dict(
105             saltcheck.__salt__,
106             {
107                 "config.get": MagicMock(return_value=True),
108                 "cp.cache_master": MagicMock(return_value=[True]),
109             },
110         ):
111             sc_instance = saltcheck.SaltCheck()
112             aaa = {"a": 1, "b": 2}
113             bbb = {"a": 1, "b": 2}
114             mybool = sc_instance._SaltCheck__assert_not_equal(aaa, bbb)
115             self.assertNotEqual(mybool, True)
116     def test__assert_true1(self):
117         with patch.dict(
118             saltcheck.__salt__,
119             {
120                 "config.get": MagicMock(return_value=True),
121                 "cp.cache_master": MagicMock(return_value=[True]),
122             },
123         ):
124             sc_instance = saltcheck.SaltCheck()
125             mybool = sc_instance._SaltCheck__assert_equal(True, True)
126             self.assertTrue(mybool)
127     def test__assert_true2(self):
128         with patch.dict(
129             saltcheck.__salt__,
130             {
131                 "config.get": MagicMock(return_value=True),
132                 "cp.cache_master": MagicMock(return_value=[True]),
133             },
134         ):
135             sc_instance = saltcheck.SaltCheck()
136             mybool = sc_instance._SaltCheck__assert_equal(False, True)
137             self.assertNotEqual(mybool, True)
138     def test__assert_false1(self):
139         with patch.dict(
140             saltcheck.__salt__,
141             {
142                 "config.get": MagicMock(return_value=True),
143                 "cp.cache_master": MagicMock(return_value=[True]),
144             },
145         ):
146             sc_instance = saltcheck.SaltCheck()
147             mybool = sc_instance._SaltCheck__assert_false(False)
148             self.assertTrue(mybool)
149     def test__assert_false2(self):
150         with patch.dict(
151             saltcheck.__salt__,
152             {
153                 "config.get": MagicMock(return_value=True),
154                 "cp.cache_master": MagicMock(return_value=[True]),
155             },
156         ):
157             sc_instance = saltcheck.SaltCheck()
158             mybool = sc_instance._SaltCheck__assert_false(True)
159             self.assertNotEqual(mybool, True)
160     def test__assert_in1(self):
161         with patch.dict(
162             saltcheck.__salt__,
163             {
164                 "config.get": MagicMock(return_value=True),
165                 "cp.cache_master": MagicMock(return_value=[True]),
166             },
167         ):
168             sc_instance = saltcheck.SaltCheck()
169             aaa = "bob"
170             mylist = ["alice", "bob", "charles", "dana"]
171             mybool = sc_instance._SaltCheck__assert_in(aaa, mylist)
172             self.assertTrue(mybool, True)
173     def test__assert_in2(self):
174         with patch.dict(
175             saltcheck.__salt__,
176             {
177                 "config.get": MagicMock(return_value=True),
178                 "cp.cache_master": MagicMock(return_value=[True]),
179             },
180         ):
181             sc_instance = saltcheck.SaltCheck()
182             aaa = "elaine"
183             mylist = ["alice", "bob", "charles", "dana"]
184             mybool = sc_instance._SaltCheck__assert_in(aaa, mylist)
185             self.assertNotEqual(mybool, True)
186     def test__assert_not_in1(self):
187         with patch.dict(
188             saltcheck.__salt__,
189             {
190                 "config.get": MagicMock(return_value=True),
191                 "cp.cache_master": MagicMock(return_value=[True]),
192             },
193         ):
194             sc_instance = saltcheck.SaltCheck()
195             aaa = "elaine"
196             mylist = ["alice", "bob", "charles", "dana"]
197             mybool = sc_instance._SaltCheck__assert_not_in(aaa, mylist)
198             self.assertTrue(mybool, True)
199     def test__assert_not_in2(self):
200         with patch.dict(
201             saltcheck.__salt__,
202             {
203                 "config.get": MagicMock(return_value=True),
204                 "cp.cache_master": MagicMock(return_value=[True]),
205             },
206         ):
207             sc_instance = saltcheck.SaltCheck()
208             aaa = "bob"
209             mylist = ["alice", "bob", "charles", "dana"]
210             mybool = sc_instance._SaltCheck__assert_not_in(aaa, mylist)
211             self.assertNotEqual(mybool, True)
212     def test__assert_greater1(self):
213         with patch.dict(
214             saltcheck.__salt__,
215             {
216                 "config.get": MagicMock(return_value=True),
217                 "cp.cache_master": MagicMock(return_value=[True]),
218             },
219         ):
220             sc_instance = saltcheck.SaltCheck()
221             aaa = 110
222             bbb = 100
223             mybool = sc_instance._SaltCheck__assert_greater(aaa, bbb)
224             self.assertTrue(mybool, True)
225     def test__assert_greater2(self):
226         with patch.dict(
227             saltcheck.__salt__,
228             {
229                 "config.get": MagicMock(return_value=True),
230                 "cp.cache_master": MagicMock(return_value=[True]),
231             },
232         ):
233             sc_instance = saltcheck.SaltCheck()
234             aaa = 100
235             bbb = 110
236             mybool = sc_instance._SaltCheck__assert_greater(aaa, bbb)
237             self.assertNotEqual(mybool, True)
238     def test__assert_greater3(self):
239         with patch.dict(
240             saltcheck.__salt__,
241             {
242                 "config.get": MagicMock(return_value=True),
243                 "cp.cache_master": MagicMock(return_value=[True]),
244             },
245         ):
246             sc_instance = saltcheck.SaltCheck()
247             aaa = 100
248             bbb = 100
249             mybool = sc_instance._SaltCheck__assert_greater(aaa, bbb)
250             self.assertNotEqual(mybool, True)
251     def test__assert_greater_equal1(self):
252         with patch.dict(
253             saltcheck.__salt__,
254             {
255                 "config.get": MagicMock(return_value=True),
256                 "cp.cache_master": MagicMock(return_value=[True]),
257             },
258         ):
259             sc_instance = saltcheck.SaltCheck()
260             aaa = 110
261             bbb = 100
262             mybool = sc_instance._SaltCheck__assert_greater_equal(aaa, bbb)
263             self.assertTrue(mybool, True)
264     def test__assert_greater_equal2(self):
265         with patch.dict(
266             saltcheck.__salt__,
267             {
268                 "config.get": MagicMock(return_value=True),
269                 "cp.cache_master": MagicMock(return_value=[True]),
270             },
271         ):
272             sc_instance = saltcheck.SaltCheck()
273             aaa = 100
274             bbb = 110
275             mybool = sc_instance._SaltCheck__assert_greater_equal(aaa, bbb)
276             self.assertNotEqual(mybool, True)
277     def test__assert_greater_equal3(self):
278         with patch.dict(
279             saltcheck.__salt__,
280             {
281                 "config.get": MagicMock(return_value=True),
282                 "cp.cache_master": MagicMock(return_value=[True]),
283             },
284         ):
285             sc_instance = saltcheck.SaltCheck()
286             aaa = 100
287             bbb = 100
288             mybool = sc_instance._SaltCheck__assert_greater_equal(aaa, bbb)
289             self.assertEqual(mybool, "Pass")
290     def test__assert_less1(self):
291         with patch.dict(
292             saltcheck.__salt__,
293             {
294                 "config.get": MagicMock(return_value=True),
295                 "cp.cache_master": MagicMock(return_value=[True]),
296             },
297         ):
298             sc_instance = saltcheck.SaltCheck()
299             aaa = 99
300             bbb = 100
301             mybool = sc_instance._SaltCheck__assert_less(aaa, bbb)
302             self.assertTrue(mybool, True)
303     def test__assert_less2(self):
304         with patch.dict(
305             saltcheck.__salt__,
306             {
307                 "config.get": MagicMock(return_value=True),
308                 "cp.cache_master": MagicMock(return_value=[True]),
309             },
310         ):
311             sc_instance = saltcheck.SaltCheck()
312             aaa = 110
313             bbb = 99
314             mybool = sc_instance._SaltCheck__assert_less(aaa, bbb)
315             self.assertNotEqual(mybool, True)
316     def test__assert_less3(self):
317         with patch.dict(
318             saltcheck.__salt__,
319             {
320                 "config.get": MagicMock(return_value=True),
321                 "cp.cache_master": MagicMock(return_value=[True]),
322             },
323         ):
324             sc_instance = saltcheck.SaltCheck()
325             aaa = 100
326             bbb = 100
327             mybool = sc_instance._SaltCheck__assert_less(aaa, bbb)
328             self.assertNotEqual(mybool, True)
329     def test__assert_less_equal1(self):
330         with patch.dict(
331             saltcheck.__salt__,
332             {
333                 "config.get": MagicMock(return_value=True),
334                 "cp.cache_master": MagicMock(return_value=[True]),
335             },
336         ):
337             sc_instance = saltcheck.SaltCheck()
338             aaa = 99
339             bbb = 100
340             mybool = sc_instance._SaltCheck__assert_less_equal(aaa, bbb)
341             self.assertTrue(mybool, True)
342     def test__assert_less_equal2(self):
343         with patch.dict(
344             saltcheck.__salt__,
345             {
346                 "config.get": MagicMock(return_value=True),
347                 "cp.cache_master": MagicMock(return_value=[True]),
348             },
349         ):
350             sc_instance = saltcheck.SaltCheck()
351             aaa = 110
352             bbb = 99
353             mybool = sc_instance._SaltCheck__assert_less_equal(aaa, bbb)
354             self.assertNotEqual(mybool, True)
355     def test__assert_less_equal3(self):
356         with patch.dict(
357             saltcheck.__salt__,
358             {
359                 "config.get": MagicMock(return_value=True),
360                 "cp.cache_master": MagicMock(return_value=[True]),
361             },
362         ):
363             sc_instance = saltcheck.SaltCheck()
364             aaa = 100
365             bbb = 100
366             mybool = sc_instance._SaltCheck__assert_less_equal(aaa, bbb)
367             self.assertEqual(mybool, "Pass")
368     def test__assert_empty(self):
369         with patch.dict(
370             saltcheck.__salt__,
371             {
372                 "config.get": MagicMock(return_value=True),
373                 "cp.cache_master": MagicMock(return_value=[True]),
374             },
375         ):
376             sc_instance = saltcheck.SaltCheck()
377             mybool = sc_instance._SaltCheck__assert_empty("")
378             self.assertEqual(mybool, "Pass")
379     def test__assert_empty_fail(self):
380         with patch.dict(
381             saltcheck.__salt__,
382             {
383                 "config.get": MagicMock(return_value=True),
384                 "cp.cache_master": MagicMock(return_value=[True]),
385             },
386         ):
387             sc_instance = saltcheck.SaltCheck()
388             mybool = sc_instance._SaltCheck__assert_empty("data")
389             self.assertNotEqual(mybool, "Pass")
390     def test__assert__not_empty(self):
391         with patch.dict(
392             saltcheck.__salt__,
393             {
394                 "config.get": MagicMock(return_value=True),
395                 "cp.cache_master": MagicMock(return_value=[True]),
396             },
397         ):
398             sc_instance = saltcheck.SaltCheck()
399             mybool = sc_instance._SaltCheck__assert_not_empty("data")
400             self.assertEqual(mybool, "Pass")
401     def test__assert__not_empty_fail(self):
402         with patch.dict(
403             saltcheck.__salt__,
404             {
405                 "config.get": MagicMock(return_value=True),
406                 "cp.cache_master": MagicMock(return_value=[True]),
407             },
408         ):
409             sc_instance = saltcheck.SaltCheck()
410             mybool = sc_instance._SaltCheck__assert_not_empty("")
411             self.assertNotEqual(mybool, "Pass")
412     @pytest.mark.slow_test
413     def test_run_test_1(self):
414         with patch.dict(
415             saltcheck.__salt__,
416             {
417                 "config.get": MagicMock(return_value=True),
418                 "sys.list_modules": MagicMock(return_value=["test"]),
419                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
420                 "cp.cache_master": MagicMock(return_value=[True]),
421             },
422         ):
423             returned = saltcheck.run_test(
424                 test={
425                     "module_and_function": "test.echo",
426                     "assertion": "assertEqual",
427                     "expected_return": "This works!",
428                     "args": ["This works!"],
429                 }
430             )
431             self.assertEqual(returned["status"], "Pass")
432     def test_run_test_muliassert(self):
433         with patch.dict(
434             saltcheck.__salt__,
435             {
436                 "config.get": MagicMock(return_value=True),
437                 "sys.list_modules": MagicMock(return_value=["test"]),
438                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
439                 "cp.cache_master": MagicMock(return_value=[True]),
440             },
441         ):
442             returned = saltcheck.run_test(
443                 test={
444                     "module_and_function": "test.echo",
445                     "assertions": [
446                         {"assertion": "assertEqual", "expected_return": "This works!"},
447                         {"assertion": "assertEqual", "expected_return": "This works!"},
448                     ],
449                     "args": ["This works!"],
450                 }
451             )
452             self.assertEqual(returned["status"], "Pass")
453     def test_run_test_muliassert_failure(self):
454         with patch.dict(
455             saltcheck.__salt__,
456             {
457                 "config.get": MagicMock(return_value=True),
458                 "sys.list_modules": MagicMock(return_value=["test"]),
459                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
460                 "cp.cache_master": MagicMock(return_value=[True]),
461             },
462         ):
463             returned = saltcheck.run_test(
464                 test={
465                     "module_and_function": "test.echo",
466                     "assertions": [
467                         {"assertion": "assertEqual", "expected_return": "WRONG"},
468                         {"assertion": "assertEqual", "expected_return": "This works!"},
469                     ],
470                     "args": ["This works!"],
471                 }
472             )
473             self.assertEqual(returned["status"], "Fail")
474     def test_report_highstate_tests(self):
475         expected_output = {
476             "TEST REPORT RESULTS": {
477                 "States missing tests": ["state1"],
478                 "Missing Tests": 1,
479                 "States with tests": ["found"],
480             }
481         }
482         with patch("salt.modules.saltcheck._get_top_states") as mocked_get_top:
483             mocked_get_top.return_value = ["state1", "found"]
484             with patch("salt.modules.saltcheck.StateTestLoader") as mocked_stl:
485                 instance = mocked_stl.return_value
486                 instance.found_states = ["found"]
487                 returned = saltcheck.report_highstate_tests()
488                 self.assertEqual(returned, expected_output)
489     def test_validation(self):
490         sc_instance = saltcheck.SaltCheck()
491         test_dict = {}
492         expected_return = False
493         val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
494         self.assertEqual(val_ret, expected_return)
495         test_dict = {
496             "module_and_function": "test.echo",
497             "args": ["hello"],
498             "kwargs": {},
499             "assertion": "assertEqual",
500             "expected_return": "hello",
501         }
502         expected_return = True
503         with patch.dict(
504             saltcheck.__salt__,
505             {
506                 "sys.list_modules": MagicMock(return_value=["test"]),
507                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
508             },
509         ):
510             val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
511             self.assertEqual(val_ret, expected_return)
512         test_dict = {
513             "module_and_function": "test.echo",
514             "args": ["hello"],
515             "kwargs": {},
516             "assertion": "assertEqual",
517             "expected-return": "hello",
518         }
519         expected_return = True
520         with patch.dict(
521             saltcheck.__salt__,
522             {
523                 "sys.list_modules": MagicMock(return_value=["test"]),
524                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
525             },
526         ):
527             val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
528             self.assertEqual(val_ret, expected_return)
529         assertions = ["assertEmpty", "assertNotEmpty", "assertTrue", "assertFalse"]
530         for assertion in assertions:
531             test_dict = {"module_and_function": "test.echo", "args": ["hello"]}
532             test_dict["assertion"] = assertion
533             expected_return = True
534             with patch.dict(
535                 saltcheck.__salt__,
536                 {
537                     "sys.list_modules": MagicMock(return_value=["test"]),
538                     "sys.list_functions": MagicMock(return_value=["test.echo"]),
539                 },
540             ):
541                 val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
542                 self.assertEqual(val_ret, expected_return)
543         test_dict = {
544             "module_and_function": "broken.echo",
545             "args": ["hello"],
546             "kwargs": {},
547             "assertion": "assertEqual",
548             "expected_return": "hello",
549         }
550         expected_return = False
551         with patch.dict(
552             saltcheck.__salt__,
553             {
554                 "sys.list_modules": MagicMock(return_value=["test"]),
555                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
556             },
557         ):
558             val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
559             self.assertEqual(val_ret, expected_return)
560         test_dict = {
561             "module_and_function": "test.broken",
562             "args": ["hello"],
563             "kwargs": {},
564             "assertion": "assertEqual",
565             "expected_return": "hello",
566         }
567         expected_return = False
568         with patch.dict(
569             saltcheck.__salt__,
570             {
571                 "sys.list_modules": MagicMock(return_value=["test"]),
572                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
573             },
574         ):
575             val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
576             self.assertEqual(val_ret, expected_return)
577         test_dict = {
578             "module_and_function": "test.echo",
579             "args": ["hello"],
580             "kwargs": {},
581             "assertion": "assertEqual",
582         }
583         expected_return = False
584         with patch.dict(
585             saltcheck.__salt__,
586             {
587                 "sys.list_modules": MagicMock(return_value=["test"]),
588                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
589             },
590         ):
591             val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
592             self.assertEqual(val_ret, expected_return)
593         test_dict = {
594             "module_and_function": "test.echo",
595             "args": ["hello"],
596             "kwargs": {},
597             "assertion": "assertEqual",
598             "expected_return": None,
599         }
600         expected_return = False
601         with patch.dict(
602             saltcheck.__salt__,
603             {
604                 "sys.list_modules": MagicMock(return_value=["test"]),
605                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
606             },
607         ):
608             val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
609             self.assertEqual(val_ret, expected_return)
610         test_dict = {"module_and_function": "saltcheck.state_apply", "args": ["common"]}
611         expected_return = True
612         with patch.dict(
613             saltcheck.__salt__,
614             {
615                 "sys.list_modules": MagicMock(return_value=["saltcheck"]),
616                 "sys.list_functions": MagicMock(return_value=["saltcheck.state_apply"]),
617             },
618         ):
619             val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
620             self.assertEqual(val_ret, expected_return)
621         test_dict = {
622             "module_and_function": "test.echo",
623             "args": ["somearg"],
624             "assertions": [
625                 {
626                     "assertion": "assertEqual",
627                     "assertion_section": "0:program",
628                     "expected_return": "systemd-resolve",
629                 },
630                 {
631                     "assertion": "assertEqual",
632                     "assertion_section": "0:proto",
633                     "expected_return": "udp",
634                 },
635             ],
636         }
637         expected_return = True
638         with patch.dict(
639             saltcheck.__salt__,
640             {
641                 "sys.list_modules": MagicMock(return_value=["test"]),
642                 "sys.list_functions": MagicMock(return_value=["test.echo"]),
643             },
644         ):
645             val_ret = sc_instance._SaltCheck__is_valid_test(test_dict)
646             self.assertEqual(val_ret, expected_return)
647     def test_sls_path_generation(self):
648         with patch.dict(
649             saltcheck.__salt__,
650             {"config.get": MagicMock(return_value="saltcheck-tests")},
651         ):
652             testLoader = saltcheck.StateTestLoader()
653             state_name = "teststate"
654             expected_return = [
655                 "salt://teststate/saltcheck-tests",
656                 "salt:///saltcheck-tests",
657             ]
658             ret = testLoader._generate_sls_path(state_name)
659             self.assertEqual(ret, expected_return)
660             state_name = "teststate.long.path"
661             expected_return = [
662                 "salt://teststate/long/path/saltcheck-tests",
663                 "salt://teststate/long/saltcheck-tests",
664                 "salt://teststate/saltcheck-tests",
665             ]
666             ret = testLoader._generate_sls_path(state_name)
667             self.assertEqual(ret, expected_return)
668 <a name="0"></a>
669             state_name = "teststate.really.long.path"
670             expected_return = [
671                 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>"salt://teststate/really/long/path/saltcheck-tests",
672                 "salt://teststate/really/long/saltcheck-tests",
673                 "salt://teststate/saltcheck-tests",
674             ]
675             ret = testLoader._generate_sls_path(state_name)
676             self.assertEqual(ret, expected_return)
677     def test_generate_output(self):
678         sc_results = {
679             "a_state": {
680                 "test_id1": {"status": "Pass", "duration": 1.987},
681                 "test_id2": {"status"</b></font>: "Pass", "duration": 1.123},
682             }
683         }
684         expected_output = [
685             {
686                 "a_state": {
687                     "test_id1": {"status": "Pass", "duration": 1.987},
688                     "test_id2": {"status": "Pass", "duration": 1.123},
689                 }
690             },
691             {
692                 "TEST RESULTS": {
693                     "Execution Time": 3.11,
694                     "Passed": 2,
695                     "Failed": 0,
696                     "Skipped": 0,
697                     "Missing Tests": 0,
698                 }
699             },
700         ]
701         ret = saltcheck._generate_out_list(sc_results)
702         self.assertEqual(ret, expected_output)
703         sc_results = {
704             "a_state": {
705                 "test_id1": {"status": "Skip", "duration": 1.987},
706                 "test_id2": {"status": "Pass", "duration": 1.123},
707             }
708         }
709         expected_output = [
710             {
711                 "a_state": {
712                     "test_id1": {"status": "Skip", "duration": 1.987},
713                     "test_id2": {"status": "Pass", "duration": 1.123},
714                 }
715             },
716             {
717                 "TEST RESULTS": {
718                     "Execution Time": 3.11,
719                     "Passed": 1,
720                     "Failed": 0,
721                     "Skipped": 1,
722                     "Missing Tests": 0,
723                 }
724             },
725         ]
726         ret = saltcheck._generate_out_list(sc_results)
727         self.assertEqual(ret, expected_output)
728         sc_results = {
729             "a_state": {
730                 "test_id1": {"status": "Failed", "duration": 1.987},
731                 "test_id2": {"status": "Pass", "duration": 1.123},
732             }
733         }
734         expected_output = [
735             {
736                 "a_state": {
737                     "test_id1": {"status": "Failed", "duration": 1.987},
738                     "test_id2": {"status": "Pass", "duration": 1.123},
739                 }
740             },
741             {
742                 "TEST RESULTS": {
743                     "Execution Time": 3.11,
744                     "Passed": 1,
745                     "Failed": 1,
746                     "Skipped": 0,
747                     "Missing Tests": 0,
748                 }
749             },
750         ]
751         ret = saltcheck._generate_out_list(sc_results)
752         self.assertEqual(ret, expected_output)
753         sc_results = {
754             "a_state": {
755                 "test_id1": {"status": "Pass", "duration": 1.987},
756                 "test_id2": {"status": "Pass", "duration": 1.123},
757             },
758             "b_state": {},
759         }
760         expected_output = [
761             {
762                 "a_state": {
763                     "test_id1": {"status": "Pass", "duration": 1.987},
764                     "test_id2": {"status": "Pass", "duration": 1.123},
765                 }
766             },
767             {"b_state": {}},
768             {
769                 "TEST RESULTS": {
770                     "Execution Time": 3.11,
771                     "Passed": 2,
772                     "Failed": 0,
773                     "Skipped": 0,
774                     "Missing Tests": 1,
775                 }
776 <a name="1"></a>            },
777         ]
778         ret = saltcheck._generate_out_list(sc_results)
779         self.assertEqual<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>(ret, expected_output)
780         sc_results = {
781             "a_state": {
782                 "test_id1": {
783                     "assertion1": {
784                         "status": "Pass",
785                         "module.function [args]": 'cmd.run ["ls /etc/salt/master"]',
786                         "saltcheck assertion": "IS NOT EMPTY /etc/salt/master",
787                     },
788                     "assertion2": {
789                         "status": "Pass",
790                         "module.function [args]": 'cmd.run ["ls /etc/salt/master"]',
791                         "saltcheck assertion": "master IN /etc/salt/master",
792                     },
793                     "status": "Pass",
794                     "duration": 1.4383,
795                 },
796                 "test_id2": {
797                     "assertion1": {"status": "Fail: /etc/salt/master is not empty"},
798                     "status": "Fail",
799                     "duration": 0.308,
800                 },
801                 "test_id3": {
802                     "assertion1": {"status": "Fail: /etc/salt/master is not empty"},
803                     "status": "Fail",
804                     "duration": 0.3073,
805                 },
806             },
807             "b_state": {
808                 "test_id4": {
809                     "assertion1": {
810                         "status"</b></font>: "Pass",
811                         "module.function [args]": 'cmd.run ["ls /etc/salt/master"]',
812                         "saltcheck assertion": "IS NOT EMPTY /etc/salt/master",
813                     },
814                     "assertion2": {
815                         "status": "Pass",
816                         "module.function [args]": 'cmd.run ["ls /etc/salt/master"]',
817                         "saltcheck assertion": "master IN /etc/salt/master",
818                     },
819                     "status": "Pass",
820                     "duration": 0.3057,
821                 },
822                 "test_id5": {
823                     "assertion1": {"status": "Fail: /etc/salt/master is not empty"},
824                     "status": "Fail",
825                     "duration": 0.3066,
826                 },
827                 "test_id6": {
828                     "assertion1": {"status": "Fail: /etc/salt/master is not empty"},
829                     "status": "Fail",
830                     "duration": 0.3076,
831                 },
832             },
833         }
834         expected_output = [
835             {
836                 "a_state": {
837                     "test_id2": {
838                         "assertion1": {"status": "Fail: /etc/salt/master is not empty"},
839                         "status": "Fail",
840                         "duration": 0.308,
841                     },
842                     "test_id3": {
843                         "assertion1": {"status": "Fail: /etc/salt/master is not empty"},
844                         "status": "Fail",
845                         "duration": 0.3073,
846                     },
847                 }
848             },
849             {
850                 "b_state": {
851                     "test_id5": {
852                         "assertion1": {"status": "Fail: /etc/salt/master is not empty"},
853                         "status": "Fail",
854                         "duration": 0.3066,
855                     },
856                     "test_id6": {
857                         "assertion1": {"status": "Fail: /etc/salt/master is not empty"},
858                         "status": "Fail",
859                         "duration": 0.3076,
860                     },
861                 }
862             },
863             {
864                 "TEST RESULTS": {
865                     "Execution Time": 2.9735,
866                     "Passed": 2,
867                     "Failed": 4,
868                     "Skipped": 0,
869                     "Missing Tests": 0,
870                 }
871             },
872         ]
873         ret = saltcheck._generate_out_list(sc_results, only_fails=True)
874         self.assertEqual(ret, expected_output)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
