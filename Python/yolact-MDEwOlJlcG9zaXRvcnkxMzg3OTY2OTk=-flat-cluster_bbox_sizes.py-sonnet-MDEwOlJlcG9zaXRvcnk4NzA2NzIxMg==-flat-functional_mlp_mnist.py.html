
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 15.942028985507244%, Tokens: 13</h2>
        <div class="column">
            <h3>yolact-MDEwOlJlcG9zaXRvcnkxMzg3OTY2OTk=-flat-cluster_bbox_sizes.py</h3>
            <pre><code>1  import os.path as osp
2  import json, pickle
3  import sys
4  import numpy as np
5  import sklearn.cluster as cluster
6  dump_file = 'weights/bboxes.pkl'
7  max_size = 550
8  num_scale_clusters = 5
9  num_aspect_ratio_clusters = 3
10  def to_relative(bboxes):
11  	return bboxes[:, 2:4] / bboxes[:, :2]
12  def process(bboxes):
13  	return to_relative(bboxes) * max_size
14  if __name__ == '__main__':
15  	with open(dump_file, 'rb') as f:
16  		bboxes = pickle.load(f)
17  	bboxes = np.array(bboxes)
18  	bboxes = process(bboxes)
19  	bboxes = bboxes[(bboxes[:, 0] > 1) * (bboxes[:, 1] > 1)]
20  	scale  = np.sqrt(bboxes[:, 0] * bboxes[:, 1]).reshape(-1, 1)
<span onclick='openModal()' class='match'>21  	clusterer = cluster.KMeans(num_scale_clusters, random_state=99, n_jobs=4)
22  	assignments = clusterer.fit_predict(scale)
23  	counts = np.bincount(assignments)
24  	cluster_centers = clusterer.cluster_centers_
</span>25  	center_indices = list(range(num_scale_clusters))
26  	center_indices.sort(key=lambda x: cluster_centers[x, 0])
27  	for idx in center_indices:
28  		center = cluster_centers[idx, 0]
29  		boxes_for_center = bboxes[assignments == idx]
30  		aspect_ratios = (boxes_for_center[:,0] / boxes_for_center[:,1]).reshape(-1, 1)
31  		c = cluster.KMeans(num_aspect_ratio_clusters, random_state=idx, n_jobs=4)
32  		ca = c.fit_predict(aspect_ratios)
33  		cc = np.bincount(ca)
34  		c = list(c.cluster_centers_.reshape(-1))
35  		cidx = list(range(num_aspect_ratio_clusters))
36  		cidx.sort(key=lambda x: -cc[x])
37  		print('%.3f (%d) aspect ratios:' % (center, counts[idx]))
38  		for idx in cidx:
39  			print('\t%.2f (%d)' % (c[idx], cc[idx]))
40  		print()
</code></pre>
        </div>
        <div class="column">
            <h3>sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-functional_mlp_mnist.py</h3>
            <pre><code>1  from absl import app
2  from absl import logging
3  import sonnet as snt
4  import tensorflow as tf
5  import tensorflow_datasets as tfds
6  fn = snt.functional
7  def main(unused_argv):
8    del unused_argv
9    with fn.variables():
10      net = snt.nets.MLP([1000, 100, 10])
11    def loss_fn(images, labels):
12      images = snt.flatten(images)
13      logits = net(images)
14      loss = tf.reduce_mean(
15          tf.nn.sparse_softmax_cross_entropy_with_logits(labels=labels,
16                                                         logits=logits))
17      return loss
18    loss_fn = fn.transform(loss_fn)
19    def preprocess(images, labels):
20      images = tf.image.convert_image_dtype(images, tf.float32)
21      return images, labels
22    batch_size = 100
<span onclick='openModal()' class='match'>23    dataset = tfds.load("mnist", split="train", as_supervised=True)
24    dataset = dataset.map(preprocess)
25    dataset = dataset.cache()
26    dataset = dataset.shuffle(batch_size * 8)
</span>27    dataset = dataset.batch(batch_size, drop_remainder=True)
28    dataset = dataset.prefetch()
29    optimizer = fn.adam(0.01)
30    images, labels = next(iter(dataset))
31    params = fn.device_put(loss_fn.init(images, labels))
32    opt_state = fn.device_put(optimizer.init(params))
33    grad_apply_fn = fn.jit(fn.value_and_grad(loss_fn.apply))
34    apply_opt_fn = fn.jit(optimizer.apply)
35    for epoch in range(10):
36      for images, labels in dataset:
37        loss, grads = grad_apply_fn(params, images, labels)
38        params, opt_state = apply_opt_fn(opt_state, grads, params)
39      logging.info("[Epoch %s] loss=%s", epoch, loss.numpy())
40    def accuracy_fn(images, labels):
41      images = snt.flatten(images)
42      predictions = tf.argmax(net(images), axis=1)
43      correct = tf.math.count_nonzero(tf.equal(predictions, labels))
44      total = tf.shape(labels)[0]
45      return correct, total
46    accuracy_fn = fn.transform(accuracy_fn)
47    batch_size = 10000
48    dataset = tfds.load("mnist", split="test", as_supervised=True)
49    dataset = dataset.batch(batch_size, drop_remainder=True)
50    dataset = dataset.map(preprocess)
51    apply_fn = fn.jit(accuracy_fn.apply)
52    num_correct = num_total = 0
53    for images, labels in dataset:
54      correct, total = apply_fn(params, images, labels)
55      num_correct += correct
56      num_total += total
57    accuracy = (int(num_correct) / int(num_total)) * 100
58    logging.info("Accuracy %.5f%%", accuracy)
59  if __name__ == "__main__":
60    app.run(main)
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from yolact-MDEwOlJlcG9zaXRvcnkxMzg3OTY2OTk=-flat-cluster_bbox_sizes.py</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-functional_mlp_mnist.py</div>
                </div>
                <div class="column column_space"><pre><code>21  	clusterer = cluster.KMeans(num_scale_clusters, random_state=99, n_jobs=4)
22  	assignments = clusterer.fit_predict(scale)
23  	counts = np.bincount(assignments)
24  	cluster_centers = clusterer.cluster_centers_
</pre></code></div>
                <div class="column column_space"><pre><code>23    dataset = tfds.load("mnist", split="train", as_supervised=True)
24    dataset = dataset.map(preprocess)
25    dataset = dataset.cache()
26    dataset = dataset.shuffle(batch_size * 8)
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    