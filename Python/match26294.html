<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_macpackage_1.py & test_lvm.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_macpackage_1.py & test_lvm.py
      </h3>
      <h1 align="center">
        8.7%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_macpackage_1.py (10.989011%)<TH>test_lvm.py (7.207207%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match26294-0.html#0',2,'match26294-1.html#0',3)" NAME="0">(125-129)<TD><A HREF="javascript:ZweiFrames('match26294-0.html#0',2,'match26294-1.html#0',3)" NAME="0">(187-210)</A><TD ALIGN=center><FONT COLOR="#ff0000">15</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match26294-0.html#1',2,'match26294-1.html#1',3)" NAME="1">(245-248)<TD><A HREF="javascript:ZweiFrames('match26294-0.html#1',2,'match26294-1.html#1',3)" NAME="1">(224-228)</A><TD ALIGN=center><FONT COLOR="#dd0000">13</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match26294-0.html#2',2,'match26294-1.html#2',3)" NAME="2">(261-264)<TD><A HREF="javascript:ZweiFrames('match26294-0.html#2',2,'match26294-1.html#2',3)" NAME="2">(257-260)</A><TD ALIGN=center><FONT COLOR="#cc0000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_macpackage_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
import pytest
import salt.modules.macpackage as macpackage
from tests.support.mock import MagicMock, call, patch


@pytest.fixture
def configure_loader_modules():
    return {macpackage: {}}


def test_install():
    &quot;&quot;&quot;
    Test installing a PKG file
    &quot;&quot;&quot;
    mock = MagicMock()
    with patch.dict(macpackage.__salt__, {&quot;cmd.run_all&quot;: mock}):
        macpackage.install(&quot;/path/to/file.pkg&quot;)
        mock.assert_called_once_with(
            &quot;installer -pkg /path/to/file.pkg -target LocalSystem&quot;,
            python_shell=False,
        )


def test_install_wildcard():
    &quot;&quot;&quot;
    Test installing a PKG file with a wildcard
    &quot;&quot;&quot;
    mock = MagicMock()
    with patch.dict(macpackage.__salt__, {&quot;cmd.run_all&quot;: mock}):
        macpackage.install(&quot;/path/to/*.pkg&quot;)
        mock.assert_called_once_with(
            &quot;installer -pkg /path/to/*.pkg -target LocalSystem&quot;, python_shell=True
        )


def test_install_with_extras():
    &quot;&quot;&quot;
    Test installing a PKG file with extra options
    &quot;&quot;&quot;
    mock = MagicMock()
    with patch.dict(macpackage.__salt__, {&quot;cmd.run_all&quot;: mock}):
        macpackage.install(&quot;/path/to/file.pkg&quot;, store=True, allow_untrusted=True)
        mock.assert_called_once_with(
            &quot;installer -pkg /path/to/file.pkg -target LocalSystem -store&quot;
            &quot; -allowUntrusted&quot;,
            python_shell=False,
        )


def test_install_app():
    &quot;&quot;&quot;
    Test installing an APP package
    &quot;&quot;&quot;
    mock = MagicMock()
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        macpackage.install_app(&quot;/path/to/file.app&quot;)
        mock.assert_called_once_with(
            'rsync -a --delete &quot;/path/to/file.app/&quot; &quot;/Applications/file.app&quot;'
        )


def test_install_app_specify_target():
    &quot;&quot;&quot;
    Test installing an APP package with a specific target
    &quot;&quot;&quot;
    mock = MagicMock()
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        macpackage.install_app(&quot;/path/to/file.app&quot;, &quot;/Applications/new.app&quot;)
        mock.assert_called_once_with(
            'rsync -a --delete &quot;/path/to/file.app/&quot; &quot;/Applications/new.app&quot;'
        )


def test_install_app_with_slash():
    &quot;&quot;&quot;
    Test installing an APP package with a specific target
    &quot;&quot;&quot;
    mock = MagicMock()
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        macpackage.install_app(&quot;/path/to/file.app/&quot;)
        mock.assert_called_once_with(
            'rsync -a --delete &quot;/path/to/file.app/&quot; &quot;/Applications/file.app&quot;'
        )


def test_uninstall():
    &quot;&quot;&quot;
    Test Uninstalling an APP package with a specific target
    &quot;&quot;&quot;
    mock = MagicMock()
    with patch.dict(macpackage.__salt__, {&quot;file.remove&quot;: mock}):
        macpackage.uninstall_app(&quot;/path/to/file.app&quot;)
        mock.assert_called_once_with(&quot;/path/to/file.app&quot;)


def test_mount():
    &quot;&quot;&quot;
    Test mounting an dmg file to a temporary location
    &quot;&quot;&quot;
    cmd_mock = MagicMock()
    temp_mock = MagicMock(return_value=&quot;dmg-ABCDEF&quot;)
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: cmd_mock, &quot;temp.dir&quot;: temp_mock}):
        macpackage.mount(&quot;/path/to/file.dmg&quot;)
        temp_mock.assert_called_once_with(prefix=&quot;dmg-&quot;)
        cmd_mock.assert_called_once_with(
            &quot;hdiutil attach -readonly -nobrowse -mountpoint &quot;
            'dmg-ABCDEF &quot;/path/to/file.dmg&quot;'
        )


def test_unmount():
    &quot;&quot;&quot;
    Test Unmounting an dmg file to a temporary location
    &quot;&quot;&quot;
    mock = MagicMock()
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        macpackage.unmount(&quot;/path/to/file.dmg&quot;)
        mock.assert_called_once_with('hdiutil detach &quot;/path/to/file.dmg&quot;')


def test_installed_pkgs():
<A NAME="0"></A>    &quot;&quot;&quot;
    Test getting a list of the installed packages
    &quot;&quot;&quot;
    expected <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match26294-1.html#0',3,'match26294-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= [&quot;com.apple.this&quot;, &quot;com.salt.that&quot;]
    mock = MagicMock(return_value=&quot;com.apple.this\ncom.salt.that&quot;)
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        out = macpackage.installed_pkgs()
        mock.assert_called_once_with(</B></FONT>&quot;pkgutil --pkgs&quot;)
        assert out == expected


def test_get_pkg_id_with_files():
    &quot;&quot;&quot;
    Test getting a the id for a package
    &quot;&quot;&quot;
    with patch(
        &quot;salt.modules.macpackage._get_pkg_id_from_pkginfo&quot;
    ) as pkg_id_pkginfo_mock:
        expected = [&quot;com.apple.this&quot;]
        cmd_mock = MagicMock(
            side_effect=[
                &quot;/path/to/PackageInfo\n/path/to/some/other/fake/PackageInfo&quot;,
                &quot;&quot;,
                &quot;&quot;,
            ]
        )
        pkg_id_pkginfo_mock.side_effect = [[&quot;com.apple.this&quot;], []]
        temp_mock = MagicMock(return_value=&quot;/tmp/dmg-ABCDEF&quot;)
        remove_mock = MagicMock()

        with patch.dict(
            macpackage.__salt__,
            {
                &quot;cmd.run&quot;: cmd_mock,
                &quot;temp.dir&quot;: temp_mock,
                &quot;file.remove&quot;: remove_mock,
            },
        ):
            out = macpackage.get_pkg_id(&quot;/path/to/file.pkg&quot;)

            temp_mock.assert_called_once_with(prefix=&quot;pkg-&quot;)
            cmd_calls = [
                call(
                    &quot;xar -t -f /path/to/file.pkg | grep PackageInfo&quot;,
                    python_shell=True,
                    output_loglevel=&quot;quiet&quot;,
                ),
                call(
                    &quot;xar -x -f /path/to/file.pkg /path/to/PackageInfo&quot;
                    &quot; /path/to/some/other/fake/PackageInfo&quot;,
                    cwd=&quot;/tmp/dmg-ABCDEF&quot;,
                    output_loglevel=&quot;quiet&quot;,
                ),
            ]
            cmd_mock.assert_has_calls(cmd_calls)

            pkg_id_pkginfo_calls = [
                call(&quot;/path/to/PackageInfo&quot;),
                call(&quot;/path/to/some/other/fake/PackageInfo&quot;),
            ]
            pkg_id_pkginfo_mock.assert_has_calls(pkg_id_pkginfo_calls)
            remove_mock.assert_called_once_with(&quot;/tmp/dmg-ABCDEF&quot;)

            assert out == expected


def test_get_pkg_id_with_dir():
    &quot;&quot;&quot;
    Test getting a the id for a package with a directory
    &quot;&quot;&quot;
    with patch(&quot;salt.modules.macpackage._get_pkg_id_dir&quot;) as pkg_id_dir_mock:
        expected = [&quot;com.apple.this&quot;]
        pkg_id_dir_mock.return_value = [&quot;com.apple.this&quot;]
        cmd_mock = MagicMock(return_value=&quot;Error opening /path/to/file.pkg&quot;)
        temp_mock = MagicMock(return_value=&quot;/tmp/dmg-ABCDEF&quot;)
        remove_mock = MagicMock()

        with patch.dict(
            macpackage.__salt__,
            {
                &quot;cmd.run&quot;: cmd_mock,
                &quot;temp.dir&quot;: temp_mock,
                &quot;file.remove&quot;: remove_mock,
            },
        ):
            out = macpackage.get_pkg_id(&quot;/path/to/file.pkg&quot;)

            temp_mock.assert_called_once_with(prefix=&quot;pkg-&quot;)
            cmd_mock.assert_called_once_with(
                &quot;xar -t -f /path/to/file.pkg | grep PackageInfo&quot;,
                python_shell=True,
                output_loglevel=&quot;quiet&quot;,
            )
            pkg_id_dir_mock.assert_called_once_with(&quot;/path/to/file.pkg&quot;)
            remove_mock.assert_called_once_with(&quot;/tmp/dmg-ABCDEF&quot;)

            assert out == expected


def test_get_mpkg_ids():
    &quot;&quot;&quot;
    Test getting the ids of a mpkg file
    &quot;&quot;&quot;
    with patch(&quot;salt.modules.macpackage.get_pkg_id&quot;) as get_pkg_id_mock:
        expected = [&quot;com.apple.this&quot;, &quot;com.salt.other&quot;]
        mock = MagicMock(return_value=&quot;/tmp/dmg-X/file.pkg\n/tmp/dmg-X/other.pkg&quot;)
        get_pkg_id_mock.side_effect = [[&quot;com.apple.this&quot;], [&quot;com.salt.other&quot;]]

        with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
            out = macpackage.get_mpkg_ids(&quot;/path/to/file.mpkg&quot;)

            mock.assert_called_once_with(&quot;find /path/to -name *.pkg&quot;, python_shell=True)

            calls = [call(&quot;/tmp/dmg-X/file.pkg&quot;), call(&quot;/tmp/dmg-X/other.pkg&quot;)]
            get_pkg_id_mock.assert_has_calls(calls)

            assert out == expected


def test_get_pkg_id_from_pkginfo():
<A NAME="1"></A>    &quot;&quot;&quot;
    Test getting a package id from pkginfo files
    &quot;&quot;&quot;
    expected <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match26294-1.html#1',3,'match26294-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= [&quot;com.apple.this&quot;, &quot;com.apple.that&quot;]
    mock = MagicMock(return_value=&quot;com.apple.this\ncom.apple.that&quot;)
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        out = macpackage._get_pkg_id_from_pkginfo(</B></FONT>&quot;/tmp/dmg-X/PackageInfo&quot;)
        cmd = (
            &quot;cat /tmp/dmg-X/PackageInfo | grep -Eo&quot;
            &quot; 'identifier=\&quot;[a-zA-Z.0-9\\-]*\&quot;' | cut -c 13- | tr -d '\&quot;'&quot;
        )
        mock.assert_called_once_with(cmd, python_shell=True)
        assert out == expected


def test_get_pkg_id_from_pkginfo_no_file():
<A NAME="2"></A>    &quot;&quot;&quot;
    Test getting a package id from pkginfo file when it doesn't exist
    &quot;&quot;&quot;
    expected <FONT color="#980517"><A HREF="javascript:ZweiFrames('match26294-1.html#2',3,'match26294-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= []
    mock = MagicMock(return_value=&quot;No such file&quot;)
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        out = macpackage._get_pkg_id_from_pkginfo(</B></FONT>&quot;/tmp/dmg-X/PackageInfo&quot;)
        cmd = (
            &quot;cat /tmp/dmg-X/PackageInfo | grep -Eo&quot;
            &quot; 'identifier=\&quot;[a-zA-Z.0-9\\-]*\&quot;' | cut -c 13- | tr -d '\&quot;'&quot;
        )
        mock.assert_called_once_with(cmd, python_shell=True)
        assert out == expected


def test_get_pkg_id_dir():
    &quot;&quot;&quot;
    Test getting a package id from a directory
    &quot;&quot;&quot;
    expected = [&quot;com.apple.this&quot;]
    mock = MagicMock(return_value=&quot;com.apple.this&quot;)
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        out = macpackage._get_pkg_id_dir(&quot;/tmp/dmg-X/&quot;)
        cmd = (
            '/usr/libexec/PlistBuddy -c &quot;print :CFBundleIdentifier&quot;'
            &quot; /tmp/dmg-X/Contents/Info.plist&quot;
        )
        mock.assert_called_once_with(cmd, python_shell=False)
        assert out == expected


def test_get_pkg_id_dir_wildcard():
    &quot;&quot;&quot;
    Test getting a package id from a directory with a wildcard
    &quot;&quot;&quot;
    expected = [&quot;com.apple.this&quot;]
    mock = MagicMock(return_value=&quot;com.apple.this&quot;)
    with patch.dict(macpackage.__salt__, {&quot;cmd.run&quot;: mock}):
        out = macpackage._get_pkg_id_dir(&quot;/tmp/dmg-X/*.pkg/&quot;)
        cmd = (
            '/usr/libexec/PlistBuddy -c &quot;print :CFBundleIdentifier&quot;'
            &quot; '/tmp/dmg-X/*.pkg/Contents/Info.plist'&quot;
        )
        mock.assert_called_once_with(cmd, python_shell=True)
        assert out == expected
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_lvm.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;

import pytest
import salt.states.lvm as lvm
from salt.exceptions import ArgumentValueError
from tests.support.mock import MagicMock, patch


@pytest.fixture
def lv01():
    return {
        &quot;/dev/testvg01/testlv01&quot;: {
            &quot;Logical Volume Name&quot;: &quot;/dev/testvg01/testlv01&quot;,
            &quot;Volume Group Name&quot;: &quot;testvg01&quot;,
            &quot;Logical Volume Access&quot;: &quot;3&quot;,
            &quot;Logical Volume Status&quot;: &quot;1&quot;,
            &quot;Internal Logical Volume Number&quot;: &quot;-1&quot;,
            &quot;Open Logical Volumes&quot;: &quot;0&quot;,
            &quot;Logical Volume Size&quot;: &quot;4194304&quot;,
            &quot;Current Logical Extents Associated&quot;: &quot;512&quot;,
            &quot;Allocated Logical Extents&quot;: &quot;-1&quot;,
            &quot;Allocation Policy&quot;: &quot;0&quot;,
            &quot;Read Ahead Sectors&quot;: &quot;-1&quot;,
            &quot;Major Device Number&quot;: &quot;253&quot;,
            &quot;Minor Device Number&quot;: &quot;9&quot;,
        }
    }


@pytest.fixture
def lv02():
    return {
        &quot;/dev/testvg01/testlv02&quot;: {
            &quot;Logical Volume Name&quot;: &quot;/dev/testvg01/testlv02&quot;,
            &quot;Volume Group Name&quot;: &quot;testvg01&quot;,
            &quot;Logical Volume Access&quot;: &quot;3&quot;,
            &quot;Logical Volume Status&quot;: &quot;1&quot;,
            &quot;Internal Logical Volume Number&quot;: &quot;-1&quot;,
            &quot;Open Logical Volumes&quot;: &quot;0&quot;,
            &quot;Logical Volume Size&quot;: &quot;4194304&quot;,
            &quot;Current Logical Extents Associated&quot;: &quot;512&quot;,
            &quot;Allocated Logical Extents&quot;: &quot;-1&quot;,
            &quot;Allocation Policy&quot;: &quot;0&quot;,
            &quot;Read Ahead Sectors&quot;: &quot;-1&quot;,
            &quot;Major Device Number&quot;: &quot;253&quot;,
            &quot;Minor Device Number&quot;: &quot;9&quot;,
        }
    }


@pytest.fixture
def configure_loader_modules():
    return {lvm: {}}


def test_pv_present():
    &quot;&quot;&quot;
    Test to set a physical device to be used as an LVM physical volume
    &quot;&quot;&quot;
    name = &quot;/dev/sda5&quot;

    comt = &quot;Physical Volume {} already present&quot;.format(name)

    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(side_effect=[True, False])
    with patch.dict(lvm.__salt__, {&quot;lvm.pvdisplay&quot;: mock}):
        assert lvm.pv_present(name) == ret

        comt = &quot;Physical Volume {} is set to be created&quot;.format(name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.pv_present(name) == ret


def test_pv_absent():
    &quot;&quot;&quot;
    Test to ensure that a Physical Device is not being used by lvm
    &quot;&quot;&quot;
    name = &quot;/dev/sda5&quot;

    comt = &quot;Physical Volume {} does not exist&quot;.format(name)

    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(side_effect=[False, True])
    with patch.dict(lvm.__salt__, {&quot;lvm.pvdisplay&quot;: mock}):
        assert lvm.pv_absent(name) == ret

        comt = &quot;Physical Volume {} is set to be removed&quot;.format(name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.pv_absent(name) == ret


def test_vg_present():
    &quot;&quot;&quot;
    Test to create an LVM volume group
    &quot;&quot;&quot;
    name = &quot;testvg00&quot;

    comt = &quot;Failed to create Volume Group {}&quot;.format(name)

    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: False, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=False)
    with patch.dict(lvm.__salt__, {&quot;lvm.vgdisplay&quot;: mock, &quot;lvm.vgcreate&quot;: mock}):
        with patch.dict(lvm.__opts__, {&quot;test&quot;: False}):
            assert lvm.vg_present(name) == ret

        comt = &quot;Volume Group {} is set to be created&quot;.format(name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.vg_present(name) == ret


def test_vg_absent():
    &quot;&quot;&quot;
    Test to remove an LVM volume group
    &quot;&quot;&quot;
    name = &quot;testvg00&quot;

    comt = &quot;Volume Group {} already absent&quot;.format(name)

    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(side_effect=[False, True])
    with patch.dict(lvm.__salt__, {&quot;lvm.vgdisplay&quot;: mock}):
        assert lvm.vg_absent(name) == ret

        comt = &quot;Volume Group {} is set to be removed&quot;.format(name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.vg_absent(name) == ret


def test_lv_present(lv01, lv02):
    &quot;&quot;&quot;
    Test to create a new logical volume
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
    vgname = &quot;testvg01&quot;
    comt = &quot;Logical Volume {} already present&quot;.format(name)
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv01)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        assert lvm.lv_present(name, vgname=vgname) == ret

    mock = MagicMock(return_value=lv02)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        comt = &quot;Logical Volume {} is set to be created&quot;.format(name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.lv_present(name, vgname=vgname) == ret


def test_lv_present_with_valid_suffixes(lv01, lv02):
    &quot;&quot;&quot;
    Test to create a new logical volume specifying valid suffixes
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
    vgname = &quot;testvg01&quot;
    sizes_list = [
        &quot;2048&quot;,
        &quot;2048m&quot;,
        &quot;2048M&quot;,
        &quot;2048MB&quot;,
        &quot;2048mb&quot;,
        &quot;2g&quot;,
        &quot;2G&quot;,
        &quot;2GB&quot;,
        &quot;2gb&quot;,
        &quot;4194304s&quot;,
        &quot;4194304S&quot;,
    ]
    comt = &quot;Logical Volume {} already present&quot;.format(name)
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv01)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
<A NAME="0"></A>        for size in sizes_list:
            assert lvm.lv_present(name, vgname=vgname, size=size) == ret

    sizes_list <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match26294-0.html#0',2,'match26294-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= [
        &quot;1G&quot;,
        &quot;1g&quot;,
        &quot;2M&quot;,
        &quot;2m&quot;,
        &quot;3T&quot;,
        &quot;3t&quot;,
        &quot;4P&quot;,
        &quot;4p&quot;,
        &quot;5s&quot;,
        &quot;5S&quot;,
        &quot;1GB&quot;,
        &quot;1gb&quot;,
        &quot;2MB&quot;,
        &quot;2mb&quot;,
        &quot;3TB&quot;,
        &quot;3tb&quot;,
        &quot;4PB&quot;,
        &quot;4pb&quot;,
    ]
    mock = MagicMock(return_value=lv02)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        comt = &quot;Logical Volume {} is set to be created&quot;.format(name)
        ret.update(</B></FONT>{&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            for size in sizes_list:
                assert lvm.lv_present(name, vgname=vgname, size=size) == ret


def test_lv_present_with_invalid_suffixes(lv02):
    &quot;&quot;&quot;
    Test to create a new logical volume specifying valid suffixes
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
<A NAME="1"></A>    vgname = &quot;testvg01&quot;
    sizes_list = [&quot;1B&quot;, &quot;1b&quot;, &quot;2K&quot;, &quot;2k&quot;, &quot;2KB&quot;, &quot;2kb&quot;, &quot;3BB&quot;, &quot;3Bb&quot;, &quot;4JKL&quot;, &quot;YJK&quot;]
    comt = &quot;Logical Volume {} already present&quot;.format(name)
    ret <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match26294-0.html#1',2,'match26294-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv02)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        comt = &quot;Logical Volume {} is set to be created&quot;.format(</B></FONT>name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            for size in sizes_list:
                pytest.raises(
                    ArgumentValueError,
                    lvm.lv_present,
                    name,
                    vgname=vgname,
                    size=size,
                )


def test_lv_present_with_percentage_extents(lv01, lv02):
    &quot;&quot;&quot;
    Test to create a new logical volume specifying extents as a percentage
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
    vgname = &quot;testvg01&quot;
    extents = &quot;42%FREE&quot;
    comt = &quot;Logical Volume {} already present, {} won't be resized.&quot;.format(
        name, extents
    )
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv01)
<A NAME="2"></A>    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        assert lvm.lv_present(name, vgname=vgname, extents=extents) == ret

    extents <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match26294-0.html#2',2,'match26294-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= &quot;42%VG&quot;
    mock = MagicMock(return_value=lv02)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        comt = &quot;Logical Volume {} is set to be created&quot;.format(</B></FONT>name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.lv_present(name, vgname=vgname, extents=extents) == ret


def test_lv_present_with_force(lv01, lv02):
    &quot;&quot;&quot;
    Test to create a new logical volume with force=True
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
    vgname = &quot;testvg01&quot;
    comt = &quot;Logical Volume {} already present&quot;.format(name)
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv01)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        assert lvm.lv_present(name, vgname=vgname, force=True) == ret

    mock = MagicMock(return_value=lv02)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        comt = &quot;Logical Volume {} is set to be created&quot;.format(name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.lv_present(name, vgname=vgname, force=True) == ret


def test_lv_present_with_same_size(lv01):
    &quot;&quot;&quot;
    Test to specify the same volume size as parameter
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
    vgname = &quot;testvg01&quot;
    comt = &quot;Logical Volume {} already present&quot;.format(name)
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv01)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        assert lvm.lv_present(name, vgname=vgname, size=&quot;2G&quot;) == ret


def test_lv_present_with_increase(lv01):
    &quot;&quot;&quot;
    Test to increase a logical volume
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
    vgname = &quot;testvg01&quot;
    comt = &quot;Logical Volume {} is set to be resized&quot;.format(name)
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: None, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv01)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.lv_present(name, vgname=vgname, size=&quot;10G&quot;) == ret


def test_lv_present_with_reduce_without_force(lv01):
    &quot;&quot;&quot;
    Test to reduce a logical volume
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
    vgname = &quot;testvg01&quot;
    comt = &quot;To reduce a Logical Volume option 'force' must be True.&quot;
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: False, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv01)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        assert lvm.lv_present(name, vgname=vgname, size=&quot;1G&quot;) == ret


def test_lv_present_with_reduce_with_force(lv01):
    &quot;&quot;&quot;
    Test to reduce a logical volume
    &quot;&quot;&quot;
    name = &quot;testlv01&quot;
    vgname = &quot;testvg01&quot;
    comt = &quot;Logical Volume {} is set to be resized&quot;.format(name)
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: None, &quot;comment&quot;: comt}

    mock = MagicMock(return_value=lv01)
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.lv_present(name, vgname=vgname, size=&quot;1G&quot;, force=True) == ret


def test_lv_absent():
    &quot;&quot;&quot;
    Test to remove a given existing logical volume from a named existing volume group
    &quot;&quot;&quot;
    name = &quot;testlv00&quot;

    comt = &quot;Logical Volume {} already absent&quot;.format(name)

    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: comt}

    mock = MagicMock(side_effect=[False, True])
    with patch.dict(lvm.__salt__, {&quot;lvm.lvdisplay&quot;: mock}):
        assert lvm.lv_absent(name) == ret

        comt = &quot;Logical Volume {} is set to be removed&quot;.format(name)
        ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
        with patch.dict(lvm.__opts__, {&quot;test&quot;: True}):
            assert lvm.lv_absent(name) == ret
</PRE>
</div>
  </div>
</body>
</html>
