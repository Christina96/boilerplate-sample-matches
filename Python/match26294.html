<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_macpackage_1.py &amp; test_lvm.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_macpackage_1.py &amp; test_lvm.py
      </h3>
<h1 align="center">
        8.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_macpackage_1.py (10.989011%)<th>test_lvm.py (7.207207%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(125-129)<td><a href="#" name="0">(187-210)</a><td align="center"><font color="#ff0000">15</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(245-248)<td><a href="#" name="1">(224-228)</a><td align="center"><font color="#dd0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(261-264)<td><a href="#" name="2">(257-260)</a><td align="center"><font color="#cc0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_macpackage_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import pytest
2 import salt.modules.macpackage as macpackage
3 from tests.support.mock import MagicMock, call, patch
4 @pytest.fixture
5 def configure_loader_modules():
6     return {macpackage: {}}
7 def test_install():
8     mock = MagicMock()
9     with patch.dict(macpackage.__salt__, {"cmd.run_all": mock}):
10         macpackage.install("/path/to/file.pkg")
11         mock.assert_called_once_with(
12             "installer -pkg /path/to/file.pkg -target LocalSystem",
13             python_shell=False,
14         )
15 def test_install_wildcard():
16     mock = MagicMock()
17     with patch.dict(macpackage.__salt__, {"cmd.run_all": mock}):
18         macpackage.install("/path/to/*.pkg")
19         mock.assert_called_once_with(
20             "installer -pkg /path/to/*.pkg -target LocalSystem", python_shell=True
21         )
22 def test_install_with_extras():
23     mock = MagicMock()
24     with patch.dict(macpackage.__salt__, {"cmd.run_all": mock}):
25         macpackage.install("/path/to/file.pkg", store=True, allow_untrusted=True)
26         mock.assert_called_once_with(
27             "installer -pkg /path/to/file.pkg -target LocalSystem -store"
28             " -allowUntrusted",
29             python_shell=False,
30         )
31 def test_install_app():
32     mock = MagicMock()
33     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
34         macpackage.install_app("/path/to/file.app")
35         mock.assert_called_once_with(
36             'rsync -a --delete "/path/to/file.app/" "/Applications/file.app"'
37         )
38 def test_install_app_specify_target():
39     mock = MagicMock()
40     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
41         macpackage.install_app("/path/to/file.app", "/Applications/new.app")
42         mock.assert_called_once_with(
43             'rsync -a --delete "/path/to/file.app/" "/Applications/new.app"'
44         )
45 def test_install_app_with_slash():
46     mock = MagicMock()
47     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
48         macpackage.install_app("/path/to/file.app/")
49         mock.assert_called_once_with(
50             'rsync -a --delete "/path/to/file.app/" "/Applications/file.app"'
51         )
52 def test_uninstall():
53     mock = MagicMock()
54     with patch.dict(macpackage.__salt__, {"file.remove": mock}):
55         macpackage.uninstall_app("/path/to/file.app")
56         mock.assert_called_once_with("/path/to/file.app")
57 def test_mount():
58     cmd_mock = MagicMock()
59     temp_mock = MagicMock(return_value="dmg-ABCDEF")
60     with patch.dict(macpackage.__salt__, {"cmd.run": cmd_mock, "temp.dir": temp_mock}):
61         macpackage.mount("/path/to/file.dmg")
62         temp_mock.assert_called_once_with(prefix="dmg-")
63         cmd_mock.assert_called_once_with(
64             "hdiutil attach -readonly -nobrowse -mountpoint "
65             'dmg-ABCDEF "/path/to/file.dmg"'
66         )
67 def test_unmount():
68     mock = MagicMock()
69     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
70         macpackage.unmount("/path/to/file.dmg")
71         mock.assert_called_once_with('hdiutil detach "/path/to/file.dmg"')
72 def test_installed_pkgs():
73     Test getting a list of the installed packages
74     """
75     expected <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= ["com.apple.this", "com.salt.that"]
76     mock = MagicMock(return_value="com.apple.this\ncom.salt.that")
77     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
78         out = macpackage.installed_pkgs()
79         mock.assert_called_once_with(</b></font>"pkgutil --pkgs")
80         assert out == expected
81 def test_get_pkg_id_with_files():
82     """
83     Test getting a the id for a package
84     """
85     with patch(
86         "salt.modules.macpackage._get_pkg_id_from_pkginfo"
87     ) as pkg_id_pkginfo_mock:
88         expected = ["com.apple.this"]
89         cmd_mock = MagicMock(
90             side_effect=[
91                 "/path/to/PackageInfo\n/path/to/some/other/fake/PackageInfo",
92                 "",
93                 "",
94             ]
95         )
96         pkg_id_pkginfo_mock.side_effect = [["com.apple.this"], []]
97         temp_mock = MagicMock(return_value="/tmp/dmg-ABCDEF")
98         remove_mock = MagicMock()
99         with patch.dict(
100             macpackage.__salt__,
101             {
102                 "cmd.run": cmd_mock,
103                 "temp.dir": temp_mock,
104                 "file.remove": remove_mock,
105             },
106         ):
107             out = macpackage.get_pkg_id("/path/to/file.pkg")
108             temp_mock.assert_called_once_with(prefix="pkg-")
109             cmd_calls = [
110                 call(
111                     "xar -t -f /path/to/file.pkg | grep PackageInfo",
112                     python_shell=True,
113                     output_loglevel="quiet",
114                 ),
115                 call(
116                     "xar -x -f /path/to/file.pkg /path/to/PackageInfo"
117                     " /path/to/some/other/fake/PackageInfo",
118                     cwd="/tmp/dmg-ABCDEF",
119                     output_loglevel="quiet",
120                 ),
121             ]
122             cmd_mock.assert_has_calls(cmd_calls)
123             pkg_id_pkginfo_calls = [
124                 call("/path/to/PackageInfo"),
125                 call("/path/to/some/other/fake/PackageInfo"),
126             ]
127             pkg_id_pkginfo_mock.assert_has_calls(pkg_id_pkginfo_calls)
128             remove_mock.assert_called_once_with("/tmp/dmg-ABCDEF")
129             assert out == expected
130 def test_get_pkg_id_with_dir():
131     """
132     Test getting a the id for a package with a directory
133     """
134     with patch("salt.modules.macpackage._get_pkg_id_dir") as pkg_id_dir_mock:
135         expected = ["com.apple.this"]
136         pkg_id_dir_mock.return_value = ["com.apple.this"]
137         cmd_mock = MagicMock(return_value="Error opening /path/to/file.pkg")
138         temp_mock = MagicMock(return_value="/tmp/dmg-ABCDEF")
139         remove_mock = MagicMock()
140         with patch.dict(
141             macpackage.__salt__,
142             {
143                 "cmd.run": cmd_mock,
144                 "temp.dir": temp_mock,
145                 "file.remove": remove_mock,
146             },
147         ):
148             out = macpackage.get_pkg_id("/path/to/file.pkg")
149             temp_mock.assert_called_once_with(prefix="pkg-")
150             cmd_mock.assert_called_once_with(
151                 "xar -t -f /path/to/file.pkg | grep PackageInfo",
152                 python_shell=True,
153                 output_loglevel="quiet",
154             )
155             pkg_id_dir_mock.assert_called_once_with("/path/to/file.pkg")
156             remove_mock.assert_called_once_with("/tmp/dmg-ABCDEF")
157             assert out == expected
158 def test_get_mpkg_ids():
159     """
160     Test getting the ids of a mpkg file
161     """
162     with patch("salt.modules.macpackage.get_pkg_id") as get_pkg_id_mock:
163         expected = ["com.apple.this", "com.salt.other"]
164         mock = MagicMock(return_value="/tmp/dmg-X/file.pkg\n/tmp/dmg-X/other.pkg")
165         get_pkg_id_mock.side_effect = [["com.apple.this"], ["com.salt.other"]]
166         with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
167             out = macpackage.get_mpkg_ids("/path/to/file.mpkg")
168             mock.assert_called_once_with("find /path/to -name *.pkg", python_shell=True)
169             calls = [call("/tmp/dmg-X/file.pkg"), call("/tmp/dmg-X/other.pkg")]
170             get_pkg_id_mock.assert_has_calls(calls)
171             assert out == expected
172 def test_get_pkg_id_from_pkginfo():
173     Test getting a package id from pkginfo files
174     """
175     expected <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= ["com.apple.this", "com.apple.that"]
176     mock = MagicMock(return_value="com.apple.this\ncom.apple.that")
177     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
178         out = macpackage._get_pkg_id_from_pkginfo(</b></font>"/tmp/dmg-X/PackageInfo")
179         cmd = (
180             "cat /tmp/dmg-X/PackageInfo | grep -Eo"
181             " 'identifier=\"[a-zA-Z.0-9\\-]*\"' | cut -c 13- | tr -d '\"'"
182         )
183         mock.assert_called_once_with(cmd, python_shell=True)
184         assert out == expected
185 def test_get_pkg_id_from_pkginfo_no_file():
186     Test getting a package id from pkginfo file when it doesn't exist
187     """
188     expected <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= []
189     mock = MagicMock(return_value="No such file")
190     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
191         out = macpackage._get_pkg_id_from_pkginfo(</b></font>"/tmp/dmg-X/PackageInfo")
192         cmd = (
193             "cat /tmp/dmg-X/PackageInfo | grep -Eo"
194             " 'identifier=\"[a-zA-Z.0-9\\-]*\"' | cut -c 13- | tr -d '\"'"
195         )
196         mock.assert_called_once_with(cmd, python_shell=True)
197         assert out == expected
198 def test_get_pkg_id_dir():
199     """
200     Test getting a package id from a directory
201     """
202     expected = ["com.apple.this"]
203     mock = MagicMock(return_value="com.apple.this")
204     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
205         out = macpackage._get_pkg_id_dir("/tmp/dmg-X/")
206         cmd = (
207             '/usr/libexec/PlistBuddy -c "print :CFBundleIdentifier"'
208             " /tmp/dmg-X/Contents/Info.plist"
209         )
210         mock.assert_called_once_with(cmd, python_shell=False)
211         assert out == expected
212 def test_get_pkg_id_dir_wildcard():
213     """
214     Test getting a package id from a directory with a wildcard
215     """
216     expected = ["com.apple.this"]
217     mock = MagicMock(return_value="com.apple.this")
218     with patch.dict(macpackage.__salt__, {"cmd.run": mock}):
219         out = macpackage._get_pkg_id_dir("/tmp/dmg-X/*.pkg/")
220         cmd = (
221             '/usr/libexec/PlistBuddy -c "print :CFBundleIdentifier"'
222             " '/tmp/dmg-X/*.pkg/Contents/Info.plist'"
223         )
224         mock.assert_called_once_with(cmd, python_shell=True)
225         assert out == expected
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_lvm.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 """
2     :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
3 """
4 import pytest
5 import salt.states.lvm as lvm
6 from salt.exceptions import ArgumentValueError
7 from tests.support.mock import MagicMock, patch
8 @pytest.fixture
9 def lv01():
10     return {
11         "/dev/testvg01/testlv01": {
12             "Logical Volume Name": "/dev/testvg01/testlv01",
13             "Volume Group Name": "testvg01",
14             "Logical Volume Access": "3",
15             "Logical Volume Status": "1",
16             "Internal Logical Volume Number": "-1",
17             "Open Logical Volumes": "0",
18             "Logical Volume Size": "4194304",
19             "Current Logical Extents Associated": "512",
20             "Allocated Logical Extents": "-1",
21             "Allocation Policy": "0",
22             "Read Ahead Sectors": "-1",
23             "Major Device Number": "253",
24             "Minor Device Number": "9",
25         }
26     }
27 @pytest.fixture
28 def lv02():
29     return {
30         "/dev/testvg01/testlv02": {
31             "Logical Volume Name": "/dev/testvg01/testlv02",
32             "Volume Group Name": "testvg01",
33             "Logical Volume Access": "3",
34             "Logical Volume Status": "1",
35             "Internal Logical Volume Number": "-1",
36             "Open Logical Volumes": "0",
37             "Logical Volume Size": "4194304",
38             "Current Logical Extents Associated": "512",
39             "Allocated Logical Extents": "-1",
40             "Allocation Policy": "0",
41             "Read Ahead Sectors": "-1",
42             "Major Device Number": "253",
43             "Minor Device Number": "9",
44         }
45     }
46 @pytest.fixture
47 def configure_loader_modules():
48     return {lvm: {}}
49 def test_pv_present():
50     """
51     Test to set a physical device to be used as an LVM physical volume
52     """
53     name = "/dev/sda5"
54     comt = "Physical Volume {} already present".format(name)
55     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
56     mock = MagicMock(side_effect=[True, False])
57     with patch.dict(lvm.__salt__, {"lvm.pvdisplay": mock}):
58         assert lvm.pv_present(name) == ret
59         comt = "Physical Volume {} is set to be created".format(name)
60         ret.update({"comment": comt, "result": None})
61         with patch.dict(lvm.__opts__, {"test": True}):
62             assert lvm.pv_present(name) == ret
63 def test_pv_absent():
64     """
65     Test to ensure that a Physical Device is not being used by lvm
66     """
67     name = "/dev/sda5"
68     comt = "Physical Volume {} does not exist".format(name)
69     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
70     mock = MagicMock(side_effect=[False, True])
71     with patch.dict(lvm.__salt__, {"lvm.pvdisplay": mock}):
72         assert lvm.pv_absent(name) == ret
73         comt = "Physical Volume {} is set to be removed".format(name)
74         ret.update({"comment": comt, "result": None})
75         with patch.dict(lvm.__opts__, {"test": True}):
76             assert lvm.pv_absent(name) == ret
77 def test_vg_present():
78     """
79     Test to create an LVM volume group
80     """
81     name = "testvg00"
82     comt = "Failed to create Volume Group {}".format(name)
83     ret = {"name": name, "changes": {}, "result": False, "comment": comt}
84     mock = MagicMock(return_value=False)
85     with patch.dict(lvm.__salt__, {"lvm.vgdisplay": mock, "lvm.vgcreate": mock}):
86         with patch.dict(lvm.__opts__, {"test": False}):
87             assert lvm.vg_present(name) == ret
88         comt = "Volume Group {} is set to be created".format(name)
89         ret.update({"comment": comt, "result": None})
90         with patch.dict(lvm.__opts__, {"test": True}):
91             assert lvm.vg_present(name) == ret
92 def test_vg_absent():
93     """
94     Test to remove an LVM volume group
95     """
96     name = "testvg00"
97     comt = "Volume Group {} already absent".format(name)
98     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
99     mock = MagicMock(side_effect=[False, True])
100     with patch.dict(lvm.__salt__, {"lvm.vgdisplay": mock}):
101         assert lvm.vg_absent(name) == ret
102         comt = "Volume Group {} is set to be removed".format(name)
103         ret.update({"comment": comt, "result": None})
104         with patch.dict(lvm.__opts__, {"test": True}):
105             assert lvm.vg_absent(name) == ret
106 def test_lv_present(lv01, lv02):
107     """
108     Test to create a new logical volume
109     """
110     name = "testlv01"
111     vgname = "testvg01"
112     comt = "Logical Volume {} already present".format(name)
113     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
114     mock = MagicMock(return_value=lv01)
115     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
116         assert lvm.lv_present(name, vgname=vgname) == ret
117     mock = MagicMock(return_value=lv02)
118     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
119         comt = "Logical Volume {} is set to be created".format(name)
120         ret.update({"comment": comt, "result": None})
121         with patch.dict(lvm.__opts__, {"test": True}):
122             assert lvm.lv_present(name, vgname=vgname) == ret
123 def test_lv_present_with_valid_suffixes(lv01, lv02):
124     """
125     Test to create a new logical volume specifying valid suffixes
126     """
127     name = "testlv01"
128     vgname = "testvg01"
129     sizes_list = [
130         "2048",
131         "2048m",
132         "2048M",
133         "2048MB",
134         "2048mb",
135         "2g",
136         "2G",
137         "2GB",
138         "2gb",
139         "4194304s",
140         "4194304S",
141     ]
142     comt = "Logical Volume {} already present".format(name)
143     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
144     mock = MagicMock(return_value=lv01)
145     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
146             assert lvm.lv_present(name, vgname=vgname, size=size) == ret
147     sizes_list <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= [
148         "1G",
149         "1g",
150         "2M",
151         "2m",
152         "3T",
153         "3t",
154         "4P",
155         "4p",
156         "5s",
157         "5S",
158         "1GB",
159         "1gb",
160         "2MB",
161         "2mb",
162         "3TB",
163         "3tb",
164         "4PB",
165         "4pb",
166     ]
167     mock = MagicMock(return_value=lv02)
168     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
169         comt = "Logical Volume {} is set to be created".format(name)
170         ret.update(</b></font>{"comment": comt, "result": None})
171         with patch.dict(lvm.__opts__, {"test": True}):
172             for size in sizes_list:
173                 assert lvm.lv_present(name, vgname=vgname, size=size) == ret
174 def test_lv_present_with_invalid_suffixes(lv02):
175     """
176     Test to create a new logical volume specifying valid suffixes
177     """
178     name = "testlv01"
179     sizes_list = ["1B", "1b", "2K", "2k", "2KB", "2kb", "3BB", "3Bb", "4JKL", "YJK"]
180     comt = "Logical Volume {} already present".format(name)
181     ret <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= {"name": name, "changes": {}, "result": True, "comment": comt}
182     mock = MagicMock(return_value=lv02)
183     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
184         comt = "Logical Volume {} is set to be created".format(</b></font>name)
185         ret.update({"comment": comt, "result": None})
186         with patch.dict(lvm.__opts__, {"test": True}):
187             for size in sizes_list:
188                 pytest.raises(
189                     ArgumentValueError,
190                     lvm.lv_present,
191                     name,
192                     vgname=vgname,
193                     size=size,
194                 )
195 def test_lv_present_with_percentage_extents(lv01, lv02):
196     """
197     Test to create a new logical volume specifying extents as a percentage
198     """
199     name = "testlv01"
200     vgname = "testvg01"
201     extents = "42%FREE"
202     comt = "Logical Volume {} already present, {} won't be resized.".format(
203         name, extents
204     )
205     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
206     mock = MagicMock(return_value=lv01)
207         assert lvm.lv_present(name, vgname=vgname, extents=extents) == ret
208     extents <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= "42%VG"
209     mock = MagicMock(return_value=lv02)
210     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
211         comt = "Logical Volume {} is set to be created".format(</b></font>name)
212         ret.update({"comment": comt, "result": None})
213         with patch.dict(lvm.__opts__, {"test": True}):
214             assert lvm.lv_present(name, vgname=vgname, extents=extents) == ret
215 def test_lv_present_with_force(lv01, lv02):
216     """
217     Test to create a new logical volume with force=True
218     """
219     name = "testlv01"
220     vgname = "testvg01"
221     comt = "Logical Volume {} already present".format(name)
222     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
223     mock = MagicMock(return_value=lv01)
224     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
225         assert lvm.lv_present(name, vgname=vgname, force=True) == ret
226     mock = MagicMock(return_value=lv02)
227     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
228         comt = "Logical Volume {} is set to be created".format(name)
229         ret.update({"comment": comt, "result": None})
230         with patch.dict(lvm.__opts__, {"test": True}):
231             assert lvm.lv_present(name, vgname=vgname, force=True) == ret
232 def test_lv_present_with_same_size(lv01):
233     """
234     Test to specify the same volume size as parameter
235     """
236     name = "testlv01"
237     vgname = "testvg01"
238     comt = "Logical Volume {} already present".format(name)
239     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
240     mock = MagicMock(return_value=lv01)
241     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
242         assert lvm.lv_present(name, vgname=vgname, size="2G") == ret
243 def test_lv_present_with_increase(lv01):
244     """
245     Test to increase a logical volume
246     """
247     name = "testlv01"
248     vgname = "testvg01"
249     comt = "Logical Volume {} is set to be resized".format(name)
250     ret = {"name": name, "changes": {}, "result": None, "comment": comt}
251     mock = MagicMock(return_value=lv01)
252     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
253         with patch.dict(lvm.__opts__, {"test": True}):
254             assert lvm.lv_present(name, vgname=vgname, size="10G") == ret
255 def test_lv_present_with_reduce_without_force(lv01):
256     """
257     Test to reduce a logical volume
258     """
259     name = "testlv01"
260     vgname = "testvg01"
261     comt = "To reduce a Logical Volume option 'force' must be True."
262     ret = {"name": name, "changes": {}, "result": False, "comment": comt}
263     mock = MagicMock(return_value=lv01)
264     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
265         assert lvm.lv_present(name, vgname=vgname, size="1G") == ret
266 def test_lv_present_with_reduce_with_force(lv01):
267     """
268     Test to reduce a logical volume
269     """
270     name = "testlv01"
271     vgname = "testvg01"
272     comt = "Logical Volume {} is set to be resized".format(name)
273     ret = {"name": name, "changes": {}, "result": None, "comment": comt}
274     mock = MagicMock(return_value=lv01)
275     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
276         with patch.dict(lvm.__opts__, {"test": True}):
277             assert lvm.lv_present(name, vgname=vgname, size="1G", force=True) == ret
278 def test_lv_absent():
279     """
280     Test to remove a given existing logical volume from a named existing volume group
281     """
282     name = "testlv00"
283     comt = "Logical Volume {} already absent".format(name)
284     ret = {"name": name, "changes": {}, "result": True, "comment": comt}
285     mock = MagicMock(side_effect=[False, True])
286     with patch.dict(lvm.__salt__, {"lvm.lvdisplay": mock}):
287         assert lvm.lv_absent(name) == ret
288         comt = "Logical Volume {} is set to be removed".format(name)
289         ret.update({"comment": comt, "result": None})
290         with patch.dict(lvm.__opts__, {"test": True}):
291             assert lvm.lv_absent(name) == ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
