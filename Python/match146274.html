<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for auth_test.py &amp; queues_test.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for auth_test.py &amp; queues_test.py
      </h3>
<h1 align="center">
        2.4%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>auth_test.py (2.4464831%)<th>queues_test.py (2.3762376%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(354-358)<td><a href="#" name="0">(369-372)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(320-324)<td><a href="#" name="1">(364-368)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>auth_test.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, division, print_function
2 from salt.ext.tornado.auth import OpenIdMixin, OAuthMixin, OAuth2Mixin, TwitterMixin, AuthError, GoogleOAuth2Mixin, FacebookGraphMixin
3 from salt.ext.tornado.concurrent import Future
4 from salt.ext.tornado.escape import json_decode
5 from salt.ext.tornado import gen
6 from salt.ext.tornado.httputil import url_concat
7 from salt.ext.tornado.log import gen_log
8 from salt.ext.tornado.testing import AsyncHTTPTestCase, ExpectLog
9 from salt.ext.tornado.web import RequestHandler, Application, asynchronous, HTTPError
10 class OpenIdClientLoginHandler(RequestHandler, OpenIdMixin):
11     def initialize(self, test):
12         self._OPENID_ENDPOINT = test.get_url('/openid/server/authenticate')
13     @asynchronous
14     def get(self):
15         if self.get_argument('openid.mode', None):
16             self.get_authenticated_user(
17                 self.on_user, http_client=self.settings['http_client'])
18             return
19         res = self.authenticate_redirect()
20         assert isinstance(res, Future)
21         assert res.done()
22     def on_user(self, user):
23         if user is None:
24             raise Exception("user is None")
25         self.finish(user)
26 class OpenIdServerAuthenticateHandler(RequestHandler):
27     def post(self):
28         if self.get_argument('openid.mode') != 'check_authentication':
29             raise Exception("incorrect openid.mode %r")
30         self.write('is_valid:true')
31 class OAuth1ClientLoginHandler(RequestHandler, OAuthMixin):
32     def initialize(self, test, version):
33         self._OAUTH_VERSION = version
34         self._OAUTH_REQUEST_TOKEN_URL = test.get_url('/oauth1/server/request_token')
35         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth1/server/authorize')
36         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/oauth1/server/access_token')
37     def _oauth_consumer_token(self):
38         return dict(key='asdf', secret='qwer')
39     @asynchronous
40     def get(self):
41         if self.get_argument('oauth_token', None):
42             self.get_authenticated_user(
43                 self.on_user, http_client=self.settings['http_client'])
44             return
45         res = self.authorize_redirect(http_client=self.settings['http_client'])
46         assert isinstance(res, Future)
47     def on_user(self, user):
48         if user is None:
49             raise Exception("user is None")
50         self.finish(user)
51     def _oauth_get_user(self, access_token, callback):
52         if self.get_argument('fail_in_get_user', None):
53             raise Exception("failing in get_user")
54         if access_token != dict(key='uiop', secret='5678'):
55             raise Exception("incorrect access token %r" % access_token)
56         callback(dict(email='foo@example.com'))
57 class OAuth1ClientLoginCoroutineHandler(OAuth1ClientLoginHandler):
58     @gen.coroutine
59     def get(self):
60         if self.get_argument('oauth_token', None):
61             try:
62                 yield self.get_authenticated_user()
63             except Exception as e:
64                 self.set_status(503)
65                 self.write("got exception: %s" % e)
66         else:
67             yield self.authorize_redirect()
68 class OAuth1ClientRequestParametersHandler(RequestHandler, OAuthMixin):
69     def initialize(self, version):
70         self._OAUTH_VERSION = version
71     def _oauth_consumer_token(self):
72         return dict(key='asdf', secret='qwer')
73     def get(self):
74         params = self._oauth_request_parameters(
75             'http://www.example.com/api/asdf',
76             dict(key='uiop', secret='5678'),
77             parameters=dict(foo='bar'))
78         self.write(params)
79 class OAuth1ServerRequestTokenHandler(RequestHandler):
80     def get(self):
81         self.write('oauth_token=zxcv&amp;oauth_token_secret=1234')
82 class OAuth1ServerAccessTokenHandler(RequestHandler):
83     def get(self):
84         self.write('oauth_token=uiop&amp;oauth_token_secret=5678')
85 class OAuth2ClientLoginHandler(RequestHandler, OAuth2Mixin):
86     def initialize(self, test):
87         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth2/server/authorize')
88     def get(self):
89         res = self.authorize_redirect()
90         assert isinstance(res, Future)
91         assert res.done()
92 class FacebookClientLoginHandler(RequestHandler, FacebookGraphMixin):
93     def initialize(self, test):
94         self._OAUTH_AUTHORIZE_URL = test.get_url('/facebook/server/authorize')
95         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/facebook/server/access_token')
96         self._FACEBOOK_BASE_URL = test.get_url('/facebook/server')
97     @gen.coroutine
98     def get(self):
99         if self.get_argument("code", None):
100             user = yield self.get_authenticated_user(
101                 redirect_uri=self.request.full_url(),
102                 client_id=self.settings["facebook_api_key"],
103                 client_secret=self.settings["facebook_secret"],
104                 code=self.get_argument("code"))
105             self.write(user)
106         else:
107             yield self.authorize_redirect(
108                 redirect_uri=self.request.full_url(),
109                 client_id=self.settings["facebook_api_key"],
110                 extra_params={"scope": "read_stream,offline_access"})
111 class FacebookServerAccessTokenHandler(RequestHandler):
112     def get(self):
113         self.write(dict(access_token="asdf", expires_in=3600))
114 class FacebookServerMeHandler(RequestHandler):
115     def get(self):
116         self.write('{}')
117 class TwitterClientHandler(RequestHandler, TwitterMixin):
118     def initialize(self, test):
119         self._OAUTH_REQUEST_TOKEN_URL = test.get_url('/oauth1/server/request_token')
120         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/twitter/server/access_token')
121         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth1/server/authorize')
122         self._TWITTER_BASE_URL = test.get_url('/twitter/api')
123     def get_auth_http_client(self):
124         return self.settings['http_client']
125 class TwitterClientLoginHandler(TwitterClientHandler):
126     @asynchronous
127     def get(self):
128         if self.get_argument("oauth_token", None):
129             self.get_authenticated_user(self.on_user)
130             return
131         self.authorize_redirect()
132     def on_user(self, user):
133         if user is None:
134             raise Exception("user is None")
135         self.finish(user)
136 class TwitterClientLoginGenEngineHandler(TwitterClientHandler):
137     @asynchronous
138     @gen.engine
139     def get(self):
140         if self.get_argument("oauth_token", None):
141             user = yield self.get_authenticated_user()
142             self.finish(user)
143         else:
144             self.authorize_redirect()
145 class TwitterClientLoginGenCoroutineHandler(TwitterClientHandler):
146     @gen.coroutine
147     def get(self):
148         if self.get_argument("oauth_token", None):
149             user = yield self.get_authenticated_user()
150             self.finish(user)
151         else:
152             yield self.authorize_redirect()
153 class TwitterClientShowUserHandler(TwitterClientHandler):
154     @asynchronous
155     @gen.engine
156     def get(self):
157         response = yield gen.Task(self.twitter_request,
158                                   '/users/show/%s' % self.get_argument('name'),
159                                   access_token=dict(key='hjkl', secret='vbnm'))
160         if response is None:
161             self.set_status(500)
162             self.finish('error from twitter request')
163         else:
164             self.finish(response)
165 class TwitterClientShowUserFutureHandler(TwitterClientHandler):
166     @asynchronous
167     @gen.engine
168     def get(self):
169         try:
170             response = yield self.twitter_request(
171                 '/users/show/%s' % self.get_argument('name'),
172                 access_token=dict(key='hjkl', secret='vbnm'))
173         except AuthError as e:
174             self.set_status(500)
175             self.finish(str(e))
176             return
177         assert response is not None
178         self.finish(response)
179 class TwitterServerAccessTokenHandler(RequestHandler):
180     def get(self):
181         self.write('oauth_token=hjkl&amp;oauth_token_secret=vbnm&amp;screen_name=foo')
182 class TwitterServerShowUserHandler(RequestHandler):
183     def get(self, screen_name):
184         if screen_name == 'error':
185             raise HTTPError(500)
186         assert 'oauth_nonce' in self.request.arguments
187         assert 'oauth_timestamp' in self.request.arguments
188         assert 'oauth_signature' in self.request.arguments
189         assert self.get_argument('oauth_consumer_key') == 'test_twitter_consumer_key'
190         assert self.get_argument('oauth_signature_method') == 'HMAC-SHA1'
191         assert self.get_argument('oauth_version') == '1.0'
192         assert self.get_argument('oauth_token') == 'hjkl'
193         self.write(dict(screen_name=screen_name, name=screen_name.capitalize()))
194 class TwitterServerVerifyCredentialsHandler(RequestHandler):
195     def get(self):
196         assert 'oauth_nonce' in self.request.arguments
197         assert 'oauth_timestamp' in self.request.arguments
198         assert 'oauth_signature' in self.request.arguments
199         assert self.get_argument('oauth_consumer_key') == 'test_twitter_consumer_key'
200         assert self.get_argument('oauth_signature_method') == 'HMAC-SHA1'
201         assert self.get_argument('oauth_version') == '1.0'
202         assert self.get_argument('oauth_token') == 'hjkl'
203         self.write(dict(screen_name='foo', name='Foo'))
204 class AuthTest(AsyncHTTPTestCase):
205     def get_app(self):
206         return Application(
207             [
208                 ('/openid/client/login', OpenIdClientLoginHandler, dict(test=self)),
209                 ('/oauth10/client/login', OAuth1ClientLoginHandler,
210                  dict(test=self, version='1.0')),
211                 ('/oauth10/client/request_params',
212                  OAuth1ClientRequestParametersHandler,
213                  dict(version='1.0')),
214                 ('/oauth10a/client/login', OAuth1ClientLoginHandler,
215                  dict(test=self, version='1.0a')),
216                 ('/oauth10a/client/login_coroutine',
217                  OAuth1ClientLoginCoroutineHandler,
218                  dict(test=self, version='1.0a')),
219                 ('/oauth10a/client/request_params',
220                  OAuth1ClientRequestParametersHandler,
221                  dict(version='1.0a')),
222                 ('/oauth2/client/login', OAuth2ClientLoginHandler, dict(test=self)),
223                 ('/facebook/client/login', FacebookClientLoginHandler, dict(test=self)),
224                 ('/twitter/client/login', TwitterClientLoginHandler, dict(test=self)),
225                 ('/twitter/client/login_gen_engine', TwitterClientLoginGenEngineHandler, dict(test=self)),
226                 ('/twitter/client/login_gen_coroutine', TwitterClientLoginGenCoroutineHandler, dict(test=self)),
227                 ('/twitter/client/show_user', TwitterClientShowUserHandler, dict(test=self)),
228                 ('/twitter/client/show_user_future', TwitterClientShowUserFutureHandler, dict(test=self)),
229                 ('/openid/server/authenticate', OpenIdServerAuthenticateHandler),
230                 ('/oauth1/server/request_token', OAuth1ServerRequestTokenHandler),
231                 ('/oauth1/server/access_token', OAuth1ServerAccessTokenHandler),
232                 ('/facebook/server/access_token', FacebookServerAccessTokenHandler),
233                 ('/facebook/server/me', FacebookServerMeHandler),
234                 ('/twitter/server/access_token', TwitterServerAccessTokenHandler),
235                 (r'/twitter/api/users/show/(.*)\.json', TwitterServerShowUserHandler),
236                 (r'/twitter/api/account/verify_credentials\.json', TwitterServerVerifyCredentialsHandler),
237             ],
238             http_client=self.http_client,
239             twitter_consumer_key='test_twitter_consumer_key',
240             twitter_consumer_secret='test_twitter_consumer_secret',
241 <a name="1"></a>            facebook_api_key='test_facebook_api_key',
242             facebook_secret='test_facebook_secret')
243     <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>def test_openid_redirect(self):
244         response = self.fetch('/openid/client/login', follow_redirects=False)
245         self.assertEqual(response.code, 302)
246         self.assertTrue(
247             '/openid/server/authenticate?' in response.headers[</b></font>'Location'])
248     def test_openid_get_user(self):
249         response = self.fetch('/openid/client/login?openid.mode=blah&amp;openid.ns.ax=http://openid.net/srv/ax/1.0&amp;openid.ax.type.email=http://axschema.org/contact/email&amp;openid.ax.value.email=foo@example.com')
250         response.rethrow()
251         parsed = json_decode(response.body)
252         self.assertEqual(parsed["email"], "foo@example.com")
253     def test_oauth10_redirect(self):
254         response = self.fetch('/oauth10/client/login', follow_redirects=False)
255         self.assertEqual(response.code, 302)
256         self.assertTrue(response.headers['Location'].endswith(
257             '/oauth1/server/authorize?oauth_token=zxcv'))
258         self.assertTrue(
259             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
260             response.headers['Set-Cookie'])
261     def test_oauth10_get_user(self):
262         response = self.fetch(
263             '/oauth10/client/login?oauth_token=zxcv',
264             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
265         response.rethrow()
266         parsed = json_decode(response.body)
267         self.assertEqual(parsed['email'], 'foo@example.com')
268         self.assertEqual(parsed['access_token'], dict(key='uiop', secret='5678'))
269 <a name="0"></a>    def test_oauth10_request_parameters(self):
270         response = self.fetch('/oauth10/client/request_params')
271         response.rethrow()
272         parsed = json_decode<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(response.body)
273         self.assertEqual(parsed['oauth_consumer_key'], 'asdf')
274         self.assertEqual(parsed['oauth_token'], 'uiop')
275         self.assertTrue('oauth_nonce' in parsed)
276         self.assertTrue(</b></font>'oauth_signature' in parsed)
277     def test_oauth10a_redirect(self):
278         response = self.fetch('/oauth10a/client/login', follow_redirects=False)
279         self.assertEqual(response.code, 302)
280         self.assertTrue(response.headers['Location'].endswith(
281             '/oauth1/server/authorize?oauth_token=zxcv'))
282         self.assertTrue(
283             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
284             response.headers['Set-Cookie'])
285     def test_oauth10a_get_user(self):
286         response = self.fetch(
287             '/oauth10a/client/login?oauth_token=zxcv',
288             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
289         response.rethrow()
290         parsed = json_decode(response.body)
291         self.assertEqual(parsed['email'], 'foo@example.com')
292         self.assertEqual(parsed['access_token'], dict(key='uiop', secret='5678'))
293     def test_oauth10a_request_parameters(self):
294         response = self.fetch('/oauth10a/client/request_params')
295         response.rethrow()
296         parsed = json_decode(response.body)
297         self.assertEqual(parsed['oauth_consumer_key'], 'asdf')
298         self.assertEqual(parsed['oauth_token'], 'uiop')
299         self.assertTrue('oauth_nonce' in parsed)
300         self.assertTrue('oauth_signature' in parsed)
301     def test_oauth10a_get_user_coroutine_exception(self):
302         response = self.fetch(
303             '/oauth10a/client/login_coroutine?oauth_token=zxcv&amp;fail_in_get_user=true',
304             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
305         self.assertEqual(response.code, 503)
306     def test_oauth2_redirect(self):
307         response = self.fetch('/oauth2/client/login', follow_redirects=False)
308         self.assertEqual(response.code, 302)
309         self.assertTrue('/oauth2/server/authorize?' in response.headers['Location'])
310     def test_facebook_login(self):
311         response = self.fetch('/facebook/client/login', follow_redirects=False)
312         self.assertEqual(response.code, 302)
313         self.assertTrue('/facebook/server/authorize?' in response.headers['Location'])
314         response = self.fetch('/facebook/client/login?code=1234', follow_redirects=False)
315         self.assertEqual(response.code, 200)
316         user = json_decode(response.body)
317         self.assertEqual(user['access_token'], 'asdf')
318         self.assertEqual(user['session_expires'], '3600')
319     def base_twitter_redirect(self, url):
320         response = self.fetch(url, follow_redirects=False)
321         self.assertEqual(response.code, 302)
322         self.assertTrue(response.headers['Location'].endswith(
323             '/oauth1/server/authorize?oauth_token=zxcv'))
324         self.assertTrue(
325             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
326             response.headers['Set-Cookie'])
327     def test_twitter_redirect(self):
328         self.base_twitter_redirect('/twitter/client/login')
329     def test_twitter_redirect_gen_engine(self):
330         self.base_twitter_redirect('/twitter/client/login_gen_engine')
331     def test_twitter_redirect_gen_coroutine(self):
332         self.base_twitter_redirect('/twitter/client/login_gen_coroutine')
333     def test_twitter_get_user(self):
334         response = self.fetch(
335             '/twitter/client/login?oauth_token=zxcv',
336             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
337         response.rethrow()
338         parsed = json_decode(response.body)
339         self.assertEqual(parsed,
340                          {u'access_token': {u'key': u'hjkl',
341                                             u'screen_name': u'foo',
342                                             u'secret': u'vbnm'},
343                           u'name': u'Foo',
344                           u'screen_name': u'foo',
345                           u'username': u'foo'})
346     def test_twitter_show_user(self):
347         response = self.fetch('/twitter/client/show_user?name=somebody')
348         response.rethrow()
349         self.assertEqual(json_decode(response.body),
350                          {'name': 'Somebody', 'screen_name': 'somebody'})
351     def test_twitter_show_user_error(self):
352         with ExpectLog(gen_log, 'Error response HTTP 500'):
353             response = self.fetch('/twitter/client/show_user?name=error')
354         self.assertEqual(response.code, 500)
355         self.assertEqual(response.body, b'error from twitter request')
356     def test_twitter_show_user_future(self):
357         response = self.fetch('/twitter/client/show_user_future?name=somebody')
358         response.rethrow()
359         self.assertEqual(json_decode(response.body),
360                          {'name': 'Somebody', 'screen_name': 'somebody'})
361     def test_twitter_show_user_future_error(self):
362         response = self.fetch('/twitter/client/show_user_future?name=error')
363         self.assertEqual(response.code, 500)
364         self.assertIn(b'Error response HTTP 500', response.body)
365 class GoogleLoginHandler(RequestHandler, GoogleOAuth2Mixin):
366     def initialize(self, test):
367         self.test = test
368         self._OAUTH_REDIRECT_URI = test.get_url('/client/login')
369         self._OAUTH_AUTHORIZE_URL = test.get_url('/google/oauth2/authorize')
370         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/google/oauth2/token')
371     @gen.coroutine
372     def get(self):
373         code = self.get_argument('code', None)
374         if code is not None:
375             access = yield self.get_authenticated_user(self._OAUTH_REDIRECT_URI,
376                                                        code)
377             user = yield self.oauth2_request(
378                 self.test.get_url("/google/oauth2/userinfo"),
379                 access_token=access["access_token"])
380             user["access_token"] = access["access_token"]
381             self.write(user)
382         else:
383             yield self.authorize_redirect(
384                 redirect_uri=self._OAUTH_REDIRECT_URI,
385                 client_id=self.settings['google_oauth']['key'],
386                 client_secret=self.settings['google_oauth']['secret'],
387                 scope=['profile', 'email'],
388                 response_type='code',
389                 extra_params={'prompt': 'select_account'})
390 class GoogleOAuth2AuthorizeHandler(RequestHandler):
391     def get(self):
392         code = 'fake-authorization-code'
393         self.redirect(url_concat(self.get_argument('redirect_uri'),
394                                  dict(code=code)))
395 class GoogleOAuth2TokenHandler(RequestHandler):
396     def post(self):
397         assert self.get_argument('code') == 'fake-authorization-code'
398         self.finish({
399             'access_token': 'fake-access-token',
400             'expires_in': 'never-expires'
401         })
402 class GoogleOAuth2UserinfoHandler(RequestHandler):
403     def get(self):
404         assert self.get_argument('access_token') == 'fake-access-token'
405         self.finish({
406             'name': 'Foo',
407             'email': 'foo@example.com'
408         })
409 class GoogleOAuth2Test(AsyncHTTPTestCase):
410     def get_app(self):
411         return Application(
412             [
413                 ('/client/login', GoogleLoginHandler, dict(test=self)),
414                 ('/google/oauth2/authorize', GoogleOAuth2AuthorizeHandler),
415                 ('/google/oauth2/token', GoogleOAuth2TokenHandler),
416                 ('/google/oauth2/userinfo', GoogleOAuth2UserinfoHandler),
417             ],
418             google_oauth={
419                 "key": 'fake_google_client_id',
420                 "secret": 'fake_google_client_secret'
421             })
422     def test_google_login(self):
423         response = self.fetch('/client/login')
424         self.assertDictEqual({
425             u'name': u'Foo',
426             u'email': u'foo@example.com',
427             u'access_token': u'fake-access-token',
428         }, json_decode(response.body))
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>queues_test.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, division, print_function
2 from datetime import timedelta
3 from random import random
4 from salt.ext.tornado import gen, queues
5 from salt.ext.tornado.gen import TimeoutError
6 from salt.ext.tornado.testing import gen_test, AsyncTestCase
7 from salt.ext.tornado.test.util import unittest, skipBefore35, exec_test
8 class QueueBasicTest(AsyncTestCase):
9     def test_repr_and_str(self):
10         q = queues.Queue(maxsize=1)
11         self.assertIn(hex(id(q)), repr(q))
12         self.assertNotIn(hex(id(q)), str(q))
13         q.get()
14         for q_str in repr(q), str(q):
15             self.assertTrue(q_str.startswith('&lt;Queue'))
16             self.assertIn('maxsize=1', q_str)
17             self.assertIn('getters[1]', q_str)
18             self.assertNotIn('putters', q_str)
19             self.assertNotIn('tasks', q_str)
20         q.put(None)
21         q.put(None)
22         q.put(None)
23         for q_str in repr(q), str(q):
24             self.assertNotIn('getters', q_str)
25             self.assertIn('putters[1]', q_str)
26             self.assertIn('tasks=2', q_str)
27     def test_order(self):
28         q = queues.Queue()
29         for i in [1, 3, 2]:
30             q.put_nowait(i)
31         items = [q.get_nowait() for _ in range(3)]
32         self.assertEqual([1, 3, 2], items)
33     @gen_test
34     def test_maxsize(self):
35         self.assertRaises(TypeError, queues.Queue, maxsize=None)
36         self.assertRaises(ValueError, queues.Queue, maxsize=-1)
37         q = queues.Queue(maxsize=2)
38         self.assertTrue(q.empty())
39         self.assertFalse(q.full())
40         self.assertEqual(2, q.maxsize)
41         self.assertTrue(q.put(0).done())
42         self.assertTrue(q.put(1).done())
43         self.assertFalse(q.empty())
44         self.assertTrue(q.full())
45         put2 = q.put(2)
46         self.assertFalse(put2.done())
47         self.assertEqual(0, (yield q.get()))  # Make room.
48         self.assertTrue(put2.done())
49         self.assertFalse(q.empty())
50         self.assertTrue(q.full())
51 class QueueGetTest(AsyncTestCase):
52     @gen_test
53     def test_blocking_get(self):
54         q = queues.Queue()
55         q.put_nowait(0)
56         self.assertEqual(0, (yield q.get()))
57     def test_nonblocking_get(self):
58         q = queues.Queue()
59         q.put_nowait(0)
60         self.assertEqual(0, q.get_nowait())
61     def test_nonblocking_get_exception(self):
62         q = queues.Queue()
63         self.assertRaises(queues.QueueEmpty, q.get_nowait)
64     @gen_test
65     def test_get_with_putters(self):
66         q = queues.Queue(1)
67         q.put_nowait(0)
68         put = q.put(1)
69         self.assertEqual(0, (yield q.get()))
70         self.assertIsNone((yield put))
71     @gen_test
72     def test_blocking_get_wait(self):
73         q = queues.Queue()
74         q.put(0)
75         self.io_loop.call_later(0.01, q.put, 1)
76         self.io_loop.call_later(0.02, q.put, 2)
77         self.assertEqual(0, (yield q.get(timeout=timedelta(seconds=1))))
78         self.assertEqual(1, (yield q.get(timeout=timedelta(seconds=1))))
79     @gen_test
80     def test_get_timeout(self):
81         q = queues.Queue()
82         get_timeout = q.get(timeout=timedelta(seconds=0.01))
83         get = q.get()
84         with self.assertRaises(TimeoutError):
85             yield get_timeout
86         q.put_nowait(0)
87         self.assertEqual(0, (yield get))
88     @gen_test
89     def test_get_timeout_preempted(self):
90         q = queues.Queue()
91         get = q.get(timeout=timedelta(seconds=0.01))
92         q.put(0)
93         yield gen.sleep(0.02)
94         self.assertEqual(0, (yield get))
95     @gen_test
96     def test_get_clears_timed_out_putters(self):
97         q = queues.Queue(1)
98         putters = [q.put(i, timedelta(seconds=0.01)) for i in range(10)]
99         put = q.put(10)
100         self.assertEqual(10, len(q._putters))
101         yield gen.sleep(0.02)
102         self.assertEqual(10, len(q._putters))
103         self.assertFalse(put.done())  # Final waiter is still active.
104         q.put(11)
105         self.assertEqual(0, (yield q.get()))  # get() clears the waiters.
106         self.assertEqual(1, len(q._putters))
107         for putter in putters[1:]:
108             self.assertRaises(TimeoutError, putter.result)
109     @gen_test
110     def test_get_clears_timed_out_getters(self):
111         q = queues.Queue()
112         getters = [q.get(timedelta(seconds=0.01)) for _ in range(10)]
113         get = q.get()
114         self.assertEqual(11, len(q._getters))
115         yield gen.sleep(0.02)
116         self.assertEqual(11, len(q._getters))
117         self.assertFalse(get.done())  # Final waiter is still active.
118         q.get()  # get() clears the waiters.
119         self.assertEqual(2, len(q._getters))
120         for getter in getters:
121             self.assertRaises(TimeoutError, getter.result)
122     @skipBefore35
123     @gen_test
124     def test_async_for(self):
125         q = queues.Queue()
126         for i in range(5):
127             q.put(i)
128         namespace = exec_test(globals(), locals(), """
129         async def f():
130             results = []
131             async for i in q:
132                 results.append(i)
133                 if i == 4:
134                     return results
135     <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>def test_order(self):
136         q = self.queue_class(maxsize=2)
137 <a name="0"></a>        q.put_nowait((1, 'a'))
138         q.put_nowait((0, 'b'))
139         self.</b></font>assertTrue(q.full())
140         q.put<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>((3, 'c'))
141         q.put((2, 'd'))
142         self.assertEqual((0, 'b'), q.get_nowait())
143         self.assertEqual(</b></font>(1, 'a'), (yield q.get()))
144         self.assertEqual((2, 'd'), q.get_nowait())
145         self.assertEqual((3, 'c'), (yield q.get()))
146         self.assertTrue(q.empty())
147 class LifoQueueJoinTest(QueueJoinTest):
148     queue_class = queues.LifoQueue
149     @gen_test
150     def test_order(self):
151         q = self.queue_class(maxsize=2)
152         q.put_nowait(1)
153         q.put_nowait(0)
154         self.assertTrue(q.full())
155         q.put(3)
156         q.put(2)
157         self.assertEqual(3, q.get_nowait())
158         self.assertEqual(2, (yield q.get()))
159         self.assertEqual(0, q.get_nowait())
160         self.assertEqual(1, (yield q.get()))
161         self.assertTrue(q.empty())
162 class ProducerConsumerTest(AsyncTestCase):
163     @gen_test
164     def test_producer_consumer(self):
165         q = queues.Queue(maxsize=3)
166         history = []
167         @gen.coroutine
168         def consumer():
169             while True:
170                 history.append((yield q.get()))
171                 q.task_done()
172         @gen.coroutine
173         def producer():
174             for item in range(10):
175                 yield q.put(item)
176         consumer()
177         yield producer()
178         yield q.join()
179         self.assertEqual(list(range(10)), history)
180 if __name__ == '__main__':
181     unittest.main()
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
