<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for fragment.py &amp; test_subtitles.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for fragment.py &amp; test_subtitles.py
      </h3>
<h1 align="center">
        2.0%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>fragment.py (2.9126213%)<th>test_subtitles.py (1.5228426%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(145-148)<td><a href="#" name="0">(8-8)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>fragment.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import division, unicode_literals
2 import os
3 import time
4 import json
5 from .common import FileDownloader
6 from .http import HttpFD
7 from ..utils import (
8     error_to_compat_str,
9     encodeFilename,
10     sanitize_open,
11     sanitized_Request,
12 )
13 class HttpQuietDownloader(HttpFD):
14     def to_screen(self, *args, **kargs):
15         pass
16 class FragmentFD(FileDownloader):
17     def report_retry_fragment(self, err, frag_index, count, retries):
18         self.to_screen(
19             '[download] Got server HTTP error: %s. Retrying fragment %d (attempt %d of %s)...'
20             % (error_to_compat_str(err), frag_index, count, self.format_retries(retries)))
21     def report_skip_fragment(self, frag_index):
22         self.to_screen('[download] Skipping fragment %d...' % frag_index)
23     def _prepare_url(self, info_dict, url):
24         headers = info_dict.get('http_headers')
25         return sanitized_Request(url, None, headers) if headers else url
26     def _prepare_and_start_frag_download(self, ctx):
27         self._prepare_frag_download(ctx)
28         self._start_frag_download(ctx)
29     @staticmethod
30     def __do_ytdl_file(ctx):
31         return not ctx['live'] and not ctx['tmpfilename'] == '-'
32     def _read_ytdl_file(self, ctx):
33         assert 'ytdl_corrupt' not in ctx
34         stream, _ = sanitize_open(self.ytdl_filename(ctx['filename']), 'r')
35         try:
36             ctx['fragment_index'] = json.loads(stream.read())['downloader']['current_fragment']['index']
37         except Exception:
38             ctx['ytdl_corrupt'] = True
39         finally:
40             stream.close()
41     def _write_ytdl_file(self, ctx):
42         frag_index_stream, _ = sanitize_open(self.ytdl_filename(ctx['filename']), 'w')
43         downloader = {
44             'current_fragment': {
45                 'index': ctx['fragment_index'],
46             },
47         }
48         if ctx.get('fragment_count') is not None:
49             downloader['fragment_count'] = ctx['fragment_count']
50         frag_index_stream.write(json.dumps({'downloader': downloader}))
51         frag_index_stream.close()
52     def _download_fragment(self, ctx, frag_url, info_dict, headers=None):
53         fragment_filename = '%s-Frag%d' % (ctx['tmpfilename'], ctx['fragment_index'])
54         fragment_info_dict = {
55             'url': frag_url,
56             'http_headers': headers or info_dict.get('http_headers'),
57         }
58         success = ctx['dl'].download(fragment_filename, fragment_info_dict)
59         if not success:
60             return False, None
61         if fragment_info_dict.get('filetime'):
62             ctx['fragment_filetime'] = fragment_info_dict.get('filetime')
63         down, frag_sanitized = sanitize_open(fragment_filename, 'rb')
64         ctx['fragment_filename_sanitized'] = frag_sanitized
65         frag_content = down.read()
66         down.close()
67         return True, frag_content
68     def _append_fragment(self, ctx, frag_content):
69         try:
70             ctx['dest_stream'].write(frag_content)
71             ctx['dest_stream'].flush()
72         finally:
73             if self.__do_ytdl_file(ctx):
74                 self._write_ytdl_file(ctx)
75             if not self.params.get('keep_fragments', False):
76                 os.remove(encodeFilename(ctx['fragment_filename_sanitized']))
77             del ctx['fragment_filename_sanitized']
78     def _prepare_frag_download(self, ctx):
79         if 'live' not in ctx:
80             ctx['live'] = False
81         if not ctx['live']:
82             total_frags_str = '%d' % ctx['total_frags']
83             ad_frags = ctx.get('ad_frags', 0)
84             if ad_frags:
85                 total_frags_str += ' (not including %d ad)' % ad_frags
86         else:
87             total_frags_str = 'unknown (live)'
88         self.to_screen(
89             '[%s] Total fragments: %s' % (self.FD_NAME, total_frags_str))
90         self.report_destination(ctx['filename'])
91         dl = HttpQuietDownloader(
92             self.ydl,
93             {
94                 'quiet': True,
95                 'noprogress': True,
96                 'ratelimit': self<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.params.get('ratelimit'),
97                 'retries': self.params.get('retries', 0),
98                 'nopart': self.params.get('nopart', False),
99                 'test': self.params.get(</b></font>'test', False),
100             }
101         )
102         tmpfilename = self.temp_name(ctx['filename'])
103         open_mode = 'wb'
104         resume_len = 0
105         if os.path.isfile(encodeFilename(tmpfilename)):
106             open_mode = 'ab'
107             resume_len = os.path.getsize(encodeFilename(tmpfilename))
108         ctx.update({
109             'tmpfilename': tmpfilename,
110             'fragment_index': 0,
111         })
112         if self.__do_ytdl_file(ctx):
113             if os.path.isfile(encodeFilename(self.ytdl_filename(ctx['filename']))):
114                 self._read_ytdl_file(ctx)
115                 is_corrupt = ctx.get('ytdl_corrupt') is True
116                 is_inconsistent = ctx['fragment_index'] &gt; 0 and resume_len == 0
117                 if is_corrupt or is_inconsistent:
118                     message = (
119                         '.ytdl file is corrupt' if is_corrupt else
120                         'Inconsistent state of incomplete fragment download')
121                     self.report_warning(
122                         '%s. Restarting from the beginning...' % message)
123                     ctx['fragment_index'] = resume_len = 0
124                     if 'ytdl_corrupt' in ctx:
125                         del ctx['ytdl_corrupt']
126                     self._write_ytdl_file(ctx)
127             else:
128                 self._write_ytdl_file(ctx)
129                 assert ctx['fragment_index'] == 0
130         dest_stream, tmpfilename = sanitize_open(tmpfilename, open_mode)
131         ctx.update({
132             'dl': dl,
133             'dest_stream': dest_stream,
134             'tmpfilename': tmpfilename,
135             'complete_frags_downloaded_bytes': resume_len,
136         })
137     def _start_frag_download(self, ctx):
138         resume_len = ctx['complete_frags_downloaded_bytes']
139         total_frags = ctx['total_frags']
140         state = {
141             'status': 'downloading',
142             'downloaded_bytes': resume_len,
143             'fragment_index': ctx['fragment_index'],
144             'fragment_count': total_frags,
145             'filename': ctx['filename'],
146             'tmpfilename': ctx['tmpfilename'],
147         }
148         start = time.time()
149         ctx.update({
150             'started': start,
151             'prev_frag_downloaded_bytes': 0,
152         })
153         def frag_progress_hook(s):
154             if s['status'] not in ('downloading', 'finished'):
155                 return
156             time_now = time.time()
157             state['elapsed'] = time_now - start
158             frag_total_bytes = s.get('total_bytes') or 0
159             if not ctx['live']:
160                 estimated_size = (
161                     (ctx['complete_frags_downloaded_bytes'] + frag_total_bytes)
162                     / (state['fragment_index'] + 1) * total_frags)
163                 state['total_bytes_estimate'] = estimated_size
164             if s['status'] == 'finished':
165                 state['fragment_index'] += 1
166                 ctx['fragment_index'] = state['fragment_index']
167                 state['downloaded_bytes'] += frag_total_bytes - ctx['prev_frag_downloaded_bytes']
168                 ctx['complete_frags_downloaded_bytes'] = state['downloaded_bytes']
169                 ctx['prev_frag_downloaded_bytes'] = 0
170             else:
171                 frag_downloaded_bytes = s['downloaded_bytes']
172                 state['downloaded_bytes'] += frag_downloaded_bytes - ctx['prev_frag_downloaded_bytes']
173                 if not ctx['live']:
174                     state['eta'] = self.calc_eta(
175                         start, time_now, estimated_size - resume_len,
176                         state['downloaded_bytes'] - resume_len)
177                 state['speed'] = s.get('speed') or ctx.get('speed')
178                 ctx['speed'] = state['speed']
179                 ctx['prev_frag_downloaded_bytes'] = frag_downloaded_bytes
180             self._hook_progress(state)
181         ctx['dl'].add_progress_hook(frag_progress_hook)
182         return start
183     def _finish_frag_download(self, ctx):
184         ctx['dest_stream'].close()
185         if self.__do_ytdl_file(ctx):
186             ytdl_filename = encodeFilename(self.ytdl_filename(ctx['filename']))
187             if os.path.isfile(ytdl_filename):
188                 os.remove(ytdl_filename)
189         elapsed = time.time() - ctx['started']
190         if ctx['tmpfilename'] == '-':
191             downloaded_bytes = ctx['complete_frags_downloaded_bytes']
192         else:
193             self.try_rename(ctx['tmpfilename'], ctx['filename'])
194             if self.params.get('updatetime', True):
195                 filetime = ctx.get('fragment_filetime')
196                 if filetime:
197                     try:
198                         os.utime(ctx['filename'], (time.time(), filetime))
199                     except Exception:
200                         pass
201             downloaded_bytes = os.path.getsize(encodeFilename(ctx['filename']))
202         self._hook_progress({
203             'downloaded_bytes': downloaded_bytes,
204             'total_bytes': downloaded_bytes,
205             'filename': ctx['filename'],
206             'status': 'finished',
207             'elapsed': elapsed,
208         })
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_subtitles.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 import sys
3 import unittest
4 sys<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(</b></font>__file__))))
5 from test.helper import FakeYDL, md5
6 from youtube_dl.extractor import (
7     YoutubeIE,
8     DailymotionIE,
9     TEDIE,
10     VimeoIE,
11     WallaIE,
12     CeskaTelevizeIE,
13     LyndaIE,
14     NPOIE,
15     ComedyCentralIE,
16     NRKTVIE,
17     RaiPlayIE,
18     VikiIE,
19     ThePlatformIE,
20     ThePlatformFeedIE,
21     RTVEALaCartaIE,
22     DemocracynowIE,
23 )
24 class BaseTestSubtitles(unittest.TestCase):
25     url = None
26     IE = None
27     def setUp(self):
28         self.DL = FakeYDL()
29         self.ie = self.IE()
30         self.DL.add_info_extractor(self.ie)
31     def getInfoDict(self):
32         info_dict = self.DL.extract_info(self.url, download=False)
33         return info_dict
34     def getSubtitles(self):
35         info_dict = self.getInfoDict()
36         subtitles = info_dict['requested_subtitles']
37         if not subtitles:
38             return subtitles
39         for sub_info in subtitles.values():
40             if sub_info.get('data') is None:
41                 uf = self.DL.urlopen(sub_info['url'])
42                 sub_info['data'] = uf.read().decode('utf-8')
43         return dict((l, sub_info['data']) for l, sub_info in subtitles.items())
44 class TestYoutubeSubtitles(BaseTestSubtitles):
45     url = 'QRS8MkLhQmM'
46     IE = YoutubeIE
47     def test_youtube_allsubtitles(self):
48         self.DL.params['writesubtitles'] = True
49         self.DL.params['allsubtitles'] = True
50         subtitles = self.getSubtitles()
51         self.assertEqual(len(subtitles.keys()), 13)
52         self.assertEqual(md5(subtitles['en']), '3cb210999d3e021bd6c7f0ea751eab06')
53         self.assertEqual(md5(subtitles['it']), '6d752b98c31f1cf8d597050c7a2cb4b5')
54         for lang in ['fr', 'de']:
55             self.assertTrue(subtitles.get(lang) is not None, 'Subtitles for \'%s\' not extracted' % lang)
56     def test_youtube_subtitles_ttml_format(self):
57         self.DL.params['writesubtitles'] = True
58         self.DL.params['subtitlesformat'] = 'ttml'
59         subtitles = self.getSubtitles()
60         self.assertEqual(md5(subtitles['en']), 'e306f8c42842f723447d9f63ad65df54')
61     def test_youtube_subtitles_vtt_format(self):
62         self.DL.params['writesubtitles'] = True
63         self.DL.params['subtitlesformat'] = 'vtt'
64         subtitles = self.getSubtitles()
65         self.assertEqual(md5(subtitles['en']), '3cb210999d3e021bd6c7f0ea751eab06')
66     def test_youtube_automatic_captions(self):
67         self.url = '8YoUxe5ncPo'
68         self.DL.params['writeautomaticsub'] = True
69         self.DL.params['subtitleslangs'] = ['it']
70         subtitles = self.getSubtitles()
71         self.assertTrue(subtitles['it'] is not None)
72     def test_youtube_translated_subtitles(self):
73         self.url = 'Ky9eprVWzlI'
74         self.DL.params['writeautomaticsub'] = True
75         self.DL.params['subtitleslangs'] = ['it']
76         subtitles = self.getSubtitles()
77         self.assertTrue(subtitles['it'] is not None)
78     def test_youtube_nosubtitles(self):
79         self.DL.expect_warning('video doesn\'t have subtitles')
80         self.url = 'n5BB19UTcdA'
81         self.DL.params['writesubtitles'] = True
82         self.DL.params['allsubtitles'] = True
83         subtitles = self.getSubtitles()
84         self.assertFalse(subtitles)
85 class TestDailymotionSubtitles(BaseTestSubtitles):
86     url = 'http://www.dailymotion.com/video/xczg00'
87     IE = DailymotionIE
88     def test_allsubtitles(self):
89         self.DL.params['writesubtitles'] = True
90         self.DL.params['allsubtitles'] = True
91         subtitles = self.getSubtitles()
92         self.assertTrue(len(subtitles.keys()) &gt;= 6)
93         self.assertEqual(md5(subtitles['en']), '976553874490cba125086bbfea3ff76f')
94         self.assertEqual(md5(subtitles['fr']), '594564ec7d588942e384e920e5341792')
95         for lang in ['es', 'fr', 'de']:
96             self.assertTrue(subtitles.get(lang) is not None, 'Subtitles for \'%s\' not extracted' % lang)
97     def test_nosubtitles(self):
98         self.DL.expect_warning('video doesn\'t have subtitles')
99         self.url = 'http://www.dailymotion.com/video/x12u166_le-zapping-tele-star-du-08-aout-2013_tv'
100         self.DL.params['writesubtitles'] = True
101         self.DL.params['allsubtitles'] = True
102         subtitles = self.getSubtitles()
103         self.assertFalse(subtitles)
104 class TestTedSubtitles(BaseTestSubtitles):
105     url = 'http://www.ted.com/talks/dan_dennett_on_our_consciousness.html'
106     IE = TEDIE
107     def test_allsubtitles(self):
108         self.DL.params['writesubtitles'] = True
109         self.DL.params['allsubtitles'] = True
110         subtitles = self.getSubtitles()
111         self.assertTrue(len(subtitles.keys()) &gt;= 28)
112         self.assertEqual(md5(subtitles['en']), '4262c1665ff928a2dada178f62cb8d14')
113         self.assertEqual(md5(subtitles['fr']), '66a63f7f42c97a50f8c0e90bc7797bb5')
114         for lang in ['es', 'fr', 'de']:
115             self.assertTrue(subtitles.get(lang) is not None, 'Subtitles for \'%s\' not extracted' % lang)
116 class TestVimeoSubtitles(BaseTestSubtitles):
117     url = 'http://vimeo.com/76979871'
118     IE = VimeoIE
119     def test_allsubtitles(self):
120         self.DL.params['writesubtitles'] = True
121         self.DL.params['allsubtitles'] = True
122         subtitles = self.getSubtitles()
123         self.assertEqual(set(subtitles.keys()), set(['de', 'en', 'es', 'fr']))
124         self.assertEqual(md5(subtitles['en']), '8062383cf4dec168fc40a088aa6d5888')
125         self.assertEqual(md5(subtitles['fr']), 'b6191146a6c5d3a452244d853fde6dc8')
126     def test_nosubtitles(self):
127         self.DL.expect_warning('video doesn\'t have subtitles')
128         self.url = 'http://vimeo.com/56015672'
129         self.DL.params['writesubtitles'] = True
130         self.DL.params['allsubtitles'] = True
131         subtitles = self.getSubtitles()
132         self.assertFalse(subtitles)
133 class TestWallaSubtitles(BaseTestSubtitles):
134     url = 'http://vod.walla.co.il/movie/2705958/the-yes-men'
135     IE = WallaIE
136     def test_allsubtitles(self):
137         self.DL.expect_warning('Automatic Captions not supported by this server')
138         self.DL.params['writesubtitles'] = True
139         self.DL.params['allsubtitles'] = True
140         subtitles = self.getSubtitles()
141         self.assertEqual(set(subtitles.keys()), set(['heb']))
142         self.assertEqual(md5(subtitles['heb']), 'e758c5d7cb982f6bef14f377ec7a3920')
143     def test_nosubtitles(self):
144         self.DL.expect_warning('video doesn\'t have subtitles')
145         self.url = 'http://vod.walla.co.il/movie/2642630/one-direction-all-for-one'
146         self.DL.params['writesubtitles'] = True
147         self.DL.params['allsubtitles'] = True
148         subtitles = self.getSubtitles()
149         self.assertFalse(subtitles)
150 class TestCeskaTelevizeSubtitles(BaseTestSubtitles):
151     url = 'http://www.ceskatelevize.cz/ivysilani/10600540290-u6-uzasny-svet-techniky'
152     IE = CeskaTelevizeIE
153     def test_allsubtitles(self):
154         self.DL.expect_warning('Automatic Captions not supported by this server')
155         self.DL.params['writesubtitles'] = True
156         self.DL.params['allsubtitles'] = True
157         subtitles = self.getSubtitles()
158         self.assertEqual(set(subtitles.keys()), set(['cs']))
159         self.assertTrue(len(subtitles['cs']) &gt; 20000)
160     def test_nosubtitles(self):
161         self.DL.expect_warning('video doesn\'t have subtitles')
162         self.url = 'http://www.ceskatelevize.cz/ivysilani/ivysilani/10441294653-hyde-park-civilizace/214411058091220'
163         self.DL.params['writesubtitles'] = True
164         self.DL.params['allsubtitles'] = True
165         subtitles = self.getSubtitles()
166         self.assertFalse(subtitles)
167 class TestLyndaSubtitles(BaseTestSubtitles):
168     url = 'http://www.lynda.com/Bootstrap-tutorials/Using-exercise-files/110885/114408-4.html'
169     IE = LyndaIE
170     def test_allsubtitles(self):
171         self.DL.params['writesubtitles'] = True
172         self.DL.params['allsubtitles'] = True
173         subtitles = self.getSubtitles()
174         self.assertEqual(set(subtitles.keys()), set(['en']))
175         self.assertEqual(md5(subtitles['en']), '09bbe67222259bed60deaa26997d73a7')
176 class TestNPOSubtitles(BaseTestSubtitles):
177     url = 'http://www.npo.nl/nos-journaal/28-08-2014/POW_00722860'
178     IE = NPOIE
179     def test_allsubtitles(self):
180         self.DL.params['writesubtitles'] = True
181         self.DL.params['allsubtitles'] = True
182         subtitles = self.getSubtitles()
183         self.assertEqual(set(subtitles.keys()), set(['nl']))
184         self.assertEqual(md5(subtitles['nl']), 'fc6435027572b63fb4ab143abd5ad3f4')
185 class TestMTVSubtitles(BaseTestSubtitles):
186     url = 'http://www.cc.com/video-clips/p63lk0/adam-devine-s-house-party-chasing-white-swans'
187     IE = ComedyCentralIE
188     def getInfoDict(self):
189         return super(TestMTVSubtitles, self).getInfoDict()['entries'][0]
190     def test_allsubtitles(self):
191         self.DL.params['writesubtitles'] = True
192         self.DL.params['allsubtitles'] = True
193         subtitles = self.getSubtitles()
194         self.assertEqual(set(subtitles.keys()), set(['en']))
195         self.assertEqual(md5(subtitles['en']), '78206b8d8a0cfa9da64dc026eea48961')
196 class TestNRKSubtitles(BaseTestSubtitles):
197     url = 'http://tv.nrk.no/serie/ikke-gjoer-dette-hjemme/DMPV73000411/sesong-2/episode-1'
198     IE = NRKTVIE
199     def test_allsubtitles(self):
200         self.DL.params['writesubtitles'] = True
201         self.DL.params['allsubtitles'] = True
202         subtitles = self.getSubtitles()
203         self.assertEqual(set(subtitles.keys()), set(['no']))
204         self.assertEqual(md5(subtitles['no']), '544fa917d3197fcbee64634559221cc2')
205 class TestRaiPlaySubtitles(BaseTestSubtitles):
206     IE = RaiPlayIE
207     def test_subtitles_key(self):
208         self.url = 'http://www.raiplay.it/video/2014/04/Report-del-07042014-cb27157f-9dd0-4aee-b788-b1f67643a391.html'
209         self.DL.params['writesubtitles'] = True
210         self.DL.params['allsubtitles'] = True
211         subtitles = self.getSubtitles()
212         self.assertEqual(set(subtitles.keys()), set(['it']))
213         self.assertEqual(md5(subtitles['it']), 'b1d90a98755126b61e667567a1f6680a')
214     def test_subtitles_array_key(self):
215         self.url = 'https://www.raiplay.it/video/2020/12/Report---04-01-2021-2e90f1de-8eee-4de4-ac0e-78d21db5b600.html'
216         self.DL.params['writesubtitles'] = True
217         self.DL.params['allsubtitles'] = True
218         subtitles = self.getSubtitles()
219         self.assertEqual(set(subtitles.keys()), set(['it']))
220         self.assertEqual(md5(subtitles['it']), '4b3264186fbb103508abe5311cfcb9cd')
221 class TestVikiSubtitles(BaseTestSubtitles):
222     url = 'http://www.viki.com/videos/1060846v-punch-episode-18'
223     IE = VikiIE
224     def test_allsubtitles(self):
225         self.DL.params['writesubtitles'] = True
226         self.DL.params['allsubtitles'] = True
227         subtitles = self.getSubtitles()
228         self.assertEqual(set(subtitles.keys()), set(['en']))
229         self.assertEqual(md5(subtitles['en']), '53cb083a5914b2d84ef1ab67b880d18a')
230 class TestThePlatformSubtitles(BaseTestSubtitles):
231     url = 'theplatform:JFUjUE1_ehvq'
232     IE = ThePlatformIE
233     def test_allsubtitles(self):
234         self.DL.params['writesubtitles'] = True
235         self.DL.params['allsubtitles'] = True
236         subtitles = self.getSubtitles()
237         self.assertEqual(set(subtitles.keys()), set(['en']))
238         self.assertEqual(md5(subtitles['en']), '97e7670cbae3c4d26ae8bcc7fdd78d4b')
239 class TestThePlatformFeedSubtitles(BaseTestSubtitles):
240     url = 'http://feed.theplatform.com/f/7wvmTC/msnbc_video-p-test?form=json&amp;pretty=true&amp;range=-40&amp;byGuid=n_hardball_5biden_140207'
241     IE = ThePlatformFeedIE
242     def test_allsubtitles(self):
243         self.DL.params['writesubtitles'] = True
244         self.DL.params['allsubtitles'] = True
245         subtitles = self.getSubtitles()
246         self.assertEqual(set(subtitles.keys()), set(['en']))
247         self.assertEqual(md5(subtitles['en']), '48649a22e82b2da21c9a67a395eedade')
248 class TestRtveSubtitles(BaseTestSubtitles):
249     url = 'http://www.rtve.es/alacarta/videos/los-misterios-de-laura/misterios-laura-capitulo-32-misterio-del-numero-17-2-parte/2428621/'
250     IE = RTVEALaCartaIE
251     def test_allsubtitles(self):
252         print('Skipping, only available from Spain')
253         return
254         self.DL.params['writesubtitles'] = True
255         self.DL.params['allsubtitles'] = True
256         subtitles = self.getSubtitles()
257         self.assertEqual(set(subtitles.keys()), set(['es']))
258         self.assertEqual(md5(subtitles['es']), '69e70cae2d40574fb7316f31d6eb7fca')
259 class TestDemocracynowSubtitles(BaseTestSubtitles):
260     url = 'http://www.democracynow.org/shows/2015/7/3'
261     IE = DemocracynowIE
262     def test_allsubtitles(self):
263         self.DL.params['writesubtitles'] = True
264         self.DL.params['allsubtitles'] = True
265         subtitles = self.getSubtitles()
266         self.assertEqual(set(subtitles.keys()), set(['en']))
267         self.assertEqual(md5(subtitles['en']), 'acaca989e24a9e45a6719c9b3d60815c')
268     def test_subtitles_in_page(self):
269         self.url = 'http://www.democracynow.org/2015/7/3/this_flag_comes_down_today_bree'
270         self.DL.params['writesubtitles'] = True
271         self.DL.params['allsubtitles'] = True
272         subtitles = self.getSubtitles()
273         self.assertEqual(set(subtitles.keys()), set(['en']))
274         self.assertEqual(md5(subtitles['en']), 'acaca989e24a9e45a6719c9b3d60815c')
275 if __name__ == '__main__':
276     unittest.main()
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
