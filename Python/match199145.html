<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for random_org.py &amp; auth_test.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for random_org.py &amp; auth_test.py
      </h3>
<h1 align="center">
        1.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>random_org.py (1.7148982%)<th>auth_test.py (1.6309888%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(146-149)<td><a href="#" name="0">(163-166)</a><td align="center"><font color="#ff0000">16</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>random_org.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import http.client
2 import logging
3 import urllib.request
4 import salt.utils.http
5 import salt.utils.json
6 log = logging.getLogger(__name__)
7 __virtualname__ = "random_org"
8 RANDOM_ORG_FUNCTIONS = {
9     "1": {
10         "getUsage": {"method": "getUsage"},
11         "generateIntegers": {"method": "generateIntegers"},
12         "generateStrings": {"method": "generateStrings"},
13         "generateUUIDs": {"method": "generateUUIDs"},
14         "generateDecimalFractions": {"method": "generateDecimalFractions"},
15         "generateGaussians": {"method": "generateGaussians"},
16         "generateBlobs": {"method": "generateBlobs"},
17     }
18 }
19 def __virtual__():
20     return __virtualname__
21 def _numeric(n):
22     return isinstance(n, (int, float))
23 def _query(api_version=None, data=None):
24     if data is None:
25         data = {}
26     ret = {"res": True}
27     api_url = "https://api.random.org/"
28     base_url = urllib.parse.urljoin(api_url, "json-rpc/" + str(api_version) + "/invoke")
29     data = salt.utils.json.dumps(data)
30     result = salt.utils.http.query(
31         base_url,
32         method="POST",
33         params={},
34         data=data,
35         decode=True,
36         status=True,
37         header_dict={},
38         opts=__opts__,
39     )
40     if result.get("status", None) == http.client.OK:
41         _result = result["dict"]
42         if _result.get("result"):
43             return _result.get("result")
44         if _result.get("error"):
45             return _result.get("error")
46         return False
47     elif result.get("status", None) == http.client.NO_CONTENT:
48         return False
49     else:
50         ret["message"] = result.text if hasattr(result, "text") else ""
51         return ret
52 def getUsage(api_key=None, api_version=None):
53     ret = {"res": True}
54     if not api_key or not api_version:
55         try:
56             options = __salt__["config.option"]("random_org")
57             if not api_key:
58                 api_key = options.get("api_key")
59             if not api_version:
60                 api_version = options.get("api_version")
61         except (NameError, KeyError, AttributeError):
62             log.error("No Random.org api key found.")
63             ret["message"] = "No Random.org api key or api version found."
64             ret["res"] = False
65             return ret
66     if isinstance(api_version, int):
67         api_version = str(api_version)
68     _function = RANDOM_ORG_FUNCTIONS.get(api_version).get("getUsage").get("method")
69     data = {}
70     data["id"] = 1911220
71     data["jsonrpc"] = "2.0"
72     data["method"] = _function
73     data["params"] = {"apiKey": api_key}
74     if result:
75         ret<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>["bitsLeft"] = result.get("bitsLeft")
76         ret["requestsLeft"] = result.get("requestsLeft")
77         ret["totalBits"] = result.get("totalBits")
78         ret["totalRequests"] = result.get(</b></font>"totalRequests")
79     else:
80         ret["res"] = False
81         ret["message"] = result["message"]
82     return ret
83 def generateIntegers(api_key=None, api_version=None, **kwargs):
84     ret = {"res": True}
85     if not api_key or not api_version:
86         try:
87             options = __salt__["config.option"]("random_org")
88             if not api_key:
89                 api_key = options.get("api_key")
90             if not api_version:
91                 api_version = options.get("api_version")
92         except (NameError, KeyError, AttributeError):
93             log.error("No Random.org api key found.")
94             ret["message"] = "No Random.org api key or api version found."
95             ret["res"] = False
96             return ret
97     for item in ["number", "minimum", "maximum"]:
98         if item not in kwargs:
99             ret["res"] = False
100             ret["message"] = "Rquired argument, {} is missing.".format(item)
101             return ret
102     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 10000:
103         ret["res"] = False
104         ret["message"] = "Number of integers must be between 1 and 10000"
105         return ret
106     if (
107         not _numeric(kwargs["minimum"])
108         or not -1000000000 &lt;= kwargs["minimum"] &lt;= 1000000000
109     ):
110         ret["res"] = False
111         ret[
112             "message"
113         ] = "Minimum argument must be between -1,000,000,000 and 1,000,000,000"
114         return ret
115     if (
116         not _numeric(kwargs["maximum"])
117         or not -1000000000 &lt;= kwargs["maximum"] &lt;= 1000000000
118     ):
119         ret["res"] = False
120         ret[
121             "message"
122         ] = "Maximum argument must be between -1,000,000,000 and 1,000,000,000"
123         return ret
124     if "base" in kwargs:
125         base = kwargs["base"]
126         if base not in [2, 8, 10, 16]:
127             ret["res"] = False
128             ret["message"] = "Base must be either 2, 8, 10 or 16."
129             return ret
130     else:
131         base = 10
132     if "replacement" not in kwargs:
133         replacement = True
134     else:
135         replacement = kwargs["replacement"]
136     if isinstance(api_version, int):
137         api_version = str(api_version)
138     _function = (
139         RANDOM_ORG_FUNCTIONS.get(api_version).get("generateIntegers").get("method")
140     )
141     data = {}
142     data["id"] = 1911220
143     data["jsonrpc"] = "2.0"
144     data["method"] = _function
145     data["params"] = {
146         "apiKey": api_key,
147         "n": kwargs["number"],
148         "min": kwargs["minimum"],
149         "max": kwargs["maximum"],
150         "replacement": replacement,
151         "base": base,
152     }
153     result = _query(api_version=api_version, data=data)
154     log.debug("result %s", result)
155     if result:
156         if "random" in result:
157             random_data = result.get("random").get("data")
158             ret["data"] = random_data
159         else:
160             ret["res"] = False
161             ret["message"] = result["message"]
162     else:
163         ret["res"] = False
164         ret["message"] = result["message"]
165     return ret
166 def generateStrings(api_key=None, api_version=None, **kwargs):
167     ret = {"res": True}
168     if not api_key or not api_version:
169         try:
170             options = __salt__["config.option"]("random_org")
171             if not api_key:
172                 api_key = options.get("api_key")
173             if not api_version:
174                 api_version = options.get("api_version")
175         except (NameError, KeyError, AttributeError):
176             log.error("No Random.org api key found.")
177             ret["message"] = "No Random.org api key or api version found."
178             ret["res"] = False
179             return ret
180     for item in ["number", "length", "characters"]:
181         if item not in kwargs:
182             ret["res"] = False
183             ret["message"] = "Required argument, {} is missing.".format(item)
184             return ret
185     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 10000:
186         ret["res"] = False
187         ret["message"] = "Number of strings must be between 1 and 10000"
188         return ret
189     if not _numeric(kwargs["length"]) or not 1 &lt;= kwargs["length"] &lt;= 20:
190         ret["res"] = False
191         ret["message"] = "Length of strings must be between 1 and 20"
192         return ret
193     if len(kwargs["characters"]) &gt;= 80:
194         ret["res"] = False
195         ret["message"] = "Length of characters must be less than 80."
196         return ret
197     if isinstance(api_version, int):
198         api_version = str(api_version)
199     if "replacement" not in kwargs:
200         replacement = True
201     else:
202         replacement = kwargs["replacement"]
203     _function = (
204         RANDOM_ORG_FUNCTIONS.get(api_version).get("generateStrings").get("method")
205     )
206     data = {}
207     data["id"] = 1911220
208     data["jsonrpc"] = "2.0"
209     data["method"] = _function
210     data["params"] = {
211         "apiKey": api_key,
212         "n": kwargs["number"],
213         "length": kwargs["length"],
214         "characters": kwargs["characters"],
215         "replacement": replacement,
216     }
217     result = _query(api_version=api_version, data=data)
218     if result:
219         if "random" in result:
220             random_data = result.get("random").get("data")
221             ret["data"] = random_data
222         else:
223             ret["res"] = False
224             ret["message"] = result["message"]
225     else:
226         ret["res"] = False
227         ret["message"] = result["message"]
228     return ret
229 def generateUUIDs(api_key=None, api_version=None, **kwargs):
230     ret = {"res": True}
231     if not api_key or not api_version:
232         try:
233             options = __salt__["config.option"]("random_org")
234             if not api_key:
235                 api_key = options.get("api_key")
236             if not api_version:
237                 api_version = options.get("api_version")
238         except (NameError, KeyError, AttributeError):
239             log.error("No Random.org api key found.")
240             ret["message"] = "No Random.org api key or api version found."
241             ret["res"] = False
242             return ret
243     for item in ["number"]:
244         if item not in kwargs:
245             ret["res"] = False
246             ret["message"] = "Required argument, {} is missing.".format(item)
247             return ret
248     if isinstance(api_version, int):
249         api_version = str(api_version)
250     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 1000:
251         ret["res"] = False
252         ret["message"] = "Number of UUIDs must be between 1 and 1000"
253         return ret
254     _function = RANDOM_ORG_FUNCTIONS.get(api_version).get("generateUUIDs").get("method")
255     data = {}
256     data["id"] = 1911220
257     data["jsonrpc"] = "2.0"
258     data["method"] = _function
259     data["params"] = {
260         "apiKey": api_key,
261         "n": kwargs["number"],
262     }
263     result = _query(api_version=api_version, data=data)
264     if result:
265         if "random" in result:
266             random_data = result.get("random").get("data")
267             ret["data"] = random_data
268         else:
269             ret["res"] = False
270             ret["message"] = result["message"]
271     else:
272         ret["res"] = False
273         ret["message"] = result["message"]
274     return ret
275 def generateDecimalFractions(api_key=None, api_version=None, **kwargs):
276     ret = {"res": True}
277     if not api_key or not api_version:
278         try:
279             options = __salt__["config.option"]("random_org")
280             if not api_key:
281                 api_key = options.get("api_key")
282             if not api_version:
283                 api_version = options.get("api_version")
284         except (NameError, KeyError, AttributeError):
285             log.error("No Random.org api key found.")
286             ret["message"] = "No Random.org api key or api version found."
287             ret["res"] = False
288             return ret
289     for item in ["number", "decimalPlaces"]:
290         if item not in kwargs:
291             ret["res"] = False
292             ret["message"] = "Required argument, {} is missing.".format(item)
293             return ret
294     if not isinstance(kwargs["number"], int) or not 1 &lt;= kwargs["number"] &lt;= 10000:
295         ret["res"] = False
296         ret["message"] = "Number of decimal fractions must be between 1 and 10000"
297         return ret
298     if not _numeric(kwargs["decimalPlaces"]) or not 1 &lt;= kwargs["decimalPlaces"] &lt;= 20:
299         ret["res"] = False
300         ret["message"] = "Number of decimal places must be between 1 and 20"
301         return ret
302     if "replacement" not in kwargs:
303         replacement = True
304     else:
305         replacement = kwargs["replacement"]
306     if isinstance(api_version, int):
307         api_version = str(api_version)
308     _function = (
309         RANDOM_ORG_FUNCTIONS.get(api_version)
310         .get("generateDecimalFractions")
311         .get("method")
312     )
313     data = {}
314     data["id"] = 1911220
315     data["jsonrpc"] = "2.0"
316     data["method"] = _function
317     data["params"] = {
318         "apiKey": api_key,
319         "n": kwargs["number"],
320         "decimalPlaces": kwargs["decimalPlaces"],
321         "replacement": replacement,
322     }
323     result = _query(api_version=api_version, data=data)
324     if result:
325         if "random" in result:
326             random_data = result.get("random").get("data")
327             ret["data"] = random_data
328         else:
329             ret["res"] = False
330             ret["message"] = result["message"]
331     else:
332         ret["res"] = False
333         ret["message"] = result["message"]
334     return ret
335 def generateGaussians(api_key=None, api_version=None, **kwargs):
336     ret = {"res": True}
337     if not api_key or not api_version:
338         try:
339             options = __salt__["config.option"]("random_org")
340             if not api_key:
341                 api_key = options.get("api_key")
342             if not api_version:
343                 api_version = options.get("api_version")
344         except (NameError, KeyError, AttributeError):
345             log.error("No Random.org api key found.")
346             ret["message"] = "No Random.org api key or api version found."
347             ret["res"] = False
348             return ret
349     for item in ["number", "mean", "standardDeviation", "significantDigits"]:
350         if item not in kwargs:
351             ret["res"] = False
352             ret["message"] = "Required argument, {} is missing.".format(item)
353             return ret
354     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 10000:
355         ret["res"] = False
356         ret["message"] = "Number of decimal fractions must be between 1 and 10000"
357         return ret
358     if not _numeric(kwargs["mean"]) or not -1000000 &lt;= kwargs["mean"] &lt;= 1000000:
359         ret["res"] = False
360         ret["message"] = "The distribution's mean must be between -1000000 and 1000000"
361         return ret
362     if (
363         not _numeric(kwargs["standardDeviation"])
364         or not -1000000 &lt;= kwargs["standardDeviation"] &lt;= 1000000
365     ):
366         ret["res"] = False
367         ret[
368             "message"
369         ] = "The distribution's standard deviation must be between -1000000 and 1000000"
370         return ret
371     if (
372         not _numeric(kwargs["significantDigits"])
373         or not 2 &lt;= kwargs["significantDigits"] &lt;= 20
374     ):
375         ret["res"] = False
376         ret["message"] = "The number of significant digits must be between 2 and 20"
377         return ret
378     if isinstance(api_version, int):
379         api_version = str(api_version)
380     _function = (
381         RANDOM_ORG_FUNCTIONS.get(api_version).get("generateGaussians").get("method")
382     )
383     data = {}
384     data["id"] = 1911220
385     data["jsonrpc"] = "2.0"
386     data["method"] = _function
387     data["params"] = {
388         "apiKey": api_key,
389         "n": kwargs["number"],
390         "mean": kwargs["mean"],
391         "standardDeviation": kwargs["standardDeviation"],
392         "significantDigits": kwargs["significantDigits"],
393     }
394     result = _query(api_version=api_version, data=data)
395     if result:
396         if "random" in result:
397             random_data = result.get("random").get("data")
398             ret["data"] = random_data
399         else:
400             ret["res"] = False
401             ret["message"] = result["message"]
402     else:
403         ret["res"] = False
404         ret["message"] = result["message"]
405     return ret
406 def generateBlobs(api_key=None, api_version=None, **kwargs):
407     ret = {"res": True}
408     if not api_key or not api_version:
409         try:
410             options = __salt__["config.option"]("random_org")
411             if not api_key:
412                 api_key = options.get("api_key")
413             if not api_version:
414                 api_version = options.get("api_version")
415         except (NameError, KeyError, AttributeError):
416             log.error("No Random.org api key found.")
417             ret["message"] = "No Random.org api key or api version found."
418             ret["res"] = False
419             return ret
420     for item in ["number", "size"]:
421         if item not in kwargs:
422             ret["res"] = False
423             ret["message"] = "Required argument, {} is missing.".format(item)
424             return ret
425     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 100:
426         ret["res"] = False
427         ret["message"] = "Number of blobs must be between 1 and 100"
428         return ret
429     if (
430         not _numeric(kwargs["size"])
431         or not 1 &lt;= kwargs["size"] &lt;= 1048576
432         or kwargs["size"] % 8 != 0
433     ):
434         ret["res"] = False
435         ret["message"] = "Number of blobs must be between 1 and 100"
436         return ret
437     if "format" in kwargs:
438         _format = kwargs["format"]
439         if _format not in ["base64", "hex"]:
440             ret["res"] = False
441             ret["message"] = "Format must be either base64 or hex."
442             return ret
443     else:
444         _format = "base64"
445     if isinstance(api_version, int):
446         api_version = str(api_version)
447     _function = RANDOM_ORG_FUNCTIONS.get(api_version).get("generateBlobs").get("method")
448     data = {}
449     data["id"] = 1911220
450     data["jsonrpc"] = "2.0"
451     data["method"] = _function
452     data["params"] = {
453         "apiKey": api_key,
454         "n": kwargs["number"],
455         "size": kwargs["size"],
456         "format": _format,
457     }
458     result = _query(api_version=api_version, data=data)
459     if result:
460         if "random" in result:
461             random_data = result.get("random").get("data")
462             ret["data"] = random_data
463         else:
464             ret["res"] = False
465             ret["message"] = result["message"]
466     else:
467         ret["res"] = False
468         ret["message"] = result["message"]
469     return ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>auth_test.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, division, print_function
2 from salt.ext.tornado.auth import OpenIdMixin, OAuthMixin, OAuth2Mixin, TwitterMixin, AuthError, GoogleOAuth2Mixin, FacebookGraphMixin
3 from salt.ext.tornado.concurrent import Future
4 from salt.ext.tornado.escape import json_decode
5 from salt.ext.tornado import gen
6 from salt.ext.tornado.httputil import url_concat
7 from salt.ext.tornado.log import gen_log
8 from salt.ext.tornado.testing import AsyncHTTPTestCase, ExpectLog
9 from salt.ext.tornado.web import RequestHandler, Application, asynchronous, HTTPError
10 class OpenIdClientLoginHandler(RequestHandler, OpenIdMixin):
11     def initialize(self, test):
12         self._OPENID_ENDPOINT = test.get_url('/openid/server/authenticate')
13     @asynchronous
14     def get(self):
15         if self.get_argument('openid.mode', None):
16             self.get_authenticated_user(
17                 self.on_user, http_client=self.settings['http_client'])
18             return
19         res = self.authenticate_redirect()
20         assert isinstance(res, Future)
21         assert res.done()
22     def on_user(self, user):
23         if user is None:
24             raise Exception("user is None")
25         self.finish(user)
26 class OpenIdServerAuthenticateHandler(RequestHandler):
27     def post(self):
28         if self.get_argument('openid.mode') != 'check_authentication':
29             raise Exception("incorrect openid.mode %r")
30         self.write('is_valid:true')
31 class OAuth1ClientLoginHandler(RequestHandler, OAuthMixin):
32     def initialize(self, test, version):
33         self._OAUTH_VERSION = version
34         self._OAUTH_REQUEST_TOKEN_URL = test.get_url('/oauth1/server/request_token')
35         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth1/server/authorize')
36         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/oauth1/server/access_token')
37     def _oauth_consumer_token(self):
38         return dict(key='asdf', secret='qwer')
39     @asynchronous
40     def get(self):
41         if self.get_argument('oauth_token', None):
42             self.get_authenticated_user(
43                 self.on_user, http_client=self.settings['http_client'])
44             return
45         res = self.authorize_redirect(http_client=self.settings['http_client'])
46         assert isinstance(res, Future)
47     def on_user(self, user):
48         if user is None:
49             raise Exception("user is None")
50         self.finish(user)
51     def _oauth_get_user(self, access_token, callback):
52         if self.get_argument('fail_in_get_user', None):
53             raise Exception("failing in get_user")
54         if access_token != dict(key='uiop', secret='5678'):
55             raise Exception("incorrect access token %r" % access_token)
56         callback(dict(email='foo@example.com'))
57 class OAuth1ClientLoginCoroutineHandler(OAuth1ClientLoginHandler):
58     @gen.coroutine
59     def get(self):
60         if self.get_argument('oauth_token', None):
61             try:
62                 yield self.get_authenticated_user()
63             except Exception as e:
64                 self.set_status(503)
65                 self.write("got exception: %s" % e)
66         else:
67             yield self.authorize_redirect()
68 class OAuth1ClientRequestParametersHandler(RequestHandler, OAuthMixin):
69     def initialize(self, version):
70         self._OAUTH_VERSION = version
71     def _oauth_consumer_token(self):
72         return dict(key='asdf', secret='qwer')
73     def get(self):
74         params = self._oauth_request_parameters(
75             'http://www.example.com/api/asdf',
76             dict(key='uiop', secret='5678'),
77             parameters=dict(foo='bar'))
78         self.write(params)
79 class OAuth1ServerRequestTokenHandler(RequestHandler):
80     def get(self):
81         self.write('oauth_token=zxcv&amp;oauth_token_secret=1234')
82 class OAuth1ServerAccessTokenHandler(RequestHandler):
83     def get(self):
84         self.write('oauth_token=uiop&amp;oauth_token_secret=5678')
85 class OAuth2ClientLoginHandler(RequestHandler, OAuth2Mixin):
86     def initialize(self, test):
87         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth2/server/authorize')
88     def get(self):
89         res = self.authorize_redirect()
90         assert isinstance(res, Future)
91         assert res.done()
92 class FacebookClientLoginHandler(RequestHandler, FacebookGraphMixin):
93     def initialize(self, test):
94         self._OAUTH_AUTHORIZE_URL = test.get_url('/facebook/server/authorize')
95         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/facebook/server/access_token')
96         self._FACEBOOK_BASE_URL = test.get_url('/facebook/server')
97     @gen.coroutine
98     def get(self):
99         if self.get_argument("code", None):
100             user = yield self.get_authenticated_user(
101                 redirect_uri=self.request.full_url(),
102                 client_id=self.settings["facebook_api_key"],
103                 client_secret=self.settings["facebook_secret"],
104                 code=self.get_argument("code"))
105             self.write(user)
106         else:
107             yield self.authorize_redirect(
108                 redirect_uri=self.request.full_url(),
109                 client_id=self.settings["facebook_api_key"],
110                 extra_params={"scope": "read_stream,offline_access"})
111 class FacebookServerAccessTokenHandler(RequestHandler):
112     def get(self):
113         self.write(dict(access_token="asdf", expires_in=3600))
114 class FacebookServerMeHandler(RequestHandler):
115     def get(self):
116         self.write('{}')
117 class TwitterClientHandler(RequestHandler, TwitterMixin):
118     def initialize(self, test):
119         self<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>._OAUTH_REQUEST_TOKEN_URL = test.get_url('/oauth1/server/request_token')
120         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/twitter/server/access_token')
121         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth1/server/authorize')
122         self._TWITTER_BASE_URL = test.get_url(</b></font>'/twitter/api')
123     def get_auth_http_client(self):
124         return self.settings['http_client']
125 class TwitterClientLoginHandler(TwitterClientHandler):
126     @asynchronous
127     def get(self):
128         if self.get_argument("oauth_token", None):
129             self.get_authenticated_user(self.on_user)
130             return
131         self.authorize_redirect()
132     def on_user(self, user):
133         if user is None:
134             raise Exception("user is None")
135         self.finish(user)
136 class TwitterClientLoginGenEngineHandler(TwitterClientHandler):
137     @asynchronous
138     @gen.engine
139     def get(self):
140         if self.get_argument("oauth_token", None):
141             user = yield self.get_authenticated_user()
142             self.finish(user)
143         else:
144             self.authorize_redirect()
145 class TwitterClientLoginGenCoroutineHandler(TwitterClientHandler):
146     @gen.coroutine
147     def get(self):
148         if self.get_argument("oauth_token", None):
149             user = yield self.get_authenticated_user()
150             self.finish(user)
151         else:
152             yield self.authorize_redirect()
153 class TwitterClientShowUserHandler(TwitterClientHandler):
154     @asynchronous
155     @gen.engine
156     def get(self):
157         response = yield gen.Task(self.twitter_request,
158                                   '/users/show/%s' % self.get_argument('name'),
159                                   access_token=dict(key='hjkl', secret='vbnm'))
160         if response is None:
161             self.set_status(500)
162             self.finish('error from twitter request')
163         else:
164             self.finish(response)
165 class TwitterClientShowUserFutureHandler(TwitterClientHandler):
166     @asynchronous
167     @gen.engine
168     def get(self):
169         try:
170             response = yield self.twitter_request(
171                 '/users/show/%s' % self.get_argument('name'),
172                 access_token=dict(key='hjkl', secret='vbnm'))
173         except AuthError as e:
174             self.set_status(500)
175             self.finish(str(e))
176             return
177         assert response is not None
178         self.finish(response)
179 class TwitterServerAccessTokenHandler(RequestHandler):
180     def get(self):
181         self.write('oauth_token=hjkl&amp;oauth_token_secret=vbnm&amp;screen_name=foo')
182 class TwitterServerShowUserHandler(RequestHandler):
183     def get(self, screen_name):
184         if screen_name == 'error':
185             raise HTTPError(500)
186         assert 'oauth_nonce' in self.request.arguments
187         assert 'oauth_timestamp' in self.request.arguments
188         assert 'oauth_signature' in self.request.arguments
189         assert self.get_argument('oauth_consumer_key') == 'test_twitter_consumer_key'
190         assert self.get_argument('oauth_signature_method') == 'HMAC-SHA1'
191         assert self.get_argument('oauth_version') == '1.0'
192         assert self.get_argument('oauth_token') == 'hjkl'
193         self.write(dict(screen_name=screen_name, name=screen_name.capitalize()))
194 class TwitterServerVerifyCredentialsHandler(RequestHandler):
195     def get(self):
196         assert 'oauth_nonce' in self.request.arguments
197         assert 'oauth_timestamp' in self.request.arguments
198         assert 'oauth_signature' in self.request.arguments
199         assert self.get_argument('oauth_consumer_key') == 'test_twitter_consumer_key'
200         assert self.get_argument('oauth_signature_method') == 'HMAC-SHA1'
201         assert self.get_argument('oauth_version') == '1.0'
202         assert self.get_argument('oauth_token') == 'hjkl'
203         self.write(dict(screen_name='foo', name='Foo'))
204 class AuthTest(AsyncHTTPTestCase):
205     def get_app(self):
206         return Application(
207             [
208                 ('/openid/client/login', OpenIdClientLoginHandler, dict(test=self)),
209                 ('/oauth10/client/login', OAuth1ClientLoginHandler,
210                  dict(test=self, version='1.0')),
211                 ('/oauth10/client/request_params',
212                  OAuth1ClientRequestParametersHandler,
213                  dict(version='1.0')),
214                 ('/oauth10a/client/login', OAuth1ClientLoginHandler,
215                  dict(test=self, version='1.0a')),
216                 ('/oauth10a/client/login_coroutine',
217                  OAuth1ClientLoginCoroutineHandler,
218                  dict(test=self, version='1.0a')),
219                 ('/oauth10a/client/request_params',
220                  OAuth1ClientRequestParametersHandler,
221                  dict(version='1.0a')),
222                 ('/oauth2/client/login', OAuth2ClientLoginHandler, dict(test=self)),
223                 ('/facebook/client/login', FacebookClientLoginHandler, dict(test=self)),
224                 ('/twitter/client/login', TwitterClientLoginHandler, dict(test=self)),
225                 ('/twitter/client/login_gen_engine', TwitterClientLoginGenEngineHandler, dict(test=self)),
226                 ('/twitter/client/login_gen_coroutine', TwitterClientLoginGenCoroutineHandler, dict(test=self)),
227                 ('/twitter/client/show_user', TwitterClientShowUserHandler, dict(test=self)),
228                 ('/twitter/client/show_user_future', TwitterClientShowUserFutureHandler, dict(test=self)),
229                 ('/openid/server/authenticate', OpenIdServerAuthenticateHandler),
230                 ('/oauth1/server/request_token', OAuth1ServerRequestTokenHandler),
231                 ('/oauth1/server/access_token', OAuth1ServerAccessTokenHandler),
232                 ('/facebook/server/access_token', FacebookServerAccessTokenHandler),
233                 ('/facebook/server/me', FacebookServerMeHandler),
234                 ('/twitter/server/access_token', TwitterServerAccessTokenHandler),
235                 (r'/twitter/api/users/show/(.*)\.json', TwitterServerShowUserHandler),
236                 (r'/twitter/api/account/verify_credentials\.json', TwitterServerVerifyCredentialsHandler),
237             ],
238             http_client=self.http_client,
239             twitter_consumer_key='test_twitter_consumer_key',
240             twitter_consumer_secret='test_twitter_consumer_secret',
241             facebook_api_key='test_facebook_api_key',
242             facebook_secret='test_facebook_secret')
243     def test_openid_redirect(self):
244         response = self.fetch('/openid/client/login', follow_redirects=False)
245         self.assertEqual(response.code, 302)
246         self.assertTrue(
247             '/openid/server/authenticate?' in response.headers['Location'])
248     def test_openid_get_user(self):
249         response = self.fetch('/openid/client/login?openid.mode=blah&amp;openid.ns.ax=http://openid.net/srv/ax/1.0&amp;openid.ax.type.email=http://axschema.org/contact/email&amp;openid.ax.value.email=foo@example.com')
250         response.rethrow()
251         parsed = json_decode(response.body)
252         self.assertEqual(parsed["email"], "foo@example.com")
253     def test_oauth10_redirect(self):
254         response = self.fetch('/oauth10/client/login', follow_redirects=False)
255         self.assertEqual(response.code, 302)
256         self.assertTrue(response.headers['Location'].endswith(
257             '/oauth1/server/authorize?oauth_token=zxcv'))
258         self.assertTrue(
259             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
260             response.headers['Set-Cookie'])
261     def test_oauth10_get_user(self):
262         response = self.fetch(
263             '/oauth10/client/login?oauth_token=zxcv',
264             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
265         response.rethrow()
266         parsed = json_decode(response.body)
267         self.assertEqual(parsed['email'], 'foo@example.com')
268         self.assertEqual(parsed['access_token'], dict(key='uiop', secret='5678'))
269     def test_oauth10_request_parameters(self):
270         response = self.fetch('/oauth10/client/request_params')
271         response.rethrow()
272         parsed = json_decode(response.body)
273         self.assertEqual(parsed['oauth_consumer_key'], 'asdf')
274         self.assertEqual(parsed['oauth_token'], 'uiop')
275         self.assertTrue('oauth_nonce' in parsed)
276         self.assertTrue('oauth_signature' in parsed)
277     def test_oauth10a_redirect(self):
278         response = self.fetch('/oauth10a/client/login', follow_redirects=False)
279         self.assertEqual(response.code, 302)
280         self.assertTrue(response.headers['Location'].endswith(
281             '/oauth1/server/authorize?oauth_token=zxcv'))
282         self.assertTrue(
283             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
284             response.headers['Set-Cookie'])
285     def test_oauth10a_get_user(self):
286         response = self.fetch(
287             '/oauth10a/client/login?oauth_token=zxcv',
288             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
289         response.rethrow()
290         parsed = json_decode(response.body)
291         self.assertEqual(parsed['email'], 'foo@example.com')
292         self.assertEqual(parsed['access_token'], dict(key='uiop', secret='5678'))
293     def test_oauth10a_request_parameters(self):
294         response = self.fetch('/oauth10a/client/request_params')
295         response.rethrow()
296         parsed = json_decode(response.body)
297         self.assertEqual(parsed['oauth_consumer_key'], 'asdf')
298         self.assertEqual(parsed['oauth_token'], 'uiop')
299         self.assertTrue('oauth_nonce' in parsed)
300         self.assertTrue('oauth_signature' in parsed)
301     def test_oauth10a_get_user_coroutine_exception(self):
302         response = self.fetch(
303             '/oauth10a/client/login_coroutine?oauth_token=zxcv&amp;fail_in_get_user=true',
304             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
305         self.assertEqual(response.code, 503)
306     def test_oauth2_redirect(self):
307         response = self.fetch('/oauth2/client/login', follow_redirects=False)
308         self.assertEqual(response.code, 302)
309         self.assertTrue('/oauth2/server/authorize?' in response.headers['Location'])
310     def test_facebook_login(self):
311         response = self.fetch('/facebook/client/login', follow_redirects=False)
312         self.assertEqual(response.code, 302)
313         self.assertTrue('/facebook/server/authorize?' in response.headers['Location'])
314         response = self.fetch('/facebook/client/login?code=1234', follow_redirects=False)
315         self.assertEqual(response.code, 200)
316         user = json_decode(response.body)
317         self.assertEqual(user['access_token'], 'asdf')
318         self.assertEqual(user['session_expires'], '3600')
319     def base_twitter_redirect(self, url):
320         response = self.fetch(url, follow_redirects=False)
321         self.assertEqual(response.code, 302)
322         self.assertTrue(response.headers['Location'].endswith(
323             '/oauth1/server/authorize?oauth_token=zxcv'))
324         self.assertTrue(
325             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
326             response.headers['Set-Cookie'])
327     def test_twitter_redirect(self):
328         self.base_twitter_redirect('/twitter/client/login')
329     def test_twitter_redirect_gen_engine(self):
330         self.base_twitter_redirect('/twitter/client/login_gen_engine')
331     def test_twitter_redirect_gen_coroutine(self):
332         self.base_twitter_redirect('/twitter/client/login_gen_coroutine')
333     def test_twitter_get_user(self):
334         response = self.fetch(
335             '/twitter/client/login?oauth_token=zxcv',
336             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
337         response.rethrow()
338         parsed = json_decode(response.body)
339         self.assertEqual(parsed,
340                          {u'access_token': {u'key': u'hjkl',
341                                             u'screen_name': u'foo',
342                                             u'secret': u'vbnm'},
343                           u'name': u'Foo',
344                           u'screen_name': u'foo',
345                           u'username': u'foo'})
346     def test_twitter_show_user(self):
347         response = self.fetch('/twitter/client/show_user?name=somebody')
348         response.rethrow()
349         self.assertEqual(json_decode(response.body),
350                          {'name': 'Somebody', 'screen_name': 'somebody'})
351     def test_twitter_show_user_error(self):
352         with ExpectLog(gen_log, 'Error response HTTP 500'):
353             response = self.fetch('/twitter/client/show_user?name=error')
354         self.assertEqual(response.code, 500)
355         self.assertEqual(response.body, b'error from twitter request')
356     def test_twitter_show_user_future(self):
357         response = self.fetch('/twitter/client/show_user_future?name=somebody')
358         response.rethrow()
359         self.assertEqual(json_decode(response.body),
360                          {'name': 'Somebody', 'screen_name': 'somebody'})
361     def test_twitter_show_user_future_error(self):
362         response = self.fetch('/twitter/client/show_user_future?name=error')
363         self.assertEqual(response.code, 500)
364         self.assertIn(b'Error response HTTP 500', response.body)
365 class GoogleLoginHandler(RequestHandler, GoogleOAuth2Mixin):
366     def initialize(self, test):
367         self.test = test
368         self._OAUTH_REDIRECT_URI = test.get_url('/client/login')
369         self._OAUTH_AUTHORIZE_URL = test.get_url('/google/oauth2/authorize')
370         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/google/oauth2/token')
371     @gen.coroutine
372     def get(self):
373         code = self.get_argument('code', None)
374         if code is not None:
375             access = yield self.get_authenticated_user(self._OAUTH_REDIRECT_URI,
376                                                        code)
377             user = yield self.oauth2_request(
378                 self.test.get_url("/google/oauth2/userinfo"),
379                 access_token=access["access_token"])
380             user["access_token"] = access["access_token"]
381             self.write(user)
382         else:
383             yield self.authorize_redirect(
384                 redirect_uri=self._OAUTH_REDIRECT_URI,
385                 client_id=self.settings['google_oauth']['key'],
386                 client_secret=self.settings['google_oauth']['secret'],
387                 scope=['profile', 'email'],
388                 response_type='code',
389                 extra_params={'prompt': 'select_account'})
390 class GoogleOAuth2AuthorizeHandler(RequestHandler):
391     def get(self):
392         code = 'fake-authorization-code'
393         self.redirect(url_concat(self.get_argument('redirect_uri'),
394                                  dict(code=code)))
395 class GoogleOAuth2TokenHandler(RequestHandler):
396     def post(self):
397         assert self.get_argument('code') == 'fake-authorization-code'
398         self.finish({
399             'access_token': 'fake-access-token',
400             'expires_in': 'never-expires'
401         })
402 class GoogleOAuth2UserinfoHandler(RequestHandler):
403     def get(self):
404         assert self.get_argument('access_token') == 'fake-access-token'
405         self.finish({
406             'name': 'Foo',
407             'email': 'foo@example.com'
408         })
409 class GoogleOAuth2Test(AsyncHTTPTestCase):
410     def get_app(self):
411         return Application(
412             [
413                 ('/client/login', GoogleLoginHandler, dict(test=self)),
414                 ('/google/oauth2/authorize', GoogleOAuth2AuthorizeHandler),
415                 ('/google/oauth2/token', GoogleOAuth2TokenHandler),
416                 ('/google/oauth2/userinfo', GoogleOAuth2UserinfoHandler),
417             ],
418             google_oauth={
419                 "key": 'fake_google_client_id',
420                 "secret": 'fake_google_client_secret'
421             })
422     def test_google_login(self):
423         response = self.fetch('/client/login')
424         self.assertDictEqual({
425             u'name': u'Foo',
426             u'email': u'foo@example.com',
427             u'access_token': u'fake-access-token',
428         }, json_decode(response.body))
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
