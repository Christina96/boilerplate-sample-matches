<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for random_org.py &amp; auth_test.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for random_org.py &amp; auth_test.py
      </h3>
<h1 align="center">
        1.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>random_org.py (1.7148982%)<th>auth_test.py (1.6309888%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(146-149)<td><a href="#" name="0">(163-166)</a><td align="center"><font color="#ff0000">16</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>random_org.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import http.client
2 import logging
3 import urllib.request
4 import salt.utils.http
5 import salt.utils.json
6 log = logging.getLogger(__name__)
7 __virtualname__ = "random_org"
8 RANDOM_ORG_FUNCTIONS = {
9     "1": {
10         "getUsage": {"method": "getUsage"},
11         "generateIntegers": {"method": "generateIntegers"},
12         "generateStrings": {"method": "generateStrings"},
13         "generateUUIDs": {"method": "generateUUIDs"},
14         "generateDecimalFractions": {"method": "generateDecimalFractions"},
15         "generateGaussians": {"method": "generateGaussians"},
16         "generateBlobs": {"method": "generateBlobs"},
17     }
18 }
19 def __virtual__():
20     return __virtualname__
21 def _numeric(n):
22     return isinstance(n, (int, float))
23 def _query(api_version=None, data=None):
24     if data is None:
25         data = {}
26     ret = {"res": True}
27     api_url = "https://api.random.org/"
28     base_url = urllib.parse.urljoin(api_url, "json-rpc/" + str(api_version) + "/invoke")
29     data = salt.utils.json.dumps(data)
30     result = salt.utils.http.query(
31         base_url,
32         method="POST",
33         params={},
34         data=data,
35         decode=True,
36         status=True,
37         header_dict={},
38         opts=__opts__,
39     )
40     if result.get("status", None) == http.client.OK:
41         _result = result["dict"]
42         if _result.get("result"):
43             return _result.get("result")
44         if _result.get("error"):
45             return _result.get("error")
46         return False
47     elif result.get("status", None) == http.client.NO_CONTENT:
48         return False
49     else:
50         ret["message"] = result.text if hasattr(result, "text") else ""
51         return ret
52 def getUsage(api_key=None, api_version=None):
53     ret = {"res": True}
54     if not api_key or not api_version:
55         try:
56             options = __salt__["config.option"]("random_org")
57             if not api_key:
58                 api_key = options.get("api_key")
59             if not api_version:
60                 api_version = options.get("api_version")
61         except (NameError, KeyError, AttributeError):
62             log.error("No Random.org api key found.")
63             ret["message"] = "No Random.org api key or api version found."
64             ret["res"] = False
65             return ret
66     if isinstance(api_version, int):
67         api_version = str(api_version)
68     _function = RANDOM_ORG_FUNCTIONS.get(api_version).get("getUsage").get("method")
69     data = {}
70     data["id"] = 1911220
71     data["jsonrpc"] = "2.0"
72     data["method"] = _function
73     data["params"] = {"apiKey": api_key}
74 <a name="0"></a>    result = _query(api_version=api_version, data=data)
75     if result:
76         ret<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>["bitsLeft"] = result.get("bitsLeft")
77         ret["requestsLeft"] = result.get("requestsLeft")
78         ret["totalBits"] = result.get("totalBits")
79         ret["totalRequests"] = result.get(</b></font>"totalRequests")
80     else:
81         ret["res"] = False
82         ret["message"] = result["message"]
83     return ret
84 def generateIntegers(api_key=None, api_version=None, **kwargs):
85     ret = {"res": True}
86     if not api_key or not api_version:
87         try:
88             options = __salt__["config.option"]("random_org")
89             if not api_key:
90                 api_key = options.get("api_key")
91             if not api_version:
92                 api_version = options.get("api_version")
93         except (NameError, KeyError, AttributeError):
94             log.error("No Random.org api key found.")
95             ret["message"] = "No Random.org api key or api version found."
96             ret["res"] = False
97             return ret
98     for item in ["number", "minimum", "maximum"]:
99         if item not in kwargs:
100             ret["res"] = False
101             ret["message"] = "Rquired argument, {} is missing.".format(item)
102             return ret
103     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 10000:
104         ret["res"] = False
105         ret["message"] = "Number of integers must be between 1 and 10000"
106         return ret
107     if (
108         not _numeric(kwargs["minimum"])
109         or not -1000000000 &lt;= kwargs["minimum"] &lt;= 1000000000
110     ):
111         ret["res"] = False
112         ret[
113             "message"
114         ] = "Minimum argument must be between -1,000,000,000 and 1,000,000,000"
115         return ret
116     if (
117         not _numeric(kwargs["maximum"])
118         or not -1000000000 &lt;= kwargs["maximum"] &lt;= 1000000000
119     ):
120         ret["res"] = False
121         ret[
122             "message"
123         ] = "Maximum argument must be between -1,000,000,000 and 1,000,000,000"
124         return ret
125     if "base" in kwargs:
126         base = kwargs["base"]
127         if base not in [2, 8, 10, 16]:
128             ret["res"] = False
129             ret["message"] = "Base must be either 2, 8, 10 or 16."
130             return ret
131     else:
132         base = 10
133     if "replacement" not in kwargs:
134         replacement = True
135     else:
136         replacement = kwargs["replacement"]
137     if isinstance(api_version, int):
138         api_version = str(api_version)
139     _function = (
140         RANDOM_ORG_FUNCTIONS.get(api_version).get("generateIntegers").get("method")
141     )
142     data = {}
143     data["id"] = 1911220
144     data["jsonrpc"] = "2.0"
145     data["method"] = _function
146     data["params"] = {
147         "apiKey": api_key,
148         "n": kwargs["number"],
149         "min": kwargs["minimum"],
150         "max": kwargs["maximum"],
151         "replacement": replacement,
152         "base": base,
153     }
154     result = _query(api_version=api_version, data=data)
155     log.debug("result %s", result)
156     if result:
157         if "random" in result:
158             random_data = result.get("random").get("data")
159             ret["data"] = random_data
160         else:
161             ret["res"] = False
162             ret["message"] = result["message"]
163     else:
164         ret["res"] = False
165         ret["message"] = result["message"]
166     return ret
167 def generateStrings(api_key=None, api_version=None, **kwargs):
168     ret = {"res": True}
169     if not api_key or not api_version:
170         try:
171             options = __salt__["config.option"]("random_org")
172             if not api_key:
173                 api_key = options.get("api_key")
174             if not api_version:
175                 api_version = options.get("api_version")
176         except (NameError, KeyError, AttributeError):
177             log.error("No Random.org api key found.")
178             ret["message"] = "No Random.org api key or api version found."
179             ret["res"] = False
180             return ret
181     for item in ["number", "length", "characters"]:
182         if item not in kwargs:
183             ret["res"] = False
184             ret["message"] = "Required argument, {} is missing.".format(item)
185             return ret
186     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 10000:
187         ret["res"] = False
188         ret["message"] = "Number of strings must be between 1 and 10000"
189         return ret
190     if not _numeric(kwargs["length"]) or not 1 &lt;= kwargs["length"] &lt;= 20:
191         ret["res"] = False
192         ret["message"] = "Length of strings must be between 1 and 20"
193         return ret
194     if len(kwargs["characters"]) &gt;= 80:
195         ret["res"] = False
196         ret["message"] = "Length of characters must be less than 80."
197         return ret
198     if isinstance(api_version, int):
199         api_version = str(api_version)
200     if "replacement" not in kwargs:
201         replacement = True
202     else:
203         replacement = kwargs["replacement"]
204     _function = (
205         RANDOM_ORG_FUNCTIONS.get(api_version).get("generateStrings").get("method")
206     )
207     data = {}
208     data["id"] = 1911220
209     data["jsonrpc"] = "2.0"
210     data["method"] = _function
211     data["params"] = {
212         "apiKey": api_key,
213         "n": kwargs["number"],
214         "length": kwargs["length"],
215         "characters": kwargs["characters"],
216         "replacement": replacement,
217     }
218     result = _query(api_version=api_version, data=data)
219     if result:
220         if "random" in result:
221             random_data = result.get("random").get("data")
222             ret["data"] = random_data
223         else:
224             ret["res"] = False
225             ret["message"] = result["message"]
226     else:
227         ret["res"] = False
228         ret["message"] = result["message"]
229     return ret
230 def generateUUIDs(api_key=None, api_version=None, **kwargs):
231     ret = {"res": True}
232     if not api_key or not api_version:
233         try:
234             options = __salt__["config.option"]("random_org")
235             if not api_key:
236                 api_key = options.get("api_key")
237             if not api_version:
238                 api_version = options.get("api_version")
239         except (NameError, KeyError, AttributeError):
240             log.error("No Random.org api key found.")
241             ret["message"] = "No Random.org api key or api version found."
242             ret["res"] = False
243             return ret
244     for item in ["number"]:
245         if item not in kwargs:
246             ret["res"] = False
247             ret["message"] = "Required argument, {} is missing.".format(item)
248             return ret
249     if isinstance(api_version, int):
250         api_version = str(api_version)
251     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 1000:
252         ret["res"] = False
253         ret["message"] = "Number of UUIDs must be between 1 and 1000"
254         return ret
255     _function = RANDOM_ORG_FUNCTIONS.get(api_version).get("generateUUIDs").get("method")
256     data = {}
257     data["id"] = 1911220
258     data["jsonrpc"] = "2.0"
259     data["method"] = _function
260     data["params"] = {
261         "apiKey": api_key,
262         "n": kwargs["number"],
263     }
264     result = _query(api_version=api_version, data=data)
265     if result:
266         if "random" in result:
267             random_data = result.get("random").get("data")
268             ret["data"] = random_data
269         else:
270             ret["res"] = False
271             ret["message"] = result["message"]
272     else:
273         ret["res"] = False
274         ret["message"] = result["message"]
275     return ret
276 def generateDecimalFractions(api_key=None, api_version=None, **kwargs):
277     ret = {"res": True}
278     if not api_key or not api_version:
279         try:
280             options = __salt__["config.option"]("random_org")
281             if not api_key:
282                 api_key = options.get("api_key")
283             if not api_version:
284                 api_version = options.get("api_version")
285         except (NameError, KeyError, AttributeError):
286             log.error("No Random.org api key found.")
287             ret["message"] = "No Random.org api key or api version found."
288             ret["res"] = False
289             return ret
290     for item in ["number", "decimalPlaces"]:
291         if item not in kwargs:
292             ret["res"] = False
293             ret["message"] = "Required argument, {} is missing.".format(item)
294             return ret
295     if not isinstance(kwargs["number"], int) or not 1 &lt;= kwargs["number"] &lt;= 10000:
296         ret["res"] = False
297         ret["message"] = "Number of decimal fractions must be between 1 and 10000"
298         return ret
299     if not _numeric(kwargs["decimalPlaces"]) or not 1 &lt;= kwargs["decimalPlaces"] &lt;= 20:
300         ret["res"] = False
301         ret["message"] = "Number of decimal places must be between 1 and 20"
302         return ret
303     if "replacement" not in kwargs:
304         replacement = True
305     else:
306         replacement = kwargs["replacement"]
307     if isinstance(api_version, int):
308         api_version = str(api_version)
309     _function = (
310         RANDOM_ORG_FUNCTIONS.get(api_version)
311         .get("generateDecimalFractions")
312         .get("method")
313     )
314     data = {}
315     data["id"] = 1911220
316     data["jsonrpc"] = "2.0"
317     data["method"] = _function
318     data["params"] = {
319         "apiKey": api_key,
320         "n": kwargs["number"],
321         "decimalPlaces": kwargs["decimalPlaces"],
322         "replacement": replacement,
323     }
324     result = _query(api_version=api_version, data=data)
325     if result:
326         if "random" in result:
327             random_data = result.get("random").get("data")
328             ret["data"] = random_data
329         else:
330             ret["res"] = False
331             ret["message"] = result["message"]
332     else:
333         ret["res"] = False
334         ret["message"] = result["message"]
335     return ret
336 def generateGaussians(api_key=None, api_version=None, **kwargs):
337     ret = {"res": True}
338     if not api_key or not api_version:
339         try:
340             options = __salt__["config.option"]("random_org")
341             if not api_key:
342                 api_key = options.get("api_key")
343             if not api_version:
344                 api_version = options.get("api_version")
345         except (NameError, KeyError, AttributeError):
346             log.error("No Random.org api key found.")
347             ret["message"] = "No Random.org api key or api version found."
348             ret["res"] = False
349             return ret
350     for item in ["number", "mean", "standardDeviation", "significantDigits"]:
351         if item not in kwargs:
352             ret["res"] = False
353             ret["message"] = "Required argument, {} is missing.".format(item)
354             return ret
355     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 10000:
356         ret["res"] = False
357         ret["message"] = "Number of decimal fractions must be between 1 and 10000"
358         return ret
359     if not _numeric(kwargs["mean"]) or not -1000000 &lt;= kwargs["mean"] &lt;= 1000000:
360         ret["res"] = False
361         ret["message"] = "The distribution's mean must be between -1000000 and 1000000"
362         return ret
363     if (
364         not _numeric(kwargs["standardDeviation"])
365         or not -1000000 &lt;= kwargs["standardDeviation"] &lt;= 1000000
366     ):
367         ret["res"] = False
368         ret[
369             "message"
370         ] = "The distribution's standard deviation must be between -1000000 and 1000000"
371         return ret
372     if (
373         not _numeric(kwargs["significantDigits"])
374         or not 2 &lt;= kwargs["significantDigits"] &lt;= 20
375     ):
376         ret["res"] = False
377         ret["message"] = "The number of significant digits must be between 2 and 20"
378         return ret
379     if isinstance(api_version, int):
380         api_version = str(api_version)
381     _function = (
382         RANDOM_ORG_FUNCTIONS.get(api_version).get("generateGaussians").get("method")
383     )
384     data = {}
385     data["id"] = 1911220
386     data["jsonrpc"] = "2.0"
387     data["method"] = _function
388     data["params"] = {
389         "apiKey": api_key,
390         "n": kwargs["number"],
391         "mean": kwargs["mean"],
392         "standardDeviation": kwargs["standardDeviation"],
393         "significantDigits": kwargs["significantDigits"],
394     }
395     result = _query(api_version=api_version, data=data)
396     if result:
397         if "random" in result:
398             random_data = result.get("random").get("data")
399             ret["data"] = random_data
400         else:
401             ret["res"] = False
402             ret["message"] = result["message"]
403     else:
404         ret["res"] = False
405         ret["message"] = result["message"]
406     return ret
407 def generateBlobs(api_key=None, api_version=None, **kwargs):
408     ret = {"res": True}
409     if not api_key or not api_version:
410         try:
411             options = __salt__["config.option"]("random_org")
412             if not api_key:
413                 api_key = options.get("api_key")
414             if not api_version:
415                 api_version = options.get("api_version")
416         except (NameError, KeyError, AttributeError):
417             log.error("No Random.org api key found.")
418             ret["message"] = "No Random.org api key or api version found."
419             ret["res"] = False
420             return ret
421     for item in ["number", "size"]:
422         if item not in kwargs:
423             ret["res"] = False
424             ret["message"] = "Required argument, {} is missing.".format(item)
425             return ret
426     if not _numeric(kwargs["number"]) or not 1 &lt;= kwargs["number"] &lt;= 100:
427         ret["res"] = False
428         ret["message"] = "Number of blobs must be between 1 and 100"
429         return ret
430     if (
431         not _numeric(kwargs["size"])
432         or not 1 &lt;= kwargs["size"] &lt;= 1048576
433         or kwargs["size"] % 8 != 0
434     ):
435         ret["res"] = False
436         ret["message"] = "Number of blobs must be between 1 and 100"
437         return ret
438     if "format" in kwargs:
439         _format = kwargs["format"]
440         if _format not in ["base64", "hex"]:
441             ret["res"] = False
442             ret["message"] = "Format must be either base64 or hex."
443             return ret
444     else:
445         _format = "base64"
446     if isinstance(api_version, int):
447         api_version = str(api_version)
448     _function = RANDOM_ORG_FUNCTIONS.get(api_version).get("generateBlobs").get("method")
449     data = {}
450     data["id"] = 1911220
451     data["jsonrpc"] = "2.0"
452     data["method"] = _function
453     data["params"] = {
454         "apiKey": api_key,
455         "n": kwargs["number"],
456         "size": kwargs["size"],
457         "format": _format,
458     }
459     result = _query(api_version=api_version, data=data)
460     if result:
461         if "random" in result:
462             random_data = result.get("random").get("data")
463             ret["data"] = random_data
464         else:
465             ret["res"] = False
466             ret["message"] = result["message"]
467     else:
468         ret["res"] = False
469         ret["message"] = result["message"]
470     return ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>auth_test.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, division, print_function
2 from salt.ext.tornado.auth import OpenIdMixin, OAuthMixin, OAuth2Mixin, TwitterMixin, AuthError, GoogleOAuth2Mixin, FacebookGraphMixin
3 from salt.ext.tornado.concurrent import Future
4 from salt.ext.tornado.escape import json_decode
5 from salt.ext.tornado import gen
6 from salt.ext.tornado.httputil import url_concat
7 from salt.ext.tornado.log import gen_log
8 from salt.ext.tornado.testing import AsyncHTTPTestCase, ExpectLog
9 from salt.ext.tornado.web import RequestHandler, Application, asynchronous, HTTPError
10 class OpenIdClientLoginHandler(RequestHandler, OpenIdMixin):
11     def initialize(self, test):
12         self._OPENID_ENDPOINT = test.get_url('/openid/server/authenticate')
13     @asynchronous
14     def get(self):
15         if self.get_argument('openid.mode', None):
16             self.get_authenticated_user(
17                 self.on_user, http_client=self.settings['http_client'])
18             return
19         res = self.authenticate_redirect()
20         assert isinstance(res, Future)
21         assert res.done()
22     def on_user(self, user):
23         if user is None:
24             raise Exception("user is None")
25         self.finish(user)
26 class OpenIdServerAuthenticateHandler(RequestHandler):
27     def post(self):
28         if self.get_argument('openid.mode') != 'check_authentication':
29             raise Exception("incorrect openid.mode %r")
30         self.write('is_valid:true')
31 class OAuth1ClientLoginHandler(RequestHandler, OAuthMixin):
32     def initialize(self, test, version):
33         self._OAUTH_VERSION = version
34         self._OAUTH_REQUEST_TOKEN_URL = test.get_url('/oauth1/server/request_token')
35         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth1/server/authorize')
36         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/oauth1/server/access_token')
37     def _oauth_consumer_token(self):
38         return dict(key='asdf', secret='qwer')
39     @asynchronous
40     def get(self):
41         if self.get_argument('oauth_token', None):
42             self.get_authenticated_user(
43                 self.on_user, http_client=self.settings['http_client'])
44             return
45         res = self.authorize_redirect(http_client=self.settings['http_client'])
46         assert isinstance(res, Future)
47     def on_user(self, user):
48         if user is None:
49             raise Exception("user is None")
50         self.finish(user)
51     def _oauth_get_user(self, access_token, callback):
52         if self.get_argument('fail_in_get_user', None):
53             raise Exception("failing in get_user")
54         if access_token != dict(key='uiop', secret='5678'):
55             raise Exception("incorrect access token %r" % access_token)
56         callback(dict(email='foo@example.com'))
57 class OAuth1ClientLoginCoroutineHandler(OAuth1ClientLoginHandler):
58     @gen.coroutine
59     def get(self):
60         if self.get_argument('oauth_token', None):
61             try:
62                 yield self.get_authenticated_user()
63             except Exception as e:
64                 self.set_status(503)
65                 self.write("got exception: %s" % e)
66         else:
67             yield self.authorize_redirect()
68 class OAuth1ClientRequestParametersHandler(RequestHandler, OAuthMixin):
69     def initialize(self, version):
70         self._OAUTH_VERSION = version
71     def _oauth_consumer_token(self):
72         return dict(key='asdf', secret='qwer')
73     def get(self):
74         params = self._oauth_request_parameters(
75             'http://www.example.com/api/asdf',
76             dict(key='uiop', secret='5678'),
77             parameters=dict(foo='bar'))
78         self.write(params)
79 class OAuth1ServerRequestTokenHandler(RequestHandler):
80     def get(self):
81         self.write('oauth_token=zxcv&amp;oauth_token_secret=1234')
82 class OAuth1ServerAccessTokenHandler(RequestHandler):
83     def get(self):
84         self.write('oauth_token=uiop&amp;oauth_token_secret=5678')
85 class OAuth2ClientLoginHandler(RequestHandler, OAuth2Mixin):
86     def initialize(self, test):
87         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth2/server/authorize')
88     def get(self):
89         res = self.authorize_redirect()
90         assert isinstance(res, Future)
91         assert res.done()
92 class FacebookClientLoginHandler(RequestHandler, FacebookGraphMixin):
93     def initialize(self, test):
94         self._OAUTH_AUTHORIZE_URL = test.get_url('/facebook/server/authorize')
95         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/facebook/server/access_token')
96         self._FACEBOOK_BASE_URL = test.get_url('/facebook/server')
97     @gen.coroutine
98     def get(self):
99         if self.get_argument("code", None):
100             user = yield self.get_authenticated_user(
101                 redirect_uri=self.request.full_url(),
102                 client_id=self.settings["facebook_api_key"],
103                 client_secret=self.settings["facebook_secret"],
104                 code=self.get_argument("code"))
105             self.write(user)
106         else:
107             yield self.authorize_redirect(
108                 redirect_uri=self.request.full_url(),
109                 client_id=self.settings["facebook_api_key"],
110                 extra_params={"scope": "read_stream,offline_access"})
111 class FacebookServerAccessTokenHandler(RequestHandler):
112     def get(self):
113         self.write(dict(access_token="asdf", expires_in=3600))
114 class FacebookServerMeHandler(RequestHandler):
115     def get(self):
116         self.write('{}')
117 <a name="0"></a>
118 class TwitterClientHandler(RequestHandler, TwitterMixin):
119     def initialize(self, test):
120         self<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>._OAUTH_REQUEST_TOKEN_URL = test.get_url('/oauth1/server/request_token')
121         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/twitter/server/access_token')
122         self._OAUTH_AUTHORIZE_URL = test.get_url('/oauth1/server/authorize')
123         self._TWITTER_BASE_URL = test.get_url(</b></font>'/twitter/api')
124     def get_auth_http_client(self):
125         return self.settings['http_client']
126 class TwitterClientLoginHandler(TwitterClientHandler):
127     @asynchronous
128     def get(self):
129         if self.get_argument("oauth_token", None):
130             self.get_authenticated_user(self.on_user)
131             return
132         self.authorize_redirect()
133     def on_user(self, user):
134         if user is None:
135             raise Exception("user is None")
136         self.finish(user)
137 class TwitterClientLoginGenEngineHandler(TwitterClientHandler):
138     @asynchronous
139     @gen.engine
140     def get(self):
141         if self.get_argument("oauth_token", None):
142             user = yield self.get_authenticated_user()
143             self.finish(user)
144         else:
145             self.authorize_redirect()
146 class TwitterClientLoginGenCoroutineHandler(TwitterClientHandler):
147     @gen.coroutine
148     def get(self):
149         if self.get_argument("oauth_token", None):
150             user = yield self.get_authenticated_user()
151             self.finish(user)
152         else:
153             yield self.authorize_redirect()
154 class TwitterClientShowUserHandler(TwitterClientHandler):
155     @asynchronous
156     @gen.engine
157     def get(self):
158         response = yield gen.Task(self.twitter_request,
159                                   '/users/show/%s' % self.get_argument('name'),
160                                   access_token=dict(key='hjkl', secret='vbnm'))
161         if response is None:
162             self.set_status(500)
163             self.finish('error from twitter request')
164         else:
165             self.finish(response)
166 class TwitterClientShowUserFutureHandler(TwitterClientHandler):
167     @asynchronous
168     @gen.engine
169     def get(self):
170         try:
171             response = yield self.twitter_request(
172                 '/users/show/%s' % self.get_argument('name'),
173                 access_token=dict(key='hjkl', secret='vbnm'))
174         except AuthError as e:
175             self.set_status(500)
176             self.finish(str(e))
177             return
178         assert response is not None
179         self.finish(response)
180 class TwitterServerAccessTokenHandler(RequestHandler):
181     def get(self):
182         self.write('oauth_token=hjkl&amp;oauth_token_secret=vbnm&amp;screen_name=foo')
183 class TwitterServerShowUserHandler(RequestHandler):
184     def get(self, screen_name):
185         if screen_name == 'error':
186             raise HTTPError(500)
187         assert 'oauth_nonce' in self.request.arguments
188         assert 'oauth_timestamp' in self.request.arguments
189         assert 'oauth_signature' in self.request.arguments
190         assert self.get_argument('oauth_consumer_key') == 'test_twitter_consumer_key'
191         assert self.get_argument('oauth_signature_method') == 'HMAC-SHA1'
192         assert self.get_argument('oauth_version') == '1.0'
193         assert self.get_argument('oauth_token') == 'hjkl'
194         self.write(dict(screen_name=screen_name, name=screen_name.capitalize()))
195 class TwitterServerVerifyCredentialsHandler(RequestHandler):
196     def get(self):
197         assert 'oauth_nonce' in self.request.arguments
198         assert 'oauth_timestamp' in self.request.arguments
199         assert 'oauth_signature' in self.request.arguments
200         assert self.get_argument('oauth_consumer_key') == 'test_twitter_consumer_key'
201         assert self.get_argument('oauth_signature_method') == 'HMAC-SHA1'
202         assert self.get_argument('oauth_version') == '1.0'
203         assert self.get_argument('oauth_token') == 'hjkl'
204         self.write(dict(screen_name='foo', name='Foo'))
205 class AuthTest(AsyncHTTPTestCase):
206     def get_app(self):
207         return Application(
208             [
209                 ('/openid/client/login', OpenIdClientLoginHandler, dict(test=self)),
210                 ('/oauth10/client/login', OAuth1ClientLoginHandler,
211                  dict(test=self, version='1.0')),
212                 ('/oauth10/client/request_params',
213                  OAuth1ClientRequestParametersHandler,
214                  dict(version='1.0')),
215                 ('/oauth10a/client/login', OAuth1ClientLoginHandler,
216                  dict(test=self, version='1.0a')),
217                 ('/oauth10a/client/login_coroutine',
218                  OAuth1ClientLoginCoroutineHandler,
219                  dict(test=self, version='1.0a')),
220                 ('/oauth10a/client/request_params',
221                  OAuth1ClientRequestParametersHandler,
222                  dict(version='1.0a')),
223                 ('/oauth2/client/login', OAuth2ClientLoginHandler, dict(test=self)),
224                 ('/facebook/client/login', FacebookClientLoginHandler, dict(test=self)),
225                 ('/twitter/client/login', TwitterClientLoginHandler, dict(test=self)),
226                 ('/twitter/client/login_gen_engine', TwitterClientLoginGenEngineHandler, dict(test=self)),
227                 ('/twitter/client/login_gen_coroutine', TwitterClientLoginGenCoroutineHandler, dict(test=self)),
228                 ('/twitter/client/show_user', TwitterClientShowUserHandler, dict(test=self)),
229                 ('/twitter/client/show_user_future', TwitterClientShowUserFutureHandler, dict(test=self)),
230                 ('/openid/server/authenticate', OpenIdServerAuthenticateHandler),
231                 ('/oauth1/server/request_token', OAuth1ServerRequestTokenHandler),
232                 ('/oauth1/server/access_token', OAuth1ServerAccessTokenHandler),
233                 ('/facebook/server/access_token', FacebookServerAccessTokenHandler),
234                 ('/facebook/server/me', FacebookServerMeHandler),
235                 ('/twitter/server/access_token', TwitterServerAccessTokenHandler),
236                 (r'/twitter/api/users/show/(.*)\.json', TwitterServerShowUserHandler),
237                 (r'/twitter/api/account/verify_credentials\.json', TwitterServerVerifyCredentialsHandler),
238             ],
239             http_client=self.http_client,
240             twitter_consumer_key='test_twitter_consumer_key',
241             twitter_consumer_secret='test_twitter_consumer_secret',
242             facebook_api_key='test_facebook_api_key',
243             facebook_secret='test_facebook_secret')
244     def test_openid_redirect(self):
245         response = self.fetch('/openid/client/login', follow_redirects=False)
246         self.assertEqual(response.code, 302)
247         self.assertTrue(
248             '/openid/server/authenticate?' in response.headers['Location'])
249     def test_openid_get_user(self):
250         response = self.fetch('/openid/client/login?openid.mode=blah&amp;openid.ns.ax=http://openid.net/srv/ax/1.0&amp;openid.ax.type.email=http://axschema.org/contact/email&amp;openid.ax.value.email=foo@example.com')
251         response.rethrow()
252         parsed = json_decode(response.body)
253         self.assertEqual(parsed["email"], "foo@example.com")
254     def test_oauth10_redirect(self):
255         response = self.fetch('/oauth10/client/login', follow_redirects=False)
256         self.assertEqual(response.code, 302)
257         self.assertTrue(response.headers['Location'].endswith(
258             '/oauth1/server/authorize?oauth_token=zxcv'))
259         self.assertTrue(
260             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
261             response.headers['Set-Cookie'])
262     def test_oauth10_get_user(self):
263         response = self.fetch(
264             '/oauth10/client/login?oauth_token=zxcv',
265             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
266         response.rethrow()
267         parsed = json_decode(response.body)
268         self.assertEqual(parsed['email'], 'foo@example.com')
269         self.assertEqual(parsed['access_token'], dict(key='uiop', secret='5678'))
270     def test_oauth10_request_parameters(self):
271         response = self.fetch('/oauth10/client/request_params')
272         response.rethrow()
273         parsed = json_decode(response.body)
274         self.assertEqual(parsed['oauth_consumer_key'], 'asdf')
275         self.assertEqual(parsed['oauth_token'], 'uiop')
276         self.assertTrue('oauth_nonce' in parsed)
277         self.assertTrue('oauth_signature' in parsed)
278     def test_oauth10a_redirect(self):
279         response = self.fetch('/oauth10a/client/login', follow_redirects=False)
280         self.assertEqual(response.code, 302)
281         self.assertTrue(response.headers['Location'].endswith(
282             '/oauth1/server/authorize?oauth_token=zxcv'))
283         self.assertTrue(
284             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
285             response.headers['Set-Cookie'])
286     def test_oauth10a_get_user(self):
287         response = self.fetch(
288             '/oauth10a/client/login?oauth_token=zxcv',
289             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
290         response.rethrow()
291         parsed = json_decode(response.body)
292         self.assertEqual(parsed['email'], 'foo@example.com')
293         self.assertEqual(parsed['access_token'], dict(key='uiop', secret='5678'))
294     def test_oauth10a_request_parameters(self):
295         response = self.fetch('/oauth10a/client/request_params')
296         response.rethrow()
297         parsed = json_decode(response.body)
298         self.assertEqual(parsed['oauth_consumer_key'], 'asdf')
299         self.assertEqual(parsed['oauth_token'], 'uiop')
300         self.assertTrue('oauth_nonce' in parsed)
301         self.assertTrue('oauth_signature' in parsed)
302     def test_oauth10a_get_user_coroutine_exception(self):
303         response = self.fetch(
304             '/oauth10a/client/login_coroutine?oauth_token=zxcv&amp;fail_in_get_user=true',
305             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
306         self.assertEqual(response.code, 503)
307     def test_oauth2_redirect(self):
308         response = self.fetch('/oauth2/client/login', follow_redirects=False)
309         self.assertEqual(response.code, 302)
310         self.assertTrue('/oauth2/server/authorize?' in response.headers['Location'])
311     def test_facebook_login(self):
312         response = self.fetch('/facebook/client/login', follow_redirects=False)
313         self.assertEqual(response.code, 302)
314         self.assertTrue('/facebook/server/authorize?' in response.headers['Location'])
315         response = self.fetch('/facebook/client/login?code=1234', follow_redirects=False)
316         self.assertEqual(response.code, 200)
317         user = json_decode(response.body)
318         self.assertEqual(user['access_token'], 'asdf')
319         self.assertEqual(user['session_expires'], '3600')
320     def base_twitter_redirect(self, url):
321         response = self.fetch(url, follow_redirects=False)
322         self.assertEqual(response.code, 302)
323         self.assertTrue(response.headers['Location'].endswith(
324             '/oauth1/server/authorize?oauth_token=zxcv'))
325         self.assertTrue(
326             '_oauth_request_token="enhjdg==|MTIzNA=="' in response.headers['Set-Cookie'],
327             response.headers['Set-Cookie'])
328     def test_twitter_redirect(self):
329         self.base_twitter_redirect('/twitter/client/login')
330     def test_twitter_redirect_gen_engine(self):
331         self.base_twitter_redirect('/twitter/client/login_gen_engine')
332     def test_twitter_redirect_gen_coroutine(self):
333         self.base_twitter_redirect('/twitter/client/login_gen_coroutine')
334     def test_twitter_get_user(self):
335         response = self.fetch(
336             '/twitter/client/login?oauth_token=zxcv',
337             headers={'Cookie': '_oauth_request_token=enhjdg==|MTIzNA=='})
338         response.rethrow()
339         parsed = json_decode(response.body)
340         self.assertEqual(parsed,
341                          {u'access_token': {u'key': u'hjkl',
342                                             u'screen_name': u'foo',
343                                             u'secret': u'vbnm'},
344                           u'name': u'Foo',
345                           u'screen_name': u'foo',
346                           u'username': u'foo'})
347     def test_twitter_show_user(self):
348         response = self.fetch('/twitter/client/show_user?name=somebody')
349         response.rethrow()
350         self.assertEqual(json_decode(response.body),
351                          {'name': 'Somebody', 'screen_name': 'somebody'})
352     def test_twitter_show_user_error(self):
353         with ExpectLog(gen_log, 'Error response HTTP 500'):
354             response = self.fetch('/twitter/client/show_user?name=error')
355         self.assertEqual(response.code, 500)
356         self.assertEqual(response.body, b'error from twitter request')
357     def test_twitter_show_user_future(self):
358         response = self.fetch('/twitter/client/show_user_future?name=somebody')
359         response.rethrow()
360         self.assertEqual(json_decode(response.body),
361                          {'name': 'Somebody', 'screen_name': 'somebody'})
362     def test_twitter_show_user_future_error(self):
363         response = self.fetch('/twitter/client/show_user_future?name=error')
364         self.assertEqual(response.code, 500)
365         self.assertIn(b'Error response HTTP 500', response.body)
366 class GoogleLoginHandler(RequestHandler, GoogleOAuth2Mixin):
367     def initialize(self, test):
368         self.test = test
369         self._OAUTH_REDIRECT_URI = test.get_url('/client/login')
370         self._OAUTH_AUTHORIZE_URL = test.get_url('/google/oauth2/authorize')
371         self._OAUTH_ACCESS_TOKEN_URL = test.get_url('/google/oauth2/token')
372     @gen.coroutine
373     def get(self):
374         code = self.get_argument('code', None)
375         if code is not None:
376             access = yield self.get_authenticated_user(self._OAUTH_REDIRECT_URI,
377                                                        code)
378             user = yield self.oauth2_request(
379                 self.test.get_url("/google/oauth2/userinfo"),
380                 access_token=access["access_token"])
381             user["access_token"] = access["access_token"]
382             self.write(user)
383         else:
384             yield self.authorize_redirect(
385                 redirect_uri=self._OAUTH_REDIRECT_URI,
386                 client_id=self.settings['google_oauth']['key'],
387                 client_secret=self.settings['google_oauth']['secret'],
388                 scope=['profile', 'email'],
389                 response_type='code',
390                 extra_params={'prompt': 'select_account'})
391 class GoogleOAuth2AuthorizeHandler(RequestHandler):
392     def get(self):
393         code = 'fake-authorization-code'
394         self.redirect(url_concat(self.get_argument('redirect_uri'),
395                                  dict(code=code)))
396 class GoogleOAuth2TokenHandler(RequestHandler):
397     def post(self):
398         assert self.get_argument('code') == 'fake-authorization-code'
399         self.finish({
400             'access_token': 'fake-access-token',
401             'expires_in': 'never-expires'
402         })
403 class GoogleOAuth2UserinfoHandler(RequestHandler):
404     def get(self):
405         assert self.get_argument('access_token') == 'fake-access-token'
406         self.finish({
407             'name': 'Foo',
408             'email': 'foo@example.com'
409         })
410 class GoogleOAuth2Test(AsyncHTTPTestCase):
411     def get_app(self):
412         return Application(
413             [
414                 ('/client/login', GoogleLoginHandler, dict(test=self)),
415                 ('/google/oauth2/authorize', GoogleOAuth2AuthorizeHandler),
416                 ('/google/oauth2/token', GoogleOAuth2TokenHandler),
417                 ('/google/oauth2/userinfo', GoogleOAuth2UserinfoHandler),
418             ],
419             google_oauth={
420                 "key": 'fake_google_client_id',
421                 "secret": 'fake_google_client_secret'
422             })
423     def test_google_login(self):
424         response = self.fetch('/client/login')
425         self.assertDictEqual({
426             u'name': u'Foo',
427             u'email': u'foo@example.com',
428             u'access_token': u'fake-access-token',
429         }, json_decode(response.body))
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
