<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for pushover_1.py & cloud_2.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for pushover_1.py & cloud_2.py
      </h3>
      <h1 align="center">
        7.0%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>pushover_1.py (36.231884%)<TH>cloud_2.py (3.8819876%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match37226-0.html#0',2,'match37226-1.html#0',3)" NAME="0">(125-134)<TD><A HREF="javascript:ZweiFrames('match37226-0.html#0',2,'match37226-1.html#0',3)" NAME="0">(391-396)</A><TD ALIGN=center><FONT COLOR="#ff0000">13</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match37226-0.html#1',2,'match37226-1.html#1',3)" NAME="1">(116-122)<TD><A HREF="javascript:ZweiFrames('match37226-0.html#1',2,'match37226-1.html#1',3)" NAME="1">(251-258)</A><TD ALIGN=center><FONT COLOR="#eb0000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>pushover_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
Send a message to PushOver
==========================

This state is useful for sending messages to PushOver during state runs.

.. versionadded:: 2015.5.0

.. code-block:: yaml

    pushover-message:
      pushover.post_message:
        - user: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        - token: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        - title: Salt Returner
        - device: phone
        - priority: -1
        - expire: 3600
        - retry: 5
        - message: 'This state was executed successfully.'

The api key can be specified in the master or minion configuration like below:
.. code-block:: yaml

    pushover:
      token: peWcBiMOS9HrZG15peWcBiMOS9HrZG15

&quot;&quot;&quot;


def __virtual__():
    &quot;&quot;&quot;
    Only load if the pushover module is available in __salt__
    &quot;&quot;&quot;
    if &quot;pushover.post_message&quot; in __salt__:
        return &quot;pushover&quot;
    return (False, &quot;pushover module could not be loaded&quot;)


def post_message(
    name,
    user=None,
    device=None,
    message=None,
    title=None,
    priority=None,
    expire=None,
    retry=None,
    sound=None,
    api_version=1,
    token=None,
):
    &quot;&quot;&quot;
    Send a message to a PushOver channel.

    .. code-block:: yaml

        pushover-message:
          pushover.post_message:
            - user: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
            - token: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
            - title: Salt Returner
            - device: phone
            - priority: -1
            - expire: 3600
            - retry: 5

    The following parameters are required:

    name
        The unique name for this event.

    user
        The user or group of users to send the message to. Must be ID of user, not name
        or email address.

    message
        The message that is to be sent to the PushOver channel.

    The following parameters are optional:

    title
        The title to use for the message.

    device
        The device for the user to send the message to.

    priority
        The priority for the message.

    expire
        The message should expire after specified amount of seconds.

    retry
        The message should be resent this many times.

    token
        The token for PushOver to use for authentication,
        if not specified in the configuration options of master or minion.

    &quot;&quot;&quot;
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: False, &quot;comment&quot;: &quot;&quot;}

    if __opts__[&quot;test&quot;]:
        ret[&quot;comment&quot;] = &quot;The following message is to be sent to PushOver: {}&quot;.format(
            message
        )
        ret[&quot;result&quot;] = None
        return ret

    if not user:
        ret[&quot;comment&quot;] = &quot;PushOver user is missing: {}&quot;.format(user)
<A NAME="1"></A>        return ret

    if not message:
        ret<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match37226-1.html#1',3,'match37226-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>[&quot;comment&quot;] = &quot;PushOver message is missing: {}&quot;.format(message)
        return ret

    result = __salt__[&quot;pushover.post_message&quot;](
        user=user,
        message=message,
<A NAME="0"></A>        title=</B></FONT>title,
        device=device,
        priority=priority,
        expire<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match37226-1.html#0',3,'match37226-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>=expire,
        retry=retry,
        token=token,
    )

    if result:
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Sent message: {}&quot;.format(name)
    else:
        ret[&quot;comment&quot;] = &quot;Failed to send message: {}&quot;.</B></FONT>format(name)

    return ret
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>cloud_2.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
Using states instead of maps to deploy clouds
=============================================

.. versionadded:: 2014.1.0

Use this minion to spin up a cloud instance:

.. code-block:: yaml

    my-ec2-instance:
      cloud.profile:
        my-ec2-config
&quot;&quot;&quot;


import pprint

import salt.utils.cloud as suc


def __virtual__():
    &quot;&quot;&quot;
    Only load if the cloud module is available in __salt__
    &quot;&quot;&quot;
    if &quot;cloud.profile&quot; in __salt__:
        return True
    return (False, &quot;cloud module could not be loaded&quot;)


def _check_name(name):
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: None, &quot;comment&quot;: &quot;&quot;}
    if suc.check_name(name, &quot;a-zA-Z0-9._-&quot;):
        ret[&quot;comment&quot;] = &quot;Invalid characters in name.&quot;
        ret[&quot;result&quot;] = False
        return ret
    else:
        ret[&quot;result&quot;] = True
        return ret


def _valid(name, comment=&quot;&quot;, changes=None):
    if not changes:
        changes = {}
    return {&quot;name&quot;: name, &quot;result&quot;: True, &quot;changes&quot;: changes, &quot;comment&quot;: comment}


def _get_instance(names):
    # for some reason loader overwrites __opts__['test'] with default
    # value of False, thus store and then load it again after action
    test = __opts__.get(&quot;test&quot;, False)
    instance = __salt__[&quot;cloud.action&quot;](fun=&quot;show_instance&quot;, names=names)
    __opts__[&quot;test&quot;] = test
    return instance


def present(name, cloud_provider, onlyif=None, unless=None, opts=None, **kwargs):
    &quot;&quot;&quot;
    Spin up a single instance on a cloud provider, using salt-cloud. This state
    does not take a profile argument; rather, it takes the arguments that would
    normally be configured as part of the state.

    Note that while this function does take any configuration argument that
    would normally be used to create an instance, it will not verify the state
    of any of those arguments on an existing instance. Stateful properties of
    an instance should be configured using their own individual state (i.e.,
    cloud.tagged, cloud.untagged, etc).

    name
        The name of the instance to create

    cloud_provider
        The name of the cloud provider to use

    onlyif
        Do run the state only if is unless succeed

    unless
        Do not run the state at least unless succeed

    opts
        Any extra opts that need to be used
    &quot;&quot;&quot;
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: None, &quot;comment&quot;: &quot;&quot;}

    retcode = __salt__[&quot;cmd.retcode&quot;]
    if onlyif is not None:
        if not isinstance(onlyif, str):
            if not onlyif:
                return _valid(name, comment=&quot;onlyif condition is false&quot;)
        elif isinstance(onlyif, str):
            if retcode(onlyif, python_shell=True) != 0:
                return _valid(name, comment=&quot;onlyif condition is false&quot;)
    if unless is not None:
        if not isinstance(unless, str):
            if unless:
                return _valid(name, comment=&quot;unless condition is true&quot;)
        elif isinstance(unless, str):
            if retcode(unless, python_shell=True) == 0:
                return _valid(name, comment=&quot;unless condition is true&quot;)

    # provider=None not cloud_provider because
    # need to ensure ALL providers don't have the instance
    if __salt__[&quot;cloud.has_instance&quot;](name=name, provider=None):
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Already present instance {}&quot;.format(name)
        return ret

    if __opts__[&quot;test&quot;]:
        ret[&quot;comment&quot;] = &quot;Instance {} needs to be created&quot;.format(name)
        return ret

    info = __salt__[&quot;cloud.create&quot;](cloud_provider, name, opts=opts, **kwargs)
    if info and &quot;Error&quot; not in info:
        ret[&quot;changes&quot;] = info
        ret[&quot;result&quot;] = True
        ret[
            &quot;comment&quot;
        ] = &quot;Created instance {} using provider {} and the following options: {}&quot;.format(
            name, cloud_provider, pprint.pformat(kwargs)
        )
    elif info and &quot;Error&quot; in info:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Failed to create instance {} using profile {}: {}&quot;.format(
            name,
            profile,
            info[&quot;Error&quot;],
        )
    else:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = (
            &quot;Failed to create instance {} using profile {}, &quot;
            &quot;please check your configuration&quot;.format(name, profile)
        )
    return ret


def absent(name, onlyif=None, unless=None):
    &quot;&quot;&quot;
    Ensure that no instances with the specified names exist.

    CAUTION: This is a destructive state, which will search all
    configured cloud providers for the named instance,
    and destroy it.

    name
        The name of the instance to destroy

    onlyif
        Do run the state only if is unless succeed

    unless
        Do not run the state at least unless succeed

    &quot;&quot;&quot;
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: None, &quot;comment&quot;: &quot;&quot;}
    retcode = __salt__[&quot;cmd.retcode&quot;]

    if onlyif is not None:
        if not isinstance(onlyif, str):
            if not onlyif:
                return _valid(name, comment=&quot;onlyif condition is false&quot;)
        elif isinstance(onlyif, str):
            if retcode(onlyif, python_shell=True) != 0:
                return _valid(name, comment=&quot;onlyif condition is false&quot;)
    if unless is not None:
        if not isinstance(unless, str):
            if unless:
                return _valid(name, comment=&quot;unless condition is true&quot;)
        elif isinstance(unless, str):
            if retcode(unless, python_shell=True) == 0:
                return _valid(name, comment=&quot;unless condition is true&quot;)

    if not __salt__[&quot;cloud.has_instance&quot;](name=name, provider=None):
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Already absent instance {}&quot;.format(name)
        return ret

    if __opts__[&quot;test&quot;]:
        ret[&quot;comment&quot;] = &quot;Instance {} needs to be destroyed&quot;.format(name)
        return ret

    info = __salt__[&quot;cloud.destroy&quot;](name)
    if info and &quot;Error&quot; not in info:
        ret[&quot;changes&quot;] = info
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Destroyed instance {}&quot;.format(name)
    elif &quot;Error&quot; in info:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Failed to destroy instance {}: {}&quot;.format(
            name,
            info[&quot;Error&quot;],
        )
    else:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Failed to destroy instance {}&quot;.format(name)
    return ret


def profile(name, profile, onlyif=None, unless=None, opts=None, **kwargs):
    &quot;&quot;&quot;
    Create a single instance on a cloud provider, using a salt-cloud profile.

    Note that while profiles used this function do take any configuration
    argument that would normally be used to create an instance using a profile,
    this state will not verify the state of any of those arguments on an
    existing instance. Stateful properties of an instance should be configured
    using their own individual state (i.e., cloud.tagged, cloud.untagged, etc).

    name
        The name of the instance to create

    profile
        The name of the cloud profile to use

    onlyif
        Do run the state only if is unless succeed

    unless
        Do not run the state at least unless succeed

    kwargs
        Any profile override or addition

    opts
        Any extra opts that need to be used
    &quot;&quot;&quot;
    ret = {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: None, &quot;comment&quot;: &quot;&quot;}
    retcode = __salt__[&quot;cmd.retcode&quot;]
    if onlyif is not None:
        if not isinstance(onlyif, str):
            if not onlyif:
                return _valid(name, comment=&quot;onlyif condition is false&quot;)
        elif isinstance(onlyif, str):
            if retcode(onlyif, python_shell=True) != 0:
                return _valid(name, comment=&quot;onlyif condition is false&quot;)
    if unless is not None:
        if not isinstance(unless, str):
            if unless:
                return _valid(name, comment=&quot;unless condition is true&quot;)
        elif isinstance(unless, str):
            if retcode(unless, python_shell=True) == 0:
                return _valid(name, comment=&quot;unless condition is true&quot;)
    instance = _get_instance([name])
    if instance and not any(&quot;Not Actioned&quot; in key for key in instance):
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Already present instance {}&quot;.format(name)
<A NAME="1"></A>        return ret

    if __opts__[&quot;test&quot;]:
        ret<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match37226-0.html#1',2,'match37226-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>[&quot;comment&quot;] = &quot;Instance {} needs to be created&quot;.format(name)
        return ret

    info = __salt__[&quot;cloud.profile&quot;](profile, name, vm_overrides=kwargs, opts=opts)

    # get either {Error: ''} or {namestring: {Error: ''}}
    # which is what we can get from providers returns
    main_error =</B></FONT> info.get(&quot;Error&quot;, &quot;&quot;)
    name_error = &quot;&quot;
    if isinstance(info, dict):
        subinfo = info.get(name, {})
        if isinstance(subinfo, dict):
            name_error = subinfo.get(&quot;Error&quot;, None)
    error = main_error or name_error
    if info and not error:
        node_info = info.get(name)
        ret[&quot;result&quot;] = True
        default_msg = &quot;Created instance {} using profile {}&quot;.format(
            name,
            profile,
        )
        # some providers support changes
        if &quot;changes&quot; in node_info:
            ret[&quot;changes&quot;] = node_info[&quot;changes&quot;]
            ret[&quot;comment&quot;] = node_info.get(&quot;comment&quot;, default_msg)
        else:
            ret[&quot;changes&quot;] = info
            ret[&quot;comment&quot;] = default_msg
    elif error:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Failed to create instance {} using profile {}: {}&quot;.format(
            name,
            profile,
            &quot;{}\n{}\n&quot;.format(main_error, name_error).strip(),
        )
    else:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Failed to create instance {} using profile {}&quot;.format(
            name,
            profile,
        )
    return ret


def volume_present(name, provider=None, **kwargs):
    &quot;&quot;&quot;
    Check that a block volume exists.
    &quot;&quot;&quot;
    ret = _check_name(name)
    if not ret[&quot;result&quot;]:
        return ret

    volumes = __salt__[&quot;cloud.volume_list&quot;](provider=provider)

    if name in volumes:
        ret[&quot;comment&quot;] = &quot;Volume exists: {}&quot;.format(name)
        ret[&quot;result&quot;] = True
        return ret
    elif __opts__[&quot;test&quot;]:
        ret[&quot;comment&quot;] = &quot;Volume {} will be created.&quot;.format(name)
        ret[&quot;result&quot;] = None
        return ret

    response = __salt__[&quot;cloud.volume_create&quot;](names=name, provider=provider, **kwargs)
    if response:
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Volume {} was created&quot;.format(name)
        ret[&quot;changes&quot;] = {&quot;old&quot;: None, &quot;new&quot;: response}
    else:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Volume {} failed to create.&quot;.format(name)
    return ret


def volume_absent(name, provider=None, **kwargs):
    &quot;&quot;&quot;
    Check that a block volume exists.
    &quot;&quot;&quot;
    ret = _check_name(name)
    if not ret[&quot;result&quot;]:
        return ret

    volumes = __salt__[&quot;cloud.volume_list&quot;](provider=provider)

    if name not in volumes:
        ret[&quot;comment&quot;] = &quot;Volume is absent.&quot;
        ret[&quot;result&quot;] = True
        return ret
    elif __opts__[&quot;test&quot;]:
        ret[&quot;comment&quot;] = &quot;Volume {} will be deleted.&quot;.format(name)
        ret[&quot;result&quot;] = None
        return ret

    response = __salt__[&quot;cloud.volume_delete&quot;](names=name, provider=provider, **kwargs)
    if response:
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Volume {} was deleted&quot;.format(name)
        ret[&quot;changes&quot;] = {&quot;old&quot;: volumes[name], &quot;new&quot;: response}
    else:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Volume {} failed to delete.&quot;.format(name)
    return ret


def volume_attached(name, server_name, provider=None, **kwargs):
    &quot;&quot;&quot;
    Check if a block volume is attached.
    &quot;&quot;&quot;
    ret = _check_name(name)
    if not ret[&quot;result&quot;]:
        return ret

    ret = _check_name(server_name)
    if not ret[&quot;result&quot;]:
        return ret

    volumes = __salt__[&quot;cloud.volume_list&quot;](provider=provider)
    instance = __salt__[&quot;cloud.action&quot;](fun=&quot;show_instance&quot;, names=server_name)

    if name in volumes and volumes[name][&quot;attachments&quot;]:
        volume = volumes[name]
        ret[&quot;comment&quot;] = &quot;Volume {name} is already attached: {attachments}&quot;.format(
            **volumes[name]
        )
        ret[&quot;result&quot;] = True
        return ret
    elif name not in volumes:
        ret[&quot;comment&quot;] = &quot;Volume {} does not exist&quot;.format(name)
        ret[&quot;result&quot;] = False
        return ret
    elif not instance:
        ret[&quot;comment&quot;] = &quot;Server {} does not exist&quot;.format(server_name)
        ret[&quot;result&quot;] = False
        return ret
    elif __opts__[&quot;test&quot;]:
        ret[&quot;comment&quot;] = &quot;Volume {} will be will be attached.&quot;.format(name)
        ret[&quot;result&quot;] = None
<A NAME="0"></A>        return ret

    response = __salt__[&quot;cloud.volume_attach&quot;](
        provider<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match37226-0.html#0',2,'match37226-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>=provider, names=name, server_name=server_name, **kwargs
    )
    if response:
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Volume {} was created&quot;.format(name)
        ret[&quot;changes&quot;] = {&quot;old&quot;</B></FONT>: volumes[name], &quot;new&quot;: response}
    else:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Volume {} failed to attach.&quot;.format(name)
    return ret


def volume_detached(name, server_name=None, provider=None, **kwargs):
    &quot;&quot;&quot;
    Check if a block volume is attached.

    Returns True if server or Volume do not exist.
    &quot;&quot;&quot;
    ret = _check_name(name)
    if not ret[&quot;result&quot;]:
        return ret

    if server_name is not None:
        ret = _check_name(server_name)
        if not ret[&quot;result&quot;]:
            return ret

    volumes = __salt__[&quot;cloud.volume_list&quot;](provider=provider)
    if server_name:
        instance = __salt__[&quot;cloud.action&quot;](fun=&quot;show_instance&quot;, names=[name])
    else:
        instance = None

    if name in volumes and not volumes[name][&quot;attachments&quot;]:
        volume = volumes[name]
        ret[&quot;comment&quot;] = &quot;Volume {name} is not currently attached to anything.&quot;.format(
            **volumes[name]
        )
        ret[&quot;result&quot;] = True
        return ret
    elif name not in volumes:
        ret[&quot;comment&quot;] = &quot;Volume {} does not exist&quot;.format(name)
        ret[&quot;result&quot;] = True
        return ret
    elif not instance and server_name is not None:
        ret[&quot;comment&quot;] = &quot;Server {} does not exist&quot;.format(server_name)
        ret[&quot;result&quot;] = True
        return ret
    elif __opts__[&quot;test&quot;]:
        ret[&quot;comment&quot;] = &quot;Volume {} will be will be detached.&quot;.format(name)
        ret[&quot;result&quot;] = None
        return ret

    response = __salt__[&quot;cloud.volume_detach&quot;](
        provider=provider, names=name, server_name=server_name, **kwargs
    )
    if response:
        ret[&quot;result&quot;] = True
        ret[&quot;comment&quot;] = &quot;Volume {} was created&quot;.format(name)
        ret[&quot;changes&quot;] = {&quot;old&quot;: volumes[name], &quot;new&quot;: response}
    else:
        ret[&quot;result&quot;] = False
        ret[&quot;comment&quot;] = &quot;Volume {} failed to detach.&quot;.format(name)
    return ret
</PRE>
</div>
  </div>
</body>
</html>
