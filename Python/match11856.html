<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for boto_elasticache.py &amp; boto_iam.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for boto_elasticache.py &amp; boto_iam.py
      </h3>
<h1 align="center">
        13.8%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>boto_elasticache.py (52.09302%)<th>boto_iam.py (8.005718%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(486-502)<td><a href="#" name="0">(1630-1641)</a><td align="center"><font color="#ff0000">29</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(353-391)<td><a href="#" name="1">(1742-1791)</a><td align="center"><font color="#ff0000">29</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(319-332)<td><a href="#" name="2">(1118-1131)</a><td align="center"><font color="#db0000">25</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(520-533)<td><a href="#" name="3">(1721-1731)</a><td align="center"><font color="#b80000">21</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(509-518)<td><a href="#" name="4">(881-887)</a><td align="center"><font color="#9e0000">18</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(333-342)<td><a href="#" name="5">(1914-1921)</a><td align="center"><font color="#950000">17</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(94-113)<td><a href="#" name="6">(1484-1557)</a><td align="center"><font color="#950000">17</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(450-468)<td><a href="#" name="7">(1278-1287)</a><td align="center"><font color="#8c0000">16</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(477-482)<td><a href="#" name="8">(841-846)</a><td align="center"><font color="#830000">15</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(268-280)<td><a href="#" name="9">(1310-1324)</a><td align="center"><font color="#720000">13</font>
<tr onclick='openModal("#ad5910")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#ad5910"><font color="#ad5910">-</font><td><a href="#" name="10">(443-449)<td><a href="#" name="10">(649-653)</a><td align="center"><font color="#690000">12</font>
<tr onclick='openModal("#b041ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#b041ff"><font color="#b041ff">-</font><td><a href="#" name="11">(232-239)<td><a href="#" name="11">(429-432)</a><td align="center"><font color="#690000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_elasticache.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 log = logging.getLogger(__name__)
3 def __virtual__():
4     if "boto_elasticache.exists" in __salt__:
5         return "boto_elasticache"
6     return (False, "boto_elasticache module could not be loaded")
7 <a name="6"></a>
8 def cache_cluster_present(*args, **kwargs):
9     return present(<font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>*args, **kwargs)
10 def present(
11     name,
12     engine=None,
13     cache_node_type=None,
14     num_cache_nodes=None,
15     preferred_availability_zone=None,
16     port=None,
17     cache_parameter_group_name=None,
18     cache_security_group_names=None,
19     replication_group_id=None,
20     auto_minor_version_upgrade=True,
21     security_group_ids=None,
22     cache_subnet_group_name=None,
23     engine_version=None,
24     notification_topic_arn=None,
25     preferred_maintenance_window=None,
26     wait=</b></font>None,
27     region=None,
28     key=None,
29     keyid=None,
30     profile=None,
31 ):
32     ret = {"name": name, "result": True, "comment": "", "changes": {}}
33     if cache_security_group_names and cache_subnet_group_name:
34         _subnet_group = __salt__["boto_elasticache.get_cache_subnet_group"](
35             cache_subnet_group_name, region, key, keyid, profile
36         )
37         vpc_id = _subnet_group["vpc_id"]
38         if not security_group_ids:
39             security_group_ids = []
40         _security_group_ids = __salt__["boto_secgroup.convert_to_group_ids"](
41             groups=cache_security_group_names,
42             vpc_id=vpc_id,
43             region=region,
44             key=key,
45             keyid=keyid,
46             profile=profile,
47         )
48         security_group_ids.extend(_security_group_ids)
49         cache_security_group_names = None
50     config = __salt__["boto_elasticache.get_config"](name, region, key, keyid, profile)
51     if config is None:
52         msg = "Failed to retrieve cache cluster info from AWS."
53         ret["comment"] = msg
54         ret["result"] = None
55         return ret
56     elif not config:
57 <a name="11"></a>        if __opts__["test"]:
58             msg = "Cache cluster {} is set to be created.".format(name)
59             ret["comment"] = msg
60             ret<font color="#b041ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>["result"] = None
61             return ret
62         created = __salt__["boto_elasticache.create"](
63             name=name,
64             num_cache_nodes=num_cache_nodes,
65             cache_node_type=cache_node_type,
66             engine=engine,
67             replication_group_id=</b></font>replication_group_id,
68             engine_version=engine_version,
69             cache_parameter_group_name=cache_parameter_group_name,
70             cache_subnet_group_name=cache_subnet_group_name,
71             cache_security_group_names=cache_security_group_names,
72             security_group_ids=security_group_ids,
73             preferred_availability_zone=preferred_availability_zone,
74             preferred_maintenance_window=preferred_maintenance_window,
75             port=port,
76             notification_topic_arn=notification_topic_arn,
77             auto_minor_version_upgrade=auto_minor_version_upgrade,
78             wait=wait,
79             region=region,
80             key=key,
81             keyid=keyid,
82             profile=profile,
83         )
84         if created:
85             ret["changes"]["old"] = None
86             config = __salt__["boto_elasticache.get_config"](
87                 name, region, key, keyid, profile
88             )
89             ret["changes"]["new"] = config
90         else:
91             ret["result"] = False
92             ret["comment"] = "Failed to create {} cache cluster.".format(name)
93 <a name="9"></a>            return ret
94     else:
95         ret["comment"] = "Cache cluster {} is present."<font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(name)
96     return ret
97 def subnet_group_present(
98     name,
99     subnet_ids=None,
100     subnet_names=None,
101     description=None,
102     tags=None,
103     region=None,
104     key=None,
105     keyid=</b></font>None,
106     profile=None,
107 ):
108 <a name="2"></a>    ret = {"name": name, "result": True, "comment": "", "changes": {}}
109     exists = __salt__["boto_elasticache.subnet_group_exists"](
110         name=name, tags<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=tags, region=region, key=key, keyid=keyid, profile=profile
111     )
112     if not exists:
113         if __opts__["test"]:
114             ret["comment"] = "Subnet group {} is set to be created.".format(name)
115             ret["result"] = None
116             return ret
117         created = __salt__["boto_elasticache.create_subnet_group"](
118             name=name,
119             subnet_ids=subnet_ids,
120             subnet_names=subnet_names,
121 <a name="5"></a>            description=description,
122             tags=tags,
123             region=</b></font>region,
124             key<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=key,
125             keyid=keyid,
126             profile=profile,
127         )
128         if not created:
129             ret["result"] = False
130             ret["comment"] = "Failed to create {} subnet group.".format(name)
131             return ret
132         ret["changes"]["old"] = None
133         ret["changes"][</b></font>"new"] = name
134         ret["comment"] = "Subnet group {} created.".format(name)
135         return ret
136     ret["comment"] = "Subnet group present."
137     return ret
138 def cache_cluster_absent(*args, **kwargs):
139 <a name="1"></a>    return absent(*args, **kwargs)
140 def absent(name, wait<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=True, region=None, key=None, keyid=None, profile=None):
141     ret = {"name": name, "result": True, "comment": "", "changes": {}}
142     is_present = __salt__["boto_elasticache.exists"](name, region, key, keyid, profile)
143     if is_present:
144         if __opts__["test"]:
145             ret["comment"] = "Cache cluster {} is set to be removed.".format(name)
146             ret["result"] = None
147             return ret
148         deleted = __salt__["boto_elasticache.delete"](
149             name, wait, region, key, keyid, profile
150         )
151         if deleted:
152             ret["changes"]["old"] = name
153             ret[</b></font>"changes"]["new"] = None
154         else:
155             ret["result"] = False
156             ret["comment"] = "Failed to delete {} cache cluster.".format(name)
157     else:
158         ret["comment"] = "{} does not exist in {}.".format(name, region)
159     return ret
160 def replication_group_present(*args, **kwargs):
161     return creategroup(*args, **kwargs)
162 def creategroup(
163     name,
164     primary_cluster_id,
165     replication_group_description,
166     wait=None,
167     region=None,
168     key=None,
169     keyid=None,
170     profile=None,
171 ):
172     ret = {"name": name, "result": None, "comment": "", "changes": {}}
173     is_present <font color="#ad5910"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= __salt__["boto_elasticache.group_exists"](
174         name, region, key, keyid, profile
175     )
176     if not is_present:
177 <a name="7"></a>        if __opts__["test"]:
178             ret["comment"] = "Replication {} is set to be created.".format(name)
179             ret["result"] =</b></font> None
180         created <font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= __salt__["boto_elasticache.create_replication_group"](
181             name,
182             primary_cluster_id,
183             replication_group_description,
184             wait,
185             region,
186             key,
187             keyid,
188             profile,
189         )
190         if created:
191             config = __salt__["boto_elasticache.describe_replication_group"](
192                 name, region, key, keyid, profile
193             )
194             ret["changes"]["old"] = None
195             ret["changes"]["new"] = config
196             ret["result"] = True
197         else:
198             ret[</b></font>"result"] = False
199             ret["comment"] = "Failed to create {} replication group.".format(name)
200     else:
201         ret["comment"] = "{} replication group exists .".format(name)
202         ret["result"] = True
203     return ret
204 <a name="8"></a>
205 def subnet_group_absent(
206     name, tags=None, region<font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=None, key=None, keyid=None, profile=None
207 ):
208     ret = {"name": name, "result": True, "comment": "", "changes": {}}
209     exists = __salt__["boto_elasticache.subnet_group_exists"](
210         name=name, tags=tags, region=region, key=key, keyid=keyid, profile=</b></font>profile
211 <a name="0"></a>    )
212     if not exists:
213         ret["result"] = True
214         ret<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>["comment"] = "{} ElastiCache subnet group does not exist.".format(name)
215         return ret
216     if __opts__["test"]:
217         ret["comment"] = "ElastiCache subnet group {} is set to be removed.".format(
218             name
219         )
220         ret["result"] = None
221         return ret
222     deleted = __salt__["boto_elasticache.delete_subnet_group"](
223         name, region, key, keyid, profile
224     )
225     if not deleted:
226         ret["result"] = False
227         ret["comment"] = "Failed to delete {} ElastiCache subnet group.".format(name)
228         return ret
229     ret[</b></font>"changes"]["old"] = name
230     ret["changes"]["new"] = None
231     ret["comment"] = "ElastiCache subnet group {} deleted.".format(name)
232     return ret
233 <a name="4"></a>
234 def replication_group_absent(
235     name, tags=None, region<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=None, key=None, keyid=None, profile=None
236 ):
237     ret = {"name": name, "result": True, "comment": "", "changes": {}}
238     exists = __salt__["boto_elasticache.group_exists"](
239         name=name, region=region, key=key, keyid=keyid, profile=profile
240     )
241     if not exists:
242 <a name="3"></a>        ret["result"] = True
243         ret[</b></font>"comment"] = "{} ElastiCache replication group does not exist.".format(name)
244         log.info(ret["comment"])
245         <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>return ret
246     if __opts__["test"]:
247         ret[
248             "comment"
249         ] = "ElastiCache replication group {} is set to be removed.".format(name)
250         ret["result"] = True
251         return ret
252     deleted = __salt__["boto_elasticache.delete_replication_group"](
253         name, region, key, keyid, profile
254     )
255     if not deleted:
256         ret["result"] = False
257         log.error(ret[</b></font>"comment"])
258         ret["comment"] = "Failed to delete {} ElastiCache replication group.".format(
259             name
260         )
261         return ret
262     ret["changes"]["old"] = name
263     ret["changes"]["new"] = None
264     ret["comment"] = "ElastiCache replication group {} deleted.".format(name)
265     log.info(ret["comment"])
266     return ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_iam.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import xml.etree.ElementTree as ET
4 import salt.utils.data
5 import salt.utils.dictupdate as dictupdate
6 import salt.utils.files
7 import salt.utils.json
8 import salt.utils.odict as odict
9 import salt.utils.stringutils
10 log = logging.getLogger(__name__)
11 __virtualname__ = "boto_iam"
12 def __virtual__():
13     if "boto_iam.get_user" in __salt__:
14         return True
15     else:
16         return (
17             False,
18             "Cannot load {} state: boto_iam module unavailable".format(__virtualname__),
19         )
20 def user_absent(
21     name,
22     delete_keys=True,
23     delete_mfa_devices=True,
24     delete_profile=True,
25     region=None,
26     key=None,
27     keyid=None,
28     profile=None,
29 ):
30     ret = {"name": name, "result": True, "comment": "", "changes": {}}
31     if not __salt__["boto_iam.get_user"](name, region, key, keyid, profile):
32         ret["result"] = True
33         ret["comment"] = "IAM User {} does not exist.".format(name)
34         return ret
35     if delete_keys:
36         keys = __salt__["boto_iam.get_all_access_keys"](
37             user_name=name, region=region, key=key, keyid=keyid, profile=profile
38         )
39         log.debug("Keys for user %s are %s.", name, keys)
40         if isinstance(keys, dict):
41             keys = keys["list_access_keys_response"]["list_access_keys_result"][
42                 "access_key_metadata"
43             ]
44             for k in keys:
45                 if __opts__["test"]:
46                     ret["comment"] = " ".join(
47                         [
48                             ret["comment"],
49                             "Key {} is set to be deleted.".format(k["access_key_id"]),
50                         ]
51                     )
52                     ret["result"] = None
53                 else:
54                     if _delete_key(
55                         ret, k["access_key_id"], name, region, key, keyid, profile
56                     ):
57                         ret["comment"] = " ".join(
58                             [
59                                 ret["comment"],
60                                 "Key {} has been deleted.".format(k["access_key_id"]),
61                             ]
62                         )
63                         ret["changes"][k["access_key_id"]] = "deleted"
64     if delete_mfa_devices:
65         devices = __salt__["boto_iam.get_all_mfa_devices"](
66             user_name=name, region=region, key=key, keyid=keyid, profile=profile
67         )
68         if devices:
69             for d in devices:
70                 serial = d["serial_number"]
71                 if __opts__["test"]:
72                     ret["comment"] = " ".join(
73                         [
74                             ret["comment"],
75                             "IAM user {} MFA device {} is set to be deactivated.".format(
76                                 name, serial
77                             ),
78                         ]
79                     )
80                     ret["result"] = None
81                 else:
82                     mfa_deactivated = __salt__["boto_iam.deactivate_mfa_device"](
83                         user_name=name,
84                         serial=serial,
85                         region=region,
86                         key=key,
87                         keyid=keyid,
88                         profile=profile,
89                     )
90                     if mfa_deactivated:
91                         ret["comment"] = " ".join(
92                             [
93                                 ret["comment"],
94                                 "IAM user {} MFA device {} is deactivated.".format(
95                                     name, serial
96                                 ),
97                             ]
98                         )
99                 if __opts__["test"]:
100                     ret["comment"] = " ".join(
101                         [
102                             ret["comment"],
103                             "Virtual MFA device {} is set to be deleted.".format(
104                                 serial
105                             ),
106                         ]
107                     )
108                     ret["result"] = None
109                 else:
110                     mfa_deleted = __salt__["boto_iam.delete_virtual_mfa_device"](
111                         serial=serial,
112                         region=region,
113                         key=key,
114                         keyid=keyid,
115                         profile=profile,
116                     )
117                     if mfa_deleted:
118                         ret["comment"] = " ".join(
119                             [
120                                 ret["comment"],
121                                 "Virtual MFA device {} is deleted.".format(serial),
122                             ]
123                         )
124     if delete_profile:
125         if __opts__["test"]:
126             ret["comment"] = " ".join(
127                 [
128                     ret["comment"],
129                     "IAM user {} login profile is set to be deleted.".format(name),
130                 ]
131             )
132             ret["result"] = None
133         else:
134             profile_deleted = __salt__["boto_iam.delete_login_profile"](
135                 name, region, key, keyid, profile
136             )
137             if profile_deleted:
138                 ret["comment"] = " ".join(
139                     [
140                         ret["comment"],
141                         "IAM user {} login profile is deleted.".format(name),
142                     ]
143                 )
144     if __opts__["test"]:
145         ret["comment"] = " ".join(
146             [
147                 ret["comment"],
148                 "IAM user {} managed policies are set to be detached.".format(name),
149             ]
150         )
151         ret["result"] = None
152     else:
153         _ret = _user_policies_detached(name, region, key, keyid, profile)
154         ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
155         if not _ret["result"]:
156             ret["result"] = _ret["result"]
157             if ret["result"] is False:
158                 return ret
159     if __opts__["test"]:
160         ret["comment"] = " ".join(
161             [
162                 ret["comment"],
163                 "IAM user {} inline policies are set to be deleted.".format(name),
164             ]
165         )
166         ret["result"] = None
167     else:
168         _ret = _user_policies_deleted(name, region, key, keyid, profile)
169         ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
170         if not _ret["result"]:
171             ret["result"] = _ret["result"]
172             if ret["result"] is False:
173                 return ret
174     if __opts__["test"]:
175         ret["comment"] = " ".join(
176             [ret["comment"], "IAM user {} is set to be deleted.".format(name)]
177         )
178         ret["result"] = None
179         return ret
180     deleted = __salt__["boto_iam.delete_user"](name, region, key, keyid, profile)
181     if deleted is True:
182         ret["comment"] = " ".join(
183             [ret["comment"], "IAM user {} is deleted.".format(name)]
184         )
185         ret["result"] = True
186         ret["changes"]["deleted"] = name
187         return ret
188     ret["comment"] = "IAM user {} could not be deleted.\n {}".format(name, deleted)
189     ret["result"] = False
190     return ret
191 def keys_present(
192     name,
193     number,
194     save_dir,
195     region=None,
196     key=None,
197     keyid=None,
198     profile=None,
199     save_format="{2}\n{0}\n{3}\n{1}\n",
200 ):
201     ret = {"name": name, "result": True, "comment": "", "changes": {}}
202     if not __salt__["boto_iam.get_user"](name, region, key, keyid, profile):
203         ret["result"] = False
204         ret["comment"] = "IAM User {} does not exist.".format(name)
205         return ret
206     if not isinstance(number, int):
207         ret["comment"] = "The number of keys must be an integer."
208         ret["result"] = False
209 <a name="11"></a>        return ret
210     if not os.path.isdir(save_dir):
211         ret["comment"] = "The directory {} does not exist.".format(save_dir)
212         ret<font color="#b041ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>["result"] = False
213         return ret
214     keys = __salt__["boto_iam.get_all_access_keys"](
215         user_name=name, region=region, key=key, keyid=keyid, profile=</b></font>profile
216     )
217     if isinstance(keys, str):
218         log.debug("keys are : false %s", keys)
219         error, message = _get_error(keys)
220         ret["comment"] = "Could not get keys.\n{}\n{}".format(error, message)
221         ret["result"] = False
222         return ret
223     keys = keys["list_access_keys_response"]["list_access_keys_result"][
224         "access_key_metadata"
225     ]
226     log.debug("Keys are : %s.", keys)
227     if len(keys) &gt;= number:
228         ret["comment"] = "The number of keys exist for user {}".format(name)
229         ret["result"] = True
230         return ret
231     if __opts__["test"]:
232         ret["comment"] = "Access key is set to be created for {}.".format(name)
233         ret["result"] = None
234         return ret
235     new_keys = {}
236     for i in range(number - len(keys)):
237         created = __salt__["boto_iam.create_access_key"](
238             name, region, key, keyid, profile
239         )
240         if isinstance(created, str):
241             error, message = _get_error(created)
242             ret["comment"] = "Could not create keys.\n{}\n{}".format(error, message)
243             ret["result"] = False
244             return ret
245         log.debug("Created is : %s", created)
246         response = "create_access_key_response"
247         result = "create_access_key_result"
248         new_keys[str(i)] = {}
249         new_keys[str(i)]["key_id"] = created[response][result]["access_key"][
250             "access_key_id"
251         ]
252         new_keys[str(i)]["secret_key"] = created[response][result]["access_key"][
253             "secret_access_key"
254         ]
255     try:
256         with salt.utils.files.fopen("{}/{}".format(save_dir, name), "a") as _wrf:
257             for key_num, key in new_keys.items():
258                 key_id = key["key_id"]
259                 secret_key = key["secret_key"]
260                 _wrf.write(
261                     salt.utils.stringutils.to_str(
262                         save_format.format(
263                             key_id,
264                             secret_key,
265                             "key_id-{}".format(key_num),
266                             "key-{}".format(key_num),
267                         )
268                     )
269                 )
270         ret["comment"] = "Keys have been written to file {}/{}.".format(save_dir, name)
271         ret["result"] = True
272         ret["changes"] = new_keys
273         return ret
274     except OSError:
275         ret["comment"] = "Could not write to file {}/{}.".format(save_dir, name)
276         ret["result"] = False
277         return ret
278 def keys_absent(
279     access_keys, user_name, region=None, key=None, keyid=None, profile=None
280 ):
281     ret = {"name": access_keys, "result": True, "comment": "", "changes": {}}
282     if not __salt__["boto_iam.get_user"](user_name, region, key, keyid, profile):
283         ret["result"] = False
284         ret["comment"] = "IAM User {} does not exist.".format(user_name)
285         return ret
286     for k in access_keys:
287         ret = _delete_key(ret, k, user_name, region, key, keyid, profile)
288     return ret
289 def _delete_key(
290     ret, access_key_id, user_name, region=None, key=None, keyid=None, profile=None
291 ):
292     keys = __salt__["boto_iam.get_all_access_keys"](
293         user_name=user_name, region=region, key=key, keyid=keyid, profile=profile
294     )
295     log.debug("Keys for user %s are : %s.", keys, user_name)
296     if isinstance(keys, str):
297         log.debug("Keys %s are a string. Something went wrong.", keys)
298         ret["comment"] = " ".join(
299             [ret["comment"], "Key {} could not be deleted.".format(access_key_id)]
300         )
301         return ret
302     keys = keys["list_access_keys_response"]["list_access_keys_result"][
303         "access_key_metadata"
304     ]
305     for k in keys:
306         log.debug(
307             "Key is: %s and is compared with: %s", k["access_key_id"], access_key_id
308         )
309         if str(k["access_key_id"]) == str(access_key_id):
310             if __opts__["test"]:
311                 ret["comment"] = "Access key {} is set to be deleted.".format(
312                     access_key_id
313                 )
314                 ret["result"] = None
315                 return ret
316             deleted = __salt__["boto_iam.delete_access_key"](
317                 access_key_id, user_name, region, key, keyid, profile
318             )
319             if deleted:
320                 ret["comment"] = " ".join(
321                     [ret["comment"], "Key {} has been deleted.".format(access_key_id)]
322                 )
323                 ret["changes"][access_key_id] = "deleted"
324                 return ret
325             ret["comment"] = " ".join(
326                 [ret["comment"], "Key {} could not be deleted.".format(access_key_id)]
327             )
328             return ret
329         ret["comment"] = " ".join([ret["comment"], "Key {} does not exist.".format(k)])
330         return ret
331 def user_present(
332     name,
333     policies=None,
334     policies_from_pillars=None,
335     managed_policies=None,
336     password=None,
337     path=None,
338     region=None,
339     key=None,
340     keyid=None,
341     profile=None,
342 ):
343     ret = {"name": name, "result": True, "comment": "", "changes": {}}
344     if not policies:
345         policies = {}
346     if not policies_from_pillars:
347         policies_from_pillars = []
348     if not managed_policies:
349         managed_policies = []
350     _policies = {}
351     for policy in policies_from_pillars:
352 <a name="10"></a>        _policy = __salt__["pillar.get"](policy)
353         _policies.update(_policy)
354     _policies.update(policies)
355     exists <font color="#ad5910"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= __salt__["boto_iam.get_user"](name, region, key, keyid, profile)
356     if not exists:
357         if __opts__["test"]:
358             ret["comment"] = "IAM user {} is set to be created.".format(name)
359             ret["result"] =</b></font> None
360             return ret
361         created = __salt__["boto_iam.create_user"](
362             name, path, region, key, keyid, profile
363         )
364         if created:
365             ret["changes"]["user"] = created
366             ret["comment"] = " ".join(
367                 [ret["comment"], "User {} has been created.".format(name)]
368             )
369             if password:
370                 ret = _case_password(ret, name, password, region, key, keyid, profile)
371             _ret = _user_policies_present(name, _policies, region, key, keyid, profile)
372             ret["changes"] = dictupdate.update(ret["changes"], _ret["changes"])
373             ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
374     else:
375         ret["comment"] = " ".join([ret["comment"], "User {} is present.".format(name)])
376         if password:
377             ret = _case_password(ret, name, password, region, key, keyid, profile)
378         _ret = _user_policies_present(name, _policies, region, key, keyid, profile)
379         ret["changes"] = dictupdate.update(ret["changes"], _ret["changes"])
380         ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
381     _ret = _user_policies_attached(name, managed_policies, region, key, keyid, profile)
382     ret["changes"] = dictupdate.update(ret["changes"], _ret["changes"])
383     ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
384     if not _ret["result"]:
385         ret["result"] = _ret["result"]
386         return ret
387     return ret
388 def _user_policies_present(
389     name, policies=None, region=None, key=None, keyid=None, profile=None
390 ):
391     ret = {"result": True, "comment": "", "changes": {}}
392     policies_to_create = {}
393     policies_to_delete = []
394     for policy_name, policy in policies.items():
395         if isinstance(policy, str):
396             dict_policy = salt.utils.json.loads(
397                 policy, object_pairs_hook=odict.OrderedDict
398             )
399         else:
400             dict_policy = policy
401         _policy = __salt__["boto_iam.get_user_policy"](
402             name, policy_name, region, key, keyid, profile
403         )
404         if _policy != dict_policy:
405             log.debug("Policy mismatch:\n%s\n%s", _policy, dict_policy)
406             policies_to_create[policy_name] = policy
407     _list = __salt__["boto_iam.get_all_user_policies"](
408         user_name=name, region=region, key=key, keyid=keyid, profile=profile
409     )
410     for policy_name in _list:
411         if policy_name not in policies:
412             policies_to_delete.append(policy_name)
413     if policies_to_create or policies_to_delete:
414         _to_modify = list(policies_to_delete)
415         _to_modify.extend(policies_to_create)
416         if __opts__["test"]:
417             ret["comment"] = "{} policies to be modified on user {}.".format(
418                 ", ".join(_to_modify), name
419             )
420             ret["result"] = None
421             return ret
422         ret["changes"]["old"] = {"policies": _list}
423         for policy_name, policy in policies_to_create.items():
424             policy_set = __salt__["boto_iam.put_user_policy"](
425                 name, policy_name, policy, region, key, keyid, profile
426             )
427             if not policy_set:
428                 _list = __salt__["boto_iam.get_all_user_policies"](
429                     user_name=name, region=region, key=key, keyid=keyid, profile=profile
430                 )
431                 ret["changes"]["new"] = {"policies": _list}
432                 ret["result"] = False
433                 ret["comment"] = "Failed to add policy {} for user {}".format(
434                     policy_name, name
435                 )
436                 return ret
437         for policy_name in policies_to_delete:
438             policy_unset = __salt__["boto_iam.delete_user_policy"](
439                 name, policy_name, region, key, keyid, profile
440             )
441             if not policy_unset:
442                 _list = __salt__["boto_iam.get_all_user_policies"](
443                     user_name=name, region=region, key=key, keyid=keyid, profile=profile
444                 )
445                 ret["changes"]["new"] = {"policies": _list}
446                 ret["result"] = False
447                 ret["comment"] = "Failed to add policy {} to user {}".format(
448                     policy_name, name
449                 )
450                 return ret
451         _list = __salt__["boto_iam.get_all_user_policies"](
452             user_name=name, region=region, key=key, keyid=keyid, profile=profile
453         )
454         ret["changes"]["new"] = {"policies": _list}
455         ret["comment"] = "{} policies modified on user {}.".format(
456             ", ".join(_list), name
457         )
458     return ret
459 def _user_policies_attached(
460     name, managed_policies=None, region=None, key=None, keyid=None, profile=None
461 ):
462     ret = {"result": True, "comment": "", "changes": {}}
463     policies_to_attach = []
464     policies_to_detach = []
465     for policy in managed_policies or []:
466         entities = __salt__["boto_iam.list_entities_for_policy"](
467             policy,
468             entity_filter="User",
469             region=region,
470             key=key,
471             keyid=keyid,
472             profile=profile,
473         )
474         found = False
475         for userdict in entities.get("policy_users", []):
476             if name == userdict.get("user_name"):
477                 found = True
478                 break
479         if not found:
480             policies_to_attach.append(policy)
481     _list = __salt__["boto_iam.list_attached_user_policies"](
482         name, region=region, key=key, keyid=keyid, profile=profile
483     )
484     oldpolicies = [x.get("policy_arn") for x in _list]
485     for policy_data in _list:
486         if (
487             policy_data.get("policy_name") not in managed_policies
488             and policy_data.get("policy_arn") not in managed_policies
489         ):
490             policies_to_detach.append(policy_data.get("policy_arn"))
491     if policies_to_attach or policies_to_detach:
492         _to_modify = list(policies_to_detach)
493         _to_modify.extend(policies_to_attach)
494         if __opts__["test"]:
495             ret["comment"] = "{} policies to be modified on user {}.".format(
496                 ", ".join(_to_modify), name
497             )
498             ret["result"] = None
499             return ret
500         ret["changes"]["old"] = {"managed_policies": oldpolicies}
501         for policy_name in policies_to_attach:
502             policy_set = __salt__["boto_iam.attach_user_policy"](
503                 policy_name, name, region=region, key=key, keyid=keyid, profile=profile
504             )
505             if not policy_set:
506                 _list = __salt__["boto_iam.list_attached_user_policies"](
507                     name, region=region, key=key, keyid=keyid, profile=profile
508                 )
509                 newpolicies = [x.get("policy_arn") for x in _list]
510                 ret["changes"]["new"] = {"managed_policies": newpolicies}
511                 ret["result"] = False
512                 ret["comment"] = "Failed to add policy {} to user {}".format(
513                     policy_name, name
514                 )
515                 return ret
516         for policy_name in policies_to_detach:
517             policy_unset = __salt__["boto_iam.detach_user_policy"](
518                 policy_name, name, region=region, key=key, keyid=keyid, profile=profile
519             )
520             if not policy_unset:
521                 _list = __salt__["boto_iam.list_attached_user_policies"](
522                     name, region=region, key=key, keyid=keyid, profile=profile
523                 )
524                 newpolicies = [x.get("policy_arn") for x in _list]
525                 ret["changes"]["new"] = {"managed_policies": newpolicies}
526                 ret["result"] = False
527                 ret["comment"] = "Failed to remove policy {} from user {}".format(
528                     policy_name, name
529                 )
530                 return ret
531         _list = __salt__["boto_iam.list_attached_user_policies"](
532             name, region=region, key=key, keyid=keyid, profile=profile
533         )
534         newpolicies = [x.get("policy_arn") for x in _list]
535         log.debug(newpolicies)
536         ret["changes"]["new"] = {"managed_policies": newpolicies}
537         ret["comment"] = "{} policies modified on user {}.".format(
538             ", ".join(newpolicies), name
539         )
540 <a name="8"></a>    return ret
541 def _user_policies_detached(name, region<font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=None, key=None, keyid=None, profile=None):
542     ret = {"result": True, "comment": "", "changes": {}}
543     _list = __salt__["boto_iam.list_attached_user_policies"](
544         user_name=name, region=region, key=key, keyid=keyid, profile=profile
545     )
546     oldpolicies =</b></font> [x.get("policy_arn") for x in _list]
547     if not _list:
548         ret["comment"] = "No attached policies in user {}.".format(name)
549         return ret
550     if __opts__["test"]:
551         ret["comment"] = "{} policies to be detached from user {}.".format(
552             ", ".join(oldpolicies), name
553         )
554         ret["result"] = None
555         return ret
556     ret["changes"]["old"] = {"managed_policies": oldpolicies}
557     for policy_arn in oldpolicies:
558         policy_unset = __salt__["boto_iam.detach_user_policy"](
559             policy_arn, name, region=region, key=key, keyid=keyid, profile=profile
560         )
561         if not policy_unset:
562             _list = __salt__["boto_iam.list_attached_user_policies"](
563                 name, region=region, key=key, keyid=keyid, profile=profile
564             )
565             newpolicies = [x.get("policy_arn") for x in _list]
566             ret["changes"]["new"] = {"managed_policies": newpolicies}
567             ret["result"] = False
568             ret["comment"] = "Failed to detach {} from user {}".format(policy_arn, name)
569             return ret
570     _list = __salt__["boto_iam.list_attached_user_policies"](
571         name, region=region, key=key, keyid=keyid, profile=profile
572     )
573     newpolicies = [x.get("policy_arn") for x in _list]
574     ret["changes"]["new"] = {"managed_policies": newpolicies}
575     ret["comment"] = "{} policies detached from user {}.".format(
576         ", ".join(oldpolicies), name
577     )
578 <a name="4"></a>    return ret
579 def _user_policies_deleted(name, region<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=None, key=None, keyid=None, profile=None):
580     ret = {"result": True, "comment": "", "changes": {}}
581     oldpolicies = __salt__["boto_iam.get_all_user_policies"](
582         user_name=name, region=region, key=key, keyid=keyid, profile=profile
583     )
584     if not oldpolicies:
585         ret["comment"] = "No inline policies in user {}.".</b></font>format(name)
586         return ret
587     if __opts__["test"]:
588         ret["comment"] = "{} policies to be deleted from user {}.".format(
589             ", ".join(oldpolicies), name
590         )
591         ret["result"] = None
592         return ret
593     ret["changes"]["old"] = {"inline_policies": oldpolicies}
594     for policy_name in oldpolicies:
595         policy_deleted = __salt__["boto_iam.delete_user_policy"](
596             name, policy_name, region=region, key=key, keyid=keyid, profile=profile
597         )
598         if not policy_deleted:
599             newpolicies = __salt__["boto_iam.get_all_user_policies"](
600                 name, region=region, key=key, keyid=keyid, profile=profile
601             )
602             ret["changes"]["new"] = {"inline_policies": newpolicies}
603             ret["result"] = False
604             ret["comment"] = "Failed to detach {} from user {}".format(
605                 policy_name, name
606             )
607             return ret
608     newpolicies = __salt__["boto_iam.get_all_user_policies"](
609         name, region=region, key=key, keyid=keyid, profile=profile
610     )
611     ret["changes"]["new"] = {"inline_policies": newpolicies}
612     ret["comment"] = "{} policies deleted from user {}.".format(
613         ", ".join(oldpolicies), name
614     )
615     return ret
616 def _case_password(
617     ret, name, password, region=None, key=None, keyid=None, profile=None
618 ):
619     if __opts__["test"]:
620         ret["comment"] = "Login policy for {} is set to be changed.".format(name)
621         ret["result"] = None
622         return ret
623     login = __salt__["boto_iam.create_login_profile"](
624         name, password, region, key, keyid, profile
625     )
626     log.debug("Login is : %s.", login)
627     if login:
628         if "Conflict" in login:
629             ret["comment"] = " ".join(
630                 [ret["comment"], "Login profile for user {} exists.".format(name)]
631             )
632         else:
633             ret["comment"] = " ".join(
634                 [ret["comment"], "Password has been added to User {}.".format(name)]
635             )
636             ret["changes"]["password"] = "REDACTED"
637     else:
638         ret["result"] = False
639         ret["comment"] = " ".join(
640             [
641                 ret["comment"],
642                 "Password for user {} could not be set.\nPlease check your password"
643                 " policy.".format(name),
644             ]
645         )
646     return ret
647 def group_absent(name, region=None, key=None, keyid=None, profile=None):
648     ret = {"name": name, "result": True, "comment": "", "changes": {}}
649     if not __salt__["boto_iam.get_group"](name, region, key, keyid, profile):
650         ret["result"] = True
651         ret["comment"] = "IAM Group {} does not exist.".format(name)
652         return ret
653     if __opts__["test"]:
654         ret["comment"] = " ".join(
655             [
656                 ret["comment"],
657                 "IAM group {} managed policies are set to be detached.".format(name),
658             ]
659         )
660         ret["result"] = None
661     else:
662         _ret = _group_policies_detached(name, region, key, keyid, profile)
663         ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
664         if not _ret["result"]:
665             ret["result"] = _ret["result"]
666             if ret["result"] is False:
667                 return ret
668     if __opts__["test"]:
669         ret["comment"] = " ".join(
670             [
671                 ret["comment"],
672                 "IAM group {} inline policies are set to be deleted.".format(name),
673             ]
674         )
675         ret["result"] = None
676     else:
677         _ret = _group_policies_deleted(name, region, key, keyid, profile)
678         ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
679         if not _ret["result"]:
680             ret["result"] = _ret["result"]
681             if ret["result"] is False:
682                 return ret
683     ret["comment"] = " ".join(
684         [ret["comment"], "IAM group {} users are set to be removed.".format(name)]
685     )
686     existing_users = __salt__["boto_iam.get_group_members"](
687         group_name=name, region=region, key=key, keyid=keyid, profile=profile
688     )
689     _ret = _case_group(ret, [], name, existing_users, region, key, keyid, profile)
690     ret["changes"] = dictupdate.update(ret["changes"], _ret["changes"])
691     ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
692     if not _ret["result"]:
693         ret["result"] = _ret["result"]
694         return ret
695     if __opts__["test"]:
696         ret["comment"] = " ".join(
697             [ret["comment"], "IAM group {} is set to be deleted.".format(name)]
698         )
699         ret["result"] = None
700         return ret
701     deleted = __salt__["boto_iam.delete_group"](name, region, key, keyid, profile)
702     if deleted is True:
703         ret["comment"] = " ".join(
704             [ret["comment"], "IAM group {} is deleted.".format(name)]
705         )
706         ret["result"] = True
707         ret["changes"]["deleted"] = name
708         return ret
709     ret["comment"] = "IAM group {} could not be deleted.\n {}".format(name, deleted)
710     ret["result"] = False
711     return ret
712 def group_present(
713     name,
714     policies=None,
715     policies_from_pillars=None,
716     managed_policies=None,
717     users=None,
718     path="/",
719     region=None,
720     key=None,
721     keyid=None,
722     profile=None,
723     delete_policies=True,
724 ):
725     ret = {"name": name, "result": True, "comment": "", "changes": {}}
726     if not policies:
727         policies = {}
728     if not policies_from_pillars:
729         policies_from_pillars = []
730     if not managed_policies:
731         managed_policies = []
732     _policies = {}
733     for policy in policies_from_pillars:
734         _policy = __salt__["pillar.get"](policy)
735 <a name="2"></a>        _policies.update(_policy)
736     _policies.update(policies)
737     exists = __salt__["boto_iam.get_group"](
738         group_name<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=name, region=region, key=key, keyid=keyid, profile=profile
739     )
740     if not exists:
741         if __opts__["test"]:
742             ret["comment"] = "IAM group {} is set to be created.".format(name)
743             ret["result"] = None
744             return ret
745         created = __salt__["boto_iam.create_group"](
746             group_name=name,
747             path=path,
748             region=region,
749             key=key,
750             keyid=keyid,
751             profile=</b></font>profile,
752         )
753         if not created:
754             ret["comment"] = "Failed to create IAM group {}.".format(name)
755             ret["result"] = False
756             return ret
757         ret["changes"]["group"] = created
758         ret["comment"] = " ".join(
759             [ret["comment"], "Group {} has been created.".format(name)]
760         )
761     else:
762         ret["comment"] = " ".join([ret["comment"], "Group {} is present.".format(name)])
763     _ret = _group_policies_present(
764         name, _policies, region, key, keyid, profile, delete_policies
765     )
766     ret["changes"] = dictupdate.update(ret["changes"], _ret["changes"])
767     ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
768     if not _ret["result"]:
769         ret["result"] = _ret["result"]
770         return ret
771     _ret = _group_policies_attached(
772         name, managed_policies, region, key, keyid, profile, delete_policies
773     )
774     ret["changes"] = dictupdate.update(ret["changes"], _ret["changes"])
775     ret["comment"] = " ".join([ret["comment"], _ret["comment"]])
776     if not _ret["result"]:
777         ret["result"] = _ret["result"]
778         return ret
779     if users is not None:
780         log.debug("Users are : %s.", users)
781         existing_users = __salt__["boto_iam.get_group_members"](
782             group_name=name, region=region, key=key, keyid=keyid, profile=profile
783         )
784         ret = _case_group(ret, users, name, existing_users, region, key, keyid, profile)
785     return ret
786 def _case_group(ret, users, group_name, existing_users, region, key, keyid, profile):
787     _users = []
788     for user in existing_users:
789         _users.append(user["user_name"])
790     log.debug("upstream users are %s", _users)
791     for user in users:
792         log.debug("users are %s", user)
793         if user in _users:
794             log.debug("user exists")
795             ret["comment"] = " ".join(
796                 [
797                     ret["comment"],
798                     "User {} is already a member of group {}.".format(user, group_name),
799                 ]
800             )
801             continue
802         else:
803             log.debug("user is set to be added %s", user)
804             if __opts__["test"]:
805                 ret["comment"] = "User {} is set to be added to group {}.".format(
806                     user, group_name
807                 )
808                 ret["result"] = None
809             else:
810                 __salt__["boto_iam.add_user_to_group"](
811                     user, group_name, region, key, keyid, profile
812                 )
813                 ret["comment"] = " ".join(
814                     [
815                         ret["comment"],
816                         "User {} has been added to group {}.".format(user, group_name),
817                     ]
818                 )
819                 ret["changes"][user] = group_name
820     for user in _users:
821         if user not in users:
822             if __opts__["test"]:
823                 ret["comment"] = " ".join(
824                     [
825                         ret["comment"],
826                         "User {} is set to be removed from group {}.".format(
827                             user, group_name
828                         ),
829                     ]
830                 )
831                 ret["result"] = None
832             else:
833                 __salt__["boto_iam.remove_user_from_group"](
834                     group_name=group_name,
835                     user_name=user,
836                     region=region,
837                     key=key,
838                     keyid=keyid,
839                     profile=profile,
840                 )
841                 ret["comment"] = " ".join(
842                     [
843                         ret["comment"],
844                         "User {} has been removed from group {}.".format(
845                             user, group_name
846                         ),
847                     ]
848                 )
849                 ret["changes"][user] = "Removed from group {}.".format(group_name)
850     return ret
851 def _group_policies_present(
852     name,
853     policies=None,
854     region=None,
855     key=None,
856     keyid=None,
857     profile=None,
858     delete_policies=True,
859 ):
860     ret = {"result": True, "comment": "", "changes": {}}
861     policies_to_create = {}
862     policies_to_delete = []
863     for policy_name, policy in policies.items():
864         if isinstance(policy, str):
865             dict_policy = salt.utils.json.loads(
866                 policy, object_pairs_hook=odict.OrderedDict
867             )
868         else:
869             dict_policy = policy
870         _policy = __salt__["boto_iam.get_group_policy"](
871             name, policy_name, region, key, keyid, profile
872         )
873         if _policy != dict_policy:
874             log.debug("Policy mismatch:\n%s\n%s", _policy, dict_policy)
875             policies_to_create[policy_name] = policy
876     _list = __salt__["boto_iam.get_all_group_policies"](
877         name, region, key, keyid, profile
878     )
879     for policy_name in _list:
880         if delete_policies and policy_name not in policies:
881             policies_to_delete.append(policy_name)
882     if policies_to_create or policies_to_delete:
883         _to_modify = list(policies_to_delete)
884         _to_modify.extend(policies_to_create)
885         if __opts__["test"]:
886             ret["comment"] = "{} policies to be modified on group {}.".format(
887                 ", ".join(_to_modify), name
888             )
889             ret["result"] = None
890 <a name="7"></a>            return ret
891         ret["changes"]["old"] = {"policies": _list}
892         for policy_name, policy in policies_to_create.items():
893             policy_set <font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= __salt__["boto_iam.put_group_policy"](
894                 name, policy_name, policy, region, key, keyid, profile
895             )
896             if not policy_set:
897                 _list = __salt__["boto_iam.get_all_group_policies"](
898                     name, region, key, keyid, profile
899                 )
900                 ret["changes"]["new"] = {"policies": _list}
901                 ret["result"] = False
902                 ret["comment"] = "Failed to add policy {} to group {}".</b></font>format(
903                     policy_name, name
904                 )
905                 return ret
906         for policy_name in policies_to_delete:
907             policy_unset = __salt__["boto_iam.delete_group_policy"](
908                 name, policy_name, region, key, keyid, profile
909             )
910             if not policy_unset:
911                 _list = __salt__["boto_iam.get_all_group_policies"](
912                     name, region, key, keyid, profile
913                 )
914                 ret["changes"]["new"] = {"policies": _list}
915                 ret["result"] = False
916                 ret["comment"] = "Failed to add policy {} to group {}".format(
917                     policy_name, name
918                 )
919                 return ret
920         _list = __salt__["boto_iam.get_all_group_policies"](
921             name, region, key, keyid, profile
922 <a name="9"></a>        )
923         ret["changes"]["new"] = {"policies": _list}
924         ret["comment"] = "{} policies modified on group {}.".format(
925             ", "<font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.join(_list), name
926         )
927     return ret
928 def _group_policies_attached(
929     name,
930     managed_policies=None,
931     region=None,
932     key=None,
933     keyid=None,
934     profile=None,
935     detach_policies=True,
936 ):
937     ret =</b></font> {"result": True, "comment": "", "changes": {}}
938     policies_to_attach = []
939     policies_to_detach = []
940     for policy in managed_policies or []:
941         entities = __salt__["boto_iam.list_entities_for_policy"](
942             policy,
943             entity_filter="Group",
944             region=region,
945             key=key,
946             keyid=keyid,
947             profile=profile,
948         )
949         found = False
950         for groupdict in entities.get("policy_groups", []):
951             if name == groupdict.get("group_name"):
952                 found = True
953                 break
954         if not found:
955             policies_to_attach.append(policy)
956     _list = __salt__["boto_iam.list_attached_group_policies"](
957         name, region=region, key=key, keyid=keyid, profile=profile
958     )
959     oldpolicies = [x.get("policy_arn") for x in _list]
960     for policy_data in _list:
961         if (
962             detach_policies
963             and policy_data.get("policy_name") not in managed_policies
964             and policy_data.get("policy_arn") not in managed_policies
965         ):
966             policies_to_detach.append(policy_data.get("policy_arn"))
967     if policies_to_attach or policies_to_detach:
968         _to_modify = list(policies_to_detach)
969         _to_modify.extend(policies_to_attach)
970         if __opts__["test"]:
971             ret["comment"] = "{} policies to be modified on group {}.".format(
972                 ", ".join(_to_modify), name
973             )
974             ret["result"] = None
975             return ret
976         ret["changes"]["old"] = {"managed_policies": oldpolicies}
977         for policy_name in policies_to_attach:
978             policy_set = __salt__["boto_iam.attach_group_policy"](
979                 policy_name, name, region=region, key=key, keyid=keyid, profile=profile
980             )
981             if not policy_set:
982                 _list = __salt__["boto_iam.list_attached_group_policies"](
983                     name, region=region, key=key, keyid=keyid, profile=profile
984                 )
985                 newpolicies = [x.get("policy_arn") for x in _list]
986                 ret["changes"]["new"] = {"managed_policies": newpolicies}
987                 ret["result"] = False
988                 ret["comment"] = "Failed to add policy {} to group {}".format(
989                     policy_name, name
990                 )
991                 return ret
992         for policy_name in policies_to_detach:
993             policy_unset = __salt__["boto_iam.detach_group_policy"](
994                 policy_name, name, region=region, key=key, keyid=keyid, profile=profile
995             )
996             if not policy_unset:
997                 _list = __salt__["boto_iam.list_attached_group_policies"](
998                     name, region=region, key=key, keyid=keyid, profile=profile
999                 )
1000                 newpolicies = [x.get("policy_arn") for x in _list]
1001                 ret["changes"]["new"] = {"managed_policies": newpolicies}
1002                 ret["result"] = False
1003                 ret["comment"] = "Failed to remove policy {} from group {}".format(
1004                     policy_name, name
1005                 )
1006                 return ret
1007         _list = __salt__["boto_iam.list_attached_group_policies"](
1008             name, region=region, key=key, keyid=keyid, profile=profile
1009         )
1010         newpolicies = [x.get("policy_arn") for x in _list]
1011         log.debug(newpolicies)
1012         ret["changes"]["new"] = {"managed_policies": newpolicies}
1013         ret["comment"] = "{} policies modified on group {}.".format(
1014             ", ".join(newpolicies), name
1015         )
1016     return ret
1017 def _group_policies_detached(name, region=None, key=None, keyid=None, profile=None):
1018     ret = {"result": True, "comment": "", "changes": {}}
1019     _list = __salt__["boto_iam.list_attached_group_policies"](
1020         group_name=name, region=region, key=key, keyid=keyid, profile=profile
1021     )
1022     oldpolicies = [x.get("policy_arn") for x in _list]
1023     if not _list:
1024         ret["comment"] = "No attached policies in group {}.".format(name)
1025         return ret
1026     if __opts__["test"]:
1027         ret["comment"] = "{} policies to be detached from group {}.".format(
1028             ", ".join(oldpolicies), name
1029         )
1030         ret["result"] = None
1031         return ret
1032     ret["changes"]["old"] = {"managed_policies": oldpolicies}
1033     for policy_arn in oldpolicies:
1034         policy_unset = __salt__["boto_iam.detach_group_policy"](
1035             policy_arn, name, region=region, key=key, keyid=keyid, profile=profile
1036         )
1037         if not policy_unset:
1038             _list = __salt__["boto_iam.list_attached_group_policies"](
1039                 name, region=region, key=key, keyid=keyid, profile=profile
1040             )
1041             newpolicies = [x.get("policy_arn") for x in _list]
1042             ret["changes"]["new"] = {"managed_policies": newpolicies}
1043             ret["result"] = False
1044             ret["comment"] = "Failed to detach {} from group {}".format(
1045                 policy_arn, name
1046             )
1047             return ret
1048     _list = __salt__["boto_iam.list_attached_group_policies"](
1049         name, region=region, key=key, keyid=keyid, profile=profile
1050     )
1051     newpolicies = [x.get("policy_arn") for x in _list]
1052     ret["changes"]["new"] = {"managed_policies": newpolicies}
1053     ret["comment"] = "{} policies detached from group {}.".format(
1054         ", ".join(newpolicies), name
1055     )
1056     return ret
1057 def _group_policies_deleted(name, region=None, key=None, keyid=None, profile=None):
1058     ret = {"result": True, "comment": "", "changes": {}}
1059     oldpolicies = __salt__["boto_iam.get_all_group_policies"](
1060         group_name=name, region=region, key=key, keyid=keyid, profile=profile
1061     )
1062     if not oldpolicies:
1063         ret["comment"] = "No inline policies in group {}.".format(name)
1064         return ret
1065     if __opts__["test"]:
1066         ret["comment"] = "{} policies to be deleted from group {}.".format(
1067             ", ".join(oldpolicies), name
1068         )
1069         ret["result"] = None
1070         return ret
1071     ret["changes"]["old"] = {"inline_policies": oldpolicies}
1072     for policy_name in oldpolicies:
1073         policy_deleted = __salt__["boto_iam.delete_group_policy"](
1074             name, policy_name, region=region, key=key, keyid=keyid, profile=profile
1075         )
1076         if not policy_deleted:
1077             newpolicies = __salt__["boto_iam.get_all_group_policies"](
1078                 name, region=region, key=key, keyid=keyid, profile=profile
1079             )
1080             ret["changes"]["new"] = {"inline_policies": newpolicies}
1081             ret["result"] = False
1082             ret["comment"] = "Failed to detach {} from group {}".format(
1083                 policy_name, name
1084             )
1085             return ret
1086     newpolicies = __salt__["boto_iam.get_all_group_policies"](
1087         name, region=region, key=key, keyid=keyid, profile=profile
1088     )
1089     ret["changes"]["new"] = {"inline_policies": newpolicies}
1090 <a name="6"></a>    ret["comment"] = "{} policies deleted from group {}.".format(
1091         ", ".join(oldpolicies), name
1092     )
1093     r<font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>eturn ret
1094 def account_policy(
1095     name=None,
1096     allow_users_to_change_password=None,
1097     hard_expiry=None,
1098     max_password_age=None,
1099     minimum_password_length=None,
1100     password_reuse_prevention=None,
1101     require_lowercase_characters=None,
1102     require_numbers=None,
1103     require_symbols=None,
1104     require_uppercase_characters=None,
1105     region=None,
1106     key=None,
1107     keyid=None,
1108     profile=None,
1109 ):
1110     config =</b></font> locals()
1111     ret = {"name": "Account Policy", "result": True, "comment": "", "changes": {}}
1112     info = __salt__["boto_iam.get_account_policy"](region, key, keyid, profile)
1113     if not info:
1114         ret["comment"] = "Account policy is not Enabled."
1115         ret["result"] = False
1116         return ret
1117     for key, value in config.items():
1118         if key in ("region", "key", "keyid", "profile", "name"):
1119             continue
1120         if value is not None and str(info[key]) != str(value).lower():
1121             ret["comment"] = " ".join(
1122                 [
1123                     ret["comment"],
1124                     "Policy value {} has been set to {}.".format(value, info[key]),
1125                 ]
1126             )
1127             ret["changes"][key] = str(value).lower()
1128     if not ret["changes"]:
1129         ret["comment"] = "Account policy is not changed."
1130         return ret
1131     if __opts__["test"]:
1132         ret["comment"] = "Account policy is set to be changed."
1133         ret["result"] = None
1134         return ret
1135     if __salt__["boto_iam.update_account_password_policy"](
1136         allow_users_to_change_password,
1137         hard_expiry,
1138         max_password_age,
1139         minimum_password_length,
1140         password_reuse_prevention,
1141         require_lowercase_characters,
1142         require_numbers,
1143         require_symbols,
1144         require_uppercase_characters,
1145         region,
1146         key,
1147         keyid,
1148         profile,
1149     ):
1150         return ret
1151     ret["comment"] = "Account policy is not changed."
1152     ret["changes"] = {}
1153     ret["result"] = False
1154     return ret
1155 def server_cert_absent(name, region=None, key=None, keyid=None, profile=None):
1156     ret = {"name": name, "result": True, "comment": "", "changes": {}}
1157     exists = __salt__["boto_iam.get_server_certificate"](
1158 <a name="0"></a>        name, region, key, keyid, profile
1159     )
1160     if not exists:
1161         ret<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>["comment"] = "Certificate {} does not exist.".format(name)
1162         return ret
1163     if __opts__["test"]:
1164         ret["comment"] = "Server certificate {} is set to be deleted.".format(name)
1165         ret["result"] = None
1166         return ret
1167     deleted = __salt__["boto_iam.delete_server_cert"](name, region, key, keyid, profile)
1168     if not deleted:
1169         ret["result"] = False
1170         ret["comment"] = "Certificate {} failed to be deleted.".format(name)
1171         return ret
1172     ret[</b></font>"comment"] = "Certificate {} was deleted.".format(name)
1173     ret["changes"] = deleted
1174     return ret
1175 def server_cert_present(
1176     name,
1177     public_key,
1178     private_key,
1179     cert_chain=None,
1180     path=None,
1181     region=None,
1182     key=None,
1183     keyid=None,
1184     profile=None,
1185 ):
1186     ret = {"name": name, "result": True, "comment": "", "changes": {}}
1187     exists = __salt__["boto_iam.get_server_certificate"](
1188         name, region, key, keyid, profile
1189     )
1190     log.debug("Variables are : %s.", locals())
1191     if exists:
1192         ret["comment"] = "Certificate {} exists.".format(name)
1193         return ret
1194     if "salt://" in public_key:
1195         try:
1196             public_key = __salt__["cp.get_file_str"](public_key)
1197         except OSError as e:
1198             log.debug(e)
1199             ret["comment"] = "File {} not found.".format(public_key)
1200             ret["result"] = False
1201             return ret
1202     if "salt://" in private_key:
1203         try:
1204             private_key = __salt__["cp.get_file_str"](private_key)
1205         except OSError as e:
1206             log.debug(e)
1207             ret["comment"] = "File {} not found.".format(private_key)
1208             ret["result"] = False
1209             return ret
1210     if cert_chain is not None and "salt://" in cert_chain:
1211         try:
1212             cert_chain = __salt__["cp.get_file_str"](cert_chain)
1213         except OSError as e:
1214 <a name="3"></a>            log.debug(e)
1215             ret["comment"] = "File {} not found.".format(cert_chain)
1216             ret["result"] = False
1217             <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>return ret
1218     if __opts__["test"]:
1219         ret["comment"] = "Server certificate {} is set to be created.".format(name)
1220         ret["result"] = None
1221         return ret
1222     created = __salt__["boto_iam.upload_server_cert"](
1223         name, public_key, private_key, cert_chain, path, region, key, keyid, profile
1224     )
1225     if created is not False:
1226         ret["comment"] = "Certificate {} was created.".format(name)
1227         ret[</b></font>"changes"] = created
1228         return ret
1229     ret["result"] = False
1230     ret["comment"] = "Certificate {} failed to be created.".format(name)
1231     return ret
1232 def policy_present(
1233 <a name="1"></a>    name,
1234     policy_document,
1235     path=None,
1236     description<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=None,
1237     region=None,
1238     key=None,
1239     keyid=None,
1240     profile=None,
1241 ):
1242     ret = {"name": name, "result": True, "comment": "", "changes": {}}
1243     policy = __salt__["boto_iam.get_policy"](name, region, key, keyid, profile)
1244     if not policy:
1245         if __opts__["test"]:
1246             ret["comment"] = "IAM policy {} is set to be created.".format(name)
1247             ret["result"] = None
1248             return ret
1249         created = __salt__["boto_iam.create_policy"](
1250             name, policy_document, path, description, region, key, keyid, profile
1251         )
1252         if created:
1253             ret["changes"]["policy"] = created
1254             ret[</b></font>"comment"] = " ".join(
1255                 [ret["comment"], "Policy {} has been created.".format(name)]
1256             )
1257         else:
1258             ret["result"] = False
1259             ret["comment"] = "Failed to update policy."
1260             ret["changes"] = {}
1261             return ret
1262     else:
1263         policy = policy.get("policy", {})
1264         ret["comment"] = " ".join(
1265             [ret["comment"], "Policy {} is present.".format(name)]
1266         )
1267         _describe = __salt__["boto_iam.get_policy_version"](
1268             name, policy.get("default_version_id"), region, key, keyid, profile
1269         ).get("policy_version", {})
1270         if isinstance(_describe["document"], str):
1271             describeDict = salt.utils.json.loads(_describe["document"])
1272         else:
1273             describeDict = _describe["document"]
1274         if isinstance(policy_document, str):
1275             policy_document = salt.utils.json.loads(policy_document)
1276         r = salt.utils.data.compare_dicts(describeDict, policy_document)
1277         if bool(r):
1278             if __opts__["test"]:
1279                 ret["comment"] = "Policy {} set to be modified.".format(name)
1280                 ret["result"] = None
1281                 return ret
1282             ret["comment"] = " ".join([ret["comment"], "Policy to be modified"])
1283             policy_document = salt.utils.json.dumps(policy_document)
1284             r = __salt__["boto_iam.create_policy_version"](
1285                 policy_name=name,
1286                 policy_document=policy_document,
1287                 set_as_default=True,
1288                 region=region,
1289                 key=key,
1290                 keyid=keyid,
1291                 profile=profile,
1292             )
1293             if not r.get("created"):
1294                 ret["result"] = False
1295                 ret["comment"] = "Failed to update policy: {}.".format(
1296                     r["error"]["message"]
1297                 )
1298                 ret["changes"] = {}
1299                 return ret
1300             __salt__["boto_iam.delete_policy_version"](
1301                 policy_name=name,
1302                 version_id=policy["default_version_id"],
1303                 region=region,
1304                 key=key,
1305                 keyid=keyid,
1306                 profile=profile,
1307             )
1308             ret["changes"].setdefault("new", {})["document"] = policy_document
1309             ret["changes"].setdefault("old", {})["document"] = _describe["document"]
1310     return ret
1311 def policy_absent(name, region=None, key=None, keyid=None, profile=None):
1312     ret = {"name": name, "result": True, "comment": "", "changes": {}}
1313     r = __salt__["boto_iam.policy_exists"](
1314         name, region=region, key=key, keyid=keyid, profile=profile
1315     )
1316     if not r:
1317         ret["comment"] = "Policy {} does not exist.".format(name)
1318         return ret
1319     if __opts__["test"]:
1320         ret["comment"] = "Policy {} is set to be removed.".format(name)
1321         ret["result"] = None
1322         return ret
1323     versions = __salt__["boto_iam.list_policy_versions"](
1324         name, region=region, key=key, keyid=keyid, profile=profile
1325     )
1326     if versions:
1327         for version in versions:
1328             if version.get("is_default_version", False) in ("true", True):
1329                 continue
1330             r = __salt__["boto_iam.delete_policy_version"](
1331                 name,
1332                 version_id=version.get("version_id"),
1333                 region=region,
1334                 key=key,
1335                 keyid=keyid,
1336                 profile=profile,
1337             )
1338             if not r:
1339                 ret["result"] = False
1340 <a name="5"></a>                ret["comment"] = "Failed to delete policy {}.".format(name)
1341                 return ret
1342     r = __salt__["boto_iam.delete_policy"](
1343         name, region=region, key<font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=key, keyid=keyid, profile=profile
1344     )
1345     if not r:
1346         ret["result"] = False
1347         ret["comment"] = "Failed to delete policy {}.".format(name)
1348         return ret
1349     ret["changes"]["old"] = {"policy": name}
1350     ret[</b></font>"changes"]["new"] = {"policy": None}
1351     ret["comment"] = "Policy {} deleted.".format(name)
1352     return ret
1353 def saml_provider_present(
1354     name, saml_metadata_document, region=None, key=None, keyid=None, profile=None
1355 ):
1356     ret = {"name": name, "result": True, "comment": "", "changes": {}}
1357     if "salt://" in saml_metadata_document:
1358         try:
1359             saml_metadata_document = __salt__["cp.get_file_str"](saml_metadata_document)
1360             ET.fromstring(saml_metadata_document)
1361         except OSError as e:
1362             log.debug(e)
1363             ret[
1364                 "comment"
1365             ] = "SAML document file {} not found or could not be loaded".format(name)
1366             ret["result"] = False
1367             return ret
1368     for provider in __salt__["boto_iam.list_saml_providers"](
1369         region=region, key=key, keyid=keyid, profile=profile
1370     ):
1371         if provider == name:
1372             ret["comment"] = "SAML provider {} is present.".format(name)
1373             return ret
1374     if __opts__["test"]:
1375         ret["comment"] = "SAML provider {} is set to be create.".format(name)
1376         ret["result"] = None
1377         return ret
1378     created = __salt__["boto_iam.create_saml_provider"](
1379         name,
1380         saml_metadata_document,
1381         region=region,
1382         key=key,
1383         keyid=keyid,
1384         profile=profile,
1385     )
1386     if created:
1387         ret["comment"] = "SAML provider {} was created.".format(name)
1388         ret["changes"]["new"] = name
1389         return ret
1390     ret["result"] = False
1391     ret["comment"] = "SAML provider {} failed to be created.".format(name)
1392     return ret
1393 def saml_provider_absent(name, region=None, key=None, keyid=None, profile=None):
1394     ret = {"name": name, "result": True, "comment": "", "changes": {}}
1395     provider = __salt__["boto_iam.list_saml_providers"](
1396         region=region, key=key, keyid=keyid, profile=profile
1397     )
1398     if len(provider) == 0:
1399         ret["comment"] = "SAML provider {} is absent.".format(name)
1400         return ret
1401     if __opts__["test"]:
1402         ret["comment"] = "SAML provider {} is set to be removed.".format(name)
1403         ret["result"] = None
1404         return ret
1405     deleted = __salt__["boto_iam.delete_saml_provider"](
1406         name, region=region, key=key, keyid=keyid, profile=profile
1407     )
1408     if deleted is not False:
1409         ret["comment"] = "SAML provider {} was deleted.".format(name)
1410         ret["changes"]["old"] = name
1411         return ret
1412     ret["result"] = False
1413     ret["comment"] = "SAML provider {} failed to be deleted.".format(name)
1414     return ret
1415 def _get_error(error):
1416     error = "\n".join(error.split("\n")[1:])
1417     error = ET.fromstring(error)
1418     code = error[0][1].text
1419     message = error[0][2].text
1420     return code, message
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
