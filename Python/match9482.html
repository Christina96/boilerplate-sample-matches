<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_deb_apache.py & test_iptables_1.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_deb_apache.py & test_iptables_1.py
      </h3>
      <h1 align="center">
        15.7%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_deb_apache.py (20.46332%)<TH>test_iptables_1.py (12.83293%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match9482-0.html#0',2,'match9482-1.html#0',3)" NAME="0">(285-289)<TD><A HREF="javascript:ZweiFrames('match9482-0.html#0',2,'match9482-1.html#0',3)" NAME="0">(681-685)</A><TD ALIGN=center><FONT COLOR="#ff0000">15</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match9482-0.html#1',2,'match9482-1.html#1',3)" NAME="1">(41-52)<TD><A HREF="javascript:ZweiFrames('match9482-0.html#1',2,'match9482-1.html#1',3)" NAME="1">(21-31)</A><TD ALIGN=center><FONT COLOR="#ee0000">14</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match9482-0.html#2',2,'match9482-1.html#2',3)" NAME="2">(372-376)<TD><A HREF="javascript:ZweiFrames('match9482-0.html#2',2,'match9482-1.html#2',3)" NAME="2">(634-638)</A><TD ALIGN=center><FONT COLOR="#dd0000">13</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match9482-0.html#3',2,'match9482-1.html#3',3)" NAME="3">(356-360)<TD><A HREF="javascript:ZweiFrames('match9482-0.html#3',2,'match9482-1.html#3',3)" NAME="3">(546-559)</A><TD ALIGN=center><FONT COLOR="#dd0000">13</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match9482-0.html#4',2,'match9482-1.html#4',3)" NAME="4">(340-344)<TD><A HREF="javascript:ZweiFrames('match9482-0.html#4',2,'match9482-1.html#4',3)" NAME="4">(523-536)</A><TD ALIGN=center><FONT COLOR="#dd0000">13</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match9482-0.html#5',2,'match9482-1.html#5',3)" NAME="5">(317-321)<TD><A HREF="javascript:ZweiFrames('match9482-0.html#5',2,'match9482-1.html#5',3)" NAME="5">(506-513)</A><TD ALIGN=center><FONT COLOR="#dd0000">13</FONT>
<TR><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match9482-0.html#6',2,'match9482-1.html#6',3)" NAME="6">(301-305)<TD><A HREF="javascript:ZweiFrames('match9482-0.html#6',2,'match9482-1.html#6',3)" NAME="6">(385-393)</A><TD ALIGN=center><FONT COLOR="#dd0000">13</FONT>
<TR><TD BGCOLOR="#38a4a5"><FONT COLOR="#38a4a5">-</FONT><TD><A HREF="javascript:ZweiFrames('match9482-0.html#7',2,'match9482-1.html#7',3)" NAME="7">(64-67)<TD><A HREF="javascript:ZweiFrames('match9482-0.html#7',2,'match9482-1.html#7',3)" NAME="7">(662-665)</A><TD ALIGN=center><FONT COLOR="#cc0000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_deb_apache.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;


import salt.modules.deb_apache as deb_apache
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase


class DebApacheTestCase(TestCase, LoaderModuleMockMixin):
    &quot;&quot;&quot;
    Test cases for salt.modules.deb_apache
    &quot;&quot;&quot;

    def setup_loader_modules(self):
        return {deb_apache: {}}

    # 'check_site_enabled' function tests: 3

    def test_check_site_enabled(self):
        &quot;&quot;&quot;
        Test if the specific Site symlink is enabled.
        &quot;&quot;&quot;
        with patch(&quot;os.path.islink&quot;, MagicMock(return_value=True)):
            self.assertTrue(deb_apache.check_site_enabled(&quot;saltstack.com&quot;))

    def test_check_site_enabled_default(self):
        &quot;&quot;&quot;
        Test if the specific Site symlink is enabled.
        &quot;&quot;&quot;
        with patch(&quot;os.path.islink&quot;, MagicMock(side_effect=[False, True])):
            self.assertTrue(deb_apache.check_site_enabled(&quot;default&quot;))

    def test_check_site_enabled_false(self):
        &quot;&quot;&quot;
<A NAME="1"></A>        Test if the specific Site symlink is enabled.
        &quot;&quot;&quot;
        with patch(&quot;os.path.islink&quot;, MagicMock(return_value=False)):
            self.assertFalse(deb_apache.check_site_enabled(&quot;<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match9482-1.html#1',3,'match9482-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>saltstack.com&quot;))

    # 'a2ensite' function tests: 4

    def test_a2ensite_notfound(self):
        &quot;&quot;&quot;
        Test if it runs a2ensite for the given site.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=1)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2ensite(</B></FONT>&quot;saltstack.com&quot;),
                {
                    &quot;Name&quot;: &quot;Apache2 Enable Site&quot;,
                    &quot;Site&quot;: &quot;saltstack.com&quot;,
                    &quot;Status&quot;: &quot;Site saltstack.com Not found&quot;,
                },
            )

    def test_a2ensite_enabled(self):
<A NAME="7"></A>        &quot;&quot;&quot;
        Test if it runs a2ensite for the given site.
        &quot;&quot;&quot;
        mock <FONT color="#38a4a5"><A HREF="javascript:ZweiFrames('match9482-1.html#7',3,'match9482-top.html#7',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= MagicMock(return_value=0)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2ensite(</B></FONT>&quot;saltstack.com&quot;),
                {
                    &quot;Name&quot;: &quot;Apache2 Enable Site&quot;,
                    &quot;Site&quot;: &quot;saltstack.com&quot;,
                    &quot;Status&quot;: &quot;Site saltstack.com enabled&quot;,
                },
            )

    def test_a2ensite(self):
        &quot;&quot;&quot;
        Test if it runs a2ensite for the given site.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=2)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2ensite(&quot;saltstack.com&quot;),
                {&quot;Name&quot;: &quot;Apache2 Enable Site&quot;, &quot;Site&quot;: &quot;saltstack.com&quot;, &quot;Status&quot;: 2},
            )

    def test_a2ensite_exception(self):
        &quot;&quot;&quot;
        Test if it runs a2ensite for the given site.
        &quot;&quot;&quot;
        mock = MagicMock(side_effect=Exception(&quot;error&quot;))
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(str(deb_apache.a2ensite(&quot;saltstack.com&quot;)), &quot;error&quot;)

    # 'a2dissite' function tests: 4

    def test_a2dissite_notfound(self):
        &quot;&quot;&quot;
        Test if it runs a2dissite for the given site.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=256)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2dissite(&quot;saltstack.com&quot;),
                {
                    &quot;Name&quot;: &quot;Apache2 Disable Site&quot;,
                    &quot;Site&quot;: &quot;saltstack.com&quot;,
                    &quot;Status&quot;: &quot;Site saltstack.com Not found&quot;,
                },
            )

    def test_a2dissite_disabled(self):
        &quot;&quot;&quot;
        Test if it runs a2dissite for the given site.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=0)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2dissite(&quot;saltstack.com&quot;),
                {
                    &quot;Name&quot;: &quot;Apache2 Disable Site&quot;,
                    &quot;Site&quot;: &quot;saltstack.com&quot;,
                    &quot;Status&quot;: &quot;Site saltstack.com disabled&quot;,
                },
            )

    def test_a2dissite(self):
        &quot;&quot;&quot;
        Test if it runs a2dissite for the given site.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=2)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2dissite(&quot;saltstack.com&quot;),
                {&quot;Name&quot;: &quot;Apache2 Disable Site&quot;, &quot;Site&quot;: &quot;saltstack.com&quot;, &quot;Status&quot;: 2},
            )

    def test_a2dissite_exception(self):
        &quot;&quot;&quot;
        Test if it runs a2dissite for the given site.
        &quot;&quot;&quot;
        mock = MagicMock(side_effect=Exception(&quot;error&quot;))
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(str(deb_apache.a2dissite(&quot;saltstack.com&quot;)), &quot;error&quot;)

    # 'check_mod_enabled' function tests: 2

    def test_check_mod_enabled(self):
        &quot;&quot;&quot;
        Test if the specific mod symlink is enabled.
        &quot;&quot;&quot;
        with patch(&quot;os.path.islink&quot;, MagicMock(return_value=True)):
            self.assertTrue(deb_apache.check_mod_enabled(&quot;status.conf&quot;))

    def test_check_mod_enabled_false(self):
        &quot;&quot;&quot;
        Test if the specific mod symlink is enabled.
        &quot;&quot;&quot;
        with patch(&quot;os.path.islink&quot;, MagicMock(return_value=False)):
            self.assertFalse(deb_apache.check_mod_enabled(&quot;status.conf&quot;))

    # 'a2enmod' function tests: 4

    def test_a2enmod_notfound(self):
        &quot;&quot;&quot;
        Test if it runs a2enmod for the given module.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=1)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2enmod(&quot;vhost_alias&quot;),
                {
                    &quot;Name&quot;: &quot;Apache2 Enable Mod&quot;,
                    &quot;Mod&quot;: &quot;vhost_alias&quot;,
                    &quot;Status&quot;: &quot;Mod vhost_alias Not found&quot;,
                },
            )

    def test_a2enmod_enabled(self):
        &quot;&quot;&quot;
        Test if it runs a2enmod for the given module.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=0)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2enmod(&quot;vhost_alias&quot;),
                {
                    &quot;Name&quot;: &quot;Apache2 Enable Mod&quot;,
                    &quot;Mod&quot;: &quot;vhost_alias&quot;,
                    &quot;Status&quot;: &quot;Mod vhost_alias enabled&quot;,
                },
            )

    def test_a2enmod(self):
        &quot;&quot;&quot;
        Test if it runs a2enmod for the given module.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=2)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2enmod(&quot;vhost_alias&quot;),
                {&quot;Name&quot;: &quot;Apache2 Enable Mod&quot;, &quot;Mod&quot;: &quot;vhost_alias&quot;, &quot;Status&quot;: 2},
            )

    def test_a2enmod_exception(self):
        &quot;&quot;&quot;
        Test if it runs a2enmod for the given module.
        &quot;&quot;&quot;
        mock = MagicMock(side_effect=Exception(&quot;error&quot;))
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(str(deb_apache.a2enmod(&quot;vhost_alias&quot;)), &quot;error&quot;)

    # 'a2dismod' function tests: 4

    def test_a2dismod_notfound(self):
        &quot;&quot;&quot;
        Test if it runs a2dismod for the given module.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=256)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2dismod(&quot;vhost_alias&quot;),
                {
                    &quot;Name&quot;: &quot;Apache2 Disable Mod&quot;,
                    &quot;Mod&quot;: &quot;vhost_alias&quot;,
                    &quot;Status&quot;: &quot;Mod vhost_alias Not found&quot;,
                },
            )

    def test_a2dismod_disabled(self):
        &quot;&quot;&quot;
        Test if it runs a2dismod for the given module.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=0)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2dismod(&quot;vhost_alias&quot;),
                {
                    &quot;Name&quot;: &quot;Apache2 Disable Mod&quot;,
                    &quot;Mod&quot;: &quot;vhost_alias&quot;,
                    &quot;Status&quot;: &quot;Mod vhost_alias disabled&quot;,
                },
            )

    def test_a2dismod(self):
        &quot;&quot;&quot;
        Test if it runs a2dismod for the given module.
        &quot;&quot;&quot;
        mock = MagicMock(return_value=2)
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(
                deb_apache.a2dismod(&quot;vhost_alias&quot;),
                {&quot;Name&quot;: &quot;Apache2 Disable Mod&quot;, &quot;Mod&quot;: &quot;vhost_alias&quot;, &quot;Status&quot;: 2},
            )

    def test_a2dismod_exception(self):
        &quot;&quot;&quot;
        Test if it runs a2dismod for the given module.
        &quot;&quot;&quot;
        mock = MagicMock(side_effect=Exception(&quot;error&quot;))
        with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
            self.assertEqual(str(deb_apache.a2dismod(&quot;vhost_alias&quot;)), &quot;error&quot;)

    # 'check_conf_enabled' function tests: 2

    def test_check_conf_enabled(self):
        &quot;&quot;&quot;
        Test if the specific conf symlink is enabled.
        &quot;&quot;&quot;
        with patch(&quot;os.path.islink&quot;, MagicMock(return_value=True)):
            self.assertTrue(deb_apache.check_conf_enabled(&quot;security.conf&quot;))

    def test_check_conf_enabled_false(self):
        &quot;&quot;&quot;
        Test if the specific conf symlink is enabled.
        &quot;&quot;&quot;
        with patch(&quot;os.path.islink&quot;, MagicMock(return_value=False)):
            self.assertFalse(deb_apache.check_conf_enabled(&quot;security.conf&quot;))

    # 'a2enconf' function tests: 4

    def test_a2enconf_notfound(self):
<A NAME="0"></A>        &quot;&quot;&quot;
        Test if it runs a2enconf for the given conf.
        &quot;&quot;&quot;
        with patch<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match9482-1.html#0',3,'match9482-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>(&quot;salt.utils.path.which&quot;, MagicMock(return_value=&quot;a2enconf&quot;)):
            mock = MagicMock(return_value=1)
            with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
                self.assertEqual(
                    deb_apache.a2enconf(</B></FONT>&quot;security&quot;),
                    {
                        &quot;Name&quot;: &quot;Apache2 Enable Conf&quot;,
                        &quot;Conf&quot;: &quot;security&quot;,
                        &quot;Status&quot;: &quot;Conf security Not found&quot;,
                    },
                )

    def test_a2enconf_enabled(self):
<A NAME="6"></A>        &quot;&quot;&quot;
        Test if it runs a2enconf for the given conf.
        &quot;&quot;&quot;
        with patch(&quot;salt.utils.path.which&quot;, MagicMock(return_value<FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match9482-1.html#6',3,'match9482-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>=&quot;a2enconf&quot;)):
            mock = MagicMock(return_value=0)
            with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
                self.assertEqual(
                    deb_apache.a2enconf(</B></FONT>&quot;security&quot;),
                    {
                        &quot;Name&quot;: &quot;Apache2 Enable Conf&quot;,
                        &quot;Conf&quot;: &quot;security&quot;,
                        &quot;Status&quot;: &quot;Conf security enabled&quot;,
                    },
                )

    def test_a2enconf(self):
<A NAME="5"></A>        &quot;&quot;&quot;
        Test if it runs a2enconf for the given conf.
        &quot;&quot;&quot;
        with patch(&quot;salt.utils.path.which&quot;, MagicMock(return_value<FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match9482-1.html#5',3,'match9482-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>=&quot;a2enconf&quot;)):
            mock = MagicMock(return_value=2)
            with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
                self.assertEqual(
                    deb_apache.a2enconf(</B></FONT>&quot;security&quot;),
                    {&quot;Name&quot;: &quot;Apache2 Enable Conf&quot;, &quot;Conf&quot;: &quot;security&quot;, &quot;Status&quot;: 2},
                )

    def test_a2enconf_exception(self):
        &quot;&quot;&quot;
        Test if it runs a2enconf for the given conf.
        &quot;&quot;&quot;
        with patch(&quot;salt.utils.path.which&quot;, MagicMock(return_value=&quot;a2enconf&quot;)):
            mock = MagicMock(side_effect=Exception(&quot;error&quot;))
            with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
                self.assertEqual(str(deb_apache.a2enconf(&quot;security&quot;)), &quot;error&quot;)

    # 'a2disconf' function tests: 4

    def test_a2disconf_notfound(self):
<A NAME="4"></A>        &quot;&quot;&quot;
        Test if it runs a2disconf for the given conf.
        &quot;&quot;&quot;
        with patch(&quot;salt.utils.path.which&quot;, MagicMock(return_value<FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match9482-1.html#4',3,'match9482-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>=&quot;a2disconf&quot;)):
            mock = MagicMock(return_value=256)
            with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
                self.assertEqual(
                    deb_apache.a2disconf(</B></FONT>&quot;security&quot;),
                    {
                        &quot;Name&quot;: &quot;Apache2 Disable Conf&quot;,
                        &quot;Conf&quot;: &quot;security&quot;,
                        &quot;Status&quot;: &quot;Conf security Not found&quot;,
                    },
                )

    def test_a2disconf_disabled(self):
<A NAME="3"></A>        &quot;&quot;&quot;
        Test if it runs a2disconf for the given conf.
        &quot;&quot;&quot;
        with patch(&quot;salt.utils.path.which&quot;, MagicMock(return_value<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match9482-1.html#3',3,'match9482-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>=&quot;a2disconf&quot;)):
            mock = MagicMock(return_value=0)
            with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
                self.assertEqual(
                    deb_apache.a2disconf(</B></FONT>&quot;security&quot;),
                    {
                        &quot;Name&quot;: &quot;Apache2 Disable Conf&quot;,
                        &quot;Conf&quot;: &quot;security&quot;,
                        &quot;Status&quot;: &quot;Conf security disabled&quot;,
                    },
                )

    def test_a2disconf(self):
<A NAME="2"></A>        &quot;&quot;&quot;
        Test if it runs a2disconf for the given conf.
        &quot;&quot;&quot;
        with patch(&quot;salt.utils.path.which&quot;, MagicMock(return_value<FONT color="#980517"><A HREF="javascript:ZweiFrames('match9482-1.html#2',3,'match9482-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>=&quot;a2disconf&quot;)):
            mock = MagicMock(return_value=2)
            with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
                self.assertEqual(
                    deb_apache.a2disconf(</B></FONT>&quot;security&quot;),
                    {&quot;Name&quot;: &quot;Apache2 Disable Conf&quot;, &quot;Conf&quot;: &quot;security&quot;, &quot;Status&quot;: 2},
                )

    def test_a2disconf_exception(self):
        &quot;&quot;&quot;
        Test if it runs a2disconf for the given conf.
        &quot;&quot;&quot;
        with patch(&quot;salt.utils.path.which&quot;, MagicMock(return_value=&quot;a2disconf&quot;)):
            mock = MagicMock(side_effect=Exception(&quot;error&quot;))
            with patch.dict(deb_apache.__salt__, {&quot;cmd.retcode&quot;: mock}):
                self.assertEqual(str(deb_apache.a2disconf(&quot;security&quot;)), &quot;error&quot;)
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_iptables_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;


import textwrap
import uuid

import salt.modules.iptables as iptables
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, mock_open, patch
from tests.support.unit import TestCase


class IptablesTestCase(TestCase, LoaderModuleMockMixin):
    &quot;&quot;&quot;
    Test cases for salt.modules.iptables
<A NAME="1"></A>    &quot;&quot;&quot;

    def setup_loader_modules(self):
        return {i<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match9482-0.html#1',2,'match9482-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ptables: {}}

    # 'version' function tests: 1

    def test_version(self):
        &quot;&quot;&quot;
        Test if it return version from iptables --version
        &quot;&quot;&quot;
        mock = MagicMock(return_value=&quot;iptables v1.4.21&quot;)
        with patch.dict(iptables.__salt__, {&quot;cmd.run_stdout&quot;: mock}):
            self.assertEqual(iptables.version(</B></FONT>), &quot;v1.4.21&quot;)

    # 'build_rule' function tests: 1

    def test_build_rule(self):
        &quot;&quot;&quot;
        Test if it build a well-formatted iptables rule based on kwargs.
        &quot;&quot;&quot;
        with patch.object(iptables, &quot;_has_option&quot;, MagicMock(return_value=True)):
            self.assertEqual(iptables.build_rule(), &quot;&quot;)

            self.assertEqual(
                iptables.build_rule(name=&quot;ignored&quot;, state=&quot;ignored&quot;),
                &quot;&quot;,
                &quot;build_rule should ignore name and state&quot;,
            )

            # Should properly negate bang-prefixed values
            self.assertEqual(iptables.build_rule(**{&quot;if&quot;: &quot;!eth0&quot;}), &quot;! -i eth0&quot;)

            # Should properly negate &quot;not&quot;-prefixed values
            self.assertEqual(iptables.build_rule(**{&quot;if&quot;: &quot;not eth0&quot;}), &quot;! -i eth0&quot;)

            self.assertEqual(
                iptables.build_rule(**{&quot;protocol&quot;: &quot;tcp&quot;, &quot;syn&quot;: &quot;!&quot;}), &quot;-p tcp ! --syn&quot;
            )

            self.assertEqual(
                iptables.build_rule(dports=[80, 443], protocol=&quot;tcp&quot;),
                &quot;-p tcp -m multiport --dports 80,443&quot;,
            )

            self.assertEqual(
                iptables.build_rule(dports=&quot;80,443&quot;, protocol=&quot;tcp&quot;),
                &quot;-p tcp -m multiport --dports 80,443&quot;,
            )

            # Should it really behave this way?
            self.assertEqual(
                iptables.build_rule(dports=[&quot;!80&quot;, 443], protocol=&quot;tcp&quot;),
                &quot;-p tcp -m multiport ! --dports 80,443&quot;,
            )

            self.assertEqual(
                iptables.build_rule(dports=&quot;!80,443&quot;, protocol=&quot;tcp&quot;),
                &quot;-p tcp -m multiport ! --dports 80,443&quot;,
            )

            self.assertEqual(
                iptables.build_rule(sports=[80, 443], protocol=&quot;tcp&quot;),
                &quot;-p tcp -m multiport --sports 80,443&quot;,
            )

            self.assertEqual(
                iptables.build_rule(sports=&quot;80,443&quot;, protocol=&quot;tcp&quot;),
                &quot;-p tcp -m multiport --sports 80,443&quot;,
            )

            self.assertEqual(
                iptables.build_rule(
                    &quot;filter&quot;,
                    &quot;INPUT&quot;,
                    command=&quot;I&quot;,
                    position=&quot;3&quot;,
                    full=True,
                    dports=&quot;protocol&quot;,
                    jump=&quot;ACCEPT&quot;,
                ),
                &quot;Error: protocol must be specified&quot;,
            )

            self.assertEqual(
                iptables.build_rule(
                    &quot;filter&quot;,
                    &quot;INPUT&quot;,
                    command=&quot;I&quot;,
                    position=&quot;3&quot;,
                    full=True,
                    sports=&quot;protocol&quot;,
                    jump=&quot;ACCEPT&quot;,
                ),
                &quot;Error: protocol must be specified&quot;,
            )

            self.assertEqual(
                iptables.build_rule(
                    &quot;&quot;,
                    &quot;INPUT&quot;,
                    command=&quot;I&quot;,
                    position=&quot;3&quot;,
                    full=&quot;True&quot;,
                    match=&quot;state&quot;,
                    jump=&quot;ACCEPT&quot;,
                ),
                &quot;Error: Table needs to be specified&quot;,
            )

            self.assertEqual(
                iptables.build_rule(
                    &quot;filter&quot;,
                    &quot;&quot;,
                    command=&quot;I&quot;,
                    position=&quot;3&quot;,
                    full=&quot;True&quot;,
                    match=&quot;state&quot;,
                    jump=&quot;ACCEPT&quot;,
                ),
                &quot;Error: Chain needs to be specified&quot;,
            )

            self.assertEqual(
                iptables.build_rule(
                    &quot;filter&quot;,
                    &quot;INPUT&quot;,
                    command=&quot;&quot;,
                    position=&quot;3&quot;,
                    full=&quot;True&quot;,
                    match=&quot;state&quot;,
                    jump=&quot;ACCEPT&quot;,
                ),
                &quot;Error: Command needs to be specified&quot;,
            )

            # Test arguments that should appear after the --jump
            self.assertEqual(
                iptables.build_rule(jump=&quot;REDIRECT&quot;, **{&quot;to-port&quot;: 8080}),
                &quot;--jump REDIRECT --to-port 8080&quot;,
            )

            # Should quote arguments with spaces, like log-prefix often has
            self.assertEqual(
                iptables.build_rule(jump=&quot;LOG&quot;, **{&quot;log-prefix&quot;: &quot;long prefix&quot;}),
                '--jump LOG --log-prefix &quot;long prefix&quot;',
            )

            # Should quote arguments with leading or trailing spaces
            self.assertEqual(
                iptables.build_rule(jump=&quot;LOG&quot;, **{&quot;log-prefix&quot;: &quot;spam: &quot;}),
                '--jump LOG --log-prefix &quot;spam: &quot;',
            )

            # Should allow no-arg jump options
            self.assertEqual(
                iptables.build_rule(jump=&quot;CLUSTERIP&quot;, **{&quot;new&quot;: &quot;&quot;}),
                &quot;--jump CLUSTERIP --new&quot;,
            )

            # Should allow no-arg jump options as None
            self.assertEqual(
                iptables.build_rule(jump=&quot;CT&quot;, **{&quot;notrack&quot;: None}),
                &quot;--jump CT --notrack&quot;,
            )

            # should build match-sets with single string
            self.assertEqual(
                iptables.build_rule(**{&quot;match-set&quot;: &quot;src flag1,flag2&quot;}),
                &quot;-m set --match-set src flag1,flag2&quot;,
            )

            # should build match-sets as list
            match_sets = [
                &quot;src1 flag1&quot;,
                &quot;src2 flag2,flag3&quot;,
            ]
            self.assertEqual(
                iptables.build_rule(**{&quot;match-set&quot;: match_sets}),
                &quot;-m set --match-set src1 flag1 -m set --match-set src2 flag2,flag3&quot;,
            )

            # should handle negations for string match-sets
            self.assertEqual(
                iptables.build_rule(**{&quot;match-set&quot;: &quot;!src flag&quot;}),
                &quot;-m set ! --match-set src flag&quot;,
            )

            # should handle negations for list match-sets
            match_sets = [&quot;src1 flag&quot;, &quot;not src2 flag2&quot;]
            self.assertEqual(
                iptables.build_rule(**{&quot;match-set&quot;: match_sets}),
                &quot;-m set --match-set src1 flag -m set ! --match-set src2 flag2&quot;,
            )

            # should allow escaped name
            self.assertEqual(
                iptables.build_rule(**{&quot;match&quot;: &quot;recent&quot;, &quot;name_&quot;: &quot;SSH&quot;}),
                &quot;-m recent --name SSH&quot;,
            )

            # should allow empty arguments
            self.assertEqual(
                iptables.build_rule(**{&quot;match&quot;: &quot;recent&quot;, &quot;update&quot;: None}),
                &quot;-m recent --update&quot;,
            )

            # Should allow the --save jump option to CONNSECMARK
            # self.assertEqual(iptables.build_rule(jump='CONNSECMARK',
            #                                     **{'save': ''}),
            #                 '--jump CONNSECMARK --save ')

            ret = &quot;/sbin/iptables --wait -t salt -I INPUT 3 -m state --jump ACCEPT&quot;
            with patch.object(
                iptables, &quot;_iptables_cmd&quot;, MagicMock(return_value=&quot;/sbin/iptables&quot;)
            ):
                self.assertEqual(
                    iptables.build_rule(
                        &quot;salt&quot;,
                        &quot;INPUT&quot;,
                        command=&quot;I&quot;,
                        position=&quot;3&quot;,
                        full=&quot;True&quot;,
                        match=&quot;state&quot;,
                        jump=&quot;ACCEPT&quot;,
                    ),
                    ret,
                )

    # 'get_saved_rules' function tests: 2

    def test_get_saved_rules(self):
        &quot;&quot;&quot;
        Test if it return a data structure of the rules in the conf file
        &quot;&quot;&quot;
        mock = MagicMock(return_value=False)
        with patch.object(iptables, &quot;_parse_conf&quot;, mock):
            self.assertFalse(iptables.get_saved_rules())
            mock.assert_called_with(conf_file=None, family=&quot;ipv4&quot;)

    def test_get_saved_rules_nilinuxrt(self):
        &quot;&quot;&quot;
        Test get rules on NILinuxRT system
        &quot;&quot;&quot;
        data = {
            &quot;/etc/natinst/share/iptables.conf&quot;: textwrap.dedent(
                &quot;&quot;&quot;\
                # Generated by iptables-save v1.6.2 on Thu Oct  8 12:13:44 2020
                *filter
                :INPUT ACCEPT [2958:584773]
                :FORWARD ACCEPT [0:0]
                :OUTPUT ACCEPT [92:23648]
                -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
                COMMIT
                # Completed on Thu Oct  8 12:13:44 2020
                &quot;&quot;&quot;
            )
        }
        expected_input_rules = [
            {
                &quot;protocol&quot;: [&quot;tcp&quot;],
                &quot;jump&quot;: [&quot;ACCEPT&quot;],
                &quot;match&quot;: [&quot;tcp&quot;],
                &quot;destination_port&quot;: [&quot;80&quot;],
            }
        ]
        file_mock = mock_open(read_data=data)
        with patch.dict(
            iptables.__grains__, {&quot;os_family&quot;: &quot;NILinuxRT&quot;, &quot;os&quot;: &quot;NILinuxRT&quot;}
        ):
            with patch.object(iptables.salt.utils.files, &quot;fopen&quot;, file_mock):
                rules = iptables.get_saved_rules()
                self.assertEqual(
                    expected_input_rules, rules[&quot;filter&quot;][&quot;INPUT&quot;][&quot;rules&quot;]
                )

    # 'get_rules' function tests: 1

    def test_get_rules(self):
        &quot;&quot;&quot;
        Test if it return a data structure of the current, in-memory rules
        &quot;&quot;&quot;
        mock = MagicMock(return_value=False)
        with patch.object(iptables, &quot;_parse_conf&quot;, mock):
            self.assertFalse(iptables.get_rules())
            mock.assert_called_with(in_mem=True, family=&quot;ipv4&quot;)

    # 'get_saved_policy' function tests: 1

    def test_get_saved_policy(self):
        &quot;&quot;&quot;
        Test if it return the current policy for the specified table/chain
        &quot;&quot;&quot;
        self.assertEqual(
            iptables.get_saved_policy(
                table=&quot;filter&quot;, chain=None, conf_file=None, family=&quot;ipv4&quot;
            ),
            &quot;Error: Chain needs to be specified&quot;,
        )

        with patch.object(
            iptables,
            &quot;_parse_conf&quot;,
            MagicMock(return_value={&quot;filter&quot;: {&quot;INPUT&quot;: {&quot;policy&quot;: True}}}),
        ):
            self.assertTrue(
                iptables.get_saved_policy(
                    table=&quot;filter&quot;, chain=&quot;INPUT&quot;, conf_file=None, family=&quot;ipv4&quot;
                )
            )

        with patch.object(
            iptables,
            &quot;_parse_conf&quot;,
            MagicMock(return_value={&quot;filter&quot;: {&quot;INPUT&quot;: {&quot;policy1&quot;: True}}}),
        ):
            self.assertIsNone(
                iptables.get_saved_policy(
                    table=&quot;filter&quot;, chain=&quot;INPUT&quot;, conf_file=None, family=&quot;ipv4&quot;
                )
            )

    # 'get_policy' function tests: 1

    def test_get_policy(self):
        &quot;&quot;&quot;
        Test if it return the current policy for the specified table/chain
        &quot;&quot;&quot;
        self.assertEqual(
            iptables.get_policy(table=&quot;filter&quot;, chain=None, family=&quot;ipv4&quot;),
            &quot;Error: Chain needs to be specified&quot;,
        )

        with patch.object(
            iptables,
            &quot;_parse_conf&quot;,
            MagicMock(return_value={&quot;filter&quot;: {&quot;INPUT&quot;: {&quot;policy&quot;: True}}}),
        ):
            self.assertTrue(
                iptables.get_policy(table=&quot;filter&quot;, chain=&quot;INPUT&quot;, family=&quot;ipv4&quot;)
            )

        with patch.object(
            iptables,
            &quot;_parse_conf&quot;,
            MagicMock(return_value={&quot;filter&quot;: {&quot;INPUT&quot;: {&quot;policy1&quot;: True}}}),
        ):
            self.assertIsNone(
                iptables.get_policy(table=&quot;filter&quot;, chain=&quot;INPUT&quot;, family=&quot;ipv4&quot;)
            )

    # 'set_policy' function tests: 1

    def test_set_policy(self):
        &quot;&quot;&quot;
        Test if it set the current policy for the specified table/chain
        &quot;&quot;&quot;
        with patch.object(iptables, &quot;_has_option&quot;, MagicMock(return_value=True)):
            self.assertEqual(
                iptables.set_policy(
                    table=&quot;filter&quot;, chain=None, policy=None, family=&quot;ipv4&quot;
                ),
                &quot;Error: Chain needs to be specified&quot;,
            )
<A NAME="6"></A>
            self.assertEqual(
                iptables.set_policy(
                    table=&quot;filter&quot;, chain=&quot;INPUT&quot;, policy=None, family<FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match9482-0.html#6',2,'match9482-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>=&quot;ipv4&quot;
                ),
                &quot;Error: Policy needs to be specified&quot;,
            )

            mock = MagicMock(return_value=True)
            with patch.dict(iptables.__salt__, {&quot;cmd.run_stderr&quot;: mock}):
                self.assertTrue(
                    iptables.set_policy(</B></FONT>
                        table=&quot;filter&quot;, chain=&quot;INPUT&quot;, policy=&quot;ACCEPT&quot;, family=&quot;ipv4&quot;
                    )
                )

    # 'save' function tests: 1

    def test_save(self):
        &quot;&quot;&quot;
        Test if it save the current in-memory rules to disk
        &quot;&quot;&quot;
        with patch(&quot;salt.modules.iptables._conf&quot;, MagicMock(return_value=False)), patch(
            &quot;os.path.isdir&quot;, MagicMock(return_value=True)
        ):
            mock = MagicMock(return_value=True)
            with patch.dict(
                iptables.__salt__,
                {
                    &quot;cmd.run_stdout&quot;: mock,
                    &quot;file.write&quot;: mock,
                    &quot;config.option&quot;: MagicMock(return_value=[]),
                },
            ):
                self.assertTrue(iptables.save(filename=&quot;/xyz&quot;, family=&quot;ipv4&quot;))

    # 'check' function tests: 1

    def test_check(self):
        &quot;&quot;&quot;
        Test if it check for the existence of a rule in the table and chain
        &quot;&quot;&quot;
        self.assertEqual(
            iptables.check(table=&quot;filter&quot;, chain=None, rule=None, family=&quot;ipv4&quot;),
            &quot;Error: Chain needs to be specified&quot;,
        )

        self.assertEqual(
            iptables.check(table=&quot;filter&quot;, chain=&quot;INPUT&quot;, rule=None, family=&quot;ipv4&quot;),
            &quot;Error: Rule needs to be specified&quot;,
        )

        mock_rule = &quot;m state --state RELATED,ESTABLISHED -j ACCEPT&quot;
        mock_chain = &quot;INPUT&quot;
        mock_uuid = 31337
        mock_cmd_rule = MagicMock(
            return_value=&quot;-A {}\n-A {}&quot;.format(mock_chain, hex(mock_uuid))
        )
        mock_cmd_nooutput = MagicMock(return_value=&quot;&quot;)
        mock_has = MagicMock(return_value=True)
        mock_not = MagicMock(return_value=False)

        with patch.object(iptables, &quot;_has_option&quot;, mock_not):
            with patch.object(uuid, &quot;getnode&quot;, MagicMock(return_value=mock_uuid)):
                with patch.dict(
                    iptables.__salt__,
                    {&quot;cmd.run_stdout&quot;: mock_cmd_rule, &quot;cmd.run&quot;: mock_cmd_nooutput},
                ):
                    self.assertTrue(
                        iptables.check(
                            table=&quot;filter&quot;,
                            chain=mock_chain,
                            rule=mock_rule,
                            family=&quot;ipv4&quot;,
                        )
                    )

        mock_cmd = MagicMock(return_value=&quot;&quot;)

        with patch.object(iptables, &quot;_has_option&quot;, mock_not):
            with patch.object(uuid, &quot;getnode&quot;, MagicMock(return_value=mock_uuid)):
                with patch.dict(
                    iptables.__salt__,
                    {
                        &quot;cmd.run_stdout&quot;: mock_cmd_nooutput,
                        &quot;cmd.run&quot;: mock_cmd_nooutput,
                    },
                ):
                    self.assertFalse(
                        iptables.check(
                            table=&quot;filter&quot;,
                            chain=mock_chain,
                            rule=mock_rule,
                            family=&quot;ipv4&quot;,
                        )
                    )

        with patch.object(iptables, &quot;_has_option&quot;, mock_has):
            with patch.dict(iptables.__salt__, {&quot;cmd.run_stderr&quot;: mock_cmd}):
                self.assertTrue(
                    iptables.check(
                        table=&quot;filter&quot;, chain=&quot;INPUT&quot;, rule=mock_rule, family=&quot;ipv4&quot;
                    )
                )

        mock_cmd = MagicMock(return_value=&quot;-A 0x4d2&quot;)
        mock_uuid = MagicMock(return_value=1234)

        with patch.object(iptables, &quot;_has_option&quot;, mock_has):
            with patch.object(uuid, &quot;getnode&quot;, mock_uuid):
                with patch.dict(iptables.__salt__, {&quot;cmd.run_stderr&quot;: mock_cmd}):
                    self.assertTrue(
                        iptables.check(
                            table=&quot;filter&quot;, chain=&quot;0x4d2&quot;, rule=mock_rule, family=&quot;ipv4&quot;
                        )
                    )

    # 'check_chain' function tests: 1

    def test_check_chain(self):
        &quot;&quot;&quot;
<A NAME="5"></A>        Test if it check for the existence of a chain in the table
        &quot;&quot;&quot;
        self.assertEqual(
            iptables.check_chain(table=&quot;filter&quot;, chain=None, family<FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match9482-0.html#5',2,'match9482-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>=&quot;ipv4&quot;),
            &quot;Error: Chain needs to be specified&quot;,
        )

        mock_cmd = MagicMock(return_value=&quot;&quot;)
        with patch.dict(iptables.__salt__, {&quot;cmd.run_stdout&quot;: mock_cmd}):
            self.assertFalse(
                iptables.check_chain(</B></FONT>table=&quot;filter&quot;, chain=&quot;INPUT&quot;, family=&quot;ipv4&quot;)
            )

    # 'new_chain' function tests: 1

    def test_new_chain(self):
        &quot;&quot;&quot;
<A NAME="4"></A>        Test if it create new custom chain to the specified table.
        &quot;&quot;&quot;
        self.assertEqual(
            iptables.new_chain(table=&quot;filter&quot;, chain=None, family<FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match9482-0.html#4',2,'match9482-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>=&quot;ipv4&quot;),
            &quot;Error: Chain needs to be specified&quot;,
        )

        mock_cmd = MagicMock(return_value=&quot;&quot;)
        with patch.dict(
            iptables.__salt__,
            {
                &quot;cmd.run_stdout&quot;: mock_cmd,  # called by iptables._has_option
                &quot;cmd.run_stderr&quot;: mock_cmd,
            },
        ):
            self.assertTrue(
                iptables.new_chain(</B></FONT>table=&quot;filter&quot;, chain=&quot;INPUT&quot;, family=&quot;ipv4&quot;)
            )

    # 'delete_chain' function tests: 1

    def test_delete_chain(self):
        &quot;&quot;&quot;
<A NAME="3"></A>        Test if it delete custom chain to the specified table.
        &quot;&quot;&quot;
        self.assertEqual(
            iptables.delete_chain(table=&quot;filter&quot;, chain=None, family<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match9482-0.html#3',2,'match9482-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>=&quot;ipv4&quot;),
            &quot;Error: Chain needs to be specified&quot;,
        )

        mock_cmd = MagicMock(return_value=&quot;&quot;)
        with patch.dict(
            iptables.__salt__,
            {
                &quot;cmd.run_stdout&quot;: mock_cmd,  # called by iptables._has_option
                &quot;cmd.run_stderr&quot;: mock_cmd,
            },
        ):
            self.assertTrue(
                iptables.delete_chain(</B></FONT>table=&quot;filter&quot;, chain=&quot;INPUT&quot;, family=&quot;ipv4&quot;)
            )

    # 'append' function tests: 1

    def test_append(self):
        &quot;&quot;&quot;
        Test if it append a rule to the specified table/chain.
        &quot;&quot;&quot;
        with patch.object(
            iptables, &quot;_has_option&quot;, MagicMock(return_value=True)
        ), patch.object(iptables, &quot;check&quot;, MagicMock(return_value=False)):
            self.assertEqual(
                iptables.append(table=&quot;filter&quot;, chain=None, rule=None, family=&quot;ipv4&quot;),
                &quot;Error: Chain needs to be specified&quot;,
            )

            self.assertEqual(
                iptables.append(
                    table=&quot;filter&quot;, chain=&quot;INPUT&quot;, rule=None, family=&quot;ipv4&quot;
                ),
                &quot;Error: Rule needs to be specified&quot;,
            )

            _rule = &quot;m state --state RELATED,ESTABLISHED -j ACCEPT&quot;
            mock = MagicMock(side_effect=[&quot;&quot;, &quot;SALT&quot;])
            with patch.dict(iptables.__salt__, {&quot;cmd.run_stderr&quot;: mock}):
                self.assertTrue(
                    iptables.append(
                        table=&quot;filter&quot;, chain=&quot;INPUT&quot;, rule=_rule, family=&quot;ipv4&quot;
                    )
                )

                self.assertFalse(
                    iptables.append(
                        table=&quot;filter&quot;, chain=&quot;INPUT&quot;, rule=_rule, family=&quot;ipv4&quot;
                    )
                )

    # 'insert' function tests: 1

    def test_insert(self):
        &quot;&quot;&quot;
        Test if it insert a rule into the specified table/chain,
        at the specified position.
        &quot;&quot;&quot;
        with patch.object(
            iptables, &quot;_has_option&quot;, MagicMock(return_value=True)
        ), patch.object(iptables, &quot;check&quot;, MagicMock(return_value=False)):
            self.assertEqual(
                iptables.insert(
                    table=&quot;filter&quot;, chain=None, position=None, rule=None, family=&quot;ipv4&quot;
                ),
                &quot;Error: Chain needs to be specified&quot;,
            )

            pos_err = &quot;Error: Position needs to be specified or use append (-A)&quot;
            self.assertEqual(
                iptables.insert(
                    table=&quot;filter&quot;,
                    chain=&quot;INPUT&quot;,
                    position=None,
                    rule=None,
                    family=&quot;ipv4&quot;,
                ),
                pos_err,
            )

            self.assertEqual(
                iptables.insert(
                    table=&quot;filter&quot;, chain=&quot;INPUT&quot;, position=3, rule=None, family=&quot;ipv4&quot;
                ),
<A NAME="2"></A>                &quot;Error: Rule needs to be specified&quot;,
            )

            _rule <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match9482-0.html#2',2,'match9482-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= &quot;m state --state RELATED,ESTABLISHED -j ACCEPT&quot;
            mock = MagicMock(return_value=True)
            with patch.dict(iptables.__salt__, {&quot;cmd.run_stderr&quot;: mock}):
                self.assertTrue(
                    iptables.insert(</B></FONT>
                        table=&quot;filter&quot;,
                        chain=&quot;INPUT&quot;,
                        position=3,
                        rule=_rule,
                        family=&quot;ipv4&quot;,
                    )
                )

    # 'delete' function tests: 1

    def test_delete(self):
        &quot;&quot;&quot;
        Test if it delete a rule from the specified table/chain
        &quot;&quot;&quot;
        with patch.object(iptables, &quot;_has_option&quot;, MagicMock(return_value=True)):
            _rule = &quot;m state --state RELATED,ESTABLISHED -j ACCEPT&quot;
            self.assertEqual(
                iptables.delete(
                    table=&quot;filter&quot;, chain=None, position=3, rule=_rule, family=&quot;ipv4&quot;
                ),
<A NAME="7"></A>                &quot;Error: Only specify a position or a rule, not both&quot;,
            )

            mock <FONT color="#38a4a5"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match9482-0.html#7',2,'match9482-top.html#7',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= MagicMock(return_value=True)
            with patch.dict(iptables.__salt__, {&quot;cmd.run_stderr&quot;: mock}):
                self.assertTrue(
                    iptables.delete(</B></FONT>
                        table=&quot;filter&quot;,
                        chain=&quot;INPUT&quot;,
                        position=3,
                        rule=&quot;&quot;,
                        family=&quot;ipv4&quot;,
                    )
                )

    # 'flush' function tests: 1

    def test_flush(self):
        &quot;&quot;&quot;
<A NAME="0"></A>        Test if it flush the chain in the specified table,
        flush all chains in the specified table if not specified chain.
        &quot;&quot;&quot;
        with patch.object<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match9482-0.html#0',2,'match9482-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>(iptables, &quot;_has_option&quot;, MagicMock(return_value=True)):
            mock_cmd = MagicMock(return_value=True)
            with patch.dict(iptables.__salt__, {&quot;cmd.run_stderr&quot;: mock_cmd}):
                self.assertTrue(
                    iptables.flush(</B></FONT>table=&quot;filter&quot;, chain=&quot;INPUT&quot;, family=&quot;ipv4&quot;)
                )
</PRE>
</div>
  </div>
</body>
</html>
