<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_deb_apache.py &amp; test_iptables_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_deb_apache.py &amp; test_iptables_1.py
      </h3>
<h1 align="center">
        15.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_deb_apache.py (20.46332%)<th>test_iptables_1.py (12.83293%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(285-289)<td><a href="#" name="0">(681-685)</a><td align="center"><font color="#ff0000">15</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(41-52)<td><a href="#" name="1">(21-31)</a><td align="center"><font color="#ee0000">14</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(372-376)<td><a href="#" name="2">(634-638)</a><td align="center"><font color="#dd0000">13</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(356-360)<td><a href="#" name="3">(546-559)</a><td align="center"><font color="#dd0000">13</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(340-344)<td><a href="#" name="4">(523-536)</a><td align="center"><font color="#dd0000">13</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(317-321)<td><a href="#" name="5">(506-513)</a><td align="center"><font color="#dd0000">13</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(301-305)<td><a href="#" name="6">(385-393)</a><td align="center"><font color="#dd0000">13</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(64-67)<td><a href="#" name="7">(662-665)</a><td align="center"><font color="#cc0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_deb_apache.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.deb_apache as deb_apache
2 from tests.support.mixins import LoaderModuleMockMixin
3 from tests.support.mock import MagicMock, patch
4 from tests.support.unit import TestCase
5 class DebApacheTestCase(TestCase, LoaderModuleMockMixin):
6     def setup_loader_modules(self):
7         return {deb_apache: {}}
8     def test_check_site_enabled(self):
9         with patch("os.path.islink", MagicMock(return_value=True)):
10             self.assertTrue(deb_apache.check_site_enabled("saltstack.com"))
11     def test_check_site_enabled_default(self):
12         with patch("os.path.islink", MagicMock(side_effect=[False, True])):
13             self.assertTrue(deb_apache.check_site_enabled("default"))
14     def test_check_site_enabled_false(self):
15         with patch("os.path.islink", MagicMock(return_value=False)):
16             self.assertFalse(deb_apache.check_site_enabled("<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>saltstack.com"))
17     def test_a2ensite_notfound(self):
18         mock = MagicMock(return_value=1)
19         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
20             self.assertEqual(
21                 deb_apache.a2ensite(</b></font>"saltstack.com"),
22                 {
23                     "Name": "Apache2 Enable Site",
24                     "Site": "saltstack.com",
25                     "Status": "Site saltstack.com Not found",
26                 },
27             )
28     def test_a2ensite_enabled(self):
29 <a name="7"></a>        """
30         Test if it runs a2ensite for the given site.
31         mock <font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=0)
32         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
33             self.assertEqual(
34                 deb_apache.a2ensite(</b></font>"saltstack.com"),
35                 {
36                     "Name": "Apache2 Enable Site",
37                     "Site": "saltstack.com",
38                     "Status": "Site saltstack.com enabled",
39                 },
40             )
41     def test_a2ensite(self):
42         mock = MagicMock(return_value=2)
43         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
44             self.assertEqual(
45                 deb_apache.a2ensite("saltstack.com"),
46                 {"Name": "Apache2 Enable Site", "Site": "saltstack.com", "Status": 2},
47             )
48     def test_a2ensite_exception(self):
49         mock = MagicMock(side_effect=Exception("error"))
50         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
51             self.assertEqual(str(deb_apache.a2ensite("saltstack.com")), "error")
52     def test_a2dissite_notfound(self):
53         mock = MagicMock(return_value=256)
54         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
55             self.assertEqual(
56                 deb_apache.a2dissite("saltstack.com"),
57                 {
58                     "Name": "Apache2 Disable Site",
59                     "Site": "saltstack.com",
60                     "Status": "Site saltstack.com Not found",
61                 },
62             )
63     def test_a2dissite_disabled(self):
64         mock = MagicMock(return_value=0)
65         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
66             self.assertEqual(
67                 deb_apache.a2dissite("saltstack.com"),
68                 {
69                     "Name": "Apache2 Disable Site",
70                     "Site": "saltstack.com",
71                     "Status": "Site saltstack.com disabled",
72                 },
73             )
74     def test_a2dissite(self):
75         mock = MagicMock(return_value=2)
76         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
77             self.assertEqual(
78                 deb_apache.a2dissite("saltstack.com"),
79                 {"Name": "Apache2 Disable Site", "Site": "saltstack.com", "Status": 2},
80             )
81     def test_a2dissite_exception(self):
82         mock = MagicMock(side_effect=Exception("error"))
83         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
84             self.assertEqual(str(deb_apache.a2dissite("saltstack.com")), "error")
85     def test_check_mod_enabled(self):
86         with patch("os.path.islink", MagicMock(return_value=True)):
87             self.assertTrue(deb_apache.check_mod_enabled("status.conf"))
88     def test_check_mod_enabled_false(self):
89         with patch("os.path.islink", MagicMock(return_value=False)):
90             self.assertFalse(deb_apache.check_mod_enabled("status.conf"))
91     def test_a2enmod_notfound(self):
92         mock = MagicMock(return_value=1)
93         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
94             self.assertEqual(
95                 deb_apache.a2enmod("vhost_alias"),
96                 {
97                     "Name": "Apache2 Enable Mod",
98                     "Mod": "vhost_alias",
99                     "Status": "Mod vhost_alias Not found",
100                 },
101             )
102     def test_a2enmod_enabled(self):
103         mock = MagicMock(return_value=0)
104         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
105             self.assertEqual(
106                 deb_apache.a2enmod("vhost_alias"),
107                 {
108                     "Name": "Apache2 Enable Mod",
109                     "Mod": "vhost_alias",
110                     "Status": "Mod vhost_alias enabled",
111                 },
112             )
113     def test_a2enmod(self):
114         mock = MagicMock(return_value=2)
115         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
116             self.assertEqual(
117                 deb_apache.a2enmod("vhost_alias"),
118                 {"Name": "Apache2 Enable Mod", "Mod": "vhost_alias", "Status": 2},
119             )
120     def test_a2enmod_exception(self):
121         mock = MagicMock(side_effect=Exception("error"))
122         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
123             self.assertEqual(str(deb_apache.a2enmod("vhost_alias")), "error")
124     def test_a2dismod_notfound(self):
125         mock = MagicMock(return_value=256)
126         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
127             self.assertEqual(
128                 deb_apache.a2dismod("vhost_alias"),
129                 {
130                     "Name": "Apache2 Disable Mod",
131                     "Mod": "vhost_alias",
132                     "Status": "Mod vhost_alias Not found",
133                 },
134             )
135     def test_a2dismod_disabled(self):
136         mock = MagicMock(return_value=0)
137         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
138             self.assertEqual(
139                 deb_apache.a2dismod("vhost_alias"),
140                 {
141                     "Name": "Apache2 Disable Mod",
142                     "Mod": "vhost_alias",
143                     "Status": "Mod vhost_alias disabled",
144                 },
145             )
146     def test_a2dismod(self):
147         mock = MagicMock(return_value=2)
148         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
149             self.assertEqual(
150                 deb_apache.a2dismod("vhost_alias"),
151                 {"Name": "Apache2 Disable Mod", "Mod": "vhost_alias", "Status": 2},
152             )
153     def test_a2dismod_exception(self):
154         mock = MagicMock(side_effect=Exception("error"))
155         with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
156             self.assertEqual(str(deb_apache.a2dismod("vhost_alias")), "error")
157     def test_check_conf_enabled(self):
158         with patch("os.path.islink", MagicMock(return_value=True)):
159             self.assertTrue(deb_apache.check_conf_enabled("security.conf"))
160     def test_check_conf_enabled_false(self):
161         with patch("os.path.islink", MagicMock(return_value=False)):
162             self.assertFalse(deb_apache.check_conf_enabled("security.conf"))
163     def test_a2enconf_notfound(self):
164 <a name="0"></a>        """
165         Test if it runs a2enconf for the given conf.
166         with patch<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>("salt.utils.path.which", MagicMock(return_value="a2enconf")):
167             mock = MagicMock(return_value=1)
168             with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
169                 self.assertEqual(
170                     deb_apache.a2enconf(</b></font>"security"),
171                     {
172                         "Name": "Apache2 Enable Conf",
173                         "Conf": "security",
174                         "Status": "Conf security Not found",
175                     },
176                 )
177     def test_a2enconf_enabled(self):
178 <a name="6"></a>        """
179         Test if it runs a2enconf for the given conf.
180         with patch("salt.utils.path.which", MagicMock(return_value<font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="a2enconf")):
181             mock = MagicMock(return_value=0)
182             with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
183                 self.assertEqual(
184                     deb_apache.a2enconf(</b></font>"security"),
185                     {
186                         "Name": "Apache2 Enable Conf",
187                         "Conf": "security",
188                         "Status": "Conf security enabled",
189                     },
190                 )
191     def test_a2enconf(self):
192 <a name="5"></a>        """
193         Test if it runs a2enconf for the given conf.
194         with patch("salt.utils.path.which", MagicMock(return_value<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="a2enconf")):
195             mock = MagicMock(return_value=2)
196             with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
197                 self.assertEqual(
198                     deb_apache.a2enconf(</b></font>"security"),
199                     {"Name": "Apache2 Enable Conf", "Conf": "security", "Status": 2},
200                 )
201     def test_a2enconf_exception(self):
202         with patch("salt.utils.path.which", MagicMock(return_value="a2enconf")):
203             mock = MagicMock(side_effect=Exception("error"))
204             with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
205                 self.assertEqual(str(deb_apache.a2enconf("security")), "error")
206     def test_a2disconf_notfound(self):
207 <a name="4"></a>        """
208         Test if it runs a2disconf for the given conf.
209         with patch("salt.utils.path.which", MagicMock(return_value<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="a2disconf")):
210             mock = MagicMock(return_value=256)
211             with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
212                 self.assertEqual(
213                     deb_apache.a2disconf(</b></font>"security"),
214                     {
215                         "Name": "Apache2 Disable Conf",
216                         "Conf": "security",
217                         "Status": "Conf security Not found",
218                     },
219                 )
220     def test_a2disconf_disabled(self):
221 <a name="3"></a>        """
222         Test if it runs a2disconf for the given conf.
223         with patch("salt.utils.path.which", MagicMock(return_value<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="a2disconf")):
224             mock = MagicMock(return_value=0)
225             with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
226                 self.assertEqual(
227                     deb_apache.a2disconf(</b></font>"security"),
228                     {
229                         "Name": "Apache2 Disable Conf",
230                         "Conf": "security",
231                         "Status": "Conf security disabled",
232                     },
233                 )
234     def test_a2disconf(self):
235 <a name="2"></a>        """
236         Test if it runs a2disconf for the given conf.
237         with patch("salt.utils.path.which", MagicMock(return_value<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="a2disconf")):
238             mock = MagicMock(return_value=2)
239             with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
240                 self.assertEqual(
241                     deb_apache.a2disconf(</b></font>"security"),
242                     {"Name": "Apache2 Disable Conf", "Conf": "security", "Status": 2},
243                 )
244     def test_a2disconf_exception(self):
245         with patch("salt.utils.path.which", MagicMock(return_value="a2disconf")):
246             mock = MagicMock(side_effect=Exception("error"))
247             with patch.dict(deb_apache.__salt__, {"cmd.retcode": mock}):
248                 self.assertEqual(str(deb_apache.a2disconf("security")), "error")
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_iptables_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import textwrap
2 import uuid
3 import salt.modules.iptables as iptables
4 from tests.support.mixins import LoaderModuleMockMixin
5 from tests.support.mock import MagicMock, mock_open, patch
6 from tests.support.unit import TestCase
7 class IptablesTestCase(TestCase, LoaderModuleMockMixin):
8         return {i<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ptables: {}}
9     def test_version(self):
10         mock = MagicMock(return_value="iptables v1.4.21")
11         with patch.dict(iptables.__salt__, {"cmd.run_stdout": mock}):
12             self.assertEqual(iptables.version(</b></font>), "v1.4.21")
13     def test_build_rule(self):
14         with patch.object(iptables, "_has_option", MagicMock(return_value=True)):
15             self.assertEqual(iptables.build_rule(), "")
16             self.assertEqual(
17                 iptables.build_rule(name="ignored", state="ignored"),
18                 "",
19                 "build_rule should ignore name and state",
20             )
21             self.assertEqual(iptables.build_rule(**{"if": "!eth0"}), "! -i eth0")
22             self.assertEqual(iptables.build_rule(**{"if": "not eth0"}), "! -i eth0")
23             self.assertEqual(
24                 iptables.build_rule(**{"protocol": "tcp", "syn": "!"}), "-p tcp ! --syn"
25             )
26             self.assertEqual(
27                 iptables.build_rule(dports=[80, 443], protocol="tcp"),
28                 "-p tcp -m multiport --dports 80,443",
29             )
30             self.assertEqual(
31                 iptables.build_rule(dports="80,443", protocol="tcp"),
32                 "-p tcp -m multiport --dports 80,443",
33             )
34             self.assertEqual(
35                 iptables.build_rule(dports=["!80", 443], protocol="tcp"),
36                 "-p tcp -m multiport ! --dports 80,443",
37             )
38             self.assertEqual(
39                 iptables.build_rule(dports="!80,443", protocol="tcp"),
40                 "-p tcp -m multiport ! --dports 80,443",
41             )
42             self.assertEqual(
43                 iptables.build_rule(sports=[80, 443], protocol="tcp"),
44                 "-p tcp -m multiport --sports 80,443",
45             )
46             self.assertEqual(
47                 iptables.build_rule(sports="80,443", protocol="tcp"),
48                 "-p tcp -m multiport --sports 80,443",
49             )
50             self.assertEqual(
51                 iptables.build_rule(
52                     "filter",
53                     "INPUT",
54                     command="I",
55                     position="3",
56                     full=True,
57                     dports="protocol",
58                     jump="ACCEPT",
59                 ),
60                 "Error: protocol must be specified",
61             )
62             self.assertEqual(
63                 iptables.build_rule(
64                     "filter",
65                     "INPUT",
66                     command="I",
67                     position="3",
68                     full=True,
69                     sports="protocol",
70                     jump="ACCEPT",
71                 ),
72                 "Error: protocol must be specified",
73             )
74             self.assertEqual(
75                 iptables.build_rule(
76                     "",
77                     "INPUT",
78                     command="I",
79                     position="3",
80                     full="True",
81                     match="state",
82                     jump="ACCEPT",
83                 ),
84                 "Error: Table needs to be specified",
85             )
86             self.assertEqual(
87                 iptables.build_rule(
88                     "filter",
89                     "",
90                     command="I",
91                     position="3",
92                     full="True",
93                     match="state",
94                     jump="ACCEPT",
95                 ),
96                 "Error: Chain needs to be specified",
97             )
98             self.assertEqual(
99                 iptables.build_rule(
100                     "filter",
101                     "INPUT",
102                     command="",
103                     position="3",
104                     full="True",
105                     match="state",
106                     jump="ACCEPT",
107                 ),
108                 "Error: Command needs to be specified",
109             )
110             self.assertEqual(
111                 iptables.build_rule(jump="REDIRECT", **{"to-port": 8080}),
112                 "--jump REDIRECT --to-port 8080",
113             )
114             self.assertEqual(
115                 iptables.build_rule(jump="LOG", **{"log-prefix": "long prefix"}),
116                 '--jump LOG --log-prefix "long prefix"',
117             )
118             self.assertEqual(
119                 iptables.build_rule(jump="LOG", **{"log-prefix": "spam: "}),
120                 '--jump LOG --log-prefix "spam: "',
121             )
122             self.assertEqual(
123                 iptables.build_rule(jump="CLUSTERIP", **{"new": ""}),
124                 "--jump CLUSTERIP --new",
125             )
126             self.assertEqual(
127                 iptables.build_rule(jump="CT", **{"notrack": None}),
128                 "--jump CT --notrack",
129             )
130             self.assertEqual(
131                 iptables.build_rule(**{"match-set": "src flag1,flag2"}),
132                 "-m set --match-set src flag1,flag2",
133             )
134             match_sets = [
135                 "src1 flag1",
136                 "src2 flag2,flag3",
137             ]
138             self.assertEqual(
139                 iptables.build_rule(**{"match-set": match_sets}),
140                 "-m set --match-set src1 flag1 -m set --match-set src2 flag2,flag3",
141             )
142             self.assertEqual(
143                 iptables.build_rule(**{"match-set": "!src flag"}),
144                 "-m set ! --match-set src flag",
145             )
146             match_sets = ["src1 flag", "not src2 flag2"]
147             self.assertEqual(
148                 iptables.build_rule(**{"match-set": match_sets}),
149                 "-m set --match-set src1 flag -m set ! --match-set src2 flag2",
150             )
151             self.assertEqual(
152                 iptables.build_rule(**{"match": "recent", "name_": "SSH"}),
153                 "-m recent --name SSH",
154             )
155             self.assertEqual(
156                 iptables.build_rule(**{"match": "recent", "update": None}),
157                 "-m recent --update",
158             )
159             ret = "/sbin/iptables --wait -t salt -I INPUT 3 -m state --jump ACCEPT"
160             with patch.object(
161                 iptables, "_iptables_cmd", MagicMock(return_value="/sbin/iptables")
162             ):
163                 self.assertEqual(
164                     iptables.build_rule(
165                         "salt",
166                         "INPUT",
167                         command="I",
168                         position="3",
169                         full="True",
170                         match="state",
171                         jump="ACCEPT",
172                     ),
173                     ret,
174                 )
175     def test_get_saved_rules(self):
176         mock = MagicMock(return_value=False)
177         with patch.object(iptables, "_parse_conf", mock):
178             self.assertFalse(iptables.get_saved_rules())
179             mock.assert_called_with(conf_file=None, family="ipv4")
180     def test_get_saved_rules_nilinuxrt(self):
181         data = {
182             "/etc/natinst/share/iptables.conf": textwrap.dedent(
183             )
184         }
185         expected_input_rules = [
186             {
187                 "protocol": ["tcp"],
188                 "jump": ["ACCEPT"],
189                 "match": ["tcp"],
190                 "destination_port": ["80"],
191             }
192         ]
193         file_mock = mock_open(read_data=data)
194         with patch.dict(
195             iptables.__grains__, {"os_family": "NILinuxRT", "os": "NILinuxRT"}
196         ):
197             with patch.object(iptables.salt.utils.files, "fopen", file_mock):
198                 rules = iptables.get_saved_rules()
199                 self.assertEqual(
200                     expected_input_rules, rules["filter"]["INPUT"]["rules"]
201                 )
202     def test_get_rules(self):
203         mock = MagicMock(return_value=False)
204         with patch.object(iptables, "_parse_conf", mock):
205             self.assertFalse(iptables.get_rules())
206             mock.assert_called_with(in_mem=True, family="ipv4")
207     def test_get_saved_policy(self):
208         self.assertEqual(
209             iptables.get_saved_policy(
210                 table="filter", chain=None, conf_file=None, family="ipv4"
211             ),
212             "Error: Chain needs to be specified",
213         )
214         with patch.object(
215             iptables,
216             "_parse_conf",
217             MagicMock(return_value={"filter": {"INPUT": {"policy": True}}}),
218         ):
219             self.assertTrue(
220                 iptables.get_saved_policy(
221                     table="filter", chain="INPUT", conf_file=None, family="ipv4"
222                 )
223             )
224         with patch.object(
225             iptables,
226             "_parse_conf",
227             MagicMock(return_value={"filter": {"INPUT": {"policy1": True}}}),
228         ):
229             self.assertIsNone(
230                 iptables.get_saved_policy(
231                     table="filter", chain="INPUT", conf_file=None, family="ipv4"
232                 )
233             )
234     def test_get_policy(self):
235         self.assertEqual(
236             iptables.get_policy(table="filter", chain=None, family="ipv4"),
237             "Error: Chain needs to be specified",
238         )
239         with patch.object(
240             iptables,
241             "_parse_conf",
242             MagicMock(return_value={"filter": {"INPUT": {"policy": True}}}),
243         ):
244             self.assertTrue(
245                 iptables.get_policy(table="filter", chain="INPUT", family="ipv4")
246             )
247         with patch.object(
248             iptables,
249             "_parse_conf",
250             MagicMock(return_value={"filter": {"INPUT": {"policy1": True}}}),
251         ):
252             self.assertIsNone(
253                 iptables.get_policy(table="filter", chain="INPUT", family="ipv4")
254             )
255     def test_set_policy(self):
256         with patch.object(iptables, "_has_option", MagicMock(return_value=True)):
257             self.assertEqual(
258                 iptables.set_policy(
259                     table="filter", chain=None, policy=None, family="ipv4"
260                 ),
261                 "Error: Chain needs to be specified",
262             )
263 <a name="6"></a>
264             self.assertEqual(
265                 iptables.set_policy(
266                     table="filter", chain="INPUT", policy=None, family<font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>="ipv4"
267                 ),
268                 "Error: Policy needs to be specified",
269             )
270             mock = MagicMock(return_value=True)
271             with patch.dict(iptables.__salt__, {"cmd.run_stderr": mock}):
272                 self.assertTrue(
273                     iptables.set_policy(</b></font>
274                         table="filter", chain="INPUT", policy="ACCEPT", family="ipv4"
275                     )
276                 )
277     def test_save(self):
278         with patch("salt.modules.iptables._conf", MagicMock(return_value=False)), patch(
279             "os.path.isdir", MagicMock(return_value=True)
280         ):
281             mock = MagicMock(return_value=True)
282             with patch.dict(
283                 iptables.__salt__,
284                 {
285                     "cmd.run_stdout": mock,
286                     "file.write": mock,
287                     "config.option": MagicMock(return_value=[]),
288                 },
289             ):
290                 self.assertTrue(iptables.save(filename="/xyz", family="ipv4"))
291     def test_check(self):
292         self.assertEqual(
293             iptables.check(table="filter", chain=None, rule=None, family="ipv4"),
294             "Error: Chain needs to be specified",
295         )
296         self.assertEqual(
297             iptables.check(table="filter", chain="INPUT", rule=None, family="ipv4"),
298             "Error: Rule needs to be specified",
299         )
300         mock_rule = "m state --state RELATED,ESTABLISHED -j ACCEPT"
301         mock_chain = "INPUT"
302         mock_uuid = 31337
303         mock_cmd_rule = MagicMock(
304             return_value="-A {}\n-A {}".format(mock_chain, hex(mock_uuid))
305         )
306         mock_cmd_nooutput = MagicMock(return_value="")
307         mock_has = MagicMock(return_value=True)
308         mock_not = MagicMock(return_value=False)
309         with patch.object(iptables, "_has_option", mock_not):
310             with patch.object(uuid, "getnode", MagicMock(return_value=mock_uuid)):
311                 with patch.dict(
312                     iptables.__salt__,
313                     {"cmd.run_stdout": mock_cmd_rule, "cmd.run": mock_cmd_nooutput},
314                 ):
315                     self.assertTrue(
316                         iptables.check(
317                             table="filter",
318                             chain=mock_chain,
319                             rule=mock_rule,
320                             family="ipv4",
321                         )
322                     )
323         mock_cmd = MagicMock(return_value="")
324         with patch.object(iptables, "_has_option", mock_not):
325             with patch.object(uuid, "getnode", MagicMock(return_value=mock_uuid)):
326                 with patch.dict(
327                     iptables.__salt__,
328                     {
329                         "cmd.run_stdout": mock_cmd_nooutput,
330                         "cmd.run": mock_cmd_nooutput,
331                     },
332                 ):
333                     self.assertFalse(
334                         iptables.check(
335                             table="filter",
336                             chain=mock_chain,
337                             rule=mock_rule,
338                             family="ipv4",
339                         )
340                     )
341         with patch.object(iptables, "_has_option", mock_has):
342             with patch.dict(iptables.__salt__, {"cmd.run_stderr": mock_cmd}):
343                 self.assertTrue(
344                     iptables.check(
345                         table="filter", chain="INPUT", rule=mock_rule, family="ipv4"
346                     )
347                 )
348         mock_cmd = MagicMock(return_value="-A 0x4d2")
349         mock_uuid = MagicMock(return_value=1234)
350         with patch.object(iptables, "_has_option", mock_has):
351             with patch.object(uuid, "getnode", mock_uuid):
352                 with patch.dict(iptables.__salt__, {"cmd.run_stderr": mock_cmd}):
353                     self.assertTrue(
354                         iptables.check(
355                             table="filter", chain="0x4d2", rule=mock_rule, family="ipv4"
356                         )
357                     )
358     def test_check_chain(self):
359         self.assertEqual(
360             iptables.check_chain(table="filter", chain=None, family<font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>="ipv4"),
361             "Error: Chain needs to be specified",
362         )
363         mock_cmd = MagicMock(return_value="")
364         with patch.dict(iptables.__salt__, {"cmd.run_stdout": mock_cmd}):
365             self.assertFalse(
366                 iptables.check_chain(</b></font>table="filter", chain="INPUT", family="ipv4")
367             )
368     def test_new_chain(self):
369         self.assertEqual(
370             iptables.new_chain(table="filter", chain=None, family<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>="ipv4"),
371             "Error: Chain needs to be specified",
372         )
373         mock_cmd = MagicMock(return_value="")
374         with patch.dict(
375             iptables.__salt__,
376             {
377                 "cmd.run_stdout": mock_cmd,  # called by iptables._has_option
378                 "cmd.run_stderr": mock_cmd,
379             },
380         ):
381             self.assertTrue(
382                 iptables.new_chain(</b></font>table="filter", chain="INPUT", family="ipv4")
383             )
384     def test_delete_chain(self):
385         self.assertEqual(
386             iptables.delete_chain(table="filter", chain=None, family<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>="ipv4"),
387             "Error: Chain needs to be specified",
388         )
389         mock_cmd = MagicMock(return_value="")
390         with patch.dict(
391             iptables.__salt__,
392             {
393                 "cmd.run_stdout": mock_cmd,  # called by iptables._has_option
394                 "cmd.run_stderr": mock_cmd,
395             },
396         ):
397             self.assertTrue(
398                 iptables.delete_chain(</b></font>table="filter", chain="INPUT", family="ipv4")
399             )
400     def test_append(self):
401         with patch.object(
402             iptables, "_has_option", MagicMock(return_value=True)
403         ), patch.object(iptables, "check", MagicMock(return_value=False)):
404             self.assertEqual(
405                 iptables.append(table="filter", chain=None, rule=None, family="ipv4"),
406                 "Error: Chain needs to be specified",
407             )
408             self.assertEqual(
409                 iptables.append(
410                     table="filter", chain="INPUT", rule=None, family="ipv4"
411                 ),
412                 "Error: Rule needs to be specified",
413             )
414             _rule = "m state --state RELATED,ESTABLISHED -j ACCEPT"
415             mock = MagicMock(side_effect=["", "SALT"])
416             with patch.dict(iptables.__salt__, {"cmd.run_stderr": mock}):
417                 self.assertTrue(
418                     iptables.append(
419                         table="filter", chain="INPUT", rule=_rule, family="ipv4"
420                     )
421                 )
422                 self.assertFalse(
423                     iptables.append(
424                         table="filter", chain="INPUT", rule=_rule, family="ipv4"
425                     )
426                 )
427     def test_insert(self):
428         with patch.object(
429             iptables, "_has_option", MagicMock(return_value=True)
430         ), patch.object(iptables, "check", MagicMock(return_value=False)):
431             self.assertEqual(
432                 iptables.insert(
433                     table="filter", chain=None, position=None, rule=None, family="ipv4"
434                 ),
435                 "Error: Chain needs to be specified",
436             )
437             pos_err = "Error: Position needs to be specified or use append (-A)"
438             self.assertEqual(
439                 iptables.insert(
440                     table="filter",
441                     chain="INPUT",
442                     position=None,
443                     rule=None,
444                     family="ipv4",
445                 ),
446                 pos_err,
447             )
448             self.assertEqual(
449                 iptables.insert(
450                     table="filter", chain="INPUT", position=3, rule=None, family="ipv4"
451                 ),
452 <a name="2"></a>                "Error: Rule needs to be specified",
453             )
454             _rule <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= "m state --state RELATED,ESTABLISHED -j ACCEPT"
455             mock = MagicMock(return_value=True)
456             with patch.dict(iptables.__salt__, {"cmd.run_stderr": mock}):
457                 self.assertTrue(
458                     iptables.insert(</b></font>
459                         table="filter",
460                         chain="INPUT",
461                         position=3,
462                         rule=_rule,
463                         family="ipv4",
464                     )
465                 )
466     def test_delete(self):
467         with patch.object(iptables, "_has_option", MagicMock(return_value=True)):
468             _rule = "m state --state RELATED,ESTABLISHED -j ACCEPT"
469             self.assertEqual(
470                 iptables.delete(
471                     table="filter", chain=None, position=3, rule=_rule, family="ipv4"
472                 ),
473 <a name="7"></a>                "Error: Only specify a position or a rule, not both",
474             )
475             mock <font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(return_value=True)
476             with patch.dict(iptables.__salt__, {"cmd.run_stderr": mock}):
477                 self.assertTrue(
478                     iptables.delete(</b></font>
479                         table="filter",
480                         chain="INPUT",
481                         position=3,
482                         rule="",
483                         family="ipv4",
484                     )
485                 )
486     def test_flush(self):
487         with patch.object<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>(iptables, "_has_option", MagicMock(return_value=True)):
488             mock_cmd = MagicMock(return_value=True)
489             with patch.dict(iptables.__salt__, {"cmd.run_stderr": mock_cmd}):
490                 self.assertTrue(
491                     iptables.flush(</b></font>table="filter", chain="INPUT", family="ipv4")
492                 )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
