<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_state.py &amp; test_ipaddress.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_state.py &amp; test_ipaddress.py
      </h3>
<h1 align="center">
        0.8%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_state.py (3.2994924%)<th>test_ipaddress.py (0.46906006%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(317-363)<td><a href="#" name="0">(959-965)</a><td align="center"><font color="#ff0000">14</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(479-485)<td><a href="#" name="1">(1104-1109)</a><td align="center"><font color="#da0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_state.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import textwrap
4 import threading
5 import time
6 import pytest
7 import salt.loader
8 import salt.utils.atomicfile
9 import salt.utils.files
10 import salt.utils.path
11 import salt.utils.platform
12 import salt.utils.stringutils
13 log = logging.getLogger(__name__)
14 pytestmark = [
15     pytest.mark.windows_whitelisted,
16 ]
17 def test_show_highstate(state, state_testfile_dest_path):
18     high = state.show_highstate()
19     assert isinstance(high, dict)
20     assert str(state_testfile_dest_path) in high
21     assert high[str(state_testfile_dest_path)]["__env__"] == "base"
22 def test_show_lowstate(state):
23     low = state.show_lowstate()
24     assert isinstance(low, list)
25     for entry in low:
26         assert isinstance(entry, dict)
27 def test_show_states(state):
28     states = state.show_states()
29     assert isinstance(states, list)
30     for entry in states:
31         assert isinstance(entry, str)
32     assert states == ["core"]
33 def test_show_states_missing_sls(state, state_tree):
34     top_sls_contents = """
35     base:
36       '*':
37         - core
38         - does-not-exist
39     state.show_sls used to catch a recursive ref
40     with pytest.helpers.temp_file("recurse-fail.sls", sls_contents, state_tree):
41         ret = state.sls("recurse-fail")
42         assert ret.failed
43         assert (
44             'A recursive requisite was found, SLS "recurse-fail" ID "/etc/mysql/my.cnf" ID "mysql"'
45             in ret.errors
46         )
47 RECURSE_SLS_ONE = """
48 snmpd:
49   pkg:
50     - installed
51   service:
52     - running
53     - require:
54       - pkg: snmpd
55     - watch:
56       - file: /etc/snmp/snmpd.conf
57 /etc/snmp/snmpd.conf:
58   file:
59     - managed
60     - source: salt://snmpd/snmpd.conf.jinja
61     - template: jinja
62     - user: root
63     - group: root
64     - mode: "0600"
65     - require:
66       - pkg: snmpd
67 @pytest.mark.parametrize(
68     "sls_contents, expected_in_output",
69     [(RECURSE_SLS_ONE, "snmpd"), (RECURSE_SLS_TWO, "/etc/nagios/nrpe.cfg")],
70     ids=("recurse-scenario-1", "recurse-scenario-2"),
71 )
72 def test_no_recurse(state, state_tree, sls_contents, expected_in_output):
73     with pytest.helpers.temp_file("recurse-ok.sls", sls_contents, state_tree):
74         ret = state.show_sls("recurse-ok")
75         assert expected_in_output in ret
76 def test_running_dictionary_consistency(state):
77     running_dict_fields = {
78         "__id__",
79         "__run_num__",
80         "__sls__",
81         "changes",
82         "comment",
83         "duration",
84         "name",
85         "result",
86         "start_time",
87     }
88     sls = state.single("test.succeed_without_changes", name="gndn")
89     ret_values_set = set(sls.full_return.keys())
90     assert running_dict_fields.issubset(ret_values_set)
91 def test_running_dictionary_key_sls(state, state_tree):
92     sls1 = state.single("test.succeed_with_changes", name="gndn")
93     assert "__sls__" in sls1.full_return
94     assert sls1.full_return["__sls__"] is None
95     sls_contents = """
96     gndn:
97       test.succeed_with_changes
98         sls_key = "cmd_|-count_root_dir_contents_|-ls -a / | wc -l_|-run"
99     else:
100         sls_contents = r"""
101         count_root_dir_contents:
102           cmd.run:
103             - name: 'Get-ChildItem C:\ | Measure-Object | %{$_.Count}'
104             - shell: powershell
105     verify sending a state request to the minion(s)
106     verify checking a state request sent to the minion(s)
107     verify clearing a state request sent to the minion(s)
108     verify running a state request sent to the minion(s)
109     verify not running a state request sent to the minion(s)
110     verify that we catch the following syntax error::
111         /tmp/salttest/issue-1876:
112           file:
113             - managed
114             - source: salt://testfile
115           file.append:
116             - text: foo
117         testfile
118     )
119     with pytest.helpers.temp_file("issue-1876.sls", sls_contents, state_tree):
120         ret = state.sls("issue-1876")
121         assert ret.failed
122         errmsg = (
123             "ID '{}' in SLS 'issue-1876' contains multiple state declarations of the"
124             " same type".format(testfile)
125         )
126         assert errmsg in ret.errors
127 <a name="0"></a>
128 def test_issue_1879_too_simple_contains_check(state, state_tree, tmp_path):
129     testfile <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= tmp_path / "issue-1979.txt"
130     init_sls_contents = """
131     {}:
132       file:
133         - touch
134         testfile
135     )
136     step2_sls_contents = """
137     {}:
138       file.append:
139         - text: |
140             if [ -f /etc/bash_completion ] &amp;&amp; ! shopt -oq posix; then
141                 . /etc/bash_completion
142             fi
143         if [ -z "$debian_chroot" ] &amp;&amp; [ -r /etc/debian_chroot ]; then
144             debian_chroot=$(cat /etc/debian_chroot)
145         fi
146         if [ -f /etc/bash_completion ] &amp;&amp; ! shopt -oq posix; then
147             . /etc/bash_completion
148         fi
149     issue_1879_dir =</b></font> state_tree / "issue-1879"
150     with pytest.helpers.temp_file(
151         "init.sls", init_sls_contents, issue_1879_dir
152     ), pytest.helpers.temp_file(
153         "step-1.sls", step1_sls_contents, issue_1879_dir
154     ), pytest.helpers.temp_file(
155         "step-2.sls", step2_sls_contents, issue_1879_dir
156     ):
157         ret = state.sls("issue-1879")
158         for staterun in ret:
159             assert staterun.result is True
160         ret = state.sls("issue-1879.step-1")
161         for staterun in ret:
162             assert staterun.result is True
163         ret = state.sls("issue-1879.step-2")
164         for staterun in ret:
165             assert staterun.result is True
166         contents = testfile.read_text()
167         assert contents == expected
168         ret = state.sls("issue-1879.step-1")
169         for staterun in ret:
170             assert staterun.result is True
171         ret = state.sls("issue-1879.step-2")
172         for staterun in ret:
173             assert staterun.result is True
174         contents = testfile.read_text()
175         assert contents == expected
176 def test_include(state, state_tree, tmp_path):
177     testfile_path = tmp_path / "testfile"
178     testfile_path.write_text("foo")
179     include_test_path = tmp_path / "include-test.txt"
180     to_include_test_path = tmp_path / "to-include-test.txt"
181     exclude_test_path = tmp_path / "exclude-test.txt"
182     to_include_sls_contents = """
183     {}:
184       file.managed:
185         - source: salt://testfile
186         include_test_path
187     )
188     with pytest.helpers.temp_file(
189         "testfile", "foo", state_tree
190     ), pytest.helpers.temp_file(
191         "to-include-test.sls", to_include_sls_contents, state_tree
192     ), pytest.helpers.temp_file(
193         "include-test.sls", include_sls_contents, state_tree
194     ):
195         ret = state.sls("include-test")
196         for staterun in ret:
197             assert staterun.result is True
198     assert include_test_path.exists()
199     assert to_include_test_path.exists()
200     assert exclude_test_path.exists() is False
201 def test_exclude(state, state_tree, tmp_path):
202     testfile_path = tmp_path / "testfile"
203     testfile_path.write_text("foo")
204     include_test_path = tmp_path / "include-test.txt"
205     to_include_test_path = tmp_path / "to-include-test.txt"
206     exclude_test_path = tmp_path / "exclude-test.txt"
207     to_include_sls_contents = """
208     {}:
209       file.managed:
210         - source: salt://testfile
211         include_test_path
212     )
213     exclude_sls_contents = """
214     exclude:
215       - to-include-test
216     include:
217       - include-test
218     {}:
219       file.managed:
220         - source: salt://testfile
221 <a name="1"></a>    """.format(
222         exclude_test_path
223     )
224     with pytest<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.helpers.temp_file(
225         "testfile", "foo", state_tree
226     ), pytest.helpers.temp_file(
227         "to-include-test.sls", to_include_sls_contents, state_tree
228     ), pytest.helpers.temp_file(
229         "include-test.sls", include_sls_contents, state_tree
230     ), pytest.helpers.temp_file(</b></font>
231         "exclude-test.sls", exclude_sls_contents, state_tree
232     ):
233         ret = state.sls("exclude-test")
234         for staterun in ret:
235             assert staterun.result is True
236     assert include_test_path.exists()
237     assert exclude_test_path.exists()
238     assert to_include_test_path.exists() is False
239 def test_issue_2068_template_str(state, state_tree):
240     template_str_no_dot_sls_contents = """
241     required_state:
242       test:
243         - succeed_without_changes
244     requiring_state:
245       test:
246         - succeed_without_changes
247         - require:
248           - test: required_state
249     with pytest.helpers.temp_file(
250         "issue-2068-no-dot.sls", template_str_no_dot_sls_contents, state_tree
251     ) as template_str_no_dot_path, pytest.helpers.temp_file(
252         "issue-2068.sls", template_str_sls_contents, state_tree
253     ) as template_str_path:
254         ret = state.sls("issue-2068-no-dot")
255         for staterun in ret:
256             assert staterun.result is True
257         template_str_no_dot_contents = template_str_no_dot_path.read_text()
258         ret = state.template_str(template_str_no_dot_contents)
259         for staterun in ret:
260             assert staterun.result is True
261         ret = state.template(str(template_str_no_dot_path))
262         for staterun in ret:
263             assert staterun.result is True
264         ret = state.sls("issue-2068")
265         for staterun in ret:
266             assert staterun.result is True
267         template_str_contents = template_str_path.read_text()
268         ret = state.template_str(template_str_contents)
269         for staterun in ret:
270             assert staterun.result is True
271         ret = state.template(str(template_str_path))
272         for staterun in ret:
273             assert staterun.result is True
274 @pytest.mark.parametrize("item", ("include", "exclude", "extends"))
275 def test_template_str_invalid_items(state, item):
276     TEMPLATE = textwrap.dedent(
277             item
278         )
279     )
280     ret = state.template_str(TEMPLATE.format(item))
281     assert ret.failed
282     errmsg = (
283         "The '{}' declaration found on '&lt;template-str&gt;' is invalid when "
284         "rendering single templates".format(item)
285     )
286     assert errmsg in ret.errors
287 @pytest.mark.skip_on_windows(
288     reason=(
289         "Functional testing this on windows raises unicode errors. "
290         "Tested in tests/pytests/integration/modules/state/test_state.py"
291     )
292 )
293 def test_pydsl(state, state_tree, tmp_path):
294     testfile = tmp_path / "testfile"
295     sls_contents = """
296     state("{}").file("touch")
297     Call sls file with yaml syntax error.
298     Ensure theses errors are detected and presented to the user without
299     stack traces.
300     badlist_2_sls_contents = """
301     B:
302       file.exist:
303         - name: /foo/bar/foobar
304     /foo/bar/foobar:
305       file.exist
306     C:
307       /foo/bar/foobar:
308         file.exist
309     test the retry option on a simple state with defaults
310     ensure comment is as expected
311     ensure state duration is greater than configured the passed (interval * attempts)
312     expected_comment = (
313         'Attempt 1: Returned a result of "False", with the following '
314         'comment: "Specified path /path/to/a/non-existent/file.txt does not exist"'
315     )
316     with pytest.helpers.temp_file("retry.sls", sls_contents, state_tree):
317         ret = state.sls("retry")
318         for state_return in ret:
319             assert state_return.result is False
320             assert expected_comment in state_return.comment
321             assert state_return.full_return["duration"] &gt;= 3
322 def test_retry_option_success(state, state_tree, tmp_path):
323     testfile = tmp_path / "testfile"
324     testfile.touch()
325     sls_contents = """
326     file_test:
327       file.exists:
328         - name: {}
329         - retry:
330             until: True
331             attempts: 5
332             interval: 2
333             splay: 0
334     test a state with the retry option that should return True, eventually
335         testfile1, testfile2
336     )
337     with pytest.helpers.temp_file("retry.sls", sls_contents, state_tree):
338         thread.start()
339         ret = state.sls("retry")
340         for state_return in ret:
341             assert state_return.result is True
342             assert state_return.full_return["duration"] &gt; 4
343             assert "Attempt 5" not in state_return.comment
344 @pytest.mark.slow_test
345 def test_state_non_base_environment(state, state_tree_prod, tmp_path):
346     testfile = tmp_path / "testfile"
347     sls_contents = """
348     {}:
349       file.managed:
350         - content: foo
351     This tests the case where the state being executed has a long ID dec or
352     name and states are being run in parallel. The filenames used for the
353     parallel state cache were previously based on the tag for each chunk,
354     and longer ID decs or name params can cause the cache file to be longer
355     than the operating system's max file name length. To counter this we
356     instead generate a SHA1 hash of the chunk's tag to use as the cache
357     filename. This test will ensure that long tags don't cause caching
358     failures.
359     See https://github.com/saltstack/salt/issues/49738 for more info.
360         short_command, long_command
361     )
362     with pytest.helpers.temp_file("issue-49738.sls", sls_contents, state_tree):
363         ret = state.sls(
364             "issue-49738",
365             __pub_jid="1",  # Because these run in parallel we need a fake JID
366         )
367     comments = sorted(x.comment for x in ret)
368     expected = sorted(
369         'Command "{}" run'.format(x) for x in (short_command, long_command)
370     )
371     assert comments == expected, "{} != {}".format(comments, expected)
372 @pytest.mark.skip_on_darwin(reason="Test is broken on macosx")
373 @pytest.mark.skip_on_windows(
374     reason=(
375         "Functional testing this on windows raises unicode errors. "
376         "Tested in tests/pytests/integration/modules/state/test_state.py"
377     )
378 )
379 def test_state_sls_unicode_characters(state, state_tree):
380     sls_contents = """
381     echo1:
382       cmd.run:
383         - name: "echo 'This is Ã† test!'"
384     This tests the case where the state file is named
385     only with integers
386     state_id = "test_|-always-passes_|-always-passes_|-succeed_without_changes"
387     with pytest.helpers.temp_file("12345.sls", sls_contents, state_tree):
388         ret = state.sls("12345")
389         assert state_id in ret
390         for state_return in ret:
391             assert state_return.result is True
392             assert "Success!" in state_return.comment
393         ret = state.sls(mods=12345)
394         assert state_id in ret
395         for state_return in ret:
396             assert state_return.result is True
397             assert "Success!" in state_return.comment
398 def test_state_sls_lazyloader_allows_recursion(state, state_tree):
399     sls_contents = """
400     {% if 'nonexistent_module.function' in salt %}
401     {% do salt.log.warning("Module is available") %}
402     {% endif %}
403     always-passes:
404       test.succeed_without_changes:
405         - name: foo
406     Object that is greater than anything (except itself).
407     Object that is less than anything (except itself).
408         Ensure exception does not display a context by default
409         Wraps unittest.TestCase.assertRaisesRegex
410     objects_with_scoped <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= objects + v6_scoped_objects
411     v4addr2 = ipaddress.IPv4Address(2)
412     v4net2 = ipaddress.IPv4Network(2)
413     v4intf2 = ipaddress.IPv4Interface(2)
414     v6addr2 = ipaddress.IPv6Address(2)
415     v6net2 =</b></font> ipaddress.IPv6Network(2)
416     v6intf2 = ipaddress.IPv6Interface(2)
417     v6addr2_scoped = ipaddress.IPv6Address("::2%scope")
418     v6net2_scoped = ipaddress.IPv6Network("::2%scope")
419     v6intf2_scoped = ipaddress.IPv6Interface("::2%scope")
420     def test_foreign_type_equality(self):
421         other = object()
422         for obj in self.objects_with_scoped:
423             self.assertNotEqual(obj, other)
424             self.assertFalse(obj == other)
425             self.assertEqual(obj.__eq__(other), NotImplemented)
426             self.assertEqual(obj.__ne__(other), NotImplemented)
427     def test_mixed_type_equality(self):
428         for lhs in self.objects:
429             for rhs in self.objects:
430                 if lhs is rhs:
431                     continue
432                 self.assertNotEqual(lhs, rhs)
433     def test_scoped_ipv6_equality(self):
434         for lhs, rhs in zip(self.v6_objects, self.v6_scoped_objects):
435             self.assertNotEqual(lhs, rhs)
436     def test_v4_with_v6_scoped_equality(self):
437         for lhs in self.v4_objects:
438             for rhs in self.v6_scoped_objects:
439                 self.assertNotEqual(lhs, rhs)
440     def test_same_type_equality(self):
441         for obj in self.objects_with_scoped:
442             self.assertEqual(obj, obj)
443             self.assertLessEqual(obj, obj)
444             self.assertGreaterEqual(obj, obj)
445     def test_same_type_ordering(self):
446         for lhs, rhs in (
447             (self.v4addr, self.v4addr2),
448             (self.v4net, self.v4net2),
449             (self.v4intf, self.v4intf2),
450             (self.v6addr, self.v6addr2),
451             (self.v6net, self.v6net2),
452             (self.v6intf, self.v6intf2),
453             (self.v6addr_scoped, self.v6addr2_scoped),
454             (self.v6net_scoped, self.v6net2_scoped),
455             (self.v6intf_scoped, self.v6intf2_scoped),
456         ):
457             self.assertNotEqual(lhs, rhs)
458             self.assertLess(lhs, rhs)
459             self.assertLessEqual(lhs, rhs)
460             self.assertGreater(rhs, lhs)
461             self.assertGreaterEqual(rhs, lhs)
462             self.assertFalse(lhs &gt; rhs)
463             self.assertFalse(rhs &lt; lhs)
464             self.assertFalse(lhs &gt;= rhs)
465             self.assertFalse(rhs &lt;= lhs)
466     def test_containment(self):
467         for obj in self.v4_addresses:
468             self.assertIn(obj, self.v4net)
469         for obj in self.v6_addresses + self.v6_scoped_addresses:
470             self.assertIn(obj, self.v6net)
471         for obj in self.v6_addresses + self.v6_scoped_addresses:
472             self.assertIn(obj, self.v6net_scoped)
473         for obj in self.v4_objects + [self.v6net, self.v6net_scoped]:
474             self.assertNotIn(obj, self.v6net)
475         for obj in self.v4_objects + [self.v6net, self.v6net_scoped]:
476             self.assertNotIn(obj, self.v6net_scoped)
477         for obj in self.v6_objects + self.v6_scoped_objects + [self.v4net]:
478             self.assertNotIn(obj, self.v4net)
479     def test_mixed_type_ordering(self):
480         for lhs in self.objects_with_scoped:
481             for rhs in self.objects_with_scoped:
482                 if isinstance(lhs, type(rhs)) or isinstance(rhs, type(lhs)):
483                     continue
484                 self.assertRaises(TypeError, lambda: lhs &lt; rhs)
485                 self.assertRaises(TypeError, lambda: lhs &gt; rhs)
486                 self.assertRaises(TypeError, lambda: lhs &lt;= rhs)
487                 self.assertRaises(TypeError, lambda: lhs &gt;= rhs)
488     def test_foreign_type_ordering(self):
489         other = object()
490         for obj in self.objects_with_scoped:
491             with self.assertRaises(TypeError):
492                 obj &lt; other
493             with self.assertRaises(TypeError):
494                 obj &gt; other
495             with self.assertRaises(TypeError):
496                 obj &lt;= other
497             with self.assertRaises(TypeError):
498                 obj &gt;= other
499             self.assertTrue(obj &lt; LARGEST)
500             self.assertFalse(obj &gt; LARGEST)
501             self.assertTrue(obj &lt;= LARGEST)
502             self.assertFalse(obj &gt;= LARGEST)
503             self.assertFalse(obj &lt; SMALLEST)
504             self.assertTrue(obj &gt; SMALLEST)
505             self.assertFalse(obj &lt;= SMALLEST)
506             self.assertTrue(obj &gt;= SMALLEST)
507     def test_mixed_type_key(self):
508         v4_ordered = [self.v4addr, self.v4net, self.v4intf]
509         v6_ordered = [self.v6addr, self.v6net, self.v6intf]
510         v6_scoped_ordered = [self.v6addr_scoped, self.v6net_scoped, self.v6intf_scoped]
511         self.assertEqual(
512             v4_ordered, sorted(self.v4_objects, key=ipaddress.get_mixed_type_key)
513         )
514         self.assertEqual(
515             v6_ordered, sorted(self.v6_objects, key=ipaddress.get_mixed_type_key)
516         )
517         self.assertEqual(
518             v6_scoped_ordered,
519             sorted(self.v6_scoped_objects, key=ipaddress.get_mixed_type_key),
520         )
521         self.assertEqual(
522             v4_ordered + v6_scoped_ordered,
523             sorted(
524                 self.v4_objects + self.v6_scoped_objects,
525                 key=ipaddress.get_mixed_type_key,
526             ),
527         )
528         self.assertEqual(NotImplemented, ipaddress.get_mixed_type_key(object))
529     def test_incompatible_versions(self):
530         v4addr = ipaddress.ip_address("1.1.1.1")
531         v4net = ipaddress.ip_network("1.1.1.1")
532         v6addr = ipaddress.ip_address("::1")
533         v6net = ipaddress.ip_network("::1")
534 <a name="1"></a>        v6addr_scoped = ipaddress.ip_address("::1%scope")
535         v6net_scoped = ipaddress.ip_network("::1%scope")
536         self.assertRaises(TypeError, v4addr<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.__lt__, v6addr)
537         self.assertRaises(TypeError, v4addr.__gt__, v6addr)
538         self.assertRaises(TypeError, v4net.__lt__, v6net)
539         self.assertRaises(TypeError, v4net.__gt__, v6net)
540         self.assertRaises(</b></font>TypeError, v6addr.__lt__, v4addr)
541         self.assertRaises(TypeError, v6addr.__gt__, v4addr)
542         self.assertRaises(TypeError, v6net.__lt__, v4net)
543         self.assertRaises(TypeError, v6net.__gt__, v4net)
544         self.assertRaises(TypeError, v4addr.__lt__, v6addr_scoped)
545         self.assertRaises(TypeError, v4addr.__gt__, v6addr_scoped)
546         self.assertRaises(TypeError, v4net.__lt__, v6net_scoped)
547         self.assertRaises(TypeError, v4net.__gt__, v6net_scoped)
548         self.assertRaises(TypeError, v6addr_scoped.__lt__, v4addr)
549         self.assertRaises(TypeError, v6addr_scoped.__gt__, v4addr)
550         self.assertRaises(TypeError, v6net_scoped.__lt__, v4net)
551         self.assertRaises(TypeError, v6net_scoped.__gt__, v4net)
552 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
553 class IpaddrUnitTest(TestCase):
554     def setUp(self):
555         self.ipv4_address = ipaddress.IPv4Address("1.2.3.4")
556         self.ipv4_interface = ipaddress.IPv4Interface("1.2.3.4/24")
557         self.ipv4_network = ipaddress.IPv4Network("1.2.3.0/24")
558         self.ipv6_address = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1")
559         self.ipv6_interface = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1/64")
560         self.ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/64")
561         self.ipv6_scoped_address = ipaddress.IPv6Interface(
562             "2001:658:22a:cafe:200:0:0:1%scope"
563         )
564         self.ipv6_scoped_interface = ipaddress.IPv6Interface(
565             "2001:658:22a:cafe:200:0:0:1%scope/64"
566         )
567         self.ipv6_scoped_network = ipaddress.IPv6Network("2001:658:22a:cafe::%scope/64")
568     def testRepr(self):
569         self.assertEqual(
570             "IPv4Interface('1.2.3.4/32')", repr(ipaddress.IPv4Interface("1.2.3.4"))
571         )
572         self.assertEqual(
573             "IPv6Interface('::1/128')", repr(ipaddress.IPv6Interface("::1"))
574         )
575         self.assertEqual(
576             "IPv6Interface('::1%scope/128')", repr(ipaddress.IPv6Interface("::1%scope"))
577         )
578     def testIPv4Tuple(self):
579         ip = ipaddress.IPv4Address("192.0.2.1")
580         net = ipaddress.IPv4Network("192.0.2.1/32")
581         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", 32)), net)
582         self.assertEqual(ipaddress.IPv4Network((ip, 32)), net)
583         self.assertEqual(ipaddress.IPv4Network((3221225985, 32)), net)
584         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", "255.255.255.255")), net)
585         self.assertEqual(ipaddress.IPv4Network((ip, "255.255.255.255")), net)
586         self.assertEqual(ipaddress.IPv4Network((3221225985, "255.255.255.255")), net)
587         with self.assertRaises(ValueError):
588             ipaddress.IPv4Network(("192.0.2.1", 24))
589         with self.assertRaises(ValueError):
590             ipaddress.IPv4Network((ip, 24))
591         with self.assertRaises(ValueError):
592             ipaddress.IPv4Network((3221225985, 24))
593         with self.assertRaises(ValueError):
594             ipaddress.IPv4Network(("192.0.2.1", "255.255.255.0"))
595         with self.assertRaises(ValueError):
596             ipaddress.IPv4Network((ip, "255.255.255.0"))
597         with self.assertRaises(ValueError):
598             ipaddress.IPv4Network((3221225985, "255.255.255.0"))
599         net = ipaddress.IPv4Network("192.0.2.0/24")
600         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", 24), strict=False), net)
601         self.assertEqual(ipaddress.IPv4Network((ip, 24), strict=False), net)
602         self.assertEqual(ipaddress.IPv4Network((3221225985, 24), strict=False), net)
603         self.assertEqual(
604             ipaddress.IPv4Network(("192.0.2.1", "255.255.255.0"), strict=False), net
605         )
606         self.assertEqual(
607             ipaddress.IPv4Network((ip, "255.255.255.0"), strict=False), net
608         )
609         self.assertEqual(
610             ipaddress.IPv4Network((3221225985, "255.255.255.0"), strict=False), net
611         )
612         ip = ipaddress.IPv4Address("192.0.2.0")
613         net = ipaddress.IPv4Network("192.0.2.0/24")
614         self.assertEqual(ipaddress.IPv4Network(("192.0.2.0", "255.255.255.0")), net)
615         self.assertEqual(ipaddress.IPv4Network((ip, "255.255.255.0")), net)
616         self.assertEqual(ipaddress.IPv4Network((3221225984, "255.255.255.0")), net)
617         self.assertEqual(ipaddress.IPv4Network(("192.0.2.0", 24)), net)
618         self.assertEqual(ipaddress.IPv4Network((ip, 24)), net)
619         self.assertEqual(ipaddress.IPv4Network((3221225984, 24)), net)
620         self.assertEqual(
621             ipaddress.IPv4Interface(("192.0.2.1", 24)),
622             ipaddress.IPv4Interface("192.0.2.1/24"),
623         )
624         self.assertEqual(
625             ipaddress.IPv4Interface((3221225985, 24)),
626             ipaddress.IPv4Interface("192.0.2.1/24"),
627         )
628     def testIPv6Tuple(self):
629         ip = ipaddress.IPv6Address("2001:db8::")
630         net = ipaddress.IPv6Network("2001:db8::/128")
631         self.assertEqual(ipaddress.IPv6Network(("2001:db8::", "128")), net)
632         self.assertEqual(
633             ipaddress.IPv6Network((42540766411282592856903984951653826560, 128)), net
634         )
635         self.assertEqual(ipaddress.IPv6Network((ip, "128")), net)
636         ip = ipaddress.IPv6Address("2001:db8::")
637         net = ipaddress.IPv6Network("2001:db8::/96")
638         self.assertEqual(ipaddress.IPv6Network(("2001:db8::", "96")), net)
639         self.assertEqual(
640             ipaddress.IPv6Network((42540766411282592856903984951653826560, 96)), net
641         )
642         self.assertEqual(ipaddress.IPv6Network((ip, "96")), net)
643         ip_scoped = ipaddress.IPv6Address("2001:db8::%scope")
644         ip = ipaddress.IPv6Address("2001:db8::1")
645         with self.assertRaises(ValueError):
646             ipaddress.IPv6Network(("2001:db8::1", 96))
647         with self.assertRaises(ValueError):
648             ipaddress.IPv6Network((42540766411282592856903984951653826561, 96))
649         with self.assertRaises(ValueError):
650             ipaddress.IPv6Network((ip, 96))
651         net = ipaddress.IPv6Network("2001:db8::/96")
652         self.assertEqual(ipaddress.IPv6Network(("2001:db8::1", 96), strict=False), net)
653         self.assertEqual(
654             ipaddress.IPv6Network(
655                 (42540766411282592856903984951653826561, 96), strict=False
656             ),
657             net,
658         )
659         self.assertEqual(ipaddress.IPv6Network((ip, 96), strict=False), net)
660         self.assertEqual(
661             ipaddress.IPv6Interface(("2001:db8::1", "96")),
662             ipaddress.IPv6Interface("2001:db8::1/96"),
663         )
664         self.assertEqual(
665             ipaddress.IPv6Interface((42540766411282592856903984951653826561, "96")),
666             ipaddress.IPv6Interface("2001:db8::1/96"),
667         )
668         ip_scoped = ipaddress.IPv6Address("2001:db8::1%scope")
669         with self.assertRaises(ValueError):
670             ipaddress.IPv6Network(("2001:db8::1%scope", 96))
671         with self.assertRaises(ValueError):
672             ipaddress.IPv6Network((ip_scoped, 96))
673     def testAddressIntMath(self):
674         self.assertEqual(
675             ipaddress.IPv4Address("1.1.1.1") + 255, ipaddress.IPv4Address("1.1.2.0")
676         )
677         self.assertEqual(
678             ipaddress.IPv4Address("1.1.1.1") - 256, ipaddress.IPv4Address("1.1.0.1")
679         )
680         self.assertEqual(
681             ipaddress.IPv6Address("::1") + (2 ** 16 - 2),
682             ipaddress.IPv6Address("::ffff"),
683         )
684         self.assertEqual(
685             ipaddress.IPv6Address("::ffff") - (2 ** 16 - 2),
686             ipaddress.IPv6Address("::1"),
687         )
688         self.assertNotEqual(
689             ipaddress.IPv6Address("::1%scope") + (2 ** 16 - 2),
690             ipaddress.IPv6Address("::ffff%scope"),
691         )
692         self.assertNotEqual(
693             ipaddress.IPv6Address("::ffff%scope") - (2 ** 16 - 2),
694             ipaddress.IPv6Address("::1%scope"),
695         )
696     def testInvalidIntToBytes(self):
697         self.assertRaises(ValueError, ipaddress.v4_int_to_packed, -1)
698         self.assertRaises(
699             ValueError, ipaddress.v4_int_to_packed, 2 ** ipaddress.IPV4LENGTH
700         )
701         self.assertRaises(ValueError, ipaddress.v6_int_to_packed, -1)
702         self.assertRaises(
703             ValueError, ipaddress.v6_int_to_packed, 2 ** ipaddress.IPV6LENGTH
704         )
705     def testInternals(self):
706         ip1 = ipaddress.IPv4Address("10.10.10.10")
707         ip2 = ipaddress.IPv4Address("10.10.10.11")
708         ip3 = ipaddress.IPv4Address("10.10.10.12")
709         self.assertEqual(list(ipaddress._find_address_range([ip1])), [(ip1, ip1)])
710         self.assertEqual(
711             list(ipaddress._find_address_range([ip1, ip3])), [(ip1, ip1), (ip3, ip3)]
712         )
713         self.assertEqual(
714             list(ipaddress._find_address_range([ip1, ip2, ip3])), [(ip1, ip3)]
715         )
716         self.assertEqual(128, ipaddress._count_righthand_zero_bits(0, 128))
717         self.assertEqual("IPv4Network('1.2.3.0/24')", repr(self.ipv4_network))
718     def testGetNetwork(self):
719         self.assertEqual(int(self.ipv4_network.network_address), 16909056)
720         self.assertEqual(str(self.ipv4_network.network_address), "1.2.3.0")
721         self.assertEqual(
722             int(self.ipv6_network.network_address),
723             42540616829182469433403647294022090752,
724         )
725         self.assertEqual(str(self.ipv6_network.network_address), "2001:658:22a:cafe::")
726         self.assertEqual(str(self.ipv6_network.hostmask), "::ffff:ffff:ffff:ffff")
727         self.assertEqual(
728             int(self.ipv6_scoped_network.network_address),
729             42540616829182469433403647294022090752,
730         )
731         self.assertEqual(
732             str(self.ipv6_scoped_network.network_address), "2001:658:22a:cafe::%scope"
733         )
734         self.assertEqual(
735             str(self.ipv6_scoped_network.hostmask), "::ffff:ffff:ffff:ffff"
736         )
737     def testIpFromInt(self):
738         self.assertEqual(self.ipv4_interface._ip, ipaddress.IPv4Interface(16909060)._ip)
739         ipv4 = ipaddress.ip_network("1.2.3.4")
740         ipv6 = ipaddress.ip_network("2001:658:22a:cafe:200:0:0:1")
741         ipv6_scoped = ipaddress.ip_network("2001:658:22a:cafe:200:0:0:1%scope")
742         self.assertEqual(ipv4, ipaddress.ip_network(int(ipv4.network_address)))
743         self.assertEqual(ipv6, ipaddress.ip_network(int(ipv6.network_address)))
744         self.assertNotEqual(
745             ipv6_scoped, ipaddress.ip_network(int(ipv6_scoped.network_address))
746         )
747         v6_int = 42540616829182469433547762482097946625
748         self.assertEqual(self.ipv6_interface._ip, ipaddress.IPv6Interface(v6_int)._ip)
749         self.assertEqual(
750             self.ipv6_scoped_interface._ip, ipaddress.IPv6Interface(v6_int)._ip
751         )
752         self.assertEqual(ipaddress.ip_network(self.ipv4_address._ip).version, 4)
753         self.assertEqual(ipaddress.ip_network(self.ipv6_address._ip).version, 6)
754         self.assertEqual(ipaddress.ip_network(self.ipv6_scoped_address._ip).version, 6)
755     def testIpFromPacked(self):
756         address = ipaddress.ip_address
757         self.assertEqual(
758             self.ipv4_interface._ip, ipaddress.ip_interface(b"\x01\x02\x03\x04")._ip
759         )
760         self.assertEqual(address("255.254.253.252"), address(b"\xff\xfe\xfd\xfc"))
761         self.assertEqual(
762             self.ipv6_interface.ip,
763             ipaddress.ip_interface(
764                 b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01"
765             ).ip,
766         )
767         self.assertEqual(
768             address("ffff:2:3:4:ffff::"),
769             address(b"\xff\xff\x00\x02\x00\x03\x00\x04" + b"\xff\xff" + b"\x00" * 6),
770         )
771         self.assertEqual(address("::"), address(b"\x00" * 16))
772     def testGetIp(self):
773         self.assertEqual(int(self.ipv4_interface.ip), 16909060)
774         self.assertEqual(str(self.ipv4_interface.ip), "1.2.3.4")
775         self.assertEqual(
776             int(self.ipv6_interface.ip), 42540616829182469433547762482097946625
777         )
778         self.assertEqual(str(self.ipv6_interface.ip), "2001:658:22a:cafe:200::1")
779         self.assertEqual(
780             int(self.ipv6_scoped_interface.ip), 42540616829182469433547762482097946625
781         )
782         self.assertEqual(str(self.ipv6_scoped_interface.ip), "2001:658:22a:cafe:200::1")
783     def testGetScopeId(self):
784         self.assertEqual(self.ipv6_address.scope_id, None)
785         self.assertEqual(str(self.ipv6_scoped_address.scope_id), "scope")
786         self.assertEqual(self.ipv6_interface.scope_id, None)
787         self.assertEqual(str(self.ipv6_scoped_interface.scope_id), "scope")
788         self.assertEqual(self.ipv6_network.network_address.scope_id, None)
789         self.assertEqual(
790             str(self.ipv6_scoped_network.network_address.scope_id), "scope"
791         )
792     def testGetNetmask(self):
793         self.assertEqual(int(self.ipv4_network.netmask), 4294967040)
794         self.assertEqual(str(self.ipv4_network.netmask), "255.255.255.0")
795         self.assertEqual(
796             int(self.ipv6_network.netmask), 340282366920938463444927863358058659840
797         )
798         self.assertEqual(self.ipv6_network.prefixlen, 64)
799         self.assertEqual(
800             int(self.ipv6_scoped_network.netmask),
801             340282366920938463444927863358058659840,
802         )
803         self.assertEqual(self.ipv6_scoped_network.prefixlen, 64)
804     def testZeroNetmask(self):
805         ipv4_zero_netmask = ipaddress.IPv4Interface("1.2.3.4/0")
806         self.assertEqual(int(ipv4_zero_netmask.network.netmask), 0)
807         self.assertEqual(ipv4_zero_netmask._prefix_from_prefix_string("0"), 0)
808         ipv6_zero_netmask = ipaddress.IPv6Interface("::1/0")
809         self.assertEqual(int(ipv6_zero_netmask.network.netmask), 0)
810         self.assertEqual(ipv6_zero_netmask._prefix_from_prefix_string("0"), 0)
811         ipv6_scoped_zero_netmask = ipaddress.IPv6Interface("::1%scope/0")
812         self.assertEqual(int(ipv6_scoped_zero_netmask.network.netmask), 0)
813         self.assertEqual(ipv6_scoped_zero_netmask._prefix_from_prefix_string("0"), 0)
814     def testIPv4Net(self):
815         net = ipaddress.IPv4Network("127.0.0.0/0.0.0.255")
816         self.assertEqual(net.prefixlen, 24)
817     def testGetBroadcast(self):
818         self.assertEqual(int(self.ipv4_network.broadcast_address), 16909311)
819         self.assertEqual(str(self.ipv4_network.broadcast_address), "1.2.3.255")
820         self.assertEqual(
821             int(self.ipv6_network.broadcast_address),
822             42540616829182469451850391367731642367,
823         )
824         self.assertEqual(
825             str(self.ipv6_network.broadcast_address),
826             "2001:658:22a:cafe:ffff:ffff:ffff:ffff",
827         )
828         self.assertEqual(
829             int(self.ipv6_scoped_network.broadcast_address),
830             42540616829182469451850391367731642367,
831         )
832         self.assertEqual(
833             str(self.ipv6_scoped_network.broadcast_address),
834             "2001:658:22a:cafe:ffff:ffff:ffff:ffff",
835         )
836     def testGetPrefixlen(self):
837         self.assertEqual(self.ipv4_interface.network.prefixlen, 24)
838         self.assertEqual(self.ipv6_interface.network.prefixlen, 64)
839         self.assertEqual(self.ipv6_scoped_interface.network.prefixlen, 64)
840     def testGetSupernet(self):
841         self.assertEqual(self.ipv4_network.supernet().prefixlen, 23)
842         self.assertEqual(str(self.ipv4_network.supernet().network_address), "1.2.2.0")
843         self.assertEqual(
844             ipaddress.IPv4Interface("0.0.0.0/0").network.supernet(),
845             ipaddress.IPv4Network("0.0.0.0/0"),
846         )
847         self.assertEqual(self.ipv6_network.supernet().prefixlen, 63)
848         self.assertEqual(
849             str(self.ipv6_network.supernet().network_address), "2001:658:22a:cafe::"
850         )
851         self.assertEqual(
852             ipaddress.IPv6Interface("::0/0").network.supernet(),
853             ipaddress.IPv6Network("::0/0"),
854         )
855         self.assertEqual(self.ipv6_scoped_network.supernet().prefixlen, 63)
856         self.assertEqual(
857             str(self.ipv6_scoped_network.supernet().network_address),
858             "2001:658:22a:cafe::",
859         )
860     def testGetSupernet3(self):
861         self.assertEqual(self.ipv4_network.supernet(3).prefixlen, 21)
862         self.assertEqual(str(self.ipv4_network.supernet(3).network_address), "1.2.0.0")
863         self.assertEqual(self.ipv6_network.supernet(3).prefixlen, 61)
864         self.assertEqual(
865             str(self.ipv6_network.supernet(3).network_address), "2001:658:22a:caf8::"
866         )
867         self.assertEqual(self.ipv6_scoped_network.supernet(3).prefixlen, 61)
868         self.assertEqual(
869             str(self.ipv6_scoped_network.supernet(3).network_address),
870             "2001:658:22a:caf8::",
871         )
872     def testGetSupernet4(self):
873         self.assertRaises(
874             ValueError, self.ipv4_network.supernet, prefixlen_diff=2, new_prefix=1
875         )
876         self.assertRaises(ValueError, self.ipv4_network.supernet, new_prefix=25)
877         self.assertEqual(
878             self.ipv4_network.supernet(prefixlen_diff=2),
879             self.ipv4_network.supernet(new_prefix=22),
880         )
881         self.assertRaises(
882             ValueError, self.ipv6_network.supernet, prefixlen_diff=2, new_prefix=1
883         )
884         self.assertRaises(ValueError, self.ipv6_network.supernet, new_prefix=65)
885         self.assertEqual(
886             self.ipv6_network.supernet(prefixlen_diff=2),
887             self.ipv6_network.supernet(new_prefix=62),
888         )
889         self.assertRaises(
890             ValueError,
891             self.ipv6_scoped_network.supernet,
892             prefixlen_diff=2,
893             new_prefix=1,
894         )
895         self.assertRaises(ValueError, self.ipv6_scoped_network.supernet, new_prefix=65)
896         self.assertEqual(
897             self.ipv6_scoped_network.supernet(prefixlen_diff=2),
898             self.ipv6_scoped_network.supernet(new_prefix=62),
899         )
900     def testHosts(self):
901         hosts = list(self.ipv4_network.hosts())
902         self.assertEqual(254, len(hosts))
903         self.assertEqual(ipaddress.IPv4Address("1.2.3.1"), hosts[0])
904         self.assertEqual(ipaddress.IPv4Address("1.2.3.254"), hosts[-1])
905         ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/120")
906         hosts = list(ipv6_network.hosts())
907         self.assertEqual(255, len(hosts))
908         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::1"), hosts[0])
909         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::ff"), hosts[-1])
910         ipv6_scoped_network = ipaddress.IPv6Network("2001:658:22a:cafe::%scope/120")
911         hosts = list(ipv6_scoped_network.hosts())
912         self.assertEqual(255, len(hosts))
913         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::1"), hosts[0])
914         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::ff"), hosts[-1])
915         addrs = [ipaddress.IPv4Address("2.0.0.0"), ipaddress.IPv4Address("2.0.0.1")]
916         str_args = "2.0.0.0/31"
917         tpl_args = ("2.0.0.0", 31)
918         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
919         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
920         self.assertEqual(
921             list(ipaddress.ip_network(str_args).hosts()),
922             list(ipaddress.ip_network(tpl_args).hosts()),
923         )
924         addrs = [ipaddress.IPv4Address("1.2.3.4")]
925         str_args = "1.2.3.4/32"
926         tpl_args = ("1.2.3.4", 32)
927         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
928         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
929         self.assertEqual(
930             list(ipaddress.ip_network(str_args).hosts()),
931             list(ipaddress.ip_network(tpl_args).hosts()),
932         )
933         addrs = [
934             ipaddress.IPv6Address("2001:658:22a:cafe::"),
935             ipaddress.IPv6Address("2001:658:22a:cafe::1"),
936         ]
937         str_args = "2001:658:22a:cafe::/127"
938         tpl_args = ("2001:658:22a:cafe::", 127)
939         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
940         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
941         self.assertEqual(
942             list(ipaddress.ip_network(str_args).hosts()),
943             list(ipaddress.ip_network(tpl_args).hosts()),
944         )
945         addrs = [
946             ipaddress.IPv6Address("2001:658:22a:cafe::1"),
947         ]
948         str_args = "2001:658:22a:cafe::1/128"
949         tpl_args = ("2001:658:22a:cafe::1", 128)
950         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
951         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
952         self.assertEqual(
953             list(ipaddress.ip_network(str_args).hosts()),
954             list(ipaddress.ip_network(tpl_args).hosts()),
955         )
956     def testFancySubnetting(self):
957         self.assertEqual(
958             sorted(self.ipv4_network.subnets(prefixlen_diff=3)),
959             sorted(self.ipv4_network.subnets(new_prefix=27)),
960         )
961         self.assertRaises(ValueError, list, self.ipv4_network.subnets(new_prefix=23))
962         self.assertRaises(
963             ValueError, list, self.ipv4_network.subnets(prefixlen_diff=3, new_prefix=27)
964         )
965         self.assertEqual(
966             sorted(self.ipv6_network.subnets(prefixlen_diff=4)),
967             sorted(self.ipv6_network.subnets(new_prefix=68)),
968         )
969         self.assertRaises(ValueError, list, self.ipv6_network.subnets(new_prefix=63))
970         self.assertRaises(
971             ValueError, list, self.ipv6_network.subnets(prefixlen_diff=4, new_prefix=68)
972         )
973         self.assertEqual(
974             sorted(self.ipv6_scoped_network.subnets(prefixlen_diff=4)),
975             sorted(self.ipv6_scoped_network.subnets(new_prefix=68)),
976         )
977         self.assertRaises(
978             ValueError, list, self.ipv6_scoped_network.subnets(new_prefix=63)
979         )
980         self.assertRaises(
981             ValueError,
982             list,
983             self.ipv6_scoped_network.subnets(prefixlen_diff=4, new_prefix=68),
984         )
985     def testGetSubnets(self):
986         self.assertEqual(list(self.ipv4_network.subnets())[0].prefixlen, 25)
987         self.assertEqual(
988             str(list(self.ipv4_network.subnets())[0].network_address), "1.2.3.0"
989         )
990         self.assertEqual(
991             str(list(self.ipv4_network.subnets())[1].network_address), "1.2.3.128"
992         )
993         self.assertEqual(list(self.ipv6_network.subnets())[0].prefixlen, 65)
994         self.assertEqual(list(self.ipv6_scoped_network.subnets())[0].prefixlen, 65)
995     def testGetSubnetForSingle32(self):
996         ip = ipaddress.IPv4Network("1.2.3.4/32")
997         subnets1 = [str(x) for x in ip.subnets()]
998         subnets2 = [str(x) for x in ip.subnets(2)]
999         self.assertEqual(subnets1, ["1.2.3.4/32"])
1000         self.assertEqual(subnets1, subnets2)
1001     def testGetSubnetForSingle128(self):
1002         ip = ipaddress.IPv6Network("::1/128")
1003         subnets1 = [str(x) for x in ip.subnets()]
1004         subnets2 = [str(x) for x in ip.subnets(2)]
1005         self.assertEqual(subnets1, ["::1/128"])
1006         self.assertEqual(subnets1, subnets2)
1007         ip_scoped = ipaddress.IPv6Network("::1%scope/128")
1008         subnets1 = [str(x) for x in ip_scoped.subnets()]
1009         subnets2 = [str(x) for x in ip_scoped.subnets(2)]
1010         self.assertEqual(subnets1, ["::1%scope/128"])
1011         self.assertEqual(subnets1, subnets2)
1012     def testSubnet2(self):
1013         ips = [str(x) for x in self.ipv4_network.subnets(2)]
1014         self.assertEqual(
1015             ips, ["1.2.3.0/26", "1.2.3.64/26", "1.2.3.128/26", "1.2.3.192/26"]
1016         )
1017         ipsv6 = [str(x) for x in self.ipv6_network.subnets(2)]
1018         self.assertEqual(
1019             ipsv6,
1020             [
1021                 "2001:658:22a:cafe::/66",
1022                 "2001:658:22a:cafe:4000::/66",
1023                 "2001:658:22a:cafe:8000::/66",
1024                 "2001:658:22a:cafe:c000::/66",
1025             ],
1026         )
1027     def testGetSubnets3(self):
1028         subnets = [str(x) for x in self.ipv4_network.subnets(8)]
1029         self.assertEqual(subnets[:3], ["1.2.3.0/32", "1.2.3.1/32", "1.2.3.2/32"])
1030         self.assertEqual(subnets[-3:], ["1.2.3.253/32", "1.2.3.254/32", "1.2.3.255/32"])
1031         self.assertEqual(len(subnets), 256)
1032         ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/120")
1033         subnets = [str(x) for x in ipv6_network.subnets(8)]
1034         self.assertEqual(
1035             subnets[:3],
1036             [
1037                 "2001:658:22a:cafe::/128",
1038                 "2001:658:22a:cafe::1/128",
1039                 "2001:658:22a:cafe::2/128",
1040             ],
1041         )
1042         self.assertEqual(
1043             subnets[-3:],
1044             [
1045                 "2001:658:22a:cafe::fd/128",
1046                 "2001:658:22a:cafe::fe/128",
1047                 "2001:658:22a:cafe::ff/128",
1048             ],
1049         )
1050         self.assertEqual(len(subnets), 256)
1051     def testSubnetFailsForLargeCidrDiff(self):
1052         self.assertRaises(ValueError, list, self.ipv4_interface.network.subnets(9))
1053         self.assertRaises(ValueError, list, self.ipv4_network.subnets(9))
1054         self.assertRaises(ValueError, list, self.ipv6_interface.network.subnets(65))
1055         self.assertRaises(ValueError, list, self.ipv6_network.subnets(65))
1056         self.assertRaises(
1057             ValueError, list, self.ipv6_scoped_interface.network.subnets(65)
1058         )
1059         self.assertRaises(ValueError, list, self.ipv6_scoped_network.subnets(65))
1060     def testSupernetFailsForLargeCidrDiff(self):
1061         self.assertRaises(ValueError, self.ipv4_interface.network.supernet, 25)
1062         self.assertRaises(ValueError, self.ipv6_interface.network.supernet, 65)
1063         self.assertRaises(ValueError, self.ipv6_scoped_interface.network.supernet, 65)
1064     def testSubnetFailsForNegativeCidrDiff(self):
1065         self.assertRaises(ValueError, list, self.ipv4_interface.network.subnets(-1))
1066         self.assertRaises(ValueError, list, self.ipv4_network.subnets(-1))
1067         self.assertRaises(ValueError, list, self.ipv6_interface.network.subnets(-1))
1068         self.assertRaises(ValueError, list, self.ipv6_network.subnets(-1))
1069         self.assertRaises(
1070             ValueError, list, self.ipv6_scoped_interface.network.subnets(-1)
1071         )
1072         self.assertRaises(ValueError, list, self.ipv6_scoped_network.subnets(-1))
1073     def testGetNum_Addresses(self):
1074         self.assertEqual(self.ipv4_network.num_addresses, 256)
1075         self.assertEqual(list(self.ipv4_network.subnets())[0].num_addresses, 128)
1076         self.assertEqual(self.ipv4_network.supernet().num_addresses, 512)
1077         self.assertEqual(self.ipv6_network.num_addresses, 18446744073709551616)
1078         self.assertEqual(
1079             list(self.ipv6_network.subnets())[0].num_addresses, 9223372036854775808
1080         )
1081         self.assertEqual(
1082             self.ipv6_network.supernet().num_addresses, 36893488147419103232
1083         )
1084         self.assertEqual(self.ipv6_scoped_network.num_addresses, 18446744073709551616)
1085         self.assertEqual(
1086             list(self.ipv6_scoped_network.subnets())[0].num_addresses,
1087             9223372036854775808,
1088         )
1089         self.assertEqual(
1090             self.ipv6_scoped_network.supernet().num_addresses, 36893488147419103232
1091         )
1092     def testContains(self):
1093         self.assertIn(ipaddress.IPv4Interface("1.2.3.128/25"), self.ipv4_network)
1094         self.assertNotIn(ipaddress.IPv4Interface("1.2.4.1/24"), self.ipv4_network)
1095         addr1 = ipaddress.IPv4Address("1.2.3.37")
1096         self.assertIn(addr1, self.ipv4_network)
1097         self.assertFalse(
1098             ipaddress.IPv4Network("1.1.0.0/16").__contains__(
1099                 ipaddress.IPv4Network("1.0.0.0/15")
1100             )
1101         )
1102     def testNth(self):
1103         self.assertEqual(str(self.ipv4_network[5]), "1.2.3.5")
1104         self.assertRaises(IndexError, self.ipv4_network.__getitem__, 256)
1105         self.assertEqual(str(self.ipv6_network[5]), "2001:658:22a:cafe::5")
1106         self.assertRaises(IndexError, self.ipv6_network.__getitem__, 1 &lt;&lt; 64)
1107         self.assertEqual(str(self.ipv6_scoped_network[5]), "2001:658:22a:cafe::5")
1108         self.assertRaises(IndexError, self.ipv6_scoped_network.__getitem__, 1 &lt;&lt; 64)
1109     def testGetitem(self):
1110         addr = ipaddress.IPv4Network("172.31.255.128/255.255.255.240")
1111         self.assertEqual(28, addr.prefixlen)
1112         addr_list = list(addr)
1113         self.assertEqual("172.31.255.128", str(addr_list[0]))
1114         self.assertEqual("172.31.255.128", str(addr[0]))
1115         self.assertEqual("172.31.255.143", str(addr_list[-1]))
1116         self.assertEqual("172.31.255.143", str(addr[-1]))
1117         self.assertEqual(addr_list[-1], addr[-1])
1118     def testEqual(self):
1119         self.assertTrue(self.ipv4_interface == ipaddress.IPv4Interface("1.2.3.4/24"))
1120         self.assertFalse(self.ipv4_interface == ipaddress.IPv4Interface("1.2.3.4/23"))
1121         self.assertFalse(self.ipv4_interface == ipaddress.IPv6Interface("::1.2.3.4/24"))
1122         self.assertFalse(
1123             self.ipv4_interface == ipaddress.IPv6Interface("::1.2.3.4%scope/24")
1124         )
1125         self.assertFalse(self.ipv4_interface == "")
1126         self.assertFalse(self.ipv4_interface == [])
1127         self.assertFalse(self.ipv4_interface == 2)
1128         self.assertTrue(
1129             self.ipv6_interface
1130             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1131         )
1132         self.assertFalse(
1133             self.ipv6_interface
1134             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1135         )
1136         self.assertFalse(self.ipv6_interface == ipaddress.IPv4Interface("1.2.3.4/23"))
1137         self.assertFalse(self.ipv6_interface == "")
1138         self.assertFalse(self.ipv6_interface == [])
1139         self.assertFalse(self.ipv6_interface == 2)
1140         self.assertTrue(
1141             self.ipv6_scoped_interface
1142             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/64")
1143         )
1144         self.assertFalse(
1145             self.ipv6_scoped_interface
1146             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/63")
1147         )
1148         self.assertFalse(
1149             self.ipv6_scoped_interface
1150             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1151         )
1152         self.assertFalse(
1153             self.ipv6_scoped_interface
1154             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1155         )
1156         self.assertFalse(
1157             self.ipv6_scoped_interface == ipaddress.IPv4Interface("1.2.3.4/23")
1158         )
1159         self.assertFalse(self.ipv6_scoped_interface == "")
1160         self.assertFalse(self.ipv6_scoped_interface == [])
1161         self.assertFalse(self.ipv6_scoped_interface == 2)
1162     def testNotEqual(self):
1163         self.assertFalse(self.ipv4_interface != ipaddress.IPv4Interface("1.2.3.4/24"))
1164         self.assertTrue(self.ipv4_interface != ipaddress.IPv4Interface("1.2.3.4/23"))
1165         self.assertTrue(self.ipv4_interface != ipaddress.IPv6Interface("::1.2.3.4/24"))
1166         self.assertTrue(
1167             self.ipv4_interface != ipaddress.IPv6Interface("::1.2.3.4%scope/24")
1168         )
1169         self.assertTrue(self.ipv4_interface != "")
1170         self.assertTrue(self.ipv4_interface != [])
1171         self.assertTrue(self.ipv4_interface != 2)
1172         self.assertTrue(self.ipv4_address != ipaddress.IPv4Address("1.2.3.5"))
1173         self.assertTrue(self.ipv4_address != "")
1174         self.assertTrue(self.ipv4_address != [])
1175         self.assertTrue(self.ipv4_address != 2)
1176         self.assertFalse(
1177             self.ipv6_interface
1178             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1179         )
1180         self.assertTrue(
1181             self.ipv6_interface
1182             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1183         )
1184         self.assertTrue(self.ipv6_interface != ipaddress.IPv4Interface("1.2.3.4/23"))
1185         self.assertTrue(self.ipv6_interface != "")
1186         self.assertTrue(self.ipv6_interface != [])
1187         self.assertTrue(self.ipv6_interface != 2)
1188         self.assertTrue(self.ipv6_address != ipaddress.IPv4Address("1.2.3.4"))
1189         self.assertTrue(self.ipv6_address != "")
1190         self.assertTrue(self.ipv6_address != [])
1191         self.assertTrue(self.ipv6_address != 2)
1192         self.assertFalse(
1193             self.ipv6_scoped_interface
1194             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/64")
1195         )
1196         self.assertTrue(
1197             self.ipv6_scoped_interface
1198             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/63")
1199         )
1200         self.assertTrue(
1201             self.ipv6_scoped_interface
1202             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1203         )
1204         self.assertTrue(
1205             self.ipv6_scoped_interface
1206             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1207         )
1208         self.assertTrue(
1209             self.ipv6_scoped_interface != ipaddress.IPv4Interface("1.2.3.4/23")
1210         )
1211         self.assertTrue(self.ipv6_scoped_interface != "")
1212         self.assertTrue(self.ipv6_scoped_interface != [])
1213         self.assertTrue(self.ipv6_scoped_interface != 2)
1214         self.assertTrue(self.ipv6_scoped_address != ipaddress.IPv4Address("1.2.3.4"))
1215         self.assertTrue(self.ipv6_scoped_address != "")
1216         self.assertTrue(self.ipv6_scoped_address != [])
1217         self.assertTrue(self.ipv6_scoped_address != 2)
1218     def testSlash32Constructor(self):
1219         self.assertEqual(
1220             str(ipaddress.IPv4Interface("1.2.3.4/255.255.255.255")), "1.2.3.4/32"
1221         )
1222     def testSlash128Constructor(self):
1223         self.assertEqual(str(ipaddress.IPv6Interface("::1/128")), "::1/128")
1224         self.assertEqual(str(ipaddress.IPv6Interface("::1%scope/128")), "::1%scope/128")
1225     def testSlash0Constructor(self):
1226         self.assertEqual(str(ipaddress.IPv4Interface("1.2.3.4/0.0.0.0")), "1.2.3.4/0")
1227     def testCollapsing(self):
1228         ip1 = ipaddress.IPv4Address("1.1.1.0")
1229         ip2 = ipaddress.IPv4Address("1.1.1.1")
1230         ip3 = ipaddress.IPv4Address("1.1.1.2")
1231         ip4 = ipaddress.IPv4Address("1.1.1.3")
1232         ip5 = ipaddress.IPv4Address("1.1.1.4")
1233         ip6 = ipaddress.IPv4Address("1.1.1.0")
1234         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4, ip5, ip6])
1235         self.assertEqual(
1236             list(collapsed),
1237             [ipaddress.IPv4Network("1.1.1.0/30"), ipaddress.IPv4Network("1.1.1.4/32")],
1238         )
1239         ip1 = ipaddress.IPv4Address("1.1.1.0")
1240         ip2 = ipaddress.IPv4Address("1.1.1.1")
1241         ip3 = ipaddress.IPv4Address("1.1.1.2")
1242         ip4 = ipaddress.IPv4Address("1.1.1.3")
1243         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4])
1244         self.assertEqual(list(collapsed), [ipaddress.IPv4Network("1.1.1.0/30")])
1245         ip1 = ipaddress.IPv4Network("1.1.0.0/24")
1246         ip2 = ipaddress.IPv4Network("1.1.1.0/24")
1247         ip3 = ipaddress.IPv4Network("1.1.2.0/24")
1248         ip4 = ipaddress.IPv4Network("1.1.3.0/24")
1249         ip5 = ipaddress.IPv4Network("1.1.4.0/24")
1250         ip6 = ipaddress.IPv4Network("1.1.0.0/22")
1251         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4, ip5, ip6])
1252         self.assertEqual(
1253             list(collapsed),
1254             [ipaddress.IPv4Network("1.1.0.0/22"), ipaddress.IPv4Network("1.1.4.0/24")],
1255         )
1256         collapsed = ipaddress.collapse_addresses([ip1, ip2])
1257         self.assertEqual(list(collapsed), [ipaddress.IPv4Network("1.1.0.0/23")])
1258         ip_same1 = ip_same2 = ipaddress.IPv4Network("1.1.1.1/32")
1259         self.assertEqual(
1260             list(ipaddress.collapse_addresses([ip_same1, ip_same2])), [ip_same1]
1261         )
1262         ip_same1 = ip_same2 = ipaddress.IPv4Address("1.1.1.1")
1263         self.assertEqual(
1264             list(ipaddress.collapse_addresses([ip_same1, ip_same2])),
1265             [ipaddress.ip_network("1.1.1.1/32")],
1266         )
1267         ip1 = ipaddress.IPv6Network("2001::/100")
1268         ip2 = ipaddress.IPv6Network("2001::/120")
1269         ip3 = ipaddress.IPv6Network("2001::/96")
1270         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3])
1271         self.assertEqual(list(collapsed), [ip3])
1272         ip1 = ipaddress.IPv6Network("2001::%scope/100")
1273         ip2 = ipaddress.IPv6Network("2001::%scope/120")
1274         ip3 = ipaddress.IPv6Network("2001::%scope/96")
1275         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3])
1276         self.assertEqual(list(collapsed), [ip3])
1277         addr_tuples = [
1278             (ipaddress.ip_address("1.1.1.1"), ipaddress.ip_address("::1")),
1279             (ipaddress.IPv4Network("1.1.0.0/24"), ipaddress.IPv6Network("2001::/120")),
1280             (ipaddress.IPv4Network("1.1.0.0/32"), ipaddress.IPv6Network("2001::/128")),
1281         ]
1282         for ip1, ip2 in addr_tuples:
1283             self.assertRaises(TypeError, ipaddress.collapse_addresses, [ip1, ip2])
1284         addr_tuples = [
1285             (ipaddress.ip_address("1.1.1.1"), ipaddress.ip_address("::1%scope")),
1286             (
1287                 ipaddress.IPv4Network("1.1.0.0/24"),
1288                 ipaddress.IPv6Network("2001::%scope/120"),
1289             ),
1290             (
1291                 ipaddress.IPv4Network("1.1.0.0/32"),
1292                 ipaddress.IPv6Network("2001::%scope/128"),
1293             ),
1294         ]
1295         for ip1, ip2 in addr_tuples:
1296             self.assertRaises(TypeError, ipaddress.collapse_addresses, [ip1, ip2])
1297     def testSummarizing(self):
1298         summarize = ipaddress.summarize_address_range
1299         ip1 = ipaddress.ip_address("1.1.1.0")
1300         ip2 = ipaddress.ip_address("1.1.1.255")
1301         class IPv7Address(ipaddress.IPv6Address):
1302             @property
1303             def version(self):
1304                 return 7
1305         ip_invalid1 = IPv7Address("::1")
1306         ip_invalid2 = IPv7Address("::1")
1307         self.assertRaises(ValueError, list, summarize(ip_invalid1, ip_invalid2))
1308         self.assertRaises(TypeError, list, summarize(ip1, ipaddress.IPv6Address("::1")))
1309         self.assertRaises(
1310             TypeError, list, summarize(ip1, ipaddress.IPv6Address("::1%scope"))
1311         )
1312         self.assertEqual(
1313             list(summarize(ip1, ip2))[0], ipaddress.ip_network("1.1.1.0/24")
1314         )
1315         ip2 = ipaddress.ip_address("1.1.1.8")
1316         self.assertEqual(
1317             list(summarize(ip1, ip2)),
1318             [ipaddress.ip_network("1.1.1.0/29"), ipaddress.ip_network("1.1.1.8")],
1319         )
1320         ip1 = ipaddress.IPv4Address(0)
1321         ip2 = ipaddress.IPv4Address(ipaddress.IPv4Address._ALL_ONES)
1322         self.assertEqual(
1323             [ipaddress.IPv4Network("0.0.0.0/0")], list(summarize(ip1, ip2))
1324         )
1325         ip1 = ipaddress.ip_address("1::")
1326         ip2 = ipaddress.ip_address("1:ffff:ffff:ffff:ffff:ffff:ffff:ffff")
1327         self.assertEqual(list(summarize(ip1, ip2))[0], ipaddress.ip_network("1::/16"))
1328         ip2 = ipaddress.ip_address("2::")
1329         self.assertEqual(
1330             list(summarize(ip1, ip2)),
1331             [ipaddress.ip_network("1::/16"), ipaddress.ip_network("2::/128")],
1332         )
1333         ip1 = ipaddress.ip_address("1::%scope")
1334         ip2 = ipaddress.ip_address("1:ffff:ffff:ffff:ffff:ffff:ffff:ffff%scope")
1335         self.assertEqual(list(summarize(ip1, ip2))[0], ipaddress.ip_network("1::/16"))
1336         ip2 = ipaddress.ip_address("2::%scope")
1337         self.assertEqual(
1338             list(summarize(ip1, ip2)),
1339             [ipaddress.ip_network("1::/16"), ipaddress.ip_network("2::/128")],
1340         )
1341         self.assertRaises(
1342             ValueError,
1343             list,
1344             summarize(ipaddress.ip_address("1.1.1.0"), ipaddress.ip_address("1.1.0.0")),
1345         )
1346         self.assertRaises(
1347             TypeError,
1348             list,
1349             summarize(ipaddress.ip_network("1.1.1.0"), ipaddress.ip_network("1.1.0.0")),
1350         )
1351         self.assertRaises(
1352             TypeError,
1353             list,
1354             summarize(ipaddress.ip_network("1.1.1.0"), ipaddress.ip_network("1.1.0.0")),
1355         )
1356         self.assertRaises(
1357             TypeError,
1358             list,
1359             summarize(ipaddress.ip_address("::"), ipaddress.ip_network("1.1.0.0")),
1360         )
1361     def testAddressComparison(self):
1362         self.assertTrue(
1363             ipaddress.ip_address("1.1.1.1") &lt;= ipaddress.ip_address("1.1.1.1")
1364         )
1365         self.assertTrue(
1366             ipaddress.ip_address("1.1.1.1") &lt;= ipaddress.ip_address("1.1.1.2")
1367         )
1368         self.assertTrue(ipaddress.ip_address("::1") &lt;= ipaddress.ip_address("::1"))
1369         self.assertTrue(ipaddress.ip_address("::1") &lt;= ipaddress.ip_address("::2"))
1370         self.assertTrue(
1371             ipaddress.ip_address("::1%scope") &lt;= ipaddress.ip_address("::1%scope")
1372         )
1373         self.assertTrue(
1374             ipaddress.ip_address("::1%scope") &lt;= ipaddress.ip_address("::2%scope")
1375         )
1376     def testInterfaceComparison(self):
1377         self.assertTrue(
1378             ipaddress.ip_interface("1.1.1.1/24") == ipaddress.ip_interface("1.1.1.1/24")
1379         )
1380         self.assertTrue(
1381             ipaddress.ip_interface("1.1.1.1/16") &lt; ipaddress.ip_interface("1.1.1.1/24")
1382         )
1383         self.assertTrue(
1384             ipaddress.ip_interface("1.1.1.1/24") &lt; ipaddress.ip_interface("1.1.1.2/24")
1385         )
1386         self.assertTrue(
1387             ipaddress.ip_interface("1.1.1.2/16") &lt; ipaddress.ip_interface("1.1.1.1/24")
1388         )
1389         self.assertTrue(
1390             ipaddress.ip_interface("1.1.1.1/24") &gt; ipaddress.ip_interface("1.1.1.1/16")
1391         )
1392         self.assertTrue(
1393             ipaddress.ip_interface("1.1.1.2/24") &gt; ipaddress.ip_interface("1.1.1.1/24")
1394         )
1395         self.assertTrue(
1396             ipaddress.ip_interface("1.1.1.1/24") &gt; ipaddress.ip_interface("1.1.1.2/16")
1397         )
1398         self.assertTrue(
1399             ipaddress.ip_interface("::1/64") == ipaddress.ip_interface("::1/64")
1400         )
1401         self.assertTrue(
1402             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::1/80")
1403         )
1404         self.assertTrue(
1405             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::2/64")
1406         )
1407         self.assertTrue(
1408             ipaddress.ip_interface("::2/48") &lt; ipaddress.ip_interface("::1/64")
1409         )
1410         self.assertTrue(
1411             ipaddress.ip_interface("::1/80") &gt; ipaddress.ip_interface("::1/64")
1412         )
1413         self.assertTrue(
1414             ipaddress.ip_interface("::2/64") &gt; ipaddress.ip_interface("::1/64")
1415         )
1416         self.assertTrue(
1417             ipaddress.ip_interface("::1/64") &gt; ipaddress.ip_interface("::2/48")
1418         )
1419         self.assertTrue(
1420             ipaddress.ip_interface("::1%scope/64")
1421             == ipaddress.ip_interface("::1%scope/64")
1422         )
1423         self.assertTrue(
1424             ipaddress.ip_interface("::1%scope/64")
1425             &lt; ipaddress.ip_interface("::1%scope/80")
1426         )
1427         self.assertTrue(
1428             ipaddress.ip_interface("::1%scope/64")
1429             &lt; ipaddress.ip_interface("::2%scope/64")
1430         )
1431         self.assertTrue(
1432             ipaddress.ip_interface("::2%scope/48")
1433             &lt; ipaddress.ip_interface("::1%scope/64")
1434         )
1435         self.assertTrue(
1436             ipaddress.ip_interface("::1%scope/80")
1437             &gt; ipaddress.ip_interface("::1%scope/64")
1438         )
1439         self.assertTrue(
1440             ipaddress.ip_interface("::2%scope/64")
1441             &gt; ipaddress.ip_interface("::1%scope/64")
1442         )
1443         self.assertTrue(
1444             ipaddress.ip_interface("::1%scope/64")
1445             &gt; ipaddress.ip_interface("::2%scope/48")
1446         )
1447         self.assertFalse(
1448             ipaddress.ip_interface("::1%scope/64") == ipaddress.ip_interface("::1/64")
1449         )
1450         self.assertTrue(
1451             ipaddress.ip_interface("::1%scope/64") &lt; ipaddress.ip_interface("::1/80")
1452         )
1453         self.assertTrue(
1454             ipaddress.ip_interface("::1%scope/64") &lt; ipaddress.ip_interface("::2/64")
1455         )
1456         self.assertTrue(
1457             ipaddress.ip_interface("::2%scope/48") &lt; ipaddress.ip_interface("::1/64")
1458         )
1459         self.assertTrue(
1460             ipaddress.ip_interface("::1%scope/80") &gt; ipaddress.ip_interface("::1/64")
1461         )
1462         self.assertTrue(
1463             ipaddress.ip_interface("::2%scope/64") &gt; ipaddress.ip_interface("::1/64")
1464         )
1465         self.assertTrue(
1466             ipaddress.ip_interface("::1%scope/64") &gt; ipaddress.ip_interface("::2/48")
1467         )
1468         self.assertFalse(
1469             ipaddress.ip_interface("::1/64") == ipaddress.ip_interface("::1%scope/64")
1470         )
1471         self.assertTrue(
1472             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::1%scope/80")
1473         )
1474         self.assertTrue(
1475             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::2%scope/64")
1476         )
1477         self.assertTrue(
1478             ipaddress.ip_interface("::2/48") &lt; ipaddress.ip_interface("::1%scope/64")
1479         )
1480         self.assertTrue(
1481             ipaddress.ip_interface("::1/80") &gt; ipaddress.ip_interface("::1%scope/64")
1482         )
1483         self.assertTrue(
1484             ipaddress.ip_interface("::2/64") &gt; ipaddress.ip_interface("::1%scope/64")
1485         )
1486         self.assertTrue(
1487             ipaddress.ip_interface("::1/64") &gt; ipaddress.ip_interface("::2%scope/48")
1488         )
1489     def testNetworkComparison(self):
1490         ip1 = ipaddress.IPv4Network("1.1.1.0/24")
1491         ip2 = ipaddress.IPv4Network("1.1.1.0/32")
1492         ip3 = ipaddress.IPv4Network("1.1.2.0/24")
1493         self.assertTrue(ip1 &lt; ip3)
1494         self.assertTrue(ip3 &gt; ip2)
1495         self.assertEqual(ip1.compare_networks(ip1), 0)
1496         self.assertEqual(ip1.compare_networks(ip2), -1)
1497         self.assertEqual(ip2.compare_networks(ip1), 1)
1498         self.assertEqual(ip1.compare_networks(ip3), -1)
1499         self.assertEqual(ip3.compare_networks(ip1), 1)
1500         self.assertTrue(ip1._get_networks_key() &lt; ip3._get_networks_key())
1501         ip1 = ipaddress.IPv6Network("2001:2000::/96")
1502         ip2 = ipaddress.IPv6Network("2001:2001::/96")
1503         ip3 = ipaddress.IPv6Network("2001:ffff:2000::/96")
1504         self.assertTrue(ip1 &lt; ip3)
1505         self.assertTrue(ip3 &gt; ip2)
1506         self.assertEqual(ip1.compare_networks(ip3), -1)
1507         self.assertTrue(ip1._get_networks_key() &lt; ip3._get_networks_key())
1508         self.assertRaises(
1509             TypeError, self.ipv4_network.compare_networks, self.ipv6_network
1510         )
1511         ipv6 = ipaddress.IPv6Interface("::/0")
1512         ipv4 = ipaddress.IPv4Interface("0.0.0.0/0")
1513         self.assertRaises(TypeError, ipv4.__lt__, ipv6)
1514         self.assertRaises(TypeError, ipv4.__gt__, ipv6)
1515         self.assertRaises(TypeError, ipv6.__lt__, ipv4)
1516         self.assertRaises(TypeError, ipv6.__gt__, ipv4)
1517         ip1 = ipaddress.ip_network("10.1.2.128/25")
1518         self.assertFalse(ip1 &lt; ip1)
1519         self.assertFalse(ip1 &gt; ip1)
1520         ip2 = ipaddress.ip_network("10.1.3.0/24")
1521         self.assertTrue(ip1 &lt; ip2)
1522         self.assertFalse(ip2 &lt; ip1)
1523         self.assertFalse(ip1 &gt; ip2)
1524         self.assertTrue(ip2 &gt; ip1)
1525         ip3 = ipaddress.ip_network("10.1.3.0/25")
1526         self.assertTrue(ip2 &lt; ip3)
1527         self.assertFalse(ip3 &lt; ip2)
1528         self.assertFalse(ip2 &gt; ip3)
1529         self.assertTrue(ip3 &gt; ip2)
1530         ip1 = ipaddress.ip_network("10.10.10.0/31")
1531         ip2 = ipaddress.ip_network("10.10.10.0")
1532         ip3 = ipaddress.ip_network("10.10.10.2/31")
1533         ip4 = ipaddress.ip_network("10.10.10.2")
1534         sorted = [ip1, ip2, ip3, ip4]
1535         unsorted = [ip2, ip4, ip1, ip3]
1536         unsorted.sort()
1537         self.assertEqual(sorted, unsorted)
1538         unsorted = [ip4, ip1, ip3, ip2]
1539         unsorted.sort()
1540         self.assertEqual(sorted, unsorted)
1541         self.assertIs(ip1.__lt__(ipaddress.ip_address("10.10.10.0")), NotImplemented)
1542         self.assertIs(ip2.__lt__(ipaddress.ip_address("10.10.10.0")), NotImplemented)
1543         self.assertTrue(
1544             ipaddress.ip_network("1.1.1.1") &lt;= ipaddress.ip_network("1.1.1.1")
1545         )
1546         self.assertTrue(
1547             ipaddress.ip_network("1.1.1.1") &lt;= ipaddress.ip_network("1.1.1.2")
1548         )
1549         self.assertFalse(
1550             ipaddress.ip_network("1.1.1.2") &lt;= ipaddress.ip_network("1.1.1.1")
1551         )
1552         self.assertTrue(ipaddress.ip_network("::1") &lt;= ipaddress.ip_network("::1"))
1553         self.assertTrue(ipaddress.ip_network("::1") &lt;= ipaddress.ip_network("::2"))
1554         self.assertFalse(ipaddress.ip_network("::2") &lt;= ipaddress.ip_network("::1"))
1555     def testStrictNetworks(self):
1556         self.assertRaises(ValueError, ipaddress.ip_network, "192.168.1.1/24")
1557         self.assertRaises(ValueError, ipaddress.ip_network, "::1/120")
1558         self.assertRaises(ValueError, ipaddress.ip_network, "::1%scope/120")
1559     def testOverlaps(self):
1560         other = ipaddress.IPv4Network("1.2.3.0/30")
1561         other2 = ipaddress.IPv4Network("1.2.2.0/24")
1562         other3 = ipaddress.IPv4Network("1.2.2.64/26")
1563         self.assertTrue(self.ipv4_network.overlaps(other))
1564         self.assertFalse(self.ipv4_network.overlaps(other2))
1565         self.assertTrue(other2.overlaps(other3))
1566     def testEmbeddedIpv4(self):
1567         ipv4_string = "192.168.0.1"
1568         ipv4 = ipaddress.IPv4Interface(ipv4_string)
1569         v4compat_ipv6 = ipaddress.IPv6Interface("::%s" % ipv4_string)
1570         self.assertEqual(int(v4compat_ipv6.ip), int(ipv4.ip))
1571         v4mapped_ipv6 = ipaddress.IPv6Interface("::ffff:%s" % ipv4_string)
1572         self.assertNotEqual(v4mapped_ipv6.ip, ipv4.ip)
1573         self.assertRaises(
1574             ipaddress.AddressValueError, ipaddress.IPv6Interface, "2001:1.1.1.1:1.1.1.1"
1575         )
1576     def testIPv6AddressTooLarge(self):
1577         self.assertEqual(
1578             ipaddress.ip_address("::FFFF:192.0.2.1"),
1579             ipaddress.ip_address("::FFFF:c000:201"),
1580         )
1581         self.assertEqual(
1582             ipaddress.ip_address("FFFF::192.0.2.1"),
1583             ipaddress.ip_address("FFFF::c000:201"),
1584         )
1585         self.assertEqual(
1586             ipaddress.ip_address("::FFFF:192.0.2.1%scope"),
1587             ipaddress.ip_address("::FFFF:c000:201%scope"),
1588         )
1589         self.assertEqual(
1590             ipaddress.ip_address("FFFF::192.0.2.1%scope"),
1591             ipaddress.ip_address("FFFF::c000:201%scope"),
1592         )
1593         self.assertNotEqual(
1594             ipaddress.ip_address("::FFFF:192.0.2.1%scope"),
1595             ipaddress.ip_address("::FFFF:c000:201"),
1596         )
1597         self.assertNotEqual(
1598             ipaddress.ip_address("FFFF::192.0.2.1%scope"),
1599             ipaddress.ip_address("FFFF::c000:201"),
1600         )
1601         self.assertNotEqual(
1602             ipaddress.ip_address("::FFFF:192.0.2.1"),
1603             ipaddress.ip_address("::FFFF:c000:201%scope"),
1604         )
1605         self.assertNotEqual(
1606             ipaddress.ip_address("FFFF::192.0.2.1"),
1607             ipaddress.ip_address("FFFF::c000:201%scope"),
1608         )
1609     def testIPVersion(self):
1610         self.assertEqual(self.ipv4_address.version, 4)
1611         self.assertEqual(self.ipv6_address.version, 6)
1612         self.assertEqual(self.ipv6_scoped_address.version, 6)
1613     def testMaxPrefixLength(self):
1614         self.assertEqual(self.ipv4_interface.max_prefixlen, 32)
1615         self.assertEqual(self.ipv6_interface.max_prefixlen, 128)
1616         self.assertEqual(self.ipv6_scoped_interface.max_prefixlen, 128)
1617     def testPacked(self):
1618         self.assertEqual(self.ipv4_address.packed, b"\x01\x02\x03\x04")
1619         self.assertEqual(
1620             ipaddress.IPv4Interface("255.254.253.252").packed, b"\xff\xfe\xfd\xfc"
1621         )
1622         self.assertEqual(
1623             self.ipv6_address.packed,
1624             b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01",
1625         )
1626         self.assertEqual(
1627             ipaddress.IPv6Interface("ffff:2:3:4:ffff::").packed,
1628             b"\xff\xff\x00\x02\x00\x03\x00\x04\xff\xff" + b"\x00" * 6,
1629         )
1630         self.assertEqual(
1631             ipaddress.IPv6Interface("::1:0:0:0:0").packed,
1632             b"\x00" * 6 + b"\x00\x01" + b"\x00" * 8,
1633         )
1634         self.assertEqual(
1635             self.ipv6_scoped_address.packed,
1636             b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01",
1637         )
1638         self.assertEqual(
1639             ipaddress.IPv6Interface("ffff:2:3:4:ffff::%scope").packed,
1640             b"\xff\xff\x00\x02\x00\x03\x00\x04\xff\xff" + b"\x00" * 6,
1641         )
1642         self.assertEqual(
1643             ipaddress.IPv6Interface("::1:0:0:0:0%scope").packed,
1644             b"\x00" * 6 + b"\x00\x01" + b"\x00" * 8,
1645         )
1646     def testIpType(self):
1647         ipv4net = ipaddress.ip_network("1.2.3.4")
1648         ipv4addr = ipaddress.ip_address("1.2.3.4")
1649         ipv6net = ipaddress.ip_network("::1.2.3.4")
1650         ipv6addr = ipaddress.ip_address("::1.2.3.4")
1651         self.assertEqual(ipaddress.IPv4Network, type(ipv4net))
1652         self.assertEqual(ipaddress.IPv4Address, type(ipv4addr))
1653         self.assertEqual(ipaddress.IPv6Network, type(ipv6net))
1654         self.assertEqual(ipaddress.IPv6Address, type(ipv6addr))
1655     def testReservedIpv4(self):
1656         self.assertEqual(True, ipaddress.ip_interface("224.1.1.1/31").is_multicast)
1657         self.assertEqual(False, ipaddress.ip_network("240.0.0.0").is_multicast)
1658         self.assertEqual(True, ipaddress.ip_network("240.0.0.0").is_reserved)
1659         self.assertEqual(True, ipaddress.ip_interface("192.168.1.1/17").is_private)
1660         self.assertEqual(False, ipaddress.ip_network("192.169.0.0").is_private)
1661         self.assertEqual(True, ipaddress.ip_network("10.255.255.255").is_private)
1662         self.assertEqual(False, ipaddress.ip_network("11.0.0.0").is_private)
1663         self.assertEqual(False, ipaddress.ip_network("11.0.0.0").is_reserved)
1664         self.assertEqual(True, ipaddress.ip_network("172.31.255.255").is_private)
1665         self.assertEqual(False, ipaddress.ip_network("172.32.0.0").is_private)
1666         self.assertEqual(True, ipaddress.ip_network("169.254.1.0/24").is_link_local)
1667         self.assertEqual(
1668             True, ipaddress.ip_interface("169.254.100.200/24").is_link_local
1669         )
1670         self.assertEqual(
1671             False, ipaddress.ip_interface("169.255.100.200/24").is_link_local
1672         )
1673         self.assertEqual(True, ipaddress.ip_network("127.100.200.254/32").is_loopback)
1674         self.assertEqual(True, ipaddress.ip_network("127.42.0.0/16").is_loopback)
1675         self.assertEqual(False, ipaddress.ip_network("128.0.0.0").is_loopback)
1676         self.assertEqual(False, ipaddress.ip_network("100.64.0.0/10").is_private)
1677         self.assertEqual(False, ipaddress.ip_network("100.64.0.0/10").is_global)
1678         self.assertEqual(True, ipaddress.ip_network("192.0.2.128/25").is_private)
1679         self.assertEqual(True, ipaddress.ip_network("192.0.3.0/24").is_global)
1680         self.assertEqual(True, ipaddress.ip_address("0.0.0.0").is_unspecified)
1681         self.assertEqual(True, ipaddress.ip_address("224.1.1.1").is_multicast)
1682         self.assertEqual(False, ipaddress.ip_address("240.0.0.0").is_multicast)
1683         self.assertEqual(True, ipaddress.ip_address("240.0.0.1").is_reserved)
1684         self.assertEqual(False, ipaddress.ip_address("239.255.255.255").is_reserved)
1685         self.assertEqual(True, ipaddress.ip_address("192.168.1.1").is_private)
1686         self.assertEqual(False, ipaddress.ip_address("192.169.0.0").is_private)
1687         self.assertEqual(True, ipaddress.ip_address("10.255.255.255").is_private)
1688         self.assertEqual(False, ipaddress.ip_address("11.0.0.0").is_private)
1689         self.assertEqual(True, ipaddress.ip_address("172.31.255.255").is_private)
1690         self.assertEqual(False, ipaddress.ip_address("172.32.0.0").is_private)
1691         self.assertEqual(True, ipaddress.ip_address("169.254.100.200").is_link_local)
1692         self.assertEqual(False, ipaddress.ip_address("169.255.100.200").is_link_local)
1693         self.assertTrue(ipaddress.ip_address("192.0.7.1").is_global)
1694         self.assertFalse(ipaddress.ip_address("203.0.113.1").is_global)
1695         self.assertEqual(True, ipaddress.ip_address("127.100.200.254").is_loopback)
1696         self.assertEqual(True, ipaddress.ip_address("127.42.0.0").is_loopback)
1697         self.assertEqual(False, ipaddress.ip_address("128.0.0.0").is_loopback)
1698         self.assertEqual(True, ipaddress.ip_network("0.0.0.0").is_unspecified)
1699     def testReservedIpv6(self):
1700         self.assertEqual(True, ipaddress.ip_network("ffff::").is_multicast)
1701         self.assertEqual(True, ipaddress.ip_network(2 ** 128 - 1).is_multicast)
1702         self.assertEqual(True, ipaddress.ip_network("ff00::").is_multicast)
1703         self.assertEqual(False, ipaddress.ip_network("fdff::").is_multicast)
1704         self.assertEqual(True, ipaddress.ip_network("fecf::").is_site_local)
1705         self.assertEqual(
1706             True, ipaddress.ip_network("feff:ffff:ffff:ffff::").is_site_local
1707         )
1708         self.assertEqual(False, ipaddress.ip_network("fbf:ffff::").is_site_local)
1709         self.assertEqual(False, ipaddress.ip_network("ff00::").is_site_local)
1710         self.assertEqual(True, ipaddress.ip_network("fc00::").is_private)
1711         self.assertEqual(True, ipaddress.ip_network("fc00:ffff:ffff:ffff::").is_private)
1712         self.assertEqual(False, ipaddress.ip_network("fbff:ffff::").is_private)
1713         self.assertEqual(False, ipaddress.ip_network("fe00::").is_private)
1714         self.assertEqual(True, ipaddress.ip_network("fea0::").is_link_local)
1715         self.assertEqual(True, ipaddress.ip_network("febf:ffff::").is_link_local)
1716         self.assertEqual(False, ipaddress.ip_network("fe7f:ffff::").is_link_local)
1717         self.assertEqual(False, ipaddress.ip_network("fec0::").is_link_local)
1718         self.assertEqual(True, ipaddress.ip_interface("0:0::0:01").is_loopback)
1719         self.assertEqual(False, ipaddress.ip_interface("::1/127").is_loopback)
1720         self.assertEqual(False, ipaddress.ip_network("::").is_loopback)
1721         self.assertEqual(False, ipaddress.ip_network("::2").is_loopback)
1722         self.assertEqual(True, ipaddress.ip_network("0::0").is_unspecified)
1723         self.assertEqual(False, ipaddress.ip_network("::1").is_unspecified)
1724         self.assertEqual(False, ipaddress.ip_network("::/127").is_unspecified)
1725         self.assertEqual(True, ipaddress.ip_network("2001::1/128").is_private)
1726         self.assertEqual(True, ipaddress.ip_network("200::1/128").is_global)
1727         self.assertEqual(True, ipaddress.ip_address("ffff::").is_multicast)
1728         self.assertEqual(True, ipaddress.ip_address(2 ** 128 - 1).is_multicast)
1729         self.assertEqual(True, ipaddress.ip_address("ff00::").is_multicast)
1730         self.assertEqual(False, ipaddress.ip_address("fdff::").is_multicast)
1731         self.assertEqual(True, ipaddress.ip_address("fecf::").is_site_local)
1732         self.assertEqual(
1733             True, ipaddress.ip_address("feff:ffff:ffff:ffff::").is_site_local
1734         )
1735         self.assertEqual(False, ipaddress.ip_address("fbf:ffff::").is_site_local)
1736         self.assertEqual(False, ipaddress.ip_address("ff00::").is_site_local)
1737         self.assertEqual(True, ipaddress.ip_address("fc00::").is_private)
1738         self.assertEqual(True, ipaddress.ip_address("fc00:ffff:ffff:ffff::").is_private)
1739         self.assertEqual(False, ipaddress.ip_address("fbff:ffff::").is_private)
1740         self.assertEqual(False, ipaddress.ip_address("fe00::").is_private)
1741         self.assertEqual(True, ipaddress.ip_address("fea0::").is_link_local)
1742         self.assertEqual(True, ipaddress.ip_address("febf:ffff::").is_link_local)
1743         self.assertEqual(False, ipaddress.ip_address("fe7f:ffff::").is_link_local)
1744         self.assertEqual(False, ipaddress.ip_address("fec0::").is_link_local)
1745         self.assertEqual(True, ipaddress.ip_address("0:0::0:01").is_loopback)
1746         self.assertEqual(True, ipaddress.ip_address("::1").is_loopback)
1747         self.assertEqual(False, ipaddress.ip_address("::2").is_loopback)
1748         self.assertEqual(True, ipaddress.ip_address("0::0").is_unspecified)
1749         self.assertEqual(False, ipaddress.ip_address("::1").is_unspecified)
1750         self.assertEqual(True, ipaddress.ip_address("100::").is_reserved)
1751         self.assertEqual(True, ipaddress.ip_network("4000::1/128").is_reserved)
1752     def testIpv4Mapped(self):
1753         self.assertEqual(
1754             ipaddress.ip_address("::ffff:192.168.1.1").ipv4_mapped,
1755             ipaddress.ip_address("192.168.1.1"),
1756         )
1757         self.assertEqual(ipaddress.ip_address("::c0a8:101").ipv4_mapped, None)
1758         self.assertEqual(
1759             ipaddress.ip_address("::ffff:c0a8:101").ipv4_mapped,
1760             ipaddress.ip_address("192.168.1.1"),
1761         )
1762     def testAddrExclude(self):
1763         addr1 = ipaddress.ip_network("10.1.1.0/24")
1764         addr2 = ipaddress.ip_network("10.1.1.0/26")
1765         addr3 = ipaddress.ip_network("10.2.1.0/24")
1766         addr4 = ipaddress.ip_address("10.1.1.0")
1767         addr5 = ipaddress.ip_network("2001:db8::0/32")
1768         addr6 = ipaddress.ip_network("10.1.1.5/32")
1769         self.assertEqual(
1770             sorted(list(addr1.address_exclude(addr2))),
1771             [
1772                 ipaddress.ip_network("10.1.1.64/26"),
1773                 ipaddress.ip_network("10.1.1.128/25"),
1774             ],
1775         )
1776         self.assertRaises(ValueError, list, addr1.address_exclude(addr3))
1777         self.assertRaises(TypeError, list, addr1.address_exclude(addr4))
1778         self.assertRaises(TypeError, list, addr1.address_exclude(addr5))
1779         self.assertEqual(list(addr1.address_exclude(addr1)), [])
1780         self.assertEqual(
1781             sorted(list(addr1.address_exclude(addr6))),
1782             [
1783                 ipaddress.ip_network("10.1.1.0/30"),
1784                 ipaddress.ip_network("10.1.1.4/32"),
1785                 ipaddress.ip_network("10.1.1.6/31"),
1786                 ipaddress.ip_network("10.1.1.8/29"),
1787                 ipaddress.ip_network("10.1.1.16/28"),
1788                 ipaddress.ip_network("10.1.1.32/27"),
1789                 ipaddress.ip_network("10.1.1.64/26"),
1790                 ipaddress.ip_network("10.1.1.128/25"),
1791             ],
1792         )
1793     def testHash(self):
1794         self.assertEqual(
1795             hash(ipaddress.ip_interface("10.1.1.0/24")),
1796             hash(ipaddress.ip_interface("10.1.1.0/24")),
1797         )
1798         self.assertEqual(
1799             hash(ipaddress.ip_network("10.1.1.0/24")),
1800             hash(ipaddress.ip_network("10.1.1.0/24")),
1801         )
1802         self.assertEqual(
1803             hash(ipaddress.ip_address("10.1.1.0")),
1804             hash(ipaddress.ip_address("10.1.1.0")),
1805         )
1806         self.assertEqual(
1807             hash(ipaddress.ip_address("1.2.3.4")),
1808             hash(ipaddress.ip_address(int(ipaddress.ip_address("1.2.3.4")._ip))),
1809         )
1810         ip1 = ipaddress.ip_address("10.1.1.0")
1811         ip2 = ipaddress.ip_address("1::")
1812         dummy = {}
1813         dummy[self.ipv4_address] = None
1814         dummy[self.ipv6_address] = None
1815         dummy[ip1] = None
1816         dummy[ip2] = None
1817         self.assertIn(self.ipv4_address, dummy)
1818         self.assertIn(ip2, dummy)
1819     def testIPBases(self):
1820         net = self.ipv4_network
1821         self.assertEqual("1.2.3.0/24", net.compressed)
1822         net = self.ipv6_network
1823         self.assertRaises(ValueError, net._string_from_ip_int, 2 ** 128 + 1)
1824     def testIPv6NetworkHelpers(self):
1825         net = self.ipv6_network
1826         self.assertEqual("2001:658:22a:cafe::/64", net.with_prefixlen)
1827         self.assertEqual("2001:658:22a:cafe::/ffff:ffff:ffff:ffff::", net.with_netmask)
1828         self.assertEqual("2001:658:22a:cafe::/::ffff:ffff:ffff:ffff", net.with_hostmask)
1829         self.assertEqual("2001:658:22a:cafe::/64", str(net))
1830     def testIPv4NetworkHelpers(self):
1831         net = self.ipv4_network
1832         self.assertEqual("1.2.3.0/24", net.with_prefixlen)
1833         self.assertEqual("1.2.3.0/255.255.255.0", net.with_netmask)
1834         self.assertEqual("1.2.3.0/0.0.0.255", net.with_hostmask)
1835         self.assertEqual("1.2.3.0/24", str(net))
1836     def testCopyConstructor(self):
1837         addr1 = ipaddress.ip_network("10.1.1.0/24")
1838         addr2 = ipaddress.ip_network(addr1)
1839         addr3 = ipaddress.ip_interface("2001:658:22a:cafe:200::1/64")
1840         addr4 = ipaddress.ip_interface(addr3)
1841         addr5 = ipaddress.IPv4Address("1.1.1.1")
1842         addr6 = ipaddress.IPv6Address("2001:658:22a:cafe:200::1")
1843         self.assertEqual(addr1, addr2)
1844         self.assertEqual(addr3, addr4)
1845         self.assertEqual(addr5, ipaddress.IPv4Address(addr5))
1846         self.assertEqual(addr6, ipaddress.IPv6Address(addr6))
1847     def testCompressIPv6Address(self):
1848         test_addresses = {
1849             "1:2:3:4:5:6:7:8": "1:2:3:4:5:6:7:8/128",
1850             "2001:0:0:4:0:0:0:8": "2001:0:0:4::8/128",
1851             "2001:0:0:4:5:6:7:8": "2001::4:5:6:7:8/128",
1852             "2001:0:3:4:5:6:7:8": "2001:0:3:4:5:6:7:8/128",
1853             "0:0:3:0:0:0:0:ffff": "0:0:3::ffff/128",
1854             "0:0:0:4:0:0:0:ffff": "::4:0:0:0:ffff/128",
1855             "0:0:0:0:5:0:0:ffff": "::5:0:0:ffff/128",
1856             "1:0:0:4:0:0:7:8": "1::4:0:0:7:8/128",
1857             "0:0:0:0:0:0:0:0": "::/128",
1858             "0:0:0:0:0:0:0:0/0": "::/0",
1859             "0:0:0:0:0:0:0:1": "::1/128",
1860             "2001:0658:022a:cafe:0000:0000:0000:0000/66": "2001:658:22a:cafe::/66",
1861             "::1.2.3.4": "::102:304/128",
1862             "1:2:3:4:5:ffff:1.2.3.4": "1:2:3:4:5:ffff:102:304/128",
1863             "::7:6:5:4:3:2:1": "0:7:6:5:4:3:2:1/128",
1864             "::7:6:5:4:3:2:0": "0:7:6:5:4:3:2:0/128",
1865             "7:6:5:4:3:2:1::": "7:6:5:4:3:2:1:0/128",
1866             "0:6:5:4:3:2:1::": "0:6:5:4:3:2:1:0/128",
1867         }
1868         for uncompressed, compressed in list(test_addresses.items()):
1869             self.assertEqual(compressed, str(ipaddress.IPv6Interface(uncompressed)))
1870     def testExplodeShortHandIpStr(self):
1871         addr1 = ipaddress.IPv6Interface("2001::1")
1872         addr2 = ipaddress.IPv6Address("2001:0:5ef5:79fd:0:59d:a0e5:ba1")
1873         addr3 = ipaddress.IPv6Network("2001::/96")
1874         addr4 = ipaddress.IPv4Address("192.168.178.1")
1875         self.assertEqual("2001:0000:0000:0000:0000:0000:0000:0001/128", addr1.exploded)
1876         self.assertEqual(
1877             "0000:0000:0000:0000:0000:0000:0000:0001/128",
1878             ipaddress.IPv6Interface("::1/128").exploded,
1879         )
1880         self.assertEqual("2001:0000:5ef5:79fd:0000:059d:a0e5:0ba1", addr2.exploded)
1881         self.assertEqual("2001:0000:0000:0000:0000:0000:0000:0000/96", addr3.exploded)
1882         self.assertEqual("192.168.178.1", addr4.exploded)
1883     def testReversePointer(self):
1884         addr1 = ipaddress.IPv4Address("127.0.0.1")
1885         addr2 = ipaddress.IPv6Address("2001:db8::1")
1886         self.assertEqual("1.0.0.127.in-addr.arpa", addr1.reverse_pointer)
1887         self.assertEqual(
1888             "1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8."
1889             + "b.d.0.1.0.0.2.ip6.arpa",
1890             addr2.reverse_pointer,
1891         )
1892     def testIntRepresentation(self):
1893         self.assertEqual(16909060, int(self.ipv4_address))
1894         self.assertEqual(42540616829182469433547762482097946625, int(self.ipv6_address))
1895     def testForceVersion(self):
1896         self.assertEqual(ipaddress.ip_network(1).version, 4)
1897         self.assertEqual(ipaddress.IPv6Network(1).version, 6)
1898     def testWithStar(self):
1899         self.assertEqual(self.ipv4_interface.with_prefixlen, "1.2.3.4/24")
1900         self.assertEqual(self.ipv4_interface.with_netmask, "1.2.3.4/255.255.255.0")
1901         self.assertEqual(self.ipv4_interface.with_hostmask, "1.2.3.4/0.0.0.255")
1902         self.assertEqual(
1903             self.ipv6_interface.with_prefixlen, "2001:658:22a:cafe:200::1/64"
1904         )
1905         self.assertEqual(
1906             self.ipv6_interface.with_netmask,
1907             "2001:658:22a:cafe:200::1/ffff:ffff:ffff:ffff::",
1908         )
1909         self.assertEqual(
1910             self.ipv6_interface.with_hostmask,
1911             "2001:658:22a:cafe:200::1/::ffff:ffff:ffff:ffff",
1912         )
1913     def testNetworkElementCaching(self):
1914         self.assertNotIn("broadcast_address", self.ipv4_network._cache)
1915         self.assertNotIn("hostmask", self.ipv4_network._cache)
1916         self.assertEqual(
1917             self.ipv4_network.broadcast_address, ipaddress.IPv4Address("1.2.3.255")
1918         )
1919         self.assertEqual(self.ipv4_network.hostmask, ipaddress.IPv4Address("0.0.0.255"))
1920         self.assertIn("broadcast_address", self.ipv4_network._cache)
1921         self.assertIn("hostmask", self.ipv4_network._cache)
1922         self.assertNotIn("broadcast_address", self.ipv6_network._cache)
1923         self.assertNotIn("hostmask", self.ipv6_network._cache)
1924         self.assertEqual(
1925             self.ipv6_network.network_address,
1926             ipaddress.IPv6Address("2001:658:22a:cafe::"),
1927         )
1928         self.assertEqual(
1929             self.ipv6_interface.network.network_address,
1930             ipaddress.IPv6Address("2001:658:22a:cafe::"),
1931         )
1932         self.assertEqual(
1933             self.ipv6_network.broadcast_address,
1934             ipaddress.IPv6Address("2001:658:22a:cafe:ffff:ffff:ffff:ffff"),
1935         )
1936         self.assertEqual(
1937             self.ipv6_network.hostmask, ipaddress.IPv6Address("::ffff:ffff:ffff:ffff")
1938         )
1939         self.assertEqual(
1940             self.ipv6_interface.network.broadcast_address,
1941             ipaddress.IPv6Address("2001:658:22a:cafe:ffff:ffff:ffff:ffff"),
1942         )
1943         self.assertEqual(
1944             self.ipv6_interface.network.hostmask,
1945             ipaddress.IPv6Address("::ffff:ffff:ffff:ffff"),
1946         )
1947         self.assertIn("broadcast_address", self.ipv6_network._cache)
1948         self.assertIn("hostmask", self.ipv6_network._cache)
1949         self.assertIn("broadcast_address", self.ipv6_interface.network._cache)
1950         self.assertIn("hostmask", self.ipv6_interface.network._cache)
1951     def testTeredo(self):
1952         server = ipaddress.IPv4Address("65.54.227.120")
1953         client = ipaddress.IPv4Address("192.0.2.45")
1954         teredo_addr = "2001:0000:4136:e378:8000:63bf:3fff:fdd2"
1955         self.assertEqual((server, client), ipaddress.ip_address(teredo_addr).teredo)
1956         bad_addr = "2000::4136:e378:8000:63bf:3fff:fdd2"
1957         self.assertFalse(ipaddress.ip_address(bad_addr).teredo)
1958         bad_addr = "2001:0001:4136:e378:8000:63bf:3fff:fdd2"
1959         self.assertFalse(ipaddress.ip_address(bad_addr).teredo)
1960         teredo_addr = ipaddress.IPv6Address("2001:0:5ef5:79fd:0:59d:a0e5:ba1")
1961         self.assertEqual(
1962             (
1963                 ipaddress.IPv4Address("94.245.121.253"),
1964                 ipaddress.IPv4Address("95.26.244.94"),
1965             ),
1966             teredo_addr.teredo,
1967         )
1968     def testsixtofour(self):
1969         sixtofouraddr = ipaddress.ip_address("2002:ac1d:2d64::1")
1970         bad_addr = ipaddress.ip_address("2000:ac1d:2d64::1")
1971         self.assertEqual(
1972             ipaddress.IPv4Address("172.29.45.100"), sixtofouraddr.sixtofour
1973         )
1974         self.assertFalse(bad_addr.sixtofour)
1975     def testV4HashIsNotConstant(self):
1976         ipv4_address1 = ipaddress.IPv4Interface("1.2.3.4")
1977         ipv4_address2 = ipaddress.IPv4Interface("2.3.4.5")
1978         self.assertNotEqual(ipv4_address1.__hash__(), ipv4_address2.__hash__())
1979     def testV6HashIsNotConstant(self):
1980         ipv6_address1 = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1")
1981         ipv6_address2 = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:2")
1982         self.assertNotEqual(ipv6_address1.__hash__(), ipv6_address2.__hash__())
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
