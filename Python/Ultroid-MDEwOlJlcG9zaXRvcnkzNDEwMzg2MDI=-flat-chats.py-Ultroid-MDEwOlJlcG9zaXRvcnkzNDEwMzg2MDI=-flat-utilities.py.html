
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 16, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-chats.py</h3>
            <pre><code>1  from . import get_help
2  __doc__ = get_help("help_chats")
3  from telethon.errors import ChatAdminRequiredError as no_admin
4  from telethon.tl.functions.channels import (
5      CreateChannelRequest,
6      DeleteChannelRequest,
7      EditPhotoRequest,
8      GetFullChannelRequest,
9      UpdateUsernameRequest,
10  )
11  from telethon.tl.functions.messages import (
12      CreateChatRequest,
13      ExportChatInviteRequest,
14      GetFullChatRequest,
15  )
16  from telethon.tl.types import (
17      ChannelParticipantsKicked,
18      User,
19      UserStatusEmpty,
20      UserStatusLastMonth,
21      UserStatusLastWeek,
22      UserStatusOffline,
23      UserStatusOnline,
24      UserStatusRecently,
25  )
26  from . import HNDLR, LOGS, asst, con, get_string, mediainfo, os, types, udB, ultroid_cmd
27  @ultroid_cmd(
28      pattern="delchat",
29      groups_only=True,
30  )
31  async def _(e):
32      xx = await e.eor(get_string("com_1"))
33      try:
34          match = e.text.split(" ", maxsplit=1)[1]
35          chat = await e.client.parse_id(match)
36      except IndexError:
37          chat = e.chat_id
38      try:
39          await e.client(DeleteChannelRequest(chat))
40      except TypeError:
41          return await xx.eor(get_string("chats_1"), time=10)
42      except no_admin:
43          return await xx.eor(get_string("chats_2"), time=10)
44      await e.client.send_message(
45          int(udB.get_key("LOG_CHANNEL")), get_string("chats_6").format(e.chat_id)
46      )
47  @ultroid_cmd(
48      pattern="getlink( (.*)|$)",
49      groups_only=True,
50      manager=True,
51  )
52  async def _(e):
53      reply = await e.get_reply_message()
54      match = e.pattern_match.group(1).strip()
55      if reply and not isinstance(reply.sender, User):
56          chat = await reply.get_sender()
57      else:
58          chat = await e.get_chat()
59      if hasattr(chat, "username") and chat.username:
60          return await e.eor(f"Username: @{chat.username}")
61      request, usage, title, link = None, None, None, None
62      if match:
63          split = match.split(maxsplit=1)
64          request = split[0] in ["r", "request"]
65          title = "Created by Ultroid"
66          if len(split) > 1:
67              match = split[1]
68              spli = match.split(maxsplit=1)
69              if spli[0].isdigit():
70                  usage = int(spli[0])
71              if len(spli) > 1:
72                  title = spli[1]
73          elif not request:
74              if match.isdigit():
75                  usage = int(match)
76              else:
77                  title = match
78          if request and usage:
79              usage = 0
80      if request or title:
81          try:
82              r = await e.client(
83                  ExportChatInviteRequest(
84                      e.chat_id,
85                      request_needed=request,
86                      usage_limit=usage,
87                      title=title,
88                  ),
89              )
90          except no_admin:
91              return await e.eor(get_string("chats_2"), time=10)
92          link = r.link
93      else:
94          if isinstance(chat, types.Chat):
95              FC = await e.client(GetFullChatRequest(chat.id))
96          elif isinstance(chat, types.Channel):
97              FC = await e.client(GetFullChannelRequest(chat.id))
98          else:
99              return
100          Inv = FC.full_chat.exported_invite
101          if Inv and not Inv.revoked:
102              link = Inv.link
103      if link:
104          return await e.eor(f"Link:- {link}")
105      await e.eor("`Failed to getlink!\nSeems like link is inaccessible to you...`")
106  @ultroid_cmd(
107      pattern="create (b|g|c)(?: |$)(.*)",
108  )
109  async def _(e):
110      type_of_group = e.pattern_match.group(1).strip()
111      group_name = e.pattern_match.group(2)
112      username = None
113      if " ; " in group_name:
114          group_ = group_name.split(" ; ", maxsplit=1)
115          group_name = group_[0]
116          username = group_[1]
117      xx = await e.eor(get_string("com_1"))
118      if type_of_group == "b":
119          try:
120              r = await e.client(
121                  CreateChatRequest(
122                      users=[asst.me.username],
123                      title=group_name,
124                  ),
125              )
126              created_chat_id = r.chats[0].id
127              result = await e.client(
128                  ExportChatInviteRequest(
129                      peer=created_chat_id,
130                  ),
131              )
132              await xx.edit(
133                  get_string("chats_4").format(group_name, result.link),
134                  link_preview=False,
135              )
136          except Exception as ex:
137              await xx.edit(str(ex))
138      elif type_of_group in ["g", "c"]:
139          try:
140              r = await e.client(
141                  CreateChannelRequest(
142                      title=group_name,
143                      about=get_string("chats_5"),
144                      megagroup=type_of_group != "c",
145                  )
146              )
147              created_chat_id = r.chats[0].id
148              if username:
149                  await e.client(UpdateUsernameRequest(created_chat_id, username))
150                  result = f"https://t.me/{username}"
151              else:
152                  result = (
153                      await e.client(
154                          ExportChatInviteRequest(
155                              peer=created_chat_id,
156                          ),
157                      )
158                  ).link
159              await xx.edit(
160                  get_string("chats_6").format(f"[{group_name}]({result})"),
161                  link_preview=False,
162              )
163          except Exception as ex:
164              await xx.edit(str(ex))
165  @ultroid_cmd(
166      pattern="setgpic( (.*)|$)", admins_only=True, manager=True, require="change_info"
167  )
168  async def _(ult):
169      if not ult.is_reply:
170          return await ult.eor("`Reply to a Media..`", time=5)
171      match = ult.pattern_match.group(1).strip()
172      if not ult.client._bot and match:
173          try:
174              chat = await ult.client.parse_id(match)
175          except Exception as ok:
176              return await ult.eor(str(ok))
177      else:
178          chat = ult.chat_id
179      reply = await ult.get_reply_message()
180      if reply.photo or reply.sticker or reply.video:
181          replfile = await reply.download_media()
182      elif reply.document and reply.document.thumbs:
183          replfile = await reply.download_media(thumb=-1)
184      else:
185          return await ult.eor("Reply to a Photo or Video..")
186      mediain = mediainfo(reply.media)
187      if "animated" in mediain:
188          replfile = await con.convert(replfile, convert_to="mp4")
189      else:
190          replfile = await con.convert(
191              replfile, outname="chatphoto", allowed_formats=["jpg", "png", "mp4"]
192          )
193      file = await ult.client.upload_file(replfile)
194      try:
195          if "pic" not in mediain:
196              file = types.InputChatUploadedPhoto(video=file)
197          await ult.client(EditPhotoRequest(chat, file))
198          await ult.eor("`Group Photo has Successfully Changed !`", time=5)
199      except Exception as ex:
200          await ult.eor(f"Error occured.\n`{str(ex)}`", time=5)
201      os.remove(replfile)
202  @ultroid_cmd(
203      pattern="delgpic( (.*)|$)", admins_only=True, manager=True, require="change_info"
204  )
205  async def _(ult):
206      match = ult.pattern_match.group(1).strip()
207      chat = ult.chat_id
208      if not ult.client._bot and match:
209          chat = match
210      try:
211          await ult.client(EditPhotoRequest(chat, types.InputChatPhotoEmpty()))
212          text = "`Removed Chat Photo..`"
213      except Exception as E:
214          text = str(E)
215      return await ult.eor(text, time=5)
216  @ultroid_cmd(pattern="unbanall$", manager=True, admins_only=True, require="ban_users")
217  async def _(event):
218      xx = await event.eor("Searching Participant Lists.")
219      p = 0
220      title = (await event.get_chat()).title
221      async for i in event.client.iter_participants(
222          event.chat_id,
223          filter=ChannelParticipantsKicked,
224          aggressive=True,
225      ):
226          try:
227              await event.client.edit_permissions(event.chat_id, i, view_messages=True)
228              p += 1
229          except no_admin:
230              pass
231          except BaseException as er:
232              LOGS.exception(er)
233      await xx.eor(f"{title}: {p} unbanned", time=5)
234  @ultroid_cmd(
235      pattern="rmusers( (.*)|$)",
236      groups_only=True,
237      admins_only=True,
238      fullsudo=True,
239  )
240  async def _(event):
241      xx = await event.eor(get_string("com_1"))
242      input_str = event.pattern_match.group(1).strip()
243      p, a, b, c, d, m, n, y, w, o, q, r = 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
244      async for i in event.client.iter_participants(event.chat_id):
245          p += 1  # Total Count
246          if isinstance(i.status, UserStatusEmpty):
247              if "empty" in input_str:
248                  try:
249                      await event.client.kick_participant(event.chat_id, i)
250                      c += 1
251                  except BaseException:
252                      pass
253              else:
254                  y += 1
255          if isinstance(i.status, UserStatusLastMonth):
256              if "month" in input_str:
257                  try:
258                      await event.client.kick_participant(event.chat_id, i)
259                      c += 1
260                  except BaseException:
261                      pass
262              else:
263                  m += 1
264          if isinstance(i.status, UserStatusLastWeek):
265              if "week" in input_str:
266                  try:
267                      await event.client.kick_participant(event.chat_id, i)
268                      c += 1
269                  except BaseException:
270                      pass
271              else:
272                  w += 1
273          if isinstance(i.status, UserStatusOffline):
274              if "offline" in input_str:
275                  try:
276                      await event.client.kick_participant(event.chat_id, i)
277                      c += 1
278                  except BaseException:
279                      pass
280              else:
281                  o += 1
282          if isinstance(i.status, UserStatusOnline):
283              if "online" in input_str:
284                  try:
285                      await event.client.kick_participant(event.chat_id, i)
286                      c += 1
287                  except BaseException:
288                      pass
289              else:
290                  q += 1
291          if isinstance(i.status, UserStatusRecently):
292              if "recently" in input_str:
293                  try:
294                      await event.client.kick_participant(event.chat_id, i)
295                      c += 1
296                  except BaseException:
297                      pass
298              else:
299                  r += 1
300          if i.bot:
301              if "bot" in input_str:
302                  try:
303                      await event.client.kick_participant(event.chat_id, i)
304                      c += 1
305                  except BaseException:
306                      pass
307              else:
308                  b += 1
309          elif i.deleted:
310              if "deleted" in input_str:
311                  try:
312                      await event.client.kick_participant(event.chat_id, i)
313                      c += 1
314                  except BaseException:
315                      pass
316              else:
317                  d += 1
318          elif i.status is None:
319              if "none" in input_str:
320                  try:
321                      await event.client.kick_participant(event.chat_id, i)
322                      c += 1
323                  except BaseException:
324                      pass
325              else:
326                  n += 1
327      if input_str:
328          required_string = f"**>> Kicked** `{c} / {p}` **users**\n\n"
329      else:
330          required_string = f"**>> Total** `{p}` **users**\n\n"
331      required_string += f"  `{HNDLR}rmusers deleted`  **â€¢â€¢**  `{d}`\n"
332      required_string += f"  `{HNDLR}rmusers empty`  **â€¢â€¢**  `{y}`\n"
333      required_string += f"  `{HNDLR}rmusers month`  **â€¢â€¢**  `{m}`\n"
334      required_string += f"  `{HNDLR}rmusers week`  **â€¢â€¢**  `{w}`\n"
335      required_string += f"  `{HNDLR}rmusers offline`  **â€¢â€¢**  `{o}`\n"
336      required_string += f"  `{HNDLR}rmusers online`  **â€¢â€¢**  `{q}`\n"
<span onclick='openModal()' class='match'>337      required_string += f"  `{HNDLR}rmusers recently`  **â€¢â€¢**  `{r}`\n"
338      required_string += f"  `{HNDLR}rmusers bot`  **â€¢â€¢**  `{b}`\n"
339      required_string += f"  `{HNDLR}rmusers none`  **â€¢â€¢**  `{n}`"
340      await xx.eor(required_string)
</span></code></pre>
        </div>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-utilities.py</h3>
            <pre><code>1  import calendar
2  import html
3  import io
4  import os
5  import pathlib
6  import time
7  from datetime import datetime as dt
8  try:
9      from PIL import Image
10  except ImportError:
11      Image = None
12  from pyUltroid._misc._assistant import asst_cmd
13  from pyUltroid.dB.gban_mute_db import is_gbanned
14  from pyUltroid.fns.tools import get_chat_and_msgid
15  try:
16      from telegraph import upload_file as uf
17  except ImportError:
18      uf = None
19  from telethon.errors.rpcerrorlist import ChatForwardsRestrictedError, UserBotError
20  from telethon.events import NewMessage
21  from telethon.tl.custom import Dialog
22  from telethon.tl.functions.channels import (
23      GetAdminedPublicChannelsRequest,
24      InviteToChannelRequest,
25      LeaveChannelRequest,
26  )
27  from telethon.tl.functions.contacts import GetBlockedRequest
28  from telethon.tl.functions.messages import AddChatUserRequest, GetAllStickersRequest
29  from telethon.tl.functions.users import GetFullUserRequest
30  from telethon.tl.types import (
31      Channel,
32      Chat,
33      InputMediaPoll,
34      Poll,
35      PollAnswer,
36      TLObject,
37      User,
38  )
39  from telethon.utils import get_peer_id
40  from pyUltroid.fns.info import get_chat_info
41  from . import (
42      HNDLR,
43      LOGS,
44      Image,
45      ReTrieveFile,
46      Telegraph,
47      asst,
48      async_searcher,
49      bash,
50      check_filename,
51      eod,
52      eor,
53      get_paste,
54      get_string,
55      inline_mention,
56      json_parser,
57      mediainfo,
58      udB,
59      ultroid_cmd,
60  )
61  TMP_DOWNLOAD_DIRECTORY = "resources/downloads/"
62  _copied_msg = {}
63  @ultroid_cmd(pattern="kickme$", fullsudo=True)
64  async def leave(ult):
65      await ult.eor(f"`{ult.client.me.first_name} has left this group, bye!!.`")
66      await ult.client(LeaveChannelRequest(ult.chat_id))
67  @ultroid_cmd(
68      pattern="date$",
69  )
70  async def date(event):
71      m = dt.now().month
72      y = dt.now().year
73      d = dt.now().strftime("Date - %B %d, %Y\nTime- %H:%M:%S")
74      k = calendar.month(y, m)
75      await event.eor(f"`{k}\n\n{d}`")
76  @ultroid_cmd(
77      pattern="listreserved$",
78  )
79  async def _(event):
80      result = await event.client(GetAdminedPublicChannelsRequest())
81      if not result.chats:
82          return await event.eor("`No username Reserved`")
83      output_str = "".join(
84          f"- {channel_obj.title} @{channel_obj.username} \n"
85          for channel_obj in result.chats
86      )
87      await event.eor(output_str)
88  @ultroid_cmd(
89      pattern="stats$",
90  )
91  async def stats(
92      event: NewMessage.Event,
93  ):
94      ok = await event.eor("`Collecting stats...`")
95      start_time = time.time()
96      private_chats = 0
97      bots = 0
98      groups = 0
99      broadcast_channels = 0
100      admin_in_groups = 0
101      creator_in_groups = 0
102      admin_in_broadcast_channels = 0
103      creator_in_channels = 0
104      unread_mentions = 0
105      unread = 0
106      dialog: Dialog
107      async for dialog in event.client.iter_dialogs():
108          entity = dialog.entity
109          if isinstance(entity, Channel) and entity.broadcast:
110              broadcast_channels += 1
111              if entity.creator or entity.admin_rights:
112                  admin_in_broadcast_channels += 1
113              if entity.creator:
114                  creator_in_channels += 1
115          elif (isinstance(entity, Channel) and entity.megagroup) or isinstance(
116              entity, Chat
117          ):
118              groups += 1
119              if entity.creator or entity.admin_rights:
120                  admin_in_groups += 1
121              if entity.creator:
122                  creator_in_groups += 1
123          elif isinstance(entity, User):
124              private_chats += 1
125              if entity.bot:
126                  bots += 1
127          unread_mentions += dialog.unread_mentions_count
128          unread += dialog.unread_count
129      stop_time = time.time() - start_time
130      try:
131          ct = (await event.client(GetBlockedRequest(1, 0))).count
132      except AttributeError:
133          ct = 0
134      try:
135          sp = await event.client(GetAllStickersRequest(0))
136          sp_count = len(sp.sets)
137      except BaseException:
138          sp_count = 0
139      full_name = inline_mention(event.client.me)
140      response = f"ðŸ”¸ **Stats for {full_name}** \n\n"
141      response += f"**Private Chats:** {private_chats} \n"
142      response += f"**  â€¢â€¢ **`Users: {private_chats - bots}` \n"
143      response += f"**  â€¢â€¢ **`Bots: {bots}` \n"
144      response += f"**Groups:** {groups} \n"
145      response += f"**Channels:** {broadcast_channels} \n"
146      response += f"**Admin in Groups:** {admin_in_groups} \n"
147      response += f"**  â€¢â€¢ **`Creator: {creator_in_groups}` \n"
148      response += f"**  â€¢â€¢ **`Admin Rights: {admin_in_groups - creator_in_groups}` \n"
149      response += f"**Admin in Channels:** {admin_in_broadcast_channels} \n"
150      response += f"**  â€¢â€¢ **`Creator: {creator_in_channels}` \n"
151      response += f"**  â€¢â€¢ **`Admin Rights: {admin_in_broadcast_channels - creator_in_channels}` \n"
152      response += f"**Unread:** {unread} \n"
153      response += f"**Unread Mentions:** {unread_mentions} \n"
<span onclick='openModal()' class='match'>154      response += f"**Blocked Users:** {ct}\n"
155      response += f"**Total Stickers Pack Installed :** `{sp_count}`\n\n"
156      response += f"**__It Took:__** {stop_time:.02f}s \n"
157      await ok.edit(response)
158  @ultroid_cmd(pattern="paste( (.*)|$)", manager=True, allow_all=True)
</span>159  async def _(event):
160      try:
161          input_str = event.text.split(maxsplit=1)[1]
162      except IndexError:
163          input_str = None
164      xx = await event.eor("` ã€Š Pasting... ã€‹ `")
165      downloaded_file_name = None
166      if input_str:
167          message = input_str
168      elif event.reply_to_msg_id:
169          previous_message = await event.get_reply_message()
170          if previous_message.media:
171              downloaded_file_name = await event.client.download_media(
172                  previous_message,
173                  "./resources/downloads",
174              )
175              with open(downloaded_file_name, "r") as fd:
176                  message = fd.read()
177              os.remove(downloaded_file_name)
178          else:
179              message = previous_message.message
180      else:
181          message = None
182      if not message:
183          return await xx.eor(
184              "`Reply to a Message/Document or Give me Some Text !`", time=5
185          )
186      done, key = await get_paste(message)
187      if not done:
188          return await xx.eor(key)
189      link = f"https://spaceb.in/{key}"
190      raw = f"https://spaceb.in/api/v1/documents/{key}/raw"
191      reply_text = (
192          f"â€¢ **Pasted to SpaceBin :** [Space]({link})\nâ€¢ **Raw Url :** : [Raw]({raw})"
193      )
194      try:
195          if event.client._bot:
196              return await xx.eor(reply_text)
197          ok = await event.client.inline_query(asst.me.username, f"pasta-{key}")
198          await ok[0].click(event.chat_id, reply_to=event.reply_to_msg_id, hide_via=True)
199          await xx.delete()
200      except BaseException as e:
201          LOGS.exception(e)
202          await xx.edit(reply_text)
203  @ultroid_cmd(
204      pattern="info( (.*)|$)",
205      manager=True,
206  )
207  async def _(event):
208      if match := event.pattern_match.group(1).strip():
209          try:
210              user = await event.client.parse_id(match)
211          except Exception as er:
212              return await event.eor(str(er))
213      elif event.is_reply:
214          rpl = await event.get_reply_message()
215          user = rpl.sender_id
216      else:
217          user = event.chat_id
218      xx = await event.eor(get_string("com_1"))
219      try:
220          _ = await event.client.get_entity(user)
221      except Exception as er:
222          return await xx.edit(f"**ERROR :** {er}")
223      if not isinstance(_, User):
224          try:
225              peer = get_peer_id(_)
226              photo, capt = await get_chat_info(_, event)
227              if is_gbanned(peer):
228                  capt += "\nâ€¢<b> Is Gbanned:</b> <code>True</code>"
229              if not photo:
230                  return await xx.eor(capt, parse_mode="html")
231              await event.client.send_message(
232                  event.chat_id, capt[:1024], file=photo, parse_mode="html"
233              )
234              await xx.delete()
235          except Exception as er:
236              await event.eor("**ERROR ON CHATINFO**\n" + str(er))
237          return
238      try:
239          full_user = (await event.client(GetFullUserRequest(user))).full_user
240      except Exception as er:
241          return await xx.edit(f"ERROR : {er}")
242      user = _
243      user_photos = (
244          await event.client.get_profile_photos(user.id, limit=0)
245      ).total or "NaN"
246      user_id = user.id
247      first_name = html.escape(user.first_name)
248      if first_name is not None:
249          first_name = first_name.replace("\u2060", "")
250      last_name = user.last_name
251      last_name = (
252          last_name.replace("\u2060", "") if last_name else ("Last Name not found")
253      )
254      user_bio = full_user.about
255      if user_bio is not None:
256          user_bio = html.escape(full_user.about)
257      common_chats = full_user.common_chats_count
258      if user.photo:
259          dc_id = user.photo.dc_id
260      else:
261          dc_id = "Need a Profile Picture to check this"
262      caption = .format(
263          user_id,
264          user_id,
265          first_name,
266          last_name,
267          user_bio,
268          dc_id,
269          user_photos,
270          user.restricted,
271          user.verified,
272          user.premium,
273          user.bot,
274          common_chats,
275      )
276      if chk := is_gbanned(user_id):
277          caption += f
278      await event.client.send_message(
279          event.chat_id,
280          caption,
281          reply_to=event.reply_to_msg_id,
282          parse_mode="HTML",
283          file=full_user.profile_photo,
284          force_document=False,
285          silent=True,
286      )
287      await xx.delete()
288  @ultroid_cmd(
289      pattern="invite( (.*)|$)",
290      groups_only=True,
291  )
292  async def _(ult):
293      xx = await ult.eor(get_string("com_1"))
294      to_add_users = ult.pattern_match.group(1).strip()
295      if not ult.is_channel and ult.is_group:
296          for user_id in to_add_users.split(" "):
297              try:
298                  await ult.client(
299                      AddChatUserRequest(
300                          chat_id=ult.chat_id,
301                          user_id=await ult.client.parse_id(user_id),
302                          fwd_limit=1000000,
303                      ),
304                  )
305                  await xx.edit(f"Successfully invited `{user_id}` to `{ult.chat_id}`")
306              except Exception as e:
307                  await xx.edit(str(e))
308      else:
309          for user_id in to_add_users.split(" "):
310              try:
311                  await ult.client(
312                      InviteToChannelRequest(
313                          channel=ult.chat_id,
314                          users=[await ult.client.parse_id(user_id)],
315                      ),
316                  )
317                  await xx.edit(f"Successfully invited `{user_id}` to `{ult.chat_id}`")
318              except UserBotError:
319                  await xx.edit(
320                      f"Bots can only be added as Admins in Channel.\nBetter Use `{HNDLR}promote {user_id}`"
321                  )
322              except Exception as e:
323                  await xx.edit(str(e))
324  @ultroid_cmd(
325      pattern="rmbg($| (.*))",
326  )
327  async def abs_rmbg(event):
328      RMBG_API = udB.get_key("RMBG_API")
329      if not RMBG_API:
330          return await event.eor(
331              "Get your API key from [here](https://www.remove.bg/) for this plugin to work.",
332          )
333      match = event.pattern_match.group(1).strip()
334      reply = await event.get_reply_message()
335      if match and os.path.exists(match):
336          dl = match
337      elif reply and reply.media:
338          if reply.document and reply.document.thumbs:
339              dl = await reply.download_media(thumb=-1)
340          else:
341              dl = await reply.download_media()
342      else:
343          return await eod(
344              event, f"Use `{HNDLR}rmbg` as reply to a pic to remove its background."
345          )
346      if not (dl and dl.endswith(("webp", "jpg", "png", "jpeg"))):
347          os.remove(dl)
348          return await event.eor(get_string("com_4"))
349      if dl.endswith("webp"):
350          file = f"{dl}.png"
351          Image.open(dl).save(file)
352          os.remove(dl)
353          dl = file
354      xx = await event.eor("`Sending to remove.bg`")
355      dn, out = await ReTrieveFile(dl)
356      os.remove(dl)
357      if not dn:
358          dr = out["errors"][0]
359          de = dr.get("detail", "")
360          return await xx.edit(
361              f"**ERROR ~** `{dr['title']}`,\n`{de}`",
362          )
363      zz = Image.open(out)
364      if zz.mode != "RGB":
365          zz.convert("RGB")
366      wbn = check_filename("ult-rmbg.webp")
367      zz.save(wbn, "webp")
368      await event.client.send_file(
369          event.chat_id,
370          out,
371          force_document=True,
372          reply_to=reply,
373      )
374      await event.client.send_file(event.chat_id, wbn, reply_to=reply)
375      os.remove(out)
376      os.remove(wbn)
377      await xx.delete()
378  @ultroid_cmd(
379      pattern="telegraph( (.*)|$)",
380  )
381  async def telegraphcmd(event):
382      xx = await event.eor(get_string("com_1"))
383      match = event.pattern_match.group(1).strip() or "Ultroid"
384      reply = await event.get_reply_message()
385      if not reply:
386          return await xx.eor("`Reply to Message.`")
387      if not reply.media and reply.message:
388          content = reply.message
389      else:
390          getit = await reply.download_media()
391          dar = mediainfo(reply.media)
392          if dar == "sticker":
393              file = f"{getit}.png"
394              Image.open(getit).save(file)
395              os.remove(getit)
396              getit = file
397          elif dar.endswith("animated"):
398              file = f"{getit}.gif"
399              await bash(f"lottie_convert.py '{getit}' {file}")
400              os.remove(getit)
401              getit = file
402          if "document" not in dar:
403              try:
404                  nn = f"https://graph.org{uf(getit)[0]}"
405                  amsg = f"Uploaded to [Telegraph]({nn}) !"
406              except Exception as e:
407                  amsg = f"Error : {e}"
408              os.remove(getit)
409              return await xx.eor(amsg)
410          content = pathlib.Path(getit).read_text()
411          os.remove(getit)
412      makeit = Telegraph.create_page(title=match, content=[content])
413      await xx.eor(
414          f"Pasted to Telegraph : [Telegraph]({makeit['url']})", link_preview=False
415      )
416  @ultroid_cmd(pattern="json( (.*)|$)")
417  async def _(event):
418      reply_to_id = None
419      match = event.pattern_match.group(1).strip()
420      if event.reply_to_msg_id:
421          msg = await event.get_reply_message()
422          reply_to_id = event.reply_to_msg_id
423      else:
424          msg = event
425          reply_to_id = event.message.id
426      if match and hasattr(msg, match.split()[0]):
427          msg = getattr(msg, match.split()[0])
428          try:
429              if hasattr(msg, "to_json"):
430                  msg = msg.to_json(ensure_ascii=False, indent=1)
431              elif hasattr(msg, "to_dict"):
432                  msg = json_parser(msg.to_dict(), indent=1)
433              else:
434                  msg = TLObject.stringify(msg)
435          except Exception:
436              pass
437          msg = str(msg)
438      else:
439          msg = json_parser(msg.to_json(), indent=1)
440      if "-t" in match:
441          try:
442              data = json_parser(msg)
443              msg = json_parser(
444                  {key: data[key] for key in data.keys() if data[key]}, indent=1
445              )
446          except Exception:
447              pass
448      if len(msg) > 4096:
449          with io.BytesIO(str.encode(msg)) as out_file:
450              out_file.name = "json-ult.txt"
451              await event.client.send_file(
452                  event.chat_id,
453                  out_file,
454                  force_document=True,
455                  allow_cache=False,
456                  reply_to=reply_to_id,
457              )
458              await event.delete()
459      else:
460          await event.eor(f"```{msg or None}```")
461  @ultroid_cmd(pattern="suggest( (.*)|$)", manager=True)
462  async def sugg(event):
463      sll = event.text.split(maxsplit=1)
464      try:
465          text = sll[1]
466      except IndexError:
467          text = None
468      if not (event.is_reply or text):
469          return await eod(
470              event,
471              "`Please reply to a message to make a suggestion poll!`",
472          )
473      if event.is_reply and not text:
474          reply = await event.get_reply_message()
475          if reply.text and len(reply.text) < 35:
476              text = reply.text
477          else:
478              text = "Do you Agree to Replied Suggestion ?"
479      reply_to = event.reply_to_msg_id if event.is_reply else event.id
480      try:
481          await event.client.send_file(
482              event.chat_id,
483              file=InputMediaPoll(
484                  poll=Poll(
485                      id=12345,
486                      question=text,
487                      answers=[PollAnswer("Yes", b"1"), PollAnswer("No", b"2")],
488                  ),
489              ),
490              reply_to=reply_to,
491          )
492      except Exception as e:
493          return await eod(event, f"`Oops, you can't send polls here!\n\n{e}`")
494      await event.delete()
495  @ultroid_cmd(pattern="ipinfo( (.*)|$)")
496  async def ipinfo(event):
497      ip = event.text.split()
498      ipaddr = ""
499      try:
500          ipaddr = f"/{ip[1]}"
501      except IndexError:
502          ipaddr = ""
503      det = await async_searcher(f"https://ipinfo.io{ipaddr}/geo", re_json=True)
504      try:
505          ip = det["ip"]
506          city = det["city"]
507          region = det["region"]
508          country = det["country"]
509          cord = det["loc"]
510          try:
511              zipc = det["postal"]
512          except KeyError:
513              zipc = "None"
514          tz = det["timezone"]
515          await eor(
516              event,
517              .format(
518                  ip,
519                  city,
520                  region,
521                  country,
522                  cord,
523                  zipc,
524                  tz,
525              ),
526          )
527      except BaseException:
528          err = det["error"]["title"]
529          msg = det["error"]["message"]
530          await event.eor(f"ERROR:\n{err}\n{msg}", time=5)
531  @ultroid_cmd(
532      pattern="cpy$",
533  )
534  async def copp(event):
535      msg = await event.get_reply_message()
536      if not msg:
537          return await event.eor(f"Use `{HNDLR}cpy` as reply to a message!", time=5)
538      _copied_msg["CLIPBOARD"] = msg
539      await event.eor(f"Copied. Use `{HNDLR}pst` to paste!", time=10)
540  @asst_cmd(pattern="pst$")
541  async def pepsodent(event):
542      await toothpaste(event)
543  @ultroid_cmd(
544      pattern="pst$",
545  )
546  async def colgate(event):
547      await toothpaste(event)
548  async def toothpaste(event):
549      try:
550          await event.respond(_copied_msg["CLIPBOARD"])
551      except KeyError:
552          return await eod(
553              event,
554              f"Nothing was copied! Use `{HNDLR}cpy` as reply to a message first!",
555          )
556      except Exception as ex:
557          return await event.eor(str(ex), time=5)
558      await event.delete()
559  @ultroid_cmd(pattern="thumb$")
560  async def thumb_dl(event):
561      reply = await event.get_reply_message()
562      if not (reply and reply.file):
563          return await eod(event, get_string("th_1"), time=5)
564      if not reply.file.media.thumbs:
565          return await eod(event, get_string("th_2"))
566      await event.eor(get_string("com_1"))
567      x = await event.get_reply_message()
568      m = await x.download_media(thumb=-1)
569      await event.reply(file=m)
570      os.remove(m)
571  @ultroid_cmd(pattern="getmsg( ?(.*)|$)")
572  async def get_restriced_msg(event):
573      match = event.pattern_match.group(1).strip()
574      if not match:
575          await event.eor("`Please provide a link!`", time=5)
576          return
577      xx = await event.eor(get_string("com_1"))
578      chat, msg = get_chat_and_msgid(match)
579      if not (chat and msg):
580          return await event.eor(
581              f"{get_string('gms_1')}!\nEg: `https://t.me/TeamUltroid/3 or `https://t.me/c/1313492028/3`"
582          )
583      try:
584          message = await event.client.get_messages(chat, ids=msg)
585      except BaseException as er:
586          return await event.eor(f"**ERROR**\n`{er}`")
587      try:
588          await event.client.send_message(event.chat_id, message)
589          await xx.try_delete()
590          return
591      except ChatForwardsRestrictedError:
592          pass
593      if message.media:
594          thumb = None
595          if message.document.thumbs:
596              thumb = await message.download_media(thumb=-1)
597          media, _ = await event.client.fast_downloader(
598              message.document,
599              show_progress=True,
600              event=xx,
601              message=f"Downloading {message.file.name}...",
602          )
603          await xx.edit("`Uploading...`")
604          uploaded, _ = await event.client.fast_uploader(
605              media.name, event=xx, show_progress=True, to_delete=True
606          )
607          typ = not bool(message.video)
608          await event.reply(
609              message.text,
610              file=uploaded,
611              supports_streaming=typ,
612              force_document=typ,
613              thumb=thumb,
614              attributes=message.document.attributes,
615          )
616          await xx.delete()
617          if thumb:
618              os.remove(thumb)
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-chats.py</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-utilities.py</div>
                </div>
                <div class="column column_space"><pre><code>337      required_string += f"  `{HNDLR}rmusers recently`  **â€¢â€¢**  `{r}`\n"
338      required_string += f"  `{HNDLR}rmusers bot`  **â€¢â€¢**  `{b}`\n"
339      required_string += f"  `{HNDLR}rmusers none`  **â€¢â€¢**  `{n}`"
340      await xx.eor(required_string)
</pre></code></div>
                <div class="column column_space"><pre><code>154      response += f"**Blocked Users:** {ct}\n"
155      response += f"**Total Stickers Pack Installed :** `{sp_count}`\n\n"
156      response += f"**__It Took:__** {stop_time:.02f}s \n"
157      await ok.edit(response)
158  @ultroid_cmd(pattern="paste( (.*)|$)", manager=True, allow_all=True)
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    