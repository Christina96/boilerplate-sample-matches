<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for mkrelease.py & test_failuredetail_plugin.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for mkrelease.py & test_failuredetail_plugin.py
      </h3>
      <h1 align="center">
        16.1%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>mkrelease.py (16.438356%)<TH>test_failuredetail_plugin.py (15.789474%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match185-0.html#0',2,'match185-1.html#0',3)" NAME="0">(5-13)<TD><A HREF="javascript:ZweiFrames('match185-0.html#0',2,'match185-1.html#0',3)" NAME="0">(2-8)</A><TD ALIGN=center><FONT COLOR="#ff0000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>mkrelease.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
#!/usr/bin/env python2.6
<A NAME="0"></A>#
#
# create and upload a release
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match185-1.html#0',3,'match185-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>import os
import sys
import urllib
from urllib2 import urlopen
from commands import getstatusoutput

success = 0

sys.path.insert(0, os.path.dirname(</B></FONT>os.path.dirname(__file__)))
import nose
version = nose.__version__

SIMULATE = 'exec' not in sys.argv
if SIMULATE:
    print(&quot;# simulated run: run as scripts/mkrelease.py exec &quot;
          &quot;to execute commands&quot;)


def runcmd(cmd):
    print cmd
    if not SIMULATE:
        (status,output) = getstatusoutput(cmd)
        if status != success:
            sys.stderr.write(output)
            sys.stderr.write(&quot;\n&quot;)
            raise Exception('command did not exit successfully')


def cd(dir):
    print &quot;cd %s&quot; % dir
    if not SIMULATE:
        os.chdir(dir)


def main():
    tag = 'release_%s' % version

    # create tag
    runcmd(&quot;hg tag -fm 'Tagged release %s' %s&quot; %
           (version, tag))

    # clone a fresh copy
    runcmd('hg clone -r %s . /tmp/nose_%s' % (tag, tag))

    # build release in clone
    cd('/tmp/nose_%s' % tag)

    # remove dev tag from setup
    runcmd('cp setup.cfg.release setup.cfg')

    # build included docs, run tests
    runcmd('tox')

    # make the distributions
    runcmd('python setup.py sdist upload -s')
    # TODO(Kumar) put this back when this bug is fixed:
    # http://bugs.python.org/issue10571
    # runcmd('python3.2 setup.py bdist_egg upload -s')
    runcmd('python setup.py register')

    rtd = 'http://readthedocs.org/build/1137'
    print 'POST %s' % rtd
    if not SIMULATE:
        u = urlopen(rtd,
                    # send dummy params to force a POST
                    urllib.urlencode({'build': 1}))
        print u.read()
        u.close()

    print '*'
    print &quot;* it's live! Now you can show/hide old releases on PyPI&quot;
    print '*'

if __name__ == '__main__':
    main()
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_failuredetail_plugin.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
<A NAME="0"></A>import os
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match185-0.html#0',2,'match185-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>import sys
import unittest
from nose.plugins.failuredetail import FailureDetail
from nose.plugins.capture import Capture
from nose.plugins import PluginTester

support = os.path.join(os.path.dirname(</B></FONT>__file__), 'support')

class TestFailureDetail(PluginTester, unittest.TestCase):
    activate = &quot;-d&quot;
    args = ['-v']
    plugins = [FailureDetail()]
    suitepath = os.path.join(support, 'fdp')

    def runTest(self):
        print '*' * 70
        print str(self.output)
        print '*' * 70

        expect = \
        'AssertionError: a is not 4\n'
        '    print &quot;Hello&quot;\n'
        '    2 = 2\n'
        '&gt;&gt;  assert 2 == 4, &quot;a is not 4&quot;'

        assert expect in self.output


class TestFailureDetailWithCapture(PluginTester, unittest.TestCase):
    activate = &quot;-d&quot;
    args = ['-v']
    plugins = [FailureDetail(), Capture()]
    suitepath = os.path.join(support, 'fdp/test_fdp_no_capt.py')

    def runTest(self):
        print '*' * 70
        print str(self.output)
        print '*' * 70

        expect = \
        'AssertionError: a is not 4\n'
        '    print &quot;Hello&quot;\n'
        '    2 = 2\n'
        '&gt;&gt;  assert 2 == 4, &quot;a is not 4&quot;'

        assert expect in self.output

class TestFailureDetailWithUnicodeAndCapture(PluginTester, unittest.TestCase):
    activate = &quot;-d&quot;
    args = ['-v']
    plugins = [FailureDetail(), Capture()]
    suitepath = os.path.join(support, 'issue720')

    def runTest(self):
        print '*' * 70
        print str(self.output)
        print '*' * 70

        assert 'UnicodeDecodeError' not in self.output
        assert 'UnicodeEncodeError' not in self.output

if __name__ == '__main__':
    unittest.main()
</PRE>
</div>
  </div>
</body>
</html>
