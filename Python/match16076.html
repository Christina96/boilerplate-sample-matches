<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_glusterfs.py &amp; test_influxdb08_user.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_glusterfs.py &amp; test_influxdb08_user.py
      </h3>
<h1 align="center">
        11.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_glusterfs.py (7.0198674%)<th>test_influxdb08_user.py (33.75796%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(235-243)<td><a href="#" name="0">(42-47)</a><td align="center"><font color="#ff0000">15</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(216-223)<td><a href="#" name="1">(37-41)</a><td align="center"><font color="#dd0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(83-88)<td><a href="#" name="2">(77-81)</a><td align="center"><font color="#dd0000">13</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(20-33)<td><a href="#" name="3">(57-69)</a><td align="center"><font color="#cc0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_glusterfs.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.glusterfs as mod_glusterfs
2 import salt.states.glusterfs as glusterfs
3 import salt.utils.cloud
4 import salt.utils.network
5 from tests.support.mixins import LoaderModuleMockMixin
6 from tests.support.mock import MagicMock, patch
7 from tests.support.unit import TestCase
8 class GlusterfsTestCase(TestCase, LoaderModuleMockMixin):
9         return {glusterfs: {"__salt__": {"glusterfs.peer": mod_glusterfs.<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>peer}}}
10     def test_peered(self):
11         name = "server1"
12         ret = {"name": name, "result": True, "comment": "", "changes": {}}
13         mock_ip = MagicMock(return_value=["1.2.3.4", "1.2.3.5"])
14         mock_ip6 = MagicMock(return_value=</b></font>["2001:db8::1"])
15         mock_host_ips = MagicMock(return_value=["1.2.3.5"])
16         mock_peer = MagicMock(return_value=True)
17         mock_status = MagicMock(return_value={"uuid1": {"hostnames": [name]}})
18         with patch.dict(
19             glusterfs.__salt__,
20             {"glusterfs.peer_status": mock_status, "glusterfs.peer": mock_peer},
21         ):
22             with patch.object(salt.utils.network, "ip_addrs", mock_ip), patch.object(
23                 salt.utils.network, "ip_addrs6", mock_ip6
24             ), patch.object(salt.utils.network, "host_to_ips", mock_host_ips):
25                 comt = "Peering with localhost is not needed"
26                 ret.update({"comment": comt})
27                 self.assertDictEqual(glusterfs.peered(name), ret)
28                 mock_host_ips.return_value = ["2001:db8::1"]
29                 self.assertDictEqual(glusterfs.peered(name), ret)
30                 mock_host_ips.return_value = ["1.2.3.42"]
31                 comt = "Host {} already peered".format(name)
32                 ret.update({"comment": comt})
33                 self.assertDictEqual(glusterfs.peered(name), ret)
34                 with patch.dict(glusterfs.__opts__, {"test": False}):
35                     old = {"uuid1": {"hostnames": ["other1"]}}
36                     new = {
37                         "uuid1": {"hostnames": ["other1"]},
38                         "uuid2": {"hostnames": ["someAlias", name]},
39                     }
40                     mock_status.side_effect = [old, new]
41                     comt = "Host {} successfully peered".format(name)
42                     ret.update({"comment": comt, "changes": {"old": old, "new": new}})
43                     self.assertDictEqual(glusterfs.peered(name), ret)
44                     mock_status.side_effect = None
45                     mock_status.return_value = {"uuid1": {"hostnames": ["other"]}}
46                     mock_peer.return_value = False
47                     ret.update({"result": False})
48                     comt = (
49                         "Failed to peer with {0}," + " please check logs for errors"
50                     ).format(name)
51                     ret.update({"comment": comt, "changes": {}})
52                     self.assertDictEqual(glusterfs.peered(name), ret)
53 <a name="2"></a>                    comt = "Invalid characters in peer name."
54                     ret.update({"comment": comt, "name": ":/"})
55                     self.assertDictEqual(glusterfs.peered(":/"), ret)
56                     ret.update({"<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>name": name})
57                 with patch.dict(glusterfs.__opts__, {"test": True}):
58                     comt = "Peer {} will be added.".format(name)
59                     ret.update({"comment": comt, "result": None})
60                     self.</b></font>assertDictEqual(glusterfs.peered(name), ret)
61     def test_volume_present(self):
62         name = "salt"
63         bricks = ["host1:/brick1"]
64         ret = {"name": name, "result": True, "comment": "", "changes": {}}
65         started_info = {name: {"status": "1"}}
66         stopped_info = {name: {"status": "0"}}
67         mock_info = MagicMock()
68         mock_list = MagicMock()
69         mock_create = MagicMock()
70         mock_start = MagicMock(return_value=True)
71         with patch.dict(
72             glusterfs.__salt__,
73             {
74                 "glusterfs.info": mock_info,
75                 "glusterfs.list_volumes": mock_list,
76                 "glusterfs.create_volume": mock_create,
77                 "glusterfs.start_volume": mock_start,
78             },
79         ):
80             with patch.dict(glusterfs.__opts__, {"test": False}):
81                 mock_list.return_value = [name]
82                 mock_info.return_value = started_info
83                 comt = "Volume {} already exists and is started".format(name)
84                 ret.update({"comment": comt})
85                 self.assertDictEqual(
86                     glusterfs.volume_present(name, bricks, start=True), ret
87                 )
88                 mock_info.return_value = stopped_info
89                 comt = "Volume {} already exists and is now started".format(name)
90                 ret.update(
91                     {"comment": comt, "changes": {"old": "stopped", "new": "started"}}
92                 )
93                 self.assertDictEqual(
94                     glusterfs.volume_present(name, bricks, start=True), ret
95                 )
96                 comt = "Volume {} already exists".format(name)
97                 ret.update({"comment": comt, "changes": {}})
98                 self.assertDictEqual(
99                     glusterfs.volume_present(name, bricks, start=False), ret
100                 )
101             with patch.dict(glusterfs.__opts__, {"test": True}):
102                 comt = "Volume {} already exists".format(name)
103                 ret.update({"comment": comt, "result": None})
104                 self.assertDictEqual(
105                     glusterfs.volume_present(name, bricks, start=False), ret
106                 )
107                 comt = ("Volume {0} already exists" + " and will be started").format(
108                     name
109                 )
110                 ret.update({"comment": comt, "result": None})
111                 self.assertDictEqual(
112                     glusterfs.volume_present(name, bricks, start=True), ret
113                 )
114                 mock_list.return_value = []
115                 comt = "Volume {} will be created".format(name)
116                 ret.update({"comment": comt, "result": None})
117                 self.assertDictEqual(
118                     glusterfs.volume_present(name, bricks, start=False), ret
119                 )
120                 comt = ("Volume {0} will be created" + " and started").format(name)
121                 ret.update({"comment": comt, "result": None})
122                 self.assertDictEqual(
123                     glusterfs.volume_present(name, bricks, start=True), ret
124                 )
125             with patch.dict(glusterfs.__opts__, {"test": False}):
126                 mock_list.side_effect = [[], [name]]
127                 comt = "Volume {} is created".format(name)
128                 ret.update(
129                     {
130                         "comment": comt,
131                         "result": True,
132                         "changes": {"old": [], "new": [name]},
133                     }
134                 )
135                 self.assertDictEqual(
136                     glusterfs.volume_present(name, bricks, start=False), ret
137                 )
138                 mock_list.side_effect = [[], [name]]
139                 comt = "Volume {} is created and is now started".format(name)
140                 ret.update({"comment": comt, "result": True})
141                 self.assertDictEqual(
142                     glusterfs.volume_present(name, bricks, start=True), ret
143                 )
144                 mock_list.side_effect = None
145                 mock_list.return_value = []
146                 mock_create.return_value = False
147                 comt = "Creation of volume {} failed".format(name)
148                 ret.update({"comment": comt, "result": False, "changes": {}})
149                 self.assertDictEqual(glusterfs.volume_present(name, bricks), ret)
150             with patch.object(
151                 salt.utils.cloud, "check_name", MagicMock(return_value=True)
152             ):
153                 comt = "Invalid characters in volume name."
154                 ret.update({"comment": comt, "result": False})
155                 self.assertDictEqual(glusterfs.volume_present(name, bricks), ret)
156     def test_started(self):
157         name = "salt"
158         ret = {"name": name, "result": False, "comment": "", "changes": {}}
159 <a name="1"></a>        started_info = {name: {"status": "1"}}
160         stopped_info = {name: {"status": "0"}}
161         mock_info = MagicMock(return_value={})
162         mock_start = MagicMock<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(return_value=True)
163         with patch.dict(
164             glusterfs.__salt__,
165             {"glusterfs.info": mock_info, "glusterfs.start_volume": mock_start},
166         ):
167             comt = "Volume {} does not exist".format(name)
168             ret.update({"comment"</b></font>: comt})
169             self.assertDictEqual(glusterfs.started(name), ret)
170             mock_info.return_value = started_info
171             comt = "Volume {} is already started".format(name)
172             ret.update({"comment": comt, "result": True})
173             self.assertDictEqual(glusterfs.started(name), ret)
174             with patch.dict(glusterfs.__opts__, {"test": True}):
175 <a name="0"></a>                mock_info.return_value = stopped_info
176                 comt = "Volume {} will be started".format(name)
177                 ret.update({"comment": comt, "result": None})
178                 self.assertDictEqual(glusterfs<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.started(name), ret)
179             with patch.dict(glusterfs.__opts__, {"test": False}):
180                 comt = "Volume {} is started".format(name)
181                 ret.update(
182                     {
183                         "comment": comt,
184                         "result": True,
185                         "change": {"new"</b></font>: "started", "old": "stopped"},
186                     }
187                 )
188                 self.assertDictEqual(glusterfs.started(name), ret)
189     def test_add_volume_bricks(self):
190         name = "salt"
191         bricks = ["host1:/drive1"]
192         old_bricks = ["host1:/drive2"]
193         ret = {"name": name, "result": False, "comment": "", "changes": {}}
194         stopped_volinfo = {"salt": {"status": "0"}}
195         volinfo = {
196             "salt": {"status": "1", "bricks": {"brick1": {"path": old_bricks[0]}}}
197         }
198         new_volinfo = {
199             "salt": {
200                 "status": "1",
201                 "bricks": {
202                     "brick1": {"path": old_bricks[0]},
203                     "brick2": {"path": bricks[0]},
204                 },
205             }
206         }
207         mock_info = MagicMock(return_value={})
208         mock_add = MagicMock(side_effect=[False, True])
209         with patch.dict(
210             glusterfs.__salt__,
211             {"glusterfs.info": mock_info, "glusterfs.add_volume_bricks": mock_add},
212         ):
213             ret.update({"comment": "Volume salt does not exist"})
214             self.assertDictEqual(glusterfs.add_volume_bricks(name, bricks), ret)
215             mock_info.return_value = stopped_volinfo
216             ret.update({"comment": "Volume salt is not started"})
217             self.assertDictEqual(glusterfs.add_volume_bricks(name, bricks), ret)
218             mock_info.return_value = volinfo
219             ret.update({"comment": "Adding bricks to volume salt failed"})
220             self.assertDictEqual(glusterfs.add_volume_bricks(name, bricks), ret)
221             ret.update({"result": True})
222             ret.update({"comment": "Bricks already added in volume salt"})
223             self.assertDictEqual(glusterfs.add_volume_bricks(name, old_bricks), ret)
224             mock_info.side_effect = [volinfo, new_volinfo]
225             ret.update(
226                 {
227                     "comment": "Bricks successfully added to volume salt",
228                     "changes": {"new": bricks + old_bricks, "old": old_bricks},
229                 }
230             )
231             result = glusterfs.add_volume_bricks(name, bricks)
232             ret["changes"]["new"] = sorted(ret["changes"]["new"])
233             result["changes"]["new"] = sorted(result["changes"]["new"])
234             self.assertDictEqual(result, ret)
235     def test_op_version(self):
236         name = "salt"
237         current = 30707
238         new = 31200
239         ret = {"name": name, "result": False, "comment": "", "changes": {}}
240         mock_get_version = MagicMock(return_value={})
241         mock_set_version = MagicMock(return_value={})
242         with patch.dict(
243             glusterfs.__salt__,
244             {
245                 "glusterfs.get_op_version": mock_get_version,
246                 "glusterfs.set_op_version": mock_set_version,
247             },
248         ):
249             mock_get_version.return_value = [False, "some error message"]
250             ret.update({"result": False})
251             ret.update({"comment": "some error message"})
252             self.assertDictEqual(glusterfs.op_version(name, current), ret)
253             mock_get_version.return_value = current
254             ret.update({"result": True})
255             ret.update(
256                 {
257                     "comment": (
258                         "Glusterfs cluster.op-version for {} already set to {}".format(
259                             name, current
260                         )
261                     )
262                 }
263             )
264             self.assertDictEqual(glusterfs.op_version(name, current), ret)
265             with patch.dict(glusterfs.__opts__, {"test": True}):
266                 mock_set_version.return_value = [False, "Failed to set version"]
267                 ret.update({"result": None})
268                 ret.update(
269                     {
270                         "comment": (
271                             "An attempt would be made to set the cluster.op-version for"
272                             " {} to {}.".format(name, new)
273                         )
274                     }
275                 )
276                 self.assertDictEqual(glusterfs.op_version(name, new), ret)
277             with patch.dict(glusterfs.__opts__, {"test": False}):
278                 mock_set_version.return_value = [False, "Failed to set version"]
279                 ret.update({"result": False})
280                 ret.update({"comment": "Failed to set version"})
281                 self.assertDictEqual(glusterfs.op_version(name, new), ret)
282                 mock_set_version.return_value = "some success message"
283                 ret.update({"comment": "some success message"})
284                 ret.update({"changes": {"old": current, "new": new}})
285                 ret.update({"result": True})
286                 self.assertDictEqual(glusterfs.op_version(name, new), ret)
287     def test_max_op_version(self):
288         name = "salt"
289         current = 30707
290         new = 31200
291         ret = {"name": name, "result": False, "comment": "", "changes": {}}
292         mock_get_version = MagicMock(return_value={})
293         mock_get_max_op_version = MagicMock(return_value={})
294         mock_set_version = MagicMock(return_value={})
295         with patch.dict(
296             glusterfs.__salt__,
297             {
298                 "glusterfs.get_op_version": mock_get_version,
299                 "glusterfs.set_op_version": mock_set_version,
300                 "glusterfs.get_max_op_version": mock_get_max_op_version,
301             },
302         ):
303             mock_get_version.return_value = [False, "some error message"]
304             ret.update({"result": False})
305             ret.update({"comment": "some error message"})
306             self.assertDictEqual(glusterfs.max_op_version(name), ret)
307             mock_get_version.return_value = current
308             mock_get_max_op_version.return_value = [False, "some error message"]
309             ret.update({"result": False})
310             ret.update({"comment": "some error message"})
311             self.assertDictEqual(glusterfs.max_op_version(name), ret)
312             mock_get_version.return_value = current
313             mock_get_max_op_version.return_value = current
314             ret.update({"result": True})
315             ret.update(
316                 {
317                     "comment": (
318                         "The cluster.op-version is already set to the"
319                         " cluster.max-op-version of {}".format(current)
320                     )
321                 }
322             )
323             self.assertDictEqual(glusterfs.max_op_version(name), ret)
324             with patch.dict(glusterfs.__opts__, {"test": True}):
325                 mock_get_max_op_version.return_value = new
326                 ret.update({"result": None})
327                 ret.update(
328                     {
329                         "comment": (
330                             "An attempt would be made to set the cluster.op-version"
331                             " to {}.".format(new)
332                         )
333                     }
334                 )
335                 self.assertDictEqual(glusterfs.max_op_version(name), ret)
336             with patch.dict(glusterfs.__opts__, {"test": False}):
337                 mock_set_version.return_value = [False, "Failed to set version"]
338                 ret.update({"result": False})
339                 ret.update({"comment": "Failed to set version"})
340                 self.assertDictEqual(glusterfs.max_op_version(name), ret)
341                 mock_set_version.return_value = "some success message"
342                 ret.update({"comment": "some success message"})
343                 ret.update({"changes": {"old": current, "new": new}})
344                 ret.update({"result": True})
345                 self.assertDictEqual(glusterfs.max_op_version(name), ret)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_influxdb08_user.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import pytest
2 import salt.states.influxdb08_user as influxdb08_user
3 from tests.support.mock import MagicMock, patch
4 @pytest.fixture
5 def configure_loader_modules():
6     return {influxdb08_user: {}}
7 def test_present():
8     name = "salt"
9     passwd = "salt"
10     ret = {"name": name, "result": False, "comment": "", "changes": {}}
11     mock = MagicMock(side_effect=[False, False, False, True])
12     mock_t = MagicMock(side_effect=[True, False])
13     mock_f = MagicMock(return_value=False)
14     with patch.dict(
15         influxdb08_user.__salt__,
16         {
17             "influxdb08.db_exists": mock_f,
18             "influxdb08.user_exists": mock,
19             "influxdb08.user_create": mock_t,
20         },
21 <a name="1"></a>    ):
22         comt = "Database mydb does not exist"
23         ret.update({"comment": comt})
24         assert influxdb08_user.present<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>(name, passwd, database="mydb") == ret
25 <a name="0"></a>        with patch.dict(influxdb08_user.__opts__, {"test": True}):
26             comt = "User {} is not present and needs to be created".format(name)
27             ret.update({"comment"</b></font>: comt, "result": None})
28             assert influxdb08_user<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.present(name, passwd) == ret
29         with patch.dict(influxdb08_user.__opts__, {"test": False}):
30             comt = "User {} has been created".format(name)
31             ret.update(
32                 {"comment": comt, "result": True, "changes": {"salt"</b></font>: "Present"}}
33             )
34             assert influxdb08_user.present(name, passwd) == ret
35             comt = "Failed to create user {}".format(name)
36             ret.update({"comment": comt, "result": False, "changes": {}})
37             assert influxdb08_user.present(name, passwd) == ret
38 <a name="3"></a>
39         comt = "User {} is already present".format(name)
40         ret.update({"comment": comt, "result": True})
41         assert influxdb08_user.present(n<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ame, passwd) == ret
42 def test_absent():
43     name = "salt"
44     ret = {"name": name, "result": None, "comment": "", "changes": {}}
45     mock = MagicMock(side_effect=[True, True, True, False])
46     mock_t = MagicMock(side_effect=</b></font>[True, False])
47     with patch.dict(
48         influxdb08_user.__salt__,
49         {"influxdb08.user_exists": mock, "influxdb08.user_remove": mock_t},
50     ):
51 <a name="2"></a>        with patch.dict(influxdb08_user.__opts__, {"test": True}):
52             comt = "User {} is present and needs to be removed".format(name)
53             ret.update({"comment": comt})
54             assert influxdb08_user.absent(<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>name) == ret
55         with patch.dict(influxdb08_user.__opts__, {"test": False}):
56             comt = "User {} has been removed".format(name)
57             ret.update({"comment": comt, "result": True, "changes": {"salt"</b></font>: "Absent"}})
58             assert influxdb08_user.absent(name) == ret
59             comt = "Failed to remove user {}".format(name)
60             ret.update({"comment": comt, "result": False, "changes": {}})
61             assert influxdb08_user.absent(name) == ret
62         comt = "User {} is not present, so it cannot be removed".format(name)
63         ret.update({"comment": comt, "result": True})
64         assert influxdb08_user.absent(name) == ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
