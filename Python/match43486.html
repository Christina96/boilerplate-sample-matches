<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for collector.py &amp; queues_test.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for collector.py &amp; queues_test.py
      </h3>
<h1 align="center">
        6.3%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>collector.py (6.5677967%)<th>queues_test.py (6.1386137%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(483-486)<td><a href="#" name="0">(73-75)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(364-369)<td><a href="#" name="1">(69-72)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(498-507)<td><a href="#" name="2">(368-371)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(383-385)<td><a href="#" name="3">(28-30)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(191-194)<td><a href="#" name="4">(104-107)</a><td align="center"><font color="#eb0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>collector.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 import subprocess
4 import sys
5 import salt.utils.crypt
6 import salt.utils.files
7 import salt.utils.fsutils
8 import salt.utils.path
9 import salt.utils.stringutils
10 from salt.exceptions import CommandExecutionError
11 from salt.modules.inspectlib import EnvLoader, kiwiproc
12 from salt.modules.inspectlib.entities import (
13     AllowedDir,
14     IgnoredDir,
15     Package,
16     PackageCfgFile,
17     PayloadFile,
18 )
19 from salt.modules.inspectlib.exceptions import InspectorSnapshotException
20 try:
21     import kiwi
22 except ImportError:
23     kiwi = None
24 log = logging.getLogger(__name__)
25 class Inspector(EnvLoader):
26     DEFAULT_MINION_CONFIG_PATH = "/etc/salt/minion"
27     MODE = ["configuration", "payload", "all"]
28     IGNORE_MOUNTS = ["proc", "sysfs", "devtmpfs", "tmpfs", "fuse.gvfs-fuse-daemon"]
29     IGNORE_FS_TYPES = ["autofs", "cifs", "nfs", "nfs4"]
30     IGNORE_PATHS = [
31         "/tmp",
32         "/var/tmp",
33         "/lost+found",
34         "/var/run",
35         "/var/lib/rpm",
36         "/.snapshots",
37         "/.zfs",
38         "/etc/ssh",
39         "/root",
40         "/home",
41     ]
42     def __init__(self, cachedir=None, piddir=None, pidfilename=None):
43         EnvLoader.__init__(
44             self, cachedir=cachedir, piddir=piddir, pidfilename=pidfilename
45         )
46     def create_snapshot(self):
47         self.db.open(new=True)
48         return self
49     def reuse_snapshot(self):
50         self.db.open()
51         return self
52     def _syscall(self, command, input=None, env=None, *params):
53         return subprocess.Popen(
54             [command] + list(params),
55             stdout=subprocess.PIPE,
56             stdin=subprocess.PIPE,
57             stderr=subprocess.STDOUT,
58             env=env or os.environ,
59         ).communicate(input=input)
60     def _get_cfg_pkgs(self):
61         if self.grains_core.os_data().get("os_family") == "Debian":
62             return self.__get_cfg_pkgs_dpkg()
63         elif self.grains_core.os_data().get("os_family") in ["Suse", "redhat"]:
64             return self.__get_cfg_pkgs_rpm()
65         else:
66             return dict()
67     def __get_cfg_pkgs_dpkg(self):
68         data = dict()
69         for pkg_name in salt.utils.stringutils.to_str(
70             self._syscall("dpkg-query", None, None, "-Wf", "${binary:Package}\\n")[0]
71         ).split(os.linesep):
72             pkg_name = pkg_name.strip()
73             if not pkg_name:
74                 continue
75             data[pkg_name] = list()
76             for pkg_cfg_item in salt.utils.stringutils.to_str(
77                 self._syscall(
78                     "dpkg-query", None, None, "-Wf", "${Conffiles}\\n", pkg_name
79                 )[0]
80             ).split(os.linesep):
81                 pkg_cfg_item = pkg_cfg_item.strip()
82                 if not pkg_cfg_item:
83                     continue
84                 pkg_cfg_file, pkg_cfg_sum = pkg_cfg_item.strip().split(" ", 1)
85                 data[pkg_name].append(pkg_cfg_file)
86             if not data[pkg_name]:
87                 data.pop(pkg_name)
88         return data
89     def __get_cfg_pkgs_rpm(self):
90         out, err = self._syscall(
91             "rpm",
92             None,
93             None,
94             "-qa",
95             "--configfiles",
96             "--queryformat",
97             "%{name}-%{version}-%{release}\\n",
98         )
99         data = dict()
100         pkg_name = None
101         pkg_configs = []
102         out = salt.utils.stringutils.to_str(out)
103         for line in out.split(os.linesep):
104             line = line.strip()
105             if not line:
106                 continue
107             if not line.startswith("/"):
108                 if pkg_name and pkg_configs:
109                     data[pkg_name] = pkg_configs
110                 pkg_name = line
111                 pkg_configs = []
112             else:
113                 pkg_configs.append(line)
114         if pkg_name and pkg_configs:
115             data[pkg_name] = pkg_configs
116         return data
117     def _get_changed_cfg_pkgs(self, data):
118         f_data = dict()
119         for pkg_name, pkg_files in data.items():
120 <a name="4"></a>            cfgs = list()
121             cfg_data = list()
122             if self.grains_core.os_data().get("os_family") == "Debian":
123                 cfg_data = salt.utils.stringutils<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.to_str(
124                     self._syscall("dpkg", None, None, "--verify", pkg_name)[0]
125                 ).split(os.linesep)
126             elif self.grains_core.os_data().</b></font>get("os_family") in ["Suse", "redhat"]:
127                 cfg_data = salt.utils.stringutils.to_str(
128                     self._syscall(
129                         "rpm",
130                         None,
131                         None,
132                         "-V",
133                         "--nodeps",
134                         "--nodigest",
135                         "--nosignature",
136                         "--nomtime",
137                         "--nolinkto",
138                         pkg_name,
139                     )[0]
140                 ).split(os.linesep)
141             for line in cfg_data:
142                 line = line.strip()
143                 if not line or line.find(" c ") &lt; 0 or line.split(" ")[0].find("5") &lt; 0:
144                     continue
145                 cfg_file = line.split(" ")[-1]
146                 if cfg_file in pkg_files:
147                     cfgs.append(cfg_file)
148             if cfgs:
149                 f_data[pkg_name] = cfgs
150         return f_data
151     def _save_cfg_packages(self, data):
152         pkg_id = 0
153         pkg_cfg_id = 0
154         for pkg_name, pkg_configs in data.items():
155             pkg = Package()
156             pkg.id = pkg_id
157             pkg.name = pkg_name
158             self.db.store(pkg)
159             for pkg_config in pkg_configs:
160                 cfg = PackageCfgFile()
161                 cfg.id = pkg_cfg_id
162                 cfg.pkgid = pkg_id
163                 cfg.path = pkg_config
164                 self.db.store(cfg)
165                 pkg_cfg_id += 1
166             pkg_id += 1
167     def _save_payload(self, files, directories, links):
168         idx = 0
169         for p_type, p_list in (
170             ("f", files),
171             ("d", directories),
172             ("l", links),
173         ):
174             for p_obj in p_list:
175                 stats = os.stat(p_obj)
176                 payload = PayloadFile()
177                 payload.id = idx
178                 payload.path = p_obj
179                 payload.p_type = p_type
180                 payload.mode = stats.st_mode
181                 payload.uid = stats.st_uid
182                 payload.gid = stats.st_gid
183                 payload.p_size = stats.st_size
184                 payload.atime = stats.st_atime
185                 payload.mtime = stats.st_mtime
186                 payload.ctime = stats.st_ctime
187                 idx += 1
188                 self.db.store(payload)
189     def _get_managed_files(self):
190         if self.grains_core.os_data().get("os_family") == "Debian":
191             return self.__get_managed_files_dpkg()
192         elif self.grains_core.os_data().get("os_family") in ["Suse", "redhat"]:
193             return self.__get_managed_files_rpm()
194         return list(), list(), list()
195     def __get_managed_files_dpkg(self):
196         dirs = set()
197         links = set()
198         files = set()
199         for pkg_name in salt.utils.stringutils.to_str(
200             self._syscall("dpkg-query", None, None, "-Wf", "${binary:Package}\\n")[0]
201         ).split(os.linesep):
202             pkg_name = pkg_name.strip()
203             if not pkg_name:
204                 continue
205             for resource in salt.utils.stringutils.to_str(
206                 self._syscall("dpkg", None, None, "-L", pkg_name)[0]
207             ).split(os.linesep):
208                 resource = resource.strip()
209                 if not resource or resource in ["/", "./", "."]:
210                     continue
211                 if os.path.isdir(resource):
212                     dirs.add(resource)
213                 elif os.path.islink(resource):
214                     links.add(resource)
215                 elif os.path.isfile(resource):
216                     files.add(resource)
217         return sorted(files), sorted(dirs), sorted(links)
218     def __get_managed_files_rpm(self):
219         dirs = set()
220         links = set()
221         files = set()
222         for line in salt.utils.stringutils.to_str(
223             self._syscall("rpm", None, None, "-qlav")[0]
224         ).split(os.linesep):
225             line = line.strip()
226             if not line:
227                 continue
228             line = line.replace("\t", " ").split(" ")
229             if line[0][0] == "d":
230                 dirs.add(line[-1])
231             elif line[0][0] == "l":
232                 links.add(line[-1])
233             elif line[0][0] == "-":
234                 files.add(line[-1])
235         return sorted(files), sorted(dirs), sorted(links)
236     def _get_all_files(self, path, *exclude):
237         files = list()
238         dirs = list()
239         links = list()
240         if os.access(path, os.R_OK):
241             for obj in os.listdir(path):
242                 obj = os.path.join(path, obj)
243                 valid = True
244                 for ex_obj in exclude:
245                     if obj.startswith(str(ex_obj)):
246                         valid = False
247                         continue
248                 if not valid or not os.path.exists(obj) or not os.access(obj, os.R_OK):
249 <a name="1"></a>                    continue
250                 if salt.utils.path.islink(obj):
251                     links.append(obj)
252                 elif os.path<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.isdir(obj):
253                     dirs.append(obj)
254                     f_obj, d_obj, l_obj = self._get_all_files(obj, *exclude)
255                     files.extend(f_obj)
256                     dirs.extend(d_obj)
257                     links.extend(</b></font>l_obj)
258                 elif os.path.isfile(obj):
259                     files.append(obj)
260         return sorted(files), sorted(dirs), sorted(links)
261     def _get_unmanaged_files(self, managed, system_all):
262         m_files, m_dirs, m_links = managed
263 <a name="3"></a>        s_files, s_dirs, s_links = system_all
264         return (
265             sorted(list(set(s_files)<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.difference(m_files))),
266             sorted(list(set(s_dirs).difference(m_dirs))),
267             sorted(list(set(s_links).difference(</b></font>m_links))),
268         )
269     def _scan_payload(self):
270         allowed = list()
271         for allowed_dir in self.db.get(AllowedDir):
272             if os.path.exists(allowed_dir.path):
273                 allowed.append(allowed_dir.path)
274         ignored = list()
275         if not allowed:
276             for ignored_dir in self.db.get(IgnoredDir):
277                 if os.path.exists(ignored_dir.path):
278                     ignored.append(ignored_dir.path)
279         all_files = list()
280         all_dirs = list()
281         all_links = list()
282         for entry_path in [pth for pth in (allowed or os.listdir("/")) if pth]:
283             if entry_path[0] != "/":
284                 entry_path = "/{}".format(entry_path)
285             if entry_path in ignored or os.path.islink(entry_path):
286                 continue
287             e_files, e_dirs, e_links = self._get_all_files(entry_path, *ignored)
288             all_files.extend(e_files)
289             all_dirs.extend(e_dirs)
290             all_links.extend(e_links)
291         return self._get_unmanaged_files(
292             self._get_managed_files(),
293             (
294                 all_files,
295                 all_dirs,
296                 all_links,
297             ),
298         )
299     def _prepare_full_scan(self, **kwargs):
300         self.db.open(new=True)
301         ignored_fs = set()
302         ignored_fs |= set(self.IGNORE_PATHS)
303         mounts = salt.utils.fsutils._get_mounts()
304         for device, data in mounts.items():
305             if device in self.IGNORE_MOUNTS:
306                 for mpt in data:
307                     ignored_fs.add(mpt["mount_point"])
308                 continue
309             for mpt in data:
310                 if mpt["type"] in self.IGNORE_FS_TYPES:
311                     ignored_fs.add(mpt["mount_point"])
312         ignored_all = list()
313         for entry in sorted(list(ignored_fs)):
314             valid = True
315             for e_entry in ignored_all:
316                 if entry.startswith(e_entry):
317                     valid = False
318                     break
319             if valid:
320                 ignored_all.append(entry)
321         for ignored_dir in ignored_all:
322             dir_obj = IgnoredDir()
323             dir_obj.path = ignored_dir
324             self.db.store(dir_obj)
325         allowed = [elm for elm in kwargs.get("filter", "").split(",") if elm]
326         for allowed_dir in allowed:
327             dir_obj = AllowedDir()
328             dir_obj.path = allowed_dir
329             self.db.store(dir_obj)
330         return ignored_all
331     def _init_env(self):
332         from salt.config import minion_config
333         from salt.grains import core as g_core
334         g_core.__opts__ = minion_config(self.DEFAULT_MINION_CONFIG_PATH)
335         self.grains_core = g_core
336     def snapshot(self, mode):
337 <a name="0"></a>        """
338         Take a snapshot of the system.
339         self<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>._init_env()
340         self._save_cfg_packages(self._get_changed_cfg_pkgs(self._get_cfg_pkgs()))
341         self._save_payload(*self._scan_payload(</b></font>))
342     def request_snapshot(self, mode, priority=19, **kwargs):
343         if mode not in self.MODE:
344             raise InspectorSnapshotException("Unknown mode: '{}'".format(mode))
345 <a name="2"></a>        if is_alive(self.pidfile):
346             raise CommandExecutionError("Inspection already in progress.")
347         self<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>._prepare_full_scan(**kwargs)
348         subprocess.run(
349             [
350                 "nice",
351                 "-{}".format(priority),
352                 "python",
353                 __file__,
354                 os.path.dirname(self.pidfile),
355                 os.</b></font>path.dirname(self.dbfile),
356                 mode,
357             ],
358             check=False,
359             stdout=subprocess.DEVNULL,
360             stderr=subprocess.DEVNULL,
361         )
362     def export(self, description, local=False, path="/tmp", format="qcow2"):
363         kiwiproc.__salt__ = __salt__
364         return (
365             kiwiproc.KiwiExporter(grains=__grains__, format=format)
366             .load(**description)
367             .export("something")
368         )
369     def build(self, format="qcow2", path="/tmp"):
370         if kiwi is None:
371             msg = (
372                 "Unable to build the image due to the missing dependencies: Kiwi module"
373                 " is not available."
374             )
375             log.error(msg)
376             raise CommandExecutionError(msg)
377         raise CommandExecutionError("Build is not yet implemented")
378 def is_alive(pidfile):
379     try:
380         with salt.utils.files.fopen(pidfile) as fp_:
381             os.kill(int(fp_.read().strip()), 0)
382         return True
383     except Exception as ex:  # pylint: disable=broad-except
384         if os.access(pidfile, os.W_OK) and os.path.isfile(pidfile):
385             os.unlink(pidfile)
386         return False
387 def main(dbfile, pidfile, mode):
388     Inspector(dbfile, pidfile).reuse_snapshot().snapshot(mode)
389 if __name__ == "__main__":
390     if len(sys.argv) != 4:
391         print("This module is not intended to use directly!", file=sys.stderr)
392         sys.exit(1)
393     pidfile, dbfile, mode = sys.argv[1:]  # pylint: disable=unbalanced-tuple-unpacking
394     if is_alive(pidfile):
395         sys.exit(1)
396     try:
397         if os.fork() &gt; 0:
398             salt.utils.crypt.reinit_crypto()
399             sys.exit(0)
400         else:
401             salt.utils.crypt.reinit_crypto()
402     except OSError as ex:
403         sys.exit(1)
404     os.setsid()
405     os.umask(0o000)  # pylint: disable=blacklisted-function
406     try:
407         pid = os.fork()
408         if pid &gt; 0:
409             salt.utils.crypt.reinit_crypto()
410             with salt.utils.files.fopen(
411                 os.path.join(pidfile, EnvLoader.PID_FILE), "w"
412             ) as fp_:
413                 fp_.write("{}\n".format(pid))
414             sys.exit(0)
415     except OSError as ex:
416         sys.exit(1)
417     salt.utils.crypt.reinit_crypto()
418     main(dbfile, pidfile, mode)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>queues_test.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, division, print_function
2 from datetime import timedelta
3 from random import random
4 from salt.ext.tornado import gen, queues
5 from salt.ext.tornado.gen import TimeoutError
6 from salt.ext.tornado.testing import gen_test, AsyncTestCase
7 from salt.ext.tornado.test.util import unittest, skipBefore35, exec_test
8 <a name="3"></a>class QueueBasicTest(AsyncTestCase):
9     def test_repr_and_str(self):
10         q = queues.Queue(maxsize=1)
11         self<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertIn(hex(id(q)), repr(q))
12         self.assertNotIn(hex(id(q)), str(q))
13         q.get(</b></font>)
14         for q_str in repr(q), str(q):
15             self.assertTrue(q_str.startswith('&lt;Queue'))
16             self.assertIn('maxsize=1', q_str)
17             self.assertIn('getters[1]', q_str)
18             self.assertNotIn('putters', q_str)
19             self.assertNotIn('tasks', q_str)
20         q.put(None)
21         q.put(None)
22         q.put(None)
23         for q_str in repr(q), str(q):
24             self.assertNotIn('getters', q_str)
25             self.assertIn('putters[1]', q_str)
26             self.assertIn('tasks=2', q_str)
27     def test_order(self):
28         q = queues.Queue()
29         for i in [1, 3, 2]:
30             q.put_nowait(i)
31         items = [q.get_nowait() for _ in range(3)]
32         self.assertEqual([1, 3, 2], items)
33     @gen_test
34     def test_maxsize(self):
35         self.assertRaises(TypeError, queues.Queue, maxsize=None)
36         self.assertRaises(ValueError, queues.Queue, maxsize=-1)
37         q = queues.Queue(maxsize=2)
38         self.assertTrue(q.empty())
39         self.assertFalse(q.full())
40         self.assertEqual(2, q.maxsize)
41 <a name="1"></a>        self.assertTrue(q.put(0).done())
42         self.assertTrue(q.put(1).done())
43         self.assertFalse(q.empty())
44         self<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertTrue(q.full())
45 <a name="0"></a>        put2 = q.put(2)
46         self.assertFalse(put2.done())
47         self.assertEqual(</b></font>0, (yield q.get()))  # Make room.
48         self<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertTrue(put2.done())
49         self.assertFalse(q.empty())
50         self.assertTrue(q.full(</b></font>))
51 class QueueGetTest(AsyncTestCase):
52     @gen_test
53     def test_blocking_get(self):
54         q = queues.Queue()
55         q.put_nowait(0)
56         self.assertEqual(0, (yield q.get()))
57     def test_nonblocking_get(self):
58         q = queues.Queue()
59         q.put_nowait(0)
60         self.assertEqual(0, q.get_nowait())
61     def test_nonblocking_get_exception(self):
62         q = queues.Queue()
63         self.assertRaises(queues.QueueEmpty, q.get_nowait)
64     @gen_test
65     def test_get_with_putters(self):
66         q = queues.Queue(1)
67         q.put_nowait(0)
68         put = q.put(1)
69         self.assertEqual(0, (yield q.get()))
70         self.assertIsNone((yield put))
71 <a name="4"></a>
72     @gen_test
73     def test_blocking_get_wait(self):
74         q = queues<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.Queue()
75         q.put(0)
76         self.io_loop.call_later(0.01, q.put, 1)
77         self.io_loop.call_later(0.02, q.</b></font>put, 2)
78         self.assertEqual(0, (yield q.get(timeout=timedelta(seconds=1))))
79         self.assertEqual(1, (yield q.get(timeout=timedelta(seconds=1))))
80     @gen_test
81     def test_get_timeout(self):
82         q = queues.Queue()
83         get_timeout = q.get(timeout=timedelta(seconds=0.01))
84         get = q.get()
85         with self.assertRaises(TimeoutError):
86             yield get_timeout
87         q.put_nowait(0)
88         self.assertEqual(0, (yield get))
89     @gen_test
90     def test_get_timeout_preempted(self):
91         q = queues.Queue()
92         get = q.get(timeout=timedelta(seconds=0.01))
93         q.put(0)
94         yield gen.sleep(0.02)
95         self.assertEqual(0, (yield get))
96     @gen_test
97     def test_get_clears_timed_out_putters(self):
98         q = queues.Queue(1)
99         putters = [q.put(i, timedelta(seconds=0.01)) for i in range(10)]
100         put = q.put(10)
101         self.assertEqual(10, len(q._putters))
102         yield gen.sleep(0.02)
103         self.assertEqual(10, len(q._putters))
104         self.assertFalse(put.done())  # Final waiter is still active.
105         q.put(11)
106         self.assertEqual(0, (yield q.get()))  # get() clears the waiters.
107         self.assertEqual(1, len(q._putters))
108         for putter in putters[1:]:
109             self.assertRaises(TimeoutError, putter.result)
110     @gen_test
111     def test_get_clears_timed_out_getters(self):
112         q = queues.Queue()
113         getters = [q.get(timedelta(seconds=0.01)) for _ in range(10)]
114         get = q.get()
115         self.assertEqual(11, len(q._getters))
116         yield gen.sleep(0.02)
117         self.assertEqual(11, len(q._getters))
118         self.assertFalse(get.done())  # Final waiter is still active.
119         q.get()  # get() clears the waiters.
120         self.assertEqual(2, len(q._getters))
121         for getter in getters:
122             self.assertRaises(TimeoutError, getter.result)
123     @skipBefore35
124     @gen_test
125     def test_async_for(self):
126         q = queues.Queue()
127         for i in range(5):
128             q.put(i)
129         namespace = exec_test(globals(), locals(), """
130         async def f():
131             results = []
132             async for i in q:
133                 results.append(i)
134                 if i == 4:
135                     return results
136         self.assertTrue(q<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.full())
137         q.put((3, 'c'))
138         q.put((2, 'd'))
139         self.assertEqual((0, 'b'), q.</b></font>get_nowait())
140         self.assertEqual((1, 'a'), (yield q.get()))
141         self.assertEqual((2, 'd'), q.get_nowait())
142         self.assertEqual((3, 'c'), (yield q.get()))
143         self.assertTrue(q.empty())
144 class LifoQueueJoinTest(QueueJoinTest):
145     queue_class = queues.LifoQueue
146     @gen_test
147     def test_order(self):
148         q = self.queue_class(maxsize=2)
149         q.put_nowait(1)
150         q.put_nowait(0)
151         self.assertTrue(q.full())
152         q.put(3)
153         q.put(2)
154         self.assertEqual(3, q.get_nowait())
155         self.assertEqual(2, (yield q.get()))
156         self.assertEqual(0, q.get_nowait())
157         self.assertEqual(1, (yield q.get()))
158         self.assertTrue(q.empty())
159 class ProducerConsumerTest(AsyncTestCase):
160     @gen_test
161     def test_producer_consumer(self):
162         q = queues.Queue(maxsize=3)
163         history = []
164         @gen.coroutine
165         def consumer():
166             while True:
167                 history.append((yield q.get()))
168                 q.task_done()
169         @gen.coroutine
170         def producer():
171             for item in range(10):
172                 yield q.put(item)
173         consumer()
174         yield producer()
175         yield q.join()
176         self.assertEqual(list(range(10)), history)
177 if __name__ == '__main__':
178     unittest.main()
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
