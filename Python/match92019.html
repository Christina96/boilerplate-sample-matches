<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for uol.py &amp; viki.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for uol.py &amp; viki.py
      </h3>
<h1 align="center">
        6.9%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>uol.py (14.184397%)<th>viki.py (4.576659%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(22-73)<td><a href="#" name="0">(169-260)</a><td align="center"><font color="#ff0000">20</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>uol.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 from .common import InfoExtractor
3 from ..compat import (
4     compat_str,
5     compat_urllib_parse_urlencode,
6 )
7 from ..utils import (
8     clean_html,
9     int_or_none,
10     parse_duration,
11     parse_iso8601,
12     qualities,
13     update_url_query,
14 )
15 <a name="0"></a>class UOLIE(InfoExtractor):
16     IE_NAME = 'uol.com.br'
17     _VALID_URL = r'https?://(?:.+?\.)?uol\.com\.br/.*?(?:(?:mediaId|v)=|view/(?:[a-z0-9]+/)?|video(?:=|/(?:\d{4}/\d{2}/\d{2}/)?))(?P&lt;id&gt;\d+|[\w-]+-[A-Z0-9]+)'
18     _TESTS = [<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>{
19         'url': 'http://player.mais.uol.com.br/player_video_v3.swf?mediaId=15951931',
20         'md5': '4f1e26683979715ff64e4e29099cf020',
21         'info_dict': {
22             'id': '15951931',
23             'ext': 'mp4',
24             'title': 'Miss simpatia é encontrada morta',
25             'description': 'md5:3f8c11a0c0556d66daf7e5b45ef823b2',
26             'timestamp': 1470421860,
27             'upload_date': '20160805',
28         }
29     }, {
30         'url': 'http://tvuol.uol.com.br/video/incendio-destroi-uma-das-maiores-casas-noturnas-de-londres-04024E9A3268D4C95326',
31         'md5': '2850a0e8dfa0a7307e04a96c5bdc5bc2',
32         'info_dict': {
33             'id': '15954259',
34             'ext': 'mp4',
35             'title': 'Incêndio destrói uma das maiores casas noturnas de Londres',
36             'description': 'Em Londres, um incêndio destruiu uma das maiores boates da cidade. Não há informações sobre vítimas.',
37             'timestamp': 1470674520,
38             'upload_date': '20160808',
39         }
40     }, {
41         'url': 'http://mais.uol.com.br/static/uolplayer/index.html?mediaId=15951931',
42         'only_matching': True,
43     }, {
44         'url': 'http://mais.uol.com.br/view/15954259',
45         'only_matching': True,
46     }, {
47         'url': 'http://noticias.band.uol.com.br/brasilurgente/video/2016/08/05/15951931/miss-simpatia-e-encontrada-morta.html',
48         'only_matching': True,
49     }, {
50         'url': 'http://videos.band.uol.com.br/programa.asp?e=noticias&amp;pr=brasil-urgente&amp;v=15951931&amp;t=Policia-desmonte-base-do-PCC-na-Cracolandia',
51         'only_matching': True,
52     }, {
53         'url': 'http://mais.uol.com.br/view/cphaa0gl2x8r/incendio-destroi-uma-das-maiores-casas-noturnas-de-londres-04024E9A3268D4C95326',
54         'only_matching': True,
55     }, {
56         'url': 'http://noticias.uol.com.br//videos/assistir.htm?video=rafaela-silva-inspira-criancas-no-judo-04024D983968D4C95326',
57         'only_matching': True,
58     }, {
59         'url': 'http://mais.uol.com.br/view/e0qbgxid79uv/15275470',
60         'only_matching': True,
61     }]
62     def _real_extract(self, url):
63         video_id = self._match_id(url)
64         video_data = self._download_json(
65             'https://api.mais.uol.com.br/apiuol/v3/media/detail/' + video_id,
66             video_id)[</b></font>'item']
67         media_id = compat_str(video_data['mediaId'])
68         title = video_data['title']
69         ver = video_data.get('revision', 2)
70         uol_formats = self._download_json(
71             'https://croupier.mais.uol.com.br/v3/formats/%s/jsonp' % media_id,
72             media_id)
73         quality = qualities(['mobile', 'WEBM', '360p', '720p', '1080p'])
74         formats = []
75         for format_id, f in uol_formats.items():
76             if not isinstance(f, dict):
77                 continue
78             f_url = f.get('url') or f.get('secureUrl')
79             if not f_url:
80                 continue
81             query = {
82                 'ver': ver,
83                 'r': 'http://mais.uol.com.br',
84             }
85             for k in ('token', 'sign'):
86                 v = f.get(k)
87                 if v:
88                     query[k] = v
89             f_url = update_url_query(f_url, query)
90             if format_id == 'HLS':
91                 m3u8_formats = self._extract_m3u8_formats(
92                     f_url, media_id, 'mp4', 'm3u8_native',
93                     m3u8_id='hls', fatal=False)
94                 encoded_query = compat_urllib_parse_urlencode(query)
95                 for m3u8_f in m3u8_formats:
96                     m3u8_f['extra_param_to_segment_url'] = encoded_query
97                     m3u8_f['url'] = update_url_query(m3u8_f['url'], query)
98                 formats.extend(m3u8_formats)
99                 continue
100             formats.append({
101                 'format_id': format_id,
102                 'url': f_url,
103                 'quality': quality(format_id),
104                 'preference': -1,
105             })
106         self._sort_formats(formats)
107         tags = []
108         for tag in video_data.get('tags', []):
109             tag_description = tag.get('description')
110             if not tag_description:
111                 continue
112             tags.append(tag_description)
113         thumbnails = []
114         for q in ('Small', 'Medium', 'Wmedium', 'Large', 'Wlarge', 'Xlarge'):
115             q_url = video_data.get('thumb' + q)
116             if not q_url:
117                 continue
118             thumbnails.append({
119                 'id': q,
120                 'url': q_url,
121             })
122         return {
123             'id': media_id,
124             'title': title,
125             'description': clean_html(video_data.get('description')),
126             'thumbnails': thumbnails,
127             'duration': parse_duration(video_data.get('duration')),
128             'tags': tags,
129             'formats': formats,
130             'timestamp': parse_iso8601(video_data.get('publishDate'), ' '),
131             'view_count': int_or_none(video_data.get('viewsQtty')),
132         }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>viki.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 import hashlib
3 import hmac
4 import json
5 import time
6 from .common import InfoExtractor
7 from ..utils import (
8     ExtractorError,
9     int_or_none,
10     parse_age_limit,
11     parse_iso8601,
12     try_get,
13 )
14 class VikiBaseIE(InfoExtractor):
15     _VALID_URL_BASE = r'https?://(?:www\.)?viki\.(?:com|net|mx|jp|fr)/'
16     _API_URL_TEMPLATE = 'https://api.viki.io%s'
17     _DEVICE_ID = '112395910d'
18     _APP = '100005a'
19     _APP_VERSION = '6.11.3'
20     _APP_SECRET = 'd96704b180208dbb2efa30fe44c48bd8690441af9f567ba8fd710a72badc85198f7472'
21     _GEO_BYPASS = False
22     _NETRC_MACHINE = 'viki'
23     _token = None
24     _ERRORS = {
25         'geo': 'Sorry, this content is not available in your region.',
26         'upcoming': 'Sorry, this content is not yet available.',
27         'paywall': 'Sorry, this content is only available to Viki Pass Plus subscribers',
28     }
29     def _stream_headers(self, timestamp, sig):
30         return {
31             'X-Viki-manufacturer': 'vivo',
32             'X-Viki-device-model': 'vivo 1606',
33             'X-Viki-device-os-ver': '6.0.1',
34             'X-Viki-connection-type': 'WIFI',
35             'X-Viki-carrier': '',
36             'X-Viki-as-id': '100005a-1625321982-3932',
37             'timestamp': str(timestamp),
38             'signature': str(sig),
39             'x-viki-app-ver': self._APP_VERSION
40         }
41     def _api_query(self, path, version=4, **kwargs):
42         path += '?' if '?' not in path else '&amp;'
43         app = self._APP
44         query = '/v{version}/{path}app={app}'.format(**locals())
45         if self._token:
46             query += '&amp;token=%s' % self._token
47         return query + ''.join('&amp;{name}={val}.format(**locals())' for name, val in kwargs.items())
48     def _sign_query(self, path):
49         timestamp = int(time.time())
50         query = self._api_query(path, version=5)
51         sig = hmac.new(
52             self._APP_SECRET.encode('ascii'),
53             '{query}&amp;t={timestamp}'.format(**locals()).encode('ascii'),
54             hashlib.sha1).hexdigest()
55         return timestamp, sig, self._API_URL_TEMPLATE % query
56     def _call_api(
57             self, path, video_id, note='Downloading JSON metadata', data=None, query=None, fatal=True):
58         if query is None:
59             timestamp, sig, url = self._sign_query(path)
60         else:
61             url = self._API_URL_TEMPLATE % self._api_query(path, version=4)
62         resp = self._download_json(
63             url, video_id, note, fatal=fatal, query=query,
64             data=json.dumps(data).encode('utf-8') if data else None,
65             headers=({'x-viki-app-ver': self._APP_VERSION} if data
66                      else self._stream_headers(timestamp, sig) if query is None
67                      else None), expected_status=400) or {}
68         self._raise_error(resp.get('error'), fatal)
69         return resp
70     def _raise_error(self, error, fatal=True):
71         if error is None:
72             return
73         msg = '%s said: %s' % (self.IE_NAME, error)
74         if fatal:
75             raise ExtractorError(msg, expected=True)
76         else:
77             self.report_warning(msg)
78     def _check_errors(self, data):
79         for reason, status in (data.get('blocking') or {}).items():
80             if status and reason in self._ERRORS:
81                 message = self._ERRORS[reason]
82                 if reason == 'geo':
83                     self.raise_geo_restricted(msg=message)
84                 elif reason == 'paywall':
85                     if try_get(data, lambda x: x['paywallable']['tvod']):
86                         self._raise_error('This video is for rent only or TVOD (Transactional Video On demand)')
87                     self.raise_login_required(message)
88                 self._raise_error(message)
89     def _real_initialize(self):
90         self._login()
91     def _login(self):
92         username, password = self._get_login_info()
93         if username is None:
94             return
95         self._token = self._call_api(
96             'sessions.json', None, 'Logging in', fatal=False,
97             data={'username': username, 'password': password}).get('token')
98         if not self._token:
99             self.report_warning('Login Failed: Unable to get session token')
100     @staticmethod
101     def dict_selection(dict_obj, preferred_key):
102         if preferred_key in dict_obj:
103             return dict_obj[preferred_key]
104         return (list(filter(None, dict_obj.values())) or [None])[0]
105 class VikiIE(VikiBaseIE):
106     IE_NAME = 'viki'
107     _VALID_URL = r'%s(?:videos|player)/(?P&lt;id&gt;[0-9]+v)' % VikiBaseIE._VALID_URL_BASE
108     _TESTS = [{
109         'note': 'Free non-DRM video with storyboards in MPD',
110         'url': 'https://www.viki.com/videos/1175236v-choosing-spouse-by-lottery-episode-1',
111         'info_dict': {
112             'id': '1175236v',
113             'ext': 'mp4',
114             'title': 'Choosing Spouse by Lottery - Episode 1',
115             'timestamp': 1606463239,
116             'age_limit': 12,
117             'uploader': 'FCC',
118             'upload_date': '20201127',
119         },
120         'expected_warnings': ['Unknown MIME type image/jpeg in DASH manifest'],
121         'params': {
122             'format': 'bestvideo',
123         },
124     }, {
125         'url': 'http://www.viki.com/videos/1023585v-heirs-episode-14',
126         'info_dict': {
127             'id': '1023585v',
128             'ext': 'mp4',
129             'title': 'Heirs - Episode 14',
130             'uploader': 'SBS Contents Hub',
131             'timestamp': 1385047627,
132             'upload_date': '20131121',
133             'age_limit': 13,
134             'duration': 3570,
135             'episode_number': 14,
136         },
137         'params': {
138             'format': 'bestvideo',
139         },
140         'skip': 'Content is only available to Viki Pass Plus subscribers',
141         'expected_warnings': ['Unknown MIME type image/jpeg in DASH manifest'],
142     }, {
143 <a name="0"></a>        'url': 'http://www.viki.com/videos/1067139v-the-avengers-age-of-ultron-press-conference',
144         'md5': '86c0b5dbd4d83a6611a79987cc7a1989',
145         'info_dict': {
146             <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>'id': '1067139v',
147             'ext': 'mp4',
148             'title': "'The Avengers: Age of Ultron' Press Conference",
149             'description': 'md5:d70b2f9428f5488321bfe1db10d612ea',
150             'duration': 352,
151             'timestamp': 1430380829,
152             'upload_date': '20150430',
153             'uploader': 'Arirang TV',
154             'like_count': int,
155             'age_limit': 0,
156         },
157         'skip': 'Sorry. There was an error loading this video',
158     }, {
159         'url': 'http://www.viki.com/videos/1048879v-ankhon-dekhi',
160         'info_dict': {
161             'id': '1048879v',
162             'ext': 'mp4',
163             'title': 'Ankhon Dekhi',
164             'duration': 6512,
165             'timestamp': 1408532356,
166             'upload_date': '20140820',
167             'uploader': 'Spuul',
168             'like_count': int,
169             'age_limit': 13,
170         },
171         'skip': 'Page not found!',
172     }, {
173         'url': 'http://www.viki.com/videos/44699v-boys-over-flowers-episode-1',
174         'md5': '670440c79f7109ca6564d4c7f24e3e81',
175         'info_dict': {
176             'id': '44699v',
177             'ext': 'mp4',
178             'title': 'Boys Over Flowers - Episode 1',
179             'description': 'md5:b89cf50038b480b88b5b3c93589a9076',
180             'duration': 4172,
181             'timestamp': 1270496524,
182             'upload_date': '20100405',
183             'uploader': 'group8',
184             'like_count': int,
185             'age_limit': 15,
186             'episode_number': 1,
187         },
188         'params': {
189             'format': 'bestvideo',
190         },
191         'expected_warnings': ['Unknown MIME type image/jpeg in DASH manifest'],
192     }, {
193         'url': 'http://www.viki.com/videos/50562v-poor-nastya-complete-episode-1',
194         'md5': '63f8600c1da6f01b7640eee7eca4f1da',
195         'info_dict': {
196             'id': '50562v',
197             'ext': 'webm',
198             'title': 'Poor Nastya [COMPLETE] - Episode 1',
199             'description': '',
200             'duration': 606,
201             'timestamp': 1274949505,
202             'upload_date': '20101213',
203             'uploader': 'ad14065n',
204             'uploader_id': 'ad14065n',
205             'like_count': int,
206             'age_limit': 13,
207         },
208         'skip': 'Page not found!',
209     }, {
210         'url': 'http://www.viki.com/player/44699v',
211         'only_matching': True,
212     }, {
213         'url': 'http://www.viki.com/videos/158036v-love-in-magic',
214         'md5': '78bf49fdaa51f9e7f9150262a9ef9bdf',
215         'info_dict': {
216             'id': '158036v',
217             'ext': 'mp4',
218             'uploader': 'I Planet Entertainment',
219             'upload_date': '20111122',
220             'timestamp': 1321985454,
221             'description': 'md5:44b1e46619df3a072294645c770cef36',
222             'title': 'Love in Magic',
223             'age_limit': 15,
224         },
225         'params': {
226             'format': 'bestvideo',
227         },
228         'expected_warnings': ['Unknown MIME type image/jpeg in DASH manifest'],
229     }]
230     def _real_extract(self, url):
231         video_id = self._match_id(url)
232         video = self._call_api('videos/{0}.json'.</b></font>format(video_id), video_id, 'Downloading video JSON', query={})
233         self._check_errors(video)
234         title = try_get(video, lambda x: x['titles']['en'], str)
235         episode_number = int_or_none(video.get('number'))
236         if not title:
237             title = 'Episode %d' % episode_number if video.get('type') == 'episode' else video.get('id') or video_id
238             container_titles = try_get(video, lambda x: x['container']['titles'], dict) or {}
239             container_title = self.dict_selection(container_titles, 'en')
240             if container_title and title == video_id:
241                 title = container_title
242             else:
243                 title = '%s - %s' % (container_title, title)
244         resp = self._call_api(
245             'playback_streams/%s.json?drms=dt3&amp;device_id=%s' % (video_id, self._DEVICE_ID),
246             video_id, 'Downloading video streams JSON')['main'][0]
247         mpd_url = resp['url']
248         mpd_content = self._download_webpage(mpd_url, video_id, note='Downloading initial MPD manifest')
249         mpd_url = self._search_regex(
250             r'(?mi)&lt;BaseURL&gt;(http.+.mpd)', mpd_content, 'new manifest', default=mpd_url)
251         if 'mpdhd_high' not in mpd_url:
252             mpd_url = mpd_url.replace('mpdhd', 'mpdhd_high')
253         formats = self._extract_mpd_formats(mpd_url, video_id)
254         self._sort_formats(formats)
255         description = self.dict_selection(video.get('descriptions', {}), 'en')
256         thumbnails = [{
257             'id': thumbnail_id,
258             'url': thumbnail['url'],
259         } for thumbnail_id, thumbnail in (video.get('images') or {}).items() if thumbnail.get('url')]
260         like_count = int_or_none(try_get(video, lambda x: x['likes']['count']))
261         stream_id = try_get(resp, lambda x: x['properties']['track']['stream_id'])
262         subtitles = dict((lang, [{
263             'ext': ext,
264             'url': self._API_URL_TEMPLATE % self._api_query(
265                 'videos/{0}/auth_subtitles/{1}.{2}'.format(video_id, lang, ext), stream_id=stream_id)
266         } for ext in ('srt', 'vtt')]) for lang in (video.get('subtitle_completions') or {}).keys())
267         return {
268             'id': video_id,
269             'formats': formats,
270             'title': title,
271             'description': description,
272             'duration': int_or_none(video.get('duration')),
273             'timestamp': parse_iso8601(video.get('created_at')),
274             'uploader': video.get('author'),
275             'uploader_url': video.get('author_url'),
276             'like_count': like_count,
277             'age_limit': parse_age_limit(video.get('rating')),
278             'thumbnails': thumbnails,
279             'subtitles': subtitles,
280             'episode_number': episode_number,
281         }
282 class VikiChannelIE(VikiBaseIE):
283     IE_NAME = 'viki:channel'
284     _VALID_URL = r'%s(?:tv|news|movies|artists)/(?P&lt;id&gt;[0-9]+c)' % VikiBaseIE._VALID_URL_BASE
285     _TESTS = [{
286         'url': 'http://www.viki.com/tv/50c-boys-over-flowers',
287         'info_dict': {
288             'id': '50c',
289             'title': 'Boys Over Flowers',
290             'description': 'md5:f08b679c200e1a273c695fe9986f21d7',
291         },
292         'playlist_mincount': 51,
293     }, {
294         'url': 'http://www.viki.com/tv/1354c-poor-nastya-complete',
295         'info_dict': {
296             'id': '1354c',
297             'title': 'Poor Nastya [COMPLETE]',
298             'description': 'md5:05bf5471385aa8b21c18ad450e350525',
299         },
300         'playlist_count': 127,
301         'skip': 'Page not found',
302     }, {
303         'url': 'http://www.viki.com/news/24569c-showbiz-korea',
304         'only_matching': True,
305     }, {
306         'url': 'http://www.viki.com/movies/22047c-pride-and-prejudice-2005',
307         'only_matching': True,
308     }, {
309         'url': 'http://www.viki.com/artists/2141c-shinee',
310         'only_matching': True,
311     }]
312     _video_types = ('episodes', 'movies', 'clips', 'trailers')
313     def _entries(self, channel_id):
314         params = {
315             'app': self._APP, 'token': self._token, 'only_ids': 'true',
316             'direction': 'asc', 'sort': 'number', 'per_page': 30
317         }
318         video_types = self._video_types
319         for video_type in video_types:
320             if video_type not in self._video_types:
321                 self.report_warning('Unknown video_type: ' + video_type)
322             page_num = 0
323             while True:
324                 page_num += 1
325                 params['page'] = page_num
326                 res = self._call_api(
327                     'containers/{channel_id}/{video_type}.json'.format(**locals()), channel_id, query=params, fatal=False,
328                     note='Downloading %s JSON page %d' % (video_type.title(), page_num))
329                 for video_id in res.get('response') or []:
330                     yield self.url_result('https://www.viki.com/videos/' + video_id, VikiIE.ie_key(), video_id)
331                 if not res.get('more'):
332                     break
333     def _real_extract(self, url):
334         channel_id = self._match_id(url)
335         channel = self._call_api('containers/%s.json' % channel_id, channel_id, 'Downloading channel JSON')
336         self._check_errors(channel)
337         return self.playlist_result(
338             self._entries(channel_id), channel_id,
339             self.dict_selection(channel['titles'], 'en'),
340             self.dict_selection(channel['descriptions'], 'en'))
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
