<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_sqlite3_1.py &amp; test_ipaddress.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_sqlite3_1.py &amp; test_ipaddress.py
      </h3>
<h1 align="center">
        1.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_sqlite3_1.py (48.076923%)<th>test_ipaddress.py (0.90203863%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(96-110)<td><a href="#" name="0">(713-720)</a><td align="center"><font color="#ff0000">18</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(67-91)<td><a href="#" name="1">(159-169)</a><td align="center"><font color="#ff0000">18</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(118-129)<td><a href="#" name="2">(894-903)</a><td align="center"><font color="#c60000">14</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_sqlite3_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.sqlite3 as sqlite3
2 from tests.support.mixins import LoaderModuleMockMixin
3 from tests.support.unit import TestCase
4 class MockSqlite3:
5     version = "2.6.0"
6     sqlite_version = "3.8.2"
7     def __init__(self):
8         self.dbase = None
9         self.isolation_level = None
10     def connect(self, dbase, isolation_level=None):
11         self.dbase = dbase
12         self.isolation_level = isolation_level
13         return MockSqlite3()
14     @staticmethod
15     def cursor():
16         return MockSqlite3()
17     @staticmethod
18     def execute(sql):
19         return sql
20     @staticmethod
21     def fetchall():
22         return True
23 class Sqlite3TestCase(TestCase, LoaderModuleMockMixin):
24     def setup_loader_modules(self):
25         return {sqlite3: {"sqlite3": MockSqlite3()}}
26     def test_version(self):
27         Tests if it return version of pysqlite.
28         """
29         self.assertEqual(sqlite3.version(<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>), "2.6.0")
30     def test_sqlite_version(self):
31         """
32         Tests if it return version of sqlite.
33         """
34         self.assertEqual(sqlite3.sqlite_version(), "3.8.2")
35     def test_modify(self):
36         """
37         Tests if it issue an SQL query to sqlite3 (with no return data).
38         """
39         self.assertFalse(sqlite3.modify())
40         self.assertTrue(
41             sqlite3.modify("/root/test.db", "CREATE TABLE test(id INT, testdata TEXT);")
42         )
43     def</b></font> test_fetch(self):
44         """
45         (returns all rows, be careful!)
46         """
47         self<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertFalse(sqlite3.fetch())
48         self.assertTrue(
49             sqlite3.fetch("/root/test.db", "CREATE TABLE test(id INT, testdata TEXT);")
50         )
51     def test_tables(self):
52         """
53         Tests if it show all tables in the database.
54         """
55         self.assertFalse(sqlite3.tables())
56         self.assertTrue(sqlite3.tables(</b></font>"/root/test.db"))
57     def test_indices(self):
58         Tests if it show all indices in the database.
59         """
60         self<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertFalse(sqlite3.indices())
61         self.assertTrue(sqlite3.indices("/root/test.db"))
62     def test_indexes(self):
63         """
64         Tests if it show all indices in the database,
65         for people with poor spelling skills
66         """
67         self.assertTrue(sqlite3.indexes(</b></font>"/root/test.db"))
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_ipaddress.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import contextlib
2 import functools
3 import operator
4 import pickle
5 import re
6 import sys
7 import weakref
8 import pytest
9 from salt._compat import ipaddress
10 from tests.support.unit import TestCase, skipIf
11 @functools.total_ordering
12 class _LARGEST:
13     """
14     Object that is greater than anything (except itself).
15     """
16     def __eq__(self, other):
17         return isinstance(other, _LARGEST)
18     def __lt__(self, other):
19         return False
20 LARGEST = _LARGEST()
21 @functools.total_ordering
22 class _SMALLEST:
23     """
24     Object that is less than anything (except itself).
25     """
26     def __eq__(self, other):
27         return isinstance(other, _SMALLEST)
28     def __gt__(self, other):
29         return False
30 SMALLEST = _SMALLEST()
31 class BaseTestCase(TestCase):
32     @property
33     def factory(self):
34         raise NotImplementedError
35     @contextlib.contextmanager
36     def assertCleanError(self, exc_type, details, *args):
37         """
38         Ensure exception does not display a context by default
39         Wraps unittest.TestCase.assertRaisesRegex
40         """
41         if args:
42             details = details % args
43         cm = self.assertRaisesRegex(exc_type, details)
44         with cm as exc:
45             yield exc
46         if exc.exception.__context__ is not None:
47             self.assertTrue(exc.exception.__suppress_context__)
48     def assertAddressError(self, details, *args):
49         return self.assertCleanError(ipaddress.AddressValueError, details, *args)
50     def assertNetmaskError(self, details, *args):
51         return self.assertCleanError(ipaddress.NetmaskValueError, details, *args)
52     def assertInstancesEqual(self, lhs, rhs):
53         self.assertEqual(self.factory(lhs), self.factory(rhs))
54 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
55 class CommonTestMixin:
56     def test_empty_address(self):
57         with self.assertAddressError("Address cannot be empty"):
58             self.factory("")
59     def test_floats_rejected(self):
60         with self.assertAddressError(re.escape(repr("1.0"))):
61             self.factory(1.0)
62     def test_not_an_index_issue15559(self):
63         self.assertRaises(TypeError, operator.index, self.factory(1))
64         self.assertRaises(TypeError, hex, self.factory(1))
65         self.assertRaises(TypeError, bytes, self.factory(1))
66     def pickle_test(self, addr):
67         for proto in range(pickle.HIGHEST_PROTOCOL + 1):
68             with self.subTest(proto=proto):
69                 x = self.factory(addr)
70                 y = pickle.loads(pickle.dumps(x, proto))
71                 self.assertEqual(y, x)
72 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
73 class CommonTestMixin_v4(CommonTestMixin):
74     def test_leading_zeros(self):
75         msg = r"Leading zeros are not permitted in '\d+'"
76         addresses = [
77             "000.000.000.000",
78             "192.168.000.001",
79             "016.016.016.016",
80             "192.168.000.001",
81             "001.000.008.016",
82             "01.2.3.40",
83             "1.02.3.40",
84             "1.2.03.40",
85             "1.2.3.040",
86         ]
87             with self.subTest(address=address):
88                 with self.assertAddressError(msg):
89                     self.factory(add<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ress)
90     def test_int(self):
91         self.assertInstancesEqual(0, "0.0.0.0")
92         self.assertInstancesEqual(3232235521, "192.168.0.1")
93     def test_packed(self):
94         self.assertInstancesEqual(bytes.fromhex("00000000"), "0.0.0.0")
95         self.assertInstancesEqual(bytes.fromhex("c0a80001"), "192.168.0.1")
96     def</b></font> test_negative_ints_rejected(self):
97         msg = "-1 (&lt; 0) is not permitted as an IPv4 address"
98         with self.assertAddressError(re.escape(msg)):
99             self.factory(-1)
100     def test_large_ints_rejected(self):
101         msg = "%d (&gt;= 2**32) is not permitted as an IPv4 address"
102         with self.assertAddressError(re.escape(msg % 2 ** 32)):
103             self.factory(2 ** 32)
104     def test_bad_packed_length(self):
105         def assertBadLength(length):
106             addr = b"\0" * length
107             msg = "%r (len %d != 4) is not permitted as an IPv4 address"
108             with self.assertAddressError(re.escape(msg % (addr, length))):
109                 self.factory(addr)
110         assertBadLength(3)
111         assertBadLength(5)
112 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
113 class CommonTestMixin_v6(CommonTestMixin):
114     def test_leading_zeros(self):
115         self.assertInstancesEqual("0000::0000", "::")
116         self.assertInstancesEqual("000::c0a8:0001", "::c0a8:1")
117     def test_int(self):
118         self.assertInstancesEqual(0, "::")
119         self.assertInstancesEqual(3232235521, "::c0a8:1")
120     def test_packed(self):
121         addr = b"\0" * 12 + bytes.fromhex("00000000")
122         self.assertInstancesEqual(addr, "::")
123         addr = b"\0" * 12 + bytes.fromhex("c0a80001")
124         self.assertInstancesEqual(addr, "::c0a8:1")
125         addr = bytes.fromhex("c0a80001") + b"\0" * 12
126         self.assertInstancesEqual(addr, "c0a8:1::")
127     def test_negative_ints_rejected(self):
128         msg = "-1 (&lt; 0) is not permitted as an IPv6 address"
129         with self.assertAddressError(re.escape(msg)):
130             self.factory(-1)
131     def test_large_ints_rejected(self):
132         msg = "%d (&gt;= 2**128) is not permitted as an IPv6 address"
133         with self.assertAddressError(re.escape(msg % 2 ** 128)):
134             self.factory(2 ** 128)
135     def test_bad_packed_length(self):
136         def assertBadLength(length):
137             addr = b"\0" * length
138             msg = "%r (len %d != 16) is not permitted as an IPv6 address"
139             with self.assertAddressError(re.escape(msg % (addr, length))):
140                 self.factory(addr)
141                 self.factory(addr)
142         assertBadLength(15)
143         assertBadLength(17)
144     def test_blank_scope_id(self):
145         address = "::1%"
146         with self.assertAddressError('Invalid IPv6 address: "%r"', address):
147             self.factory(address)
148     def test_invalid_scope_id_with_percent(self):
149         address = "::1%scope%"
150         with self.assertAddressError('Invalid IPv6 address: "%r"', address):
151             self.factory(address)
152 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
153 class AddressTestCase_v4(BaseTestCase, CommonTestMixin_v4):
154     factory = ipaddress.IPv4Address
155     @pytest.mark.skipif(sys.version_info &lt; (3, 6), reason="Don't run on Py3.5")
156     def test_format(self):
157         v4 = ipaddress.IPv4Address("1.2.3.42")
158         v4_pairs = [
159             ("b", "00000001000000100000001100101010"),
160             ("n", "00000001000000100000001100101010"),
161             ("x", "0102032a"),
162             ("X", "0102032A"),
163             ("_b", "0000_0001_0000_0010_0000_0011_0010_1010"),
164             ("_n", "0000_0001_0000_0010_0000_0011_0010_1010"),
165             ("_x", "0102_032a"),
166             ("_X", "0102_032A"),
167             ("#b", "0b00000001000000100000001100101010"),
168             ("#n", "0b00000001000000100000001100101010"),
169             ("#x", "0x0102032a"),
170             ("#X", "0X0102032A"),
171             ("#_b", "0b0000_0001_0000_0010_0000_0011_0010_1010"),
172             ("#_n", "0b0000_0001_0000_0010_0000_0011_0010_1010"),
173             ("#_x", "0x0102_032a"),
174             ("#_X", "0X0102_032A"),
175             ("s", "1.2.3.42"),
176             ("", "1.2.3.42"),
177         ]
178         for (fmt, txt) in v4_pairs:
179             self.assertEqual(txt, format(v4, fmt))
180     def test_network_passed_as_address(self):
181         addr = "127.0.0.1/24"
182         with self.assertAddressError("Unexpected '/' in %r", addr):
183             ipaddress.IPv4Address(addr)
184     def test_bad_address_split(self):
185         def assertBadSplit(addr):
186             with self.assertAddressError("Expected 4 octets in %r", addr):
187                 ipaddress.IPv4Address(addr)
188         assertBadSplit("127.0.1")
189         assertBadSplit("42.42.42.42.42")
190         assertBadSplit("42.42.42")
191         assertBadSplit("42.42")
192         assertBadSplit("42")
193         assertBadSplit("42..42.42.42")
194         assertBadSplit("42.42.42.42.")
195         assertBadSplit("42.42.42.42...")
196         assertBadSplit(".42.42.42.42")
197         assertBadSplit("...42.42.42.42")
198         assertBadSplit("016.016.016")
199         assertBadSplit("016.016")
200         assertBadSplit("016")
201         assertBadSplit("000")
202         assertBadSplit("0x0a.0x0a.0x0a")
203         assertBadSplit("0x0a.0x0a")
204         assertBadSplit("0x0a")
205         assertBadSplit(".")
206         assertBadSplit("bogus")
207         assertBadSplit("bogus.com")
208         assertBadSplit("1000")
209         assertBadSplit("1000000000000000")
210         assertBadSplit("192.168.0.1.com")
211     def test_empty_octet(self):
212         def assertBadOctet(addr):
213             with self.assertAddressError("Empty octet not permitted in %r", addr):
214                 ipaddress.IPv4Address(addr)
215         assertBadOctet("42..42.42")
216         assertBadOctet("...")
217     def test_invalid_characters(self):
218         def assertBadOctet(addr, octet):
219             msg = "Only decimal digits permitted in {!r} in {!r}".format(octet, addr)
220             with self.assertAddressError(re.escape(msg)):
221                 ipaddress.IPv4Address(addr)
222         assertBadOctet("0x0a.0x0a.0x0a.0x0a", "0x0a")
223         assertBadOctet("0xa.0x0a.0x0a.0x0a", "0xa")
224         assertBadOctet("42.42.42.-0", "-0")
225         assertBadOctet("42.42.42.+0", "+0")
226         assertBadOctet("42.42.42.-42", "-42")
227         assertBadOctet("+1.+2.+3.4", "+1")
228         assertBadOctet("1.2.3.4e0", "4e0")
229         assertBadOctet("1.2.3.4::", "4::")
230         assertBadOctet("1.a.2.3", "a")
231     def test_octet_length(self):
232         def assertBadOctet(addr, octet):
233             msg = "At most 3 characters permitted in %r in %r"
234             with self.assertAddressError(re.escape(msg % (octet, addr))):
235                 ipaddress.IPv4Address(addr)
236         assertBadOctet("0000.000.000.000", "0000")
237         assertBadOctet("12345.67899.-54321.-98765", "12345")
238     def test_octet_limit(self):
239         def assertBadOctet(addr, octet):
240             msg = "Octet %d (&gt; 255) not permitted in %r" % (octet, addr)
241             with self.assertAddressError(re.escape(msg)):
242                 ipaddress.IPv4Address(addr)
243         assertBadOctet("257.0.0.0", 257)
244         assertBadOctet("192.168.0.999", 999)
245     def test_pickle(self):
246         self.pickle_test("192.0.2.1")
247     def test_weakref(self):
248         weakref.ref(self.factory("192.0.2.1"))
249 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
250 class AddressTestCase_v6(BaseTestCase, CommonTestMixin_v6):
251     factory = ipaddress.IPv6Address
252     @pytest.mark.skipif(sys.version_info &lt; (3, 6), reason="Don't run on Py3.5")
253     def test_format(self):
254         v6 = ipaddress.IPv6Address("::1.2.3.42")
255         v6_pairs = [
256             (
257                 "b",
258                 "000000000000000000000000000000000000000000000000000000"
259                 "000000000000000000000000000000000000000000000000010000"
260                 "00100000001100101010",
261             ),
262             ("n", "0000000000000000000000000102032a"),
263             ("x", "0000000000000000000000000102032a"),
264             ("X", "0000000000000000000000000102032A"),
265             (
266                 "_b",
267                 "0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
268                 "_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
269                 "_0000_0000_0000_0000_0001_0000_0010_0000_0011_0010"
270                 "_1010",
271             ),
272             ("_n", "0000_0000_0000_0000_0000_0000_0102_032a"),
273             ("_x", "0000_0000_0000_0000_0000_0000_0102_032a"),
274             ("_X", "0000_0000_0000_0000_0000_0000_0102_032A"),
275             (
276                 "#b",
277                 "0b0000000000000000000000000000000000000000000000000000"
278                 "000000000000000000000000000000000000000000000000000100"
279                 "0000100000001100101010",
280             ),
281             ("#n", "0x0000000000000000000000000102032a"),
282             ("#x", "0x0000000000000000000000000102032a"),
283             ("#X", "0X0000000000000000000000000102032A"),
284             (
285                 "#_b",
286                 "0b0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
287                 "_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
288                 "_0000_0000_0000_0000_0000_0001_0000_0010_0000_0011"
289                 "_0010_1010",
290             ),
291             ("#_n", "0x0000_0000_0000_0000_0000_0000_0102_032a"),
292             ("#_x", "0x0000_0000_0000_0000_0000_0000_0102_032a"),
293             ("#_X", "0X0000_0000_0000_0000_0000_0000_0102_032A"),
294             ("s", "::102:32a"),
295             ("", "::102:32a"),
296         ]
297         for (fmt, txt) in v6_pairs:
298             self.assertEqual(txt, format(v6, fmt))
299     def test_network_passed_as_address(self):
300         def assertBadSplit(addr):
301             msg = "Unexpected '/' in %r"
302             with self.assertAddressError(msg, addr):
303                 ipaddress.IPv6Address(addr)
304         assertBadSplit("::1/24")
305         assertBadSplit("::1%scope_id/24")
306     def test_bad_address_split_v6_not_enough_parts(self):
307         def assertBadSplit(addr):
308             msg = "At least 3 parts expected in %r"
309             with self.assertAddressError(msg, addr.split("%")[0]):
310                 ipaddress.IPv6Address(addr)
311         assertBadSplit(":")
312         assertBadSplit(":1")
313         assertBadSplit("FEDC:9878")
314         assertBadSplit(":%scope")
315         assertBadSplit(":1%scope")
316         assertBadSplit("FEDC:9878%scope")
317     def test_bad_address_split_v6_too_many_colons(self):
318         def assertBadSplit(addr):
319             msg = "At most 8 colons permitted in %r"
320             with self.assertAddressError(msg, addr.split("%")[0]):
321                 ipaddress.IPv6Address(addr)
322         assertBadSplit("9:8:7:6:5:4:3::2:1")
323         assertBadSplit("10:9:8:7:6:5:4:3:2:1")
324         assertBadSplit("::8:7:6:5:4:3:2:1")
325         assertBadSplit("8:7:6:5:4:3:2:1::")
326         assertBadSplit("10:9:8:7:6:5:4:3:42.42.42.42")
327         assertBadSplit("9:8:7:6:5:4:3::2:1%scope")
328         assertBadSplit("10:9:8:7:6:5:4:3:2:1%scope")
329         assertBadSplit("::8:7:6:5:4:3:2:1%scope")
330         assertBadSplit("8:7:6:5:4:3:2:1::%scope")
331         assertBadSplit("10:9:8:7:6:5:4:3:42.42.42.42%scope")
332     def test_bad_address_split_v6_too_many_parts(self):
333         def assertBadSplit(addr):
334             msg = "Exactly 8 parts expected without '::' in %r"
335             with self.assertAddressError(msg, addr.split("%")[0]):
336                 ipaddress.IPv6Address(addr)
337         assertBadSplit("3ffe:0:0:0:0:0:0:0:1")
338         assertBadSplit("9:8:7:6:5:4:3:2:1")
339         assertBadSplit("7:6:5:4:3:2:1")
340         assertBadSplit("9:8:7:6:5:4:3:42.42.42.42")
341         assertBadSplit("7:6:5:4:3:42.42.42.42")
342         assertBadSplit("3ffe:0:0:0:0:0:0:0:1%scope")
343         assertBadSplit("9:8:7:6:5:4:3:2:1%scope")
344         assertBadSplit("7:6:5:4:3:2:1%scope")
345         assertBadSplit("9:8:7:6:5:4:3:42.42.42.42%scope")
346         assertBadSplit("7:6:5:4:3:42.42.42.42%scope")
347     def test_bad_address_split_v6_too_many_parts_with_double_colon(self):
348         def assertBadSplit(addr):
349             msg = "Expected at most 7 other parts with '::' in %r"
350             with self.assertAddressError(msg, addr.split("%")[0]):
351                 ipaddress.IPv6Address(addr)
352         assertBadSplit("1:2:3:4::5:6:7:8")
353         assertBadSplit("1:2:3:4::5:6:7:8%scope")
354     def test_bad_address_split_v6_repeated_double_colon(self):
355         def assertBadSplit(addr):
356             msg = "At most one '::' permitted in %r"
357             with self.assertAddressError(msg, addr.split("%")[0]):
358                 ipaddress.IPv6Address(addr)
359         assertBadSplit("3ffe::1::1")
360         assertBadSplit("1::2::3::4:5")
361         assertBadSplit("2001::db:::1")
362         assertBadSplit("3ffe::1::")
363         assertBadSplit("::3ffe::1")
364         assertBadSplit(":3ffe::1::1")
365         assertBadSplit("3ffe::1::1:")
366         assertBadSplit(":3ffe::1::1:")
367         assertBadSplit(":::")
368         assertBadSplit("2001:db8:::1")
369         assertBadSplit("3ffe::1::1%scope")
370         assertBadSplit("1::2::3::4:5%scope")
371         assertBadSplit("2001::db:::1%scope")
372         assertBadSplit("3ffe::1::%scope")
373         assertBadSplit("::3ffe::1%scope")
374         assertBadSplit(":3ffe::1::1%scope")
375         assertBadSplit("3ffe::1::1:%scope")
376         assertBadSplit(":3ffe::1::1:%scope")
377         assertBadSplit(":::%scope")
378         assertBadSplit("2001:db8:::1%scope")
379     def test_bad_address_split_v6_leading_colon(self):
380         def assertBadSplit(addr):
381             msg = "Leading ':' only permitted as part of '::' in %r"
382             with self.assertAddressError(msg, addr.split("%")[0]):
383                 ipaddress.IPv6Address(addr)
384         assertBadSplit(":2001:db8::1")
385         assertBadSplit(":1:2:3:4:5:6:7")
386         assertBadSplit(":1:2:3:4:5:6:")
387         assertBadSplit(":6:5:4:3:2:1::")
388         assertBadSplit(":2001:db8::1%scope")
389         assertBadSplit(":1:2:3:4:5:6:7%scope")
390         assertBadSplit(":1:2:3:4:5:6:%scope")
391         assertBadSplit(":6:5:4:3:2:1::%scope")
392     def test_bad_address_split_v6_trailing_colon(self):
393         def assertBadSplit(addr):
394             msg = "Trailing ':' only permitted as part of '::' in %r"
395             with self.assertAddressError(msg, addr.split("%")[0]):
396                 ipaddress.IPv6Address(addr)
397         assertBadSplit("2001:db8::1:")
398         assertBadSplit("1:2:3:4:5:6:7:")
399         assertBadSplit("::1.2.3.4:")
400         assertBadSplit("::7:6:5:4:3:2:")
401         assertBadSplit("2001:db8::1:%scope")
402         assertBadSplit("1:2:3:4:5:6:7:%scope")
403         assertBadSplit("::1.2.3.4:%scope")
404         assertBadSplit("::7:6:5:4:3:2:%scope")
405     def test_bad_v4_part_in(self):
406         def assertBadAddressPart(addr, v4_error):
407             with self.assertAddressError("%s in %r", v4_error, addr.split("%")[0]):
408                 ipaddress.IPv6Address(addr)
409         assertBadAddressPart("3ffe::1.net", "Expected 4 octets in '1.net'")
410         assertBadAddressPart("3ffe::127.0.1", "Expected 4 octets in '127.0.1'")
411         assertBadAddressPart("::1.2.3", "Expected 4 octets in '1.2.3'")
412         assertBadAddressPart("::1.2.3.4.5", "Expected 4 octets in '1.2.3.4.5'")
413         assertBadAddressPart(
414             "3ffe::1.1.1.net",
415             "Only decimal digits permitted in 'net' in '1.1.1.net'",
416         )
417         assertBadAddressPart("3ffe::1.net%scope", "Expected 4 octets in '1.net'")
418         assertBadAddressPart("3ffe::127.0.1%scope", "Expected 4 octets in '127.0.1'")
419         assertBadAddressPart("::1.2.3%scope", "Expected 4 octets in '1.2.3'")
420         assertBadAddressPart("::1.2.3.4.5%scope", "Expected 4 octets in '1.2.3.4.5'")
421         assertBadAddressPart(
422             "3ffe::1.1.1.net%scope",
423             "Only decimal digits permitted in 'net' in '1.1.1.net'",
424         )
425     def test_invalid_characters(self):
426         def assertBadPart(addr, part):
427             msg = "Only hex digits permitted in {!r} in {!r}".format(
428                 part, addr.split("%")[0]
429             )
430             with self.assertAddressError(re.escape(msg)):
431                 ipaddress.IPv6Address(addr)
432         assertBadPart("3ffe::goog", "goog")
433         assertBadPart("3ffe::-0", "-0")
434         assertBadPart("3ffe::+0", "+0")
435         assertBadPart("3ffe::-1", "-1")
436         assertBadPart("1.2.3.4::", "1.2.3.4")
437         assertBadPart("1234:axy::b", "axy")
438         assertBadPart("3ffe::goog%scope", "goog")
439         assertBadPart("3ffe::-0%scope", "-0")
440         assertBadPart("3ffe::+0%scope", "+0")
441         assertBadPart("3ffe::-1%scope", "-1")
442         assertBadPart("1.2.3.4::%scope", "1.2.3.4")
443         assertBadPart("1234:axy::b%scope", "axy")
444     def test_part_length(self):
445         def assertBadPart(addr, part):
446             msg = "At most 4 characters permitted in %r in %r"
447             with self.assertAddressError(msg, part, addr.split("%")[0]):
448                 ipaddress.IPv6Address(addr)
449         assertBadPart("::00000", "00000")
450         assertBadPart("3ffe::10000", "10000")
451         assertBadPart("02001:db8::", "02001")
452         assertBadPart("2001:888888::1", "888888")
453         assertBadPart("::00000%scope", "00000")
454         assertBadPart("3ffe::10000%scope", "10000")
455         assertBadPart("02001:db8::%scope", "02001")
456         assertBadPart("2001:888888::1%scope", "888888")
457     def test_pickle(self):
458         self.pickle_test("2001:db8::")
459     def test_weakref(self):
460         weakref.ref(self.factory("2001:db8::"))
461         weakref.ref(self.factory("2001:db8::%scope"))
462 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
463 class NetmaskTestMixin_v4(CommonTestMixin_v4):
464     def test_no_mask(self):
465         for address in ("1.2.3.4", 0x01020304, b"\x01\x02\x03\x04"):
466             net = self.factory(address)
467             self.assertEqual(str(net), "1.2.3.4/32")
468             self.assertEqual(str(net.netmask), "255.255.255.255")
469             self.assertEqual(str(net.hostmask), "0.0.0.0")
470     def test_split_netmask(self):
471         addr = "1.2.3.4/32/24"
472         with self.assertAddressError("Only one '/' permitted in %r" % addr):
473             self.factory(addr)
474     def test_address_errors(self):
475         def assertBadAddress(addr, details):
476             with self.assertAddressError(details):
477                 self.factory(addr)
478         assertBadAddress("/", "Address cannot be empty")
479         assertBadAddress("/8", "Address cannot be empty")
480         assertBadAddress("bogus", "Expected 4 octets")
481         assertBadAddress("google.com", "Expected 4 octets")
482         assertBadAddress("10/8", "Expected 4 octets")
483         assertBadAddress("::1.2.3.4", "Only decimal digits")
484         assertBadAddress("1.2.3.256", re.escape("256 (&gt; 255)"))
485     def test_valid_netmask(self):
486         self.assertEqual(str(self.factory("192.0.2.0/255.255.255.0")), "192.0.2.0/24")
487         for i in range(0, 33):
488             net_str = "0.0.0.0/%d" % i
489             net = self.factory(net_str)
490             self.assertEqual(str(net), net_str)
491             self.assertEqual(str(self.factory("0.0.0.0/%s" % net.netmask)), net_str)
492             self.assertEqual(str(self.factory("0.0.0.0/0%d" % i)), net_str)
493             if i in (32, 0):
494                 net_str = "0.0.0.0/%d" % (32 - i)
495             self.assertEqual(str(self.factory("0.0.0.0/%s" % net.hostmask)), net_str)
496     def test_netmask_errors(self):
497         def assertBadNetmask(addr, netmask):
498             msg = "%r is not a valid netmask" % netmask
499             with self.assertNetmaskError(re.escape(msg)):
500                 self.factory("{}/{}".format(addr, netmask))
501         assertBadNetmask("1.2.3.4", "")
502         assertBadNetmask("1.2.3.4", "-1")
503         assertBadNetmask("1.2.3.4", "+1")
504         assertBadNetmask("1.2.3.4", " 1 ")
505         assertBadNetmask("1.2.3.4", "0x1")
506         assertBadNetmask("1.2.3.4", "33")
507         assertBadNetmask("1.2.3.4", "254.254.255.256")
508         assertBadNetmask("1.2.3.4", "1.a.2.3")
509         assertBadNetmask("1.1.1.1", "254.xyz.2.3")
510         assertBadNetmask("1.1.1.1", "240.255.0.0")
511         assertBadNetmask("1.1.1.1", "255.254.128.0")
512         assertBadNetmask("1.1.1.1", "0.1.127.255")
513         assertBadNetmask("1.1.1.1", "pudding")
514         assertBadNetmask("1.1.1.1", "::")
515     def test_netmask_in_tuple_errors(self):
516         def assertBadNetmask(addr, netmask):
517             msg = "%r is not a valid netmask" % netmask
518             with self.assertNetmaskError(re.escape(msg)):
519                 self.factory((addr, netmask))
520         assertBadNetmask("1.1.1.1", -1)
521         assertBadNetmask("1.1.1.1", 33)
522     def test_pickle(self):
523         self.pickle_test("192.0.2.0/27")
524         self.pickle_test("192.0.2.0/31")  # IPV4LENGTH - 1
525         self.pickle_test("192.0.2.0")  # IPV4LENGTH
526 class InterfaceTestCase_v4(BaseTestCase, NetmaskTestMixin_v4):
527     factory = ipaddress.IPv4Interface
528 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
529 class NetworkTestCase_v4(BaseTestCase, NetmaskTestMixin_v4):
530     factory = ipaddress.IPv4Network
531     def test_subnet_of(self):
532         self.assertFalse(
533             self.factory("10.0.0.0/30").subnet_of(self.factory("10.0.1.0/24"))
534         )
535         self.assertTrue(
536             self.factory("10.0.0.0/30").subnet_of(self.factory("10.0.0.0/24"))
537         )
538         self.assertFalse(
539         )
540         self<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertFalse(
541             self.factory("10.0.1.0/24").subnet_of(self.factory("10.0.0.0/30"))
542         )
543     def test_supernet_of(self):
544         self.assertFalse(
545             self.factory("10.0.0.0/30").supernet_of(self.factory(</b></font>"10.0.1.0/24"))
546         )
547         self.assertFalse(
548             self.factory("10.0.0.0/30").supernet_of(self.factory("10.0.0.0/24"))
549         )
550         self.assertFalse(
551             self.factory("10.0.0.0/30").supernet_of(self.factory("10.0.1.0/24"))
552         )
553         self.assertTrue(
554             self.factory("10.0.0.0/24").supernet_of(self.factory("10.0.0.0/30"))
555         )
556     def test_subnet_of_mixed_types(self):
557         with self.assertRaises(TypeError):
558             ipaddress.IPv4Network("10.0.0.0/30").supernet_of(
559                 ipaddress.IPv6Network("::1/128")
560             )
561         with self.assertRaises(TypeError):
562             ipaddress.IPv6Network("::1/128").supernet_of(
563                 ipaddress.IPv4Network("10.0.0.0/30")
564             )
565         with self.assertRaises(TypeError):
566             ipaddress.IPv4Network("10.0.0.0/30").subnet_of(
567                 ipaddress.IPv6Network("::1/128")
568             )
569         with self.assertRaises(TypeError):
570             ipaddress.IPv6Network("::1/128").subnet_of(
571                 ipaddress.IPv4Network("10.0.0.0/30")
572             )
573 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
574 class NetmaskTestMixin_v6(CommonTestMixin_v6):
575     def test_no_mask(self):
576         for address in ("::1", 1, b"\x00" * 15 + b"\x01"):
577             net = self.factory(address)
578             self.assertEqual(str(net), "::1/128")
579             self.assertEqual(
580                 str(net.netmask), "ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"
581             )
582             self.assertEqual(str(net.hostmask), "::")
583         scoped_net = self.factory("::1%scope")
584         self.assertEqual(str(scoped_net), "::1%scope/128")
585         self.assertEqual(
586             str(scoped_net.netmask), "ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"
587         )
588         self.assertEqual(str(scoped_net.hostmask), "::")
589     def test_split_netmask(self):
590         addr = "cafe:cafe::/128/190"
591         with self.assertAddressError("Only one '/' permitted in %r" % addr):
592             self.factory(addr)
593         scoped_addr = "cafe:cafe::%scope/128/190"
594         with self.assertAddressError("Only one '/' permitted in %r" % scoped_addr):
595             self.factory(scoped_addr)
596     def test_address_errors(self):
597         def assertBadAddress(addr, details):
598             with self.assertAddressError(details):
599                 self.factory(addr)
600         assertBadAddress("/", "Address cannot be empty")
601         assertBadAddress("/8", "Address cannot be empty")
602         assertBadAddress("google.com", "At least 3 parts")
603         assertBadAddress("1.2.3.4", "At least 3 parts")
604         assertBadAddress("10/8", "At least 3 parts")
605         assertBadAddress("1234:axy::b", "Only hex digits")
606         assertBadAddress("/%scope", "Address cannot be empty")
607         assertBadAddress("/%scope8", "Address cannot be empty")
608         assertBadAddress("google.com%scope", "At least 3 parts")
609         assertBadAddress("1.2.3.4%scope", "At least 3 parts")
610         assertBadAddress("10%scope/8", "At least 3 parts")
611         assertBadAddress("1234:axy::b%scope", "Only hex digits")
612     def test_valid_netmask(self):
613         self.assertEqual(str(self.factory("2001:db8::/32")), "2001:db8::/32")
614         for i in range(0, 129):
615             net_str = "::/%d" % i
616             self.assertEqual(str(self.factory(net_str)), net_str)
617             self.assertEqual(str(self.factory("::/0%d" % i)), net_str)
618         self.assertEqual(
619             str(self.factory("2001:db8::%scope/32")), "2001:db8::%scope/32"
620         )
621         for i in range(0, 129):
622             net_str = "::/%d" % i
623             self.assertEqual(str(self.factory(net_str)), net_str)
624             self.assertEqual(str(self.factory("::/0%d" % i)), net_str)
625     def test_netmask_errors(self):
626         def assertBadNetmask(addr, netmask):
627             msg = "%r is not a valid netmask" % netmask
628             with self.assertNetmaskError(re.escape(msg)):
629                 self.factory("{}/{}".format(addr, netmask))
630         assertBadNetmask("::1", "")
631         assertBadNetmask("::1", "::1")
632         assertBadNetmask("::1", "1::")
633         assertBadNetmask("::1", "-1")
634         assertBadNetmask("::1", "+1")
635         assertBadNetmask("::1", " 1 ")
636         assertBadNetmask("::1", "0x1")
637         assertBadNetmask("::1", "129")
638         assertBadNetmask("::1", "1.2.3.4")
639         assertBadNetmask("::1", "pudding")
640         assertBadNetmask("::", "::")
641         assertBadNetmask("::1%scope", "pudding")
642     def test_netmask_in_tuple_errors(self):
643         def assertBadNetmask(addr, netmask):
644             msg = "%r is not a valid netmask" % netmask
645             with self.assertNetmaskError(re.escape(msg)):
646                 self.factory((addr, netmask))
647         assertBadNetmask("::1", -1)
648         assertBadNetmask("::1", 129)
649         assertBadNetmask("::1%scope", 129)
650     def test_pickle(self):
651         self.pickle_test("2001:db8::1000/124")
652         self.pickle_test("2001:db8::1000/127")  # IPV6LENGTH - 1
653         self.pickle_test("2001:db8::1000")  # IPV6LENGTH
654         self.pickle_test("2001:db8::1000%scope")  # IPV6LENGTH
655 class InterfaceTestCase_v6(BaseTestCase, NetmaskTestMixin_v6):
656     factory = ipaddress.IPv6Interface
657 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
658 class NetworkTestCase_v6(BaseTestCase, NetmaskTestMixin_v6):
659     factory = ipaddress.IPv6Network
660     def test_subnet_of(self):
661         self.assertFalse(
662             self.factory("2000:999::/56").subnet_of(self.factory("2000:aaa::/48"))
663         )
664         self.assertTrue(
665             self.factory("2000:aaa::/56").subnet_of(self.factory("2000:aaa::/48"))
666         )
667         self.assertFalse(
668             self.factory("2000:bbb::/56").subnet_of(self.factory("2000:aaa::/48"))
669         )
670         self.assertFalse(
671             self.factory("2000:aaa::/48").subnet_of(self.factory("2000:aaa::/56"))
672         )
673         self.assertFalse(
674             self.factory("2000:999::%scope/56").subnet_of(
675             )
676         )
677         self<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertTrue(
678             self.factory("2000:aaa::%scope/56").subnet_of(
679                 self.factory("2000:aaa::%scope/48")
680             )
681         )
682     def test_supernet_of(self):
683         self.assertFalse(
684             self.factory(</b></font>"2000:999::/56").supernet_of(self.factory("2000:aaa::/48"))
685         )
686         self.assertFalse(
687             self.factory("2000:aaa::/56").supernet_of(self.factory("2000:aaa::/48"))
688         )
689         self.assertFalse(
690             self.factory("2000:bbb::/56").supernet_of(self.factory("2000:aaa::/48"))
691         )
692         self.assertTrue(
693             self.factory("2000:aaa::/48").supernet_of(self.factory("2000:aaa::/56"))
694         )
695 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
696 class FactoryFunctionErrors(BaseTestCase):
697     def assertFactoryError(self, factory, kind):
698         addr = "camelot"
699         msg = "%r does not appear to be an IPv4 or IPv6 %s"
700         with self.assertCleanError(ValueError, msg, addr, kind):
701             factory(addr)
702     def test_ip_address(self):
703         self.assertFactoryError(ipaddress.ip_address, "address")
704     def test_ip_interface(self):
705         self.assertFactoryError(ipaddress.ip_interface, "interface")
706     def test_ip_network(self):
707         self.assertFactoryError(ipaddress.ip_network, "network")
708 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
709 class ComparisonTests(TestCase):
710     v4addr = ipaddress.IPv4Address(1)
711     v4net = ipaddress.IPv4Network(1)
712     v4intf = ipaddress.IPv4Interface(1)
713     v6addr = ipaddress.IPv6Address(1)
714     v6net = ipaddress.IPv6Network(1)
715     v6intf = ipaddress.IPv6Interface(1)
716     v6addr_scoped = ipaddress.IPv6Address("::1%scope")
717     v6net_scoped = ipaddress.IPv6Network("::1%scope")
718     v6intf_scoped = ipaddress.IPv6Interface("::1%scope")
719     v4_addresses = [v4addr, v4intf]
720     v4_objects = v4_addresses + [v4net]
721     v6_addresses = [v6addr, v6intf]
722     v6_objects = v6_addresses + [v6net]
723     v6_scoped_addresses = [v6addr_scoped, v6intf_scoped]
724     v6_scoped_objects = v6_scoped_addresses + [v6net_scoped]
725     objects = v4_objects + v6_objects
726     objects_with_scoped = objects + v6_scoped_objects
727     v4addr2 = ipaddress.IPv4Address(2)
728     v4net2 = ipaddress.IPv4Network(2)
729     v4intf2 = ipaddress.IPv4Interface(2)
730     v6addr2 = ipaddress.IPv6Address(2)
731     v6net2 = ipaddress.IPv6Network(2)
732     v6intf2 = ipaddress.IPv6Interface(2)
733     v6addr2_scoped = ipaddress.IPv6Address("::2%scope")
734     v6net2_scoped = ipaddress.IPv6Network("::2%scope")
735     v6intf2_scoped = ipaddress.IPv6Interface("::2%scope")
736     def test_foreign_type_equality(self):
737         other = object()
738         for obj in self.objects_with_scoped:
739             self.assertNotEqual(obj, other)
740             self.assertFalse(obj == other)
741             self.assertEqual(obj.__eq__(other), NotImplemented)
742             self.assertEqual(obj.__ne__(other), NotImplemented)
743     def test_mixed_type_equality(self):
744         for lhs in self.objects:
745             for rhs in self.objects:
746                 if lhs is rhs:
747                     continue
748                 self.assertNotEqual(lhs, rhs)
749     def test_scoped_ipv6_equality(self):
750         for lhs, rhs in zip(self.v6_objects, self.v6_scoped_objects):
751             self.assertNotEqual(lhs, rhs)
752     def test_v4_with_v6_scoped_equality(self):
753         for lhs in self.v4_objects:
754             for rhs in self.v6_scoped_objects:
755                 self.assertNotEqual(lhs, rhs)
756     def test_same_type_equality(self):
757         for obj in self.objects_with_scoped:
758             self.assertEqual(obj, obj)
759             self.assertLessEqual(obj, obj)
760             self.assertGreaterEqual(obj, obj)
761     def test_same_type_ordering(self):
762         for lhs, rhs in (
763             (self.v4addr, self.v4addr2),
764             (self.v4net, self.v4net2),
765             (self.v4intf, self.v4intf2),
766             (self.v6addr, self.v6addr2),
767             (self.v6net, self.v6net2),
768             (self.v6intf, self.v6intf2),
769             (self.v6addr_scoped, self.v6addr2_scoped),
770             (self.v6net_scoped, self.v6net2_scoped),
771             (self.v6intf_scoped, self.v6intf2_scoped),
772         ):
773             self.assertNotEqual(lhs, rhs)
774             self.assertLess(lhs, rhs)
775             self.assertLessEqual(lhs, rhs)
776             self.assertGreater(rhs, lhs)
777             self.assertGreaterEqual(rhs, lhs)
778             self.assertFalse(lhs &gt; rhs)
779             self.assertFalse(rhs &lt; lhs)
780             self.assertFalse(lhs &gt;= rhs)
781             self.assertFalse(rhs &lt;= lhs)
782     def test_containment(self):
783         for obj in self.v4_addresses:
784             self.assertIn(obj, self.v4net)
785         for obj in self.v6_addresses + self.v6_scoped_addresses:
786             self.assertIn(obj, self.v6net)
787         for obj in self.v6_addresses + self.v6_scoped_addresses:
788             self.assertIn(obj, self.v6net_scoped)
789         for obj in self.v4_objects + [self.v6net, self.v6net_scoped]:
790             self.assertNotIn(obj, self.v6net)
791         for obj in self.v4_objects + [self.v6net, self.v6net_scoped]:
792             self.assertNotIn(obj, self.v6net_scoped)
793         for obj in self.v6_objects + self.v6_scoped_objects + [self.v4net]:
794             self.assertNotIn(obj, self.v4net)
795     def test_mixed_type_ordering(self):
796         for lhs in self.objects_with_scoped:
797             for rhs in self.objects_with_scoped:
798                 if isinstance(lhs, type(rhs)) or isinstance(rhs, type(lhs)):
799                     continue
800                 self.assertRaises(TypeError, lambda: lhs &lt; rhs)
801                 self.assertRaises(TypeError, lambda: lhs &gt; rhs)
802                 self.assertRaises(TypeError, lambda: lhs &lt;= rhs)
803                 self.assertRaises(TypeError, lambda: lhs &gt;= rhs)
804     def test_foreign_type_ordering(self):
805         other = object()
806         for obj in self.objects_with_scoped:
807             with self.assertRaises(TypeError):
808                 obj &lt; other
809             with self.assertRaises(TypeError):
810                 obj &gt; other
811             with self.assertRaises(TypeError):
812                 obj &lt;= other
813             with self.assertRaises(TypeError):
814                 obj &gt;= other
815             self.assertTrue(obj &lt; LARGEST)
816             self.assertFalse(obj &gt; LARGEST)
817             self.assertTrue(obj &lt;= LARGEST)
818             self.assertFalse(obj &gt;= LARGEST)
819             self.assertFalse(obj &lt; SMALLEST)
820             self.assertTrue(obj &gt; SMALLEST)
821             self.assertFalse(obj &lt;= SMALLEST)
822             self.assertTrue(obj &gt;= SMALLEST)
823     def test_mixed_type_key(self):
824         v4_ordered = [self.v4addr, self.v4net, self.v4intf]
825         v6_ordered = [self.v6addr, self.v6net, self.v6intf]
826         v6_scoped_ordered = [self.v6addr_scoped, self.v6net_scoped, self.v6intf_scoped]
827         self.assertEqual(
828             v4_ordered, sorted(self.v4_objects, key=ipaddress.get_mixed_type_key)
829         )
830         self.assertEqual(
831             v6_ordered, sorted(self.v6_objects, key=ipaddress.get_mixed_type_key)
832         )
833         self.assertEqual(
834             v6_scoped_ordered,
835             sorted(self.v6_scoped_objects, key=ipaddress.get_mixed_type_key),
836         )
837         self.assertEqual(
838             v4_ordered + v6_scoped_ordered,
839             sorted(
840                 self.v4_objects + self.v6_scoped_objects,
841                 key=ipaddress.get_mixed_type_key,
842             ),
843         )
844         self.assertEqual(NotImplemented, ipaddress.get_mixed_type_key(object))
845     def test_incompatible_versions(self):
846         v4addr = ipaddress.ip_address("1.1.1.1")
847         v4net = ipaddress.ip_network("1.1.1.1")
848         v6addr = ipaddress.ip_address("::1")
849         v6net = ipaddress.ip_network("::1")
850         v6addr_scoped = ipaddress.ip_address("::1%scope")
851         v6net_scoped = ipaddress.ip_network("::1%scope")
852         self.assertRaises(TypeError, v4addr.__lt__, v6addr)
853         self.assertRaises(TypeError, v4addr.__gt__, v6addr)
854         self.assertRaises(TypeError, v4net.__lt__, v6net)
855         self.assertRaises(TypeError, v4net.__gt__, v6net)
856         self.assertRaises(TypeError, v6addr.__lt__, v4addr)
857         self.assertRaises(TypeError, v6addr.__gt__, v4addr)
858         self.assertRaises(TypeError, v6net.__lt__, v4net)
859         self.assertRaises(TypeError, v6net.__gt__, v4net)
860         self.assertRaises(TypeError, v4addr.__lt__, v6addr_scoped)
861         self.assertRaises(TypeError, v4addr.__gt__, v6addr_scoped)
862         self.assertRaises(TypeError, v4net.__lt__, v6net_scoped)
863         self.assertRaises(TypeError, v4net.__gt__, v6net_scoped)
864         self.assertRaises(TypeError, v6addr_scoped.__lt__, v4addr)
865         self.assertRaises(TypeError, v6addr_scoped.__gt__, v4addr)
866         self.assertRaises(TypeError, v6net_scoped.__lt__, v4net)
867         self.assertRaises(TypeError, v6net_scoped.__gt__, v4net)
868 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
869 class IpaddrUnitTest(TestCase):
870     def setUp(self):
871         self.ipv4_address = ipaddress.IPv4Address("1.2.3.4")
872         self.ipv4_interface = ipaddress.IPv4Interface("1.2.3.4/24")
873         self.ipv4_network = ipaddress.IPv4Network("1.2.3.0/24")
874         self.ipv6_address = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1")
875         self.ipv6_interface = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1/64")
876         self.ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/64")
877         self.ipv6_scoped_address = ipaddress.IPv6Interface(
878             "2001:658:22a:cafe:200:0:0:1%scope"
879         )
880         self.ipv6_scoped_interface = ipaddress.IPv6Interface(
881             "2001:658:22a:cafe:200:0:0:1%scope/64"
882         )
883         self.ipv6_scoped_network = ipaddress.IPv6Network("2001:658:22a:cafe::%scope/64")
884     def testRepr(self):
885         self.assertEqual(
886             "IPv4Interface('1.2.3.4/32')", repr(ipaddress.IPv4Interface("1.2.3.4"))
887         )
888         self.assertEqual(
889             "IPv6Interface('::1/128')", repr(ipaddress.IPv6Interface("::1"))
890         )
891         self.assertEqual(
892             "IPv6Interface('::1%scope/128')", repr(ipaddress.IPv6Interface("::1%scope"))
893         )
894     def testIPv4Tuple(self):
895         ip = ipaddress.IPv4Address("192.0.2.1")
896         net = ipaddress.IPv4Network("192.0.2.1/32")
897         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", 32)), net)
898         self.assertEqual(ipaddress.IPv4Network((ip, 32)), net)
899         self.assertEqual(ipaddress.IPv4Network((3221225985, 32)), net)
900         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", "255.255.255.255")), net)
901         self.assertEqual(ipaddress.IPv4Network((ip, "255.255.255.255")), net)
902         self.assertEqual(ipaddress.IPv4Network((3221225985, "255.255.255.255")), net)
903         with self.assertRaises(ValueError):
904             ipaddress.IPv4Network(("192.0.2.1", 24))
905         with self.assertRaises(ValueError):
906             ipaddress.IPv4Network((ip, 24))
907         with self.assertRaises(ValueError):
908             ipaddress.IPv4Network((3221225985, 24))
909         with self.assertRaises(ValueError):
910             ipaddress.IPv4Network(("192.0.2.1", "255.255.255.0"))
911         with self.assertRaises(ValueError):
912             ipaddress.IPv4Network((ip, "255.255.255.0"))
913         with self.assertRaises(ValueError):
914             ipaddress.IPv4Network((3221225985, "255.255.255.0"))
915         net = ipaddress.IPv4Network("192.0.2.0/24")
916         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", 24), strict=False), net)
917         self.assertEqual(ipaddress.IPv4Network((ip, 24), strict=False), net)
918         self.assertEqual(ipaddress.IPv4Network((3221225985, 24), strict=False), net)
919         self.assertEqual(
920             ipaddress.IPv4Network(("192.0.2.1", "255.255.255.0"), strict=False), net
921         )
922         self.assertEqual(
923             ipaddress.IPv4Network((ip, "255.255.255.0"), strict=False), net
924         )
925         self.assertEqual(
926             ipaddress.IPv4Network((3221225985, "255.255.255.0"), strict=False), net
927         )
928         ip = ipaddress.IPv4Address("192.0.2.0")
929         net = ipaddress.IPv4Network("192.0.2.0/24")
930         self.assertEqual(ipaddress.IPv4Network(("192.0.2.0", "255.255.255.0")), net)
931         self.assertEqual(ipaddress.IPv4Network((ip, "255.255.255.0")), net)
932         self.assertEqual(ipaddress.IPv4Network((3221225984, "255.255.255.0")), net)
933         self.assertEqual(ipaddress.IPv4Network(("192.0.2.0", 24)), net)
934         self.assertEqual(ipaddress.IPv4Network((ip, 24)), net)
935         self.assertEqual(ipaddress.IPv4Network((3221225984, 24)), net)
936         self.assertEqual(
937             ipaddress.IPv4Interface(("192.0.2.1", 24)),
938             ipaddress.IPv4Interface("192.0.2.1/24"),
939         )
940         self.assertEqual(
941             ipaddress.IPv4Interface((3221225985, 24)),
942             ipaddress.IPv4Interface("192.0.2.1/24"),
943         )
944     def testIPv6Tuple(self):
945         ip = ipaddress.IPv6Address("2001:db8::")
946         net = ipaddress.IPv6Network("2001:db8::/128")
947         self.assertEqual(ipaddress.IPv6Network(("2001:db8::", "128")), net)
948         self.assertEqual(
949             ipaddress.IPv6Network((42540766411282592856903984951653826560, 128)), net
950         )
951         self.assertEqual(ipaddress.IPv6Network((ip, "128")), net)
952         ip = ipaddress.IPv6Address("2001:db8::")
953         net = ipaddress.IPv6Network("2001:db8::/96")
954         self.assertEqual(ipaddress.IPv6Network(("2001:db8::", "96")), net)
955         self.assertEqual(
956             ipaddress.IPv6Network((42540766411282592856903984951653826560, 96)), net
957         )
958         self.assertEqual(ipaddress.IPv6Network((ip, "96")), net)
959         ip_scoped = ipaddress.IPv6Address("2001:db8::%scope")
960         ip = ipaddress.IPv6Address("2001:db8::1")
961         with self.assertRaises(ValueError):
962             ipaddress.IPv6Network(("2001:db8::1", 96))
963         with self.assertRaises(ValueError):
964             ipaddress.IPv6Network((42540766411282592856903984951653826561, 96))
965         with self.assertRaises(ValueError):
966             ipaddress.IPv6Network((ip, 96))
967         net = ipaddress.IPv6Network("2001:db8::/96")
968         self.assertEqual(ipaddress.IPv6Network(("2001:db8::1", 96), strict=False), net)
969         self.assertEqual(
970             ipaddress.IPv6Network(
971                 (42540766411282592856903984951653826561, 96), strict=False
972             ),
973             net,
974         )
975         self.assertEqual(ipaddress.IPv6Network((ip, 96), strict=False), net)
976         self.assertEqual(
977             ipaddress.IPv6Interface(("2001:db8::1", "96")),
978             ipaddress.IPv6Interface("2001:db8::1/96"),
979         )
980         self.assertEqual(
981             ipaddress.IPv6Interface((42540766411282592856903984951653826561, "96")),
982             ipaddress.IPv6Interface("2001:db8::1/96"),
983         )
984         ip_scoped = ipaddress.IPv6Address("2001:db8::1%scope")
985         with self.assertRaises(ValueError):
986             ipaddress.IPv6Network(("2001:db8::1%scope", 96))
987         with self.assertRaises(ValueError):
988             ipaddress.IPv6Network((ip_scoped, 96))
989     def testAddressIntMath(self):
990         self.assertEqual(
991             ipaddress.IPv4Address("1.1.1.1") + 255, ipaddress.IPv4Address("1.1.2.0")
992         )
993         self.assertEqual(
994             ipaddress.IPv4Address("1.1.1.1") - 256, ipaddress.IPv4Address("1.1.0.1")
995         )
996         self.assertEqual(
997             ipaddress.IPv6Address("::1") + (2 ** 16 - 2),
998             ipaddress.IPv6Address("::ffff"),
999         )
1000         self.assertEqual(
1001             ipaddress.IPv6Address("::ffff") - (2 ** 16 - 2),
1002             ipaddress.IPv6Address("::1"),
1003         )
1004         self.assertNotEqual(
1005             ipaddress.IPv6Address("::1%scope") + (2 ** 16 - 2),
1006             ipaddress.IPv6Address("::ffff%scope"),
1007         )
1008         self.assertNotEqual(
1009             ipaddress.IPv6Address("::ffff%scope") - (2 ** 16 - 2),
1010             ipaddress.IPv6Address("::1%scope"),
1011         )
1012     def testInvalidIntToBytes(self):
1013         self.assertRaises(ValueError, ipaddress.v4_int_to_packed, -1)
1014         self.assertRaises(
1015             ValueError, ipaddress.v4_int_to_packed, 2 ** ipaddress.IPV4LENGTH
1016         )
1017         self.assertRaises(ValueError, ipaddress.v6_int_to_packed, -1)
1018         self.assertRaises(
1019             ValueError, ipaddress.v6_int_to_packed, 2 ** ipaddress.IPV6LENGTH
1020         )
1021     def testInternals(self):
1022         ip1 = ipaddress.IPv4Address("10.10.10.10")
1023         ip2 = ipaddress.IPv4Address("10.10.10.11")
1024         ip3 = ipaddress.IPv4Address("10.10.10.12")
1025         self.assertEqual(list(ipaddress._find_address_range([ip1])), [(ip1, ip1)])
1026         self.assertEqual(
1027             list(ipaddress._find_address_range([ip1, ip3])), [(ip1, ip1), (ip3, ip3)]
1028         )
1029         self.assertEqual(
1030             list(ipaddress._find_address_range([ip1, ip2, ip3])), [(ip1, ip3)]
1031         )
1032         self.assertEqual(128, ipaddress._count_righthand_zero_bits(0, 128))
1033         self.assertEqual("IPv4Network('1.2.3.0/24')", repr(self.ipv4_network))
1034     def testGetNetwork(self):
1035         self.assertEqual(int(self.ipv4_network.network_address), 16909056)
1036         self.assertEqual(str(self.ipv4_network.network_address), "1.2.3.0")
1037         self.assertEqual(
1038             int(self.ipv6_network.network_address),
1039             42540616829182469433403647294022090752,
1040         )
1041         self.assertEqual(str(self.ipv6_network.network_address), "2001:658:22a:cafe::")
1042         self.assertEqual(str(self.ipv6_network.hostmask), "::ffff:ffff:ffff:ffff")
1043         self.assertEqual(
1044             int(self.ipv6_scoped_network.network_address),
1045             42540616829182469433403647294022090752,
1046         )
1047         self.assertEqual(
1048             str(self.ipv6_scoped_network.network_address), "2001:658:22a:cafe::%scope"
1049         )
1050         self.assertEqual(
1051             str(self.ipv6_scoped_network.hostmask), "::ffff:ffff:ffff:ffff"
1052         )
1053     def testIpFromInt(self):
1054         self.assertEqual(self.ipv4_interface._ip, ipaddress.IPv4Interface(16909060)._ip)
1055         ipv4 = ipaddress.ip_network("1.2.3.4")
1056         ipv6 = ipaddress.ip_network("2001:658:22a:cafe:200:0:0:1")
1057         ipv6_scoped = ipaddress.ip_network("2001:658:22a:cafe:200:0:0:1%scope")
1058         self.assertEqual(ipv4, ipaddress.ip_network(int(ipv4.network_address)))
1059         self.assertEqual(ipv6, ipaddress.ip_network(int(ipv6.network_address)))
1060         self.assertNotEqual(
1061             ipv6_scoped, ipaddress.ip_network(int(ipv6_scoped.network_address))
1062         )
1063         v6_int = 42540616829182469433547762482097946625
1064         self.assertEqual(self.ipv6_interface._ip, ipaddress.IPv6Interface(v6_int)._ip)
1065         self.assertEqual(
1066             self.ipv6_scoped_interface._ip, ipaddress.IPv6Interface(v6_int)._ip
1067         )
1068         self.assertEqual(ipaddress.ip_network(self.ipv4_address._ip).version, 4)
1069         self.assertEqual(ipaddress.ip_network(self.ipv6_address._ip).version, 6)
1070         self.assertEqual(ipaddress.ip_network(self.ipv6_scoped_address._ip).version, 6)
1071     def testIpFromPacked(self):
1072         address = ipaddress.ip_address
1073         self.assertEqual(
1074             self.ipv4_interface._ip, ipaddress.ip_interface(b"\x01\x02\x03\x04")._ip
1075         )
1076         self.assertEqual(address("255.254.253.252"), address(b"\xff\xfe\xfd\xfc"))
1077         self.assertEqual(
1078             self.ipv6_interface.ip,
1079             ipaddress.ip_interface(
1080                 b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01"
1081             ).ip,
1082         )
1083         self.assertEqual(
1084             address("ffff:2:3:4:ffff::"),
1085             address(b"\xff\xff\x00\x02\x00\x03\x00\x04" + b"\xff\xff" + b"\x00" * 6),
1086         )
1087         self.assertEqual(address("::"), address(b"\x00" * 16))
1088     def testGetIp(self):
1089         self.assertEqual(int(self.ipv4_interface.ip), 16909060)
1090         self.assertEqual(str(self.ipv4_interface.ip), "1.2.3.4")
1091         self.assertEqual(
1092             int(self.ipv6_interface.ip), 42540616829182469433547762482097946625
1093         )
1094         self.assertEqual(str(self.ipv6_interface.ip), "2001:658:22a:cafe:200::1")
1095         self.assertEqual(
1096             int(self.ipv6_scoped_interface.ip), 42540616829182469433547762482097946625
1097         )
1098         self.assertEqual(str(self.ipv6_scoped_interface.ip), "2001:658:22a:cafe:200::1")
1099     def testGetScopeId(self):
1100         self.assertEqual(self.ipv6_address.scope_id, None)
1101         self.assertEqual(str(self.ipv6_scoped_address.scope_id), "scope")
1102         self.assertEqual(self.ipv6_interface.scope_id, None)
1103         self.assertEqual(str(self.ipv6_scoped_interface.scope_id), "scope")
1104         self.assertEqual(self.ipv6_network.network_address.scope_id, None)
1105         self.assertEqual(
1106             str(self.ipv6_scoped_network.network_address.scope_id), "scope"
1107         )
1108     def testGetNetmask(self):
1109         self.assertEqual(int(self.ipv4_network.netmask), 4294967040)
1110         self.assertEqual(str(self.ipv4_network.netmask), "255.255.255.0")
1111         self.assertEqual(
1112             int(self.ipv6_network.netmask), 340282366920938463444927863358058659840
1113         )
1114         self.assertEqual(self.ipv6_network.prefixlen, 64)
1115         self.assertEqual(
1116             int(self.ipv6_scoped_network.netmask),
1117             340282366920938463444927863358058659840,
1118         )
1119         self.assertEqual(self.ipv6_scoped_network.prefixlen, 64)
1120     def testZeroNetmask(self):
1121         ipv4_zero_netmask = ipaddress.IPv4Interface("1.2.3.4/0")
1122         self.assertEqual(int(ipv4_zero_netmask.network.netmask), 0)
1123         self.assertEqual(ipv4_zero_netmask._prefix_from_prefix_string("0"), 0)
1124         ipv6_zero_netmask = ipaddress.IPv6Interface("::1/0")
1125         self.assertEqual(int(ipv6_zero_netmask.network.netmask), 0)
1126         self.assertEqual(ipv6_zero_netmask._prefix_from_prefix_string("0"), 0)
1127         ipv6_scoped_zero_netmask = ipaddress.IPv6Interface("::1%scope/0")
1128         self.assertEqual(int(ipv6_scoped_zero_netmask.network.netmask), 0)
1129         self.assertEqual(ipv6_scoped_zero_netmask._prefix_from_prefix_string("0"), 0)
1130     def testIPv4Net(self):
1131         net = ipaddress.IPv4Network("127.0.0.0/0.0.0.255")
1132         self.assertEqual(net.prefixlen, 24)
1133     def testGetBroadcast(self):
1134         self.assertEqual(int(self.ipv4_network.broadcast_address), 16909311)
1135         self.assertEqual(str(self.ipv4_network.broadcast_address), "1.2.3.255")
1136         self.assertEqual(
1137             int(self.ipv6_network.broadcast_address),
1138             42540616829182469451850391367731642367,
1139         )
1140         self.assertEqual(
1141             str(self.ipv6_network.broadcast_address),
1142             "2001:658:22a:cafe:ffff:ffff:ffff:ffff",
1143         )
1144         self.assertEqual(
1145             int(self.ipv6_scoped_network.broadcast_address),
1146             42540616829182469451850391367731642367,
1147         )
1148         self.assertEqual(
1149             str(self.ipv6_scoped_network.broadcast_address),
1150             "2001:658:22a:cafe:ffff:ffff:ffff:ffff",
1151         )
1152     def testGetPrefixlen(self):
1153         self.assertEqual(self.ipv4_interface.network.prefixlen, 24)
1154         self.assertEqual(self.ipv6_interface.network.prefixlen, 64)
1155         self.assertEqual(self.ipv6_scoped_interface.network.prefixlen, 64)
1156     def testGetSupernet(self):
1157         self.assertEqual(self.ipv4_network.supernet().prefixlen, 23)
1158         self.assertEqual(str(self.ipv4_network.supernet().network_address), "1.2.2.0")
1159         self.assertEqual(
1160             ipaddress.IPv4Interface("0.0.0.0/0").network.supernet(),
1161             ipaddress.IPv4Network("0.0.0.0/0"),
1162         )
1163         self.assertEqual(self.ipv6_network.supernet().prefixlen, 63)
1164         self.assertEqual(
1165             str(self.ipv6_network.supernet().network_address), "2001:658:22a:cafe::"
1166         )
1167         self.assertEqual(
1168             ipaddress.IPv6Interface("::0/0").network.supernet(),
1169             ipaddress.IPv6Network("::0/0"),
1170         )
1171         self.assertEqual(self.ipv6_scoped_network.supernet().prefixlen, 63)
1172         self.assertEqual(
1173             str(self.ipv6_scoped_network.supernet().network_address),
1174             "2001:658:22a:cafe::",
1175         )
1176     def testGetSupernet3(self):
1177         self.assertEqual(self.ipv4_network.supernet(3).prefixlen, 21)
1178         self.assertEqual(str(self.ipv4_network.supernet(3).network_address), "1.2.0.0")
1179         self.assertEqual(self.ipv6_network.supernet(3).prefixlen, 61)
1180         self.assertEqual(
1181             str(self.ipv6_network.supernet(3).network_address), "2001:658:22a:caf8::"
1182         )
1183         self.assertEqual(self.ipv6_scoped_network.supernet(3).prefixlen, 61)
1184         self.assertEqual(
1185             str(self.ipv6_scoped_network.supernet(3).network_address),
1186             "2001:658:22a:caf8::",
1187         )
1188     def testGetSupernet4(self):
1189         self.assertRaises(
1190             ValueError, self.ipv4_network.supernet, prefixlen_diff=2, new_prefix=1
1191         )
1192         self.assertRaises(ValueError, self.ipv4_network.supernet, new_prefix=25)
1193         self.assertEqual(
1194             self.ipv4_network.supernet(prefixlen_diff=2),
1195             self.ipv4_network.supernet(new_prefix=22),
1196         )
1197         self.assertRaises(
1198             ValueError, self.ipv6_network.supernet, prefixlen_diff=2, new_prefix=1
1199         )
1200         self.assertRaises(ValueError, self.ipv6_network.supernet, new_prefix=65)
1201         self.assertEqual(
1202             self.ipv6_network.supernet(prefixlen_diff=2),
1203             self.ipv6_network.supernet(new_prefix=62),
1204         )
1205         self.assertRaises(
1206             ValueError,
1207             self.ipv6_scoped_network.supernet,
1208             prefixlen_diff=2,
1209             new_prefix=1,
1210         )
1211         self.assertRaises(ValueError, self.ipv6_scoped_network.supernet, new_prefix=65)
1212         self.assertEqual(
1213             self.ipv6_scoped_network.supernet(prefixlen_diff=2),
1214             self.ipv6_scoped_network.supernet(new_prefix=62),
1215         )
1216     def testHosts(self):
1217         hosts = list(self.ipv4_network.hosts())
1218         self.assertEqual(254, len(hosts))
1219         self.assertEqual(ipaddress.IPv4Address("1.2.3.1"), hosts[0])
1220         self.assertEqual(ipaddress.IPv4Address("1.2.3.254"), hosts[-1])
1221         ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/120")
1222         hosts = list(ipv6_network.hosts())
1223         self.assertEqual(255, len(hosts))
1224         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::1"), hosts[0])
1225         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::ff"), hosts[-1])
1226         ipv6_scoped_network = ipaddress.IPv6Network("2001:658:22a:cafe::%scope/120")
1227         hosts = list(ipv6_scoped_network.hosts())
1228         self.assertEqual(255, len(hosts))
1229         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::1"), hosts[0])
1230         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::ff"), hosts[-1])
1231         addrs = [ipaddress.IPv4Address("2.0.0.0"), ipaddress.IPv4Address("2.0.0.1")]
1232         str_args = "2.0.0.0/31"
1233         tpl_args = ("2.0.0.0", 31)
1234         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1235         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1236         self.assertEqual(
1237             list(ipaddress.ip_network(str_args).hosts()),
1238             list(ipaddress.ip_network(tpl_args).hosts()),
1239         )
1240         addrs = [ipaddress.IPv4Address("1.2.3.4")]
1241         str_args = "1.2.3.4/32"
1242         tpl_args = ("1.2.3.4", 32)
1243         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1244         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1245         self.assertEqual(
1246             list(ipaddress.ip_network(str_args).hosts()),
1247             list(ipaddress.ip_network(tpl_args).hosts()),
1248         )
1249         addrs = [
1250             ipaddress.IPv6Address("2001:658:22a:cafe::"),
1251             ipaddress.IPv6Address("2001:658:22a:cafe::1"),
1252         ]
1253         str_args = "2001:658:22a:cafe::/127"
1254         tpl_args = ("2001:658:22a:cafe::", 127)
1255         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1256         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1257         self.assertEqual(
1258             list(ipaddress.ip_network(str_args).hosts()),
1259             list(ipaddress.ip_network(tpl_args).hosts()),
1260         )
1261         addrs = [
1262             ipaddress.IPv6Address("2001:658:22a:cafe::1"),
1263         ]
1264         str_args = "2001:658:22a:cafe::1/128"
1265         tpl_args = ("2001:658:22a:cafe::1", 128)
1266         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1267         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1268         self.assertEqual(
1269             list(ipaddress.ip_network(str_args).hosts()),
1270             list(ipaddress.ip_network(tpl_args).hosts()),
1271         )
1272     def testFancySubnetting(self):
1273         self.assertEqual(
1274             sorted(self.ipv4_network.subnets(prefixlen_diff=3)),
1275             sorted(self.ipv4_network.subnets(new_prefix=27)),
1276         )
1277         self.assertRaises(ValueError, list, self.ipv4_network.subnets(new_prefix=23))
1278         self.assertRaises(
1279             ValueError, list, self.ipv4_network.subnets(prefixlen_diff=3, new_prefix=27)
1280         )
1281         self.assertEqual(
1282             sorted(self.ipv6_network.subnets(prefixlen_diff=4)),
1283             sorted(self.ipv6_network.subnets(new_prefix=68)),
1284         )
1285         self.assertRaises(ValueError, list, self.ipv6_network.subnets(new_prefix=63))
1286         self.assertRaises(
1287             ValueError, list, self.ipv6_network.subnets(prefixlen_diff=4, new_prefix=68)
1288         )
1289         self.assertEqual(
1290             sorted(self.ipv6_scoped_network.subnets(prefixlen_diff=4)),
1291             sorted(self.ipv6_scoped_network.subnets(new_prefix=68)),
1292         )
1293         self.assertRaises(
1294             ValueError, list, self.ipv6_scoped_network.subnets(new_prefix=63)
1295         )
1296         self.assertRaises(
1297             ValueError,
1298             list,
1299             self.ipv6_scoped_network.subnets(prefixlen_diff=4, new_prefix=68),
1300         )
1301     def testGetSubnets(self):
1302         self.assertEqual(list(self.ipv4_network.subnets())[0].prefixlen, 25)
1303         self.assertEqual(
1304             str(list(self.ipv4_network.subnets())[0].network_address), "1.2.3.0"
1305         )
1306         self.assertEqual(
1307             str(list(self.ipv4_network.subnets())[1].network_address), "1.2.3.128"
1308         )
1309         self.assertEqual(list(self.ipv6_network.subnets())[0].prefixlen, 65)
1310         self.assertEqual(list(self.ipv6_scoped_network.subnets())[0].prefixlen, 65)
1311     def testGetSubnetForSingle32(self):
1312         ip = ipaddress.IPv4Network("1.2.3.4/32")
1313         subnets1 = [str(x) for x in ip.subnets()]
1314         subnets2 = [str(x) for x in ip.subnets(2)]
1315         self.assertEqual(subnets1, ["1.2.3.4/32"])
1316         self.assertEqual(subnets1, subnets2)
1317     def testGetSubnetForSingle128(self):
1318         ip = ipaddress.IPv6Network("::1/128")
1319         subnets1 = [str(x) for x in ip.subnets()]
1320         subnets2 = [str(x) for x in ip.subnets(2)]
1321         self.assertEqual(subnets1, ["::1/128"])
1322         self.assertEqual(subnets1, subnets2)
1323         ip_scoped = ipaddress.IPv6Network("::1%scope/128")
1324         subnets1 = [str(x) for x in ip_scoped.subnets()]
1325         subnets2 = [str(x) for x in ip_scoped.subnets(2)]
1326         self.assertEqual(subnets1, ["::1%scope/128"])
1327         self.assertEqual(subnets1, subnets2)
1328     def testSubnet2(self):
1329         ips = [str(x) for x in self.ipv4_network.subnets(2)]
1330         self.assertEqual(
1331             ips, ["1.2.3.0/26", "1.2.3.64/26", "1.2.3.128/26", "1.2.3.192/26"]
1332         )
1333         ipsv6 = [str(x) for x in self.ipv6_network.subnets(2)]
1334         self.assertEqual(
1335             ipsv6,
1336             [
1337                 "2001:658:22a:cafe::/66",
1338                 "2001:658:22a:cafe:4000::/66",
1339                 "2001:658:22a:cafe:8000::/66",
1340                 "2001:658:22a:cafe:c000::/66",
1341             ],
1342         )
1343     def testGetSubnets3(self):
1344         subnets = [str(x) for x in self.ipv4_network.subnets(8)]
1345         self.assertEqual(subnets[:3], ["1.2.3.0/32", "1.2.3.1/32", "1.2.3.2/32"])
1346         self.assertEqual(subnets[-3:], ["1.2.3.253/32", "1.2.3.254/32", "1.2.3.255/32"])
1347         self.assertEqual(len(subnets), 256)
1348         ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/120")
1349         subnets = [str(x) for x in ipv6_network.subnets(8)]
1350         self.assertEqual(
1351             subnets[:3],
1352             [
1353                 "2001:658:22a:cafe::/128",
1354                 "2001:658:22a:cafe::1/128",
1355                 "2001:658:22a:cafe::2/128",
1356             ],
1357         )
1358         self.assertEqual(
1359             subnets[-3:],
1360             [
1361                 "2001:658:22a:cafe::fd/128",
1362                 "2001:658:22a:cafe::fe/128",
1363                 "2001:658:22a:cafe::ff/128",
1364             ],
1365         )
1366         self.assertEqual(len(subnets), 256)
1367     def testSubnetFailsForLargeCidrDiff(self):
1368         self.assertRaises(ValueError, list, self.ipv4_interface.network.subnets(9))
1369         self.assertRaises(ValueError, list, self.ipv4_network.subnets(9))
1370         self.assertRaises(ValueError, list, self.ipv6_interface.network.subnets(65))
1371         self.assertRaises(ValueError, list, self.ipv6_network.subnets(65))
1372         self.assertRaises(
1373             ValueError, list, self.ipv6_scoped_interface.network.subnets(65)
1374         )
1375         self.assertRaises(ValueError, list, self.ipv6_scoped_network.subnets(65))
1376     def testSupernetFailsForLargeCidrDiff(self):
1377         self.assertRaises(ValueError, self.ipv4_interface.network.supernet, 25)
1378         self.assertRaises(ValueError, self.ipv6_interface.network.supernet, 65)
1379         self.assertRaises(ValueError, self.ipv6_scoped_interface.network.supernet, 65)
1380     def testSubnetFailsForNegativeCidrDiff(self):
1381         self.assertRaises(ValueError, list, self.ipv4_interface.network.subnets(-1))
1382         self.assertRaises(ValueError, list, self.ipv4_network.subnets(-1))
1383         self.assertRaises(ValueError, list, self.ipv6_interface.network.subnets(-1))
1384         self.assertRaises(ValueError, list, self.ipv6_network.subnets(-1))
1385         self.assertRaises(
1386             ValueError, list, self.ipv6_scoped_interface.network.subnets(-1)
1387         )
1388         self.assertRaises(ValueError, list, self.ipv6_scoped_network.subnets(-1))
1389     def testGetNum_Addresses(self):
1390         self.assertEqual(self.ipv4_network.num_addresses, 256)
1391         self.assertEqual(list(self.ipv4_network.subnets())[0].num_addresses, 128)
1392         self.assertEqual(self.ipv4_network.supernet().num_addresses, 512)
1393         self.assertEqual(self.ipv6_network.num_addresses, 18446744073709551616)
1394         self.assertEqual(
1395             list(self.ipv6_network.subnets())[0].num_addresses, 9223372036854775808
1396         )
1397         self.assertEqual(
1398             self.ipv6_network.supernet().num_addresses, 36893488147419103232
1399         )
1400         self.assertEqual(self.ipv6_scoped_network.num_addresses, 18446744073709551616)
1401         self.assertEqual(
1402             list(self.ipv6_scoped_network.subnets())[0].num_addresses,
1403             9223372036854775808,
1404         )
1405         self.assertEqual(
1406             self.ipv6_scoped_network.supernet().num_addresses, 36893488147419103232
1407         )
1408     def testContains(self):
1409         self.assertIn(ipaddress.IPv4Interface("1.2.3.128/25"), self.ipv4_network)
1410         self.assertNotIn(ipaddress.IPv4Interface("1.2.4.1/24"), self.ipv4_network)
1411         addr1 = ipaddress.IPv4Address("1.2.3.37")
1412         self.assertIn(addr1, self.ipv4_network)
1413         self.assertFalse(
1414             ipaddress.IPv4Network("1.1.0.0/16").__contains__(
1415                 ipaddress.IPv4Network("1.0.0.0/15")
1416             )
1417         )
1418     def testNth(self):
1419         self.assertEqual(str(self.ipv4_network[5]), "1.2.3.5")
1420         self.assertRaises(IndexError, self.ipv4_network.__getitem__, 256)
1421         self.assertEqual(str(self.ipv6_network[5]), "2001:658:22a:cafe::5")
1422         self.assertRaises(IndexError, self.ipv6_network.__getitem__, 1 &lt;&lt; 64)
1423         self.assertEqual(str(self.ipv6_scoped_network[5]), "2001:658:22a:cafe::5")
1424         self.assertRaises(IndexError, self.ipv6_scoped_network.__getitem__, 1 &lt;&lt; 64)
1425     def testGetitem(self):
1426         addr = ipaddress.IPv4Network("172.31.255.128/255.255.255.240")
1427         self.assertEqual(28, addr.prefixlen)
1428         addr_list = list(addr)
1429         self.assertEqual("172.31.255.128", str(addr_list[0]))
1430         self.assertEqual("172.31.255.128", str(addr[0]))
1431         self.assertEqual("172.31.255.143", str(addr_list[-1]))
1432         self.assertEqual("172.31.255.143", str(addr[-1]))
1433         self.assertEqual(addr_list[-1], addr[-1])
1434     def testEqual(self):
1435         self.assertTrue(self.ipv4_interface == ipaddress.IPv4Interface("1.2.3.4/24"))
1436         self.assertFalse(self.ipv4_interface == ipaddress.IPv4Interface("1.2.3.4/23"))
1437         self.assertFalse(self.ipv4_interface == ipaddress.IPv6Interface("::1.2.3.4/24"))
1438         self.assertFalse(
1439             self.ipv4_interface == ipaddress.IPv6Interface("::1.2.3.4%scope/24")
1440         )
1441         self.assertFalse(self.ipv4_interface == "")
1442         self.assertFalse(self.ipv4_interface == [])
1443         self.assertFalse(self.ipv4_interface == 2)
1444         self.assertTrue(
1445             self.ipv6_interface
1446             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1447         )
1448         self.assertFalse(
1449             self.ipv6_interface
1450             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1451         )
1452         self.assertFalse(self.ipv6_interface == ipaddress.IPv4Interface("1.2.3.4/23"))
1453         self.assertFalse(self.ipv6_interface == "")
1454         self.assertFalse(self.ipv6_interface == [])
1455         self.assertFalse(self.ipv6_interface == 2)
1456         self.assertTrue(
1457             self.ipv6_scoped_interface
1458             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/64")
1459         )
1460         self.assertFalse(
1461             self.ipv6_scoped_interface
1462             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/63")
1463         )
1464         self.assertFalse(
1465             self.ipv6_scoped_interface
1466             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1467         )
1468         self.assertFalse(
1469             self.ipv6_scoped_interface
1470             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1471         )
1472         self.assertFalse(
1473             self.ipv6_scoped_interface == ipaddress.IPv4Interface("1.2.3.4/23")
1474         )
1475         self.assertFalse(self.ipv6_scoped_interface == "")
1476         self.assertFalse(self.ipv6_scoped_interface == [])
1477         self.assertFalse(self.ipv6_scoped_interface == 2)
1478     def testNotEqual(self):
1479         self.assertFalse(self.ipv4_interface != ipaddress.IPv4Interface("1.2.3.4/24"))
1480         self.assertTrue(self.ipv4_interface != ipaddress.IPv4Interface("1.2.3.4/23"))
1481         self.assertTrue(self.ipv4_interface != ipaddress.IPv6Interface("::1.2.3.4/24"))
1482         self.assertTrue(
1483             self.ipv4_interface != ipaddress.IPv6Interface("::1.2.3.4%scope/24")
1484         )
1485         self.assertTrue(self.ipv4_interface != "")
1486         self.assertTrue(self.ipv4_interface != [])
1487         self.assertTrue(self.ipv4_interface != 2)
1488         self.assertTrue(self.ipv4_address != ipaddress.IPv4Address("1.2.3.5"))
1489         self.assertTrue(self.ipv4_address != "")
1490         self.assertTrue(self.ipv4_address != [])
1491         self.assertTrue(self.ipv4_address != 2)
1492         self.assertFalse(
1493             self.ipv6_interface
1494             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1495         )
1496         self.assertTrue(
1497             self.ipv6_interface
1498             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1499         )
1500         self.assertTrue(self.ipv6_interface != ipaddress.IPv4Interface("1.2.3.4/23"))
1501         self.assertTrue(self.ipv6_interface != "")
1502         self.assertTrue(self.ipv6_interface != [])
1503         self.assertTrue(self.ipv6_interface != 2)
1504         self.assertTrue(self.ipv6_address != ipaddress.IPv4Address("1.2.3.4"))
1505         self.assertTrue(self.ipv6_address != "")
1506         self.assertTrue(self.ipv6_address != [])
1507         self.assertTrue(self.ipv6_address != 2)
1508         self.assertFalse(
1509             self.ipv6_scoped_interface
1510             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/64")
1511         )
1512         self.assertTrue(
1513             self.ipv6_scoped_interface
1514             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/63")
1515         )
1516         self.assertTrue(
1517             self.ipv6_scoped_interface
1518             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1519         )
1520         self.assertTrue(
1521             self.ipv6_scoped_interface
1522             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1523         )
1524         self.assertTrue(
1525             self.ipv6_scoped_interface != ipaddress.IPv4Interface("1.2.3.4/23")
1526         )
1527         self.assertTrue(self.ipv6_scoped_interface != "")
1528         self.assertTrue(self.ipv6_scoped_interface != [])
1529         self.assertTrue(self.ipv6_scoped_interface != 2)
1530         self.assertTrue(self.ipv6_scoped_address != ipaddress.IPv4Address("1.2.3.4"))
1531         self.assertTrue(self.ipv6_scoped_address != "")
1532         self.assertTrue(self.ipv6_scoped_address != [])
1533         self.assertTrue(self.ipv6_scoped_address != 2)
1534     def testSlash32Constructor(self):
1535         self.assertEqual(
1536             str(ipaddress.IPv4Interface("1.2.3.4/255.255.255.255")), "1.2.3.4/32"
1537         )
1538     def testSlash128Constructor(self):
1539         self.assertEqual(str(ipaddress.IPv6Interface("::1/128")), "::1/128")
1540         self.assertEqual(str(ipaddress.IPv6Interface("::1%scope/128")), "::1%scope/128")
1541     def testSlash0Constructor(self):
1542         self.assertEqual(str(ipaddress.IPv4Interface("1.2.3.4/0.0.0.0")), "1.2.3.4/0")
1543     def testCollapsing(self):
1544         ip1 = ipaddress.IPv4Address("1.1.1.0")
1545         ip2 = ipaddress.IPv4Address("1.1.1.1")
1546         ip3 = ipaddress.IPv4Address("1.1.1.2")
1547         ip4 = ipaddress.IPv4Address("1.1.1.3")
1548         ip5 = ipaddress.IPv4Address("1.1.1.4")
1549         ip6 = ipaddress.IPv4Address("1.1.1.0")
1550         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4, ip5, ip6])
1551         self.assertEqual(
1552             list(collapsed),
1553             [ipaddress.IPv4Network("1.1.1.0/30"), ipaddress.IPv4Network("1.1.1.4/32")],
1554         )
1555         ip1 = ipaddress.IPv4Address("1.1.1.0")
1556         ip2 = ipaddress.IPv4Address("1.1.1.1")
1557         ip3 = ipaddress.IPv4Address("1.1.1.2")
1558         ip4 = ipaddress.IPv4Address("1.1.1.3")
1559         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4])
1560         self.assertEqual(list(collapsed), [ipaddress.IPv4Network("1.1.1.0/30")])
1561         ip1 = ipaddress.IPv4Network("1.1.0.0/24")
1562         ip2 = ipaddress.IPv4Network("1.1.1.0/24")
1563         ip3 = ipaddress.IPv4Network("1.1.2.0/24")
1564         ip4 = ipaddress.IPv4Network("1.1.3.0/24")
1565         ip5 = ipaddress.IPv4Network("1.1.4.0/24")
1566         ip6 = ipaddress.IPv4Network("1.1.0.0/22")
1567         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4, ip5, ip6])
1568         self.assertEqual(
1569             list(collapsed),
1570             [ipaddress.IPv4Network("1.1.0.0/22"), ipaddress.IPv4Network("1.1.4.0/24")],
1571         )
1572         collapsed = ipaddress.collapse_addresses([ip1, ip2])
1573         self.assertEqual(list(collapsed), [ipaddress.IPv4Network("1.1.0.0/23")])
1574         ip_same1 = ip_same2 = ipaddress.IPv4Network("1.1.1.1/32")
1575         self.assertEqual(
1576             list(ipaddress.collapse_addresses([ip_same1, ip_same2])), [ip_same1]
1577         )
1578         ip_same1 = ip_same2 = ipaddress.IPv4Address("1.1.1.1")
1579         self.assertEqual(
1580             list(ipaddress.collapse_addresses([ip_same1, ip_same2])),
1581             [ipaddress.ip_network("1.1.1.1/32")],
1582         )
1583         ip1 = ipaddress.IPv6Network("2001::/100")
1584         ip2 = ipaddress.IPv6Network("2001::/120")
1585         ip3 = ipaddress.IPv6Network("2001::/96")
1586         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3])
1587         self.assertEqual(list(collapsed), [ip3])
1588         ip1 = ipaddress.IPv6Network("2001::%scope/100")
1589         ip2 = ipaddress.IPv6Network("2001::%scope/120")
1590         ip3 = ipaddress.IPv6Network("2001::%scope/96")
1591         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3])
1592         self.assertEqual(list(collapsed), [ip3])
1593         addr_tuples = [
1594             (ipaddress.ip_address("1.1.1.1"), ipaddress.ip_address("::1")),
1595             (ipaddress.IPv4Network("1.1.0.0/24"), ipaddress.IPv6Network("2001::/120")),
1596             (ipaddress.IPv4Network("1.1.0.0/32"), ipaddress.IPv6Network("2001::/128")),
1597         ]
1598         for ip1, ip2 in addr_tuples:
1599             self.assertRaises(TypeError, ipaddress.collapse_addresses, [ip1, ip2])
1600         addr_tuples = [
1601             (ipaddress.ip_address("1.1.1.1"), ipaddress.ip_address("::1%scope")),
1602             (
1603                 ipaddress.IPv4Network("1.1.0.0/24"),
1604                 ipaddress.IPv6Network("2001::%scope/120"),
1605             ),
1606             (
1607                 ipaddress.IPv4Network("1.1.0.0/32"),
1608                 ipaddress.IPv6Network("2001::%scope/128"),
1609             ),
1610         ]
1611         for ip1, ip2 in addr_tuples:
1612             self.assertRaises(TypeError, ipaddress.collapse_addresses, [ip1, ip2])
1613     def testSummarizing(self):
1614         summarize = ipaddress.summarize_address_range
1615         ip1 = ipaddress.ip_address("1.1.1.0")
1616         ip2 = ipaddress.ip_address("1.1.1.255")
1617         class IPv7Address(ipaddress.IPv6Address):
1618             @property
1619             def version(self):
1620                 return 7
1621         ip_invalid1 = IPv7Address("::1")
1622         ip_invalid2 = IPv7Address("::1")
1623         self.assertRaises(ValueError, list, summarize(ip_invalid1, ip_invalid2))
1624         self.assertRaises(TypeError, list, summarize(ip1, ipaddress.IPv6Address("::1")))
1625         self.assertRaises(
1626             TypeError, list, summarize(ip1, ipaddress.IPv6Address("::1%scope"))
1627         )
1628         self.assertEqual(
1629             list(summarize(ip1, ip2))[0], ipaddress.ip_network("1.1.1.0/24")
1630         )
1631         ip2 = ipaddress.ip_address("1.1.1.8")
1632         self.assertEqual(
1633             list(summarize(ip1, ip2)),
1634             [ipaddress.ip_network("1.1.1.0/29"), ipaddress.ip_network("1.1.1.8")],
1635         )
1636         ip1 = ipaddress.IPv4Address(0)
1637         ip2 = ipaddress.IPv4Address(ipaddress.IPv4Address._ALL_ONES)
1638         self.assertEqual(
1639             [ipaddress.IPv4Network("0.0.0.0/0")], list(summarize(ip1, ip2))
1640         )
1641         ip1 = ipaddress.ip_address("1::")
1642         ip2 = ipaddress.ip_address("1:ffff:ffff:ffff:ffff:ffff:ffff:ffff")
1643         self.assertEqual(list(summarize(ip1, ip2))[0], ipaddress.ip_network("1::/16"))
1644         ip2 = ipaddress.ip_address("2::")
1645         self.assertEqual(
1646             list(summarize(ip1, ip2)),
1647             [ipaddress.ip_network("1::/16"), ipaddress.ip_network("2::/128")],
1648         )
1649         ip1 = ipaddress.ip_address("1::%scope")
1650         ip2 = ipaddress.ip_address("1:ffff:ffff:ffff:ffff:ffff:ffff:ffff%scope")
1651         self.assertEqual(list(summarize(ip1, ip2))[0], ipaddress.ip_network("1::/16"))
1652         ip2 = ipaddress.ip_address("2::%scope")
1653         self.assertEqual(
1654             list(summarize(ip1, ip2)),
1655             [ipaddress.ip_network("1::/16"), ipaddress.ip_network("2::/128")],
1656         )
1657         self.assertRaises(
1658             ValueError,
1659             list,
1660             summarize(ipaddress.ip_address("1.1.1.0"), ipaddress.ip_address("1.1.0.0")),
1661         )
1662         self.assertRaises(
1663             TypeError,
1664             list,
1665             summarize(ipaddress.ip_network("1.1.1.0"), ipaddress.ip_network("1.1.0.0")),
1666         )
1667         self.assertRaises(
1668             TypeError,
1669             list,
1670             summarize(ipaddress.ip_network("1.1.1.0"), ipaddress.ip_network("1.1.0.0")),
1671         )
1672         self.assertRaises(
1673             TypeError,
1674             list,
1675             summarize(ipaddress.ip_address("::"), ipaddress.ip_network("1.1.0.0")),
1676         )
1677     def testAddressComparison(self):
1678         self.assertTrue(
1679             ipaddress.ip_address("1.1.1.1") &lt;= ipaddress.ip_address("1.1.1.1")
1680         )
1681         self.assertTrue(
1682             ipaddress.ip_address("1.1.1.1") &lt;= ipaddress.ip_address("1.1.1.2")
1683         )
1684         self.assertTrue(ipaddress.ip_address("::1") &lt;= ipaddress.ip_address("::1"))
1685         self.assertTrue(ipaddress.ip_address("::1") &lt;= ipaddress.ip_address("::2"))
1686         self.assertTrue(
1687             ipaddress.ip_address("::1%scope") &lt;= ipaddress.ip_address("::1%scope")
1688         )
1689         self.assertTrue(
1690             ipaddress.ip_address("::1%scope") &lt;= ipaddress.ip_address("::2%scope")
1691         )
1692     def testInterfaceComparison(self):
1693         self.assertTrue(
1694             ipaddress.ip_interface("1.1.1.1/24") == ipaddress.ip_interface("1.1.1.1/24")
1695         )
1696         self.assertTrue(
1697             ipaddress.ip_interface("1.1.1.1/16") &lt; ipaddress.ip_interface("1.1.1.1/24")
1698         )
1699         self.assertTrue(
1700             ipaddress.ip_interface("1.1.1.1/24") &lt; ipaddress.ip_interface("1.1.1.2/24")
1701         )
1702         self.assertTrue(
1703             ipaddress.ip_interface("1.1.1.2/16") &lt; ipaddress.ip_interface("1.1.1.1/24")
1704         )
1705         self.assertTrue(
1706             ipaddress.ip_interface("1.1.1.1/24") &gt; ipaddress.ip_interface("1.1.1.1/16")
1707         )
1708         self.assertTrue(
1709             ipaddress.ip_interface("1.1.1.2/24") &gt; ipaddress.ip_interface("1.1.1.1/24")
1710         )
1711         self.assertTrue(
1712             ipaddress.ip_interface("1.1.1.1/24") &gt; ipaddress.ip_interface("1.1.1.2/16")
1713         )
1714         self.assertTrue(
1715             ipaddress.ip_interface("::1/64") == ipaddress.ip_interface("::1/64")
1716         )
1717         self.assertTrue(
1718             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::1/80")
1719         )
1720         self.assertTrue(
1721             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::2/64")
1722         )
1723         self.assertTrue(
1724             ipaddress.ip_interface("::2/48") &lt; ipaddress.ip_interface("::1/64")
1725         )
1726         self.assertTrue(
1727             ipaddress.ip_interface("::1/80") &gt; ipaddress.ip_interface("::1/64")
1728         )
1729         self.assertTrue(
1730             ipaddress.ip_interface("::2/64") &gt; ipaddress.ip_interface("::1/64")
1731         )
1732         self.assertTrue(
1733             ipaddress.ip_interface("::1/64") &gt; ipaddress.ip_interface("::2/48")
1734         )
1735         self.assertTrue(
1736             ipaddress.ip_interface("::1%scope/64")
1737             == ipaddress.ip_interface("::1%scope/64")
1738         )
1739         self.assertTrue(
1740             ipaddress.ip_interface("::1%scope/64")
1741             &lt; ipaddress.ip_interface("::1%scope/80")
1742         )
1743         self.assertTrue(
1744             ipaddress.ip_interface("::1%scope/64")
1745             &lt; ipaddress.ip_interface("::2%scope/64")
1746         )
1747         self.assertTrue(
1748             ipaddress.ip_interface("::2%scope/48")
1749             &lt; ipaddress.ip_interface("::1%scope/64")
1750         )
1751         self.assertTrue(
1752             ipaddress.ip_interface("::1%scope/80")
1753             &gt; ipaddress.ip_interface("::1%scope/64")
1754         )
1755         self.assertTrue(
1756             ipaddress.ip_interface("::2%scope/64")
1757             &gt; ipaddress.ip_interface("::1%scope/64")
1758         )
1759         self.assertTrue(
1760             ipaddress.ip_interface("::1%scope/64")
1761             &gt; ipaddress.ip_interface("::2%scope/48")
1762         )
1763         self.assertFalse(
1764             ipaddress.ip_interface("::1%scope/64") == ipaddress.ip_interface("::1/64")
1765         )
1766         self.assertTrue(
1767             ipaddress.ip_interface("::1%scope/64") &lt; ipaddress.ip_interface("::1/80")
1768         )
1769         self.assertTrue(
1770             ipaddress.ip_interface("::1%scope/64") &lt; ipaddress.ip_interface("::2/64")
1771         )
1772         self.assertTrue(
1773             ipaddress.ip_interface("::2%scope/48") &lt; ipaddress.ip_interface("::1/64")
1774         )
1775         self.assertTrue(
1776             ipaddress.ip_interface("::1%scope/80") &gt; ipaddress.ip_interface("::1/64")
1777         )
1778         self.assertTrue(
1779             ipaddress.ip_interface("::2%scope/64") &gt; ipaddress.ip_interface("::1/64")
1780         )
1781         self.assertTrue(
1782             ipaddress.ip_interface("::1%scope/64") &gt; ipaddress.ip_interface("::2/48")
1783         )
1784         self.assertFalse(
1785             ipaddress.ip_interface("::1/64") == ipaddress.ip_interface("::1%scope/64")
1786         )
1787         self.assertTrue(
1788             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::1%scope/80")
1789         )
1790         self.assertTrue(
1791             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::2%scope/64")
1792         )
1793         self.assertTrue(
1794             ipaddress.ip_interface("::2/48") &lt; ipaddress.ip_interface("::1%scope/64")
1795         )
1796         self.assertTrue(
1797             ipaddress.ip_interface("::1/80") &gt; ipaddress.ip_interface("::1%scope/64")
1798         )
1799         self.assertTrue(
1800             ipaddress.ip_interface("::2/64") &gt; ipaddress.ip_interface("::1%scope/64")
1801         )
1802         self.assertTrue(
1803             ipaddress.ip_interface("::1/64") &gt; ipaddress.ip_interface("::2%scope/48")
1804         )
1805     def testNetworkComparison(self):
1806         ip1 = ipaddress.IPv4Network("1.1.1.0/24")
1807         ip2 = ipaddress.IPv4Network("1.1.1.0/32")
1808         ip3 = ipaddress.IPv4Network("1.1.2.0/24")
1809         self.assertTrue(ip1 &lt; ip3)
1810         self.assertTrue(ip3 &gt; ip2)
1811         self.assertEqual(ip1.compare_networks(ip1), 0)
1812         self.assertEqual(ip1.compare_networks(ip2), -1)
1813         self.assertEqual(ip2.compare_networks(ip1), 1)
1814         self.assertEqual(ip1.compare_networks(ip3), -1)
1815         self.assertEqual(ip3.compare_networks(ip1), 1)
1816         self.assertTrue(ip1._get_networks_key() &lt; ip3._get_networks_key())
1817         ip1 = ipaddress.IPv6Network("2001:2000::/96")
1818         ip2 = ipaddress.IPv6Network("2001:2001::/96")
1819         ip3 = ipaddress.IPv6Network("2001:ffff:2000::/96")
1820         self.assertTrue(ip1 &lt; ip3)
1821         self.assertTrue(ip3 &gt; ip2)
1822         self.assertEqual(ip1.compare_networks(ip3), -1)
1823         self.assertTrue(ip1._get_networks_key() &lt; ip3._get_networks_key())
1824         self.assertRaises(
1825             TypeError, self.ipv4_network.compare_networks, self.ipv6_network
1826         )
1827         ipv6 = ipaddress.IPv6Interface("::/0")
1828         ipv4 = ipaddress.IPv4Interface("0.0.0.0/0")
1829         self.assertRaises(TypeError, ipv4.__lt__, ipv6)
1830         self.assertRaises(TypeError, ipv4.__gt__, ipv6)
1831         self.assertRaises(TypeError, ipv6.__lt__, ipv4)
1832         self.assertRaises(TypeError, ipv6.__gt__, ipv4)
1833         ip1 = ipaddress.ip_network("10.1.2.128/25")
1834         self.assertFalse(ip1 &lt; ip1)
1835         self.assertFalse(ip1 &gt; ip1)
1836         ip2 = ipaddress.ip_network("10.1.3.0/24")
1837         self.assertTrue(ip1 &lt; ip2)
1838         self.assertFalse(ip2 &lt; ip1)
1839         self.assertFalse(ip1 &gt; ip2)
1840         self.assertTrue(ip2 &gt; ip1)
1841         ip3 = ipaddress.ip_network("10.1.3.0/25")
1842         self.assertTrue(ip2 &lt; ip3)
1843         self.assertFalse(ip3 &lt; ip2)
1844         self.assertFalse(ip2 &gt; ip3)
1845         self.assertTrue(ip3 &gt; ip2)
1846         ip1 = ipaddress.ip_network("10.10.10.0/31")
1847         ip2 = ipaddress.ip_network("10.10.10.0")
1848         ip3 = ipaddress.ip_network("10.10.10.2/31")
1849         ip4 = ipaddress.ip_network("10.10.10.2")
1850         sorted = [ip1, ip2, ip3, ip4]
1851         unsorted = [ip2, ip4, ip1, ip3]
1852         unsorted.sort()
1853         self.assertEqual(sorted, unsorted)
1854         unsorted = [ip4, ip1, ip3, ip2]
1855         unsorted.sort()
1856         self.assertEqual(sorted, unsorted)
1857         self.assertIs(ip1.__lt__(ipaddress.ip_address("10.10.10.0")), NotImplemented)
1858         self.assertIs(ip2.__lt__(ipaddress.ip_address("10.10.10.0")), NotImplemented)
1859         self.assertTrue(
1860             ipaddress.ip_network("1.1.1.1") &lt;= ipaddress.ip_network("1.1.1.1")
1861         )
1862         self.assertTrue(
1863             ipaddress.ip_network("1.1.1.1") &lt;= ipaddress.ip_network("1.1.1.2")
1864         )
1865         self.assertFalse(
1866             ipaddress.ip_network("1.1.1.2") &lt;= ipaddress.ip_network("1.1.1.1")
1867         )
1868         self.assertTrue(ipaddress.ip_network("::1") &lt;= ipaddress.ip_network("::1"))
1869         self.assertTrue(ipaddress.ip_network("::1") &lt;= ipaddress.ip_network("::2"))
1870         self.assertFalse(ipaddress.ip_network("::2") &lt;= ipaddress.ip_network("::1"))
1871     def testStrictNetworks(self):
1872         self.assertRaises(ValueError, ipaddress.ip_network, "192.168.1.1/24")
1873         self.assertRaises(ValueError, ipaddress.ip_network, "::1/120")
1874         self.assertRaises(ValueError, ipaddress.ip_network, "::1%scope/120")
1875     def testOverlaps(self):
1876         other = ipaddress.IPv4Network("1.2.3.0/30")
1877         other2 = ipaddress.IPv4Network("1.2.2.0/24")
1878         other3 = ipaddress.IPv4Network("1.2.2.64/26")
1879         self.assertTrue(self.ipv4_network.overlaps(other))
1880         self.assertFalse(self.ipv4_network.overlaps(other2))
1881         self.assertTrue(other2.overlaps(other3))
1882     def testEmbeddedIpv4(self):
1883         ipv4_string = "192.168.0.1"
1884         ipv4 = ipaddress.IPv4Interface(ipv4_string)
1885         v4compat_ipv6 = ipaddress.IPv6Interface("::%s" % ipv4_string)
1886         self.assertEqual(int(v4compat_ipv6.ip), int(ipv4.ip))
1887         v4mapped_ipv6 = ipaddress.IPv6Interface("::ffff:%s" % ipv4_string)
1888         self.assertNotEqual(v4mapped_ipv6.ip, ipv4.ip)
1889         self.assertRaises(
1890             ipaddress.AddressValueError, ipaddress.IPv6Interface, "2001:1.1.1.1:1.1.1.1"
1891         )
1892     def testIPv6AddressTooLarge(self):
1893         self.assertEqual(
1894             ipaddress.ip_address("::FFFF:192.0.2.1"),
1895             ipaddress.ip_address("::FFFF:c000:201"),
1896         )
1897         self.assertEqual(
1898             ipaddress.ip_address("FFFF::192.0.2.1"),
1899             ipaddress.ip_address("FFFF::c000:201"),
1900         )
1901         self.assertEqual(
1902             ipaddress.ip_address("::FFFF:192.0.2.1%scope"),
1903             ipaddress.ip_address("::FFFF:c000:201%scope"),
1904         )
1905         self.assertEqual(
1906             ipaddress.ip_address("FFFF::192.0.2.1%scope"),
1907             ipaddress.ip_address("FFFF::c000:201%scope"),
1908         )
1909         self.assertNotEqual(
1910             ipaddress.ip_address("::FFFF:192.0.2.1%scope"),
1911             ipaddress.ip_address("::FFFF:c000:201"),
1912         )
1913         self.assertNotEqual(
1914             ipaddress.ip_address("FFFF::192.0.2.1%scope"),
1915             ipaddress.ip_address("FFFF::c000:201"),
1916         )
1917         self.assertNotEqual(
1918             ipaddress.ip_address("::FFFF:192.0.2.1"),
1919             ipaddress.ip_address("::FFFF:c000:201%scope"),
1920         )
1921         self.assertNotEqual(
1922             ipaddress.ip_address("FFFF::192.0.2.1"),
1923             ipaddress.ip_address("FFFF::c000:201%scope"),
1924         )
1925     def testIPVersion(self):
1926         self.assertEqual(self.ipv4_address.version, 4)
1927         self.assertEqual(self.ipv6_address.version, 6)
1928         self.assertEqual(self.ipv6_scoped_address.version, 6)
1929     def testMaxPrefixLength(self):
1930         self.assertEqual(self.ipv4_interface.max_prefixlen, 32)
1931         self.assertEqual(self.ipv6_interface.max_prefixlen, 128)
1932         self.assertEqual(self.ipv6_scoped_interface.max_prefixlen, 128)
1933     def testPacked(self):
1934         self.assertEqual(self.ipv4_address.packed, b"\x01\x02\x03\x04")
1935         self.assertEqual(
1936             ipaddress.IPv4Interface("255.254.253.252").packed, b"\xff\xfe\xfd\xfc"
1937         )
1938         self.assertEqual(
1939             self.ipv6_address.packed,
1940             b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01",
1941         )
1942         self.assertEqual(
1943             ipaddress.IPv6Interface("ffff:2:3:4:ffff::").packed,
1944             b"\xff\xff\x00\x02\x00\x03\x00\x04\xff\xff" + b"\x00" * 6,
1945         )
1946         self.assertEqual(
1947             ipaddress.IPv6Interface("::1:0:0:0:0").packed,
1948             b"\x00" * 6 + b"\x00\x01" + b"\x00" * 8,
1949         )
1950         self.assertEqual(
1951             self.ipv6_scoped_address.packed,
1952             b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01",
1953         )
1954         self.assertEqual(
1955             ipaddress.IPv6Interface("ffff:2:3:4:ffff::%scope").packed,
1956             b"\xff\xff\x00\x02\x00\x03\x00\x04\xff\xff" + b"\x00" * 6,
1957         )
1958         self.assertEqual(
1959             ipaddress.IPv6Interface("::1:0:0:0:0%scope").packed,
1960             b"\x00" * 6 + b"\x00\x01" + b"\x00" * 8,
1961         )
1962     def testIpType(self):
1963         ipv4net = ipaddress.ip_network("1.2.3.4")
1964         ipv4addr = ipaddress.ip_address("1.2.3.4")
1965         ipv6net = ipaddress.ip_network("::1.2.3.4")
1966         ipv6addr = ipaddress.ip_address("::1.2.3.4")
1967         self.assertEqual(ipaddress.IPv4Network, type(ipv4net))
1968         self.assertEqual(ipaddress.IPv4Address, type(ipv4addr))
1969         self.assertEqual(ipaddress.IPv6Network, type(ipv6net))
1970         self.assertEqual(ipaddress.IPv6Address, type(ipv6addr))
1971     def testReservedIpv4(self):
1972         self.assertEqual(True, ipaddress.ip_interface("224.1.1.1/31").is_multicast)
1973         self.assertEqual(False, ipaddress.ip_network("240.0.0.0").is_multicast)
1974         self.assertEqual(True, ipaddress.ip_network("240.0.0.0").is_reserved)
1975         self.assertEqual(True, ipaddress.ip_interface("192.168.1.1/17").is_private)
1976         self.assertEqual(False, ipaddress.ip_network("192.169.0.0").is_private)
1977         self.assertEqual(True, ipaddress.ip_network("10.255.255.255").is_private)
1978         self.assertEqual(False, ipaddress.ip_network("11.0.0.0").is_private)
1979         self.assertEqual(False, ipaddress.ip_network("11.0.0.0").is_reserved)
1980         self.assertEqual(True, ipaddress.ip_network("172.31.255.255").is_private)
1981         self.assertEqual(False, ipaddress.ip_network("172.32.0.0").is_private)
1982         self.assertEqual(True, ipaddress.ip_network("169.254.1.0/24").is_link_local)
1983         self.assertEqual(
1984             True, ipaddress.ip_interface("169.254.100.200/24").is_link_local
1985         )
1986         self.assertEqual(
1987             False, ipaddress.ip_interface("169.255.100.200/24").is_link_local
1988         )
1989         self.assertEqual(True, ipaddress.ip_network("127.100.200.254/32").is_loopback)
1990         self.assertEqual(True, ipaddress.ip_network("127.42.0.0/16").is_loopback)
1991         self.assertEqual(False, ipaddress.ip_network("128.0.0.0").is_loopback)
1992         self.assertEqual(False, ipaddress.ip_network("100.64.0.0/10").is_private)
1993         self.assertEqual(False, ipaddress.ip_network("100.64.0.0/10").is_global)
1994         self.assertEqual(True, ipaddress.ip_network("192.0.2.128/25").is_private)
1995         self.assertEqual(True, ipaddress.ip_network("192.0.3.0/24").is_global)
1996         self.assertEqual(True, ipaddress.ip_address("0.0.0.0").is_unspecified)
1997         self.assertEqual(True, ipaddress.ip_address("224.1.1.1").is_multicast)
1998         self.assertEqual(False, ipaddress.ip_address("240.0.0.0").is_multicast)
1999         self.assertEqual(True, ipaddress.ip_address("240.0.0.1").is_reserved)
2000         self.assertEqual(False, ipaddress.ip_address("239.255.255.255").is_reserved)
2001         self.assertEqual(True, ipaddress.ip_address("192.168.1.1").is_private)
2002         self.assertEqual(False, ipaddress.ip_address("192.169.0.0").is_private)
2003         self.assertEqual(True, ipaddress.ip_address("10.255.255.255").is_private)
2004         self.assertEqual(False, ipaddress.ip_address("11.0.0.0").is_private)
2005         self.assertEqual(True, ipaddress.ip_address("172.31.255.255").is_private)
2006         self.assertEqual(False, ipaddress.ip_address("172.32.0.0").is_private)
2007         self.assertEqual(True, ipaddress.ip_address("169.254.100.200").is_link_local)
2008         self.assertEqual(False, ipaddress.ip_address("169.255.100.200").is_link_local)
2009         self.assertTrue(ipaddress.ip_address("192.0.7.1").is_global)
2010         self.assertFalse(ipaddress.ip_address("203.0.113.1").is_global)
2011         self.assertEqual(True, ipaddress.ip_address("127.100.200.254").is_loopback)
2012         self.assertEqual(True, ipaddress.ip_address("127.42.0.0").is_loopback)
2013         self.assertEqual(False, ipaddress.ip_address("128.0.0.0").is_loopback)
2014         self.assertEqual(True, ipaddress.ip_network("0.0.0.0").is_unspecified)
2015     def testReservedIpv6(self):
2016         self.assertEqual(True, ipaddress.ip_network("ffff::").is_multicast)
2017         self.assertEqual(True, ipaddress.ip_network(2 ** 128 - 1).is_multicast)
2018         self.assertEqual(True, ipaddress.ip_network("ff00::").is_multicast)
2019         self.assertEqual(False, ipaddress.ip_network("fdff::").is_multicast)
2020         self.assertEqual(True, ipaddress.ip_network("fecf::").is_site_local)
2021         self.assertEqual(
2022             True, ipaddress.ip_network("feff:ffff:ffff:ffff::").is_site_local
2023         )
2024         self.assertEqual(False, ipaddress.ip_network("fbf:ffff::").is_site_local)
2025         self.assertEqual(False, ipaddress.ip_network("ff00::").is_site_local)
2026         self.assertEqual(True, ipaddress.ip_network("fc00::").is_private)
2027         self.assertEqual(True, ipaddress.ip_network("fc00:ffff:ffff:ffff::").is_private)
2028         self.assertEqual(False, ipaddress.ip_network("fbff:ffff::").is_private)
2029         self.assertEqual(False, ipaddress.ip_network("fe00::").is_private)
2030         self.assertEqual(True, ipaddress.ip_network("fea0::").is_link_local)
2031         self.assertEqual(True, ipaddress.ip_network("febf:ffff::").is_link_local)
2032         self.assertEqual(False, ipaddress.ip_network("fe7f:ffff::").is_link_local)
2033         self.assertEqual(False, ipaddress.ip_network("fec0::").is_link_local)
2034         self.assertEqual(True, ipaddress.ip_interface("0:0::0:01").is_loopback)
2035         self.assertEqual(False, ipaddress.ip_interface("::1/127").is_loopback)
2036         self.assertEqual(False, ipaddress.ip_network("::").is_loopback)
2037         self.assertEqual(False, ipaddress.ip_network("::2").is_loopback)
2038         self.assertEqual(True, ipaddress.ip_network("0::0").is_unspecified)
2039         self.assertEqual(False, ipaddress.ip_network("::1").is_unspecified)
2040         self.assertEqual(False, ipaddress.ip_network("::/127").is_unspecified)
2041         self.assertEqual(True, ipaddress.ip_network("2001::1/128").is_private)
2042         self.assertEqual(True, ipaddress.ip_network("200::1/128").is_global)
2043         self.assertEqual(True, ipaddress.ip_address("ffff::").is_multicast)
2044         self.assertEqual(True, ipaddress.ip_address(2 ** 128 - 1).is_multicast)
2045         self.assertEqual(True, ipaddress.ip_address("ff00::").is_multicast)
2046         self.assertEqual(False, ipaddress.ip_address("fdff::").is_multicast)
2047         self.assertEqual(True, ipaddress.ip_address("fecf::").is_site_local)
2048         self.assertEqual(
2049             True, ipaddress.ip_address("feff:ffff:ffff:ffff::").is_site_local
2050         )
2051         self.assertEqual(False, ipaddress.ip_address("fbf:ffff::").is_site_local)
2052         self.assertEqual(False, ipaddress.ip_address("ff00::").is_site_local)
2053         self.assertEqual(True, ipaddress.ip_address("fc00::").is_private)
2054         self.assertEqual(True, ipaddress.ip_address("fc00:ffff:ffff:ffff::").is_private)
2055         self.assertEqual(False, ipaddress.ip_address("fbff:ffff::").is_private)
2056         self.assertEqual(False, ipaddress.ip_address("fe00::").is_private)
2057         self.assertEqual(True, ipaddress.ip_address("fea0::").is_link_local)
2058         self.assertEqual(True, ipaddress.ip_address("febf:ffff::").is_link_local)
2059         self.assertEqual(False, ipaddress.ip_address("fe7f:ffff::").is_link_local)
2060         self.assertEqual(False, ipaddress.ip_address("fec0::").is_link_local)
2061         self.assertEqual(True, ipaddress.ip_address("0:0::0:01").is_loopback)
2062         self.assertEqual(True, ipaddress.ip_address("::1").is_loopback)
2063         self.assertEqual(False, ipaddress.ip_address("::2").is_loopback)
2064         self.assertEqual(True, ipaddress.ip_address("0::0").is_unspecified)
2065         self.assertEqual(False, ipaddress.ip_address("::1").is_unspecified)
2066         self.assertEqual(True, ipaddress.ip_address("100::").is_reserved)
2067         self.assertEqual(True, ipaddress.ip_network("4000::1/128").is_reserved)
2068     def testIpv4Mapped(self):
2069         self.assertEqual(
2070             ipaddress.ip_address("::ffff:192.168.1.1").ipv4_mapped,
2071             ipaddress.ip_address("192.168.1.1"),
2072         )
2073         self.assertEqual(ipaddress.ip_address("::c0a8:101").ipv4_mapped, None)
2074         self.assertEqual(
2075             ipaddress.ip_address("::ffff:c0a8:101").ipv4_mapped,
2076             ipaddress.ip_address("192.168.1.1"),
2077         )
2078     def testAddrExclude(self):
2079         addr1 = ipaddress.ip_network("10.1.1.0/24")
2080         addr2 = ipaddress.ip_network("10.1.1.0/26")
2081         addr3 = ipaddress.ip_network("10.2.1.0/24")
2082         addr4 = ipaddress.ip_address("10.1.1.0")
2083         addr5 = ipaddress.ip_network("2001:db8::0/32")
2084         addr6 = ipaddress.ip_network("10.1.1.5/32")
2085         self.assertEqual(
2086             sorted(list(addr1.address_exclude(addr2))),
2087             [
2088                 ipaddress.ip_network("10.1.1.64/26"),
2089                 ipaddress.ip_network("10.1.1.128/25"),
2090             ],
2091         )
2092         self.assertRaises(ValueError, list, addr1.address_exclude(addr3))
2093         self.assertRaises(TypeError, list, addr1.address_exclude(addr4))
2094         self.assertRaises(TypeError, list, addr1.address_exclude(addr5))
2095         self.assertEqual(list(addr1.address_exclude(addr1)), [])
2096         self.assertEqual(
2097             sorted(list(addr1.address_exclude(addr6))),
2098             [
2099                 ipaddress.ip_network("10.1.1.0/30"),
2100                 ipaddress.ip_network("10.1.1.4/32"),
2101                 ipaddress.ip_network("10.1.1.6/31"),
2102                 ipaddress.ip_network("10.1.1.8/29"),
2103                 ipaddress.ip_network("10.1.1.16/28"),
2104                 ipaddress.ip_network("10.1.1.32/27"),
2105                 ipaddress.ip_network("10.1.1.64/26"),
2106                 ipaddress.ip_network("10.1.1.128/25"),
2107             ],
2108         )
2109     def testHash(self):
2110         self.assertEqual(
2111             hash(ipaddress.ip_interface("10.1.1.0/24")),
2112             hash(ipaddress.ip_interface("10.1.1.0/24")),
2113         )
2114         self.assertEqual(
2115             hash(ipaddress.ip_network("10.1.1.0/24")),
2116             hash(ipaddress.ip_network("10.1.1.0/24")),
2117         )
2118         self.assertEqual(
2119             hash(ipaddress.ip_address("10.1.1.0")),
2120             hash(ipaddress.ip_address("10.1.1.0")),
2121         )
2122         self.assertEqual(
2123             hash(ipaddress.ip_address("1.2.3.4")),
2124             hash(ipaddress.ip_address(int(ipaddress.ip_address("1.2.3.4")._ip))),
2125         )
2126         ip1 = ipaddress.ip_address("10.1.1.0")
2127         ip2 = ipaddress.ip_address("1::")
2128         dummy = {}
2129         dummy[self.ipv4_address] = None
2130         dummy[self.ipv6_address] = None
2131         dummy[ip1] = None
2132         dummy[ip2] = None
2133         self.assertIn(self.ipv4_address, dummy)
2134         self.assertIn(ip2, dummy)
2135     def testIPBases(self):
2136         net = self.ipv4_network
2137         self.assertEqual("1.2.3.0/24", net.compressed)
2138         net = self.ipv6_network
2139         self.assertRaises(ValueError, net._string_from_ip_int, 2 ** 128 + 1)
2140     def testIPv6NetworkHelpers(self):
2141         net = self.ipv6_network
2142         self.assertEqual("2001:658:22a:cafe::/64", net.with_prefixlen)
2143         self.assertEqual("2001:658:22a:cafe::/ffff:ffff:ffff:ffff::", net.with_netmask)
2144         self.assertEqual("2001:658:22a:cafe::/::ffff:ffff:ffff:ffff", net.with_hostmask)
2145         self.assertEqual("2001:658:22a:cafe::/64", str(net))
2146     def testIPv4NetworkHelpers(self):
2147         net = self.ipv4_network
2148         self.assertEqual("1.2.3.0/24", net.with_prefixlen)
2149         self.assertEqual("1.2.3.0/255.255.255.0", net.with_netmask)
2150         self.assertEqual("1.2.3.0/0.0.0.255", net.with_hostmask)
2151         self.assertEqual("1.2.3.0/24", str(net))
2152     def testCopyConstructor(self):
2153         addr1 = ipaddress.ip_network("10.1.1.0/24")
2154         addr2 = ipaddress.ip_network(addr1)
2155         addr3 = ipaddress.ip_interface("2001:658:22a:cafe:200::1/64")
2156         addr4 = ipaddress.ip_interface(addr3)
2157         addr5 = ipaddress.IPv4Address("1.1.1.1")
2158         addr6 = ipaddress.IPv6Address("2001:658:22a:cafe:200::1")
2159         self.assertEqual(addr1, addr2)
2160         self.assertEqual(addr3, addr4)
2161         self.assertEqual(addr5, ipaddress.IPv4Address(addr5))
2162         self.assertEqual(addr6, ipaddress.IPv6Address(addr6))
2163     def testCompressIPv6Address(self):
2164         test_addresses = {
2165             "1:2:3:4:5:6:7:8": "1:2:3:4:5:6:7:8/128",
2166             "2001:0:0:4:0:0:0:8": "2001:0:0:4::8/128",
2167             "2001:0:0:4:5:6:7:8": "2001::4:5:6:7:8/128",
2168             "2001:0:3:4:5:6:7:8": "2001:0:3:4:5:6:7:8/128",
2169             "0:0:3:0:0:0:0:ffff": "0:0:3::ffff/128",
2170             "0:0:0:4:0:0:0:ffff": "::4:0:0:0:ffff/128",
2171             "0:0:0:0:5:0:0:ffff": "::5:0:0:ffff/128",
2172             "1:0:0:4:0:0:7:8": "1::4:0:0:7:8/128",
2173             "0:0:0:0:0:0:0:0": "::/128",
2174             "0:0:0:0:0:0:0:0/0": "::/0",
2175             "0:0:0:0:0:0:0:1": "::1/128",
2176             "2001:0658:022a:cafe:0000:0000:0000:0000/66": "2001:658:22a:cafe::/66",
2177             "::1.2.3.4": "::102:304/128",
2178             "1:2:3:4:5:ffff:1.2.3.4": "1:2:3:4:5:ffff:102:304/128",
2179             "::7:6:5:4:3:2:1": "0:7:6:5:4:3:2:1/128",
2180             "::7:6:5:4:3:2:0": "0:7:6:5:4:3:2:0/128",
2181             "7:6:5:4:3:2:1::": "7:6:5:4:3:2:1:0/128",
2182             "0:6:5:4:3:2:1::": "0:6:5:4:3:2:1:0/128",
2183         }
2184         for uncompressed, compressed in list(test_addresses.items()):
2185             self.assertEqual(compressed, str(ipaddress.IPv6Interface(uncompressed)))
2186     def testExplodeShortHandIpStr(self):
2187         addr1 = ipaddress.IPv6Interface("2001::1")
2188         addr2 = ipaddress.IPv6Address("2001:0:5ef5:79fd:0:59d:a0e5:ba1")
2189         addr3 = ipaddress.IPv6Network("2001::/96")
2190         addr4 = ipaddress.IPv4Address("192.168.178.1")
2191         self.assertEqual("2001:0000:0000:0000:0000:0000:0000:0001/128", addr1.exploded)
2192         self.assertEqual(
2193             "0000:0000:0000:0000:0000:0000:0000:0001/128",
2194             ipaddress.IPv6Interface("::1/128").exploded,
2195         )
2196         self.assertEqual("2001:0000:5ef5:79fd:0000:059d:a0e5:0ba1", addr2.exploded)
2197         self.assertEqual("2001:0000:0000:0000:0000:0000:0000:0000/96", addr3.exploded)
2198         self.assertEqual("192.168.178.1", addr4.exploded)
2199     def testReversePointer(self):
2200         addr1 = ipaddress.IPv4Address("127.0.0.1")
2201         addr2 = ipaddress.IPv6Address("2001:db8::1")
2202         self.assertEqual("1.0.0.127.in-addr.arpa", addr1.reverse_pointer)
2203         self.assertEqual(
2204             "1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8."
2205             + "b.d.0.1.0.0.2.ip6.arpa",
2206             addr2.reverse_pointer,
2207         )
2208     def testIntRepresentation(self):
2209         self.assertEqual(16909060, int(self.ipv4_address))
2210         self.assertEqual(42540616829182469433547762482097946625, int(self.ipv6_address))
2211     def testForceVersion(self):
2212         self.assertEqual(ipaddress.ip_network(1).version, 4)
2213         self.assertEqual(ipaddress.IPv6Network(1).version, 6)
2214     def testWithStar(self):
2215         self.assertEqual(self.ipv4_interface.with_prefixlen, "1.2.3.4/24")
2216         self.assertEqual(self.ipv4_interface.with_netmask, "1.2.3.4/255.255.255.0")
2217         self.assertEqual(self.ipv4_interface.with_hostmask, "1.2.3.4/0.0.0.255")
2218         self.assertEqual(
2219             self.ipv6_interface.with_prefixlen, "2001:658:22a:cafe:200::1/64"
2220         )
2221         self.assertEqual(
2222             self.ipv6_interface.with_netmask,
2223             "2001:658:22a:cafe:200::1/ffff:ffff:ffff:ffff::",
2224         )
2225         self.assertEqual(
2226             self.ipv6_interface.with_hostmask,
2227             "2001:658:22a:cafe:200::1/::ffff:ffff:ffff:ffff",
2228         )
2229     def testNetworkElementCaching(self):
2230         self.assertNotIn("broadcast_address", self.ipv4_network._cache)
2231         self.assertNotIn("hostmask", self.ipv4_network._cache)
2232         self.assertEqual(
2233             self.ipv4_network.broadcast_address, ipaddress.IPv4Address("1.2.3.255")
2234         )
2235         self.assertEqual(self.ipv4_network.hostmask, ipaddress.IPv4Address("0.0.0.255"))
2236         self.assertIn("broadcast_address", self.ipv4_network._cache)
2237         self.assertIn("hostmask", self.ipv4_network._cache)
2238         self.assertNotIn("broadcast_address", self.ipv6_network._cache)
2239         self.assertNotIn("hostmask", self.ipv6_network._cache)
2240         self.assertEqual(
2241             self.ipv6_network.network_address,
2242             ipaddress.IPv6Address("2001:658:22a:cafe::"),
2243         )
2244         self.assertEqual(
2245             self.ipv6_interface.network.network_address,
2246             ipaddress.IPv6Address("2001:658:22a:cafe::"),
2247         )
2248         self.assertEqual(
2249             self.ipv6_network.broadcast_address,
2250             ipaddress.IPv6Address("2001:658:22a:cafe:ffff:ffff:ffff:ffff"),
2251         )
2252         self.assertEqual(
2253             self.ipv6_network.hostmask, ipaddress.IPv6Address("::ffff:ffff:ffff:ffff")
2254         )
2255         self.assertEqual(
2256             self.ipv6_interface.network.broadcast_address,
2257             ipaddress.IPv6Address("2001:658:22a:cafe:ffff:ffff:ffff:ffff"),
2258         )
2259         self.assertEqual(
2260             self.ipv6_interface.network.hostmask,
2261             ipaddress.IPv6Address("::ffff:ffff:ffff:ffff"),
2262         )
2263         self.assertIn("broadcast_address", self.ipv6_network._cache)
2264         self.assertIn("hostmask", self.ipv6_network._cache)
2265         self.assertIn("broadcast_address", self.ipv6_interface.network._cache)
2266         self.assertIn("hostmask", self.ipv6_interface.network._cache)
2267     def testTeredo(self):
2268         server = ipaddress.IPv4Address("65.54.227.120")
2269         client = ipaddress.IPv4Address("192.0.2.45")
2270         teredo_addr = "2001:0000:4136:e378:8000:63bf:3fff:fdd2"
2271         self.assertEqual((server, client), ipaddress.ip_address(teredo_addr).teredo)
2272         bad_addr = "2000::4136:e378:8000:63bf:3fff:fdd2"
2273         self.assertFalse(ipaddress.ip_address(bad_addr).teredo)
2274         bad_addr = "2001:0001:4136:e378:8000:63bf:3fff:fdd2"
2275         self.assertFalse(ipaddress.ip_address(bad_addr).teredo)
2276         teredo_addr = ipaddress.IPv6Address("2001:0:5ef5:79fd:0:59d:a0e5:ba1")
2277         self.assertEqual(
2278             (
2279                 ipaddress.IPv4Address("94.245.121.253"),
2280                 ipaddress.IPv4Address("95.26.244.94"),
2281             ),
2282             teredo_addr.teredo,
2283         )
2284     def testsixtofour(self):
2285         sixtofouraddr = ipaddress.ip_address("2002:ac1d:2d64::1")
2286         bad_addr = ipaddress.ip_address("2000:ac1d:2d64::1")
2287         self.assertEqual(
2288             ipaddress.IPv4Address("172.29.45.100"), sixtofouraddr.sixtofour
2289         )
2290         self.assertFalse(bad_addr.sixtofour)
2291     def testV4HashIsNotConstant(self):
2292         ipv4_address1 = ipaddress.IPv4Interface("1.2.3.4")
2293         ipv4_address2 = ipaddress.IPv4Interface("2.3.4.5")
2294         self.assertNotEqual(ipv4_address1.__hash__(), ipv4_address2.__hash__())
2295     def testV6HashIsNotConstant(self):
2296         ipv6_address1 = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1")
2297         ipv6_address2 = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:2")
2298         self.assertNotEqual(ipv6_address1.__hash__(), ipv6_address2.__hash__())
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
