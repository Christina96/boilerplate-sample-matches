<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_win_lgpo_netsh.py &amp; test_ipaddress.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_win_lgpo_netsh.py &amp; test_ipaddress.py
      </h3>
<h1 align="center">
        3.4%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_win_lgpo_netsh.py (12.034079%)<th>test_ipaddress.py (2.0386074%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(105-120)<td><a href="#" name="0">(2195-2211)</a><td align="center"><font color="#ff0000">32</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(89-102)<td><a href="#" name="1">(705-717)</a><td align="center"><font color="#cf0000">26</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(121-128)<td><a href="#" name="2">(2794-2800)</a><td align="center"><font color="#7f0000">16</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(58-65)<td><a href="#" name="3">(2630-2636)</a><td align="center"><font color="#6f0000">14</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(40-47)<td><a href="#" name="4">(1634-1640)</a><td align="center"><font color="#670000">13</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(68-74)<td><a href="#" name="5">(128-132)</a><td align="center"><font color="#5f0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_win_lgpo_netsh.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import pytest
2 import salt.utils.platform
3 import salt.utils.win_lgpo_netsh as win_lgpo_netsh
4 from salt.exceptions import CommandExecutionError
5 from tests.support.mock import patch
6 from tests.support.unit import TestCase, skipIf
7 @skipIf(not salt.utils.platform.is_windows(), "System is not Windows")
8 class WinLgpoNetshTestCase(TestCase):
9     def test_get_settings_firewallpolicy_local(self):
10         ret = win_lgpo_netsh.get_settings(
11             profile="domain", section="firewallpolicy", store="local"
12         )
13         self.assertIn("Inbound", ret)
14         self.assertIn("Outbound", ret)
15     def test_get_settings_firewallpolicy_lgpo(self):
16         ret = win_lgpo_netsh.get_settings(
17             profile="domain", section="firewallpolicy", store="lgpo"
18         )
19         self.assertIn("Inbound", ret)
20         self.assertIn("Outbound", ret)
21     def test_get_settings_firewallpolicy_lgpo_issue_57591(self):
22         with patch.object(win_lgpo_netsh, "__hostname__", return_value="kомпьютер"):
23             ret = win_lgpo_netsh.get_settings(
24                 profile="domain", section="firewallpolicy", store="lgpo"
25             )
26         self.assertIn("Inbound", ret)
27         self.assertIn("Outbound", ret)
28     def test_get_settings_logging_local(self):
29             profile="domain", section="logging", store="local"
30         )
31         self.assertIn<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>("FileName", ret)
32         self.assertIn("LogAllowedConnections", ret)
33         self.assertIn("LogDroppedConnections", ret)
34         self.assertIn("MaxFileSize", ret)
35     def test_get_settings_logging_lgpo(self):
36         ret = win_lgpo_netsh.get_settings(
37             profile=</b></font>"domain", section="logging", store="lgpo"
38         )
39         self.assertIn("FileName", ret)
40         self.assertIn("LogAllowedConnections", ret)
41         self.assertIn("LogDroppedConnections", ret)
42         self.assertIn("MaxFileSize", ret)
43     def test_get_settings_settings_local(self):
44             profile="domain", section="settings", store="local"
45         )
46         self<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertIn("InboundUserNotification", ret)
47         self.assertIn("LocalConSecRules", ret)
48         self.assertIn("LocalFirewallRules", ret)
49         self.assertIn("RemoteManagement", ret)
50         self.assertIn("UnicastResponseToMulticast", ret)
51     def test_get_settings_settings_lgpo(self):
52             profile="domain", section="settings", store="lgpo"
53         )
54         self<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertIn("InboundUserNotification", ret)
55         self.assertIn("LocalConSecRules", ret)
56         self.assertIn("LocalFirewallRules", ret)
57         self.assertIn("RemoteManagement", ret)
58         self.assertIn("UnicastResponseToMulticast", ret)
59     def</b></font> test_get_settings_state_local(self):
60         ret = win_lgpo_netsh.get_settings(
61             profile="domain", section="state", store="local"
62         )
63         self.assertIn("State", ret)
64     def test_get_settings_state_lgpo(self):
65         ret = win_lgpo_netsh.get_settings(
66             profile="domain", section="state", store="lgpo"
67         )
68         self.assertIn("State", ret)
69         ret = win_lgpo_netsh.get_all_settings(profile="domain", store="local")
70         self<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertIn("Inbound", ret)
71         self.assertIn("Outbound", ret)
72         self.assertIn("FileName", ret)
73         self.assertIn("LogAllowedConnections", ret)
74         self.assertIn("LogDroppedConnections", ret)
75         self.assertIn("MaxFileSize", ret)
76         self.assertIn("InboundUserNotification", ret)
77         self.assertIn("LocalConSecRules", ret)
78         self.assertIn("LocalFirewallRules", ret)
79         self.assertIn("RemoteManagement", ret)
80         self.assertIn("UnicastResponseToMulticast", ret)
81         self.assertIn("State", ret)
82         ret = win_lgpo_netsh.get_all_settings(profile="domain", store="local")
83         self<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertIn("Inbound", ret)
84         self.assertIn("Outbound", ret)
85         self.assertIn("FileName", ret)
86         self.assertIn("LogAllowedConnections", ret)
87         self.assertIn("LogDroppedConnections", ret)
88         self.assertIn("MaxFileSize", ret)
89         self.assertIn("InboundUserNotification", ret)
90         self.assertIn("LocalConSecRules", ret)
91         self.assertIn("LocalFirewallRules", ret)
92         self.assertIn("RemoteManagement", ret)
93         self.assertIn("UnicastResponseToMulticast", ret)
94         self.assertIn("State", ret)
95         ret = win_lgpo_netsh.get_all_profiles(store="local")
96         self.assertIn(</b></font>"Domain Profile", ret)
97         self<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertIn("Private Profile", ret)
98         self.assertIn("Public Profile", ret)
99     def test_get_all_profiles_lgpo(self):
100         ret = win_lgpo_netsh.get_all_profiles(store="lgpo")
101         self.assertIn("Domain Profile", ret)
102         self.assertIn("Private Profile", ret)
103         self.assertIn(</b></font>"Public Profile", ret)
104     @pytest.mark.destructive_test
105     def test_set_firewall_settings_inbound_local(self):
106         current = win_lgpo_netsh.get_settings(
107             profile="domain", section="firewallpolicy", store="local"
108         )["Inbound"]
109         try:
110             ret = win_lgpo_netsh.set_firewall_settings(
111                 profile="domain", inbound="allowinbound", store="local"
112             )
113             self.assertTrue(ret)
114             new = win_lgpo_netsh.get_settings(
115                 profile="domain", section="firewallpolicy", store="local"
116             )["Inbound"]
117             self.assertEqual("AllowInbound", new)
118         finally:
119             ret = win_lgpo_netsh.set_firewall_settings(
120                 profile="domain", inbound=current, store="local"
121             )
122             self.assertTrue(ret)
123     @pytest.mark.destructive_test
124     def test_set_firewall_settings_inbound_local_notconfigured(self):
125         current = win_lgpo_netsh.get_settings(
126             profile="domain", section="firewallpolicy", store="local"
127         )["Inbound"]
128         try:
129             self.assertRaises(
130                 CommandExecutionError,
131                 win_lgpo_netsh.set_firewall_settings,
132                 profile="domain",
133                 inbound="notconfigured",
134                 store="local",
135             )
136         finally:
137             ret = win_lgpo_netsh.set_firewall_settings(
138                 profile="domain", inbound=current, store="local"
139             )
140             self.assertTrue(ret)
141     @pytest.mark.destructive_test
142     def test_set_firewall_settings_inbound_lgpo_notconfigured(self):
143         current = win_lgpo_netsh.get_settings(
144             profile="domain", section="firewallpolicy", store="lgpo"
145         )["Inbound"]
146         try:
147             ret = win_lgpo_netsh.set_firewall_settings(
148                 profile="domain", inbound="notconfigured", store="lgpo"
149             )
150             self.assertTrue(ret)
151             new = win_lgpo_netsh.get_settings(
152                 profile="domain", section="firewallpolicy", store="lgpo"
153             )["Inbound"]
154             self.assertEqual("NotConfigured", new)
155         finally:
156             ret = win_lgpo_netsh.set_firewall_settings(
157                 profile="domain", inbound=current, store="lgpo"
158             )
159             self.assertTrue(ret)
160     @pytest.mark.destructive_test
161     def test_set_firewall_settings_outbound_local(self):
162         current = win_lgpo_netsh.get_settings(
163             profile="domain", section="firewallpolicy", store="local"
164         )["Outbound"]
165         try:
166             ret = win_lgpo_netsh.set_firewall_settings(
167                 profile="domain", outbound="allowoutbound", store="local"
168             )
169             self.assertTrue(ret)
170             new = win_lgpo_netsh.get_settings(
171                 profile="domain", section="firewallpolicy", store="local"
172             )["Outbound"]
173             self.assertEqual("AllowOutbound", new)
174         finally:
175             ret = win_lgpo_netsh.set_firewall_settings(
176                 profile="domain", outbound=current, store="local"
177             )
178             self.assertTrue(ret)
179     @pytest.mark.destructive_test
180     def test_set_firewall_logging_allowed_local_enable(self):
181         current = win_lgpo_netsh.get_settings(
182             profile="domain", section="logging", store="local"
183         )["LogAllowedConnections"]
184         try:
185             ret = win_lgpo_netsh.set_logging_settings(
186                 profile="domain",
187                 setting="allowedconnections",
188                 value="enable",
189                 store="local",
190             )
191             self.assertTrue(ret)
192             new = win_lgpo_netsh.get_settings(
193                 profile="domain", section="logging", store="local"
194             )["LogAllowedConnections"]
195             self.assertEqual("Enable", new)
196         finally:
197             ret = win_lgpo_netsh.set_logging_settings(
198                 profile="domain",
199                 setting="allowedconnections",
200                 value=current,
201                 store="local",
202             )
203             self.assertTrue(ret)
204     @pytest.mark.destructive_test
205     def test_set_firewall_logging_allowed_local_notconfigured(self):
206         current = win_lgpo_netsh.get_settings(
207             profile="domain", section="logging", store="local"
208         )["LogAllowedConnections"]
209         try:
210             self.assertRaises(
211                 CommandExecutionError,
212                 win_lgpo_netsh.set_logging_settings,
213                 profile="domain",
214                 setting="allowedconnections",
215                 value="notconfigured",
216                 store="local",
217             )
218         finally:
219             ret = win_lgpo_netsh.set_logging_settings(
220                 profile="domain",
221                 setting="allowedconnections",
222                 value=current,
223                 store="local",
224             )
225             self.assertTrue(ret)
226     @pytest.mark.destructive_test
227     def test_set_firewall_logging_allowed_lgpo_notconfigured(self):
228         current = win_lgpo_netsh.get_settings(
229             profile="domain", section="logging", store="lgpo"
230         )["LogAllowedConnections"]
231         try:
232             ret = win_lgpo_netsh.set_logging_settings(
233                 profile="domain",
234                 setting="allowedconnections",
235                 value="notconfigured",
236                 store="lgpo",
237             )
238             self.assertTrue(ret)
239             new = win_lgpo_netsh.get_settings(
240                 profile="domain", section="logging", store="lgpo"
241             )["LogAllowedConnections"]
242             self.assertEqual("NotConfigured", new)
243         finally:
244             ret = win_lgpo_netsh.set_logging_settings(
245                 profile="domain",
246                 setting="allowedconnections",
247                 value=current,
248                 store="lgpo",
249             )
250             self.assertTrue(ret)
251     def test_set_firewall_logging_dropped_local_enable(self):
252         current = win_lgpo_netsh.get_settings(
253             profile="domain", section="logging", store="local"
254         )["LogDroppedConnections"]
255         try:
256             ret = win_lgpo_netsh.set_logging_settings(
257                 profile="domain",
258                 setting="droppedconnections",
259                 value="enable",
260                 store="local",
261             )
262             self.assertTrue(ret)
263             new = win_lgpo_netsh.get_settings(
264                 profile="domain", section="logging", store="local"
265             )["LogDroppedConnections"]
266             self.assertEqual("Enable", new)
267         finally:
268             ret = win_lgpo_netsh.set_logging_settings(
269                 profile="domain",
270                 setting="droppedconnections",
271                 value=current,
272                 store="local",
273             )
274             self.assertTrue(ret)
275     def test_set_firewall_logging_filename_local(self):
276         current = win_lgpo_netsh.get_settings(
277             profile="domain", section="logging", store="local"
278         )["FileName"]
279         try:
280             ret = win_lgpo_netsh.set_logging_settings(
281                 profile="domain",
282                 setting="filename",
283                 value="C:\\Temp\\test.log",
284                 store="local",
285             )
286             self.assertTrue(ret)
287             new = win_lgpo_netsh.get_settings(
288                 profile="domain", section="logging", store="local"
289             )["FileName"]
290             self.assertEqual("C:\\Temp\\test.log", new)
291         finally:
292             ret = win_lgpo_netsh.set_logging_settings(
293                 profile="domain", setting="filename", value=current, store="local"
294             )
295             self.assertTrue(ret)
296     def test_set_firewall_logging_maxfilesize_local(self):
297         current = win_lgpo_netsh.get_settings(
298             profile="domain", section="logging", store="local"
299         )["MaxFileSize"]
300         try:
301             ret = win_lgpo_netsh.set_logging_settings(
302                 profile="domain", setting="maxfilesize", value="16384", store="local"
303             )
304             self.assertTrue(ret)
305             new = win_lgpo_netsh.get_settings(
306                 profile="domain", section="logging", store="local"
307             )["MaxFileSize"]
308             self.assertEqual("16384", new)
309         finally:
310             ret = win_lgpo_netsh.set_logging_settings(
311                 profile="domain", setting="maxfilesize", value=current, store="local"
312             )
313             self.assertTrue(ret)
314     @pytest.mark.destructive_test
315     def test_set_firewall_settings_fwrules_local_enable(self):
316         self.assertRaises(
317             CommandExecutionError,
318             win_lgpo_netsh.set_settings,
319             profile="domain",
320             setting="localfirewallrules",
321             value="enable",
322             store="local",
323         )
324     @pytest.mark.destructive_test
325     def test_set_firewall_settings_fwrules_lgpo_notconfigured(self):
326         current = win_lgpo_netsh.get_settings(
327             profile="domain", section="settings", store="lgpo"
328         )["LocalFirewallRules"]
329         try:
330             ret = win_lgpo_netsh.set_settings(
331                 profile="domain",
332                 setting="localfirewallrules",
333                 value="notconfigured",
334                 store="lgpo",
335             )
336             self.assertTrue(ret)
337             new = win_lgpo_netsh.get_settings(
338                 profile="domain", section="settings", store="lgpo"
339             )["LocalFirewallRules"]
340             self.assertEqual("NotConfigured", new)
341         finally:
342             ret = win_lgpo_netsh.set_settings(
343                 profile="domain",
344                 setting="localfirewallrules",
345                 value=current,
346                 store="lgpo",
347             )
348             self.assertTrue(ret)
349     @pytest.mark.destructive_test
350     def test_set_firewall_settings_consecrules_local_enable(self):
351         self.assertRaises(
352             CommandExecutionError,
353             win_lgpo_netsh.set_settings,
354             profile="domain",
355             setting="localconsecrules",
356             value="enable",
357             store="local",
358         )
359     def test_set_firewall_settings_notification_local_enable(self):
360         current = win_lgpo_netsh.get_settings(
361             profile="domain", section="settings", store="local"
362         )["InboundUserNotification"]
363         try:
364             ret = win_lgpo_netsh.set_settings(
365                 profile="domain",
366                 setting="inboundusernotification",
367                 value="enable",
368                 store="local",
369             )
370             self.assertTrue(ret)
371             new = win_lgpo_netsh.get_settings(
372                 profile="domain", section="settings", store="local"
373             )["InboundUserNotification"]
374             self.assertEqual("Enable", new)
375         finally:
376             ret = win_lgpo_netsh.set_settings(
377                 profile="domain",
378                 setting="inboundusernotification",
379                 value=current,
380                 store="local",
381             )
382             self.assertTrue(ret)
383     @pytest.mark.destructive_test
384     def test_set_firewall_settings_notification_local_notconfigured(self):
385         current = win_lgpo_netsh.get_settings(
386             profile="domain", section="settings", store="local"
387         )["InboundUserNotification"]
388         try:
389             self.assertRaises(
390                 CommandExecutionError,
391                 win_lgpo_netsh.set_settings,
392                 profile="domain",
393                 setting="inboundusernotification",
394                 value="notconfigured",
395                 store="local",
396             )
397         finally:
398             ret = win_lgpo_netsh.set_settings(
399                 profile="domain",
400                 setting="inboundusernotification",
401                 value=current,
402                 store="local",
403             )
404             self.assertTrue(ret)
405     def test_set_firewall_settings_notification_lgpo_notconfigured(self):
406         current = win_lgpo_netsh.get_settings(
407             profile="domain", section="settings", store="lgpo"
408         )["InboundUserNotification"]
409         try:
410             ret = win_lgpo_netsh.set_settings(
411                 profile="domain",
412                 setting="inboundusernotification",
413                 value="notconfigured",
414                 store="lgpo",
415             )
416             self.assertTrue(ret)
417             new = win_lgpo_netsh.get_settings(
418                 profile="domain", section="settings", store="lgpo"
419             )["InboundUserNotification"]
420             self.assertEqual("NotConfigured", new)
421         finally:
422             ret = win_lgpo_netsh.set_settings(
423                 profile="domain",
424                 setting="inboundusernotification",
425                 value=current,
426                 store="lgpo",
427             )
428             self.assertTrue(ret)
429     def test_set_firewall_settings_remotemgmt_local_enable(self):
430         current = win_lgpo_netsh.get_settings(
431             profile="domain", section="settings", store="local"
432         )["RemoteManagement"]
433         try:
434             ret = win_lgpo_netsh.set_settings(
435                 profile="domain",
436                 setting="remotemanagement",
437                 value="enable",
438                 store="local",
439             )
440             self.assertTrue(ret)
441             new = win_lgpo_netsh.get_settings(
442                 profile="domain", section="settings", store="local"
443             )["RemoteManagement"]
444             self.assertEqual("Enable", new)
445         finally:
446             ret = win_lgpo_netsh.set_settings(
447                 profile="domain",
448                 setting="remotemanagement",
449                 value=current,
450                 store="local",
451             )
452             self.assertTrue(ret)
453     def test_set_firewall_settings_unicast_local_disable(self):
454         current = win_lgpo_netsh.get_settings(
455             profile="domain", section="settings", store="local"
456         )["UnicastResponseToMulticast"]
457         try:
458             ret = win_lgpo_netsh.set_settings(
459                 profile="domain",
460                 setting="unicastresponsetomulticast",
461                 value="disable",
462                 store="local",
463             )
464             self.assertTrue(ret)
465             new = win_lgpo_netsh.get_settings(
466                 profile="domain", section="settings", store="local"
467             )["UnicastResponseToMulticast"]
468             self.assertEqual("Disable", new)
469         finally:
470             ret = win_lgpo_netsh.set_settings(
471                 profile="domain",
472                 setting="unicastresponsetomulticast",
473                 value=current,
474                 store="local",
475             )
476             self.assertTrue(ret)
477     @pytest.mark.destructive_test
478     def test_set_firewall_state_local_on(self):
479         current = win_lgpo_netsh.get_settings(
480             profile="domain", section="state", store="local"
481         )["State"]
482         try:
483             ret = win_lgpo_netsh.set_state(profile="domain", state="off", store="local")
484             self.assertTrue(ret)
485             new = win_lgpo_netsh.get_settings(
486                 profile="domain", section="state", store="local"
487             )["State"]
488             self.assertEqual("OFF", new)
489         finally:
490             ret = win_lgpo_netsh.set_state(
491                 profile="domain", state=current, store="local"
492             )
493             self.assertTrue(ret)
494     @pytest.mark.destructive_test
495     def test_set_firewall_state_local_notconfigured(self):
496         current = win_lgpo_netsh.get_settings(
497             profile="domain", section="state", store="local"
498         )["State"]
499         try:
500             self.assertRaises(
501                 CommandExecutionError,
502                 win_lgpo_netsh.set_state,
503                 profile="domain",
504                 state="notconfigured",
505                 store="local",
506             )
507         finally:
508             ret = win_lgpo_netsh.set_state(
509                 profile="domain", state=current, store="local"
510             )
511             self.assertTrue(ret)
512     @pytest.mark.destructive_test
513     def test_set_firewall_state_lgpo_notconfigured(self):
514         current = win_lgpo_netsh.get_settings(
515             profile="domain", section="state", store="local"
516         )["State"]
517         try:
518             ret = win_lgpo_netsh.set_state(
519                 profile="domain", state="notconfigured", store="lgpo"
520             )
521             self.assertTrue(ret)
522             new = win_lgpo_netsh.get_settings(
523                 profile="domain", section="state", store="lgpo"
524             )["State"]
525             self.assertEqual("NotConfigured", new)
526         finally:
527             ret = win_lgpo_netsh.set_state(
528                 profile="domain", state=current, store="lgpo"
529             )
530             self.assertTrue(ret)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_ipaddress.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import contextlib
2 import functools
3 import operator
4 import pickle
5 import re
6 import sys
7 import weakref
8 import pytest
9 from salt._compat import ipaddress
10 from tests.support.unit import TestCase, skipIf
11 @functools.total_ordering
12 class _LARGEST:
13     def __eq__(self, other):
14         return isinstance(other, _LARGEST)
15     def __lt__(self, other):
16         return False
17 LARGEST = _LARGEST()
18 @functools.total_ordering
19 class _SMALLEST:
20     def __eq__(self, other):
21         return isinstance(other, _SMALLEST)
22     def __gt__(self, other):
23         return False
24 SMALLEST = _SMALLEST()
25 class BaseTestCase(TestCase):
26     @property
27     def factory(self):
28         raise NotImplementedError
29     @contextlib.contextmanager
30     def assertCleanError(self, exc_type, details, *args):
31         if args:
32             details = details % args
33         cm = self.assertRaisesRegex(exc_type, details)
34         with cm as exc:
35             yield exc
36         if exc.exception.__context__ is not None:
37             self.assertTrue(exc.exception.__suppress_context__)
38     def assertAddressError(self, details, *args):
39         return self.assertCleanError(ipaddress.AddressValueError, details, *args)
40     def assertNetmaskError(self, details, *args):
41         return self.assertCleanError(ipaddress.NetmaskValueError, details, *args)
42     def assertInstancesEqual(self, lhs, rhs):
43         self.assertEqual(self.factory(lhs), self.factory(rhs))
44 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
45 class CommonTestMixin:
46     def test_empty_address(self):
47         with self.assertAddressError("Address cannot be empty"):
48             self.factory("")
49     def test_floats_rejected(self):
50         with self.assertAddressError(re.escape(repr("1.0"))):
51             self.factory(1.0)
52         self.assertRaises(TypeError, operator.index, self<font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.factory(1))
53         self.assertRaises(TypeError, hex, self.factory(1))
54         self.assertRaises(TypeError, bytes, self.factory(1))
55     def</b></font> pickle_test(self, addr):
56         for proto in range(pickle.HIGHEST_PROTOCOL + 1):
57             with self.subTest(proto=proto):
58                 x = self.factory(addr)
59                 y = pickle.loads(pickle.dumps(x, proto))
60                 self.assertEqual(y, x)
61 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
62 class CommonTestMixin_v4(CommonTestMixin):
63     def test_leading_zeros(self):
64         msg = r"Leading zeros are not permitted in '\d+'"
65         addresses = [
66             "000.000.000.000",
67             "192.168.000.001",
68             "016.016.016.016",
69             "192.168.000.001",
70             "001.000.008.016",
71             "01.2.3.40",
72             "1.02.3.40",
73             "1.2.03.40",
74             "1.2.3.040",
75         ]
76         for address in addresses:
77             with self.subTest(address=address):
78                 with self.assertAddressError(msg):
79                     self.factory(address)
80     def test_int(self):
81         self.assertInstancesEqual(0, "0.0.0.0")
82         self.assertInstancesEqual(3232235521, "192.168.0.1")
83     def test_packed(self):
84         self.assertInstancesEqual(bytes.fromhex("00000000"), "0.0.0.0")
85         self.assertInstancesEqual(bytes.fromhex("c0a80001"), "192.168.0.1")
86     def test_negative_ints_rejected(self):
87         msg = "-1 (&lt; 0) is not permitted as an IPv4 address"
88         with self.assertAddressError(re.escape(msg)):
89             self.factory(-1)
90     def test_large_ints_rejected(self):
91         msg = "%d (&gt;= 2**32) is not permitted as an IPv4 address"
92         with self.assertAddressError(re.escape(msg % 2 ** 32)):
93             self.factory(2 ** 32)
94     def test_bad_packed_length(self):
95         def assertBadLength(length):
96             addr = b"\0" * length
97             msg = "%r (len %d != 4) is not permitted as an IPv4 address"
98             with self.assertAddressError(re.escape(msg % (addr, length))):
99                 self.factory(addr)
100         assertBadLength(3)
101         assertBadLength(5)
102 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
103 class CommonTestMixin_v6(CommonTestMixin):
104     def test_leading_zeros(self):
105         self.assertInstancesEqual("0000::0000", "::")
106         self.assertInstancesEqual("000::c0a8:0001", "::c0a8:1")
107     def test_int(self):
108         self.assertInstancesEqual(0, "::")
109         self.assertInstancesEqual(3232235521, "::c0a8:1")
110     def test_packed(self):
111         addr = b"\0" * 12 + bytes.fromhex("00000000")
112         self.assertInstancesEqual(addr, "::")
113         addr = b"\0" * 12 + bytes.fromhex("c0a80001")
114         self.assertInstancesEqual(addr, "::c0a8:1")
115         addr = bytes.fromhex("c0a80001") + b"\0" * 12
116         self.assertInstancesEqual(addr, "c0a8:1::")
117     def test_negative_ints_rejected(self):
118         msg = "-1 (&lt; 0) is not permitted as an IPv6 address"
119         with self.assertAddressError(re.escape(msg)):
120             self.factory(-1)
121     def test_large_ints_rejected(self):
122         msg = "%d (&gt;= 2**128) is not permitted as an IPv6 address"
123         with self.assertAddressError(re.escape(msg % 2 ** 128)):
124             self.factory(2 ** 128)
125     def test_bad_packed_length(self):
126         def assertBadLength(length):
127             addr = b"\0" * length
128             msg = "%r (len %d != 16) is not permitted as an IPv6 address"
129             with self.assertAddressError(re.escape(msg % (addr, length))):
130                 self.factory(addr)
131                 self.factory(addr)
132         assertBadLength(15)
133         assertBadLength(17)
134     def test_blank_scope_id(self):
135         address = "::1%"
136         with self.assertAddressError('Invalid IPv6 address: "%r"', address):
137             self.factory(address)
138     def test_invalid_scope_id_with_percent(self):
139         address = "::1%scope%"
140         with self.assertAddressError('Invalid IPv6 address: "%r"', address):
141             self.factory(address)
142 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
143 class AddressTestCase_v4(BaseTestCase, CommonTestMixin_v4):
144     factory = ipaddress.IPv4Address
145     @pytest.mark.skipif(sys.version_info &lt; (3, 6), reason="Don't run on Py3.5")
146     def test_format(self):
147         v4 = ipaddress.IPv4Address("1.2.3.42")
148         v4_pairs = [
149             ("b", "00000001000000100000001100101010"),
150             ("n", "00000001000000100000001100101010"),
151             ("x", "0102032a"),
152             ("X", "0102032A"),
153             ("_b", "0000_0001_0000_0010_0000_0011_0010_1010"),
154             ("_n", "0000_0001_0000_0010_0000_0011_0010_1010"),
155             ("_x", "0102_032a"),
156             ("_X", "0102_032A"),
157             ("#b", "0b00000001000000100000001100101010"),
158             ("#n", "0b00000001000000100000001100101010"),
159             ("#x", "0x0102032a"),
160             ("#X", "0X0102032A"),
161             ("#_b", "0b0000_0001_0000_0010_0000_0011_0010_1010"),
162             ("#_n", "0b0000_0001_0000_0010_0000_0011_0010_1010"),
163             ("#_x", "0x0102_032a"),
164             ("#_X", "0X0102_032A"),
165             ("s", "1.2.3.42"),
166             ("", "1.2.3.42"),
167         ]
168         for (fmt, txt) in v4_pairs:
169             self.assertEqual(txt, format(v4, fmt))
170     def test_network_passed_as_address(self):
171         addr = "127.0.0.1/24"
172         with self.assertAddressError("Unexpected '/' in %r", addr):
173             ipaddress.IPv4Address(addr)
174     def test_bad_address_split(self):
175         def assertBadSplit(addr):
176             with self.assertAddressError("Expected 4 octets in %r", addr):
177                 ipaddress.IPv4Address(addr)
178         assertBadSplit("127.0.1")
179         assertBadSplit("42.42.42.42.42")
180         assertBadSplit("42.42.42")
181         assertBadSplit("42.42")
182         assertBadSplit("42")
183         assertBadSplit("42..42.42.42")
184         assertBadSplit("42.42.42.42.")
185         assertBadSplit("42.42.42.42...")
186         assertBadSplit(".42.42.42.42")
187         assertBadSplit("...42.42.42.42")
188         assertBadSplit("016.016.016")
189         assertBadSplit("016.016")
190         assertBadSplit("016")
191         assertBadSplit("000")
192         assertBadSplit("0x0a.0x0a.0x0a")
193         assertBadSplit("0x0a.0x0a")
194         assertBadSplit("0x0a")
195         assertBadSplit(".")
196         assertBadSplit("bogus")
197         assertBadSplit("bogus.com")
198         assertBadSplit("1000")
199         assertBadSplit("1000000000000000")
200         assertBadSplit("192.168.0.1.com")
201     def test_empty_octet(self):
202         def assertBadOctet(addr):
203             with self.assertAddressError("Empty octet not permitted in %r", addr):
204                 ipaddress.IPv4Address(addr)
205         assertBadOctet("42..42.42")
206         assertBadOctet("...")
207     def test_invalid_characters(self):
208         def assertBadOctet(addr, octet):
209             msg = "Only decimal digits permitted in {!r} in {!r}".format(octet, addr)
210             with self.assertAddressError(re.escape(msg)):
211                 ipaddress.IPv4Address(addr)
212         assertBadOctet("0x0a.0x0a.0x0a.0x0a", "0x0a")
213         assertBadOctet("0xa.0x0a.0x0a.0x0a", "0xa")
214         assertBadOctet("42.42.42.-0", "-0")
215         assertBadOctet("42.42.42.+0", "+0")
216         assertBadOctet("42.42.42.-42", "-42")
217         assertBadOctet("+1.+2.+3.4", "+1")
218         assertBadOctet("1.2.3.4e0", "4e0")
219         assertBadOctet("1.2.3.4::", "4::")
220         assertBadOctet("1.a.2.3", "a")
221     def test_octet_length(self):
222         def assertBadOctet(addr, octet):
223             msg = "At most 3 characters permitted in %r in %r"
224             with self.assertAddressError(re.escape(msg % (octet, addr))):
225                 ipaddress.IPv4Address(addr)
226         assertBadOctet("0000.000.000.000", "0000")
227         assertBadOctet("12345.67899.-54321.-98765", "12345")
228     def test_octet_limit(self):
229         def assertBadOctet(addr, octet):
230             msg = "Octet %d (&gt; 255) not permitted in %r" % (octet, addr)
231             with self.assertAddressError(re.escape(msg)):
232                 ipaddress.IPv4Address(addr)
233         assertBadOctet("257.0.0.0", 257)
234         assertBadOctet("192.168.0.999", 999)
235     def test_pickle(self):
236         self.pickle_test("192.0.2.1")
237     def test_weakref(self):
238         weakref.ref(self.factory("192.0.2.1"))
239 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
240 class AddressTestCase_v6(BaseTestCase, CommonTestMixin_v6):
241     factory = ipaddress.IPv6Address
242     @pytest.mark.skipif(sys.version_info &lt; (3, 6), reason="Don't run on Py3.5")
243     def test_format(self):
244         v6 = ipaddress.IPv6Address("::1.2.3.42")
245         v6_pairs = [
246             (
247                 "b",
248                 "000000000000000000000000000000000000000000000000000000"
249                 "000000000000000000000000000000000000000000000000010000"
250                 "00100000001100101010",
251             ),
252             ("n", "0000000000000000000000000102032a"),
253             ("x", "0000000000000000000000000102032a"),
254             ("X", "0000000000000000000000000102032A"),
255             (
256                 "_b",
257                 "0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
258                 "_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
259                 "_0000_0000_0000_0000_0001_0000_0010_0000_0011_0010"
260                 "_1010",
261             ),
262             ("_n", "0000_0000_0000_0000_0000_0000_0102_032a"),
263             ("_x", "0000_0000_0000_0000_0000_0000_0102_032a"),
264             ("_X", "0000_0000_0000_0000_0000_0000_0102_032A"),
265             (
266                 "#b",
267                 "0b0000000000000000000000000000000000000000000000000000"
268                 "000000000000000000000000000000000000000000000000000100"
269                 "0000100000001100101010",
270             ),
271             ("#n", "0x0000000000000000000000000102032a"),
272             ("#x", "0x0000000000000000000000000102032a"),
273             ("#X", "0X0000000000000000000000000102032A"),
274             (
275                 "#_b",
276                 "0b0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
277                 "_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
278                 "_0000_0000_0000_0000_0000_0001_0000_0010_0000_0011"
279                 "_0010_1010",
280             ),
281             ("#_n", "0x0000_0000_0000_0000_0000_0000_0102_032a"),
282             ("#_x", "0x0000_0000_0000_0000_0000_0000_0102_032a"),
283             ("#_X", "0X0000_0000_0000_0000_0000_0000_0102_032A"),
284             ("s", "::102:32a"),
285             ("", "::102:32a"),
286         ]
287         for (fmt, txt) in v6_pairs:
288             self.assertEqual(txt, format(v6, fmt))
289     def test_network_passed_as_address(self):
290         def assertBadSplit(addr):
291             msg = "Unexpected '/' in %r"
292             with self.assertAddressError(msg, addr):
293                 ipaddress.IPv6Address(addr)
294         assertBadSplit("::1/24")
295         assertBadSplit("::1%scope_id/24")
296     def test_bad_address_split_v6_not_enough_parts(self):
297         def assertBadSplit(addr):
298             msg = "At least 3 parts expected in %r"
299             with self.assertAddressError(msg, addr.split("%")[0]):
300                 ipaddress.IPv6Address(addr)
301         assertBadSplit(":")
302         assertBadSplit(":1")
303         assertBadSplit("FEDC:9878")
304         assertBadSplit(":%scope")
305         assertBadSplit(":1%scope")
306         assertBadSplit("FEDC:9878%scope")
307     def test_bad_address_split_v6_too_many_colons(self):
308         def assertBadSplit(addr):
309             msg = "At most 8 colons permitted in %r"
310             with self.assertAddressError(msg, addr.split("%")[0]):
311                 ipaddress.IPv6Address(addr)
312         assertBadSplit("9:8:7:6:5:4:3::2:1")
313         assertBadSplit("10:9:8:7:6:5:4:3:2:1")
314         assertBadSplit("::8:7:6:5:4:3:2:1")
315         assertBadSplit("8:7:6:5:4:3:2:1::")
316         assertBadSplit("10:9:8:7:6:5:4:3:42.42.42.42")
317         assertBadSplit("9:8:7:6:5:4:3::2:1%scope")
318         assertBadSplit("10:9:8:7:6:5:4:3:2:1%scope")
319         assertBadSplit("::8:7:6:5:4:3:2:1%scope")
320         assertBadSplit("8:7:6:5:4:3:2:1::%scope")
321         assertBadSplit("10:9:8:7:6:5:4:3:42.42.42.42%scope")
322     def test_bad_address_split_v6_too_many_parts(self):
323         def assertBadSplit(addr):
324             msg = "Exactly 8 parts expected without '::' in %r"
325             with self.assertAddressError(msg, addr.split("%")[0]):
326                 ipaddress.IPv6Address(addr)
327         assertBadSplit("3ffe:0:0:0:0:0:0:0:1")
328         assertBadSplit("9:8:7:6:5:4:3:2:1")
329         assertBadSplit("7:6:5:4:3:2:1")
330         assertBadSplit("9:8:7:6:5:4:3:42.42.42.42")
331         assertBadSplit("7:6:5:4:3:42.42.42.42")
332         assertBadSplit("3ffe:0:0:0:0:0:0:0:1%scope")
333         assertBadSplit("9:8:7:6:5:4:3:2:1%scope")
334         assertBadSplit("7:6:5:4:3:2:1%scope")
335         assertBadSplit("9:8:7:6:5:4:3:42.42.42.42%scope")
336         assertBadSplit("7:6:5:4:3:42.42.42.42%scope")
337     def test_bad_address_split_v6_too_many_parts_with_double_colon(self):
338         def assertBadSplit(addr):
339             msg = "Expected at most 7 other parts with '::' in %r"
340             with self.assertAddressError(msg, addr.split("%")[0]):
341                 ipaddress.IPv6Address(addr)
342         assertBadSplit("1:2:3:4::5:6:7:8")
343         assertBadSplit("1:2:3:4::5:6:7:8%scope")
344     def test_bad_address_split_v6_repeated_double_colon(self):
345         def assertBadSplit(addr):
346             msg = "At most one '::' permitted in %r"
347             with self.assertAddressError(msg, addr.split("%")[0]):
348                 ipaddress.IPv6Address(addr)
349         assertBadSplit("3ffe::1::1")
350         assertBadSplit("1::2::3::4:5")
351         assertBadSplit("2001::db:::1")
352         assertBadSplit("3ffe::1::")
353         assertBadSplit("::3ffe::1")
354         assertBadSplit(":3ffe::1::1")
355         assertBadSplit("3ffe::1::1:")
356         assertBadSplit(":3ffe::1::1:")
357         assertBadSplit(":::")
358         assertBadSplit("2001:db8:::1")
359         assertBadSplit("3ffe::1::1%scope")
360         assertBadSplit("1::2::3::4:5%scope")
361         assertBadSplit("2001::db:::1%scope")
362         assertBadSplit("3ffe::1::%scope")
363         assertBadSplit("::3ffe::1%scope")
364         assertBadSplit(":3ffe::1::1%scope")
365         assertBadSplit("3ffe::1::1:%scope")
366         assertBadSplit(":3ffe::1::1:%scope")
367         assertBadSplit(":::%scope")
368         assertBadSplit("2001:db8:::1%scope")
369     def test_bad_address_split_v6_leading_colon(self):
370         def assertBadSplit(addr):
371             msg = "Leading ':' only permitted as part of '::' in %r"
372             with self.assertAddressError(msg, addr.split("%")[0]):
373                 ipaddress.IPv6Address(addr)
374         assertBadSplit(":2001:db8::1")
375         assertBadSplit(":1:2:3:4:5:6:7")
376         assertBadSplit(":1:2:3:4:5:6:")
377         assertBadSplit(":6:5:4:3:2:1::")
378         assertBadSplit(":2001:db8::1%scope")
379         assertBadSplit(":1:2:3:4:5:6:7%scope")
380         assertBadSplit(":1:2:3:4:5:6:%scope")
381         assertBadSplit(":6:5:4:3:2:1::%scope")
382     def test_bad_address_split_v6_trailing_colon(self):
383         def assertBadSplit(addr):
384             msg = "Trailing ':' only permitted as part of '::' in %r"
385             with self.assertAddressError(msg, addr.split("%")[0]):
386                 ipaddress.IPv6Address(addr)
387         assertBadSplit("2001:db8::1:")
388         assertBadSplit("1:2:3:4:5:6:7:")
389         assertBadSplit("::1.2.3.4:")
390         assertBadSplit("::7:6:5:4:3:2:")
391         assertBadSplit("2001:db8::1:%scope")
392         assertBadSplit("1:2:3:4:5:6:7:%scope")
393         assertBadSplit("::1.2.3.4:%scope")
394         assertBadSplit("::7:6:5:4:3:2:%scope")
395     def test_bad_v4_part_in(self):
396         def assertBadAddressPart(addr, v4_error):
397             with self.assertAddressError("%s in %r", v4_error, addr.split("%")[0]):
398                 ipaddress.IPv6Address(addr)
399         assertBadAddressPart("3ffe::1.net", "Expected 4 octets in '1.net'")
400         assertBadAddressPart("3ffe::127.0.1", "Expected 4 octets in '127.0.1'")
401         assertBadAddressPart("::1.2.3", "Expected 4 octets in '1.2.3'")
402         assertBadAddressPart("::1.2.3.4.5", "Expected 4 octets in '1.2.3.4.5'")
403         assertBadAddressPart(
404             "3ffe::1.1.1.net",
405             "Only decimal digits permitted in 'net' in '1.1.1.net'",
406         )
407         assertBadAddressPart("3ffe::1.net%scope", "Expected 4 octets in '1.net'")
408         assertBadAddressPart("3ffe::127.0.1%scope", "Expected 4 octets in '127.0.1'")
409         assertBadAddressPart("::1.2.3%scope", "Expected 4 octets in '1.2.3'")
410         assertBadAddressPart("::1.2.3.4.5%scope", "Expected 4 octets in '1.2.3.4.5'")
411         assertBadAddressPart(
412             "3ffe::1.1.1.net%scope",
413             "Only decimal digits permitted in 'net' in '1.1.1.net'",
414         )
415     def test_invalid_characters(self):
416         def assertBadPart(addr, part):
417             msg = "Only hex digits permitted in {!r} in {!r}".format(
418                 part, addr.split("%")[0]
419             )
420             with self.assertAddressError(re.escape(msg)):
421                 ipaddress.IPv6Address(addr)
422         assertBadPart("3ffe::goog", "goog")
423         assertBadPart("3ffe::-0", "-0")
424         assertBadPart("3ffe::+0", "+0")
425         assertBadPart("3ffe::-1", "-1")
426         assertBadPart("1.2.3.4::", "1.2.3.4")
427         assertBadPart("1234:axy::b", "axy")
428         assertBadPart("3ffe::goog%scope", "goog")
429         assertBadPart("3ffe::-0%scope", "-0")
430         assertBadPart("3ffe::+0%scope", "+0")
431         assertBadPart("3ffe::-1%scope", "-1")
432         assertBadPart("1.2.3.4::%scope", "1.2.3.4")
433         assertBadPart("1234:axy::b%scope", "axy")
434     def test_part_length(self):
435         def assertBadPart(addr, part):
436             msg = "At most 4 characters permitted in %r in %r"
437             with self.assertAddressError(msg, part, addr.split("%")[0]):
438                 ipaddress.IPv6Address(addr)
439         assertBadPart("::00000", "00000")
440         assertBadPart("3ffe::10000", "10000")
441         assertBadPart("02001:db8::", "02001")
442         assertBadPart("2001:888888::1", "888888")
443         assertBadPart("::00000%scope", "00000")
444         assertBadPart("3ffe::10000%scope", "10000")
445         assertBadPart("02001:db8::%scope", "02001")
446         assertBadPart("2001:888888::1%scope", "888888")
447     def test_pickle(self):
448         self.pickle_test("2001:db8::")
449     def test_weakref(self):
450         weakref.ref(self.factory("2001:db8::"))
451         weakref.ref(self.factory("2001:db8::%scope"))
452 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
453 class NetmaskTestMixin_v4(CommonTestMixin_v4):
454     def test_no_mask(self):
455         for address in ("1.2.3.4", 0x01020304, b"\x01\x02\x03\x04"):
456             net = self.factory(address)
457             self.assertEqual(str(net), "1.2.3.4/32")
458             self.assertEqual(str(net.netmask), "255.255.255.255")
459             self.assertEqual(str(net.hostmask), "0.0.0.0")
460     def test_split_netmask(self):
461         addr = "1.2.3.4/32/24"
462         with self.assertAddressError("Only one '/' permitted in %r" % addr):
463             self.factory(addr)
464     def test_address_errors(self):
465         def assertBadAddress(addr, details):
466             with self.assertAddressError(details):
467                 self.factory(addr)
468         assertBadAddress("/", "Address cannot be empty")
469         assertBadAddress("/8", "Address cannot be empty")
470         assertBadAddress("bogus", "Expected 4 octets")
471         assertBadAddress("google.com", "Expected 4 octets")
472         assertBadAddress("10/8", "Expected 4 octets")
473         assertBadAddress("::1.2.3.4", "Only decimal digits")
474         assertBadAddress("1.2.3.256", re.escape("256 (&gt; 255)"))
475     def test_valid_netmask(self):
476         self.assertEqual(str(self.factory("192.0.2.0/255.255.255.0")), "192.0.2.0/24")
477         for i in range(0, 33):
478             net_str = "0.0.0.0/%d" % i
479             net = self.factory(net_str)
480             self.assertEqual(str(net), net_str)
481             self.assertEqual(str(self.factory("0.0.0.0/%s" % net.netmask)), net_str)
482             self.assertEqual(str(self.factory("0.0.0.0/0%d" % i)), net_str)
483             if i in (32, 0):
484                 net_str = "0.0.0.0/%d" % (32 - i)
485             self.assertEqual(str(self.factory("0.0.0.0/%s" % net.hostmask)), net_str)
486     def test_netmask_errors(self):
487         def assertBadNetmask(addr, netmask):
488             msg = "%r is not a valid netmask" % netmask
489             with self.assertNetmaskError(re.escape(msg)):
490                 self.factory("{}/{}".format(addr, netmask))
491         assertBadNetmask("1.2.3.4", "")
492         assertBadNetmask("1.2.3.4", "-1")
493         assertBadNetmask("1.2.3.4", "+1")
494         assertBadNetmask("1.2.3.4", " 1 ")
495         assertBadNetmask("1.2.3.4", "0x1")
496         assertBadNetmask("1.2.3.4", "33")
497         assertBadNetmask("1.2.3.4", "254.254.255.256")
498         assertBadNetmask("1.2.3.4", "1.a.2.3")
499         assertBadNetmask("1.1.1.1", "254.xyz.2.3")
500         assertBadNetmask("1.1.1.1", "240.255.0.0")
501         assertBadNetmask("1.1.1.1", "255.254.128.0")
502         assertBadNetmask("1.1.1.1", "0.1.127.255")
503         assertBadNetmask("1.1.1.1", "pudding")
504         assertBadNetmask("1.1.1.1", "::")
505     def test_netmask_in_tuple_errors(self):
506         def assertBadNetmask(addr, netmask):
507             msg = "%r is not a valid netmask" % netmask
508             with self.assertNetmaskError(re.escape(msg)):
509                 self.factory((addr, netmask))
510         assertBadNetmask("1.1.1.1", -1)
511         assertBadNetmask("1.1.1.1", 33)
512     def test_pickle(self):
513         self.pickle_test("192.0.2.0/27")
514         self.pickle_test("192.0.2.0/31")  # IPV4LENGTH - 1
515         self.pickle_test("192.0.2.0")  # IPV4LENGTH
516 class InterfaceTestCase_v4(BaseTestCase, NetmaskTestMixin_v4):
517     factory = ipaddress.IPv4Interface
518 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
519 class NetworkTestCase_v4(BaseTestCase, NetmaskTestMixin_v4):
520     factory = ipaddress.IPv4Network
521     def test_subnet_of(self):
522         self.assertFalse(
523         )
524         self<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertTrue(
525             self.factory("10.0.0.0/30").subnet_of(self.factory("10.0.0.0/24"))
526         )
527         self.assertFalse(
528             self.factory("10.0.0.0/30").subnet_of(self.factory("10.0.1.0/24"))
529         )
530         self.assertFalse(
531             self.factory("10.0.1.0/24").subnet_of(self.factory("10.0.0.0/30"))
532         )
533     def</b></font> test_supernet_of(self):
534         self.assertFalse(
535             self.factory("10.0.0.0/30").supernet_of(self.factory("10.0.1.0/24"))
536         )
537         self.assertFalse(
538             self.factory("10.0.0.0/30").supernet_of(self.factory("10.0.0.0/24"))
539         )
540         self.assertFalse(
541             self.factory("10.0.0.0/30").supernet_of(self.factory("10.0.1.0/24"))
542         )
543         self.assertTrue(
544             self.factory("10.0.0.0/24").supernet_of(self.factory("10.0.0.0/30"))
545         )
546     def test_subnet_of_mixed_types(self):
547         with self.assertRaises(TypeError):
548             ipaddress.IPv4Network("10.0.0.0/30").supernet_of(
549                 ipaddress.IPv6Network("::1/128")
550             )
551         with self.assertRaises(TypeError):
552             ipaddress.IPv6Network("::1/128").supernet_of(
553                 ipaddress.IPv4Network("10.0.0.0/30")
554             )
555         with self.assertRaises(TypeError):
556             ipaddress.IPv4Network("10.0.0.0/30").subnet_of(
557                 ipaddress.IPv6Network("::1/128")
558             )
559         with self.assertRaises(TypeError):
560             ipaddress.IPv6Network("::1/128").subnet_of(
561                 ipaddress.IPv4Network("10.0.0.0/30")
562             )
563 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
564 class NetmaskTestMixin_v6(CommonTestMixin_v6):
565     def test_no_mask(self):
566         for address in ("::1", 1, b"\x00" * 15 + b"\x01"):
567             net = self.factory(address)
568             self.assertEqual(str(net), "::1/128")
569             self.assertEqual(
570                 str(net.netmask), "ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"
571             )
572             self.assertEqual(str(net.hostmask), "::")
573         scoped_net = self.factory("::1%scope")
574         self.assertEqual(str(scoped_net), "::1%scope/128")
575         self.assertEqual(
576             str(scoped_net.netmask), "ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"
577         )
578         self.assertEqual(str(scoped_net.hostmask), "::")
579     def test_split_netmask(self):
580         addr = "cafe:cafe::/128/190"
581         with self.assertAddressError("Only one '/' permitted in %r" % addr):
582             self.factory(addr)
583         scoped_addr = "cafe:cafe::%scope/128/190"
584         with self.assertAddressError("Only one '/' permitted in %r" % scoped_addr):
585             self.factory(scoped_addr)
586     def test_address_errors(self):
587         def assertBadAddress(addr, details):
588             with self.assertAddressError(details):
589                 self.factory(addr)
590         assertBadAddress("/", "Address cannot be empty")
591         assertBadAddress("/8", "Address cannot be empty")
592         assertBadAddress("google.com", "At least 3 parts")
593         assertBadAddress("1.2.3.4", "At least 3 parts")
594         assertBadAddress("10/8", "At least 3 parts")
595         assertBadAddress("1234:axy::b", "Only hex digits")
596         assertBadAddress("/%scope", "Address cannot be empty")
597         assertBadAddress("/%scope8", "Address cannot be empty")
598         assertBadAddress("google.com%scope", "At least 3 parts")
599         assertBadAddress("1.2.3.4%scope", "At least 3 parts")
600         assertBadAddress("10%scope/8", "At least 3 parts")
601         assertBadAddress("1234:axy::b%scope", "Only hex digits")
602     def test_valid_netmask(self):
603         self.assertEqual(str(self.factory("2001:db8::/32")), "2001:db8::/32")
604         for i in range(0, 129):
605             net_str = "::/%d" % i
606             self.assertEqual(str(self.factory(net_str)), net_str)
607             self.assertEqual(str(self.factory("::/0%d" % i)), net_str)
608         self.assertEqual(
609             str(self.factory("2001:db8::%scope/32")), "2001:db8::%scope/32"
610         )
611         for i in range(0, 129):
612             net_str = "::/%d" % i
613             self.assertEqual(str(self.factory(net_str)), net_str)
614             self.assertEqual(str(self.factory("::/0%d" % i)), net_str)
615     def test_netmask_errors(self):
616         def assertBadNetmask(addr, netmask):
617             msg = "%r is not a valid netmask" % netmask
618             with self.assertNetmaskError(re.escape(msg)):
619                 self.factory("{}/{}".format(addr, netmask))
620         assertBadNetmask("::1", "")
621         assertBadNetmask("::1", "::1")
622         assertBadNetmask("::1", "1::")
623         assertBadNetmask("::1", "-1")
624         assertBadNetmask("::1", "+1")
625         assertBadNetmask("::1", " 1 ")
626         assertBadNetmask("::1", "0x1")
627         assertBadNetmask("::1", "129")
628         assertBadNetmask("::1", "1.2.3.4")
629         assertBadNetmask("::1", "pudding")
630         assertBadNetmask("::", "::")
631         assertBadNetmask("::1%scope", "pudding")
632     def test_netmask_in_tuple_errors(self):
633         def assertBadNetmask(addr, netmask):
634             msg = "%r is not a valid netmask" % netmask
635             with self.assertNetmaskError(re.escape(msg)):
636                 self.factory((addr, netmask))
637         assertBadNetmask("::1", -1)
638         assertBadNetmask("::1", 129)
639         assertBadNetmask("::1%scope", 129)
640     def test_pickle(self):
641         self.pickle_test("2001:db8::1000/124")
642         self.pickle_test("2001:db8::1000/127")  # IPV6LENGTH - 1
643         self.pickle_test("2001:db8::1000")  # IPV6LENGTH
644         self.pickle_test("2001:db8::1000%scope")  # IPV6LENGTH
645 class InterfaceTestCase_v6(BaseTestCase, NetmaskTestMixin_v6):
646     factory = ipaddress.IPv6Interface
647 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
648 class NetworkTestCase_v6(BaseTestCase, NetmaskTestMixin_v6):
649     factory = ipaddress.IPv6Network
650     def test_subnet_of(self):
651         self.assertFalse(
652             self.factory("2000:999::/56").subnet_of(self.factory("2000:aaa::/48"))
653         )
654         self.assertTrue(
655             self.factory("2000:aaa::/56").subnet_of(self.factory("2000:aaa::/48"))
656         )
657         self.assertFalse(
658             self.factory("2000:bbb::/56").subnet_of(self.factory("2000:aaa::/48"))
659         )
660         self.assertFalse(
661             self.factory("2000:aaa::/48").subnet_of(self.factory("2000:aaa::/56"))
662         )
663         self.assertFalse(
664             self.factory("2000:999::%scope/56").subnet_of(
665                 self.factory("2000:aaa::%scope/48")
666             )
667         )
668         self.assertTrue(
669             self.factory("2000:aaa::%scope/56").subnet_of(
670                 self.factory("2000:aaa::%scope/48")
671             )
672         )
673     def test_supernet_of(self):
674         self.assertFalse(
675             self.factory("2000:999::/56").supernet_of(self.factory("2000:aaa::/48"))
676         )
677         self.assertFalse(
678             self.factory("2000:aaa::/56").supernet_of(self.factory("2000:aaa::/48"))
679         )
680         self.assertFalse(
681             self.factory("2000:bbb::/56").supernet_of(self.factory("2000:aaa::/48"))
682         )
683         self.assertTrue(
684             self.factory("2000:aaa::/48").supernet_of(self.factory("2000:aaa::/56"))
685         )
686 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
687 class FactoryFunctionErrors(BaseTestCase):
688     def assertFactoryError(self, factory, kind):
689         addr = "camelot"
690         msg = "%r does not appear to be an IPv4 or IPv6 %s"
691         with self.assertCleanError(ValueError, msg, addr, kind):
692             factory(addr)
693     def test_ip_address(self):
694         self.assertFactoryError(ipaddress.ip_address, "address")
695     def test_ip_interface(self):
696         self.assertFactoryError(ipaddress.ip_interface, "interface")
697     def test_ip_network(self):
698         self.assertFactoryError(ipaddress.ip_network, "network")
699 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
700 class ComparisonTests(TestCase):
701     v4addr = ipaddress.IPv4Address(1)
702     v4net = ipaddress.IPv4Network(1)
703     v4intf = ipaddress.IPv4Interface(1)
704     v6addr = ipaddress.IPv6Address(1)
705     v6net = ipaddress.IPv6Network(1)
706     v6intf = ipaddress.IPv6Interface(1)
707     v6addr_scoped = ipaddress.IPv6Address("::1%scope")
708     v6net_scoped = ipaddress.IPv6Network("::1%scope")
709     v6intf_scoped = ipaddress.IPv6Interface("::1%scope")
710     v4_addresses = [v4addr, v4intf]
711     v4_objects = v4_addresses + [v4net]
712     v6_addresses = [v6addr, v6intf]
713     v6_objects = v6_addresses + [v6net]
714     v6_scoped_addresses = [v6addr_scoped, v6intf_scoped]
715     v6_scoped_objects = v6_scoped_addresses + [v6net_scoped]
716     objects = v4_objects + v6_objects
717     objects_with_scoped = objects + v6_scoped_objects
718     v4addr2 = ipaddress.IPv4Address(2)
719     v4net2 = ipaddress.IPv4Network(2)
720     v4intf2 = ipaddress.IPv4Interface(2)
721     v6addr2 = ipaddress.IPv6Address(2)
722     v6net2 = ipaddress.IPv6Network(2)
723     v6intf2 = ipaddress.IPv6Interface(2)
724     v6addr2_scoped = ipaddress.IPv6Address("::2%scope")
725     v6net2_scoped = ipaddress.IPv6Network("::2%scope")
726     v6intf2_scoped = ipaddress.IPv6Interface("::2%scope")
727     def test_foreign_type_equality(self):
728         other = object()
729         for obj in self.objects_with_scoped:
730             self.assertNotEqual(obj, other)
731             self.assertFalse(obj == other)
732             self.assertEqual(obj.__eq__(other), NotImplemented)
733             self.assertEqual(obj.__ne__(other), NotImplemented)
734     def test_mixed_type_equality(self):
735         for lhs in self.objects:
736             for rhs in self.objects:
737                 if lhs is rhs:
738                     continue
739                 self.assertNotEqual(lhs, rhs)
740     def test_scoped_ipv6_equality(self):
741         for lhs, rhs in zip(self.v6_objects, self.v6_scoped_objects):
742             self.assertNotEqual(lhs, rhs)
743     def test_v4_with_v6_scoped_equality(self):
744         for lhs in self.v4_objects:
745             for rhs in self.v6_scoped_objects:
746                 self.assertNotEqual(lhs, rhs)
747     def test_same_type_equality(self):
748         for obj in self.objects_with_scoped:
749             self.assertEqual(obj, obj)
750             self.assertLessEqual(obj, obj)
751             self.assertGreaterEqual(obj, obj)
752     def test_same_type_ordering(self):
753         for lhs, rhs in (
754             (self.v4addr, self.v4addr2),
755             (self.v4net, self.v4net2),
756             (self.v4intf, self.v4intf2),
757             (self.v6addr, self.v6addr2),
758             (self.v6net, self.v6net2),
759             (self.v6intf, self.v6intf2),
760             (self.v6addr_scoped, self.v6addr2_scoped),
761             (self.v6net_scoped, self.v6net2_scoped),
762             (self.v6intf_scoped, self.v6intf2_scoped),
763         ):
764             self.assertNotEqual(lhs, rhs)
765             self.assertLess(lhs, rhs)
766             self.assertLessEqual(lhs, rhs)
767             self.assertGreater(rhs, lhs)
768             self.assertGreaterEqual(rhs, lhs)
769             self.assertFalse(lhs &gt; rhs)
770             self.assertFalse(rhs &lt; lhs)
771             self.assertFalse(lhs &gt;= rhs)
772             self.assertFalse(rhs &lt;= lhs)
773     def test_containment(self):
774         for obj in self.v4_addresses:
775             self.assertIn(obj, self.v4net)
776         for obj in self.v6_addresses + self.v6_scoped_addresses:
777             self.assertIn(obj, self.v6net)
778         for obj in self.v6_addresses + self.v6_scoped_addresses:
779             self.assertIn(obj, self.v6net_scoped)
780         for obj in self.v4_objects + [self.v6net, self.v6net_scoped]:
781             self.assertNotIn(obj, self.v6net)
782         for obj in self.v4_objects + [self.v6net, self.v6net_scoped]:
783             self.assertNotIn(obj, self.v6net_scoped)
784         for obj in self.v6_objects + self.v6_scoped_objects + [self.v4net]:
785             self.assertNotIn(obj, self.v4net)
786     def test_mixed_type_ordering(self):
787         for lhs in self.objects_with_scoped:
788             for rhs in self.objects_with_scoped:
789                 if isinstance(lhs, type(rhs)) or isinstance(rhs, type(lhs)):
790                     continue
791                 self.assertRaises(TypeError, lambda: lhs &lt; rhs)
792                 self.assertRaises(TypeError, lambda: lhs &gt; rhs)
793                 self.assertRaises(TypeError, lambda: lhs &lt;= rhs)
794                 self.assertRaises(TypeError, lambda: lhs &gt;= rhs)
795     def test_foreign_type_ordering(self):
796         other = object()
797         for obj in self.objects_with_scoped:
798             with self.assertRaises(TypeError):
799                 obj &lt; other
800             with self.assertRaises(TypeError):
801                 obj &gt; other
802             with self.assertRaises(TypeError):
803                 obj &lt;= other
804             with self.assertRaises(TypeError):
805                 obj &gt;= other
806             self.assertTrue(obj &lt; LARGEST)
807             self.assertFalse(obj &gt; LARGEST)
808             self.assertTrue(obj &lt;= LARGEST)
809             self.assertFalse(obj &gt;= LARGEST)
810             self.assertFalse(obj &lt; SMALLEST)
811             self.assertTrue(obj &gt; SMALLEST)
812             self.assertFalse(obj &lt;= SMALLEST)
813             self.assertTrue(obj &gt;= SMALLEST)
814     def test_mixed_type_key(self):
815         v4_ordered = [self.v4addr, self.v4net, self.v4intf]
816         v6_ordered = [self.v6addr, self.v6net, self.v6intf]
817         v6_scoped_ordered = [self.v6addr_scoped, self.v6net_scoped, self.v6intf_scoped]
818         self.assertEqual(
819             v4_ordered, sorted(self.v4_objects, key=ipaddress.get_mixed_type_key)
820         )
821         self.assertEqual(
822             v6_ordered, sorted(self.v6_objects, key=ipaddress.get_mixed_type_key)
823         )
824         self.assertEqual(
825             v6_scoped_ordered,
826             sorted(self.v6_scoped_objects, key=ipaddress.get_mixed_type_key),
827         )
828         self.assertEqual(
829             v4_ordered + v6_scoped_ordered,
830             sorted(
831                 self.v4_objects + self.v6_scoped_objects,
832                 key=ipaddress.get_mixed_type_key,
833             ),
834         )
835         self.assertEqual(NotImplemented, ipaddress.get_mixed_type_key(object))
836     def test_incompatible_versions(self):
837         v4addr = ipaddress.ip_address("1.1.1.1")
838         v4net = ipaddress.ip_network("1.1.1.1")
839         v6addr = ipaddress.ip_address("::1")
840         v6net = ipaddress.ip_network("::1")
841         v6addr_scoped = ipaddress.ip_address("::1%scope")
842         v6net_scoped = ipaddress.ip_network("::1%scope")
843         self.assertRaises(TypeError, v4addr.__lt__, v6addr)
844         self.assertRaises(TypeError, v4addr.__gt__, v6addr)
845         self.assertRaises(TypeError, v4net.__lt__, v6net)
846         self.assertRaises(TypeError, v4net.__gt__, v6net)
847         self.assertRaises(TypeError, v6addr.__lt__, v4addr)
848         self.assertRaises(TypeError, v6addr.__gt__, v4addr)
849         self.assertRaises(TypeError, v6net.__lt__, v4net)
850         self.assertRaises(TypeError, v6net.__gt__, v4net)
851         self.assertRaises(TypeError, v4addr.__lt__, v6addr_scoped)
852         self.assertRaises(TypeError, v4addr.__gt__, v6addr_scoped)
853         self.assertRaises(TypeError, v4net.__lt__, v6net_scoped)
854         self.assertRaises(TypeError, v4net.__gt__, v6net_scoped)
855         self.assertRaises(TypeError, v6addr_scoped.__lt__, v4addr)
856         self.assertRaises(TypeError, v6addr_scoped.__gt__, v4addr)
857         self.assertRaises(TypeError, v6net_scoped.__lt__, v4net)
858         self.assertRaises(TypeError, v6net_scoped.__gt__, v4net)
859 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
860 class IpaddrUnitTest(TestCase):
861     def setUp(self):
862         self.ipv4_address = ipaddress.IPv4Address("1.2.3.4")
863         self.ipv4_interface = ipaddress.IPv4Interface("1.2.3.4/24")
864         self.ipv4_network = ipaddress.IPv4Network("1.2.3.0/24")
865         self.ipv6_address = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1")
866         self.ipv6_interface = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1/64")
867         self.ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/64")
868         self.ipv6_scoped_address = ipaddress.IPv6Interface(
869             "2001:658:22a:cafe:200:0:0:1%scope"
870         )
871         self.ipv6_scoped_interface = ipaddress.IPv6Interface(
872             "2001:658:22a:cafe:200:0:0:1%scope/64"
873         )
874         self.ipv6_scoped_network = ipaddress.IPv6Network("2001:658:22a:cafe::%scope/64")
875     def testRepr(self):
876         self.assertEqual(
877             "IPv4Interface('1.2.3.4/32')", repr(ipaddress.IPv4Interface("1.2.3.4"))
878         )
879         self.assertEqual(
880             "IPv6Interface('::1/128')", repr(ipaddress.IPv6Interface("::1"))
881         )
882         self.assertEqual(
883             "IPv6Interface('::1%scope/128')", repr(ipaddress.IPv6Interface("::1%scope"))
884         )
885     def testIPv4Tuple(self):
886         ip = ipaddress.IPv4Address("192.0.2.1")
887         net = ipaddress.IPv4Network("192.0.2.1/32")
888         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", 32)), net)
889         self.assertEqual(ipaddress.IPv4Network((ip, 32)), net)
890         self.assertEqual(ipaddress.IPv4Network((3221225985, 32)), net)
891         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", "255.255.255.255")), net)
892         self.assertEqual(ipaddress.IPv4Network((ip, "255.255.255.255")), net)
893         self.assertEqual(ipaddress.IPv4Network((3221225985, "255.255.255.255")), net)
894         with self.assertRaises(ValueError):
895             ipaddress.IPv4Network(("192.0.2.1", 24))
896         with self.assertRaises(ValueError):
897             ipaddress.IPv4Network((ip, 24))
898         with self.assertRaises(ValueError):
899             ipaddress.IPv4Network((3221225985, 24))
900         with self.assertRaises(ValueError):
901             ipaddress.IPv4Network(("192.0.2.1", "255.255.255.0"))
902         with self.assertRaises(ValueError):
903             ipaddress.IPv4Network((ip, "255.255.255.0"))
904         with self.assertRaises(ValueError):
905             ipaddress.IPv4Network((3221225985, "255.255.255.0"))
906         net = ipaddress.IPv4Network("192.0.2.0/24")
907         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", 24), strict=False), net)
908         self.assertEqual(ipaddress.IPv4Network((ip, 24), strict=False), net)
909         self.assertEqual(ipaddress.IPv4Network((3221225985, 24), strict=False), net)
910         self.assertEqual(
911             ipaddress.IPv4Network(("192.0.2.1", "255.255.255.0"), strict=False), net
912         )
913         self.assertEqual(
914             ipaddress.IPv4Network((ip, "255.255.255.0"), strict=False), net
915         )
916         self.assertEqual(
917             ipaddress.IPv4Network((3221225985, "255.255.255.0"), strict=False), net
918         )
919         ip = ipaddress.IPv4Address("192.0.2.0")
920         net = ipaddress.IPv4Network("192.0.2.0/24")
921         self.assertEqual(ipaddress.IPv4Network(("192.0.2.0", "255.255.255.0")), net)
922         self.assertEqual(ipaddress.IPv4Network((ip, "255.255.255.0")), net)
923         self.assertEqual(ipaddress.IPv4Network((3221225984, "255.255.255.0")), net)
924         self.assertEqual(ipaddress.IPv4Network(("192.0.2.0", 24)), net)
925         self.assertEqual(ipaddress.IPv4Network((ip, 24)), net)
926         self.assertEqual(ipaddress.IPv4Network((3221225984, 24)), net)
927         self.assertEqual(
928             ipaddress.IPv4Interface(("192.0.2.1", 24)),
929             ipaddress.IPv4Interface("192.0.2.1/24"),
930         )
931         self.assertEqual(
932             ipaddress.IPv4Interface((3221225985, 24)),
933             ipaddress.IPv4Interface("192.0.2.1/24"),
934         )
935     def testIPv6Tuple(self):
936         ip = ipaddress.IPv6Address("2001:db8::")
937         net = ipaddress.IPv6Network("2001:db8::/128")
938         self.assertEqual(ipaddress.IPv6Network(("2001:db8::", "128")), net)
939         self.assertEqual(
940             ipaddress.IPv6Network((42540766411282592856903984951653826560, 128)), net
941         )
942         self.assertEqual(ipaddress.IPv6Network((ip, "128")), net)
943         ip = ipaddress.IPv6Address("2001:db8::")
944         net = ipaddress.IPv6Network("2001:db8::/96")
945         self.assertEqual(ipaddress.IPv6Network(("2001:db8::", "96")), net)
946         self.assertEqual(
947             ipaddress.IPv6Network((42540766411282592856903984951653826560, 96)), net
948         )
949         self.assertEqual(ipaddress.IPv6Network((ip, "96")), net)
950         ip_scoped = ipaddress.IPv6Address("2001:db8::%scope")
951         ip = ipaddress.IPv6Address("2001:db8::1")
952         with self.assertRaises(ValueError):
953             ipaddress.IPv6Network(("2001:db8::1", 96))
954         with self.assertRaises(ValueError):
955             ipaddress.IPv6Network((42540766411282592856903984951653826561, 96))
956         with self.assertRaises(ValueError):
957             ipaddress.IPv6Network((ip, 96))
958         net = ipaddress.IPv6Network("2001:db8::/96")
959         self.assertEqual(ipaddress.IPv6Network(("2001:db8::1", 96), strict=False), net)
960         self.assertEqual(
961             ipaddress.IPv6Network(
962                 (42540766411282592856903984951653826561, 96), strict=False
963             ),
964             net,
965         )
966         self.assertEqual(ipaddress.IPv6Network((ip, 96), strict=False), net)
967         self.assertEqual(
968             ipaddress.IPv6Interface(("2001:db8::1", "96")),
969             ipaddress.IPv6Interface("2001:db8::1/96"),
970         )
971         self.assertEqual(
972             ipaddress.IPv6Interface((42540766411282592856903984951653826561, "96")),
973             ipaddress.IPv6Interface("2001:db8::1/96"),
974         )
975         ip_scoped = ipaddress.IPv6Address("2001:db8::1%scope")
976         with self.assertRaises(ValueError):
977             ipaddress.IPv6Network(("2001:db8::1%scope", 96))
978         with self.assertRaises(ValueError):
979             ipaddress.IPv6Network((ip_scoped, 96))
980     def testAddressIntMath(self):
981         self.assertEqual(
982             ipaddress.IPv4Address("1.1.1.1") + 255, ipaddress.IPv4Address("1.1.2.0")
983         )
984         self.assertEqual(
985             ipaddress.IPv4Address("1.1.1.1") - 256, ipaddress.IPv4Address("1.1.0.1")
986         )
987         self.assertEqual(
988             ipaddress.IPv6Address("::1") + (2 ** 16 - 2),
989             ipaddress.IPv6Address("::ffff"),
990         )
991         self.assertEqual(
992             ipaddress.IPv6Address("::ffff") - (2 ** 16 - 2),
993             ipaddress.IPv6Address("::1"),
994         )
995         self.assertNotEqual(
996             ipaddress.IPv6Address("::1%scope") + (2 ** 16 - 2),
997             ipaddress.IPv6Address("::ffff%scope"),
998         )
999         self.assertNotEqual(
1000             ipaddress.IPv6Address("::ffff%scope") - (2 ** 16 - 2),
1001             ipaddress.IPv6Address("::1%scope"),
1002         )
1003     def testInvalidIntToBytes(self):
1004         self.assertRaises(ValueError, ipaddress.v4_int_to_packed, -1)
1005         self.assertRaises(
1006             ValueError, ipaddress.v4_int_to_packed, 2 ** ipaddress.IPV4LENGTH
1007         )
1008         self.assertRaises(ValueError, ipaddress.v6_int_to_packed, -1)
1009         self.assertRaises(
1010             ValueError, ipaddress.v6_int_to_packed, 2 ** ipaddress.IPV6LENGTH
1011         )
1012     def testInternals(self):
1013         ip1 = ipaddress.IPv4Address("10.10.10.10")
1014         ip2 = ipaddress.IPv4Address("10.10.10.11")
1015         ip3 = ipaddress.IPv4Address("10.10.10.12")
1016         self.assertEqual(list(ipaddress._find_address_range([ip1])), [(ip1, ip1)])
1017         self.assertEqual(
1018             list(ipaddress._find_address_range([ip1, ip3])), [(ip1, ip1), (ip3, ip3)]
1019         )
1020         self.assertEqual(
1021             list(ipaddress._find_address_range([ip1, ip2, ip3])), [(ip1, ip3)]
1022         )
1023         self.assertEqual(128, ipaddress._count_righthand_zero_bits(0, 128))
1024         self.assertEqual("IPv4Network('1.2.3.0/24')", repr(self.ipv4_network))
1025     def testGetNetwork(self):
1026         self.assertEqual(int(self.ipv4_network.network_address), 16909056)
1027         self.assertEqual(str(self.ipv4_network.network_address), "1.2.3.0")
1028         self.assertEqual(
1029             int(self.ipv6_network.network_address),
1030             42540616829182469433403647294022090752,
1031         )
1032         self.assertEqual(str(self.ipv6_network.network_address), "2001:658:22a:cafe::")
1033         self.assertEqual(str(self.ipv6_network.hostmask), "::ffff:ffff:ffff:ffff")
1034         self.assertEqual(
1035             int(self.ipv6_scoped_network.network_address),
1036             42540616829182469433403647294022090752,
1037         )
1038         self.assertEqual(
1039             str(self.ipv6_scoped_network.network_address), "2001:658:22a:cafe::%scope"
1040         )
1041         self.assertEqual(
1042             str(self.ipv6_scoped_network.hostmask), "::ffff:ffff:ffff:ffff"
1043         )
1044     def testIpFromInt(self):
1045         self.assertEqual(self.ipv4_interface._ip, ipaddress.IPv4Interface(16909060)._ip)
1046         ipv4 = ipaddress.ip_network("1.2.3.4")
1047         ipv6 = ipaddress.ip_network("2001:658:22a:cafe:200:0:0:1")
1048         ipv6_scoped = ipaddress.ip_network("2001:658:22a:cafe:200:0:0:1%scope")
1049         self.assertEqual(ipv4, ipaddress.ip_network(int(ipv4.network_address)))
1050         self.assertEqual(ipv6, ipaddress.ip_network(int(ipv6.network_address)))
1051         self.assertNotEqual(
1052             ipv6_scoped, ipaddress.ip_network(int(ipv6_scoped.network_address))
1053         )
1054         v6_int = 42540616829182469433547762482097946625
1055         self.assertEqual(self.ipv6_interface._ip, ipaddress.IPv6Interface(v6_int)._ip)
1056         self.assertEqual(
1057             self.ipv6_scoped_interface._ip, ipaddress.IPv6Interface(v6_int)._ip
1058         )
1059         self.assertEqual(ipaddress.ip_network(self.ipv4_address._ip).version, 4)
1060         self.assertEqual(ipaddress.ip_network(self.ipv6_address._ip).version, 6)
1061         self.assertEqual(ipaddress.ip_network(self.ipv6_scoped_address._ip).version, 6)
1062     def testIpFromPacked(self):
1063         address = ipaddress.ip_address
1064         self.assertEqual(
1065             self.ipv4_interface._ip, ipaddress.ip_interface(b"\x01\x02\x03\x04")._ip
1066         )
1067         self.assertEqual(address("255.254.253.252"), address(b"\xff\xfe\xfd\xfc"))
1068         self.assertEqual(
1069             self.ipv6_interface.ip,
1070             ipaddress.ip_interface(
1071                 b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01"
1072             ).ip,
1073         )
1074         self.assertEqual(
1075             address("ffff:2:3:4:ffff::"),
1076             address(b"\xff\xff\x00\x02\x00\x03\x00\x04" + b"\xff\xff" + b"\x00" * 6),
1077         )
1078         self.assertEqual(address("::"), address(b"\x00" * 16))
1079     def testGetIp(self):
1080         self.assertEqual(int(self.ipv4_interface.ip), 16909060)
1081         self.assertEqual(str(self.ipv4_interface.ip), "1.2.3.4")
1082         self.assertEqual(
1083             int(self.ipv6_interface.ip), 42540616829182469433547762482097946625
1084         )
1085         self.assertEqual(str(self.ipv6_interface.ip), "2001:658:22a:cafe:200::1")
1086         self.assertEqual(
1087             int(self.ipv6_scoped_interface.ip), 42540616829182469433547762482097946625
1088         )
1089         self.assertEqual(str(self.ipv6_scoped_interface.ip), "2001:658:22a:cafe:200::1")
1090     def testGetScopeId(self):
1091         self.assertEqual(self.ipv6_address.scope_id, None)
1092         self.assertEqual(str(self.ipv6_scoped_address.scope_id), "scope")
1093         self.assertEqual(self.ipv6_interface.scope_id, None)
1094         self.assertEqual(str(self.ipv6_scoped_interface.scope_id), "scope")
1095         self.assertEqual(self.ipv6_network.network_address.scope_id, None)
1096         self.assertEqual(
1097             str(self.ipv6_scoped_network.network_address.scope_id), "scope"
1098         )
1099     def testGetNetmask(self):
1100         self.assertEqual(int(self.ipv4_network.netmask), 4294967040)
1101         self.assertEqual(str(self.ipv4_network.netmask), "255.255.255.0")
1102         self.assertEqual(
1103             int(self.ipv6_network.netmask), 340282366920938463444927863358058659840
1104         )
1105         self.assertEqual(self.ipv6_network.prefixlen, 64)
1106         self.assertEqual(
1107             int(self.ipv6_scoped_network.netmask),
1108             340282366920938463444927863358058659840,
1109         )
1110         self.assertEqual(self.ipv6_scoped_network.prefixlen, 64)
1111     def testZeroNetmask(self):
1112         ipv4_zero_netmask = ipaddress.IPv4Interface("1.2.3.4/0")
1113         self.assertEqual(int(ipv4_zero_netmask.network.netmask), 0)
1114         self.assertEqual(ipv4_zero_netmask._prefix_from_prefix_string("0"), 0)
1115         ipv6_zero_netmask = ipaddress.IPv6Interface("::1/0")
1116         self.assertEqual(int(ipv6_zero_netmask.network.netmask), 0)
1117         self.assertEqual(ipv6_zero_netmask._prefix_from_prefix_string("0"), 0)
1118         ipv6_scoped_zero_netmask = ipaddress.IPv6Interface("::1%scope/0")
1119         self.assertEqual(int(ipv6_scoped_zero_netmask.network.netmask), 0)
1120         self.assertEqual(ipv6_scoped_zero_netmask._prefix_from_prefix_string("0"), 0)
1121     def testIPv4Net(self):
1122         net = ipaddress.IPv4Network("127.0.0.0/0.0.0.255")
1123         self.assertEqual(net.prefixlen, 24)
1124     def testGetBroadcast(self):
1125         self.assertEqual(int(self.ipv4_network.broadcast_address), 16909311)
1126         self.assertEqual(str(self.ipv4_network.broadcast_address), "1.2.3.255")
1127         self.assertEqual(
1128             int(self.ipv6_network.broadcast_address),
1129             42540616829182469451850391367731642367,
1130         )
1131         self.assertEqual(
1132             str(self.ipv6_network.broadcast_address),
1133             "2001:658:22a:cafe:ffff:ffff:ffff:ffff",
1134         )
1135         self.assertEqual(
1136             int(self.ipv6_scoped_network.broadcast_address),
1137             42540616829182469451850391367731642367,
1138         )
1139         self.assertEqual(
1140             str(self.ipv6_scoped_network.broadcast_address),
1141             "2001:658:22a:cafe:ffff:ffff:ffff:ffff",
1142         )
1143     def testGetPrefixlen(self):
1144         self.assertEqual(self.ipv4_interface.network.prefixlen, 24)
1145         self.assertEqual(self.ipv6_interface.network.prefixlen, 64)
1146         self.assertEqual(self.ipv6_scoped_interface.network.prefixlen, 64)
1147     def testGetSupernet(self):
1148         self.assertEqual(self.ipv4_network.supernet().prefixlen, 23)
1149         self.assertEqual(str(self.ipv4_network.supernet().network_address), "1.2.2.0")
1150         self.assertEqual(
1151             ipaddress.IPv4Interface("0.0.0.0/0").network.supernet(),
1152             ipaddress.IPv4Network("0.0.0.0/0"),
1153         )
1154         self.assertEqual(self.ipv6_network.supernet().prefixlen, 63)
1155         self.assertEqual(
1156             str(self.ipv6_network.supernet().network_address), "2001:658:22a:cafe::"
1157         )
1158         self.assertEqual(
1159             ipaddress.IPv6Interface("::0/0").network.supernet(),
1160             ipaddress.IPv6Network("::0/0"),
1161         )
1162         self.assertEqual(self.ipv6_scoped_network.supernet().prefixlen, 63)
1163         self.assertEqual(
1164             str(self.ipv6_scoped_network.supernet().network_address),
1165             "2001:658:22a:cafe::",
1166         )
1167     def testGetSupernet3(self):
1168         self.assertEqual(self.ipv4_network.supernet(3).prefixlen, 21)
1169         self.assertEqual(str(self.ipv4_network.supernet(3).network_address), "1.2.0.0")
1170         self.assertEqual(self.ipv6_network.supernet(3).prefixlen, 61)
1171         self.assertEqual(
1172             str(self.ipv6_network.supernet(3).network_address), "2001:658:22a:caf8::"
1173         )
1174         self.assertEqual(self.ipv6_scoped_network.supernet(3).prefixlen, 61)
1175         self.assertEqual(
1176             str(self.ipv6_scoped_network.supernet(3).network_address),
1177             "2001:658:22a:caf8::",
1178         )
1179     def testGetSupernet4(self):
1180         self.assertRaises(
1181             ValueError, self.ipv4_network.supernet, prefixlen_diff=2, new_prefix=1
1182         )
1183         self.assertRaises(ValueError, self.ipv4_network.supernet, new_prefix=25)
1184         self.assertEqual(
1185             self.ipv4_network.supernet(prefixlen_diff=2),
1186             self.ipv4_network.supernet(new_prefix=22),
1187         )
1188         self.assertRaises(
1189             ValueError, self.ipv6_network.supernet, prefixlen_diff=2, new_prefix=1
1190         )
1191         self.assertRaises(ValueError, self.ipv6_network.supernet, new_prefix=65)
1192         self.assertEqual(
1193             self.ipv6_network.supernet(prefixlen_diff=2),
1194             self.ipv6_network.supernet(new_prefix=62),
1195         )
1196         self.assertRaises(
1197             ValueError,
1198             self.ipv6_scoped_network.supernet,
1199             prefixlen_diff=2,
1200             new_prefix=1,
1201         )
1202         self.assertRaises(ValueError, self.ipv6_scoped_network.supernet, new_prefix=65)
1203         self.assertEqual(
1204             self.ipv6_scoped_network.supernet(prefixlen_diff=2),
1205             self.ipv6_scoped_network.supernet(new_prefix=62),
1206         )
1207     def testHosts(self):
1208         hosts = list(self.ipv4_network.hosts())
1209         self.assertEqual(254, len(hosts))
1210         self.assertEqual(ipaddress.IPv4Address("1.2.3.1"), hosts[0])
1211         self.assertEqual(ipaddress.IPv4Address("1.2.3.254"), hosts[-1])
1212         ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/120")
1213         hosts = list(ipv6_network.hosts())
1214         self.assertEqual(255, len(hosts))
1215         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::1"), hosts[0])
1216         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::ff"), hosts[-1])
1217         ipv6_scoped_network = ipaddress.IPv6Network("2001:658:22a:cafe::%scope/120")
1218         hosts = list(ipv6_scoped_network.hosts())
1219         self.assertEqual(255, len(hosts))
1220         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::1"), hosts[0])
1221         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::ff"), hosts[-1])
1222         addrs = [ipaddress.IPv4Address("2.0.0.0"), ipaddress.IPv4Address("2.0.0.1")]
1223         str_args = "2.0.0.0/31"
1224         tpl_args = ("2.0.0.0", 31)
1225         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1226         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1227         self.assertEqual(
1228             list(ipaddress.ip_network(str_args).hosts()),
1229             list(ipaddress.ip_network(tpl_args).hosts()),
1230         )
1231         addrs = [ipaddress.IPv4Address("1.2.3.4")]
1232         str_args = "1.2.3.4/32"
1233         tpl_args = ("1.2.3.4", 32)
1234         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1235         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1236         self.assertEqual(
1237             list(ipaddress.ip_network(str_args).hosts()),
1238             list(ipaddress.ip_network(tpl_args).hosts()),
1239         )
1240         addrs = [
1241             ipaddress.IPv6Address("2001:658:22a:cafe::"),
1242             ipaddress.IPv6Address("2001:658:22a:cafe::1"),
1243         ]
1244         str_args = "2001:658:22a:cafe::/127"
1245         tpl_args = ("2001:658:22a:cafe::", 127)
1246         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1247         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1248         self.assertEqual(
1249             list(ipaddress.ip_network(str_args).hosts()),
1250             list(ipaddress.ip_network(tpl_args).hosts()),
1251         )
1252         addrs = [
1253             ipaddress.IPv6Address("2001:658:22a:cafe::1"),
1254         ]
1255         str_args = "2001:658:22a:cafe::1/128"
1256         tpl_args = ("2001:658:22a:cafe::1", 128)
1257         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1258         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1259         self.assertEqual(
1260             list(ipaddress.ip_network(str_args).hosts()),
1261             list(ipaddress.ip_network(tpl_args).hosts()),
1262         )
1263     def testFancySubnetting(self):
1264         self.assertEqual(
1265             sorted(self.ipv4_network.subnets(prefixlen_diff=3)),
1266             sorted(self.ipv4_network.subnets(new_prefix=27)),
1267         )
1268         self.assertRaises(ValueError, list, self.ipv4_network.subnets(new_prefix=23))
1269         self.assertRaises(
1270             ValueError, list, self.ipv4_network.subnets(prefixlen_diff=3, new_prefix=27)
1271         )
1272         self.assertEqual(
1273             sorted(self.ipv6_network.subnets(prefixlen_diff=4)),
1274             sorted(self.ipv6_network.subnets(new_prefix=68)),
1275         )
1276         self.assertRaises(ValueError, list, self.ipv6_network.subnets(new_prefix=63))
1277         self.assertRaises(
1278             ValueError, list, self.ipv6_network.subnets(prefixlen_diff=4, new_prefix=68)
1279         )
1280         self.assertEqual(
1281             sorted(self.ipv6_scoped_network.subnets(prefixlen_diff=4)),
1282             sorted(self.ipv6_scoped_network.subnets(new_prefix=68)),
1283         )
1284         self.assertRaises(
1285             ValueError, list, self.ipv6_scoped_network.subnets(new_prefix=63)
1286         )
1287         self.assertRaises(
1288             ValueError,
1289             list,
1290             self.ipv6_scoped_network.subnets(prefixlen_diff=4, new_prefix=68),
1291         )
1292     def testGetSubnets(self):
1293         self.assertEqual(list(self.ipv4_network.subnets())[0].prefixlen, 25)
1294         self.assertEqual(
1295             str(list(self.ipv4_network.subnets())[0].network_address), "1.2.3.0"
1296         )
1297         self.assertEqual(
1298             str(list(self.ipv4_network.subnets())[1].network_address), "1.2.3.128"
1299         )
1300         self.assertEqual(list(self.ipv6_network.subnets())[0].prefixlen, 65)
1301         self.assertEqual(list(self.ipv6_scoped_network.subnets())[0].prefixlen, 65)
1302         ip = ipaddress.IPv4Network("1.2.3.4/32")
1303         subnets1 = [str(x) for x in ip.subnets()]
1304         subnets2 = [str<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>(x) for x in ip.subnets(2)]
1305         self.assertEqual(subnets1, ["1.2.3.4/32"])
1306         self.assertEqual(subnets1, subnets2)
1307     def testGetSubnetForSingle128(self):
1308         ip = ipaddress.IPv6Network("::1/128")
1309         subnets1 =</b></font> [str(x) for x in ip.subnets()]
1310         subnets2 = [str(x) for x in ip.subnets(2)]
1311         self.assertEqual(subnets1, ["::1/128"])
1312         self.assertEqual(subnets1, subnets2)
1313         ip_scoped = ipaddress.IPv6Network("::1%scope/128")
1314         subnets1 = [str(x) for x in ip_scoped.subnets()]
1315         subnets2 = [str(x) for x in ip_scoped.subnets(2)]
1316         self.assertEqual(subnets1, ["::1%scope/128"])
1317         self.assertEqual(subnets1, subnets2)
1318     def testSubnet2(self):
1319         ips = [str(x) for x in self.ipv4_network.subnets(2)]
1320         self.assertEqual(
1321             ips, ["1.2.3.0/26", "1.2.3.64/26", "1.2.3.128/26", "1.2.3.192/26"]
1322         )
1323         ipsv6 = [str(x) for x in self.ipv6_network.subnets(2)]
1324         self.assertEqual(
1325             ipsv6,
1326             [
1327                 "2001:658:22a:cafe::/66",
1328                 "2001:658:22a:cafe:4000::/66",
1329                 "2001:658:22a:cafe:8000::/66",
1330                 "2001:658:22a:cafe:c000::/66",
1331             ],
1332         )
1333     def testGetSubnets3(self):
1334         subnets = [str(x) for x in self.ipv4_network.subnets(8)]
1335         self.assertEqual(subnets[:3], ["1.2.3.0/32", "1.2.3.1/32", "1.2.3.2/32"])
1336         self.assertEqual(subnets[-3:], ["1.2.3.253/32", "1.2.3.254/32", "1.2.3.255/32"])
1337         self.assertEqual(len(subnets), 256)
1338         ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/120")
1339         subnets = [str(x) for x in ipv6_network.subnets(8)]
1340         self.assertEqual(
1341             subnets[:3],
1342             [
1343                 "2001:658:22a:cafe::/128",
1344                 "2001:658:22a:cafe::1/128",
1345                 "2001:658:22a:cafe::2/128",
1346             ],
1347         )
1348         self.assertEqual(
1349             subnets[-3:],
1350             [
1351                 "2001:658:22a:cafe::fd/128",
1352                 "2001:658:22a:cafe::fe/128",
1353                 "2001:658:22a:cafe::ff/128",
1354             ],
1355         )
1356         self.assertEqual(len(subnets), 256)
1357     def testSubnetFailsForLargeCidrDiff(self):
1358         self.assertRaises(ValueError, list, self.ipv4_interface.network.subnets(9))
1359         self.assertRaises(ValueError, list, self.ipv4_network.subnets(9))
1360         self.assertRaises(ValueError, list, self.ipv6_interface.network.subnets(65))
1361         self.assertRaises(ValueError, list, self.ipv6_network.subnets(65))
1362         self.assertRaises(
1363             ValueError, list, self.ipv6_scoped_interface.network.subnets(65)
1364         )
1365         self.assertRaises(ValueError, list, self.ipv6_scoped_network.subnets(65))
1366     def testSupernetFailsForLargeCidrDiff(self):
1367         self.assertRaises(ValueError, self.ipv4_interface.network.supernet, 25)
1368         self.assertRaises(ValueError, self.ipv6_interface.network.supernet, 65)
1369         self.assertRaises(ValueError, self.ipv6_scoped_interface.network.supernet, 65)
1370     def testSubnetFailsForNegativeCidrDiff(self):
1371         self.assertRaises(ValueError, list, self.ipv4_interface.network.subnets(-1))
1372         self.assertRaises(ValueError, list, self.ipv4_network.subnets(-1))
1373         self.assertRaises(ValueError, list, self.ipv6_interface.network.subnets(-1))
1374         self.assertRaises(ValueError, list, self.ipv6_network.subnets(-1))
1375         self.assertRaises(
1376             ValueError, list, self.ipv6_scoped_interface.network.subnets(-1)
1377         )
1378         self.assertRaises(ValueError, list, self.ipv6_scoped_network.subnets(-1))
1379     def testGetNum_Addresses(self):
1380         self.assertEqual(self.ipv4_network.num_addresses, 256)
1381         self.assertEqual(list(self.ipv4_network.subnets())[0].num_addresses, 128)
1382         self.assertEqual(self.ipv4_network.supernet().num_addresses, 512)
1383         self.assertEqual(self.ipv6_network.num_addresses, 18446744073709551616)
1384         self.assertEqual(
1385             list(self.ipv6_network.subnets())[0].num_addresses, 9223372036854775808
1386         )
1387         self.assertEqual(
1388             self.ipv6_network.supernet().num_addresses, 36893488147419103232
1389         )
1390         self.assertEqual(self.ipv6_scoped_network.num_addresses, 18446744073709551616)
1391         self.assertEqual(
1392             list(self.ipv6_scoped_network.subnets())[0].num_addresses,
1393             9223372036854775808,
1394         )
1395         self.assertEqual(
1396             self.ipv6_scoped_network.supernet().num_addresses, 36893488147419103232
1397         )
1398     def testContains(self):
1399         self.assertIn(ipaddress.IPv4Interface("1.2.3.128/25"), self.ipv4_network)
1400         self.assertNotIn(ipaddress.IPv4Interface("1.2.4.1/24"), self.ipv4_network)
1401         addr1 = ipaddress.IPv4Address("1.2.3.37")
1402         self.assertIn(addr1, self.ipv4_network)
1403         self.assertFalse(
1404             ipaddress.IPv4Network("1.1.0.0/16").__contains__(
1405                 ipaddress.IPv4Network("1.0.0.0/15")
1406             )
1407         )
1408     def testNth(self):
1409         self.assertEqual(str(self.ipv4_network[5]), "1.2.3.5")
1410         self.assertRaises(IndexError, self.ipv4_network.__getitem__, 256)
1411         self.assertEqual(str(self.ipv6_network[5]), "2001:658:22a:cafe::5")
1412         self.assertRaises(IndexError, self.ipv6_network.__getitem__, 1 &lt;&lt; 64)
1413         self.assertEqual(str(self.ipv6_scoped_network[5]), "2001:658:22a:cafe::5")
1414         self.assertRaises(IndexError, self.ipv6_scoped_network.__getitem__, 1 &lt;&lt; 64)
1415     def testGetitem(self):
1416         addr = ipaddress.IPv4Network("172.31.255.128/255.255.255.240")
1417         self.assertEqual(28, addr.prefixlen)
1418         addr_list = list(addr)
1419         self.assertEqual("172.31.255.128", str(addr_list[0]))
1420         self.assertEqual("172.31.255.128", str(addr[0]))
1421         self.assertEqual("172.31.255.143", str(addr_list[-1]))
1422         self.assertEqual("172.31.255.143", str(addr[-1]))
1423         self.assertEqual(addr_list[-1], addr[-1])
1424     def testEqual(self):
1425         self.assertTrue(self.ipv4_interface == ipaddress.IPv4Interface("1.2.3.4/24"))
1426         self.assertFalse(self.ipv4_interface == ipaddress.IPv4Interface("1.2.3.4/23"))
1427         self.assertFalse(self.ipv4_interface == ipaddress.IPv6Interface("::1.2.3.4/24"))
1428         self.assertFalse(
1429             self.ipv4_interface == ipaddress.IPv6Interface("::1.2.3.4%scope/24")
1430         )
1431         self.assertFalse(self.ipv4_interface == "")
1432         self.assertFalse(self.ipv4_interface == [])
1433         self.assertFalse(self.ipv4_interface == 2)
1434         self.assertTrue(
1435             self.ipv6_interface
1436             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1437         )
1438         self.assertFalse(
1439             self.ipv6_interface
1440             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1441         )
1442         self.assertFalse(self.ipv6_interface == ipaddress.IPv4Interface("1.2.3.4/23"))
1443         self.assertFalse(self.ipv6_interface == "")
1444         self.assertFalse(self.ipv6_interface == [])
1445         self.assertFalse(self.ipv6_interface == 2)
1446         self.assertTrue(
1447             self.ipv6_scoped_interface
1448             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/64")
1449         )
1450         self.assertFalse(
1451             self.ipv6_scoped_interface
1452             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/63")
1453         )
1454         self.assertFalse(
1455             self.ipv6_scoped_interface
1456             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1457         )
1458         self.assertFalse(
1459             self.ipv6_scoped_interface
1460             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1461         )
1462         self.assertFalse(
1463             self.ipv6_scoped_interface == ipaddress.IPv4Interface("1.2.3.4/23")
1464         )
1465         self.assertFalse(self.ipv6_scoped_interface == "")
1466         self.assertFalse(self.ipv6_scoped_interface == [])
1467         self.assertFalse(self.ipv6_scoped_interface == 2)
1468     def testNotEqual(self):
1469         self.assertFalse(self.ipv4_interface != ipaddress.IPv4Interface("1.2.3.4/24"))
1470         self.assertTrue(self.ipv4_interface != ipaddress.IPv4Interface("1.2.3.4/23"))
1471         self.assertTrue(self.ipv4_interface != ipaddress.IPv6Interface("::1.2.3.4/24"))
1472         self.assertTrue(
1473             self.ipv4_interface != ipaddress.IPv6Interface("::1.2.3.4%scope/24")
1474         )
1475         self.assertTrue(self.ipv4_interface != "")
1476         self.assertTrue(self.ipv4_interface != [])
1477         self.assertTrue(self.ipv4_interface != 2)
1478         self.assertTrue(self.ipv4_address != ipaddress.IPv4Address("1.2.3.5"))
1479         self.assertTrue(self.ipv4_address != "")
1480         self.assertTrue(self.ipv4_address != [])
1481         self.assertTrue(self.ipv4_address != 2)
1482         self.assertFalse(
1483             self.ipv6_interface
1484             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1485         )
1486         self.assertTrue(
1487             self.ipv6_interface
1488             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1489         )
1490         self.assertTrue(self.ipv6_interface != ipaddress.IPv4Interface("1.2.3.4/23"))
1491         self.assertTrue(self.ipv6_interface != "")
1492         self.assertTrue(self.ipv6_interface != [])
1493         self.assertTrue(self.ipv6_interface != 2)
1494         self.assertTrue(self.ipv6_address != ipaddress.IPv4Address("1.2.3.4"))
1495         self.assertTrue(self.ipv6_address != "")
1496         self.assertTrue(self.ipv6_address != [])
1497         self.assertTrue(self.ipv6_address != 2)
1498         self.assertFalse(
1499             self.ipv6_scoped_interface
1500             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/64")
1501         )
1502         self.assertTrue(
1503             self.ipv6_scoped_interface
1504             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/63")
1505         )
1506         self.assertTrue(
1507             self.ipv6_scoped_interface
1508             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1509         )
1510         self.assertTrue(
1511             self.ipv6_scoped_interface
1512             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1513         )
1514         self.assertTrue(
1515             self.ipv6_scoped_interface != ipaddress.IPv4Interface("1.2.3.4/23")
1516         )
1517         self.assertTrue(self.ipv6_scoped_interface != "")
1518         self.assertTrue(self.ipv6_scoped_interface != [])
1519         self.assertTrue(self.ipv6_scoped_interface != 2)
1520         self.assertTrue(self.ipv6_scoped_address != ipaddress.IPv4Address("1.2.3.4"))
1521         self.assertTrue(self.ipv6_scoped_address != "")
1522         self.assertTrue(self.ipv6_scoped_address != [])
1523         self.assertTrue(self.ipv6_scoped_address != 2)
1524     def testSlash32Constructor(self):
1525         self.assertEqual(
1526             str(ipaddress.IPv4Interface("1.2.3.4/255.255.255.255")), "1.2.3.4/32"
1527         )
1528     def testSlash128Constructor(self):
1529         self.assertEqual(str(ipaddress.IPv6Interface("::1/128")), "::1/128")
1530         self.assertEqual(str(ipaddress.IPv6Interface("::1%scope/128")), "::1%scope/128")
1531     def testSlash0Constructor(self):
1532         self.assertEqual(str(ipaddress.IPv4Interface("1.2.3.4/0.0.0.0")), "1.2.3.4/0")
1533     def testCollapsing(self):
1534         ip1 = ipaddress.IPv4Address("1.1.1.0")
1535         ip2 = ipaddress.IPv4Address("1.1.1.1")
1536         ip3 = ipaddress.IPv4Address("1.1.1.2")
1537         ip4 = ipaddress.IPv4Address("1.1.1.3")
1538         ip5 = ipaddress.IPv4Address("1.1.1.4")
1539         ip6 = ipaddress.IPv4Address("1.1.1.0")
1540         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4, ip5, ip6])
1541         self.assertEqual(
1542             list(collapsed),
1543             [ipaddress.IPv4Network("1.1.1.0/30"), ipaddress.IPv4Network("1.1.1.4/32")],
1544         )
1545         ip1 = ipaddress.IPv4Address("1.1.1.0")
1546         ip2 = ipaddress.IPv4Address("1.1.1.1")
1547         ip3 = ipaddress.IPv4Address("1.1.1.2")
1548         ip4 = ipaddress.IPv4Address("1.1.1.3")
1549         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4])
1550         self.assertEqual(list(collapsed), [ipaddress.IPv4Network("1.1.1.0/30")])
1551         ip1 = ipaddress.IPv4Network("1.1.0.0/24")
1552         ip2 = ipaddress.IPv4Network("1.1.1.0/24")
1553         ip3 = ipaddress.IPv4Network("1.1.2.0/24")
1554         ip4 = ipaddress.IPv4Network("1.1.3.0/24")
1555         ip5 = ipaddress.IPv4Network("1.1.4.0/24")
1556         ip6 = ipaddress.IPv4Network("1.1.0.0/22")
1557         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4, ip5, ip6])
1558         self.assertEqual(
1559             list(collapsed),
1560             [ipaddress.IPv4Network("1.1.0.0/22"), ipaddress.IPv4Network("1.1.4.0/24")],
1561         )
1562         collapsed = ipaddress.collapse_addresses([ip1, ip2])
1563         self.assertEqual(list(collapsed), [ipaddress.IPv4Network("1.1.0.0/23")])
1564         ip_same1 = ip_same2 = ipaddress.IPv4Network("1.1.1.1/32")
1565         self.assertEqual(
1566             list(ipaddress.collapse_addresses([ip_same1, ip_same2])), [ip_same1]
1567         )
1568         ip_same1 = ip_same2 = ipaddress.IPv4Address("1.1.1.1")
1569         self.assertEqual(
1570             list(ipaddress.collapse_addresses([ip_same1, ip_same2])),
1571             [ipaddress.ip_network("1.1.1.1/32")],
1572         )
1573         ip1 = ipaddress.IPv6Network("2001::/100")
1574         ip2 = ipaddress.IPv6Network("2001::/120")
1575         ip3 = ipaddress.IPv6Network("2001::/96")
1576         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3])
1577         self.assertEqual(list(collapsed), [ip3])
1578         ip1 = ipaddress.IPv6Network("2001::%scope/100")
1579         ip2 = ipaddress.IPv6Network("2001::%scope/120")
1580         ip3 = ipaddress.IPv6Network("2001::%scope/96")
1581         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3])
1582         self.assertEqual(list(collapsed), [ip3])
1583         addr_tuples = [
1584             (ipaddress.ip_address("1.1.1.1"), ipaddress.ip_address("::1")),
1585             (ipaddress.IPv4Network("1.1.0.0/24"), ipaddress.IPv6Network("2001::/120")),
1586             (ipaddress.IPv4Network("1.1.0.0/32"), ipaddress.IPv6Network("2001::/128")),
1587         ]
1588         for ip1, ip2 in addr_tuples:
1589             self.assertRaises(TypeError, ipaddress.collapse_addresses, [ip1, ip2])
1590         addr_tuples = [
1591             (ipaddress.ip_address("1.1.1.1"), ipaddress.ip_address("::1%scope")),
1592             (
1593                 ipaddress.IPv4Network("1.1.0.0/24"),
1594                 ipaddress.IPv6Network("2001::%scope/120"),
1595             ),
1596             (
1597                 ipaddress.IPv4Network("1.1.0.0/32"),
1598                 ipaddress.IPv6Network("2001::%scope/128"),
1599             ),
1600         ]
1601         for ip1, ip2 in addr_tuples:
1602             self.assertRaises(TypeError, ipaddress.collapse_addresses, [ip1, ip2])
1603     def testSummarizing(self):
1604         summarize = ipaddress.summarize_address_range
1605         ip1 = ipaddress.ip_address("1.1.1.0")
1606         ip2 = ipaddress.ip_address("1.1.1.255")
1607         class IPv7Address(ipaddress.IPv6Address):
1608             @property
1609             def version(self):
1610                 return 7
1611         ip_invalid1 = IPv7Address("::1")
1612         ip_invalid2 = IPv7Address("::1")
1613         self.assertRaises(ValueError, list, summarize(ip_invalid1, ip_invalid2))
1614         self.assertRaises(TypeError, list, summarize(ip1, ipaddress.IPv6Address("::1")))
1615         self.assertRaises(
1616             TypeError, list, summarize(ip1, ipaddress.IPv6Address("::1%scope"))
1617         )
1618         self.assertEqual(
1619             list(summarize(ip1, ip2))[0], ipaddress.ip_network("1.1.1.0/24")
1620         )
1621         ip2 = ipaddress.ip_address("1.1.1.8")
1622         self.assertEqual(
1623             list(summarize(ip1, ip2)),
1624             [ipaddress.ip_network("1.1.1.0/29"), ipaddress.ip_network("1.1.1.8")],
1625         )
1626         ip1 = ipaddress.IPv4Address(0)
1627         ip2 = ipaddress.IPv4Address(ipaddress.IPv4Address._ALL_ONES)
1628         self.assertEqual(
1629             [ipaddress.IPv4Network("0.0.0.0/0")], list(summarize(ip1, ip2))
1630         )
1631         ip1 = ipaddress.ip_address("1::")
1632         ip2 = ipaddress.ip_address("1:ffff:ffff:ffff:ffff:ffff:ffff:ffff")
1633         self.assertEqual(list(summarize(ip1, ip2))[0], ipaddress.ip_network("1::/16"))
1634         ip2 = ipaddress.ip_address("2::")
1635         self.assertEqual(
1636             list(summarize(ip1, ip2)),
1637             [ipaddress.ip_network("1::/16"), ipaddress.ip_network("2::/128")],
1638         )
1639         ip1 = ipaddress.ip_address("1::%scope")
1640         ip2 = ipaddress.ip_address("1:ffff:ffff:ffff:ffff:ffff:ffff:ffff%scope")
1641         self.assertEqual(list(summarize(ip1, ip2))[0], ipaddress.ip_network("1::/16"))
1642         ip2 = ipaddress.ip_address("2::%scope")
1643         self.assertEqual(
1644             list(summarize(ip1, ip2)),
1645             [ipaddress.ip_network("1::/16"), ipaddress.ip_network("2::/128")],
1646         )
1647         self.assertRaises(
1648             ValueError,
1649             list,
1650             summarize(ipaddress.ip_address("1.1.1.0"), ipaddress.ip_address("1.1.0.0")),
1651         )
1652         self.assertRaises(
1653             TypeError,
1654             list,
1655             summarize(ipaddress.ip_network("1.1.1.0"), ipaddress.ip_network("1.1.0.0")),
1656         )
1657         self.assertRaises(
1658             TypeError,
1659             list,
1660             summarize(ipaddress.ip_network("1.1.1.0"), ipaddress.ip_network("1.1.0.0")),
1661         )
1662         self.assertRaises(
1663             TypeError,
1664             list,
1665             summarize(ipaddress.ip_address("::"), ipaddress.ip_network("1.1.0.0")),
1666         )
1667     def testAddressComparison(self):
1668         self.assertTrue(
1669             ipaddress.ip_address("1.1.1.1") &lt;= ipaddress.ip_address("1.1.1.1")
1670         )
1671         self.assertTrue(
1672             ipaddress.ip_address("1.1.1.1") &lt;= ipaddress.ip_address("1.1.1.2")
1673         )
1674         self.assertTrue(ipaddress.ip_address("::1") &lt;= ipaddress.ip_address("::1"))
1675         self.assertTrue(ipaddress.ip_address("::1") &lt;= ipaddress.ip_address("::2"))
1676         self.assertTrue(
1677             ipaddress.ip_address("::1%scope") &lt;= ipaddress.ip_address("::1%scope")
1678         )
1679         self.assertTrue(
1680             ipaddress.ip_address("::1%scope") &lt;= ipaddress.ip_address("::2%scope")
1681         )
1682     def testInterfaceComparison(self):
1683         self.assertTrue(
1684             ipaddress.ip_interface("1.1.1.1/24") == ipaddress.ip_interface("1.1.1.1/24")
1685         )
1686         self.assertTrue(
1687             ipaddress.ip_interface("1.1.1.1/16") &lt; ipaddress.ip_interface("1.1.1.1/24")
1688         )
1689         self.assertTrue(
1690             ipaddress.ip_interface("1.1.1.1/24") &lt; ipaddress.ip_interface("1.1.1.2/24")
1691         )
1692         self.assertTrue(
1693             ipaddress.ip_interface("1.1.1.2/16") &lt; ipaddress.ip_interface("1.1.1.1/24")
1694         )
1695         self.assertTrue(
1696             ipaddress.ip_interface("1.1.1.1/24") &gt; ipaddress.ip_interface("1.1.1.1/16")
1697         )
1698         self.assertTrue(
1699             ipaddress.ip_interface("1.1.1.2/24") &gt; ipaddress.ip_interface("1.1.1.1/24")
1700         )
1701         self.assertTrue(
1702             ipaddress.ip_interface("1.1.1.1/24") &gt; ipaddress.ip_interface("1.1.1.2/16")
1703         )
1704         self.assertTrue(
1705             ipaddress.ip_interface("::1/64") == ipaddress.ip_interface("::1/64")
1706         )
1707         self.assertTrue(
1708             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::1/80")
1709         )
1710         self.assertTrue(
1711             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::2/64")
1712         )
1713         self.assertTrue(
1714             ipaddress.ip_interface("::2/48") &lt; ipaddress.ip_interface("::1/64")
1715         )
1716         self.assertTrue(
1717             ipaddress.ip_interface("::1/80") &gt; ipaddress.ip_interface("::1/64")
1718         )
1719         self.assertTrue(
1720             ipaddress.ip_interface("::2/64") &gt; ipaddress.ip_interface("::1/64")
1721         )
1722         self.assertTrue(
1723             ipaddress.ip_interface("::1/64") &gt; ipaddress.ip_interface("::2/48")
1724         )
1725         self.assertTrue(
1726             ipaddress.ip_interface("::1%scope/64")
1727             == ipaddress.ip_interface("::1%scope/64")
1728         )
1729         self.assertTrue(
1730             ipaddress.ip_interface("::1%scope/64")
1731             &lt; ipaddress.ip_interface("::1%scope/80")
1732         )
1733         self.assertTrue(
1734             ipaddress.ip_interface("::1%scope/64")
1735             &lt; ipaddress.ip_interface("::2%scope/64")
1736         )
1737         self.assertTrue(
1738             ipaddress.ip_interface("::2%scope/48")
1739             &lt; ipaddress.ip_interface("::1%scope/64")
1740         )
1741         self.assertTrue(
1742             ipaddress.ip_interface("::1%scope/80")
1743             &gt; ipaddress.ip_interface("::1%scope/64")
1744         )
1745         self.assertTrue(
1746             ipaddress.ip_interface("::2%scope/64")
1747             &gt; ipaddress.ip_interface("::1%scope/64")
1748         )
1749         self.assertTrue(
1750             ipaddress.ip_interface("::1%scope/64")
1751             &gt; ipaddress.ip_interface("::2%scope/48")
1752         )
1753         self.assertFalse(
1754             ipaddress.ip_interface("::1%scope/64") == ipaddress.ip_interface("::1/64")
1755         )
1756         self.assertTrue(
1757             ipaddress.ip_interface("::1%scope/64") &lt; ipaddress.ip_interface("::1/80")
1758         )
1759         self.assertTrue(
1760             ipaddress.ip_interface("::1%scope/64") &lt; ipaddress.ip_interface("::2/64")
1761         )
1762         self.assertTrue(
1763             ipaddress.ip_interface("::2%scope/48") &lt; ipaddress.ip_interface("::1/64")
1764         )
1765         self.assertTrue(
1766             ipaddress.ip_interface("::1%scope/80") &gt; ipaddress.ip_interface("::1/64")
1767         )
1768         self.assertTrue(
1769             ipaddress.ip_interface("::2%scope/64") &gt; ipaddress.ip_interface("::1/64")
1770         )
1771         self.assertTrue(
1772             ipaddress.ip_interface("::1%scope/64") &gt; ipaddress.ip_interface("::2/48")
1773         )
1774         self.assertFalse(
1775             ipaddress.ip_interface("::1/64") == ipaddress.ip_interface("::1%scope/64")
1776         )
1777         self.assertTrue(
1778             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::1%scope/80")
1779         )
1780             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::2%scope/64")
1781         )
1782         self<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertTrue(
1783             ipaddress.ip_interface("::2/48") &lt; ipaddress.ip_interface("::1%scope/64")
1784         )
1785         self.assertTrue(
1786             ipaddress.ip_interface("::1/80") &gt; ipaddress.ip_interface("::1%scope/64")
1787         )
1788         self.assertTrue(
1789             ipaddress.ip_interface("::2/64") &gt; ipaddress.ip_interface("::1%scope/64")
1790         )
1791         self.assertTrue(
1792             ipaddress.ip_interface("::1/64") &gt; ipaddress.ip_interface("::2%scope/48")
1793         )
1794     def testNetworkComparison(self):
1795         ip1 = ipaddress.IPv4Network("1.1.1.0/24")
1796         ip2 = ipaddress.IPv4Network(</b></font>"1.1.1.0/32")
1797         ip3 = ipaddress.IPv4Network("1.1.2.0/24")
1798         self.assertTrue(ip1 &lt; ip3)
1799         self.assertTrue(ip3 &gt; ip2)
1800         self.assertEqual(ip1.compare_networks(ip1), 0)
1801         self.assertEqual(ip1.compare_networks(ip2), -1)
1802         self.assertEqual(ip2.compare_networks(ip1), 1)
1803         self.assertEqual(ip1.compare_networks(ip3), -1)
1804         self.assertEqual(ip3.compare_networks(ip1), 1)
1805         self.assertTrue(ip1._get_networks_key() &lt; ip3._get_networks_key())
1806         ip1 = ipaddress.IPv6Network("2001:2000::/96")
1807         ip2 = ipaddress.IPv6Network("2001:2001::/96")
1808         ip3 = ipaddress.IPv6Network("2001:ffff:2000::/96")
1809         self.assertTrue(ip1 &lt; ip3)
1810         self.assertTrue(ip3 &gt; ip2)
1811         self.assertEqual(ip1.compare_networks(ip3), -1)
1812         self.assertTrue(ip1._get_networks_key() &lt; ip3._get_networks_key())
1813         self.assertRaises(
1814             TypeError, self.ipv4_network.compare_networks, self.ipv6_network
1815         )
1816         ipv6 = ipaddress.IPv6Interface("::/0")
1817         ipv4 = ipaddress.IPv4Interface("0.0.0.0/0")
1818         self.assertRaises(TypeError, ipv4.__lt__, ipv6)
1819         self.assertRaises(TypeError, ipv4.__gt__, ipv6)
1820         self.assertRaises(TypeError, ipv6.__lt__, ipv4)
1821         self.assertRaises(TypeError, ipv6.__gt__, ipv4)
1822         ip1 = ipaddress.ip_network("10.1.2.128/25")
1823         self.assertFalse(ip1 &lt; ip1)
1824         self.assertFalse(ip1 &gt; ip1)
1825         ip2 = ipaddress.ip_network("10.1.3.0/24")
1826         self.assertTrue(ip1 &lt; ip2)
1827         self.assertFalse(ip2 &lt; ip1)
1828         self.assertFalse(ip1 &gt; ip2)
1829         self.assertTrue(ip2 &gt; ip1)
1830         ip3 = ipaddress.ip_network("10.1.3.0/25")
1831         self.assertTrue(ip2 &lt; ip3)
1832         self.assertFalse(ip3 &lt; ip2)
1833         self.assertFalse(ip2 &gt; ip3)
1834         self.assertTrue(ip3 &gt; ip2)
1835         ip1 = ipaddress.ip_network("10.10.10.0/31")
1836         ip2 = ipaddress.ip_network("10.10.10.0")
1837         ip3 = ipaddress.ip_network("10.10.10.2/31")
1838         ip4 = ipaddress.ip_network("10.10.10.2")
1839         sorted = [ip1, ip2, ip3, ip4]
1840         unsorted = [ip2, ip4, ip1, ip3]
1841         unsorted.sort()
1842         self.assertEqual(sorted, unsorted)
1843         unsorted = [ip4, ip1, ip3, ip2]
1844         unsorted.sort()
1845         self.assertEqual(sorted, unsorted)
1846         self.assertIs(ip1.__lt__(ipaddress.ip_address("10.10.10.0")), NotImplemented)
1847         self.assertIs(ip2.__lt__(ipaddress.ip_address("10.10.10.0")), NotImplemented)
1848         self.assertTrue(
1849             ipaddress.ip_network("1.1.1.1") &lt;= ipaddress.ip_network("1.1.1.1")
1850         )
1851         self.assertTrue(
1852             ipaddress.ip_network("1.1.1.1") &lt;= ipaddress.ip_network("1.1.1.2")
1853         )
1854         self.assertFalse(
1855             ipaddress.ip_network("1.1.1.2") &lt;= ipaddress.ip_network("1.1.1.1")
1856         )
1857         self.assertTrue(ipaddress.ip_network("::1") &lt;= ipaddress.ip_network("::1"))
1858         self.assertTrue(ipaddress.ip_network("::1") &lt;= ipaddress.ip_network("::2"))
1859         self.assertFalse(ipaddress.ip_network("::2") &lt;= ipaddress.ip_network("::1"))
1860     def testStrictNetworks(self):
1861         self.assertRaises(ValueError, ipaddress.ip_network, "192.168.1.1/24")
1862         self.assertRaises(ValueError, ipaddress.ip_network, "::1/120")
1863         self.assertRaises(ValueError, ipaddress.ip_network, "::1%scope/120")
1864     def testOverlaps(self):
1865         other = ipaddress.IPv4Network("1.2.3.0/30")
1866         other2 = ipaddress.IPv4Network("1.2.2.0/24")
1867         other3 = ipaddress.IPv4Network("1.2.2.64/26")
1868         self.assertTrue(self.ipv4_network.overlaps(other))
1869         self.assertFalse(self.ipv4_network.overlaps(other2))
1870         self.assertTrue(other2.overlaps(other3))
1871     def testEmbeddedIpv4(self):
1872         ipv4_string = "192.168.0.1"
1873         ipv4 = ipaddress.IPv4Interface(ipv4_string)
1874         v4compat_ipv6 = ipaddress.IPv6Interface("::%s" % ipv4_string)
1875         self.assertEqual(int(v4compat_ipv6.ip), int(ipv4.ip))
1876         v4mapped_ipv6 = ipaddress.IPv6Interface("::ffff:%s" % ipv4_string)
1877         self.assertNotEqual(v4mapped_ipv6.ip, ipv4.ip)
1878         self.assertRaises(
1879             ipaddress.AddressValueError, ipaddress.IPv6Interface, "2001:1.1.1.1:1.1.1.1"
1880         )
1881     def testIPv6AddressTooLarge(self):
1882         self.assertEqual(
1883             ipaddress.ip_address("::FFFF:192.0.2.1"),
1884             ipaddress.ip_address("::FFFF:c000:201"),
1885         )
1886         self.assertEqual(
1887             ipaddress.ip_address("FFFF::192.0.2.1"),
1888             ipaddress.ip_address("FFFF::c000:201"),
1889         )
1890         self.assertEqual(
1891             ipaddress.ip_address("::FFFF:192.0.2.1%scope"),
1892             ipaddress.ip_address("::FFFF:c000:201%scope"),
1893         )
1894         self.assertEqual(
1895             ipaddress.ip_address("FFFF::192.0.2.1%scope"),
1896             ipaddress.ip_address("FFFF::c000:201%scope"),
1897         )
1898         self.assertNotEqual(
1899             ipaddress.ip_address("::FFFF:192.0.2.1%scope"),
1900             ipaddress.ip_address("::FFFF:c000:201"),
1901         )
1902         self.assertNotEqual(
1903             ipaddress.ip_address("FFFF::192.0.2.1%scope"),
1904             ipaddress.ip_address("FFFF::c000:201"),
1905         )
1906         self.assertNotEqual(
1907             ipaddress.ip_address("::FFFF:192.0.2.1"),
1908             ipaddress.ip_address("::FFFF:c000:201%scope"),
1909         )
1910         self.assertNotEqual(
1911             ipaddress.ip_address("FFFF::192.0.2.1"),
1912             ipaddress.ip_address("FFFF::c000:201%scope"),
1913         )
1914     def testIPVersion(self):
1915         self.assertEqual(self.ipv4_address.version, 4)
1916         self.assertEqual(self.ipv6_address.version, 6)
1917         self.assertEqual(self.ipv6_scoped_address.version, 6)
1918     def testMaxPrefixLength(self):
1919         self.assertEqual(self.ipv4_interface.max_prefixlen, 32)
1920         self.assertEqual(self.ipv6_interface.max_prefixlen, 128)
1921         self.assertEqual(self.ipv6_scoped_interface.max_prefixlen, 128)
1922     def testPacked(self):
1923         self.assertEqual(self.ipv4_address.packed, b"\x01\x02\x03\x04")
1924         self.assertEqual(
1925             ipaddress.IPv4Interface("255.254.253.252").packed, b"\xff\xfe\xfd\xfc"
1926         )
1927         self.assertEqual(
1928             self.ipv6_address.packed,
1929             b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01",
1930         )
1931         self.assertEqual(
1932             ipaddress.IPv6Interface("ffff:2:3:4:ffff::").packed,
1933             b"\xff\xff\x00\x02\x00\x03\x00\x04\xff\xff" + b"\x00" * 6,
1934         )
1935         self.assertEqual(
1936             ipaddress.IPv6Interface("::1:0:0:0:0").packed,
1937             b"\x00" * 6 + b"\x00\x01" + b"\x00" * 8,
1938         )
1939         self.assertEqual(
1940             self.ipv6_scoped_address.packed,
1941             b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01",
1942         )
1943         self.assertEqual(
1944             ipaddress.IPv6Interface("ffff:2:3:4:ffff::%scope").packed,
1945             b"\xff\xff\x00\x02\x00\x03\x00\x04\xff\xff" + b"\x00" * 6,
1946         )
1947         self.assertEqual(
1948             ipaddress.IPv6Interface("::1:0:0:0:0%scope").packed,
1949             b"\x00" * 6 + b"\x00\x01" + b"\x00" * 8,
1950         )
1951     def testIpType(self):
1952         ipv4net = ipaddress.ip_network("1.2.3.4")
1953         ipv4addr = ipaddress.ip_address("1.2.3.4")
1954         ipv6net = ipaddress.ip_network("::1.2.3.4")
1955         ipv6addr = ipaddress.ip_address("::1.2.3.4")
1956         self.assertEqual(ipaddress.IPv4Network, type(ipv4net))
1957         self.assertEqual(ipaddress.IPv4Address, type(ipv4addr))
1958         self.assertEqual(ipaddress.IPv6Network, type(ipv6net))
1959         self.assertEqual(ipaddress.IPv6Address, type(ipv6addr))
1960     def testReservedIpv4(self):
1961         self.assertEqual(True, ipaddress.ip_interface("224.1.1.1/31").is_multicast)
1962         self.assertEqual(False, ipaddress.ip_network("240.0.0.0").is_multicast)
1963         self.assertEqual(True, ipaddress.ip_network("240.0.0.0").is_reserved)
1964         self.assertEqual(True, ipaddress.ip_interface("192.168.1.1/17").is_private)
1965         self.assertEqual(False, ipaddress.ip_network("192.169.0.0").is_private)
1966         self.assertEqual(True, ipaddress.ip_network("10.255.255.255").is_private)
1967         self.assertEqual(False, ipaddress.ip_network("11.0.0.0").is_private)
1968         self.assertEqual(False, ipaddress.ip_network("11.0.0.0").is_reserved)
1969         self.assertEqual(True, ipaddress.ip_network("172.31.255.255").is_private)
1970         self.assertEqual(False, ipaddress.ip_network("172.32.0.0").is_private)
1971         self.assertEqual(True, ipaddress.ip_network("169.254.1.0/24").is_link_local)
1972         self.assertEqual(
1973             True, ipaddress.ip_interface("169.254.100.200/24").is_link_local
1974         )
1975         self.assertEqual(
1976             False, ipaddress.ip_interface("169.255.100.200/24").is_link_local
1977         )
1978         self.assertEqual(True, ipaddress.ip_network("127.100.200.254/32").is_loopback)
1979         self.assertEqual(True, ipaddress.ip_network("127.42.0.0/16").is_loopback)
1980         self.assertEqual(False, ipaddress.ip_network("128.0.0.0").is_loopback)
1981         self.assertEqual(False, ipaddress.ip_network("100.64.0.0/10").is_private)
1982         self.assertEqual(False, ipaddress.ip_network("100.64.0.0/10").is_global)
1983         self.assertEqual(True, ipaddress.ip_network("192.0.2.128/25").is_private)
1984         self.assertEqual(True, ipaddress.ip_network("192.0.3.0/24").is_global)
1985         self.assertEqual(True, ipaddress.ip_address("0.0.0.0").is_unspecified)
1986         self.assertEqual(True, ipaddress.ip_address("224.1.1.1").is_multicast)
1987         self.assertEqual(False, ipaddress.ip_address("240.0.0.0").is_multicast)
1988         self.assertEqual(True, ipaddress.ip_address("240.0.0.1").is_reserved)
1989         self.assertEqual(False, ipaddress.ip_address("239.255.255.255").is_reserved)
1990         self.assertEqual(True, ipaddress.ip_address("192.168.1.1").is_private)
1991         self.assertEqual(False, ipaddress.ip_address("192.169.0.0").is_private)
1992         self.assertEqual(True, ipaddress.ip_address("10.255.255.255").is_private)
1993         self.assertEqual(False, ipaddress.ip_address("11.0.0.0").is_private)
1994         self.assertEqual(True, ipaddress.ip_address("172.31.255.255").is_private)
1995         self.assertEqual(False, ipaddress.ip_address("172.32.0.0").is_private)
1996         self.assertEqual(True, ipaddress.ip_address("169.254.100.200").is_link_local)
1997         self.assertEqual(False, ipaddress.ip_address("169.255.100.200").is_link_local)
1998         self.assertTrue(ipaddress.ip_address("192.0.7.1").is_global)
1999         self.assertFalse(ipaddress.ip_address("203.0.113.1").is_global)
2000         self.assertEqual(True, ipaddress.ip_address("127.100.200.254").is_loopback)
2001         self.assertEqual(True, ipaddress.ip_address("127.42.0.0").is_loopback)
2002         self.assertEqual(False, ipaddress.ip_address("128.0.0.0").is_loopback)
2003         self.assertEqual(True, ipaddress.ip_network("0.0.0.0").is_unspecified)
2004     def testReservedIpv6(self):
2005         self.assertEqual(True, ipaddress.ip_network("ffff::").is_multicast)
2006         self.assertEqual(True, ipaddress.ip_network(2 ** 128 - 1).is_multicast)
2007         self.assertEqual(True, ipaddress.ip_network("ff00::").is_multicast)
2008         self.assertEqual(False, ipaddress.ip_network("fdff::").is_multicast)
2009         self.assertEqual(True, ipaddress.ip_network("fecf::").is_site_local)
2010         self.assertEqual(
2011             True, ipaddress.ip_network("feff:ffff:ffff:ffff::").is_site_local
2012         )
2013         self.assertEqual(False, ipaddress.ip_network("fbf:ffff::").is_site_local)
2014         self.assertEqual(False, ipaddress.ip_network("ff00::").is_site_local)
2015         self.assertEqual(True, ipaddress.ip_network("fc00::").is_private)
2016         self.assertEqual(True, ipaddress.ip_network("fc00:ffff:ffff:ffff::").is_private)
2017         self.assertEqual(False, ipaddress.ip_network("fbff:ffff::").is_private)
2018         self.assertEqual(False, ipaddress.ip_network("fe00::").is_private)
2019         self.assertEqual(True, ipaddress.ip_network("fea0::").is_link_local)
2020         self.assertEqual(True, ipaddress.ip_network("febf:ffff::").is_link_local)
2021         self.assertEqual(False, ipaddress.ip_network("fe7f:ffff::").is_link_local)
2022         self.assertEqual(False, ipaddress.ip_network("fec0::").is_link_local)
2023         self.assertEqual(True, ipaddress.ip_interface("0:0::0:01").is_loopback)
2024         self.assertEqual(False, ipaddress.ip_interface("::1/127").is_loopback)
2025         self.assertEqual(False, ipaddress.ip_network("::").is_loopback)
2026         self.assertEqual(False, ipaddress.ip_network("::2").is_loopback)
2027         self.assertEqual(True, ipaddress.ip_network("0::0").is_unspecified)
2028         self.assertEqual(False, ipaddress.ip_network("::1").is_unspecified)
2029         self.assertEqual(False, ipaddress.ip_network("::/127").is_unspecified)
2030         self.assertEqual(True, ipaddress.ip_network("2001::1/128").is_private)
2031         self.assertEqual(True, ipaddress.ip_network("200::1/128").is_global)
2032         self.assertEqual(True, ipaddress.ip_address("ffff::").is_multicast)
2033         self.assertEqual(True, ipaddress.ip_address(2 ** 128 - 1).is_multicast)
2034         self.assertEqual(True, ipaddress.ip_address("ff00::").is_multicast)
2035         self.assertEqual(False, ipaddress.ip_address("fdff::").is_multicast)
2036         self.assertEqual(True, ipaddress.ip_address("fecf::").is_site_local)
2037         self.assertEqual(
2038             True, ipaddress.ip_address("feff:ffff:ffff:ffff::").is_site_local
2039         )
2040         self.assertEqual(False, ipaddress.ip_address("fbf:ffff::").is_site_local)
2041         self.assertEqual(False, ipaddress.ip_address("ff00::").is_site_local)
2042         self.assertEqual(True, ipaddress.ip_address("fc00::").is_private)
2043         self.assertEqual(True, ipaddress.ip_address("fc00:ffff:ffff:ffff::").is_private)
2044         self.assertEqual(False, ipaddress.ip_address("fbff:ffff::").is_private)
2045         self.assertEqual(False, ipaddress.ip_address("fe00::").is_private)
2046         self.assertEqual(True, ipaddress.ip_address("fea0::").is_link_local)
2047         self.assertEqual(True, ipaddress.ip_address("febf:ffff::").is_link_local)
2048         self.assertEqual(False, ipaddress.ip_address("fe7f:ffff::").is_link_local)
2049         self.assertEqual(False, ipaddress.ip_address("fec0::").is_link_local)
2050         self.assertEqual(True, ipaddress.ip_address("0:0::0:01").is_loopback)
2051         self.assertEqual(True, ipaddress.ip_address("::1").is_loopback)
2052         self.assertEqual(False, ipaddress.ip_address("::2").is_loopback)
2053         self.assertEqual(True, ipaddress.ip_address("0::0").is_unspecified)
2054         self.assertEqual(False, ipaddress.ip_address("::1").is_unspecified)
2055         self.assertEqual(True, ipaddress.ip_address("100::").is_reserved)
2056         self.assertEqual(True, ipaddress.ip_network("4000::1/128").is_reserved)
2057     def testIpv4Mapped(self):
2058         self.assertEqual(
2059             ipaddress.ip_address("::ffff:192.168.1.1").ipv4_mapped,
2060             ipaddress.ip_address("192.168.1.1"),
2061         )
2062         self.assertEqual(ipaddress.ip_address("::c0a8:101").ipv4_mapped, None)
2063         self.assertEqual(
2064             ipaddress.ip_address("::ffff:c0a8:101").ipv4_mapped,
2065             ipaddress.ip_address("192.168.1.1"),
2066         )
2067     def testAddrExclude(self):
2068         addr1 = ipaddress.ip_network("10.1.1.0/24")
2069         addr2 = ipaddress.ip_network("10.1.1.0/26")
2070         addr3 = ipaddress.ip_network("10.2.1.0/24")
2071         addr4 = ipaddress.ip_address("10.1.1.0")
2072         addr5 = ipaddress.ip_network("2001:db8::0/32")
2073         addr6 = ipaddress.ip_network("10.1.1.5/32")
2074         self.assertEqual(
2075             sorted(list(addr1.address_exclude(addr2))),
2076             [
2077                 ipaddress.ip_network("10.1.1.64/26"),
2078                 ipaddress.ip_network("10.1.1.128/25"),
2079             ],
2080         )
2081         self.assertRaises(ValueError, list, addr1.address_exclude(addr3))
2082         self.assertRaises(TypeError, list, addr1.address_exclude(addr4))
2083         self.assertRaises(TypeError, list, addr1.address_exclude(addr5))
2084         self.assertEqual(list(addr1.address_exclude(addr1)), [])
2085         self.assertEqual(
2086             sorted(list(addr1.address_exclude(addr6))),
2087             [
2088                 ipaddress.ip_network("10.1.1.0/30"),
2089                 ipaddress.ip_network("10.1.1.4/32"),
2090                 ipaddress.ip_network("10.1.1.6/31"),
2091                 ipaddress.ip_network("10.1.1.8/29"),
2092                 ipaddress.ip_network("10.1.1.16/28"),
2093                 ipaddress.ip_network("10.1.1.32/27"),
2094                 ipaddress.ip_network("10.1.1.64/26"),
2095                 ipaddress.ip_network("10.1.1.128/25"),
2096             ],
2097         )
2098     def testHash(self):
2099         self.assertEqual(
2100             hash(ipaddress.ip_interface("10.1.1.0/24")),
2101             hash(ipaddress.ip_interface("10.1.1.0/24")),
2102         )
2103         self.assertEqual(
2104             hash(ipaddress.ip_network("10.1.1.0/24")),
2105             hash(ipaddress.ip_network("10.1.1.0/24")),
2106         )
2107         self.assertEqual(
2108             hash(ipaddress.ip_address("10.1.1.0")),
2109             hash(ipaddress.ip_address("10.1.1.0")),
2110         )
2111         self.assertEqual(
2112             hash(ipaddress.ip_address("1.2.3.4")),
2113             hash(ipaddress.ip_address(int(ipaddress.ip_address("1.2.3.4")._ip))),
2114         )
2115         ip1 = ipaddress.ip_address("10.1.1.0")
2116         ip2 = ipaddress.ip_address("1::")
2117         dummy = {}
2118         dummy[self.ipv4_address] = None
2119         dummy[self.ipv6_address] = None
2120         dummy[ip1] = None
2121         dummy[ip2] = None
2122         self.assertIn(self.ipv4_address, dummy)
2123         self.assertIn(ip2, dummy)
2124     def testIPBases(self):
2125         net = self.ipv4_network
2126         self.assertEqual("1.2.3.0/24", net.compressed)
2127         net = self.ipv6_network
2128         self.assertRaises(ValueError, net._string_from_ip_int, 2 ** 128 + 1)
2129     def testIPv6NetworkHelpers(self):
2130         net = self.ipv6_network
2131         self.assertEqual("2001:658:22a:cafe::/64", net.with_prefixlen)
2132         self.assertEqual("2001:658:22a:cafe::/ffff:ffff:ffff:ffff::", net.with_netmask)
2133         self.assertEqual("2001:658:22a:cafe::/::ffff:ffff:ffff:ffff", net.with_hostmask)
2134         self.assertEqual("2001:658:22a:cafe::/64", str(net))
2135     def testIPv4NetworkHelpers(self):
2136         net = self.ipv4_network
2137         self.assertEqual("1.2.3.0/24", net.with_prefixlen)
2138         self.assertEqual("1.2.3.0/255.255.255.0", net.with_netmask)
2139         self.assertEqual("1.2.3.0/0.0.0.255", net.with_hostmask)
2140         self.assertEqual("1.2.3.0/24", str(net))
2141     def testCopyConstructor(self):
2142         addr1 = ipaddress.ip_network("10.1.1.0/24")
2143         addr2 = ipaddress.ip_network(addr1)
2144         addr3 = ipaddress.ip_interface("2001:658:22a:cafe:200::1/64")
2145         addr4 = ipaddress.ip_interface(addr3)
2146         addr5 = ipaddress.IPv4Address("1.1.1.1")
2147         self.assertEqual(addr1, addr2)
2148         self<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertEqual(addr3, addr4)
2149         self.assertEqual(addr5, ipaddress.IPv4Address(addr5))
2150         self.assertEqual(addr6, ipaddress.IPv6Address(addr6))
2151     def testCompressIPv6Address(self):
2152         test_addresses = {
2153             "1:2:3:4:5:6:7:8"</b></font>: "1:2:3:4:5:6:7:8/128",
2154             "2001:0:0:4:0:0:0:8": "2001:0:0:4::8/128",
2155             "2001:0:0:4:5:6:7:8": "2001::4:5:6:7:8/128",
2156             "2001:0:3:4:5:6:7:8": "2001:0:3:4:5:6:7:8/128",
2157             "0:0:3:0:0:0:0:ffff": "0:0:3::ffff/128",
2158             "0:0:0:4:0:0:0:ffff": "::4:0:0:0:ffff/128",
2159             "0:0:0:0:5:0:0:ffff": "::5:0:0:ffff/128",
2160             "1:0:0:4:0:0:7:8": "1::4:0:0:7:8/128",
2161             "0:0:0:0:0:0:0:0": "::/128",
2162             "0:0:0:0:0:0:0:0/0": "::/0",
2163             "0:0:0:0:0:0:0:1": "::1/128",
2164             "2001:0658:022a:cafe:0000:0000:0000:0000/66": "2001:658:22a:cafe::/66",
2165             "::1.2.3.4": "::102:304/128",
2166             "1:2:3:4:5:ffff:1.2.3.4": "1:2:3:4:5:ffff:102:304/128",
2167             "::7:6:5:4:3:2:1": "0:7:6:5:4:3:2:1/128",
2168             "::7:6:5:4:3:2:0": "0:7:6:5:4:3:2:0/128",
2169             "7:6:5:4:3:2:1::": "7:6:5:4:3:2:1:0/128",
2170             "0:6:5:4:3:2:1::": "0:6:5:4:3:2:1:0/128",
2171         }
2172         for uncompressed, compressed in list(test_addresses.items()):
2173             self.assertEqual(compressed, str(ipaddress.IPv6Interface(uncompressed)))
2174     def testExplodeShortHandIpStr(self):
2175         addr1 = ipaddress.IPv6Interface("2001::1")
2176         addr2 = ipaddress.IPv6Address("2001:0:5ef5:79fd:0:59d:a0e5:ba1")
2177         addr3 = ipaddress.IPv6Network("2001::/96")
2178         addr4 = ipaddress.IPv4Address("192.168.178.1")
2179         self.assertEqual("2001:0000:0000:0000:0000:0000:0000:0001/128", addr1.exploded)
2180         self.assertEqual(
2181             "0000:0000:0000:0000:0000:0000:0000:0001/128",
2182             ipaddress.IPv6Interface("::1/128").exploded,
2183         )
2184         self.assertEqual("2001:0000:5ef5:79fd:0000:059d:a0e5:0ba1", addr2.exploded)
2185         self.assertEqual("2001:0000:0000:0000:0000:0000:0000:0000/96", addr3.exploded)
2186         self.assertEqual("192.168.178.1", addr4.exploded)
2187     def testReversePointer(self):
2188         addr1 = ipaddress.IPv4Address("127.0.0.1")
2189         addr2 = ipaddress.IPv6Address("2001:db8::1")
2190         self.assertEqual("1.0.0.127.in-addr.arpa", addr1.reverse_pointer)
2191         self.assertEqual(
2192             "1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8."
2193             + "b.d.0.1.0.0.2.ip6.arpa",
2194             addr2.reverse_pointer,
2195         )
2196     def testIntRepresentation(self):
2197         self.assertEqual(16909060, int(self.ipv4_address))
2198         self.assertEqual(42540616829182469433547762482097946625, int(self.ipv6_address))
2199     def testForceVersion(self):
2200         self.assertEqual(ipaddress.ip_network(1).version, 4)
2201         self.assertEqual(ipaddress.IPv6Network(1).version, 6)
2202     def testWithStar(self):
2203         self.assertEqual(self.ipv4_interface.with_prefixlen, "1.2.3.4/24")
2204         self.assertEqual(self.ipv4_interface.with_netmask, "1.2.3.4/255.255.255.0")
2205         self.assertEqual(self.ipv4_interface.with_hostmask, "1.2.3.4/0.0.0.255")
2206         self.assertEqual(
2207             self.ipv6_interface.with_prefixlen, "2001:658:22a:cafe:200::1/64"
2208         )
2209         self.assertEqual(
2210             self.ipv6_interface.with_netmask,
2211             "2001:658:22a:cafe:200::1/ffff:ffff:ffff:ffff::",
2212         )
2213         self.assertEqual(
2214             self.ipv6_interface.with_hostmask,
2215             "2001:658:22a:cafe:200::1/::ffff:ffff:ffff:ffff",
2216         )
2217     def testNetworkElementCaching(self):
2218         self.assertNotIn("broadcast_address", self.ipv4_network._cache)
2219         self.assertNotIn("hostmask", self.ipv4_network._cache)
2220         self.assertEqual(
2221             self.ipv4_network.broadcast_address, ipaddress.IPv4Address("1.2.3.255")
2222         )
2223         self.assertEqual(self.ipv4_network.hostmask, ipaddress.IPv4Address("0.0.0.255"))
2224         self.assertIn("broadcast_address", self.ipv4_network._cache)
2225         self.assertIn("hostmask", self.ipv4_network._cache)
2226         self.assertNotIn("broadcast_address", self.ipv6_network._cache)
2227         self.assertNotIn("hostmask", self.ipv6_network._cache)
2228         self.assertEqual(
2229             self.ipv6_network.network_address,
2230             ipaddress.IPv6Address("2001:658:22a:cafe::"),
2231         )
2232         self.assertEqual(
2233             self.ipv6_interface.network.network_address,
2234             ipaddress.IPv6Address("2001:658:22a:cafe::"),
2235         )
2236         self.assertEqual(
2237             self.ipv6_network.broadcast_address,
2238             ipaddress.IPv6Address("2001:658:22a:cafe:ffff:ffff:ffff:ffff"),
2239         )
2240         self.assertEqual(
2241             self.ipv6_network.hostmask, ipaddress.IPv6Address("::ffff:ffff:ffff:ffff")
2242         )
2243         self.assertEqual(
2244             self.ipv6_interface.network.broadcast_address,
2245             ipaddress.IPv6Address("2001:658:22a:cafe:ffff:ffff:ffff:ffff"),
2246         )
2247         self.assertEqual(
2248             self.ipv6_interface.network.hostmask,
2249             ipaddress.IPv6Address("::ffff:ffff:ffff:ffff"),
2250         )
2251         self.assertIn("broadcast_address", self.ipv6_network._cache)
2252         self.assertIn("hostmask", self.ipv6_network._cache)
2253         self.assertIn("broadcast_address", self.ipv6_interface.network._cache)
2254         self.assertIn("hostmask", self.ipv6_interface.network._cache)
2255     def testTeredo(self):
2256         server = ipaddress.IPv4Address("65.54.227.120")
2257         client = ipaddress.IPv4Address("192.0.2.45")
2258         teredo_addr = "2001:0000:4136:e378:8000:63bf:3fff:fdd2"
2259         self.assertEqual((server, client), ipaddress.ip_address(teredo_addr).teredo)
2260         bad_addr = "2000::4136:e378:8000:63bf:3fff:fdd2"
2261         self.assertFalse(ipaddress.ip_address(bad_addr).teredo)
2262         bad_addr = "2001:0001:4136:e378:8000:63bf:3fff:fdd2"
2263         self.assertFalse(ipaddress.ip_address(bad_addr).teredo)
2264         teredo_addr = ipaddress.IPv6Address("2001:0:5ef5:79fd:0:59d:a0e5:ba1")
2265         self.assertEqual(
2266             (
2267                 ipaddress.IPv4Address("94.245.121.253"),
2268                 ipaddress.IPv4Address("95.26.244.94"),
2269             ),
2270             teredo_addr.teredo,
2271         )
2272     def testsixtofour(self):
2273         sixtofouraddr = ipaddress.ip_address("2002:ac1d:2d64::1")
2274         bad_addr = ipaddress.ip_address("2000:ac1d:2d64::1")
2275         self.assertEqual(
2276             ipaddress.IPv4Address("172.29.45.100"), sixtofouraddr.sixtofour
2277         )
2278         self.assertFalse(bad_addr.sixtofour)
2279         ipv4_address1 = ipaddress.IPv4Interface("1.2.3.4")
2280         ipv4_address2 = ipaddress.IPv4Interface("2.3.4.5")
2281         self.assertNotEqual(ipv4_address1<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.__hash__(), ipv4_address2.__hash__())
2282     def testV6HashIsNotConstant(self):
2283         ipv6_address1 = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1")
2284         ipv6_address2 = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:2")
2285         self.assertNotEqual(ipv6_address1.__hash__(</b></font>), ipv6_address2.__hash__())
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
