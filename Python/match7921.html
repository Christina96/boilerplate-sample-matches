<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_boto_lc.py & test_serverdensity_device.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_boto_lc.py & test_serverdensity_device.py
      </h3>
      <h1 align="center">
        17.3%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_boto_lc.py (13.953488%)<TH>test_serverdensity_device.py (23.076923%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match7921-0.html#0',2,'match7921-1.html#0',3)" NAME="0">(5-20)<TD><A HREF="javascript:ZweiFrames('match7921-0.html#0',2,'match7921-1.html#0',3)" NAME="0">(5-21)</A><TD ALIGN=center><FONT COLOR="#ff0000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_boto_lc.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
<A NAME="0"></A>    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;
import pytest
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match7921-1.html#0',3,'match7921-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>import salt.states.boto_lc as boto_lc
from salt.exceptions import SaltInvocationError
from tests.support.mock import MagicMock, patch


@pytest.fixture
def configure_loader_modules():
    return {boto_lc: {}}


def test_present():
    &quot;&quot;&quot;
    Test to ensure the launch configuration exists.
    &quot;&quot;&quot;
    name = &quot;mylc&quot;
    image_id =</B></FONT> &quot;ami-0b9c9f62&quot;

    ret = {&quot;name&quot;: name, &quot;result&quot;: True, &quot;changes&quot;: {}, &quot;comment&quot;: &quot;&quot;}

    pytest.raises(
        SaltInvocationError,
        boto_lc.present,
        name,
        image_id,
        user_data=True,
        cloud_init=True,
    )

    mock = MagicMock(side_effect=[True, False])
    with patch.dict(boto_lc.__salt__, {&quot;boto_asg.launch_configuration_exists&quot;: mock}):
        comt = &quot;Launch configuration present.&quot;
        ret.update({&quot;comment&quot;: comt})
        assert boto_lc.present(name, image_id) == ret

        with patch.dict(boto_lc.__opts__, {&quot;test&quot;: True}):
            comt = &quot;Launch configuration set to be created.&quot;
            ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
            assert boto_lc.present(name, image_id) == ret


def test_absent():
    &quot;&quot;&quot;
    Test to ensure the named launch configuration is deleted.
    &quot;&quot;&quot;
    name = &quot;mylc&quot;

    ret = {&quot;name&quot;: name, &quot;result&quot;: True, &quot;changes&quot;: {}, &quot;comment&quot;: &quot;&quot;}

    mock = MagicMock(side_effect=[False, True])
    with patch.dict(boto_lc.__salt__, {&quot;boto_asg.launch_configuration_exists&quot;: mock}):
        comt = &quot;Launch configuration does not exist.&quot;
        ret.update({&quot;comment&quot;: comt})
        assert boto_lc.absent(name) == ret

        with patch.dict(boto_lc.__opts__, {&quot;test&quot;: True}):
            comt = &quot;Launch configuration set to be deleted.&quot;
            ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
            assert boto_lc.absent(name) == ret
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_serverdensity_device.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
<A NAME="0"></A>    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;

<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match7921-0.html#0',2,'match7921-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>import pytest
import salt.states.serverdensity_device as serverdensity_device
from tests.support.mock import MagicMock, patch


@pytest.fixture
def configure_loader_modules():
    return {serverdensity_device: {}}


def test_monitored():
    &quot;&quot;&quot;
    Test to device is monitored with Server Density.
    &quot;&quot;&quot;
    name = &quot;my_special_server&quot;

    ret =</B></FONT> {&quot;name&quot;: name, &quot;changes&quot;: {}, &quot;result&quot;: True, &quot;comment&quot;: &quot;&quot;}

    mock_dict = MagicMock(return_value={&quot;id&quot;: name})
    mock_t = MagicMock(side_effect=[True, {&quot;agentKey&quot;: True}, [{&quot;agentKey&quot;: True}]])
    mock_sd = MagicMock(side_effect=[[&quot;sd-agent&quot;], [], True])
    with patch.multiple(
        serverdensity_device,
        __salt__={
            &quot;status.all_status&quot;: mock_dict,
            &quot;grains.items&quot;: mock_dict,
            &quot;serverdensity_device.ls&quot;: mock_t,
            &quot;pkg.list_pkgs&quot;: mock_sd,
            &quot;serverdensity_device.install_agent&quot;: mock_sd,
        },
        __opts__={&quot;test&quot;: False},
    ):
        comt = (
            &quot;Such server name already exists in this&quot;
            &quot; Server Density account. And sd-agent is installed&quot;
        )
        ret.update({&quot;comment&quot;: comt})
        assert serverdensity_device.monitored(name) == ret

        comt = &quot;Successfully installed agent and created device in Server Density db.&quot;
        ret.update(
            {
                &quot;comment&quot;: comt,
                &quot;changes&quot;: {
                    &quot;created_device&quot;: {&quot;agentKey&quot;: True},
                    &quot;installed_agent&quot;: True,
                },
            }
        )
        assert serverdensity_device.monitored(name) == ret
</PRE>
</div>
  </div>
</body>
</html>
