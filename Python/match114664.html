<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for mitele.py &amp; instagram.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for mitele.py &amp; instagram.py
      </h3>
<h1 align="center">
        3.8%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>mitele.py (17.910448%)<th>instagram.py (2.1276596%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(63-66)<td><a href="#" name="0">(397-402)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>mitele.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 from .telecinco import TelecincoIE
3 from ..utils import (
4     int_or_none,
5     parse_iso8601,
6 )
7 class MiTeleIE(TelecincoIE):
8     IE_DESC = 'mitele.es'
9     _VALID_URL = r'https?://(?:www\.)?mitele\.es/(?:[^/]+/)+(?P&lt;id&gt;[^/]+)/player'
10     _TESTS = [{
11         'url': 'http://www.mitele.es/programas-tv/diario-de/57b0dfb9c715da65618b4afa/player',
12         'info_dict': {
13             'id': 'FhYW1iNTE6J6H7NkQRIEzfne6t2quqPg',
14             'ext': 'mp4',
15             'title': 'Diario de La redacci√≥n Programa 144',
16             'description': 'md5:07c35a7b11abb05876a6a79185b58d27',
17             'series': 'Diario de',
18             'season': 'Season 14',
19             'season_number': 14,
20             'episode': 'Tor, la web invisible',
21             'episode_number': 3,
22             'thumbnail': r're:(?i)^https?://.*\.jpg$',
23             'duration': 2913,
24             'age_limit': 16,
25             'timestamp': 1471209401,
26             'upload_date': '20160814',
27         },
28     }, {
29         'url': 'http://www.mitele.es/programas-tv/cuarto-milenio/57b0de3dc915da14058b4876/player',
30         'info_dict': {
31             'id': 'oyNG1iNTE6TAPP-JmCjbwfwJqqMMX3Vq',
32             'ext': 'mp4',
33             'title': 'Cuarto Milenio Temporada 6 Programa 226',
34             'description': 'md5:5ff132013f0cd968ffbf1f5f3538a65f',
35             'series': 'Cuarto Milenio',
36             'season': 'Season 6',
37             'season_number': 6,
38             'episode': 'Episode 24',
39             'episode_number': 24,
40             'thumbnail': r're:(?i)^https?://.*\.jpg$',
41             'duration': 7313,
42             'age_limit': 12,
43             'timestamp': 1471209021,
44             'upload_date': '20160814',
45         },
46         'params': {
47             'skip_download': True,
48         },
49     }, {
50         'url': 'http://www.mitele.es/series-online/la-que-se-avecina/57aac5c1c915da951a8b45ed/player',
51         'only_matching': True,
52     }, {
53         'url': 'https://www.mitele.es/programas-tv/diario-de/la-redaccion/programa-144-40_1006364575251/player/',
54     }]
55     <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>def _real_extract(self, url):
56         display_id = self._match_id(url)
57         webpage = self._download_webpage(url, display_id)
58         pre_player = self._parse_json(self._search_regex(</b></font>
59             r'window\.\$REACTBASE_STATE\.prePlayer_mtweb\s*=\s*({.+})',
60             webpage, 'Pre Player'), display_id)['prePlayer']
61         title = pre_player['title']
62         video_info = self._parse_content(pre_player['video'], url)
63         content = pre_player.get('content') or {}
64         info = content.get('info') or {}
65         video_info.update({
66             'title': title,
67             'description': info.get('synopsis'),
68             'series': content.get('title'),
69             'season_number': int_or_none(info.get('season_number')),
70             'episode': content.get('subtitle'),
71             'episode_number': int_or_none(info.get('episode_number')),
72             'duration': int_or_none(info.get('duration')),
73             'age_limit': int_or_none(info.get('rating')),
74             'timestamp': parse_iso8601(pre_player.get('publishedTime')),
75         })
76         return video_info
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>instagram.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 import itertools
3 import hashlib
4 import json
5 import re
6 from .common import InfoExtractor
7 from ..compat import (
8     compat_str,
9     compat_HTTPError,
10 )
11 from ..utils import (
12     ExtractorError,
13     float_or_none,
14     get_element_by_attribute,
15     int_or_none,
16     lowercase_escape,
17     std_headers,
18     try_get,
19     url_or_none,
20 )
21 class InstagramIE(InfoExtractor):
22     _VALID_URL = r'(?P&lt;url&gt;https?://(?:www\.)?instagram\.com/(?:p|tv|reel)/(?P&lt;id&gt;[^/?#&amp;]+))'
23     _TESTS = [{
24         'url': 'https://instagram.com/p/aye83DjauH/?foo=bar#abc',
25         'md5': '0d2da106a9d2631273e192b372806516',
26         'info_dict': {
27             'id': 'aye83DjauH',
28             'ext': 'mp4',
29             'title': 'Video by naomipq',
30             'description': 'md5:1f17f0ab29bd6fe2bfad705f58de3cb8',
31             'thumbnail': r're:^https?://.*\.jpg',
32             'duration': 0,
33             'timestamp': 1371748545,
34             'upload_date': '20130620',
35             'uploader_id': 'naomipq',
36             'uploader': 'B E A U T Y  F O R  A S H E S',
37             'like_count': int,
38             'comment_count': int,
39             'comments': list,
40         },
41     }, {
42         'url': 'https://www.instagram.com/p/BA-pQFBG8HZ/?taken-by=britneyspears',
43         'info_dict': {
44             'id': 'BA-pQFBG8HZ',
45             'ext': 'mp4',
46             'title': 'Video by britneyspears',
47             'thumbnail': r're:^https?://.*\.jpg',
48             'duration': 0,
49             'timestamp': 1453760977,
50             'upload_date': '20160125',
51             'uploader_id': 'britneyspears',
52             'uploader': 'Britney Spears',
53             'like_count': int,
54             'comment_count': int,
55             'comments': list,
56         },
57         'params': {
58             'skip_download': True,
59         },
60     }, {
61         'url': 'https://www.instagram.com/p/BQ0eAlwhDrw/',
62         'playlist': [{
63             'info_dict': {
64                 'id': 'BQ0dSaohpPW',
65                 'ext': 'mp4',
66                 'title': 'Video 1',
67             },
68         }, {
69             'info_dict': {
70                 'id': 'BQ0dTpOhuHT',
71                 'ext': 'mp4',
72                 'title': 'Video 2',
73             },
74         }, {
75             'info_dict': {
76                 'id': 'BQ0dT7RBFeF',
77                 'ext': 'mp4',
78                 'title': 'Video 3',
79             },
80         }],
81         'info_dict': {
82             'id': 'BQ0eAlwhDrw',
83             'title': 'Post by instagram',
84             'description': 'md5:0f9203fc6a2ce4d228da5754bcf54957',
85         },
86     }, {
87         'url': 'https://www.instagram.com/tv/BkfuX9UB-eK/',
88         'info_dict': {
89             'id': 'BkfuX9UB-eK',
90             'ext': 'mp4',
91             'title': 'Fingerboarding Tricks with @cass.fb',
92             'thumbnail': r're:^https?://.*\.jpg',
93             'duration': 53.83,
94             'timestamp': 1530032919,
95             'upload_date': '20180626',
96             'uploader_id': 'instagram',
97             'uploader': 'Instagram',
98             'like_count': int,
99             'comment_count': int,
100             'comments': list,
101             'description': 'Meet Cass Hirst (@cass.fb), a fingerboarding pro who can perform tiny ollies and kickflips while blindfolded.',
102         }
103     }, {
104         'url': 'https://instagram.com/p/-Cmh1cukG2/',
105         'only_matching': True,
106     }, {
107         'url': 'http://instagram.com/p/9o6LshA7zy/embed/',
108         'only_matching': True,
109     }, {
110         'url': 'https://www.instagram.com/tv/aye83DjauH/',
111         'only_matching': True,
112     }, {
113         'url': 'https://www.instagram.com/reel/CDUMkliABpa/',
114         'only_matching': True,
115     }]
116     @staticmethod
117     def _extract_embed_url(webpage):
118         mobj = re.search(
119             r'&lt;iframe[^&gt;]+src=(["\'])(?P&lt;url&gt;(?:https?:)?//(?:www\.)?instagram\.com/p/[^/]+/embed.*?)\1',
120             webpage)
121         if mobj:
122             return mobj.group('url')
123         blockquote_el = get_element_by_attribute(
124             'class', 'instagram-media', webpage)
125         if blockquote_el is None:
126             return
127         mobj = re.search(
128             r'&lt;a[^&gt;]+href=([\'"])(?P&lt;link&gt;[^\'"]+)\1', blockquote_el)
129         if mobj:
130             return mobj.group('link')
131     def _real_extract(self, url):
132         mobj = re.match(self._VALID_URL, url)
133         video_id = mobj.group('id')
134         url = mobj.group('url')
135         webpage = self._download_webpage(url, video_id)
136         (media, video_url, description, thumbnail, timestamp, uploader,
137          uploader_id, like_count, comment_count, comments, height,
138          width) = [None] * 12
139         shared_data = self._parse_json(
140             self._search_regex(
141                 r'window\._sharedData\s*=\s*({.+?});',
142                 webpage, 'shared data', default='{}'),
143             video_id, fatal=False)
144         if shared_data:
145             media = try_get(
146                 shared_data,
147                 (lambda x: x['entry_data']['PostPage'][0]['graphql']['shortcode_media'],
148                  lambda x: x['entry_data']['PostPage'][0]['media']),
149                 dict)
150         if not media:
151             additional_data = self._parse_json(
152                 self._search_regex(
153                     r'window\.__additionalDataLoaded\s*\(\s*[^,]+,\s*({.+?})\s*\)\s*;',
154                     webpage, 'additional data', default='{}'),
155                 video_id, fatal=False)
156             if additional_data:
157                 media = try_get(
158                     additional_data, lambda x: x['graphql']['shortcode_media'],
159                     dict)
160         if media:
161             video_url = media.get('video_url')
162             height = int_or_none(media.get('dimensions', {}).get('height'))
163             width = int_or_none(media.get('dimensions', {}).get('width'))
164             description = try_get(
165                 media, lambda x: x['edge_media_to_caption']['edges'][0]['node']['text'],
166                 compat_str) or media.get('caption')
167             title = media.get('title')
168             thumbnail = media.get('display_src') or media.get('display_url')
169             duration = float_or_none(media.get('video_duration'))
170             timestamp = int_or_none(media.get('taken_at_timestamp') or media.get('date'))
171             uploader = media.get('owner', {}).get('full_name')
172             uploader_id = media.get('owner', {}).get('username')
173             def get_count(keys, kind):
174                 if not isinstance(keys, (list, tuple)):
175                     keys = [keys]
176                 for key in keys:
177                     count = int_or_none(try_get(
178                         media, (lambda x: x['edge_media_%s' % key]['count'],
179                                 lambda x: x['%ss' % kind]['count'])))
180                     if count is not None:
181                         return count
182             like_count = get_count('preview_like', 'like')
183             comment_count = get_count(
184                 ('preview_comment', 'to_comment', 'to_parent_comment'), 'comment')
185             comments = [{
186                 'author': comment.get('user', {}).get('username'),
187                 'author_id': comment.get('user', {}).get('id'),
188                 'id': comment.get('id'),
189                 'text': comment.get('text'),
190                 'timestamp': int_or_none(comment.get('created_at')),
191             } for comment in media.get(
192                 'comments', {}).get('nodes', []) if comment.get('text')]
193             if not video_url:
194                 edges = try_get(
195                     media, lambda x: x['edge_sidecar_to_children']['edges'],
196                     list) or []
197                 if edges:
198                     entries = []
199                     for edge_num, edge in enumerate(edges, start=1):
200                         node = try_get(edge, lambda x: x['node'], dict)
201                         if not node:
202                             continue
203                         node_video_url = url_or_none(node.get('video_url'))
204                         if not node_video_url:
205                             continue
206                         entries.append({
207                             'id': node.get('shortcode') or node['id'],
208                             'title': node.get('title') or 'Video %d' % edge_num,
209                             'url': node_video_url,
210                             'thumbnail': node.get('display_url'),
211                             'duration': float_or_none(node.get('video_duration')),
212                             'width': int_or_none(try_get(node, lambda x: x['dimensions']['width'])),
213                             'height': int_or_none(try_get(node, lambda x: x['dimensions']['height'])),
214                             'view_count': int_or_none(node.get('video_view_count')),
215                         })
216                     return self.playlist_result(
217                         entries, video_id,
218                         'Post by %s' % uploader_id if uploader_id else None,
219                         description)
220         if not video_url:
221             video_url = self._og_search_video_url(webpage, secure=False)
222         formats = [{
223             'url': video_url,
224             'width': width,
225             'height': height,
226         }]
227         if not uploader_id:
228             uploader_id = self._search_regex(
229                 r'"owner"\s*:\s*{\s*"username"\s*:\s*"(.+?)"',
230                 webpage, 'uploader id', fatal=False)
231         if not description:
232             description = self._search_regex(
233                 r'"caption"\s*:\s*"(.+?)"', webpage, 'description', default=None)
234             if description is not None:
235                 description = lowercase_escape(description)
236         if not thumbnail:
237             thumbnail = self._og_search_thumbnail(webpage)
238         return {
239             'id': video_id,
240             'formats': formats,
241             'ext': 'mp4',
242             'title': title or 'Video by %s' % uploader_id,
243             'description': description,
244             'duration': duration,
245             'thumbnail': thumbnail,
246             'timestamp': timestamp,
247             'uploader_id': uploader_id,
248             'uploader': uploader,
249             'like_count': like_count,
250             'comment_count': comment_count,
251             'comments': comments,
252         }
253 class InstagramPlaylistIE(InfoExtractor):
254     _gis_tmpl = None  # used to cache GIS request type
255     def _parse_graphql(self, webpage, item_id):
256         return self._parse_json(
257             self._search_regex(
258                 r'sharedData\s*=\s*({.+?})\s*;\s*[&lt;\n]', webpage, 'data'),
259             item_id)
260     def _extract_graphql(self, data, url):
261         def get_count(suffix):
262             return int_or_none(try_get(
263                 node, lambda x: x['edge_media_' + suffix]['count']))
264         uploader_id = self._match_id(url)
265         csrf_token = data['config']['csrf_token']
266         rhx_gis = data.get('rhx_gis') or '3c7ca9dcefcf966d11dacf1f151335e8'
267         cursor = ''
268         for page_num in itertools.count(1):
269             variables = {
270                 'first': 12,
271                 'after': cursor,
272             }
273             variables.update(self._query_vars_for(data))
274             variables = json.dumps(variables)
275             if self._gis_tmpl:
276                 gis_tmpls = [self._gis_tmpl]
277             else:
278                 gis_tmpls = [
279                     '%s' % rhx_gis,
280                     '',
281                     '%s:%s' % (rhx_gis, csrf_token),
282                     '%s:%s:%s' % (rhx_gis, csrf_token, std_headers['User-Agent']),
283                 ]
284             for gis_tmpl in gis_tmpls:
285                 try:
286                     json_data = self._download_json(
287                         'https://www.instagram.com/graphql/query/', uploader_id,
288                         'Downloading JSON page %d' % page_num, headers={
289                             'X-Requested-With': 'XMLHttpRequest',
290                             'X-Instagram-GIS': hashlib.md5(
291                                 ('%s:%s' % (gis_tmpl, variables)).encode('utf-8')).hexdigest(),
292                         }, query={
293                             'query_hash': self._QUERY_HASH,
294                             'variables': variables,
295                         })
296                     media = self._parse_timeline_from(json_data)
297                     self._gis_tmpl = gis_tmpl
298                     break
299                 except ExtractorError as e:
300                     if isinstance(e.cause, compat_HTTPError) and e.cause.code == 403:
301                         if gis_tmpl != gis_tmpls[-1]:
302                             continue
303                     raise
304             edges = media.get('edges')
305             if not edges or not isinstance(edges, list):
306                 break
307             for edge in edges:
308                 node = edge.get('node')
309                 if not node or not isinstance(node, dict):
310                     continue
311                 if node.get('__typename') != 'GraphVideo' and node.get('is_video') is not True:
312                     continue
313                 video_id = node.get('shortcode')
314                 if not video_id:
315                     continue
316                 info = self.url_result(
317                     'https://instagram.com/p/%s/' % video_id,
318                     ie=InstagramIE.ie_key(), video_id=video_id)
319                 description = try_get(
320                     node, lambda x: x['edge_media_to_caption']['edges'][0]['node']['text'],
321                     compat_str)
322                 thumbnail = node.get('thumbnail_src') or node.get('display_src')
323                 timestamp = int_or_none(node.get('taken_at_timestamp'))
324                 comment_count = get_count('to_comment')
325                 like_count = get_count('preview_like')
326                 view_count = int_or_none(node.get('video_view_count'))
327                 info.update({
328                     'description': description,
329                     'thumbnail': thumbnail,
330                     'timestamp': timestamp,
331                     'comment_count': comment_count,
332                     'like_count': like_count,
333                     'view_count': view_count,
334                 })
335                 yield info
336             page_info = media.get('page_info')
337             if not page_info or not isinstance(page_info, dict):
338                 break
339             has_next_page = page_info.get('has_next_page')
340             if not has_next_page:
341                 break
342             cursor = page_info.get('end_cursor')
343                 break
344     <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>def _real_extract(self, url):
345         user_or_tag = self._match_id(url)
346         webpage = self._download_webpage(url, user_or_tag)
347         data = self._parse_graphql(webpage, user_or_tag)
348         self._set_cookie(</b></font>'instagram.com', 'ig_pr', '1')
349         return self.playlist_result(
350             self._extract_graphql(data, url), user_or_tag, user_or_tag)
351 class InstagramUserIE(InstagramPlaylistIE):
352     _VALID_URL = r'https?://(?:www\.)?instagram\.com/(?P&lt;id&gt;[^/]{2,})/?(?:$|[?#])'
353     IE_DESC = 'Instagram user profile'
354     IE_NAME = 'instagram:user'
355     _TEST = {
356         'url': 'https://instagram.com/porsche',
357         'info_dict': {
358             'id': 'porsche',
359             'title': 'porsche',
360         },
361         'playlist_count': 5,
362         'params': {
363             'extract_flat': True,
364             'skip_download': True,
365             'playlistend': 5,
366         }
367     }
368     _QUERY_HASH = '42323d64886122307be10013ad2dcc44',
369     @staticmethod
370     def _parse_timeline_from(data):
371         return data['data']['user']['edge_owner_to_timeline_media']
372     @staticmethod
373     def _query_vars_for(data):
374         return {
375             'id': data['entry_data']['ProfilePage'][0]['graphql']['user']['id']
376         }
377 class InstagramTagIE(InstagramPlaylistIE):
378     _VALID_URL = r'https?://(?:www\.)?instagram\.com/explore/tags/(?P&lt;id&gt;[^/]+)'
379     IE_DESC = 'Instagram hashtag search'
380     IE_NAME = 'instagram:tag'
381     _TEST = {
382         'url': 'https://instagram.com/explore/tags/lolcats',
383         'info_dict': {
384             'id': 'lolcats',
385             'title': 'lolcats',
386         },
387         'playlist_count': 50,
388         'params': {
389             'extract_flat': True,
390             'skip_download': True,
391             'playlistend': 50,
392         }
393     }
394     _QUERY_HASH = 'f92f56d47dc7a55b606908374b43a314',
395     @staticmethod
396     def _parse_timeline_from(data):
397         return data['data']['hashtag']['edge_hashtag_to_media']
398     @staticmethod
399     def _query_vars_for(data):
400         return {
401             'tag_name':
402                 data['entry_data']['TagPage'][0]['graphql']['hashtag']['name']
403         }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
