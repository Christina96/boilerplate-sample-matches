
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 22, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-tools.py</h3>
            <pre><code>1  import json
2  import math
3  import os
4  import random
5  import re
6  import secrets
7  import ssl
8  from io import BytesIO
9  from json.decoder import JSONDecodeError
10  from traceback import format_exc
11  import requests
12  from .. import *
13  from ..exceptions import DependencyMissingError
14  from . import some_random_headers
15  from .helper import async_searcher, bash, run_async
16  try:
17      import certifi
18  except ImportError:
19      certifi = None
20  try:
21      from PIL import Image, ImageDraw, ImageFont
22  except ImportError:
23      Image, ImageDraw, ImageFont = None, None, None
24      LOGS.info(&quot;PIL not installed!&quot;)
25  from urllib.parse import quote, unquote
26  from telethon import Button
27  from telethon.tl.types import DocumentAttributeAudio, DocumentAttributeVideo
28  if run_as_module:
29      from ..dB.filestore_db import get_stored_msg, store_msg
30  try:
31      import numpy as np
32  except ImportError:
33      np = None
34  try:
35      from telegraph import Telegraph
36  except ImportError:
37      Telegraph = None
38  try:
39      from bs4 import BeautifulSoup
40  except ImportError:
41      BeautifulSoup = None
42  async def get_ofox(codename):
43      ofox_baseurl = &quot;https://api.orangefox.download/v3/&quot;
44      releases = await async_searcher(
45          ofox_baseurl + &quot;releases?codename=&quot; + codename, re_json=True
46      )
47      device = await async_searcher(
48          ofox_baseurl + &quot;devices/get?codename=&quot; + codename, re_json=True
49      )
50      return device, releases
51  def _unquote_text(text):
52      return text.replace(&quot;&#x27;&quot;, unquote(&quot;%5C%27&quot;)).replace(&#x27;&quot;&#x27;, unquote(&quot;%5C%22&quot;))
53  def json_parser(data, indent=None, ascii=False):
54      parsed = {}
55      try:
56          if isinstance(data, str):
57              parsed = json.loads(str(data))
58              if indent:
59                  parsed = json.dumps(
60                      json.loads(str(data)), indent=indent, ensure_ascii=ascii
61                  )
62          elif isinstance(data, dict):
63              parsed = data
64              if indent:
65                  parsed = json.dumps(data, indent=indent, ensure_ascii=ascii)
66      except JSONDecodeError:
67          parsed = eval(data)
68      return parsed
69  async def is_url_ok(url: str):
70      try:
71          return await async_searcher(url, head=True)
72      except BaseException as er:
73          LOGS.debug(er)
74          return False
75  async def metadata(file):
76      out, _ = await bash(f&#x27;mediainfo &quot;{_unquote_text(file)}&quot; --Output=JSON&#x27;)
77      if _ and _.endswith(&quot;NOT_FOUND&quot;):
78          raise DependencyMissingError(
79              f&quot;&#x27;{_}&#x27; is not installed!\nInstall it to use this command.&quot;
80          )
81      data = {}
82      _info = json.loads(out)[&quot;media&quot;][&quot;track&quot;]
83      info = _info[0]
84      if info.get(&quot;Format&quot;) in [&quot;GIF&quot;, &quot;PNG&quot;]:
85          return {
86              &quot;height&quot;: _info[1][&quot;Height&quot;],
87              &quot;width&quot;: _info[1][&quot;Width&quot;],
88              &quot;bitrate&quot;: _info[1].get(&quot;BitRate&quot;, 320),
89          }
90      if info.get(&quot;AudioCount&quot;):
91          data[&quot;title&quot;] = info.get(&quot;Title&quot;, file)
92          data[&quot;performer&quot;] = info.get(&quot;Performer&quot;) or udB.get_key(&quot;artist&quot;) or &quot;&quot;
93      if info.get(&quot;VideoCount&quot;):
94          data[&quot;height&quot;] = int(float(_info[1].get(&quot;Height&quot;, 720)))
95          data[&quot;width&quot;] = int(float(_info[1].get(&quot;Width&quot;, 1280)))
96          data[&quot;bitrate&quot;] = int(_info[1].get(&quot;BitRate&quot;, 320))
97      data[&quot;duration&quot;] = int(float(info.get(&quot;Duration&quot;, 0)))
98      return data
99  async def set_attributes(file):
100      data = await metadata(file)
101      if not data:
102          return None
103      if &quot;width&quot; in data:
104          return [
105              DocumentAttributeVideo(
<span onclick='openModal()' class='match'>106                  duration=data.get(&quot;duration&quot;, 0),
107                  w=data.get(&quot;width&quot;, 512),
108                  h=data.get(&quot;height&quot;, 512),
</span>109                  supports_streaming=True,
110              )
111          ]
112      ext = &quot;.&quot; + file.split(&quot;.&quot;)[-1]
113      return [
114          DocumentAttributeAudio(
115              duration=data.get(&quot;duration&quot;, 0),
116              title=data.get(&quot;title&quot;, file.split(&quot;/&quot;)[-1].replace(ext, &quot;&quot;)),
117              performer=data.get(&quot;performer&quot;),
118          )
119      ]
120  def get_msg_button(texts: str):
121      btn = []
122      for z in re.findall(&quot;\\[(.*?)\\|(.*?)\\]&quot;, texts):
123          text, url = z
124          urls = url.split(&quot;|&quot;)
125          url = urls[0]
126          if len(urls) &gt; 1:
127              btn[-1].append([text, url])
128          else:
129              btn.append([[text, url]])
130      txt = texts
131      for z in re.findall(&quot;\\[.+?\\|.+?\\]&quot;, texts):
132          txt = txt.replace(z, &quot;&quot;)
133      return txt.strip(), btn
134  def create_tl_btn(button: list):
135      btn = []
136      for z in button:
137          if len(z) &gt; 1:
138              kk = [Button.url(x, y.strip()) for x, y in z]
139              btn.append(kk)
140          else:
141              btn.append([Button.url(z[0][0], z[0][1].strip())])
142      return btn
143  def format_btn(buttons: list):
144      txt = &quot;&quot;
145      for i in buttons:
146          a = 0
147          for i in i:
148              if hasattr(i.button, &quot;url&quot;):
149                  a += 1
150                  if a &gt; 1:
151                      txt += f&quot;[{i.button.text} | {i.button.url} | same]&quot;
152                  else:
153                      txt += f&quot;[{i.button.text} | {i.button.url}]&quot;
154      _, btn = get_msg_button(txt)
155      return btn
156  async def saavn_search(query: str):
157      try:
158          data = await async_searcher(
159              url=f&quot;https://saavn-api.vercel.app/search/{query.replace(&#x27; &#x27;, &#x27;%20&#x27;)}&quot;,
160              re_json=True,
161          )
162      except BaseException:
163          data = None
164      return data
165  _webupload_cache = {}
166  async def webuploader(chat_id: int, msg_id: int, uploader: str):
167      file = _webupload_cache[int(chat_id)][int(msg_id)]
168      sites = {
169          &quot;anonfiles&quot;: {&quot;url&quot;: &quot;https://api.anonfiles.com/upload&quot;, &quot;json&quot;: True},
170          &quot;siasky&quot;: {&quot;url&quot;: &quot;https://siasky.net/skynet/skyfile&quot;, &quot;json&quot;: True},
171          &quot;file.io&quot;: {&quot;url&quot;: &quot;https://file.io&quot;, &quot;json&quot;: True},
172          &quot;bayfiles&quot;: {&quot;url&quot;: &quot;https://api.bayfiles.com/upload&quot;, &quot;json&quot;: True},
173          &quot;x0.at&quot;: {&quot;url&quot;: &quot;https://x0.at/&quot;, &quot;json&quot;: False},
174          &quot;transfer&quot;: {&quot;url&quot;: &quot;https://transfer.sh&quot;, &quot;json&quot;: False},
175      }
176      if uploader and uploader in sites:
177          url = sites[uploader][&quot;url&quot;]
178          json = sites[uploader][&quot;json&quot;]
179      with open(file, &quot;rb&quot;) as data:
180          status = await async_searcher(
181              url, data={&quot;file&quot;: data.read()}, post=True, re_json=json
182          )
183      if isinstance(status, dict):
184          if &quot;skylink&quot; in status:
185              return f&quot;https://siasky.net/{status[&#x27;skylink&#x27;]}&quot;
186          if status[&quot;status&quot;] == 200 or status[&quot;status&quot;] is True:
187              try:
188                  link = status[&quot;link&quot;]
189              except KeyError:
190                  link = status[&quot;data&quot;][&quot;file&quot;][&quot;url&quot;][&quot;short&quot;]
191              return link
192      del _webupload_cache[int(chat_id)][int(msg_id)]
193      return status
194  def get_all_files(path, extension=None):
195      filelist = []
196      for root, dirs, files in os.walk(path):
197          for file in files:
198              if not (extension and not file.endswith(extension)):
199                  filelist.append(os.path.join(root, file))
200      return sorted(filelist)
201  def text_set(text):
202      lines = []
203      if len(text) &lt;= 55:
204          lines.append(text)
205      else:
206          all_lines = text.split(&quot;\n&quot;)
207          for line in all_lines:
208              if len(line) &lt;= 55:
209                  lines.append(line)
210              else:
211                  k = len(line) // 55
212                  for z in range(1, k + 2):
213                      lines.append(line[((z - 1) * 55) : (z * 55)])
214      return lines[:25]
215  class LogoHelper:
216      @staticmethod
217      def get_text_size(text, image, font):
218          im = Image.new(&quot;RGB&quot;, (image.width, image.height))
219          draw = ImageDraw.Draw(im)
220          return draw.textsize(text, font)
221      @staticmethod
222      def find_font_size(text, font, image, target_width_ratio):
223          tested_font_size = 100
224          tested_font = ImageFont.truetype(font, tested_font_size)
225          observed_width, observed_height = LogoHelper.get_text_size(
226              text, image, tested_font
227          )
228          estimated_font_size = (
229              tested_font_size / (observed_width / image.width) * target_width_ratio
230          )
231          return round(estimated_font_size)
232      @staticmethod
233      def make_logo(imgpath, text, funt, **args):
234          fill = args.get(&quot;fill&quot;)
235          width_ratio = args.get(&quot;width_ratio&quot;) or 0.7
236          stroke_width = int(args.get(&quot;stroke_width&quot;))
237          stroke_fill = args.get(&quot;stroke_fill&quot;)
238          img = Image.open(imgpath)
239          width, height = img.size
240          draw = ImageDraw.Draw(img)
241          font_size = LogoHelper.find_font_size(text, funt, img, width_ratio)
242          font = ImageFont.truetype(funt, font_size)
243          w, h = draw.textsize(text, font=font)
244          draw.text(
245              ((width - w) / 2, (height - h) / 2),
246              text,
247              font=font,
248              fill=fill,
249              stroke_width=stroke_width,
250              stroke_fill=stroke_fill,
251          )
252          file_name = check_filename(&quot;logo.png&quot;)
253          img.save(file_name, &quot;PNG&quot;)
254          return file_name
255  async def get_paste(data: str, extension: str = &quot;txt&quot;):
256      ssl_context = ssl.create_default_context(cafile=certifi.where())
257      json = {&quot;content&quot;: data, &quot;extension&quot;: extension}
258      key = await async_searcher(
259          url=&quot;https://spaceb.in/api/v1/documents/&quot;,
260          json=json,
261          ssl=ssl_context,
262          post=True,
263          re_json=True,
264      )
265      try:
266          return True, key[&quot;payload&quot;][&quot;id&quot;]
267      except KeyError:
268          if &quot;the length must be between 2 and 400000.&quot; in key[&quot;error&quot;]:
269              return await get_paste(data[-400000:], extension=extension)
270          return False, key[&quot;error&quot;]
271      except Exception as e:
272          LOGS.info(e)
273          return None, str(e)
274  async def get_google_images(query):
275      soup = BeautifulSoup(
276          await async_searcher(
277              &quot;https://google.com/search&quot;,
278              params={&quot;q&quot;: query, &quot;tbm&quot;: &quot;isch&quot;},
279              headers={&quot;User-Agent&quot;: random.choice(some_random_headers)},
280          ),
281          &quot;lxml&quot;,
282      )
283      google_images = []
284      all_script_tags = soup.select(&quot;script&quot;)
285      matched_images_data = &quot;&quot;.join(
286          re.findall(r&quot;AF_initDataCallback\(([^&lt;]+)\);&quot;, str(all_script_tags))
287      )
288      matched_images_data_fix = json.dumps(matched_images_data)
289      matched_images_data_json = json.loads(matched_images_data_fix)
290      matched_google_image_data = re.findall(
291          r&quot;\&quot;b-GRID_STATE0\&quot;(.*)sideChannel:\s?{}}&quot;, matched_images_data_json
292      )
293      matched_google_images_thumbnails = &quot;, &quot;.join(
294          re.findall(
295              r&quot;\[\&quot;(https\:\/\/encrypted-tbn0\.gstatic\.com\/images\?.*?)\&quot;,\d+,\d+\]&quot;,
296              str(matched_google_image_data),
297          )
298      ).split(&quot;, &quot;)
299      thumbnails = [
300          bytes(bytes(thumbnail, &quot;ascii&quot;).decode(&quot;unicode-escape&quot;), &quot;ascii&quot;).decode(
301              &quot;unicode-escape&quot;
302          )
303          for thumbnail in matched_google_images_thumbnails
304      ]
305      removed_matched_google_images_thumbnails = re.sub(
306          r&quot;\[\&quot;(https\:\/\/encrypted-tbn0\.gstatic\.com\/images\?.*?)\&quot;,\d+,\d+\]&quot;,
307          &quot;&quot;,
308          str(matched_google_image_data),
309      )
310      matched_google_full_resolution_images = re.findall(
311          r&quot;(?:&#x27;|,),\[\&quot;(https:|http.*?)\&quot;,\d+,\d+\]&quot;,
312          removed_matched_google_images_thumbnails,
313      )
314      full_res_images = [
315          bytes(bytes(img, &quot;ascii&quot;).decode(&quot;unicode-escape&quot;), &quot;ascii&quot;).decode(
316              &quot;unicode-escape&quot;
317          )
318          for img in matched_google_full_resolution_images
319      ]
320      for index, (metadata, thumbnail, original) in enumerate(
321          zip(soup.select(&quot;.isv-r.PNCib.MSM1fd.BUooTd&quot;), thumbnails, full_res_images),
322          start=1,
323      ):
324          google_images.append(
325              {
326                  &quot;title&quot;: metadata.select_one(&quot;.VFACy.kGQAp.sMi44c.lNHeqe.WGvvNb&quot;)[
327                      &quot;title&quot;
328                  ],
329                  &quot;link&quot;: metadata.select_one(&quot;.VFACy.kGQAp.sMi44c.lNHeqe.WGvvNb&quot;)[
330                      &quot;href&quot;
331                  ],
332                  &quot;source&quot;: metadata.select_one(&quot;.fxgdke&quot;).text,
333                  &quot;thumbnail&quot;: thumbnail,
334                  &quot;original&quot;: original,
335              }
336          )
337      random.shuffle(google_images)
338      return google_images
339  async def get_chatbot_reply(message):
340      chatbot_base = &quot;https://kuki-api-lac.vercel.app/message={}&quot;
341      req_link = chatbot_base.format(
342          message,
343      )
344      try:
345          return (await async_searcher(req_link, re_json=True)).get(&quot;reply&quot;)
346      except Exception:
347          LOGS.info(f&quot;**ERROR:**`{format_exc()}`&quot;)
348  def check_filename(filroid):
349      if os.path.exists(filroid):
350          no = 1
351          while True:
352              ult = &quot;{0}_{2}{1}&quot;.format(*os.path.splitext(filroid) + (no,))
353              if os.path.exists(ult):
354                  no += 1
355              else:
356                  return ult
357      return filroid
358  async def genss(file):
359      return (await metadata(file)).get(&quot;duration&quot;)
360  async def duration_s(file, stime):
361      tsec = await genss(file)
362      x = round(tsec / 5)
363      y = round(tsec / 5 + int(stime))
364      pin = stdr(x)
365      pon = stdr(y) if y &lt; tsec else stdr(tsec)
366      return pin, pon
367  def stdr(seconds):
368      minutes, seconds = divmod(seconds, 60)
369      hours, minutes = divmod(minutes, 60)
370      if len(str(minutes)) == 1:
371          minutes = &quot;0&quot; + str(minutes)
372      if len(str(hours)) == 1:
373          hours = &quot;0&quot; + str(hours)
374      if len(str(seconds)) == 1:
375          seconds = &quot;0&quot; + str(seconds)
376      return (
377          ((str(hours) + &quot;:&quot;) if hours else &quot;00:&quot;)
378          + ((str(minutes) + &quot;:&quot;) if minutes else &quot;00:&quot;)
379          + ((str(seconds)) if seconds else &quot;&quot;)
380      )
381  def order_points(pts):
382      &quot;get the required points&quot;
383      rect = np.zeros((4, 2), dtype=&quot;float32&quot;)
384      s = pts.sum(axis=1)
385      rect[0] = pts[np.argmin(s)]
386      rect[2] = pts[np.argmax(s)]
387      diff = np.diff(pts, axis=1)
388      rect[1] = pts[np.argmin(diff)]
389      rect[3] = pts[np.argmax(diff)]
390      return rect
391  def four_point_transform(image, pts):
392      try:
393          import cv2
394      except ImportError:
395          raise DependencyMissingError(&quot;This function needs &#x27;cv2&#x27; to be installed.&quot;)
396      rect = order_points(pts)
397      (tl, tr, br, bl) = rect
398      widthA = np.sqrt(((br[0] - bl[0]) ** 2) + ((br[1] - bl[1]) ** 2))
399      widthB = np.sqrt(((tr[0] - tl[0]) ** 2) + ((tr[1] - tl[1]) ** 2))
400      maxWidth = max(int(widthA), int(widthB))
401      heightA = np.sqrt(((tr[0] - br[0]) ** 2) + ((tr[1] - br[1]) ** 2))
402      heightB = np.sqrt(((tl[0] - bl[0]) ** 2) + ((tl[1] - bl[1]) ** 2))
403      maxHeight = max(int(heightA), int(heightB))
404      dst = np.array(
405          [[0, 0], [maxWidth - 1, 0], [maxWidth - 1, maxHeight - 1], [0, maxHeight - 1]],
406          dtype=&quot;float32&quot;,
407      )
408      M = cv2.getPerspectiveTransform(rect, dst)
409      return cv2.warpPerspective(image, M, (maxWidth, maxHeight))
410  TELEGRAPH = []
411  def telegraph_client():
412      if not Telegraph:
413          LOGS.info(&quot;&#x27;Telegraph&#x27; is not Installed!&quot;)
414          return
415      if TELEGRAPH:
416          return TELEGRAPH[0]
417      from .. import udB, ultroid_bot
418      token = udB.get_key(&quot;_TELEGRAPH_TOKEN&quot;)
419      TelegraphClient = Telegraph(token)
420      if token:
421          TELEGRAPH.append(TelegraphClient)
422          return TelegraphClient
423      gd_name = ultroid_bot.full_name
424      short_name = gd_name[:30]
425      profile_url = (
426          f&quot;https://t.me/{ultroid_bot.me.username}&quot;
427          if ultroid_bot.me.username
428          else &quot;https://t.me/TeamUltroid&quot;
429      )
430      try:
431          TelegraphClient.create_account(
432              short_name=short_name, author_name=gd_name, author_url=profile_url
433          )
434      except Exception as er:
435          if &quot;SHORT_NAME_TOO_LONG&quot; in str(er):
436              TelegraphClient.create_account(
437                  short_name=&quot;ultroiduser&quot;, author_name=gd_name, author_url=profile_url
438              )
439          else:
440              LOGS.exception(er)
441              return
442      udB.set_key(&quot;_TELEGRAPH_TOKEN&quot;, TelegraphClient.get_access_token())
443      TELEGRAPH.append(TelegraphClient)
444      return TelegraphClient
445  @run_async
446  def make_html_telegraph(title, html=&quot;&quot;):
447      telegraph = telegraph_client()
448      page = telegraph.create_page(
449          title=title,
450          html_content=html,
451      )
452      return page[&quot;url&quot;]
453  async def Carbon(
454      code,
455      base_url=&quot;https://carbonara.solopov.dev/api/cook&quot;,
456      file_name=&quot;ultroid&quot;,
457      download=False,
458      rayso=False,
459      **kwargs,
460  ):
461      if rayso:
462          base_url = &quot;https://rayso-api-desvhu-33.koyeb.app/generate&quot;
463          kwargs[&quot;text&quot;] = code
464          kwargs[&quot;theme&quot;] = kwargs.get(&quot;theme&quot;, &quot;breeze&quot;)
465          kwargs[&quot;darkMode&quot;] = kwargs.get(&quot;darkMode&quot;, True)
466          kwargs[&quot;title&quot;] = kwargs.get(&quot;title&quot;, &quot;Ultroid&quot;)
467      else:
468          kwargs[&quot;code&quot;] = code
469      con = await async_searcher(base_url, post=True, json=kwargs, re_content=True)
470      if not download:
471          file = BytesIO(con)
472          file.name = file_name + &quot;.jpg&quot;
473      else:
474          try:
475              return json_parser(con.decode())
476          except Exception:
477              pass
478          file = file_name + &quot;.jpg&quot;
479          with open(file, &quot;wb&quot;) as f:
480              f.write(con)
481      return file
482  async def get_file_link(msg):
483      from .. import udB
484      msg_id = await msg.forward_to(udB.get_key(&quot;LOG_CHANNEL&quot;))
485      await msg_id.reply(
486          &quot;**Message has been stored to generate a shareable link. Do not delete it.**&quot;
487      )
488      msg_id = msg_id.id
489      msg_hash = secrets.token_hex(nbytes=8)
490      store_msg(msg_hash, msg_id)
491      return msg_hash
492  async def get_stored_file(event, hash):
493      from .. import udB
494      msg_id = get_stored_msg(hash)
495      if not msg_id:
496          return
497      try:
498          msg = await asst.get_messages(udB.get_key(&quot;LOG_CHANNEL&quot;), ids=msg_id)
499      except Exception as er:
500          LOGS.warning(f&quot;FileStore, Error: {er}&quot;)
501          return
502      if not msg_id:
503          return await asst.send_message(
504              event.chat_id, &quot;__Message was deleted by owner!__&quot;, reply_to=event.id
505          )
506      await asst.send_message(event.chat_id, msg.text, file=msg.media, reply_to=event.id)
507  def _package_rpc(text, lang_src=&quot;auto&quot;, lang_tgt=&quot;auto&quot;):
508      GOOGLE_TTS_RPC = [&quot;MkEWBc&quot;]
509      parameter = [[text.strip(), lang_src, lang_tgt, True], [1]]
510      escaped_parameter = json.dumps(parameter, separators=(&quot;,&quot;, &quot;:&quot;))
511      rpc = [[[random.choice(GOOGLE_TTS_RPC), escaped_parameter, None, &quot;generic&quot;]]]
512      espaced_rpc = json.dumps(rpc, separators=(&quot;,&quot;, &quot;:&quot;))
513      freq = &quot;f.req={}&amp;&quot;.format(quote(espaced_rpc))
514      return freq
515  def translate(*args, **kwargs):
516      headers = {
517          &quot;Referer&quot;: &quot;https://translate.google.co.in&quot;,
518          &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; WOW64) &quot;
519          &quot;AppleWebKit/537.36 (KHTML, like Gecko) &quot;
520          &quot;Chrome/47.0.2526.106 Safari/537.36&quot;,
521          &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded;charset=utf-8&quot;,
522      }
523      x = requests.post(
524          &quot;https://translate.google.co.in/_/TranslateWebserverUi/data/batchexecute&quot;,
525          headers=headers,
526          data=_package_rpc(*args, **kwargs),
527      ).text
528      response = &quot;&quot;
529      data = json.loads(json.loads(x[4:])[0][2])[1][0][0]
530      subind = data[-2]
531      if not subind:
532          subind = data[-1]
533      for i in subind:
534          response += i[0]
535      return response
536  def cmd_regex_replace(cmd):
537      return (
538          cmd.replace(&quot;$&quot;, &quot;&quot;)
539          .replace(&quot;?(.*)&quot;, &quot;&quot;)
540          .replace(&quot;(.*)&quot;, &quot;&quot;)
541          .replace(&quot;(?: |)&quot;, &quot;&quot;)
542          .replace(&quot;| &quot;, &quot;&quot;)
543          .replace(&quot;( |)&quot;, &quot;&quot;)
544          .replace(&quot;?((.|//)*)&quot;, &quot;&quot;)
545          .replace(&quot;?P&lt;shortname&gt;\\w+&quot;, &quot;&quot;)
546          .replace(&quot;(&quot;, &quot;&quot;)
547          .replace(&quot;)&quot;, &quot;&quot;)
548          .replace(&quot;?(\\d+)&quot;, &quot;&quot;)
549      )
550  class LottieException(Exception):
551      ...
552  class TgConverter:
553      @staticmethod
554      async def animated_sticker(file, out_path=&quot;sticker.tgs&quot;, throw=False, remove=False):
555          if out_path.endswith(&quot;webp&quot;):
556              er, out = await bash(
557                  f&quot;lottie_convert.py --webp-quality 100 --webp-skip-frames 100 &#x27;{file}&#x27; &#x27;{out_path}&#x27;&quot;
558              )
559          else:
560              er, out = await bash(f&quot;lottie_convert.py &#x27;{file}&#x27; &#x27;{out_path}&#x27;&quot;)
561          if er and throw:
562              raise LottieException(er)
563          if remove:
564              os.remove(file)
565          if os.path.exists(out_path):
566              return out_path
567      @staticmethod
568      async def animated_to_gif(file, out_path=&quot;gif.gif&quot;):
569          await bash(
570              f&quot;lottie_convert.py &#x27;{_unquote_text(file)}&#x27; &#x27;{_unquote_text(out_path)}&#x27;&quot;
571          )
572          return out_path
573      @staticmethod
574      def resize_photo_sticker(photo):
575          image = Image.open(photo)
576          if (image.width and image.height) &lt; 512:
577              size1 = image.width
578              size2 = image.height
579              if image.width &gt; image.height:
580                  scale = 512 / size1
581                  size1new = 512
582                  size2new = size2 * scale
583              else:
584                  scale = 512 / size2
585                  size1new = size1 * scale
586                  size2new = 512
587              size1new = math.floor(size1new)
588              size2new = math.floor(size2new)
589              sizenew = (size1new, size2new)
590              image = image.resize(sizenew)
591          else:
592              maxsize = (512, 512)
593              image.thumbnail(maxsize)
594          return image
595      @staticmethod
596      async def ffmpeg_convert(input_, output, remove=False):
597          if output.endswith(&quot;.webm&quot;):
598              return await TgConverter.create_webm(
599                  input_, name=output[:-5], remove=remove
600              )
601          if output.endswith(&quot;.gif&quot;):
602              await bash(f&quot;ffmpeg -i &#x27;{input_}&#x27; -an -sn -c:v copy &#x27;{output}.mp4&#x27; -y&quot;)
603          else:
604              await bash(f&quot;ffmpeg -i &#x27;{input_}&#x27; &#x27;{output}&#x27; -y&quot;)
605          if remove:
606              os.remove(input_)
607          if os.path.exists(output):
608              return output
609      @staticmethod
610      async def create_webm(file, name=&quot;video&quot;, remove=False):
611          _ = await metadata(file)
612          name += &quot;.webm&quot;
613          h, w = _[&quot;height&quot;], _[&quot;width&quot;]
614          if h == w and h != 512:
615              h, w = 512, 512
616          if h != 512 or w != 512:
617              if h &gt; w:
618                  h, w = 512, -1
619              if w &gt; h:
620                  h, w = -1, 512
621          await bash(
622              f&#x27;ffmpeg -i &quot;{file}&quot; -preset fast -an -to 00:00:03 -crf 30 -bufsize 256k -b:v {_[&quot;bitrate&quot;]} -vf &quot;scale={w}:{h},fps=30&quot; -c:v libvpx-vp9 &quot;{name}&quot; -y&#x27;
623          )
624          if remove:
625              os.remove(file)
626          return name
627      @staticmethod
628      def to_image(input_, name, remove=False):
629          try:
630              import cv2
631          except ImportError:
632              raise DependencyMissingError(&quot;This function needs &#x27;cv2&#x27; to be installed.&quot;)
633          img = cv2.VideoCapture(input_)
634          ult, roid = img.read()
635          cv2.imwrite(name, roid)
636          if remove:
637              os.remove(input_)
638          return name
639      @staticmethod
640      async def convert(
641          input_file,
642          outname=&quot;converted&quot;,
643          convert_to=None,
644          allowed_formats=[],
645          remove_old=True,
646      ):
647          if &quot;.&quot; in input_file:
648              ext = input_file.split(&quot;.&quot;)[-1].lower()
649          else:
650              return input_file
651          if (
652              ext in allowed_formats
653              or ext == convert_to
654              or not (convert_to or allowed_formats)
655          ):
656              return input_file
657          def recycle_type(exte):
658              return convert_to == exte or exte in allowed_formats
659          if ext == &quot;tgs&quot;:
660              for extn in [&quot;webp&quot;, &quot;json&quot;, &quot;png&quot;, &quot;mp4&quot;, &quot;gif&quot;]:
661                  if recycle_type(extn):
662                      name = outname + &quot;.&quot; + extn
663                      return await TgConverter.animated_sticker(
664                          input_file, name, remove=remove_old
665                      )
666              if recycle_type(&quot;webm&quot;):
667                  input_file = await TgConverter.convert(
668                      input_file, convert_to=&quot;gif&quot;, remove_old=remove_old
669                  )
670                  return await TgConverter.create_webm(input_file, outname, remove=True)
671          elif ext == &quot;json&quot;:
672              if recycle_type(&quot;tgs&quot;):
673                  name = outname + &quot;.tgs&quot;
674                  return await TgConverter.animated_sticker(
675                      input_file, name, remove=remove_old
676                  )
677          elif ext in [&quot;webm&quot;, &quot;mp4&quot;, &quot;gif&quot;]:
678              for exte in [&quot;webm&quot;, &quot;mp4&quot;, &quot;gif&quot;]:
679                  if recycle_type(exte):
680                      name = outname + &quot;.&quot; + exte
681                      return await TgConverter.ffmpeg_convert(
682                          input_file, name, remove=remove_old
683                      )
684              for exte in [&quot;png&quot;, &quot;jpg&quot;, &quot;jpeg&quot;, &quot;webp&quot;]:
685                  if recycle_type(exte):
686                      name = outname + &quot;.&quot; + exte
687                      return TgConverter.to_image(input_file, name, remove=remove_old)
688          elif ext in [&quot;jpg&quot;, &quot;jpeg&quot;, &quot;png&quot;, &quot;webp&quot;]:
689              for extn in [&quot;png&quot;, &quot;webp&quot;, &quot;ico&quot;]:
690                  if recycle_type(extn):
691                      img = Image.open(input_file)
692                      name = outname + &quot;.&quot; + extn
693                      img.save(name, extn.upper())
694                      if remove_old:
695                          os.remove(input_file)
696                      return name
697              for extn in [&quot;webm&quot;, &quot;gif&quot;, &quot;mp4&quot;]:
698                  if recycle_type(extn):
699                      name = outname + &quot;.&quot; + extn
700                      if extn == &quot;webm&quot;:
701                          input_file = await TgConverter.convert(
702                              input_file,
703                              convert_to=&quot;png&quot;,
704                              remove_old=remove_old,
705                          )
706                      return await TgConverter.ffmpeg_convert(
707                          input_file, name, remove=True if extn == &quot;webm&quot; else remove_old
708                      )
709  def _get_value(stri):
710      try:
711          value = eval(stri.strip())
712      except Exception as er:
713          from .. import LOGS
714          LOGS.debug(er)
715          value = stri.strip()
716      return value
717  def safe_load(file, *args, **kwargs):
718      if isinstance(file, str):
719          read = file.split(&quot;\n&quot;)
720      else:
721          read = file.readlines()
722      out = {}
723      for line in read:
724          if &quot;:&quot; in line:  # Ignores Empty &amp; Invalid lines
725              spli = line.split(&quot;:&quot;, maxsplit=1)
726              key = spli[0].strip()
727              value = _get_value(spli[1])
728              out.update({key: value or []})
729          elif &quot;-&quot; in line:
730              spli = line.split(&quot;-&quot;, maxsplit=1)
731              where = out[list(out.keys())[-1]]
732              if isinstance(where, list):
733                  value = _get_value(spli[1])
734                  if value:
735                      where.append(value)
736      return out
737  def get_chat_and_msgid(link):
738      matches = re.findall(&quot;https:\\/\\/t\\.me\\/(c\\/|)(.*)\\/(.*)&quot;, link)
739      if not matches:
740          return None, None
741      _, chat, msg_id = matches[0]
742      if chat.isdigit():
743          chat = int(&quot;-100&quot; + chat)
744      return chat, int(msg_id)
</code></pre>
        </div>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-tools.py</h3>
            <pre><code>1  import json
2  import math
3  import os
4  import random
5  import re
6  import secrets
7  import ssl
8  from io import BytesIO
9  from json.decoder import JSONDecodeError
10  from traceback import format_exc
11  import requests
12  from .. import *
13  from ..exceptions import DependencyMissingError
14  from . import some_random_headers
15  from .helper import async_searcher, bash, run_async
16  try:
17      import certifi
18  except ImportError:
19      certifi = None
20  try:
21      from PIL import Image, ImageDraw, ImageFont
22  except ImportError:
23      Image, ImageDraw, ImageFont = None, None, None
24      LOGS.info(&quot;PIL not installed!&quot;)
25  from urllib.parse import quote, unquote
26  from telethon import Button
27  from telethon.tl.types import DocumentAttributeAudio, DocumentAttributeVideo
28  if run_as_module:
29      from ..dB.filestore_db import get_stored_msg, store_msg
30  try:
31      import numpy as np
32  except ImportError:
33      np = None
34  try:
35      from telegraph import Telegraph
36  except ImportError:
37      Telegraph = None
38  try:
39      from bs4 import BeautifulSoup
40  except ImportError:
41      BeautifulSoup = None
42  async def get_ofox(codename):
43      ofox_baseurl = &quot;https://api.orangefox.download/v3/&quot;
44      releases = await async_searcher(
45          ofox_baseurl + &quot;releases?codename=&quot; + codename, re_json=True
46      )
47      device = await async_searcher(
48          ofox_baseurl + &quot;devices/get?codename=&quot; + codename, re_json=True
49      )
50      return device, releases
51  def _unquote_text(text):
52      return text.replace(&quot;&#x27;&quot;, unquote(&quot;%5C%27&quot;)).replace(&#x27;&quot;&#x27;, unquote(&quot;%5C%22&quot;))
53  def json_parser(data, indent=None, ascii=False):
54      parsed = {}
55      try:
56          if isinstance(data, str):
57              parsed = json.loads(str(data))
58              if indent:
59                  parsed = json.dumps(
60                      json.loads(str(data)), indent=indent, ensure_ascii=ascii
61                  )
62          elif isinstance(data, dict):
63              parsed = data
64              if indent:
65                  parsed = json.dumps(data, indent=indent, ensure_ascii=ascii)
66      except JSONDecodeError:
67          parsed = eval(data)
68      return parsed
69  async def is_url_ok(url: str):
70      try:
71          return await async_searcher(url, head=True)
72      except BaseException as er:
73          LOGS.debug(er)
74          return False
75  async def metadata(file):
76      out, _ = await bash(f&#x27;mediainfo &quot;{_unquote_text(file)}&quot; --Output=JSON&#x27;)
77      if _ and _.endswith(&quot;NOT_FOUND&quot;):
78          raise DependencyMissingError(
79              f&quot;&#x27;{_}&#x27; is not installed!\nInstall it to use this command.&quot;
80          )
81      data = {}
82      _info = json.loads(out)[&quot;media&quot;][&quot;track&quot;]
83      info = _info[0]
84      if info.get(&quot;Format&quot;) in [&quot;GIF&quot;, &quot;PNG&quot;]:
85          return {
86              &quot;height&quot;: _info[1][&quot;Height&quot;],
87              &quot;width&quot;: _info[1][&quot;Width&quot;],
88              &quot;bitrate&quot;: _info[1].get(&quot;BitRate&quot;, 320),
89          }
90      if info.get(&quot;AudioCount&quot;):
91          data[&quot;title&quot;] = info.get(&quot;Title&quot;, file)
92          data[&quot;performer&quot;] = info.get(&quot;Performer&quot;) or udB.get_key(&quot;artist&quot;) or &quot;&quot;
93      if info.get(&quot;VideoCount&quot;):
94          data[&quot;height&quot;] = int(float(_info[1].get(&quot;Height&quot;, 720)))
95          data[&quot;width&quot;] = int(float(_info[1].get(&quot;Width&quot;, 1280)))
96          data[&quot;bitrate&quot;] = int(_info[1].get(&quot;BitRate&quot;, 320))
97      data[&quot;duration&quot;] = int(float(info.get(&quot;Duration&quot;, 0)))
98      return data
99  async def set_attributes(file):
100      data = await metadata(file)
101      if not data:
102          return None
103      if &quot;width&quot; in data:
104          return [
105              DocumentAttributeVideo(
106                  duration=data.get(&quot;duration&quot;, 0),
<span onclick='openModal()' class='match'>107                  w=data.get(&quot;width&quot;, 512),
108                  h=data.get(&quot;height&quot;, 512),
109                  supports_streaming=True,
</span>110              )
111          ]
112      ext = &quot;.&quot; + file.split(&quot;.&quot;)[-1]
113      return [
114          DocumentAttributeAudio(
115              duration=data.get(&quot;duration&quot;, 0),
116              title=data.get(&quot;title&quot;, file.split(&quot;/&quot;)[-1].replace(ext, &quot;&quot;)),
117              performer=data.get(&quot;performer&quot;),
118          )
119      ]
120  def get_msg_button(texts: str):
121      btn = []
122      for z in re.findall(&quot;\\[(.*?)\\|(.*?)\\]&quot;, texts):
123          text, url = z
124          urls = url.split(&quot;|&quot;)
125          url = urls[0]
126          if len(urls) &gt; 1:
127              btn[-1].append([text, url])
128          else:
129              btn.append([[text, url]])
130      txt = texts
131      for z in re.findall(&quot;\\[.+?\\|.+?\\]&quot;, texts):
132          txt = txt.replace(z, &quot;&quot;)
133      return txt.strip(), btn
134  def create_tl_btn(button: list):
135      btn = []
136      for z in button:
137          if len(z) &gt; 1:
138              kk = [Button.url(x, y.strip()) for x, y in z]
139              btn.append(kk)
140          else:
141              btn.append([Button.url(z[0][0], z[0][1].strip())])
142      return btn
143  def format_btn(buttons: list):
144      txt = &quot;&quot;
145      for i in buttons:
146          a = 0
147          for i in i:
148              if hasattr(i.button, &quot;url&quot;):
149                  a += 1
150                  if a &gt; 1:
151                      txt += f&quot;[{i.button.text} | {i.button.url} | same]&quot;
152                  else:
153                      txt += f&quot;[{i.button.text} | {i.button.url}]&quot;
154      _, btn = get_msg_button(txt)
155      return btn
156  async def saavn_search(query: str):
157      try:
158          data = await async_searcher(
159              url=f&quot;https://saavn-api.vercel.app/search/{query.replace(&#x27; &#x27;, &#x27;%20&#x27;)}&quot;,
160              re_json=True,
161          )
162      except BaseException:
163          data = None
164      return data
165  _webupload_cache = {}
166  async def webuploader(chat_id: int, msg_id: int, uploader: str):
167      file = _webupload_cache[int(chat_id)][int(msg_id)]
168      sites = {
169          &quot;anonfiles&quot;: {&quot;url&quot;: &quot;https://api.anonfiles.com/upload&quot;, &quot;json&quot;: True},
170          &quot;siasky&quot;: {&quot;url&quot;: &quot;https://siasky.net/skynet/skyfile&quot;, &quot;json&quot;: True},
171          &quot;file.io&quot;: {&quot;url&quot;: &quot;https://file.io&quot;, &quot;json&quot;: True},
172          &quot;bayfiles&quot;: {&quot;url&quot;: &quot;https://api.bayfiles.com/upload&quot;, &quot;json&quot;: True},
173          &quot;x0.at&quot;: {&quot;url&quot;: &quot;https://x0.at/&quot;, &quot;json&quot;: False},
174          &quot;transfer&quot;: {&quot;url&quot;: &quot;https://transfer.sh&quot;, &quot;json&quot;: False},
175      }
176      if uploader and uploader in sites:
177          url = sites[uploader][&quot;url&quot;]
178          json = sites[uploader][&quot;json&quot;]
179      with open(file, &quot;rb&quot;) as data:
180          status = await async_searcher(
181              url, data={&quot;file&quot;: data.read()}, post=True, re_json=json
182          )
183      if isinstance(status, dict):
184          if &quot;skylink&quot; in status:
185              return f&quot;https://siasky.net/{status[&#x27;skylink&#x27;]}&quot;
186          if status[&quot;status&quot;] == 200 or status[&quot;status&quot;] is True:
187              try:
188                  link = status[&quot;link&quot;]
189              except KeyError:
190                  link = status[&quot;data&quot;][&quot;file&quot;][&quot;url&quot;][&quot;short&quot;]
191              return link
192      del _webupload_cache[int(chat_id)][int(msg_id)]
193      return status
194  def get_all_files(path, extension=None):
195      filelist = []
196      for root, dirs, files in os.walk(path):
197          for file in files:
198              if not (extension and not file.endswith(extension)):
199                  filelist.append(os.path.join(root, file))
200      return sorted(filelist)
201  def text_set(text):
202      lines = []
203      if len(text) &lt;= 55:
204          lines.append(text)
205      else:
206          all_lines = text.split(&quot;\n&quot;)
207          for line in all_lines:
208              if len(line) &lt;= 55:
209                  lines.append(line)
210              else:
211                  k = len(line) // 55
212                  for z in range(1, k + 2):
213                      lines.append(line[((z - 1) * 55) : (z * 55)])
214      return lines[:25]
215  class LogoHelper:
216      @staticmethod
217      def get_text_size(text, image, font):
218          im = Image.new(&quot;RGB&quot;, (image.width, image.height))
219          draw = ImageDraw.Draw(im)
220          return draw.textsize(text, font)
221      @staticmethod
222      def find_font_size(text, font, image, target_width_ratio):
223          tested_font_size = 100
224          tested_font = ImageFont.truetype(font, tested_font_size)
225          observed_width, observed_height = LogoHelper.get_text_size(
226              text, image, tested_font
227          )
228          estimated_font_size = (
229              tested_font_size / (observed_width / image.width) * target_width_ratio
230          )
231          return round(estimated_font_size)
232      @staticmethod
233      def make_logo(imgpath, text, funt, **args):
234          fill = args.get(&quot;fill&quot;)
235          width_ratio = args.get(&quot;width_ratio&quot;) or 0.7
236          stroke_width = int(args.get(&quot;stroke_width&quot;))
237          stroke_fill = args.get(&quot;stroke_fill&quot;)
238          img = Image.open(imgpath)
239          width, height = img.size
240          draw = ImageDraw.Draw(img)
241          font_size = LogoHelper.find_font_size(text, funt, img, width_ratio)
242          font = ImageFont.truetype(funt, font_size)
243          w, h = draw.textsize(text, font=font)
244          draw.text(
245              ((width - w) / 2, (height - h) / 2),
246              text,
247              font=font,
248              fill=fill,
249              stroke_width=stroke_width,
250              stroke_fill=stroke_fill,
251          )
252          file_name = check_filename(&quot;logo.png&quot;)
253          img.save(file_name, &quot;PNG&quot;)
254          return file_name
255  async def get_paste(data: str, extension: str = &quot;txt&quot;):
256      ssl_context = ssl.create_default_context(cafile=certifi.where())
257      json = {&quot;content&quot;: data, &quot;extension&quot;: extension}
258      key = await async_searcher(
259          url=&quot;https://spaceb.in/api/v1/documents/&quot;,
260          json=json,
261          ssl=ssl_context,
262          post=True,
263          re_json=True,
264      )
265      try:
266          return True, key[&quot;payload&quot;][&quot;id&quot;]
267      except KeyError:
268          if &quot;the length must be between 2 and 400000.&quot; in key[&quot;error&quot;]:
269              return await get_paste(data[-400000:], extension=extension)
270          return False, key[&quot;error&quot;]
271      except Exception as e:
272          LOGS.info(e)
273          return None, str(e)
274  async def get_google_images(query):
275      soup = BeautifulSoup(
276          await async_searcher(
277              &quot;https://google.com/search&quot;,
278              params={&quot;q&quot;: query, &quot;tbm&quot;: &quot;isch&quot;},
279              headers={&quot;User-Agent&quot;: random.choice(some_random_headers)},
280          ),
281          &quot;lxml&quot;,
282      )
283      google_images = []
284      all_script_tags = soup.select(&quot;script&quot;)
285      matched_images_data = &quot;&quot;.join(
286          re.findall(r&quot;AF_initDataCallback\(([^&lt;]+)\);&quot;, str(all_script_tags))
287      )
288      matched_images_data_fix = json.dumps(matched_images_data)
289      matched_images_data_json = json.loads(matched_images_data_fix)
290      matched_google_image_data = re.findall(
291          r&quot;\&quot;b-GRID_STATE0\&quot;(.*)sideChannel:\s?{}}&quot;, matched_images_data_json
292      )
293      matched_google_images_thumbnails = &quot;, &quot;.join(
294          re.findall(
295              r&quot;\[\&quot;(https\:\/\/encrypted-tbn0\.gstatic\.com\/images\?.*?)\&quot;,\d+,\d+\]&quot;,
296              str(matched_google_image_data),
297          )
298      ).split(&quot;, &quot;)
299      thumbnails = [
300          bytes(bytes(thumbnail, &quot;ascii&quot;).decode(&quot;unicode-escape&quot;), &quot;ascii&quot;).decode(
301              &quot;unicode-escape&quot;
302          )
303          for thumbnail in matched_google_images_thumbnails
304      ]
305      removed_matched_google_images_thumbnails = re.sub(
306          r&quot;\[\&quot;(https\:\/\/encrypted-tbn0\.gstatic\.com\/images\?.*?)\&quot;,\d+,\d+\]&quot;,
307          &quot;&quot;,
308          str(matched_google_image_data),
309      )
310      matched_google_full_resolution_images = re.findall(
311          r&quot;(?:&#x27;|,),\[\&quot;(https:|http.*?)\&quot;,\d+,\d+\]&quot;,
312          removed_matched_google_images_thumbnails,
313      )
314      full_res_images = [
315          bytes(bytes(img, &quot;ascii&quot;).decode(&quot;unicode-escape&quot;), &quot;ascii&quot;).decode(
316              &quot;unicode-escape&quot;
317          )
318          for img in matched_google_full_resolution_images
319      ]
320      for index, (metadata, thumbnail, original) in enumerate(
321          zip(soup.select(&quot;.isv-r.PNCib.MSM1fd.BUooTd&quot;), thumbnails, full_res_images),
322          start=1,
323      ):
324          google_images.append(
325              {
326                  &quot;title&quot;: metadata.select_one(&quot;.VFACy.kGQAp.sMi44c.lNHeqe.WGvvNb&quot;)[
327                      &quot;title&quot;
328                  ],
329                  &quot;link&quot;: metadata.select_one(&quot;.VFACy.kGQAp.sMi44c.lNHeqe.WGvvNb&quot;)[
330                      &quot;href&quot;
331                  ],
332                  &quot;source&quot;: metadata.select_one(&quot;.fxgdke&quot;).text,
333                  &quot;thumbnail&quot;: thumbnail,
334                  &quot;original&quot;: original,
335              }
336          )
337      random.shuffle(google_images)
338      return google_images
339  async def get_chatbot_reply(message):
340      chatbot_base = &quot;https://kuki-api-lac.vercel.app/message={}&quot;
341      req_link = chatbot_base.format(
342          message,
343      )
344      try:
345          return (await async_searcher(req_link, re_json=True)).get(&quot;reply&quot;)
346      except Exception:
347          LOGS.info(f&quot;**ERROR:**`{format_exc()}`&quot;)
348  def check_filename(filroid):
349      if os.path.exists(filroid):
350          no = 1
351          while True:
352              ult = &quot;{0}_{2}{1}&quot;.format(*os.path.splitext(filroid) + (no,))
353              if os.path.exists(ult):
354                  no += 1
355              else:
356                  return ult
357      return filroid
358  async def genss(file):
359      return (await metadata(file)).get(&quot;duration&quot;)
360  async def duration_s(file, stime):
361      tsec = await genss(file)
362      x = round(tsec / 5)
363      y = round(tsec / 5 + int(stime))
364      pin = stdr(x)
365      pon = stdr(y) if y &lt; tsec else stdr(tsec)
366      return pin, pon
367  def stdr(seconds):
368      minutes, seconds = divmod(seconds, 60)
369      hours, minutes = divmod(minutes, 60)
370      if len(str(minutes)) == 1:
371          minutes = &quot;0&quot; + str(minutes)
372      if len(str(hours)) == 1:
373          hours = &quot;0&quot; + str(hours)
374      if len(str(seconds)) == 1:
375          seconds = &quot;0&quot; + str(seconds)
376      return (
377          ((str(hours) + &quot;:&quot;) if hours else &quot;00:&quot;)
378          + ((str(minutes) + &quot;:&quot;) if minutes else &quot;00:&quot;)
379          + ((str(seconds)) if seconds else &quot;&quot;)
380      )
381  def order_points(pts):
382      &quot;get the required points&quot;
383      rect = np.zeros((4, 2), dtype=&quot;float32&quot;)
384      s = pts.sum(axis=1)
385      rect[0] = pts[np.argmin(s)]
386      rect[2] = pts[np.argmax(s)]
387      diff = np.diff(pts, axis=1)
388      rect[1] = pts[np.argmin(diff)]
389      rect[3] = pts[np.argmax(diff)]
390      return rect
391  def four_point_transform(image, pts):
392      try:
393          import cv2
394      except ImportError:
395          raise DependencyMissingError(&quot;This function needs &#x27;cv2&#x27; to be installed.&quot;)
396      rect = order_points(pts)
397      (tl, tr, br, bl) = rect
398      widthA = np.sqrt(((br[0] - bl[0]) ** 2) + ((br[1] - bl[1]) ** 2))
399      widthB = np.sqrt(((tr[0] - tl[0]) ** 2) + ((tr[1] - tl[1]) ** 2))
400      maxWidth = max(int(widthA), int(widthB))
401      heightA = np.sqrt(((tr[0] - br[0]) ** 2) + ((tr[1] - br[1]) ** 2))
402      heightB = np.sqrt(((tl[0] - bl[0]) ** 2) + ((tl[1] - bl[1]) ** 2))
403      maxHeight = max(int(heightA), int(heightB))
404      dst = np.array(
405          [[0, 0], [maxWidth - 1, 0], [maxWidth - 1, maxHeight - 1], [0, maxHeight - 1]],
406          dtype=&quot;float32&quot;,
407      )
408      M = cv2.getPerspectiveTransform(rect, dst)
409      return cv2.warpPerspective(image, M, (maxWidth, maxHeight))
410  TELEGRAPH = []
411  def telegraph_client():
412      if not Telegraph:
413          LOGS.info(&quot;&#x27;Telegraph&#x27; is not Installed!&quot;)
414          return
415      if TELEGRAPH:
416          return TELEGRAPH[0]
417      from .. import udB, ultroid_bot
418      token = udB.get_key(&quot;_TELEGRAPH_TOKEN&quot;)
419      TelegraphClient = Telegraph(token)
420      if token:
421          TELEGRAPH.append(TelegraphClient)
422          return TelegraphClient
423      gd_name = ultroid_bot.full_name
424      short_name = gd_name[:30]
425      profile_url = (
426          f&quot;https://t.me/{ultroid_bot.me.username}&quot;
427          if ultroid_bot.me.username
428          else &quot;https://t.me/TeamUltroid&quot;
429      )
430      try:
431          TelegraphClient.create_account(
432              short_name=short_name, author_name=gd_name, author_url=profile_url
433          )
434      except Exception as er:
435          if &quot;SHORT_NAME_TOO_LONG&quot; in str(er):
436              TelegraphClient.create_account(
437                  short_name=&quot;ultroiduser&quot;, author_name=gd_name, author_url=profile_url
438              )
439          else:
440              LOGS.exception(er)
441              return
442      udB.set_key(&quot;_TELEGRAPH_TOKEN&quot;, TelegraphClient.get_access_token())
443      TELEGRAPH.append(TelegraphClient)
444      return TelegraphClient
445  @run_async
446  def make_html_telegraph(title, html=&quot;&quot;):
447      telegraph = telegraph_client()
448      page = telegraph.create_page(
449          title=title,
450          html_content=html,
451      )
452      return page[&quot;url&quot;]
453  async def Carbon(
454      code,
455      base_url=&quot;https://carbonara.solopov.dev/api/cook&quot;,
456      file_name=&quot;ultroid&quot;,
457      download=False,
458      rayso=False,
459      **kwargs,
460  ):
461      if rayso:
462          base_url = &quot;https://rayso-api-desvhu-33.koyeb.app/generate&quot;
463          kwargs[&quot;text&quot;] = code
464          kwargs[&quot;theme&quot;] = kwargs.get(&quot;theme&quot;, &quot;breeze&quot;)
465          kwargs[&quot;darkMode&quot;] = kwargs.get(&quot;darkMode&quot;, True)
466          kwargs[&quot;title&quot;] = kwargs.get(&quot;title&quot;, &quot;Ultroid&quot;)
467      else:
468          kwargs[&quot;code&quot;] = code
469      con = await async_searcher(base_url, post=True, json=kwargs, re_content=True)
470      if not download:
471          file = BytesIO(con)
472          file.name = file_name + &quot;.jpg&quot;
473      else:
474          try:
475              return json_parser(con.decode())
476          except Exception:
477              pass
478          file = file_name + &quot;.jpg&quot;
479          with open(file, &quot;wb&quot;) as f:
480              f.write(con)
481      return file
482  async def get_file_link(msg):
483      from .. import udB
484      msg_id = await msg.forward_to(udB.get_key(&quot;LOG_CHANNEL&quot;))
485      await msg_id.reply(
486          &quot;**Message has been stored to generate a shareable link. Do not delete it.**&quot;
487      )
488      msg_id = msg_id.id
489      msg_hash = secrets.token_hex(nbytes=8)
490      store_msg(msg_hash, msg_id)
491      return msg_hash
492  async def get_stored_file(event, hash):
493      from .. import udB
494      msg_id = get_stored_msg(hash)
495      if not msg_id:
496          return
497      try:
498          msg = await asst.get_messages(udB.get_key(&quot;LOG_CHANNEL&quot;), ids=msg_id)
499      except Exception as er:
500          LOGS.warning(f&quot;FileStore, Error: {er}&quot;)
501          return
502      if not msg_id:
503          return await asst.send_message(
504              event.chat_id, &quot;__Message was deleted by owner!__&quot;, reply_to=event.id
505          )
506      await asst.send_message(event.chat_id, msg.text, file=msg.media, reply_to=event.id)
507  def _package_rpc(text, lang_src=&quot;auto&quot;, lang_tgt=&quot;auto&quot;):
508      GOOGLE_TTS_RPC = [&quot;MkEWBc&quot;]
509      parameter = [[text.strip(), lang_src, lang_tgt, True], [1]]
510      escaped_parameter = json.dumps(parameter, separators=(&quot;,&quot;, &quot;:&quot;))
511      rpc = [[[random.choice(GOOGLE_TTS_RPC), escaped_parameter, None, &quot;generic&quot;]]]
512      espaced_rpc = json.dumps(rpc, separators=(&quot;,&quot;, &quot;:&quot;))
513      freq = &quot;f.req={}&amp;&quot;.format(quote(espaced_rpc))
514      return freq
515  def translate(*args, **kwargs):
516      headers = {
517          &quot;Referer&quot;: &quot;https://translate.google.co.in&quot;,
518          &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; WOW64) &quot;
519          &quot;AppleWebKit/537.36 (KHTML, like Gecko) &quot;
520          &quot;Chrome/47.0.2526.106 Safari/537.36&quot;,
521          &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded;charset=utf-8&quot;,
522      }
523      x = requests.post(
524          &quot;https://translate.google.co.in/_/TranslateWebserverUi/data/batchexecute&quot;,
525          headers=headers,
526          data=_package_rpc(*args, **kwargs),
527      ).text
528      response = &quot;&quot;
529      data = json.loads(json.loads(x[4:])[0][2])[1][0][0]
530      subind = data[-2]
531      if not subind:
532          subind = data[-1]
533      for i in subind:
534          response += i[0]
535      return response
536  def cmd_regex_replace(cmd):
537      return (
538          cmd.replace(&quot;$&quot;, &quot;&quot;)
539          .replace(&quot;?(.*)&quot;, &quot;&quot;)
540          .replace(&quot;(.*)&quot;, &quot;&quot;)
541          .replace(&quot;(?: |)&quot;, &quot;&quot;)
542          .replace(&quot;| &quot;, &quot;&quot;)
543          .replace(&quot;( |)&quot;, &quot;&quot;)
544          .replace(&quot;?((.|//)*)&quot;, &quot;&quot;)
545          .replace(&quot;?P&lt;shortname&gt;\\w+&quot;, &quot;&quot;)
546          .replace(&quot;(&quot;, &quot;&quot;)
547          .replace(&quot;)&quot;, &quot;&quot;)
548          .replace(&quot;?(\\d+)&quot;, &quot;&quot;)
549      )
550  class LottieException(Exception):
551      ...
552  class TgConverter:
553      @staticmethod
554      async def animated_sticker(file, out_path=&quot;sticker.tgs&quot;, throw=False, remove=False):
555          if out_path.endswith(&quot;webp&quot;):
556              er, out = await bash(
557                  f&quot;lottie_convert.py --webp-quality 100 --webp-skip-frames 100 &#x27;{file}&#x27; &#x27;{out_path}&#x27;&quot;
558              )
559          else:
560              er, out = await bash(f&quot;lottie_convert.py &#x27;{file}&#x27; &#x27;{out_path}&#x27;&quot;)
561          if er and throw:
562              raise LottieException(er)
563          if remove:
564              os.remove(file)
565          if os.path.exists(out_path):
566              return out_path
567      @staticmethod
568      async def animated_to_gif(file, out_path=&quot;gif.gif&quot;):
569          await bash(
570              f&quot;lottie_convert.py &#x27;{_unquote_text(file)}&#x27; &#x27;{_unquote_text(out_path)}&#x27;&quot;
571          )
572          return out_path
573      @staticmethod
574      def resize_photo_sticker(photo):
575          image = Image.open(photo)
576          if (image.width and image.height) &lt; 512:
577              size1 = image.width
578              size2 = image.height
579              if image.width &gt; image.height:
580                  scale = 512 / size1
581                  size1new = 512
582                  size2new = size2 * scale
583              else:
584                  scale = 512 / size2
585                  size1new = size1 * scale
586                  size2new = 512
587              size1new = math.floor(size1new)
588              size2new = math.floor(size2new)
589              sizenew = (size1new, size2new)
590              image = image.resize(sizenew)
591          else:
592              maxsize = (512, 512)
593              image.thumbnail(maxsize)
594          return image
595      @staticmethod
596      async def ffmpeg_convert(input_, output, remove=False):
597          if output.endswith(&quot;.webm&quot;):
598              return await TgConverter.create_webm(
599                  input_, name=output[:-5], remove=remove
600              )
601          if output.endswith(&quot;.gif&quot;):
602              await bash(f&quot;ffmpeg -i &#x27;{input_}&#x27; -an -sn -c:v copy &#x27;{output}.mp4&#x27; -y&quot;)
603          else:
604              await bash(f&quot;ffmpeg -i &#x27;{input_}&#x27; &#x27;{output}&#x27; -y&quot;)
605          if remove:
606              os.remove(input_)
607          if os.path.exists(output):
608              return output
609      @staticmethod
610      async def create_webm(file, name=&quot;video&quot;, remove=False):
611          _ = await metadata(file)
612          name += &quot;.webm&quot;
613          h, w = _[&quot;height&quot;], _[&quot;width&quot;]
614          if h == w and h != 512:
615              h, w = 512, 512
616          if h != 512 or w != 512:
617              if h &gt; w:
618                  h, w = 512, -1
619              if w &gt; h:
620                  h, w = -1, 512
621          await bash(
622              f&#x27;ffmpeg -i &quot;{file}&quot; -preset fast -an -to 00:00:03 -crf 30 -bufsize 256k -b:v {_[&quot;bitrate&quot;]} -vf &quot;scale={w}:{h},fps=30&quot; -c:v libvpx-vp9 &quot;{name}&quot; -y&#x27;
623          )
624          if remove:
625              os.remove(file)
626          return name
627      @staticmethod
628      def to_image(input_, name, remove=False):
629          try:
630              import cv2
631          except ImportError:
632              raise DependencyMissingError(&quot;This function needs &#x27;cv2&#x27; to be installed.&quot;)
633          img = cv2.VideoCapture(input_)
634          ult, roid = img.read()
635          cv2.imwrite(name, roid)
636          if remove:
637              os.remove(input_)
638          return name
639      @staticmethod
640      async def convert(
641          input_file,
642          outname=&quot;converted&quot;,
643          convert_to=None,
644          allowed_formats=[],
645          remove_old=True,
646      ):
647          if &quot;.&quot; in input_file:
648              ext = input_file.split(&quot;.&quot;)[-1].lower()
649          else:
650              return input_file
651          if (
652              ext in allowed_formats
653              or ext == convert_to
654              or not (convert_to or allowed_formats)
655          ):
656              return input_file
657          def recycle_type(exte):
658              return convert_to == exte or exte in allowed_formats
659          if ext == &quot;tgs&quot;:
660              for extn in [&quot;webp&quot;, &quot;json&quot;, &quot;png&quot;, &quot;mp4&quot;, &quot;gif&quot;]:
661                  if recycle_type(extn):
662                      name = outname + &quot;.&quot; + extn
663                      return await TgConverter.animated_sticker(
664                          input_file, name, remove=remove_old
665                      )
666              if recycle_type(&quot;webm&quot;):
667                  input_file = await TgConverter.convert(
668                      input_file, convert_to=&quot;gif&quot;, remove_old=remove_old
669                  )
670                  return await TgConverter.create_webm(input_file, outname, remove=True)
671          elif ext == &quot;json&quot;:
672              if recycle_type(&quot;tgs&quot;):
673                  name = outname + &quot;.tgs&quot;
674                  return await TgConverter.animated_sticker(
675                      input_file, name, remove=remove_old
676                  )
677          elif ext in [&quot;webm&quot;, &quot;mp4&quot;, &quot;gif&quot;]:
678              for exte in [&quot;webm&quot;, &quot;mp4&quot;, &quot;gif&quot;]:
679                  if recycle_type(exte):
680                      name = outname + &quot;.&quot; + exte
681                      return await TgConverter.ffmpeg_convert(
682                          input_file, name, remove=remove_old
683                      )
684              for exte in [&quot;png&quot;, &quot;jpg&quot;, &quot;jpeg&quot;, &quot;webp&quot;]:
685                  if recycle_type(exte):
686                      name = outname + &quot;.&quot; + exte
687                      return TgConverter.to_image(input_file, name, remove=remove_old)
688          elif ext in [&quot;jpg&quot;, &quot;jpeg&quot;, &quot;png&quot;, &quot;webp&quot;]:
689              for extn in [&quot;png&quot;, &quot;webp&quot;, &quot;ico&quot;]:
690                  if recycle_type(extn):
691                      img = Image.open(input_file)
692                      name = outname + &quot;.&quot; + extn
693                      img.save(name, extn.upper())
694                      if remove_old:
695                          os.remove(input_file)
696                      return name
697              for extn in [&quot;webm&quot;, &quot;gif&quot;, &quot;mp4&quot;]:
698                  if recycle_type(extn):
699                      name = outname + &quot;.&quot; + extn
700                      if extn == &quot;webm&quot;:
701                          input_file = await TgConverter.convert(
702                              input_file,
703                              convert_to=&quot;png&quot;,
704                              remove_old=remove_old,
705                          )
706                      return await TgConverter.ffmpeg_convert(
707                          input_file, name, remove=True if extn == &quot;webm&quot; else remove_old
708                      )
709  def _get_value(stri):
710      try:
711          value = eval(stri.strip())
712      except Exception as er:
713          from .. import LOGS
714          LOGS.debug(er)
715          value = stri.strip()
716      return value
717  def safe_load(file, *args, **kwargs):
718      if isinstance(file, str):
719          read = file.split(&quot;\n&quot;)
720      else:
721          read = file.readlines()
722      out = {}
723      for line in read:
724          if &quot;:&quot; in line:  # Ignores Empty &amp; Invalid lines
725              spli = line.split(&quot;:&quot;, maxsplit=1)
726              key = spli[0].strip()
727              value = _get_value(spli[1])
728              out.update({key: value or []})
729          elif &quot;-&quot; in line:
730              spli = line.split(&quot;-&quot;, maxsplit=1)
731              where = out[list(out.keys())[-1]]
732              if isinstance(where, list):
733                  value = _get_value(spli[1])
734                  if value:
735                      where.append(value)
736      return out
737  def get_chat_and_msgid(link):
738      matches = re.findall(&quot;https:\\/\\/t\\.me\\/(c\\/|)(.*)\\/(.*)&quot;, link)
739      if not matches:
740          return None, None
741      _, chat, msg_id = matches[0]
742      if chat.isdigit():
743          chat = int(&quot;-100&quot; + chat)
744      return chat, int(msg_id)
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-tools.py</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-tools.py</div>
                </div>
                <div class="column column_space"><pre><code>106                  duration=data.get(&quot;duration&quot;, 0),
107                  w=data.get(&quot;width&quot;, 512),
108                  h=data.get(&quot;height&quot;, 512),
</pre></code></div>
                <div class="column column_space"><pre><code>107                  w=data.get(&quot;width&quot;, 512),
108                  h=data.get(&quot;height&quot;, 512),
109                  supports_streaming=True,
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    