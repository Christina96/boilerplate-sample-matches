<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for kickstart.py &amp; test_ipaddress.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for kickstart.py &amp; test_ipaddress.py
      </h3>
<h1 align="center">
        3.3%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>kickstart.py (5.574468%)<th>test_ipaddress.py (2.363341%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(951-958)<td><a href="#" name="0">(1128-1133)</a><td align="center"><font color="#ff0000">16</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(554-565)<td><a href="#" name="1">(2794-2800)</a><td align="center"><font color="#df0000">14</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(414-425)<td><a href="#" name="2">(2788-2794)</a><td align="center"><font color="#df0000">14</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(1127-1133)<td><a href="#" name="3">(1073-1075)</a><td align="center"><font color="#cf0000">13</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(1077-1083)<td><a href="#" name="4">(134-137)</a><td align="center"><font color="#cf0000">13</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(770-780)<td><a href="#" name="5">(2779-2786)</a><td align="center"><font color="#cf0000">13</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(1013-1018)<td><a href="#" name="6">(1133-1138)</a><td align="center"><font color="#bf0000">12</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(218-222)<td><a href="#" name="7">(202-206)</a><td align="center"><font color="#bf0000">12</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(133-143)<td><a href="#" name="8">(1209-1217)</a><td align="center"><font color="#bf0000">12</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(115-125)<td><a href="#" name="9">(1151-1159)</a><td align="center"><font color="#bf0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>kickstart.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import argparse
2 import shlex
3 import salt.utils.files
4 import salt.utils.yaml
5 def clean_args(args):
6     for arg in list(args):
7         if not args[arg]:
8             del args[arg]
9     return args
10 def parse_auth(rule):
11     parser = argparse.ArgumentParser()
12     rules = shlex.split(rule)
13     rules.pop(0)
14     noargs = (
15         "back",
16         "test",
17         "nostart",
18         "kickstart",
19         "probe",
20         "enablecache",
21         "disablecache",
22         "disablenis",
23         "enableshadow",
24         "disableshadow",
25         "enablemd5",
26         "disablemd5",
27         "enableldap",
28         "enableldapauth",
29         "enableldaptls",
30         "disableldap",
31         "disableldapauth",
32         "enablekrb5kdcdns",
33         "disablekrb5kdcdns",
34         "enablekrb5realmdns",
35         "disablekrb5realmdns",
36         "disablekrb5",
37         "disablehe-siod",
38         "enablesmbauth",
39         "disablesmbauth",
40         "enablewinbind",
41         "enablewinbindauth",
42         "disablewinbind",
43         "disablewinbindauth",
44         "enablewinbindusedefaultdomain",
45         "disablewinbindusedefaultdomain",
46         "enablewins",
47         "disablewins",
48     )
49     for arg in noargs:
50         parser.add_argument("--{}".format(arg), dest=arg, action="store_true")
51     parser.add_argument("--enablenis", dest="enablenis", action="store")
52     parser.add_argument("--hesiodrhs", dest="hesiodrhs", action="store")
53     parser.add_argument("--krb5adminserver", dest="krb5adminserver", action="append")
54     parser.add_argument("--krb5kdc", dest="krb5kdc", action="append")
55     parser.add_argument("--ldapbasedn", dest="ldapbasedn", action="store")
56     parser.add_argument("--ldapserver", dest="ldapserver", action="append")
57     parser.add_argument("--nisserver", dest="nisserver", action="append")
58     parser.add_argument("--passalgo", dest="passalgo", action="store")
59     parser.add_argument("--smbidmapgid", dest="smbidmapgid", action="store")
60     parser.add_argument("--smbidmapuid", dest="smbidmapuid", action="store")
61     parser.add_argument("--smbrealm", dest="smbrealm", action="store")
62     parser.add_argument(
63         "--smbsecurity",
64         dest="smbsecurity",
65         action="store",
66         choices=["user", "server", "domain", "dns"],
67     )
68     parser.add_argument("--smbservers", dest="smbservers", action="store")
69     parser.add_argument("--smbworkgroup", dest="smbworkgroup", action="store")
70     parser.add_argument("--winbindjoin", dest="winbindjoin", action="store")
71     parser.add_argument("--winbindseparator", dest="winbindseparator", action="store")
72     parser.add_argument(
73         "--winbindtemplatehomedir", dest="winbindtemplatehomedir", action="store"
74     )
75     parser.add_argument(
76         "--winbindtemplateprimarygroup",
77         dest="winbindtemplateprimarygroup",
78         action="store",
79     )
80     parser.add_argument(
81         "--winbindtemplateshell", dest="winbindtemplateshell", action="store"
82     )
83     parser.add_argument("--enablekrb5", dest="enablekrb5", action="store_true")
84     if "--enablekrb5" in rules:
85         parser.add_argument(
86             "--krb5realm", dest="krb5realm", action="store", required=True
87         )
88     parser.add_argument("--enablehesiod", dest="enablehesiod", action="store_true")
89     if "--enablehesiod" in rules:
90         parser.add_argument(
91             "--hesiodlhs", dest="hesiodlhs", action="store", required=True
92         )
93     args = clean_args(vars(parser.parse_args(rules)))
94     parser = None
95     r<font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>eturn args
96 def parse_autopart(rule):
97     parser = argparse.ArgumentParser()
98     rules = shlex.split(rule)
99     rules.pop(0)
100     parser.add_argument(</b></font>"--type", dest="type", action="store")
101     parser.add_argument("--encrypted", dest="encrypted", action="store_true")
102     parser.add_argument("--passphrase", dest="passphrase", action="store")
103     parser.add_argument("--escrowcert", dest="escrowcert", action="store")
104     parser.add_argument("--backuppassphrase", dest="backuppassphrase", action="store")
105     args = clean_args(vars(parser.parse_args(rules)))
106     parser = None
107     r<font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>eturn args
108 def parse_autostep(rule):
109     parser = argparse.ArgumentParser()
110     rules = shlex.split(rule)
111     rules.pop(0)
112     parser.add_argument(</b></font>"--autoscreenshot", dest="autoscreenshot", action="store")
113     args = clean_args(vars(parser.parse_args(rules)))
114     parser = None
115     return args
116 def parse_bootloader(rule):
117     parser = argparse.ArgumentParser()
118     rules = shlex.split(rule)
119     rules.pop(0)
120     parser.add_argument("--append", dest="append", action="store")
121     parser.add_argument("--driveorder", dest="driveorder", action="store")
122     parser.add_argument("--location", dest="location", action="store")
123     parser.add_argument("--password", dest="password", action="store")
124     parser.add_argument("--md5pass", dest="md5pass", action="store")
125     parser.add_argument("--upgrade", dest="upgrade", action="store_true")
126     parser.add_argument("--timeout", dest="timeout", action="store")
127     parser.add_argument("--boot-drive", dest="bootdrive", action="store")
128     args = clean_args(vars(parser.parse_args(rules)))
129     parser = None
130     return args
131 def parse_btrfs(rule):
132     parser = argparse.ArgumentParser()
133     rules = shlex.split(rule)
134     rules.pop(0)
135     parser.add_argument("--name", dest="name", action="store")
136     parser.add_argument("--data", dest="data", action="store")
137     parser.add_argument("--metadata", dest="metadata", action="store")
138     parser.add_argument("--label", dest="label", action="store")
139     parser.add_argument("--noformat", dest="noformat", action="store_true")
140     parser.add_argument("--useexisting", dest="useexisting", action="store_true")
141     parser.add_argument("--subvol", dest="subvol", action="store_true")
142     args = clean_args(vars(parser.parse_args(rules)))
143     parser = None
144     return args
145 def parse_clearpart(rule):
146     parser = argparse.ArgumentParser()
147     rules = shlex.split(rule)
148     rules.pop(0)
149     parser.add_argument("--all", dest="all", action="store_true")
150     parser.add_argument("--drives", dest="drives", action="store")
151     parser.add_argument("--init_label", dest="init_label", action="store_true")
152     parser.add_argument("--linux", dest="linux", action="store_true")
153     parser.add_argument("--none", dest="none", action="store_true")
154     parser.add_argument("--initlabel", dest="init_label", action="store_true")
155     parser.add_argument("--list", dest="list", action="store")
156     args = clean_args(vars(parser.parse_args(rules)))
157     parser = None
158     return args
159 def parse_device(rule):
160     Parse the device line
161     """
162     parser = argparse<font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.ArgumentParser()
163     rules = shlex.split(rule)
164     rules.pop(0)
165     modulename = rules.pop(0)
166     parser.add_argument(</b></font>"--opts", dest="opts", action="store")
167     args = clean_args(vars(parser.parse_args(rules)))
168     args["modulename"] = modulename
169     parser = None
170     return args
171 def parse_dmraid(rule):
172     """
173     Parse the dmraid line
174     """
175     parser = argparse.ArgumentParser()
176     rules = shlex.split(rule)
177     rules.pop(0)
178     parser.add_argument("--name", dest="name", action="store")
179     parser.add_argument("--dev", dest="dev", action="store")
180     args = clean_args(vars(parser.parse_args(rules)))
181     parser = None
182     return args
183 def parse_driverdisk(rule):
184     """
185     Parse the driverdisk line
186     """
187     if "--" not in rule:
188         return {"partition": rule}
189     parser = argparse.ArgumentParser()
190     rules = shlex.split(rule)
191     rules.pop(0)
192     parser.add_argument("--source", dest="source", action="store")
193     parser.add_argument("--biospart", dest="biospart", action="store")
194     args = clean_args(vars(parser.parse_args(rules)))
195     parser = None
196     return args
197 def parse_firewall(rule):
198     """
199     Parse the firewall line
200     """
201     parser = argparse.ArgumentParser()
202     rules = shlex.split(rule)
203     rules.pop(0)
204     parser.add_argument("--enable", "--enabled", dest="enable", action="store_true")
205     parser.add_argument("--disable", "--disabled", dest="disable", action="store_true")
206     parser.add_argument("--port", dest="port", action="store")
207     parser.add_argument("--service", dest="service", action="store")
208     parser.add_argument("--ssh", dest="ssh", action="store_true")
209     parser.add_argument("--smtp", dest="smtp", action="store_true")
210     parser.add_argument("--http", dest="http", action="store_true")
211     parser.add_argument("--ftp", dest="ftp", action="store_true")
212     args = clean_args(vars(parser.parse_args(rules)))
213     parser = None
214     return args
215 def parse_firstboot(rule):
216     """
217     Parse the firstboot line
218     """
219     parser = argparse.ArgumentParser()
220     rules = shlex.split(rule)
221     rules.pop(0)
222     parser.add_argument("--enable", "--enabled", dest="enable", action="store_true")
223     parser.add_argument("--disable", "--disabled", dest="disable", action="store_true")
224     parser.add_argument("--reconfig", dest="reconfig", action="store_true")
225     args = clean_args(vars(parser.parse_args(rules)))
226     parser = None
227     return args
228 def parse_group(rule):
229     """
230     Parse the group line
231     """
232     parser = argparse.ArgumentParser()
233     rules = shlex.split(rule)
234     rules.pop(0)
235     parser.add_argument("--name", dest="name", action="store")
236     parser.add_argument("--gid", dest="gid", action="store")
237     args = clean_args(vars(parser.parse_args(rules)))
238     parser = None
239     return args
240 def parse_harddrive(rule):
241     """
242     Parse the harddrive line
243     """
244     parser = argparse.ArgumentParser()
245     rules = shlex.split(rule)
246     rules.pop(0)
247     parser.add_argument("--biospart", dest="biospart", action="store")
248     parser.add_argument("--partition", dest="partition", action="store")
249     parser.add_argument("--dir", dest="dir", action="store")
250     args = clean_args(vars(parser.parse_args(rules)))
251     parser = None
252     return args
253 def parse_ignoredisk(rule):
254     """
255     Parse the ignoredisk line
256     """
257     parser = argparse.ArgumentParser()
258     rules = shlex.split(rule)
259     rules.pop(0)
260     parser.add_argument("--drives", dest="drives", action="store")
261     parser.add_argument("--only-use", dest="only-use", action="store")
262     parser.add_argument("--interactive", dest="interactive", action="store_true")
263     args = clean_args(vars(parser.parse_args(rules)))
264     parser = None
265     return args
266 def parse_iscsi(rule):
267     """
268     Parse the iscsi line
269     """
270     parser = argparse.ArgumentParser()
271     rules = shlex.split(rule)
272     rules.pop(0)
273     parser.add_argument("--ipaddr", dest="ipaddr", action="store")
274     parser.add_argument("--port", dest="port", action="store")
275     parser.add_argument("--target", dest="target", action="store")
276     parser.add_argument("--iface", dest="iface", action="store")
277     parser.add_argument("--user", dest="user", action="store")
278     parser.add_argument("--password", dest="password", action="store")
279     parser.add_argument("--reverse-user", dest="reverse-user", action="store")
280     parser.add_argument("--reverse-password", dest="reverse-password", action="store")
281     args = clean_args(vars(parser.parse_args(rules)))
282     parser = None
283     return args
284 def parse_iscsiname(rule):
285     """
286     Parse the iscsiname line
287     """
288     parser = argparse.ArgumentParser()
289     rules = shlex.split(rule)
290     rules.pop(0)
291     args = clean_args(vars(parser.parse_args(rules)))
292     parser = None
293     return args
294 def parse_keyboard(rule):
295     """
296     Parse the keyboard line
297     """
298     parser = argparse.ArgumentParser()
299     rules = shlex.split(rule)
300     rules.pop(0)
301     parser.add_argument("--vckeymap", dest="vckeymap", action="store")
302     parser.add_argument("--xlayouts", dest="xlayouts", action="store")
303     parser.add_argument("--switch", dest="switch", action="store")
304     parser.add_argument("keyboard")
305     args = clean_args(vars(parser.parse_args(rules)))
306     if "keyboard" in args and "xlayouts" not in args:
307         args["xlayouts"] = args["keyboard"]
308     parser = None
309     return args
310 def parse_lang(rule):
311     """
312     Parse the lang line
313     """
314     parser = argparse.ArgumentParser()
315     rules = shlex.split(rule)
316     rules.pop(0)
317     parser.add_argument("lang")
318     args = clean_args(vars(parser.parse_args(rules)))
319     parser = None
320     r<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>eturn args
321 def parse_logvol(rule):
322     """
323     Parse the logvol line
324     """
325     parser = argparse.ArgumentParser()
326     rules = shlex.split(rule)
327     rules.pop(0)
328     parser.add_argument("mntpoint")
329     parser.add_argument(</b></font>"--noformat", dest="noformat", action="store_true")
330     parser.add_argument("--useexisting", dest="useexisting", action="store_true")
331     parser.add_argument("--fstype", dest="fstype", action="store")
332     parser.add_argument("--fsoptions", dest="fsoptions", action="store")
333     parser.add_argument("--grow", dest="grow", action="store_true")
334     parser.add_argument("--maxsize", dest="maxsize", action="store")
335     parser.add_argument("--recommended", dest="recommended", action="store_true")
336     parser.add_argument("--percent", dest="percent", action="store_true")
337     parser.add_argument("--encrypted", dest="encrypted", action="store_true")
338     parser.add_argument("--passphrase", dest="passphrase", action="store")
339     parser.add_argument("--escrowcert", dest="escrowcert", action="store")
340     parser.add_argument(
341         "--backuppassphrase", dest="backuppassphrase", action="store_true"
342     )
343     parser.add_argument("--name", dest="name", action="store")
344     parser.add_argument("--vgname", dest="vgname", action="store")
345     parser.add_argument("--size", dest="size", action="store")
346     parser.add_argument("--label", dest="label", action="store")
347     args = clean_args(vars(parser.parse_args(rules)))
348     parser = None
349     return args
350 def parse_logging(rule):
351     """
352     Parse the logging line
353     """
354     parser = argparse.ArgumentParser()
355     rules = shlex.split(rule)
356     rules.pop(0)
357     parser.add_argument("--host", dest="host", action="store")
358     parser.add_argument("--port", dest="port", action="store")
359     parser.add_argument(
360         "--level",
361         dest="level",
362         action="store",
363         choices=["debug", "info", "warning", "error", "critical"],
364     )
365     args = clean_args(vars(parser.parse_args(rules)))
366     parser = None
367     return args
368 def parse_monitor(rule):
369     """
370     Parse the monitor line
371     """
372     parser = argparse.ArgumentParser()
373     rules = shlex.split(rule)
374     rules.pop(0)
375     parser.add_argument("--hsync", dest="hsync", action="store")
376     parser.add_argument("--monitor", dest="monitor", action="store")
377     parser.add_argument("--noprobe", dest="noprobe", action="store_true")
378     parser.add_argument("--vsync", dest="vsync", action="store")
379     args = clean_args(vars(parser.parse_args(rules)))
380     parser = None
381     return args
382 def parse_multipath(rule):
383     """
384     Parse the multipath line
385     """
386     parser = argparse.ArgumentParser()
387     rules = shlex.split(rule)
388     rules.pop(0)
389     parser.add_argument("--name", dest="name", action="store")
390     parser.add_argument("--device", dest="device", action="store")
391     parser.add_argument("--rule", dest="rule", action="store")
392     args = clean_args(vars(parser.parse_args(rules)))
393     parser = None
394     return args
395 def parse_network(rule):
396     """
397     Parse the network line
398     """
399     parser = argparse.ArgumentParser()
400     rules = shlex.split(rule)
401     rules.pop(0)
402     parser.add_argument(
403         "--bootproto",
404         dest="bootproto",
405         action="store",
406         choices=["dhcp", "bootp", "static", "ibft"],
407     )
408     parser.add_argument("--device", dest="device", action="store")
409     parser.add_argument("--ip", dest="ip", action="store")
410     parser.add_argument("--ipv6", dest="ipv6", action="store")
411     parser.add_argument("--gateway", dest="gateway", action="store")
412     parser.add_argument("--nodefroute", dest="nodefroute", action="store_true")
413     parser.add_argument("--nameserver", dest="nameserver", action="store")
414     parser.add_argument("--nodns", dest="nodns", action="store_true")
415     parser.add_argument("--netmask", dest="netmask", action="store")
416     parser.add_argument("--hostname", dest="hostname", action="store")
417     parser.add_argument("--ethtool", dest="ethtool", action="store")
418     parser.add_argument("--essid", dest="essid", action="store")
419     parser.add_argument("--wepkey", dest="wepkey", action="store")
420     parser.add_argument("--wpakey", dest="wpakey", action="store")
421     parser.add_argument("--onboot", dest="onboot", action="store")
422     parser.add_argument("--dhcpclass", dest="dhcpclass", action="store")
423     parser.add_argument("--mtu", dest="mtu", action="store")
424     parser.add_argument("--noipv4", dest="noipv4", action="store_true")
425     parser.add_argument("--noipv6", dest="noipv6", action="store_true")
426     parser.add_argument("--activate", dest="activate", action="store_true")
427     args = clean_args(vars(parser.parse_args(rules)))
428     parser = None
429     return args
430 def parse_nfs(rule):
431     """
432     Parse the nfs line
433     """
434     parser = argparse.ArgumentParser()
435     rules = shlex.split(rule)
436     rules.pop(0)
437     parser.add_argument("--server", dest="server", action="store")
438     parser.add_argument("--dir", dest="dir", action="store")
439     parser.add_argument("--opts", dest="opts", action="store")
440     args = clean_args(vars(parser.parse_args(rules)))
441     parser = None
442     r<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>eturn args
443 def parse_partition(rule):
444     """
445     Parse the partition line
446     """
447     parser = argparse.ArgumentParser()
448     rules = shlex.split(rule)
449     rules.pop(0)
450     parser.add_argument("mntpoint")
451     parser.add_argument(</b></font>"--size", dest="size", action="store")
452     parser.add_argument("--grow", dest="grow", action="store_true")
453     parser.add_argument("--maxsize", dest="maxsize", action="store")
454     parser.add_argument("--noformat", dest="noformat", action="store_true")
455     parser.add_argument("--onpart", "--usepart", dest="onpart", action="store")
456     parser.add_argument("--ondisk", "--ondrive", dest="ondisk", action="store")
457     parser.add_argument("--asprimary", dest="asprimary", action="store_true")
458     parser.add_argument("--fsprofile", dest="fsprofile", action="store")
459     parser.add_argument("--fstype", dest="fstype", action="store")
460     parser.add_argument("--fsoptions", dest="fsoptions", action="store")
461     parser.add_argument("--label", dest="label", action="store")
462     parser.add_argument("--recommended", dest="recommended", action="store_true")
463     parser.add_argument("--onbiosdisk", dest="onbiosdisk", action="store")
464     parser.add_argument("--encrypted", dest="encrypted", action="store_true")
465     parser.add_argument("--passphrase", dest="passphrase", action="store")
466     parser.add_argument("--escrowcert", dest="escrowcert", action="store")
467     parser.add_argument("--backupphrase", dest="backupphrase", action="store")
468     args = clean_args(vars(parser.parse_args(rules)))
469     parser = None
470     return args
471 def parse_raid(rule):
472     """
473     Parse the raid line
474     """
475     parser = argparse.ArgumentParser()
476     rules = shlex.split(rule)
477     rules.pop(0)
478     partitions = []
479     newrules = []
480     for count, rule in enumerate(rules):
481         if count == 0:
482             newrules.append(rule)
483             continue
484         elif rule.startswith("--"):
485             newrules.append(rule)
486             continue
487         else:
488             partitions.append(rule)
489     rules = newrules
490     parser.add_argument("mntpoint")
491     parser.add_argument("--level", dest="level", action="store")
492     parser.add_argument("--device", dest="device", action="store")
493     parser.add_argument("--spares", dest="spares", action="store")
494     parser.add_argument("--fstype", dest="fstype", action="store")
495     parser.add_argument("--fsoptions", dest="fsoptions", action="store")
496     parser.add_argument("--label", dest="label", action="store")
497     parser.add_argument("--noformat", dest="noformat", action="store_true")
498     parser.add_argument("--useexisting", dest="useexisting", action="store_true")
499     parser.add_argument("--encrypted", dest="encrypted", action="store_true")
500     parser.add_argument("--passphrase", dest="passphrase", action="store")
501     parser.add_argument("--escrowcert", dest="escrowcert", action="store")
502     parser.add_argument("--backuppassphrase", dest="backuppassphrase", action="store")
503     args = clean_args(vars(parser.parse_args(rules)))
504     if partitions:
505         args["partitions"] = partitions
506     parser = None
507     return args
508 def parse_reboot(rule):
509     """
510     Parse the reboot line
511     """
512     parser = argparse.ArgumentParser()
513     rules = shlex.split(rule)
514     rules.pop(0)
515     parser.add_argument("--eject", dest="eject", action="store_true")
516     args = clean_args(vars(parser.parse_args(rules)))
517     parser = None
518     return args
519 def parse_repo(rule):
520     """
521     Parse the repo line
522     """
523     parser = argparse.ArgumentParser()
524     rules = shlex.split(rule)
525     rules.pop(0)
526     parser.add_argument("--name", dest="name", action="store")
527     parser.add_argument("--baseurl", dest="baseurl", action="store")
528     parser.add_argument("--mirrorlist", dest="mirrorlist", action="store")
529     parser.add_argument("--cost", dest="cost", action="store")
530     parser.add_argument("--excludepkgs", dest="excludepkgs", action="store")
531     parser.add_argument("--includepkgs", dest="includepkgs", action="store")
532     parser.add_argument("--proxy", dest="proxy", action="store")
533     parser.add_argument("--ignoregroups", dest="ignoregroups", action="store")
534     parser.add_argument("--noverifyssl", dest="noverifyssl", action="store_true")
535     args = clean_args(vars(parser.parse_args(rules)))
536     parser = None
537     return args
538 def parse_rescue(rule):
539     """
540     Parse the rescue line
541     """
542     parser = argparse.ArgumentParser()
543     rules = shlex.split(rule)
544     rules.pop(0)
545     parser.add_argument("--nomount", dest="nomount", action="store_true")
546     parser.add_argument("--romount", dest="romount", action="store_true")
547     args = clean_args(vars(parser.parse_args(rules)))
548     parser = None
549     return args
550 def parse_rootpw(rule):
551     """
552     Parse the rootpw line
553     """
554     parser = argparse.ArgumentParser()
555     rules = shlex.split(rule)
556     rules.pop(0)
557     parser.add_argument("--iscrypted", dest="iscrypted", action="store_true")
558     parser.add_argument("--plaintext", dest="plaintext", action="store_true")
559     parser.add_argument("--lock", dest="lock", action="store_true")
560     parser.add_argument("password")
561     args = clean_args(vars(parser.parse_args(rules)))
562     parser = None
563     return args
564 def parse_selinux(rule):
565     """
566     Parse the selinux line
567     """
568     parser = argparse.ArgumentParser()
569     rules = shlex.split(rule)
570     rules.pop(0)
571     parser.add_argument("--disabled", dest="disabled", action="store_true")
572     parser.add_argument("--enforcing", dest="enforcing", action="store_true")
573     parser.add_argument("--permissive", dest="permissive", action="store_true")
574     args = clean_args(vars(parser.parse_args(rules)))
575     parser = None
576     return args
577 def parse_services(rule):
578     """
579     Parse the services line
580     """
581     parser = argparse.ArgumentParser()
582     rules = shlex.split(rule)
583     rules.pop(0)
584     parser.add_argument("--disabled", dest="disabled", action="store")
585     parser.add_argument("--enabled", dest="enabled", action="store")
586     args = clean_args(vars(parser.parse_args(rules)))
587     parser = None
588     return args
589 def parse_sshpw(rule):
590     """
591     Parse the sshpw line
592     """
593     parser = argparse.ArgumentParser()
594     rules = shlex.split(rule)
595     rules.pop(0)
596     parser.add_argument("--username", dest="username", action="store")
597     parser.add_argument("--iscrypted", dest="iscrypted", action="store_true")
598     parser.add_argument("--plaintext", dest="plaintext", action="store_true")
599     parser.add_argument("--lock", dest="lock", action="store_true")
600     args = clean_args(vars(parser.parse_args(rules)))
601     parser = None
602     return args
603 def parse_timezone(rule):
604     """
605     Parse the timezone line
606     """
607     parser = argparse.ArgumentParser()
608     rules = shlex.split(rule)
609     rules.pop(0)
610     parser.add_argument("--utc", dest="utc", action="store_true")
611     parser.add_argument("--nontp", dest="nontp", action="store_true")
612     parser.add_argument("--ntpservers", dest="ntpservers", action="store")
613     parser.add_argument("--isUtc", dest="isutc", action="store_true")
614     parser.add_argument("timezone")
615     args = clean_args(vars(parser.parse_args(rules)))
616     parser = None
617     return args
618 def parse_updates(rule):
619     """
620     Parse the updates line
621     rules = shlex.split(rule)
622     rules.pop(0)
623     return {"url": rules<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>[0]} if rules else True
624 def parse_upgrade(rule):
625     """
626     Parse the upgrade line
627     """
628     parser = argparse.ArgumentParser()
629     rules = shlex.split(rule)
630     rules.pop(0)
631     parser.add_argument(</b></font>"--root-device", dest="root-device", action="store")
632     args = clean_args(vars(parser.parse_args(rules)))
633     parser = None
634     if args:
635         return args
636     return True
637 def parse_url(rule):
638     """
639     Parse the url line
640     """
641     parser = argparse.ArgumentParser()
642     rules = shlex.split(rule)
643     rules.pop(0)
644     parser.add_argument("--url", dest="url", action="store")
645     parser.add_argument("--proxy", dest="proxy", action="store")
646     parser.add_argument("--noverifyssl", dest="noverifyssl", action="store_true")
647     args = clean_args(vars(parser.parse_args(rules)))
648     parser = None
649     return args
650 def parse_user(rule):
651     """
652     Parse the user line
653     """
654     parser = argparse.ArgumentParser()
655     rules = shlex.split(rule)
656     rules.pop(0)
657     parser.add_argument("--name", dest="name", action="store")
658     parser.add_argument("--gecos", dest="gecos", action="store")
659     parser.add_argument("--groups", dest="groups", action="store")
660     parser.add_argument("--homedir", dest="homedir", action="store")
661     parser.add_argument("--lock", dest="lock", action="store_true")
662     parser.add_argument("--password", dest="password", action="store")
663     parser.add_argument("--iscrypted", dest="iscrypted", action="store_true")
664     parser.add_argument("--plaintext", dest="plaintext", action="store_true")
665     parser.add_argument("--shell", dest="shell", action="store")
666     parser.add_argument("--uid", dest="uid", action="store")
667     args = clean_args(vars(parser.parse_args(rules)))
668     parser = None
669     return args
670 def parse_vnc(rule):
671     """
672     Parse the vnc line
673     """
674     parser = argparse.ArgumentParser()
675     rules = shlex.split(rule)
676     rules.pop(0)
677     parser.add_argument("--host", dest="host", action="store")
678     parser.add_argument("--port", dest="port", action="store")
679     parser.add_argument("--password", dest="password", action="store")
680     args = clean_args(vars(parser.parse_args(rules)))
681     parser = None
682     return args
683 def parse_volgroup(rule):
684     """
685     Parse the volgroup line
686     """
687     parser = argparse.ArgumentParser()
688     rules = shlex.split(rule)
689     rules.pop(0)
690     partitions = []
691     newrules = []
692     for count, rule in enumerate(rules):
693         if count == 0:
694             newrules.append(rule)
695             continue
696         elif rule.startswith("--"):
697             newrules.append(rule)
698             continue
699         else:
700             partitions.append(rule)
701     rules = newrules
702     parser.add_argument("name")
703     parser.add_argument("--noformat", dest="noformat", action="store_true")
704     parser.add_argument("--useexisting", dest="useexisting", action="store_true")
705     parser.add_argument("--pesize", dest="pesize", action="store")
706     parser.add_argument("--reserved-space", dest="reserved-space", action="store")
707     parser.add_argument("--reserved-percent", dest="reserved-percent", action="store")
708     args = clean_args(vars(parser.parse_args(rules)))
709     if partitions:
710         args["partitions"] = partitions
711     parser = None
712     return args
713 def parse_xconfig(rule):
714     """
715     Parse the xconfig line
716     """
717     parser = argparse.ArgumentParser()
718     rules = shlex.split(rule)
719     rules.pop(0)
720     parser.add_argument("--defaultdesktop", dest="defaultdesktop", action="store")
721     parser.add_argument("--startxonboot", dest="startxonboot", action="store_true")
722     args = clean_args(vars(parser.parse_args(rules)))
723     parser = None
724     return args
725 def parse_zfcp(rule):
726     """
727     Parse the zfcp line
728     """
729     parser = argparse.ArgumentParser()
730     rules = shlex.split(rule)
731     rules.pop(0)
732     parser.add_argument("--devnum", dest="devnum", action="store")
733     parser.add_argument("--fcplun", dest="fcplun", action="store")
734     parser.add_argument("--wwpn", dest="wwpn", action="store")
735     args = clean_args(vars(parser.parse_args(rules)))
736     parser = None
737     return args
738 def mksls(src, dst=None):
739     """
740     Convert a kickstart file to an SLS file
741     """
742     mode = "command"
743     sls = {}
744     ks_opts = {}
745     with salt.utils.files.fopen(src, "r") as fh_:
746         for line in fh_:
747             if line.startswith("#"):
748                 continue
749             if mode == "command":
750                 if line.startswith("auth ") or line.startswith("authconfig "):
751                     ks_opts["auth"] = parse_auth(line)
752                 elif line.startswith("autopart"):
753                     ks_opts["autopath"] = parse_autopart(line)
754                 elif line.startswith("autostep"):
755                     ks_opts["autostep"] = parse_autostep(line)
756                 elif line.startswith("bootloader"):
757                     ks_opts["bootloader"] = parse_bootloader(line)
758                 elif line.startswith("btrfs"):
759                     ks_opts["btrfs"] = parse_btrfs(line)
760                 elif line.startswith("cdrom"):
761                     ks_opts["cdrom"] = True
762                 elif line.startswith("clearpart"):
763                     ks_opts["clearpart"] = parse_clearpart(line)
764                 elif line.startswith("cmdline"):
765                     ks_opts["cmdline"] = True
766                 elif line.startswith("device"):
767                     ks_opts["device"] = parse_device(line)
768                 elif line.startswith("dmraid"):
769                     ks_opts["dmraid"] = parse_dmraid(line)
770                 elif line.startswith("driverdisk"):
771                     ks_opts["driverdisk"] = parse_driverdisk(line)
772                 elif line.startswith("firewall"):
773                     ks_opts["firewall"] = parse_firewall(line)
774                 elif line.startswith("firstboot"):
775                 elif line.startswith("group"):
776                     ks_opts["group"] = parse_group(line)
777                 elif line<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.startswith("graphical"):
778                     ks_opts["graphical"] = True
779                 elif line.startswith("halt"):
780                     ks_opts["halt"] = True
781                 elif line.startswith("harddrive"):
782                     ks_opts["harddrive"] = True
783                 elif line.startswith("ignoredisk"):
784                     ks_opts["ignoredisk"] =</b></font> parse_ignoredisk(line)
785                 elif line.startswith("install"):
786                     ks_opts["install"] = True
787                 elif line.startswith("iscsi"):
788                     ks_opts["iscsi"] = parse_iscsi(line)
789                 elif line.startswith("iscsiname"):
790                     ks_opts["iscsiname"] = parse_iscsiname(line)
791                 elif line.startswith("keyboard"):
792                     ks_opts["keyboard"] = parse_keyboard(line)
793                 elif line.startswith("lang"):
794                     ks_opts["lang"] = parse_lang(line)
795                 elif line.startswith("logvol"):
796                     if "logvol" not in ks_opts:
797                         ks_opts["logvol"] = []
798                     ks_opts["logvol"].append(parse_logvol(line))
799                 elif line.startswith("logging"):
800                     ks_opts["logging"] = parse_logging(line)
801                 elif line.startswith("mediacheck"):
802                     ks_opts["mediacheck"] = True
803                 elif line.startswith("monitor"):
804                     ks_opts["monitor"] = parse_monitor(line)
805                 elif line.startswith("multipath"):
806                     ks_opts["multipath"] = parse_multipath(line)
807                 elif line.startswith("network"):
808                     if "network" not in ks_opts:
809                         ks_opts["network"] = []
810                     ks_opts["network"].append(parse_network(line))
811                 elif line.startswith("nfs"):
812                     ks_opts["nfs"] = True
813                 elif line.startswith("part ") or line.startswith("partition"):
814                     if "part" not in ks_opts:
815                         ks_opts["part"] = []
816                     ks_opts["part"].append(parse_partition(line))
817                 elif line.startswith("poweroff"):
818                     ks_opts["poweroff"] = True
819                 elif line.startswith("raid"):
820                     if "raid" not in ks_opts:
821                         ks_opts["raid"] = []
822                     ks_opts["raid"].append(parse_raid(line))
823                 elif line.startswith("reboot"):
824                     ks_opts["reboot"] = parse_reboot(line)
825                 elif line.startswith("repo"):
826                     ks_opts["repo"] = parse_repo(line)
827                 elif line.startswith("rescue"):
828                     ks_opts["rescue"] = parse_rescue(line)
829                 elif line.startswith("rootpw"):
830                     ks_opts["rootpw"] = parse_rootpw(line)
831                 elif line.startswith("selinux"):
832                     ks_opts["selinux"] = parse_selinux(line)
833                 elif line.startswith("services"):
834                     ks_opts["services"] = parse_services(line)
835                 elif line.startswith("shutdown"):
836                 elif line.startswith("sshpw"):
837                     ks_opts["sshpw"] = parse_sshpw(line)
838                 elif line<font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.startswith("skipx"):
839                     ks_opts["skipx"] = True
840                 elif line.startswith("text"):
841                     ks_opts["text"] = True
842                 elif line.startswith("timezone"):
843                     ks_opts["timezone"] =</b></font> parse_timezone(line)
844                 elif line.startswith("updates"):
845                     ks_opts["updates"] = parse_updates(line)
846                 elif line.startswith("upgrade"):
847                     ks_opts["upgrade"] = parse_upgrade(line)
848                 elif line.startswith("url"):
849                     ks_opts["url"] = True
850                 elif line.startswith("user"):
851                     ks_opts["user"] = parse_user(line)
852                 elif line.startswith("vnc"):
853                     ks_opts["vnc"] = parse_vnc(line)
854                 elif line.startswith("volgroup"):
855                     ks_opts["volgroup"] = parse_volgroup(line)
856                 elif line.startswith("xconfig"):
857                     ks_opts["xconfig"] = parse_xconfig(line)
858                 elif line.startswith("zerombr"):
859                     ks_opts["zerombr"] = True
860                 elif line.startswith("zfcp"):
861                     ks_opts["zfcp"] = parse_zfcp(line)
862             if line.startswith("%include"):
863                 rules = shlex.split(line)
864                 if not ks_opts["include"]:
865                     ks_opts["include"] = []
866                 ks_opts["include"].append(rules[1])
867             if line.startswith("%ksappend"):
868                 rules = shlex.split(line)
869                 if not ks_opts["ksappend"]:
870                     ks_opts["ksappend"] = []
871                 ks_opts["ksappend"].append(rules[1])
872             if line.startswith("%packages"):
873                 mode = "packages"
874                 if "packages" not in ks_opts:
875                     ks_opts["packages"] = {"packages": {}}
876                 parser = argparse.ArgumentParser()
877                 opts = shlex.split(line)
878                 opts.pop(0)
879                 parser.add_argument("--default", dest="default", action="store_true")
880                 parser.add_argument(
881                     "--excludedocs", dest="excludedocs", action="store_true"
882                 )
883                 parser.add_argument(
884                     "--ignoremissing", dest="ignoremissing", action="store_true"
885                 )
886                 parser.add_argument("--instLangs", dest="instLangs", action="store")
887                 parser.add_argument("--multilib", dest="multilib", action="store_true")
888                 parser.add_argument(
889                     "--nodefaults", dest="nodefaults", action="store_true"
890                 )
891                 parser.add_argument("--optional", dest="optional", action="store_true")
892                 parser.add_argument("--nobase", dest="nobase", action="store_true")
893                 args = clean_args(vars(parser.parse_args(opts)))
894                 ks_opts["packages"]["options"] = args
895                 continue
896             if line<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.startswith("%pre"):
897                 mode = "pre"
898                 parser = argparse.ArgumentParser()
899                 opts = shlex.split(line)
900                 opts.pop(0)
901                 parser.add_argument(</b></font>"--interpreter", dest="interpreter", action="store")
902                 parser.add_argument(
903                     "--erroronfail", dest="erroronfail", action="store_true"
904                 )
905                 parser.add_argument("--log", dest="log", action="store")
906                 args = clean_args(vars(parser.parse_args(opts)))
907                 ks_opts["pre"] = {"options": args, "script": ""}
908                 continue
909             if line.startswith("%post"):
910                 mode = "post"
911                 parser = argparse.ArgumentParser()
912                 opts = shlex.split(line)
913                 opts.pop(0)
914                 parser.add_argument("--nochroot", dest="nochroot", action="store_true")
915                 parser.add_argument("--interpreter", dest="interpreter", action="store")
916                 parser.add_argument(
917                     "--erroronfail", dest="erroronfail", action="store_true"
918                 )
919                 parser.add_argument("--log", dest="log", action="store")
920                 args = clean_args(vars(parser.parse_args(opts)))
921                 ks_opts["post"] = {"options": args, "script": ""}
922                 continue
923             if line.startswith("%end"):
924                 mode = None
925             if mode == "packages":
926                 if line.startswith("-"):
927                     package = line.replace("-", "", 1).strip()
928                     ks_opts["packages"]["packages"][package] = False
929                 else:
930                     ks_opts["packages"]["packages"][line.strip()] = True
931             if mode == "pre":
932                 ks_opts["pre"]["script"] += line
933             if mode == "post":
934     sls<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>[ks_opts["lang"]["lang"]] = {"locale": ["system"]}
935     sls[ks_opts["keyboard"]["xlayouts"]] = {"keyboard": ["system"]}
936     sls[ks_opts["timezone"][</b></font>"timezone"]] = {"timezone": ["system"]}
937     if "utc" in ks_opts["timezone"]:
938         sls[ks_opts["timezone"]["timezone"]]["timezone"].append("utc")
939     if "network" in ks_opts:
940         for interface in ks_opts["network"]:
941             device = interface.get("device", None)
942             if device is not None:
943                 del interface["device"]
944                 sls[device] = {"proto": interface["bootproto"]}
945                 del interface["bootproto"]
946                 if "onboot" in interface:
947                     if "no" in interface["onboot"]:
948                         sls[device]["enabled"] = False
949                     else:
950                         sls[device]["enabled"] = True
951                     del interface["onboot"]
952                 if "noipv4" in interface:
953                     sls[device]["ipv4"] = {"enabled": False}
954                     del interface["noipv4"]
955                 if "noipv6" in interface:
956                     sls[device]["ipv6"] = {"enabled": False}
957                     del interface["noipv6"]
958                 for option in interface:
959                     if type(interface[option]) is bool:
960                         sls[device][option] = {"enabled": [interface[option]]}
961                     else:
962                         sls[device][option] = interface[option]
963             if "hostname" in interface:
964                 sls["system"] = {
965                     "network.system": {
966                         "enabled": True,
967                         "hostname": interface["hostname"],
968                         "apply_hostname": True,
969                     }
970                 }
971     if "selinux" in ks_opts:
972         for mode in ks_opts["selinux"]:
973             sls[mode] = {"selinux": ["mode"]}
974     if "nobase" not in ks_opts["packages"]["options"]:
975         sls["base"] = {"pkg_group": ["installed"]}
976     packages = ks_opts["packages"]["packages"]
977     for package in packages:
978         if not packages[package]:
979             continue
980         if package and packages[package] is True:
981             if package.startswith("@"):
982                 pkg_group = package.replace("@", "", 1)
983                 sls[pkg_group] = {"pkg_group": ["installed"]}
984             else:
985                 sls[package] = {"pkg": ["installed"]}
986         elif packages[package] is False:
987             sls[package] = {"pkg": ["absent"]}
988     if dst:
989         with salt.utils.files.fopen(dst, "w") as fp_:
990             salt.utils.yaml.safe_dump(sls, fp_, default_flow_style=False)
991     else:
992         return salt.utils.yaml.safe_dump(sls, default_flow_style=False)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_ipaddress.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import contextlib
2 import functools
3 import operator
4 import pickle
5 import re
6 import sys
7 import weakref
8 import pytest
9 from salt._compat import ipaddress
10 from tests.support.unit import TestCase, skipIf
11 @functools.total_ordering
12 class _LARGEST:
13     """
14     Object that is greater than anything (except itself).
15     """
16     def __eq__(self, other):
17         return isinstance(other, _LARGEST)
18     def __lt__(self, other):
19         return False
20 LARGEST = _LARGEST()
21 @functools.total_ordering
22 class _SMALLEST:
23     """
24     Object that is less than anything (except itself).
25     """
26     def __eq__(self, other):
27         return isinstance(other, _SMALLEST)
28     def __gt__(self, other):
29         return False
30 SMALLEST = _SMALLEST()
31 class BaseTestCase(TestCase):
32     @property
33     def factory(self):
34         raise NotImplementedError
35     @contextlib.contextmanager
36     def assertCleanError(self, exc_type, details, *args):
37         """
38         Ensure exception does not display a context by default
39         Wraps unittest.TestCase.assertRaisesRegex
40         """
41         if args:
42             details = details % args
43         cm = self.assertRaisesRegex(exc_type, details)
44         with cm as exc:
45             yield exc
46         if exc.exception.__context__ is not None:
47             self.assertTrue(exc.exception.__suppress_context__)
48     def assertAddressError(self, details, *args):
49         return self.assertCleanError(ipaddress.AddressValueError, details, *args)
50     def assertNetmaskError(self, details, *args):
51         return self.assertCleanError(ipaddress.NetmaskValueError, details, *args)
52     def assertInstancesEqual(self, lhs, rhs):
53         self.assertEqual(self.factory(lhs), self.factory(rhs))
54 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
55 class CommonTestMixin:
56     def test_empty_address(self):
57         with self.assertAddressError("Address cannot be empty"):
58             self.factory("")
59     def test_floats_rejected(self):
60         with self.assertAddressError(re.escape(repr("1.0"))):
61             self.factory(1.0)
62     def test_not_an_index_issue15559(self):
63         self.assertRaises(TypeError, operator.index, self.factory(1))
64         self.assertRaises(TypeError, hex, self.factory(1))
65         self.assertRaises(TypeError, bytes, self.factory(1))
66     def pickle_test(self, addr):
67         for proto in range(pickle.HIGHEST_PROTOCOL + 1):
68             with self<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.subTest(proto=proto):
69                 x = self.factory(addr)
70                 y = pickle.loads(pickle.dumps(x, proto))
71                 self.assertEqual(</b></font>y, x)
72 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
73 class CommonTestMixin_v4(CommonTestMixin):
74     def test_leading_zeros(self):
75         msg = r"Leading zeros are not permitted in '\d+'"
76         addresses = [
77             "000.000.000.000",
78             "192.168.000.001",
79             "016.016.016.016",
80             "192.168.000.001",
81             "001.000.008.016",
82             "01.2.3.40",
83             "1.02.3.40",
84             "1.2.03.40",
85             "1.2.3.040",
86         ]
87         for address in addresses:
88             with self.subTest(address=address):
89                 with self.assertAddressError(msg):
90                     self.factory(address)
91     def test_int(self):
92         self.assertInstancesEqual(0, "0.0.0.0")
93         self.assertInstancesEqual(3232235521, "192.168.0.1")
94     def test_packed(self):
95         self.assertInstancesEqual(bytes.fromhex("00000000"), "0.0.0.0")
96         self.assertInstancesEqual(bytes.fromhex("c0a80001"), "192.168.0.1")
97     def test_negative_ints_rejected(self):
98         msg = "-1 (&lt; 0) is not permitted as an IPv4 address"
99         with self.assertAddressError(re.escape(msg)):
100             self.factory(-1)
101     def test_large_ints_rejected(self):
102         msg = "%d (&gt;= 2**32) is not permitted as an IPv4 address"
103         with self.assertAddressError(re.escape(msg % 2 ** 32)):
104             self.factory(2 ** 32)
105     def test_bad_packed_length(self):
106         def assertBadLength(length):
107             addr = b"\0" * length
108             msg = "%r (len %d != 4) is not permitted as an IPv4 address"
109             with self.assertAddressError(re.escape(msg % (addr, length))):
110                 self.factory(addr)
111         assertBadLength(3)
112         assertBadLength(5)
113 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
114 class CommonTestMixin_v6(CommonTestMixin):
115     def test_leading_zeros(self):
116         self.assertInstancesEqual("0000::0000", "::")
117         self.assertInstancesEqual("000::c0a8:0001", "::c0a8:1")
118     def test_int(self):
119         self.assertInstancesEqual(0, "::")
120         self.assertInstancesEqual(3232235521, "::c0a8:1")
121     def test_packed(self):
122         addr = b"\0" * 12 + bytes.fromhex("00000000")
123         self<font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertInstancesEqual(addr, "::")
124         addr = b"\0" * 12 + bytes.fromhex("c0a80001")
125         self.assertInstancesEqual(addr, "::c0a8:1")
126         addr = bytes.fromhex("c0a80001") + b"\0" * 12
127         self.assertInstancesEqual(</b></font>addr, "c0a8:1::")
128     def test_negative_ints_rejected(self):
129         msg = "-1 (&lt; 0) is not permitted as an IPv6 address"
130         with self.assertAddressError(re.escape(msg)):
131             self.factory(-1)
132     def test_large_ints_rejected(self):
133         msg = "%d (&gt;= 2**128) is not permitted as an IPv6 address"
134         with self.assertAddressError(re.escape(msg % 2 ** 128)):
135             self.factory(2 ** 128)
136     def test_bad_packed_length(self):
137         def assertBadLength(length):
138             addr = b"\0" * length
139             msg = "%r (len %d != 16) is not permitted as an IPv6 address"
140             with self.assertAddressError(re.escape(msg % (addr, length))):
141                 self.factory(addr)
142                 self.factory(addr)
143         assertBadLength(15)
144         assertBadLength(17)
145     def test_blank_scope_id(self):
146         address = "::1%"
147         with self.assertAddressError('Invalid IPv6 address: "%r"', address):
148             self.factory(address)
149     def test_invalid_scope_id_with_percent(self):
150         address = "::1%scope%"
151         with self.assertAddressError('Invalid IPv6 address: "%r"', address):
152             self.factory(address)
153 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
154 class AddressTestCase_v4(BaseTestCase, CommonTestMixin_v4):
155     factory = ipaddress.IPv4Address
156     @pytest.mark.skipif(sys.version_info &lt; (3, 6), reason="Don't run on Py3.5")
157     def test_format(self):
158         v4 = ipaddress.IPv4Address("1.2.3.42")
159         v4_pairs = [
160             ("b", "00000001000000100000001100101010"),
161             ("n", "00000001000000100000001100101010"),
162             ("x", "0102032a"),
163             ("X", "0102032A"),
164             ("_b", "0000_0001_0000_0010_0000_0011_0010_1010"),
165             ("_n", "0000_0001_0000_0010_0000_0011_0010_1010"),
166             ("_x", "0102_032a"),
167             ("_X", "0102_032A"),
168             ("#b", "0b00000001000000100000001100101010"),
169             ("#n", "0b00000001000000100000001100101010"),
170             ("#x", "0x0102032a"),
171             ("#X", "0X0102032A"),
172             ("#_b", "0b0000_0001_0000_0010_0000_0011_0010_1010"),
173             ("#_n", "0b0000_0001_0000_0010_0000_0011_0010_1010"),
174             ("#_x", "0x0102_032a"),
175             ("#_X", "0X0102_032A"),
176             ("s", "1.2.3.42"),
177             ("", "1.2.3.42"),
178         ]
179         for (fmt, txt) in v4_pairs:
180             self.assertEqual(txt, format(v4, fmt))
181     def test_network_passed_as_address(self):
182         addr = "127.0.0.1/24"
183         with self.assertAddressError("Unexpected '/' in %r", addr):
184             ipaddress.IPv4Address(addr)
185     def test_bad_address_split(self):
186         def assertBadSplit(addr):
187             with self.assertAddressError("Expected 4 octets in %r", addr):
188                 ipaddress.IPv4Address(addr)
189         assertBadSplit("127.0.1")
190         assertBadSplit("42.42.42.42.42")
191         assertBadSplit("42.42.42")
192         assertBadSplit("42.42")
193         assertBadSplit("42")
194         assertBadSplit("42..42.42.42")
195         assertBadSplit("42.42.42.42.")
196         assertBadSplit("42.42.42.42...")
197         assertBadSplit(".42.42.42.42")
198         assertBadSplit("...42.42.42.42")
199         assertBadSplit("016.016.016")
200         assertBadSplit("016.016")
201         assertBadSplit("016")
202         assertBadSplit("000")
203         assertBadSplit("0x0a.0x0a.0x0a")
204         assertBadSplit("0x0a.0x0a")
205         assertBadSplit("0x0a")
206         assertBadSplit(".")
207         assertBadSplit("bogus")
208         assertBadSplit("bogus.com")
209         assertBadSplit("1000")
210         assertBadSplit("1000000000000000")
211         assertBadSplit("192.168.0.1.com")
212     def test_empty_octet(self):
213         def assertBadOctet(addr):
214             with self.assertAddressError("Empty octet not permitted in %r", addr):
215                 ipaddress.IPv4Address(addr)
216         assertBadOctet("42..42.42")
217         assertBadOctet("...")
218     def test_invalid_characters(self):
219         def assertBadOctet(addr, octet):
220             msg = "Only decimal digits permitted in {!r} in {!r}".format(octet, addr)
221             with self.assertAddressError(re.escape(msg)):
222                 ipaddress.IPv4Address(addr)
223         assertBadOctet("0x0a.0x0a.0x0a.0x0a", "0x0a")
224         assertBadOctet("0xa.0x0a.0x0a.0x0a", "0xa")
225         assertBadOctet("42.42.42.-0", "-0")
226         assertBadOctet("42.42.42.+0", "+0")
227         assertBadOctet("42.42.42.-42", "-42")
228         assertBadOctet("+1.+2.+3.4", "+1")
229         assertBadOctet("1.2.3.4e0", "4e0")
230         assertBadOctet("1.2.3.4::", "4::")
231         assertBadOctet("1.a.2.3", "a")
232     def test_octet_length(self):
233         def assertBadOctet(addr, octet):
234             msg = "At most 3 characters permitted in %r in %r"
235             with self.assertAddressError(re.escape(msg % (octet, addr))):
236                 ipaddress.IPv4Address(addr)
237         assertBadOctet("0000.000.000.000", "0000")
238         assertBadOctet("12345.67899.-54321.-98765", "12345")
239     def test_octet_limit(self):
240         def assertBadOctet(addr, octet):
241             msg = "Octet %d (&gt; 255) not permitted in %r" % (octet, addr)
242             with self.assertAddressError(re.escape(msg)):
243                 ipaddress.IPv4Address(addr)
244         assertBadOctet("257.0.0.0", 257)
245         assertBadOctet("192.168.0.999", 999)
246     def test_pickle(self):
247         self.pickle_test("192.0.2.1")
248     def test_weakref(self):
249         weakref.ref(self.factory("192.0.2.1"))
250 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
251 class AddressTestCase_v6(BaseTestCase, CommonTestMixin_v6):
252     factory = ipaddress.IPv6Address
253     @pytest.mark.skipif(sys.version_info &lt; (3, 6), reason="Don't run on Py3.5")
254     def test_format(self):
255         v6 = ipaddress.IPv6Address("::1.2.3.42")
256         v6_pairs = [
257             (
258                 "b",
259                 "000000000000000000000000000000000000000000000000000000"
260                 "000000000000000000000000000000000000000000000000010000"
261                 "00100000001100101010",
262             ),
263             ("n", "0000000000000000000000000102032a"),
264             ("x", "0000000000000000000000000102032a"),
265             ("X", "0000000000000000000000000102032A"),
266             (
267                 "_b",
268                 "0000_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
269                 "_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
270                 "_0000_0000_0000_0000_0001_0000_0010_0000_0011_0010"
271                 "_1010",
272             ),
273             ("_n", "0000_0000_0000_0000_0000_0000_0102_032a"),
274             ("_x", "0000_0000_0000_0000_0000_0000_0102_032a"),
275             ("_X", "0000_0000_0000_0000_0000_0000_0102_032A"),
276             (
277                 "#b",
278                 "0b0000000000000000000000000000000000000000000000000000"
279                 "000000000000000000000000000000000000000000000000000100"
280                 "0000100000001100101010",
281             ),
282             ("#n", "0x0000000000000000000000000102032a"),
283             ("#x", "0x0000000000000000000000000102032a"),
284             ("#X", "0X0000000000000000000000000102032A"),
285             (
286                 "#_b",
287                 "0b0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
288                 "_0000_0000_0000_0000_0000_0000_0000_0000_0000_0000"
289                 "_0000_0000_0000_0000_0000_0001_0000_0010_0000_0011"
290                 "_0010_1010",
291             ),
292             ("#_n", "0x0000_0000_0000_0000_0000_0000_0102_032a"),
293             ("#_x", "0x0000_0000_0000_0000_0000_0000_0102_032a"),
294             ("#_X", "0X0000_0000_0000_0000_0000_0000_0102_032A"),
295             ("s", "::102:32a"),
296             ("", "::102:32a"),
297         ]
298         for (fmt, txt) in v6_pairs:
299             self.assertEqual(txt, format(v6, fmt))
300     def test_network_passed_as_address(self):
301         def assertBadSplit(addr):
302             msg = "Unexpected '/' in %r"
303             with self.assertAddressError(msg, addr):
304                 ipaddress.IPv6Address(addr)
305         assertBadSplit("::1/24")
306         assertBadSplit("::1%scope_id/24")
307     def test_bad_address_split_v6_not_enough_parts(self):
308         def assertBadSplit(addr):
309             msg = "At least 3 parts expected in %r"
310             with self.assertAddressError(msg, addr.split("%")[0]):
311                 ipaddress.IPv6Address(addr)
312         assertBadSplit(":")
313         assertBadSplit(":1")
314         assertBadSplit("FEDC:9878")
315         assertBadSplit(":%scope")
316         assertBadSplit(":1%scope")
317         assertBadSplit("FEDC:9878%scope")
318     def test_bad_address_split_v6_too_many_colons(self):
319         def assertBadSplit(addr):
320             msg = "At most 8 colons permitted in %r"
321             with self.assertAddressError(msg, addr.split("%")[0]):
322                 ipaddress.IPv6Address(addr)
323         assertBadSplit("9:8:7:6:5:4:3::2:1")
324         assertBadSplit("10:9:8:7:6:5:4:3:2:1")
325         assertBadSplit("::8:7:6:5:4:3:2:1")
326         assertBadSplit("8:7:6:5:4:3:2:1::")
327         assertBadSplit("10:9:8:7:6:5:4:3:42.42.42.42")
328         assertBadSplit("9:8:7:6:5:4:3::2:1%scope")
329         assertBadSplit("10:9:8:7:6:5:4:3:2:1%scope")
330         assertBadSplit("::8:7:6:5:4:3:2:1%scope")
331         assertBadSplit("8:7:6:5:4:3:2:1::%scope")
332         assertBadSplit("10:9:8:7:6:5:4:3:42.42.42.42%scope")
333     def test_bad_address_split_v6_too_many_parts(self):
334         def assertBadSplit(addr):
335             msg = "Exactly 8 parts expected without '::' in %r"
336             with self.assertAddressError(msg, addr.split("%")[0]):
337                 ipaddress.IPv6Address(addr)
338         assertBadSplit("3ffe:0:0:0:0:0:0:0:1")
339         assertBadSplit("9:8:7:6:5:4:3:2:1")
340         assertBadSplit("7:6:5:4:3:2:1")
341         assertBadSplit("9:8:7:6:5:4:3:42.42.42.42")
342         assertBadSplit("7:6:5:4:3:42.42.42.42")
343         assertBadSplit("3ffe:0:0:0:0:0:0:0:1%scope")
344         assertBadSplit("9:8:7:6:5:4:3:2:1%scope")
345         assertBadSplit("7:6:5:4:3:2:1%scope")
346         assertBadSplit("9:8:7:6:5:4:3:42.42.42.42%scope")
347         assertBadSplit("7:6:5:4:3:42.42.42.42%scope")
348     def test_bad_address_split_v6_too_many_parts_with_double_colon(self):
349         def assertBadSplit(addr):
350             msg = "Expected at most 7 other parts with '::' in %r"
351             with self.assertAddressError(msg, addr.split("%")[0]):
352                 ipaddress.IPv6Address(addr)
353         assertBadSplit("1:2:3:4::5:6:7:8")
354         assertBadSplit("1:2:3:4::5:6:7:8%scope")
355     def test_bad_address_split_v6_repeated_double_colon(self):
356         def assertBadSplit(addr):
357             msg = "At most one '::' permitted in %r"
358             with self.assertAddressError(msg, addr.split("%")[0]):
359                 ipaddress.IPv6Address(addr)
360         assertBadSplit("3ffe::1::1")
361         assertBadSplit("1::2::3::4:5")
362         assertBadSplit("2001::db:::1")
363         assertBadSplit("3ffe::1::")
364         assertBadSplit("::3ffe::1")
365         assertBadSplit(":3ffe::1::1")
366         assertBadSplit("3ffe::1::1:")
367         assertBadSplit(":3ffe::1::1:")
368         assertBadSplit(":::")
369         assertBadSplit("2001:db8:::1")
370         assertBadSplit("3ffe::1::1%scope")
371         assertBadSplit("1::2::3::4:5%scope")
372         assertBadSplit("2001::db:::1%scope")
373         assertBadSplit("3ffe::1::%scope")
374         assertBadSplit("::3ffe::1%scope")
375         assertBadSplit(":3ffe::1::1%scope")
376         assertBadSplit("3ffe::1::1:%scope")
377         assertBadSplit(":3ffe::1::1:%scope")
378         assertBadSplit(":::%scope")
379         assertBadSplit("2001:db8:::1%scope")
380     def test_bad_address_split_v6_leading_colon(self):
381         def assertBadSplit(addr):
382             msg = "Leading ':' only permitted as part of '::' in %r"
383             with self.assertAddressError(msg, addr.split("%")[0]):
384                 ipaddress.IPv6Address(addr)
385         assertBadSplit(":2001:db8::1")
386         assertBadSplit(":1:2:3:4:5:6:7")
387         assertBadSplit(":1:2:3:4:5:6:")
388         assertBadSplit(":6:5:4:3:2:1::")
389         assertBadSplit(":2001:db8::1%scope")
390         assertBadSplit(":1:2:3:4:5:6:7%scope")
391         assertBadSplit(":1:2:3:4:5:6:%scope")
392         assertBadSplit(":6:5:4:3:2:1::%scope")
393     def test_bad_address_split_v6_trailing_colon(self):
394         def assertBadSplit(addr):
395             msg = "Trailing ':' only permitted as part of '::' in %r"
396             with self.assertAddressError(msg, addr.split("%")[0]):
397                 ipaddress.IPv6Address(addr)
398         assertBadSplit("2001:db8::1:")
399         assertBadSplit("1:2:3:4:5:6:7:")
400         assertBadSplit("::1.2.3.4:")
401         assertBadSplit("::7:6:5:4:3:2:")
402         assertBadSplit("2001:db8::1:%scope")
403         assertBadSplit("1:2:3:4:5:6:7:%scope")
404         assertBadSplit("::1.2.3.4:%scope")
405         assertBadSplit("::7:6:5:4:3:2:%scope")
406     def test_bad_v4_part_in(self):
407         def assertBadAddressPart(addr, v4_error):
408             with self.assertAddressError("%s in %r", v4_error, addr.split("%")[0]):
409                 ipaddress.IPv6Address(addr)
410         assertBadAddressPart("3ffe::1.net", "Expected 4 octets in '1.net'")
411         assertBadAddressPart("3ffe::127.0.1", "Expected 4 octets in '127.0.1'")
412         assertBadAddressPart("::1.2.3", "Expected 4 octets in '1.2.3'")
413         assertBadAddressPart("::1.2.3.4.5", "Expected 4 octets in '1.2.3.4.5'")
414         assertBadAddressPart(
415             "3ffe::1.1.1.net",
416             "Only decimal digits permitted in 'net' in '1.1.1.net'",
417         )
418         assertBadAddressPart("3ffe::1.net%scope", "Expected 4 octets in '1.net'")
419         assertBadAddressPart("3ffe::127.0.1%scope", "Expected 4 octets in '127.0.1'")
420         assertBadAddressPart("::1.2.3%scope", "Expected 4 octets in '1.2.3'")
421         assertBadAddressPart("::1.2.3.4.5%scope", "Expected 4 octets in '1.2.3.4.5'")
422         assertBadAddressPart(
423             "3ffe::1.1.1.net%scope",
424             "Only decimal digits permitted in 'net' in '1.1.1.net'",
425         )
426     def test_invalid_characters(self):
427         def assertBadPart(addr, part):
428             msg = "Only hex digits permitted in {!r} in {!r}".format(
429                 part, addr.split("%")[0]
430             )
431             with self.assertAddressError(re.escape(msg)):
432                 ipaddress.IPv6Address(addr)
433         assertBadPart("3ffe::goog", "goog")
434         assertBadPart("3ffe::-0", "-0")
435         assertBadPart("3ffe::+0", "+0")
436         assertBadPart("3ffe::-1", "-1")
437         assertBadPart("1.2.3.4::", "1.2.3.4")
438         assertBadPart("1234:axy::b", "axy")
439         assertBadPart("3ffe::goog%scope", "goog")
440         assertBadPart("3ffe::-0%scope", "-0")
441         assertBadPart("3ffe::+0%scope", "+0")
442         assertBadPart("3ffe::-1%scope", "-1")
443         assertBadPart("1.2.3.4::%scope", "1.2.3.4")
444         assertBadPart("1234:axy::b%scope", "axy")
445     def test_part_length(self):
446         def assertBadPart(addr, part):
447             msg = "At most 4 characters permitted in %r in %r"
448             with self.assertAddressError(msg, part, addr.split("%")[0]):
449                 ipaddress.IPv6Address(addr)
450         assertBadPart("::00000", "00000")
451         assertBadPart("3ffe::10000", "10000")
452         assertBadPart("02001:db8::", "02001")
453         assertBadPart("2001:888888::1", "888888")
454         assertBadPart("::00000%scope", "00000")
455         assertBadPart("3ffe::10000%scope", "10000")
456         assertBadPart("02001:db8::%scope", "02001")
457         assertBadPart("2001:888888::1%scope", "888888")
458     def test_pickle(self):
459         self.pickle_test("2001:db8::")
460     def test_weakref(self):
461         weakref.ref(self.factory("2001:db8::"))
462         weakref.ref(self.factory("2001:db8::%scope"))
463 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
464 class NetmaskTestMixin_v4(CommonTestMixin_v4):
465     def test_no_mask(self):
466         for address in ("1.2.3.4", 0x01020304, b"\x01\x02\x03\x04"):
467             net = self.factory(address)
468             self.assertEqual(str(net), "1.2.3.4/32")
469             self.assertEqual(str(net.netmask), "255.255.255.255")
470             self.assertEqual(str(net.hostmask), "0.0.0.0")
471     def test_split_netmask(self):
472         addr = "1.2.3.4/32/24"
473         with self.assertAddressError("Only one '/' permitted in %r" % addr):
474             self.factory(addr)
475     def test_address_errors(self):
476         def assertBadAddress(addr, details):
477             with self.assertAddressError(details):
478                 self.factory(addr)
479         assertBadAddress("/", "Address cannot be empty")
480         assertBadAddress("/8", "Address cannot be empty")
481         assertBadAddress("bogus", "Expected 4 octets")
482         assertBadAddress("google.com", "Expected 4 octets")
483         assertBadAddress("10/8", "Expected 4 octets")
484         assertBadAddress("::1.2.3.4", "Only decimal digits")
485         assertBadAddress("1.2.3.256", re.escape("256 (&gt; 255)"))
486     def test_valid_netmask(self):
487         self.assertEqual(str(self.factory("192.0.2.0/255.255.255.0")), "192.0.2.0/24")
488         for i in range(0, 33):
489             net_str = "0.0.0.0/%d" % i
490             net = self.factory(net_str)
491             self.assertEqual(str(net), net_str)
492             self.assertEqual(str(self.factory("0.0.0.0/%s" % net.netmask)), net_str)
493             self.assertEqual(str(self.factory("0.0.0.0/0%d" % i)), net_str)
494             if i in (32, 0):
495                 net_str = "0.0.0.0/%d" % (32 - i)
496             self.assertEqual(str(self.factory("0.0.0.0/%s" % net.hostmask)), net_str)
497     def test_netmask_errors(self):
498         def assertBadNetmask(addr, netmask):
499             msg = "%r is not a valid netmask" % netmask
500             with self.assertNetmaskError(re.escape(msg)):
501                 self.factory("{}/{}".format(addr, netmask))
502         assertBadNetmask("1.2.3.4", "")
503         assertBadNetmask("1.2.3.4", "-1")
504         assertBadNetmask("1.2.3.4", "+1")
505         assertBadNetmask("1.2.3.4", " 1 ")
506         assertBadNetmask("1.2.3.4", "0x1")
507         assertBadNetmask("1.2.3.4", "33")
508         assertBadNetmask("1.2.3.4", "254.254.255.256")
509         assertBadNetmask("1.2.3.4", "1.a.2.3")
510         assertBadNetmask("1.1.1.1", "254.xyz.2.3")
511         assertBadNetmask("1.1.1.1", "240.255.0.0")
512         assertBadNetmask("1.1.1.1", "255.254.128.0")
513         assertBadNetmask("1.1.1.1", "0.1.127.255")
514         assertBadNetmask("1.1.1.1", "pudding")
515         assertBadNetmask("1.1.1.1", "::")
516     def test_netmask_in_tuple_errors(self):
517         def assertBadNetmask(addr, netmask):
518             msg = "%r is not a valid netmask" % netmask
519             with self.assertNetmaskError(re.escape(msg)):
520                 self.factory((addr, netmask))
521         assertBadNetmask("1.1.1.1", -1)
522         assertBadNetmask("1.1.1.1", 33)
523     def test_pickle(self):
524         self.pickle_test("192.0.2.0/27")
525         self.pickle_test("192.0.2.0/31")  # IPV4LENGTH - 1
526         self.pickle_test("192.0.2.0")  # IPV4LENGTH
527 class InterfaceTestCase_v4(BaseTestCase, NetmaskTestMixin_v4):
528     factory = ipaddress.IPv4Interface
529 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
530 class NetworkTestCase_v4(BaseTestCase, NetmaskTestMixin_v4):
531     factory = ipaddress.IPv4Network
532     def test_subnet_of(self):
533         self.assertFalse(
534             self.factory("10.0.0.0/30").subnet_of(self.factory("10.0.1.0/24"))
535         )
536         self.assertTrue(
537             self.factory("10.0.0.0/30").subnet_of(self.factory("10.0.0.0/24"))
538         )
539         self.assertFalse(
540             self.factory("10.0.0.0/30").subnet_of(self.factory("10.0.1.0/24"))
541         )
542         self.assertFalse(
543             self.factory("10.0.1.0/24").subnet_of(self.factory("10.0.0.0/30"))
544         )
545     def test_supernet_of(self):
546         self.assertFalse(
547             self.factory("10.0.0.0/30").supernet_of(self.factory("10.0.1.0/24"))
548         )
549         self.assertFalse(
550             self.factory("10.0.0.0/30").supernet_of(self.factory("10.0.0.0/24"))
551         )
552         self.assertFalse(
553             self.factory("10.0.0.0/30").supernet_of(self.factory("10.0.1.0/24"))
554         )
555         self.assertTrue(
556             self.factory("10.0.0.0/24").supernet_of(self.factory("10.0.0.0/30"))
557         )
558     def test_subnet_of_mixed_types(self):
559         with self.assertRaises(TypeError):
560             ipaddress.IPv4Network("10.0.0.0/30").supernet_of(
561                 ipaddress.IPv6Network("::1/128")
562             )
563         with self.assertRaises(TypeError):
564             ipaddress.IPv6Network("::1/128").supernet_of(
565                 ipaddress.IPv4Network("10.0.0.0/30")
566             )
567         with self.assertRaises(TypeError):
568             ipaddress.IPv4Network("10.0.0.0/30").subnet_of(
569                 ipaddress.IPv6Network("::1/128")
570             )
571         with self.assertRaises(TypeError):
572             ipaddress.IPv6Network("::1/128").subnet_of(
573                 ipaddress.IPv4Network("10.0.0.0/30")
574             )
575 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
576 class NetmaskTestMixin_v6(CommonTestMixin_v6):
577     def test_no_mask(self):
578         for address in ("::1", 1, b"\x00" * 15 + b"\x01"):
579             net = self.factory(address)
580             self.assertEqual(str(net), "::1/128")
581             self.assertEqual(
582                 str(net.netmask), "ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"
583             )
584             self.assertEqual(str(net.hostmask), "::")
585         scoped_net = self.factory("::1%scope")
586         self.assertEqual(str(scoped_net), "::1%scope/128")
587         self.assertEqual(
588             str(scoped_net.netmask), "ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"
589         )
590         self.assertEqual(str(scoped_net.hostmask), "::")
591     def test_split_netmask(self):
592         addr = "cafe:cafe::/128/190"
593         with self.assertAddressError("Only one '/' permitted in %r" % addr):
594             self.factory(addr)
595         scoped_addr = "cafe:cafe::%scope/128/190"
596         with self.assertAddressError("Only one '/' permitted in %r" % scoped_addr):
597             self.factory(scoped_addr)
598     def test_address_errors(self):
599         def assertBadAddress(addr, details):
600             with self.assertAddressError(details):
601                 self.factory(addr)
602         assertBadAddress("/", "Address cannot be empty")
603         assertBadAddress("/8", "Address cannot be empty")
604         assertBadAddress("google.com", "At least 3 parts")
605         assertBadAddress("1.2.3.4", "At least 3 parts")
606         assertBadAddress("10/8", "At least 3 parts")
607         assertBadAddress("1234:axy::b", "Only hex digits")
608         assertBadAddress("/%scope", "Address cannot be empty")
609         assertBadAddress("/%scope8", "Address cannot be empty")
610         assertBadAddress("google.com%scope", "At least 3 parts")
611         assertBadAddress("1.2.3.4%scope", "At least 3 parts")
612         assertBadAddress("10%scope/8", "At least 3 parts")
613         assertBadAddress("1234:axy::b%scope", "Only hex digits")
614     def test_valid_netmask(self):
615         self.assertEqual(str(self.factory("2001:db8::/32")), "2001:db8::/32")
616         for i in range(0, 129):
617             net_str = "::/%d" % i
618             self.assertEqual(str(self.factory(net_str)), net_str)
619             self.assertEqual(str(self.factory("::/0%d" % i)), net_str)
620         self.assertEqual(
621             str(self.factory("2001:db8::%scope/32")), "2001:db8::%scope/32"
622         )
623         for i in range(0, 129):
624             net_str = "::/%d" % i
625             self.assertEqual(str(self.factory(net_str)), net_str)
626             self.assertEqual(str(self.factory("::/0%d" % i)), net_str)
627     def test_netmask_errors(self):
628         def assertBadNetmask(addr, netmask):
629             msg = "%r is not a valid netmask" % netmask
630             with self.assertNetmaskError(re.escape(msg)):
631                 self.factory("{}/{}".format(addr, netmask))
632         assertBadNetmask("::1", "")
633         assertBadNetmask("::1", "::1")
634         assertBadNetmask("::1", "1::")
635         assertBadNetmask("::1", "-1")
636         assertBadNetmask("::1", "+1")
637         assertBadNetmask("::1", " 1 ")
638         assertBadNetmask("::1", "0x1")
639         assertBadNetmask("::1", "129")
640         assertBadNetmask("::1", "1.2.3.4")
641         assertBadNetmask("::1", "pudding")
642         assertBadNetmask("::", "::")
643         assertBadNetmask("::1%scope", "pudding")
644     def test_netmask_in_tuple_errors(self):
645         def assertBadNetmask(addr, netmask):
646             msg = "%r is not a valid netmask" % netmask
647             with self.assertNetmaskError(re.escape(msg)):
648                 self.factory((addr, netmask))
649         assertBadNetmask("::1", -1)
650         assertBadNetmask("::1", 129)
651         assertBadNetmask("::1%scope", 129)
652     def test_pickle(self):
653         self.pickle_test("2001:db8::1000/124")
654         self.pickle_test("2001:db8::1000/127")  # IPV6LENGTH - 1
655         self.pickle_test("2001:db8::1000")  # IPV6LENGTH
656         self.pickle_test("2001:db8::1000%scope")  # IPV6LENGTH
657 class InterfaceTestCase_v6(BaseTestCase, NetmaskTestMixin_v6):
658     factory = ipaddress.IPv6Interface
659 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
660 class NetworkTestCase_v6(BaseTestCase, NetmaskTestMixin_v6):
661     factory = ipaddress.IPv6Network
662     def test_subnet_of(self):
663         self.assertFalse(
664             self.factory("2000:999::/56").subnet_of(self.factory("2000:aaa::/48"))
665         )
666         self.assertTrue(
667             self.factory("2000:aaa::/56").subnet_of(self.factory("2000:aaa::/48"))
668         )
669         self.assertFalse(
670             self.factory("2000:bbb::/56").subnet_of(self.factory("2000:aaa::/48"))
671         )
672         self.assertFalse(
673             self.factory("2000:aaa::/48").subnet_of(self.factory("2000:aaa::/56"))
674         )
675         self.assertFalse(
676             self.factory("2000:999::%scope/56").subnet_of(
677                 self.factory("2000:aaa::%scope/48")
678             )
679         )
680         self.assertTrue(
681             self.factory("2000:aaa::%scope/56").subnet_of(
682                 self.factory("2000:aaa::%scope/48")
683             )
684         )
685     def test_supernet_of(self):
686         self.assertFalse(
687             self.factory("2000:999::/56").supernet_of(self.factory("2000:aaa::/48"))
688         )
689         self.assertFalse(
690             self.factory("2000:aaa::/56").supernet_of(self.factory("2000:aaa::/48"))
691         )
692         self.assertFalse(
693             self.factory("2000:bbb::/56").supernet_of(self.factory("2000:aaa::/48"))
694         )
695         self.assertTrue(
696             self.factory("2000:aaa::/48").supernet_of(self.factory("2000:aaa::/56"))
697         )
698 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
699 class FactoryFunctionErrors(BaseTestCase):
700     def assertFactoryError(self, factory, kind):
701         addr = "camelot"
702         msg = "%r does not appear to be an IPv4 or IPv6 %s"
703         with self.assertCleanError(ValueError, msg, addr, kind):
704             factory(addr)
705     def test_ip_address(self):
706         self.assertFactoryError(ipaddress.ip_address, "address")
707     def test_ip_interface(self):
708         self.assertFactoryError(ipaddress.ip_interface, "interface")
709     def test_ip_network(self):
710         self.assertFactoryError(ipaddress.ip_network, "network")
711 @skipIf(sys.version_info &gt;= (3, 9, 5), "We use builtin ipaddress on Python &gt;= 3.9.5")
712 class ComparisonTests(TestCase):
713     v4addr = ipaddress.IPv4Address(1)
714     v4net = ipaddress.IPv4Network(1)
715     v4intf = ipaddress.IPv4Interface(1)
716     v6addr = ipaddress.IPv6Address(1)
717     v6net = ipaddress.IPv6Network(1)
718     v6intf = ipaddress.IPv6Interface(1)
719     v6addr_scoped = ipaddress.IPv6Address("::1%scope")
720     v6net_scoped = ipaddress.IPv6Network("::1%scope")
721     v6intf_scoped = ipaddress.IPv6Interface("::1%scope")
722     v4_addresses = [v4addr, v4intf]
723     v4_objects = v4_addresses + [v4net]
724     v6_addresses = [v6addr, v6intf]
725     v6_objects = v6_addresses + [v6net]
726     v6_scoped_addresses = [v6addr_scoped, v6intf_scoped]
727     v6_scoped_objects = v6_scoped_addresses + [v6net_scoped]
728     objects = v4_objects + v6_objects
729     objects_with_scoped = objects + v6_scoped_objects
730     v4addr2 = ipaddress.IPv4Address(2)
731     v4net2 = ipaddress.IPv4Network(2)
732     v4intf2 = ipaddress.IPv4Interface(2)
733     v6addr2 = ipaddress.IPv6Address(2)
734     v6net2 = ipaddress.IPv6Network(2)
735     v6intf2 = ipaddress.IPv6Interface(2)
736     v6addr2_scoped = ipaddress.IPv6Address("::2%scope")
737     v6net2_scoped = ipaddress.IPv6Network("::2%scope")
738     v6intf2_scoped = ipaddress.IPv6Interface("::2%scope")
739     def test_foreign_type_equality(self):
740         other = object()
741         for obj in self.objects_with_scoped:
742             self.assertNotEqual(obj, other)
743             self.assertFalse(obj == other)
744             self.assertEqual(obj.__eq__(other), NotImplemented)
745             self.assertEqual(obj.__ne__(other), NotImplemented)
746     def test_mixed_type_equality(self):
747         for lhs in self.objects:
748             for rhs in self.objects:
749                 if lhs is rhs:
750                     continue
751                 self.assertNotEqual(lhs, rhs)
752     def test_scoped_ipv6_equality(self):
753         for lhs, rhs in zip(self.v6_objects, self.v6_scoped_objects):
754             self.assertNotEqual(lhs, rhs)
755     def test_v4_with_v6_scoped_equality(self):
756         for lhs in self.v4_objects:
757             for rhs in self.v6_scoped_objects:
758                 self.assertNotEqual(lhs, rhs)
759     def test_same_type_equality(self):
760         for obj in self.objects_with_scoped:
761             self.assertEqual(obj, obj)
762             self.assertLessEqual(obj, obj)
763             self.assertGreaterEqual(obj, obj)
764     def test_same_type_ordering(self):
765         for lhs, rhs in (
766             (self.v4addr, self.v4addr2),
767             (self.v4net, self.v4net2),
768             (self.v4intf, self.v4intf2),
769             (self.v6addr, self.v6addr2),
770             (self.v6net, self.v6net2),
771             (self.v6intf, self.v6intf2),
772             (self.v6addr_scoped, self.v6addr2_scoped),
773             (self.v6net_scoped, self.v6net2_scoped),
774             (self.v6intf_scoped, self.v6intf2_scoped),
775         ):
776             self.assertNotEqual(lhs, rhs)
777             self.assertLess(lhs, rhs)
778             self.assertLessEqual(lhs, rhs)
779             self.assertGreater(rhs, lhs)
780             self.assertGreaterEqual(rhs, lhs)
781             self.assertFalse(lhs &gt; rhs)
782             self.assertFalse(rhs &lt; lhs)
783             self.assertFalse(lhs &gt;= rhs)
784             self.assertFalse(rhs &lt;= lhs)
785     def test_containment(self):
786         for obj in self.v4_addresses:
787             self.assertIn(obj, self.v4net)
788         for obj in self.v6_addresses + self.v6_scoped_addresses:
789             self.assertIn(obj, self.v6net)
790         for obj in self.v6_addresses + self.v6_scoped_addresses:
791             self.assertIn(obj, self.v6net_scoped)
792         for obj in self.v4_objects + [self.v6net, self.v6net_scoped]:
793             self.assertNotIn(obj, self.v6net)
794         for obj in self.v4_objects + [self.v6net, self.v6net_scoped]:
795             self.assertNotIn(obj, self.v6net_scoped)
796         for obj in self.v6_objects + self.v6_scoped_objects + [self.v4net]:
797             self.assertNotIn(obj, self.v4net)
798     def test_mixed_type_ordering(self):
799         for lhs in self.objects_with_scoped:
800             for rhs in self.objects_with_scoped:
801                 if isinstance(lhs, type(rhs)) or isinstance(rhs, type(lhs)):
802                     continue
803                 self.assertRaises(TypeError, lambda: lhs &lt; rhs)
804                 self.assertRaises(TypeError, lambda: lhs &gt; rhs)
805                 self.assertRaises(TypeError, lambda: lhs &lt;= rhs)
806                 self.assertRaises(TypeError, lambda: lhs &gt;= rhs)
807     def test_foreign_type_ordering(self):
808         other = object()
809         for obj in self.objects_with_scoped:
810             with self.assertRaises(TypeError):
811                 obj &lt; other
812             with self.assertRaises(TypeError):
813                 obj &gt; other
814             with self.assertRaises(TypeError):
815                 obj &lt;= other
816             with self.assertRaises(TypeError):
817                 obj &gt;= other
818             self.assertTrue(obj &lt; LARGEST)
819             self.assertFalse(obj &gt; LARGEST)
820             self.assertTrue(obj &lt;= LARGEST)
821             self.assertFalse(obj &gt;= LARGEST)
822             self.assertFalse(obj &lt; SMALLEST)
823             self.assertTrue(obj &gt; SMALLEST)
824             self.assertFalse(obj &lt;= SMALLEST)
825             self.assertTrue(obj &gt;= SMALLEST)
826     def test_mixed_type_key(self):
827         v4_ordered = [self<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.v4addr, self.v4net, self.v4intf]
828         v6_ordered = [self.v6addr, self.v6net, self.v6intf]
829         v6_scoped_ordered = [self.v6addr_scoped, self.v6net_scoped, self.</b></font>v6intf_scoped]
830         self.assertEqual(
831             v4_ordered, sorted(self.v4_objects, key=ipaddress.get_mixed_type_key)
832         )
833         self.assertEqual(
834             v6_ordered, sorted(self.v6_objects, key=ipaddress.get_mixed_type_key)
835         )
836         self.assertEqual(
837             v6_scoped_ordered,
838             sorted(self.v6_scoped_objects, key=ipaddress.get_mixed_type_key),
839         )
840         self.assertEqual(
841             v4_ordered + v6_scoped_ordered,
842             sorted(
843                 self.v4_objects + self.v6_scoped_objects,
844                 key=ipaddress.get_mixed_type_key,
845             ),
846         )
847         self.assertEqual(NotImplemented, ipaddress.get_mixed_type_key(object))
848     def test_incompatible_versions(self):
849         v4addr = ipaddress.ip_address("1.1.1.1")
850         v4net = ipaddress.ip_network("1.1.1.1")
851         v6addr = ipaddress.ip_address("::1")
852         v6net = ipaddress.ip_network("::1")
853         v6addr_scoped = ipaddress.ip_address("::1%scope")
854         v6net_scoped = ipaddress.ip_network("::1%scope")
855         self.assertRaises(TypeError, v4addr.__lt__, v6addr)
856         self.assertRaises(TypeError, v4addr.__gt__, v6addr)
857         self.assertRaises(TypeError, v4net.__lt__, v6net)
858         self.assertRaises(TypeError, v4net.__gt__, v6net)
859         self.assertRaises(TypeError, v6addr.__lt__, v4addr)
860         self.assertRaises(TypeError, v6addr.__gt__, v4addr)
861         self.assertRaises(TypeError, v6net.__lt__, v4net)
862         self.assertRaises(TypeError, v6net.__gt__, v4net)
863         self.assertRaises(TypeError, v4addr.__lt__, v6addr_scoped)
864         self.assertRaises(TypeError, v4addr.__gt__, v6addr_scoped)
865         self.assertRaises(TypeError, v4net.__lt__, v6net_scoped)
866         self.assertRaises(TypeError, v4net.__gt__, v6net_scoped)
867         self.assertRaises(TypeError, v6addr_scoped.__lt__, v4addr)
868         self.assertRaises(TypeError, v6addr_scoped.__gt__, v4addr)
869         self.assertRaises(TypeError, v6net_scoped.__lt__, v4net)
870         self.assertRaises(TypeError, v6net_scoped.__gt__, v4net)
871 class IpaddrUnitTest(TestCase):
872     def setUp(self):
873         self.ipv4_address = ipaddress<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.IPv4Address("1.2.3.4")
874         self.ipv4_interface = ipaddress.IPv4Interface("1.2.3.4/24")
875         self.ipv6_address = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1")
876         self.ipv6_interface =</b></font> ipaddress<font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.IPv6Interface("2001:658:22a:cafe:200:0:0:1/64")
877         self.ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/64")
878         self.ipv6_scoped_address = ipaddress.IPv6Interface(
879             "2001:658:22a:cafe:200:0:0:1%scope"
880         )
881         self.ipv6_scoped_interface =</b></font> ipaddress.IPv6Interface(
882             "2001:658:22a:cafe:200:0:0:1%scope/64"
883         )
884         self.ipv6_scoped_network = ipaddress.IPv6Network("2001:658:22a:cafe::%scope/64")
885     def testRepr(self):
886         self.assertEqual(
887             "IPv4Interface('1.2.3.4/32')", repr(ipaddress.IPv4Interface("1.2.3.4"))
888         )
889         self.assertEqual(
890         )
891         self.assertEqual(
892             "IPv6Interface('::1%scope/128')", repr(ipaddress.IPv6Interface(<font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>"::1%scope"))
893         )
894     def testIPv4Tuple(self):
895         ip = ipaddress.IPv4Address("192.0.2.1")
896         net = ipaddress.IPv4Network("192.0.2.1/32")
897         self.assertEqual(ipaddress.IPv4Network(</b></font>("192.0.2.1", 32)), net)
898         self.assertEqual(ipaddress.IPv4Network((ip, 32)), net)
899         self.assertEqual(ipaddress.IPv4Network((3221225985, 32)), net)
900         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", "255.255.255.255")), net)
901         self.assertEqual(ipaddress.IPv4Network((ip, "255.255.255.255")), net)
902         self.assertEqual(ipaddress.IPv4Network((3221225985, "255.255.255.255")), net)
903         with self.assertRaises(ValueError):
904             ipaddress.IPv4Network(("192.0.2.1", 24))
905         with self.assertRaises(ValueError):
906             ipaddress.IPv4Network((ip, 24))
907         with self.assertRaises(ValueError):
908             ipaddress.IPv4Network((3221225985, 24))
909         with self.assertRaises(ValueError):
910             ipaddress.IPv4Network(("192.0.2.1", "255.255.255.0"))
911         with self.assertRaises(ValueError):
912             ipaddress.IPv4Network((ip, "255.255.255.0"))
913         with self.assertRaises(ValueError):
914             ipaddress.IPv4Network((3221225985, "255.255.255.0"))
915         net = ipaddress.IPv4Network("192.0.2.0/24")
916         self.assertEqual(ipaddress.IPv4Network(("192.0.2.1", 24), strict=False), net)
917         self.assertEqual(ipaddress.IPv4Network((ip, 24), strict=False), net)
918         self.assertEqual(ipaddress.IPv4Network((3221225985, 24), strict=False), net)
919         self.assertEqual(
920             ipaddress.IPv4Network(("192.0.2.1", "255.255.255.0"), strict=False), net
921         )
922         self.assertEqual(
923             ipaddress.IPv4Network((ip, "255.255.255.0"), strict=False), net
924         )
925         self.assertEqual(
926             ipaddress.IPv4Network((3221225985, "255.255.255.0"), strict=False), net
927         )
928         ip = ipaddress.IPv4Address("192.0.2.0")
929         net = ipaddress.IPv4Network("192.0.2.0/24")
930         self.assertEqual(ipaddress.IPv4Network(("192.0.2.0", "255.255.255.0")), net)
931         self.assertEqual(ipaddress.IPv4Network((ip, "255.255.255.0")), net)
932         self.assertEqual(ipaddress.IPv4Network((3221225984, "255.255.255.0")), net)
933         self.assertEqual(ipaddress.IPv4Network(("192.0.2.0", 24)), net)
934         self.assertEqual(ipaddress.IPv4Network((ip, 24)), net)
935         self.assertEqual(ipaddress.IPv4Network((3221225984, 24)), net)
936         self.assertEqual(
937             ipaddress.IPv4Interface(("192.0.2.1", 24)),
938             ipaddress.IPv4Interface("192.0.2.1/24"),
939         self.assertEqual(
940             ipaddress.IPv4Interface((3221225985, 24)),
941             ipaddress.IPv4Interface(<font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>"192.0.2.1/24"),
942         )
943     def testIPv6Tuple(self):
944         ip = ipaddress.IPv6Address("2001:db8::")
945         net = ipaddress.IPv6Network("2001:db8::/128")
946         self.assertEqual(ipaddress.IPv6Network(</b></font>("2001:db8::", "128")), net)
947         self.assertEqual(
948             ipaddress.IPv6Network((42540766411282592856903984951653826560, 128)), net
949         )
950         self.assertEqual(ipaddress.IPv6Network((ip, "128")), net)
951         ip = ipaddress.IPv6Address("2001:db8::")
952         net = ipaddress.IPv6Network("2001:db8::/96")
953         self.assertEqual(ipaddress.IPv6Network(("2001:db8::", "96")), net)
954         self.assertEqual(
955             ipaddress.IPv6Network((42540766411282592856903984951653826560, 96)), net
956         )
957         self.assertEqual(ipaddress.IPv6Network((ip, "96")), net)
958         ip_scoped = ipaddress.IPv6Address("2001:db8::%scope")
959         ip = ipaddress.IPv6Address("2001:db8::1")
960         with self.assertRaises(ValueError):
961             ipaddress.IPv6Network(("2001:db8::1", 96))
962         with self.assertRaises(ValueError):
963             ipaddress.IPv6Network((42540766411282592856903984951653826561, 96))
964         with self.assertRaises(ValueError):
965             ipaddress.IPv6Network((ip, 96))
966         net = ipaddress.IPv6Network("2001:db8::/96")
967         self.assertEqual(ipaddress.IPv6Network(("2001:db8::1", 96), strict=False), net)
968         self.assertEqual(
969             ipaddress.IPv6Network(
970                 (42540766411282592856903984951653826561, 96), strict=False
971             ),
972             net,
973         )
974         self.assertEqual(ipaddress.IPv6Network((ip, 96), strict=False), net)
975         self.assertEqual(
976             ipaddress.IPv6Interface(("2001:db8::1", "96")),
977             ipaddress.IPv6Interface("2001:db8::1/96"),
978         )
979         self.assertEqual(
980             ipaddress.IPv6Interface((42540766411282592856903984951653826561, "96")),
981             ipaddress.IPv6Interface("2001:db8::1/96"),
982         )
983         ip_scoped = ipaddress.IPv6Address("2001:db8::1%scope")
984         with self.assertRaises(ValueError):
985             ipaddress.IPv6Network(("2001:db8::1%scope", 96))
986         with self.assertRaises(ValueError):
987             ipaddress.IPv6Network((ip_scoped, 96))
988     def testAddressIntMath(self):
989         self.assertEqual(
990             ipaddress.IPv4Address("1.1.1.1") + 255, ipaddress.IPv4Address("1.1.2.0")
991         )
992         self.assertEqual(
993             ipaddress.IPv4Address("1.1.1.1") - 256, ipaddress.IPv4Address("1.1.0.1")
994         )
995         self.assertEqual(
996             ipaddress.IPv6Address("::1") + (2 ** 16 - 2),
997             ipaddress.IPv6Address("::ffff"),
998         )
999         self.assertEqual(
1000             ipaddress.IPv6Address("::ffff") - (2 ** 16 - 2),
1001             ipaddress.IPv6Address("::1"),
1002         )
1003         self.assertNotEqual(
1004             ipaddress.IPv6Address("::1%scope") + (2 ** 16 - 2),
1005             ipaddress.IPv6Address("::ffff%scope"),
1006         )
1007         self.assertNotEqual(
1008             ipaddress.IPv6Address("::ffff%scope") - (2 ** 16 - 2),
1009             ipaddress.IPv6Address("::1%scope"),
1010         )
1011     def testInvalidIntToBytes(self):
1012         self.assertRaises(ValueError, ipaddress.v4_int_to_packed, -1)
1013         self.assertRaises(
1014             ValueError, ipaddress.v4_int_to_packed, 2 ** ipaddress.IPV4LENGTH
1015         )
1016         self.assertRaises(ValueError, ipaddress.v6_int_to_packed, -1)
1017         self.assertRaises(
1018             ValueError, ipaddress.v6_int_to_packed, 2 ** ipaddress.IPV6LENGTH
1019         )
1020     def testInternals(self):
1021         ip1 = ipaddress.IPv4Address("10.10.10.10")
1022         ip2 = ipaddress.IPv4Address("10.10.10.11")
1023         ip3 = ipaddress.IPv4Address("10.10.10.12")
1024         self.assertEqual(list(ipaddress._find_address_range([ip1])), [(ip1, ip1)])
1025         self.assertEqual(
1026             list(ipaddress._find_address_range([ip1, ip3])), [(ip1, ip1), (ip3, ip3)]
1027         )
1028         self.assertEqual(
1029             list(ipaddress._find_address_range([ip1, ip2, ip3])), [(ip1, ip3)]
1030         )
1031         self.assertEqual(128, ipaddress._count_righthand_zero_bits(0, 128))
1032         self.assertEqual("IPv4Network('1.2.3.0/24')", repr(self.ipv4_network))
1033     def testGetNetwork(self):
1034         self.assertEqual(int(self.ipv4_network.network_address), 16909056)
1035         self.assertEqual(str(self.ipv4_network.network_address), "1.2.3.0")
1036         self.assertEqual(
1037             int(self.ipv6_network.network_address),
1038             42540616829182469433403647294022090752,
1039         )
1040         self.assertEqual(str(self.ipv6_network.network_address), "2001:658:22a:cafe::")
1041         self.assertEqual(str(self.ipv6_network.hostmask), "::ffff:ffff:ffff:ffff")
1042         self.assertEqual(
1043             int(self.ipv6_scoped_network.network_address),
1044             42540616829182469433403647294022090752,
1045         )
1046         self.assertEqual(
1047             str(self.ipv6_scoped_network.network_address), "2001:658:22a:cafe::%scope"
1048         )
1049         self.assertEqual(
1050             str(self.ipv6_scoped_network.hostmask), "::ffff:ffff:ffff:ffff"
1051         )
1052     def testIpFromInt(self):
1053         self.assertEqual(self.ipv4_interface._ip, ipaddress.IPv4Interface(16909060)._ip)
1054         ipv4 = ipaddress.ip_network("1.2.3.4")
1055         ipv6 = ipaddress.ip_network("2001:658:22a:cafe:200:0:0:1")
1056         ipv6_scoped = ipaddress.ip_network("2001:658:22a:cafe:200:0:0:1%scope")
1057         self.assertEqual(ipv4, ipaddress.ip_network(int(ipv4.network_address)))
1058         self.assertEqual(ipv6, ipaddress.ip_network(int(ipv6.network_address)))
1059         self.assertNotEqual(
1060             ipv6_scoped, ipaddress.ip_network(int(ipv6_scoped.network_address))
1061         )
1062         v6_int = 42540616829182469433547762482097946625
1063         self.assertEqual(self.ipv6_interface._ip, ipaddress.IPv6Interface(v6_int)._ip)
1064         self.assertEqual(
1065             self.ipv6_scoped_interface._ip, ipaddress.IPv6Interface(v6_int)._ip
1066         )
1067         self.assertEqual(ipaddress.ip_network(self.ipv4_address._ip).version, 4)
1068         self.assertEqual(ipaddress.ip_network(self.ipv6_address._ip).version, 6)
1069         self.assertEqual(ipaddress.ip_network(self.ipv6_scoped_address._ip).version, 6)
1070     def testIpFromPacked(self):
1071         address = ipaddress.ip_address
1072         self.assertEqual(
1073             self.ipv4_interface._ip, ipaddress.ip_interface(b"\x01\x02\x03\x04")._ip
1074         )
1075         self.assertEqual(address("255.254.253.252"), address(b"\xff\xfe\xfd\xfc"))
1076         self.assertEqual(
1077             self.ipv6_interface.ip,
1078             ipaddress.ip_interface(
1079                 b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01"
1080             ).ip,
1081         )
1082         self.assertEqual(
1083             address("ffff:2:3:4:ffff::"),
1084             address(b"\xff\xff\x00\x02\x00\x03\x00\x04" + b"\xff\xff" + b"\x00" * 6),
1085         )
1086         self.assertEqual(address("::"), address(b"\x00" * 16))
1087     def testGetIp(self):
1088         self.assertEqual(int(self.ipv4_interface.ip), 16909060)
1089         self.assertEqual(str(self.ipv4_interface.ip), "1.2.3.4")
1090         self.assertEqual(
1091             int(self.ipv6_interface.ip), 42540616829182469433547762482097946625
1092         )
1093         self.assertEqual(str(self.ipv6_interface.ip), "2001:658:22a:cafe:200::1")
1094         self.assertEqual(
1095             int(self.ipv6_scoped_interface.ip), 42540616829182469433547762482097946625
1096         )
1097         self.assertEqual(str(self.ipv6_scoped_interface.ip), "2001:658:22a:cafe:200::1")
1098     def testGetScopeId(self):
1099         self.assertEqual(self.ipv6_address.scope_id, None)
1100         self.assertEqual(str(self.ipv6_scoped_address.scope_id), "scope")
1101         self.assertEqual(self.ipv6_interface.scope_id, None)
1102         self.assertEqual(str(self.ipv6_scoped_interface.scope_id), "scope")
1103         self.assertEqual(self.ipv6_network.network_address.scope_id, None)
1104         self.assertEqual(
1105             str(self.ipv6_scoped_network.network_address.scope_id), "scope"
1106         )
1107     def testGetNetmask(self):
1108         self.assertEqual(int(self.ipv4_network.netmask), 4294967040)
1109         self.assertEqual(str(self.ipv4_network.netmask), "255.255.255.0")
1110         self.assertEqual(
1111             int(self.ipv6_network.netmask), 340282366920938463444927863358058659840
1112         )
1113         self.assertEqual(self.ipv6_network.prefixlen, 64)
1114         self.assertEqual(
1115             int(self.ipv6_scoped_network.netmask),
1116             340282366920938463444927863358058659840,
1117         )
1118         self.assertEqual(self.ipv6_scoped_network.prefixlen, 64)
1119     def testZeroNetmask(self):
1120         ipv4_zero_netmask = ipaddress.IPv4Interface("1.2.3.4/0")
1121         self.assertEqual(int(ipv4_zero_netmask.network.netmask), 0)
1122         self.assertEqual(ipv4_zero_netmask._prefix_from_prefix_string("0"), 0)
1123         ipv6_zero_netmask = ipaddress.IPv6Interface("::1/0")
1124         self.assertEqual(int(ipv6_zero_netmask.network.netmask), 0)
1125         self.assertEqual(ipv6_zero_netmask._prefix_from_prefix_string("0"), 0)
1126         ipv6_scoped_zero_netmask = ipaddress.IPv6Interface("::1%scope/0")
1127         self.assertEqual(int(ipv6_scoped_zero_netmask.network.netmask), 0)
1128         self.assertEqual(ipv6_scoped_zero_netmask._prefix_from_prefix_string("0"), 0)
1129     def testIPv4Net(self):
1130         net = ipaddress.IPv4Network("127.0.0.0/0.0.0.255")
1131         self.assertEqual(net.prefixlen, 24)
1132     def testGetBroadcast(self):
1133         self.assertEqual(int(self.ipv4_network.broadcast_address), 16909311)
1134         self.assertEqual(str(self.ipv4_network.broadcast_address), "1.2.3.255")
1135         self.assertEqual(
1136             int(self.ipv6_network.broadcast_address),
1137             42540616829182469451850391367731642367,
1138         )
1139         self.assertEqual(
1140             str(self.ipv6_network.broadcast_address),
1141             "2001:658:22a:cafe:ffff:ffff:ffff:ffff",
1142         )
1143         self.assertEqual(
1144             int(self.ipv6_scoped_network.broadcast_address),
1145             42540616829182469451850391367731642367,
1146         )
1147         self.assertEqual(
1148             str(self.ipv6_scoped_network.broadcast_address),
1149             "2001:658:22a:cafe:ffff:ffff:ffff:ffff",
1150         )
1151     def testGetPrefixlen(self):
1152         self.assertEqual(self.ipv4_interface.network.prefixlen, 24)
1153         self.assertEqual(self.ipv6_interface.network.prefixlen, 64)
1154         self.assertEqual(self.ipv6_scoped_interface.network.prefixlen, 64)
1155     def testGetSupernet(self):
1156         self.assertEqual(self.ipv4_network.supernet().prefixlen, 23)
1157         self.assertEqual(str(self.ipv4_network.supernet().network_address), "1.2.2.0")
1158         self.assertEqual(
1159             ipaddress.IPv4Interface("0.0.0.0/0").network.supernet(),
1160             ipaddress.IPv4Network("0.0.0.0/0"),
1161         )
1162         self.assertEqual(self.ipv6_network.supernet().prefixlen, 63)
1163         self.assertEqual(
1164             str(self.ipv6_network.supernet().network_address), "2001:658:22a:cafe::"
1165         )
1166         self.assertEqual(
1167             ipaddress.IPv6Interface("::0/0").network.supernet(),
1168             ipaddress.IPv6Network("::0/0"),
1169         )
1170         self.assertEqual(self.ipv6_scoped_network.supernet().prefixlen, 63)
1171         self.assertEqual(
1172             str(self.ipv6_scoped_network.supernet().network_address),
1173             "2001:658:22a:cafe::",
1174         )
1175     def testGetSupernet3(self):
1176         self.assertEqual(self.ipv4_network.supernet(3).prefixlen, 21)
1177         self.assertEqual(str(self.ipv4_network.supernet(3).network_address), "1.2.0.0")
1178         self.assertEqual(self.ipv6_network.supernet(3).prefixlen, 61)
1179         self.assertEqual(
1180             str(self.ipv6_network.supernet(3).network_address), "2001:658:22a:caf8::"
1181         )
1182         self.assertEqual(self.ipv6_scoped_network.supernet(3).prefixlen, 61)
1183         self.assertEqual(
1184             str(self.ipv6_scoped_network.supernet(3).network_address),
1185             "2001:658:22a:caf8::",
1186         )
1187     def testGetSupernet4(self):
1188         self.assertRaises(
1189             ValueError, self.ipv4_network.supernet, prefixlen_diff=2, new_prefix=1
1190         )
1191         self.assertRaises(ValueError, self.ipv4_network.supernet, new_prefix=25)
1192         self.assertEqual(
1193             self.ipv4_network.supernet(prefixlen_diff=2),
1194             self.ipv4_network.supernet(new_prefix=22),
1195         )
1196         self.assertRaises(
1197             ValueError, self.ipv6_network.supernet, prefixlen_diff=2, new_prefix=1
1198         )
1199         self.assertRaises(ValueError, self.ipv6_network.supernet, new_prefix=65)
1200         self.assertEqual(
1201             self.ipv6_network.supernet(prefixlen_diff=2),
1202             self.ipv6_network.supernet(new_prefix=62),
1203         )
1204         self.assertRaises(
1205             ValueError,
1206             self.ipv6_scoped_network.supernet,
1207             prefixlen_diff=2,
1208             new_prefix=1,
1209         )
1210         self.assertRaises(ValueError, self.ipv6_scoped_network.supernet, new_prefix=65)
1211         self.assertEqual(
1212             self.ipv6_scoped_network.supernet(prefixlen_diff=2),
1213             self.ipv6_scoped_network.supernet(new_prefix=62),
1214         )
1215     def testHosts(self):
1216         hosts = list(self.ipv4_network.hosts())
1217         self.assertEqual(254, len(hosts))
1218         self.assertEqual(ipaddress.IPv4Address("1.2.3.1"), hosts[0])
1219         self.assertEqual(ipaddress.IPv4Address("1.2.3.254"), hosts[-1])
1220         ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/120")
1221         hosts = list(ipv6_network.hosts())
1222         self.assertEqual(255, len(hosts))
1223         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::1"), hosts[0])
1224         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::ff"), hosts[-1])
1225         ipv6_scoped_network = ipaddress.IPv6Network("2001:658:22a:cafe::%scope/120")
1226         hosts = list(ipv6_scoped_network.hosts())
1227         self.assertEqual(255, len(hosts))
1228         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::1"), hosts[0])
1229         self.assertEqual(ipaddress.IPv6Address("2001:658:22a:cafe::ff"), hosts[-1])
1230         addrs = [ipaddress.IPv4Address("2.0.0.0"), ipaddress.IPv4Address("2.0.0.1")]
1231         str_args = "2.0.0.0/31"
1232         tpl_args = ("2.0.0.0", 31)
1233         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1234         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1235         self.assertEqual(
1236             list(ipaddress.ip_network(str_args).hosts()),
1237             list(ipaddress.ip_network(tpl_args).hosts()),
1238         )
1239         addrs = [ipaddress.IPv4Address("1.2.3.4")]
1240         str_args = "1.2.3.4/32"
1241         tpl_args = ("1.2.3.4", 32)
1242         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1243         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1244         self.assertEqual(
1245             list(ipaddress.ip_network(str_args).hosts()),
1246             list(ipaddress.ip_network(tpl_args).hosts()),
1247         )
1248         addrs = [
1249             ipaddress.IPv6Address("2001:658:22a:cafe::"),
1250             ipaddress.IPv6Address("2001:658:22a:cafe::1"),
1251         ]
1252         str_args = "2001:658:22a:cafe::/127"
1253         tpl_args = ("2001:658:22a:cafe::", 127)
1254         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1255         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1256         self.assertEqual(
1257             list(ipaddress.ip_network(str_args).hosts()),
1258             list(ipaddress.ip_network(tpl_args).hosts()),
1259         )
1260         addrs = [
1261             ipaddress.IPv6Address("2001:658:22a:cafe::1"),
1262         ]
1263         str_args = "2001:658:22a:cafe::1/128"
1264         tpl_args = ("2001:658:22a:cafe::1", 128)
1265         self.assertEqual(addrs, list(ipaddress.ip_network(str_args).hosts()))
1266         self.assertEqual(addrs, list(ipaddress.ip_network(tpl_args).hosts()))
1267         self.assertEqual(
1268             list(ipaddress.ip_network(str_args).hosts()),
1269             list(ipaddress.ip_network(tpl_args).hosts()),
1270         )
1271     def testFancySubnetting(self):
1272         self.assertEqual(
1273             sorted(self.ipv4_network.subnets(prefixlen_diff=3)),
1274             sorted(self.ipv4_network.subnets(new_prefix=27)),
1275         )
1276         self.assertRaises(ValueError, list, self.ipv4_network.subnets(new_prefix=23))
1277         self.assertRaises(
1278             ValueError, list, self.ipv4_network.subnets(prefixlen_diff=3, new_prefix=27)
1279         )
1280         self.assertEqual(
1281             sorted(self.ipv6_network.subnets(prefixlen_diff=4)),
1282             sorted(self.ipv6_network.subnets(new_prefix=68)),
1283         )
1284         self.assertRaises(ValueError, list, self.ipv6_network.subnets(new_prefix=63))
1285         self.assertRaises(
1286             ValueError, list, self.ipv6_network.subnets(prefixlen_diff=4, new_prefix=68)
1287         )
1288         self.assertEqual(
1289             sorted(self.ipv6_scoped_network.subnets(prefixlen_diff=4)),
1290             sorted(self.ipv6_scoped_network.subnets(new_prefix=68)),
1291         )
1292         self.assertRaises(
1293             ValueError, list, self.ipv6_scoped_network.subnets(new_prefix=63)
1294         )
1295         self.assertRaises(
1296             ValueError,
1297             list,
1298             self.ipv6_scoped_network.subnets(prefixlen_diff=4, new_prefix=68),
1299         )
1300     def testGetSubnets(self):
1301         self.assertEqual(list(self.ipv4_network.subnets())[0].prefixlen, 25)
1302         self.assertEqual(
1303             str(list(self.ipv4_network.subnets())[0].network_address), "1.2.3.0"
1304         )
1305         self.assertEqual(
1306             str(list(self.ipv4_network.subnets())[1].network_address), "1.2.3.128"
1307         )
1308         self.assertEqual(list(self.ipv6_network.subnets())[0].prefixlen, 65)
1309         self.assertEqual(list(self.ipv6_scoped_network.subnets())[0].prefixlen, 65)
1310     def testGetSubnetForSingle32(self):
1311         ip = ipaddress.IPv4Network("1.2.3.4/32")
1312         subnets1 = [str(x) for x in ip.subnets()]
1313         subnets2 = [str(x) for x in ip.subnets(2)]
1314         self.assertEqual(subnets1, ["1.2.3.4/32"])
1315         self.assertEqual(subnets1, subnets2)
1316     def testGetSubnetForSingle128(self):
1317         ip = ipaddress.IPv6Network("::1/128")
1318         subnets1 = [str(x) for x in ip.subnets()]
1319         subnets2 = [str(x) for x in ip.subnets(2)]
1320         self.assertEqual(subnets1, ["::1/128"])
1321         self.assertEqual(subnets1, subnets2)
1322         ip_scoped = ipaddress.IPv6Network("::1%scope/128")
1323         subnets1 = [str(x) for x in ip_scoped.subnets()]
1324         subnets2 = [str(x) for x in ip_scoped.subnets(2)]
1325         self.assertEqual(subnets1, ["::1%scope/128"])
1326         self.assertEqual(subnets1, subnets2)
1327     def testSubnet2(self):
1328         ips = [str(x) for x in self.ipv4_network.subnets(2)]
1329         self.assertEqual(
1330             ips, ["1.2.3.0/26", "1.2.3.64/26", "1.2.3.128/26", "1.2.3.192/26"]
1331         )
1332         ipsv6 = [str(x) for x in self.ipv6_network.subnets(2)]
1333         self.assertEqual(
1334             ipsv6,
1335             [
1336                 "2001:658:22a:cafe::/66",
1337                 "2001:658:22a:cafe:4000::/66",
1338                 "2001:658:22a:cafe:8000::/66",
1339                 "2001:658:22a:cafe:c000::/66",
1340             ],
1341         )
1342     def testGetSubnets3(self):
1343         subnets = [str(x) for x in self.ipv4_network.subnets(8)]
1344         self.assertEqual(subnets[:3], ["1.2.3.0/32", "1.2.3.1/32", "1.2.3.2/32"])
1345         self.assertEqual(subnets[-3:], ["1.2.3.253/32", "1.2.3.254/32", "1.2.3.255/32"])
1346         self.assertEqual(len(subnets), 256)
1347         ipv6_network = ipaddress.IPv6Network("2001:658:22a:cafe::/120")
1348         subnets = [str(x) for x in ipv6_network.subnets(8)]
1349         self.assertEqual(
1350             subnets[:3],
1351             [
1352                 "2001:658:22a:cafe::/128",
1353                 "2001:658:22a:cafe::1/128",
1354                 "2001:658:22a:cafe::2/128",
1355             ],
1356         )
1357         self.assertEqual(
1358             subnets[-3:],
1359             [
1360                 "2001:658:22a:cafe::fd/128",
1361                 "2001:658:22a:cafe::fe/128",
1362                 "2001:658:22a:cafe::ff/128",
1363             ],
1364         )
1365         self.assertEqual(len(subnets), 256)
1366     def testSubnetFailsForLargeCidrDiff(self):
1367         self.assertRaises(ValueError, list, self.ipv4_interface.network.subnets(9))
1368         self.assertRaises(ValueError, list, self.ipv4_network.subnets(9))
1369         self.assertRaises(ValueError, list, self.ipv6_interface.network.subnets(65))
1370         self.assertRaises(ValueError, list, self.ipv6_network.subnets(65))
1371         self.assertRaises(
1372             ValueError, list, self.ipv6_scoped_interface.network.subnets(65)
1373         )
1374         self.assertRaises(ValueError, list, self.ipv6_scoped_network.subnets(65))
1375     def testSupernetFailsForLargeCidrDiff(self):
1376         self.assertRaises(ValueError, self.ipv4_interface.network.supernet, 25)
1377         self.assertRaises(ValueError, self.ipv6_interface.network.supernet, 65)
1378         self.assertRaises(ValueError, self.ipv6_scoped_interface.network.supernet, 65)
1379     def testSubnetFailsForNegativeCidrDiff(self):
1380         self.assertRaises(ValueError, list, self.ipv4_interface.network.subnets(-1))
1381         self.assertRaises(ValueError, list, self.ipv4_network.subnets(-1))
1382         self.assertRaises(ValueError, list, self.ipv6_interface.network.subnets(-1))
1383         self.assertRaises(ValueError, list, self.ipv6_network.subnets(-1))
1384         self.assertRaises(
1385             ValueError, list, self.ipv6_scoped_interface.network.subnets(-1)
1386         )
1387         self.assertRaises(ValueError, list, self.ipv6_scoped_network.subnets(-1))
1388     def testGetNum_Addresses(self):
1389         self.assertEqual(self.ipv4_network.num_addresses, 256)
1390         self.assertEqual(list(self.ipv4_network.subnets())[0].num_addresses, 128)
1391         self.assertEqual(self.ipv4_network.supernet().num_addresses, 512)
1392         self.assertEqual(self.ipv6_network.num_addresses, 18446744073709551616)
1393         self.assertEqual(
1394             list(self.ipv6_network.subnets())[0].num_addresses, 9223372036854775808
1395         )
1396         self.assertEqual(
1397             self.ipv6_network.supernet().num_addresses, 36893488147419103232
1398         )
1399         self.assertEqual(self.ipv6_scoped_network.num_addresses, 18446744073709551616)
1400         self.assertEqual(
1401             list(self.ipv6_scoped_network.subnets())[0].num_addresses,
1402             9223372036854775808,
1403         )
1404         self.assertEqual(
1405             self.ipv6_scoped_network.supernet().num_addresses, 36893488147419103232
1406         )
1407     def testContains(self):
1408         self.assertIn(ipaddress.IPv4Interface("1.2.3.128/25"), self.ipv4_network)
1409         self.assertNotIn(ipaddress.IPv4Interface("1.2.4.1/24"), self.ipv4_network)
1410         addr1 = ipaddress.IPv4Address("1.2.3.37")
1411         self.assertIn(addr1, self.ipv4_network)
1412         self.assertFalse(
1413             ipaddress.IPv4Network("1.1.0.0/16").__contains__(
1414                 ipaddress.IPv4Network("1.0.0.0/15")
1415             )
1416         )
1417     def testNth(self):
1418         self.assertEqual(str(self.ipv4_network[5]), "1.2.3.5")
1419         self.assertRaises(IndexError, self.ipv4_network.__getitem__, 256)
1420         self.assertEqual(str(self.ipv6_network[5]), "2001:658:22a:cafe::5")
1421         self.assertRaises(IndexError, self.ipv6_network.__getitem__, 1 &lt;&lt; 64)
1422         self.assertEqual(str(self.ipv6_scoped_network[5]), "2001:658:22a:cafe::5")
1423         self.assertRaises(IndexError, self.ipv6_scoped_network.__getitem__, 1 &lt;&lt; 64)
1424     def testGetitem(self):
1425         addr = ipaddress.IPv4Network("172.31.255.128/255.255.255.240")
1426         self.assertEqual(28, addr.prefixlen)
1427         addr_list = list(addr)
1428         self.assertEqual("172.31.255.128", str(addr_list[0]))
1429         self.assertEqual("172.31.255.128", str(addr[0]))
1430         self.assertEqual("172.31.255.143", str(addr_list[-1]))
1431         self.assertEqual("172.31.255.143", str(addr[-1]))
1432         self.assertEqual(addr_list[-1], addr[-1])
1433     def testEqual(self):
1434         self.assertTrue(self.ipv4_interface == ipaddress.IPv4Interface("1.2.3.4/24"))
1435         self.assertFalse(self.ipv4_interface == ipaddress.IPv4Interface("1.2.3.4/23"))
1436         self.assertFalse(self.ipv4_interface == ipaddress.IPv6Interface("::1.2.3.4/24"))
1437         self.assertFalse(
1438             self.ipv4_interface == ipaddress.IPv6Interface("::1.2.3.4%scope/24")
1439         )
1440         self.assertFalse(self.ipv4_interface == "")
1441         self.assertFalse(self.ipv4_interface == [])
1442         self.assertFalse(self.ipv4_interface == 2)
1443         self.assertTrue(
1444             self.ipv6_interface
1445             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1446         )
1447         self.assertFalse(
1448             self.ipv6_interface
1449             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1450         )
1451         self.assertFalse(self.ipv6_interface == ipaddress.IPv4Interface("1.2.3.4/23"))
1452         self.assertFalse(self.ipv6_interface == "")
1453         self.assertFalse(self.ipv6_interface == [])
1454         self.assertFalse(self.ipv6_interface == 2)
1455         self.assertTrue(
1456             self.ipv6_scoped_interface
1457             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/64")
1458         )
1459         self.assertFalse(
1460             self.ipv6_scoped_interface
1461             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/63")
1462         )
1463         self.assertFalse(
1464             self.ipv6_scoped_interface
1465             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1466         )
1467         self.assertFalse(
1468             self.ipv6_scoped_interface
1469             == ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1470         )
1471         self.assertFalse(
1472             self.ipv6_scoped_interface == ipaddress.IPv4Interface("1.2.3.4/23")
1473         )
1474         self.assertFalse(self.ipv6_scoped_interface == "")
1475         self.assertFalse(self.ipv6_scoped_interface == [])
1476         self.assertFalse(self.ipv6_scoped_interface == 2)
1477     def testNotEqual(self):
1478         self.assertFalse(self.ipv4_interface != ipaddress.IPv4Interface("1.2.3.4/24"))
1479         self.assertTrue(self.ipv4_interface != ipaddress.IPv4Interface("1.2.3.4/23"))
1480         self.assertTrue(self.ipv4_interface != ipaddress.IPv6Interface("::1.2.3.4/24"))
1481         self.assertTrue(
1482             self.ipv4_interface != ipaddress.IPv6Interface("::1.2.3.4%scope/24")
1483         )
1484         self.assertTrue(self.ipv4_interface != "")
1485         self.assertTrue(self.ipv4_interface != [])
1486         self.assertTrue(self.ipv4_interface != 2)
1487         self.assertTrue(self.ipv4_address != ipaddress.IPv4Address("1.2.3.5"))
1488         self.assertTrue(self.ipv4_address != "")
1489         self.assertTrue(self.ipv4_address != [])
1490         self.assertTrue(self.ipv4_address != 2)
1491         self.assertFalse(
1492             self.ipv6_interface
1493             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1494         )
1495         self.assertTrue(
1496             self.ipv6_interface
1497             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1498         )
1499         self.assertTrue(self.ipv6_interface != ipaddress.IPv4Interface("1.2.3.4/23"))
1500         self.assertTrue(self.ipv6_interface != "")
1501         self.assertTrue(self.ipv6_interface != [])
1502         self.assertTrue(self.ipv6_interface != 2)
1503         self.assertTrue(self.ipv6_address != ipaddress.IPv4Address("1.2.3.4"))
1504         self.assertTrue(self.ipv6_address != "")
1505         self.assertTrue(self.ipv6_address != [])
1506         self.assertTrue(self.ipv6_address != 2)
1507         self.assertFalse(
1508             self.ipv6_scoped_interface
1509             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/64")
1510         )
1511         self.assertTrue(
1512             self.ipv6_scoped_interface
1513             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1%scope/63")
1514         )
1515         self.assertTrue(
1516             self.ipv6_scoped_interface
1517             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/64")
1518         )
1519         self.assertTrue(
1520             self.ipv6_scoped_interface
1521             != ipaddress.IPv6Interface("2001:658:22a:cafe:200::1/63")
1522         )
1523         self.assertTrue(
1524             self.ipv6_scoped_interface != ipaddress.IPv4Interface("1.2.3.4/23")
1525         )
1526         self.assertTrue(self.ipv6_scoped_interface != "")
1527         self.assertTrue(self.ipv6_scoped_interface != [])
1528         self.assertTrue(self.ipv6_scoped_interface != 2)
1529         self.assertTrue(self.ipv6_scoped_address != ipaddress.IPv4Address("1.2.3.4"))
1530         self.assertTrue(self.ipv6_scoped_address != "")
1531         self.assertTrue(self.ipv6_scoped_address != [])
1532         self.assertTrue(self.ipv6_scoped_address != 2)
1533     def testSlash32Constructor(self):
1534         self.assertEqual(
1535             str(ipaddress.IPv4Interface("1.2.3.4/255.255.255.255")), "1.2.3.4/32"
1536         )
1537     def testSlash128Constructor(self):
1538         self.assertEqual(str(ipaddress.IPv6Interface("::1/128")), "::1/128")
1539         self.assertEqual(str(ipaddress.IPv6Interface("::1%scope/128")), "::1%scope/128")
1540     def testSlash0Constructor(self):
1541         self.assertEqual(str(ipaddress.IPv4Interface("1.2.3.4/0.0.0.0")), "1.2.3.4/0")
1542     def testCollapsing(self):
1543         ip1 = ipaddress.IPv4Address("1.1.1.0")
1544         ip2 = ipaddress.IPv4Address("1.1.1.1")
1545         ip3 = ipaddress.IPv4Address("1.1.1.2")
1546         ip4 = ipaddress.IPv4Address("1.1.1.3")
1547         ip5 = ipaddress.IPv4Address("1.1.1.4")
1548         ip6 = ipaddress.IPv4Address("1.1.1.0")
1549         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4, ip5, ip6])
1550         self.assertEqual(
1551             list(collapsed),
1552             [ipaddress.IPv4Network("1.1.1.0/30"), ipaddress.IPv4Network("1.1.1.4/32")],
1553         )
1554         ip1 = ipaddress.IPv4Address("1.1.1.0")
1555         ip2 = ipaddress.IPv4Address("1.1.1.1")
1556         ip3 = ipaddress.IPv4Address("1.1.1.2")
1557         ip4 = ipaddress.IPv4Address("1.1.1.3")
1558         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4])
1559         self.assertEqual(list(collapsed), [ipaddress.IPv4Network("1.1.1.0/30")])
1560         ip1 = ipaddress.IPv4Network("1.1.0.0/24")
1561         ip2 = ipaddress.IPv4Network("1.1.1.0/24")
1562         ip3 = ipaddress.IPv4Network("1.1.2.0/24")
1563         ip4 = ipaddress.IPv4Network("1.1.3.0/24")
1564         ip5 = ipaddress.IPv4Network("1.1.4.0/24")
1565         ip6 = ipaddress.IPv4Network("1.1.0.0/22")
1566         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3, ip4, ip5, ip6])
1567         self.assertEqual(
1568             list(collapsed),
1569             [ipaddress.IPv4Network("1.1.0.0/22"), ipaddress.IPv4Network("1.1.4.0/24")],
1570         )
1571         collapsed = ipaddress.collapse_addresses([ip1, ip2])
1572         self.assertEqual(list(collapsed), [ipaddress.IPv4Network("1.1.0.0/23")])
1573         ip_same1 = ip_same2 = ipaddress.IPv4Network("1.1.1.1/32")
1574         self.assertEqual(
1575             list(ipaddress.collapse_addresses([ip_same1, ip_same2])), [ip_same1]
1576         )
1577         ip_same1 = ip_same2 = ipaddress.IPv4Address("1.1.1.1")
1578         self.assertEqual(
1579             list(ipaddress.collapse_addresses([ip_same1, ip_same2])),
1580             [ipaddress.ip_network("1.1.1.1/32")],
1581         )
1582         ip1 = ipaddress.IPv6Network("2001::/100")
1583         ip2 = ipaddress.IPv6Network("2001::/120")
1584         ip3 = ipaddress.IPv6Network("2001::/96")
1585         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3])
1586         self.assertEqual(list(collapsed), [ip3])
1587         ip1 = ipaddress.IPv6Network("2001::%scope/100")
1588         ip2 = ipaddress.IPv6Network("2001::%scope/120")
1589         ip3 = ipaddress.IPv6Network("2001::%scope/96")
1590         collapsed = ipaddress.collapse_addresses([ip1, ip2, ip3])
1591         self.assertEqual(list(collapsed), [ip3])
1592         addr_tuples = [
1593             (ipaddress.ip_address("1.1.1.1"), ipaddress.ip_address("::1")),
1594             (ipaddress.IPv4Network("1.1.0.0/24"), ipaddress.IPv6Network("2001::/120")),
1595             (ipaddress.IPv4Network("1.1.0.0/32"), ipaddress.IPv6Network("2001::/128")),
1596         ]
1597         for ip1, ip2 in addr_tuples:
1598             self.assertRaises(TypeError, ipaddress.collapse_addresses, [ip1, ip2])
1599         addr_tuples = [
1600             (ipaddress.ip_address("1.1.1.1"), ipaddress.ip_address("::1%scope")),
1601             (
1602                 ipaddress.IPv4Network("1.1.0.0/24"),
1603                 ipaddress.IPv6Network("2001::%scope/120"),
1604             ),
1605             (
1606                 ipaddress.IPv4Network("1.1.0.0/32"),
1607                 ipaddress.IPv6Network("2001::%scope/128"),
1608             ),
1609         ]
1610         for ip1, ip2 in addr_tuples:
1611             self.assertRaises(TypeError, ipaddress.collapse_addresses, [ip1, ip2])
1612     def testSummarizing(self):
1613         summarize = ipaddress.summarize_address_range
1614         ip1 = ipaddress.ip_address("1.1.1.0")
1615         ip2 = ipaddress.ip_address("1.1.1.255")
1616         class IPv7Address(ipaddress.IPv6Address):
1617             @property
1618             def version(self):
1619                 return 7
1620         ip_invalid1 = IPv7Address("::1")
1621         ip_invalid2 = IPv7Address("::1")
1622         self.assertRaises(ValueError, list, summarize(ip_invalid1, ip_invalid2))
1623         self.assertRaises(TypeError, list, summarize(ip1, ipaddress.IPv6Address("::1")))
1624         self.assertRaises(
1625             TypeError, list, summarize(ip1, ipaddress.IPv6Address("::1%scope"))
1626         )
1627         self.assertEqual(
1628             list(summarize(ip1, ip2))[0], ipaddress.ip_network("1.1.1.0/24")
1629         )
1630         ip2 = ipaddress.ip_address("1.1.1.8")
1631         self.assertEqual(
1632             list(summarize(ip1, ip2)),
1633             [ipaddress.ip_network("1.1.1.0/29"), ipaddress.ip_network("1.1.1.8")],
1634         )
1635         ip1 = ipaddress.IPv4Address(0)
1636         ip2 = ipaddress.IPv4Address(ipaddress.IPv4Address._ALL_ONES)
1637         self.assertEqual(
1638             [ipaddress.IPv4Network("0.0.0.0/0")], list(summarize(ip1, ip2))
1639         )
1640         ip1 = ipaddress.ip_address("1::")
1641         ip2 = ipaddress.ip_address("1:ffff:ffff:ffff:ffff:ffff:ffff:ffff")
1642         self.assertEqual(list(summarize(ip1, ip2))[0], ipaddress.ip_network("1::/16"))
1643         ip2 = ipaddress.ip_address("2::")
1644         self.assertEqual(
1645             list(summarize(ip1, ip2)),
1646             [ipaddress.ip_network("1::/16"), ipaddress.ip_network("2::/128")],
1647         )
1648         ip1 = ipaddress.ip_address("1::%scope")
1649         ip2 = ipaddress.ip_address("1:ffff:ffff:ffff:ffff:ffff:ffff:ffff%scope")
1650         self.assertEqual(list(summarize(ip1, ip2))[0], ipaddress.ip_network("1::/16"))
1651         ip2 = ipaddress.ip_address("2::%scope")
1652         self.assertEqual(
1653             list(summarize(ip1, ip2)),
1654             [ipaddress.ip_network("1::/16"), ipaddress.ip_network("2::/128")],
1655         )
1656         self.assertRaises(
1657             ValueError,
1658             list,
1659             summarize(ipaddress.ip_address("1.1.1.0"), ipaddress.ip_address("1.1.0.0")),
1660         )
1661         self.assertRaises(
1662             TypeError,
1663             list,
1664             summarize(ipaddress.ip_network("1.1.1.0"), ipaddress.ip_network("1.1.0.0")),
1665         )
1666         self.assertRaises(
1667             TypeError,
1668             list,
1669             summarize(ipaddress.ip_network("1.1.1.0"), ipaddress.ip_network("1.1.0.0")),
1670         )
1671         self.assertRaises(
1672             TypeError,
1673             list,
1674             summarize(ipaddress.ip_address("::"), ipaddress.ip_network("1.1.0.0")),
1675         )
1676     def testAddressComparison(self):
1677         self.assertTrue(
1678             ipaddress.ip_address("1.1.1.1") &lt;= ipaddress.ip_address("1.1.1.1")
1679         )
1680         self.assertTrue(
1681             ipaddress.ip_address("1.1.1.1") &lt;= ipaddress.ip_address("1.1.1.2")
1682         )
1683         self.assertTrue(ipaddress.ip_address("::1") &lt;= ipaddress.ip_address("::1"))
1684         self.assertTrue(ipaddress.ip_address("::1") &lt;= ipaddress.ip_address("::2"))
1685         self.assertTrue(
1686             ipaddress.ip_address("::1%scope") &lt;= ipaddress.ip_address("::1%scope")
1687         )
1688         self.assertTrue(
1689             ipaddress.ip_address("::1%scope") &lt;= ipaddress.ip_address("::2%scope")
1690         )
1691     def testInterfaceComparison(self):
1692         self.assertTrue(
1693             ipaddress.ip_interface("1.1.1.1/24") == ipaddress.ip_interface("1.1.1.1/24")
1694         )
1695         self.assertTrue(
1696             ipaddress.ip_interface("1.1.1.1/16") &lt; ipaddress.ip_interface("1.1.1.1/24")
1697         )
1698         self.assertTrue(
1699             ipaddress.ip_interface("1.1.1.1/24") &lt; ipaddress.ip_interface("1.1.1.2/24")
1700         )
1701         self.assertTrue(
1702             ipaddress.ip_interface("1.1.1.2/16") &lt; ipaddress.ip_interface("1.1.1.1/24")
1703         )
1704         self.assertTrue(
1705             ipaddress.ip_interface("1.1.1.1/24") &gt; ipaddress.ip_interface("1.1.1.1/16")
1706         )
1707         self.assertTrue(
1708             ipaddress.ip_interface("1.1.1.2/24") &gt; ipaddress.ip_interface("1.1.1.1/24")
1709         )
1710         self.assertTrue(
1711             ipaddress.ip_interface("1.1.1.1/24") &gt; ipaddress.ip_interface("1.1.1.2/16")
1712         )
1713         self.assertTrue(
1714             ipaddress.ip_interface("::1/64") == ipaddress.ip_interface("::1/64")
1715         )
1716         self.assertTrue(
1717             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::1/80")
1718         )
1719         self.assertTrue(
1720             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::2/64")
1721         )
1722         self.assertTrue(
1723             ipaddress.ip_interface("::2/48") &lt; ipaddress.ip_interface("::1/64")
1724         )
1725         self.assertTrue(
1726             ipaddress.ip_interface("::1/80") &gt; ipaddress.ip_interface("::1/64")
1727         )
1728         self.assertTrue(
1729             ipaddress.ip_interface("::2/64") &gt; ipaddress.ip_interface("::1/64")
1730         )
1731         self.assertTrue(
1732             ipaddress.ip_interface("::1/64") &gt; ipaddress.ip_interface("::2/48")
1733         )
1734         self.assertTrue(
1735             ipaddress.ip_interface("::1%scope/64")
1736             == ipaddress.ip_interface("::1%scope/64")
1737         )
1738         self.assertTrue(
1739             ipaddress.ip_interface("::1%scope/64")
1740             &lt; ipaddress.ip_interface("::1%scope/80")
1741         )
1742         self.assertTrue(
1743             ipaddress.ip_interface("::1%scope/64")
1744             &lt; ipaddress.ip_interface("::2%scope/64")
1745         )
1746         self.assertTrue(
1747             ipaddress.ip_interface("::2%scope/48")
1748             &lt; ipaddress.ip_interface("::1%scope/64")
1749         )
1750         self.assertTrue(
1751             ipaddress.ip_interface("::1%scope/80")
1752             &gt; ipaddress.ip_interface("::1%scope/64")
1753         )
1754         self.assertTrue(
1755             ipaddress.ip_interface("::2%scope/64")
1756             &gt; ipaddress.ip_interface("::1%scope/64")
1757         )
1758         self.assertTrue(
1759             ipaddress.ip_interface("::1%scope/64")
1760             &gt; ipaddress.ip_interface("::2%scope/48")
1761         )
1762         self.assertFalse(
1763             ipaddress.ip_interface("::1%scope/64") == ipaddress.ip_interface("::1/64")
1764         )
1765         self.assertTrue(
1766             ipaddress.ip_interface("::1%scope/64") &lt; ipaddress.ip_interface("::1/80")
1767         )
1768         self.assertTrue(
1769             ipaddress.ip_interface("::1%scope/64") &lt; ipaddress.ip_interface("::2/64")
1770         )
1771         self.assertTrue(
1772             ipaddress.ip_interface("::2%scope/48") &lt; ipaddress.ip_interface("::1/64")
1773         )
1774         self.assertTrue(
1775             ipaddress.ip_interface("::1%scope/80") &gt; ipaddress.ip_interface("::1/64")
1776         )
1777         self.assertTrue(
1778             ipaddress.ip_interface("::2%scope/64") &gt; ipaddress.ip_interface("::1/64")
1779         )
1780         self.assertTrue(
1781             ipaddress.ip_interface("::1%scope/64") &gt; ipaddress.ip_interface("::2/48")
1782         )
1783         self.assertFalse(
1784             ipaddress.ip_interface("::1/64") == ipaddress.ip_interface("::1%scope/64")
1785         )
1786         self.assertTrue(
1787             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::1%scope/80")
1788         )
1789         self.assertTrue(
1790             ipaddress.ip_interface("::1/64") &lt; ipaddress.ip_interface("::2%scope/64")
1791         )
1792         self.assertTrue(
1793             ipaddress.ip_interface("::2/48") &lt; ipaddress.ip_interface("::1%scope/64")
1794         )
1795         self.assertTrue(
1796             ipaddress.ip_interface("::1/80") &gt; ipaddress.ip_interface("::1%scope/64")
1797         )
1798         self.assertTrue(
1799             ipaddress.ip_interface("::2/64") &gt; ipaddress.ip_interface("::1%scope/64")
1800         )
1801         self.assertTrue(
1802             ipaddress.ip_interface("::1/64") &gt; ipaddress.ip_interface("::2%scope/48")
1803         )
1804     def testNetworkComparison(self):
1805         ip1 = ipaddress.IPv4Network("1.1.1.0/24")
1806         ip2 = ipaddress.IPv4Network("1.1.1.0/32")
1807         ip3 = ipaddress.IPv4Network("1.1.2.0/24")
1808         self.assertTrue(ip1 &lt; ip3)
1809         self.assertTrue(ip3 &gt; ip2)
1810         self.assertEqual(ip1.compare_networks(ip1), 0)
1811         self.assertEqual(ip1.compare_networks(ip2), -1)
1812         self.assertEqual(ip2.compare_networks(ip1), 1)
1813         self.assertEqual(ip1.compare_networks(ip3), -1)
1814         self.assertEqual(ip3.compare_networks(ip1), 1)
1815         self.assertTrue(ip1._get_networks_key() &lt; ip3._get_networks_key())
1816         ip1 = ipaddress.IPv6Network("2001:2000::/96")
1817         ip2 = ipaddress.IPv6Network("2001:2001::/96")
1818         ip3 = ipaddress.IPv6Network("2001:ffff:2000::/96")
1819         self.assertTrue(ip1 &lt; ip3)
1820         self.assertTrue(ip3 &gt; ip2)
1821         self.assertEqual(ip1.compare_networks(ip3), -1)
1822         self.assertTrue(ip1._get_networks_key() &lt; ip3._get_networks_key())
1823         self.assertRaises(
1824             TypeError, self.ipv4_network.compare_networks, self.ipv6_network
1825         )
1826         ipv6 = ipaddress.IPv6Interface("::/0")
1827         ipv4 = ipaddress.IPv4Interface("0.0.0.0/0")
1828         self.assertRaises(TypeError, ipv4.__lt__, ipv6)
1829         self.assertRaises(TypeError, ipv4.__gt__, ipv6)
1830         self.assertRaises(TypeError, ipv6.__lt__, ipv4)
1831         self.assertRaises(TypeError, ipv6.__gt__, ipv4)
1832         ip1 = ipaddress.ip_network("10.1.2.128/25")
1833         self.assertFalse(ip1 &lt; ip1)
1834         self.assertFalse(ip1 &gt; ip1)
1835         ip2 = ipaddress.ip_network("10.1.3.0/24")
1836         self.assertTrue(ip1 &lt; ip2)
1837         self.assertFalse(ip2 &lt; ip1)
1838         self.assertFalse(ip1 &gt; ip2)
1839         self.assertTrue(ip2 &gt; ip1)
1840         ip3 = ipaddress.ip_network("10.1.3.0/25")
1841         self.assertTrue(ip2 &lt; ip3)
1842         self.assertFalse(ip3 &lt; ip2)
1843         self.assertFalse(ip2 &gt; ip3)
1844         self.assertTrue(ip3 &gt; ip2)
1845         ip1 = ipaddress.ip_network("10.10.10.0/31")
1846         ip2 = ipaddress.ip_network("10.10.10.0")
1847         ip3 = ipaddress.ip_network("10.10.10.2/31")
1848         ip4 = ipaddress.ip_network("10.10.10.2")
1849         sorted = [ip1, ip2, ip3, ip4]
1850         unsorted = [ip2, ip4, ip1, ip3]
1851         unsorted.sort()
1852         self.assertEqual(sorted, unsorted)
1853         unsorted = [ip4, ip1, ip3, ip2]
1854         unsorted.sort()
1855         self.assertEqual(sorted, unsorted)
1856         self.assertIs(ip1.__lt__(ipaddress.ip_address("10.10.10.0")), NotImplemented)
1857         self.assertIs(ip2.__lt__(ipaddress.ip_address("10.10.10.0")), NotImplemented)
1858         self.assertTrue(
1859             ipaddress.ip_network("1.1.1.1") &lt;= ipaddress.ip_network("1.1.1.1")
1860         )
1861         self.assertTrue(
1862             ipaddress.ip_network("1.1.1.1") &lt;= ipaddress.ip_network("1.1.1.2")
1863         )
1864         self.assertFalse(
1865             ipaddress.ip_network("1.1.1.2") &lt;= ipaddress.ip_network("1.1.1.1")
1866         )
1867         self.assertTrue(ipaddress.ip_network("::1") &lt;= ipaddress.ip_network("::1"))
1868         self.assertTrue(ipaddress.ip_network("::1") &lt;= ipaddress.ip_network("::2"))
1869         self.assertFalse(ipaddress.ip_network("::2") &lt;= ipaddress.ip_network("::1"))
1870     def testStrictNetworks(self):
1871         self.assertRaises(ValueError, ipaddress.ip_network, "192.168.1.1/24")
1872         self.assertRaises(ValueError, ipaddress.ip_network, "::1/120")
1873         self.assertRaises(ValueError, ipaddress.ip_network, "::1%scope/120")
1874     def testOverlaps(self):
1875         other = ipaddress.IPv4Network("1.2.3.0/30")
1876         other2 = ipaddress.IPv4Network("1.2.2.0/24")
1877         other3 = ipaddress.IPv4Network("1.2.2.64/26")
1878         self.assertTrue(self.ipv4_network.overlaps(other))
1879         self.assertFalse(self.ipv4_network.overlaps(other2))
1880         self.assertTrue(other2.overlaps(other3))
1881     def testEmbeddedIpv4(self):
1882         ipv4_string = "192.168.0.1"
1883         ipv4 = ipaddress.IPv4Interface(ipv4_string)
1884         v4compat_ipv6 = ipaddress.IPv6Interface("::%s" % ipv4_string)
1885         self.assertEqual(int(v4compat_ipv6.ip), int(ipv4.ip))
1886         v4mapped_ipv6 = ipaddress.IPv6Interface("::ffff:%s" % ipv4_string)
1887         self.assertNotEqual(v4mapped_ipv6.ip, ipv4.ip)
1888         self.assertRaises(
1889             ipaddress.AddressValueError, ipaddress.IPv6Interface, "2001:1.1.1.1:1.1.1.1"
1890         )
1891     def testIPv6AddressTooLarge(self):
1892         self.assertEqual(
1893             ipaddress.ip_address("::FFFF:192.0.2.1"),
1894             ipaddress.ip_address("::FFFF:c000:201"),
1895         )
1896         self.assertEqual(
1897             ipaddress.ip_address("FFFF::192.0.2.1"),
1898             ipaddress.ip_address("FFFF::c000:201"),
1899         )
1900         self.assertEqual(
1901             ipaddress.ip_address("::FFFF:192.0.2.1%scope"),
1902             ipaddress.ip_address("::FFFF:c000:201%scope"),
1903         )
1904         self.assertEqual(
1905             ipaddress.ip_address("FFFF::192.0.2.1%scope"),
1906             ipaddress.ip_address("FFFF::c000:201%scope"),
1907         )
1908         self.assertNotEqual(
1909             ipaddress.ip_address("::FFFF:192.0.2.1%scope"),
1910             ipaddress.ip_address("::FFFF:c000:201"),
1911         )
1912         self.assertNotEqual(
1913             ipaddress.ip_address("FFFF::192.0.2.1%scope"),
1914             ipaddress.ip_address("FFFF::c000:201"),
1915         )
1916         self.assertNotEqual(
1917             ipaddress.ip_address("::FFFF:192.0.2.1"),
1918             ipaddress.ip_address("::FFFF:c000:201%scope"),
1919         )
1920         self.assertNotEqual(
1921             ipaddress.ip_address("FFFF::192.0.2.1"),
1922             ipaddress.ip_address("FFFF::c000:201%scope"),
1923         )
1924     def testIPVersion(self):
1925         self.assertEqual(self.ipv4_address.version, 4)
1926         self.assertEqual(self.ipv6_address.version, 6)
1927         self.assertEqual(self.ipv6_scoped_address.version, 6)
1928     def testMaxPrefixLength(self):
1929         self.assertEqual(self.ipv4_interface.max_prefixlen, 32)
1930         self.assertEqual(self.ipv6_interface.max_prefixlen, 128)
1931         self.assertEqual(self.ipv6_scoped_interface.max_prefixlen, 128)
1932     def testPacked(self):
1933         self.assertEqual(self.ipv4_address.packed, b"\x01\x02\x03\x04")
1934         self.assertEqual(
1935             ipaddress.IPv4Interface("255.254.253.252").packed, b"\xff\xfe\xfd\xfc"
1936         )
1937         self.assertEqual(
1938             self.ipv6_address.packed,
1939             b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01",
1940         )
1941         self.assertEqual(
1942             ipaddress.IPv6Interface("ffff:2:3:4:ffff::").packed,
1943             b"\xff\xff\x00\x02\x00\x03\x00\x04\xff\xff" + b"\x00" * 6,
1944         )
1945         self.assertEqual(
1946             ipaddress.IPv6Interface("::1:0:0:0:0").packed,
1947             b"\x00" * 6 + b"\x00\x01" + b"\x00" * 8,
1948         )
1949         self.assertEqual(
1950             self.ipv6_scoped_address.packed,
1951             b"\x20\x01\x06\x58\x02\x2a\xca\xfe\x02\x00\x00\x00\x00\x00\x00\x01",
1952         )
1953         self.assertEqual(
1954             ipaddress.IPv6Interface("ffff:2:3:4:ffff::%scope").packed,
1955             b"\xff\xff\x00\x02\x00\x03\x00\x04\xff\xff" + b"\x00" * 6,
1956         )
1957         self.assertEqual(
1958             ipaddress.IPv6Interface("::1:0:0:0:0%scope").packed,
1959             b"\x00" * 6 + b"\x00\x01" + b"\x00" * 8,
1960         )
1961     def testIpType(self):
1962         ipv4net = ipaddress.ip_network("1.2.3.4")
1963         ipv4addr = ipaddress.ip_address("1.2.3.4")
1964         ipv6net = ipaddress.ip_network("::1.2.3.4")
1965         ipv6addr = ipaddress.ip_address("::1.2.3.4")
1966         self.assertEqual(ipaddress.IPv4Network, type(ipv4net))
1967         self.assertEqual(ipaddress.IPv4Address, type(ipv4addr))
1968         self.assertEqual(ipaddress.IPv6Network, type(ipv6net))
1969         self.assertEqual(ipaddress.IPv6Address, type(ipv6addr))
1970     def testReservedIpv4(self):
1971         self.assertEqual(True, ipaddress.ip_interface("224.1.1.1/31").is_multicast)
1972         self.assertEqual(False, ipaddress.ip_network("240.0.0.0").is_multicast)
1973         self.assertEqual(True, ipaddress.ip_network("240.0.0.0").is_reserved)
1974         self.assertEqual(True, ipaddress.ip_interface("192.168.1.1/17").is_private)
1975         self.assertEqual(False, ipaddress.ip_network("192.169.0.0").is_private)
1976         self.assertEqual(True, ipaddress.ip_network("10.255.255.255").is_private)
1977         self.assertEqual(False, ipaddress.ip_network("11.0.0.0").is_private)
1978         self.assertEqual(False, ipaddress.ip_network("11.0.0.0").is_reserved)
1979         self.assertEqual(True, ipaddress.ip_network("172.31.255.255").is_private)
1980         self.assertEqual(False, ipaddress.ip_network("172.32.0.0").is_private)
1981         self.assertEqual(True, ipaddress.ip_network("169.254.1.0/24").is_link_local)
1982         self.assertEqual(
1983             True, ipaddress.ip_interface("169.254.100.200/24").is_link_local
1984         )
1985         self.assertEqual(
1986             False, ipaddress.ip_interface("169.255.100.200/24").is_link_local
1987         )
1988         self.assertEqual(True, ipaddress.ip_network("127.100.200.254/32").is_loopback)
1989         self.assertEqual(True, ipaddress.ip_network("127.42.0.0/16").is_loopback)
1990         self.assertEqual(False, ipaddress.ip_network("128.0.0.0").is_loopback)
1991         self.assertEqual(False, ipaddress.ip_network("100.64.0.0/10").is_private)
1992         self.assertEqual(False, ipaddress.ip_network("100.64.0.0/10").is_global)
1993         self.assertEqual(True, ipaddress.ip_network("192.0.2.128/25").is_private)
1994         self.assertEqual(True, ipaddress.ip_network("192.0.3.0/24").is_global)
1995         self.assertEqual(True, ipaddress.ip_address("0.0.0.0").is_unspecified)
1996         self.assertEqual(True, ipaddress.ip_address("224.1.1.1").is_multicast)
1997         self.assertEqual(False, ipaddress.ip_address("240.0.0.0").is_multicast)
1998         self.assertEqual(True, ipaddress.ip_address("240.0.0.1").is_reserved)
1999         self.assertEqual(False, ipaddress.ip_address("239.255.255.255").is_reserved)
2000         self.assertEqual(True, ipaddress.ip_address("192.168.1.1").is_private)
2001         self.assertEqual(False, ipaddress.ip_address("192.169.0.0").is_private)
2002         self.assertEqual(True, ipaddress.ip_address("10.255.255.255").is_private)
2003         self.assertEqual(False, ipaddress.ip_address("11.0.0.0").is_private)
2004         self.assertEqual(True, ipaddress.ip_address("172.31.255.255").is_private)
2005         self.assertEqual(False, ipaddress.ip_address("172.32.0.0").is_private)
2006         self.assertEqual(True, ipaddress.ip_address("169.254.100.200").is_link_local)
2007         self.assertEqual(False, ipaddress.ip_address("169.255.100.200").is_link_local)
2008         self.assertTrue(ipaddress.ip_address("192.0.7.1").is_global)
2009         self.assertFalse(ipaddress.ip_address("203.0.113.1").is_global)
2010         self.assertEqual(True, ipaddress.ip_address("127.100.200.254").is_loopback)
2011         self.assertEqual(True, ipaddress.ip_address("127.42.0.0").is_loopback)
2012         self.assertEqual(False, ipaddress.ip_address("128.0.0.0").is_loopback)
2013         self.assertEqual(True, ipaddress.ip_network("0.0.0.0").is_unspecified)
2014     def testReservedIpv6(self):
2015         self.assertEqual(True, ipaddress.ip_network("ffff::").is_multicast)
2016         self.assertEqual(True, ipaddress.ip_network(2 ** 128 - 1).is_multicast)
2017         self.assertEqual(True, ipaddress.ip_network("ff00::").is_multicast)
2018         self.assertEqual(False, ipaddress.ip_network("fdff::").is_multicast)
2019         self.assertEqual(True, ipaddress.ip_network("fecf::").is_site_local)
2020         self.assertEqual(
2021             True, ipaddress.ip_network("feff:ffff:ffff:ffff::").is_site_local
2022         )
2023         self.assertEqual(False, ipaddress.ip_network("fbf:ffff::").is_site_local)
2024         self.assertEqual(False, ipaddress.ip_network("ff00::").is_site_local)
2025         self.assertEqual(True, ipaddress.ip_network("fc00::").is_private)
2026         self.assertEqual(True, ipaddress.ip_network("fc00:ffff:ffff:ffff::").is_private)
2027         self.assertEqual(False, ipaddress.ip_network("fbff:ffff::").is_private)
2028         self.assertEqual(False, ipaddress.ip_network("fe00::").is_private)
2029         self.assertEqual(True, ipaddress.ip_network("fea0::").is_link_local)
2030         self.assertEqual(True, ipaddress.ip_network("febf:ffff::").is_link_local)
2031         self.assertEqual(False, ipaddress.ip_network("fe7f:ffff::").is_link_local)
2032         self.assertEqual(False, ipaddress.ip_network("fec0::").is_link_local)
2033         self.assertEqual(True, ipaddress.ip_interface("0:0::0:01").is_loopback)
2034         self.assertEqual(False, ipaddress.ip_interface("::1/127").is_loopback)
2035         self.assertEqual(False, ipaddress.ip_network("::").is_loopback)
2036         self.assertEqual(False, ipaddress.ip_network("::2").is_loopback)
2037         self.assertEqual(True, ipaddress.ip_network("0::0").is_unspecified)
2038         self.assertEqual(False, ipaddress.ip_network("::1").is_unspecified)
2039         self.assertEqual(False, ipaddress.ip_network("::/127").is_unspecified)
2040         self.assertEqual(True, ipaddress.ip_network("2001::1/128").is_private)
2041         self.assertEqual(True, ipaddress.ip_network("200::1/128").is_global)
2042         self.assertEqual(True, ipaddress.ip_address("ffff::").is_multicast)
2043         self.assertEqual(True, ipaddress.ip_address(2 ** 128 - 1).is_multicast)
2044         self.assertEqual(True, ipaddress.ip_address("ff00::").is_multicast)
2045         self.assertEqual(False, ipaddress.ip_address("fdff::").is_multicast)
2046         self.assertEqual(True, ipaddress.ip_address("fecf::").is_site_local)
2047         self.assertEqual(
2048             True, ipaddress.ip_address("feff:ffff:ffff:ffff::").is_site_local
2049         )
2050         self.assertEqual(False, ipaddress.ip_address("fbf:ffff::").is_site_local)
2051         self.assertEqual(False, ipaddress.ip_address("ff00::").is_site_local)
2052         self.assertEqual(True, ipaddress.ip_address("fc00::").is_private)
2053         self.assertEqual(True, ipaddress.ip_address("fc00:ffff:ffff:ffff::").is_private)
2054         self.assertEqual(False, ipaddress.ip_address("fbff:ffff::").is_private)
2055         self.assertEqual(False, ipaddress.ip_address("fe00::").is_private)
2056         self.assertEqual(True, ipaddress.ip_address("fea0::").is_link_local)
2057         self.assertEqual(True, ipaddress.ip_address("febf:ffff::").is_link_local)
2058         self.assertEqual(False, ipaddress.ip_address("fe7f:ffff::").is_link_local)
2059         self.assertEqual(False, ipaddress.ip_address("fec0::").is_link_local)
2060         self.assertEqual(True, ipaddress.ip_address("0:0::0:01").is_loopback)
2061         self.assertEqual(True, ipaddress.ip_address("::1").is_loopback)
2062         self.assertEqual(False, ipaddress.ip_address("::2").is_loopback)
2063         self.assertEqual(True, ipaddress.ip_address("0::0").is_unspecified)
2064         self.assertEqual(False, ipaddress.ip_address("::1").is_unspecified)
2065         self.assertEqual(True, ipaddress.ip_address("100::").is_reserved)
2066         self.assertEqual(True, ipaddress.ip_network("4000::1/128").is_reserved)
2067     def testIpv4Mapped(self):
2068         self.assertEqual(
2069             ipaddress.ip_address("::ffff:192.168.1.1").ipv4_mapped,
2070             ipaddress.ip_address("192.168.1.1"),
2071         )
2072         self.assertEqual(ipaddress.ip_address("::c0a8:101").ipv4_mapped, None)
2073         self.assertEqual(
2074             ipaddress.ip_address("::ffff:c0a8:101").ipv4_mapped,
2075             ipaddress.ip_address("192.168.1.1"),
2076         )
2077     def testAddrExclude(self):
2078         addr1 = ipaddress.ip_network("10.1.1.0/24")
2079         addr2 = ipaddress.ip_network("10.1.1.0/26")
2080         addr3 = ipaddress.ip_network("10.2.1.0/24")
2081         addr4 = ipaddress.ip_address("10.1.1.0")
2082         addr5 = ipaddress.ip_network("2001:db8::0/32")
2083         addr6 = ipaddress.ip_network("10.1.1.5/32")
2084         self.assertEqual(
2085             sorted(list(addr1.address_exclude(addr2))),
2086             [
2087                 ipaddress.ip_network("10.1.1.64/26"),
2088                 ipaddress.ip_network("10.1.1.128/25"),
2089             ],
2090         )
2091         self.assertRaises(ValueError, list, addr1.address_exclude(addr3))
2092         self.assertRaises(TypeError, list, addr1.address_exclude(addr4))
2093         self.assertRaises(TypeError, list, addr1.address_exclude(addr5))
2094         self.assertEqual(list(addr1.address_exclude(addr1)), [])
2095         self.assertEqual(
2096             sorted(list(addr1.address_exclude(addr6))),
2097             [
2098                 ipaddress.ip_network("10.1.1.0/30"),
2099                 ipaddress.ip_network("10.1.1.4/32"),
2100                 ipaddress.ip_network("10.1.1.6/31"),
2101                 ipaddress.ip_network("10.1.1.8/29"),
2102                 ipaddress.ip_network("10.1.1.16/28"),
2103                 ipaddress.ip_network("10.1.1.32/27"),
2104                 ipaddress.ip_network("10.1.1.64/26"),
2105                 ipaddress.ip_network("10.1.1.128/25"),
2106             ],
2107         )
2108     def testHash(self):
2109         self.assertEqual(
2110             hash(ipaddress.ip_interface("10.1.1.0/24")),
2111             hash(ipaddress.ip_interface("10.1.1.0/24")),
2112         )
2113         self.assertEqual(
2114             hash(ipaddress.ip_network("10.1.1.0/24")),
2115             hash(ipaddress.ip_network("10.1.1.0/24")),
2116         )
2117         self.assertEqual(
2118             hash(ipaddress.ip_address("10.1.1.0")),
2119             hash(ipaddress.ip_address("10.1.1.0")),
2120         )
2121         self.assertEqual(
2122             hash(ipaddress.ip_address("1.2.3.4")),
2123             hash(ipaddress.ip_address(int(ipaddress.ip_address("1.2.3.4")._ip))),
2124         )
2125         ip1 = ipaddress.ip_address("10.1.1.0")
2126         ip2 = ipaddress.ip_address("1::")
2127         dummy = {}
2128         dummy[self.ipv4_address] = None
2129         dummy[self.ipv6_address] = None
2130         dummy[ip1] = None
2131         dummy[ip2] = None
2132         self.assertIn(self.ipv4_address, dummy)
2133         self.assertIn(ip2, dummy)
2134     def testIPBases(self):
2135         net = self.ipv4_network
2136         self.assertEqual("1.2.3.0/24", net.compressed)
2137         net = self.ipv6_network
2138         self.assertRaises(ValueError, net._string_from_ip_int, 2 ** 128 + 1)
2139     def testIPv6NetworkHelpers(self):
2140         net = self.ipv6_network
2141         self.assertEqual("2001:658:22a:cafe::/64", net.with_prefixlen)
2142         self.assertEqual("2001:658:22a:cafe::/ffff:ffff:ffff:ffff::", net.with_netmask)
2143         self.assertEqual("2001:658:22a:cafe::/::ffff:ffff:ffff:ffff", net.with_hostmask)
2144         self.assertEqual("2001:658:22a:cafe::/64", str(net))
2145     def testIPv4NetworkHelpers(self):
2146         net = self.ipv4_network
2147         self.assertEqual("1.2.3.0/24", net.with_prefixlen)
2148         self.assertEqual("1.2.3.0/255.255.255.0", net.with_netmask)
2149         self.assertEqual("1.2.3.0/0.0.0.255", net.with_hostmask)
2150         self.assertEqual("1.2.3.0/24", str(net))
2151     def testCopyConstructor(self):
2152         addr1 = ipaddress.ip_network("10.1.1.0/24")
2153         addr2 = ipaddress.ip_network(addr1)
2154         addr3 = ipaddress.ip_interface("2001:658:22a:cafe:200::1/64")
2155         addr4 = ipaddress.ip_interface(addr3)
2156         addr5 = ipaddress.IPv4Address("1.1.1.1")
2157         addr6 = ipaddress.IPv6Address("2001:658:22a:cafe:200::1")
2158         self.assertEqual(addr1, addr2)
2159         self.assertEqual(addr3, addr4)
2160         self.assertEqual(addr5, ipaddress.IPv4Address(addr5))
2161         self.assertEqual(addr6, ipaddress.IPv6Address(addr6))
2162     def testCompressIPv6Address(self):
2163         test_addresses = {
2164             "1:2:3:4:5:6:7:8": "1:2:3:4:5:6:7:8/128",
2165             "2001:0:0:4:0:0:0:8": "2001:0:0:4::8/128",
2166             "2001:0:0:4:5:6:7:8": "2001::4:5:6:7:8/128",
2167             "2001:0:3:4:5:6:7:8": "2001:0:3:4:5:6:7:8/128",
2168             "0:0:3:0:0:0:0:ffff": "0:0:3::ffff/128",
2169             "0:0:0:4:0:0:0:ffff": "::4:0:0:0:ffff/128",
2170             "0:0:0:0:5:0:0:ffff": "::5:0:0:ffff/128",
2171             "1:0:0:4:0:0:7:8": "1::4:0:0:7:8/128",
2172             "0:0:0:0:0:0:0:0": "::/128",
2173             "0:0:0:0:0:0:0:0/0": "::/0",
2174             "0:0:0:0:0:0:0:1": "::1/128",
2175             "2001:0658:022a:cafe:0000:0000:0000:0000/66": "2001:658:22a:cafe::/66",
2176             "::1.2.3.4": "::102:304/128",
2177             "1:2:3:4:5:ffff:1.2.3.4": "1:2:3:4:5:ffff:102:304/128",
2178             "::7:6:5:4:3:2:1": "0:7:6:5:4:3:2:1/128",
2179             "::7:6:5:4:3:2:0": "0:7:6:5:4:3:2:0/128",
2180             "7:6:5:4:3:2:1::": "7:6:5:4:3:2:1:0/128",
2181             "0:6:5:4:3:2:1::": "0:6:5:4:3:2:1:0/128",
2182         }
2183         for uncompressed, compressed in list(test_addresses.items()):
2184             self.assertEqual(compressed, str(ipaddress.IPv6Interface(uncompressed)))
2185     def testExplodeShortHandIpStr(self):
2186         addr1 = ipaddress.IPv6Interface("2001::1")
2187         addr2 = ipaddress.IPv6Address("2001:0:5ef5:79fd:0:59d:a0e5:ba1")
2188         addr3 = ipaddress.IPv6Network("2001::/96")
2189         addr4 = ipaddress.IPv4Address("192.168.178.1")
2190         self.assertEqual("2001:0000:0000:0000:0000:0000:0000:0001/128", addr1.exploded)
2191         self.assertEqual(
2192             "0000:0000:0000:0000:0000:0000:0000:0001/128",
2193             ipaddress.IPv6Interface("::1/128").exploded,
2194         )
2195         self.assertEqual("2001:0000:5ef5:79fd:0000:059d:a0e5:0ba1", addr2.exploded)
2196         self.assertEqual("2001:0000:0000:0000:0000:0000:0000:0000/96", addr3.exploded)
2197         self.assertEqual("192.168.178.1", addr4.exploded)
2198     def testReversePointer(self):
2199         addr1 = ipaddress.IPv4Address("127.0.0.1")
2200         addr2 = ipaddress.IPv6Address("2001:db8::1")
2201         self.assertEqual("1.0.0.127.in-addr.arpa", addr1.reverse_pointer)
2202         self.assertEqual(
2203             "1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8."
2204             + "b.d.0.1.0.0.2.ip6.arpa",
2205             addr2.reverse_pointer,
2206         )
2207     def testIntRepresentation(self):
2208         self.assertEqual(16909060, int(self.ipv4_address))
2209         self.assertEqual(42540616829182469433547762482097946625, int(self.ipv6_address))
2210     def testForceVersion(self):
2211         self.assertEqual(ipaddress.ip_network(1).version, 4)
2212         self.assertEqual(ipaddress.IPv6Network(1).version, 6)
2213     def testWithStar(self):
2214         self.assertEqual(self.ipv4_interface.with_prefixlen, "1.2.3.4/24")
2215         self.assertEqual(self.ipv4_interface.with_netmask, "1.2.3.4/255.255.255.0")
2216         self.assertEqual(self.ipv4_interface.with_hostmask, "1.2.3.4/0.0.0.255")
2217         self.assertEqual(
2218             self.ipv6_interface.with_prefixlen, "2001:658:22a:cafe:200::1/64"
2219         )
2220         self.assertEqual(
2221             self.ipv6_interface.with_netmask,
2222             "2001:658:22a:cafe:200::1/ffff:ffff:ffff:ffff::",
2223         )
2224         self.assertEqual(
2225             self.ipv6_interface.with_hostmask,
2226             "2001:658:22a:cafe:200::1/::ffff:ffff:ffff:ffff",
2227         )
2228     def testNetworkElementCaching(self):
2229         self.assertNotIn("broadcast_address", self.ipv4_network._cache)
2230         self.assertNotIn("hostmask", self.ipv4_network._cache)
2231         self.assertEqual(
2232             self.ipv4_network.broadcast_address, ipaddress.IPv4Address("1.2.3.255")
2233         )
2234         self.assertEqual(self.ipv4_network.hostmask, ipaddress.IPv4Address("0.0.0.255"))
2235         self.assertIn("broadcast_address", self.ipv4_network._cache)
2236         self.assertIn("hostmask", self.ipv4_network._cache)
2237         self.assertNotIn("broadcast_address", self.ipv6_network._cache)
2238         self.assertNotIn("hostmask", self.ipv6_network._cache)
2239         self.assertEqual(
2240             self.ipv6_network.network_address,
2241             ipaddress.IPv6Address("2001:658:22a:cafe::"),
2242         )
2243         self.assertEqual(
2244             self.ipv6_interface.network.network_address,
2245             ipaddress.IPv6Address("2001:658:22a:cafe::"),
2246         )
2247         self.assertEqual(
2248             self.ipv6_network.broadcast_address,
2249             ipaddress.IPv6Address("2001:658:22a:cafe:ffff:ffff:ffff:ffff"),
2250         )
2251         self.assertEqual(
2252             self.ipv6_network.hostmask, ipaddress.IPv6Address("::ffff:ffff:ffff:ffff")
2253         )
2254         self.assertEqual(
2255             self.ipv6_interface.network.broadcast_address,
2256             ipaddress.IPv6Address("2001:658:22a:cafe:ffff:ffff:ffff:ffff"),
2257         )
2258         self.assertEqual(
2259             self.ipv6_interface.network.hostmask,
2260             ipaddress.IPv6Address("::ffff:ffff:ffff:ffff"),
2261         )
2262         self.assertIn("broadcast_address", self.ipv6_network._cache)
2263         self.assertIn("hostmask", self.ipv6_network._cache)
2264         self.assertIn("broadcast_address", self.ipv6_interface.network._cache)
2265         self.assertIn("hostmask", self.ipv6_interface.network._cache)
2266     def testTeredo(self):
2267         server = ipaddress.IPv4Address("65.54.227.120")
2268         client = ipaddress.IPv4Address("192.0.2.45")
2269         teredo_addr = "2001:0000:4136:e378:8000:63bf:3fff:fdd2"
2270         self.assertEqual((server, client), ipaddress.ip_address(teredo_addr).teredo)
2271         bad_addr = "2000::4136:e378:8000:63bf:3fff:fdd2"
2272         self.assertFalse(ipaddress.ip_address(bad_addr).teredo)
2273         bad_addr = "2001:0001:4136:e378:8000:63bf:3fff:fdd2"
2274         self.assertFalse(ipaddress.ip_address(bad_addr).teredo)
2275         teredo_addr = ipaddress.IPv6Address("2001:0:5ef5:79fd:0:59d:a0e5:ba1")
2276         self.assertEqual(
2277             (
2278                 ipaddress.IPv4Address("95.26.244.94"),
2279             ),
2280             teredo_addr<font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.teredo,
2281         )
2282     def testsixtofour(self):
2283         sixtofouraddr = ipaddress.ip_address("2002:ac1d:2d64::1")
2284         bad_addr = ipaddress.ip_address("2000:ac1d:2d64::1")
2285             ipaddress.IPv4Address(</b></font>"172.29.45.100"), sixtofouraddr.sixtofour
2286         )
2287         self.assertFalse(bad_addr.<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>sixtofour)
2288         ipv4_address1 = ipaddress.IPv4Interface("1.2.3.4")
2289         ipv4_address2 = ipaddress.IPv4Interface("2.3.4.5")
2290         self.assertNotEqual(ipv4_address1.__hash__(), ipv4_address2.__hash__(</b></font><font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>))
2291     def testV6HashIsNotConstant(self):
2292         ipv6_address1 = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:1")
2293         ipv6_address2 = ipaddress.IPv6Interface("2001:658:22a:cafe:200:0:0:2")
2294         self.assertNotEqual(ipv6_address1.__hash__(), ipv6_address2.__hash__(</b></font>))
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
