<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for network_info.py &amp; mac_shadow.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for network_info.py &amp; mac_shadow.py
      </h3>
<h1 align="center">
        5.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>network_info.py (9.090909%)<th>mac_shadow.py (3.6253777%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(6-20)<td><a href="#" name="0">(16-29)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>network_info.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>import logging
2 import salt.utils.beacons
3 try:
4     import salt.utils.psutil_compat as psutil
5     HAS_PSUTIL = True
6 except ImportError:
7     HAS_PSUTIL = False
8 log = logging.getLogger(__name__)
9 __virtualname__ =</b></font> "network_info"
10 __attrs = [
11     "bytes_sent",
12     "bytes_recv",
13     "packets_sent",
14     "packets_recv",
15     "errin",
16     "errout",
17     "dropin",
18     "dropout",
19 ]
20 def _to_list(obj):
21     ret = {}
22     for attr in __attrs:
23         if hasattr(obj, attr):
24             ret[attr] = getattr(obj, attr)
25     return ret
26 def __virtual__():
27     if not HAS_PSUTIL:
28         err_msg = "psutil not available"
29         log.error("Unable to load %s beacon: %s", __virtualname__, err_msg)
30         return False, err_msg
31     return __virtualname__
32 def validate(config):
33     VALID_ITEMS = [
34         "type",
35         "bytes_sent",
36         "bytes_recv",
37         "packets_sent",
38         "packets_recv",
39         "errin",
40         "errout",
41         "dropin",
42         "dropout",
43     ]
44     if not isinstance(config, list):
45         return False, "Configuration for network_info beacon must be a list."
46     else:
47         config = salt.utils.beacons.list_to_dict(config)
48         for item in config.get("interfaces", {}):
49             if not isinstance(config["interfaces"][item], dict):
50                 return (
51                     False,
52                     "Configuration for network_info beacon must "
53                     "be a list of dictionaries.",
54                 )
55             else:
56                 if not any(j in VALID_ITEMS for j in config["interfaces"][item]):
57                     return (
58                         False,
59                         "Invalid configuration item in Beacon configuration.",
60                     )
61     return True, "Valid beacon configuration"
62 def beacon(config):
63     ret = []
64     config = salt.utils.beacons.list_to_dict(config)
65     log.debug("psutil.net_io_counters %s", psutil.net_io_counters)
66     _stats = psutil.net_io_counters(pernic=True)
67     log.debug("_stats %s", _stats)
68     for interface in config.get("interfaces", {}):
69         if interface in _stats:
70             interface_config = config["interfaces"][interface]
71             _if_stats = _stats[interface]
72             _diff = False
73             for attr in __attrs:
74                 if attr in interface_config:
75                     if (
76                         "type" in interface_config
77                         and interface_config["type"] == "equal"
78                     ):
79                         if getattr(_if_stats, attr, None) == int(
80                             interface_config[attr]
81                         ):
82                             _diff = True
83                     elif (
84                         "type" in interface_config
85                         and interface_config["type"] == "greater"
86                     ):
87                         if getattr(_if_stats, attr, None) &gt; int(interface_config[attr]):
88                             _diff = True
89                         else:
90                             log.debug("attr %s", getattr(_if_stats, attr, None))
91                     else:
92                         if getattr(_if_stats, attr, None) == int(
93                             interface_config[attr]
94                         ):
95                             _diff = True
96             if _diff:
97                 ret.append(
98                     {"interface": interface, "network_info": _to_list(_if_stats)}
99                 )
100     return ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>mac_shadow.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import salt.utils.mac_utils
3 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>import salt.utils.platform
4 from salt.exceptions import CommandExecutionError
5 try:
6     import pwd
7     HAS_PWD = True
8 except ImportError:
9     HAS_PWD = False
10 log = logging.getLogger(__name__)  # Start logging
11 __virtualname__ =</b></font> "shadow"
12 def __virtual__():
13     if not salt.utils.platform.is_darwin():
14         return False, "Not macOS"
15     if HAS_PWD:
16         return __virtualname__
17     else:
18         return (False, "The pwd module failed to load.")
19 def _get_account_policy(name):
20     cmd = "pwpolicy -u {} -getpolicy".format(name)
21     try:
22         ret = salt.utils.mac_utils.execute_return_result(cmd)
23     except CommandExecutionError as exc:
24         if "Error: user &lt;{}&gt; not found".format(name) in exc.strerror:
25             raise CommandExecutionError("User not found: {}".format(name))
26         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
27     try:
28         policy_list = ret.split("\n")[1].split(" ")
29         policy_dict = {}
30         for policy in policy_list:
31             if "=" in policy:
32                 key, value = policy.split("=")
33                 policy_dict[key] = value
34         return policy_dict
35     except IndexError:
36         return {}
37 def _set_account_policy(name, policy):
38     cmd = 'pwpolicy -u {} -setpolicy "{}"'.format(name, policy)
39     try:
40         return salt.utils.mac_utils.execute_return_success(cmd)
41     except CommandExecutionError as exc:
42         if "Error: user &lt;{}&gt; not found".format(name) in exc.strerror:
43             raise CommandExecutionError("User not found: {}".format(name))
44         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
45 def _get_account_policy_data_value(name, key):
46     cmd = "dscl . -readpl /Users/{} accountPolicyData {}".format(name, key)
47     try:
48         ret = salt.utils.mac_utils.execute_return_result(cmd)
49     except CommandExecutionError as exc:
50         if "eDSUnknownNodeName" in exc.strerror:
51             raise CommandExecutionError("User not found: {}".format(name))
52         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
53     return ret
54 def _convert_to_datetime(unix_timestamp):
55     try:
56         unix_timestamp = float(unix_timestamp)
57         return datetime.fromtimestamp(unix_timestamp).strftime("%Y-%m-%d %H:%M:%S")
58     except (ValueError, TypeError):
59         return "Invalid Timestamp"
60 def info(name):
61     try:
62         data = pwd.getpwnam(name)
63         return {
64             "name": data.pw_name,
65             "passwd": data.pw_passwd,
66             "account_created": get_account_created(name),
67             "login_failed_count": get_login_failed_count(name),
68             "login_failed_last": get_login_failed_last(name),
69             "lstchg": get_last_change(name),
70             "max": get_maxdays(name),
71             "expire": get_expire(name),
72             "change": get_change(name),
73             "min": "Unavailable",
74             "warn": "Unavailable",
75             "inact": "Unavailable",
76         }
77     except KeyError:
78         log.debug("User not found: %s", name)
79         return {
80             "name": "",
81             "passwd": "",
82             "account_created": "",
83             "login_failed_count": "",
84             "login_failed_last": "",
85             "lstchg": "",
86             "max": "",
87             "expire": "",
88             "change": "",
89             "min": "",
90             "warn": "",
91             "inact": "",
92         }
93 def get_account_created(name):
94     ret = _get_account_policy_data_value(name, "creationTime")
95     unix_timestamp = salt.utils.mac_utils.parse_return(ret)
96     date_text = _convert_to_datetime(unix_timestamp)
97     return date_text
98 def get_last_change(name):
99     ret = _get_account_policy_data_value(name, "passwordLastSetTime")
100     unix_timestamp = salt.utils.mac_utils.parse_return(ret)
101     date_text = _convert_to_datetime(unix_timestamp)
102     return date_text
103 def get_login_failed_count(name):
104     ret = _get_account_policy_data_value(name, "failedLoginCount")
105     return salt.utils.mac_utils.parse_return(ret)
106 def get_login_failed_last(name):
107     ret = _get_account_policy_data_value(name, "failedLoginTimestamp")
108     unix_timestamp = salt.utils.mac_utils.parse_return(ret)
109     date_text = _convert_to_datetime(unix_timestamp)
110     return date_text
111 def set_maxdays(name, days):
112     minutes = days * 24 * 60
113     _set_account_policy(name, "maxMinutesUntilChangePassword={}".format(minutes))
114     return get_maxdays(name) == days
115 def get_maxdays(name):
116     policies = _get_account_policy(name)
117     if "maxMinutesUntilChangePassword" in policies:
118         max_minutes = policies["maxMinutesUntilChangePassword"]
119         return int(max_minutes) / 24 / 60
120     return 0
121 def set_mindays(name, days):
122     return False
123 def set_inactdays(name, days):
124     return False
125 def set_warndays(name, days):
126     return False
127 def set_change(name, date):
128     _set_account_policy(name, "usingExpirationDate=1 expirationDateGMT={}".format(date))
129     return get_change(name) == date
130 def get_change(name):
131     policies = _get_account_policy(name)
132     if "expirationDateGMT" in policies:
133         return policies["expirationDateGMT"]
134     return "Value not set"
135 def set_expire(name, date):
136     _set_account_policy(
137         name, "usingHardExpirationDate=1 hardExpireDateGMT={}".format(date)
138     )
139     return get_expire(name) == date
140 def get_expire(name):
141     policies = _get_account_policy(name)
142     if "hardExpireDateGMT" in policies:
143         return policies["hardExpireDateGMT"]
144     return "Value not set"
145 def del_password(name):
146     cmd = "dscl . -passwd /Users/{} ''".format(name)
147     try:
148         salt.utils.mac_utils.execute_return_success(cmd)
149     except CommandExecutionError as exc:
150         if "eDSUnknownNodeName" in exc.strerror:
151             raise CommandExecutionError("User not found: {}".format(name))
152         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
153     cmd = "dscl . -create /Users/{} Password '*'".format(name)
154     salt.utils.mac_utils.execute_return_success(cmd)
155     return info(name)["passwd"] == "*"
156 def set_password(name, password):
157     cmd = "dscl . -passwd /Users/{} '{}'".format(name, password)
158     try:
159         salt.utils.mac_utils.execute_return_success(cmd)
160     except CommandExecutionError as exc:
161         if "eDSUnknownNodeName" in exc.strerror:
162             raise CommandExecutionError("User not found: {}".format(name))
163         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
164     return True
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
