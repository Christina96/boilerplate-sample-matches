<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for network_info.py &amp; mac_shadow.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for network_info.py &amp; mac_shadow.py
      </h3>
<h1 align="center">
        5.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>network_info.py (9.090909%)<th>mac_shadow.py (3.6253777%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(6-20)<td><a href="#" name="0">(16-29)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>network_info.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>import logging
2 import salt.utils.beacons
3 try:
4     import salt.utils.psutil_compat as psutil
5     HAS_PSUTIL = True
6 except ImportError:
7     HAS_PSUTIL = False
8 log = logging.getLogger(__name__)
9 __virtualname__ =</b></font> "network_info"
10 __attrs = [
11     "bytes_sent",
12     "bytes_recv",
13     "packets_sent",
14     "packets_recv",
15     "errin",
16     "errout",
17     "dropin",
18     "dropout",
19 ]
20 def _to_list(obj):
21     ret = {}
22     for attr in __attrs:
23         if hasattr(obj, attr):
24             ret[attr] = getattr(obj, attr)
25     return ret
26 def __virtual__():
27     if not HAS_PSUTIL:
28         err_msg = "psutil not available"
29         log.error("Unable to load %s beacon: %s", __virtualname__, err_msg)
30         return False, err_msg
31     return __virtualname__
32 def validate(config):
33     VALID_ITEMS = [
34         "type",
35         "bytes_sent",
36         "bytes_recv",
37         "packets_sent",
38         "packets_recv",
39         "errin",
40         "errout",
41         "dropin",
42         "dropout",
43     ]
44     if not isinstance(config, list):
45         return False, "Configuration for network_info beacon must be a list."
46     else:
47         config = salt.utils.beacons.list_to_dict(config)
48         for item in config.get("interfaces", {}):
49             if not isinstance(config["interfaces"][item], dict):
50                 return (
51                     False,
52                     "Configuration for network_info beacon must "
53                     "be a list of dictionaries.",
54                 )
55             else:
56                 if not any(j in VALID_ITEMS for j in config["interfaces"][item]):
57                     return (
58                         False,
59                         "Invalid configuration item in Beacon configuration.",
60                     )
61     return True, "Valid beacon configuration"
62 def beacon(config):
63     ret = []
64     config = salt.utils.beacons.list_to_dict(config)
65     log.debug("psutil.net_io_counters %s", psutil.net_io_counters)
66     _stats = psutil.net_io_counters(pernic=True)
67     log.debug("_stats %s", _stats)
68     for interface in config.get("interfaces", {}):
69         if interface in _stats:
70             interface_config = config["interfaces"][interface]
71             _if_stats = _stats[interface]
72             _diff = False
73             for attr in __attrs:
74                 if attr in interface_config:
75                     if (
76                         "type" in interface_config
77                         and interface_config["type"] == "equal"
78                     ):
79                         if getattr(_if_stats, attr, None) == int(
80                             interface_config[attr]
81                         ):
82                             _diff = True
83                     elif (
84                         "type" in interface_config
85                         and interface_config["type"] == "greater"
86                     ):
87                         if getattr(_if_stats, attr, None) &gt; int(interface_config[attr]):
88                             _diff = True
89                         else:
90                             log.debug("attr %s", getattr(_if_stats, attr, None))
91                     else:
92                         if getattr(_if_stats, attr, None) == int(
93                             interface_config[attr]
94                         ):
95                             _diff = True
96             if _diff:
97                 ret.append(
98                     {"interface": interface, "network_info": _to_list(_if_stats)}
99                 )
100     return ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>mac_shadow.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 <a name="0"></a>from datetime import datetime
3 import salt.utils.mac_utils
4 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>import salt.utils.platform
5 from salt.exceptions import CommandExecutionError
6 try:
7     import pwd
8     HAS_PWD = True
9 except ImportError:
10     HAS_PWD = False
11 log = logging.getLogger(__name__)  # Start logging
12 __virtualname__ =</b></font> "shadow"
13 def __virtual__():
14     if not salt.utils.platform.is_darwin():
15         return False, "Not macOS"
16     if HAS_PWD:
17         return __virtualname__
18     else:
19         return (False, "The pwd module failed to load.")
20 def _get_account_policy(name):
21     cmd = "pwpolicy -u {} -getpolicy".format(name)
22     try:
23         ret = salt.utils.mac_utils.execute_return_result(cmd)
24     except CommandExecutionError as exc:
25         if "Error: user &lt;{}&gt; not found".format(name) in exc.strerror:
26             raise CommandExecutionError("User not found: {}".format(name))
27         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
28     try:
29         policy_list = ret.split("\n")[1].split(" ")
30         policy_dict = {}
31         for policy in policy_list:
32             if "=" in policy:
33                 key, value = policy.split("=")
34                 policy_dict[key] = value
35         return policy_dict
36     except IndexError:
37         return {}
38 def _set_account_policy(name, policy):
39     cmd = 'pwpolicy -u {} -setpolicy "{}"'.format(name, policy)
40     try:
41         return salt.utils.mac_utils.execute_return_success(cmd)
42     except CommandExecutionError as exc:
43         if "Error: user &lt;{}&gt; not found".format(name) in exc.strerror:
44             raise CommandExecutionError("User not found: {}".format(name))
45         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
46 def _get_account_policy_data_value(name, key):
47     cmd = "dscl . -readpl /Users/{} accountPolicyData {}".format(name, key)
48     try:
49         ret = salt.utils.mac_utils.execute_return_result(cmd)
50     except CommandExecutionError as exc:
51         if "eDSUnknownNodeName" in exc.strerror:
52             raise CommandExecutionError("User not found: {}".format(name))
53         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
54     return ret
55 def _convert_to_datetime(unix_timestamp):
56     try:
57         unix_timestamp = float(unix_timestamp)
58         return datetime.fromtimestamp(unix_timestamp).strftime("%Y-%m-%d %H:%M:%S")
59     except (ValueError, TypeError):
60         return "Invalid Timestamp"
61 def info(name):
62     try:
63         data = pwd.getpwnam(name)
64         return {
65             "name": data.pw_name,
66             "passwd": data.pw_passwd,
67             "account_created": get_account_created(name),
68             "login_failed_count": get_login_failed_count(name),
69             "login_failed_last": get_login_failed_last(name),
70             "lstchg": get_last_change(name),
71             "max": get_maxdays(name),
72             "expire": get_expire(name),
73             "change": get_change(name),
74             "min": "Unavailable",
75             "warn": "Unavailable",
76             "inact": "Unavailable",
77         }
78     except KeyError:
79         log.debug("User not found: %s", name)
80         return {
81             "name": "",
82             "passwd": "",
83             "account_created": "",
84             "login_failed_count": "",
85             "login_failed_last": "",
86             "lstchg": "",
87             "max": "",
88             "expire": "",
89             "change": "",
90             "min": "",
91             "warn": "",
92             "inact": "",
93         }
94 def get_account_created(name):
95     ret = _get_account_policy_data_value(name, "creationTime")
96     unix_timestamp = salt.utils.mac_utils.parse_return(ret)
97     date_text = _convert_to_datetime(unix_timestamp)
98     return date_text
99 def get_last_change(name):
100     ret = _get_account_policy_data_value(name, "passwordLastSetTime")
101     unix_timestamp = salt.utils.mac_utils.parse_return(ret)
102     date_text = _convert_to_datetime(unix_timestamp)
103     return date_text
104 def get_login_failed_count(name):
105     ret = _get_account_policy_data_value(name, "failedLoginCount")
106     return salt.utils.mac_utils.parse_return(ret)
107 def get_login_failed_last(name):
108     ret = _get_account_policy_data_value(name, "failedLoginTimestamp")
109     unix_timestamp = salt.utils.mac_utils.parse_return(ret)
110     date_text = _convert_to_datetime(unix_timestamp)
111     return date_text
112 def set_maxdays(name, days):
113     minutes = days * 24 * 60
114     _set_account_policy(name, "maxMinutesUntilChangePassword={}".format(minutes))
115     return get_maxdays(name) == days
116 def get_maxdays(name):
117     policies = _get_account_policy(name)
118     if "maxMinutesUntilChangePassword" in policies:
119         max_minutes = policies["maxMinutesUntilChangePassword"]
120         return int(max_minutes) / 24 / 60
121     return 0
122 def set_mindays(name, days):
123     return False
124 def set_inactdays(name, days):
125     return False
126 def set_warndays(name, days):
127     return False
128 def set_change(name, date):
129     _set_account_policy(name, "usingExpirationDate=1 expirationDateGMT={}".format(date))
130     return get_change(name) == date
131 def get_change(name):
132     policies = _get_account_policy(name)
133     if "expirationDateGMT" in policies:
134         return policies["expirationDateGMT"]
135     return "Value not set"
136 def set_expire(name, date):
137     _set_account_policy(
138         name, "usingHardExpirationDate=1 hardExpireDateGMT={}".format(date)
139     )
140     return get_expire(name) == date
141 def get_expire(name):
142     policies = _get_account_policy(name)
143     if "hardExpireDateGMT" in policies:
144         return policies["hardExpireDateGMT"]
145     return "Value not set"
146 def del_password(name):
147     cmd = "dscl . -passwd /Users/{} ''".format(name)
148     try:
149         salt.utils.mac_utils.execute_return_success(cmd)
150     except CommandExecutionError as exc:
151         if "eDSUnknownNodeName" in exc.strerror:
152             raise CommandExecutionError("User not found: {}".format(name))
153         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
154     cmd = "dscl . -create /Users/{} Password '*'".format(name)
155     salt.utils.mac_utils.execute_return_success(cmd)
156     return info(name)["passwd"] == "*"
157 def set_password(name, password):
158     cmd = "dscl . -passwd /Users/{} '{}'".format(name, password)
159     try:
160         salt.utils.mac_utils.execute_return_success(cmd)
161     except CommandExecutionError as exc:
162         if "eDSUnknownNodeName" in exc.strerror:
163             raise CommandExecutionError("User not found: {}".format(name))
164         raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
165     return True
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
