<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for network_info.py &amp; mac_shadow.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for network_info.py &amp; mac_shadow.py
      </h3>
<h1 align="center">
        5.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>network_info.py (9.090909%)<th>mac_shadow.py (3.6253777%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(6-20)<td><a href="#" name="0">(16-29)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>network_info.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>import logging
import salt.utils.beacons
try:
    import salt.utils.psutil_compat as psutil
    HAS_PSUTIL = True
except ImportError:
    HAS_PSUTIL = False
log = logging.getLogger(__name__)
__virtualname__ =</b></font> "network_info"
__attrs = [
    "bytes_sent",
    "bytes_recv",
    "packets_sent",
    "packets_recv",
    "errin",
    "errout",
    "dropin",
    "dropout",
]
def _to_list(obj):
    ret = {}
    for attr in __attrs:
        if hasattr(obj, attr):
            ret[attr] = getattr(obj, attr)
    return ret
def __virtual__():
    if not HAS_PSUTIL:
        err_msg = "psutil not available"
        log.error("Unable to load %s beacon: %s", __virtualname__, err_msg)
        return False, err_msg
    return __virtualname__
def validate(config):
    VALID_ITEMS = [
        "type",
        "bytes_sent",
        "bytes_recv",
        "packets_sent",
        "packets_recv",
        "errin",
        "errout",
        "dropin",
        "dropout",
    ]
    if not isinstance(config, list):
        return False, "Configuration for network_info beacon must be a list."
    else:
        config = salt.utils.beacons.list_to_dict(config)
        for item in config.get("interfaces", {}):
            if not isinstance(config["interfaces"][item], dict):
                return (
                    False,
                    "Configuration for network_info beacon must "
                    "be a list of dictionaries.",
                )
            else:
                if not any(j in VALID_ITEMS for j in config["interfaces"][item]):
                    return (
                        False,
                        "Invalid configuration item in Beacon configuration.",
                    )
    return True, "Valid beacon configuration"
def beacon(config):
    ret = []
    config = salt.utils.beacons.list_to_dict(config)
    log.debug("psutil.net_io_counters %s", psutil.net_io_counters)
    _stats = psutil.net_io_counters(pernic=True)
    log.debug("_stats %s", _stats)
    for interface in config.get("interfaces", {}):
        if interface in _stats:
            interface_config = config["interfaces"][interface]
            _if_stats = _stats[interface]
            _diff = False
            for attr in __attrs:
                if attr in interface_config:
                    if (
                        "type" in interface_config
                        and interface_config["type"] == "equal"
                    ):
                        if getattr(_if_stats, attr, None) == int(
                            interface_config[attr]
                        ):
                            _diff = True
                    elif (
                        "type" in interface_config
                        and interface_config["type"] == "greater"
                    ):
                        if getattr(_if_stats, attr, None) &gt; int(interface_config[attr]):
                            _diff = True
                        else:
                            log.debug("attr %s", getattr(_if_stats, attr, None))
                    else:
                        if getattr(_if_stats, attr, None) == int(
                            interface_config[attr]
                        ):
                            _diff = True
            if _diff:
                ret.append(
                    {"interface": interface, "network_info": _to_list(_if_stats)}
                )
    return ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>mac_shadow.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import logging
<a name="0"></a>from datetime import datetime
import salt.utils.mac_utils
<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>import salt.utils.platform
from salt.exceptions import CommandExecutionError
try:
    import pwd
    HAS_PWD = True
except ImportError:
    HAS_PWD = False
log = logging.getLogger(__name__)  # Start logging
__virtualname__ =</b></font> "shadow"
def __virtual__():
    if not salt.utils.platform.is_darwin():
        return False, "Not macOS"
    if HAS_PWD:
        return __virtualname__
    else:
        return (False, "The pwd module failed to load.")
def _get_account_policy(name):
    cmd = "pwpolicy -u {} -getpolicy".format(name)
    try:
        ret = salt.utils.mac_utils.execute_return_result(cmd)
    except CommandExecutionError as exc:
        if "Error: user &lt;{}&gt; not found".format(name) in exc.strerror:
            raise CommandExecutionError("User not found: {}".format(name))
        raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
    try:
        policy_list = ret.split("\n")[1].split(" ")
        policy_dict = {}
        for policy in policy_list:
            if "=" in policy:
                key, value = policy.split("=")
                policy_dict[key] = value
        return policy_dict
    except IndexError:
        return {}
def _set_account_policy(name, policy):
    cmd = 'pwpolicy -u {} -setpolicy "{}"'.format(name, policy)
    try:
        return salt.utils.mac_utils.execute_return_success(cmd)
    except CommandExecutionError as exc:
        if "Error: user &lt;{}&gt; not found".format(name) in exc.strerror:
            raise CommandExecutionError("User not found: {}".format(name))
        raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
def _get_account_policy_data_value(name, key):
    cmd = "dscl . -readpl /Users/{} accountPolicyData {}".format(name, key)
    try:
        ret = salt.utils.mac_utils.execute_return_result(cmd)
    except CommandExecutionError as exc:
        if "eDSUnknownNodeName" in exc.strerror:
            raise CommandExecutionError("User not found: {}".format(name))
        raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
    return ret
def _convert_to_datetime(unix_timestamp):
    try:
        unix_timestamp = float(unix_timestamp)
        return datetime.fromtimestamp(unix_timestamp).strftime("%Y-%m-%d %H:%M:%S")
    except (ValueError, TypeError):
        return "Invalid Timestamp"
def info(name):
    try:
        data = pwd.getpwnam(name)
        return {
            "name": data.pw_name,
            "passwd": data.pw_passwd,
            "account_created": get_account_created(name),
            "login_failed_count": get_login_failed_count(name),
            "login_failed_last": get_login_failed_last(name),
            "lstchg": get_last_change(name),
            "max": get_maxdays(name),
            "expire": get_expire(name),
            "change": get_change(name),
            "min": "Unavailable",
            "warn": "Unavailable",
            "inact": "Unavailable",
        }
    except KeyError:
        log.debug("User not found: %s", name)
        return {
            "name": "",
            "passwd": "",
            "account_created": "",
            "login_failed_count": "",
            "login_failed_last": "",
            "lstchg": "",
            "max": "",
            "expire": "",
            "change": "",
            "min": "",
            "warn": "",
            "inact": "",
        }
def get_account_created(name):
    ret = _get_account_policy_data_value(name, "creationTime")
    unix_timestamp = salt.utils.mac_utils.parse_return(ret)
    date_text = _convert_to_datetime(unix_timestamp)
    return date_text
def get_last_change(name):
    ret = _get_account_policy_data_value(name, "passwordLastSetTime")
    unix_timestamp = salt.utils.mac_utils.parse_return(ret)
    date_text = _convert_to_datetime(unix_timestamp)
    return date_text
def get_login_failed_count(name):
    ret = _get_account_policy_data_value(name, "failedLoginCount")
    return salt.utils.mac_utils.parse_return(ret)
def get_login_failed_last(name):
    ret = _get_account_policy_data_value(name, "failedLoginTimestamp")
    unix_timestamp = salt.utils.mac_utils.parse_return(ret)
    date_text = _convert_to_datetime(unix_timestamp)
    return date_text
def set_maxdays(name, days):
    minutes = days * 24 * 60
    _set_account_policy(name, "maxMinutesUntilChangePassword={}".format(minutes))
    return get_maxdays(name) == days
def get_maxdays(name):
    policies = _get_account_policy(name)
    if "maxMinutesUntilChangePassword" in policies:
        max_minutes = policies["maxMinutesUntilChangePassword"]
        return int(max_minutes) / 24 / 60
    return 0
def set_mindays(name, days):
    return False
def set_inactdays(name, days):
    return False
def set_warndays(name, days):
    return False
def set_change(name, date):
    _set_account_policy(name, "usingExpirationDate=1 expirationDateGMT={}".format(date))
    return get_change(name) == date
def get_change(name):
    policies = _get_account_policy(name)
    if "expirationDateGMT" in policies:
        return policies["expirationDateGMT"]
    return "Value not set"
def set_expire(name, date):
    _set_account_policy(
        name, "usingHardExpirationDate=1 hardExpireDateGMT={}".format(date)
    )
    return get_expire(name) == date
def get_expire(name):
    policies = _get_account_policy(name)
    if "hardExpireDateGMT" in policies:
        return policies["hardExpireDateGMT"]
    return "Value not set"
def del_password(name):
    cmd = "dscl . -passwd /Users/{} ''".format(name)
    try:
        salt.utils.mac_utils.execute_return_success(cmd)
    except CommandExecutionError as exc:
        if "eDSUnknownNodeName" in exc.strerror:
            raise CommandExecutionError("User not found: {}".format(name))
        raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
    cmd = "dscl . -create /Users/{} Password '*'".format(name)
    salt.utils.mac_utils.execute_return_success(cmd)
    return info(name)["passwd"] == "*"
def set_password(name, password):
    cmd = "dscl . -passwd /Users/{} '{}'".format(name, password)
    try:
        salt.utils.mac_utils.execute_return_success(cmd)
    except CommandExecutionError as exc:
        if "eDSUnknownNodeName" in exc.strerror:
            raise CommandExecutionError("User not found: {}".format(name))
        raise CommandExecutionError("Unknown error: {}".format(exc.strerror))
    return True
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
