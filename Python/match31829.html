<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_hosts.py &amp; test_restartcheck_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_hosts.py &amp; test_restartcheck_1.py
      </h3>
<h1 align="center">
        7.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_hosts.py (8.791209%)<th>test_restartcheck_1.py (6.8965516%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(287-294)<td><a href="#" name="0">(29-38)</a><td align="center"><font color="#ff0000">14</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(123-125)<td><a href="#" name="1">(54-61)</a><td align="center"><font color="#ec0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(7-26)<td><a href="#" name="2">(5-23)</a><td align="center"><font color="#ec0000">13</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_hosts.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <a name="2"></a>
2 import io
3 <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>import salt.modules.hosts as hosts
4 import salt.utils.data
5 import salt.utils.platform
6 import salt.utils.stringutils
7 from tests.support.mixins import LoaderModuleMockMixin
8 from tests.support.mock import MagicMock, mock_open, patch
9 from tests.support.unit import TestCase
10 class HostsTestCase(TestCase, LoaderModuleMockMixin):
11     def setup_loader_modules(self):
12         return {hosts: {}}
13     def</b></font> test_list_hosts(self):
14         with patch(
15             "salt.modules.hosts._list_hosts",
16             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
17         ):
18             self.assertDictEqual(
19                 {"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}, hosts.list_hosts()
20             )
21     def test_get_ip(self):
22         with patch(
23             "salt.modules.hosts._list_hosts",
24             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
25         ):
26             self.assertEqual("10.10.10.10", hosts.get_ip("Salt1"))
27             self.assertEqual("", hosts.get_ip("Salt3"))
28     def test_get_ip_none(self):
29         with patch("salt.modules.hosts._list_hosts", MagicMock(return_value="")):
30             self.assertEqual("", hosts.get_ip("Salt1"))
31     def test_get_alias(self):
32         with patch(
33             "salt.modules.hosts._list_hosts",
34             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
35         ):
36             self.assertListEqual(["Salt1", "Salt2"], hosts.get_alias("10.10.10.10"))
37     def test_get_alias_none(self):
38         with patch(
39             "salt.modules.hosts._list_hosts",
40             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
41         ):
42             self.assertListEqual([], hosts.get_alias("10.10.10.11"))
43     def test_has_pair(self):
44         with patch(
45             "salt.modules.hosts._list_hosts",
46             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
47         ):
48             self.assertTrue(hosts.has_pair("10.10.10.10", "Salt1"))
49             self.assertFalse(hosts.has_pair("10.10.10.10", "Salt3"))
50     def test_set_host(self):
51         hosts_file = "/etc/hosts"
52         if salt.utils.platform.is_windows():
53             hosts_file = r"C:\Windows\System32\Drivers\etc\hosts"
54         with patch(
55             "salt.modules.hosts.__get_hosts_filename",
56             MagicMock(return_value=hosts_file),
57         ), patch("os.path.isfile", MagicMock(return_value=False)), patch.dict(
58             hosts.__salt__, {"config.option": MagicMock(return_value=None)}
59         ):
60             self.assertFalse(hosts.set_host("10.10.10.10", "Salt1"))
61     def test_set_host_true(self):
62         with patch(
63             "salt.modules.hosts.__get_hosts_filename",
64             MagicMock(return_value="/etc/hosts"),
65 <a name="1"></a>        ), patch("os.path.isfile", MagicMock(return_value=True)), patch(
66             "salt.utils.files.fopen", mock_open(b"")
67         ):
68             mock_opt <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=None)
69             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
70                 self.assertTrue(hosts.set_host(</b></font>"10.10.10.10", "Salt1"))
71     def test_set_host_true_remove(self):
72         with patch(
73             "salt.modules.hosts.__get_hosts_filename",
74             MagicMock(return_value="/etc/hosts"),
75         ), patch("os.path.isfile", MagicMock(return_value=True)):
76             data = [
77                 "\n".join(
78                     (
79                         "1.1.1.1 foo.foofoo foo",
80                         "2.2.2.2 bar.barbar bar",
81                         "3.3.3.3 asdf.asdfadsf asdf",
82                         "1.1.1.1 foofoo.foofoo foofoo",
83                     )
84                 )
85             ]
86             class TmpStringIO(io.StringIO):
87                 def __init__(self, fn, mode="r"):
88                     self.mode = mode
89                     initial_value = data[0]
90                     if "w" in self.mode:
91                         initial_value = ""
92                     super().__init__(initial_value)
93                 def __enter__(self):
94                     return self
95                 def __exit__(self, exc_type, exc_value, traceback):
96                     self.close()
97                 def close(self):
98                     if self.getvalue():
99                         data[0] = self.getvalue()
100                     io.StringIO.close(self)
101                 def read(self, *args):
102                     ret = super().read(*args)
103                     if "b" in self.mode:
104                         return salt.utils.stringutils.to_bytes(ret)
105                     else:
106                         return ret
107                 def write(self, s, *args):
108                     if "b" in self.mode:
109                         if not isinstance(s, bytes):
110                             raise TypeError(
111                                 "a bytes-like object is required, not 'str'"
112                             )
113                         return super().write(salt.utils.stringutils.to_str(s), *args)
114                     else:
115                         if not isinstance(s, str):
116                             raise TypeError("write() argument must be str, not bytes")
117                     return super().write(s, *args)
118                 def readlines(self):
119                     ret = super().readlines()
120                     if "b" in self.mode:
121                         return salt.utils.data.encode(ret)
122                     else:
123                         return ret
124                 def writelines(self, lines):
125                     for line in lines:
126                         self.write(line)
127             expected = (
128                 "\n".join(
129                     (
130                         "2.2.2.2 bar.barbar bar",
131                         "3.3.3.3 asdf.asdfadsf asdf",
132                     )
133                 )
134                 + "\n"
135             )
136             with patch("salt.utils.files.fopen", TmpStringIO):
137                 mock_opt = MagicMock(return_value=None)
138                 with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
139                     self.assertTrue(hosts.set_host("1.1.1.1", " "))
140             self.assertEqual(data[0], expected)
141     def test_rm_host(self):
142         hosts_content = (
143             b"# one line comment\n10.10.10.10    Salt1\n9.9.9.9    Salt2   # comment\n"
144         )
145         with patch("salt.utils.files.fopen", mock_open(hosts_content)), patch(
146             "salt.modules.hosts.__get_hosts_filename",
147             MagicMock(return_value="/etc/hosts"),
148         ), patch("salt.modules.hosts.has_pair", MagicMock(return_value=True)), patch(
149             "os.path.isfile", MagicMock(return_value=True)
150         ):
151             mock_opt = MagicMock(return_value=None)
152             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
153                 self.assertTrue(hosts.rm_host("10.10.10.10", "Salt1"))
154     def test_rm_host_false(self):
155         with patch("salt.modules.hosts.has_pair", MagicMock(return_value=False)):
156             self.assertTrue(hosts.rm_host("10.10.10.10", "Salt1"))
157     def test_add_host(self):
158         hosts_file = "/etc/hosts"
159         if salt.utils.platform.is_windows():
160             hosts_file = r"C:\Windows\System32\Drivers\etc\hosts"
161         with patch("salt.utils.files.fopen", mock_open()), patch(
162             "salt.modules.hosts.__get_hosts_filename",
163             MagicMock(return_value=hosts_file),
164         ):
165             mock_opt = MagicMock(return_value=None)
166             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
167                 self.assertTrue(hosts.add_host("10.10.10.10", "Salt1"))
168     def test_add_host_no_file(self):
169         with patch("salt.utils.files.fopen", mock_open()), patch(
170             "os.path.isfile", MagicMock(return_value=False)
171         ):
172             mock_opt = MagicMock(return_value=None)
173             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
174                 self.assertFalse(hosts.add_host("10.10.10.10", "Salt1"))
175     def test_add_host_create_entry(self):
176         with patch("salt.utils.files.fopen", mock_open()), patch(
177 <a name="0"></a>            "os.path.isfile", MagicMock(return_value=True)
178         ):
179             mock_opt = MagicMock(return_value=None)
180             <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
181                 self.assertTrue(hosts.add_host("10.10.10.10", "Salt1"))
182     def test_set_comment(self):
183         hosts_file =</b></font> "/etc/hosts"
184         if salt.utils.platform.is_windows():
185             hosts_file = r"C:\Windows\System32\Drivers\etc\hosts"
186         with patch("salt.utils.files.fopen", mock_open()), patch(
187             "salt.modules.hosts.__get_hosts_filename",
188             MagicMock(return_value=hosts_file),
189         ):
190             mock_opt = MagicMock(return_value=None)
191             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
192                 with patch(
193                     "salt.modules.hosts._list_hosts",
194                     MagicMock(
195                         return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}
196                     ),
197                 ):
198                     self.assertTrue(hosts.set_comment("10.10.10.10", "A comment"))
199                     self.assertFalse(hosts.set_comment("10.10.10.11", "A comment"))
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_restartcheck_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>import os
2 import salt.modules.restartcheck as restartcheck
3 import salt.utils.path
4 from tests.support.mixins import LoaderModuleMockMixin
5 from tests.support.mock import ANY, MagicMock, patch
6 from tests.support.runtests import RUNTIME_VARS
7 from tests.support.unit import TestCase
8 class RestartcheckTestCase(TestCase, LoaderModuleMockMixin):
9     def setup_loader_modules(self):
10         return {restartcheck: {}}
11     def</b></font> test_kernel_versions_debian(self):
12             <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(restartcheck.__salt__, {"cmd.run": mock}):
13                 self.assertListEqual(
14                     restartcheck._kernel_versions_debian(), ["4.9.82-1+deb9u3"]
15                 )
16     def test_kernel_versions_ubuntu(self):
17         mock =</b></font> MagicMock(return_value="  Installed: 4.10.0-42.46")
18         with patch.dict(restartcheck.__grains__, {"os": "Ubuntu"}):
19             with patch.dict(restartcheck.__salt__, {"cmd.run": mock}):
20                 self.assertListEqual(
21                     restartcheck._kernel_versions_debian(),
22                     [
23                         "4.10.0-42.46",
24                         "4.10.0-42-generic #46",
25                         "4.10.0-42-lowlatency #46",
26                     ],
27                 )
28     def test_kernel_versions_redhat(self):
29 <a name="1"></a>        """
30         Test if it return a data structure of the current, in-memory rules
31         mock <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(
32             return_value=(
33                 "kernel-3.10.0-862.el7.x86_64                  Thu Apr 5 00:40:00 2018"
34             )
35         )
36         with patch.dict(restartcheck.__salt__, {"cmd.run": mock}):
37             self.assertListEqual(
38                 restartcheck._kernel_versions_redhat(</b></font>), ["3.10.0-862.el7.x86_64"]
39             )
40     def test_valid_deleted_file_deleted(self):
41         self.assertTrue(restartcheck._valid_deleted_file("/usr/lib/test (deleted)"))
42     def test_valid_deleted_file_psth_inode(self):
43         self.assertTrue(
44             restartcheck._valid_deleted_file("/usr/lib/test (path inode=1)")
45         )
46     def test_valid_deleted_file_var_log(self):
47         self.assertFalse(restartcheck._valid_deleted_file("/var/log/test"))
48         self.assertFalse(restartcheck._valid_deleted_file("/var/log/test (deleted)"))
49         self.assertFalse(
50             restartcheck._valid_deleted_file("/var/log/test (path inode=1)")
51         )
52     def test_valid_deleted_file_var_local_log(self):
53         self.assertFalse(restartcheck._valid_deleted_file("/var/local/log/test"))
54         self.assertFalse(
55             restartcheck._valid_deleted_file("/var/local/log/test (deleted)")
56         )
57         self.assertFalse(
58             restartcheck._valid_deleted_file("/var/local/log/test (path inode=1)")
59         )
60     def test_valid_deleted_file_var_run(self):
61         self.assertFalse(restartcheck._valid_deleted_file("/var/run/test"))
62         self.assertFalse(restartcheck._valid_deleted_file("/var/run/test (deleted)"))
63         self.assertFalse(
64             restartcheck._valid_deleted_file("/var/run/test (path inode=1)")
65         )
66     def test_valid_deleted_file_var_local_run(self):
67         self.assertFalse(restartcheck._valid_deleted_file("/var/local/run/test"))
68         self.assertFalse(
69             restartcheck._valid_deleted_file("/var/local/run/test (deleted)")
70         )
71         self.assertFalse(
72             restartcheck._valid_deleted_file("/var/local/run/test (path inode=1)")
73         )
74     def test_valid_deleted_file_tmp(self):
75         self.assertFalse(restartcheck._valid_deleted_file("/tmp/test"))
76         self.assertFalse(restartcheck._valid_deleted_file("/tmp/test (deleted)"))
77         self.assertFalse(restartcheck._valid_deleted_file("/tmp/test (path inode=1)"))
78     def test_valid_deleted_file_dev_shm(self):
79         self.assertFalse(restartcheck._valid_deleted_file("/dev/shm/test"))
80         self.assertFalse(restartcheck._valid_deleted_file("/dev/shm/test (deleted)"))
81         self.assertFalse(
82             restartcheck._valid_deleted_file("/dev/shm/test (path inode=1)")
83         )
84     def test_valid_deleted_file_run(self):
85         self.assertFalse(restartcheck._valid_deleted_file("/run/test"))
86         self.assertFalse(restartcheck._valid_deleted_file("/run/test (deleted)"))
87         self.assertFalse(restartcheck._valid_deleted_file("/run/test (path inode=1)"))
88     def test_valid_deleted_file_drm(self):
89         self.assertFalse(restartcheck._valid_deleted_file("/drm/test"))
90         self.assertFalse(restartcheck._valid_deleted_file("/drm/test (deleted)"))
91         self.assertFalse(restartcheck._valid_deleted_file("/drm/test (path inode=1)"))
92     def test_valid_deleted_file_var_tmp(self):
93         self.assertFalse(restartcheck._valid_deleted_file("/var/tmp/test"))
94         self.assertFalse(restartcheck._valid_deleted_file("/var/tmp/test (deleted)"))
95         self.assertFalse(
96             restartcheck._valid_deleted_file("/var/tmp/test (path inode=1)")
97         )
98     def test_valid_deleted_file_var_local_tmp(self):
99         self.assertFalse(restartcheck._valid_deleted_file("/var/local/tmp/test"))
100         self.assertFalse(
101             restartcheck._valid_deleted_file("/var/local/tmp/test (deleted)")
102         )
103         self.assertFalse(
104             restartcheck._valid_deleted_file("/var/local/tmp/test (path inode=1)")
105         )
106     def test_valid_deleted_file_dev_zero(self):
107         self.assertFalse(restartcheck._valid_deleted_file("/dev/zero/test"))
108         self.assertFalse(restartcheck._valid_deleted_file("/dev/zero/test (deleted)"))
109         self.assertFalse(
110             restartcheck._valid_deleted_file("/dev/zero/test (path inode=1)")
111         )
112     def test_valid_deleted_file_dev_pts(self):
113         self.assertFalse(restartcheck._valid_deleted_file("/dev/pts/test"))
114         self.assertFalse(restartcheck._valid_deleted_file("/dev/pts/test (deleted)"))
115         self.assertFalse(
116             restartcheck._valid_deleted_file("/dev/pts/test (path inode=1)")
117         )
118     def test_valid_deleted_file_usr_lib_locale(self):
119         self.assertFalse(restartcheck._valid_deleted_file("/usr/lib/locale/test"))
120         self.assertFalse(
121             restartcheck._valid_deleted_file("/usr/lib/locale/test (deleted)")
122         )
123         self.assertFalse(
124             restartcheck._valid_deleted_file("/usr/lib/locale/test (path inode=1)")
125         )
126     def test_valid_deleted_file_home(self):
127         self.assertFalse(restartcheck._valid_deleted_file("/home/test"))
128         self.assertFalse(restartcheck._valid_deleted_file("/home/test (deleted)"))
129         self.assertFalse(restartcheck._valid_deleted_file("/home/test (path inode=1)"))
130     def test_valid_deleted_file_icon_theme_cache(self):
131         self.assertFalse(restartcheck._valid_deleted_file("/dev/test.icon-theme.cache"))
132         self.assertFalse(
133             restartcheck._valid_deleted_file("/dev/test.icon-theme.cache (deleted)")
134         )
135         self.assertFalse(
136             restartcheck._valid_deleted_file(
137                 "/dev/test.icon-theme.cache (path inode=1)"
138             )
139         )
140     def test_valid_deleted_file_var_cache_fontconfig(self):
141         self.assertFalse(restartcheck._valid_deleted_file("/var/cache/fontconfig/test"))
142         self.assertFalse(
143             restartcheck._valid_deleted_file("/var/cache/fontconfig/test (deleted)")
144         )
145         self.assertFalse(
146             restartcheck._valid_deleted_file(
147                 "/var/cache/fontconfig/test (path inode=1)"
148             )
149         )
150     def test_valid_deleted_file_var_lib_nagios3_spool(self):
151         self.assertFalse(
152             restartcheck._valid_deleted_file("/var/lib/nagios3/spool/test")
153         )
154         self.assertFalse(
155             restartcheck._valid_deleted_file("/var/lib/nagios3/spool/test (deleted)")
156         )
157         self.assertFalse(
158             restartcheck._valid_deleted_file(
159                 "/var/lib/nagios3/spool/test (path inode=1)"
160             )
161         )
162     def test_valid_deleted_file_var_lib_nagios3_spool_checkresults(self):
163         self.assertFalse(
164             restartcheck._valid_deleted_file("/var/lib/nagios3/spool/checkresults/test")
165         )
166         self.assertFalse(
167             restartcheck._valid_deleted_file(
168                 "/var/lib/nagios3/spool/checkresults/test (deleted)"
169             )
170         )
171         self.assertFalse(
172             restartcheck._valid_deleted_file(
173                 "/var/lib/nagios3/spool/checkresults/test (path inode=1)"
174             )
175         )
176     def test_valid_deleted_file_var_lib_postgresql(self):
177         self.assertFalse(restartcheck._valid_deleted_file("/var/lib/postgresql/test"))
178         self.assertFalse(
179             restartcheck._valid_deleted_file("/var/lib/postgresql/test (deleted)")
180         )
181         self.assertFalse(
182             restartcheck._valid_deleted_file("/var/lib/postgresql/test (path inode=1)")
183         )
184     def test_valid_deleted_file_var_lib_vdr(self):
185         self.assertFalse(restartcheck._valid_deleted_file("/var/lib/vdr/test"))
186         self.assertFalse(
187             restartcheck._valid_deleted_file("/var/lib/vdr/test (deleted)")
188         )
189         self.assertFalse(
190             restartcheck._valid_deleted_file("/var/lib/vdr/test (path inode=1)")
191         )
192     def test_valid_deleted_file_aio(self):
193         self.assertFalse(restartcheck._valid_deleted_file("/opt/test"))
194         self.assertFalse(restartcheck._valid_deleted_file("/opt/test (deleted)"))
195         self.assertFalse(restartcheck._valid_deleted_file("/opt/test (path inode=1)"))
196         self.assertFalse(restartcheck._valid_deleted_file("/apt/test"))
197         self.assertFalse(restartcheck._valid_deleted_file("/apt/test (deleted)"))
198         self.assertFalse(restartcheck._valid_deleted_file("/apt/test (path inode=1)"))
199         self.assertFalse(restartcheck._valid_deleted_file("/ipt/test"))
200         self.assertFalse(restartcheck._valid_deleted_file("/ipt/test (deleted)"))
201         self.assertFalse(restartcheck._valid_deleted_file("/ipt/test (path inode=1)"))
202         self.assertFalse(restartcheck._valid_deleted_file("/aio/test"))
203         self.assertFalse(restartcheck._valid_deleted_file("/aio/test (deleted)"))
204         self.assertFalse(restartcheck._valid_deleted_file("/aio/test (path inode=1)"))
205     def test_valid_deleted_file_sysv(self):
206         self.assertFalse(restartcheck._valid_deleted_file("/SYSV/test"))
207         self.assertFalse(restartcheck._valid_deleted_file("/SYSV/test (deleted)"))
208         self.assertFalse(restartcheck._valid_deleted_file("/SYSV/test (path inode=1)"))
209     def test_valid_command(self):
210         create_file = os.path.join(RUNTIME_VARS.TMP, "created_file")
211         patch_kernel = patch(
212             "salt.modules.restartcheck._kernel_versions_redhat",
213             return_value=["3.10.0-1127.el7.x86_64"],
214         )
215         services = {
216             "NetworkManager": {"ExecMainPID": 123},
217             "auditd": {"ExecMainPID": 456},
218             "crond": {"ExecMainPID": 789},
219         }
220         patch_salt = patch.dict(
221             restartcheck.__salt__,
222             {
223                 "cmd.run": MagicMock(
224                     return_value="Linux localhost.localdomain 3.10.0-1127.el7.x86_64"
225                 ),
226                 "service.get_running": MagicMock(return_value=list(services.keys())),
227                 "service.show": MagicMock(side_effect=list(services.values())),
228                 "pkg.owner": MagicMock(return_value=""),
229                 "service.available": MagicMock(return_value=True),
230             },
231         )
232         patch_deleted = patch(
233             "salt.modules.restartcheck._deleted_files",
234             MagicMock(
235                 return_value=[
236                     (";touch {};".format(create_file), 123, "/root/ (deleted)")
237                 ]
238             ),
239         )
240         patch_readlink = patch(
241             "os.readlink", return_value="/root/;touch {};".format(create_file)
242         )
243         check_error = True
244         if salt.utils.path.which("repoquery"):
245             check_error = False
246         patch_grains = patch.dict(restartcheck.__grains__, {"os_family": "RedHat"})
247         with patch_kernel, patch_salt, patch_deleted, patch_readlink, patch_grains:
248             if check_error:
249                 with self.assertRaises(FileNotFoundError):
250                     restartcheck.restartcheck()
251             else:
252                 ret = restartcheck.restartcheck()
253                 self.assertIn(
254                     "Found 1 processes using old versions of upgraded files", ret
255                 )
256             self.assertFalse(os.path.exists(create_file))
257     def test_valid_command_b(self):
258         create_file = os.path.join(RUNTIME_VARS.TMP, "created_file")
259         patch_kernel = patch(
260             "salt.modules.restartcheck._kernel_versions_redhat",
261             return_value=["3.10.0-1127.el7.x86_64"],
262         )
263         services = {
264             "NetworkManager": {"ExecMainPID": 123},
265             "auditd": {"ExecMainPID": 456},
266             "crond": {"ExecMainPID": 789},
267         }
268         patch_salt = patch.dict(
269             restartcheck.__salt__,
270             {
271                 "cmd.run": MagicMock(
272                     return_value="Linux localhost.localdomain 3.10.0-1127.el7.x86_64"
273                 ),
274                 "service.get_running": MagicMock(return_value=list(services.keys())),
275                 "service.show": MagicMock(side_effect=list(services.values())),
276                 "pkg.owner": MagicMock(return_value=""),
277                 "service.available": MagicMock(return_value=True),
278             },
279         )
280         patch_deleted = patch(
281             "salt.modules.restartcheck._deleted_files",
282             MagicMock(return_value=[("--admindir tmp dpkg", 123, "/root/ (deleted)")]),
283         )
284         patch_readlink = patch("os.readlink", return_value="--admindir tmp dpkg")
285         popen_mock = MagicMock()
286         popen_mock.return_value.stdout.readline.side_effect = ["/usr/bin\n", ""]
287         patch_popen = patch("subprocess.Popen", popen_mock)
288         patch_grains = patch.dict(restartcheck.__grains__, {"os_family": "RedHat"})
289         with patch_kernel, patch_salt, patch_deleted, patch_readlink, patch_grains, patch_popen:
290             ret = restartcheck.restartcheck()
291             self.assertIn("Found 1 processes using old versions of upgraded files", ret)
292             popen_mock.assert_called_with(
293                 ["repoquery", "-l", "--admindir tmp dpkg"], stdout=ANY
294             )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
