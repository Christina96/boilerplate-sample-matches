<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_hosts.py &amp; test_restartcheck_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_hosts.py &amp; test_restartcheck_1.py
      </h3>
<h1 align="center">
        7.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_hosts.py (8.791209%)<th>test_restartcheck_1.py (6.8965516%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(287-294)<td><a href="#" name="0">(29-38)</a><td align="center"><font color="#ff0000">14</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(123-125)<td><a href="#" name="1">(54-61)</a><td align="center"><font color="#ec0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(7-26)<td><a href="#" name="2">(5-23)</a><td align="center"><font color="#ec0000">13</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_hosts.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import io
2 <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>import salt.modules.hosts as hosts
3 import salt.utils.data
4 import salt.utils.platform
5 import salt.utils.stringutils
6 from tests.support.mixins import LoaderModuleMockMixin
7 from tests.support.mock import MagicMock, mock_open, patch
8 from tests.support.unit import TestCase
9 class HostsTestCase(TestCase, LoaderModuleMockMixin):
10     def setup_loader_modules(self):
11         return {hosts: {}}
12     def</b></font> test_list_hosts(self):
13         with patch(
14             "salt.modules.hosts._list_hosts",
15             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
16         ):
17             self.assertDictEqual(
18                 {"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}, hosts.list_hosts()
19             )
20     def test_get_ip(self):
21         with patch(
22             "salt.modules.hosts._list_hosts",
23             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
24         ):
25             self.assertEqual("10.10.10.10", hosts.get_ip("Salt1"))
26             self.assertEqual("", hosts.get_ip("Salt3"))
27     def test_get_ip_none(self):
28         with patch("salt.modules.hosts._list_hosts", MagicMock(return_value="")):
29             self.assertEqual("", hosts.get_ip("Salt1"))
30     def test_get_alias(self):
31         with patch(
32             "salt.modules.hosts._list_hosts",
33             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
34         ):
35             self.assertListEqual(["Salt1", "Salt2"], hosts.get_alias("10.10.10.10"))
36     def test_get_alias_none(self):
37         with patch(
38             "salt.modules.hosts._list_hosts",
39             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
40         ):
41             self.assertListEqual([], hosts.get_alias("10.10.10.11"))
42     def test_has_pair(self):
43         with patch(
44             "salt.modules.hosts._list_hosts",
45             MagicMock(return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}),
46         ):
47             self.assertTrue(hosts.has_pair("10.10.10.10", "Salt1"))
48             self.assertFalse(hosts.has_pair("10.10.10.10", "Salt3"))
49     def test_set_host(self):
50         hosts_file = "/etc/hosts"
51         if salt.utils.platform.is_windows():
52             hosts_file = r"C:\Windows\System32\Drivers\etc\hosts"
53         with patch(
54             "salt.modules.hosts.__get_hosts_filename",
55             MagicMock(return_value=hosts_file),
56         ), patch("os.path.isfile", MagicMock(return_value=False)), patch.dict(
57             hosts.__salt__, {"config.option": MagicMock(return_value=None)}
58         ):
59             self.assertFalse(hosts.set_host("10.10.10.10", "Salt1"))
60     def test_set_host_true(self):
61         with patch(
62             "salt.modules.hosts.__get_hosts_filename",
63             MagicMock(return_value="/etc/hosts"),
64             "salt.utils.files.fopen", mock_open(b"")
65         ):
66             mock_opt <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= MagicMock(return_value=None)
67             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
68                 self.assertTrue(hosts.set_host(</b></font>"10.10.10.10", "Salt1"))
69     def test_set_host_true_remove(self):
70         with patch(
71             "salt.modules.hosts.__get_hosts_filename",
72             MagicMock(return_value="/etc/hosts"),
73         ), patch("os.path.isfile", MagicMock(return_value=True)):
74             data = [
75                 "\n".join(
76                     (
77                         "1.1.1.1 foo.foofoo foo",
78                         "2.2.2.2 bar.barbar bar",
79                         "3.3.3.3 asdf.asdfadsf asdf",
80                         "1.1.1.1 foofoo.foofoo foofoo",
81                     )
82                 )
83             ]
84             class TmpStringIO(io.StringIO):
85                 def __init__(self, fn, mode="r"):
86                     self.mode = mode
87                     initial_value = data[0]
88                     if "w" in self.mode:
89                         initial_value = ""
90                     super().__init__(initial_value)
91                 def __enter__(self):
92                     return self
93                 def __exit__(self, exc_type, exc_value, traceback):
94                     self.close()
95                 def close(self):
96                     if self.getvalue():
97                         data[0] = self.getvalue()
98                     io.StringIO.close(self)
99                 def read(self, *args):
100                     ret = super().read(*args)
101                     if "b" in self.mode:
102                         return salt.utils.stringutils.to_bytes(ret)
103                     else:
104                         return ret
105                 def write(self, s, *args):
106                     if "b" in self.mode:
107                         if not isinstance(s, bytes):
108                             raise TypeError(
109                                 "a bytes-like object is required, not 'str'"
110                             )
111                         return super().write(salt.utils.stringutils.to_str(s), *args)
112                     else:
113                         if not isinstance(s, str):
114                             raise TypeError("write() argument must be str, not bytes")
115                     return super().write(s, *args)
116                 def readlines(self):
117                     ret = super().readlines()
118                     if "b" in self.mode:
119                         return salt.utils.data.encode(ret)
120                     else:
121                         return ret
122                 def writelines(self, lines):
123                     for line in lines:
124                         self.write(line)
125             expected = (
126                 "\n".join(
127                     (
128                         "2.2.2.2 bar.barbar bar",
129                         "3.3.3.3 asdf.asdfadsf asdf",
130                     )
131                 )
132                 + "\n"
133             )
134             with patch("salt.utils.files.fopen", TmpStringIO):
135                 mock_opt = MagicMock(return_value=None)
136                 with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
137                     self.assertTrue(hosts.set_host("1.1.1.1", " "))
138             self.assertEqual(data[0], expected)
139     def test_rm_host(self):
140         hosts_content = (
141             b"# one line comment\n10.10.10.10    Salt1\n9.9.9.9    Salt2   # comment\n"
142         )
143         with patch("salt.utils.files.fopen", mock_open(hosts_content)), patch(
144             "salt.modules.hosts.__get_hosts_filename",
145             MagicMock(return_value="/etc/hosts"),
146         ), patch("salt.modules.hosts.has_pair", MagicMock(return_value=True)), patch(
147             "os.path.isfile", MagicMock(return_value=True)
148         ):
149             mock_opt = MagicMock(return_value=None)
150             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
151                 self.assertTrue(hosts.rm_host("10.10.10.10", "Salt1"))
152     def test_rm_host_false(self):
153         with patch("salt.modules.hosts.has_pair", MagicMock(return_value=False)):
154             self.assertTrue(hosts.rm_host("10.10.10.10", "Salt1"))
155     def test_add_host(self):
156         hosts_file = "/etc/hosts"
157         if salt.utils.platform.is_windows():
158             hosts_file = r"C:\Windows\System32\Drivers\etc\hosts"
159         with patch("salt.utils.files.fopen", mock_open()), patch(
160             "salt.modules.hosts.__get_hosts_filename",
161             MagicMock(return_value=hosts_file),
162         ):
163             mock_opt = MagicMock(return_value=None)
164             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
165                 self.assertTrue(hosts.add_host("10.10.10.10", "Salt1"))
166     def test_add_host_no_file(self):
167         with patch("salt.utils.files.fopen", mock_open()), patch(
168             "os.path.isfile", MagicMock(return_value=False)
169         ):
170             mock_opt = MagicMock(return_value=None)
171             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
172                 self.assertFalse(hosts.add_host("10.10.10.10", "Salt1"))
173     def test_add_host_create_entry(self):
174         with patch("salt.utils.files.fopen", mock_open()), patch(
175         ):
176             mock_opt = MagicMock(return_value=None)
177             <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
178                 self.assertTrue(hosts.add_host("10.10.10.10", "Salt1"))
179     def test_set_comment(self):
180         hosts_file =</b></font> "/etc/hosts"
181         if salt.utils.platform.is_windows():
182             hosts_file = r"C:\Windows\System32\Drivers\etc\hosts"
183         with patch("salt.utils.files.fopen", mock_open()), patch(
184             "salt.modules.hosts.__get_hosts_filename",
185             MagicMock(return_value=hosts_file),
186         ):
187             mock_opt = MagicMock(return_value=None)
188             with patch.dict(hosts.__salt__, {"config.option": mock_opt}):
189                 with patch(
190                     "salt.modules.hosts._list_hosts",
191                     MagicMock(
192                         return_value={"10.10.10.10": {"aliases": ["Salt1", "Salt2"]}}
193                     ),
194                 ):
195                     self.assertTrue(hosts.set_comment("10.10.10.10", "A comment"))
196                     self.assertFalse(hosts.set_comment("10.10.10.11", "A comment"))
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_restartcheck_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>import os
2 import salt.modules.restartcheck as restartcheck
3 import salt.utils.path
4 from tests.support.mixins import LoaderModuleMockMixin
5 from tests.support.mock import ANY, MagicMock, patch
6 from tests.support.runtests import RUNTIME_VARS
7 from tests.support.unit import TestCase
8 class RestartcheckTestCase(TestCase, LoaderModuleMockMixin):
9     def setup_loader_modules(self):
10         return {restartcheck: {}}
11     def</b></font> test_kernel_versions_debian(self):
12         """
13             <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(restartcheck.__salt__, {"cmd.run": mock}):
14                 self.assertListEqual(
15                     restartcheck._kernel_versions_debian(), ["4.9.82-1+deb9u3"]
16                 )
17     def test_kernel_versions_ubuntu(self):
18         """
19         Test kernel version ubuntu
20         """
21         mock =</b></font> MagicMock(return_value="  Installed: 4.10.0-42.46")
22         with patch.dict(restartcheck.__grains__, {"os": "Ubuntu"}):
23             with patch.dict(restartcheck.__salt__, {"cmd.run": mock}):
24                 self.assertListEqual(
25                     restartcheck._kernel_versions_debian(),
26                     [
27                         "4.10.0-42.46",
28                         "4.10.0-42-generic #46",
29                         "4.10.0-42-lowlatency #46",
30                     ],
31                 )
32     def test_kernel_versions_redhat(self):
33         Test if it return a data structure of the current, in-memory rules
34         """
35         mock <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= MagicMock(
36             return_value=(
37                 "kernel-3.10.0-862.el7.x86_64                  Thu Apr 5 00:40:00 2018"
38             )
39         )
40         with patch.dict(restartcheck.__salt__, {"cmd.run": mock}):
41             self.assertListEqual(
42                 restartcheck._kernel_versions_redhat(</b></font>), ["3.10.0-862.el7.x86_64"]
43             )
44     def test_valid_deleted_file_deleted(self):
45         """
46         Test (deleted) file
47         """
48         self.assertTrue(restartcheck._valid_deleted_file("/usr/lib/test (deleted)"))
49     def test_valid_deleted_file_psth_inode(self):
50         """
51         Test (path inode=1) file
52         """
53         self.assertTrue(
54             restartcheck._valid_deleted_file("/usr/lib/test (path inode=1)")
55         )
56     def test_valid_deleted_file_var_log(self):
57         """
58         Test /var/log/
59         """
60         self.assertFalse(restartcheck._valid_deleted_file("/var/log/test"))
61         self.assertFalse(restartcheck._valid_deleted_file("/var/log/test (deleted)"))
62         self.assertFalse(
63             restartcheck._valid_deleted_file("/var/log/test (path inode=1)")
64         )
65     def test_valid_deleted_file_var_local_log(self):
66         """
67         Test /var/local/log/
68         """
69         self.assertFalse(restartcheck._valid_deleted_file("/var/local/log/test"))
70         self.assertFalse(
71             restartcheck._valid_deleted_file("/var/local/log/test (deleted)")
72         )
73         self.assertFalse(
74             restartcheck._valid_deleted_file("/var/local/log/test (path inode=1)")
75         )
76     def test_valid_deleted_file_var_run(self):
77         """
78         Test /var/run/
79         """
80         self.assertFalse(restartcheck._valid_deleted_file("/var/run/test"))
81         self.assertFalse(restartcheck._valid_deleted_file("/var/run/test (deleted)"))
82         self.assertFalse(
83             restartcheck._valid_deleted_file("/var/run/test (path inode=1)")
84         )
85     def test_valid_deleted_file_var_local_run(self):
86         """
87         Test /var/local/run/
88         """
89         self.assertFalse(restartcheck._valid_deleted_file("/var/local/run/test"))
90         self.assertFalse(
91             restartcheck._valid_deleted_file("/var/local/run/test (deleted)")
92         )
93         self.assertFalse(
94             restartcheck._valid_deleted_file("/var/local/run/test (path inode=1)")
95         )
96     def test_valid_deleted_file_tmp(self):
97         """
98         Test /tmp/
99         """
100         self.assertFalse(restartcheck._valid_deleted_file("/tmp/test"))
101         self.assertFalse(restartcheck._valid_deleted_file("/tmp/test (deleted)"))
102         self.assertFalse(restartcheck._valid_deleted_file("/tmp/test (path inode=1)"))
103     def test_valid_deleted_file_dev_shm(self):
104         """
105         Test /dev/shm/
106         """
107         self.assertFalse(restartcheck._valid_deleted_file("/dev/shm/test"))
108         self.assertFalse(restartcheck._valid_deleted_file("/dev/shm/test (deleted)"))
109         self.assertFalse(
110             restartcheck._valid_deleted_file("/dev/shm/test (path inode=1)")
111         )
112     def test_valid_deleted_file_run(self):
113         """
114         Test /run/
115         """
116         self.assertFalse(restartcheck._valid_deleted_file("/run/test"))
117         self.assertFalse(restartcheck._valid_deleted_file("/run/test (deleted)"))
118         self.assertFalse(restartcheck._valid_deleted_file("/run/test (path inode=1)"))
119     def test_valid_deleted_file_drm(self):
120         """
121         Test /drm/
122         """
123         self.assertFalse(restartcheck._valid_deleted_file("/drm/test"))
124         self.assertFalse(restartcheck._valid_deleted_file("/drm/test (deleted)"))
125         self.assertFalse(restartcheck._valid_deleted_file("/drm/test (path inode=1)"))
126     def test_valid_deleted_file_var_tmp(self):
127         """
128         Test /var/tmp/
129         """
130         self.assertFalse(restartcheck._valid_deleted_file("/var/tmp/test"))
131         self.assertFalse(restartcheck._valid_deleted_file("/var/tmp/test (deleted)"))
132         self.assertFalse(
133             restartcheck._valid_deleted_file("/var/tmp/test (path inode=1)")
134         )
135     def test_valid_deleted_file_var_local_tmp(self):
136         """
137         Test /var/local/tmp/
138         """
139         self.assertFalse(restartcheck._valid_deleted_file("/var/local/tmp/test"))
140         self.assertFalse(
141             restartcheck._valid_deleted_file("/var/local/tmp/test (deleted)")
142         )
143         self.assertFalse(
144             restartcheck._valid_deleted_file("/var/local/tmp/test (path inode=1)")
145         )
146     def test_valid_deleted_file_dev_zero(self):
147         """
148         Test /dev/zero/
149         """
150         self.assertFalse(restartcheck._valid_deleted_file("/dev/zero/test"))
151         self.assertFalse(restartcheck._valid_deleted_file("/dev/zero/test (deleted)"))
152         self.assertFalse(
153             restartcheck._valid_deleted_file("/dev/zero/test (path inode=1)")
154         )
155     def test_valid_deleted_file_dev_pts(self):
156         """
157         Test /dev/pts/
158         """
159         self.assertFalse(restartcheck._valid_deleted_file("/dev/pts/test"))
160         self.assertFalse(restartcheck._valid_deleted_file("/dev/pts/test (deleted)"))
161         self.assertFalse(
162             restartcheck._valid_deleted_file("/dev/pts/test (path inode=1)")
163         )
164     def test_valid_deleted_file_usr_lib_locale(self):
165         """
166         Test /usr/lib/locale/
167         """
168         self.assertFalse(restartcheck._valid_deleted_file("/usr/lib/locale/test"))
169         self.assertFalse(
170             restartcheck._valid_deleted_file("/usr/lib/locale/test (deleted)")
171         )
172         self.assertFalse(
173             restartcheck._valid_deleted_file("/usr/lib/locale/test (path inode=1)")
174         )
175     def test_valid_deleted_file_home(self):
176         """
177         Test /home/
178         """
179         self.assertFalse(restartcheck._valid_deleted_file("/home/test"))
180         self.assertFalse(restartcheck._valid_deleted_file("/home/test (deleted)"))
181         self.assertFalse(restartcheck._valid_deleted_file("/home/test (path inode=1)"))
182     def test_valid_deleted_file_icon_theme_cache(self):
183         """
184         Test /test.icon-theme.cache
185         """
186         self.assertFalse(restartcheck._valid_deleted_file("/dev/test.icon-theme.cache"))
187         self.assertFalse(
188             restartcheck._valid_deleted_file("/dev/test.icon-theme.cache (deleted)")
189         )
190         self.assertFalse(
191             restartcheck._valid_deleted_file(
192                 "/dev/test.icon-theme.cache (path inode=1)"
193             )
194         )
195     def test_valid_deleted_file_var_cache_fontconfig(self):
196         """
197         Test /var/cache/fontconfig/
198         """
199         self.assertFalse(restartcheck._valid_deleted_file("/var/cache/fontconfig/test"))
200         self.assertFalse(
201             restartcheck._valid_deleted_file("/var/cache/fontconfig/test (deleted)")
202         )
203         self.assertFalse(
204             restartcheck._valid_deleted_file(
205                 "/var/cache/fontconfig/test (path inode=1)"
206             )
207         )
208     def test_valid_deleted_file_var_lib_nagios3_spool(self):
209         """
210         Test /var/lib/nagios3/spool/
211         """
212         self.assertFalse(
213             restartcheck._valid_deleted_file("/var/lib/nagios3/spool/test")
214         )
215         self.assertFalse(
216             restartcheck._valid_deleted_file("/var/lib/nagios3/spool/test (deleted)")
217         )
218         self.assertFalse(
219             restartcheck._valid_deleted_file(
220                 "/var/lib/nagios3/spool/test (path inode=1)"
221             )
222         )
223     def test_valid_deleted_file_var_lib_nagios3_spool_checkresults(self):
224         """
225         Test /var/lib/nagios3/spool/checkresults/
226         """
227         self.assertFalse(
228             restartcheck._valid_deleted_file("/var/lib/nagios3/spool/checkresults/test")
229         )
230         self.assertFalse(
231             restartcheck._valid_deleted_file(
232                 "/var/lib/nagios3/spool/checkresults/test (deleted)"
233             )
234         )
235         self.assertFalse(
236             restartcheck._valid_deleted_file(
237                 "/var/lib/nagios3/spool/checkresults/test (path inode=1)"
238             )
239         )
240     def test_valid_deleted_file_var_lib_postgresql(self):
241         """
242         Test /var/lib/postgresql/
243         """
244         self.assertFalse(restartcheck._valid_deleted_file("/var/lib/postgresql/test"))
245         self.assertFalse(
246             restartcheck._valid_deleted_file("/var/lib/postgresql/test (deleted)")
247         )
248         self.assertFalse(
249             restartcheck._valid_deleted_file("/var/lib/postgresql/test (path inode=1)")
250         )
251     def test_valid_deleted_file_var_lib_vdr(self):
252         """
253         Test /var/lib/vdr/
254         """
255         self.assertFalse(restartcheck._valid_deleted_file("/var/lib/vdr/test"))
256         self.assertFalse(
257             restartcheck._valid_deleted_file("/var/lib/vdr/test (deleted)")
258         )
259         self.assertFalse(
260             restartcheck._valid_deleted_file("/var/lib/vdr/test (path inode=1)")
261         )
262     def test_valid_deleted_file_aio(self):
263         """
264         Test /[aio]/
265         """
266         self.assertFalse(restartcheck._valid_deleted_file("/opt/test"))
267         self.assertFalse(restartcheck._valid_deleted_file("/opt/test (deleted)"))
268         self.assertFalse(restartcheck._valid_deleted_file("/opt/test (path inode=1)"))
269         self.assertFalse(restartcheck._valid_deleted_file("/apt/test"))
270         self.assertFalse(restartcheck._valid_deleted_file("/apt/test (deleted)"))
271         self.assertFalse(restartcheck._valid_deleted_file("/apt/test (path inode=1)"))
272         self.assertFalse(restartcheck._valid_deleted_file("/ipt/test"))
273         self.assertFalse(restartcheck._valid_deleted_file("/ipt/test (deleted)"))
274         self.assertFalse(restartcheck._valid_deleted_file("/ipt/test (path inode=1)"))
275         self.assertFalse(restartcheck._valid_deleted_file("/aio/test"))
276         self.assertFalse(restartcheck._valid_deleted_file("/aio/test (deleted)"))
277         self.assertFalse(restartcheck._valid_deleted_file("/aio/test (path inode=1)"))
278     def test_valid_deleted_file_sysv(self):
279         """
280         Test /SYSV/
281         """
282         self.assertFalse(restartcheck._valid_deleted_file("/SYSV/test"))
283         self.assertFalse(restartcheck._valid_deleted_file("/SYSV/test (deleted)"))
284         self.assertFalse(restartcheck._valid_deleted_file("/SYSV/test (path inode=1)"))
285     def test_valid_command(self):
286         """
287         test for CVE-2020-28243
288         """
289         create_file = os.path.join(RUNTIME_VARS.TMP, "created_file")
290         patch_kernel = patch(
291             "salt.modules.restartcheck._kernel_versions_redhat",
292             return_value=["3.10.0-1127.el7.x86_64"],
293         )
294         services = {
295             "NetworkManager": {"ExecMainPID": 123},
296             "auditd": {"ExecMainPID": 456},
297             "crond": {"ExecMainPID": 789},
298         }
299         patch_salt = patch.dict(
300             restartcheck.__salt__,
301             {
302                 "cmd.run": MagicMock(
303                     return_value="Linux localhost.localdomain 3.10.0-1127.el7.x86_64"
304                 ),
305                 "service.get_running": MagicMock(return_value=list(services.keys())),
306                 "service.show": MagicMock(side_effect=list(services.values())),
307                 "pkg.owner": MagicMock(return_value=""),
308                 "service.available": MagicMock(return_value=True),
309             },
310         )
311         patch_deleted = patch(
312             "salt.modules.restartcheck._deleted_files",
313             MagicMock(
314                 return_value=[
315                     (";touch {};".format(create_file), 123, "/root/ (deleted)")
316                 ]
317             ),
318         )
319         patch_readlink = patch(
320             "os.readlink", return_value="/root/;touch {};".format(create_file)
321         )
322         check_error = True
323         if salt.utils.path.which("repoquery"):
324             check_error = False
325         patch_grains = patch.dict(restartcheck.__grains__, {"os_family": "RedHat"})
326         with patch_kernel, patch_salt, patch_deleted, patch_readlink, patch_grains:
327             if check_error:
328                 with self.assertRaises(FileNotFoundError):
329                     restartcheck.restartcheck()
330             else:
331                 ret = restartcheck.restartcheck()
332                 self.assertIn(
333                     "Found 1 processes using old versions of upgraded files", ret
334                 )
335             self.assertFalse(os.path.exists(create_file))
336     def test_valid_command_b(self):
337         """
338         test for CVE-2020-28243
339         """
340         create_file = os.path.join(RUNTIME_VARS.TMP, "created_file")
341         patch_kernel = patch(
342             "salt.modules.restartcheck._kernel_versions_redhat",
343             return_value=["3.10.0-1127.el7.x86_64"],
344         )
345         services = {
346             "NetworkManager": {"ExecMainPID": 123},
347             "auditd": {"ExecMainPID": 456},
348             "crond": {"ExecMainPID": 789},
349         }
350         patch_salt = patch.dict(
351             restartcheck.__salt__,
352             {
353                 "cmd.run": MagicMock(
354                     return_value="Linux localhost.localdomain 3.10.0-1127.el7.x86_64"
355                 ),
356                 "service.get_running": MagicMock(return_value=list(services.keys())),
357                 "service.show": MagicMock(side_effect=list(services.values())),
358                 "pkg.owner": MagicMock(return_value=""),
359                 "service.available": MagicMock(return_value=True),
360             },
361         )
362         patch_deleted = patch(
363             "salt.modules.restartcheck._deleted_files",
364             MagicMock(return_value=[("--admindir tmp dpkg", 123, "/root/ (deleted)")]),
365         )
366         patch_readlink = patch("os.readlink", return_value="--admindir tmp dpkg")
367         popen_mock = MagicMock()
368         popen_mock.return_value.stdout.readline.side_effect = ["/usr/bin\n", ""]
369         patch_popen = patch("subprocess.Popen", popen_mock)
370         patch_grains = patch.dict(restartcheck.__grains__, {"os_family": "RedHat"})
371         with patch_kernel, patch_salt, patch_deleted, patch_readlink, patch_grains, patch_popen:
372             ret = restartcheck.restartcheck()
373             self.assertIn("Found 1 processes using old versions of upgraded files", ret)
374             popen_mock.assert_called_with(
375                 ["repoquery", "-l", "--admindir tmp dpkg"], stdout=ANY
376             )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
