
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 10.112359550561797%, Tokens: 9, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-leaky_clip_by_value_test.py</h3>
            <pre><code>1  from absl.testing import parameterized
2  from sonnet.src import leaky_clip_by_value
3  from sonnet.src import test_utils
4  import tensorflow as tf
5  class LeakyClipByValueTest(test_utils.TestCase, parameterized.TestCase):
6    def test_leaky_clip_by_value_forward(self):
7      t = tf.Variable([1.0, 2.0, 3.0])
8      clip_min = [1.5]
9      clip_max = [2.5]
10      clip_t = leaky_clip_by_value.leaky_clip_by_value(t, clip_min, clip_max)
11      self.assertAllEqual(clip_t.numpy(), [1.5, 2.0, 2.5])
12      clip_min_array = [0.5, 2.5, 2.5]
13      clip_max_array = [1.5, 3.0, 3.5]
14      clip_t_2 = leaky_clip_by_value.leaky_clip_by_value(t, clip_min_array,
15                                                         clip_max_array)
16      self.assertAllEqual(clip_t_2.numpy(), [1.0, 2.5, 3.0])
17    @parameterized.parameters([
18        (0.5, lambda x: x, [1.0]),
19        (1.5, lambda x: x, [1.0]),
20        (1.5, lambda x: -x, [0.0]),
21        (-.5, lambda x: x, [0.0]),
22        (-.5, lambda x: -x, [-1.0]),
23    ])
24    def test_leaky_clip_by_value_backward(self, init, fn, expected_grad):
25      t = tf.Variable([init])
26      max_val = 1.0
27      min_val = 0.0
28      with tf.GradientTape() as tape:
29        clip_t = leaky_clip_by_value.leaky_clip_by_value(t, min_val, max_val)
30        f = fn(clip_t)
<span onclick='openModal()' class='match'>31      grad = tape.gradient(f, t)
32      clip_t_value = clip_t.numpy()
33      self.assertAllEqual(grad.numpy(), expected_grad)
</span>34      self.assertGreaterEqual(clip_t_value, min_val)
35      self.assertLessEqual(clip_t_value, max_val)
36  if __name__ == "__main__":
37    tf.test.main()
</code></pre>
        </div>
        <div class="column">
            <h3>sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-distributed_batch_norm.py</h3>
            <pre><code>1  from typing import Optional, Tuple
2  from sonnet.src import batch_norm
3  from sonnet.src import initializers
4  from sonnet.src import metrics
5  from sonnet.src import once
6  from sonnet.src import types
7  import tensorflow as tf
8  class CrossReplicaBatchNorm(batch_norm.BaseBatchNorm):
9    def __init__(self,
10                 create_scale: bool,
11                 create_offset: bool,
12                 moving_mean: metrics.Metric,
13                 moving_variance: metrics.Metric,
14                 eps: types.FloatLike = 1e-5,
15                 scale_init: Optional[initializers.Initializer] = None,
16                 offset_init: Optional[initializers.Initializer] = None,
17                 data_format: str = "channels_last",
18                 name: Optional[str] = None):
19      super().__init__(
20          create_scale=create_scale,
21          create_offset=create_offset,
22          moving_mean=moving_mean,
23          moving_variance=moving_variance,
24          eps=eps,
25          scale_init=scale_init,
26          offset_init=offset_init,
27          data_format=data_format,
28          name=name)
29    @once.once
30    def _initialize(self, inputs: tf.Tensor):
31      super()._initialize(inputs)
32      self._fused = False
33    def _moments(self, inputs: tf.Tensor,
34                 use_batch_stats: types.BoolLike) -> Tuple[tf.Tensor, tf.Tensor]:
35      replica_context = tf.distribute.get_replica_context()
36      if replica_context is None:
37        raise TypeError(
38            "Cross replica batch norm cannot be called in cross-replica context.")
39      if use_batch_stats:
40        mean = tf.reduce_mean(inputs, self._axis, keepdims=True)
<span onclick='openModal()' class='match'>41        mean = replica_context.all_reduce("MEAN", mean)
42        mean_of_squares = tf.reduce_mean(
43            tf.square(inputs), self._axis, keepdims=True)
</span>44        mean_of_squares = replica_context.all_reduce("MEAN", mean_of_squares)
45        mean_squared = tf.square(mean)
46        var = mean_of_squares - mean_squared
47        return mean, var
48      else:  # use moving statistics
49        mean = self.moving_mean.value
50        variance = self.moving_variance.value
51        return mean, variance
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-leaky_clip_by_value_test.py</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-distributed_batch_norm.py</div>
                </div>
                <div class="column column_space"><pre><code>31      grad = tape.gradient(f, t)
32      clip_t_value = clip_t.numpy()
33      self.assertAllEqual(grad.numpy(), expected_grad)
</pre></code></div>
                <div class="column column_space"><pre><code>41        mean = replica_context.all_reduce("MEAN", mean)
42        mean_of_squares = tf.reduce_mean(
43            tf.square(inputs), self._axis, keepdims=True)
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    