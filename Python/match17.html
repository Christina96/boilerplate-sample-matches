<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_networksimplex.py & test_mincost.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_networksimplex.py & test_mincost.py
      </h3>
      <h1 align="center">
        57.2%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_networksimplex.py (69.68912%)<TH>test_mincost.py (48.64376%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#0',2,'match17-1.html#0',3)" NAME="0">(172-213)<TD><A HREF="javascript:ZweiFrames('match17-0.html#0',2,'match17-1.html#0',3)" NAME="0">(65-105)</A><TD ALIGN=center><FONT COLOR="#ff0000">93</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#1',2,'match17-1.html#1',3)" NAME="1">(288-316)<TD><A HREF="javascript:ZweiFrames('match17-0.html#1',2,'match17-1.html#1',3)" NAME="1">(323-349)</A><TD ALIGN=center><FONT COLOR="#9c0000">57</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#2',2,'match17-1.html#2',3)" NAME="2">(347-368)<TD><A HREF="javascript:ZweiFrames('match17-0.html#2',2,'match17-1.html#2',3)" NAME="2">(403-423)</A><TD ALIGN=center><FONT COLOR="#960000">55</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#3',2,'match17-1.html#3',3)" NAME="3">(213-246)<TD><A HREF="javascript:ZweiFrames('match17-0.html#3',2,'match17-1.html#3',3)" NAME="3">(142-174)</A><TD ALIGN=center><FONT COLOR="#890000">50</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#4',2,'match17-1.html#4',3)" NAME="4">(246-271)<TD><A HREF="javascript:ZweiFrames('match17-0.html#4',2,'match17-1.html#4',3)" NAME="4">(267-291)</A><TD ALIGN=center><FONT COLOR="#830000">48</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#5',2,'match17-1.html#5',3)" NAME="5">(147-159)<TD><A HREF="javascript:ZweiFrames('match17-0.html#5',2,'match17-1.html#5',3)" NAME="5">(7-19)</A><TD ALIGN=center><FONT COLOR="#6a0000">39</FONT>
<TR><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#6',2,'match17-1.html#6',3)" NAME="6">(271-288)<TD><A HREF="javascript:ZweiFrames('match17-0.html#6',2,'match17-1.html#6',3)" NAME="6">(298-314)</A><TD ALIGN=center><FONT COLOR="#5a0000">33</FONT>
<TR><TD BGCOLOR="#38a4a5"><FONT COLOR="#38a4a5">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#7',2,'match17-1.html#7',3)" NAME="7">(159-171)<TD><A HREF="javascript:ZweiFrames('match17-0.html#7',2,'match17-1.html#7',3)" NAME="7">(26-37)</A><TD ALIGN=center><FONT COLOR="#550000">31</FONT>
<TR><TD BGCOLOR="#c58917"><FONT COLOR="#c58917">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#8',2,'match17-1.html#8',3)" NAME="8">(21-30)<TD><A HREF="javascript:ZweiFrames('match17-0.html#8',2,'match17-1.html#8',3)" NAME="8">(41-50)</A><TD ALIGN=center><FONT COLOR="#520000">30</FONT>
<TR><TD BGCOLOR="#83a33a"><FONT COLOR="#83a33a">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#9',2,'match17-1.html#9',3)" NAME="9">(10-16)<TD><A HREF="javascript:ZweiFrames('match17-0.html#9',2,'match17-1.html#9',3)" NAME="9">(187-193)</A><TD ALIGN=center><FONT COLOR="#440000">25</FONT>
<TR><TD BGCOLOR="#ad5910"><FONT COLOR="#ad5910">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#10',2,'match17-1.html#10',3)" NAME="10">(323-336)<TD><A HREF="javascript:ZweiFrames('match17-0.html#10',2,'match17-1.html#10',3)" NAME="10">(374-385)</A><TD ALIGN=center><FONT COLOR="#3f0000">23</FONT>
<TR><TD BGCOLOR="#b041ff"><FONT COLOR="#b041ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#11',2,'match17-1.html#11',3)" NAME="11">(337-346)<TD><A HREF="javascript:ZweiFrames('match17-0.html#11',2,'match17-1.html#11',3)" NAME="11">(390-398)</A><TD ALIGN=center><FONT COLOR="#390000">21</FONT>
<TR><TD BGCOLOR="#571b7e"><FONT COLOR="#571b7e">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#12',2,'match17-1.html#12',3)" NAME="12">(136-144)<TD><A HREF="javascript:ZweiFrames('match17-0.html#12',2,'match17-1.html#12',3)" NAME="12">(456-464)</A><TD ALIGN=center><FONT COLOR="#340000">19</FONT>
<TR><TD BGCOLOR="#3b9c9c"><FONT COLOR="#3b9c9c">-</FONT><TD><A HREF="javascript:ZweiFrames('match17-0.html#13',2,'match17-1.html#13',3)" NAME="13">(68-74)<TD><A HREF="javascript:ZweiFrames('match17-0.html#13',2,'match17-1.html#13',3)" NAME="13">(51-56)</A><TD ALIGN=center><FONT COLOR="#260000">14</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_networksimplex.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
import pytest
import networkx as nx
import os


@pytest.fixture
<A NAME="9"></A>def simple_flow_graph():
    G = nx.DiGraph()
    G.add_node(&quot;a&quot;, demand=0)
    G<FONT color="#83a33a"><A HREF="javascript:ZweiFrames('match17-1.html#9',3,'match17-top.html#9',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.add_node(&quot;b&quot;, demand=-5)
    G.add_node(&quot;c&quot;, demand=50000000)
    G.add_node(&quot;d&quot;, demand=-49999995)
    G.add_edge(&quot;a&quot;, &quot;b&quot;, weight=3, capacity=4)
    G.add_edge(&quot;a&quot;, &quot;c&quot;, weight=6, capacity=10)
    G.add_edge(&quot;b&quot;, &quot;d&quot;, weight=1, capacity=9)
    G.add_edge(&quot;c&quot;, &quot;d&quot;, weight=2, capacity=</B></FONT>5)
    return G
<A NAME="8"></A>

@pytest.fixture
<FONT color="#c58917"><A HREF="javascript:ZweiFrames('match17-1.html#8',3,'match17-top.html#8',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>def simple_no_flow_graph():
    G = nx.DiGraph()
    G.add_node(&quot;s&quot;, demand=-5)
    G.add_node(&quot;t&quot;, demand=5)
    G.add_edge(&quot;s&quot;, &quot;a&quot;, weight=1, capacity=3)
    G.add_edge(&quot;a&quot;, &quot;b&quot;, weight=3)
    G.add_edge(&quot;a&quot;, &quot;c&quot;, weight=-6)
    G.add_edge(&quot;b&quot;, &quot;d&quot;, weight=1)
    G.add_edge(&quot;c&quot;, &quot;d&quot;, weight=-2)
    G.add_edge(&quot;d&quot;, &quot;t&quot;, weight=1, capacity=</B></FONT>3)
    return G


def get_flowcost_from_flowdict(G, flowDict):
    &quot;&quot;&quot;Returns flow cost calculated from flow dictionary&quot;&quot;&quot;
    flowCost = 0
    for u in flowDict.keys():
        for v in flowDict[u].keys():
            flowCost += flowDict[u][v] * G[u][v][&quot;weight&quot;]
    return flowCost


def test_infinite_demand_raise(simple_flow_graph):
    G = simple_flow_graph
    inf = float(&quot;inf&quot;)
    nx.set_node_attributes(G, {&quot;a&quot;: {&quot;demand&quot;: inf}})
    pytest.raises(nx.NetworkXError, nx.network_simplex, G)


def test_neg_infinite_demand_raise(simple_flow_graph):
    G = simple_flow_graph
    inf = float(&quot;inf&quot;)
    nx.set_node_attributes(G, {&quot;a&quot;: {&quot;demand&quot;: -inf}})
    pytest.raises(nx.NetworkXError, nx.network_simplex, G)


def test_infinite_weight_raise(simple_flow_graph):
    G = simple_flow_graph
    inf = float(&quot;inf&quot;)
    nx.set_edge_attributes(
        G, {(&quot;a&quot;, &quot;b&quot;): {&quot;weight&quot;: inf}, (&quot;b&quot;, &quot;d&quot;): {&quot;weight&quot;: inf}}
    )
    pytest.raises(nx.NetworkXError, nx.network_simplex, G)

<A NAME="13"></A>
def test_nonzero_net_demand_raise(simple_flow_graph):
    G = simple_flow_graph
    nx<FONT color="#3b9c9c"><A HREF="javascript:ZweiFrames('match17-1.html#13',3,'match17-top.html#13',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.set_node_attributes(G, {&quot;b&quot;: {&quot;demand&quot;: -4}})
    pytest.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)


def test_negative_capacity_raise(simple_flow_graph):
    G = simple_flow_graph
    nx.set_edge_attributes(G, {(</B></FONT>&quot;a&quot;, &quot;b&quot;): {&quot;weight&quot;: 1}, (&quot;b&quot;, &quot;d&quot;): {&quot;capacity&quot;: -9}})
    pytest.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)


def test_no_flow_satisfying_demands(simple_no_flow_graph):
    G = simple_no_flow_graph
    pytest.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)


def test_sum_demands_not_zero(simple_no_flow_graph):
    G = simple_no_flow_graph
    nx.set_node_attributes(G, {&quot;t&quot;: {&quot;demand&quot;: 4}})
    pytest.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)


def test_google_or_tools_example():
    &quot;&quot;&quot;
    https://developers.google.com/optimization/flow/mincostflow
    &quot;&quot;&quot;
    G = nx.DiGraph()
    start_nodes = [0, 0, 1, 1, 1, 2, 2, 3, 4]
    end_nodes = [1, 2, 2, 3, 4, 3, 4, 4, 2]
    capacities = [15, 8, 20, 4, 10, 15, 4, 20, 5]
    unit_costs = [4, 4, 2, 2, 6, 1, 3, 2, 3]
    supplies = [20, 0, 0, -5, -15]
    answer = 150

    for i in range(len(supplies)):
        G.add_node(i, demand=(-1) * supplies[i])  # supplies are negative of demand

    for i in range(len(start_nodes)):
        G.add_edge(
            start_nodes[i], end_nodes[i], weight=unit_costs[i], capacity=capacities[i]
        )

    flowCost, flowDict = nx.network_simplex(G)
    assert flowCost == answer
    assert flowCost == get_flowcost_from_flowdict(G, flowDict)


def test_google_or_tools_example2():
    &quot;&quot;&quot;
    https://developers.google.com/optimization/flow/mincostflow
    &quot;&quot;&quot;
    G = nx.DiGraph()
    start_nodes = [0, 0, 1, 1, 1, 2, 2, 3, 4, 3]
    end_nodes = [1, 2, 2, 3, 4, 3, 4, 4, 2, 5]
    capacities = [15, 8, 20, 4, 10, 15, 4, 20, 5, 10]
    unit_costs = [4, 4, 2, 2, 6, 1, 3, 2, 3, 4]
    supplies = [23, 0, 0, -5, -15, -3]
    answer = 183

    for i in range(len(supplies)):
        G.add_node(i, demand=(-1) * supplies[i])  # supplies are negative of demand

    for i in range(len(start_nodes)):
        G.add_edge(
            start_nodes[i], end_nodes[i], weight=unit_costs[i], capacity=capacities[i]
        )
<A NAME="12"></A>
    flowCost, flowDict = nx.network_simplex(G)
    assert flowCost == answer
    assert flowCost == get_flowcost_from_flowdict(<FONT color="#571b7e"><A HREF="javascript:ZweiFrames('match17-1.html#12',3,'match17-top.html#12',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>G, flowDict)


def test_large():
    fname = os.path.join(os.path.dirname(__file__), &quot;netgen-2.gpickle.bz2&quot;)
    G = nx.read_gpickle(fname)
    flowCost, flowDict = nx.network_simplex(G)
    assert 6749969302 == flowCost
<A NAME="5"></A>    assert 6749969302 == nx.cost_of_flow(</B></FONT>G, flowDict)


<FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match17-1.html#5',3,'match17-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>def test_simple_digraph():
    G = nx.DiGraph()
    G.add_node(&quot;a&quot;, demand=-5)
    G.add_node(&quot;d&quot;, demand=5)
    G.add_edge(&quot;a&quot;, &quot;b&quot;, weight=3, capacity=4)
    G.add_edge(&quot;a&quot;, &quot;c&quot;, weight=6, capacity=10)
    G.add_edge(&quot;b&quot;, &quot;d&quot;, weight=1, capacity=9)
    G.add_edge(&quot;c&quot;, &quot;d&quot;, weight=2, capacity=5)
    flowCost, H = nx.network_simplex(G)
<A NAME="7"></A>    soln = {&quot;a&quot;: {&quot;b&quot;: 4, &quot;c&quot;: 1}, &quot;b&quot;: {&quot;d&quot;: 4}, &quot;c&quot;: {&quot;d&quot;: 1}, &quot;d&quot;: {}}
    assert flowCost == 24
    assert nx.min_cost_flow_cost(G) == 24
    a<FONT color="#38a4a5"><A HREF="javascript:ZweiFrames('match17-1.html#7',3,'match17-top.html#7',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ssert</B></FONT> H == soln


def test_negcycle_infcap():
    G = nx.DiGraph()
    G.add_node(&quot;s&quot;, demand=-5)
    G.add_node(&quot;t&quot;, demand=5)
    G.add_edge(&quot;s&quot;, &quot;a&quot;, weight=1, capacity=3)
    G.add_edge(&quot;a&quot;, &quot;b&quot;, weight=3)
    G.add_edge(&quot;c&quot;, &quot;a&quot;, weight=-6)
<A NAME="0"></A>    G.add_edge(&quot;b&quot;, &quot;d&quot;, weight=1)
    G.add_edge(&quot;d&quot;, &quot;c&quot;, weight=-2)
    G.add_edge(&quot;d&quot;, &quot;t&quot;, weight=1, capacity=</B></FONT>3)
    pytest<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match17-1.html#0',3,'match17-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)


def test_transshipment():
    G = nx.DiGraph()
    G.add_node(&quot;a&quot;, demand=1)
    G.add_node(&quot;b&quot;, demand=-2)
    G.add_node(&quot;c&quot;, demand=-2)
    G.add_node(&quot;d&quot;, demand=3)
    G.add_node(&quot;e&quot;, demand=-4)
    G.add_node(&quot;f&quot;, demand=-4)
    G.add_node(&quot;g&quot;, demand=3)
    G.add_node(&quot;h&quot;, demand=2)
    G.add_node(&quot;r&quot;, demand=3)
    G.add_edge(&quot;a&quot;, &quot;c&quot;, weight=3)
    G.add_edge(&quot;r&quot;, &quot;a&quot;, weight=2)
    G.add_edge(&quot;b&quot;, &quot;a&quot;, weight=9)
    G.add_edge(&quot;r&quot;, &quot;c&quot;, weight=0)
    G.add_edge(&quot;b&quot;, &quot;r&quot;, weight=-6)
    G.add_edge(&quot;c&quot;, &quot;d&quot;, weight=5)
    G.add_edge(&quot;e&quot;, &quot;r&quot;, weight=4)
    G.add_edge(&quot;e&quot;, &quot;f&quot;, weight=3)
    G.add_edge(&quot;h&quot;, &quot;b&quot;, weight=4)
    G.add_edge(&quot;f&quot;, &quot;d&quot;, weight=7)
    G.add_edge(&quot;f&quot;, &quot;h&quot;, weight=12)
    G.add_edge(&quot;g&quot;, &quot;d&quot;, weight=12)
    G.add_edge(&quot;f&quot;, &quot;g&quot;, weight=-1)
    G.add_edge(&quot;h&quot;, &quot;g&quot;, weight=-10)
    flowCost, H = nx.network_simplex(G)
    soln = {
        &quot;a&quot;: {&quot;c&quot;: 0},
        &quot;b&quot;: {&quot;a&quot;: 0, &quot;r&quot;: 2},
        &quot;c&quot;: {&quot;d&quot;: 3},
        &quot;d&quot;: {},
        &quot;e&quot;: {&quot;r&quot;: 3, &quot;f&quot;: 1},
        &quot;f&quot;: {&quot;d&quot;: 0, &quot;g&quot;: 3, &quot;h&quot;: 2},
        &quot;g&quot;: {&quot;d&quot;: 0},
        &quot;h&quot;: {&quot;b&quot;: 0, &quot;g&quot;: 0},
<A NAME="3"></A>        &quot;r&quot;: {&quot;a&quot;: 1, &quot;c&quot;: 1},
    }
    assert flowCost == 41
    a<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match17-1.html#3',3,'match17-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ssert</B></FONT> H == soln


def test_digraph1():
    # From Bradley, S. P., Hax, A. C. and Magnanti, T. L. Applied
    # Mathematical Programming. Addison-Wesley, 1977.
    G = nx.DiGraph()
    G.add_node(1, demand=-20)
    G.add_node(4, demand=5)
    G.add_node(5, demand=15)
    G.add_edges_from(
        [
            (1, 2, {&quot;capacity&quot;: 15, &quot;weight&quot;: 4}),
            (1, 3, {&quot;capacity&quot;: 8, &quot;weight&quot;: 4}),
            (2, 3, {&quot;weight&quot;: 2}),
            (2, 4, {&quot;capacity&quot;: 4, &quot;weight&quot;: 2}),
            (2, 5, {&quot;capacity&quot;: 10, &quot;weight&quot;: 6}),
            (3, 4, {&quot;capacity&quot;: 15, &quot;weight&quot;: 1}),
            (3, 5, {&quot;capacity&quot;: 5, &quot;weight&quot;: 3}),
            (4, 5, {&quot;weight&quot;: 2}),
            (5, 3, {&quot;capacity&quot;: 4, &quot;weight&quot;: 1}),
        ]
    )
    flowCost, H = nx.network_simplex(G)
    soln = {
        1: {2: 12, 3: 8},
        2: {3: 8, 4: 4, 5: 0},
        3: {4: 11, 5: 5},
        4: {5: 10},
        5: {3: 0},
<A NAME="4"></A>    }
    assert flowCost == 150
    assert nx.min_cost_flow_cost(G) == 150
    a<FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match17-1.html#4',3,'match17-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ssert</B></FONT> H == soln


def test_zero_capacity_edges():
    &quot;&quot;&quot;Address issue raised in ticket #617 by arv.&quot;&quot;&quot;
    G = nx.DiGraph()
    G.add_edges_from(
        [
            (1, 2, {&quot;capacity&quot;: 1, &quot;weight&quot;: 1}),
            (1, 5, {&quot;capacity&quot;: 1, &quot;weight&quot;: 1}),
            (2, 3, {&quot;capacity&quot;: 0, &quot;weight&quot;: 1}),
            (2, 5, {&quot;capacity&quot;: 1, &quot;weight&quot;: 1}),
            (5, 3, {&quot;capacity&quot;: 2, &quot;weight&quot;: 1}),
            (5, 4, {&quot;capacity&quot;: 0, &quot;weight&quot;: 1}),
            (3, 4, {&quot;capacity&quot;: 2, &quot;weight&quot;: 1}),
        ]
    )
    G.nodes[1][&quot;demand&quot;] = -1
    G.nodes[2][&quot;demand&quot;] = -1
    G.nodes[4][&quot;demand&quot;] = 2

    flowCost, H = nx.network_simplex(G)
<A NAME="6"></A>    soln = {1: {2: 0, 5: 1}, 2: {3: 0, 5: 1}, 3: {4: 2}, 4: {}, 5: {3: 2, 4: 0}}
    assert flowCost == 6
    assert nx.min_cost_flow_cost(G) == 6
    a<FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match17-1.html#6',3,'match17-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ssert</B></FONT> H == soln


def test_digon():
    &quot;&quot;&quot;Check if digons are handled properly. Taken from ticket
    #618 by arv.&quot;&quot;&quot;
    nodes = [(1, {}), (2, {&quot;demand&quot;: -4}), (3, {&quot;demand&quot;: 4})]
    edges = [
        (1, 2, {&quot;capacity&quot;: 3, &quot;weight&quot;: 600000}),
        (2, 1, {&quot;capacity&quot;: 2, &quot;weight&quot;: 0}),
        (2, 3, {&quot;capacity&quot;: 5, &quot;weight&quot;: 714285}),
        (3, 2, {&quot;capacity&quot;: 2, &quot;weight&quot;: 0}),
    ]
    G = nx.DiGraph(edges)
<A NAME="1"></A>    G.add_nodes_from(nodes)
    flowCost, H = nx.network_simplex(G)
    soln = {1: {2: 0}, 2: {1: 0, 3: 4}, 3: {2: 0}}
    a<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match17-1.html#1',3,'match17-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ssert</B></FONT> flowCost == 2857140


def test_deadend():
    &quot;&quot;&quot;Check if one-node cycles are handled properly. Taken from ticket
    #2906 from @sshraven.&quot;&quot;&quot;
    G = nx.DiGraph()

    G.add_nodes_from(range(5), demand=0)
    G.nodes[4][&quot;demand&quot;] = -13
    G.nodes[3][&quot;demand&quot;] = 13

    G.add_edges_from([(0, 2), (0, 3), (2, 1)], capacity=20, weight=0.1)
    pytest.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)


def test_infinite_capacity_neg_digon():
    &quot;&quot;&quot;An infinite capacity negative cost digon results in an unbounded
    instance.&quot;&quot;&quot;
    nodes = [(1, {}), (2, {&quot;demand&quot;: -4}), (3, {&quot;demand&quot;: 4})]
    edges = [
        (1, 2, {&quot;weight&quot;: -600}),
        (2, 1, {&quot;weight&quot;: 0}),
        (2, 3, {&quot;capacity&quot;: 5, &quot;weight&quot;: 714285}),
        (3, 2, {&quot;capacity&quot;: 2, &quot;weight&quot;: 0}),
    ]
    G = nx.DiGraph(edges)
    G.add_nodes_from(nodes)
    pytest.raises(nx.NetworkXUnbounded, nx.</B></FONT>network_simplex, G)


def test_multidigraph():
<A NAME="10"></A>    &quot;&quot;&quot;Multidigraphs are acceptable.&quot;&quot;&quot;
    G = nx.MultiDiGraph()
    G.add_weighted_edges_from([(1, 2, 1), (2, 3, 2)], weight=&quot;capacity&quot;)
    flowCost, H <FONT color="#ad5910"><A HREF="javascript:ZweiFrames('match17-1.html#10',3,'match17-top.html#10',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= nx.network_simplex(G)
    assert flowCost == 0
    assert H == {1: {2: {0: 0}}, 2: {3: {0: 0}}, 3: {}}


def test_negative_selfloops():
    &quot;&quot;&quot;Negative selfloops should cause an exception if uncapacitated and
    always be saturated otherwise.
    &quot;&quot;&quot;
    G = nx.DiGraph()
    G.add_edge(1, 1, weight=-1)
<A NAME="11"></A>    pytest.raises(nx.NetworkXUnbounded, nx.network_simplex, G)

    G[</B></FONT>1][1][&quot;capacity&quot;] = 2
    flowCost, H <FONT color="#b041ff"><A HREF="javascript:ZweiFrames('match17-1.html#11',3,'match17-top.html#11',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= nx.network_simplex(G)
    assert flowCost == -2
    assert H == {1: {1: 2}}

    G = nx.MultiDiGraph()
    G.add_edge(1, 1, &quot;x&quot;, weight=-1)
    G.add_edge(1, 1, &quot;y&quot;, weight=1)
<A NAME="2"></A>    pytest.raises(nx.NetworkXUnbounded, nx.network_simplex, G)

    G[</B></FONT>1][1][&quot;x&quot;][&quot;capacity&quot;] = 2
    flowCost, H <FONT color="#980517"><A HREF="javascript:ZweiFrames('match17-1.html#2',3,'match17-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= nx.network_simplex(G)
    assert flowCost == -2
    assert H == {1: {1: {&quot;x&quot;: 2, &quot;y&quot;: 0}}}


def test_bone_shaped():
    # From #1283
    G = nx.DiGraph()
    G.add_node(0, demand=-4)
    G.add_node(1, demand=2)
    G.add_node(2, demand=2)
    G.add_node(3, demand=4)
    G.add_node(4, demand=-2)
    G.add_node(5, demand=-2)
    G.add_edge(0, 1, capacity=4)
    G.add_edge(0, 2, capacity=4)
    G.add_edge(4, 3, capacity=4)
    G.add_edge(5, 3, capacity=4)
    G.add_edge(0, 3, capacity=0)
    flowCost, H = nx.network_simplex(G)
    assert flowCost == 0
    assert H == {0: {1: 2, 2: 2, 3: 0}, 1: {}, 2: {}, 3: {}, 4: {3: 2}, 5: {3</B></FONT>: 2}}


def test_graphs_type_exceptions():
    G = nx.Graph()
    pytest.raises(nx.NetworkXNotImplemented, nx.network_simplex, G)
    G = nx.MultiGraph()
    pytest.raises(nx.NetworkXNotImplemented, nx.network_simplex, G)
    G = nx.DiGraph()
    pytest.raises(nx.NetworkXError, nx.network_simplex, G)
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_mincost.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
import networkx as nx
import pytest
import os
<A NAME="5"></A>

class TestMinCostFlow:
    <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#5',2,'match17-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>def test_simple_digraph(self):
        G = nx.DiGraph()
        G.add_node(&quot;a&quot;, demand=-5)
        G.add_node(&quot;d&quot;, demand=5)
        G.add_edge(&quot;a&quot;, &quot;b&quot;, weight=3, capacity=4)
        G.add_edge(&quot;a&quot;, &quot;c&quot;, weight=6, capacity=10)
        G.add_edge(&quot;b&quot;, &quot;d&quot;, weight=1, capacity=9)
        G.add_edge(&quot;c&quot;, &quot;d&quot;, weight=2, capacity=5)
        flowCost, H = nx.network_simplex(G)
        soln = {&quot;a&quot;: {&quot;b&quot;: 4, &quot;c&quot;: 1}, &quot;b&quot;: {&quot;d&quot;: 4}, &quot;c&quot;: {&quot;d&quot;: 1}, &quot;d&quot;: {}}
        assert flowCost == 24
        assert nx.min_cost_flow_cost(G) == 24
        assert</B></FONT> H == soln
        assert nx.min_cost_flow(G) == soln
        assert nx.cost_of_flow(G, H) == 24

<A NAME="7"></A>        flowCost, H = nx.capacity_scaling(G)
        assert flowCost == 24
        assert nx.cost_of_flow(G, H) == 24
        a<FONT color="#38a4a5"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#7',2,'match17-top.html#7',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ssert H == soln

    def test_negcycle_infcap(self):
        G = nx.DiGraph()
        G.add_node(&quot;s&quot;, demand=-5)
        G.add_node(&quot;t&quot;, demand=5)
        G.add_edge(&quot;s&quot;, &quot;a&quot;, weight=1, capacity=3)
        G.add_edge(&quot;a&quot;, &quot;b&quot;, weight=3)
        G.add_edge(&quot;c&quot;, &quot;a&quot;, weight=-6)
        G.add_edge(&quot;b&quot;, &quot;d&quot;, weight=1)
        G.add_edge(&quot;d&quot;, &quot;c&quot;, weight=-2)
        G.add_edge(&quot;d&quot;, &quot;t&quot;, weight=1, capacity=</B></FONT>3)
<A NAME="8"></A>        pytest.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)
        pytest.raises(nx.NetworkXUnbounded, nx.capacity_scaling, G)

    <FONT color="#c58917"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#8',2,'match17-top.html#8',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>def test_sum_demands_not_zero(self):
        G = nx.DiGraph()
        G.add_node(&quot;s&quot;, demand=-5)
        G.add_node(&quot;t&quot;, demand=4)
        G.add_edge(&quot;s&quot;, &quot;a&quot;, weight=1, capacity=3)
        G.add_edge(&quot;a&quot;, &quot;b&quot;, weight=3)
        G.add_edge(&quot;a&quot;, &quot;c&quot;, weight=-6)
<A NAME="13"></A>        G.add_edge(&quot;b&quot;, &quot;d&quot;, weight=1)
        G.add_edge(&quot;c&quot;, &quot;d&quot;, weight=-2)
        G.add_edge(&quot;d&quot;, &quot;t&quot;, weight=1, capacity=</B></FONT>3)
        pytest<FONT color="#3b9c9c"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#13',2,'match17-top.html#13',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)
        pytest.raises(nx.NetworkXUnfeasible, nx.capacity_scaling, G)

    def test_no_flow_satisfying_demands(self):
        G = nx.DiGraph()
        G.</B></FONT>add_node(&quot;s&quot;, demand=-5)
        G.add_node(&quot;t&quot;, demand=5)
        G.add_edge(&quot;s&quot;, &quot;a&quot;, weight=1, capacity=3)
        G.add_edge(&quot;a&quot;, &quot;b&quot;, weight=3)
        G.add_edge(&quot;a&quot;, &quot;c&quot;, weight=-6)
        G.add_edge(&quot;b&quot;, &quot;d&quot;, weight=1)
<A NAME="0"></A>        G.add_edge(&quot;c&quot;, &quot;d&quot;, weight=-2)
        G.add_edge(&quot;d&quot;, &quot;t&quot;, weight=1, capacity=3)
        pytest.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)
        pytest<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#0',2,'match17-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.raises(nx.NetworkXUnfeasible, nx.capacity_scaling, G)

    def test_transshipment(self):
        G = nx.DiGraph()
        G.add_node(&quot;a&quot;, demand=1)
        G.add_node(&quot;b&quot;, demand=-2)
        G.add_node(&quot;c&quot;, demand=-2)
        G.add_node(&quot;d&quot;, demand=3)
        G.add_node(&quot;e&quot;, demand=-4)
        G.add_node(&quot;f&quot;, demand=-4)
        G.add_node(&quot;g&quot;, demand=3)
        G.add_node(&quot;h&quot;, demand=2)
        G.add_node(&quot;r&quot;, demand=3)
        G.add_edge(&quot;a&quot;, &quot;c&quot;, weight=3)
        G.add_edge(&quot;r&quot;, &quot;a&quot;, weight=2)
        G.add_edge(&quot;b&quot;, &quot;a&quot;, weight=9)
        G.add_edge(&quot;r&quot;, &quot;c&quot;, weight=0)
        G.add_edge(&quot;b&quot;, &quot;r&quot;, weight=-6)
        G.add_edge(&quot;c&quot;, &quot;d&quot;, weight=5)
        G.add_edge(&quot;e&quot;, &quot;r&quot;, weight=4)
        G.add_edge(&quot;e&quot;, &quot;f&quot;, weight=3)
        G.add_edge(&quot;h&quot;, &quot;b&quot;, weight=4)
        G.add_edge(&quot;f&quot;, &quot;d&quot;, weight=7)
        G.add_edge(&quot;f&quot;, &quot;h&quot;, weight=12)
        G.add_edge(&quot;g&quot;, &quot;d&quot;, weight=12)
        G.add_edge(&quot;f&quot;, &quot;g&quot;, weight=-1)
        G.add_edge(&quot;h&quot;, &quot;g&quot;, weight=-10)
        flowCost, H = nx.network_simplex(G)
        soln = {
            &quot;a&quot;: {&quot;c&quot;: 0},
            &quot;b&quot;: {&quot;a&quot;: 0, &quot;r&quot;: 2},
            &quot;c&quot;: {&quot;d&quot;: 3},
            &quot;d&quot;: {},
            &quot;e&quot;: {&quot;r&quot;: 3, &quot;f&quot;: 1},
            &quot;f&quot;: {&quot;d&quot;: 0, &quot;g&quot;: 3, &quot;h&quot;: 2},
            &quot;g&quot;: {&quot;d&quot;: 0},
            &quot;h&quot;: {&quot;b&quot;: 0, &quot;g&quot;: 0},
            &quot;r&quot;: {&quot;a&quot;: 1, &quot;c&quot;: 1},
        }
        assert flowCost == 41
        assert</B></FONT> nx.min_cost_flow_cost(G) == 41
        assert H == soln
        assert nx.min_cost_flow(G) == soln
        assert nx.cost_of_flow(G, H) == 41

        flowCost, H = nx.capacity_scaling(G)
        assert flowCost == 41
        assert nx.cost_of_flow(G, H) == 41
        assert H == soln

    def test_max_flow_min_cost(self):
        G = nx.DiGraph()
        G.add_edge(&quot;s&quot;, &quot;a&quot;, bandwidth=6)
        G.add_edge(&quot;s&quot;, &quot;c&quot;, bandwidth=10, cost=10)
        G.add_edge(&quot;a&quot;, &quot;b&quot;, cost=6)
        G.add_edge(&quot;b&quot;, &quot;d&quot;, bandwidth=8, cost=7)
        G.add_edge(&quot;c&quot;, &quot;d&quot;, cost=10)
        G.add_edge(&quot;d&quot;, &quot;t&quot;, bandwidth=5, cost=5)
        soln = {
            &quot;s&quot;: {&quot;a&quot;: 5, &quot;c&quot;: 0},
            &quot;a&quot;: {&quot;b&quot;: 5},
            &quot;b&quot;: {&quot;d&quot;: 5},
            &quot;c&quot;: {&quot;d&quot;: 0},
            &quot;d&quot;: {&quot;t&quot;: 5},
            &quot;t&quot;: {},
        }
        flow = nx.max_flow_min_cost(G, &quot;s&quot;, &quot;t&quot;, capacity=&quot;bandwidth&quot;, weight=&quot;cost&quot;)
        assert flow == soln
        assert nx.cost_of_flow(G, flow, weight=&quot;cost&quot;) == 90

        G.add_edge(&quot;t&quot;, &quot;s&quot;, cost=-100)
        flowCost, flow = nx.capacity_scaling(G, capacity=&quot;bandwidth&quot;, weight=&quot;cost&quot;)
        G.remove_edge(&quot;t&quot;, &quot;s&quot;)
        assert flowCost == -410
<A NAME="3"></A>        assert flow[&quot;t&quot;][&quot;s&quot;] == 5
        del flow[&quot;t&quot;][&quot;s&quot;]
        assert flow == soln
        assert nx.cost_of_flow(G, flow, weight=<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#3',2,'match17-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>&quot;cost&quot;) == 90

    def test_digraph1(self):
        # From Bradley, S. P., Hax, A. C. and Magnanti, T. L. Applied
        # Mathematical Programming. Addison-Wesley, 1977.
        G = nx.DiGraph()
        G.add_node(1, demand=-20)
        G.add_node(4, demand=5)
        G.add_node(5, demand=15)
        G.add_edges_from(
            [
                (1, 2, {&quot;capacity&quot;: 15, &quot;weight&quot;: 4}),
                (1, 3, {&quot;capacity&quot;: 8, &quot;weight&quot;: 4}),
                (2, 3, {&quot;weight&quot;: 2}),
                (2, 4, {&quot;capacity&quot;: 4, &quot;weight&quot;: 2}),
                (2, 5, {&quot;capacity&quot;: 10, &quot;weight&quot;: 6}),
                (3, 4, {&quot;capacity&quot;: 15, &quot;weight&quot;: 1}),
                (3, 5, {&quot;capacity&quot;: 5, &quot;weight&quot;: 3}),
                (4, 5, {&quot;weight&quot;: 2}),
                (5, 3, {&quot;capacity&quot;: 4, &quot;weight&quot;: 1}),
            ]
        )
        flowCost, H = nx.network_simplex(G)
        soln = {
            1: {2: 12, 3: 8},
            2: {3: 8, 4: 4, 5: 0},
            3: {4: 11, 5: 5},
            4: {5: 10},
            5: {3: 0},
        }
        assert flowCost == 150
        assert nx.min_cost_flow_cost(G) == 150
        assert</B></FONT> H == soln
        assert nx.min_cost_flow(G) == soln
        assert nx.cost_of_flow(G, H) == 150

        flowCost, H = nx.capacity_scaling(G)
        assert flowCost == 150
        assert H == soln
        assert nx.cost_of_flow(G, H) == 150

    def test_digraph2(self):
<A NAME="9"></A>        # Example from ticket #430 from mfrasca. Original source:
        # http://www.cs.princeton.edu/courses/archive/spr03/cs226/lectures/mincost.4up.pdf, slide 11.
        G = nx.DiGraph()
        G<FONT color="#83a33a"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#9',2,'match17-top.html#9',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.add_edge(&quot;s&quot;, 1, capacity=12)
        G.add_edge(&quot;s&quot;, 2, capacity=6)
        G.add_edge(&quot;s&quot;, 3, capacity=14)
        G.add_edge(1, 2, capacity=11, weight=4)
        G.add_edge(2, 3, capacity=9, weight=6)
        G.add_edge(1, 4, capacity=5, weight=5)
        G.add_edge(1, 5, capacity=2, weight=</B></FONT>12)
        G.add_edge(2, 5, capacity=4, weight=4)
        G.add_edge(2, 6, capacity=2, weight=6)
        G.add_edge(3, 6, capacity=31, weight=3)
        G.add_edge(4, 5, capacity=18, weight=4)
        G.add_edge(5, 6, capacity=9, weight=5)
        G.add_edge(4, &quot;t&quot;, capacity=3)
        G.add_edge(5, &quot;t&quot;, capacity=7)
        G.add_edge(6, &quot;t&quot;, capacity=22)
        flow = nx.max_flow_min_cost(G, &quot;s&quot;, &quot;t&quot;)
        soln = {
            1: {2: 6, 4: 5, 5: 1},
            2: {3: 6, 5: 4, 6: 2},
            3: {6: 20},
            4: {5: 2, &quot;t&quot;: 3},
            5: {6: 0, &quot;t&quot;: 7},
            6: {&quot;t&quot;: 22},
            &quot;s&quot;: {1: 12, 2: 6, 3: 14},
            &quot;t&quot;: {},
        }
        assert flow == soln

        G.add_edge(&quot;t&quot;, &quot;s&quot;, weight=-100)
        flowCost, flow = nx.capacity_scaling(G)
        G.remove_edge(&quot;t&quot;, &quot;s&quot;)
        assert flow[&quot;t&quot;][&quot;s&quot;] == 32
        assert flowCost == -3007
        del flow[&quot;t&quot;][&quot;s&quot;]
        assert flow == soln
        assert nx.cost_of_flow(G, flow) == 193

    def test_digraph3(self):
        &quot;&quot;&quot;Combinatorial Optimization: Algorithms and Complexity,
        Papadimitriou Steiglitz at page 140 has an example, 7.1, but that
        admits multiple solutions, so I alter it a bit. From ticket #430
        by mfrasca.&quot;&quot;&quot;

        G = nx.DiGraph()
        G.add_edge(&quot;s&quot;, &quot;a&quot;)
        G[&quot;s&quot;][&quot;a&quot;].update({0: 2, 1: 4})
        G.add_edge(&quot;s&quot;, &quot;b&quot;)
        G[&quot;s&quot;][&quot;b&quot;].update({0: 2, 1: 1})
        G.add_edge(&quot;a&quot;, &quot;b&quot;)
        G[&quot;a&quot;][&quot;b&quot;].update({0: 5, 1: 2})
        G.add_edge(&quot;a&quot;, &quot;t&quot;)
        G[&quot;a&quot;][&quot;t&quot;].update({0: 1, 1: 5})
        G.add_edge(&quot;b&quot;, &quot;a&quot;)
        G[&quot;b&quot;][&quot;a&quot;].update({0: 1, 1: 3})
        G.add_edge(&quot;b&quot;, &quot;t&quot;)
        G[&quot;b&quot;][&quot;t&quot;].update({0: 3, 1: 2})

        &quot;PS.ex.7.1: testing main function&quot;
        sol = nx.max_flow_min_cost(G, &quot;s&quot;, &quot;t&quot;, capacity=0, weight=1)
        flow = sum(v for v in sol[&quot;s&quot;].values())
        assert 4 == flow
        assert 23 == nx.cost_of_flow(G, sol, weight=1)
        assert sol[&quot;s&quot;] == {&quot;a&quot;: 2, &quot;b&quot;: 2}
        assert sol[&quot;a&quot;] == {&quot;b&quot;: 1, &quot;t&quot;: 1}
        assert sol[&quot;b&quot;] == {&quot;a&quot;: 0, &quot;t&quot;: 3}
        assert sol[&quot;t&quot;] == {}

        G.add_edge(&quot;t&quot;, &quot;s&quot;)
        G[&quot;t&quot;][&quot;s&quot;].update({1: -100})
        flowCost, sol = nx.capacity_scaling(G, capacity=0, weight=1)
        G.remove_edge(&quot;t&quot;, &quot;s&quot;)
        flow = sum(v for v in sol[&quot;s&quot;].values())
        assert 4 == flow
        assert sol[&quot;t&quot;][&quot;s&quot;] == 4
        assert flowCost == -377
        del sol[&quot;t&quot;][&quot;s&quot;]
        assert sol[&quot;s&quot;] == {&quot;a&quot;: 2, &quot;b&quot;: 2}
<A NAME="4"></A>        assert sol[&quot;a&quot;] == {&quot;b&quot;: 1, &quot;t&quot;: 1}
        assert sol[&quot;b&quot;] == {&quot;a&quot;: 0, &quot;t&quot;: 3}
        assert sol[&quot;t&quot;] == {}
        assert nx.cost_of_flow(G, sol, weight=<FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#4',2,'match17-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>1) == 23

    def test_zero_capacity_edges(self):
        &quot;&quot;&quot;Address issue raised in ticket #617 by arv.&quot;&quot;&quot;
        G = nx.DiGraph()
        G.add_edges_from(
            [
                (1, 2, {&quot;capacity&quot;: 1, &quot;weight&quot;: 1}),
                (1, 5, {&quot;capacity&quot;: 1, &quot;weight&quot;: 1}),
                (2, 3, {&quot;capacity&quot;: 0, &quot;weight&quot;: 1}),
                (2, 5, {&quot;capacity&quot;: 1, &quot;weight&quot;: 1}),
                (5, 3, {&quot;capacity&quot;: 2, &quot;weight&quot;: 1}),
                (5, 4, {&quot;capacity&quot;: 0, &quot;weight&quot;: 1}),
                (3, 4, {&quot;capacity&quot;: 2, &quot;weight&quot;: 1}),
            ]
        )
        G.nodes[1][&quot;demand&quot;] = -1
        G.nodes[2][&quot;demand&quot;] = -1
        G.nodes[4][&quot;demand&quot;] = 2

        flowCost, H = nx.network_simplex(G)
        soln = {1: {2: 0, 5: 1}, 2: {3: 0, 5: 1}, 3: {4: 2}, 4: {}, 5: {3: 2, 4: 0}}
        assert flowCost == 6
        assert nx.min_cost_flow_cost(G) == 6
        assert</B></FONT> H == soln
        assert nx.min_cost_flow(G) == soln
        assert nx.cost_of_flow(G, H) == 6

<A NAME="6"></A>        flowCost, H = nx.capacity_scaling(G)
        assert flowCost == 6
        assert H == soln
        assert nx.cost_of_flow(<FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#6',2,'match17-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>G, H) == 6

    def test_digon(self):
        &quot;&quot;&quot;Check if digons are handled properly. Taken from ticket
        #618 by arv.&quot;&quot;&quot;
        nodes = [(1, {}), (2, {&quot;demand&quot;: -4}), (3, {&quot;demand&quot;: 4})]
        edges = [
            (1, 2, {&quot;capacity&quot;: 3, &quot;weight&quot;: 600000}),
            (2, 1, {&quot;capacity&quot;: 2, &quot;weight&quot;: 0}),
            (2, 3, {&quot;capacity&quot;: 5, &quot;weight&quot;: 714285}),
            (3, 2, {&quot;capacity&quot;: 2, &quot;weight&quot;: 0}),
        ]
        G = nx.DiGraph(edges)
        G.add_nodes_from(nodes)
        flowCost, H = nx.network_simplex(G)
        soln = {1: {2: 0}, 2: {1: 0, 3: 4}, 3: {2: 0}}
        assert</B></FONT> flowCost == 2857140
        assert nx.min_cost_flow_cost(G) == 2857140
        assert H == soln
        assert nx.min_cost_flow(G) == soln
        assert nx.cost_of_flow(G, H) == 2857140

<A NAME="1"></A>        flowCost, H = nx.capacity_scaling(G)
        assert flowCost == 2857140
        assert H == soln
        assert nx.cost_of_flow(<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#1',2,'match17-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>G, H) == 2857140

    def test_deadend(self):
        &quot;&quot;&quot;Check if one-node cycles are handled properly. Taken from ticket
        #2906 from @sshraven.&quot;&quot;&quot;
        G = nx.DiGraph()

        G.add_nodes_from(range(5), demand=0)
        G.nodes[4][&quot;demand&quot;] = -13
        G.nodes[3][&quot;demand&quot;] = 13

        G.add_edges_from([(0, 2), (0, 3), (2, 1)], capacity=20, weight=0.1)
        pytest.raises(nx.NetworkXUnfeasible, nx.min_cost_flow, G)

    def test_infinite_capacity_neg_digon(self):
        &quot;&quot;&quot;An infinite capacity negative cost digon results in an unbounded
        instance.&quot;&quot;&quot;
        nodes = [(1, {}), (2, {&quot;demand&quot;: -4}), (3, {&quot;demand&quot;: 4})]
        edges = [
            (1, 2, {&quot;weight&quot;: -600}),
            (2, 1, {&quot;weight&quot;: 0}),
            (2, 3, {&quot;capacity&quot;: 5, &quot;weight&quot;: 714285}),
            (3, 2, {&quot;capacity&quot;: 2, &quot;weight&quot;: 0}),
        ]
        G = nx.DiGraph(edges)
        G.add_nodes_from(nodes)
        pytest.raises(nx.NetworkXUnbounded, nx.</B></FONT>network_simplex, G)
        pytest.raises(nx.NetworkXUnbounded, nx.capacity_scaling, G)

    def test_finite_capacity_neg_digon(self):
        &quot;&quot;&quot;The digon should receive the maximum amount of flow it can handle.
        Taken from ticket #749 by @chuongdo.&quot;&quot;&quot;
        G = nx.DiGraph()
        G.add_edge(&quot;a&quot;, &quot;b&quot;, capacity=1, weight=-1)
        G.add_edge(&quot;b&quot;, &quot;a&quot;, capacity=1, weight=-1)
        min_cost = -2
        assert nx.min_cost_flow_cost(G) == min_cost

        flowCost, H = nx.capacity_scaling(G)
        assert flowCost == -2
        assert H == {&quot;a&quot;: {&quot;b&quot;: 1}, &quot;b&quot;: {&quot;a&quot;: 1}}
        assert nx.cost_of_flow(G, H) == -2

    def test_multidigraph(self):
        &quot;&quot;&quot;Multidigraphs are acceptable.&quot;&quot;&quot;
        G = nx.MultiDiGraph()
        G.add_weighted_edges_from([(1, 2, 1), (2, 3, 2)], weight=&quot;capacity&quot;)
        flowCost, H = nx.network_simplex(G)
<A NAME="10"></A>        assert flowCost == 0
        assert H == {1: {2: {0: 0}}, 2: {3: {0: 0}}, 3: {}}

        flowCost, H <FONT color="#ad5910"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#10',2,'match17-top.html#10',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= nx.capacity_scaling(G)
        assert flowCost == 0
        assert H == {1: {2: {0: 0}}, 2: {3: {0: 0}}, 3: {}}

    def test_negative_selfloops(self):
        &quot;&quot;&quot;Negative selfloops should cause an exception if uncapacitated and
        always be saturated otherwise.
        &quot;&quot;&quot;
        G = nx.DiGraph()
        G.add_edge(1, 1, weight=-1)
        pytest.raises(nx.NetworkXUnbounded, nx.network_simplex, G)
        pytest.</B></FONT>raises(nx.NetworkXUnbounded, nx.capacity_scaling, G)
        G[1][1][&quot;capacity&quot;] = 2
<A NAME="11"></A>        flowCost, H = nx.network_simplex(G)
        assert flowCost == -2
        assert H == {1: {1: 2}}
        flowCost, H <FONT color="#b041ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#11',2,'match17-top.html#11',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= nx.capacity_scaling(G)
        assert flowCost == -2
        assert H == {1: {1: 2}}

        G = nx.MultiDiGraph()
        G.add_edge(1, 1, &quot;x&quot;, weight=-1)
        G.add_edge(1, 1, &quot;y&quot;, weight=1)
        pytest.raises(nx.NetworkXUnbounded, nx.network_simplex, G)
        pytest.</B></FONT>raises(nx.NetworkXUnbounded, nx.capacity_scaling, G)
        G[1][1][&quot;x&quot;][&quot;capacity&quot;] = 2
<A NAME="2"></A>        flowCost, H = nx.network_simplex(G)
        assert flowCost == -2
        assert H == {1: {1: {&quot;x&quot;: 2, &quot;y&quot;: 0}}}
        flowCost, H <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#2',2,'match17-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= nx.capacity_scaling(G)
        assert flowCost == -2
        assert H == {1: {1: {&quot;x&quot;: 2, &quot;y&quot;: 0}}}

    def test_bone_shaped(self):
        # From #1283
        G = nx.DiGraph()
        G.add_node(0, demand=-4)
        G.add_node(1, demand=2)
        G.add_node(2, demand=2)
        G.add_node(3, demand=4)
        G.add_node(4, demand=-2)
        G.add_node(5, demand=-2)
        G.add_edge(0, 1, capacity=4)
        G.add_edge(0, 2, capacity=4)
        G.add_edge(4, 3, capacity=4)
        G.add_edge(5, 3, capacity=4)
        G.add_edge(0, 3, capacity=0)
        flowCost, H = nx.network_simplex(G)
        assert flowCost == 0
        assert H == {0: {1: 2, 2: 2, 3: 0}, 1: {}, 2: {}, 3: {}, 4: {3: 2}, 5: {3</B></FONT>: 2}}
        flowCost, H = nx.capacity_scaling(G)
        assert flowCost == 0
        assert H == {0: {1: 2, 2: 2, 3: 0}, 1: {}, 2: {}, 3: {}, 4: {3: 2}, 5: {3: 2}}

    def test_exceptions(self):
        G = nx.Graph()
        pytest.raises(nx.NetworkXNotImplemented, nx.network_simplex, G)
        pytest.raises(nx.NetworkXNotImplemented, nx.capacity_scaling, G)
        G = nx.MultiGraph()
        pytest.raises(nx.NetworkXNotImplemented, nx.network_simplex, G)
        pytest.raises(nx.NetworkXNotImplemented, nx.capacity_scaling, G)
        G = nx.DiGraph()
        pytest.raises(nx.NetworkXError, nx.network_simplex, G)
        pytest.raises(nx.NetworkXError, nx.capacity_scaling, G)
        G.add_node(0, demand=float(&quot;inf&quot;))
        pytest.raises(nx.NetworkXError, nx.network_simplex, G)
        pytest.raises(nx.NetworkXUnfeasible, nx.capacity_scaling, G)
        G.nodes[0][&quot;demand&quot;] = 0
        G.add_node(1, demand=0)
        G.add_edge(0, 1, weight=-float(&quot;inf&quot;))
        pytest.raises(nx.NetworkXError, nx.network_simplex, G)
        pytest.raises(nx.NetworkXUnfeasible, nx.capacity_scaling, G)
        G[0][1][&quot;weight&quot;] = 0
        G.add_edge(0, 0, weight=float(&quot;inf&quot;))
        pytest.raises(nx.NetworkXError, nx.network_simplex, G)
        # pytest.raises(nx.NetworkXError, nx.capacity_scaling, G)
        G[0][0][&quot;weight&quot;] = 0
        G[0][1][&quot;capacity&quot;] = -1
        pytest.raises(nx.NetworkXUnfeasible, nx.network_simplex, G)
<A NAME="12"></A>        # pytest.raises(nx.NetworkXUnfeasible, nx.capacity_scaling, G)
        G[0][1][&quot;capacity&quot;] = 0
        G[0][0][&quot;capacity&quot;] = -1
        pytest.raises(nx.NetworkXUnfeasible, nx.<FONT color="#571b7e"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match17-0.html#12',2,'match17-top.html#12',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>network_simplex, G)
        # pytest.raises(nx.NetworkXUnfeasible, nx.capacity_scaling, G)

    def test_large(self):
        fname = os.path.join(os.path.dirname(__file__), &quot;netgen-2.gpickle.bz2&quot;)
        G = nx.read_gpickle(fname)
        flowCost, flowDict = nx.network_simplex(G)
        assert 6749969302 == flowCost
        assert 6749969302 == nx.cost_of_flow(</B></FONT>G, flowDict)
        flowCost, flowDict = nx.capacity_scaling(G)
        assert 6749969302 == flowCost
        assert 6749969302 == nx.cost_of_flow(G, flowDict)
</PRE>
</div>
  </div>
</body>
</html>
