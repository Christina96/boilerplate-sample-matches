<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_service_3.py & test_mount.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_service_3.py & test_mount.py
      </h3>
      <h1 align="center">
        4.5%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_service_3.py (6.56682%)<TH>test_mount.py (3.4905083%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match69652-0.html#0',2,'match69652-1.html#0',3)" NAME="0">(421-432)<TD><A HREF="javascript:ZweiFrames('match69652-0.html#0',2,'match69652-1.html#0',3)" NAME="0">(785-788)</A><TD ALIGN=center><FONT COLOR="#ff0000">15</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match69652-0.html#1',2,'match69652-1.html#1',3)" NAME="1">(398-409)<TD><A HREF="javascript:ZweiFrames('match69652-0.html#1',2,'match69652-1.html#1',3)" NAME="1">(766-769)</A><TD ALIGN=center><FONT COLOR="#ff0000">15</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match69652-0.html#2',2,'match69652-1.html#2',3)" NAME="2">(548-557)<TD><A HREF="javascript:ZweiFrames('match69652-0.html#2',2,'match69652-1.html#2',3)" NAME="2">(105-109)</A><TD ALIGN=center><FONT COLOR="#ee0000">14</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match69652-0.html#3',2,'match69652-1.html#3',3)" NAME="3">(186-191)<TD><A HREF="javascript:ZweiFrames('match69652-0.html#3',2,'match69652-1.html#3',3)" NAME="3">(693-695)</A><TD ALIGN=center><FONT COLOR="#dd0000">13</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_service_3.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Gareth J. Greenaway &lt;ggreenaway@vmware.com&gt;
&quot;&quot;&quot;

import logging

import pytest
import salt.modules.beacons as beaconmod
import salt.states.beacon as beaconstate
import salt.states.service as service
import salt.utils.platform
from salt.utils.event import SaltEvent
from tests.support.mock import MagicMock, patch

log = logging.getLogger(__name__)


def func(name):
    &quot;&quot;&quot;
    Mock func method
    &quot;&quot;&quot;
    return name


@pytest.fixture
def configure_loader_modules():
    return {
        service: {
            &quot;__env__&quot;: &quot;base&quot;,
            &quot;__salt__&quot;: {},
            &quot;__opts__&quot;: {&quot;test&quot;: False, &quot;cachedir&quot;: &quot;&quot;},
            &quot;__instance_id__&quot;: &quot;&quot;,
            &quot;__low__&quot;: {},
            &quot;__utils__&quot;: {},
            &quot;__context__&quot;: {},
        },
        beaconstate: {&quot;__salt__&quot;: {}, &quot;__opts__&quot;: {}},
        beaconmod: {&quot;__salt__&quot;: {}, &quot;__opts__&quot;: {}},
    }


def test_get_systemd_only():
    &quot;&quot;&quot;
    Test the _get_system_only function
    &quot;&quot;&quot;

    def test_func(cats, dogs, no_block):
        pass

    with patch.object(service._get_systemd_only, &quot;HAS_SYSTEMD&quot;, True, create=True):
        ret, warnings = service._get_systemd_only(
            test_func, {&quot;cats&quot;: 1, &quot;no_block&quot;: 2, &quot;unmask&quot;: 3}
        )
        assert len(warnings) == 0
        assert ret == {&quot;no_block&quot;: 2}

        ret, warnings = service._get_systemd_only(test_func, {&quot;cats&quot;: 1, &quot;unmask&quot;: 3})

        assert len(warnings) == 0
        assert ret == {}


def test_get_systemd_only_platform():
    &quot;&quot;&quot;
    Test the _get_system_only function on unsupported platforms
    &quot;&quot;&quot;

    def test_func(cats, dogs, no_block):
        pass

    with patch.object(service._get_systemd_only, &quot;HAS_SYSTEMD&quot;, False, create=True):
        ret, warnings = service._get_systemd_only(
            test_func, {&quot;cats&quot;: 1, &quot;no_block&quot;: 2, &quot;unmask&quot;: 3}
        )

        assert warnings == [&quot;The 'no_block' argument is not supported by this platform&quot;]
        assert ret == {}

        ret, warnings = service._get_systemd_only(test_func, {&quot;cats&quot;: 1, &quot;unmask&quot;: 3})

        assert len(warnings) == 0
        assert ret == {}


def test_get_systemd_only_no_mock():
    &quot;&quot;&quot;
    Test the _get_system_only without mocking
    &quot;&quot;&quot;

    def test_func(cats, dogs, no_block):
        pass

    ret, warnings = service._get_systemd_only(
        test_func, {&quot;cats&quot;: 1, &quot;no_block&quot;: 2, &quot;unmask&quot;: 3}
    )

    assert isinstance(ret, dict)
    assert isinstance(warnings, list)


def test_running():
    &quot;&quot;&quot;
    Test to verify that the service is running
    &quot;&quot;&quot;
    ret = [
        {&quot;comment&quot;: &quot;&quot;, &quot;changes&quot;: {}, &quot;name&quot;: &quot;salt&quot;, &quot;result&quot;: True},
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;The service salt is already running&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: &quot;saltstack&quot;,
            &quot;comment&quot;: &quot;The service salt is already running&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;Service salt is set to start&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: None,
        },
        {
            &quot;changes&quot;: &quot;saltstack&quot;,
            &quot;comment&quot;: &quot;Started service salt&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;The service salt is already running&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: &quot;saltstack&quot;,
            &quot;comment&quot;: &quot;Service salt failed to start&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: False,
        },
        {
            &quot;changes&quot;: &quot;saltstack&quot;,
            &quot;comment&quot;: (
                &quot;Started service salt\nService masking not available on this minion&quot;
            ),
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: &quot;saltstack&quot;,
            &quot;comment&quot;: (
                &quot;Started service salt\nService masking not available on this minion&quot;
            ),
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: (
                &quot;The service salt is disabled but enable is not True. Set enable to&quot;
                &quot; True to successfully start the service.&quot;
            ),
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: False,
        },
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;The service salt is set to restart&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: None,
        },
    ]

    tmock = MagicMock(return_value=True)
    fmock = MagicMock(return_value=False)
    vmock = MagicMock(return_value=&quot;salt&quot;)
    with patch.object(service, &quot;_enabled_used_error&quot;, vmock):
        assert service.running(&quot;salt&quot;, enabled=1) == &quot;salt&quot;

    with patch.object(service, &quot;_available&quot;, fmock):
<A NAME="3"></A>        assert service.running(&quot;salt&quot;) == ret[0]

    with patch.object(service, &quot;_available&quot;, tmock):
        <FONT color="#53858b"><A HREF="javascript:ZweiFrames('match69652-1.html#3',3,'match69652-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>with patch.dict(service.__opts__, {&quot;test&quot;: False}):
            with patch.dict(
                service.__salt__,
                {&quot;service.enabled&quot;: tmock, &quot;service.status&quot;: tmock},
            ):
                assert service.running(</B></FONT>&quot;salt&quot;) == ret[1]

            mock = MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;})
            with patch.dict(
                service.__salt__,
                {
                    &quot;service.enabled&quot;: MagicMock(side_effect=[False, True]),
                    &quot;service.status&quot;: tmock,
                },
            ):
                with patch.object(service, &quot;_enable&quot;, mock):
                    assert service.running(&quot;salt&quot;, True) == ret[2]

            with patch.dict(
                service.__salt__,
                {
                    &quot;service.enabled&quot;: MagicMock(side_effect=[True, False]),
                    &quot;service.status&quot;: tmock,
                },
            ):
                with patch.object(service, &quot;_disable&quot;, mock):
                    assert service.running(&quot;salt&quot;, False) == ret[2]

            with patch.dict(
                service.__salt__,
                {
                    &quot;service.status&quot;: MagicMock(side_effect=[False, True]),
                    &quot;service.enabled&quot;: MagicMock(side_effect=[False, True]),
                    &quot;service.start&quot;: MagicMock(return_value=&quot;stack&quot;),
                },
            ):
                with patch.object(
                    service,
                    &quot;_enable&quot;,
                    MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;}),
                ):
                    assert service.running(&quot;salt&quot;, True) == ret[4]

            with patch.dict(
                service.__salt__,
                {
                    &quot;service.status&quot;: MagicMock(side_effect=[False, True]),
                    &quot;service.enabled&quot;: MagicMock(side_effect=[False, True]),
                    &quot;service.unmask&quot;: MagicMock(side_effect=[False, True]),
                    &quot;service.start&quot;: MagicMock(return_value=&quot;stack&quot;),
                },
            ):
                with patch.object(
                    service,
                    &quot;_enable&quot;,
                    MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;}),
                ):
                    assert service.running(&quot;salt&quot;, True, unmask=True) == ret[7]

        with patch.dict(service.__opts__, {&quot;test&quot;: True}):
            with patch.dict(service.__salt__, {&quot;service.status&quot;: tmock}):
                assert service.running(&quot;salt&quot;) == ret[5]

            with patch.dict(service.__salt__, {&quot;service.status&quot;: fmock}):
                assert service.running(&quot;salt&quot;) == ret[3]

        with patch.dict(service.__opts__, {&quot;test&quot;: False}):
            with patch.dict(
                service.__salt__,
                {
                    &quot;service.status&quot;: MagicMock(side_effect=[False, False]),
                    &quot;service.enabled&quot;: MagicMock(side_effect=[True, True]),
                    &quot;service.start&quot;: MagicMock(return_value=&quot;stack&quot;),
                },
            ):
                with patch.object(
                    service,
                    &quot;_enable&quot;,
                    MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;}),
                ):
                    assert service.running(&quot;salt&quot;, True) == ret[6]
            # test some unique cases simulating Windows
            with patch.object(salt.utils.platform, &quot;is_windows&quot;, tmock):
                # We should fail if a service is disabled on Windows and enable
                # isn't set.
                with patch.dict(
                    service.__salt__,
                    {
                        &quot;service.status&quot;: fmock,
                        &quot;service.enabled&quot;: fmock,
                        &quot;service.start&quot;: tmock,
                    },
                ):
                    assert service.running(&quot;salt&quot;, None) == ret[9]
                    assert service.__context__ == {&quot;service.state&quot;: &quot;running&quot;}
            # test some unique cases simulating macOS
            with patch.object(salt.utils.platform, &quot;is_darwin&quot;, tmock):
                # We should fail if a service is disabled on macOS and enable
                # isn't set.
                with patch.dict(
                    service.__salt__,
                    {
                        &quot;service.status&quot;: fmock,
                        &quot;service.enabled&quot;: fmock,
                        &quot;service.start&quot;: tmock,
                    },
                ):
                    assert service.running(&quot;salt&quot;, None) == ret[9]
                    assert service.__context__ == {&quot;service.state&quot;: &quot;running&quot;}
                # test enabling a service prior starting it on macOS
                with patch.dict(
                    service.__salt__,
                    {
                        &quot;service.status&quot;: MagicMock(side_effect=[False, &quot;loaded&quot;]),
                        &quot;service.enabled&quot;: MagicMock(side_effect=[False, True]),
                        &quot;service.start&quot;: tmock,
                    },
                ):
                    with patch.object(
                        service,
                        &quot;_enable&quot;,
                        MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;}),
                    ):
                        assert service.running(&quot;salt&quot;, True) == ret[4]
                        assert service.__context__ == {&quot;service.state&quot;: &quot;running&quot;}
                # if an enable attempt fails on macOS or windows then a
                # disabled service will always fail to start.
                with patch.dict(
                    service.__salt__,
                    {
                        &quot;service.status&quot;: fmock,
                        &quot;service.enabled&quot;: fmock,
                        &quot;service.start&quot;: fmock,
                    },
                ):
                    with patch.object(
                        service,
                        &quot;_enable&quot;,
                        MagicMock(
                            return_value={&quot;changes&quot;: &quot;saltstack&quot;, &quot;result&quot;: False}
                        ),
                    ):
                        assert service.running(&quot;salt&quot;, True) == ret[6]
                        assert service.__context__ == {&quot;service.state&quot;: &quot;running&quot;}


def test_running_in_offline_mode():
    &quot;&quot;&quot;
    Tests the case in which a service.running state is executed on an offline environemnt

    &quot;&quot;&quot;
    name = &quot;thisisnotarealservice&quot;
    with patch.object(service, &quot;_offline&quot;, MagicMock(return_value=True)):
        ret = service.running(name=name)
        assert ret == {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;Running in OFFLINE mode. Nothing to do&quot;,
            &quot;result&quot;: True,
            &quot;name&quot;: name,
        }


def test_dead():
    &quot;&quot;&quot;
    Test to ensure that the named service is dead
    &quot;&quot;&quot;
    ret = [
        {&quot;changes&quot;: {}, &quot;comment&quot;: &quot;&quot;, &quot;name&quot;: &quot;salt&quot;, &quot;result&quot;: True},
        {
            &quot;changes&quot;: &quot;saltstack&quot;,
            &quot;comment&quot;: &quot;The service salt is already dead&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;Service salt is set to be killed&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: None,
        },
        {
            &quot;changes&quot;: &quot;saltstack&quot;,
            &quot;comment&quot;: &quot;Service salt was killed&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;Service salt failed to die&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: False,
        },
        {
            &quot;changes&quot;: &quot;saltstack&quot;,
            &quot;comment&quot;: &quot;The service salt is already dead&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
    ]
    info_mock = MagicMock(return_value={&quot;StartType&quot;: &quot;&quot;})

    mock = MagicMock(return_value=&quot;salt&quot;)
    with patch.object(service, &quot;_enabled_used_error&quot;, mock):
        assert service.dead(&quot;salt&quot;, enabled=1) == &quot;salt&quot;

    tmock = MagicMock(return_value=True)
    fmock = MagicMock(return_value=False)
    with patch.object(service, &quot;_available&quot;, fmock):
        assert service.dead(&quot;salt&quot;) == ret[0]
<A NAME="1"></A>
    with patch.object(service, &quot;_available&quot;, tmock):
        mock = MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;})
        with patch.dict(service.__opts__, {<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match69652-1.html#1',3,'match69652-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>&quot;test&quot;: True}):
            with patch.dict(
                service.__salt__,
                {
                    &quot;service.enabled&quot;: fmock,
                    &quot;service.stop&quot;: tmock,
                    &quot;service.status&quot;: fmock,
                    &quot;service.info&quot;: info_mock,
                },
            ):
                with patch.object(service, &quot;_enable&quot;, mock):
                    assert service.dead(&quot;salt&quot;, True) == ret[5</B></FONT>]

            with patch.dict(
                service.__salt__,
                {
                    &quot;service.enabled&quot;: tmock,
                    &quot;service.status&quot;: tmock,
                    &quot;service.info&quot;: info_mock,
                },
<A NAME="0"></A>            ):
                assert service.dead(&quot;salt&quot;) == ret[2]

        with patch.dict(service.__opts__, {<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match69652-1.html#0',3,'match69652-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>&quot;test&quot;: False}):
            with patch.dict(
                service.__salt__,
                {
                    &quot;service.enabled&quot;: fmock,
                    &quot;service.stop&quot;: tmock,
                    &quot;service.status&quot;: fmock,
                    &quot;service.info&quot;: info_mock,
                },
            ):
                with patch.object(service, &quot;_enable&quot;, mock):
                    assert service.dead(&quot;salt&quot;, True) == ret[1</B></FONT>]

            with patch.dict(
                service.__salt__,
                {
                    &quot;service.enabled&quot;: MagicMock(side_effect=[True, True, False]),
                    &quot;service.status&quot;: MagicMock(side_effect=[True, False, False]),
                    &quot;service.stop&quot;: MagicMock(return_value=&quot;stack&quot;),
                    &quot;service.info&quot;: info_mock,
                },
            ):
                with patch.object(
                    service,
                    &quot;_enable&quot;,
                    MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;}),
                ):
                    assert service.dead(&quot;salt&quot;, True) == ret[3]

            # test an initd which a wrong status (True even if dead)
            with patch.dict(
                service.__salt__,
                {
                    &quot;service.enabled&quot;: MagicMock(side_effect=[False, False, False]),
                    &quot;service.status&quot;: MagicMock(side_effect=[True, True, True]),
                    &quot;service.stop&quot;: MagicMock(return_value=&quot;stack&quot;),
                    &quot;service.info&quot;: info_mock,
                },
            ):
                with patch.object(service, &quot;_disable&quot;, MagicMock(return_value={})):
                    assert service.dead(&quot;salt&quot;, False) == ret[4]

        assert service.__context__ == {&quot;service.state&quot;: &quot;dead&quot;}


def test_dead_with_missing_service():
    &quot;&quot;&quot;
    Tests the case in which a service.dead state is executed on a state
    which does not exist.

    See https://github.com/saltstack/salt/issues/37511
    &quot;&quot;&quot;
    name = &quot;thisisnotarealservice&quot;
    with patch.dict(
        service.__salt__, {&quot;service.available&quot;: MagicMock(return_value=False)}
    ):
        ret = service.dead(name=name)
        assert ret == {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;The named service {} is not available&quot;.format(name),
            &quot;result&quot;: True,
            &quot;name&quot;: name,
        }


def test_dead_in_offline_mode():
    &quot;&quot;&quot;
    Tests the case in which a service.dead state is executed on an offline environemnt

    &quot;&quot;&quot;
    name = &quot;thisisnotarealservice&quot;
    with patch.object(service, &quot;_offline&quot;, MagicMock(return_value=True)):
        ret = service.dead(name=name)
        assert ret == {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;Running in OFFLINE mode. Nothing to do&quot;,
            &quot;result&quot;: True,
            &quot;name&quot;: name,
        }


def test_enabled():
    &quot;&quot;&quot;
    Test to verify that the service is enabled
    &quot;&quot;&quot;
    ret = {&quot;changes&quot;: &quot;saltstack&quot;, &quot;comment&quot;: &quot;&quot;, &quot;name&quot;: &quot;salt&quot;, &quot;result&quot;: True}
    mock = MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;})
    with patch.object(service, &quot;_enable&quot;, mock):
        assert service.enabled(&quot;salt&quot;) == ret
        assert service.__context__ == {&quot;service.state&quot;: &quot;enabled&quot;}


def test_disabled():
    &quot;&quot;&quot;
    Test to verify that the service is disabled
    &quot;&quot;&quot;
    ret = {&quot;changes&quot;: &quot;saltstack&quot;, &quot;comment&quot;: &quot;&quot;, &quot;name&quot;: &quot;salt&quot;, &quot;result&quot;: True}
    mock = MagicMock(return_value={&quot;changes&quot;: &quot;saltstack&quot;})
    with patch.object(service, &quot;_disable&quot;, mock):
        assert service.disabled(&quot;salt&quot;) == ret
        assert service.__context__ == {&quot;service.state&quot;: &quot;disabled&quot;}


def test_mod_watch():
    &quot;&quot;&quot;
    Test to the service watcher, called to invoke the watch command.
    &quot;&quot;&quot;
    ret = [
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;Service is already stopped&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: True,
        },
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;Unable to trigger watch for service.stack&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: False,
        },
        {
            &quot;changes&quot;: {},
            &quot;comment&quot;: &quot;Service is set to be started&quot;,
            &quot;name&quot;: &quot;salt&quot;,
<A NAME="2"></A>            &quot;result&quot;: None,
        },
        {
            <FONT color="#980517"><A HREF="javascript:ZweiFrames('match69652-1.html#2',3,'match69652-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>&quot;changes&quot;: {&quot;salt&quot;: &quot;salt&quot;},
            &quot;comment&quot;: &quot;Service started&quot;,
            &quot;name&quot;: &quot;salt&quot;,
            &quot;result&quot;: &quot;salt&quot;,
        },
    ]

    mock = MagicMock(return_value=False)
    with patch.dict(service.__salt__, {&quot;service.status&quot;: mock}):
        assert service.mod_watch(&quot;salt&quot;, &quot;dead&quot;) == ret[</B></FONT>0]

        with patch.dict(service.__salt__, {&quot;service.start&quot;: func}):
            with patch.dict(service.__opts__, {&quot;test&quot;: True}):
                assert service.mod_watch(&quot;salt&quot;, &quot;running&quot;) == ret[2]

            with patch.dict(service.__opts__, {&quot;test&quot;: False}):
                assert service.mod_watch(&quot;salt&quot;, &quot;running&quot;) == ret[3]

        assert service.mod_watch(&quot;salt&quot;, &quot;stack&quot;) == ret[1]


def test_mod_beacon(tmp_path):
    &quot;&quot;&quot;
    Test to create a beacon based on a service
    &quot;&quot;&quot;
    name = &quot;sshd&quot;

    with patch.dict(service.__salt__, {&quot;beacons.list&quot;: MagicMock(return_value={})}):
        with patch.dict(service.__states__, {&quot;beacon.present&quot;: beaconstate.present}):
            ret = service.mod_beacon(name, sfun=&quot;copy&quot;)
            expected = {
                &quot;name&quot;: name,
                &quot;changes&quot;: {},
                &quot;result&quot;: False,
                &quot;comment&quot;: &quot;service.copy does not work with the beacon state function&quot;,
            }

            assert ret == expected

    event_returns = [
        {
            &quot;complete&quot;: True,
            &quot;tag&quot;: &quot;/salt/minion/minion_beacons_list_complete&quot;,
            &quot;beacons&quot;: {},
        },
        {
            &quot;complete&quot;: True,
            &quot;tag&quot;: &quot;/salt/minion/minion_beacons_list_complete&quot;,
            &quot;beacons&quot;: {},
        },
        {
            &quot;complete&quot;: True,
            &quot;tag&quot;: &quot;/salt/minion/minion_beacons_list_available_complete&quot;,
            &quot;beacons&quot;: [&quot;service&quot;],
        },
        {
            &quot;valid&quot;: True,
            &quot;tag&quot;: &quot;/salt/minion/minion_beacon_validation_complete&quot;,
            &quot;vcomment&quot;: &quot;Valid beacon configuration&quot;,
        },
        {
            &quot;complete&quot;: True,
            &quot;tag&quot;: &quot;/salt/minion/minion_beacon_add_complete&quot;,
            &quot;beacons&quot;: {
                &quot;beacon_service_sshd&quot;: [
                    {
                        &quot;services&quot;: {
                            &quot;sshd&quot;: {
                                &quot;onchangeonly&quot;: True,
                                &quot;delay&quot;: 0,
                                &quot;uncleanshutdown&quot;: None,
                                &quot;emitatstartup&quot;: False,
                            },
                        }
                    },
                    {&quot;interval&quot;: 60},
                    {&quot;beacon_module&quot;: &quot;service&quot;},
                ]
            },
        },
    ]
    mock = MagicMock(return_value=True)
    beacon_state_mocks = {
        &quot;beacons.list&quot;: beaconmod.list_,
        &quot;beacons.add&quot;: beaconmod.add,
        &quot;beacons.list_available&quot;: beaconmod.list_available,
        &quot;event.fire&quot;: mock,
    }

    beacon_mod_mocks = {&quot;event.fire&quot;: mock}

    sock_dir = str(tmp_path / &quot;test-socks&quot;)
    with patch.dict(service.__states__, {&quot;beacon.present&quot;: beaconstate.present}):
        with patch.dict(beaconstate.__salt__, beacon_state_mocks):
            with patch.dict(beaconmod.__salt__, beacon_mod_mocks):
                with patch.dict(
                    beaconmod.__opts__, {&quot;beacons&quot;: {}, &quot;sock_dir&quot;: sock_dir}
                ):
                    with patch.object(
                        SaltEvent, &quot;get_event&quot;, side_effect=event_returns
                    ):
                        ret = service.mod_beacon(name, sfun=&quot;running&quot;, beacon=&quot;True&quot;)
                        expected = {
                            &quot;name&quot;: &quot;beacon_service_sshd&quot;,
                            &quot;changes&quot;: {},
                            &quot;result&quot;: True,
                            &quot;comment&quot;: &quot;Adding beacon_service_sshd to beacons&quot;,
                        }

                        assert ret == expected


@pytest.mark.skip_on_darwin(reason=&quot;service.running is currently failing on OSX&quot;)
@pytest.mark.destructive_test
@pytest.mark.slow_test
def test_running_with_reload():
    &quot;&quot;&quot;
    Test that a running service is properly reloaded
    &quot;&quot;&quot;
    opts = salt.config.DEFAULT_MINION_OPTS.copy()
    opts[&quot;grains&quot;] = salt.loader.grains(opts)
    utils = salt.loader.utils(opts)
    modules = salt.loader.minion_mods(opts, utils=utils)

    service_name = &quot;cron&quot;
    cmd_name = &quot;crontab&quot;
    os_family = opts[&quot;grains&quot;][&quot;os_family&quot;]
    os_release = opts[&quot;grains&quot;][&quot;osrelease&quot;]
    if os_family == &quot;RedHat&quot;:
        service_name = &quot;crond&quot;
    elif os_family == &quot;Arch&quot;:
        service_name = &quot;sshd&quot;
        cmd_name = &quot;systemctl&quot;
    elif os_family == &quot;MacOS&quot;:
        service_name = &quot;org.ntp.ntpd&quot;
        if int(os_release.split(&quot;.&quot;)[1]) &gt;= 13:
            service_name = &quot;com.openssh.sshd&quot;
    elif os_family == &quot;Windows&quot;:
        service_name = &quot;Spooler&quot;

    if os_family != &quot;Windows&quot; and salt.utils.path.which(cmd_name) is None:
        pytest.skip(&quot;{} is not installed&quot;.format(cmd_name))

    pre_srv_enabled = (
        True if service_name in modules[&quot;service.get_enabled&quot;]() else False
    )
    post_srv_disable = False
    if not pre_srv_enabled:
        modules[&quot;service.enable&quot;](service_name)
        post_srv_disable = True

    try:
        with patch.dict(service.__grains__, opts[&quot;grains&quot;]), patch.dict(
            service.__opts__, opts
        ), patch.dict(service.__salt__, modules), patch.dict(
            service.__utils__, utils
        ), patch.dict(
            service.__opts__, {&quot;test&quot;: False}
        ), patch(
            &quot;salt.utils.systemd.offline&quot;, MagicMock(return_value=False)
        ):
            service.dead(service_name, enable=False)
            result = service.running(name=service_name, enable=True, reload=False)

        if salt.utils.platform.is_windows():
            comment = &quot;Started service {}&quot;.format(service_name)
        else:
            comment = &quot;Service {} has been enabled, and is running&quot;.format(service_name)
        expected = {
            &quot;changes&quot;: {service_name: True},
            &quot;comment&quot;: comment,
            &quot;name&quot;: service_name,
            &quot;result&quot;: True,
        }
        assert result == expected
    finally:
        if post_srv_disable:
            modules[&quot;service.disable&quot;](service_name)
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_mount.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Rupesh Tare &lt;rupesht@saltstack.com&gt;
&quot;&quot;&quot;

import logging
import os
import shutil
import sys
import textwrap

import pytest
import salt.modules.mount as mount
import salt.utils.files
import salt.utils.path
from salt.exceptions import CommandExecutionError
from tests.support.mock import MagicMock, mock_open, patch

log = logging.getLogger(__name__)


@pytest.fixture
def mock_shell_file():
    return &quot;A B C D F G\n&quot;


@pytest.fixture
def config_initial_file():
    inital_fsystem = [
        &quot;/:\n&quot;,
        &quot;\tdev\t\t= /dev/hd4\n&quot;,
        &quot;\tvfs\t\t= jfs2\n&quot;,
        &quot;\tlog\t\t= /dev/hd8\n&quot;,
        &quot;\tmount \t\t= automatic\n&quot;,
        &quot;\tcheck\t\t= false\n&quot;,
        &quot;\ttype\t\t= bootfs\n&quot;,
        &quot;\tvol\t\t= root\n&quot;,
        &quot;\tfree\t\t= true\n&quot;,
        &quot;\n&quot;,
        &quot;/home:\n&quot;,
        &quot;\tdev\t\t= /dev/hd1\n&quot;,
        &quot;\tvfs\t\t= jfs2\n&quot;,
        &quot;\tlog\t\t= /dev/hd8\n&quot;,
        &quot;\tmount\t\t= true\n&quot;,
        &quot;\tcheck\t\t= true\n&quot;,
        &quot;\tvol\t\t= /home\n&quot;,
        &quot;\tfree\t\t= false\n&quot;,
        &quot;\n&quot;,
    ]
    return inital_fsystem


@pytest.fixture
def configure_loader_modules():
    return {mount: {}}


@pytest.fixture
def tmp_sub_dir(tmp_path):
    directory = tmp_path / &quot;filesystems-dir&quot;
    directory.mkdir()

    yield directory

    shutil.rmtree(str(directory))


@pytest.fixture
def config_file(tmp_sub_dir, config_initial_file):
    filename = str(tmp_sub_dir / &quot;filesystems&quot;)

    with salt.utils.files.fopen(filename, &quot;wb&quot;) as fp:
        fp.writelines(salt.utils.data.encode(config_initial_file))

    yield filename

    os.remove(filename)


def test_active():
    &quot;&quot;&quot;
    List the active mounts.
    &quot;&quot;&quot;
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;FreeBSD&quot;, &quot;kernel&quot;: &quot;FreeBSD&quot;}):
        # uid=user1 tests the improbable case where a OS returns a name
        # instead of a numeric id, for #25293
        mock = MagicMock(return_value=&quot;A B C D,E,F,uid=user1,gid=grp1&quot;)
        mock_user = MagicMock(return_value={&quot;uid&quot;: &quot;100&quot;})
        mock_group = MagicMock(return_value={&quot;gid&quot;: &quot;100&quot;})
        with patch.dict(
            mount.__salt__,
            {
                &quot;cmd.run_stdout&quot;: mock,
                &quot;user.info&quot;: mock_user,
                &quot;group.info&quot;: mock_group,
            },
        ):
            assert mount.active() == {
                &quot;B&quot;: {
                    &quot;device&quot;: &quot;A&quot;,
                    &quot;opts&quot;: [&quot;D&quot;, &quot;E&quot;, &quot;F&quot;, &quot;uid=100&quot;, &quot;gid=100&quot;],
                    &quot;fstype&quot;: &quot;C&quot;,
<A NAME="2"></A>                }
            }

    with patch.dict(mount<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match69652-0.html#2',2,'match69652-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.__grains__, {&quot;os&quot;: &quot;Solaris&quot;, &quot;kernel&quot;: &quot;SunOS&quot;}):
        mock = MagicMock(return_value=&quot;A * B * C D/E/F&quot;)
        with patch.dict(mount.__salt__, {&quot;cmd.run_stdout&quot;: mock}):
            assert mount.active() == {
                &quot;B&quot;</B></FONT>: {&quot;device&quot;: &quot;A&quot;, &quot;opts&quot;: [&quot;D&quot;, &quot;E&quot;, &quot;F&quot;], &quot;fstype&quot;: &quot;C&quot;}
            }

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}):
        mock = MagicMock(return_value=&quot;A * B * C D/E/F&quot;)
        with patch.dict(mount.__salt__, {&quot;cmd.run_stdout&quot;: mock}):
            assert mount.active() == {&quot;B&quot;: {&quot;node&quot;: &quot;A&quot;, &quot;device&quot;: &quot;*&quot;, &quot;fstype&quot;: &quot;*&quot;}}

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;OpenBSD&quot;, &quot;kernel&quot;: &quot;OpenBSD&quot;}):
        mock = MagicMock(return_value={})
        with patch.object(mount, &quot;_active_mounts_openbsd&quot;, mock):
            assert mount.active() == {}

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;MacOS&quot;, &quot;kernel&quot;: &quot;Darwin&quot;}):
        mock = MagicMock(return_value={})
        with patch.object(mount, &quot;_active_mounts_darwin&quot;, mock):
            assert mount.active() == {}

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;MacOS&quot;, &quot;kernel&quot;: &quot;Darwin&quot;}):
        mock = MagicMock(return_value={})
        with patch.object(mount, &quot;_active_mountinfo&quot;, mock):
            with patch.object(mount, &quot;_active_mounts_darwin&quot;, mock):
                assert mount.active(extended=True) == {}

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}):
        mock = MagicMock(return_value={})
        with patch.object(mount, &quot;_active_mounts_aix&quot;, mock):
            assert mount.active() == {}


def test_fstab():
    &quot;&quot;&quot;
    List the content of the fstab
    &quot;&quot;&quot;
    mock = MagicMock(return_value=False)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        assert mount.fstab() == {}

    file_data = &quot;\n&quot;.join([&quot;#&quot;, &quot;A B C D,E,F G H&quot;])
    mock = MagicMock(return_value=True)
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}), patch.object(
        os.path, &quot;isfile&quot;, mock
    ), patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=file_data)):
        fstab = mount.fstab()
        assert fstab == {
            &quot;B&quot;: {
                &quot;device&quot;: &quot;A&quot;,
                &quot;dump&quot;: &quot;G&quot;,
                &quot;fstype&quot;: &quot;C&quot;,
                &quot;opts&quot;: [&quot;D&quot;, &quot;E&quot;, &quot;F&quot;],
                &quot;pass&quot;: &quot;H&quot;,
            }
        }, fstab


def test_vfstab():
    &quot;&quot;&quot;
    List the content of the vfstab
    &quot;&quot;&quot;
    mock = MagicMock(return_value=False)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        assert mount.vfstab() == {}

    file_data = textwrap.dedent(
        &quot;&quot;&quot;\
        #
        swap        -   /tmp                tmpfs    -   yes    size=2048m
        &quot;&quot;&quot;
    )
    mock = MagicMock(return_value=True)
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;SunOS&quot;}), patch.object(
        os.path, &quot;isfile&quot;, mock
    ), patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=file_data)):
        vfstab = mount.vfstab()
        assert vfstab == {
            &quot;/tmp&quot;: {
                &quot;device&quot;: &quot;swap&quot;,
                &quot;device_fsck&quot;: &quot;-&quot;,
                &quot;fstype&quot;: &quot;tmpfs&quot;,
                &quot;mount_at_boot&quot;: &quot;yes&quot;,
                &quot;opts&quot;: [&quot;size=2048m&quot;],
                &quot;pass_fsck&quot;: &quot;-&quot;,
            }
        }, vfstab


def test_filesystems():
    &quot;&quot;&quot;
    List the content of the filesystems
    &quot;&quot;&quot;
    file_data = textwrap.dedent(
        &quot;&quot;&quot;\
        #

        &quot;&quot;&quot;
    )
    mock = MagicMock(return_value=True)
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}), patch.object(
        os.path, &quot;isfile&quot;, mock
    ), patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=file_data)):
        assert mount.filesystems() == {}

    file_data = textwrap.dedent(
        &quot;&quot;&quot;\
        #
        /home:
                dev             = /dev/hd1
                vfs             = jfs2
                log             = /dev/hd8
                mount           = true
                check           = true
                vol             = /home
                free            = false
                quota           = no

        &quot;&quot;&quot;
    )
    mock = MagicMock(return_value=True)
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}), patch.object(
        os.path, &quot;isfile&quot;, mock
    ), patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=file_data)):
        fsyst = mount.filesystems()
        test_fsyst = {
            &quot;/home&quot;: {
                &quot;dev&quot;: &quot;/dev/hd1&quot;,
                &quot;vfs&quot;: &quot;jfs2&quot;,
                &quot;log&quot;: &quot;/dev/hd8&quot;,
                &quot;mount&quot;: &quot;true&quot;,
                &quot;check&quot;: &quot;true&quot;,
                &quot;vol&quot;: &quot;/home&quot;,
                &quot;free&quot;: &quot;false&quot;,
                &quot;quota&quot;: &quot;no&quot;,
            }
        }
        assert test_fsyst == fsyst


def test_rm_fstab():
    &quot;&quot;&quot;
    Remove the mount point from the fstab
    &quot;&quot;&quot;
    mock_fstab = MagicMock(return_value={})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}):
        with patch.object(mount, &quot;fstab&quot;, mock_fstab):
            with patch(&quot;salt.utils.files.fopen&quot;, mock_open()):
                assert mount.rm_fstab(&quot;name&quot;, &quot;device&quot;)


def test_set_fstab(mock_shell_file):
    &quot;&quot;&quot;
    Tests to verify that this mount is represented in the fstab,
    change the mount to match the data passed, or add the mount
    if it is not present.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=False)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        pytest.raises(CommandExecutionError, mount.set_fstab, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;)

    mock = MagicMock(return_value=True)
    mock_read = MagicMock(side_effect=OSError)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        with patch.object(salt.utils.files, &quot;fopen&quot;, mock_read):
            pytest.raises(CommandExecutionError, mount.set_fstab, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;)

    mock = MagicMock(return_value=True)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        with patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=mock_shell_file)):
            assert mount.set_fstab(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) == &quot;new&quot;

    mock = MagicMock(return_value=True)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        with patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=mock_shell_file)):
            assert mount.set_fstab(&quot;B&quot;, &quot;A&quot;, &quot;C&quot;, &quot;D&quot;, &quot;F&quot;, &quot;G&quot;) == &quot;present&quot;

    mock = MagicMock(return_value=True)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        with patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=mock_shell_file)):
            assert mount.set_fstab(&quot;B&quot;, &quot;A&quot;, &quot;C&quot;, not_change=True) == &quot;present&quot;


def test_rm_automaster():
    &quot;&quot;&quot;
    Remove the mount point from the auto_master
    &quot;&quot;&quot;
    mock = MagicMock(return_value={})
    with patch.object(mount, &quot;automaster&quot;, mock):
        assert mount.rm_automaster(&quot;name&quot;, &quot;device&quot;)

    mock = MagicMock(return_value={&quot;name&quot;: &quot;name&quot;})
    with patch.object(mount, &quot;fstab&quot;, mock):
        assert mount.rm_automaster(&quot;name&quot;, &quot;device&quot;)


def test_set_automaster(mock_shell_file):
    &quot;&quot;&quot;
    Verify that this mount is represented in the auto_salt, change the mount
    to match the data passed, or add the mount if it is not present.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=True)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        pytest.raises(CommandExecutionError, mount.set_automaster, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;)

    mock = MagicMock(return_value=True)
    mock_read = MagicMock(side_effect=OSError)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        with patch.object(salt.utils.files, &quot;fopen&quot;, mock_read):
            pytest.raises(CommandExecutionError, mount.set_automaster, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;)

    mock = MagicMock(return_value=True)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        with patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=mock_shell_file)):
            assert mount.set_automaster(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) == &quot;new&quot;

    mock = MagicMock(return_value=True)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        with patch(
            &quot;salt.utils.files.fopen&quot;, mock_open(read_data=&quot;/..A -fstype=C,D C:B&quot;)
        ):
            assert mount.set_automaster(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;) == &quot;present&quot;

    mock = MagicMock(return_value=True)
    with patch.object(os.path, &quot;isfile&quot;, mock):
        with patch(
            &quot;salt.utils.files.fopen&quot;, mock_open(read_data=&quot;/..A -fstype=XX C:B&quot;)
        ):
            assert (
                mount.set_automaster(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, not_change=True) == &quot;present&quot;
            )


def test_automaster():
    &quot;&quot;&quot;
    Test the list the contents of the fstab
    &quot;&quot;&quot;
    assert mount.automaster() == {}


def test_rm_filesystems():
    &quot;&quot;&quot;
    Remove the mount point from the filesystems
    &quot;&quot;&quot;
    file_data = textwrap.dedent(
        &quot;&quot;&quot;\
        #

        &quot;&quot;&quot;
    )
    mock = MagicMock(return_value=True)
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}), patch.object(
        os.path, &quot;isfile&quot;, mock
    ), patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=file_data)):
        assert not mount.rm_filesystems(&quot;name&quot;, &quot;device&quot;)

    file_data = textwrap.dedent(
        &quot;&quot;&quot;\
        #
        /name:
                dev             = device
                vol             = /name

        &quot;&quot;&quot;
    )

    mock = MagicMock(return_value=True)
    mock_fsyst = MagicMock(return_value=True)
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}), patch.object(
        os.path, &quot;isfile&quot;, mock
    ), patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=file_data)):
        assert mount.rm_filesystems(&quot;/name&quot;, &quot;device&quot;)


def test_set_filesystems():
    &quot;&quot;&quot;
    Tests to verify that this mount is represented in the filesystems,
    change the mount to match the data passed, or add the mount
    if it is not present.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=False)
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}):
        with patch.object(os.path, &quot;isfile&quot;, mock):
            pytest.raises(CommandExecutionError, mount.set_filesystems, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;)

        mock_read = MagicMock(side_effect=OSError)
        with patch.object(os.path, &quot;isfile&quot;, mock):
            with patch.object(salt.utils.files, &quot;fopen&quot;, mock_read):
                pytest.raises(
                    CommandExecutionError, mount.set_filesystems, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;
                )


@pytest.mark.skipif(
    sys.version_info[0] == 3 and sys.version_info[1] &lt;= 5,
    reason=&quot;run on Python 3.6 or greater where OrderedDict is default&quot;,
)
@pytest.mark.skip_on_windows(
    reason=&quot;Not supported on Windows, does not handle tabs well&quot;
)
def test_set_filesystems_with_data(tmp_sub_dir, config_file):
    &quot;&quot;&quot;
    Tests to verify set_filesystems reads and adjusts file /etc/filesystems correctly
    &quot;&quot;&quot;
    # Note AIX uses tabs in filesystems files, hence disable warings and errors for tabs and spaces
    # pylint: disable=W8191
    # pylint: disable=E8101
    config_filepath = str(tmp_sub_dir / &quot;filesystems&quot;)
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}):
        mount.set_filesystems(
            &quot;/test_mount&quot;, &quot;/dev/hd3&quot;, &quot;jsf2&quot;, &quot;-&quot;, &quot;true&quot;, config_filepath
        )
        with salt.utils.files.fopen(config_filepath, &quot;r&quot;) as fp:
            fsys_content = fp.read()

        test_fsyst = &quot;&quot;&quot;/:
	dev		= /dev/hd4
	vfs		= jfs2
	log		= /dev/hd8
	mount		= automatic
	check		= false
	type		= bootfs
	vol		= root
	free		= true

/home:
	dev		= /dev/hd1
	vfs		= jfs2
	log		= /dev/hd8
	mount		= true
	check		= true
	vol		= /home
	free		= false

/test_mount:
	dev		= /dev/hd3
	vfstype		= jsf2
	opts		= -
	mount		= true

&quot;&quot;&quot;
    assert test_fsyst == fsys_content


def test_mount():
    &quot;&quot;&quot;
    Mount a device
    &quot;&quot;&quot;
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;MacOS&quot;}):
        mock = MagicMock(return_value=True)
        with patch.object(os.path, &quot;exists&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(mount.__salt__, {&quot;file.mkdir&quot;: None}):
                mock = MagicMock(return_value={&quot;retcode&quot;: True, &quot;stderr&quot;: True})
                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;)
                    mock.assert_called_with(
                        &quot;mount  device name &quot;, python_shell=False, runas=None
                    )

                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;, fstype=&quot;fstype&quot;)
                    mock.assert_called_with(
                        &quot;mount  -t fstype device name &quot;,
                        python_shell=False,
                        runas=None,
                    )

                mock = MagicMock(return_value={&quot;retcode&quot;: False, &quot;stderr&quot;: False})
                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;)

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;}):
        mock = MagicMock(return_value=True)
        with patch.object(os.path, &quot;exists&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(mount.__salt__, {&quot;file.mkdir&quot;: None}):
                mock = MagicMock(return_value={&quot;retcode&quot;: True, &quot;stderr&quot;: True})
                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;)
                    mock.assert_called_with(
                        &quot;mount  device name &quot;, python_shell=False, runas=None
                    )

                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;, fstype=&quot;fstype&quot;)
                    mock.assert_called_with(
                        &quot;mount  -v fstype device name &quot;,
                        python_shell=False,
                        runas=None,
                    )

                mock = MagicMock(return_value={&quot;retcode&quot;: False, &quot;stderr&quot;: False})
                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;)

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;Linux&quot;}):
        mock = MagicMock(return_value=True)
        with patch.object(os.path, &quot;exists&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(mount.__salt__, {&quot;file.mkdir&quot;: None}):
                mock = MagicMock(return_value={&quot;retcode&quot;: True, &quot;stderr&quot;: True})
                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;)
                    mock.assert_called_with(
                        &quot;mount -o defaults device name &quot;,
                        python_shell=False,
                        runas=None,
                    )

                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;, fstype=&quot;fstype&quot;)
                    mock.assert_called_with(
                        &quot;mount -o defaults -t fstype device name &quot;,
                        python_shell=False,
                        runas=None,
                    )

                mock = MagicMock(return_value={&quot;retcode&quot;: False, &quot;stderr&quot;: False})
                with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                    assert mount.mount(&quot;name&quot;, &quot;device&quot;)


def test_remount_non_mounted():
    &quot;&quot;&quot;
    Attempt to remount a device, if the device is not already mounted, mount
    is called
    &quot;&quot;&quot;
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;MacOS&quot;}):
        mock = MagicMock(return_value=[])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value=True)
            with patch.object(mount, &quot;mount&quot;, mock):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;)

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;}):
        mock = MagicMock(return_value=[])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value=True)
            with patch.object(mount, &quot;mount&quot;, mock):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;)

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;Linux&quot;}):
        mock = MagicMock(return_value=[])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value=True)
            with patch.object(mount, &quot;mount&quot;, mock):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;)


def test_remount_already_mounted_no_fstype():
    &quot;&quot;&quot;
    Attempt to remount a device already mounted that do not provides
    fstype
    &quot;&quot;&quot;
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;MacOS&quot;}):
        mock = MagicMock(return_value=[&quot;name&quot;])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value={&quot;retcode&quot;: 0})
            with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;)
                mock.assert_called_with(
                    &quot;mount -u -o noowners device name &quot;,
                    python_shell=False,
                    runas=None,
                )

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;}):
        mock = MagicMock(return_value=[&quot;name&quot;])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value={&quot;retcode&quot;: 0})
            with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;)
                mock.assert_called_with(
                    &quot;mount -o remount device name &quot;, python_shell=False, runas=None
                )

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;Linux&quot;}):
        mock = MagicMock(return_value=[&quot;name&quot;])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value={&quot;retcode&quot;: 0})
            with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;)
                mock.assert_called_with(
                    &quot;mount -o defaults,remount device name &quot;,
                    python_shell=False,
                    runas=None,
                )


def test_remount_already_mounted_with_fstype():
    &quot;&quot;&quot;
    Attempt to remount a device already mounted that do not provides
    fstype
    &quot;&quot;&quot;
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;MacOS&quot;}):
        mock = MagicMock(return_value=[&quot;name&quot;])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value={&quot;retcode&quot;: 0})
            with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;, fstype=&quot;type&quot;)
                mock.assert_called_with(
                    &quot;mount -u -o noowners -t type device name &quot;,
                    python_shell=False,
                    runas=None,
                )

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;}):
        mock = MagicMock(return_value=[&quot;name&quot;])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value={&quot;retcode&quot;: 0})
            with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;, fstype=&quot;type&quot;)
                mock.assert_called_with(
                    &quot;mount -o remount -v type device name &quot;,
                    python_shell=False,
                    runas=None,
                )

    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;Linux&quot;}):
        mock = MagicMock(return_value=[&quot;name&quot;])
        with patch.object(mount, &quot;active&quot;, mock):
            mock = MagicMock(return_value={&quot;retcode&quot;: 0})
            with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
                assert mount.remount(&quot;name&quot;, &quot;device&quot;, fstype=&quot;type&quot;)
                mock.assert_called_with(
                    &quot;mount -o defaults,remount -t type device name &quot;,
                    python_shell=False,
                    runas=None,
                )


def test_umount():
    &quot;&quot;&quot;
    Attempt to unmount a device by specifying the directory it is
    mounted on
    &quot;&quot;&quot;
    mock = MagicMock(return_value={})
    with patch.object(mount, &quot;active&quot;, mock):
        assert mount.umount(&quot;name&quot;) == &quot;name does not have anything mounted&quot;

    mock = MagicMock(return_value={&quot;name&quot;: &quot;name&quot;})
    with patch.object(mount, &quot;active&quot;, mock):
        mock = MagicMock(return_value={&quot;retcode&quot;: True, &quot;stderr&quot;: True})
        with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
            assert mount.umount(&quot;name&quot;)

        mock = MagicMock(return_value={&quot;retcode&quot;: False})
        with patch.dict(mount.__salt__, {&quot;cmd.run_all&quot;: mock}):
            assert mount.umount(&quot;name&quot;)

    # Test unmounting with guestfs util
    mock = MagicMock()
    with patch.dict(mount.__salt__, {&quot;guestfs.umount&quot;: mock}):
        mount.umount(&quot;/mountpoint&quot;, device=&quot;/path/to/my.qcow&quot;, util=&quot;guestfs&quot;)
        mock.assert_called_once_with(&quot;/mountpoint&quot;, disk=&quot;/path/to/my.qcow&quot;)


def test_is_fuse_exec():
    &quot;&quot;&quot;
    Returns true if the command passed is a fuse mountable application
    &quot;&quot;&quot;
    with patch.object(salt.utils.path, &quot;which&quot;, return_value=None):
        assert not mount.is_fuse_exec(&quot;cmd&quot;)

    def _ldd_side_effect(cmd, *args, **kwargs):
        &quot;&quot;&quot;
        Neither of these are full ldd output, but what is_fuse_exec is
        looking for is 'libfuse' in the ldd output, so these examples
        should be sufficient enough to test both the True and False cases.
        &quot;&quot;&quot;
        return {
            &quot;ldd cmd1&quot;: textwrap.dedent(
                &quot;&quot;&quot;\
                linux-vdso.so.1 (0x00007ffeaf5fb000)
                libfuse3.so.3 =&gt; /usr/lib/libfuse3.so.3 (0x00007f91e66ac000)
                &quot;&quot;&quot;
            ),
            &quot;ldd cmd2&quot;: textwrap.dedent(
                &quot;&quot;&quot;\
                linux-vdso.so.1 (0x00007ffeaf5fb000)
                &quot;&quot;&quot;
            ),
        }[cmd]
<A NAME="3"></A>
    which_mock = MagicMock(side_effect=lambda x: x)
    ldd_mock = MagicMock(side_effect=_ldd_side_effect)
    <FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match69652-0.html#3',2,'match69652-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>with patch.object(salt.utils.path, &quot;which&quot;, which_mock):
        with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: _ldd_side_effect}):
            assert mount.is_fuse_exec(</B></FONT>&quot;cmd1&quot;)
            assert not mount.is_fuse_exec(&quot;cmd2&quot;)


def test_swaps():
    &quot;&quot;&quot;
    Return a dict containing information on active swap
    &quot;&quot;&quot;
    file_data = textwrap.dedent(
        &quot;&quot;&quot;\
        Filename Type Size Used Priority
        /dev/sda1 partition 31249404 4100 -1
        &quot;&quot;&quot;
    )
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;&quot;, &quot;kernel&quot;: &quot;&quot;}):
        with patch(&quot;salt.utils.files.fopen&quot;, mock_open(read_data=file_data)):
            swaps = mount.swaps()
            assert swaps == {
                &quot;/dev/sda1&quot;: {
                    &quot;priority&quot;: &quot;-1&quot;,
                    &quot;size&quot;: &quot;31249404&quot;,
                    &quot;type&quot;: &quot;partition&quot;,
                    &quot;used&quot;: &quot;4100&quot;,
                }
            }, swaps

    file_data = textwrap.dedent(
        &quot;&quot;&quot;\
        Device Size Used Unknown Unknown Priority
        /dev/sda1 31249404 4100 unknown unknown -1
        &quot;&quot;&quot;
    )
    mock = MagicMock(return_value=file_data)
    with patch.dict(
        mount.__grains__, {&quot;os&quot;: &quot;OpenBSD&quot;, &quot;kernel&quot;: &quot;OpenBSD&quot;}
    ), patch.dict(mount.__salt__, {&quot;cmd.run_stdout&quot;: mock}):
        swaps = mount.swaps()
        assert swaps == {
            &quot;/dev/sda1&quot;: {
                &quot;priority&quot;: &quot;-1&quot;,
                &quot;size&quot;: &quot;31249404&quot;,
                &quot;type&quot;: &quot;partition&quot;,
                &quot;used&quot;: &quot;4100&quot;,
            }
        }, swaps

    file_data = textwrap.dedent(
        &quot;&quot;&quot;\
        device              maj,min        total       free
        /dev/hd6              10,  2     11776MB     11765MB
        &quot;&quot;&quot;
    )
    mock = MagicMock(return_value=file_data)
    with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;AIX&quot;, &quot;kernel&quot;: &quot;AIX&quot;}), patch.dict(
        mount.__salt__, {&quot;cmd.run_stdout&quot;: mock}
    ):
        swaps = mount.swaps()
        assert swaps == {
            &quot;/dev/hd6&quot;: {
                &quot;priority&quot;: &quot;-&quot;,
                &quot;size&quot;: 12058624,
                &quot;type&quot;: &quot;device&quot;,
                &quot;used&quot;: 11264,
            }
        }, swaps


def test_swapon():
<A NAME="1"></A>    &quot;&quot;&quot;
    Activate a swap disk
    &quot;&quot;&quot;
    mock = MagicMock(return_value={<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match69652-0.html#1',2,'match69652-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>&quot;name&quot;: &quot;name&quot;})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            assert mount.swapon(&quot;name&quot;) == {&quot;s</B></FONT>tats&quot;: &quot;name&quot;, &quot;new&quot;: False}

    mock = MagicMock(return_value={})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: mock}):
                assert mount.swapon(&quot;name&quot;, False) == {}

    mock = MagicMock(side_effect=[{}, {&quot;name&quot;: &quot;name&quot;}])
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            mock = MagicMock(return_value=None)
<A NAME="0"></A>            with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: mock}):
                assert mount.swapon(&quot;name&quot;) == {&quot;stats&quot;: &quot;name&quot;, &quot;new&quot;: True}
    ## effects of AIX
    mock = MagicMock(return_value={<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match69652-0.html#0',2,'match69652-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>&quot;name&quot;: &quot;name&quot;})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;AIX&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            assert mount.swapon(&quot;name&quot;) == {&quot;s</B></FONT>tats&quot;: &quot;name&quot;, &quot;new&quot;: False}

    mock = MagicMock(return_value={})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;AIX&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: mock}):
                assert mount.swapon(&quot;name&quot;, False) == {}

    mock = MagicMock(side_effect=[{}, {&quot;name&quot;: &quot;name&quot;}])
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;AIX&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            mock = MagicMock(return_value=None)
            with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: mock}):
                assert mount.swapon(&quot;name&quot;) == {&quot;stats&quot;: &quot;name&quot;, &quot;new&quot;: True}


def test_swapoff():
    &quot;&quot;&quot;
    Deactivate a named swap mount
    &quot;&quot;&quot;
    mock = MagicMock(return_value={})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            assert mount.swapoff(&quot;name&quot;) is None

    mock = MagicMock(return_value={&quot;name&quot;: &quot;name&quot;})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;test&quot;}):
                mock = MagicMock(return_value=None)
                with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: mock}):
                    assert not mount.swapoff(&quot;name&quot;)

    mock = MagicMock(side_effect=[{&quot;name&quot;: &quot;name&quot;}, {}])
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;test&quot;}):
                mock = MagicMock(return_value=None)
                with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: mock}):
                    assert mount.swapoff(&quot;name&quot;)

    # check on AIX
    mock = MagicMock(return_value={})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;AIX&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            assert mount.swapoff(&quot;name&quot;) is None

    mock = MagicMock(return_value={&quot;name&quot;: &quot;name&quot;})
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;AIX&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;test&quot;}):
                mock = MagicMock(return_value=None)
                with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: mock}):
                    assert not mount.swapoff(&quot;name&quot;)

    mock = MagicMock(side_effect=[{&quot;name&quot;: &quot;name&quot;}, {}])
    with patch.dict(mount.__grains__, {&quot;kernel&quot;: &quot;AIX&quot;}):
        with patch.object(mount, &quot;swaps&quot;, mock):
            with patch.dict(mount.__grains__, {&quot;os&quot;: &quot;test&quot;}):
                mock = MagicMock(return_value=None)
                with patch.dict(mount.__salt__, {&quot;cmd.run&quot;: mock}):
                    assert mount.swapoff(&quot;name&quot;)


def test_is_mounted():
    &quot;&quot;&quot;
    Provide information if the path is mounted
    &quot;&quot;&quot;
    mock = MagicMock(return_value={})
    with patch.object(mount, &quot;active&quot;, mock), patch.dict(
        mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}
    ):
        assert not mount.is_mounted(&quot;name&quot;)

    mock = MagicMock(return_value={&quot;name&quot;: &quot;name&quot;})
    with patch.object(mount, &quot;active&quot;, mock), patch.dict(
        mount.__grains__, {&quot;kernel&quot;: &quot;&quot;}
    ):
        assert mount.is_mounted(&quot;name&quot;)
</PRE>
</div>
  </div>
</body>
</html>
