<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_keystone_1.py &amp; boto3_elasticache.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_keystone_1.py &amp; boto3_elasticache.py
      </h3>
<h1 align="center">
        6.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_keystone_1.py (8.633094%)<th>boto3_elasticache.py (4.8257375%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(323-331)<td><a href="#" name="0">(914-918)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(193-201)<td><a href="#" name="1">(462-466)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(50-59)<td><a href="#" name="2">(171-427)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_keystone_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import pytest
3 from tests.support.case import ModuleCase
4 from tests.support.mixins import SaltReturnAssertsMixin
5 from tests.support.unit import skipIf
6 log = logging.getLogger(__name__)
7 NO_KEYSTONE = False
8 try:
9     import keystoneclient  # pylint: disable=import-error,unused-import
10 except ImportError:
11     NO_KEYSTONE = True
12 @skipIf(
13     NO_KEYSTONE,
14     "Please install keystoneclient and a keystone server before running"
15     "keystone integration tests.",
16 )
17 class KeystoneStateTest(ModuleCase, SaltReturnAssertsMixin):
18     endpoint = "http://localhost:35357/v2.0"
19     token = "administrator"
20     @pytest.mark.destructive_test
21     def setUp(self):
22         ret = self.run_state(
23             "keystone.service_present",
24             name="keystone",
25             description="OpenStack Identity",
26             service_type="identity",
27             connection_endpoint=self.endpoint,
28             connection_token=self.token,
29         )
30         self.assertTrue(
31             ret["keystone_|-keystone_|-keystone_|-service_present"]["result"]
32         )
33         ret = self.run_state(
34             "keystone.endpoint_present",
35             name<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="keystone",
36             region="RegionOne",
37             publicurl="http://localhost:5000/v2.0",
38             internalurl="http://localhost:5000/v2.0",
39             adminurl="http://localhost:35357/v2.0",
40             connection_endpoint=self.endpoint,
41             connection_token=self.token,
42         )
43         self.assertTrue(
44             ret[</b></font>"keystone_|-keystone_|-keystone_|-endpoint_present"]["result"]
45         )
46         ret = self.run_state(
47             "keystone.tenant_present",
48             name="admin",
49             description="Admin Project",
50             connection_endpoint=self.endpoint,
51             connection_token=self.token,
52         )
53         self.assertTrue(ret["keystone_|-admin_|-admin_|-tenant_present"]["result"])
54         ret = self.run_state(
55             "keystone.tenant_present",
56             name="demo",
57             description="Demo Project",
58             connection_endpoint=self.endpoint,
59             connection_token=self.token,
60         )
61         self.assertTrue(ret["keystone_|-demo_|-demo_|-tenant_present"]["result"])
62         ret = self.run_state(
63             "keystone.role_present",
64             name="admin",
65             connection_endpoint=self.endpoint,
66             connection_token=self.token,
67         )
68         self.assertTrue(ret["keystone_|-admin_|-admin_|-role_present"]["result"])
69         ret = self.run_state(
70             "keystone.role_present",
71             name="user",
72             connection_endpoint=self.endpoint,
73             connection_token=self.token,
74         )
75         self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
76         ret = self.run_state(
77             "keystone.user_present",
78             name="admin",
79             email="admin@example.com",
80             password="adminpass",
81             tenant="admin",
82             roles={"admin": ["admin"]},
83             connection_endpoint=self.endpoint,
84             connection_token=self.token,
85         )
86         self.assertTrue(ret["keystone_|-admin_|-admin_|-user_present"]["result"])
87         ret = self.run_state(
88             "keystone.user_present",
89             name="demo",
90             email="demo@example.com",
91             password="demopass",
92             tenant="demo",
93             roles={"demo": ["user"]},
94             connection_endpoint=self.endpoint,
95             connection_token=self.token,
96         )
97         self.assertTrue(ret["keystone_|-demo_|-demo_|-user_present"]["result"])
98     @pytest.mark.destructive_test
99     def test_keystone_v2(self):
100         ret = self.run_state(
101             "keystone.service_present",
102             name="testv2",
103             description="Nova Service",
104             service_type="compute",
105             profile="adminv2",
106         )
107         self.assertTrue(ret["keystone_|-testv2_|-testv2_|-service_present"]["result"])
108         ret = self.run_state(
109             "keystone.endpoint_present",
110             name="nova",
111             description="Nova Service",
112             publicurl="http://localhost:8774/v2.1/%(tenant_id)s",
113             internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
114             adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
115             region="RegionOne",
116             profile="adminv2",
117         )
118         self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
119         ret = self.run_state(
120             "keystone.endpoint_present",
121             name="nova",
122             description="Nova Service",
123             publicurl="http://localhost:8774/v2.1/%(tenant_id)s",
124             internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
125             adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
126             region="RegionTwo",
127             profile="adminv2",
128         )
129         self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
130         ret = self.run_state(
131             "keystone.endpoint_present",
132             name="nova",
133             description="Nova Service",
134             publicurl="http://127.0.0.1:8774/v2.1/%(tenant_id)s",
135             internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
136             adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
137             region="RegionOne",
138             profile="adminv2",
139         )
140         self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
141         ret = self.run_state(
142             "keystone.endpoint_get", name="nova", region="RegionOne", profile="adminv2"
143         )
144         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
145         self.assertTrue(
146             ret["keystone_|-testv3_|-testv3_|-endpoint_present"][
147                 "publicurl"
148             ].start_with("http://127.0.0.1")
149         )
150         ret = self.run_state(
151             "keystone.tenant_present",
152             name="test",
153             description="Test Tenant",
154             profile="adminv2",
155         )
156         self.assertTrue(ret["keystone_|-test_|-test_|-tenant_present"]["result"])
157         ret = self.run_state("keystone.role_present", name="user", profile="adminv2")
158         self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
159             "keystone.user_present",
160             name="test",
161             email<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="test@example.com",
162             tenant="test",
163             password="testpass",
164             roles={"test": ["user"]},
165             profile="adminv2",
166         )
167         self.assertTrue(ret["keystone_|-test_|-test_|-user_present"]["result"])
168         ret = self.</b></font>run_state(
169             "keystone.service_absent", name="testv2", profile="adminv2"
170         )
171         self.assertTrue(ret["keystone_|-testv2_|-testv2_|-service_absent"]["result"])
172     @pytest.mark.destructive_test
173     def test_keystone_v3(self):
174         ret = self.run_state(
175             "keystone.service_present",
176             name="testv3",
177             description="Image Service",
178             service_type="image",
179             profile="adminv3",
180         )
181         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-service_present"]["result"])
182         ret = self.run_state(
183             "keystone.endpoint_present",
184             name="testv3",
185             description="Glance Service",
186             interface="public",
187             url="http://localhost:9292",
188             region="RegionOne",
189             profile="adminv3",
190         )
191         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
192         ret = self.run_state(
193             "keystone.endpoint_present",
194             name="testv3",
195             description="Glance Service",
196             interface="internal",
197             url="http://localhost:9292",
198             region="RegionOne",
199             profile="adminv3",
200         )
201         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
202         ret = self.run_state(
203             "keystone.endpoint_present",
204             name="testv3",
205             description="Glance Service",
206             interface="admin",
207             url="http://localhost:9292",
208             region="RegionOne",
209             profile="adminv3",
210         )
211         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
212         ret = self.run_state(
213             "keystone.endpoint_present",
214             name="testv3",
215             description="Glance Service",
216             interface="public",
217             url="http://localhost:9292",
218             region="RegionTwo",
219             profile="adminv3",
220         )
221         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
222         ret = self.run_state(
223             "keystone.endpoint_present",
224             name="testv3",
225             description="Glance Service",
226             interface="internal",
227             url="http://localhost:9292",
228             region="RegionTwo",
229             profile="adminv3",
230         )
231         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
232         ret = self.run_state(
233             "keystone.endpoint_present",
234             name="testv3",
235             description="Glance Service",
236             interface="admin",
237             url="http://localhost:9292",
238             region="RegionTwo",
239             profile="adminv3",
240         )
241         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
242         ret = self.run_state(
243             "keystone.endpoint_present",
244             name="testv3",
245             description="Glance Service",
246             interface="public",
247             url="http://127.0.0.1:9292",
248             region="RegionOne",
249             profile="adminv3",
250         )
251         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
252         ret = self.run_state(
253             "keystone.endpoint_get",
254             name="testv3",
255             region="RegionOne",
256             interface="public",
257             profile="adminv3",
258         )
259         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
260         self.assertTrue(
261             ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["endpoint"]["url"]
262             == "http://127.0.0.1:9292"
263         )
264         ret = self.run_state(
265             "keystone.project_present",
266             name="testv3",
267             description="Test v3 Tenant",
268             profile="adminv3",
269         )
270         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-project_present"]["result"])
271         ret = self.run_state("keystone.role_present", name="user", profile="adminv3")
272         self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
273             "keystone.user_present",
274             name="testv3",
275             email<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="testv3@example.com",
276             project="testv3",
277             password="testv3pass",
278             roles={"testv3": ["user"]},
279             profile="adminv3",
280         )
281         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-user_present"]["result"])
282         ret = self.</b></font>run_state(
283             "keystone.service_absent", name="testv3", profile="adminv3"
284         )
285         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-service_absent"]["result"])
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto3_elasticache.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 def __virtual__():
2     if "boto3_elasticache.cache_cluster_exists" in __salt__:
3         return "boto3_elasticache"
4     return (False, "boto3_elasticcache module could not be loaded")
5 def _diff_cache_cluster(current, desired):
6     if current.get("SecurityGroups") is not None:
7         current["SecurityGroupIds"] = [
8             s["SecurityGroupId"] for s in current["SecurityGroups"]
9         ]
10     if current.get("CacheSecurityGroups") is not None:
11         current["CacheSecurityGroupNames"] = [
12             c["CacheSecurityGroupName"] for c in current["CacheSecurityGroups"]
13         ]
14     if current.get("NotificationConfiguration") is not None:
15         current["NotificationTopicArn"] = current["NotificationConfiguration"][
16             "TopicArn"
17         ]
18         current["NotificationTopicStatus"] = current["NotificationConfiguration"][
19             "TopicStatus"
20         ]
21     if current.get("CacheParameterGroup") is not None:
22         current["CacheParameterGroupName"] = current["CacheParameterGroup"][
23             "CacheParameterGroupName"
24         ]
25     modifiable = {
26         "AutoMinorVersionUpgrade": "AutoMinorVersionUpgrade",
27         "AZMode": "AZMode",
28         "CacheNodeType": "CacheNodeType",
29         "CacheNodeIdsToRemove": None,
30         "CacheParameterGroupName": "CacheParameterGroupName",
31         "CacheSecurityGroupNames": "CacheSecurityGroupNames",
32         "EngineVersion": "EngineVersion",
33         "NewAvailabilityZones": None,
34         "NotificationTopicArn": "NotificationTopicArn",
35         "NotificationTopicStatus": "NotificationTopicStatus",
36         "NumCacheNodes": "NumCacheNodes",
37         "PreferredMaintenanceWindow": "PreferredMaintenanceWindow",
38         "SecurityGroupIds": "SecurityGroupIds",
39         "SnapshotRetentionLimit": "SnapshotRetentionLimit",
40         "SnapshotWindow": "SnapshotWindow",
41     }
42     need_update = {}
43     for m, o in modifiable.items():
44         if m in desired:
45             if not o:
46                 need_update[m] = desired[m]
47             else:
48                 if m in current:
49                     if current[m] != desired[m]:
50                         need_update[m] = desired[m]
51     return need_update
52     name,
53     wait=900,
54     security_groups<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=None,
55     region=None,
56     key=None,
57     keyid=None,
58     profile=None,
59     **args
60 ):
61     ret = {"name": name, "result": True, "comment": "", "changes": {}}
62     args = {k: v for k, v in args.items() if not k.</b></font>startswith("_")}
63     current = __salt__["boto3_elasticache.describe_cache_clusters"](
64         name, region=region, key=key, keyid=keyid, profile=profile
65     )
66     if current:
67         check_update = True
68     else:
69         check_update = False
70         only_on_modify = [
71             "CacheNodeIdsToRemove",
72             "NewAvailabilityZones",
73             "NotificationTopicStatus",
74         ]
75         create_args = {}
76         for k, v in args.items():
77             if k in only_on_modify:
78                 check_update = True
79             else:
80                 create_args[k] = v
81         if __opts__["test"]:
82             ret["comment"] = "Cache cluster {} would be created.".format(name)
83             ret["result"] = None
84             return ret
85         created = __salt__["boto3_elasticache.create_cache_cluster"](
86             name,
87             wait=wait,
88             security_groups=security_groups,
89             region=region,
90             key=key,
91             keyid=keyid,
92             profile=profile,
93             **create_args
94         if created:
95             new = __salt__["boto3_elasticache.describe_cache_clusters"](
96                 name, region<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=region, key=key, keyid=keyid, profile=profile
97             )
98             ret["comment"] = "Cache cluster {} was created.".format(name)
99             ret["changes"]["old"] = None
100             ret[</b></font>"changes"]["new"] = new[0]
101         else:
102             ret["result"] = False
103             ret["comment"] = "Failed to create {} cache cluster.".format(name)
104     if check_update:
105         updated = __salt__["boto3_elasticache.describe_cache_clusters"](
106             name, region=region, key=key, keyid=keyid, profile=profile
107         )
108         need_update = _diff_cache_cluster(updated["CacheClusters"][0], args)
109         if need_update:
110             if __opts__["test"]:
111                 ret["comment"] = "Cache cluster {} would be modified.".format(name)
112                 ret["result"] = None
113                 return ret
114             modified = __salt__["boto3_elasticache.modify_cache_cluster"](
115                 name,
116                 wait=wait,
117                 security_groups=security_groups,
118                 region=region,
119                 key=key,
120                 keyid=keyid,
121                 profile=profile,
122                 **need_update
123             )
124             if modified:
125                 new = __salt__["boto3_elasticache.describe_cache_clusters"](
126                     name, region=region, key=key, keyid=keyid, profile=profile
127                 )
128                 if ret["comment"]:  # 'create' just ran...
129                     ret["comment"] += " ... and then immediately modified."
130                 else:
131                     ret["comment"] = "Cache cluster {} was modified.".format(name)
132                     ret["changes"]["old"] = current
133                 ret["changes"]["new"] = new[0]
134             else:
135                 ret["result"] = False
136                 ret["comment"] = "Failed to modify cache cluster {}.".format(name)
137         else:
138             ret["comment"] = "Cache cluster {} is in the desired state.".format(name)
139     return ret
140 def cache_cluster_absent(
141     name, wait=600, region=None, key=None, keyid=None, profile=None, **args
142 ):
143     ret = {"name": name, "result": True, "comment": "", "changes": {}}
144     args = {k: v for k, v in args.items() if not k.startswith("_")}
145     exists = __salt__["boto3_elasticache.cache_cluster_exists"](
146         name, region=region, key=key, keyid=keyid, profile=profile
147     )
148     if exists:
149         if __opts__["test"]:
150             ret["comment"] = "Cache cluster {} would be removed.".format(name)
151             ret["result"] = None
152             return ret
153         deleted = __salt__["boto3_elasticache.delete_cache_cluster"](
154             name,
155             wait=wait,
156             region=region,
157             key=key,
158             keyid=keyid,
159             profile=profile,
160             **args
161         )
162         if deleted:
163             ret["changes"]["old"] = name
164             ret["changes"]["new"] = None
165         else:
166             ret["result"] = False
167             ret["comment"] = "Failed to delete {} cache cluster.".format(name)
168     else:
169         ret["comment"] = "Cache cluster {} already absent.".format(name)
170     return ret
171 def _diff_replication_group(current, desired):
172     if current.get("AutomaticFailover") is not None:
173         current["AutomaticFailoverEnabled"] = (
174             True if current["AutomaticFailover"] in ("enabled", "enabling") else False
175         )
176     modifiable = {
177         "AutomaticFailoverEnabled": "AutomaticFailoverEnabled",
178         "AutoMinorVersionUpgrade": None,
179         "CacheNodeType": None,
180         "CacheParameterGroupName": None,
181         "CacheSecurityGroupNames": None,
182         "EngineVersion": None,
183         "NotificationTopicArn": None,
184         "NotificationTopicStatus": None,
185         "PreferredMaintenanceWindow": None,
186         "PrimaryClusterId": None,
187         "ReplicationGroupDescription": "Description",
188         "SecurityGroupIds": None,
189         "SnapshotRetentionLimit": "SnapshotRetentionLimit",
190         "SnapshottingClusterId": "SnapshottingClusterId",
191         "SnapshotWindow": "SnapshotWindow",
192     }
193     need_update = {}
194     for m, o in modifiable.items():
195         if m in desired:
196             if not o:
197                 need_update[m] = desired[m]
198             else:
199                 if m in current:
200                     if current[m] != desired[m]:
201                         need_update[m] = desired[m]
202     return need_update
203 def replication_group_present(
204     name,
205     wait=900,
206     security_groups=None,
207     region=None,
208     key=None,
209     keyid=None,
210     profile=None,
211     **args
212 ):
213     ret = {"name": name, "result": True, "comment": "", "changes": {}}
214     args = {k: v for k, v in args.items() if not k.startswith("_")}
215     current = __salt__["boto3_elasticache.describe_replication_groups"](
216         name, region=region, key=key, keyid=keyid, profile=profile
217     )
218     if current:
219         check_update = True
220     else:
221         check_update = False
222         only_on_modify = ["SnapshottingClusterId", "NotificationTopicStatus"]
223         create_args = {}
224         for k, v in args.items():
225             if k in only_on_modify:
226                 check_update = True
227             else:
228                 create_args[k] = v
229         if __opts__["test"]:
230             ret["comment"] = "Replication group {} would be created.".format(name)
231             ret["result"] = None
232             return ret
233         created = __salt__["boto3_elasticache.create_replication_group"](
234             name,
235             wait=wait,
236             security_groups=security_groups,
237             region=region,
238             key=key,
239             keyid=keyid,
240             profile=profile,
241             **create_args
242         if created:
243             new = __salt__["boto3_elasticache.describe_replication_groups"](
244                 name, region<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=region, key=key, keyid=keyid, profile=profile
245             )
246             ret["comment"] = "Replication group {} was created.".format(name)
247             ret["changes"]["old"] = None
248             ret[</b></font>"changes"]["new"] = new[0]
249         else:
250             ret["result"] = False
251             ret["comment"] = "Failed to create {} replication group.".format(name)
252     if check_update:
253         updated = __salt__["boto3_elasticache.describe_replication_groups"](
254             name, region=region, key=key, keyid=keyid, profile=profile
255         )[0]
256         need_update = _diff_replication_group(updated, args)
257         if need_update:
258             if __opts__["test"]:
259                 ret["comment"] = "Replication group {} would be modified.".format(name)
260                 ret["result"] = None
261                 return ret
262             modified = __salt__["boto3_elasticache.modify_replication_group"](
263                 name,
264                 wait=wait,
265                 security_groups=security_groups,
266                 region=region,
267                 key=key,
268                 keyid=keyid,
269                 profile=profile,
270                 **need_update
271             )
272             if modified:
273                 new = __salt__["boto3_elasticache.describe_replication_groups"](
274                     name, region=region, key=key, keyid=keyid, profile=profile
275                 )
276                 if ret["comment"]:  # 'create' just ran...
277                     ret["comment"] += " ... and then immediately modified."
278                 else:
279                     ret["comment"] = "Replication group {} was modified.".format(name)
280                     ret["changes"]["old"] = current[0] if current else None
281                 ret["changes"]["new"] = new[0]
282             else:
283                 ret["result"] = False
284                 ret["comment"] = "Failed to modify replication group {}.".format(name)
285         else:
286             ret["comment"] = "Replication group {} is in the desired state.".format(
287                 name
288             )
289     return ret
290 def replication_group_absent(
291     name, wait=600, region=None, key=None, keyid=None, profile=None, **args
292 ):
293     ret = {"name": name, "result": True, "comment": "", "changes": {}}
294     args = {k: v for k, v in args.items() if not k.startswith("_")}
295     exists = __salt__["boto3_elasticache.replication_group_exists"](
296         name, region=region, key=key, keyid=keyid, profile=profile
297     )
298     if exists:
299         if __opts__["test"]:
300             ret["comment"] = "Replication group {} would be removed.".format(name)
301             ret["result"] = None
302             return ret
303         deleted = __salt__["boto3_elasticache.delete_replication_group"](
304             name,
305             wait=wait,
306             region=region,
307             key=key,
308             keyid=keyid,
309             profile=profile,
310             **args
311         )
312         if deleted:
313             ret["changes"]["old"] = name
314             ret["changes"]["new"] = None
315         else:
316             ret["result"] = False
317             ret["comment"] = "Failed to delete {} replication group.".format(name)
318     else:
319         ret["comment"] = "Replication group {} already absent.".format(name)
320     return ret
321 def _diff_cache_subnet_group(current, desired):
322     modifiable = {
323         "CacheSubnetGroupDescription": "CacheSubnetGroupDescription",
324         "SubnetIds": "SubnetIds",
325     }
326     need_update = {}
327     for m, o in modifiable.items():
328         if m in desired:
329             if not o:
330                 need_update[m] = desired[m]
331             else:
332                 if m in current:
333                     if current[m] != desired[m]:
334                         need_update[m] = desired[m]
335     return need_update
336 def cache_subnet_group_present(
337     name, subnets=None, region=None, key=None, keyid=None, profile=None, **args
338 ):
339     ret = {"name": name, "result": True, "comment": "", "changes": {}}
340     args = {k: v for k, v in args.items() if not k.startswith("_")}
341     current = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
342         name, region=region, key=key, keyid=keyid, profile=profile
343     )
344     if current:
345         check_update = True
346     else:
347         check_update = False
348         if __opts__["test"]:
349             ret["comment"] = "Cache subnet group {} would be created.".format(name)
350             ret["result"] = None
351             return ret
352         created = __salt__["boto3_elasticache.create_cache_subnet_group"](
353             name,
354             subnets=subnets,
355             region=region,
356             key=key,
357             keyid=keyid,
358             profile=profile,
359             **args
360         )
361         if created:
362             new = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
363                 name, region=region, key=key, keyid=keyid, profile=profile
364             )
365             ret["comment"] = "Cache subnet group {} was created.".format(name)
366             ret["changes"]["old"] = None
367             ret["changes"]["new"] = new[0]
368         else:
369             ret["result"] = False
370             ret["comment"] = "Failed to create {} cache subnet group.".format(name)
371     if check_update:
372         need_update = _diff_cache_subnet_group(current, args)
373         if need_update:
374             if __opts__["test"]:
375                 ret["comment"] = "Cache subnet group {} would be modified.".format(name)
376                 ret["result"] = None
377                 return ret
378             modified = __salt__["boto3_elasticache.modify_cache_subnet_group"](
379                 name,
380                 subnets=subnets,
381                 region=region,
382                 key=key,
383                 keyid=keyid,
384                 profile=profile,
385                 **need_update
386             )
387             if modified:
388                 new = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
389                     name, region=region, key=key, keyid=keyid, profile=profile
390                 )
391                 ret["comment"] = "Cache subnet group {} was modified.".format(name)
392                 ret["changes"]["old"] = current["CacheSubetGroups"][0]
393                 ret["changes"]["new"] = new[0]
394             else:
395                 ret["result"] = False
396                 ret["comment"] = "Failed to modify cache subnet group {}.".format(name)
397         else:
398             ret["comment"] = "Cache subnet group {} is in the desired state.".format(
399                 name
400             )
401     return ret
402 def cache_subnet_group_absent(
403     name, region=None, key=None, keyid=None, profile=None, **args
404 ):
405     ret = {"name": name, "result": True, "comment": "", "changes": {}}
406     args = {k: v for k, v in args.items() if not k.startswith("_")}
407     exists = __salt__["boto3_elasticache.cache_subnet_group_exists"](
408         name, region=region, key=key, keyid=keyid, profile=profile
409     )
410     if exists:
411         if __opts__["test"]:
412             ret["comment"] = "Cache subnet group {} would be removed.".format(name)
413             ret["result"] = None
414             return ret
415         deleted = __salt__["boto3_elasticache.delete_cache_subnet_group"](
416             name, region=region, key=key, keyid=keyid, profile=profile, **args
417         )
418         if deleted:
419             ret["changes"]["old"] = name
420             ret["changes"]["new"] = None
421         else:
422             ret["result"] = False
423             ret["comment"] = "Failed to delete {} cache_subnet group.".format(name)
424     else:
425         ret["comment"] = "Cache subnet group {} already absent.".format(name)
426     return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
