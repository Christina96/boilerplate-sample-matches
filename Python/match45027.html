<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_keystone_1.py &amp; boto3_elasticache.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_keystone_1.py &amp; boto3_elasticache.py
      </h3>
<h1 align="center">
        6.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_keystone_1.py (8.633094%)<th>boto3_elasticache.py (4.8257375%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(323-331)<td><a href="#" name="0">(914-918)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(193-201)<td><a href="#" name="1">(462-466)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(50-59)<td><a href="#" name="2">(171-427)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_keystone_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import logging
import pytest
from tests.support.case import ModuleCase
from tests.support.mixins import SaltReturnAssertsMixin
from tests.support.unit import skipIf
log = logging.getLogger(__name__)
NO_KEYSTONE = False
try:
    import keystoneclient  # pylint: disable=import-error,unused-import
except ImportError:
    NO_KEYSTONE = True
@skipIf(
    NO_KEYSTONE,
    "Please install keystoneclient and a keystone server before running"
    "keystone integration tests.",
)
class KeystoneStateTest(ModuleCase, SaltReturnAssertsMixin):
    endpoint = "http://localhost:35357/v2.0"
    token = "administrator"
    @pytest.mark.destructive_test
    def setUp(self):
        ret = self.run_state(
            "keystone.service_present",
            name="keystone",
            description="OpenStack Identity",
            service_type="identity",
            connection_endpoint=self.endpoint,
            connection_token=self.token,
        )
        self.assertTrue(
            ret["keystone_|-keystone_|-keystone_|-service_present"]["result"]
        )
<a name="2"></a>
        ret = self.run_state(
            "keystone.endpoint_present",
            name<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="keystone",
            region="RegionOne",
            publicurl="http://localhost:5000/v2.0",
            internalurl="http://localhost:5000/v2.0",
            adminurl="http://localhost:35357/v2.0",
            connection_endpoint=self.endpoint,
            connection_token=self.token,
        )
        self.assertTrue(
            ret[</b></font>"keystone_|-keystone_|-keystone_|-endpoint_present"]["result"]
        )
        ret = self.run_state(
            "keystone.tenant_present",
            name="admin",
            description="Admin Project",
            connection_endpoint=self.endpoint,
            connection_token=self.token,
        )
        self.assertTrue(ret["keystone_|-admin_|-admin_|-tenant_present"]["result"])
        ret = self.run_state(
            "keystone.tenant_present",
            name="demo",
            description="Demo Project",
            connection_endpoint=self.endpoint,
            connection_token=self.token,
        )
        self.assertTrue(ret["keystone_|-demo_|-demo_|-tenant_present"]["result"])
        ret = self.run_state(
            "keystone.role_present",
            name="admin",
            connection_endpoint=self.endpoint,
            connection_token=self.token,
        )
        self.assertTrue(ret["keystone_|-admin_|-admin_|-role_present"]["result"])
        ret = self.run_state(
            "keystone.role_present",
            name="user",
            connection_endpoint=self.endpoint,
            connection_token=self.token,
        )
        self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
        ret = self.run_state(
            "keystone.user_present",
            name="admin",
            email="admin@example.com",
            password="adminpass",
            tenant="admin",
            roles={"admin": ["admin"]},
            connection_endpoint=self.endpoint,
            connection_token=self.token,
        )
        self.assertTrue(ret["keystone_|-admin_|-admin_|-user_present"]["result"])
        ret = self.run_state(
            "keystone.user_present",
            name="demo",
            email="demo@example.com",
            password="demopass",
            tenant="demo",
            roles={"demo": ["user"]},
            connection_endpoint=self.endpoint,
            connection_token=self.token,
        )
        self.assertTrue(ret["keystone_|-demo_|-demo_|-user_present"]["result"])
    @pytest.mark.destructive_test
    def test_keystone_v2(self):
        ret = self.run_state(
            "keystone.service_present",
            name="testv2",
            description="Nova Service",
            service_type="compute",
            profile="adminv2",
        )
        self.assertTrue(ret["keystone_|-testv2_|-testv2_|-service_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="nova",
            description="Nova Service",
            publicurl="http://localhost:8774/v2.1/%(tenant_id)s",
            internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
            adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
            region="RegionOne",
            profile="adminv2",
        )
        self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="nova",
            description="Nova Service",
            publicurl="http://localhost:8774/v2.1/%(tenant_id)s",
            internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
            adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
            region="RegionTwo",
            profile="adminv2",
        )
        self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="nova",
            description="Nova Service",
            publicurl="http://127.0.0.1:8774/v2.1/%(tenant_id)s",
            internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
            adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
            region="RegionOne",
            profile="adminv2",
        )
        self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_get", name="nova", region="RegionOne", profile="adminv2"
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        self.assertTrue(
            ret["keystone_|-testv3_|-testv3_|-endpoint_present"][
                "publicurl"
            ].start_with("http://127.0.0.1")
        )
        ret = self.run_state(
            "keystone.tenant_present",
            name="test",
            description="Test Tenant",
            profile="adminv2",
        )
        self.assertTrue(ret["keystone_|-test_|-test_|-tenant_present"]["result"])
        ret = self.run_state("keystone.role_present", name="user", profile="adminv2")
        self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
<a name="1"></a>        ret = self.run_state(
            "keystone.user_present",
            name="test",
            email<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="test@example.com",
            tenant="test",
            password="testpass",
            roles={"test": ["user"]},
            profile="adminv2",
        )
        self.assertTrue(ret["keystone_|-test_|-test_|-user_present"]["result"])
        ret = self.</b></font>run_state(
            "keystone.service_absent", name="testv2", profile="adminv2"
        )
        self.assertTrue(ret["keystone_|-testv2_|-testv2_|-service_absent"]["result"])
    @pytest.mark.destructive_test
    def test_keystone_v3(self):
        ret = self.run_state(
            "keystone.service_present",
            name="testv3",
            description="Image Service",
            service_type="image",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-service_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="testv3",
            description="Glance Service",
            interface="public",
            url="http://localhost:9292",
            region="RegionOne",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="testv3",
            description="Glance Service",
            interface="internal",
            url="http://localhost:9292",
            region="RegionOne",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="testv3",
            description="Glance Service",
            interface="admin",
            url="http://localhost:9292",
            region="RegionOne",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="testv3",
            description="Glance Service",
            interface="public",
            url="http://localhost:9292",
            region="RegionTwo",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="testv3",
            description="Glance Service",
            interface="internal",
            url="http://localhost:9292",
            region="RegionTwo",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="testv3",
            description="Glance Service",
            interface="admin",
            url="http://localhost:9292",
            region="RegionTwo",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_present",
            name="testv3",
            description="Glance Service",
            interface="public",
            url="http://127.0.0.1:9292",
            region="RegionOne",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        ret = self.run_state(
            "keystone.endpoint_get",
            name="testv3",
            region="RegionOne",
            interface="public",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
        self.assertTrue(
            ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["endpoint"]["url"]
            == "http://127.0.0.1:9292"
        )
        ret = self.run_state(
            "keystone.project_present",
            name="testv3",
            description="Test v3 Tenant",
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-project_present"]["result"])
        ret = self.run_state("keystone.role_present", name="user", profile="adminv3")
        self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
<a name="0"></a>        ret = self.run_state(
            "keystone.user_present",
            name="testv3",
            email<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="testv3@example.com",
            project="testv3",
            password="testv3pass",
            roles={"testv3": ["user"]},
            profile="adminv3",
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-user_present"]["result"])
        ret = self.</b></font>run_state(
            "keystone.service_absent", name="testv3", profile="adminv3"
        )
        self.assertTrue(ret["keystone_|-testv3_|-testv3_|-service_absent"]["result"])
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto3_elasticache.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
def __virtual__():
    if "boto3_elasticache.cache_cluster_exists" in __salt__:
        return "boto3_elasticache"
    return (False, "boto3_elasticcache module could not be loaded")
def _diff_cache_cluster(current, desired):
    if current.get("SecurityGroups") is not None:
        current["SecurityGroupIds"] = [
            s["SecurityGroupId"] for s in current["SecurityGroups"]
        ]
    if current.get("CacheSecurityGroups") is not None:
        current["CacheSecurityGroupNames"] = [
            c["CacheSecurityGroupName"] for c in current["CacheSecurityGroups"]
        ]
    if current.get("NotificationConfiguration") is not None:
        current["NotificationTopicArn"] = current["NotificationConfiguration"][
            "TopicArn"
        ]
        current["NotificationTopicStatus"] = current["NotificationConfiguration"][
            "TopicStatus"
        ]
    if current.get("CacheParameterGroup") is not None:
        current["CacheParameterGroupName"] = current["CacheParameterGroup"][
            "CacheParameterGroupName"
        ]
    modifiable = {
        "AutoMinorVersionUpgrade": "AutoMinorVersionUpgrade",
        "AZMode": "AZMode",
        "CacheNodeType": "CacheNodeType",
        "CacheNodeIdsToRemove": None,
        "CacheParameterGroupName": "CacheParameterGroupName",
        "CacheSecurityGroupNames": "CacheSecurityGroupNames",
        "EngineVersion": "EngineVersion",
        "NewAvailabilityZones": None,
        "NotificationTopicArn": "NotificationTopicArn",
        "NotificationTopicStatus": "NotificationTopicStatus",
        "NumCacheNodes": "NumCacheNodes",
        "PreferredMaintenanceWindow": "PreferredMaintenanceWindow",
        "SecurityGroupIds": "SecurityGroupIds",
        "SnapshotRetentionLimit": "SnapshotRetentionLimit",
        "SnapshotWindow": "SnapshotWindow",
    }
    need_update = {}
    for m, o in modifiable.items():
        if m in desired:
            if not o:
                need_update[m] = desired[m]
            else:
                if m in current:
                    if current[m] != desired[m]:
                        need_update[m] = desired[m]
    return need_update
<a name="2"></a>def cache_cluster_present(
    name,
    wait=900,
    security_groups<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=None,
    region=None,
    key=None,
    keyid=None,
    profile=None,
    **args
):
    ret = {"name": name, "result": True, "comment": "", "changes": {}}
    args = {k: v for k, v in args.items() if not k.</b></font>startswith("_")}
    current = __salt__["boto3_elasticache.describe_cache_clusters"](
        name, region=region, key=key, keyid=keyid, profile=profile
    )
    if current:
        check_update = True
    else:
        check_update = False
        only_on_modify = [
            "CacheNodeIdsToRemove",
            "NewAvailabilityZones",
            "NotificationTopicStatus",
        ]
        create_args = {}
        for k, v in args.items():
            if k in only_on_modify:
                check_update = True
            else:
                create_args[k] = v
        if __opts__["test"]:
            ret["comment"] = "Cache cluster {} would be created.".format(name)
            ret["result"] = None
            return ret
        created = __salt__["boto3_elasticache.create_cache_cluster"](
            name,
            wait=wait,
            security_groups=security_groups,
            region=region,
            key=key,
            keyid=keyid,
            profile=profile,
            **create_args
<a name="1"></a>        )
        if created:
            new = __salt__["boto3_elasticache.describe_cache_clusters"](
                name, region<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=region, key=key, keyid=keyid, profile=profile
            )
            ret["comment"] = "Cache cluster {} was created.".format(name)
            ret["changes"]["old"] = None
            ret[</b></font>"changes"]["new"] = new[0]
        else:
            ret["result"] = False
            ret["comment"] = "Failed to create {} cache cluster.".format(name)
    if check_update:
        updated = __salt__["boto3_elasticache.describe_cache_clusters"](
            name, region=region, key=key, keyid=keyid, profile=profile
        )
        need_update = _diff_cache_cluster(updated["CacheClusters"][0], args)
        if need_update:
            if __opts__["test"]:
                ret["comment"] = "Cache cluster {} would be modified.".format(name)
                ret["result"] = None
                return ret
            modified = __salt__["boto3_elasticache.modify_cache_cluster"](
                name,
                wait=wait,
                security_groups=security_groups,
                region=region,
                key=key,
                keyid=keyid,
                profile=profile,
                **need_update
            )
            if modified:
                new = __salt__["boto3_elasticache.describe_cache_clusters"](
                    name, region=region, key=key, keyid=keyid, profile=profile
                )
                if ret["comment"]:  # 'create' just ran...
                    ret["comment"] += " ... and then immediately modified."
                else:
                    ret["comment"] = "Cache cluster {} was modified.".format(name)
                    ret["changes"]["old"] = current
                ret["changes"]["new"] = new[0]
            else:
                ret["result"] = False
                ret["comment"] = "Failed to modify cache cluster {}.".format(name)
        else:
            ret["comment"] = "Cache cluster {} is in the desired state.".format(name)
    return ret
def cache_cluster_absent(
    name, wait=600, region=None, key=None, keyid=None, profile=None, **args
):
    ret = {"name": name, "result": True, "comment": "", "changes": {}}
    args = {k: v for k, v in args.items() if not k.startswith("_")}
    exists = __salt__["boto3_elasticache.cache_cluster_exists"](
        name, region=region, key=key, keyid=keyid, profile=profile
    )
    if exists:
        if __opts__["test"]:
            ret["comment"] = "Cache cluster {} would be removed.".format(name)
            ret["result"] = None
            return ret
        deleted = __salt__["boto3_elasticache.delete_cache_cluster"](
            name,
            wait=wait,
            region=region,
            key=key,
            keyid=keyid,
            profile=profile,
            **args
        )
        if deleted:
            ret["changes"]["old"] = name
            ret["changes"]["new"] = None
        else:
            ret["result"] = False
            ret["comment"] = "Failed to delete {} cache cluster.".format(name)
    else:
        ret["comment"] = "Cache cluster {} already absent.".format(name)
    return ret
def _diff_replication_group(current, desired):
    if current.get("AutomaticFailover") is not None:
        current["AutomaticFailoverEnabled"] = (
            True if current["AutomaticFailover"] in ("enabled", "enabling") else False
        )
    modifiable = {
        "AutomaticFailoverEnabled": "AutomaticFailoverEnabled",
        "AutoMinorVersionUpgrade": None,
        "CacheNodeType": None,
        "CacheParameterGroupName": None,
        "CacheSecurityGroupNames": None,
        "EngineVersion": None,
        "NotificationTopicArn": None,
        "NotificationTopicStatus": None,
        "PreferredMaintenanceWindow": None,
        "PrimaryClusterId": None,
        "ReplicationGroupDescription": "Description",
        "SecurityGroupIds": None,
        "SnapshotRetentionLimit": "SnapshotRetentionLimit",
        "SnapshottingClusterId": "SnapshottingClusterId",
        "SnapshotWindow": "SnapshotWindow",
    }
    need_update = {}
    for m, o in modifiable.items():
        if m in desired:
            if not o:
                need_update[m] = desired[m]
            else:
                if m in current:
                    if current[m] != desired[m]:
                        need_update[m] = desired[m]
    return need_update
def replication_group_present(
    name,
    wait=900,
    security_groups=None,
    region=None,
    key=None,
    keyid=None,
    profile=None,
    **args
):
    ret = {"name": name, "result": True, "comment": "", "changes": {}}
    args = {k: v for k, v in args.items() if not k.startswith("_")}
    current = __salt__["boto3_elasticache.describe_replication_groups"](
        name, region=region, key=key, keyid=keyid, profile=profile
    )
    if current:
        check_update = True
    else:
        check_update = False
        only_on_modify = ["SnapshottingClusterId", "NotificationTopicStatus"]
        create_args = {}
        for k, v in args.items():
            if k in only_on_modify:
                check_update = True
            else:
                create_args[k] = v
        if __opts__["test"]:
            ret["comment"] = "Replication group {} would be created.".format(name)
            ret["result"] = None
            return ret
        created = __salt__["boto3_elasticache.create_replication_group"](
            name,
            wait=wait,
            security_groups=security_groups,
            region=region,
            key=key,
            keyid=keyid,
            profile=profile,
            **create_args
<a name="0"></a>        )
        if created:
            new = __salt__["boto3_elasticache.describe_replication_groups"](
                name, region<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=region, key=key, keyid=keyid, profile=profile
            )
            ret["comment"] = "Replication group {} was created.".format(name)
            ret["changes"]["old"] = None
            ret[</b></font>"changes"]["new"] = new[0]
        else:
            ret["result"] = False
            ret["comment"] = "Failed to create {} replication group.".format(name)
    if check_update:
        updated = __salt__["boto3_elasticache.describe_replication_groups"](
            name, region=region, key=key, keyid=keyid, profile=profile
        )[0]
        need_update = _diff_replication_group(updated, args)
        if need_update:
            if __opts__["test"]:
                ret["comment"] = "Replication group {} would be modified.".format(name)
                ret["result"] = None
                return ret
            modified = __salt__["boto3_elasticache.modify_replication_group"](
                name,
                wait=wait,
                security_groups=security_groups,
                region=region,
                key=key,
                keyid=keyid,
                profile=profile,
                **need_update
            )
            if modified:
                new = __salt__["boto3_elasticache.describe_replication_groups"](
                    name, region=region, key=key, keyid=keyid, profile=profile
                )
                if ret["comment"]:  # 'create' just ran...
                    ret["comment"] += " ... and then immediately modified."
                else:
                    ret["comment"] = "Replication group {} was modified.".format(name)
                    ret["changes"]["old"] = current[0] if current else None
                ret["changes"]["new"] = new[0]
            else:
                ret["result"] = False
                ret["comment"] = "Failed to modify replication group {}.".format(name)
        else:
            ret["comment"] = "Replication group {} is in the desired state.".format(
                name
            )
    return ret
def replication_group_absent(
    name, wait=600, region=None, key=None, keyid=None, profile=None, **args
):
    ret = {"name": name, "result": True, "comment": "", "changes": {}}
    args = {k: v for k, v in args.items() if not k.startswith("_")}
    exists = __salt__["boto3_elasticache.replication_group_exists"](
        name, region=region, key=key, keyid=keyid, profile=profile
    )
    if exists:
        if __opts__["test"]:
            ret["comment"] = "Replication group {} would be removed.".format(name)
            ret["result"] = None
            return ret
        deleted = __salt__["boto3_elasticache.delete_replication_group"](
            name,
            wait=wait,
            region=region,
            key=key,
            keyid=keyid,
            profile=profile,
            **args
        )
        if deleted:
            ret["changes"]["old"] = name
            ret["changes"]["new"] = None
        else:
            ret["result"] = False
            ret["comment"] = "Failed to delete {} replication group.".format(name)
    else:
        ret["comment"] = "Replication group {} already absent.".format(name)
    return ret
def _diff_cache_subnet_group(current, desired):
    modifiable = {
        "CacheSubnetGroupDescription": "CacheSubnetGroupDescription",
        "SubnetIds": "SubnetIds",
    }
    need_update = {}
    for m, o in modifiable.items():
        if m in desired:
            if not o:
                need_update[m] = desired[m]
            else:
                if m in current:
                    if current[m] != desired[m]:
                        need_update[m] = desired[m]
    return need_update
def cache_subnet_group_present(
    name, subnets=None, region=None, key=None, keyid=None, profile=None, **args
):
    ret = {"name": name, "result": True, "comment": "", "changes": {}}
    args = {k: v for k, v in args.items() if not k.startswith("_")}
    current = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
        name, region=region, key=key, keyid=keyid, profile=profile
    )
    if current:
        check_update = True
    else:
        check_update = False
        if __opts__["test"]:
            ret["comment"] = "Cache subnet group {} would be created.".format(name)
            ret["result"] = None
            return ret
        created = __salt__["boto3_elasticache.create_cache_subnet_group"](
            name,
            subnets=subnets,
            region=region,
            key=key,
            keyid=keyid,
            profile=profile,
            **args
        )
        if created:
            new = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
                name, region=region, key=key, keyid=keyid, profile=profile
            )
            ret["comment"] = "Cache subnet group {} was created.".format(name)
            ret["changes"]["old"] = None
            ret["changes"]["new"] = new[0]
        else:
            ret["result"] = False
            ret["comment"] = "Failed to create {} cache subnet group.".format(name)
    if check_update:
        need_update = _diff_cache_subnet_group(current, args)
        if need_update:
            if __opts__["test"]:
                ret["comment"] = "Cache subnet group {} would be modified.".format(name)
                ret["result"] = None
                return ret
            modified = __salt__["boto3_elasticache.modify_cache_subnet_group"](
                name,
                subnets=subnets,
                region=region,
                key=key,
                keyid=keyid,
                profile=profile,
                **need_update
            )
            if modified:
                new = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
                    name, region=region, key=key, keyid=keyid, profile=profile
                )
                ret["comment"] = "Cache subnet group {} was modified.".format(name)
                ret["changes"]["old"] = current["CacheSubetGroups"][0]
                ret["changes"]["new"] = new[0]
            else:
                ret["result"] = False
                ret["comment"] = "Failed to modify cache subnet group {}.".format(name)
        else:
            ret["comment"] = "Cache subnet group {} is in the desired state.".format(
                name
            )
    return ret
def cache_subnet_group_absent(
    name, region=None, key=None, keyid=None, profile=None, **args
):
    ret = {"name": name, "result": True, "comment": "", "changes": {}}
    args = {k: v for k, v in args.items() if not k.startswith("_")}
    exists = __salt__["boto3_elasticache.cache_subnet_group_exists"](
        name, region=region, key=key, keyid=keyid, profile=profile
    )
    if exists:
        if __opts__["test"]:
            ret["comment"] = "Cache subnet group {} would be removed.".format(name)
            ret["result"] = None
            return ret
        deleted = __salt__["boto3_elasticache.delete_cache_subnet_group"](
            name, region=region, key=key, keyid=keyid, profile=profile, **args
        )
        if deleted:
            ret["changes"]["old"] = name
            ret["changes"]["new"] = None
        else:
            ret["result"] = False
            ret["comment"] = "Failed to delete {} cache_subnet group.".format(name)
    else:
        ret["comment"] = "Cache subnet group {} already absent.".format(name)
    return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
