<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_keystone_1.py &amp; boto3_elasticache.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_keystone_1.py &amp; boto3_elasticache.py
      </h3>
<h1 align="center">
        6.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_keystone_1.py (8.633094%)<th>boto3_elasticache.py (4.8257375%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(323-331)<td><a href="#" name="0">(914-918)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(193-201)<td><a href="#" name="1">(462-466)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(50-59)<td><a href="#" name="2">(171-427)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_keystone_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import pytest
3 from tests.support.case import ModuleCase
4 from tests.support.mixins import SaltReturnAssertsMixin
5 from tests.support.unit import skipIf
6 log = logging.getLogger(__name__)
7 NO_KEYSTONE = False
8 try:
9     import keystoneclient  # pylint: disable=import-error,unused-import
10 except ImportError:
11     NO_KEYSTONE = True
12 @skipIf(
13     NO_KEYSTONE,
14     "Please install keystoneclient and a keystone server before running"
15     "keystone integration tests.",
16 )
17 class KeystoneStateTest(ModuleCase, SaltReturnAssertsMixin):
18     endpoint = "http://localhost:35357/v2.0"
19     token = "administrator"
20     @pytest.mark.destructive_test
21     def setUp(self):
22         ret = self.run_state(
23             "keystone.service_present",
24             name="keystone",
25             description="OpenStack Identity",
26             service_type="identity",
27             connection_endpoint=self.endpoint,
28             connection_token=self.token,
29         )
30         self.assertTrue(
31             ret["keystone_|-keystone_|-keystone_|-service_present"]["result"]
32         )
33 <a name="2"></a>
34         ret = self.run_state(
35             "keystone.endpoint_present",
36             name<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="keystone",
37             region="RegionOne",
38             publicurl="http://localhost:5000/v2.0",
39             internalurl="http://localhost:5000/v2.0",
40             adminurl="http://localhost:35357/v2.0",
41             connection_endpoint=self.endpoint,
42             connection_token=self.token,
43         )
44         self.assertTrue(
45             ret[</b></font>"keystone_|-keystone_|-keystone_|-endpoint_present"]["result"]
46         )
47         ret = self.run_state(
48             "keystone.tenant_present",
49             name="admin",
50             description="Admin Project",
51             connection_endpoint=self.endpoint,
52             connection_token=self.token,
53         )
54         self.assertTrue(ret["keystone_|-admin_|-admin_|-tenant_present"]["result"])
55         ret = self.run_state(
56             "keystone.tenant_present",
57             name="demo",
58             description="Demo Project",
59             connection_endpoint=self.endpoint,
60             connection_token=self.token,
61         )
62         self.assertTrue(ret["keystone_|-demo_|-demo_|-tenant_present"]["result"])
63         ret = self.run_state(
64             "keystone.role_present",
65             name="admin",
66             connection_endpoint=self.endpoint,
67             connection_token=self.token,
68         )
69         self.assertTrue(ret["keystone_|-admin_|-admin_|-role_present"]["result"])
70         ret = self.run_state(
71             "keystone.role_present",
72             name="user",
73             connection_endpoint=self.endpoint,
74             connection_token=self.token,
75         )
76         self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
77         ret = self.run_state(
78             "keystone.user_present",
79             name="admin",
80             email="admin@example.com",
81             password="adminpass",
82             tenant="admin",
83             roles={"admin": ["admin"]},
84             connection_endpoint=self.endpoint,
85             connection_token=self.token,
86         )
87         self.assertTrue(ret["keystone_|-admin_|-admin_|-user_present"]["result"])
88         ret = self.run_state(
89             "keystone.user_present",
90             name="demo",
91             email="demo@example.com",
92             password="demopass",
93             tenant="demo",
94             roles={"demo": ["user"]},
95             connection_endpoint=self.endpoint,
96             connection_token=self.token,
97         )
98         self.assertTrue(ret["keystone_|-demo_|-demo_|-user_present"]["result"])
99     @pytest.mark.destructive_test
100     def test_keystone_v2(self):
101         ret = self.run_state(
102             "keystone.service_present",
103             name="testv2",
104             description="Nova Service",
105             service_type="compute",
106             profile="adminv2",
107         )
108         self.assertTrue(ret["keystone_|-testv2_|-testv2_|-service_present"]["result"])
109         ret = self.run_state(
110             "keystone.endpoint_present",
111             name="nova",
112             description="Nova Service",
113             publicurl="http://localhost:8774/v2.1/%(tenant_id)s",
114             internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
115             adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
116             region="RegionOne",
117             profile="adminv2",
118         )
119         self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
120         ret = self.run_state(
121             "keystone.endpoint_present",
122             name="nova",
123             description="Nova Service",
124             publicurl="http://localhost:8774/v2.1/%(tenant_id)s",
125             internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
126             adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
127             region="RegionTwo",
128             profile="adminv2",
129         )
130         self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
131         ret = self.run_state(
132             "keystone.endpoint_present",
133             name="nova",
134             description="Nova Service",
135             publicurl="http://127.0.0.1:8774/v2.1/%(tenant_id)s",
136             internalurl="http://localhost:8774/v2.1/%(tenant_id)s",
137             adminurl="http://localhost:8774/v2.1/%(tenant_id)s",
138             region="RegionOne",
139             profile="adminv2",
140         )
141         self.assertTrue(ret["keystone_|-nova_|-nova_|-endpoint_present"]["result"])
142         ret = self.run_state(
143             "keystone.endpoint_get", name="nova", region="RegionOne", profile="adminv2"
144         )
145         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
146         self.assertTrue(
147             ret["keystone_|-testv3_|-testv3_|-endpoint_present"][
148                 "publicurl"
149             ].start_with("http://127.0.0.1")
150         )
151         ret = self.run_state(
152             "keystone.tenant_present",
153             name="test",
154             description="Test Tenant",
155             profile="adminv2",
156         )
157         self.assertTrue(ret["keystone_|-test_|-test_|-tenant_present"]["result"])
158         ret = self.run_state("keystone.role_present", name="user", profile="adminv2")
159         self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
160 <a name="1"></a>        ret = self.run_state(
161             "keystone.user_present",
162             name="test",
163             email<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="test@example.com",
164             tenant="test",
165             password="testpass",
166             roles={"test": ["user"]},
167             profile="adminv2",
168         )
169         self.assertTrue(ret["keystone_|-test_|-test_|-user_present"]["result"])
170         ret = self.</b></font>run_state(
171             "keystone.service_absent", name="testv2", profile="adminv2"
172         )
173         self.assertTrue(ret["keystone_|-testv2_|-testv2_|-service_absent"]["result"])
174     @pytest.mark.destructive_test
175     def test_keystone_v3(self):
176         ret = self.run_state(
177             "keystone.service_present",
178             name="testv3",
179             description="Image Service",
180             service_type="image",
181             profile="adminv3",
182         )
183         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-service_present"]["result"])
184         ret = self.run_state(
185             "keystone.endpoint_present",
186             name="testv3",
187             description="Glance Service",
188             interface="public",
189             url="http://localhost:9292",
190             region="RegionOne",
191             profile="adminv3",
192         )
193         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
194         ret = self.run_state(
195             "keystone.endpoint_present",
196             name="testv3",
197             description="Glance Service",
198             interface="internal",
199             url="http://localhost:9292",
200             region="RegionOne",
201             profile="adminv3",
202         )
203         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
204         ret = self.run_state(
205             "keystone.endpoint_present",
206             name="testv3",
207             description="Glance Service",
208             interface="admin",
209             url="http://localhost:9292",
210             region="RegionOne",
211             profile="adminv3",
212         )
213         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
214         ret = self.run_state(
215             "keystone.endpoint_present",
216             name="testv3",
217             description="Glance Service",
218             interface="public",
219             url="http://localhost:9292",
220             region="RegionTwo",
221             profile="adminv3",
222         )
223         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
224         ret = self.run_state(
225             "keystone.endpoint_present",
226             name="testv3",
227             description="Glance Service",
228             interface="internal",
229             url="http://localhost:9292",
230             region="RegionTwo",
231             profile="adminv3",
232         )
233         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
234         ret = self.run_state(
235             "keystone.endpoint_present",
236             name="testv3",
237             description="Glance Service",
238             interface="admin",
239             url="http://localhost:9292",
240             region="RegionTwo",
241             profile="adminv3",
242         )
243         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
244         ret = self.run_state(
245             "keystone.endpoint_present",
246             name="testv3",
247             description="Glance Service",
248             interface="public",
249             url="http://127.0.0.1:9292",
250             region="RegionOne",
251             profile="adminv3",
252         )
253         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
254         ret = self.run_state(
255             "keystone.endpoint_get",
256             name="testv3",
257             region="RegionOne",
258             interface="public",
259             profile="adminv3",
260         )
261         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["result"])
262         self.assertTrue(
263             ret["keystone_|-testv3_|-testv3_|-endpoint_present"]["endpoint"]["url"]
264             == "http://127.0.0.1:9292"
265         )
266         ret = self.run_state(
267             "keystone.project_present",
268             name="testv3",
269             description="Test v3 Tenant",
270             profile="adminv3",
271         )
272         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-project_present"]["result"])
273         ret = self.run_state("keystone.role_present", name="user", profile="adminv3")
274         self.assertTrue(ret["keystone_|-user_|-user_|-role_present"]["result"])
275 <a name="0"></a>        ret = self.run_state(
276             "keystone.user_present",
277             name="testv3",
278             email<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="testv3@example.com",
279             project="testv3",
280             password="testv3pass",
281             roles={"testv3": ["user"]},
282             profile="adminv3",
283         )
284         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-user_present"]["result"])
285         ret = self.</b></font>run_state(
286             "keystone.service_absent", name="testv3", profile="adminv3"
287         )
288         self.assertTrue(ret["keystone_|-testv3_|-testv3_|-service_absent"]["result"])
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto3_elasticache.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 def __virtual__():
2     if "boto3_elasticache.cache_cluster_exists" in __salt__:
3         return "boto3_elasticache"
4     return (False, "boto3_elasticcache module could not be loaded")
5 def _diff_cache_cluster(current, desired):
6     if current.get("SecurityGroups") is not None:
7         current["SecurityGroupIds"] = [
8             s["SecurityGroupId"] for s in current["SecurityGroups"]
9         ]
10     if current.get("CacheSecurityGroups") is not None:
11         current["CacheSecurityGroupNames"] = [
12             c["CacheSecurityGroupName"] for c in current["CacheSecurityGroups"]
13         ]
14     if current.get("NotificationConfiguration") is not None:
15         current["NotificationTopicArn"] = current["NotificationConfiguration"][
16             "TopicArn"
17         ]
18         current["NotificationTopicStatus"] = current["NotificationConfiguration"][
19             "TopicStatus"
20         ]
21     if current.get("CacheParameterGroup") is not None:
22         current["CacheParameterGroupName"] = current["CacheParameterGroup"][
23             "CacheParameterGroupName"
24         ]
25     modifiable = {
26         "AutoMinorVersionUpgrade": "AutoMinorVersionUpgrade",
27         "AZMode": "AZMode",
28         "CacheNodeType": "CacheNodeType",
29         "CacheNodeIdsToRemove": None,
30         "CacheParameterGroupName": "CacheParameterGroupName",
31         "CacheSecurityGroupNames": "CacheSecurityGroupNames",
32         "EngineVersion": "EngineVersion",
33         "NewAvailabilityZones": None,
34         "NotificationTopicArn": "NotificationTopicArn",
35         "NotificationTopicStatus": "NotificationTopicStatus",
36         "NumCacheNodes": "NumCacheNodes",
37         "PreferredMaintenanceWindow": "PreferredMaintenanceWindow",
38         "SecurityGroupIds": "SecurityGroupIds",
39         "SnapshotRetentionLimit": "SnapshotRetentionLimit",
40         "SnapshotWindow": "SnapshotWindow",
41     }
42     need_update = {}
43     for m, o in modifiable.items():
44         if m in desired:
45             if not o:
46                 need_update[m] = desired[m]
47             else:
48                 if m in current:
49                     if current[m] != desired[m]:
50                         need_update[m] = desired[m]
51     return need_update
52 <a name="2"></a>def cache_cluster_present(
53     name,
54     wait=900,
55     security_groups<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=None,
56     region=None,
57     key=None,
58     keyid=None,
59     profile=None,
60     **args
61 ):
62     ret = {"name": name, "result": True, "comment": "", "changes": {}}
63     args = {k: v for k, v in args.items() if not k.</b></font>startswith("_")}
64     current = __salt__["boto3_elasticache.describe_cache_clusters"](
65         name, region=region, key=key, keyid=keyid, profile=profile
66     )
67     if current:
68         check_update = True
69     else:
70         check_update = False
71         only_on_modify = [
72             "CacheNodeIdsToRemove",
73             "NewAvailabilityZones",
74             "NotificationTopicStatus",
75         ]
76         create_args = {}
77         for k, v in args.items():
78             if k in only_on_modify:
79                 check_update = True
80             else:
81                 create_args[k] = v
82         if __opts__["test"]:
83             ret["comment"] = "Cache cluster {} would be created.".format(name)
84             ret["result"] = None
85             return ret
86         created = __salt__["boto3_elasticache.create_cache_cluster"](
87             name,
88             wait=wait,
89             security_groups=security_groups,
90             region=region,
91             key=key,
92             keyid=keyid,
93             profile=profile,
94             **create_args
95 <a name="1"></a>        )
96         if created:
97             new = __salt__["boto3_elasticache.describe_cache_clusters"](
98                 name, region<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=region, key=key, keyid=keyid, profile=profile
99             )
100             ret["comment"] = "Cache cluster {} was created.".format(name)
101             ret["changes"]["old"] = None
102             ret[</b></font>"changes"]["new"] = new[0]
103         else:
104             ret["result"] = False
105             ret["comment"] = "Failed to create {} cache cluster.".format(name)
106     if check_update:
107         updated = __salt__["boto3_elasticache.describe_cache_clusters"](
108             name, region=region, key=key, keyid=keyid, profile=profile
109         )
110         need_update = _diff_cache_cluster(updated["CacheClusters"][0], args)
111         if need_update:
112             if __opts__["test"]:
113                 ret["comment"] = "Cache cluster {} would be modified.".format(name)
114                 ret["result"] = None
115                 return ret
116             modified = __salt__["boto3_elasticache.modify_cache_cluster"](
117                 name,
118                 wait=wait,
119                 security_groups=security_groups,
120                 region=region,
121                 key=key,
122                 keyid=keyid,
123                 profile=profile,
124                 **need_update
125             )
126             if modified:
127                 new = __salt__["boto3_elasticache.describe_cache_clusters"](
128                     name, region=region, key=key, keyid=keyid, profile=profile
129                 )
130                 if ret["comment"]:  # 'create' just ran...
131                     ret["comment"] += " ... and then immediately modified."
132                 else:
133                     ret["comment"] = "Cache cluster {} was modified.".format(name)
134                     ret["changes"]["old"] = current
135                 ret["changes"]["new"] = new[0]
136             else:
137                 ret["result"] = False
138                 ret["comment"] = "Failed to modify cache cluster {}.".format(name)
139         else:
140             ret["comment"] = "Cache cluster {} is in the desired state.".format(name)
141     return ret
142 def cache_cluster_absent(
143     name, wait=600, region=None, key=None, keyid=None, profile=None, **args
144 ):
145     ret = {"name": name, "result": True, "comment": "", "changes": {}}
146     args = {k: v for k, v in args.items() if not k.startswith("_")}
147     exists = __salt__["boto3_elasticache.cache_cluster_exists"](
148         name, region=region, key=key, keyid=keyid, profile=profile
149     )
150     if exists:
151         if __opts__["test"]:
152             ret["comment"] = "Cache cluster {} would be removed.".format(name)
153             ret["result"] = None
154             return ret
155         deleted = __salt__["boto3_elasticache.delete_cache_cluster"](
156             name,
157             wait=wait,
158             region=region,
159             key=key,
160             keyid=keyid,
161             profile=profile,
162             **args
163         )
164         if deleted:
165             ret["changes"]["old"] = name
166             ret["changes"]["new"] = None
167         else:
168             ret["result"] = False
169             ret["comment"] = "Failed to delete {} cache cluster.".format(name)
170     else:
171         ret["comment"] = "Cache cluster {} already absent.".format(name)
172     return ret
173 def _diff_replication_group(current, desired):
174     if current.get("AutomaticFailover") is not None:
175         current["AutomaticFailoverEnabled"] = (
176             True if current["AutomaticFailover"] in ("enabled", "enabling") else False
177         )
178     modifiable = {
179         "AutomaticFailoverEnabled": "AutomaticFailoverEnabled",
180         "AutoMinorVersionUpgrade": None,
181         "CacheNodeType": None,
182         "CacheParameterGroupName": None,
183         "CacheSecurityGroupNames": None,
184         "EngineVersion": None,
185         "NotificationTopicArn": None,
186         "NotificationTopicStatus": None,
187         "PreferredMaintenanceWindow": None,
188         "PrimaryClusterId": None,
189         "ReplicationGroupDescription": "Description",
190         "SecurityGroupIds": None,
191         "SnapshotRetentionLimit": "SnapshotRetentionLimit",
192         "SnapshottingClusterId": "SnapshottingClusterId",
193         "SnapshotWindow": "SnapshotWindow",
194     }
195     need_update = {}
196     for m, o in modifiable.items():
197         if m in desired:
198             if not o:
199                 need_update[m] = desired[m]
200             else:
201                 if m in current:
202                     if current[m] != desired[m]:
203                         need_update[m] = desired[m]
204     return need_update
205 def replication_group_present(
206     name,
207     wait=900,
208     security_groups=None,
209     region=None,
210     key=None,
211     keyid=None,
212     profile=None,
213     **args
214 ):
215     ret = {"name": name, "result": True, "comment": "", "changes": {}}
216     args = {k: v for k, v in args.items() if not k.startswith("_")}
217     current = __salt__["boto3_elasticache.describe_replication_groups"](
218         name, region=region, key=key, keyid=keyid, profile=profile
219     )
220     if current:
221         check_update = True
222     else:
223         check_update = False
224         only_on_modify = ["SnapshottingClusterId", "NotificationTopicStatus"]
225         create_args = {}
226         for k, v in args.items():
227             if k in only_on_modify:
228                 check_update = True
229             else:
230                 create_args[k] = v
231         if __opts__["test"]:
232             ret["comment"] = "Replication group {} would be created.".format(name)
233             ret["result"] = None
234             return ret
235         created = __salt__["boto3_elasticache.create_replication_group"](
236             name,
237             wait=wait,
238             security_groups=security_groups,
239             region=region,
240             key=key,
241             keyid=keyid,
242             profile=profile,
243             **create_args
244 <a name="0"></a>        )
245         if created:
246             new = __salt__["boto3_elasticache.describe_replication_groups"](
247                 name, region<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=region, key=key, keyid=keyid, profile=profile
248             )
249             ret["comment"] = "Replication group {} was created.".format(name)
250             ret["changes"]["old"] = None
251             ret[</b></font>"changes"]["new"] = new[0]
252         else:
253             ret["result"] = False
254             ret["comment"] = "Failed to create {} replication group.".format(name)
255     if check_update:
256         updated = __salt__["boto3_elasticache.describe_replication_groups"](
257             name, region=region, key=key, keyid=keyid, profile=profile
258         )[0]
259         need_update = _diff_replication_group(updated, args)
260         if need_update:
261             if __opts__["test"]:
262                 ret["comment"] = "Replication group {} would be modified.".format(name)
263                 ret["result"] = None
264                 return ret
265             modified = __salt__["boto3_elasticache.modify_replication_group"](
266                 name,
267                 wait=wait,
268                 security_groups=security_groups,
269                 region=region,
270                 key=key,
271                 keyid=keyid,
272                 profile=profile,
273                 **need_update
274             )
275             if modified:
276                 new = __salt__["boto3_elasticache.describe_replication_groups"](
277                     name, region=region, key=key, keyid=keyid, profile=profile
278                 )
279                 if ret["comment"]:  # 'create' just ran...
280                     ret["comment"] += " ... and then immediately modified."
281                 else:
282                     ret["comment"] = "Replication group {} was modified.".format(name)
283                     ret["changes"]["old"] = current[0] if current else None
284                 ret["changes"]["new"] = new[0]
285             else:
286                 ret["result"] = False
287                 ret["comment"] = "Failed to modify replication group {}.".format(name)
288         else:
289             ret["comment"] = "Replication group {} is in the desired state.".format(
290                 name
291             )
292     return ret
293 def replication_group_absent(
294     name, wait=600, region=None, key=None, keyid=None, profile=None, **args
295 ):
296     ret = {"name": name, "result": True, "comment": "", "changes": {}}
297     args = {k: v for k, v in args.items() if not k.startswith("_")}
298     exists = __salt__["boto3_elasticache.replication_group_exists"](
299         name, region=region, key=key, keyid=keyid, profile=profile
300     )
301     if exists:
302         if __opts__["test"]:
303             ret["comment"] = "Replication group {} would be removed.".format(name)
304             ret["result"] = None
305             return ret
306         deleted = __salt__["boto3_elasticache.delete_replication_group"](
307             name,
308             wait=wait,
309             region=region,
310             key=key,
311             keyid=keyid,
312             profile=profile,
313             **args
314         )
315         if deleted:
316             ret["changes"]["old"] = name
317             ret["changes"]["new"] = None
318         else:
319             ret["result"] = False
320             ret["comment"] = "Failed to delete {} replication group.".format(name)
321     else:
322         ret["comment"] = "Replication group {} already absent.".format(name)
323     return ret
324 def _diff_cache_subnet_group(current, desired):
325     modifiable = {
326         "CacheSubnetGroupDescription": "CacheSubnetGroupDescription",
327         "SubnetIds": "SubnetIds",
328     }
329     need_update = {}
330     for m, o in modifiable.items():
331         if m in desired:
332             if not o:
333                 need_update[m] = desired[m]
334             else:
335                 if m in current:
336                     if current[m] != desired[m]:
337                         need_update[m] = desired[m]
338     return need_update
339 def cache_subnet_group_present(
340     name, subnets=None, region=None, key=None, keyid=None, profile=None, **args
341 ):
342     ret = {"name": name, "result": True, "comment": "", "changes": {}}
343     args = {k: v for k, v in args.items() if not k.startswith("_")}
344     current = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
345         name, region=region, key=key, keyid=keyid, profile=profile
346     )
347     if current:
348         check_update = True
349     else:
350         check_update = False
351         if __opts__["test"]:
352             ret["comment"] = "Cache subnet group {} would be created.".format(name)
353             ret["result"] = None
354             return ret
355         created = __salt__["boto3_elasticache.create_cache_subnet_group"](
356             name,
357             subnets=subnets,
358             region=region,
359             key=key,
360             keyid=keyid,
361             profile=profile,
362             **args
363         )
364         if created:
365             new = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
366                 name, region=region, key=key, keyid=keyid, profile=profile
367             )
368             ret["comment"] = "Cache subnet group {} was created.".format(name)
369             ret["changes"]["old"] = None
370             ret["changes"]["new"] = new[0]
371         else:
372             ret["result"] = False
373             ret["comment"] = "Failed to create {} cache subnet group.".format(name)
374     if check_update:
375         need_update = _diff_cache_subnet_group(current, args)
376         if need_update:
377             if __opts__["test"]:
378                 ret["comment"] = "Cache subnet group {} would be modified.".format(name)
379                 ret["result"] = None
380                 return ret
381             modified = __salt__["boto3_elasticache.modify_cache_subnet_group"](
382                 name,
383                 subnets=subnets,
384                 region=region,
385                 key=key,
386                 keyid=keyid,
387                 profile=profile,
388                 **need_update
389             )
390             if modified:
391                 new = __salt__["boto3_elasticache.describe_cache_subnet_groups"](
392                     name, region=region, key=key, keyid=keyid, profile=profile
393                 )
394                 ret["comment"] = "Cache subnet group {} was modified.".format(name)
395                 ret["changes"]["old"] = current["CacheSubetGroups"][0]
396                 ret["changes"]["new"] = new[0]
397             else:
398                 ret["result"] = False
399                 ret["comment"] = "Failed to modify cache subnet group {}.".format(name)
400         else:
401             ret["comment"] = "Cache subnet group {} is in the desired state.".format(
402                 name
403             )
404     return ret
405 def cache_subnet_group_absent(
406     name, region=None, key=None, keyid=None, profile=None, **args
407 ):
408     ret = {"name": name, "result": True, "comment": "", "changes": {}}
409     args = {k: v for k, v in args.items() if not k.startswith("_")}
410     exists = __salt__["boto3_elasticache.cache_subnet_group_exists"](
411         name, region=region, key=key, keyid=keyid, profile=profile
412     )
413     if exists:
414         if __opts__["test"]:
415             ret["comment"] = "Cache subnet group {} would be removed.".format(name)
416             ret["result"] = None
417             return ret
418         deleted = __salt__["boto3_elasticache.delete_cache_subnet_group"](
419             name, region=region, key=key, keyid=keyid, profile=profile, **args
420         )
421         if deleted:
422             ret["changes"]["old"] = name
423             ret["changes"]["new"] = None
424         else:
425             ret["result"] = False
426             ret["comment"] = "Failed to delete {} cache_subnet group.".format(name)
427     else:
428         ret["comment"] = "Cache subnet group {} already absent.".format(name)
429     return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
