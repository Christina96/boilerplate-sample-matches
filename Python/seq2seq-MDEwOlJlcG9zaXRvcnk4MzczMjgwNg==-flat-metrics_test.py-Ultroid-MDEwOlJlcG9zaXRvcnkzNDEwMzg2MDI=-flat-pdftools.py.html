
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 6.70995670995671%, Tokens: 9</h2>
        <div class="column">
            <h3>seq2seq-MDEwOlJlcG9zaXRvcnk4MzczMjgwNg==-flat-metrics_test.py</h3>
            <pre><code>1  from __future__ import absolute_import
2  from __future__ import division
3  from __future__ import print_function
4  from __future__ import unicode_literals
5  import numpy as np
6  import tensorflow as tf
7  from seq2seq.metrics import bleu
8  from seq2seq.metrics import rouge
9  from seq2seq.metrics.metric_specs import BleuMetricSpec
10  from seq2seq.metrics.metric_specs import RougeMetricSpec
11  class TestMosesBleu(tf.test.TestCase):
12    def _test_multi_bleu(self, hypotheses, references, lowercase, expected_bleu):
13      result = bleu.moses_multi_bleu(
14          hypotheses=hypotheses, references=references, lowercase=lowercase)
15      np.testing.assert_almost_equal(result, expected_bleu, decimal=2)
16    def test_multi_bleu(self):
17      self._test_multi_bleu(
18          hypotheses=np.array([
19              "The brown fox jumps over the dog 笑",
20              "The brown fox jumps over the dog 2 笑"
21          ]),
22          references=np.array([
23              "The quick brown fox jumps over the lazy dog 笑",
24              "The quick brown fox jumps over the lazy dog 笑"
25          ]),
26          lowercase=False,
27          expected_bleu=46.51)
28    def test_empty(self):
<span onclick='openModal()' class='match'>29      self._test_multi_bleu(
30          hypotheses=np.array([]),
31          references=np.array([]),
32          lowercase=False,
</span>33          expected_bleu=0.00)
34    def test_multi_bleu_lowercase(self):
35      self._test_multi_bleu(
36          hypotheses=np.array([
37              "The brown fox jumps over The Dog 笑",
38              "The brown fox jumps over The Dog 2 笑"
39          ]),
40          references=np.array([
41              "The quick brown fox jumps over the lazy dog 笑",
42              "The quick brown fox jumps over the lazy dog 笑"
43          ]),
44          lowercase=True,
45          expected_bleu=46.51)
46  class TestTextMetricSpec(tf.test.TestCase):
47    def _test_metric_spec(self, metric_spec, hyps, refs, expected_scores):
48      predictions = {"predicted_tokens": tf.placeholder(dtype=tf.string)}
49      labels = {"target_tokens": tf.placeholder(dtype=tf.string)}
50      value, update_op = metric_spec.create_metric_ops(None, labels, predictions)
51      with self.test_session() as sess:
52        sess.run(tf.global_variables_initializer())
53        sess.run(tf.local_variables_initializer())
54        scores = []
55        for hyp, ref in zip(hyps, refs):
56          hyp = hyp.split(" ")
57          ref = ref.split(" ")
58          sess.run(update_op, {
59              predictions["predicted_tokens"]: [hyp],
60              labels["target_tokens"]: [ref]
61          })
62          scores.append(sess.run(value))
63        for score, expected in zip(scores, expected_scores):
64          np.testing.assert_almost_equal(score, expected, decimal=2)
65          np.testing.assert_almost_equal(score, expected, decimal=2)
66  class TestBleuMetricSpec(TestTextMetricSpec):
67    def test_bleu(self):
68      metric_spec = BleuMetricSpec({})
69      return self._test_metric_spec(
70          metric_spec=metric_spec,
71          hyps=["A B C D E F", "A B C D E F"],
72          refs=["A B C D E F", "A B A D E F"],
73          expected_scores=[100.0, 69.19])
74  class TestRougeMetricSpec(TestTextMetricSpec):
75    def test_rouge_1_f_score(self):
76      metric_spec = RougeMetricSpec({"rouge_type":  "rouge_1/f_score"})
77      self._test_metric_spec(
78          metric_spec=metric_spec,
79          hyps=["A B C D E F", "A B C D E F"],
80          refs=["A B C D E F", "A B A D E F"],
81          expected_scores=[1.0, 0.954])
82      self._test_metric_spec(
83          metric_spec=metric_spec,
84          hyps=[],
85          refs=[],
86          expected_scores=[0.0])
87      self._test_metric_spec(
88          metric_spec=metric_spec,
89          hyps=["A"],
90          refs=["B"],
91          expected_scores=[0.0])
92    def test_rouge_2_f_score(self):
93      metric_spec = RougeMetricSpec({"rouge_type":  "rouge_2/f_score"})
94      self._test_metric_spec(
95          metric_spec=metric_spec,
96          hyps=["A B C D E F", "A B C D E F"],
97          refs=["A B C D E F", "A B A D E F"],
98          expected_scores=[1.0, 0.8])
99      self._test_metric_spec(
100          metric_spec=metric_spec,
101          hyps=[],
102          refs=[],
103          expected_scores=[0.0])
104      self._test_metric_spec(
105          metric_spec=metric_spec,
106          hyps=["A"],
107          refs=["B"],
108          expected_scores=[0.0])
109    def test_rouge_l_f_score(self):
110      metric_spec = RougeMetricSpec({"rouge_type":  "rouge_l/f_score"})
111      self._test_metric_spec(
112          metric_spec=metric_spec,
113          hyps=["A B C D E F", "A B C D E F"],
114          refs=["A B C D E F", "A B A D E F"],
115          expected_scores=[1.0, 0.916])
116      self._test_metric_spec(
117          metric_spec=metric_spec,
118          hyps=[],
119          refs=[],
120          expected_scores=[0.0])
121      self._test_metric_spec(
122          metric_spec=metric_spec,
123          hyps=["A"],
124          refs=["B"],
125          expected_scores=[0.0])
126  class TestRougeMetric(tf.test.TestCase):
127    def test_rouge(self):
128      hypotheses = np.array([
129          "The brown fox jumps over the dog 笑",
130          "The brown fox jumps over the dog 2 笑"
131      ])
132      references = np.array([
133          "The quick brown fox jumps over the lazy dog 笑",
134          "The quick brown fox jumps over the lazy dog 笑"
135      ])
136      output = rouge.rouge(hypotheses, references)
137      np.testing.assert_almost_equal(output["rouge_1/f_score"], 0.865, decimal=2)
138      np.testing.assert_almost_equal(output["rouge_2/f_score"], 0.548, decimal=2)
139      np.testing.assert_almost_equal(output["rouge_l/f_score"], 0.852, decimal=2)
140  if __name__ == "__main__":
141    tf.test.main()
</code></pre>
        </div>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-pdftools.py</h3>
            <pre><code>1  import glob
2  import os
3  import shutil
4  import time
5  import cv2
6  import numpy as np
7  try:
8      from PIL import Image
9  except ImportError:
10      Image = None
11      LOGS.info(f"{__file__}: PIL  not Installed.")
12  from PyPDF2 import PdfFileMerger, PdfFileReader, PdfFileWriter
13  from telethon.errors.rpcerrorlist import PhotoSaveFileInvalidError
14  from pyUltroid.fns.tools import four_point_transform
15  from . import (
16      HNDLR,
17      LOGS,
18      bash,
19      check_filename,
20      downloader,
21      eor,
22      get_string,
23      ultroid_cmd,
24  )
25  if not os.path.isdir("pdf"):
26      os.mkdir("pdf")
27  @ultroid_cmd(
28      pattern="pdf( (.*)|$)",
29  )
30  async def pdfseimg(event):
31      ok = await event.get_reply_message()
32      msg = event.pattern_match.group(1).strip()
33      if not (ok and (ok.document and (ok.document.mime_type == "application/pdf"))):
34          await event.eor("`Reply The pdf u Want to Download..`")
35          return
36      xx = await event.eor(get_string("com_1"))
37      file = ok.media.document
38      k = time.time()
39      filename = "hehe.pdf"
40      result = await downloader(
41          f"pdf/{filename}", file, xx, k, f"Downloading {filename}..."
42      )
43      await xx.delete()
44      pdfp = "pdf/hehe.pdf"
45      pdfp.replace(".pdf", "")
46      pdf = PdfFileReader(pdfp)
47      if not msg:
48          ok = []
49          for num in range(pdf.numPages):
50              pw = PdfFileWriter()
51              pw.addPage(pdf.getPage(num))
52              fil = os.path.join(f"pdf/ult{num + 1}.png")
53              ok.append(fil)
54              with open(fil, "wb") as f:
55                  pw.write(f)
56          os.remove(pdfp)
57          for z in ok:
58              await event.client.send_file(event.chat_id, z)
59          shutil.rmtree("pdf")
60          os.mkdir("pdf")
61          await xx.delete()
62      elif "-" in msg:
63          ok = int(msg.split("-")[-1]) - 1
64          for o in range(ok):
65              pw = PdfFileWriter()
66              pw.addPage(pdf.getPage(o))
67              with open(os.path.join("ult.png"), "wb") as f:
68                  pw.write(f)
69              await event.reply(
70                  file="ult.png",
71              )
72              os.remove("ult.png")
73          os.remove(pdfp)
74      else:
75          o = int(msg) - 1
76          pw = PdfFileWriter()
77          pw.addPage(pdf.getPage(o))
78          with open(os.path.join("ult.png"), "wb") as f:
79              pw.write(f)
80          os.remove(pdfp)
81          try:
82              await event.reply(file="ult.png")
83          except PhotoSaveFileInvalidError:
84              await event.reply(file="ult.png", force_document=True)
85          os.remove("ult.png")
86  @ultroid_cmd(
87      pattern="pdtext( (.*)|$)",
88  )
89  async def pdfsetxt(event):
90      ok = await event.get_reply_message()
91      msg = event.pattern_match.group(1).strip()
92      if not ok and ok.document and ok.document.mime_type == "application/pdf":
93          await event.eor("`Reply The pdf u Want to Download..`")
94          return
95      xx = await event.eor(get_string("com_1"))
96      file = ok.media.document
97      k = time.time()
98      filename = ok.file.name
99      result = await downloader(filename, file, xx, k, f"Downloading {filename}...")
100      await xx.delete()
101      dl = result.name
102      if not msg:
103          pdf = PdfFileReader(dl)
104          text = f"{dl.split('.')[0]}.txt"
105          with open(text, "w") as f:
106              for page_num in range(pdf.numPages):
107                  pageObj = pdf.getPage(page_num)
108                  txt = pageObj.extractText()
109                  f.write(f"Page {page_num + 1}\n")
110                  f.write("".center(100, "-"))
111                  f.write(txt)
112          await event.client.send_file(
113              event.chat_id,
114              text,
115              reply_to=event.reply_to_msg_id,
116          )
117          os.remove(text)
118          os.remove(dl)
119          return
120      if "-" in msg:
121          u, d = msg.split("-")
122          a = PdfFileReader(dl)
123          str = "".join(a.getPage(i).extractText() for i in range(int(u) - 1, int(d)))
124          text = f"{dl.split('.')[0]} {msg}.txt"
125      else:
126          u = int(msg) - 1
127          a = PdfFileReader(dl)
128          str = a.getPage(u).extractText()
129          text = f"{dl.split('.')[0]} Pg-{msg}.txt"
130      with open(text, "w") as f:
131          f.write(str)
132      await event.client.send_file(
133          event.chat_id,
134          text,
135          reply_to=event.reply_to_msg_id,
136      )
137      os.remove(text)
138      os.remove(dl)
139  @ultroid_cmd(
140      pattern="pdscan( (.*)|$)",
141  )
142  async def imgscan(event):
143      ok = await event.get_reply_message()
144      if not (ok and (ok.media)):
145          await event.eor("`Reply The pdf u Want to Download..`")
146          return
147      if not (
148          ok.photo
149          or (ok.file.name and ok.file.name.endswith(("png", "jpg", "jpeg", "webp")))
150      ):
151          await event.eor("`Reply to a Image only...`")
152          return
153      ultt = await ok.download_media()
154      xx = await event.eor(get_string("com_1"))
155      image = cv2.imread(ultt)
156      original_image = image.copy()
157      ratio = image.shape[0] / 500.0
158      hi, wid = image.shape[:2]
159      ra = 500 / float(hi)
160      dmes = (int(wid * ra), 500)
161      image = cv2.resize(image, dmes, interpolation=cv2.INTER_AREA)
162      image_yuv = cv2.cvtColor(image, cv2.COLOR_BGR2YUV)
163      image_y = np.zeros(image_yuv.shape[:2], np.uint8)
164      image_y[:, :] = image_yuv[:, :, 0]
165      image_blurred = cv2.GaussianBlur(image_y, (3, 3), 0)
166      edges = cv2.Canny(image_blurred, 50, 200, apertureSize=3)
167      contours, hierarchy = cv2.findContours(
168          edges,
169          cv2.RETR_EXTERNAL,
170          cv2.CHAIN_APPROX_SIMPLE,
171      )
172      polygons = []
173      for cnt in contours:
174          hull = cv2.convexHull(cnt)
175          polygons.append(cv2.approxPolyDP(hull, 0.01 * cv2.arcLength(hull, True), False))
176          sortedPoly = sorted(polygons, key=cv2.contourArea, reverse=True)
177          cv2.drawContours(image, sortedPoly[0], -1, (0, 0, 255), 5)
178          simplified_cnt = sortedPoly[0]
179      if len(simplified_cnt) == 4:
180          try:
181              from skimage.filters import threshold_local
182          except ImportError:
183              LOGS.info(f"Scikit-Image is not Installed.")
184              await xx.edit("`Installing Scikit-Image...\nThis may take some long...`")
185              _, __ = await bash("pip install scikit-image")
186              LOGS.info(_)
187              from skimage.filters import threshold_local
188          cropped_image = four_point_transform(
189              original_image,
190              simplified_cnt.reshape(4, 2) * ratio,
191          )
192          gray_image = cv2.cvtColor(cropped_image, cv2.COLOR_BGR2GRAY)
193          T = threshold_local(gray_image, 11, offset=10, method="gaussian")
194          ok = (gray_image > T).astype("uint8") * 255
195      if len(simplified_cnt) != 4:
196          ok = cv2.detailEnhance(original_image, sigma_s=10, sigma_r=0.15)
197      cv2.imwrite("o.png", ok)
198      image1 = Image.open("o.png")
199      im1 = image1.convert("RGB")
200      scann = f"Scanned {ultt.split('.')[0]}.pdf"
201      im1.save(scann)
202      await event.client.send_file(event.chat_id, scann, reply_to=event.reply_to_msg_id)
203      await xx.delete()
204      os.remove(ultt)
205      os.remove("o.png")
206      os.remove(scann)
207  @ultroid_cmd(
208      pattern="pdsave( (.*)|$)",
209  )
210  async def savepdf(event):
211      ok = await event.get_reply_message()
212      if not (ok and (ok.media)):
213          await eor(
214              event,
215              "`Reply to Images/pdf which u want to merge as a single pdf..`",
216          )
217          return
218      ultt = await ok.download_media()
219      if ultt.endswith(("png", "jpg", "jpeg", "webp")):
220          xx = await event.eor(get_string("com_1"))
221          image = cv2.imread(ultt)
222          original_image = image.copy()
223          ratio = image.shape[0] / 500.0
224          h_, _v = image.shape[:2]
225          m_ = 500 / float(h_)
226          image = cv2.resize(image, (int(_v * m_), 500), interpolation=cv2.INTER_AREA)
227          image_yuv = cv2.cvtColor(image, cv2.COLOR_BGR2YUV)
228          image_y = np.zeros(image_yuv.shape[:2], np.uint8)
229          image_y[:, :] = image_yuv[:, :, 0]
230          image_blurred = cv2.GaussianBlur(image_y, (3, 3), 0)
231          edges = cv2.Canny(image_blurred, 50, 200, apertureSize=3)
232          contours, hierarchy = cv2.findContours(
233              edges,
234              cv2.RETR_EXTERNAL,
235              cv2.CHAIN_APPROX_SIMPLE,
236          )
237          polygons = []
238          for cnt in contours:
239              hull = cv2.convexHull(cnt)
240              polygons.append(
241                  cv2.approxPolyDP(hull, 0.01 * cv2.arcLength(hull, True), False),
242              )
243              sortedPoly = sorted(polygons, key=cv2.contourArea, reverse=True)
244              cv2.drawContours(image, sortedPoly[0], -1, (0, 0, 255), 5)
245              simplified_cnt = sortedPoly[0]
246          if len(simplified_cnt) == 4:
247              try:
248                  from skimage.filters import threshold_local
249              except ImportError:
250                  LOGS.info(f"Scikit-Image is not Installed.")
251                  await xx.edit(
252                      "`Installing Scikit-Image...\nThis may take some long...`"
253                  )
254                  _, __ = await bash("pip install scikit-image")
255                  LOGS.info(_)
256                  from skimage.filters import threshold_local
257              cropped_image = four_point_transform(
258                  original_image,
259                  simplified_cnt.reshape(4, 2) * ratio,
260              )
261              gray_image = cv2.cvtColor(cropped_image, cv2.COLOR_BGR2GRAY)
262              T = threshold_local(gray_image, 11, offset=10, method="gaussian")
263              ok = (gray_image > T).astype("uint8") * 255
264          if len(simplified_cnt) != 4:
265              ok = cv2.detailEnhance(original_image, sigma_s=10, sigma_r=0.15)
<span onclick='openModal()' class='match'>266          cv2.imwrite("o.png", ok)
267          image1 = Image.open("o.png")
268          im1 = image1.convert("RGB")
269          a = check_filename("pdf/scan.pdf")
</span>270          im1.save(a)
271          await xx.edit(
272              f"Done, Now Reply Another Image/pdf if completed then use {HNDLR}pdsend to merge nd send all as pdf",
273          )
274          os.remove("o.png")
275      elif ultt.endswith(".pdf"):
276          a = check_filename("pdf/scan.pdf")
277          await event.client.download_media(ok, a)
278          await eor(
279              event,
280              f"Done, Now Reply Another Image/pdf if completed then use {HNDLR}pdsend to merge nd send all as pdf",
281          )
282      else:
283          await event.eor("`Reply to a Image/pdf only...`")
284      os.remove(ultt)
285  @ultroid_cmd(
286      pattern="pdsend( (.*)|$)",
287  )
288  async def sendpdf(event):
289      if not os.path.exists("pdf/scan.pdf"):
290          await eor(
291              event,
292              "first select pages by replying .pdsave of which u want to make multi page pdf file",
293          )
294          return
295      msg = event.pattern_match.group(1).strip()
296      ok = f"{msg}.pdf" if msg else "My PDF File.pdf"
297      merger = PdfFileMerger()
298      ok_ = [*sorted(afl)]
299      for item in ok_:
300          if item.endswith("pdf"):
301              merger.append(item)
302      merger.write(ok)
303      await event.client.send_file(event.chat_id, ok_, reply_to=event.reply_to_msg_id)
304      os.remove(ok_)
305      shutil.rmtree("pdf/")
306      os.makedirs("pdf/")
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from seq2seq-MDEwOlJlcG9zaXRvcnk4MzczMjgwNg==-flat-metrics_test.py</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-pdftools.py</div>
                </div>
                <div class="column column_space"><pre><code>29      self._test_multi_bleu(
30          hypotheses=np.array([]),
31          references=np.array([]),
32          lowercase=False,
</pre></code></div>
                <div class="column column_space"><pre><code>266          cv2.imwrite("o.png", ok)
267          image1 = Image.open("o.png")
268          im1 = image1.convert("RGB")
269          a = check_filename("pdf/scan.pdf")
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    