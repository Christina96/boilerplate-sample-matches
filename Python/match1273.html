<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_keyboard.py & test_boto_sns.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_keyboard.py & test_boto_sns.py
      </h3>
      <h1 align="center">
        41.5%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_keyboard.py (49.333332%)<TH>test_boto_sns.py (35.92233%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match1273-0.html#0',2,'match1273-1.html#0',3)" NAME="0">(64-71)<TD><A HREF="javascript:ZweiFrames('match1273-0.html#0',2,'match1273-1.html#0',3)" NAME="0">(94-104)</A><TD ALIGN=center><FONT COLOR="#ff0000">17</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match1273-0.html#1',2,'match1273-1.html#1',3)" NAME="1">(29-35)<TD><A HREF="javascript:ZweiFrames('match1273-0.html#1',2,'match1273-1.html#1',3)" NAME="1">(48-54)</A><TD ALIGN=center><FONT COLOR="#ff0000">17</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match1273-0.html#2',2,'match1273-1.html#2',3)" NAME="2">(41-46)<TD><A HREF="javascript:ZweiFrames('match1273-0.html#2',2,'match1273-1.html#2',3)" NAME="2">(34-38)</A><TD ALIGN=center><FONT COLOR="#d20000">14</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match1273-0.html#3',2,'match1273-1.html#3',3)" NAME="3">(71-75)<TD><A HREF="javascript:ZweiFrames('match1273-0.html#3',2,'match1273-1.html#3',3)" NAME="3">(55-63)</A><TD ALIGN=center><FONT COLOR="#c30000">13</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match1273-0.html#4',2,'match1273-1.html#4',3)" NAME="4">(36-40)<TD><A HREF="javascript:ZweiFrames('match1273-0.html#4',2,'match1273-1.html#4',3)" NAME="4">(29-33)</A><TD ALIGN=center><FONT COLOR="#c30000">13</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_keyboard.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;

import salt.states.keyboard as keyboard
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase


class KeyboardTestCase(TestCase, LoaderModuleMockMixin):
    &quot;&quot;&quot;
    Test cases for salt.states.keyboard
    &quot;&quot;&quot;

    def setup_loader_modules(self):
        return {keyboard: {}}

    # 'system' function tests: 1

    def test_system(self):
        &quot;&quot;&quot;
        Test to set the keyboard layout for the system.
        &quot;&quot;&quot;
        name = &quot;salt&quot;
<A NAME="1"></A>
        ret = {&quot;name&quot;: name, &quot;result&quot;: True, &quot;comment&quot;: &quot;&quot;, &quot;changes&quot;: {}}

        mock = MagicMock(side_effect<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match1273-1.html#1',3,'match1273-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>=[name, &quot;&quot;, &quot;&quot;, &quot;&quot;])
        mock_t = MagicMock(side_effect=[True, False])
        with patch.dict(
            keyboard.__salt__, {&quot;keyboard.get_sys&quot;: mock, &quot;keyboard.set_sys&quot;: mock_t}
<A NAME="4"></A>        ):
            comt = &quot;System layout {} already set&quot;.format(name)
            ret.update({&quot;comment&quot;</B></FONT>: comt})
            self.assertDictEqual(keyboard<FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match1273-1.html#4',3,'match1273-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.system(name), ret)

<A NAME="2"></A>            with patch.dict(keyboard.__opts__, {&quot;test&quot;: True}):
                comt = &quot;System layout {} needs to be set&quot;.format(name)
                ret.update({&quot;comment&quot;</B></FONT>: comt, &quot;result&quot;: None})
                self.assertDictEqual(keyboard<FONT color="#980517"><A HREF="javascript:ZweiFrames('match1273-1.html#2',3,'match1273-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.system(name), ret)

            with patch.dict(keyboard.__opts__, {&quot;test&quot;: False}):
                comt = &quot;Set system keyboard layout {}&quot;.format(name)
                ret.update(
                    {&quot;comment&quot;</B></FONT>: comt, &quot;result&quot;: True, &quot;changes&quot;: {&quot;layout&quot;: name}}
                )
                self.assertDictEqual(keyboard.system(name), ret)

                comt = &quot;Failed to set system keyboard layout&quot;
                ret.update({&quot;comment&quot;: comt, &quot;result&quot;: False, &quot;changes&quot;: {}})
                self.assertDictEqual(keyboard.system(name), ret)

    # 'xorg' function tests: 1

    def test_xorg(self):
        &quot;&quot;&quot;
        Test to set the keyboard layout for XOrg.
        &quot;&quot;&quot;
        name = &quot;salt&quot;
<A NAME="0"></A>
        ret = {&quot;name&quot;: name, &quot;result&quot;: True, &quot;comment&quot;: &quot;&quot;, &quot;changes&quot;: {}}

        mock = MagicMock(side_effect=[<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match1273-1.html#0',3,'match1273-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>name, &quot;&quot;, &quot;&quot;, &quot;&quot;])
        mock_t = MagicMock(side_effect=[True, False])
        with patch.dict(
            keyboard.__salt__, {&quot;keyboard.get_x&quot;: mock, &quot;keyboard.set_x&quot;: mock_t}
<A NAME="3"></A>        ):
            comt = &quot;XOrg layout {} already set&quot;.format(name)
            ret.update({&quot;comment&quot;: comt})
            self.</B></FONT>assertDictEqual(keyboard<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match1273-1.html#3',3,'match1273-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.xorg(name), ret)

            with patch.dict(keyboard.__opts__, {&quot;test&quot;: True}):
                comt = &quot;XOrg layout {} needs to be set&quot;.format(name)
                ret.update({&quot;comment&quot;</B></FONT>: comt, &quot;result&quot;: None})
                self.assertDictEqual(keyboard.xorg(name), ret)

            with patch.dict(keyboard.__opts__, {&quot;test&quot;: False}):
                comt = &quot;Set XOrg keyboard layout {}&quot;.format(name)
                ret.update(
                    {&quot;comment&quot;: comt, &quot;result&quot;: True, &quot;changes&quot;: {&quot;layout&quot;: name}}
                )
                self.assertDictEqual(keyboard.xorg(name), ret)

                comt = &quot;Failed to set XOrg keyboard layout&quot;
                ret.update({&quot;comment&quot;: comt, &quot;result&quot;: False, &quot;changes&quot;: {}})
                self.assertDictEqual(keyboard.xorg(name), ret)
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_boto_sns.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;
import pytest
import salt.states.boto_sns as boto_sns
from tests.support.mock import MagicMock, patch


@pytest.fixture
def configure_loader_modules():
    return {boto_sns: {}}


def test_present():
    &quot;&quot;&quot;
    Test to ensure the SNS topic exists.
    &quot;&quot;&quot;
    name = &quot;test.example.com.&quot;

    ret = {&quot;name&quot;: name, &quot;result&quot;: True, &quot;changes&quot;: {}, &quot;comment&quot;: &quot;&quot;}

    mock = MagicMock(side_effect=[True, False, False])
    mock_bool = MagicMock(return_value=False)
    with patch.dict(
        boto_sns.__salt__, {&quot;boto_sns.exists&quot;: mock, &quot;boto_sns.create&quot;: mock_bool}
<A NAME="4"></A>    ):
        comt = &quot;AWS SNS topic {} present.&quot;.format(name)
        ret.update({&quot;comment&quot;: comt})
        assert boto_sns<FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1273-0.html#4',2,'match1273-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.present(name) == ret

<A NAME="2"></A>        with patch.dict(boto_sns.__opts__, {&quot;test&quot;: True}):
            comt = &quot;AWS SNS topic {} is set to be created.&quot;.format(name)
            ret.update({&quot;comment&quot;</B></FONT>: comt, &quot;result&quot;: None})
            assert boto_sns<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1273-0.html#2',2,'match1273-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.present(name) == ret

        with patch.dict(boto_sns.__opts__, {&quot;test&quot;: False}):
            comt = &quot;Failed to create {} AWS SNS topic&quot;.format(name)
            ret.update({&quot;comment&quot;</B></FONT>: comt, &quot;result&quot;: False})
            assert boto_sns.present(name) == ret


def test_absent():
    &quot;&quot;&quot;
    Test to ensure the named sns topic is deleted.
<A NAME="1"></A>    &quot;&quot;&quot;
    name = &quot;test.example.com.&quot;

    ret <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1273-0.html#1',2,'match1273-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= {&quot;name&quot;: name, &quot;result&quot;: True, &quot;changes&quot;: {}, &quot;comment&quot;: &quot;&quot;}

    exists_mock = MagicMock(side_effect=[False, True, True, True, True, True, True])
    with patch.dict(boto_sns.__salt__, {&quot;boto_sns.exists&quot;: exists_mock}):
<A NAME="3"></A>        # tests topic already absent
        comt = &quot;AWS SNS topic {} does not exist.&quot;.format(name)
        ret.update({&quot;comment&quot;</B></FONT>: comt})
        assert boto_sns<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1273-0.html#3',2,'match1273-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.absent(name) == ret

        with patch.dict(boto_sns.__opts__, {&quot;test&quot;: True}):
            # tests topic present, test option, unsubscribe is False
            comt = (
                &quot;AWS SNS topic {} is set to be removed.  &quot;
                &quot;0 subscription(s) will be removed.&quot;.format(name)
            )
            ret.update({&quot;comment&quot;</B></FONT>: comt, &quot;result&quot;: None})
            assert boto_sns.absent(name) == ret

        subscriptions = [
            dict(
                Endpoint=&quot;arn:aws:lambda:us-west-2:123456789:function:test&quot;,
                Owner=123456789,
                Protocol=&quot;Lambda&quot;,
                TopicArn=&quot;arn:aws:sns:us-west-2:123456789:test&quot;,
                SubscriptionArn=&quot;arn:aws:sns:us-west-2:123456789:test:some_uuid&quot;,
            )
        ]
        with patch.dict(boto_sns.__opts__, {&quot;test&quot;: True}):
            subs_mock = MagicMock(return_value=subscriptions)
            with patch.dict(
                boto_sns.__salt__,
                {&quot;boto_sns.get_all_subscriptions_by_topic&quot;: subs_mock},
            ):
                # tests topic present, 1 subscription, test option, unsubscribe is True
                comt = (
                    &quot;AWS SNS topic {} is set to be removed.  &quot;
                    &quot;1 subscription(s) will be removed.&quot;.format(name)
                )
                ret.update({&quot;comment&quot;: comt, &quot;result&quot;: None})
                assert boto_sns.absent(name, unsubscribe=True) == ret

        subs_mock = MagicMock(return_value=subscriptions)
        unsubscribe_mock = MagicMock(side_effect=[True, False])
<A NAME="0"></A>        with patch.dict(boto_sns.__salt__, {&quot;boto_sns.unsubscribe&quot;: unsubscribe_mock}):
            with patch.dict(
                boto_sns.__salt__,
                {<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1273-0.html#0',2,'match1273-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>&quot;boto_sns.get_all_subscriptions_by_topic&quot;: subs_mock},
            ):
                delete_mock = MagicMock(side_effect=[True, True, True, False])
                with patch.dict(boto_sns.__salt__, {&quot;boto_sns.delete&quot;: delete_mock}):
                    # tests topic present, unsubscribe flag True, unsubscribe succeeded,
                    # delete succeeded
                    comt = &quot;AWS SNS topic {} deleted.&quot;.format(name)
                    ret.update(
                        {
                            &quot;changes&quot;: {
                                &quot;new&quot;</B></FONT>: None,
                                &quot;old&quot;: {&quot;topic&quot;: name, &quot;subscriptions&quot;: subscriptions},
                            },
                            &quot;result&quot;: True,
                            &quot;comment&quot;: comt,
                        }
                    )
                    assert boto_sns.absent(name, unsubscribe=True) == ret

                    # tests topic present, unsubscribe flag True, unsubscribe fails,
                    # delete succeeded
                    ret.update(
                        {
                            &quot;changes&quot;: {
                                &quot;new&quot;: {&quot;subscriptions&quot;: subscriptions},
                                &quot;old&quot;: {&quot;topic&quot;: name, &quot;subscriptions&quot;: subscriptions},
                            },
                            &quot;result&quot;: True,
                            &quot;comment&quot;: comt,
                        }
                    )
                    assert boto_sns.absent(name, unsubscribe=True) == ret

                    # tests topic present, unsubscribe flag False, delete succeeded
                    ret.update(
                        {
                            &quot;changes&quot;: {&quot;new&quot;: None, &quot;old&quot;: {&quot;topic&quot;: name}},
                            &quot;result&quot;: True,
                            &quot;comment&quot;: comt,
                        }
                    )
                    assert boto_sns.absent(name) == ret

                    # tests topic present, unsubscribe flag False, delete failed
                    comt = &quot;Failed to delete {} AWS SNS topic.&quot;.format(name)
                    ret.update({&quot;changes&quot;: {}, &quot;result&quot;: False, &quot;comment&quot;: comt})
                    assert boto_sns.absent(name) == ret
</PRE>
</div>
  </div>
</body>
</html>
