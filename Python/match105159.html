<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for voot.py &amp; leeco.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for voot.py &amp; leeco.py
      </h3>
<h1 align="center">
        5.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>voot.py (15.294118%)<th>leeco.py (3.117506%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(87-98)<td><a href="#" name="0">(339-344)</a><td align="center"><font color="#ff0000">13</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>voot.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 from .common import InfoExtractor
3 from ..utils import (
4     ExtractorError,
5     int_or_none,
6     try_get,
7     unified_timestamp,
8 )
9 class VootIE(InfoExtractor):
10     _VALID_URL = r'https?://(?:www\.)?voot\.com/(?:[^/]+/)+(?P&lt;id&gt;\d+)'
11     _GEO_COUNTRIES = ['IN']
12     _TESTS = [{
13         'url': 'https://www.voot.com/shows/ishq-ka-rang-safed/1/360558/is-this-the-end-of-kamini-/441353',
14         'info_dict': {
15             'id': '0_8ledb18o',
16             'ext': 'mp4',
17             'title': 'Ishq Ka Rang Safed - Season 01 - Episode 340',
18             'description': 'md5:06291fbbbc4dcbe21235c40c262507c1',
19             'timestamp': 1472162937,
20             'upload_date': '20160825',
21             'duration': 1146,
22             'series': 'Ishq Ka Rang Safed',
23             'season_number': 1,
24             'episode': 'Is this the end of Kamini?',
25             'episode_number': 340,
26             'view_count': int,
27             'like_count': int,
28         },
29         'params': {
30             'skip_download': True,
31         },
32         'expected_warnings': ['Failed to download m3u8 information'],
33     }, {
34         'url': 'https://www.voot.com/kids/characters/mighty-cat-masked-niyander-e-/400478/school-bag-disappears/440925',
35         'only_matching': True,
36     }, {
37         'url': 'https://www.voot.com/movies/pandavas-5/424627',
38         'only_matching': True,
39     }]
40     def _real_extract(self, url):
41         video_id = self._match_id(url)
42         media_info = self._download_json(
43             'https://wapi.voot.com/ws/ott/getMediaInfo.json', video_id,
44             query={
45                 'platform': 'Web',
46                 'pId': 2,
47                 'mediaId': video_id,
48             })
49         status_code = try_get(media_info, lambda x: x['status']['code'], int)
50         if status_code != 0:
51             raise ExtractorError(media_info['status']['message'], expected=True)
52         media = media_info['assets']
53         entry_id = media['EntryId']
54         title = media['MediaName']
55         formats = self._extract_m3u8_formats(
56             'https://cdnapisec.kaltura.com/p/1982551/playManifest/pt/https/f/applehttp/t/web/e/' + entry_id,
57             video_id, 'mp4', m3u8_id='hls')
58         self._sort_formats(formats)
59         description, series, season_number, episode, episode_number = [None] * 5
60         for meta in try_get(media, lambda x: x['Metas'], list) or []:
61             key, value = meta.get('Key'), meta.get('Value')
62             if not key or not value:
63                 continue
64             if key == 'ContentSynopsis':
65                 description = value
66             elif key == 'RefSeriesTitle':
67                 series = value
68             elif key == 'RefSeriesSeason':
69                 season_number = int_or_none(value)
70             elif key == 'EpisodeMainTitle':
71                 episode = value
72             elif key == 'EpisodeNo':
73         return {
74             <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>'extractor_key': 'Kaltura',
75             'id': entry_id,
76             'title': title,
77             'description': description,
78             'series': series,
79             'season_number': season_number,
80             'episode': episode,
81             'episode_number': episode_number,
82             'timestamp': unified_timestamp(media.get('CreationDate')),
83             'duration': int_or_none(media.get('Duration')),
84             'view_count': int_or_none(media.get('ViewCounter')),
85             'like_count': int_or_none(media.get(</b></font>'like_counter')),
86             'formats': formats,
87         }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>leeco.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import unicode_literals
2 import datetime
3 import hashlib
4 import re
5 import time
6 from .common import InfoExtractor
7 from ..compat import (
8     compat_b64decode,
9     compat_ord,
10     compat_str,
11     compat_urllib_parse_urlencode,
12 )
13 from ..utils import (
14     determine_ext,
15     encode_data_uri,
16     ExtractorError,
17     int_or_none,
18     orderedSet,
19     parse_iso8601,
20     str_or_none,
21     url_basename,
22     urshift,
23 )
24 class LeIE(InfoExtractor):
25     IE_DESC = '乐视网'
26     _VALID_URL = r'https?://(?:www\.le\.com/ptv/vplay|(?:sports\.le|(?:www\.)?lesports)\.com/(?:match|video))/(?P&lt;id&gt;\d+)\.html'
27     _GEO_COUNTRIES = ['CN']
28     _URL_TEMPLATE = 'http://www.le.com/ptv/vplay/%s.html'
29     _TESTS = [{
30         'url': 'http://www.le.com/ptv/vplay/22005890.html',
31         'md5': 'edadcfe5406976f42f9f266057ee5e40',
32         'info_dict': {
33             'id': '22005890',
34             'ext': 'mp4',
35             'title': '第87届奥斯卡颁奖礼完美落幕 《鸟人》成最大赢家',
36             'description': 'md5:a9cb175fd753e2962176b7beca21a47c',
37         },
38         'params': {
39             'hls_prefer_native': True,
40         },
41     }, {
42         'url': 'http://www.le.com/ptv/vplay/1415246.html',
43         'info_dict': {
44             'id': '1415246',
45             'ext': 'mp4',
46             'title': '美人天下01',
47             'description': 'md5:28942e650e82ed4fcc8e4de919ee854d',
48         },
49         'params': {
50             'hls_prefer_native': True,
51         },
52     }, {
53         'note': 'This video is available only in Mainland China, thus a proxy is needed',
54         'url': 'http://www.le.com/ptv/vplay/1118082.html',
55         'md5': '2424c74948a62e5f31988438979c5ad1',
56         'info_dict': {
57             'id': '1118082',
58             'ext': 'mp4',
59             'title': '与龙共舞 完整版',
60             'description': 'md5:7506a5eeb1722bb9d4068f85024e3986',
61         },
62         'params': {
63             'hls_prefer_native': True,
64         },
65     }, {
66         'url': 'http://sports.le.com/video/25737697.html',
67         'only_matching': True,
68     }, {
69         'url': 'http://www.lesports.com/match/1023203003.html',
70         'only_matching': True,
71     }, {
72         'url': 'http://sports.le.com/match/1023203003.html',
73         'only_matching': True,
74     }]
75     def ror(self, param1, param2):
76         _loc3_ = 0
77         while _loc3_ &lt; param2:
78             param1 = urshift(param1, 1) + ((param1 &amp; 1) &lt;&lt; 31)
79             _loc3_ += 1
80         return param1
81     def calc_time_key(self, param1):
82         _loc2_ = 185025305
83         return self.ror(param1, _loc2_ % 17) ^ _loc2_
84     @staticmethod
85     def decrypt_m3u8(encrypted_data):
86         if encrypted_data[:5].decode('utf-8').lower() != 'vc_01':
87             return encrypted_data
88         encrypted_data = encrypted_data[5:]
89         _loc4_ = bytearray(2 * len(encrypted_data))
90         for idx, val in enumerate(encrypted_data):
91             b = compat_ord(val)
92             _loc4_[2 * idx] = b // 16
93             _loc4_[2 * idx + 1] = b % 16
94         idx = len(_loc4_) - 11
95         _loc4_ = _loc4_[idx:] + _loc4_[:idx]
96         _loc7_ = bytearray(len(encrypted_data))
97         for i in range(len(encrypted_data)):
98             _loc7_[i] = _loc4_[2 * i] * 16 + _loc4_[2 * i + 1]
99         return bytes(_loc7_)
100     def _check_errors(self, play_json):
101         playstatus = play_json['msgs']['playstatus']
102         if playstatus['status'] == 0:
103             flag = playstatus['flag']
104             if flag == 1:
105                 self.raise_geo_restricted()
106             else:
107                 raise ExtractorError('Generic error. flag = %d' % flag, expected=True)
108     def _real_extract(self, url):
109         media_id = self._match_id(url)
110         page = self._download_webpage(url, media_id)
111         play_json_flash = self._download_json(
112             'http://player-pc.le.com/mms/out/video/playJson',
113             media_id, 'Downloading flash playJson data', query={
114                 'id': media_id,
115                 'platid': 1,
116                 'splatid': 105,
117                 'format': 1,
118                 'source': 1000,
119                 'tkey': self.calc_time_key(int(time.time())),
120                 'domain': 'www.le.com',
121                 'region': 'cn',
122             },
123             headers=self.geo_verification_headers())
124         self._check_errors(play_json_flash)
125         def get_flash_urls(media_url, format_id):
126             nodes_data = self._download_json(
127                 media_url, media_id,
128                 'Download JSON metadata for format %s' % format_id,
129                 query={
130                     'm3v': 1,
131                     'format': 1,
132                     'expect': 3,
133                     'tss': 'ios',
134                 })
135             req = self._request_webpage(
136                 nodes_data['nodelist'][0]['location'], media_id,
137                 note='Downloading m3u8 information for format %s' % format_id)
138             m3u8_data = self.decrypt_m3u8(req.read())
139             return {
140                 'hls': encode_data_uri(m3u8_data, 'application/vnd.apple.mpegurl'),
141             }
142         extracted_formats = []
143         formats = []
144         playurl = play_json_flash['msgs']['playurl']
145         play_domain = playurl['domain'][0]
146         for format_id, format_data in playurl.get('dispatch', []).items():
147             if format_id in extracted_formats:
148                 continue
149             extracted_formats.append(format_id)
150             media_url = play_domain + format_data[0]
151             for protocol, format_url in get_flash_urls(media_url, format_id).items():
152                 f = {
153                     'url': format_url,
154                     'ext': determine_ext(format_data[1]),
155                     'format_id': '%s-%s' % (protocol, format_id),
156                     'protocol': 'm3u8_native' if protocol == 'hls' else 'http',
157                     'quality': int_or_none(format_id),
158                 }
159                 if format_id[-1:] == 'p':
160                     f['height'] = int_or_none(format_id[:-1])
161                 formats.append(f)
162         self._sort_formats(formats, ('height', 'quality', 'format_id'))
163         publish_time = parse_iso8601(self._html_search_regex(
164             r'发布时间&amp;nbsp;([^&lt;&gt;]+) ', page, 'publish time', default=None),
165             delimiter=' ', timezone=datetime.timedelta(hours=8))
166         description = self._html_search_meta('description', page, fatal=False)
167         return {
168             'id': media_id,
169             'formats': formats,
170             'title': playurl['title'],
171             'thumbnail': playurl['pic'],
172             'description': description,
173             'timestamp': publish_time,
174         }
175 class LePlaylistIE(InfoExtractor):
176     _VALID_URL = r'https?://[a-z]+\.le\.com/(?!video)[a-z]+/(?P&lt;id&gt;[a-z0-9_]+)'
177     _TESTS = [{
178         'url': 'http://www.le.com/tv/46177.html',
179         'info_dict': {
180             'id': '46177',
181             'title': '美人天下',
182             'description': 'md5:395666ff41b44080396e59570dbac01c'
183         },
184         'playlist_count': 35
185     }, {
186         'url': 'http://tv.le.com/izt/wuzetian/index.html',
187         'info_dict': {
188             'id': 'wuzetian',
189             'title': '武媚娘传奇',
190             'description': 'md5:e12499475ab3d50219e5bba00b3cb248'
191         },
192         'playlist_mincount': 96
193     }, {
194         'url': 'http://tv.le.com/pzt/lswjzzjc/index.shtml',
195         'only_matching': True,
196     }, {
197         'url': 'http://www.le.com/comic/92063.html',
198         'only_matching': True,
199     }, {
200         'url': 'http://list.le.com/listn/c1009_sc532002_d2_p1_o1.html',
201         'only_matching': True,
202     }]
203     @classmethod
204     def suitable(cls, url):
205         return False if LeIE.suitable(url) else super(LePlaylistIE, cls).suitable(url)
206     def _real_extract(self, url):
207         playlist_id = self._match_id(url)
208         page = self._download_webpage(url, playlist_id)
209         media_ids = orderedSet(re.findall(
210             r'&lt;a[^&gt;]+href="http://www\.letv\.com/ptv/vplay/(\d+)\.html', page))
211         entries = [self.url_result(LeIE._URL_TEMPLATE % media_id, ie='Le')
212                    for media_id in media_ids]
213         title = self._html_search_meta('keywords', page,
214                                        fatal=False).split('，')[0]
215         description = self._html_search_meta('description', page, fatal=False)
216         return self.playlist_result(entries, playlist_id, playlist_title=title,
217                                     playlist_description=description)
218 class LetvCloudIE(InfoExtractor):
219     IE_DESC = '乐视云'
220     _VALID_URL = r'https?://yuntv\.letv\.com/bcloud.html\?.+'
221     _TESTS = [{
222         'url': 'http://yuntv.letv.com/bcloud.html?uu=p7jnfw5hw9&amp;vu=467623dedf',
223         'md5': '26450599afd64c513bc77030ad15db44',
224         'info_dict': {
225             'id': 'p7jnfw5hw9_467623dedf',
226             'ext': 'mp4',
227             'title': 'Video p7jnfw5hw9_467623dedf',
228         },
229     }, {
230         'url': 'http://yuntv.letv.com/bcloud.html?uu=p7jnfw5hw9&amp;vu=ec93197892&amp;pu=2c7cd40209&amp;auto_play=1&amp;gpcflag=1&amp;width=640&amp;height=360',
231         'md5': 'e03d9cc8d9c13191e1caf277e42dbd31',
232         'info_dict': {
233             'id': 'p7jnfw5hw9_ec93197892',
234             'ext': 'mp4',
235             'title': 'Video p7jnfw5hw9_ec93197892',
236         },
237     }, {
238         'url': 'http://yuntv.letv.com/bcloud.html?uu=p7jnfw5hw9&amp;vu=187060b6fd',
239         'md5': 'cb988699a776b22d4a41b9d43acfb3ac',
240         'info_dict': {
241             'id': 'p7jnfw5hw9_187060b6fd',
242             'ext': 'mp4',
243             'title': 'Video p7jnfw5hw9_187060b6fd',
244         },
245     }]
246     @staticmethod
247     def sign_data(obj):
248         if obj['cf'] == 'flash':
249             salt = '2f9d6924b33a165a6d8b5d3d42f4f987'
250             items = ['cf', 'format', 'ran', 'uu', 'ver', 'vu']
251         elif obj['cf'] == 'html5':
252             salt = 'fbeh5player12c43eccf2bec3300344'
253             items = ['cf', 'ran', 'uu', 'bver', 'vu']
254         input_data = ''.join([item + obj[item] for item in items]) + salt
255         obj['sign'] = hashlib.md5(input_data.encode('utf-8')).hexdigest()
256     def _get_formats(self, cf, uu, vu, media_id):
257         def get_play_json(cf, timestamp):
258             data = {
259                 'cf': cf,
260                 'ver': '2.2',
261                 'bver': 'firefox44.0',
262                 'format': 'json',
263                 'uu': uu,
264                 'vu': vu,
265                 'ran': compat_str(timestamp),
266             }
267             self.sign_data(data)
268             return self._download_json(
269                 'http://api.letvcloud.com/gpc.php?' + compat_urllib_parse_urlencode(data),
270                 media_id, 'Downloading playJson data for type %s' % cf)
271         play_json = get_play_json(cf, time.time())
272         if play_json.get('code') == 10071:
273             play_json = get_play_json(cf, play_json['timestamp'])
274         if not play_json.get('data'):
275             if play_json.get('message'):
276                 raise ExtractorError('Letv cloud said: %s' % play_json['message'], expected=True)
277             elif play_json.get('code'):
278                 raise ExtractorError('Letv cloud returned error %d' % play_json['code'], expected=True)
279             else:
280                 raise ExtractorError('Letv cloud returned an unknown error')
281         def b64decode(s):
282             return compat_b64decode(s).decode('utf-8')
283         formats = []
284         for media in play_json['data']['video_info']['media'].values():
285             url = b64decode(play_url['main_url'])
286             decoded_url = b64decode(url_basename(url))
287             formats<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.append({
288                 'url': url,
289                 'ext': determine_ext(decoded_url),
290                 'format_id': str_or_none(play_url.get('vtype')),
291                 'format_note': str_or_none(play_url.get('definition')),
292                 'width': int_or_none(play_url.get(</b></font>'vwidth')),
293                 'height': int_or_none(play_url.get('vheight')),
294             })
295         return formats
296     def _real_extract(self, url):
297         uu_mobj = re.search(r'uu=([\w]+)', url)
298         vu_mobj = re.search(r'vu=([\w]+)', url)
299         if not uu_mobj or not vu_mobj:
300             raise ExtractorError('Invalid URL: %s' % url, expected=True)
301         uu = uu_mobj.group(1)
302         vu = vu_mobj.group(1)
303         media_id = uu + '_' + vu
304         formats = self._get_formats('flash', uu, vu, media_id) + self._get_formats('html5', uu, vu, media_id)
305         self._sort_formats(formats)
306         return {
307             'id': media_id,
308             'title': 'Video %s' % media_id,
309             'formats': formats,
310         }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
