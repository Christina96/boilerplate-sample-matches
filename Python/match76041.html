<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for boto_cloudwatch.py &amp; boto_apigateway_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for boto_cloudwatch.py &amp; boto_apigateway_1.py
      </h3>
<h1 align="center">
        4.2%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>boto_cloudwatch.py (16.25767%)<th>boto_apigateway_1.py (2.4559777%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(76-91)<td><a href="#" name="0">(331-351)</a><td align="center"><font color="#ff0000">15</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(125-164)<td><a href="#" name="1">(224-245)</a><td align="center"><font color="#ee0000">14</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(317-328)<td><a href="#" name="2">(436-455)</a><td align="center"><font color="#cc0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(176-188)<td><a href="#" name="3">(799-813)</a><td align="center"><font color="#cc0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_cloudwatch.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import salt.utils.json
3 import salt.utils.odict as odict
4 import salt.utils.versions
5 import yaml  # pylint: disable=blacklisted-import
6 try:
7     import boto
8     import boto.ec2.cloudwatch
9     import boto.ec2.cloudwatch.listelement
10     import boto.ec2.cloudwatch.dimension
11     logging.getLogger("boto").setLevel(logging.CRITICAL)
12     HAS_BOTO = True
13 except ImportError:
14     HAS_BOTO = False
15 log = logging.getLogger(__name__)
16 def __virtual__():
17     has_boto_reqs = salt.utils.versions.check_boto_reqs(check_boto3=False)
18     if has_boto_reqs is True:
19             __name__, "cloudwatch", module="ec2.cloudwatch", pack=__salt__
20         )
21     r<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>eturn has_boto_reqs
22 def get_alarm(name, region=None, key=None, keyid=None, profile=None):
23     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
24     alarms = conn.describe_alarms(</b></font>alarm_names=[name])
25     if not alarms:
26         return None
27     if len(alarms) &gt; 1:
28         log.error("multiple alarms matched name '%s'", name)
29     return _metric_alarm_to_dict(alarms[0])
30 def _safe_dump(data):
31     custom_dumper = __utils__["yaml.get_dumper"]("SafeOrderedDumper")
32     def boto_listelement_presenter(dumper, data):
33         return dumper.represent_list(list(data))
34     yaml.add_representer(
35         boto.ec2.cloudwatch.listelement.ListElement,
36         boto_listelement_presenter,
37         Dumper=custom_dumper,
38     )
39     def dimension_presenter(dumper, data):
40         return dumper.represent_dict(dict(data))
41     yaml.add_representer(
42         boto.ec2.cloudwatch.dimension.Dimension,
43         dimension_presenter,
44     )
45     return __utils__["yaml.dump"](data, Dumper=<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>custom_dumper)
46 def get_all_alarms(region=None, prefix=None, key=None, keyid=None, profile=None):
47     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
48     alarms =</b></font> conn.describe_alarms()
49     results = odict.OrderedDict()
50     for alarm in alarms:
51         alarm = _metric_alarm_to_dict(alarm)
52         name = alarm["name"]
53         if prefix:
54             if name.startswith(prefix):
55                 continue
56             name = prefix + alarm["name"]
57         alarm_sls = [{"name": name}, {"attributes": alarm}]
58         results["manage alarm " + name] = {"boto_cloudwatch_alarm.present": alarm_sls}
59     return _safe_dump<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(results)
60 def create_or_update_alarm(
61     connection=None,
62     name=None,
63     metric=None,
64     namespace=None,
65     statistic=None,
66     comparison=None,
67     threshold=None,
68     period=None,
69     evaluation_periods=</b></font>None,
70     unit=None,
71     description="",
72     dimensions=None,
73     alarm_actions=None,
74     insufficient_data_actions=None,
75     ok_actions=None,
76     region=None,
77     key=None,
78     keyid=None,
79     profile=None,
80 ):
81     if threshold:
82         threshold = float(threshold)
83     if period:
84         period = int(period)
85     if evaluation_periods:
86         evaluation_periods = int(evaluation_periods)
87     if isinstance(dimensions, str):
88         dimensions = salt.utils.json.loads(dimensions)
89         if not isinstance(dimensions, dict):
90             log.error(
91                 "could not parse dimensions argument: must be json encoding of a dict:"
92                 " '%s'",
93                 dimensions,
94             )
95             return False
96     if isinstance(alarm_actions, str):
97         alarm_actions = alarm_actions.split(",")
98     if isinstance(insufficient_data_actions, str):
99         insufficient_data_actions = insufficient_data_actions.split(",")
100     if isinstance(ok_actions, str):
101         ok_actions = ok_actions.split(",")
102     if alarm_actions:
103         alarm_actions = convert_to_arn(
104             alarm_actions, region=region, key=key, keyid=keyid, profile=profile
105         )
106     if insufficient_data_actions:
107         insufficient_data_actions = convert_to_arn(
108             insufficient_data_actions,
109             region=region,
110             key=key,
111             keyid=keyid,
112             profile=profile,
113         )
114     if ok_actions:
115         ok_actions = convert_to_arn(
116             ok_actions, region=region, key=key, keyid=keyid, profile=profile
117         )
118     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
119     alarm = boto.ec2.cloudwatch.alarm.MetricAlarm(
120         connection=connection,
121         name=name,
122         metric=metric,
123         namespace=namespace,
124         statistic=statistic,
125         comparison=comparison,
126         threshold=threshold,
127         period=period,
128         evaluation_periods=evaluation_periods,
129         unit=unit,
130         description=description,
131         dimensions=dimensions,
132         alarm_actions=alarm_actions,
133         insufficient_data_actions=insufficient_data_actions,
134         ok_actions=ok_actions,
135     )
136     conn.create_alarm(alarm)
137     log.info("Created/updated alarm %s", name)
138     return True
139 def convert_to_arn(arns, region=None, key=None, keyid=None, profile=None):
140     results = []
141     for arn in arns:
142         if arn.startswith("scaling_policy:"):
143             _, as_group, scaling_policy_name = arn.split(":")
144             policy_arn = __salt__["boto_asg.get_scaling_policy_arn"](
145                 as_group, scaling_policy_name, region, key, keyid, profile
146             )
147             if policy_arn:
148                 results.append(policy_arn)
149             else:
150         else:
151             results.append(arn)
152     r<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>eturn results
153 def delete_alarm(name, region=None, key=None, keyid=None, profile=None):
154     conn = _get_conn(region=region, key=key, keyid=keyid, profile=</b></font>profile)
155     conn.delete_alarms([name])
156     log.info("Deleted alarm %s", name)
157     return True
158 def _metric_alarm_to_dict(alarm):
159     d = odict.OrderedDict()
160     fields = [
161         "name",
162         "metric",
163         "namespace",
164         "statistic",
165         "comparison",
166         "threshold",
167         "period",
168         "evaluation_periods",
169         "unit",
170         "description",
171         "dimensions",
172         "alarm_actions",
173         "insufficient_data_actions",
174         "ok_actions",
175     ]
176     for f in fields:
177         if hasattr(alarm, f):
178             d[f] = getattr(alarm, f)
179     return d
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_apigateway_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import datetime
2 import logging
3 import salt.utils.compat
4 import salt.utils.json
5 import salt.utils.versions
6 log = logging.getLogger(__name__)
7 try:
8     import boto
9     import boto3
10     from botocore.exceptions import ClientError
11     from botocore import __version__ as found_botocore_version
12     logging.getLogger("boto").setLevel(logging.CRITICAL)
13     logging.getLogger("boto3").setLevel(logging.CRITICAL)
14     HAS_BOTO = True
15 except ImportError:
16     HAS_BOTO = False
17 def __virtual__():
18     return salt.utils.versions.check_boto_reqs(
19         boto_ver="2.8.0", boto3_ver="1.2.1", botocore_ver="1.4.49"
20     )
21 def __init__(opts):
22     if HAS_BOTO:
23         __utils__["boto3.assign_funcs"](__name__, "apigateway")
24 def _convert_datetime_str(response):
25     if response:
26         return dict(
27             [
28                 (k, "{}".format(v)) if isinstance(v, datetime.date) else (k, v)
29                 for k, v in response.items()
30             ]
31         )
32     return None
33 def _filter_apis(name, apis):
34     return [api for api in apis if api["name"] == name]
35 def _filter_apis_desc(desc, apis):
36     return [api for api in apis if api["description"] == desc]
37 def _multi_call(function, contentkey, *args, **kwargs):
38     ret = function(*args, **kwargs)
39     position = ret.get("position")
40     while position:
41         more = function(*args, position=position, **kwargs)
42         ret[contentkey].extend(more[contentkey])
43         position = more.get("position")
44     return ret.get(contentkey)
45 def _find_apis_by_name(
46     name, description=None, region=None, key=None, keyid=None, profile=None
47 ):
48     try:
49         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
50         apis = _multi_call(conn.get_rest_apis, "items")
51         if name:
52             apis = _filter_apis(name, apis)
53         if description is not None:
54             apis = _filter_apis_desc(description, apis)
55         return {"restapi": [_convert_datetime_str(api) for api in apis]}
56     except ClientError as e:
57         return {"error": __utils__["boto3.get_error"](e)}
58 def describe_apis(
59     name=None, description=None, region=None, key=None, keyid=None, profile=None
60 ):
61     if name:
62         return _find_apis_by_name(
63             name,
64             description=description,
65             region=region,
66             key=key,
67             keyid=keyid,
68             profile=profile,
69         )
70     else:
71         return _find_apis_by_name(
72             "",
73             description=description,
74             key=key,
75             keyid=keyid,
76             profile=p<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>rofile,
77         )
78 def api_exists(name, description=None, region=None, key=None, keyid=None, profile=None):
79     apis = _find_apis_by_name(
80         name,
81         description=description,
82         region=region,
83         key=key,
84         keyid=keyid,
85         profile=</b></font>profile,
86     )
87     return {"exists": bool(apis.get("restapi"))}
88 def create_api(
89     name, description, cloneFrom=None, region=None, key=None, keyid=None, profile=None
90 ):
91     try:
92         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
93         if cloneFrom:
94             api = conn.create_rest_api(
95                 name=name, description=description, cloneFrom=cloneFrom
96             )
97         else:
98             api = conn.create_rest_api(name=name, description=description)
99         api = _convert_datetime_str(api)
100         return {"created": True, "restapi": api} if api else {"created": False}
101     except ClientError as e:
102         return {"created": False, "error": __utils__["boto3.get_error"](e)}
103 def delete_api(name, description=None, region=None, key=None, keyid=None, profile=None):
104     try:
105         conn_params = dict(region=region, key=key, keyid=keyid, profile=profile)
106         r = _find_apis_by_name(name, description=description, **conn_params)
107         apis = r.get("restapi")
108         if apis:
109             conn = _get_conn(**conn_params)
110             for api in apis:
111                 conn.delete_rest_api(restApiId=api["id"])
112             return {"deleted": True, "count": len(apis)}
113         else:
114             return {"deleted": False}
115     except ClientError as e:
116         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
117 def describe_api_resources(restApiId, region=None, key=None, keyid=None, profile=None):
118     try:
119         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
120         resources = sorted(
121             _multi_call(conn.get_resources, "items", restApiId=restApiId),
122             key=lambda k: k["path"],
123         )
124         return {"resources": resources}
125     except ClientError as e:
126         return {"error": __utils__["boto3.get_error"](<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>e)}
127 def describe_api_resource(
128     restApiId, path, region=None, key=None, keyid=None, profile=None
129 ):
130     r = describe_api_resources(
131         restApiId, region=region, key=key, keyid=keyid, profile=profile
132     )
133     resources = r.get(</b></font>"resources")
134     if resources is None:
135         return r
136     for resource in resources:
137         if resource["path"] == path:
138             return {"resource": resource}
139     return {"resource": None}
140 def create_api_resources(
141     restApiId, path, region=None, key=None, keyid=None, profile=None
142 ):
143     path_parts = path.split("/")
144     created = []
145     current_path = ""
146     try:
147         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
148         for path_part in path_parts:
149             if current_path == "/":
150                 current_path = "{}{}".format(current_path, path_part)
151             else:
152                 current_path = "{}/{}".format(current_path, path_part)
153             r = describe_api_resource(
154                 restApiId,
155                 current_path,
156                 region=region,
157                 key=key,
158                 keyid=keyid,
159                 profile=profile,
160             )
161             resource = r.get("resource")
162             if not resource:
163                 resource = conn.create_resource(
164                     restApiId=restApiId, parentId=created[-1]["id"], pathPart=path_part
165                 )
166             created.append(resource)
167         if created:
168             return {"created": True, "restApiId": restApiId, "resources": created}
169         else:
170             return {"created": False, "error": "unexpected error."}
171     except ClientError as e:
172         return {"created": False, "error": __utils__["boto3.get_error"](e)}
173 def delete_api_resources(
174     restApiId, path, region=None, key=None, keyid=None, profile=None
175 ):
176     if path == "/":
177         return {"deleted": False, "error": "use delete_api to remove the root resource"}
178     try:
179         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
180         r = describe_api_resource(
181             restApiId, path, region=region, key=key, keyid=keyid, profile=profile
182         )
183         resource = r.get("resource")
184         if resource:
185             conn.delete_resource(restApiId=restApiId, resourceId=resource["id"])
186             return {"deleted": True}
187             return {"deleted": False, "error": "no resource found by {}".format(path)}
188     except ClientError as e:
189         return {"created": False, "error": __utils__["boto3.get_error"](<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>e)}
190 def describe_api_resource_method(
191     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
192 ):
193     r = describe_api_resource(
194         restApiId, resourcePath, region=region, key=key, keyid=keyid, profile=</b></font>profile
195     )
196     resource = r.get("resource")
197     if not resource:
198         return {"error": "no such resource"}
199     try:
200         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
201         method = conn.get_method(
202             restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
203         )
204         return {"method": method}
205     except ClientError as e:
206         return {"error": __utils__["boto3.get_error"](e)}
207 def describe_api_key(apiKey, region=None, key=None, keyid=None, profile=None):
208     try:
209         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
210         response = conn.get_api_key(apiKey=apiKey)
211         return {"apiKey": _convert_datetime_str(response)}
212     except ClientError as e:
213         return {"error": __utils__["boto3.get_error"](e)}
214 def describe_api_keys(region=None, key=None, keyid=None, profile=None):
215     try:
216         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
217         apikeys = _multi_call(conn.get_api_keys, "items")
218         return {"apiKeys": [_convert_datetime_str(apikey) for apikey in apikeys]}
219     except ClientError as e:
220         return {"error": __utils__["boto3.get_error"](e)}
221 def create_api_key(
222     name,
223     description,
224     enabled=True,
225     stageKeys=None,
226     region=None,
227     key=None,
228     keyid=None,
229     profile=None,
230 ):
231     try:
232         stageKeys = list() if stageKeys is None else stageKeys
233         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
234         response = conn.create_api_key(
235             name=name, description=description, enabled=enabled, stageKeys=stageKeys
236         )
237         if not response:
238             return {"created": False}
239         return {"created": True, "apiKey": _convert_datetime_str(response)}
240     except ClientError as e:
241         return {"created": False, "error": __utils__["boto3.get_error"](e)}
242 def delete_api_key(apiKey, region=None, key=None, keyid=None, profile=None):
243     try:
244         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
245         conn.delete_api_key(apiKey=apiKey)
246         return {"deleted": True}
247     except ClientError as e:
248         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
249 def _api_key_patch_replace(conn, apiKey, path, value):
250     response = conn.update_api_key(
251         apiKey=apiKey, patchOperations=[{"op": "replace", "path": path, "value": value}]
252     )
253     return response
254 def _api_key_patchops(op, pvlist):
255     return [{"op": op, "path": p, "value": v} for (p, v) in pvlist]
256 def _api_key_patch_add(conn, apiKey, pvlist):
257     response = conn.update_api_key(
258         apiKey=apiKey, patchOperations=_api_key_patchops("add", pvlist)
259     )
260     return response
261 def _api_key_patch_remove(conn, apiKey, pvlist):
262     response = conn.update_api_key(
263         apiKey=apiKey, patchOperations=_api_key_patchops("remove", pvlist)
264     )
265     return response
266 def update_api_key_description(
267     apiKey, description, region=None, key=None, keyid=None, profile=None
268 ):
269     try:
270         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
271         response = _api_key_patch_replace(conn, apiKey, "/description", description)
272         return {"updated": True, "apiKey": _convert_datetime_str(response)}
273     except ClientError as e:
274         return {"updated": False, "error": __utils__["boto3.get_error"](e)}
275 def enable_api_key(apiKey, region=None, key=None, keyid=None, profile=None):
276     try:
277         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
278         response = _api_key_patch_replace(conn, apiKey, "/enabled", "True")
279         return {"apiKey": _convert_datetime_str(response)}
280     except ClientError as e:
281         return {"error": __utils__["boto3.get_error"](e)}
282 def disable_api_key(apiKey, region=None, key=None, keyid=None, profile=None):
283     try:
284         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
285         response = _api_key_patch_replace(conn, apiKey, "/enabled", "False")
286         return {"apiKey": _convert_datetime_str(response)}
287     except ClientError as e:
288         return {"error": __utils__["boto3.get_error"](e)}
289 def associate_api_key_stagekeys(
290     apiKey, stagekeyslist, region=None, key=None, keyid=None, profile=None
291 ):
292     try:
293         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
294         pvlist = [("/stages", stagekey) for stagekey in stagekeyslist]
295         response = _api_key_patch_add(conn, apiKey, pvlist)
296         return {"associated": True, "apiKey": _convert_datetime_str(response)}
297     except ClientError as e:
298         return {"associated": False, "error": __utils__["boto3.get_error"](e)}
299 def disassociate_api_key_stagekeys(
300     apiKey, stagekeyslist, region=None, key=None, keyid=None, profile=None
301 ):
302     try:
303         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
304         pvlist = [("/stages", stagekey) for stagekey in stagekeyslist]
305         response = _api_key_patch_remove(conn, apiKey, pvlist)
306         return {"disassociated": True}
307     except ClientError as e:
308         return {"disassociated": False, "error": __utils__["boto3.get_error"](e)}
309 def describe_api_deployments(
310     restApiId, region=None, key=None, keyid=None, profile=None
311 ):
312     try:
313         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
314         deployments = []
315         _deployments = conn.get_deployments(restApiId=restApiId)
316         while True:
317             if _deployments:
318                 deployments = deployments + _deployments["items"]
319                 if "position" not in _deployments:
320                     break
321                 _deployments = conn.get_deployments(
322                     restApiId=restApiId, position=_deployments["position"]
323                 )
324         return {
325             "deployments": [
326                 _convert_datetime_str(deployment) for deployment in deployments
327             ]
328         }
329     except ClientError as e:
330         return {"error": __utils__["boto3.get_error"](e)}
331 def describe_api_deployment(
332     restApiId, deploymentId, region=None, key=None, keyid=None, profile=None
333 ):
334     try:
335         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
336         deployment = conn.get_deployment(restApiId=restApiId, deploymentId=deploymentId)
337         return {"deployment": _convert_datetime_str(deployment)}
338     except ClientError as e:
339         return {"error": __utils__["boto3.get_error"](e)}
340 def activate_api_deployment(
341     restApiId, stageName, deploymentId, region=None, key=None, keyid=None, profile=None
342 ):
343     try:
344         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
345         response = conn.update_stage(
346             restApiId=restApiId,
347             stageName=stageName,
348             patchOperations=[
349                 {"op": "replace", "path": "/deploymentId", "value": deploymentId}
350             ],
351         return {"set": True, "response": _convert_datetime_str(response)}
352     except ClientError as e:
353         return {"set": False, "error": __utils__["boto3.get_error"]<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>(e)}
354 def create_api_deployment(
355     restApiId,
356     stageName,
357     stageDescription="",
358     description="",
359     cacheClusterEnabled=False,
360     cacheClusterSize="0.5",
361     variables=None,
362     region=None,
363     key=None,
364     keyid=None,
365     profile=</b></font>None,
366 ):
367     try:
368         variables = dict() if variables is None else variables
369         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
370         deployment = conn.create_deployment(
371             restApiId=restApiId,
372             stageName=stageName,
373             stageDescription=stageDescription,
374             description=description,
375             cacheClusterEnabled=cacheClusterEnabled,
376             cacheClusterSize=cacheClusterSize,
377             variables=variables,
378         )
379         return {"created": True, "deployment": _convert_datetime_str(deployment)}
380     except ClientError as e:
381         return {"created": False, "error": __utils__["boto3.get_error"](e)}
382 def delete_api_deployment(
383     restApiId, deploymentId, region=None, key=None, keyid=None, profile=None
384 ):
385     try:
386         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
387         conn.delete_deployment(restApiId=restApiId, deploymentId=deploymentId)
388         return {"deleted": True}
389     except ClientError as e:
390         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
391 def overwrite_api_stage_variables(
392     restApiId, stageName, variables, region=None, key=None, keyid=None, profile=None
393 ):
394     try:
395         res = describe_api_stage(
396             restApiId, stageName, region=region, key=key, keyid=keyid, profile=profile
397         )
398         if res.get("error"):
399             return {"overwrite": False, "error": res.get("error")}
400         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
401         stage = res.get("stage")
402         old_vars = stage.get("variables", {})
403         patch_ops = []
404         for old_var in old_vars:
405             if old_var not in variables:
406                 patch_ops.append(
407                     dict(op="remove", path="/variables/{}".format(old_var), value="")
408                 )
409         for var, val in variables.items():
410             if var not in old_vars or old_vars[var] != val:
411                 patch_ops.append(
412                     dict(op="replace", path="/variables/{}".format(var), value=val)
413                 )
414         if patch_ops:
415             stage = conn.update_stage(
416                 restApiId=restApiId, stageName=stageName, patchOperations=patch_ops
417             )
418         return {"overwrite": True, "stage": _convert_datetime_str(stage)}
419     except ClientError as e:
420         return {"overwrite": False, "error": __utils__["boto3.get_error"](e)}
421 def describe_api_stage(
422     restApiId, stageName, region=None, key=None, keyid=None, profile=None
423 ):
424     try:
425         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
426         stage = conn.get_stage(restApiId=restApiId, stageName=stageName)
427         return {"stage": _convert_datetime_str(stage)}
428     except ClientError as e:
429         return {"error": __utils__["boto3.get_error"](e)}
430 def describe_api_stages(
431     restApiId, deploymentId, region=None, key=None, keyid=None, profile=None
432 ):
433     try:
434         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
435         stages = conn.get_stages(restApiId=restApiId, deploymentId=deploymentId)
436         return {"stages": [_convert_datetime_str(stage) for stage in stages["item"]]}
437     except ClientError as e:
438         return {"error": __utils__["boto3.get_error"](e)}
439 def create_api_stage(
440     restApiId,
441     stageName,
442     deploymentId,
443     description="",
444     cacheClusterEnabled=False,
445     cacheClusterSize="0.5",
446     variables=None,
447     region=None,
448     key=None,
449     keyid=None,
450     profile=None,
451 ):
452     try:
453         variables = dict() if variables is None else variables
454         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
455         stage = conn.create_stage(
456             restApiId=restApiId,
457             stageName=stageName,
458             deploymentId=deploymentId,
459             description=description,
460             cacheClusterEnabled=cacheClusterEnabled,
461             cacheClusterSize=cacheClusterSize,
462             variables=variables,
463         )
464         return {"created": True, "stage": _convert_datetime_str(stage)}
465     except ClientError as e:
466         return {"created": False, "error": __utils__["boto3.get_error"](e)}
467 def delete_api_stage(
468     restApiId, stageName, region=None, key=None, keyid=None, profile=None
469 ):
470     try:
471         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
472         conn.delete_stage(restApiId=restApiId, stageName=stageName)
473         return {"deleted": True}
474     except ClientError as e:
475         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
476 def flush_api_stage_cache(
477     restApiId, stageName, region=None, key=None, keyid=None, profile=None
478 ):
479     try:
480         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
481         conn.flush_stage_cache(restApiId=restApiId, stageName=stageName)
482         return {"flushed": True}
483     except ClientError as e:
484         return {"flushed": False, "error": __utils__["boto3.get_error"](e)}
485 def create_api_method(
486     restApiId,
487     resourcePath,
488     httpMethod,
489     authorizationType,
490     apiKeyRequired=False,
491     requestParameters=None,
492     requestModels=None,
493     region=None,
494     key=None,
495     keyid=None,
496     profile=None,
497 ):
498     try:
499         resource = describe_api_resource(
500             restApiId,
501             resourcePath,
502             region=region,
503             key=key,
504             keyid=keyid,
505             profile=profile,
506         ).get("resource")
507         if resource:
508             requestParameters = (
509                 dict() if requestParameters is None else requestParameters
510             )
511             requestModels = dict() if requestModels is None else requestModels
512             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
513             method = conn.put_method(
514                 restApiId=restApiId,
515                 resourceId=resource["id"],
516                 httpMethod=httpMethod,
517                 authorizationType=str(authorizationType),
518                 apiKeyRequired=apiKeyRequired,
519                 requestParameters=requestParameters,
520                 requestModels=requestModels,
521             )
522             return {"created": True, "method": method}
523         return {"created": False, "error": "Failed to create method"}
524     except ClientError as e:
525         return {"created": False, "error": __utils__["boto3.get_error"](e)}
526 def describe_api_method(
527     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
528 ):
529     try:
530         resource = describe_api_resource(
531             restApiId,
532             resourcePath,
533             region=region,
534             key=key,
535             keyid=keyid,
536             profile=profile,
537         ).get("resource")
538         if resource:
539             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
540             method = conn.get_method(
541                 restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
542             )
543             return {"method": _convert_datetime_str(method)}
544         return {"error": "get API method failed: no such resource"}
545     except ClientError as e:
546         return {"error": __utils__["boto3.get_error"](e)}
547 def delete_api_method(
548     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
549 ):
550     try:
551         resource = describe_api_resource(
552             restApiId,
553             resourcePath,
554             region=region,
555             key=key,
556             keyid=keyid,
557             profile=profile,
558         ).get("resource")
559         if resource:
560             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
561             conn.delete_method(
562                 restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
563             )
564             return {"deleted": True}
565         return {"deleted": False, "error": "get API method failed: no such resource"}
566     except ClientError as e:
567         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
568 def create_api_method_response(
569     restApiId,
570     resourcePath,
571     httpMethod,
572     statusCode,
573     responseParameters=None,
574     responseModels=None,
575     region=None,
576     key=None,
577     keyid=None,
578     profile=None,
579 ):
580     try:
581         resource = describe_api_resource(
582             restApiId,
583             resourcePath,
584             region=region,
585             key=key,
586             keyid=keyid,
587             profile=profile,
588         ).get("resource")
589         if resource:
590             responseParameters = (
591                 dict() if responseParameters is None else responseParameters
592             )
593             responseModels = dict() if responseModels is None else responseModels
594             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
595             response = conn.put_method_response(
596                 restApiId=restApiId,
597                 resourceId=resource["id"],
598                 httpMethod=httpMethod,
599                 statusCode=str(statusCode),
600                 responseParameters=responseParameters,
601                 responseModels=responseModels,
602             )
603             return {"created": True, "response": response}
604         return {"created": False, "error": "no such resource"}
605     except ClientError as e:
606         return {"created": False, "error": __utils__["boto3.get_error"](e)}
607 def delete_api_method_response(
608     restApiId,
609     resourcePath,
610     httpMethod,
611     statusCode,
612     region=None,
613     key=None,
614     keyid=None,
615     profile=None,
616 ):
617     try:
618         resource = describe_api_resource(
619             restApiId,
620             resourcePath,
621             region=region,
622             key=key,
623             keyid=keyid,
624             profile=profile,
625         ).get("resource")
626         if resource:
627             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
628             conn.delete_method_response(
629                 restApiId=restApiId,
630                 resourceId=resource["id"],
631                 httpMethod=httpMethod,
632                 statusCode=str(statusCode),
633             )
634             return {"deleted": True}
635         return {"deleted": False, "error": "no such resource"}
636     except ClientError as e:
637         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
638 def describe_api_method_response(
639     restApiId,
640     resourcePath,
641     httpMethod,
642     statusCode,
643     region=None,
644     key=None,
645     keyid=None,
646     profile=None,
647 ):
648     try:
649         resource = describe_api_resource(
650             restApiId,
651             resourcePath,
652             region=region,
653             key=key,
654             keyid=keyid,
655             profile=profile,
656         ).get("resource")
657         if resource:
658             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
659             response = conn.get_method_response(
660                 restApiId=restApiId,
661                 resourceId=resource["id"],
662                 httpMethod=httpMethod,
663                 statusCode=str(statusCode),
664             )
665             return {"response": _convert_datetime_str(response)}
666         return {"error": "no such resource"}
667     except ClientError as e:
668         return {"error": __utils__["boto3.get_error"](e)}
669 def describe_api_models(restApiId, region=None, key=None, keyid=None, profile=None):
670     try:
671         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
672         models = _multi_call(conn.get_models, "items", restApiId=restApiId)
673         return {"models": [_convert_datetime_str(model) for model in models]}
674     except ClientError as e:
675         return {"error": __utils__["boto3.get_error"](e)}
676 def describe_api_model(
677     restApiId, modelName, flatten=True, region=None, key=None, keyid=None, profile=None
678 ):
679     try:
680         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
681         model = conn.get_model(
682             restApiId=restApiId, modelName=modelName, flatten=flatten
683         )
684         return {"model": _convert_datetime_str(model)}
685     except ClientError as e:
686         return {"error": __utils__["boto3.get_error"](e)}
687 def api_model_exists(
688     restApiId, modelName, region=None, key=None, keyid=None, profile=None
689 ):
690     r = describe_api_model(
691         restApiId, modelName, region=region, key=key, keyid=keyid, profile=profile
692     )
693     return {"exists": bool(r.get("model"))}
694 def _api_model_patch_replace(conn, restApiId, modelName, path, value):
695     response = conn.update_model(
696         restApiId=restApiId,
697         modelName=modelName,
698         patchOperations=[{"op": "replace", "path": path, "value": value}],
699     )
700     return response
701 def update_api_model_schema(
702     restApiId, modelName, schema, region=None, key=None, keyid=None, profile=None
703 ):
704     try:
705         schema_json = (
706             salt.utils.json.dumps(schema) if isinstance(schema, dict) else schema
707         )
708         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
709         response = _api_model_patch_replace(
710             conn, restApiId, modelName, "/schema", schema_json
711         )
712         return {"updated": True, "model": _convert_datetime_str(response)}
713     except ClientError as e:
714         return {"updated": False, "error": __utils__["boto3.get_error"](e)}
715 def delete_api_model(
716     restApiId, modelName, region=None, key=None, keyid=None, profile=None
717 ):
718     try:
719         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
720         conn.delete_model(restApiId=restApiId, modelName=modelName)
721         return {"deleted": True}
722     except ClientError as e:
723         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
724 def create_api_model(
725     restApiId,
726     modelName,
727     modelDescription,
728     schema,
729     contentType="application/json",
730     region=None,
731     key=None,
732     keyid=None,
733     profile=None,
734 ):
735     try:
736         schema_json = (
737             salt.utils.json.dumps(schema) if isinstance(schema, dict) else schema
738         )
739         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
740         model = conn.create_model(
741             restApiId=restApiId,
742             name=modelName,
743             description=modelDescription,
744             schema=schema_json,
745             contentType=contentType,
746         )
747         return {"created": True, "model": _convert_datetime_str(model)}
748     except ClientError as e:
749         return {"created": False, "error": __utils__["boto3.get_error"](e)}
750 def describe_api_integration(
751     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
752 ):
753     try:
754         resource = describe_api_resource(
755             restApiId,
756             resourcePath,
757             region=region,
758             key=key,
759             keyid=keyid,
760             profile=profile,
761         ).get("resource")
762         if resource:
763             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
764             integration = conn.get_integration(
765                 restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
766             )
767             return {"integration": _convert_datetime_str(integration)}
768         return {"error": "no such resource"}
769     except ClientError as e:
770         return {"error": __utils__["boto3.get_error"](e)}
771 def describe_api_integration_response(
772     restApiId,
773     resourcePath,
774     httpMethod,
775     statusCode,
776     region=None,
777     key=None,
778     keyid=None,
779     profile=None,
780 ):
781     try:
782         resource = describe_api_resource(
783             restApiId,
784             resourcePath,
785             region=region,
786             key=key,
787             keyid=keyid,
788             profile=profile,
789         ).get("resource")
790         if resource:
791             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
792             response = conn.get_integration_response(
793                 restApiId=restApiId,
794                 resourceId=resource["id"],
795                 httpMethod=httpMethod,
796                 statusCode=statusCode,
797             )
798             return {"response": _convert_datetime_str(response)}
799         return {"error": "no such resource"}
800     except ClientError as e:
801         return {"error": __utils__["boto3.get_error"](e)}
802 def delete_api_integration(
803     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
804 ):
805     try:
806         resource = describe_api_resource(
807             restApiId,
808             resourcePath,
809             region=region,
810             key=key,
811             keyid=keyid,
812             profile=profile,
813         ).get("resource")
814         if resource:
815             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
816             conn.delete_integration(
817                 restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
818             )
819             return {"deleted": True}
820         return {"deleted": False, "error": "no such resource"}
821     except ClientError as e:
822         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
823 def delete_api_integration_response(
824     restApiId,
825     resourcePath,
826     httpMethod,
827     statusCode,
828     region=None,
829     key=None,
830     keyid=None,
831     profile=None,
832 ):
833     try:
834         resource = describe_api_resource(
835             restApiId,
836             resourcePath,
837             region=region,
838             key=key,
839             keyid=keyid,
840             profile=profile,
841         ).get("resource")
842         if resource:
843             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
844             conn.delete_integration_response(
845                 restApiId=restApiId,
846                 resourceId=resource["id"],
847                 httpMethod=httpMethod,
848                 statusCode=statusCode,
849             )
850             return {"deleted": True}
851         return {"deleted": False, "error": "no such resource"}
852     except ClientError as e:
853         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
854 def _get_role_arn(name, region=None, key=None, keyid=None, profile=None):
855     if name.startswith("arn:aws:iam:"):
856         return name
857     account_id = __salt__["boto_iam.get_account_id"](
858         region=region, key=key, keyid=keyid, profile=profile
859     )
860     return "arn:aws:iam::{}:role/{}".format(account_id, name)
861 def create_api_integration(
862     restApiId,
863     resourcePath,
864     httpMethod,
865     integrationType,
866     integrationHttpMethod,
867     uri,
868     credentials,
869     requestParameters=None,
870     requestTemplates=None,
871     region=None,
872     key=None,
873     keyid=None,
874     profile=None,
875 ):
876     try:
877         credentials = _get_role_arn(
878             credentials, region=region, key=key, keyid=keyid, profile=profile
879         )
880         resource = describe_api_resource(
881             restApiId,
882             resourcePath,
883             region=region,
884             key=key,
885             keyid=keyid,
886             profile=profile,
887         ).get("resource")
888         if resource:
889             requestParameters = (
890                 dict() if requestParameters is None else requestParameters
891             )
892             requestTemplates = dict() if requestTemplates is None else requestTemplates
893             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
894             if httpMethod.lower() == "options":
895                 uri = ""
896                 credentials = ""
897             integration = conn.put_integration(
898                 restApiId=restApiId,
899                 resourceId=resource["id"],
900                 httpMethod=httpMethod,
901                 type=integrationType,
902                 integrationHttpMethod=integrationHttpMethod,
903                 uri=uri,
904                 credentials=credentials,
905                 requestParameters=requestParameters,
906                 requestTemplates=requestTemplates,
907             )
908             return {"created": True, "integration": integration}
909         return {"created": False, "error": "no such resource"}
910     except ClientError as e:
911         return {"created": False, "error": __utils__["boto3.get_error"](e)}
912 def create_api_integration_response(
913     restApiId,
914     resourcePath,
915     httpMethod,
916     statusCode,
917     selectionPattern,
918     responseParameters=None,
919     responseTemplates=None,
920     region=None,
921     key=None,
922     keyid=None,
923     profile=None,
924 ):
925     try:
926         resource = describe_api_resource(
927             restApiId,
928             resourcePath,
929             region=region,
930             key=key,
931             keyid=keyid,
932             profile=profile,
933         ).get("resource")
934         if resource:
935             responseParameters = (
936                 dict() if responseParameters is None else responseParameters
937             )
938             responseTemplates = (
939                 dict() if responseTemplates is None else responseTemplates
940             )
941             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
942             response = conn.put_integration_response(
943                 restApiId=restApiId,
944                 resourceId=resource["id"],
945                 httpMethod=httpMethod,
946                 statusCode=statusCode,
947                 selectionPattern=selectionPattern,
948                 responseParameters=responseParameters,
949                 responseTemplates=responseTemplates,
950             )
951             return {"created": True, "response": response}
952         return {"created": False, "error": "no such resource"}
953     except ClientError as e:
954         return {"created": False, "error": __utils__["boto3.get_error"](e)}
955 def _filter_plans(attr, name, plans):
956     return [plan for plan in plans if plan[attr] == name]
957 def describe_usage_plans(
958     name=None, plan_id=None, region=None, key=None, keyid=None, profile=None
959 ):
960     try:
961         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
962         plans = _multi_call(conn.get_usage_plans, "items")
963         if name:
964             plans = _filter_plans("name", name, plans)
965         if plan_id:
966             plans = _filter_plans("id", plan_id, plans)
967         return {"plans": [_convert_datetime_str(plan) for plan in plans]}
968     except ClientError as e:
969         return {"error": __utils__["boto3.get_error"](e)}
970 def _validate_throttle(throttle):
971     if throttle is not None:
972         if not isinstance(throttle, dict):
973             raise TypeError(
974                 "throttle must be a dictionary, provided value: {}".format(throttle)
975             )
976 def _validate_quota(quota):
977     if quota is not None:
978         if not isinstance(quota, dict):
979             raise TypeError(
980                 "quota must be a dictionary, provided value: {}".format(quota)
981             )
982         periods = ["DAY", "WEEK", "MONTH"]
983         if "period" not in quota or quota["period"] not in periods:
984             raise ValueError(
985                 "quota must have a valid period specified, valid values are {}".format(
986                     ",".join(periods)
987                 )
988             )
989         if "limit" not in quota:
990             raise ValueError("quota limit must have a valid value")
991 def create_usage_plan(
992     name,
993     description=None,
994     throttle=None,
995     quota=None,
996     region=None,
997     key=None,
998     keyid=None,
999     profile=None,
1000 ):
1001     try:
1002         _validate_throttle(throttle)
1003         _validate_quota(quota)
1004         values = dict(name=name)
1005         if description:
1006             values["description"] = description
1007         if throttle:
1008             values["throttle"] = throttle
1009         if quota:
1010             values["quota"] = quota
1011         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
1012         res = conn.create_usage_plan(**values)
1013         return {"created": True, "result": res}
1014     except ClientError as e:
1015         return {"error": __utils__["boto3.get_error"](e)}
1016     except (TypeError, ValueError) as e:
1017         return {"error": str(e)}
1018 def update_usage_plan(
1019     plan_id, throttle=None, quota=None, region=None, key=None, keyid=None, profile=None
1020 ):
1021     try:
1022         _validate_throttle(throttle)
1023         _validate_quota(quota)
1024         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
1025         patchOperations = []
1026         if throttle is None:
1027             patchOperations.append({"op": "remove", "path": "/throttle"})
1028         else:
1029             if "rateLimit" in throttle:
1030                 patchOperations.append(
1031                     {
1032                         "op": "replace",
1033                         "path": "/throttle/rateLimit",
1034                         "value": str(throttle["rateLimit"]),
1035                     }
1036                 )
1037             if "burstLimit" in throttle:
1038                 patchOperations.append(
1039                     {
1040                         "op": "replace",
1041                         "path": "/throttle/burstLimit",
1042                         "value": str(throttle["burstLimit"]),
1043                     }
1044                 )
1045         if quota is None:
1046             patchOperations.append({"op": "remove", "path": "/quota"})
1047         else:
1048             patchOperations.append(
1049                 {
1050                     "op": "replace",
1051                     "path": "/quota/period",
1052                     "value": str(quota["period"]),
1053                 }
1054             )
1055             patchOperations.append(
1056                 {"op": "replace", "path": "/quota/limit", "value": str(quota["limit"])}
1057             )
1058             if "offset" in quota:
1059                 patchOperations.append(
1060                     {
1061                         "op": "replace",
1062                         "path": "/quota/offset",
1063                         "value": str(quota["offset"]),
1064                     }
1065                 )
1066         if patchOperations:
1067             res = conn.update_usage_plan(
1068                 usagePlanId=plan_id, patchOperations=patchOperations
1069             )
1070             return {"updated": True, "result": res}
1071         return {"updated": False}
1072     except ClientError as e:
1073         return {"error": __utils__["boto3.get_error"](e)}
1074     except (TypeError, ValueError) as e:
1075         return {"error": str(e)}
1076 def delete_usage_plan(plan_id, region=None, key=None, keyid=None, profile=None):
1077     try:
1078         existing = describe_usage_plans(
1079             plan_id=plan_id, region=region, key=key, keyid=keyid, profile=profile
1080         )
1081         if "error" in existing:
1082             return {"error": existing["error"]}
1083         if "plans" in existing and existing["plans"]:
1084             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
1085             res = conn.delete_usage_plan(usagePlanId=plan_id)
1086         return {"deleted": True, "usagePlanId": plan_id}
1087     except ClientError as e:
1088         return {"error": __utils__["boto3.get_error"](e)}
1089 def _update_usage_plan_apis(
1090     plan_id, apis, op, region=None, key=None, keyid=None, profile=None
1091 ):
1092     try:
1093         patchOperations = []
1094         for api in apis:
1095             patchOperations.append(
1096                 {
1097                     "op": op,
1098                     "path": "/apiStages",
1099                     "value": "{}:{}".format(api["apiId"], api["stage"]),
1100                 }
1101             )
1102         res = None
1103         if patchOperations:
1104             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
1105             res = conn.update_usage_plan(
1106                 usagePlanId=plan_id, patchOperations=patchOperations
1107             )
1108         return {"success": True, "result": res}
1109     except ClientError as e:
1110         return {"error": __utils__["boto3.get_error"](e)}
1111     except Exception as e:  # pylint: disable=broad-except
1112         return {"error": e}
1113 def attach_usage_plan_to_apis(
1114     plan_id, apis, region=None, key=None, keyid=None, profile=None
1115 ):
1116     return _update_usage_plan_apis(
1117         plan_id, apis, "add", region=region, key=key, keyid=keyid, profile=profile
1118     )
1119 def detach_usage_plan_from_apis(
1120     plan_id, apis, region=None, key=None, keyid=None, profile=None
1121 ):
1122     return _update_usage_plan_apis(
1123         plan_id, apis, "remove", region=region, key=key, keyid=keyid, profile=profile
1124     )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
