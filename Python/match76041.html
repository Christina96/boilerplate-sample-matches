<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for boto_cloudwatch.py &amp; boto_apigateway_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for boto_cloudwatch.py &amp; boto_apigateway_1.py
      </h3>
<h1 align="center">
        4.2%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>boto_cloudwatch.py (16.25767%)<th>boto_apigateway_1.py (2.4559777%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(76-91)<td><a href="#" name="0">(331-351)</a><td align="center"><font color="#ff0000">15</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(125-164)<td><a href="#" name="1">(224-245)</a><td align="center"><font color="#ee0000">14</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(317-328)<td><a href="#" name="2">(436-455)</a><td align="center"><font color="#cc0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(176-188)<td><a href="#" name="3">(799-813)</a><td align="center"><font color="#cc0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_cloudwatch.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import salt.utils.json
3 import salt.utils.odict as odict
4 import salt.utils.versions
5 import yaml  # pylint: disable=blacklisted-import
6 try:
7     import boto
8     import boto.ec2.cloudwatch
9     import boto.ec2.cloudwatch.listelement
10     import boto.ec2.cloudwatch.dimension
11     logging.getLogger("boto").setLevel(logging.CRITICAL)
12     HAS_BOTO = True
13 except ImportError:
14     HAS_BOTO = False
15 log = logging.getLogger(__name__)
16 def __virtual__():
17     has_boto_reqs = salt.utils.versions.check_boto_reqs(check_boto3=False)
18     if has_boto_reqs is True:
19 <a name="0"></a>        __utils__["boto.assign_funcs"](
20             __name__, "cloudwatch", module="ec2.cloudwatch", pack=__salt__
21         )
22     r<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>eturn has_boto_reqs
23 def get_alarm(name, region=None, key=None, keyid=None, profile=None):
24     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
25     alarms = conn.describe_alarms(</b></font>alarm_names=[name])
26     if not alarms:
27         return None
28     if len(alarms) &gt; 1:
29         log.error("multiple alarms matched name '%s'", name)
30     return _metric_alarm_to_dict(alarms[0])
31 def _safe_dump(data):
32     custom_dumper = __utils__["yaml.get_dumper"]("SafeOrderedDumper")
33     def boto_listelement_presenter(dumper, data):
34         return dumper.represent_list(list(data))
35     yaml.add_representer(
36         boto.ec2.cloudwatch.listelement.ListElement,
37         boto_listelement_presenter,
38         Dumper=custom_dumper,
39     )
40     def dimension_presenter(dumper, data):
41         return dumper.represent_dict(dict(data))
42     yaml.add_representer(
43         boto.ec2.cloudwatch.dimension.Dimension,
44         dimension_presenter,
45 <a name="1"></a>        Dumper=custom_dumper,
46     )
47     return __utils__["yaml.dump"](data, Dumper=<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>custom_dumper)
48 def get_all_alarms(region=None, prefix=None, key=None, keyid=None, profile=None):
49     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
50     alarms =</b></font> conn.describe_alarms()
51     results = odict.OrderedDict()
52     for alarm in alarms:
53         alarm = _metric_alarm_to_dict(alarm)
54         name = alarm["name"]
55         if prefix:
56             if name.startswith(prefix):
57                 continue
58             name = prefix + alarm["name"]
59 <a name="3"></a>        del alarm["name"]
60         alarm_sls = [{"name": name}, {"attributes": alarm}]
61         results["manage alarm " + name] = {"boto_cloudwatch_alarm.present": alarm_sls}
62     return _safe_dump<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(results)
63 def create_or_update_alarm(
64     connection=None,
65     name=None,
66     metric=None,
67     namespace=None,
68     statistic=None,
69     comparison=None,
70     threshold=None,
71     period=None,
72     evaluation_periods=</b></font>None,
73     unit=None,
74     description="",
75     dimensions=None,
76     alarm_actions=None,
77     insufficient_data_actions=None,
78     ok_actions=None,
79     region=None,
80     key=None,
81     keyid=None,
82     profile=None,
83 ):
84     if threshold:
85         threshold = float(threshold)
86     if period:
87         period = int(period)
88     if evaluation_periods:
89         evaluation_periods = int(evaluation_periods)
90     if isinstance(dimensions, str):
91         dimensions = salt.utils.json.loads(dimensions)
92         if not isinstance(dimensions, dict):
93             log.error(
94                 "could not parse dimensions argument: must be json encoding of a dict:"
95                 " '%s'",
96                 dimensions,
97             )
98             return False
99     if isinstance(alarm_actions, str):
100         alarm_actions = alarm_actions.split(",")
101     if isinstance(insufficient_data_actions, str):
102         insufficient_data_actions = insufficient_data_actions.split(",")
103     if isinstance(ok_actions, str):
104         ok_actions = ok_actions.split(",")
105     if alarm_actions:
106         alarm_actions = convert_to_arn(
107             alarm_actions, region=region, key=key, keyid=keyid, profile=profile
108         )
109     if insufficient_data_actions:
110         insufficient_data_actions = convert_to_arn(
111             insufficient_data_actions,
112             region=region,
113             key=key,
114             keyid=keyid,
115             profile=profile,
116         )
117     if ok_actions:
118         ok_actions = convert_to_arn(
119             ok_actions, region=region, key=key, keyid=keyid, profile=profile
120         )
121     conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
122     alarm = boto.ec2.cloudwatch.alarm.MetricAlarm(
123         connection=connection,
124         name=name,
125         metric=metric,
126         namespace=namespace,
127         statistic=statistic,
128         comparison=comparison,
129         threshold=threshold,
130         period=period,
131         evaluation_periods=evaluation_periods,
132         unit=unit,
133         description=description,
134         dimensions=dimensions,
135         alarm_actions=alarm_actions,
136         insufficient_data_actions=insufficient_data_actions,
137         ok_actions=ok_actions,
138     )
139     conn.create_alarm(alarm)
140     log.info("Created/updated alarm %s", name)
141     return True
142 def convert_to_arn(arns, region=None, key=None, keyid=None, profile=None):
143     results = []
144     for arn in arns:
145         if arn.startswith("scaling_policy:"):
146             _, as_group, scaling_policy_name = arn.split(":")
147             policy_arn = __salt__["boto_asg.get_scaling_policy_arn"](
148                 as_group, scaling_policy_name, region, key, keyid, profile
149             )
150             if policy_arn:
151                 results.append(policy_arn)
152             else:
153 <a name="2"></a>                log.error("Could not convert: %s", arn)
154         else:
155             results.append(arn)
156     r<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>eturn results
157 def delete_alarm(name, region=None, key=None, keyid=None, profile=None):
158     conn = _get_conn(region=region, key=key, keyid=keyid, profile=</b></font>profile)
159     conn.delete_alarms([name])
160     log.info("Deleted alarm %s", name)
161     return True
162 def _metric_alarm_to_dict(alarm):
163     d = odict.OrderedDict()
164     fields = [
165         "name",
166         "metric",
167         "namespace",
168         "statistic",
169         "comparison",
170         "threshold",
171         "period",
172         "evaluation_periods",
173         "unit",
174         "description",
175         "dimensions",
176         "alarm_actions",
177         "insufficient_data_actions",
178         "ok_actions",
179     ]
180     for f in fields:
181         if hasattr(alarm, f):
182             d[f] = getattr(alarm, f)
183     return d
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>boto_apigateway_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import datetime
2 import logging
3 import salt.utils.compat
4 import salt.utils.json
5 import salt.utils.versions
6 log = logging.getLogger(__name__)
7 try:
8     import boto
9     import boto3
10     from botocore.exceptions import ClientError
11     from botocore import __version__ as found_botocore_version
12     logging.getLogger("boto").setLevel(logging.CRITICAL)
13     logging.getLogger("boto3").setLevel(logging.CRITICAL)
14     HAS_BOTO = True
15 except ImportError:
16     HAS_BOTO = False
17 def __virtual__():
18     return salt.utils.versions.check_boto_reqs(
19         boto_ver="2.8.0", boto3_ver="1.2.1", botocore_ver="1.4.49"
20     )
21 def __init__(opts):
22     if HAS_BOTO:
23         __utils__["boto3.assign_funcs"](__name__, "apigateway")
24 def _convert_datetime_str(response):
25     if response:
26         return dict(
27             [
28                 (k, "{}".format(v)) if isinstance(v, datetime.date) else (k, v)
29                 for k, v in response.items()
30             ]
31         )
32     return None
33 def _filter_apis(name, apis):
34     return [api for api in apis if api["name"] == name]
35 def _filter_apis_desc(desc, apis):
36     return [api for api in apis if api["description"] == desc]
37 def _multi_call(function, contentkey, *args, **kwargs):
38     ret = function(*args, **kwargs)
39     position = ret.get("position")
40     while position:
41         more = function(*args, position=position, **kwargs)
42         ret[contentkey].extend(more[contentkey])
43         position = more.get("position")
44     return ret.get(contentkey)
45 def _find_apis_by_name(
46     name, description=None, region=None, key=None, keyid=None, profile=None
47 ):
48     try:
49         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
50         apis = _multi_call(conn.get_rest_apis, "items")
51         if name:
52             apis = _filter_apis(name, apis)
53         if description is not None:
54             apis = _filter_apis_desc(description, apis)
55         return {"restapi": [_convert_datetime_str(api) for api in apis]}
56     except ClientError as e:
57         return {"error": __utils__["boto3.get_error"](e)}
58 def describe_apis(
59     name=None, description=None, region=None, key=None, keyid=None, profile=None
60 ):
61     if name:
62         return _find_apis_by_name(
63             name,
64             description=description,
65             region=region,
66             key=key,
67             keyid=keyid,
68             profile=profile,
69         )
70     else:
71         return _find_apis_by_name(
72             "",
73             description=description,
74 <a name="1"></a>            region=region,
75             key=key,
76             keyid=keyid,
77             profile=p<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>rofile,
78         )
79 def api_exists(name, description=None, region=None, key=None, keyid=None, profile=None):
80     apis = _find_apis_by_name(
81         name,
82         description=description,
83         region=region,
84         key=key,
85         keyid=keyid,
86         profile=</b></font>profile,
87     )
88     return {"exists": bool(apis.get("restapi"))}
89 def create_api(
90     name, description, cloneFrom=None, region=None, key=None, keyid=None, profile=None
91 ):
92     try:
93         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
94         if cloneFrom:
95             api = conn.create_rest_api(
96                 name=name, description=description, cloneFrom=cloneFrom
97             )
98         else:
99             api = conn.create_rest_api(name=name, description=description)
100         api = _convert_datetime_str(api)
101         return {"created": True, "restapi": api} if api else {"created": False}
102     except ClientError as e:
103         return {"created": False, "error": __utils__["boto3.get_error"](e)}
104 def delete_api(name, description=None, region=None, key=None, keyid=None, profile=None):
105     try:
106         conn_params = dict(region=region, key=key, keyid=keyid, profile=profile)
107         r = _find_apis_by_name(name, description=description, **conn_params)
108         apis = r.get("restapi")
109         if apis:
110             conn = _get_conn(**conn_params)
111             for api in apis:
112                 conn.delete_rest_api(restApiId=api["id"])
113             return {"deleted": True, "count": len(apis)}
114         else:
115             return {"deleted": False}
116     except ClientError as e:
117         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
118 def describe_api_resources(restApiId, region=None, key=None, keyid=None, profile=None):
119     try:
120         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
121         resources = sorted(
122             _multi_call(conn.get_resources, "items", restApiId=restApiId),
123             key=lambda k: k["path"],
124         )
125 <a name="0"></a>
126         return {"resources": resources}
127     except ClientError as e:
128         return {"error": __utils__["boto3.get_error"](<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>e)}
129 def describe_api_resource(
130     restApiId, path, region=None, key=None, keyid=None, profile=None
131 ):
132     r = describe_api_resources(
133         restApiId, region=region, key=key, keyid=keyid, profile=profile
134     )
135     resources = r.get(</b></font>"resources")
136     if resources is None:
137         return r
138     for resource in resources:
139         if resource["path"] == path:
140             return {"resource": resource}
141     return {"resource": None}
142 def create_api_resources(
143     restApiId, path, region=None, key=None, keyid=None, profile=None
144 ):
145     path_parts = path.split("/")
146     created = []
147     current_path = ""
148     try:
149         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
150         for path_part in path_parts:
151             if current_path == "/":
152                 current_path = "{}{}".format(current_path, path_part)
153             else:
154                 current_path = "{}/{}".format(current_path, path_part)
155             r = describe_api_resource(
156                 restApiId,
157                 current_path,
158                 region=region,
159                 key=key,
160                 keyid=keyid,
161                 profile=profile,
162             )
163             resource = r.get("resource")
164             if not resource:
165                 resource = conn.create_resource(
166                     restApiId=restApiId, parentId=created[-1]["id"], pathPart=path_part
167                 )
168             created.append(resource)
169         if created:
170             return {"created": True, "restApiId": restApiId, "resources": created}
171         else:
172             return {"created": False, "error": "unexpected error."}
173     except ClientError as e:
174         return {"created": False, "error": __utils__["boto3.get_error"](e)}
175 def delete_api_resources(
176     restApiId, path, region=None, key=None, keyid=None, profile=None
177 ):
178     if path == "/":
179         return {"deleted": False, "error": "use delete_api to remove the root resource"}
180     try:
181         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
182         r = describe_api_resource(
183             restApiId, path, region=region, key=key, keyid=keyid, profile=profile
184         )
185         resource = r.get("resource")
186         if resource:
187             conn.delete_resource(restApiId=restApiId, resourceId=resource["id"])
188             return {"deleted": True}
189 <a name="2"></a>        else:
190             return {"deleted": False, "error": "no resource found by {}".format(path)}
191     except ClientError as e:
192         return {"created": False, "error": __utils__["boto3.get_error"](<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>e)}
193 def describe_api_resource_method(
194     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
195 ):
196     r = describe_api_resource(
197         restApiId, resourcePath, region=region, key=key, keyid=keyid, profile=</b></font>profile
198     )
199     resource = r.get("resource")
200     if not resource:
201         return {"error": "no such resource"}
202     try:
203         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
204         method = conn.get_method(
205             restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
206         )
207         return {"method": method}
208     except ClientError as e:
209         return {"error": __utils__["boto3.get_error"](e)}
210 def describe_api_key(apiKey, region=None, key=None, keyid=None, profile=None):
211     try:
212         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
213         response = conn.get_api_key(apiKey=apiKey)
214         return {"apiKey": _convert_datetime_str(response)}
215     except ClientError as e:
216         return {"error": __utils__["boto3.get_error"](e)}
217 def describe_api_keys(region=None, key=None, keyid=None, profile=None):
218     try:
219         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
220         apikeys = _multi_call(conn.get_api_keys, "items")
221         return {"apiKeys": [_convert_datetime_str(apikey) for apikey in apikeys]}
222     except ClientError as e:
223         return {"error": __utils__["boto3.get_error"](e)}
224 def create_api_key(
225     name,
226     description,
227     enabled=True,
228     stageKeys=None,
229     region=None,
230     key=None,
231     keyid=None,
232     profile=None,
233 ):
234     try:
235         stageKeys = list() if stageKeys is None else stageKeys
236         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
237         response = conn.create_api_key(
238             name=name, description=description, enabled=enabled, stageKeys=stageKeys
239         )
240         if not response:
241             return {"created": False}
242         return {"created": True, "apiKey": _convert_datetime_str(response)}
243     except ClientError as e:
244         return {"created": False, "error": __utils__["boto3.get_error"](e)}
245 def delete_api_key(apiKey, region=None, key=None, keyid=None, profile=None):
246     try:
247         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
248         conn.delete_api_key(apiKey=apiKey)
249         return {"deleted": True}
250     except ClientError as e:
251         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
252 def _api_key_patch_replace(conn, apiKey, path, value):
253     response = conn.update_api_key(
254         apiKey=apiKey, patchOperations=[{"op": "replace", "path": path, "value": value}]
255     )
256     return response
257 def _api_key_patchops(op, pvlist):
258     return [{"op": op, "path": p, "value": v} for (p, v) in pvlist]
259 def _api_key_patch_add(conn, apiKey, pvlist):
260     response = conn.update_api_key(
261         apiKey=apiKey, patchOperations=_api_key_patchops("add", pvlist)
262     )
263     return response
264 def _api_key_patch_remove(conn, apiKey, pvlist):
265     response = conn.update_api_key(
266         apiKey=apiKey, patchOperations=_api_key_patchops("remove", pvlist)
267     )
268     return response
269 def update_api_key_description(
270     apiKey, description, region=None, key=None, keyid=None, profile=None
271 ):
272     try:
273         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
274         response = _api_key_patch_replace(conn, apiKey, "/description", description)
275         return {"updated": True, "apiKey": _convert_datetime_str(response)}
276     except ClientError as e:
277         return {"updated": False, "error": __utils__["boto3.get_error"](e)}
278 def enable_api_key(apiKey, region=None, key=None, keyid=None, profile=None):
279     try:
280         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
281         response = _api_key_patch_replace(conn, apiKey, "/enabled", "True")
282         return {"apiKey": _convert_datetime_str(response)}
283     except ClientError as e:
284         return {"error": __utils__["boto3.get_error"](e)}
285 def disable_api_key(apiKey, region=None, key=None, keyid=None, profile=None):
286     try:
287         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
288         response = _api_key_patch_replace(conn, apiKey, "/enabled", "False")
289         return {"apiKey": _convert_datetime_str(response)}
290     except ClientError as e:
291         return {"error": __utils__["boto3.get_error"](e)}
292 def associate_api_key_stagekeys(
293     apiKey, stagekeyslist, region=None, key=None, keyid=None, profile=None
294 ):
295     try:
296         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
297         pvlist = [("/stages", stagekey) for stagekey in stagekeyslist]
298         response = _api_key_patch_add(conn, apiKey, pvlist)
299         return {"associated": True, "apiKey": _convert_datetime_str(response)}
300     except ClientError as e:
301         return {"associated": False, "error": __utils__["boto3.get_error"](e)}
302 def disassociate_api_key_stagekeys(
303     apiKey, stagekeyslist, region=None, key=None, keyid=None, profile=None
304 ):
305     try:
306         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
307         pvlist = [("/stages", stagekey) for stagekey in stagekeyslist]
308         response = _api_key_patch_remove(conn, apiKey, pvlist)
309         return {"disassociated": True}
310     except ClientError as e:
311         return {"disassociated": False, "error": __utils__["boto3.get_error"](e)}
312 def describe_api_deployments(
313     restApiId, region=None, key=None, keyid=None, profile=None
314 ):
315     try:
316         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
317         deployments = []
318         _deployments = conn.get_deployments(restApiId=restApiId)
319         while True:
320             if _deployments:
321                 deployments = deployments + _deployments["items"]
322                 if "position" not in _deployments:
323                     break
324                 _deployments = conn.get_deployments(
325                     restApiId=restApiId, position=_deployments["position"]
326                 )
327         return {
328             "deployments": [
329                 _convert_datetime_str(deployment) for deployment in deployments
330             ]
331         }
332     except ClientError as e:
333         return {"error": __utils__["boto3.get_error"](e)}
334 def describe_api_deployment(
335     restApiId, deploymentId, region=None, key=None, keyid=None, profile=None
336 ):
337     try:
338         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
339         deployment = conn.get_deployment(restApiId=restApiId, deploymentId=deploymentId)
340         return {"deployment": _convert_datetime_str(deployment)}
341     except ClientError as e:
342         return {"error": __utils__["boto3.get_error"](e)}
343 def activate_api_deployment(
344     restApiId, stageName, deploymentId, region=None, key=None, keyid=None, profile=None
345 ):
346     try:
347         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
348         response = conn.update_stage(
349             restApiId=restApiId,
350             stageName=stageName,
351             patchOperations=[
352                 {"op": "replace", "path": "/deploymentId", "value": deploymentId}
353             ],
354 <a name="3"></a>        )
355         return {"set": True, "response": _convert_datetime_str(response)}
356     except ClientError as e:
357         return {"set": False, "error": __utils__["boto3.get_error"]<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>(e)}
358 def create_api_deployment(
359     restApiId,
360     stageName,
361     stageDescription="",
362     description="",
363     cacheClusterEnabled=False,
364     cacheClusterSize="0.5",
365     variables=None,
366     region=None,
367     key=None,
368     keyid=None,
369     profile=</b></font>None,
370 ):
371     try:
372         variables = dict() if variables is None else variables
373         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
374         deployment = conn.create_deployment(
375             restApiId=restApiId,
376             stageName=stageName,
377             stageDescription=stageDescription,
378             description=description,
379             cacheClusterEnabled=cacheClusterEnabled,
380             cacheClusterSize=cacheClusterSize,
381             variables=variables,
382         )
383         return {"created": True, "deployment": _convert_datetime_str(deployment)}
384     except ClientError as e:
385         return {"created": False, "error": __utils__["boto3.get_error"](e)}
386 def delete_api_deployment(
387     restApiId, deploymentId, region=None, key=None, keyid=None, profile=None
388 ):
389     try:
390         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
391         conn.delete_deployment(restApiId=restApiId, deploymentId=deploymentId)
392         return {"deleted": True}
393     except ClientError as e:
394         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
395 def overwrite_api_stage_variables(
396     restApiId, stageName, variables, region=None, key=None, keyid=None, profile=None
397 ):
398     try:
399         res = describe_api_stage(
400             restApiId, stageName, region=region, key=key, keyid=keyid, profile=profile
401         )
402         if res.get("error"):
403             return {"overwrite": False, "error": res.get("error")}
404         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
405         stage = res.get("stage")
406         old_vars = stage.get("variables", {})
407         patch_ops = []
408         for old_var in old_vars:
409             if old_var not in variables:
410                 patch_ops.append(
411                     dict(op="remove", path="/variables/{}".format(old_var), value="")
412                 )
413         for var, val in variables.items():
414             if var not in old_vars or old_vars[var] != val:
415                 patch_ops.append(
416                     dict(op="replace", path="/variables/{}".format(var), value=val)
417                 )
418         if patch_ops:
419             stage = conn.update_stage(
420                 restApiId=restApiId, stageName=stageName, patchOperations=patch_ops
421             )
422         return {"overwrite": True, "stage": _convert_datetime_str(stage)}
423     except ClientError as e:
424         return {"overwrite": False, "error": __utils__["boto3.get_error"](e)}
425 def describe_api_stage(
426     restApiId, stageName, region=None, key=None, keyid=None, profile=None
427 ):
428     try:
429         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
430         stage = conn.get_stage(restApiId=restApiId, stageName=stageName)
431         return {"stage": _convert_datetime_str(stage)}
432     except ClientError as e:
433         return {"error": __utils__["boto3.get_error"](e)}
434 def describe_api_stages(
435     restApiId, deploymentId, region=None, key=None, keyid=None, profile=None
436 ):
437     try:
438         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
439         stages = conn.get_stages(restApiId=restApiId, deploymentId=deploymentId)
440         return {"stages": [_convert_datetime_str(stage) for stage in stages["item"]]}
441     except ClientError as e:
442         return {"error": __utils__["boto3.get_error"](e)}
443 def create_api_stage(
444     restApiId,
445     stageName,
446     deploymentId,
447     description="",
448     cacheClusterEnabled=False,
449     cacheClusterSize="0.5",
450     variables=None,
451     region=None,
452     key=None,
453     keyid=None,
454     profile=None,
455 ):
456     try:
457         variables = dict() if variables is None else variables
458         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
459         stage = conn.create_stage(
460             restApiId=restApiId,
461             stageName=stageName,
462             deploymentId=deploymentId,
463             description=description,
464             cacheClusterEnabled=cacheClusterEnabled,
465             cacheClusterSize=cacheClusterSize,
466             variables=variables,
467         )
468         return {"created": True, "stage": _convert_datetime_str(stage)}
469     except ClientError as e:
470         return {"created": False, "error": __utils__["boto3.get_error"](e)}
471 def delete_api_stage(
472     restApiId, stageName, region=None, key=None, keyid=None, profile=None
473 ):
474     try:
475         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
476         conn.delete_stage(restApiId=restApiId, stageName=stageName)
477         return {"deleted": True}
478     except ClientError as e:
479         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
480 def flush_api_stage_cache(
481     restApiId, stageName, region=None, key=None, keyid=None, profile=None
482 ):
483     try:
484         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
485         conn.flush_stage_cache(restApiId=restApiId, stageName=stageName)
486         return {"flushed": True}
487     except ClientError as e:
488         return {"flushed": False, "error": __utils__["boto3.get_error"](e)}
489 def create_api_method(
490     restApiId,
491     resourcePath,
492     httpMethod,
493     authorizationType,
494     apiKeyRequired=False,
495     requestParameters=None,
496     requestModels=None,
497     region=None,
498     key=None,
499     keyid=None,
500     profile=None,
501 ):
502     try:
503         resource = describe_api_resource(
504             restApiId,
505             resourcePath,
506             region=region,
507             key=key,
508             keyid=keyid,
509             profile=profile,
510         ).get("resource")
511         if resource:
512             requestParameters = (
513                 dict() if requestParameters is None else requestParameters
514             )
515             requestModels = dict() if requestModels is None else requestModels
516             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
517             method = conn.put_method(
518                 restApiId=restApiId,
519                 resourceId=resource["id"],
520                 httpMethod=httpMethod,
521                 authorizationType=str(authorizationType),
522                 apiKeyRequired=apiKeyRequired,
523                 requestParameters=requestParameters,
524                 requestModels=requestModels,
525             )
526             return {"created": True, "method": method}
527         return {"created": False, "error": "Failed to create method"}
528     except ClientError as e:
529         return {"created": False, "error": __utils__["boto3.get_error"](e)}
530 def describe_api_method(
531     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
532 ):
533     try:
534         resource = describe_api_resource(
535             restApiId,
536             resourcePath,
537             region=region,
538             key=key,
539             keyid=keyid,
540             profile=profile,
541         ).get("resource")
542         if resource:
543             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
544             method = conn.get_method(
545                 restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
546             )
547             return {"method": _convert_datetime_str(method)}
548         return {"error": "get API method failed: no such resource"}
549     except ClientError as e:
550         return {"error": __utils__["boto3.get_error"](e)}
551 def delete_api_method(
552     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
553 ):
554     try:
555         resource = describe_api_resource(
556             restApiId,
557             resourcePath,
558             region=region,
559             key=key,
560             keyid=keyid,
561             profile=profile,
562         ).get("resource")
563         if resource:
564             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
565             conn.delete_method(
566                 restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
567             )
568             return {"deleted": True}
569         return {"deleted": False, "error": "get API method failed: no such resource"}
570     except ClientError as e:
571         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
572 def create_api_method_response(
573     restApiId,
574     resourcePath,
575     httpMethod,
576     statusCode,
577     responseParameters=None,
578     responseModels=None,
579     region=None,
580     key=None,
581     keyid=None,
582     profile=None,
583 ):
584     try:
585         resource = describe_api_resource(
586             restApiId,
587             resourcePath,
588             region=region,
589             key=key,
590             keyid=keyid,
591             profile=profile,
592         ).get("resource")
593         if resource:
594             responseParameters = (
595                 dict() if responseParameters is None else responseParameters
596             )
597             responseModels = dict() if responseModels is None else responseModels
598             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
599             response = conn.put_method_response(
600                 restApiId=restApiId,
601                 resourceId=resource["id"],
602                 httpMethod=httpMethod,
603                 statusCode=str(statusCode),
604                 responseParameters=responseParameters,
605                 responseModels=responseModels,
606             )
607             return {"created": True, "response": response}
608         return {"created": False, "error": "no such resource"}
609     except ClientError as e:
610         return {"created": False, "error": __utils__["boto3.get_error"](e)}
611 def delete_api_method_response(
612     restApiId,
613     resourcePath,
614     httpMethod,
615     statusCode,
616     region=None,
617     key=None,
618     keyid=None,
619     profile=None,
620 ):
621     try:
622         resource = describe_api_resource(
623             restApiId,
624             resourcePath,
625             region=region,
626             key=key,
627             keyid=keyid,
628             profile=profile,
629         ).get("resource")
630         if resource:
631             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
632             conn.delete_method_response(
633                 restApiId=restApiId,
634                 resourceId=resource["id"],
635                 httpMethod=httpMethod,
636                 statusCode=str(statusCode),
637             )
638             return {"deleted": True}
639         return {"deleted": False, "error": "no such resource"}
640     except ClientError as e:
641         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
642 def describe_api_method_response(
643     restApiId,
644     resourcePath,
645     httpMethod,
646     statusCode,
647     region=None,
648     key=None,
649     keyid=None,
650     profile=None,
651 ):
652     try:
653         resource = describe_api_resource(
654             restApiId,
655             resourcePath,
656             region=region,
657             key=key,
658             keyid=keyid,
659             profile=profile,
660         ).get("resource")
661         if resource:
662             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
663             response = conn.get_method_response(
664                 restApiId=restApiId,
665                 resourceId=resource["id"],
666                 httpMethod=httpMethod,
667                 statusCode=str(statusCode),
668             )
669             return {"response": _convert_datetime_str(response)}
670         return {"error": "no such resource"}
671     except ClientError as e:
672         return {"error": __utils__["boto3.get_error"](e)}
673 def describe_api_models(restApiId, region=None, key=None, keyid=None, profile=None):
674     try:
675         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
676         models = _multi_call(conn.get_models, "items", restApiId=restApiId)
677         return {"models": [_convert_datetime_str(model) for model in models]}
678     except ClientError as e:
679         return {"error": __utils__["boto3.get_error"](e)}
680 def describe_api_model(
681     restApiId, modelName, flatten=True, region=None, key=None, keyid=None, profile=None
682 ):
683     try:
684         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
685         model = conn.get_model(
686             restApiId=restApiId, modelName=modelName, flatten=flatten
687         )
688         return {"model": _convert_datetime_str(model)}
689     except ClientError as e:
690         return {"error": __utils__["boto3.get_error"](e)}
691 def api_model_exists(
692     restApiId, modelName, region=None, key=None, keyid=None, profile=None
693 ):
694     r = describe_api_model(
695         restApiId, modelName, region=region, key=key, keyid=keyid, profile=profile
696     )
697     return {"exists": bool(r.get("model"))}
698 def _api_model_patch_replace(conn, restApiId, modelName, path, value):
699     response = conn.update_model(
700         restApiId=restApiId,
701         modelName=modelName,
702         patchOperations=[{"op": "replace", "path": path, "value": value}],
703     )
704     return response
705 def update_api_model_schema(
706     restApiId, modelName, schema, region=None, key=None, keyid=None, profile=None
707 ):
708     try:
709         schema_json = (
710             salt.utils.json.dumps(schema) if isinstance(schema, dict) else schema
711         )
712         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
713         response = _api_model_patch_replace(
714             conn, restApiId, modelName, "/schema", schema_json
715         )
716         return {"updated": True, "model": _convert_datetime_str(response)}
717     except ClientError as e:
718         return {"updated": False, "error": __utils__["boto3.get_error"](e)}
719 def delete_api_model(
720     restApiId, modelName, region=None, key=None, keyid=None, profile=None
721 ):
722     try:
723         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
724         conn.delete_model(restApiId=restApiId, modelName=modelName)
725         return {"deleted": True}
726     except ClientError as e:
727         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
728 def create_api_model(
729     restApiId,
730     modelName,
731     modelDescription,
732     schema,
733     contentType="application/json",
734     region=None,
735     key=None,
736     keyid=None,
737     profile=None,
738 ):
739     try:
740         schema_json = (
741             salt.utils.json.dumps(schema) if isinstance(schema, dict) else schema
742         )
743         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
744         model = conn.create_model(
745             restApiId=restApiId,
746             name=modelName,
747             description=modelDescription,
748             schema=schema_json,
749             contentType=contentType,
750         )
751         return {"created": True, "model": _convert_datetime_str(model)}
752     except ClientError as e:
753         return {"created": False, "error": __utils__["boto3.get_error"](e)}
754 def describe_api_integration(
755     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
756 ):
757     try:
758         resource = describe_api_resource(
759             restApiId,
760             resourcePath,
761             region=region,
762             key=key,
763             keyid=keyid,
764             profile=profile,
765         ).get("resource")
766         if resource:
767             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
768             integration = conn.get_integration(
769                 restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
770             )
771             return {"integration": _convert_datetime_str(integration)}
772         return {"error": "no such resource"}
773     except ClientError as e:
774         return {"error": __utils__["boto3.get_error"](e)}
775 def describe_api_integration_response(
776     restApiId,
777     resourcePath,
778     httpMethod,
779     statusCode,
780     region=None,
781     key=None,
782     keyid=None,
783     profile=None,
784 ):
785     try:
786         resource = describe_api_resource(
787             restApiId,
788             resourcePath,
789             region=region,
790             key=key,
791             keyid=keyid,
792             profile=profile,
793         ).get("resource")
794         if resource:
795             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
796             response = conn.get_integration_response(
797                 restApiId=restApiId,
798                 resourceId=resource["id"],
799                 httpMethod=httpMethod,
800                 statusCode=statusCode,
801             )
802             return {"response": _convert_datetime_str(response)}
803         return {"error": "no such resource"}
804     except ClientError as e:
805         return {"error": __utils__["boto3.get_error"](e)}
806 def delete_api_integration(
807     restApiId, resourcePath, httpMethod, region=None, key=None, keyid=None, profile=None
808 ):
809     try:
810         resource = describe_api_resource(
811             restApiId,
812             resourcePath,
813             region=region,
814             key=key,
815             keyid=keyid,
816             profile=profile,
817         ).get("resource")
818         if resource:
819             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
820             conn.delete_integration(
821                 restApiId=restApiId, resourceId=resource["id"], httpMethod=httpMethod
822             )
823             return {"deleted": True}
824         return {"deleted": False, "error": "no such resource"}
825     except ClientError as e:
826         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
827 def delete_api_integration_response(
828     restApiId,
829     resourcePath,
830     httpMethod,
831     statusCode,
832     region=None,
833     key=None,
834     keyid=None,
835     profile=None,
836 ):
837     try:
838         resource = describe_api_resource(
839             restApiId,
840             resourcePath,
841             region=region,
842             key=key,
843             keyid=keyid,
844             profile=profile,
845         ).get("resource")
846         if resource:
847             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
848             conn.delete_integration_response(
849                 restApiId=restApiId,
850                 resourceId=resource["id"],
851                 httpMethod=httpMethod,
852                 statusCode=statusCode,
853             )
854             return {"deleted": True}
855         return {"deleted": False, "error": "no such resource"}
856     except ClientError as e:
857         return {"deleted": False, "error": __utils__["boto3.get_error"](e)}
858 def _get_role_arn(name, region=None, key=None, keyid=None, profile=None):
859     if name.startswith("arn:aws:iam:"):
860         return name
861     account_id = __salt__["boto_iam.get_account_id"](
862         region=region, key=key, keyid=keyid, profile=profile
863     )
864     return "arn:aws:iam::{}:role/{}".format(account_id, name)
865 def create_api_integration(
866     restApiId,
867     resourcePath,
868     httpMethod,
869     integrationType,
870     integrationHttpMethod,
871     uri,
872     credentials,
873     requestParameters=None,
874     requestTemplates=None,
875     region=None,
876     key=None,
877     keyid=None,
878     profile=None,
879 ):
880     try:
881         credentials = _get_role_arn(
882             credentials, region=region, key=key, keyid=keyid, profile=profile
883         )
884         resource = describe_api_resource(
885             restApiId,
886             resourcePath,
887             region=region,
888             key=key,
889             keyid=keyid,
890             profile=profile,
891         ).get("resource")
892         if resource:
893             requestParameters = (
894                 dict() if requestParameters is None else requestParameters
895             )
896             requestTemplates = dict() if requestTemplates is None else requestTemplates
897             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
898             if httpMethod.lower() == "options":
899                 uri = ""
900                 credentials = ""
901             integration = conn.put_integration(
902                 restApiId=restApiId,
903                 resourceId=resource["id"],
904                 httpMethod=httpMethod,
905                 type=integrationType,
906                 integrationHttpMethod=integrationHttpMethod,
907                 uri=uri,
908                 credentials=credentials,
909                 requestParameters=requestParameters,
910                 requestTemplates=requestTemplates,
911             )
912             return {"created": True, "integration": integration}
913         return {"created": False, "error": "no such resource"}
914     except ClientError as e:
915         return {"created": False, "error": __utils__["boto3.get_error"](e)}
916 def create_api_integration_response(
917     restApiId,
918     resourcePath,
919     httpMethod,
920     statusCode,
921     selectionPattern,
922     responseParameters=None,
923     responseTemplates=None,
924     region=None,
925     key=None,
926     keyid=None,
927     profile=None,
928 ):
929     try:
930         resource = describe_api_resource(
931             restApiId,
932             resourcePath,
933             region=region,
934             key=key,
935             keyid=keyid,
936             profile=profile,
937         ).get("resource")
938         if resource:
939             responseParameters = (
940                 dict() if responseParameters is None else responseParameters
941             )
942             responseTemplates = (
943                 dict() if responseTemplates is None else responseTemplates
944             )
945             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
946             response = conn.put_integration_response(
947                 restApiId=restApiId,
948                 resourceId=resource["id"],
949                 httpMethod=httpMethod,
950                 statusCode=statusCode,
951                 selectionPattern=selectionPattern,
952                 responseParameters=responseParameters,
953                 responseTemplates=responseTemplates,
954             )
955             return {"created": True, "response": response}
956         return {"created": False, "error": "no such resource"}
957     except ClientError as e:
958         return {"created": False, "error": __utils__["boto3.get_error"](e)}
959 def _filter_plans(attr, name, plans):
960     return [plan for plan in plans if plan[attr] == name]
961 def describe_usage_plans(
962     name=None, plan_id=None, region=None, key=None, keyid=None, profile=None
963 ):
964     try:
965         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
966         plans = _multi_call(conn.get_usage_plans, "items")
967         if name:
968             plans = _filter_plans("name", name, plans)
969         if plan_id:
970             plans = _filter_plans("id", plan_id, plans)
971         return {"plans": [_convert_datetime_str(plan) for plan in plans]}
972     except ClientError as e:
973         return {"error": __utils__["boto3.get_error"](e)}
974 def _validate_throttle(throttle):
975     if throttle is not None:
976         if not isinstance(throttle, dict):
977             raise TypeError(
978                 "throttle must be a dictionary, provided value: {}".format(throttle)
979             )
980 def _validate_quota(quota):
981     if quota is not None:
982         if not isinstance(quota, dict):
983             raise TypeError(
984                 "quota must be a dictionary, provided value: {}".format(quota)
985             )
986         periods = ["DAY", "WEEK", "MONTH"]
987         if "period" not in quota or quota["period"] not in periods:
988             raise ValueError(
989                 "quota must have a valid period specified, valid values are {}".format(
990                     ",".join(periods)
991                 )
992             )
993         if "limit" not in quota:
994             raise ValueError("quota limit must have a valid value")
995 def create_usage_plan(
996     name,
997     description=None,
998     throttle=None,
999     quota=None,
1000     region=None,
1001     key=None,
1002     keyid=None,
1003     profile=None,
1004 ):
1005     try:
1006         _validate_throttle(throttle)
1007         _validate_quota(quota)
1008         values = dict(name=name)
1009         if description:
1010             values["description"] = description
1011         if throttle:
1012             values["throttle"] = throttle
1013         if quota:
1014             values["quota"] = quota
1015         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
1016         res = conn.create_usage_plan(**values)
1017         return {"created": True, "result": res}
1018     except ClientError as e:
1019         return {"error": __utils__["boto3.get_error"](e)}
1020     except (TypeError, ValueError) as e:
1021         return {"error": str(e)}
1022 def update_usage_plan(
1023     plan_id, throttle=None, quota=None, region=None, key=None, keyid=None, profile=None
1024 ):
1025     try:
1026         _validate_throttle(throttle)
1027         _validate_quota(quota)
1028         conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
1029         patchOperations = []
1030         if throttle is None:
1031             patchOperations.append({"op": "remove", "path": "/throttle"})
1032         else:
1033             if "rateLimit" in throttle:
1034                 patchOperations.append(
1035                     {
1036                         "op": "replace",
1037                         "path": "/throttle/rateLimit",
1038                         "value": str(throttle["rateLimit"]),
1039                     }
1040                 )
1041             if "burstLimit" in throttle:
1042                 patchOperations.append(
1043                     {
1044                         "op": "replace",
1045                         "path": "/throttle/burstLimit",
1046                         "value": str(throttle["burstLimit"]),
1047                     }
1048                 )
1049         if quota is None:
1050             patchOperations.append({"op": "remove", "path": "/quota"})
1051         else:
1052             patchOperations.append(
1053                 {
1054                     "op": "replace",
1055                     "path": "/quota/period",
1056                     "value": str(quota["period"]),
1057                 }
1058             )
1059             patchOperations.append(
1060                 {"op": "replace", "path": "/quota/limit", "value": str(quota["limit"])}
1061             )
1062             if "offset" in quota:
1063                 patchOperations.append(
1064                     {
1065                         "op": "replace",
1066                         "path": "/quota/offset",
1067                         "value": str(quota["offset"]),
1068                     }
1069                 )
1070         if patchOperations:
1071             res = conn.update_usage_plan(
1072                 usagePlanId=plan_id, patchOperations=patchOperations
1073             )
1074             return {"updated": True, "result": res}
1075         return {"updated": False}
1076     except ClientError as e:
1077         return {"error": __utils__["boto3.get_error"](e)}
1078     except (TypeError, ValueError) as e:
1079         return {"error": str(e)}
1080 def delete_usage_plan(plan_id, region=None, key=None, keyid=None, profile=None):
1081     try:
1082         existing = describe_usage_plans(
1083             plan_id=plan_id, region=region, key=key, keyid=keyid, profile=profile
1084         )
1085         if "error" in existing:
1086             return {"error": existing["error"]}
1087         if "plans" in existing and existing["plans"]:
1088             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
1089             res = conn.delete_usage_plan(usagePlanId=plan_id)
1090         return {"deleted": True, "usagePlanId": plan_id}
1091     except ClientError as e:
1092         return {"error": __utils__["boto3.get_error"](e)}
1093 def _update_usage_plan_apis(
1094     plan_id, apis, op, region=None, key=None, keyid=None, profile=None
1095 ):
1096     try:
1097         patchOperations = []
1098         for api in apis:
1099             patchOperations.append(
1100                 {
1101                     "op": op,
1102                     "path": "/apiStages",
1103                     "value": "{}:{}".format(api["apiId"], api["stage"]),
1104                 }
1105             )
1106         res = None
1107         if patchOperations:
1108             conn = _get_conn(region=region, key=key, keyid=keyid, profile=profile)
1109             res = conn.update_usage_plan(
1110                 usagePlanId=plan_id, patchOperations=patchOperations
1111             )
1112         return {"success": True, "result": res}
1113     except ClientError as e:
1114         return {"error": __utils__["boto3.get_error"](e)}
1115     except Exception as e:  # pylint: disable=broad-except
1116         return {"error": e}
1117 def attach_usage_plan_to_apis(
1118     plan_id, apis, region=None, key=None, keyid=None, profile=None
1119 ):
1120     return _update_usage_plan_apis(
1121         plan_id, apis, "add", region=region, key=key, keyid=keyid, profile=profile
1122     )
1123 def detach_usage_plan_from_apis(
1124     plan_id, apis, region=None, key=None, keyid=None, profile=None
1125 ):
1126     return _update_usage_plan_apis(
1127         plan_id, apis, "remove", region=region, key=key, keyid=keyid, profile=profile
1128     )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
