<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_themes_scale.py & test_themes_dimensions.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_themes_scale.py & test_themes_dimensions.py
      </h3>
      <h1 align="center">
        50.0%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_themes_scale.py (60.17699%)<TH>test_themes_dimensions.py (42.767296%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match90-0.html#0',2,'match90-1.html#0',3)" NAME="0">(131-153)<TD><A HREF="javascript:ZweiFrames('match90-0.html#0',2,'match90-1.html#0',3)" NAME="0">(174-196)</A><TD ALIGN=center><FONT COLOR="#ff0000">38</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match90-0.html#1',2,'match90-1.html#1',3)" NAME="1">(105-120)<TD><A HREF="javascript:ZweiFrames('match90-0.html#1',2,'match90-1.html#1',3)" NAME="1">(158-173)</A><TD ALIGN=center><FONT COLOR="#c90000">30</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match90-0.html#2',2,'match90-1.html#2',3)" NAME="2">(159-226)<TD><A HREF="javascript:ZweiFrames('match90-0.html#2',2,'match90-1.html#2',3)" NAME="2">(215-239)</A><TD ALIGN=center><FONT COLOR="#b50000">27</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match90-0.html#3',2,'match90-1.html#3',3)" NAME="3">(30-48)<TD><A HREF="javascript:ZweiFrames('match90-0.html#3',2,'match90-1.html#3',3)" NAME="3">(32-58)</A><TD ALIGN=center><FONT COLOR="#640000">15</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match90-0.html#4',2,'match90-1.html#4',3)" NAME="4">(76-89)<TD><A HREF="javascript:ZweiFrames('match90-0.html#4',2,'match90-1.html#4',3)" NAME="4">(112-120)</A><TD ALIGN=center><FONT COLOR="#5d0000">14</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match90-0.html#5',2,'match90-1.html#5',3)" NAME="5">(50-55)<TD><A HREF="javascript:ZweiFrames('match90-0.html#5',2,'match90-1.html#5',3)" NAME="5">(63-69)</A><TD ALIGN=center><FONT COLOR="#500000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_themes_scale.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
# Copyright (c) 2013-2019, Camptocamp SA
# All rights reserved.

# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:

# 1. Redistributions of source code must retain the above copyright notice, this
#    list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright notice,
#    this list of conditions and the following disclaimer in the documentation
#    and/or other materials provided with the distribution.

# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
# DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
# LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
# ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

# The views and conclusions contained in the software and documentation are those
# of the authors and should not be interpreted as representing official policies,
# either expressed or implied, of the FreeBSD Project.
<A NAME="3"></A>
# pylint: disable=missing-docstring,attribute-defined-outside-init,protected-access

<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match90-1.html#3',3,'match90-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>from unittest import TestCase

import transaction
from pyramid import testing
from tests.functional import create_default_ogcserver, create_dummy_request, mapserv_url
from tests.functional import setup_common as setup_module  # noqa
from tests.functional import teardown_common as teardown_module  # noqa


class TestThemesScale(TestCase):
    def setup_method(self, _):
        # Always see the diff
        # https://docs.python.org/2/library/unittest.html#unittest.TestCase.maxDiff
        self.maxDiff = None

        from c2cgeoportal_commons.models import DBSession
        from c2cgeoportal_commons.models.main import Interface, LayerGroup, LayerWMS, Metadata, Theme
<A NAME="5"></A>
        main = Interface(name=</B></FONT>&quot;desktop&quot;)

        ogc_server <FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match90-1.html#5',3,'match90-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>= create_default_ogcserver()

        layer_noscale = LayerWMS(name=&quot;__test_layer_noscale&quot;, public=True)
        layer_noscale.layer = &quot;test_noscale&quot;
        layer_noscale.interfaces = [main]
        layer_noscale.ogc_server =</B></FONT> ogc_server

        layer_minscale = LayerWMS(name=&quot;__test_layer_minscale&quot;, public=True)
        layer_minscale.layer = &quot;test_minscale&quot;
        layer_minscale.interfaces = [main]
        layer_minscale.ogc_server = ogc_server

        layer_maxscale = LayerWMS(name=&quot;__test_layer_maxscale&quot;, public=True)
        layer_maxscale.layer = &quot;test_maxscale&quot;
        layer_maxscale.interfaces = [main]
        layer_maxscale.ogc_server = ogc_server

        layer_boothscale = LayerWMS(name=&quot;__test_layer_boothscale&quot;, public=True)
        layer_boothscale.layer = &quot;test_boothscale&quot;
        layer_boothscale.interfaces = [main]
        layer_boothscale.ogc_server = ogc_server

        layer_metadatascale = LayerWMS(name=&quot;__test_layer_metadatascale&quot;, public=True)
<A NAME="4"></A>        layer_metadatascale.layer = &quot;test_boothscale&quot;
        layer_metadatascale.interfaces = [main]
        layer_metadatascale.ogc_server = ogc_server
        layer_metadatascale.metadatas = [Metadata(&quot;minResolution&quot;, &quot;100&quot;), Metadata<FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match90-1.html#4',3,'match90-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>(&quot;maxResolution&quot;, &quot;1000&quot;)]

        layer_group = LayerGroup(name=&quot;__test_layer_group&quot;)
        layer_group.children = [
            layer_noscale,
            layer_minscale,
            layer_maxscale,
            layer_boothscale,
            layer_metadatascale,
        ]

        theme = Theme(name=&quot;__test_theme&quot;)
        theme.interfaces = [main]
        theme.children =</B></FONT> [layer_group]

        DBSession.add_all([theme])

        transaction.commit()

    def teardown_method(self, _):
        testing.tearDown()

        from c2cgeoportal_commons.models import DBSession
        from c2cgeoportal_commons.models.main import Interface, Layer, LayerGroup, OGCServer, Theme

        for layer in DBSession.query(Layer).all():
<A NAME="1"></A>            DBSession.delete(layer)
        for g in DBSession.query(LayerGroup).all():
            DBSession.delete(g)
        <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match90-1.html#1',3,'match90-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>for t in DBSession.query(Theme).all():
            DBSession.delete(t)
        DBSession.query(Interface).filter(Interface.name == &quot;main&quot;).delete()
        DBSession.query(OGCServer).delete()

        transaction.commit()

    #
    # viewer view tests
    #

    @staticmethod
    def _create_request_obj(params=None, **kwargs):
        if params is None:
            params = {}
        request = create_dummy_request(</B></FONT>
            additional_settings={
                &quot;admin_interface&quot;: {
                    &quot;available_metadata&quot;: [
                        {&quot;name&quot;: &quot;minResolution&quot;, &quot;type&quot;: &quot;float&quot;},
                        {&quot;name&quot;: &quot;maxResolution&quot;, &quot;type&quot;: &quot;float&quot;},
                    ]
                }
<A NAME="0"></A>            },
            **kwargs,
        )
        request<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match90-1.html#0',3,'match90-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.route_url = lambda url, **kwargs: mapserv_url
        request.params = params

        return request

    def _create_theme_obj(self, **kwargs):
        from c2cgeoportal_geoportal.views.theme import Theme

        return Theme(self._create_request_obj(**kwargs))

    def _only_name(self, item, attributes=None):
        if attributes is None:
            attributes = [&quot;name&quot;]
        result = {}

        for attribute in attributes:
            if attribute in item:
                result[attribute] = item[attribute]

        if &quot;children&quot; in item:
            result[&quot;children&quot;] = [self._only_name(i, attributes) for i in item[&quot;children&quot;]]

        r</B></FONT>eturn result

    def test_scale(self):
<A NAME="2"></A>        theme_view = self._create_theme_obj()
        themes = theme_view.themes()
        self.assertEqual(set(themes[&quot;errors&quot;]), set())
        self<FONT color="#980517"><A HREF="javascript:ZweiFrames('match90-1.html#2',3,'match90-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.assertEqual(
            [
                self._only_name(t, [&quot;name&quot;, &quot;childLayers&quot;, &quot;minResolutionHint&quot;, &quot;maxResolutionHint&quot;])
                for t in themes[&quot;themes&quot;]
            ],
            [
                {
                    &quot;name&quot;: &quot;__test_theme&quot;,
                    &quot;children&quot;: [
                        {
                            &quot;name&quot;: &quot;__test_layer_group&quot;,
                            &quot;children&quot;: [
                                {
                                    &quot;childLayers&quot;: [
                                        {
                                            &quot;minResolutionHint&quot;: 0.0,
                                            &quot;name&quot;: &quot;test_noscale&quot;,
                                            &quot;maxResolutionHint&quot;: 999999999.0,
                                            &quot;queryable&quot;: True,
                                        }
                                    ],
                                    &quot;maxResolutionHint&quot;: 999999999.0,
                                    &quot;minResolutionHint&quot;: 0.0,
                                    &quot;name&quot;: &quot;__test_layer_noscale&quot;,
                                },
                                {
                                    &quot;childLayers&quot;: [
                                        {
                                            &quot;minResolutionHint&quot;: 1.76,
                                            &quot;name&quot;: &quot;test_minscale&quot;,
                                            &quot;maxResolutionHint&quot;: 999999999.0,
                                            &quot;queryable&quot;: True,
                                        }
                                    ],
                                    &quot;maxResolutionHint&quot;: 999999999.0,
                                    &quot;minResolutionHint&quot;: 1.76,
                                    &quot;name&quot;: &quot;__test_layer_minscale&quot;,
                                },
                                {
                                    &quot;childLayers&quot;: [
                                        {
                                            &quot;minResolutionHint&quot;: 0.0,
                                            &quot;name&quot;: &quot;test_maxscale&quot;,
                                            &quot;maxResolutionHint&quot;: 8.82,
                                            &quot;queryable&quot;: True,
                                        }
                                    ],
                                    &quot;maxResolutionHint&quot;: 8.82,
                                    &quot;minResolutionHint&quot;: 0.0,
                                    &quot;name&quot;: &quot;__test_layer_maxscale&quot;,
                                },
                                {
                                    &quot;childLayers&quot;: [
                                        {
                                            &quot;minResolutionHint&quot;: 1.76,
                                            &quot;name&quot;: &quot;test_boothscale&quot;,
                                            &quot;maxResolutionHint&quot;: 8.82,
                                            &quot;queryable&quot;: True,
                                        }
                                    ],
                                    &quot;maxResolutionHint&quot;: 8.82,
                                    &quot;minResolutionHint&quot;: 1.76,
                                    &quot;name&quot;: &quot;__test_layer_boothscale&quot;,
                                },
                                {
                                    &quot;childLayers&quot;: [
                                        {
                                            &quot;minResolutionHint&quot;</B></FONT>: 1.76,
                                            &quot;name&quot;: &quot;test_boothscale&quot;,
                                            &quot;maxResolutionHint&quot;: 8.82,
                                            &quot;queryable&quot;: True,
                                        }
                                    ],
                                    &quot;maxResolutionHint&quot;: 1000.0,
                                    &quot;minResolutionHint&quot;: 100.0,
                                    &quot;name&quot;: &quot;__test_layer_metadatascale&quot;,
                                },
                            ],
                        }
                    ],
                }
            ],
        )
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_themes_dimensions.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
# Copyright (c) 2016-2019, Camptocamp SA
# All rights reserved.

# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:

# 1. Redistributions of source code must retain the above copyright notice, this
#    list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright notice,
#    this list of conditions and the following disclaimer in the documentation
#    and/or other materials provided with the distribution.

# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
# DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
# ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
# (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
# LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
# ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

# The views and conclusions contained in the software and documentation are those
# of the authors and should not be interpreted as representing official policies,
# either expressed or implied, of the FreeBSD Project.

# pylint: disable=missing-docstring,attribute-defined-outside-init,protected-access
<A NAME="3"></A>

import re
<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match90-0.html#3',2,'match90-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>from unittest import TestCase

import transaction
from pyramid import testing
from tests.functional import create_default_ogcserver, create_dummy_request, mapserv_url
from tests.functional import setup_common as setup_module  # noqa
from tests.functional import teardown_common as teardown_module  # noqa


class TestThemesView(TestCase):
    def setup_method(self, _):
        # Always see the diff
        # https://docs.python.org/2/library/unittest.html#unittest.TestCase.maxDiff
        self.maxDiff = None

        from c2cgeoportal_commons.models import DBSession
        from c2cgeoportal_commons.models.main import (
            Dimension,
            Interface,
            LayerGroup,
            LayerWMS,
            LayerWMTS,
            Theme,
        )

        ogc_server = create_default_ogcserver()
        main =</B></FONT> Interface(name=&quot;main&quot;)

<A NAME="5"></A>        layer_wms_1 = LayerWMS(name=&quot;__test_layer_wms_1&quot;, public=True)
        layer_wms_1.layer = &quot;testpoint_unprotected&quot;
        layer_wms_1.interfaces = [main]
        layer_wms_1.ogc_server <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match90-0.html#5',2,'match90-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= ogc_server
        Dimension(&quot;A&quot;, &quot;a&quot;, layer_wms_1)

        layer_wms_2 = LayerWMS(name=&quot;__test_layer_wms_2&quot;, public=True)
        layer_wms_2.layer = &quot;testpoint_unprotected&quot;
        layer_wms_2.interfaces = [main]
        layer_wms_2.ogc_server =</B></FONT> ogc_server
        Dimension(&quot;A&quot;, &quot;b&quot;, layer_wms_2)

        layer_wms_3 = LayerWMS(name=&quot;__test_layer_wms_3&quot;, public=True)
        layer_wms_3.layer = &quot;testpoint_unprotected&quot;
        layer_wms_3.interfaces = [main]
        layer_wms_3.ogc_server = ogc_server
        Dimension(&quot;A&quot;, None, layer_wms_3)

        layer_wms_4 = LayerWMS(name=&quot;__test_layer_wms_4&quot;, public=True)
        layer_wms_4.layer = &quot;testpoint_unprotected&quot;
        layer_wms_4.interfaces = [main]
        layer_wms_4.ogc_server = ogc_server
        Dimension(&quot;A&quot;, &quot;a&quot;, layer_wms_4)

        layer_wms_5 = LayerWMS(name=&quot;__test_layer_wms_5&quot;, public=True)
        layer_wms_5.layer = &quot;testpoint_unprotected&quot;
        layer_wms_5.interfaces = [main]
        layer_wms_5.ogc_server = ogc_server
        Dimension(&quot;B&quot;, &quot;b&quot;, layer_wms_5)

        layer_wms_6 = LayerWMS(name=&quot;__test_layer_wms_6&quot;, public=True)
        layer_wms_6.layer = &quot;testpoint_unprotected&quot;
        layer_wms_6.interfaces = [main]
        layer_wms_6.ogc_server = ogc_server
        Dimension(&quot;FILTER&quot;, &quot;countries:\&quot;name\&quot; IN ( 'Germany' , 'Italy' )&quot;, layer_wms_6)

        layer_wms_7 = LayerWMS(name=&quot;__test_layer_wms_7&quot;, public=True)
        layer_wms_7.layer = &quot;testpoint_unprotected&quot;
        layer_wms_7.interfaces = [main]
        layer_wms_7.ogc_server = ogc_server
        Dimension(&quot;FLOOR&quot;, None, layer_wms_7, &quot;floor&quot;)

        layer_wmts = LayerWMTS(name=&quot;__test_layer_wmts&quot;, public=True)
        layer_wmts.url = &quot;http://tilecloudchain/1.0.0/WMTSCapabilities.xml&quot;
        layer_wmts.layer = &quot;map&quot;
        layer_wmts.interfaces = [main]
        Dimension(&quot;B&quot;, &quot;b&quot;, layer_wmts)

        layer_wmts_2 = LayerWMTS(name=&quot;__test_layer_wmts_2&quot;, public=True)
<A NAME="4"></A>        layer_wmts_2.url = &quot;http://tilecloudchain/1.0.0/WMTSCapabilities.xml&quot;
        layer_wmts_2.layer = &quot;map&quot;
        layer_wmts_2.interfaces = [main]
        Dimension<FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match90-0.html#4',2,'match90-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>(&quot;FILTER&quot;, &quot;countries:\&quot;name\&quot; IN ( 'Germany' , 'Italy' )&quot;, layer_wmts_2)

        layer_group_1 = LayerGroup(name=&quot;__test_layer_group_1&quot;)
        layer_group_1.children = [layer_wms_1, layer_wmts, layer_wmts_2]

        layer_group_2 = LayerGroup(name=&quot;__test_layer_group_2&quot;)
        layer_group_2.children = [layer_wms_1, layer_wms_2]

        layer_group_3 =</B></FONT> LayerGroup(name=&quot;__test_layer_group_3&quot;)
        layer_group_3.children = [layer_wms_1, layer_wms_3]

        layer_group_4 = LayerGroup(name=&quot;__test_layer_group_4&quot;)
        layer_group_4.children = [layer_wms_1, layer_wms_4]

        layer_group_5 = LayerGroup(name=&quot;__test_layer_group_5&quot;)
        layer_group_5.children = [layer_wms_1, layer_wms_5, layer_wms_6]

        layer_group_6 = LayerGroup(name=&quot;__test_layer_group_6&quot;)
        layer_group_6.children = [layer_wms_3]

        layer_group_7 = LayerGroup(name=&quot;__test_layer_group_7&quot;)
        layer_group_7.children = [layer_wms_7]

        theme = Theme(name=&quot;__test_theme&quot;)
        theme.interfaces = [main]
        theme.children = [
            layer_group_1,
            layer_group_2,
            layer_group_3,
            layer_group_4,
            layer_group_5,
            layer_group_6,
            layer_group_7,
        ]

        DBSession.add(theme)

        transaction.commit()

    def teardown_method(self, _):
        testing.tearDown()

        from c2cgeoportal_commons.models import DBSession
<A NAME="1"></A>        from c2cgeoportal_commons.models.main import Dimension, Interface, OGCServer, TreeItem

        DBSession.query(Dimension).delete()
        <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match90-0.html#1',2,'match90-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>for item in DBSession.query(TreeItem).all():
            DBSession.delete(item)
        DBSession.query(Interface).filter(Interface.name == &quot;main&quot;).delete()
        DBSession.query(OGCServer).delete()

        transaction.commit()

    #
    # viewer view tests
    #

    @staticmethod
    def _create_request_obj(params=None, **kwargs):
<A NAME="0"></A>        if params is None:
            params = {}
        request = create_dummy_request(</B></FONT>**kwargs)
        request<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match90-0.html#0',2,'match90-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.route_url = lambda url, **kwargs: mapserv_url
        request.params = params

        return request

    def _create_theme_obj(self, **kwargs):
        from c2cgeoportal_geoportal.views.theme import Theme

        return Theme(self._create_request_obj(**kwargs))

    def _only_name(self, item, attributes=None):
        if attributes is None:
            attributes = [&quot;name&quot;]
        result = {}

        for attribute in attributes:
            if attribute in item:
                result[attribute] = item[attribute]

        if &quot;children&quot; in item:
            result[&quot;children&quot;] = [self._only_name(i, attributes) for i in item[&quot;children&quot;]]

        r</B></FONT>eturn result

    @staticmethod
    def _get_filtered_errors(themes):
        regex = re.compile(
            r&quot;^The layer '__[a-z0-9_]+' \(__[a-z0-9_]+\) is not defined in WMS capabilities from '__test_ogc_server'$&quot;
        )
        return {e for e in themes[&quot;errors&quot;] if regex.search(e) is None}

    def test_theme_dimensions(self):
        theme_view = self._create_theme_obj(params={&quot;interface&quot;: &quot;main&quot;})
        themes = theme_view.themes()
        self.assertEqual(
            set(themes[&quot;errors&quot;]),
            {
                &quot;The layer '__test_layer_wms_2' has a wrong dimension value 'b' for 'A', expected 'a' or empty.&quot;,
<A NAME="2"></A>                &quot;The layer '__test_layer_wmts_2' has an unsupported dimension value 'countries:\&quot;name\&quot; IN ( 'Germany' , 'Italy' )' ('FILTER').&quot;,
            },
        )
        self<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match90-0.html#2',2,'match90-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.assertEqual(
            [self._only_name(t, [&quot;name&quot;, &quot;dimensions&quot;, &quot;dimensionsFilters&quot;]) for t in themes[&quot;themes&quot;]],
            [
                {
                    &quot;children&quot;: [
                        {
                            &quot;name&quot;: &quot;__test_layer_group_1&quot;,
                            &quot;children&quot;: [
                                {&quot;dimensions&quot;: {&quot;A&quot;: &quot;a&quot;}, &quot;name&quot;: &quot;__test_layer_wms_1&quot;},
                                {&quot;dimensions&quot;: {&quot;B&quot;: &quot;b&quot;}, &quot;name&quot;: &quot;__test_layer_wmts&quot;},
                            ],
                        },
                        {
                            &quot;name&quot;: &quot;__test_layer_group_2&quot;,
                            &quot;children&quot;: [{&quot;name&quot;: &quot;__test_layer_wms_1&quot;}],
                            &quot;dimensions&quot;: {&quot;A&quot;: &quot;a&quot;},
                        },
                        {
                            &quot;name&quot;: &quot;__test_layer_group_3&quot;,
                            &quot;children&quot;: [{&quot;name&quot;: &quot;__test_layer_wms_1&quot;}, {&quot;name&quot;: &quot;__test_layer_wms_3&quot;}],
                            &quot;dimensions&quot;: {&quot;A&quot;: &quot;a&quot;},
                        },
                        {
                            &quot;name&quot;: &quot;__test_layer_group_4&quot;,
                            &quot;children&quot;: [{&quot;name&quot;</B></FONT>: &quot;__test_layer_wms_1&quot;}, {&quot;name&quot;: &quot;__test_layer_wms_4&quot;}],
                            &quot;dimensions&quot;: {&quot;A&quot;: &quot;a&quot;},
                        },
                        {
                            &quot;name&quot;: &quot;__test_layer_group_5&quot;,
                            &quot;children&quot;: [
                                {&quot;name&quot;: &quot;__test_layer_wms_1&quot;},
                                {&quot;name&quot;: &quot;__test_layer_wms_5&quot;},
                                {&quot;name&quot;: &quot;__test_layer_wms_6&quot;},
                            ],
                            &quot;dimensions&quot;: {
                                &quot;A&quot;: &quot;a&quot;,
                                &quot;B&quot;: &quot;b&quot;,
                                &quot;FILTER&quot;: &quot;countries:\&quot;name\&quot; IN ( 'Germany' , 'Italy' )&quot;,
                            },
                        },
                        {
                            &quot;name&quot;: &quot;__test_layer_group_6&quot;,
                            &quot;children&quot;: [{&quot;name&quot;: &quot;__test_layer_wms_3&quot;}],
                            &quot;dimensions&quot;: {&quot;A&quot;: None},
                        },
                        {
                            &quot;name&quot;: &quot;__test_layer_group_7&quot;,
                            &quot;children&quot;: [
                                {
                                    &quot;name&quot;: &quot;__test_layer_wms_7&quot;,
                                    &quot;dimensionsFilters&quot;: {&quot;FLOOR&quot;: {&quot;field&quot;: &quot;floor&quot;, &quot;value&quot;: None}},
                                }
                            ],
                            &quot;dimensions&quot;: {},
                        },
                    ],
                    &quot;name&quot;: &quot;__test_theme&quot;,
                }
            ],
        )
</PRE>
</div>
  </div>
</body>
</html>
