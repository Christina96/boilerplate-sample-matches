<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_themes_scale.py &amp; test_themes_dimensions.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_themes_scale.py &amp; test_themes_dimensions.py
      </h3>
<h1 align="center">
        50.0%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_themes_scale.py (60.17699%)<th>test_themes_dimensions.py (42.767296%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(131-153)<td><a href="#" name="0">(174-196)</a><td align="center"><font color="#ff0000">38</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(105-120)<td><a href="#" name="1">(158-173)</a><td align="center"><font color="#c90000">30</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(159-226)<td><a href="#" name="2">(215-239)</a><td align="center"><font color="#b50000">27</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(30-48)<td><a href="#" name="3">(32-58)</a><td align="center"><font color="#640000">15</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(76-89)<td><a href="#" name="4">(112-120)</a><td align="center"><font color="#5d0000">14</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(50-55)<td><a href="#" name="5">(63-69)</a><td align="center"><font color="#500000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_themes_scale.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <a name="3"></a>
2 <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>from unittest import TestCase
3 import transaction
4 from pyramid import testing
5 from tests.functional import create_default_ogcserver, create_dummy_request, mapserv_url
6 from tests.functional import setup_common as setup_module  # noqa
7 from tests.functional import teardown_common as teardown_module  # noqa
8 class TestThemesScale(TestCase):
9     def setup_method(self, _):
10         self.maxDiff = None
11         from c2cgeoportal_commons.models import DBSession
12         from c2cgeoportal_commons.models.main import Interface, LayerGroup, LayerWMS, Metadata, Theme
13 <a name="5"></a>
14         main = Interface(name=</b></font>"desktop")
15         ogc_server <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= create_default_ogcserver()
16         layer_noscale = LayerWMS(name="__test_layer_noscale", public=True)
17         layer_noscale.layer = "test_noscale"
18         layer_noscale.interfaces = [main]
19         layer_noscale.ogc_server =</b></font> ogc_server
20         layer_minscale = LayerWMS(name="__test_layer_minscale", public=True)
21         layer_minscale.layer = "test_minscale"
22         layer_minscale.interfaces = [main]
23         layer_minscale.ogc_server = ogc_server
24         layer_maxscale = LayerWMS(name="__test_layer_maxscale", public=True)
25         layer_maxscale.layer = "test_maxscale"
26         layer_maxscale.interfaces = [main]
27         layer_maxscale.ogc_server = ogc_server
28         layer_boothscale = LayerWMS(name="__test_layer_boothscale", public=True)
29         layer_boothscale.layer = "test_boothscale"
30         layer_boothscale.interfaces = [main]
31         layer_boothscale.ogc_server = ogc_server
32         layer_metadatascale = LayerWMS(name="__test_layer_metadatascale", public=True)
33 <a name="4"></a>        layer_metadatascale.layer = "test_boothscale"
34         layer_metadatascale.interfaces = [main]
35         layer_metadatascale.ogc_server = ogc_server
36         layer_metadatascale.metadatas = [Metadata("minResolution", "100"), Metadata<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>("maxResolution", "1000")]
37         layer_group = LayerGroup(name="__test_layer_group")
38         layer_group.children = [
39             layer_noscale,
40             layer_minscale,
41             layer_maxscale,
42             layer_boothscale,
43             layer_metadatascale,
44         ]
45         theme = Theme(name="__test_theme")
46         theme.interfaces = [main]
47         theme.children =</b></font> [layer_group]
48         DBSession.add_all([theme])
49         transaction.commit()
50     def teardown_method(self, _):
51         testing.tearDown()
52         from c2cgeoportal_commons.models import DBSession
53         from c2cgeoportal_commons.models.main import Interface, Layer, LayerGroup, OGCServer, Theme
54         for layer in DBSession.query(Layer).all():
55 <a name="1"></a>            DBSession.delete(layer)
56         for g in DBSession.query(LayerGroup).all():
57             DBSession.delete(g)
58         <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>for t in DBSession.query(Theme).all():
59             DBSession.delete(t)
60         DBSession.query(Interface).filter(Interface.name == "main").delete()
61         DBSession.query(OGCServer).delete()
62         transaction.commit()
63     @staticmethod
64     def _create_request_obj(params=None, **kwargs):
65         if params is None:
66             params = {}
67         request = create_dummy_request(</b></font>
68             additional_settings={
69                 "admin_interface": {
70                     "available_metadata": [
71                         {"name": "minResolution", "type": "float"},
72                         {"name": "maxResolution", "type": "float"},
73                     ]
74                 }
75 <a name="0"></a>            },
76             **kwargs,
77         )
78         request<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.route_url = lambda url, **kwargs: mapserv_url
79         request.params = params
80         return request
81     def _create_theme_obj(self, **kwargs):
82         from c2cgeoportal_geoportal.views.theme import Theme
83         return Theme(self._create_request_obj(**kwargs))
84     def _only_name(self, item, attributes=None):
85         if attributes is None:
86             attributes = ["name"]
87         result = {}
88         for attribute in attributes:
89             if attribute in item:
90                 result[attribute] = item[attribute]
91         if "children" in item:
92             result["children"] = [self._only_name(i, attributes) for i in item["children"]]
93         r</b></font>eturn result
94     def test_scale(self):
95 <a name="2"></a>        theme_view = self._create_theme_obj()
96         themes = theme_view.themes()
97         self.assertEqual(set(themes["errors"]), set())
98         self<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertEqual(
99             [
100                 self._only_name(t, ["name", "childLayers", "minResolutionHint", "maxResolutionHint"])
101                 for t in themes["themes"]
102             ],
103             [
104                 {
105                     "name": "__test_theme",
106                     "children": [
107                         {
108                             "name": "__test_layer_group",
109                             "children": [
110                                 {
111                                     "childLayers": [
112                                         {
113                                             "minResolutionHint": 0.0,
114                                             "name": "test_noscale",
115                                             "maxResolutionHint": 999999999.0,
116                                             "queryable": True,
117                                         }
118                                     ],
119                                     "maxResolutionHint": 999999999.0,
120                                     "minResolutionHint": 0.0,
121                                     "name": "__test_layer_noscale",
122                                 },
123                                 {
124                                     "childLayers": [
125                                         {
126                                             "minResolutionHint": 1.76,
127                                             "name": "test_minscale",
128                                             "maxResolutionHint": 999999999.0,
129                                             "queryable": True,
130                                         }
131                                     ],
132                                     "maxResolutionHint": 999999999.0,
133                                     "minResolutionHint": 1.76,
134                                     "name": "__test_layer_minscale",
135                                 },
136                                 {
137                                     "childLayers": [
138                                         {
139                                             "minResolutionHint": 0.0,
140                                             "name": "test_maxscale",
141                                             "maxResolutionHint": 8.82,
142                                             "queryable": True,
143                                         }
144                                     ],
145                                     "maxResolutionHint": 8.82,
146                                     "minResolutionHint": 0.0,
147                                     "name": "__test_layer_maxscale",
148                                 },
149                                 {
150                                     "childLayers": [
151                                         {
152                                             "minResolutionHint": 1.76,
153                                             "name": "test_boothscale",
154                                             "maxResolutionHint": 8.82,
155                                             "queryable": True,
156                                         }
157                                     ],
158                                     "maxResolutionHint": 8.82,
159                                     "minResolutionHint": 1.76,
160                                     "name": "__test_layer_boothscale",
161                                 },
162                                 {
163                                     "childLayers": [
164                                         {
165                                             "minResolutionHint"</b></font>: 1.76,
166                                             "name": "test_boothscale",
167                                             "maxResolutionHint": 8.82,
168                                             "queryable": True,
169                                         }
170                                     ],
171                                     "maxResolutionHint": 1000.0,
172                                     "minResolutionHint": 100.0,
173                                     "name": "__test_layer_metadatascale",
174                                 },
175                             ],
176                         }
177                     ],
178                 }
179             ],
180         )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_themes_dimensions.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <a name="3"></a>
2 import re
3 <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>from unittest import TestCase
4 import transaction
5 from pyramid import testing
6 from tests.functional import create_default_ogcserver, create_dummy_request, mapserv_url
7 from tests.functional import setup_common as setup_module  # noqa
8 from tests.functional import teardown_common as teardown_module  # noqa
9 class TestThemesView(TestCase):
10     def setup_method(self, _):
11         self.maxDiff = None
12         from c2cgeoportal_commons.models import DBSession
13         from c2cgeoportal_commons.models.main import (
14             Dimension,
15             Interface,
16             LayerGroup,
17             LayerWMS,
18             LayerWMTS,
19             Theme,
20         )
21         ogc_server = create_default_ogcserver()
22         main =</b></font> Interface(name="main")
23 <a name="5"></a>        layer_wms_1 = LayerWMS(name="__test_layer_wms_1", public=True)
24         layer_wms_1.layer = "testpoint_unprotected"
25         layer_wms_1.interfaces = [main]
26         layer_wms_1.ogc_server <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= ogc_server
27         Dimension("A", "a", layer_wms_1)
28         layer_wms_2 = LayerWMS(name="__test_layer_wms_2", public=True)
29         layer_wms_2.layer = "testpoint_unprotected"
30         layer_wms_2.interfaces = [main]
31         layer_wms_2.ogc_server =</b></font> ogc_server
32         Dimension("A", "b", layer_wms_2)
33         layer_wms_3 = LayerWMS(name="__test_layer_wms_3", public=True)
34         layer_wms_3.layer = "testpoint_unprotected"
35         layer_wms_3.interfaces = [main]
36         layer_wms_3.ogc_server = ogc_server
37         Dimension("A", None, layer_wms_3)
38         layer_wms_4 = LayerWMS(name="__test_layer_wms_4", public=True)
39         layer_wms_4.layer = "testpoint_unprotected"
40         layer_wms_4.interfaces = [main]
41         layer_wms_4.ogc_server = ogc_server
42         Dimension("A", "a", layer_wms_4)
43         layer_wms_5 = LayerWMS(name="__test_layer_wms_5", public=True)
44         layer_wms_5.layer = "testpoint_unprotected"
45         layer_wms_5.interfaces = [main]
46         layer_wms_5.ogc_server = ogc_server
47         Dimension("B", "b", layer_wms_5)
48         layer_wms_6 = LayerWMS(name="__test_layer_wms_6", public=True)
49         layer_wms_6.layer = "testpoint_unprotected"
50         layer_wms_6.interfaces = [main]
51         layer_wms_6.ogc_server = ogc_server
52         Dimension("FILTER", "countries:\"name\" IN ( 'Germany' , 'Italy' )", layer_wms_6)
53         layer_wms_7 = LayerWMS(name="__test_layer_wms_7", public=True)
54         layer_wms_7.layer = "testpoint_unprotected"
55         layer_wms_7.interfaces = [main]
56         layer_wms_7.ogc_server = ogc_server
57         Dimension("FLOOR", None, layer_wms_7, "floor")
58         layer_wmts = LayerWMTS(name="__test_layer_wmts", public=True)
59         layer_wmts.url = "http://tilecloudchain/1.0.0/WMTSCapabilities.xml"
60         layer_wmts.layer = "map"
61         layer_wmts.interfaces = [main]
62         Dimension("B", "b", layer_wmts)
63         layer_wmts_2 = LayerWMTS(name="__test_layer_wmts_2", public=True)
64 <a name="4"></a>        layer_wmts_2.url = "http://tilecloudchain/1.0.0/WMTSCapabilities.xml"
65         layer_wmts_2.layer = "map"
66         layer_wmts_2.interfaces = [main]
67         Dimension<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>("FILTER", "countries:\"name\" IN ( 'Germany' , 'Italy' )", layer_wmts_2)
68         layer_group_1 = LayerGroup(name="__test_layer_group_1")
69         layer_group_1.children = [layer_wms_1, layer_wmts, layer_wmts_2]
70         layer_group_2 = LayerGroup(name="__test_layer_group_2")
71         layer_group_2.children = [layer_wms_1, layer_wms_2]
72         layer_group_3 =</b></font> LayerGroup(name="__test_layer_group_3")
73         layer_group_3.children = [layer_wms_1, layer_wms_3]
74         layer_group_4 = LayerGroup(name="__test_layer_group_4")
75         layer_group_4.children = [layer_wms_1, layer_wms_4]
76         layer_group_5 = LayerGroup(name="__test_layer_group_5")
77         layer_group_5.children = [layer_wms_1, layer_wms_5, layer_wms_6]
78         layer_group_6 = LayerGroup(name="__test_layer_group_6")
79         layer_group_6.children = [layer_wms_3]
80         layer_group_7 = LayerGroup(name="__test_layer_group_7")
81         layer_group_7.children = [layer_wms_7]
82         theme = Theme(name="__test_theme")
83         theme.interfaces = [main]
84         theme.children = [
85             layer_group_1,
86             layer_group_2,
87             layer_group_3,
88             layer_group_4,
89             layer_group_5,
90             layer_group_6,
91             layer_group_7,
92         ]
93         DBSession.add(theme)
94         transaction.commit()
95     def teardown_method(self, _):
96         testing.tearDown()
97         from c2cgeoportal_commons.models import DBSession
98 <a name="1"></a>        from c2cgeoportal_commons.models.main import Dimension, Interface, OGCServer, TreeItem
99         DBSession.query(Dimension).delete()
100         <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>for item in DBSession.query(TreeItem).all():
101             DBSession.delete(item)
102         DBSession.query(Interface).filter(Interface.name == "main").delete()
103         DBSession.query(OGCServer).delete()
104         transaction.commit()
105     @staticmethod
106     def _create_request_obj(params=None, **kwargs):
107 <a name="0"></a>        if params is None:
108             params = {}
109         request = create_dummy_request(</b></font>**kwargs)
110         request<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.route_url = lambda url, **kwargs: mapserv_url
111         request.params = params
112         return request
113     def _create_theme_obj(self, **kwargs):
114         from c2cgeoportal_geoportal.views.theme import Theme
115         return Theme(self._create_request_obj(**kwargs))
116     def _only_name(self, item, attributes=None):
117         if attributes is None:
118             attributes = ["name"]
119         result = {}
120         for attribute in attributes:
121             if attribute in item:
122                 result[attribute] = item[attribute]
123         if "children" in item:
124             result["children"] = [self._only_name(i, attributes) for i in item["children"]]
125         r</b></font>eturn result
126     @staticmethod
127     def _get_filtered_errors(themes):
128         regex = re.compile(
129             r"^The layer '__[a-z0-9_]+' \(__[a-z0-9_]+\) is not defined in WMS capabilities from '__test_ogc_server'$"
130         )
131         return {e for e in themes["errors"] if regex.search(e) is None}
132     def test_theme_dimensions(self):
133         theme_view = self._create_theme_obj(params={"interface": "main"})
134         themes = theme_view.themes()
135         self.assertEqual(
136             set(themes["errors"]),
137             {
138                 "The layer '__test_layer_wms_2' has a wrong dimension value 'b' for 'A', expected 'a' or empty.",
139 <a name="2"></a>                "The layer '__test_layer_wmts_2' has an unsupported dimension value 'countries:\"name\" IN ( 'Germany' , 'Italy' )' ('FILTER').",
140             },
141         )
142         self<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertEqual(
143             [self._only_name(t, ["name", "dimensions", "dimensionsFilters"]) for t in themes["themes"]],
144             [
145                 {
146                     "children": [
147                         {
148                             "name": "__test_layer_group_1",
149                             "children": [
150                                 {"dimensions": {"A": "a"}, "name": "__test_layer_wms_1"},
151                                 {"dimensions": {"B": "b"}, "name": "__test_layer_wmts"},
152                             ],
153                         },
154                         {
155                             "name": "__test_layer_group_2",
156                             "children": [{"name": "__test_layer_wms_1"}],
157                             "dimensions": {"A": "a"},
158                         },
159                         {
160                             "name": "__test_layer_group_3",
161                             "children": [{"name": "__test_layer_wms_1"}, {"name": "__test_layer_wms_3"}],
162                             "dimensions": {"A": "a"},
163                         },
164                         {
165                             "name": "__test_layer_group_4",
166                             "children": [{"name"</b></font>: "__test_layer_wms_1"}, {"name": "__test_layer_wms_4"}],
167                             "dimensions": {"A": "a"},
168                         },
169                         {
170                             "name": "__test_layer_group_5",
171                             "children": [
172                                 {"name": "__test_layer_wms_1"},
173                                 {"name": "__test_layer_wms_5"},
174                                 {"name": "__test_layer_wms_6"},
175                             ],
176                             "dimensions": {
177                                 "A": "a",
178                                 "B": "b",
179                                 "FILTER": "countries:\"name\" IN ( 'Germany' , 'Italy' )",
180                             },
181                         },
182                         {
183                             "name": "__test_layer_group_6",
184                             "children": [{"name": "__test_layer_wms_3"}],
185                             "dimensions": {"A": None},
186                         },
187                         {
188                             "name": "__test_layer_group_7",
189                             "children": [
190                                 {
191                                     "name": "__test_layer_wms_7",
192                                     "dimensionsFilters": {"FLOOR": {"field": "floor", "value": None}},
193                                 }
194                             ],
195                             "dimensions": {},
196                         },
197                     ],
198                     "name": "__test_theme",
199                 }
200             ],
201         )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
