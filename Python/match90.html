<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_themes_scale.py &amp; test_themes_dimensions.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_themes_scale.py &amp; test_themes_dimensions.py
      </h3>
<h1 align="center">
        50.0%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_themes_scale.py (60.17699%)<th>test_themes_dimensions.py (42.767296%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(131-153)<td><a href="#" name="0">(174-196)</a><td align="center"><font color="#ff0000">38</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(105-120)<td><a href="#" name="1">(158-173)</a><td align="center"><font color="#c90000">30</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(159-226)<td><a href="#" name="2">(215-239)</a><td align="center"><font color="#b50000">27</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(30-48)<td><a href="#" name="3">(32-58)</a><td align="center"><font color="#640000">15</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(76-89)<td><a href="#" name="4">(112-120)</a><td align="center"><font color="#5d0000">14</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(50-55)<td><a href="#" name="5">(63-69)</a><td align="center"><font color="#500000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_themes_scale.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>from unittest import TestCase
2 import transaction
3 from pyramid import testing
4 from tests.functional import create_default_ogcserver, create_dummy_request, mapserv_url
5 from tests.functional import setup_common as setup_module  # noqa
6 from tests.functional import teardown_common as teardown_module  # noqa
7 class TestThemesScale(TestCase):
8     def setup_method(self, _):
9         self.maxDiff = None
10         from c2cgeoportal_commons.models import DBSession
11         from c2cgeoportal_commons.models.main import Interface, LayerGroup, LayerWMS, Metadata, Theme
12         main = Interface(name=</b></font>"desktop")
13         ogc_server <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= create_default_ogcserver()
14         layer_noscale = LayerWMS(name="__test_layer_noscale", public=True)
15         layer_noscale.layer = "test_noscale"
16         layer_noscale.interfaces = [main]
17         layer_noscale.ogc_server =</b></font> ogc_server
18         layer_minscale = LayerWMS(name="__test_layer_minscale", public=True)
19         layer_minscale.layer = "test_minscale"
20         layer_minscale.interfaces = [main]
21         layer_minscale.ogc_server = ogc_server
22         layer_maxscale = LayerWMS(name="__test_layer_maxscale", public=True)
23         layer_maxscale.layer = "test_maxscale"
24         layer_maxscale.interfaces = [main]
25         layer_maxscale.ogc_server = ogc_server
26         layer_boothscale = LayerWMS(name="__test_layer_boothscale", public=True)
27         layer_boothscale.layer = "test_boothscale"
28         layer_boothscale.interfaces = [main]
29         layer_boothscale.ogc_server = ogc_server
30         layer_metadatascale = LayerWMS(name="__test_layer_metadatascale", public=True)
31         layer_metadatascale.interfaces = [main]
32         layer_metadatascale.ogc_server = ogc_server
33         layer_metadatascale.metadatas = [Metadata("minResolution", "100"), Metadata<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>("maxResolution", "1000")]
34         layer_group = LayerGroup(name="__test_layer_group")
35         layer_group.children = [
36             layer_noscale,
37             layer_minscale,
38             layer_maxscale,
39             layer_boothscale,
40             layer_metadatascale,
41         ]
42         theme = Theme(name="__test_theme")
43         theme.interfaces = [main]
44         theme.children =</b></font> [layer_group]
45         DBSession.add_all([theme])
46         transaction.commit()
47     def teardown_method(self, _):
48         testing.tearDown()
49         from c2cgeoportal_commons.models import DBSession
50         from c2cgeoportal_commons.models.main import Interface, Layer, LayerGroup, OGCServer, Theme
51         for layer in DBSession.query(Layer).all():
52         for g in DBSession.query(LayerGroup).all():
53             DBSession.delete(g)
54         <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>for t in DBSession.query(Theme).all():
55             DBSession.delete(t)
56         DBSession.query(Interface).filter(Interface.name == "main").delete()
57         DBSession.query(OGCServer).delete()
58         transaction.commit()
59     @staticmethod
60     def _create_request_obj(params=None, **kwargs):
61         if params is None:
62             params = {}
63         request = create_dummy_request(</b></font>
64             additional_settings={
65                 "admin_interface": {
66                     "available_metadata": [
67                         {"name": "minResolution", "type": "float"},
68                         {"name": "maxResolution", "type": "float"},
69                     ]
70                 }
71             **kwargs,
72         )
73         request<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.route_url = lambda url, **kwargs: mapserv_url
74         request.params = params
75         return request
76     def _create_theme_obj(self, **kwargs):
77         from c2cgeoportal_geoportal.views.theme import Theme
78         return Theme(self._create_request_obj(**kwargs))
79     def _only_name(self, item, attributes=None):
80         if attributes is None:
81             attributes = ["name"]
82         result = {}
83         for attribute in attributes:
84             if attribute in item:
85                 result[attribute] = item[attribute]
86         if "children" in item:
87             result["children"] = [self._only_name(i, attributes) for i in item["children"]]
88         r</b></font>eturn result
89     def test_scale(self):
90         themes = theme_view.themes()
91         self.assertEqual(set(themes["errors"]), set())
92         self<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertEqual(
93             [
94                 self._only_name(t, ["name", "childLayers", "minResolutionHint", "maxResolutionHint"])
95                 for t in themes["themes"]
96             ],
97             [
98                 {
99                     "name": "__test_theme",
100                     "children": [
101                         {
102                             "name": "__test_layer_group",
103                             "children": [
104                                 {
105                                     "childLayers": [
106                                         {
107                                             "minResolutionHint": 0.0,
108                                             "name": "test_noscale",
109                                             "maxResolutionHint": 999999999.0,
110                                             "queryable": True,
111                                         }
112                                     ],
113                                     "maxResolutionHint": 999999999.0,
114                                     "minResolutionHint": 0.0,
115                                     "name": "__test_layer_noscale",
116                                 },
117                                 {
118                                     "childLayers": [
119                                         {
120                                             "minResolutionHint": 1.76,
121                                             "name": "test_minscale",
122                                             "maxResolutionHint": 999999999.0,
123                                             "queryable": True,
124                                         }
125                                     ],
126                                     "maxResolutionHint": 999999999.0,
127                                     "minResolutionHint": 1.76,
128                                     "name": "__test_layer_minscale",
129                                 },
130                                 {
131                                     "childLayers": [
132                                         {
133                                             "minResolutionHint": 0.0,
134                                             "name": "test_maxscale",
135                                             "maxResolutionHint": 8.82,
136                                             "queryable": True,
137                                         }
138                                     ],
139                                     "maxResolutionHint": 8.82,
140                                     "minResolutionHint": 0.0,
141                                     "name": "__test_layer_maxscale",
142                                 },
143                                 {
144                                     "childLayers": [
145                                         {
146                                             "minResolutionHint": 1.76,
147                                             "name": "test_boothscale",
148                                             "maxResolutionHint": 8.82,
149                                             "queryable": True,
150                                         }
151                                     ],
152                                     "maxResolutionHint": 8.82,
153                                     "minResolutionHint": 1.76,
154                                     "name": "__test_layer_boothscale",
155                                 },
156                                 {
157                                     "childLayers": [
158                                         {
159                                             "minResolutionHint"</b></font>: 1.76,
160                                             "name": "test_boothscale",
161                                             "maxResolutionHint": 8.82,
162                                             "queryable": True,
163                                         }
164                                     ],
165                                     "maxResolutionHint": 1000.0,
166                                     "minResolutionHint": 100.0,
167                                     "name": "__test_layer_metadatascale",
168                                 },
169                             ],
170                         }
171                     ],
172                 }
173             ],
174         )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_themes_dimensions.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import re
2 <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>from unittest import TestCase
3 import transaction
4 from pyramid import testing
5 from tests.functional import create_default_ogcserver, create_dummy_request, mapserv_url
6 from tests.functional import setup_common as setup_module  # noqa
7 from tests.functional import teardown_common as teardown_module  # noqa
8 class TestThemesView(TestCase):
9     def setup_method(self, _):
10         self.maxDiff = None
11         from c2cgeoportal_commons.models import DBSession
12         from c2cgeoportal_commons.models.main import (
13             Dimension,
14             Interface,
15             LayerGroup,
16             LayerWMS,
17             LayerWMTS,
18             Theme,
19         )
20         ogc_server = create_default_ogcserver()
21         main =</b></font> Interface(name="main")
22         layer_wms_1.layer = "testpoint_unprotected"
23         layer_wms_1.interfaces = [main]
24         layer_wms_1.ogc_server <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= ogc_server
25         Dimension("A", "a", layer_wms_1)
26         layer_wms_2 = LayerWMS(name="__test_layer_wms_2", public=True)
27         layer_wms_2.layer = "testpoint_unprotected"
28         layer_wms_2.interfaces = [main]
29         layer_wms_2.ogc_server =</b></font> ogc_server
30         Dimension("A", "b", layer_wms_2)
31         layer_wms_3 = LayerWMS(name="__test_layer_wms_3", public=True)
32         layer_wms_3.layer = "testpoint_unprotected"
33         layer_wms_3.interfaces = [main]
34         layer_wms_3.ogc_server = ogc_server
35         Dimension("A", None, layer_wms_3)
36         layer_wms_4 = LayerWMS(name="__test_layer_wms_4", public=True)
37         layer_wms_4.layer = "testpoint_unprotected"
38         layer_wms_4.interfaces = [main]
39         layer_wms_4.ogc_server = ogc_server
40         Dimension("A", "a", layer_wms_4)
41         layer_wms_5 = LayerWMS(name="__test_layer_wms_5", public=True)
42         layer_wms_5.layer = "testpoint_unprotected"
43         layer_wms_5.interfaces = [main]
44         layer_wms_5.ogc_server = ogc_server
45         Dimension("B", "b", layer_wms_5)
46         layer_wms_6 = LayerWMS(name="__test_layer_wms_6", public=True)
47         layer_wms_6.layer = "testpoint_unprotected"
48         layer_wms_6.interfaces = [main]
49         layer_wms_6.ogc_server = ogc_server
50         Dimension("FILTER", "countries:\"name\" IN ( 'Germany' , 'Italy' )", layer_wms_6)
51         layer_wms_7 = LayerWMS(name="__test_layer_wms_7", public=True)
52         layer_wms_7.layer = "testpoint_unprotected"
53         layer_wms_7.interfaces = [main]
54         layer_wms_7.ogc_server = ogc_server
55         Dimension("FLOOR", None, layer_wms_7, "floor")
56         layer_wmts = LayerWMTS(name="__test_layer_wmts", public=True)
57         layer_wmts.url = "http://tilecloudchain/1.0.0/WMTSCapabilities.xml"
58         layer_wmts.layer = "map"
59         layer_wmts.interfaces = [main]
60         Dimension("B", "b", layer_wmts)
61         layer_wmts_2 = LayerWMTS(name="__test_layer_wmts_2", public=True)
62         layer_wmts_2.layer = "map"
63         layer_wmts_2.interfaces = [main]
64         Dimension<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>("FILTER", "countries:\"name\" IN ( 'Germany' , 'Italy' )", layer_wmts_2)
65         layer_group_1 = LayerGroup(name="__test_layer_group_1")
66         layer_group_1.children = [layer_wms_1, layer_wmts, layer_wmts_2]
67         layer_group_2 = LayerGroup(name="__test_layer_group_2")
68         layer_group_2.children = [layer_wms_1, layer_wms_2]
69         layer_group_3 =</b></font> LayerGroup(name="__test_layer_group_3")
70         layer_group_3.children = [layer_wms_1, layer_wms_3]
71         layer_group_4 = LayerGroup(name="__test_layer_group_4")
72         layer_group_4.children = [layer_wms_1, layer_wms_4]
73         layer_group_5 = LayerGroup(name="__test_layer_group_5")
74         layer_group_5.children = [layer_wms_1, layer_wms_5, layer_wms_6]
75         layer_group_6 = LayerGroup(name="__test_layer_group_6")
76         layer_group_6.children = [layer_wms_3]
77         layer_group_7 = LayerGroup(name="__test_layer_group_7")
78         layer_group_7.children = [layer_wms_7]
79         theme = Theme(name="__test_theme")
80         theme.interfaces = [main]
81         theme.children = [
82             layer_group_1,
83             layer_group_2,
84             layer_group_3,
85             layer_group_4,
86             layer_group_5,
87             layer_group_6,
88             layer_group_7,
89         ]
90         DBSession.add(theme)
91         transaction.commit()
92     def teardown_method(self, _):
93         testing.tearDown()
94         from c2cgeoportal_commons.models import DBSession
95         DBSession.query(Dimension).delete()
96         <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>for item in DBSession.query(TreeItem).all():
97             DBSession.delete(item)
98         DBSession.query(Interface).filter(Interface.name == "main").delete()
99         DBSession.query(OGCServer).delete()
100         transaction.commit()
101     @staticmethod
102     def _create_request_obj(params=None, **kwargs):
103             params = {}
104         request = create_dummy_request(</b></font>**kwargs)
105         request<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.route_url = lambda url, **kwargs: mapserv_url
106         request.params = params
107         return request
108     def _create_theme_obj(self, **kwargs):
109         from c2cgeoportal_geoportal.views.theme import Theme
110         return Theme(self._create_request_obj(**kwargs))
111     def _only_name(self, item, attributes=None):
112         if attributes is None:
113             attributes = ["name"]
114         result = {}
115         for attribute in attributes:
116             if attribute in item:
117                 result[attribute] = item[attribute]
118         if "children" in item:
119             result["children"] = [self._only_name(i, attributes) for i in item["children"]]
120         r</b></font>eturn result
121     @staticmethod
122     def _get_filtered_errors(themes):
123         regex = re.compile(
124             r"^The layer '__[a-z0-9_]+' \(__[a-z0-9_]+\) is not defined in WMS capabilities from '__test_ogc_server'$"
125         )
126         return {e for e in themes["errors"] if regex.search(e) is None}
127     def test_theme_dimensions(self):
128         theme_view = self._create_theme_obj(params={"interface": "main"})
129         themes = theme_view.themes()
130         self.assertEqual(
131             set(themes["errors"]),
132             {
133                 "The layer '__test_layer_wms_2' has a wrong dimension value 'b' for 'A', expected 'a' or empty.",
134             },
135         )
136         self<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertEqual(
137             [self._only_name(t, ["name", "dimensions", "dimensionsFilters"]) for t in themes["themes"]],
138             [
139                 {
140                     "children": [
141                         {
142                             "name": "__test_layer_group_1",
143                             "children": [
144                                 {"dimensions": {"A": "a"}, "name": "__test_layer_wms_1"},
145                                 {"dimensions": {"B": "b"}, "name": "__test_layer_wmts"},
146                             ],
147                         },
148                         {
149                             "name": "__test_layer_group_2",
150                             "children": [{"name": "__test_layer_wms_1"}],
151                             "dimensions": {"A": "a"},
152                         },
153                         {
154                             "name": "__test_layer_group_3",
155                             "children": [{"name": "__test_layer_wms_1"}, {"name": "__test_layer_wms_3"}],
156                             "dimensions": {"A": "a"},
157                         },
158                         {
159                             "name": "__test_layer_group_4",
160                             "children": [{"name"</b></font>: "__test_layer_wms_1"}, {"name": "__test_layer_wms_4"}],
161                             "dimensions": {"A": "a"},
162                         },
163                         {
164                             "name": "__test_layer_group_5",
165                             "children": [
166                                 {"name": "__test_layer_wms_1"},
167                                 {"name": "__test_layer_wms_5"},
168                                 {"name": "__test_layer_wms_6"},
169                             ],
170                             "dimensions": {
171                                 "A": "a",
172                                 "B": "b",
173                                 "FILTER": "countries:\"name\" IN ( 'Germany' , 'Italy' )",
174                             },
175                         },
176                         {
177                             "name": "__test_layer_group_6",
178                             "children": [{"name": "__test_layer_wms_3"}],
179                             "dimensions": {"A": None},
180                         },
181                         {
182                             "name": "__test_layer_group_7",
183                             "children": [
184                                 {
185                                     "name": "__test_layer_wms_7",
186                                     "dimensionsFilters": {"FLOOR": {"field": "floor", "value": None}},
187                                 }
188                             ],
189                             "dimensions": {},
190                         },
191                     ],
192                     "name": "__test_theme",
193                 }
194             ],
195         )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
