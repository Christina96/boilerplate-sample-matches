<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_themes_scale.py &amp; test_themes_dimensions.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_themes_scale.py &amp; test_themes_dimensions.py
      </h3>
<h1 align="center">
        50.0%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_themes_scale.py (60.17699%)<th>test_themes_dimensions.py (42.767296%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(131-153)<td><a href="#" name="0">(174-196)</a><td align="center"><font color="#ff0000">38</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(105-120)<td><a href="#" name="1">(158-173)</a><td align="center"><font color="#c90000">30</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(159-226)<td><a href="#" name="2">(215-239)</a><td align="center"><font color="#b50000">27</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(30-48)<td><a href="#" name="3">(32-58)</a><td align="center"><font color="#640000">15</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(76-89)<td><a href="#" name="4">(112-120)</a><td align="center"><font color="#5d0000">14</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(50-55)<td><a href="#" name="5">(63-69)</a><td align="center"><font color="#500000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_themes_scale.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>from unittest import TestCase
import transaction
from pyramid import testing
from tests.functional import create_default_ogcserver, create_dummy_request, mapserv_url
from tests.functional import setup_common as setup_module  # noqa
from tests.functional import teardown_common as teardown_module  # noqa
class TestThemesScale(TestCase):
    def setup_method(self, _):
        self.maxDiff = None
        from c2cgeoportal_commons.models import DBSession
        from c2cgeoportal_commons.models.main import Interface, LayerGroup, LayerWMS, Metadata, Theme
        main = Interface(name=</b></font>"desktop")
        ogc_server <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= create_default_ogcserver()
        layer_noscale = LayerWMS(name="__test_layer_noscale", public=True)
        layer_noscale.layer = "test_noscale"
        layer_noscale.interfaces = [main]
        layer_noscale.ogc_server =</b></font> ogc_server
        layer_minscale = LayerWMS(name="__test_layer_minscale", public=True)
        layer_minscale.layer = "test_minscale"
        layer_minscale.interfaces = [main]
        layer_minscale.ogc_server = ogc_server
        layer_maxscale = LayerWMS(name="__test_layer_maxscale", public=True)
        layer_maxscale.layer = "test_maxscale"
        layer_maxscale.interfaces = [main]
        layer_maxscale.ogc_server = ogc_server
        layer_boothscale = LayerWMS(name="__test_layer_boothscale", public=True)
        layer_boothscale.layer = "test_boothscale"
        layer_boothscale.interfaces = [main]
        layer_boothscale.ogc_server = ogc_server
        layer_metadatascale = LayerWMS(name="__test_layer_metadatascale", public=True)
        layer_metadatascale.interfaces = [main]
        layer_metadatascale.ogc_server = ogc_server
        layer_metadatascale.metadatas = [Metadata("minResolution", "100"), Metadata<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>("maxResolution", "1000")]
        layer_group = LayerGroup(name="__test_layer_group")
        layer_group.children = [
            layer_noscale,
            layer_minscale,
            layer_maxscale,
            layer_boothscale,
            layer_metadatascale,
        ]
        theme = Theme(name="__test_theme")
        theme.interfaces = [main]
        theme.children =</b></font> [layer_group]
        DBSession.add_all([theme])
        transaction.commit()
    def teardown_method(self, _):
        testing.tearDown()
        from c2cgeoportal_commons.models import DBSession
        from c2cgeoportal_commons.models.main import Interface, Layer, LayerGroup, OGCServer, Theme
        for layer in DBSession.query(Layer).all():
        for g in DBSession.query(LayerGroup).all():
            DBSession.delete(g)
        <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>for t in DBSession.query(Theme).all():
            DBSession.delete(t)
        DBSession.query(Interface).filter(Interface.name == "main").delete()
        DBSession.query(OGCServer).delete()
        transaction.commit()
    @staticmethod
    def _create_request_obj(params=None, **kwargs):
        if params is None:
            params = {}
        request = create_dummy_request(</b></font>
            additional_settings={
                "admin_interface": {
                    "available_metadata": [
                        {"name": "minResolution", "type": "float"},
                        {"name": "maxResolution", "type": "float"},
                    ]
                }
            **kwargs,
        )
        request<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.route_url = lambda url, **kwargs: mapserv_url
        request.params = params
        return request
    def _create_theme_obj(self, **kwargs):
        from c2cgeoportal_geoportal.views.theme import Theme
        return Theme(self._create_request_obj(**kwargs))
    def _only_name(self, item, attributes=None):
        if attributes is None:
            attributes = ["name"]
        result = {}
        for attribute in attributes:
            if attribute in item:
                result[attribute] = item[attribute]
        if "children" in item:
            result["children"] = [self._only_name(i, attributes) for i in item["children"]]
        r</b></font>eturn result
    def test_scale(self):
        themes = theme_view.themes()
        self.assertEqual(set(themes["errors"]), set())
        self<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertEqual(
            [
                self._only_name(t, ["name", "childLayers", "minResolutionHint", "maxResolutionHint"])
                for t in themes["themes"]
            ],
            [
                {
                    "name": "__test_theme",
                    "children": [
                        {
                            "name": "__test_layer_group",
                            "children": [
                                {
                                    "childLayers": [
                                        {
                                            "minResolutionHint": 0.0,
                                            "name": "test_noscale",
                                            "maxResolutionHint": 999999999.0,
                                            "queryable": True,
                                        }
                                    ],
                                    "maxResolutionHint": 999999999.0,
                                    "minResolutionHint": 0.0,
                                    "name": "__test_layer_noscale",
                                },
                                {
                                    "childLayers": [
                                        {
                                            "minResolutionHint": 1.76,
                                            "name": "test_minscale",
                                            "maxResolutionHint": 999999999.0,
                                            "queryable": True,
                                        }
                                    ],
                                    "maxResolutionHint": 999999999.0,
                                    "minResolutionHint": 1.76,
                                    "name": "__test_layer_minscale",
                                },
                                {
                                    "childLayers": [
                                        {
                                            "minResolutionHint": 0.0,
                                            "name": "test_maxscale",
                                            "maxResolutionHint": 8.82,
                                            "queryable": True,
                                        }
                                    ],
                                    "maxResolutionHint": 8.82,
                                    "minResolutionHint": 0.0,
                                    "name": "__test_layer_maxscale",
                                },
                                {
                                    "childLayers": [
                                        {
                                            "minResolutionHint": 1.76,
                                            "name": "test_boothscale",
                                            "maxResolutionHint": 8.82,
                                            "queryable": True,
                                        }
                                    ],
                                    "maxResolutionHint": 8.82,
                                    "minResolutionHint": 1.76,
                                    "name": "__test_layer_boothscale",
                                },
                                {
                                    "childLayers": [
                                        {
                                            "minResolutionHint"</b></font>: 1.76,
                                            "name": "test_boothscale",
                                            "maxResolutionHint": 8.82,
                                            "queryable": True,
                                        }
                                    ],
                                    "maxResolutionHint": 1000.0,
                                    "minResolutionHint": 100.0,
                                    "name": "__test_layer_metadatascale",
                                },
                            ],
                        }
                    ],
                }
            ],
        )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_themes_dimensions.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import re
<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>from unittest import TestCase
import transaction
from pyramid import testing
from tests.functional import create_default_ogcserver, create_dummy_request, mapserv_url
from tests.functional import setup_common as setup_module  # noqa
from tests.functional import teardown_common as teardown_module  # noqa
class TestThemesView(TestCase):
    def setup_method(self, _):
        self.maxDiff = None
        from c2cgeoportal_commons.models import DBSession
        from c2cgeoportal_commons.models.main import (
            Dimension,
            Interface,
            LayerGroup,
            LayerWMS,
            LayerWMTS,
            Theme,
        )
        ogc_server = create_default_ogcserver()
        main =</b></font> Interface(name="main")
        layer_wms_1.layer = "testpoint_unprotected"
        layer_wms_1.interfaces = [main]
        layer_wms_1.ogc_server <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= ogc_server
        Dimension("A", "a", layer_wms_1)
        layer_wms_2 = LayerWMS(name="__test_layer_wms_2", public=True)
        layer_wms_2.layer = "testpoint_unprotected"
        layer_wms_2.interfaces = [main]
        layer_wms_2.ogc_server =</b></font> ogc_server
        Dimension("A", "b", layer_wms_2)
        layer_wms_3 = LayerWMS(name="__test_layer_wms_3", public=True)
        layer_wms_3.layer = "testpoint_unprotected"
        layer_wms_3.interfaces = [main]
        layer_wms_3.ogc_server = ogc_server
        Dimension("A", None, layer_wms_3)
        layer_wms_4 = LayerWMS(name="__test_layer_wms_4", public=True)
        layer_wms_4.layer = "testpoint_unprotected"
        layer_wms_4.interfaces = [main]
        layer_wms_4.ogc_server = ogc_server
        Dimension("A", "a", layer_wms_4)
        layer_wms_5 = LayerWMS(name="__test_layer_wms_5", public=True)
        layer_wms_5.layer = "testpoint_unprotected"
        layer_wms_5.interfaces = [main]
        layer_wms_5.ogc_server = ogc_server
        Dimension("B", "b", layer_wms_5)
        layer_wms_6 = LayerWMS(name="__test_layer_wms_6", public=True)
        layer_wms_6.layer = "testpoint_unprotected"
        layer_wms_6.interfaces = [main]
        layer_wms_6.ogc_server = ogc_server
        Dimension("FILTER", "countries:\"name\" IN ( 'Germany' , 'Italy' )", layer_wms_6)
        layer_wms_7 = LayerWMS(name="__test_layer_wms_7", public=True)
        layer_wms_7.layer = "testpoint_unprotected"
        layer_wms_7.interfaces = [main]
        layer_wms_7.ogc_server = ogc_server
        Dimension("FLOOR", None, layer_wms_7, "floor")
        layer_wmts = LayerWMTS(name="__test_layer_wmts", public=True)
        layer_wmts.url = "http://tilecloudchain/1.0.0/WMTSCapabilities.xml"
        layer_wmts.layer = "map"
        layer_wmts.interfaces = [main]
        Dimension("B", "b", layer_wmts)
        layer_wmts_2 = LayerWMTS(name="__test_layer_wmts_2", public=True)
        layer_wmts_2.layer = "map"
        layer_wmts_2.interfaces = [main]
        Dimension<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>("FILTER", "countries:\"name\" IN ( 'Germany' , 'Italy' )", layer_wmts_2)
        layer_group_1 = LayerGroup(name="__test_layer_group_1")
        layer_group_1.children = [layer_wms_1, layer_wmts, layer_wmts_2]
        layer_group_2 = LayerGroup(name="__test_layer_group_2")
        layer_group_2.children = [layer_wms_1, layer_wms_2]
        layer_group_3 =</b></font> LayerGroup(name="__test_layer_group_3")
        layer_group_3.children = [layer_wms_1, layer_wms_3]
        layer_group_4 = LayerGroup(name="__test_layer_group_4")
        layer_group_4.children = [layer_wms_1, layer_wms_4]
        layer_group_5 = LayerGroup(name="__test_layer_group_5")
        layer_group_5.children = [layer_wms_1, layer_wms_5, layer_wms_6]
        layer_group_6 = LayerGroup(name="__test_layer_group_6")
        layer_group_6.children = [layer_wms_3]
        layer_group_7 = LayerGroup(name="__test_layer_group_7")
        layer_group_7.children = [layer_wms_7]
        theme = Theme(name="__test_theme")
        theme.interfaces = [main]
        theme.children = [
            layer_group_1,
            layer_group_2,
            layer_group_3,
            layer_group_4,
            layer_group_5,
            layer_group_6,
            layer_group_7,
        ]
        DBSession.add(theme)
        transaction.commit()
    def teardown_method(self, _):
        testing.tearDown()
        from c2cgeoportal_commons.models import DBSession
        DBSession.query(Dimension).delete()
        <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>for item in DBSession.query(TreeItem).all():
            DBSession.delete(item)
        DBSession.query(Interface).filter(Interface.name == "main").delete()
        DBSession.query(OGCServer).delete()
        transaction.commit()
    @staticmethod
    def _create_request_obj(params=None, **kwargs):
            params = {}
        request = create_dummy_request(</b></font>**kwargs)
        request<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.route_url = lambda url, **kwargs: mapserv_url
        request.params = params
        return request
    def _create_theme_obj(self, **kwargs):
        from c2cgeoportal_geoportal.views.theme import Theme
        return Theme(self._create_request_obj(**kwargs))
    def _only_name(self, item, attributes=None):
        if attributes is None:
            attributes = ["name"]
        result = {}
        for attribute in attributes:
            if attribute in item:
                result[attribute] = item[attribute]
        if "children" in item:
            result["children"] = [self._only_name(i, attributes) for i in item["children"]]
        r</b></font>eturn result
    @staticmethod
    def _get_filtered_errors(themes):
        regex = re.compile(
            r"^The layer '__[a-z0-9_]+' \(__[a-z0-9_]+\) is not defined in WMS capabilities from '__test_ogc_server'$"
        )
        return {e for e in themes["errors"] if regex.search(e) is None}
    def test_theme_dimensions(self):
        theme_view = self._create_theme_obj(params={"interface": "main"})
        themes = theme_view.themes()
        self.assertEqual(
            set(themes["errors"]),
            {
                "The layer '__test_layer_wms_2' has a wrong dimension value 'b' for 'A', expected 'a' or empty.",
            },
        )
        self<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assertEqual(
            [self._only_name(t, ["name", "dimensions", "dimensionsFilters"]) for t in themes["themes"]],
            [
                {
                    "children": [
                        {
                            "name": "__test_layer_group_1",
                            "children": [
                                {"dimensions": {"A": "a"}, "name": "__test_layer_wms_1"},
                                {"dimensions": {"B": "b"}, "name": "__test_layer_wmts"},
                            ],
                        },
                        {
                            "name": "__test_layer_group_2",
                            "children": [{"name": "__test_layer_wms_1"}],
                            "dimensions": {"A": "a"},
                        },
                        {
                            "name": "__test_layer_group_3",
                            "children": [{"name": "__test_layer_wms_1"}, {"name": "__test_layer_wms_3"}],
                            "dimensions": {"A": "a"},
                        },
                        {
                            "name": "__test_layer_group_4",
                            "children": [{"name"</b></font>: "__test_layer_wms_1"}, {"name": "__test_layer_wms_4"}],
                            "dimensions": {"A": "a"},
                        },
                        {
                            "name": "__test_layer_group_5",
                            "children": [
                                {"name": "__test_layer_wms_1"},
                                {"name": "__test_layer_wms_5"},
                                {"name": "__test_layer_wms_6"},
                            ],
                            "dimensions": {
                                "A": "a",
                                "B": "b",
                                "FILTER": "countries:\"name\" IN ( 'Germany' , 'Italy' )",
                            },
                        },
                        {
                            "name": "__test_layer_group_6",
                            "children": [{"name": "__test_layer_wms_3"}],
                            "dimensions": {"A": None},
                        },
                        {
                            "name": "__test_layer_group_7",
                            "children": [
                                {
                                    "name": "__test_layer_wms_7",
                                    "dimensionsFilters": {"FLOOR": {"field": "floor", "value": None}},
                                }
                            ],
                            "dimensions": {},
                        },
                    ],
                    "name": "__test_theme",
                }
            ],
        )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
