<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for win_update.py &amp; test_jinja_3.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for win_update.py &amp; test_jinja_3.py
      </h3>
<h1 align="center">
        2.3%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>win_update.py (1.2229539%)<th>test_jinja_3.py (22.807018%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(169-175)<td><a href="#" name="0">(15-27)</a><td align="center"><font color="#ff0000">13</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>win_update.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import subprocess
3 import salt.utils.args
4 import salt.utils.data
5 import salt.utils.winapi
6 from salt.exceptions import CommandExecutionError
7 try:
8     import win32com.client
9     import pywintypes
10     HAS_PYWIN32 = True
11 except ImportError:
12     HAS_PYWIN32 = False
13 log = logging.getLogger(__name__)
14 REBOOT_BEHAVIOR = {
15     0: "Never Requires Reboot",
16     1: "Always Requires Reboot",
17     2: "Can Require Reboot",
18 }
19 __virtualname__ = "win_update"
20 def __virtual__():
21     if not salt.utils.platform.is_windows():
22         return False, "win_update: Only available on Windows"
23     if not HAS_PYWIN32:
24         return False, "win_update: Missing pywin32"
25     return __virtualname__
26 class Updates:
27     update_types = {1: "Software", 2: "Driver"}
28     def __init__(self):
29         with salt.utils.winapi.Com():
30             self.updates = win32com.client.Dispatch("Microsoft.Update.UpdateColl")
31     def count(self):
32         return self.updates.Count
33     def list(self):
34         if self.count() == 0:
35             return "Nothing to return"
36         log.debug("Building a detailed report of the results.")
37         results = {}
38         for update in self.updates:
39             try:
40                 user_input = bool(update.InstallationBehavior.CanRequestUserInput)
41             except AttributeError:
42                 log.debug(
43                     "Windows Update: Error reading InstallationBehavior COM Object"
44                 )
45                 user_input = False
46             try:
47                 requires_reboot = update.InstallationBehavior.RebootBehavior
48             except AttributeError:
49                 log.debug(
50                     "Windows Update: Error reading InstallationBehavior COM Object"
51                 )
52                 requires_reboot = 2
53 <a name="0"></a>            results[update.Identity.UpdateID] = {
54                 "guid": update.Identity.UpdateID,
55                 "Title": str(update.Title),
56                 "Type": self.update_types<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>[update.Type],
57                 "Description": update.Description,
58                 "Downloaded": bool(update.IsDownloaded),
59                 "Installed": bool(update.IsInstalled),
60                 "Mandatory": bool(update.IsMandatory),
61                 "EULAAccepted": bool(update.EulaAccepted),
62                 "NeedsReboot": bool(update.</b></font>RebootRequired),
63                 "Severity": str(update.MsrcSeverity),
64                 "UserInput": user_input,
65                 "RebootBehavior": REBOOT_BEHAVIOR[requires_reboot],
66                 "KBs": ["KB" + item for item in update.KBArticleIDs],
67                 "Categories": [item.Name for item in update.Categories],
68                 "SupportUrl": update.SupportUrl,
69             }
70         return results
71     def summary(self):
72         if self.count() == 0:
73             return "Nothing to return"
74         results = {
75             "Total": 0,
76             "Available": 0,
77             "Downloaded": 0,
78             "Installed": 0,
79             "Categories": {},
80             "Severity": {},
81         }
82         for update in self.updates:
83             results["Total"] += 1
84             if not salt.utils.data.is_true(
85                 update.IsDownloaded
86             ) and not salt.utils.data.is_true(update.IsInstalled):
87                 results["Available"] += 1
88             if salt.utils.data.is_true(
89                 update.IsDownloaded
90             ) and not salt.utils.data.is_true(update.IsInstalled):
91                 results["Downloaded"] += 1
92             if salt.utils.data.is_true(update.IsInstalled):
93                 results["Installed"] += 1
94             for category in update.Categories:
95                 if category.Name in results["Categories"]:
96                     results["Categories"][category.Name] += 1
97                 else:
98                     results["Categories"][category.Name] = 1
99             if update.MsrcSeverity:
100                 if update.MsrcSeverity in results["Severity"]:
101                     results["Severity"][update.MsrcSeverity] += 1
102                 else:
103                     results["Severity"][update.MsrcSeverity] = 1
104         return results
105 class WindowsUpdateAgent:
106     fail_codes = {
107         -2145107924: "WinHTTP Send/Receive failed: 0x8024402C",
108         -2145124300: "Download failed: 0x80240034",
109         -2145124302: "Invalid search criteria: 0x80240032",
110         -2145124305: "Cancelled by policy: 0x8024002F",
111         -2145124307: "Missing source: 0x8024002D",
112         -2145124308: "Missing source: 0x8024002C",
113         -2145124312: "Uninstall not allowed: 0x80240028",
114         -2145124315: "Prevented by policy: 0x80240025",
115         -2145124316: "No Updates: 0x80240024",
116         -2145124322: "Service being shutdown: 0x8024001E",
117         -2145124325: "Self Update in Progress: 0x8024001B",
118         -2145124327: "Exclusive Install Conflict: 0x80240019",
119         -2145124330: "Install not allowed: 0x80240016",
120         -2145124333: "Duplicate item: 0x80240013",
121         -2145124341: "Operation cancelled: 0x8024000B",
122         -2145124343: "Operation in progress: 0x80240009",
123         -2145124284: "Access Denied: 0x8024044",
124         -2145124283: "Unsupported search scope: 0x80240045",
125         -2147024891: "Access is denied: 0x80070005",
126         -2149843018: "Setup in progress: 0x8024004A",
127         -4292599787: "Install still pending: 0x00242015",
128         -4292607992: "Already downloaded: 0x00240008",
129         -4292607993: "Already uninstalled: 0x00240007",
130         -4292607994: "Already installed: 0x00240006",
131         -4292607995: "Reboot required: 0x00240005",
132     }
133     def __init__(self, online=True):
134         with salt.utils.winapi.Com():
135             self._session = win32com.client.Dispatch("Microsoft.Update.Session")
136             self._updates = win32com.client.Dispatch("Microsoft.Update.UpdateColl")
137         self.refresh(online=online)
138     def updates(self):
139         updates = Updates()
140         found = updates.updates
141         for update in self._updates:
142             found.Add(update)
143         return updates
144     def refresh(self, online=True):
145         search_string = "Type='Software' or Type='Driver'"
146         searcher = self._session.CreateUpdateSearcher()
147         searcher.Online = online
148         self._session.ClientApplicationID = "Salt: Load Updates"
149         try:
150             results = searcher.Search(search_string)
151             if results.Updates.Count == 0:
152                 log.debug("No Updates found for:\n\t\t%s", search_string)
153                 return "No Updates found: {}".format(search_string)
154         except pywintypes.com_error as error:
155             hr, msg, exc, arg = error.args  # pylint: disable=W0633
156             try:
157                 failure_code = self.fail_codes[exc[5]]
158             except KeyError:
159                 failure_code = "Unknown Failure: {}".format(error)
160             log.error("Search Failed: %s\n\t\t%s", failure_code, search_string)
161             raise CommandExecutionError(failure_code)
162         self._updates = results.Updates
163     def installed(self):
164         updates = Updates()
165         for update in self._updates:
166             if salt.utils.data.is_true(update.IsInstalled):
167                 updates.updates.Add(update)
168         return updates
169     def available(
170         self,
171         skip_hidden=True,
172         skip_installed=True,
173         skip_mandatory=False,
174         skip_reboot=False,
175         software=True,
176         drivers=True,
177         categories=None,
178         severities=None,
179     ):
180         updates = Updates()
181         found = updates.updates
182         for update in self._updates:
183             if salt.utils.data.is_true(update.IsHidden) and skip_hidden:
184                 continue
185             if salt.utils.data.is_true(update.IsInstalled) and skip_installed:
186                 continue
187             if salt.utils.data.is_true(update.IsMandatory) and skip_mandatory:
188                 continue
189             try:
190                 requires_reboot = salt.utils.data.is_true(
191                     update.InstallationBehavior.RebootBehavior
192                 )
193             except AttributeError:
194                 log.debug(
195                     "Windows Update: Error reading InstallationBehavior COM Object"
196                 )
197                 requires_reboot = True
198             if requires_reboot and skip_reboot:
199                 continue
200             if not software and update.Type == 1:
201                 continue
202             if not drivers and update.Type == 2:
203                 continue
204             if categories is not None:
205                 match = False
206                 for category in update.Categories:
207                     if category.Name in categories:
208                         match = True
209                 if not match:
210                     continue
211             if severities is not None:
212                 if update.MsrcSeverity not in severities:
213                     continue
214             found.Add(update)
215         return updates
216     def search(self, search_string):
217         updates = Updates()
218         found = updates.updates
219         if isinstance(search_string, str):
220             search_string = [search_string]
221         if isinstance(search_string, int):
222             search_string = [str(search_string)]
223         for update in self._updates:
224             for find in search_string:
225                 if find == update.Identity.UpdateID:
226                     found.Add(update)
227                     continue
228                 if find in ["KB" + item for item in update.KBArticleIDs]:
229                     found.Add(update)
230                     continue
231                 if find in [item for item in update.KBArticleIDs]:
232                     found.Add(update)
233                     continue
234                 if find in update.Title:
235                     found.Add(update)
236                     continue
237         return updates
238     def download(self, updates):
239         if updates.count() == 0:
240             ret = {"Success": False, "Updates": "Nothing to download"}
241             return ret
242         downloader = self._session.CreateUpdateDownloader()
243         self._session.ClientApplicationID = "Salt: Download Update"
244         with salt.utils.winapi.Com():
245             download_list = win32com.client.Dispatch("Microsoft.Update.UpdateColl")
246             ret = {"Updates": {}}
247             for update in updates.updates:
248                 uid = update.Identity.UpdateID
249                 ret["Updates"][uid] = {}
250                 ret["Updates"][uid]["Title"] = update.Title
251                 ret["Updates"][uid]["AlreadyDownloaded"] = bool(update.IsDownloaded)
252                 if not salt.utils.data.is_true(update.EulaAccepted):
253                     log.debug("Accepting EULA: %s", update.Title)
254                     update.AcceptEula()  # pylint: disable=W0104
255                 if not salt.utils.data.is_true(update.IsDownloaded):
256                     log.debug("To Be Downloaded: %s", uid)
257                     log.debug("\tTitle: %s", update.Title)
258                     download_list.Add(update)
259             if download_list.Count == 0:
260                 ret = {"Success": True, "Updates": "Nothing to download"}
261                 return ret
262             downloader.Updates = download_list
263             try:
264                 log.debug("Downloading Updates")
265                 result = downloader.Download()
266             except pywintypes.com_error as error:
267                 hr, msg, exc, arg = error.args  # pylint: disable=W0633
268                 try:
269                     failure_code = self.fail_codes[exc[5]]
270                 except KeyError:
271                     failure_code = "Unknown Failure: {}".format(error)
272                 log.error("Download Failed: %s", failure_code)
273                 raise CommandExecutionError(failure_code)
274             result_code = {
275                 0: "Download Not Started",
276                 1: "Download In Progress",
277                 2: "Download Succeeded",
278                 3: "Download Succeeded With Errors",
279                 4: "Download Failed",
280                 5: "Download Aborted",
281             }
282             log.debug("Download Complete")
283             log.debug(result_code[result.ResultCode])
284             ret["Message"] = result_code[result.ResultCode]
285             if result.ResultCode in [2, 3]:
286                 log.debug("Downloaded Successfully")
287                 ret["Success"] = True
288             else:
289                 log.debug("Download Failed")
290                 ret["Success"] = False
291             for i in range(download_list.Count):
292                 uid = download_list.Item(i).Identity.UpdateID
293                 ret["Updates"][uid]["Result"] = result_code[
294                     result.GetUpdateResult(i).ResultCode
295                 ]
296         return ret
297     def install(self, updates):
298         if updates.count() == 0:
299             ret = {"Success": False, "Updates": "Nothing to install"}
300             return ret
301         installer = self._session.CreateUpdateInstaller()
302         self._session.ClientApplicationID = "Salt: Install Update"
303         with salt.utils.winapi.Com():
304             install_list = win32com.client.Dispatch("Microsoft.Update.UpdateColl")
305             ret = {"Updates": {}}
306             for update in updates.updates:
307                 uid = update.Identity.UpdateID
308                 ret["Updates"][uid] = {}
309                 ret["Updates"][uid]["Title"] = update.Title
310                 ret["Updates"][uid]["AlreadyInstalled"] = bool(update.IsInstalled)
311                 if not salt.utils.data.is_true(update.IsInstalled):
312                     log.debug("To Be Installed: %s", uid)
313                     log.debug("\tTitle: %s", update.Title)
314                     install_list.Add(update)
315             if install_list.Count == 0:
316                 ret = {"Success": True, "Updates": "Nothing to install"}
317                 return ret
318             installer.Updates = install_list
319             try:
320                 log.debug("Installing Updates")
321                 result = installer.Install()
322             except pywintypes.com_error as error:
323                 hr, msg, exc, arg = error.args  # pylint: disable=W0633
324                 try:
325                     failure_code = self.fail_codes[exc[5]]
326                 except KeyError:
327                     failure_code = "Unknown Failure: {}".format(error)
328                 log.error("Install Failed: %s", failure_code)
329                 raise CommandExecutionError(failure_code)
330             result_code = {
331                 0: "Installation Not Started",
332                 1: "Installation In Progress",
333                 2: "Installation Succeeded",
334                 3: "Installation Succeeded With Errors",
335                 4: "Installation Failed",
336                 5: "Installation Aborted",
337             }
338             log.debug("Install Complete")
339             log.debug(result_code[result.ResultCode])
340             ret["Message"] = result_code[result.ResultCode]
341             if result.ResultCode in [2, 3]:
342                 ret["Success"] = True
343                 ret["NeedsReboot"] = result.RebootRequired
344                 log.debug("NeedsReboot: %s", result.RebootRequired)
345             else:
346                 log.debug("Install Failed")
347                 ret["Success"] = False
348             for i in range(install_list.Count):
349                 uid = install_list.Item(i).Identity.UpdateID
350                 ret["Updates"][uid]["Result"] = result_code[
351                     result.GetUpdateResult(i).ResultCode
352                 ]
353                 try:
354                     reboot_behavior = install_list.Item(
355                         i
356                     ).InstallationBehavior.RebootBehavior
357                 except AttributeError:
358                     log.debug(
359                         "Windows Update: Error reading InstallationBehavior COM Object"
360                     )
361                     reboot_behavior = 2
362                 ret["Updates"][uid]["RebootBehavior"] = REBOOT_BEHAVIOR[reboot_behavior]
363         return ret
364     def uninstall(self, updates):
365         if updates.count() == 0:
366             ret = {"Success": False, "Updates": "Nothing to uninstall"}
367             return ret
368         installer = self._session.CreateUpdateInstaller()
369         self._session.ClientApplicationID = "Salt: Uninstall Update"
370         with salt.utils.winapi.Com():
371             uninstall_list = win32com.client.Dispatch("Microsoft.Update.UpdateColl")
372             ret = {"Updates": {}}
373             for update in updates.updates:
374                 uid = update.Identity.UpdateID
375                 ret["Updates"][uid] = {}
376                 ret["Updates"][uid]["Title"] = update.Title
377                 ret["Updates"][uid]["AlreadyUninstalled"] = not bool(update.IsInstalled)
378                 if salt.utils.data.is_true(update.IsInstalled):
379                     log.debug("To Be Uninstalled: %s", uid)
380                     log.debug("\tTitle: %s", update.Title)
381                     uninstall_list.Add(update)
382             if uninstall_list.Count == 0:
383                 ret = {"Success": False, "Updates": "Nothing to uninstall"}
384                 return ret
385             installer.Updates = uninstall_list
386             try:
387                 log.debug("Uninstalling Updates")
388                 result = installer.Uninstall()
389             except pywintypes.com_error as error:
390                 hr, msg, exc, arg = error.args  # pylint: disable=W0633
391                 try:
392                     failure_code = self.fail_codes[exc[5]]
393                 except KeyError:
394                     failure_code = "Unknown Failure: {}".format(error)
395                 if exc[5] == -2145124312:
396                     log.debug("Uninstall Failed with WUA, attempting with DISM")
397                     try:
398                         for item in uninstall_list:
399                             for kb in item.KBArticleIDs:
400                                 cmd = ["dism", "/Online", "/Get-Packages"]
401                                 pkg_list = self._run(cmd)[0].splitlines()
402                                 for item in pkg_list:
403                                     if "kb" + kb in item.lower():
404                                         pkg = item.split(" : ")[1]
405                                         ret["DismPackage"] = pkg
406                                         cmd = [
407                                             "dism",
408                                             "/Online",
409                                             "/Remove-Package",
410                                             "/PackageName:{}".format(pkg),
411                                             "/Quiet",
412                                             "/NoRestart",
413                                         ]
414                                         self._run(cmd)
415                     except CommandExecutionError as exc:
416                         log.debug("Uninstall using DISM failed")
417                         log.debug("Command: %s", " ".join(cmd))
418                         log.debug("Error: %s", exc)
419                         raise CommandExecutionError(
420                             "Uninstall using DISM failed: {}".format(exc)
421                         )
422                     log.debug("Uninstall Completed using DISM")
423                     ret["Success"] = True
424                     ret["Message"] = "Uninstalled using DISM"
425                     ret["NeedsReboot"] = needs_reboot()
426                     log.debug("NeedsReboot: %s", ret["NeedsReboot"])
427                     self.refresh(online=False)
428                     for update in self._updates:
429                         uid = update.Identity.UpdateID
430                         for item in uninstall_list:
431                             if item.Identity.UpdateID == uid:
432                                 if not update.IsInstalled:
433                                     ret["Updates"][uid][
434                                         "Result"
435                                     ] = "Uninstallation Succeeded"
436                                 else:
437                                     ret["Updates"][uid][
438                                         "Result"
439                                     ] = "Uninstallation Failed"
440                                 try:
441                                     requires_reboot = (
442                                         update.InstallationBehavior.RebootBehavior
443                                     )
444                                 except AttributeError:
445                                     log.debug(
446                                         "Windows Update: Error reading"
447                                         " InstallationBehavior COM Object"
448                                     )
449                                     requires_reboot = 2
450                                 ret["Updates"][uid]["RebootBehavior"] = REBOOT_BEHAVIOR[
451                                     requires_reboot
452                                 ]
453                     return ret
454                 log.error("Uninstall Failed: %s", failure_code)
455                 raise CommandExecutionError(failure_code)
456             result_code = {
457                 0: "Uninstallation Not Started",
458                 1: "Uninstallation In Progress",
459                 2: "Uninstallation Succeeded",
460                 3: "Uninstallation Succeeded With Errors",
461                 4: "Uninstallation Failed",
462                 5: "Uninstallation Aborted",
463             }
464             log.debug("Uninstall Complete")
465             log.debug(result_code[result.ResultCode])
466             ret["Message"] = result_code[result.ResultCode]
467             if result.ResultCode in [2, 3]:
468                 ret["Success"] = True
469                 ret["NeedsReboot"] = result.RebootRequired
470                 log.debug("NeedsReboot: %s", result.RebootRequired)
471             else:
472                 log.debug("Uninstall Failed")
473                 ret["Success"] = False
474             for i in range(uninstall_list.Count):
475                 uid = uninstall_list.Item(i).Identity.UpdateID
476                 ret["Updates"][uid]["Result"] = result_code[
477                     result.GetUpdateResult(i).ResultCode
478                 ]
479                 try:
480                     reboot_behavior = uninstall_list.Item(
481                         i
482                     ).InstallationBehavior.RebootBehavior
483                 except AttributeError:
484                     log.debug(
485                         "Windows Update: Error reading InstallationBehavior COM Object"
486                     )
487                     reboot_behavior = 2
488                 ret["Updates"][uid]["RebootBehavior"] = REBOOT_BEHAVIOR[reboot_behavior]
489         return ret
490     def _run(self, cmd):
491         if isinstance(cmd, str):
492             cmd = salt.utils.args.shlex_split(cmd)
493         try:
494             log.debug(cmd)
495             p = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
496             return p.communicate()
497         except OSError as exc:
498             log.debug("Command Failed: %s", " ".join(cmd))
499             log.debug("Error: %s", exc)
500             raise CommandExecutionError(exc)
501 def needs_reboot():
502     with salt.utils.winapi.Com():
503         try:
504             obj_sys = win32com.client.Dispatch("Microsoft.Update.SystemInfo")
505         except pywintypes.com_error as exc:
506             _, msg, _, _ = exc.args
507             log.debug("Failed to create SystemInfo object: %s", msg)
508             return False
509         return salt.utils.data.is_true(obj_sys.RebootRequired)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_jinja_3.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import os
2 import re
3 import pytest
4 import salt.config
5 from salt.exceptions import SaltRenderError
6 from salt.utils.templates import render_jinja_tmpl
7 <a name="0"></a>
8 @pytest.fixture
9 def minion_opts(tmp_path):
10     _opts = salt<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.config.DEFAULT_MINION_OPTS.copy()
11     _opts.update(
12         {
13             "cachedir": str(tmp_path / "jinja-template-cache"),
14             "file_buffer_size": 1048576,
15             "file_client": "local",
16             "file_ignore_regex": None,
17             "file_ignore_glob": None,
18             "file_roots": {"test": [str(tmp_path / "templates")]},
19             "pillar_roots": {"test": [str(tmp_path / "templates")]},
20             "fileserver_backend": ["roots"],
21             "hash_type": "md5",
22             "extension_modules": os.</b></font>path.join(
23                 os.path.dirname(os.path.abspath(__file__)), "extmods"
24             ),
25         }
26     )
27     return _opts
28 @pytest.fixture
29 def local_salt():
30     return {}
31 def test_jinja_undefined_error_context(minion_opts, local_salt):
32     jinja_code = """
33     {%- set sections = {"first": {"a": "b"}, "second": ["a", "b"]} %}
34     {%- for section in sections %}
35       {%- for name, config in section.items() %}
36       {%- endfor %}
37     {%- endfor %}
38     """
39     marker = "    &lt;======================"
40     match_regex = re.compile(
41         fr"^Jinja variable .*; line .*{marker}$", re.DOTALL | re.MULTILINE
42     )
43     with pytest.raises(SaltRenderError, match=match_regex):
44         render_jinja_tmpl(
45             jinja_code,
46             dict(opts=minion_opts, saltenv="test", salt=local_salt),
47         )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
