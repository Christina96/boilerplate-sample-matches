
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 8.347826086956523%, Tokens: 15, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-rmsprop.py</h3>
            <pre><code>1  import itertools
2  from typing import Optional, Sequence, Union
3  from sonnet.src import base
4  from sonnet.src import once
5  from sonnet.src import types
6  from sonnet.src import utils
7  from sonnet.src.optimizers import optimizer_utils
8  import tensorflow as tf
9  def rmsprop_update(update, decay, learning_rate, epsilon, mu, mom, ms, mg):
10    ms = tf.square(update) * (1. - decay) + ms * decay
11    if mg is not None:  # centered
12      mg = update * (1. - decay) + mg * decay
13      denominator = ms - tf.square(mg) + epsilon
14    else:
15      denominator = ms + epsilon
16    mom = (mu * mom) + (learning_rate * update * tf.math.rsqrt(denominator))
17    return mom, ms, mg
18  class RMSProp(base.Optimizer):
19    def __init__(self,
20                 learning_rate: Union[types.FloatLike, tf.Variable],
21                 decay: Union[types.FloatLike, tf.Variable] = 0.9,
22                 momentum: Union[types.FloatLike, tf.Variable] = 0.0,
23                 epsilon: Union[types.FloatLike, tf.Variable] = 1e-10,
24                 centered: bool = False,
25                 name: Optional[str] = None):
26      super().__init__(name)
<span onclick='openModal()' class='match'>27      self.learning_rate = learning_rate
28      self.decay = decay
29      self.momentum = momentum
30      self.epsilon = epsilon
31      self.centered = centered
32      self.mom = []
33      self.ms = []
34      self.mg = []
</span>35    @once.once
36    def _initialize(self, parameters: Sequence[tf.Variable]):
37      zero_var = lambda p: utils.variable_like(p, trainable=False)
38      with tf.name_scope("momentum"):
39        self.mom.extend(zero_var(p) for p in parameters)
40      with tf.name_scope("rms"):
41        self.ms.extend(zero_var(p) for p in parameters)
42      if self.centered:
43        with tf.name_scope("mg"):
44          self.mg.extend(zero_var(p) for p in parameters)
45    def apply(self, updates: Sequence[types.ParameterUpdate],
46              parameters: Sequence[tf.Variable]):
47      optimizer_utils.check_distribution_strategy()
48      optimizer_utils.check_updates_parameters(updates, parameters)
49      self._initialize(parameters)
50      for update, parameter, mom_var, ms_var, mg_var in itertools.zip_longest(
51          updates, parameters, self.mom, self.ms, self.mg):
52        if update is None:
53          continue
54        optimizer_utils.check_same_dtype(update, parameter)
55        learning_rate = tf.cast(self.learning_rate, update.dtype)
56        decay = tf.cast(self.decay, update.dtype)
57        mu = tf.cast(self.momentum, update.dtype)
58        epsilon = tf.cast(self.epsilon, update.dtype)
59        if isinstance(update, tf.IndexedSlices):
60          update, indices = optimizer_utils.deduplicate_indexed_slices(update)
61          ms = ms_var.sparse_read(indices)
62          mg = mg_var.sparse_read(indices) if self.centered else None
63          mom = mom_var.sparse_read(indices)
64          mom, ms, mg = rmsprop_update(update, decay, learning_rate, epsilon, mu,
65                                       mom, ms, mg)
66          parameter.scatter_sub(tf.IndexedSlices(mom, indices))
67          mom_var.scatter_update(tf.IndexedSlices(mom, indices))
68          ms_var.scatter_update(tf.IndexedSlices(ms, indices))
69          if self.centered:
70            mg_var.scatter_update(tf.IndexedSlices(mg, indices))
71        else:
72          mom, ms, mg = rmsprop_update(update, decay, learning_rate, epsilon, mu,
73                                       mom_var, ms_var, mg_var)
74          parameter.assign_sub(mom)
75          mom_var.assign(mom)
76          ms_var.assign(ms)
77          if self.centered:
78            mg_var.assign(mg)
</code></pre>
        </div>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-BaseClient.py</h3>
            <pre><code>1  import inspect
2  import sys
3  import time
4  from logging import Logger
5  from telethon import TelegramClient
6  from telethon import utils as telethon_utils
7  from telethon.errors import (
8      AccessTokenExpiredError,
9      AccessTokenInvalidError,
10      ApiIdInvalidError,
11      AuthKeyDuplicatedError,
12  )
13  from ..configs import Var
14  from . import *
15  class UltroidClient(TelegramClient):
16      def __init__(
17          self,
18          session,
19          api_id=None,
20          api_hash=None,
21          bot_token=None,
22          udB=None,
23          logger: Logger = LOGS,
24          log_attempt=True,
25          exit_on_error=True,
26          *args,
27          **kwargs,
28      ):
<span onclick='openModal()' class='match'>29          self._cache = {}
30          self._dialogs = []
31          self._handle_error = exit_on_error
32          self._log_at = log_attempt
33          self.logger = logger
34          self.udB = udB
35          kwargs["api_id"] = api_id or Var.API_ID
</span>36          kwargs["api_hash"] = api_hash or Var.API_HASH
37          kwargs["base_logger"] = TelethonLogger
38          super().__init__(session, **kwargs)
39          self.run_in_loop(self.start_client(bot_token=bot_token))
40          self.dc_id = self.session.dc_id
41      def __repr__(self):
42          return "<Ultroid.Client :\n self: {}\n bot: {}\n>".format(
43              self.full_name, self._bot
44          )
45      @property
46      def __dict__(self):
47          if self.me:
48              return self.me.to_dict()
49      async def start_client(self, **kwargs):
50          if self._log_at:
51              self.logger.info("Trying to login.")
52          try:
53              await self.start(**kwargs)
54          except ApiIdInvalidError:
55              self.logger.critical("API ID and API_HASH combination does not match!")
56              sys.exit()
57          except (AuthKeyDuplicatedError, EOFError) as er:
58              if self._handle_error:
59                  self.logger.critical("String session expired. Create new!")
60                  return sys.exit()
61              self.logger.critical("String session expired.")
62          except (AccessTokenExpiredError, AccessTokenInvalidError):
63              self.udB.del_key("BOT_TOKEN")
64              self.logger.critical(
65                  "Bot token is expired or invalid. Create new from @Botfather and add in BOT_TOKEN env variable!"
66              )
67              sys.exit()
68          self.me = await self.get_me()
69          if self.me.bot:
70              me = f"@{self.me.username}"
71          else:
72              setattr(self.me, "phone", None)
73              me = self.full_name
74          if self._log_at:
75              self.logger.info(f"Logged in as {me}")
76          self._bot = await self.is_bot()
77      async def fast_uploader(self, file, **kwargs):
78          import os
79          from pathlib import Path
80          start_time = time.time()
81          path = Path(file)
82          filename = kwargs.get("filename", path.name)
83          show_progress = kwargs.get("show_progress", False)
84          if show_progress:
85              event = kwargs["event"]
86          use_cache = kwargs.get("use_cache", True)
87          to_delete = kwargs.get("to_delete", False)
88          message = kwargs.get("message", f"Uploading {filename}...")
89          by_bot = self._bot
90          size = os.path.getsize(file)
91          if size < 5 * 2 ** 20:
92              show_progress = False
93          if use_cache and self._cache and self._cache.get("upload_cache"):
94              for files in self._cache["upload_cache"]:
95                  if (
96                      files["size"] == size
97                      and files["path"] == path
98                      and files["name"] == filename
99                      and files["by_bot"] == by_bot
100                  ):
101                      if to_delete:
102                          try:
103                              os.remove(file)
104                          except FileNotFoundError:
105                              pass
106                      return files["raw_file"], time.time() - start_time
107          from pyUltroid.fns.FastTelethon import upload_file
108          from pyUltroid.fns.helper import progress
109          raw_file = None
110          while not raw_file:
111              with open(file, "rb") as f:
112                  raw_file = await upload_file(
113                      client=self,
114                      file=f,
115                      filename=filename,
116                      progress_callback=(
117                          lambda completed, total: self.loop.create_task(
118                              progress(completed, total, event, start_time, message)
119                          )
120                      )
121                      if show_progress
122                      else None,
123                  )
124          cache = {
125              "by_bot": by_bot,
126              "size": size,
127              "path": path,
128              "name": filename,
129              "raw_file": raw_file,
130          }
131          if self._cache.get("upload_cache"):
132              self._cache["upload_cache"].append(cache)
133          else:
134              self._cache.update({"upload_cache": [cache]})
135          if to_delete:
136              try:
137                  os.remove(file)
138              except FileNotFoundError:
139                  pass
140          return raw_file, time.time() - start_time
141      async def fast_downloader(self, file, **kwargs):
142          show_progress = kwargs.get("show_progress", False)
143          filename = kwargs.get("filename", "")
144          if show_progress:
145              event = kwargs["event"]
146          if file.size < 10 * 2 ** 20:
147              show_progress = False
148          import mimetypes
149          from telethon.tl.types import DocumentAttributeFilename
150          from pyUltroid.fns.FastTelethon import download_file
151          from pyUltroid.fns.helper import progress
152          start_time = time.time()
153          if not filename:
154              try:
155                  if isinstance(file.attributes[-1], DocumentAttributeFilename):
156                      filename = file.attributes[-1].file_name
157              except IndexError:
158                  mimetype = file.mime_type
159                  filename = (
160                      mimetype.split("/")[0]
161                      + "-"
162                      + str(round(start_time))
163                      + mimetypes.guess_extension(mimetype)
164                  )
165          message = kwargs.get("message", f"Downloading {filename}...")
166          raw_file = None
167          while not raw_file:
168              with open(filename, "wb") as f:
169                  raw_file = await download_file(
170                      client=self,
171                      location=file,
172                      out=f,
173                      progress_callback=(
174                          lambda completed, total: self.loop.create_task(
175                              progress(completed, total, event, start_time, message)
176                          )
177                      )
178                      if show_progress
179                      else None,
180                  )
181          return raw_file, time.time() - start_time
182      def run_in_loop(self, function):
183          return self.loop.run_until_complete(function)
184      def run(self):
185          self.run_until_disconnected()
186      def add_handler(self, func, *args, **kwargs):
187          if func in [_[0] for _ in self.list_event_handlers()]:
188              return
189          self.add_event_handler(func, *args, **kwargs)
190      @property
191      def utils(self):
192          return telethon_utils
193      @property
194      def full_name(self):
195          return self.utils.get_display_name(self.me)
196      @property
197      def uid(self):
198          return self.me.id
199      def to_dict(self):
200          return dict(inspect.getmembers(self))
201      async def parse_id(self, text):
202          try:
203              text = int(text)
204          except ValueError:
205              pass
206          return await self.get_peer_id(text)
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from sonnet-MDEwOlJlcG9zaXRvcnk4NzA2NzIxMg==-flat-rmsprop.py</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-BaseClient.py</div>
                </div>
                <div class="column column_space"><pre><code>27      self.learning_rate = learning_rate
28      self.decay = decay
29      self.momentum = momentum
30      self.epsilon = epsilon
31      self.centered = centered
32      self.mom = []
33      self.ms = []
34      self.mg = []
</pre></code></div>
                <div class="column column_space"><pre><code>29          self._cache = {}
30          self._dialogs = []
31          self._handle_error = exit_on_error
32          self._log_at = log_attempt
33          self.logger = logger
34          self.udB = udB
35          kwargs["api_id"] = api_id or Var.API_ID
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    