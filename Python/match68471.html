<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for zpool.py &amp; nfs3.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for zpool.py &amp; nfs3.py
      </h3>
<h1 align="center">
        4.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>zpool.py (3.5502958%)<th>nfs3.py (6.5934067%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(295-299)<td><a href="#" name="0">(146-151)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>zpool.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import os
3 from salt.utils.odict import OrderedDict
4 log = logging.getLogger(__name__)
5 __virtualname__ = "zpool"
6 def __virtual__():
7     if not __grains__.get("zfs_support"):
8         return False, "The zpool state cannot be loaded: zfs not supported"
9     return __virtualname__
10 def _layout_to_vdev(layout, device_dir=None):
11     vdevs = []
12     if device_dir and not os.path.exists(device_dir):
13         device_dir = None
14     if isinstance(layout, list):
15         for vdev in layout:
16             if isinstance(vdev, OrderedDict):
17                 vdevs.extend(_layout_to_vdev(vdev, device_dir))
18             else:
19                 if device_dir and vdev[0] != "/":
20                     vdev = os.path.join(device_dir, vdev)
21                 vdevs.append(vdev)
22     elif isinstance(layout, OrderedDict):
23         for vdev in layout:
24             vdev_type = vdev.split("-")[0]
25             vdev_disk = layout[vdev]
26             if vdev_type != "disk":
27                 vdevs.append(vdev_type)
28             if not isinstance(vdev_disk, list):
29                 vdev_disk = vdev_disk.split(" ")
30             for disk in vdev_disk:
31                 if device_dir and disk[0] != "/":
32                     disk = os.path.join(device_dir, disk)
33                 vdevs.append(disk)
34     else:
35         vdevs = None
36     return vdevs
37 def present(
38     name, properties=None, filesystem_properties=None, layout=None, config=None
39 ):
40     ret = {"name": name, "changes": {}, "result": None, "comment": ""}
41     default_config = {
42         "import": True,
43         "import_dirs": None,
44         "device_dir": None,
45         "force": False,
46     }
47     if __grains__["kernel"] == "SunOS":
48         default_config["device_dir"] = "/dev/dsk"
49     elif __grains__["kernel"] == "Linux":
50         default_config["device_dir"] = "/dev"
51     if config:
52         default_config.update(config)
53     config = default_config
54     if properties:
55         properties = __utils__["zfs.from_auto_dict"](properties)
56     elif properties is None:
57         properties = {}
58     if filesystem_properties:
59         filesystem_properties = __utils__["zfs.from_auto_dict"](filesystem_properties)
60     elif filesystem_properties is None:
61         filesystem_properties = {}
62     vdevs = _layout_to_vdev(layout, config["device_dir"])
63     if vdevs:
64         vdevs.insert(0, name)
65     log.debug("zpool.present::%s::config - %s", name, config)
66     log.debug("zpool.present::%s::vdevs - %s", name, vdevs)
67     log.debug("zpool.present::%s::properties -  %s", name, properties)
68     log.debug(
69         "zpool.present::%s::filesystem_properties -  %s", name, filesystem_properties
70     )
71     ret["result"] = False
72         if __salt__["zpool.exists"](name):
73             ret["result"] = True
74             ret["comment"] <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= "storage pool {} is {}".format(name, "uptodate")
75         else:
76             ret["result"] = None
77             ret["changes"][name] = "imported" if config["import"] else "created"
78             ret["comment"] = "storage pool {} would have been {}".</b></font>format(
79                 name, ret["changes"][name]
80             )
81     elif __salt__["zpool.exists"](name):
82         ret["result"] = True
83         properties_current = __salt__["zpool.get"](name, parsable=True)
84         properties_update = []
85         if properties:
86             for prop in properties:
87                 if prop not in properties_current:
88                     log.warning(
89                         "zpool.present::%s::update - unknown property: %s", name, prop
90                     )
91                     continue
92                 if properties_current[prop] != properties[prop]:
93                     properties_update.append(prop)
94         for prop in properties_update:
95             res = __salt__["zpool.set"](name, prop, properties[prop])
96             if res["set"]:
97                 if name not in ret["changes"]:
98                     ret["changes"][name] = {}
99                 ret["changes"][name][prop] = properties[prop]
100             else:
101                 ret["result"] = False
102                 if ret["comment"] == "":
103                     ret["comment"] = "The following properties were not updated:"
104                 ret["comment"] = "{} {}".format(ret["comment"], prop)
105         if ret["result"]:
106             ret["comment"] = (
107                 "properties updated" if ret["changes"] else "no update needed"
108             )
109     else:
110         if config["import"]:
111             mod_res = __salt__["zpool.import"](
112                 name,
113                 force=config["force"],
114                 dir=config["import_dirs"],
115             )
116             ret["result"] = mod_res["imported"]
117             if ret["result"]:
118                 ret["changes"][name] = "imported"
119                 ret["comment"] = "storage pool {} was imported".format(name)
120         if not ret["result"] and vdevs:
121             log.debug("zpool.present::%s::creating", name)
122             mod_res = __salt__["zpool.create"](
123                 *vdevs,
124                 force=config["force"],
125                 properties=properties,
126                 filesystem_properties=filesystem_properties
127             )
128             ret["result"] = mod_res["created"]
129             if ret["result"]:
130                 ret["changes"][name] = "created"
131                 ret["comment"] = "storage pool {} was created".format(name)
132             elif "error" in mod_res:
133                 ret["comment"] = mod_res["error"]
134             else:
135                 ret["comment"] = "could not create storage pool {}".format(name)
136         if not ret["result"] and not vdevs:
137             ret["comment"] = (
138                 "storage pool {} was not imported, no (valid) layout specified for"
139                 " creation".format(name)
140             )
141     return ret
142 def absent(name, export=False, force=False):
143     ret = {"name": name, "changes": {}, "result": None, "comment": ""}
144     log.debug("zpool.absent::%s::config::force = %s", name, force)
145     log.debug("zpool.absent::%s::config::export = %s", name, export)
146     if __salt__["zpool.exists"](name):  # looks like we need to do some work
147         mod_res = {}
148         ret["result"] = False
149         if __opts__["test"]:
150             ret["result"] = True
151         elif export:
152             mod_res = __salt__["zpool.export"](name, force=force)
153             ret["result"] = mod_res["exported"]
154         else:
155             mod_res = __salt__["zpool.destroy"](name, force=force)
156             ret["result"] = mod_res["destroyed"]
157         if ret["result"]:  # update the changes and comment
158             ret["changes"][name] = "exported" if export else "destroyed"
159             ret["comment"] = "storage pool {} was {}".format(name, ret["changes"][name])
160         elif "error" in mod_res:
161             ret["comment"] = mod_res["error"]
162     else:  # we are looking good
163         ret["result"] = True
164         ret["comment"] = "storage pool {} is absent".format(name)
165     return ret
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>nfs3.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import logging
2 import salt.utils.files
3 import salt.utils.path
4 import salt.utils.stringutils
5 log = logging.getLogger(__name__)
6 def __virtual__():
7     if not salt.utils.path.which("showmount"):
8         return (
9             False,
10             "The nfs3 execution module failed to load: the showmount binary is not in"
11             " the path.",
12         )
13     return True
14 def list_exports(exports="/etc/exports"):
15     ret = {}
16     with salt.utils.files.fopen(exports, "r") as efl:
17         for line in salt.utils.stringutils.to_unicode(efl.read()).splitlines():
18             if not line:
19                 continue
20             if line.startswith("#"):
21                 continue
22             comps = line.split()
23             if not comps[0] in ret:
24                 ret[comps[0]] = []
25             newshares = []
26             for perm in comps[1:]:
27                 if perm.startswith("/"):
28                     newshares.append(perm)
29                     continue
30                 permcomps = perm.split("(")
31                 permcomps[1] = permcomps[1].replace(")", "")
32                 hosts = permcomps[0]
33                 if not isinstance(hosts, str):
34                     raise TypeError("hosts argument must be a string")
35                 options = permcomps[1].split(",")
36                 ret[comps[0]].append({"hosts": hosts, "options": options})
37             for share in newshares:
38                 ret[share] = ret[comps[0]]
39     return ret
40 def del_export(exports="/etc/exports", path=None):
41     edict = list_exports(exports)
42     del edict[path]
43     _write_exports(exports, edict)
44     return edict
45 def add_export(exports="/etc/exports", path=None, hosts=None, options=None):
46     if options is None:
47         options = []
48     if not isinstance(hosts, str):
49         raise TypeError("hosts argument must be a string")
50     edict = list_exports(exports)
51     if path not in edict:
52         edict[path] = []
53     new = {"hosts": hosts, "options": options}
54     edict[path].append(new)
55     _write_exports(exports, edict)
56     return new
57 def _write_exports(exports, edict):
58     with salt.utils.files.fopen(exports, "w") as efh:
59         for export in edict:
60             line = salt.utils.stringutils.to_str(export)
61             for perms in edict[export]:
62                 hosts = perms["hosts"]
63                 options = ",".join(perms["options"])
64                 line += " {}({})".format(hosts, options)
65             efh.write("{}\n".format(line))
66 def reload_exports():
67     ret = {}
68     command = "exportfs -r"
69     output <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= __salt__["cmd.run_all"](command)
70     ret["stdout"] = output["stdout"]
71     ret["stderr"] = output["stderr"]
72     ret["result"] = output[</b></font>"stderr"] == ""
73     return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
