<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for opennebula.py &amp; vagrant_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for opennebula.py &amp; vagrant_1.py
      </h3>
<h1 align="center">
        3.5%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>opennebula.py (2.0712302%)<th>vagrant_1.py (13.12%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(3426-3431)<td><a href="#" name="0">(411-415)</a><td align="center"><font color="#ff0000">18</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(1805-1810)<td><a href="#" name="1">(163-166)</a><td align="center"><font color="#d40000">15</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(2197-2201)<td><a href="#" name="2">(521-524)</a><td align="center"><font color="#b80000">13</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(2583-2586)<td><a href="#" name="3">(501-502)</a><td align="center"><font color="#aa0000">12</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(2364-2367)<td><a href="#" name="4">(479-480)</a><td align="center"><font color="#aa0000">12</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(1254-1257)<td><a href="#" name="5">(461-462)</a><td align="center"><font color="#aa0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>opennebula.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import logging
import os
import pprint
import time
import salt.config as config
import salt.utils.data
import salt.utils.files
from salt.exceptions import (
    SaltCloudConfigError,
    SaltCloudExecutionFailure,
    SaltCloudExecutionTimeout,
    SaltCloudNotFound,
    SaltCloudSystemExit,
)
try:
    import xmlrpc.client
    from lxml import etree
    HAS_XML_LIBS = True
except ImportError:
    HAS_XML_LIBS = False
log = logging.getLogger(__name__)
__virtualname__ = "opennebula"
def __virtual__():
    if get_configured_provider() is False:
        return False
    if get_dependencies() is False:
        return False
    return __virtualname__
def _get_active_provider_name():
    try:
        return __active_provider_name__.value()
    except AttributeError:
        return __active_provider_name__
def get_configured_provider():
    return config.is_provider_configured(
        __opts__,
        _get_active_provider_name() or __virtualname__,
        ("xml_rpc", "user", "password"),
    )
def get_dependencies():
    return config.check_driver_dependencies(__virtualname__, {"lmxl": HAS_XML_LIBS})
def avail_images(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The avail_images function must be called with "
            "-f or --function, or with the --list-images option"
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    image_pool = server.one.imagepool.info(auth, -2, -1, -1)[1]
    images = {}
    for image in _get_xml(image_pool):
        images[image.find("NAME").text] = _xml_to_dict(image)
    return images
def avail_locations(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The avail_locations function must be called with "
            "-f or --function, or with the --list-locations option."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    host_pool = server.one.hostpool.info(auth)[1]
    locations = {}
    for host in _get_xml(host_pool):
        locations[host.find("NAME").text] = _xml_to_dict(host)
    return locations
def avail_sizes(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The avail_sizes function must be called with "
            "-f or --function, or with the --list-sizes option."
        )
    log.warning(
        "Because sizes are built into templates with OpenNebula, there are no sizes "
        "to return."
    )
    return {}
def list_clusters(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_clusters function must be called with -f or --function."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    cluster_pool = server.one.clusterpool.info(auth)[1]
    clusters = {}
    for cluster in _get_xml(cluster_pool):
        clusters[cluster.find("NAME").text] = _xml_to_dict(cluster)
    return clusters
def list_datastores(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_datastores function must be called with -f or --function."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    datastore_pool = server.one.datastorepool.info(auth)[1]
    datastores = {}
    for datastore in _get_xml(datastore_pool):
        datastores[datastore.find("NAME").text] = _xml_to_dict(datastore)
    return datastores
def list_hosts(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_hosts function must be called with -f or --function."
        )
    return avail_locations()
def list_nodes(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_nodes function must be called with -f or --function."
        )
    return _list_nodes(full=False)
def list_nodes_full(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_nodes_full function must be called with -f or --function."
        )
    return _list_nodes(full=True)
def list_nodes_select(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_nodes_full function must be called with -f or --function."
        )
    return __utils__["cloud.list_nodes_select"](
        list_nodes_full("function"),
        __opts__["query.selection"],
        call,
    )
def list_security_groups(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_security_groups function must be called with -f or --function."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    secgroup_pool = server.one.secgrouppool.info(auth, -2, -1, -1)[1]
    groups = {}
    for group in _get_xml(secgroup_pool):
        groups[group.find("NAME").text] = _xml_to_dict(group)
    return groups
def list_templates(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_templates function must be called with -f or --function."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    template_pool = server.one.templatepool.info(auth, -2, -1, -1)[1]
    templates = {}
    for template in _get_xml(template_pool):
        templates[template.find("NAME").text] = _xml_to_dict(template)
    return templates
def list_vns(call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The list_vns function must be called with -f or --function."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vn_pool = server.one.vnpool.info(auth, -2, -1, -1)[1]
    vns = {}
    for v_network in _get_xml(vn_pool):
        vns[v_network.find("NAME").text] = _xml_to_dict(v_network)
    return vns
def reboot(name, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The start action must be called with -a or --action."
        )
    log.info("Rebooting node %s", name)
    return vm_action(name, kwargs={"action": "reboot"}, call=call)
def start(name, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The start action must be called with -a or --action."
        )
    log.info("Starting node %s", name)
    return vm_action(name, kwargs={"action": "resume"}, call=call)
def stop(name, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The start action must be called with -a or --action."
        )
    log.info("Stopping node %s", name)
    return vm_action(name, kwargs={"action": "stop"}, call=call)
def get_one_version(kwargs=None, call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The get_cluster_id function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    return server.one.system.version(auth)[1]
def get_cluster_id(kwargs=None, call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The get_cluster_id function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    if name is None:
        raise SaltCloudSystemExit("The get_cluster_id function requires a name.")
    try:
        ret = list_clusters()[name]["id"]
    except KeyError:
        raise SaltCloudSystemExit("The cluster '{}' could not be found".format(name))
    return ret
def get_datastore_id(kwargs=None, call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The get_datastore_id function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    if name is None:
        raise SaltCloudSystemExit("The get_datastore_id function requires a name.")
    try:
        ret = list_datastores()[name]["id"]
    except KeyError:
        raise SaltCloudSystemExit("The datastore '{}' could not be found.".format(name))
    return ret
def get_host_id(kwargs=None, call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The get_host_id function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    if name is None:
        raise SaltCloudSystemExit("The get_host_id function requires a name.")
    try:
        ret = avail_locations()[name]["id"]
    except KeyError:
        raise SaltCloudSystemExit("The host '{}' could not be found".format(name))
    return ret
def get_image(vm_):
    r"""
    Return the image object to use.
    vm\_
        The VM dictionary for which to obtain an image.
    Returns an image's ID from the given image name.
    .. versionadded:: 2016.3.0
    CLI Example:
    .. code-block:: bash
        salt-cloud -f get_image_id opennebula name=my-image-name
    locations = avail_locations()
    vm_location = str(
        config.get_cloud_config_value("location", vm_, __opts__, search_global=False)
    )
    if vm_location == "None":
        return None
    for location in locations:
        if vm_location in (locations[location]["name"], locations[location]["id"]):
            return locations[location]["id"]
    raise SaltCloudNotFound(
        "The specified location, '{}', could not be found.".format(vm_location)
    )
def get_secgroup_id(kwargs=None, call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The get_secgroup_id function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    if name is None:
        raise SaltCloudSystemExit("The get_secgroup_id function requires a 'name'.")
    try:
        ret = list_security_groups()[name]["id"]
    except KeyError:
        raise SaltCloudSystemExit(
            "The security group '{}' could not be found.".format(name)
        )
    return ret
def get_template_image(kwargs=None, call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The get_template_image function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    if name is None:
        raise SaltCloudSystemExit("The get_template_image function requires a 'name'.")
    try:
        ret = list_templates()[name]["template"]["disk"]["image"]
    except KeyError:
        raise SaltCloudSystemExit(
            "The image for template '{}' could not be found.".format(name)
        )
    return ret
def get_template_id(kwargs=None, call=None):
    if call == "action":
        raise SaltCloudSystemExit(
            "The get_template_id function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    if name is None:
        raise SaltCloudSystemExit("The get_template_id function requires a 'name'.")
    try:
        ret = list_templates()[name]["id"]
    except KeyError:
        raise SaltCloudSystemExit("The template '{}' could not be found.".format(name))
    return ret
def get_template(vm_):
    r"""
    Return the template id for a VM.
    .. versionadded:: 2016.11.0
    vm\_
        The VM dictionary for which to obtain a template.
    Returns a virtual machine's ID from the given virtual machine's name.
    .. versionadded:: 2016.3.0
    CLI Example:
    .. code-block:: bash
        salt-cloud -f get_vm_id opennebula name=my-vm
    Returns a virtual network's ID from the given virtual network's name.
    .. versionadded:: 2016.3.0
    CLI Example:
    .. code-block:: bash
        salt-cloud -f get_vn_id opennebula name=my-vn-name
    Returns the template format to create a disk in open nebula
    .. versionadded:: 2018.3.0
    try:
        if (
            vm_["profile"]
            and config.is_profile_configured(
                __opts__, _get_active_provider_name() or "opennebula", vm_["profile"]
            )
            is False
        ):
            return False
    except AttributeError:
        pass
    __utils__["cloud.fire_event"](
        "event",
        "starting create",
        "salt/cloud/{}/creating".format(vm_["name"]),
        args=__utils__["cloud.filter_event"](
            "creating", vm_, ["name", "profile", "provider", "driver"]
        ),
        sock_dir=__opts__["sock_dir"],
        transport=__opts__["transport"],
    )
    log.info("Creating Cloud VM %s", vm_["name"])
    kwargs = {
        "name": vm_["name"],
        "template_id": get_template(vm_),
        "region_id": get_location(vm_),
    }
    if "template" in vm_:
        kwargs["image_id"] = get_template_id({"name": vm_["template"]})
    private_networking = config.get_cloud_config_value(
        "private_networking", vm_, __opts__, search_global=False, default=None
    )
    kwargs["private_networking"] = "true" if private_networking else "false"
    __utils__["cloud.fire_event"](
        "event",
        "requesting instance",
        "salt/cloud/{}/requesting".format(vm_["name"]),
        args={
            "kwargs": __utils__["cloud.filter_event"](
                "requesting", kwargs, list(kwargs)
            ),
        },
        sock_dir=__opts__["sock_dir"],
    )
    template = []
    if kwargs.get("region_id"):
        template.append('SCHED_REQUIREMENTS="ID={}"'.format(kwargs.get("region_id")))
    if vm_.get("memory"):
        template.append("MEMORY={}".format(vm_.get("memory")))
    if vm_.get("cpu"):
        template.append("CPU={}".format(vm_.get("cpu")))
    if vm_.get("vcpu"):
        template.append("VCPU={}".format(vm_.get("vcpu")))
    if vm_.get("disk"):
        get_disks = vm_.get("disk")
        template_name = vm_["image"]
        for disk in get_disks:
            template.append(
                _get_device_template(disk, get_disks[disk], template=template_name)
            )
        if "CLONE" not in str(template):
            raise SaltCloudSystemExit(
                "Missing an image disk to clone. Must define a clone disk alongside all"
                " other disk definitions."
            )
    template_args = "\n".join(template)
    try:
        server, user, password = _get_xml_rpc()
        auth = ":".join([user, password])
        cret = server.one.template.instantiate(
            auth, int(kwargs["template_id"]), kwargs["name"], False, template_args
        )
        if not cret[0]:
            log.error(
                "Error creating %s on OpenNebula\n\n"
                "The following error was returned when trying to "
                "instantiate the template: %s",
                vm_["name"],
                cret[1],
                exc_info_on_loglevel=logging.DEBUG,
            )
            return False
    except Exception as exc:  # pylint: disable=broad-except
        log.error(
            "Error creating %s on OpenNebula\n\n"
            "The following exception was thrown when trying to "
            "run the initial deployment: %s",
            vm_["name"],
            exc,
            exc_info_on_loglevel=logging.DEBUG,
        )
        return False
    fqdn = vm_.get("fqdn_base")
    if fqdn is not None:
        fqdn = "{}.{}".format(vm_["name"], fqdn)
    def __query_node_data(vm_name):
        node_data = show_instance(vm_name, call="action")
        if not node_data:
            return False
        if node_data["state"] == "7":
            return False
        if node_data["lcm_state"] == "3":
            return node_data
    try:
        data = __utils__["cloud.wait_for_ip"](
            __query_node_data,
            update_args=(vm_["name"],),
            timeout=config.get_cloud_config_value(
                "wait_for_ip_timeout", vm_, __opts__, default=10 * 60
            ),
            interval=config.get_cloud_config_value(
                "wait_for_ip_interval", vm_, __opts__, default=2
            ),
        )
    except (SaltCloudExecutionTimeout, SaltCloudExecutionFailure) as exc:
        try:
            destroy(vm_["name"])
        except SaltCloudSystemExit:
            pass
        finally:
            raise SaltCloudSystemExit(str(exc))
    key_filename = config.get_cloud_config_value(
        "private_key", vm_, __opts__, search_global=False, default=None
    )
    if key_filename is not None and not os.path.isfile(key_filename):
        raise SaltCloudConfigError(
            "The defined key_filename '{}' does not exist".format(key_filename)
        )
    if fqdn:
        vm_["ssh_host"] = fqdn
        private_ip = "0.0.0.0"
    else:
        try:
            private_ip = data["private_ips"][0]
        except KeyError:
            try:
                private_ip = data["template"]["nic"]["ip"]
            except KeyError:
                private_ip = data["template"]["nic"]["ip6_global"]
            vm_["ssh_host"] = private_ip
    ssh_username = config.get_cloud_config_value(
        "ssh_username", vm_, __opts__, default="root"
    )
    vm_["username"] = ssh_username
    vm_["key_filename"] = key_filename
    ret = __utils__["cloud.bootstrap"](vm_, __opts__)
    ret["id"] = data["id"]
    ret["image"] = vm_["image"]
    ret["name"] = vm_["name"]
    ret["size"] = data["template"]["memory"]
    ret["state"] = data["state"]
    ret["private_ips"] = private_ip
    ret["public_ips"] = []
    log.info("Created Cloud VM '%s'", vm_["name"])
    log.debug("'%s' VM creation details:\n%s", vm_["name"], pprint.pformat(data))
    __utils__["cloud.fire_event"](
        "event",
        "created instance",
        "salt/cloud/{}/created".format(vm_["name"]),
        args=__utils__["cloud.filter_event"](
            "created", vm_, ["name", "profile", "provider", "driver"]
        ),
        sock_dir=__opts__["sock_dir"],
    )
    return ret
def destroy(name, call=None):
    if call == "function":
        raise SaltCloudSystemExit(
            "The destroy action must be called with -d, --destroy, -a or --action."
        )
    __utils__["cloud.fire_event"](
        "event",
        "destroying instance",
        "salt/cloud/{}/destroying".format(name),
        args={"name": name},
        sock_dir=__opts__["sock_dir"],
    )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    data = show_instance(name, call="action")
    node = server.one.vm.action(auth, "delete", int(data["id"]))
    __utils__["cloud.fire_event"](
        "event",
        "destroyed instance",
        "salt/cloud/{}/destroyed".format(name),
        args={"name": name},
        sock_dir=__opts__["sock_dir"],
    )
    if __opts__.get("update_cachedir", False) is True:
        __utils__["cloud.delete_minion_cachedir"](
            name, _get_active_provider_name().split(":")[0], __opts__
        )
    data = {
        "action": "vm.delete",
        "deleted": node[0],
        "node_id": node[1],
        "error_code": node[2],
    }
    return data
def image_allocate(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_allocate function must be called with -f or --function."
        )
<a name="5"></a>    if kwargs is None:
        kwargs = {}
    path <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= kwargs.get("path", None)
    data = kwargs.get("data", None)
    datastore_id = kwargs.get("datastore_id", None)
    datastore_name = kwargs.get(</b></font>"datastore_name", None)
    if datastore_id:
        if datastore_name:
            log.warning(
                "Both a 'datastore_id' and a 'datastore_name' were provided. "
                "'datastore_id' will take precedence."
            )
    elif datastore_name:
        datastore_id = get_datastore_id(kwargs={"name": datastore_name})
    else:
        raise SaltCloudSystemExit(
            "The image_allocate function requires either a 'datastore_id' or a "
            "'datastore_name' to be provided."
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The image_allocate function requires either a file 'path' or 'data' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.image.allocate(auth, data, int(datastore_id))
    ret = {
        "action": "image.allocate",
        "allocated": response[0],
        "image_id": response[1],
        "error_code": response[2],
    }
    return ret
def image_clone(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_clone function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    image_id = kwargs.get("image_id", None)
    image_name = kwargs.get("image_name", None)
    if name is None:
        raise SaltCloudSystemExit(
            "The image_clone function requires a 'name' to be provided."
        )
    if image_id:
        if image_name:
            log.warning(
                "Both the 'image_id' and 'image_name' arguments were provided. "
                "'image_id' will take precedence."
            )
    elif image_name:
        image_id = get_image_id(kwargs={"name": image_name})
    else:
        raise SaltCloudSystemExit(
            "The image_clone function requires either an 'image_id' or an "
            "'image_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.image.clone(auth, int(image_id), name)
    data = {
        "action": "image.clone",
        "cloned": response[0],
        "cloned_image_id": response[1],
        "cloned_image_name": name,
        "error_code": response[2],
    }
    return data
def image_delete(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_delete function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    image_id = kwargs.get("image_id", None)
    if image_id:
        if name:
            log.warning(
                "Both the 'image_id' and 'name' arguments were provided. "
                "'image_id' will take precedence."
            )
    elif name:
        image_id = get_image_id(kwargs={"name": name})
    else:
        raise SaltCloudSystemExit(
            "The image_delete function requires either an 'image_id' or a "
            "'name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.image.delete(auth, int(image_id))
    data = {
        "action": "image.delete",
        "deleted": response[0],
        "image_id": response[1],
        "error_code": response[2],
    }
    return data
def image_info(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_info function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    image_id = kwargs.get("image_id", None)
    if image_id:
        if name:
            log.warning(
                "Both the 'image_id' and 'name' arguments were provided. "
                "'image_id' will take precedence."
            )
    elif name:
        image_id = get_image_id(kwargs={"name": name})
    else:
        raise SaltCloudSystemExit(
            "The image_info function requires either a 'name or an 'image_id' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    info = {}
    response = server.one.image.info(auth, int(image_id))[1]
    tree = _get_xml(response)
    info[tree.find("NAME").text] = _xml_to_dict(tree)
    return info
def image_persistent(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_persistent function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    persist = kwargs.get("persist", None)
    image_id = kwargs.get("image_id", None)
    if persist is None:
        raise SaltCloudSystemExit(
            "The image_persistent function requires 'persist' to be set to 'True' "
            "or 'False'."
        )
    if image_id:
        if name:
            log.warning(
                "Both the 'image_id' and 'name' arguments were provided. "
                "'image_id' will take precedence."
            )
    elif name:
        image_id = get_image_id(kwargs={"name": name})
    else:
        raise SaltCloudSystemExit(
            "The image_persistent function requires either a 'name' or an "
            "'image_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.image.persistent(
        auth, int(image_id), salt.utils.data.is_true(persist)
    )
    data = {
        "action": "image.persistent",
        "response": response[0],
        "image_id": response[1],
        "error_code": response[2],
    }
    return data
def image_snapshot_delete(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_snapshot_delete function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    image_id = kwargs.get("image_id", None)
    image_name = kwargs.get("image_name", None)
    snapshot_id = kwargs.get("snapshot_id", None)
    if snapshot_id is None:
        raise SaltCloudSystemExit(
            "The image_snapshot_delete function requires a 'snapshot_id' to be"
            " provided."
        )
    if image_id:
        if image_name:
            log.warning(
                "Both the 'image_id' and 'image_name' arguments were provided. "
                "'image_id' will take precedence."
            )
    elif image_name:
        image_id = get_image_id(kwargs={"name": image_name})
    else:
        raise SaltCloudSystemExit(
            "The image_snapshot_delete function requires either an 'image_id' "
            "or a 'image_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.image.snapshotdelete(auth, int(image_id), int(snapshot_id))
    data = {
        "action": "image.snapshotdelete",
        "deleted": response[0],
        "snapshot_id": response[1],
        "error_code": response[2],
    }
    return data
def image_snapshot_revert(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_snapshot_revert function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    image_id = kwargs.get("image_id", None)
    image_name = kwargs.get("image_name", None)
    snapshot_id = kwargs.get("snapshot_id", None)
    if snapshot_id is None:
        raise SaltCloudSystemExit(
            "The image_snapshot_revert function requires a 'snapshot_id' to be"
            " provided."
        )
    if image_id:
        if image_name:
            log.warning(
                "Both the 'image_id' and 'image_name' arguments were provided. "
                "'image_id' will take precedence."
            )
    elif image_name:
        image_id = get_image_id(kwargs={"name": image_name})
    else:
        raise SaltCloudSystemExit(
            "The image_snapshot_revert function requires either an 'image_id' or "
            "an 'image_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.image.snapshotrevert(auth, int(image_id), int(snapshot_id))
    data = {
        "action": "image.snapshotrevert",
        "reverted": response[0],
        "snapshot_id": response[1],
        "error_code": response[2],
    }
    return data
def image_snapshot_flatten(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_snapshot_flatten function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    image_id = kwargs.get("image_id", None)
    image_name = kwargs.get("image_name", None)
    snapshot_id = kwargs.get("snapshot_id", None)
    if snapshot_id is None:
        raise SaltCloudSystemExit(
            "The image_stanpshot_flatten function requires a 'snapshot_id' "
            "to be provided."
        )
    if image_id:
        if image_name:
            log.warning(
                "Both the 'image_id' and 'image_name' arguments were provided. "
                "'image_id' will take precedence."
            )
    elif image_name:
        image_id = get_image_id(kwargs={"name": image_name})
    else:
        raise SaltCloudSystemExit(
            "The image_snapshot_flatten function requires either an "
            "'image_id' or an 'image_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.image.snapshotflatten(auth, int(image_id), int(snapshot_id))
    data = {
        "action": "image.snapshotflatten",
        "flattened": response[0],
        "snapshot_id": response[1],
        "error_code": response[2],
    }
    return data
def image_update(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The image_allocate function must be called with -f or --function."
        )
<a name="1"></a>    if kwargs is None:
        kwargs = {}
    image_id = kwargs<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.get("image_id", None)
    image_name = kwargs.get("image_name", None)
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    update_type = kwargs.get("update_type", None)
    update_args =</b></font> ["replace", "merge"]
    if update_type is None:
        raise SaltCloudSystemExit(
            "The image_update function requires an 'update_type' to be provided."
        )
    if update_type == update_args[0]:
        update_number = 0
    elif update_type == update_args[1]:
        update_number = 1
    else:
        raise SaltCloudSystemExit(
            "The update_type argument must be either {} or {}.".format(
                update_args[0], update_args[1]
            )
        )
    if image_id:
        if image_name:
            log.warning(
                "Both the 'image_id' and 'image_name' arguments were provided. "
                "'image_id' will take precedence."
            )
    elif image_name:
        image_id = get_image_id(kwargs={"name": image_name})
    else:
        raise SaltCloudSystemExit(
            "The image_update function requires either an 'image_id' or an "
            "'image_name' to be provided."
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The image_update function requires either 'data' or a file 'path' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.image.update(auth, int(image_id), data, int(update_number))
    ret = {
        "action": "image.update",
        "updated": response[0],
        "image_id": response[1],
        "error_code": response[2],
    }
    return ret
def show_instance(name, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The show_instance action must be called with -a or --action."
        )
    node = _get_node(name)
    __utils__["cloud.cache_node"](node, _get_active_provider_name(), __opts__)
    return node
def secgroup_allocate(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The secgroup_allocate function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The secgroup_allocate function requires either 'data' or a file "
            "'path' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.secgroup.allocate(auth, data)
    ret = {
        "action": "secgroup.allocate",
        "allocated": response[0],
        "secgroup_id": response[1],
        "error_code": response[2],
    }
    return ret
def secgroup_clone(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The secgroup_clone function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    secgroup_id = kwargs.get("secgroup_id", None)
    secgroup_name = kwargs.get("secgroup_name", None)
    if name is None:
        raise SaltCloudSystemExit(
            "The secgroup_clone function requires a 'name' to be provided."
        )
    if secgroup_id:
        if secgroup_name:
            log.warning(
                "Both the 'secgroup_id' and 'secgroup_name' arguments were provided. "
                "'secgroup_id' will take precedence."
            )
    elif secgroup_name:
        secgroup_id = get_secgroup_id(kwargs={"name": secgroup_name})
    else:
        raise SaltCloudSystemExit(
            "The secgroup_clone function requires either a 'secgroup_id' or a "
            "'secgroup_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.secgroup.clone(auth, int(secgroup_id), name)
    data = {
        "action": "secgroup.clone",
        "cloned": response[0],
        "cloned_secgroup_id": response[1],
        "cloned_secgroup_name": name,
        "error_code": response[2],
    }
    return data
def secgroup_delete(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The secgroup_delete function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    secgroup_id = kwargs.get("secgroup_id", None)
    if secgroup_id:
        if name:
            log.warning(
                "Both the 'secgroup_id' and 'name' arguments were provided. "
                "'secgroup_id' will take precedence."
            )
    elif name:
        secgroup_id = get_secgroup_id(kwargs={"name": name})
    else:
        raise SaltCloudSystemExit(
            "The secgroup_delete function requires either a 'name' or a "
            "'secgroup_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.secgroup.delete(auth, int(secgroup_id))
    data = {
        "action": "secgroup.delete",
        "deleted": response[0],
        "secgroup_id": response[1],
        "error_code": response[2],
    }
    return data
def secgroup_info(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The secgroup_info function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    secgroup_id = kwargs.get("secgroup_id", None)
    if secgroup_id:
        if name:
            log.warning(
                "Both the 'secgroup_id' and 'name' arguments were provided. "
                "'secgroup_id' will take precedence."
            )
    elif name:
        secgroup_id = get_secgroup_id(kwargs={"name": name})
    else:
        raise SaltCloudSystemExit(
            "The secgroup_info function requires either a name or a secgroup_id "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    info = {}
    response = server.one.secgroup.info(auth, int(secgroup_id))[1]
    tree = _get_xml(response)
    info[tree.find("NAME").text] = _xml_to_dict(tree)
    return info
def secgroup_update(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The secgroup_allocate function must be called with -f or --function."
        )
<a name="2"></a>    if kwargs is None:
        kwargs = {}
    secgroup_id <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= kwargs.get("secgroup_id", None)
    secgroup_name = kwargs.get("secgroup_name", None)
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    update_type =</b></font> kwargs.get("update_type", None)
    update_args = ["replace", "merge"]
    if update_type is None:
        raise SaltCloudSystemExit(
            "The secgroup_update function requires an 'update_type' to be provided."
        )
    if update_type == update_args[0]:
        update_number = 0
    elif update_type == update_args[1]:
        update_number = 1
    else:
        raise SaltCloudSystemExit(
            "The update_type argument must be either {} or {}.".format(
                update_args[0], update_args[1]
            )
        )
    if secgroup_id:
        if secgroup_name:
            log.warning(
                "Both the 'secgroup_id' and 'secgroup_name' arguments were provided. "
                "'secgroup_id' will take precedence."
            )
    elif secgroup_name:
        secgroup_id = get_secgroup_id(kwargs={"name": secgroup_name})
    else:
        raise SaltCloudSystemExit(
            "The secgroup_update function requires either a 'secgroup_id' or a "
            "'secgroup_name' to be provided."
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The secgroup_update function requires either 'data' or a file 'path' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.secgroup.update(
        auth, int(secgroup_id), data, int(update_number)
    )
    ret = {
        "action": "secgroup.update",
        "updated": response[0],
        "secgroup_id": response[1],
        "error_code": response[2],
    }
    return ret
def template_allocate(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The template_allocate function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The template_allocate function requires either 'data' or a file "
            "'path' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.template.allocate(auth, data)
    ret = {
        "action": "template.allocate",
        "allocated": response[0],
        "template_id": response[1],
        "error_code": response[2],
    }
    return ret
def template_clone(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The template_clone function must be called with -f or --function."
        )
<a name="4"></a>    if kwargs is None:
        kwargs = {}
    name <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= kwargs.get("name", None)
    template_id = kwargs.get("template_id", None)
    template_name = kwargs.get("template_name", None)
    clone_images = kwargs.get(</b></font>"clone_images", False)
    if name is None:
        raise SaltCloudSystemExit(
            "The template_clone function requires a name to be provided."
        )
    if template_id:
        if template_name:
            log.warning(
                "Both the 'template_id' and 'template_name' arguments were provided. "
                "'template_id' will take precedence."
            )
    elif template_name:
        template_id = get_template_id(kwargs={"name": template_name})
    else:
        raise SaltCloudSystemExit(
            "The template_clone function requires either a 'template_id' "
            "or a 'template_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.template.clone(auth, int(template_id), name, clone_images)
    data = {
        "action": "template.clone",
        "cloned": response[0],
        "cloned_template_id": response[1],
        "cloned_template_name": name,
        "error_code": response[2],
    }
    return data
def template_delete(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The template_delete function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    template_id = kwargs.get("template_id", None)
    if template_id:
        if name:
            log.warning(
                "Both the 'template_id' and 'name' arguments were provided. "
                "'template_id' will take precedence."
            )
    elif name:
        template_id = get_template_id(kwargs={"name": name})
    else:
        raise SaltCloudSystemExit(
            "The template_delete function requires either a 'name' or a 'template_id' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.template.delete(auth, int(template_id))
    data = {
        "action": "template.delete",
        "deleted": response[0],
        "template_id": response[1],
        "error_code": response[2],
    }
    return data
def template_instantiate(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The template_instantiate function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    vm_name = kwargs.get("vm_name", None)
    template_id = kwargs.get("template_id", None)
    template_name = kwargs.get("template_name", None)
    if vm_name is None:
        raise SaltCloudSystemExit(
            "The template_instantiate function requires a 'vm_name' to be provided."
        )
    if template_id:
        if template_name:
            log.warning(
                "Both the 'template_id' and 'template_name' arguments were provided. "
                "'template_id' will take precedence."
            )
    elif template_name:
        template_id = get_template_id(kwargs={"name": template_name})
    else:
        raise SaltCloudSystemExit(
            "The template_instantiate function requires either a 'template_id' "
            "or a 'template_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.template.instantiate(auth, int(template_id), vm_name)
    data = {
        "action": "template.instantiate",
        "instantiated": response[0],
        "instantiated_vm_id": response[1],
        "vm_name": vm_name,
        "error_code": response[2],
    }
    return data
def template_update(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The template_update function must be called with -f or --function."
        )
<a name="3"></a>    if kwargs is None:
        kwargs = {}
    template_id <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= kwargs.get("template_id", None)
    template_name = kwargs.get("template_name", None)
    path = kwargs.get("path", None)
    data = kwargs.get(</b></font>"data", None)
    update_type = kwargs.get("update_type", None)
    update_args = ["replace", "merge"]
    if update_type is None:
        raise SaltCloudSystemExit(
            "The template_update function requires an 'update_type' to be provided."
        )
    if update_type == update_args[0]:
        update_number = 0
    elif update_type == update_args[1]:
        update_number = 1
    else:
        raise SaltCloudSystemExit(
            "The update_type argument must be either {} or {}.".format(
                update_args[0], update_args[1]
            )
        )
    if template_id:
        if template_name:
            log.warning(
                "Both the 'template_id' and 'template_name' arguments were provided. "
                "'template_id' will take precedence."
            )
    elif template_name:
        template_id = get_template_id(kwargs={"name": template_name})
    else:
        raise SaltCloudSystemExit(
            "The template_update function requires either a 'template_id' "
            "or a 'template_name' to be provided."
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The template_update function requires either 'data' or a file "
            "'path' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.template.update(
        auth, int(template_id), data, int(update_number)
    )
    ret = {
        "action": "template.update",
        "updated": response[0],
        "template_id": response[1],
        "error_code": response[2],
    }
    return ret
def vm_action(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_action function must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    action = kwargs.get("action", None)
    if action is None:
        raise SaltCloudSystemExit(
            "The vm_action function must have an 'action' provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.action(auth, action, vm_id)
    data = {
        "action": "vm.action." + str(action),
        "actioned": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_allocate(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vm_allocate function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    hold = kwargs.get("hold", False)
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vm_allocate function requires either 'data' or a file 'path' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vm.allocate(auth, data, salt.utils.data.is_true(hold))
    ret = {
        "action": "vm.allocate",
        "allocated": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return ret
def vm_attach(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_attach action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vm_attach function requires either 'data' or a file "
            "'path' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.attach(auth, vm_id, data)
    ret = {
        "action": "vm.attach",
        "attached": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return ret
def vm_attach_nic(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_attach_nic action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vm_attach_nic function requires either 'data' or a file "
            "'path' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.attachnic(auth, vm_id, data)
    ret = {
        "action": "vm.attachnic",
        "nic_attached": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return ret
def vm_deploy(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_deploy action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    host_id = kwargs.get("host_id", None)
    host_name = kwargs.get("host_name", None)
    capacity_maintained = kwargs.get("capacity_maintained", True)
    datastore_id = kwargs.get("datastore_id", None)
    datastore_name = kwargs.get("datastore_name", None)
    if host_id:
        if host_name:
            log.warning(
                "Both the 'host_id' and 'host_name' arguments were provided. "
                "'host_id' will take precedence."
            )
    elif host_name:
        host_id = get_host_id(kwargs={"name": host_name})
    else:
        raise SaltCloudSystemExit(
            "The vm_deploy function requires a 'host_id' or a 'host_name' "
            "to be provided."
        )
    if datastore_id:
        if datastore_name:
            log.warning(
                "Both the 'datastore_id' and 'datastore_name' arguments were provided. "
                "'datastore_id' will take precedence."
            )
    elif datastore_name:
        datastore_id = get_datastore_id(kwargs={"name": datastore_name})
    else:
        datastore_id = "-1"
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = get_vm_id(kwargs={"name": name})
    response = server.one.vm.deploy(
        auth,
        int(vm_id),
        int(host_id),
        salt.utils.data.is_true(capacity_maintained),
        int(datastore_id),
    )
    data = {
        "action": "vm.deploy",
        "deployed": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_detach(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_detach action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    disk_id = kwargs.get("disk_id", None)
    if disk_id is None:
        raise SaltCloudSystemExit(
            "The vm_detach function requires a 'disk_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.detach(auth, vm_id, int(disk_id))
    data = {
        "action": "vm.detach",
        "detached": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_detach_nic(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_detach_nic action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    nic_id = kwargs.get("nic_id", None)
    if nic_id is None:
        raise SaltCloudSystemExit(
            "The vm_detach_nic function requires a 'nic_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.detachnic(auth, vm_id, int(nic_id))
    data = {
        "action": "vm.detachnic",
        "nic_detached": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_disk_save(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_disk_save action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    disk_id = kwargs.get("disk_id", None)
    image_name = kwargs.get("image_name", None)
    image_type = kwargs.get("image_type", "")
    snapshot_id = int(kwargs.get("snapshot_id", "-1"))
    if disk_id is None or image_name is None:
        raise SaltCloudSystemExit(
            "The vm_disk_save function requires a 'disk_id' and an 'image_name' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.disksave(
        auth, vm_id, int(disk_id), image_name, image_type, snapshot_id
    )
    data = {
        "action": "vm.disksave",
        "saved": response[0],
        "image_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_disk_snapshot_create(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_disk_snapshot_create action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    disk_id = kwargs.get("disk_id", None)
    description = kwargs.get("description", None)
    if disk_id is None or description is None:
        raise SaltCloudSystemExit(
            "The vm_disk_snapshot_create function requires a 'disk_id' and a"
            " 'description' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.disksnapshotcreate(auth, vm_id, int(disk_id), description)
    data = {
        "action": "vm.disksnapshotcreate",
        "created": response[0],
        "snapshot_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_disk_snapshot_delete(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_disk_snapshot_delete action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    disk_id = kwargs.get("disk_id", None)
    snapshot_id = kwargs.get("snapshot_id", None)
    if disk_id is None or snapshot_id is None:
        raise SaltCloudSystemExit(
            "The vm_disk_snapshot_create function requires a 'disk_id' and a"
            " 'snapshot_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.disksnapshotdelete(
        auth, vm_id, int(disk_id), int(snapshot_id)
    )
    data = {
        "action": "vm.disksnapshotdelete",
        "deleted": response[0],
        "snapshot_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_disk_snapshot_revert(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_disk_snapshot_revert action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    disk_id = kwargs.get("disk_id", None)
    snapshot_id = kwargs.get("snapshot_id", None)
    if disk_id is None or snapshot_id is None:
        raise SaltCloudSystemExit(
            "The vm_disk_snapshot_revert function requires a 'disk_id' and a"
            " 'snapshot_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.disksnapshotrevert(
        auth, vm_id, int(disk_id), int(snapshot_id)
    )
    data = {
        "action": "vm.disksnapshotrevert",
        "deleted": response[0],
        "snapshot_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_info(name, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_info action must be called with -a or --action."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.info(auth, vm_id)
    if response[0] is False:
        return response[1]
    else:
        info = {}
        tree = _get_xml(response[1])
        info[tree.find("NAME").text] = _xml_to_dict(tree)
        return info
def vm_migrate(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_migrate action must be called with -a or --action."
        )
<a name="0"></a>    if kwargs is None:
        kwargs = {}
    host_id <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= kwargs.get("host_id", None)
    host_name = kwargs.get("host_name", None)
    live_migration = kwargs.get("live_migration", False)
    capacity_maintained = kwargs.get("capacity_maintained", True)
    datastore_id = kwargs.get("datastore_id", None)
    datastore_name = kwargs.get(</b></font>"datastore_name", None)
    if datastore_id:
        if datastore_name:
            log.warning(
                "Both the 'datastore_id' and 'datastore_name' arguments were provided. "
                "'datastore_id' will take precedence."
            )
    elif datastore_name:
        datastore_id = get_datastore_id(kwargs={"name": datastore_name})
    else:
        raise SaltCloudSystemExit(
            "The vm_migrate function requires either a 'datastore_id' or a "
            "'datastore_name' to be provided."
        )
    if host_id:
        if host_name:
            log.warning(
                "Both the 'host_id' and 'host_name' arguments were provided. "
                "'host_id' will take precedence."
            )
    elif host_name:
        host_id = get_host_id(kwargs={"name": host_name})
    else:
        raise SaltCloudSystemExit(
            "The vm_migrate function requires either a 'host_id' "
            "or a 'host_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.migrate(
        auth,
        vm_id,
        int(host_id),
        salt.utils.data.is_true(live_migration),
        salt.utils.data.is_true(capacity_maintained),
        int(datastore_id),
    )
    data = {
        "action": "vm.migrate",
        "migrated": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_monitoring(name, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_monitoring action must be called with -a or --action."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.monitoring(auth, vm_id)
    if response[0] is False:
        log.error(
            "There was an error retrieving the specified VM's monitoring information."
        )
        return {}
    else:
        info = {}
        for vm_ in _get_xml(response[1]):
            info[vm_.find("ID").text] = _xml_to_dict(vm_)
        return info
def vm_resize(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_resize action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    capacity_maintained = kwargs.get("capacity_maintained", True)
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vm_resize function requires either 'data' or a file 'path' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.resize(
        auth, vm_id, data, salt.utils.data.is_true(capacity_maintained)
    )
    ret = {
        "action": "vm.resize",
        "resized": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return ret
def vm_snapshot_create(vm_name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_snapshot_create action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    snapshot_name = kwargs.get("snapshot_name", None)
    if snapshot_name is None:
        raise SaltCloudSystemExit(
            "The vm_snapshot_create function requires a 'snapshot_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": vm_name}))
    response = server.one.vm.snapshotcreate(auth, vm_id, snapshot_name)
    data = {
        "action": "vm.snapshotcreate",
        "snapshot_created": response[0],
        "snapshot_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_snapshot_delete(vm_name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_snapshot_delete action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    snapshot_id = kwargs.get("snapshot_id", None)
    if snapshot_id is None:
        raise SaltCloudSystemExit(
            "The vm_snapshot_delete function requires a 'snapshot_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": vm_name}))
    response = server.one.vm.snapshotdelete(auth, vm_id, int(snapshot_id))
    data = {
        "action": "vm.snapshotdelete",
        "snapshot_deleted": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_snapshot_revert(vm_name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_snapshot_revert action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    snapshot_id = kwargs.get("snapshot_id", None)
    if snapshot_id is None:
        raise SaltCloudSystemExit(
            "The vm_snapshot_revert function requires a 'snapshot_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": vm_name}))
    response = server.one.vm.snapshotrevert(auth, vm_id, int(snapshot_id))
    data = {
        "action": "vm.snapshotrevert",
        "snapshot_reverted": response[0],
        "vm_id": response[1],
        "error_code": response[2],
    }
    return data
def vm_update(name, kwargs=None, call=None):
    if call != "action":
        raise SaltCloudSystemExit(
            "The vm_update action must be called with -a or --action."
        )
    if kwargs is None:
        kwargs = {}
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    update_type = kwargs.get("update_type", None)
    update_args = ["replace", "merge"]
    if update_type is None:
        raise SaltCloudSystemExit(
            "The vm_update function requires an 'update_type' to be provided."
        )
    if update_type == update_args[0]:
        update_number = 0
    elif update_type == update_args[1]:
        update_number = 1
    else:
        raise SaltCloudSystemExit(
            "The update_type argument must be either {} or {}.".format(
                update_args[0], update_args[1]
            )
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vm_update function requires either 'data' or a file 'path' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_id = int(get_vm_id(kwargs={"name": name}))
    response = server.one.vm.update(auth, vm_id, data, int(update_number))
    ret = {
        "action": "vm.update",
        "updated": response[0],
        "resource_id": response[1],
        "error_code": response[2],
    }
    return ret
def vn_add_ar(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vn_add_ar function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    vn_id = kwargs.get("vn_id", None)
    vn_name = kwargs.get("vn_name", None)
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if vn_id:
        if vn_name:
            log.warning(
                "Both the 'vn_id' and 'vn_name' arguments were provided. "
                "'vn_id' will take precedence."
            )
    elif vn_name:
        vn_id = get_vn_id(kwargs={"name": vn_name})
    else:
        raise SaltCloudSystemExit(
            "The vn_add_ar function requires a 'vn_id' and a 'vn_name' to be provided."
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vn_add_ar function requires either 'data' or a file 'path' "
            "to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vn.add_ar(auth, int(vn_id), data)
    ret = {
        "action": "vn.add_ar",
        "address_range_added": response[0],
        "resource_id": response[1],
        "error_code": response[2],
    }
    return ret
def vn_allocate(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vn_allocate function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    cluster_id = kwargs.get("cluster_id", None)
    cluster_name = kwargs.get("cluster_name", None)
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vn_allocate function requires either 'data' or a file 'path' "
            "to be provided."
        )
    if cluster_id:
        if cluster_name:
            log.warning(
                "Both the 'cluster_id' and 'cluster_name' arguments were provided. "
                "'cluster_id' will take precedence."
            )
    elif cluster_name:
        cluster_id = get_cluster_id(kwargs={"name": cluster_name})
    else:
        cluster_id = "-1"
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vn.allocate(auth, data, int(cluster_id))
    ret = {
        "action": "vn.allocate",
        "allocated": response[0],
        "vn_id": response[1],
        "error_code": response[2],
    }
    return ret
def vn_delete(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vn_delete function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    vn_id = kwargs.get("vn_id", None)
    if vn_id:
        if name:
            log.warning(
                "Both the 'vn_id' and 'name' arguments were provided. "
                "'vn_id' will take precedence."
            )
    elif name:
        vn_id = get_vn_id(kwargs={"name": name})
    else:
        raise SaltCloudSystemExit(
            "The vn_delete function requires a 'name' or a 'vn_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vn.delete(auth, int(vn_id))
    data = {
        "action": "vn.delete",
        "deleted": response[0],
        "vn_id": response[1],
        "error_code": response[2],
    }
    return data
def vn_free_ar(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vn_free_ar function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    vn_id = kwargs.get("vn_id", None)
    vn_name = kwargs.get("vn_name", None)
    ar_id = kwargs.get("ar_id", None)
    if ar_id is None:
        raise SaltCloudSystemExit(
            "The vn_free_ar function requires an 'rn_id' to be provided."
        )
    if vn_id:
        if vn_name:
            log.warning(
                "Both the 'vn_id' and 'vn_name' arguments were provided. "
                "'vn_id' will take precedence."
            )
    elif vn_name:
        vn_id = get_vn_id(kwargs={"name": vn_name})
    else:
        raise SaltCloudSystemExit(
            "The vn_free_ar function requires a 'vn_id' or a 'vn_name' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vn.free_ar(auth, int(vn_id), int(ar_id))
    data = {
        "action": "vn.free_ar",
        "ar_freed": response[0],
        "resource_id": response[1],
        "error_code": response[2],
    }
    return data
def vn_hold(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vn_hold function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    vn_id = kwargs.get("vn_id", None)
    vn_name = kwargs.get("vn_name", None)
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if vn_id:
        if vn_name:
            log.warning(
                "Both the 'vn_id' and 'vn_name' arguments were provided. "
                "'vn_id' will take precedence."
            )
    elif vn_name:
        vn_id = get_vn_id(kwargs={"name": vn_name})
    else:
        raise SaltCloudSystemExit(
            "The vn_hold function requires a 'vn_id' or a 'vn_name' to be provided."
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vn_hold function requires either 'data' or a 'path' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vn.hold(auth, int(vn_id), data)
    ret = {
        "action": "vn.hold",
        "held": response[0],
        "resource_id": response[1],
        "error_code": response[2],
    }
    return ret
def vn_info(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vn_info function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    name = kwargs.get("name", None)
    vn_id = kwargs.get("vn_id", None)
    if vn_id:
        if name:
            log.warning(
                "Both the 'vn_id' and 'name' arguments were provided. "
                "'vn_id' will take precedence."
            )
    elif name:
        vn_id = get_vn_id(kwargs={"name": name})
    else:
        raise SaltCloudSystemExit(
            "The vn_info function requires either a 'name' or a 'vn_id' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vn.info(auth, int(vn_id))
    if response[0] is False:
        return response[1]
    else:
        info = {}
        tree = _get_xml(response[1])
        info[tree.find("NAME").text] = _xml_to_dict(tree)
        return info
def vn_release(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vn_reserve function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    vn_id = kwargs.get("vn_id", None)
    vn_name = kwargs.get("vn_name", None)
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if vn_id:
        if vn_name:
            log.warning(
                "Both the 'vn_id' and 'vn_name' arguments were provided. "
                "'vn_id' will take precedence."
            )
    elif vn_name:
        vn_id = get_vn_id(kwargs={"name": vn_name})
    else:
        raise SaltCloudSystemExit(
            "The vn_release function requires a 'vn_id' or a 'vn_name' to be provided."
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vn_release function requires either 'data' or a 'path' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vn.release(auth, int(vn_id), data)
    ret = {
        "action": "vn.release",
        "released": response[0],
        "resource_id": response[1],
        "error_code": response[2],
    }
    return ret
def vn_reserve(call=None, kwargs=None):
    if call != "function":
        raise SaltCloudSystemExit(
            "The vn_reserve function must be called with -f or --function."
        )
    if kwargs is None:
        kwargs = {}
    vn_id = kwargs.get("vn_id", None)
    vn_name = kwargs.get("vn_name", None)
    path = kwargs.get("path", None)
    data = kwargs.get("data", None)
    if vn_id:
        if vn_name:
            log.warning(
                "Both the 'vn_id' and 'vn_name' arguments were provided. "
                "'vn_id' will take precedence."
            )
    elif vn_name:
        vn_id = get_vn_id(kwargs={"name": vn_name})
    else:
        raise SaltCloudSystemExit(
            "The vn_reserve function requires a 'vn_id' or a 'vn_name' to be provided."
        )
    if data:
        if path:
            log.warning(
                "Both the 'data' and 'path' arguments were provided. "
                "'data' will take precedence."
            )
    elif path:
        with salt.utils.files.fopen(path, mode="r") as rfh:
            data = rfh.read()
    else:
        raise SaltCloudSystemExit(
            "The vn_reserve function requires a 'path' to be provided."
        )
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    response = server.one.vn.reserve(auth, int(vn_id), data)
    ret = {
        "action": "vn.reserve",
        "reserved": response[0],
        "resource_id": response[1],
        "error_code": response[2],
    }
    return ret
def _get_node(name):
    attempts = 10
    while attempts &gt;= 0:
        try:
            return list_nodes_full()[name]
        except KeyError:
            attempts -= 1
            log.debug(
                "Failed to get the data for node '%s'. Remaining attempts: %s",
                name,
                attempts,
            )
            time.sleep(0.5)
    return {}
def _get_xml(xml_str):
    try:
        xml_data = etree.XML(xml_str)
    except etree.XMLSyntaxError as err:
        raise SaltCloudSystemExit("opennebula returned: {}".format(xml_str))
    return xml_data
def _get_xml_rpc():
    vm_ = get_configured_provider()
    xml_rpc = config.get_cloud_config_value(
        "xml_rpc", vm_, __opts__, search_global=False
    )
    user = config.get_cloud_config_value("user", vm_, __opts__, search_global=False)
    password = config.get_cloud_config_value(
        "password", vm_, __opts__, search_global=False
    )
    server = xmlrpc.client.ServerProxy(xml_rpc)
    return server, user, password
def _list_nodes(full=False):
    server, user, password = _get_xml_rpc()
    auth = ":".join([user, password])
    vm_pool = server.one.vmpool.info(auth, -2, -1, -1, -1)[1]
    vms = {}
    for vm in _get_xml(vm_pool):
        name = vm.find("NAME").text
        vms[name] = {}
        cpu_size = vm.find("TEMPLATE").find("CPU").text
        memory_size = vm.find("TEMPLATE").find("MEMORY").text
        private_ips = []
        for nic in vm.find("TEMPLATE").findall("NIC"):
            try:
                private_ips.append(nic.find("IP").text)
            except Exception:  # pylint: disable=broad-except
                pass
        vms[name]["id"] = vm.find("ID").text
        if "TEMPLATE_ID" in vm.find("TEMPLATE"):
            vms[name]["image"] = vm.find("TEMPLATE").find("TEMPLATE_ID").text
        vms[name]["name"] = name
        vms[name]["size"] = {"cpu": cpu_size, "memory": memory_size}
        vms[name]["state"] = vm.find("STATE").text
        vms[name]["private_ips"] = private_ips
        vms[name]["public_ips"] = []
        if full:
            vms[vm.find("NAME").text] = _xml_to_dict(vm)
    return vms
def _xml_to_dict(xml):
    dicts = {}
    for item in xml:
        key = item.tag.lower()
        idx = 1
        while key in dicts:
            key += str(idx)
            idx += 1
        if item.text is None:
            dicts[key] = _xml_to_dict(item)
        else:
            dicts[key] = item.text
    return dicts
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>vagrant_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import logging
import os
import salt.utils.files
import salt.utils.path
import salt.utils.stringutils
from salt._compat import ipaddress
from salt.exceptions import CommandExecutionError, SaltInvocationError
log = logging.getLogger(__name__)
__virtualname__ = "vagrant"
VAGRANT_SDB_URL = "sdb://vagrant_sdb_data/"
def __virtual__():
    if salt.utils.path.which("vagrant") is None:
        return (
            False,
            "The vagrant module could not be loaded: vagrant command not found",
        )
    return __virtualname__
def _build_sdb_uri(key):
    return "{}{}".format(VAGRANT_SDB_URL, key)
def _build_machine_uri(machine, cwd):
    key = "{}?{}".format(machine, os.path.abspath(cwd))
    return _build_sdb_uri(key)
def _update_vm_info(name, vm_):
    __utils__["sdb.sdb_set"](_build_sdb_uri(name), vm_, __opts__)
    if vm_["machine"]:
        __utils__["sdb.sdb_set"](
            _build_machine_uri(vm_["machine"], vm_.get("cwd", ".")), name, __opts__
        )
def get_vm_info(name):
    try:
        vm_ = __utils__["sdb.sdb_get"](_build_sdb_uri(name), __opts__)
    except KeyError:
        raise SaltInvocationError(
            "Probable sdb driver not found. Check your configuration."
        )
    if vm_ is None or "machine" not in vm_:
        raise SaltInvocationError(
            "No Vagrant machine defined for Salt_id {}".format(name)
        )
    return vm_
def get_machine_id(machine, cwd):
    name = __utils__["sdb.sdb_get"](_build_machine_uri(machine, cwd), __opts__)
    return name
def _erase_vm_info(name):
    try:
        vm_ = get_vm_info(name)
        if vm_["machine"]:
            key = _build_machine_uri(vm_["machine"], vm_.get("cwd", "."))
            try:
                __utils__["sdb.sdb_delete"](key, __opts__)
            except KeyError:
                __utils__["sdb.sdb_set"](key, None, __opts__)
    except Exception:  # pylint: disable=broad-except
        pass
    uri = _build_sdb_uri(name)
    try:
        __utils__["sdb.sdb_delete"](uri, __opts__)
    except KeyError:
        __utils__["sdb.sdb_set"](uri, {}, __opts__)
    except Exception:  # pylint: disable=broad-except
        pass
def _vagrant_ssh_config(vm_):
    machine = vm_["machine"]
    log<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.info("requesting vagrant ssh-config for VM %s", machine or "(default)")
    cmd = "vagrant ssh-config {}".format(machine)
    reply = __salt__["cmd.shell"](
        cmd, runas=vm_.get("runas"), cwd=vm_.get("cwd"), ignore_retcode=</b></font>True
    )
    ssh_config = {}
    for line in reply.split("\n"):  # build a dictionary of the text reply
        tokens = line.strip().split()
        if len(tokens) == 2:  # each two-token line becomes a key:value pair
            ssh_config[tokens[0]] = tokens[1]
    log.debug("ssh_config=%s", repr(ssh_config))
    return ssh_config
def version():
    cmd = "vagrant -v"
    return __salt__["cmd.shell"](cmd)
def list_domains():
    vms = []
    cmd = "vagrant global-status"
    reply = __salt__["cmd.shell"](cmd)
    log.debug("---&gt;\n%s", reply)
    for line in reply.split("\n"):  # build a list of the text reply
        tokens = line.strip().split()
        try:
            _ = int(tokens[0], 16)  # valid id numbers are hexadecimal
        except (ValueError, IndexError):
            continue  # skip lines without valid id numbers
        machine = tokens[1]
        cwd = tokens[-1]
        name = get_machine_id(machine, cwd)
        if name:
            vms.append(name)
    return vms
def list_active_vms(cwd=None):
    vms = []
    cmd = "vagrant status"
    reply = __salt__["cmd.shell"](cmd, cwd=cwd)
    log.info("---&gt;\n%s", reply)
    for line in reply.split("\n"):  # build a list of the text reply
        tokens = line.strip().split()
        if len(tokens) &gt; 1:
            if tokens[1] == "running":
                vms.append(tokens[0])
    return vms
def list_inactive_vms(cwd=None):
    vms = []
    cmd = "vagrant status"
    reply = __salt__["cmd.shell"](cmd, cwd=cwd)
    log.info("---&gt;\n%s", reply)
    for line in reply.split("\n"):  # build a list of the text reply
        tokens = line.strip().split()
        if len(tokens) &gt; 1 and tokens[-1].endswith(")"):
            if tokens[1] != "running":
                vms.append(tokens[0])
    return vms
def vm_state(name="", cwd=None):
    if name:
        vm_ = get_vm_info(name)
        machine = vm_["machine"]
        cwd = vm_["cwd"] or cwd  # usually ignore passed-in cwd
    else:
        if not cwd:
            raise SaltInvocationError(
                "Path to Vagranfile must be defined, but cwd={}".format(cwd)
            )
        machine = ""
    info = []
    cmd = "vagrant status {}".format(machine)
    reply = __salt__["cmd.shell"](cmd, cwd)
    log.info("---&gt;\n%s", reply)
    for line in reply.split("\n"):  # build a list of the text reply
        tokens = line.strip().split()
        if len(tokens) &gt; 1 and tokens[-1].endswith(")"):
            try:
                datum = {
                    "machine": tokens[0],
                    "state": " ".join(tokens[1:-1]),
                    "provider": tokens[-1].lstrip("(").rstrip(")"),
                    "name": get_machine_id(tokens[0], cwd),
                }
                info.append(datum)
            except IndexError:
                pass
    return info
def init(
    name,  # Salt_id for created VM
    cwd=None,  # path to find Vagrantfile
    machine="",  # name of machine in Vagrantfile
    runas=None,  # username who owns Vagrant box
    start=False,  # start the machine when initialized
    vagrant_provider="",  # vagrant provider (default=virtualbox)
    vm=None,  # a dictionary of VM configuration settings
):
    vm_ = {} if vm is None else vm.copy()  # passed configuration data
    vm_["name"] = name
    vm_["cwd"] = cwd or vm_.get("cwd")
    if not vm_["cwd"]:
        raise SaltInvocationError(
            'Path to Vagrantfile must be defined by "cwd" argument'
        )
    vm_["machine"] = machine or vm_.get("machine", machine)
    vm_["runas"] = runas or vm_.get("runas", runas)
    vm_["vagrant_provider"] = vagrant_provider or vm_.get("vagrant_provider", "")
    _update_vm_info(name, vm_)
    if start:
        log.debug("Starting VM %s", name)
        ret = _start(name, vm_)
    else:
        ret = "Name {} defined using VM {}".format(name, vm_["machine"] or "(default)")
    return ret
def start(name):
    vm_ = get_vm_info(name)
    return _start(name, vm_)
def _start(
    name, vm_
):  # internal call name, because "start" is a keyword argument to vagrant.init
    try:
        machine = vm_["machine"]
    except KeyError:
        raise SaltInvocationError(
<a name="0"></a>            "No Vagrant machine defined for Salt_id {}".format(name)
        )
    vagrant_provider <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= vm_.get("vagrant_provider", "")
    provider_ = "--provider={}".format(vagrant_provider) if vagrant_provider else ""
    cmd = "vagrant up {} {}".format(machine, provider_)
    ret = __salt__["cmd.run_all"](
        cmd, runas=vm_.get("runas"), cwd=vm_.get(</b></font>"cwd"), output_loglevel="info"
    )
    if machine == "":  # we were called using the default machine
        for line in ret["stdout"].split("\n"):  # find its actual Vagrant name
            if line.startswith("==&gt;"):
                machine = line.split()[1].rstrip(":")
                vm_["machine"] = machine
                _update_vm_info(name, vm_)  # and remember the true name
                break
    if ret["retcode"] == 0:
        return 'Started "{}" using Vagrant machine "{}".'.format(name, machine)
    return False
def shutdown(name):
    return stop(name)
def stop(name):
<a name="5"></a>    vm_ = get_vm_info(name)
    machine = vm_["machine"]
    cmd <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= "vagrant halt {}".format(machine)
    ret = __salt__["cmd.retcode"](cmd, runas=vm_.get("runas"), cwd=vm_.get(</b></font>"cwd"))
    return ret == 0
def pause(name):
<a name="4"></a>    vm_ = get_vm_info(name)
    machine = vm_["machine"]
    cmd <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= "vagrant suspend {}".format(machine)
    ret = __salt__["cmd.retcode"](cmd, runas=vm_.get("runas"), cwd=vm_.get(</b></font>"cwd"))
    return ret == 0
def reboot(name, provision=False):
    vm_ = get_vm_info(name)
<a name="3"></a>    machine = vm_["machine"]
    prov = "--provision" if provision else ""
    cmd <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= "vagrant reload {} {}".format(machine, prov)
    ret = __salt__["cmd.retcode"](cmd, runas=vm_.get("runas"), cwd=vm_.get(</b></font>"cwd"))
    return ret == 0
def destroy(name):
<a name="2"></a>    vm_ = get_vm_info(name)
    machine = vm_["machine"]
    cmd <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= "vagrant destroy -f {}".format(machine)
    ret = __salt__["cmd.run_all"](
        cmd, runas=vm_.get("runas"), cwd=vm_.get("cwd"), output_loglevel=</b></font>"info"
    )
    if ret["retcode"] == 0:
        _erase_vm_info(name)
        return "Destroyed VM {}".format(name)
    return False
def get_ssh_config(name, network_mask="", get_private_key=False):
    r"""
    Retrieve hints of how you might connect to a Vagrant VM.
    :param name: the salt_id of the machine
    :param network_mask: a CIDR mask to search for the VM's address
    :param get_private_key: (default: False) return the key used for ssh login
    :return: a dict of ssh login information for the VM
    CLI Example:
    .. code-block:: bash
        salt &lt;host&gt; vagrant.get_ssh_config &lt;salt_id&gt;
        salt my_laptop vagrant.get_ssh_config quail1 network_mask=10.0.0.0/8 get_private_key=True
    The returned dictionary contains:
    - key_filename:  the name of the private key file on the VM host computer
    - ssh_username:  the username to be used to log in to the VM
    - ssh_host:  the IP address used to log in to the VM.  (This will usually be `127.0.0.1`)
    - ssh_port:  the TCP port used to log in to the VM.  (This will often be `2222`)
    - \[ip_address:\]  (if `network_mask` is defined. see below)
    - \[private_key:\]  (if `get_private_key` is True) the private key for ssh_username
    About `network_mask`:
    Vagrant usually uses a redirected TCP port on its host computer to log in to a VM using ssh.
    This redirected port and its IP address are "ssh_port" and "ssh_host".  The ssh_host is
    usually the localhost (127.0.0.1).
    This makes it impossible for a third machine (such as a salt-cloud master) to contact the VM
    unless the VM has another network interface defined.  You will usually want a bridged network
    defined by having a `config.vm.network "public_network"` statement in your `Vagrantfile`.
    The IP address of the bridged adapter will typically be assigned by DHCP and unknown to you,
    but you should be able to determine what IP network the address will be chosen from.
    If you enter a CIDR network mask, Salt will attempt to find the VM's address for you.
    The host machine will send an "ifconfig" command to the VM (using ssh to `ssh_host`:`ssh_port`)
    and return the IP address of the first interface it can find which matches your mask.
    """
    vm_ = get_vm_info(name)
    ssh_config = _vagrant_ssh_config(vm_)
    try:
        ans = {
            "key_filename": ssh_config["IdentityFile"],
            "ssh_username": ssh_config["User"],
            "ssh_host": ssh_config["HostName"],
            "ssh_port": ssh_config["Port"],
        }
    except KeyError:
        raise CommandExecutionError(
            "Insufficient SSH information to contact VM {}. Is it running?".format(
                vm_.get("machine", "(default)")
            )
        )
    if network_mask:
        command = (
            "ssh -i {IdentityFile} -p {Port} "
            "-oStrictHostKeyChecking={StrictHostKeyChecking} "
            "-oUserKnownHostsFile={UserKnownHostsFile} "
            "-oControlPath=none "
            "{User}@{HostName} ifconfig".format(**ssh_config)
        )
        log.info("Trying ssh -p %(Port)s %(User)s@%(HostName)s ifconfig", ssh_config)
        reply = __salt__["cmd.shell"](command)
        log.info("---&gt;\n%s", reply)
        target_network_range = ipaddress.ip_network(network_mask, strict=False)
        for line in reply.split("\n"):
            try:  # try to find a bridged network address
                tokens = line.replace(
                    "addr:", "", 1
                ).split()  # remove "addr:" if it exists, then split
                found_address = None
                if "inet" in tokens:
                    nxt = tokens.index("inet") + 1
                    found_address = ipaddress.ip_address(tokens[nxt])
                elif "inet6" in tokens:
                    nxt = tokens.index("inet6") + 1
                    found_address = ipaddress.ip_address(tokens[nxt].split("/")[0])
                if found_address in target_network_range:
                    ans["ip_address"] = str(found_address)
                    break  # we have located a good matching address
            except (IndexError, AttributeError, TypeError):
                pass  # all syntax and type errors loop here
        log.info(
            "Network IP address in %s detected as: %s",
            target_network_range,
            ans.get("ip_address", "(not found)"),
        )
    if get_private_key:
        try:
            with salt.utils.files.fopen(ssh_config["IdentityFile"]) as pks:
                ans["private_key"] = salt.utils.stringutils.to_unicode(pks.read())
        except OSError as e:
            raise CommandExecutionError(
                "Error processing Vagrant private key file: {}".format(e)
            )
    return ans
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
