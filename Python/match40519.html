<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_dig.py &amp; test_pkgng_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_dig.py &amp; test_pkgng_1.py
      </h3>
<h1 align="center">
        6.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_dig.py (25.66845%)<th>test_pkgng_1.py (3.8125496%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(148-166)<td><a href="#" name="0">(126-137)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(122-126)<td><a href="#" name="1">(342-352)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(90-108)<td><a href="#" name="2">(103-111)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(68-86)<td><a href="#" name="3">(952-966)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_dig.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.dig as dig
2 from tests.support.mixins import LoaderModuleMockMixin
3 from tests.support.mock import MagicMock, patch
4 from tests.support.unit import TestCase, skipIf
5 _SPF_VALUES = {
6     "dig +short xmission.com TXT": {
7         "pid": 27282,
8         "retcode": 0,
9         "stderr": "",
10         "stdout": '"v=spf1 a mx include:_spf.xmission.com ?all"',
11     },
12     "dig +short _spf.xmission.com TXT": {
13         "pid": 27282,
14         "retcode": 0,
15         "stderr": "",
16         "stdout": '"v=spf1 a mx ip4:198.60.22.0/24 ip4:166.70.13.0/24 ~all"',
17     },
18     "dig +short xmission-redirect.com TXT": {
19         "pid": 27282,
20         "retcode": 0,
21         "stderr": "",
22         "stdout": "v=spf1 redirect=_spf.xmission.com",
23     },
24     "dig +short foo.com TXT": {
25         "pid": 27282,
26         "retcode": 0,
27         "stderr": "",
28         "stdout": "v=spf1 ip4:216.73.93.70/31 ip4:216.73.93.72/31 ~all",
29     },
30 }
31 def _spf_side_effect(key, python_shell=False):
32     return _SPF_VALUES.get(
33         " ".join(key), {"pid": 27310, "retcode": 0, "stderr": "", "stdout": ""}
34     )
35 @skipIf(dig.__virtual__() is False, "Dig must be installed")
36 class DigTestCase(TestCase, LoaderModuleMockMixin):
37     def setup_loader_modules(self):
38         return {dig: {}}
39     def test_check_ip(self):
40         self.assertTrue(dig.check_ip("127.0.0.1"), msg="Not a valid ip address")
41     def test_check_ip_ipv6(self):
42         self.assertTrue(
43             dig.check_ip("1111:2222:3333:4444:5555:6666:7777:8888"),
44             msg="Not a valid ip address",
45         )
46     def test_check_ip_ipv6_valid(self):
47         self.assertTrue(dig.check_ip("2607:fa18:0:3::4"))
48     def test_check_ip_neg(self):
49         self.assertFalse(
50             dig.check_ip("-127.0.0.1"), msg="Did not detect negative value as invalid"
51 <a name="3"></a>        )
52     def test_check_ip_empty(self):
53         self.assertFalse(dig.check_ip(""), msg<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="Did not detect empty value as invalid")
54     def test_a(self):
55         dig_mock = MagicMock(
56             return_value={
57                 "pid": 3656,
58                 "retcode": 0,
59                 "stderr": "",
60                 "stdout": (
61                     "74.125.193.104\n"
62                     "74.125.193.105\n"
63                     "74.125.193.99\n"
64                     "74.125.193.106\n"
65                     "74.125.193.103\n"
66                     "74.125.193.147"
67                 ),
68             }
69         )
70         with patch.dict(dig.__salt__, {"cmd.run_all"</b></font>: dig_mock}):
71 <a name="2"></a>            self.assertEqual(
72                 dig.A("www.google.com"),
73                 [
74                     "<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>74.125.193.104",
75                     "74.125.193.105",
76                     "74.125.193.99",
77                     "74.125.193.106",
78                     "74.125.193.103",
79                     "74.125.193.147",
80                 ],
81             )
82     def test_aaaa(self):
83         dig_mock = MagicMock(
84             return_value={
85                 "pid": 25451,
86                 "retcode": 0,
87                 "stderr": "",
88                 "stdout": "2607:f8b0:400f:801::1014",
89             }
90         )
91         with patch.dict(dig.__salt__, {"cmd.run_all"</b></font>: dig_mock}):
92             self.assertEqual(dig.AAAA("www.google.com"), ["2607:f8b0:400f:801::1014"])
93     def test_ns(self):
94         with patch("salt.modules.dig.A", MagicMock(return_value=["ns4.google.com."])):
95             dig_mock = MagicMock(
96                 return_value={
97                     "pid": 26136,
98                     "retcode": 0,
99                     "stderr": "",
100                     "stdout": "ns4.google.com.",
101 <a name="1"></a>                }
102             )
103             with patch.dict(dig.__salt__, {"cmd.run_all": dig_mock}):
104                 self.assertEqual(dig.NS(<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"google.com"), ["ns4.google.com."])
105     def test_spf(self):
106         dig_mock = MagicMock(side_effect=_spf_side_effect)
107         with patch.dict(dig.__salt__, {"cmd.run_all"</b></font>: dig_mock}):
108             self.assertEqual(dig.SPF("foo.com"), ["216.73.93.70/31", "216.73.93.72/31"])
109     def test_spf_redir(self):
110         dig_mock = MagicMock(side_effect=_spf_side_effect)
111         with patch.dict(dig.__salt__, {"cmd.run_all": dig_mock}):
112             self.assertEqual(
113                 dig.SPF("xmission-redirect.com"), ["198.60.22.0/24", "166.70.13.0/24"]
114             )
115     def test_spf_include(self):
116 <a name="0"></a>        dig_mock = MagicMock(side_effect=_spf_side_effect)
117         with patch.dict(dig.__salt__, {"cmd.run_all": dig_mock}):
118             self.assertEqual(
119                 dig.SPF("xmission.com"), ["<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>198.60.22.0/24", "166.70.13.0/24"]
120             )
121     def test_mx(self):
122         dig_mock = MagicMock(
123             return_value={
124                 "pid": 27780,
125                 "retcode": 0,
126                 "stderr": "",
127                 "stdout": (
128                     "10 aspmx.l.google.com.\n"
129                     "20 alt1.aspmx.l.google.com.\n"
130                     "40 alt3.aspmx.l.google.com.\n"
131                     "50 alt4.aspmx.l.google.com.\n"
132                     "30 alt2.aspmx.l.google.com."
133                 ),
134             }
135         )
136         with patch.dict(dig.__salt__, {"cmd.run_all"</b></font>: dig_mock}):
137             self.assertEqual(
138                 dig.MX("google.com"),
139                 [
140                     ["10", "aspmx.l.google.com."],
141                     ["20", "alt1.aspmx.l.google.com."],
142                     ["40", "alt3.aspmx.l.google.com."],
143                     ["50", "alt4.aspmx.l.google.com."],
144                     ["30", "alt2.aspmx.l.google.com."],
145                 ],
146             )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_pkgng_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import textwrap
2 import pytest
3 import salt.modules.pkgng as pkgng
4 from salt.utils.odict import OrderedDict
5 from tests.support.mock import MagicMock, patch
6 @pytest.fixture
7 def configure_loader_modules():
8     return {pkgng: {}}
9 @pytest.fixture
10 def pkgs():
11     return [
12         {"openvpn": "2.4.8_2"},
13         {"openvpn": "2.4.8_2", "gettext-runtime": "0.20.1", "p5-Mojolicious": "8.40"},
14     ]
15 def test_latest_version(pkgs):
16     pkgs_mock = MagicMock(side_effect=pkgs)
17     search_cmd = MagicMock(return_value="bash-5.1.4")
18     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
19         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
20             result = pkgng.latest_version("bash")
21             search_cmd.assert_called_with(
22                 ["pkg", "search", "-eqS", "name", "-U", "bash"],
23                 output_loglevel="trace",
24                 python_shell=False,
25             )
26             assert result == "5.1.4"
27 def test_latest_version_origin(pkgs):
28     pkgs_mock = MagicMock(side_effect=pkgs)
29     search_cmd = MagicMock(return_value="bash-5.1.4_2")
30     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
31         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
32             result = pkgng.latest_version("shells/bash")
33             search_cmd.assert_called_with(
34                 ["pkg", "search", "-eqS", "origin", "-U", "shells/bash"],
35                 output_loglevel="trace",
36                 python_shell=False,
37             )
38             assert result == "5.1.4_2"
39 def test_latest_version_outofdatedate(pkgs):
40     pkgs_mock = MagicMock(side_effect=pkgs)
41     search_cmd = MagicMock(return_value="openvpn-2.4.8_3")
42     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
43         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
44             result = pkgng.latest_version("openvpn")
45             search_cmd.assert_called_with(
46                 ["pkg", "search", "-eqS", "name", "-U", "openvpn"],
47                 output_loglevel="trace",
48                 python_shell=False,
49             )
50             assert result == "2.4.8_3"
51 def test_latest_version_unavailable(pkgs):
52     pkgs_mock = MagicMock(side_effect=pkgs)
53     search_cmd = MagicMock(return_value="")
54     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
55         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
56             result = pkgng.latest_version("does_not_exist")
57             search_cmd.assert_called_with(
58                 ["pkg", "search", "-eqS", "name", "-U", "does_not_exist"],
59                 output_loglevel="trace",
60                 python_shell=False,
61             )
62 def test_latest_version_uptodate(pkgs):
63     pkgs_mock = MagicMock(side_effect=pkgs)
64     search_cmd = MagicMock(return_value="openvpn-2.4.8_2")
65     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
66         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
67             result = pkgng.latest_version("openvpn")
68             search_cmd.assert_called_with(
69                 ["pkg", "search", "-eqS", "name", "-U", "openvpn"],
70 <a name="2"></a>                output_loglevel="trace",
71                 python_shell=False,
72             )
73             as<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>sert result == ""
74 def test_lock():
75     lock_cmd = MagicMock(return_value={"stdout": "pkga-1.0\npkgb-2.0\n", "retcode": 0})
76     with patch.dict(pkgng.__salt__, {"cmd.run_all"</b></font>: lock_cmd}):
77         result = pkgng.lock("pkga")
78         assert result
79         lock_cmd.assert_called_with(
80             ["pkg", "lock", "-y", "--quiet", "--show-locked", "pkga"],
81             output_loglevel="trace",
82             python_shell=False,
83         )
84         result = pkgng.lock("dummy")
85         assert not result
86 <a name="0"></a>        lock_cmd.assert_called_with(
87             ["pkg", "lock", "-y", "--quiet", "--show-locked", "dummy"],
88             output_loglevel="trace",
89             python_shell=<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>False,
90         )
91 def test_unlock():
92     unlock_cmd = MagicMock(
93         return_value={"stdout": "pkga-1.0\npkgb-2.0\n", "retcode": 0}
94     )
95     with patch.dict(pkgng.__salt__, {"cmd.run_all"</b></font>: unlock_cmd}):
96         result = pkgng.unlock("pkga")
97         assert not result
98         unlock_cmd.assert_called_with(
99             ["pkg", "unlock", "-y", "--quiet", "--show-locked", "pkga"],
100             output_loglevel="trace",
101             python_shell=False,
102         )
103         result = pkgng.unlock("dummy")
104         assert result
105         unlock_cmd.assert_called_with(
106             ["pkg", "unlock", "-y", "--quiet", "--show-locked", "dummy"],
107             output_loglevel="trace",
108             python_shell=False,
109         )
110 def test_locked():
111     lock_cmd = MagicMock(return_value={"stdout": "pkga-1.0\npkgb-2.0\n", "retcode": 0})
112     with patch.dict(pkgng.__salt__, {"cmd.run_all": lock_cmd}):
113         result = pkgng.locked("pkga")
114         assert result
115         lock_cmd.assert_called_with(
116             ["pkg", "lock", "-y", "--quiet", "--show-locked"],
117             output_loglevel="trace",
118             python_shell=False,
119         )
120         result = pkgng.locked("dummy")
121         assert not result
122         lock_cmd.assert_called_with(
123             ["pkg", "lock", "-y", "--quiet", "--show-locked"],
124             output_loglevel="trace",
125             python_shell=False,
126         )
127 def test_list_upgrades_present():
128     pkg_cmd = MagicMock(
129         return_value=textwrap.dedent(
130         )
131     )
132     with patch.dict(pkgng.__salt__, {"cmd.run_stdout": pkg_cmd}):
133         result = pkgng.list_upgrades(refresh=False)
134         assert result == {"pkga": "1.1", "pkgb": "2.1", "pkgc": "3.1", "pkgd": "4.1"}
135         pkg_cmd.assert_called_with(
136             ["pkg", "upgrade", "--dry-run", "--quiet", "--no-repo-update"],
137             output_loglevel="trace",
138             python_shell=False,
139             ignore_retcode=True,
140         )
141 def test_list_upgrades_absent():
142     pkg_cmd = MagicMock(return_value="")
143     with patch.dict(pkgng.__salt__, {"cmd.run_stdout": pkg_cmd}):
144         result = pkgng.list_upgrades(refresh=False)
145         assert result == {}
146         pkg_cmd.assert_called_with(
147             ["pkg", "upgrade", "--dry-run", "--quiet", "--no-repo-update"],
148             output_loglevel="trace",
149             python_shell=False,
150             ignore_retcode=True,
151         )
152 def test_upgrade_without_fromrepo(pkgs):
153     pkg_cmd = MagicMock(return_value={"retcode": 0})
154     pkgs_mock = MagicMock(side_effect=pkgs)
155     with patch.dict(pkgng.__salt__, {"cmd.run_all": pkg_cmd}):
156         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
157             result = pkgng.upgrade()
158             expected = {
159                 "gettext-runtime": {"new": "0.20.1", "old": ""},
160                 "p5-Mojolicious": {"new": "8.40", "old": ""},
161             }
162             assert result == expected
163             pkg_cmd.assert_called_with(
164                 ["pkg", "upgrade", "-y"],
165                 output_loglevel="trace",
166                 python_shell=False,
167             )
168 def test_upgrade_with_fromrepo(pkgs):
169     pkg_cmd = MagicMock(return_value={"retcode": 0})
170     pkgs_mock = MagicMock(side_effect=pkgs)
171     with patch.dict(pkgng.__salt__, {"cmd.run_all": pkg_cmd}):
172         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
173             result = pkgng.upgrade(fromrepo="FreeBSD")
174             expected = {
175                 "gettext-runtime": {"new": "0.20.1", "old": ""},
176                 "p5-Mojolicious": {"new": "8.40", "old": ""},
177             }
178             assert result == expected
179             pkg_cmd.assert_called_with(
180                 ["pkg", "upgrade", "-y", "--repository", "FreeBSD"],
181                 output_loglevel="trace",
182                 python_shell=False,
183             )
184 def test_upgrade_with_fetchonly(pkgs):
185     pkg_cmd = MagicMock(return_value={"retcode": 0})
186     pkgs_mock = MagicMock(side_effect=pkgs)
187     with patch.dict(pkgng.__salt__, {"cmd.run_all": pkg_cmd}):
188         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
189             result = pkgng.upgrade(fetchonly=True)
190             expected = {
191                 "gettext-runtime": {"new": "0.20.1", "old": ""},
192                 "p5-Mojolicious": {"new": "8.40", "old": ""},
193             }
194             assert result == expected
195             pkg_cmd.assert_called_with(
196                 ["pkg", "upgrade", "-Fy"],
197                 output_loglevel="trace",
198                 python_shell=False,
199             )
200 def test_upgrade_with_local(pkgs):
201     pkg_cmd = MagicMock(return_value={"retcode": 0})
202     pkgs_mock = MagicMock(side_effect=pkgs)
203     with patch.dict(pkgng.__salt__, {"cmd.run_all": pkg_cmd}):
204         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
205             result = pkgng.upgrade(local=True)
206             expected = {
207                 "gettext-runtime": {"new": "0.20.1", "old": ""},
208                 "p5-Mojolicious": {"new": "8.40", "old": ""},
209             }
210             assert result == expected
211 <a name="1"></a>            pkg_cmd.assert_called_with(
212                 ["pkg", "upgrade", "-Uy"],
213                 output_loglevel="trace",
214                 python_shell=<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>False,
215             )
216 def test_stats_with_local():
217     pkg_cmd = MagicMock(return_value="")
218     with patch.dict(pkgng.__salt__, {"cmd.run"</b></font>: pkg_cmd}):
219         result = pkgng.stats(local=True)
220         assert result == []
221         pkg_cmd.assert_called_with(
222             ["pkg", "stats", "-l"],
223             output_loglevel="trace",
224             python_shell=False,
225         )
226 def test_stats_with_remote():
227     pkg_cmd = MagicMock(return_value="")
228     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
229         result = pkgng.stats(remote=True)
230         assert result == []
231         pkg_cmd.assert_called_with(
232             ["pkg", "stats", "-r"],
233             output_loglevel="trace",
234             python_shell=False,
235         )
236 def test_stats_with_bytes_remote():
237     pkg_cmd = MagicMock(return_value="")
238     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
239         result = pkgng.stats(remote=True, bytes=True)
240         assert result == []
241         pkg_cmd.assert_called_with(
242             ["pkg", "stats", "-rb"],
243             output_loglevel="trace",
244             python_shell=False,
245         )
246 def test_stats_with_bytes_local():
247     pkg_cmd = MagicMock(return_value="")
248     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
249         result = pkgng.stats(local=True, bytes=True)
250         assert result == []
251         pkg_cmd.assert_called_with(
252             ["pkg", "stats", "-lb"],
253             output_loglevel="trace",
254             python_shell=False,
255         )
256 def test_install_without_args(pkgs):
257     parsed_targets = (
258         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
259         "repository",
260     )
261     pkg_cmd = MagicMock(return_value={"retcode": 0})
262     pkgs_mock = MagicMock(side_effect=pkgs)
263     patches = {
264         "cmd.run_all": pkg_cmd,
265         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
266     }
267     with patch.dict(pkgng.__salt__, patches):
268         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
269             added = pkgng.install()
270             expected = {
271                 "gettext-runtime": {"new": "0.20.1", "old": ""},
272                 "p5-Mojolicious": {"new": "8.40", "old": ""},
273             }
274             assert added == expected
275             pkg_cmd.assert_called_with(
276                 ["pkg", "install", "-y", "gettext-runtime", "p5-Mojolicious"],
277                 output_loglevel="trace",
278                 python_shell=False,
279                 env={},
280             )
281 def test_install_with_local(pkgs):
282     parsed_targets = (
283         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
284         "repository",
285     )
286     pkg_cmd = MagicMock(return_value={"retcode": 0})
287     pkgs_mock = MagicMock(side_effect=pkgs)
288     patches = {
289         "cmd.run_all": pkg_cmd,
290         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
291     }
292     with patch.dict(pkgng.__salt__, patches):
293         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
294             added = pkgng.install(local=True)
295             expected = {
296                 "gettext-runtime": {"new": "0.20.1", "old": ""},
297                 "p5-Mojolicious": {"new": "8.40", "old": ""},
298             }
299             assert added == expected
300             pkg_cmd.assert_called_with(
301                 ["pkg", "install", "-yU", "gettext-runtime", "p5-Mojolicious"],
302                 output_loglevel="trace",
303                 python_shell=False,
304                 env={},
305             )
306 def test_install_with_fromrepo(pkgs):
307     parsed_targets = (
308         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
309         "repository",
310     )
311     pkg_cmd = MagicMock(return_value={"retcode": 0})
312     pkgs_mock = MagicMock(side_effect=pkgs)
313     patches = {
314         "cmd.run_all": pkg_cmd,
315         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
316     }
317     with patch.dict(pkgng.__salt__, patches):
318         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
319             added = pkgng.install(fromrepo="FreeBSD")
320             expected = {
321                 "gettext-runtime": {"new": "0.20.1", "old": ""},
322                 "p5-Mojolicious": {"new": "8.40", "old": ""},
323             }
324             assert added == expected
325             pkg_cmd.assert_called_with(
326                 [
327                     "pkg",
328                     "install",
329                     "-r",
330                     "FreeBSD",
331                     "-y",
332                     "gettext-runtime",
333                     "p5-Mojolicious",
334                 ],
335                 output_loglevel="trace",
336                 python_shell=False,
337                 env={},
338             )
339 def test_install_with_glob(pkgs):
340     parsed_targets = (
341         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
342         "repository",
343     )
344     pkg_cmd = MagicMock(return_value={"retcode": 0})
345     pkgs_mock = MagicMock(side_effect=pkgs)
346     patches = {
347         "cmd.run_all": pkg_cmd,
348         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
349     }
350     with patch.dict(pkgng.__salt__, patches):
351         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
352             added = pkgng.install(glob=True)
353             expected = {
354                 "gettext-runtime": {"new": "0.20.1", "old": ""},
355                 "p5-Mojolicious": {"new": "8.40", "old": ""},
356             }
357             assert added == expected
358             pkg_cmd.assert_called_with(
359                 ["pkg", "install", "-yg", "gettext-runtime", "p5-Mojolicious"],
360                 output_loglevel="trace",
361                 python_shell=False,
362                 env={},
363             )
364 def test_install_with_reinstall_requires(pkgs):
365     parsed_targets = (
366         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
367         "repository",
368     )
369     pkg_cmd = MagicMock(return_value={"retcode": 0})
370     pkgs_mock = MagicMock(side_effect=pkgs)
371     patches = {
372         "cmd.run_all": pkg_cmd,
373         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
374     }
375     with patch.dict(pkgng.__salt__, patches):
376         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
377             added = pkgng.install(reinstall_requires=True, force=True)
378             expected = {
379                 "gettext-runtime": {"new": "0.20.1", "old": ""},
380                 "p5-Mojolicious": {"new": "8.40", "old": ""},
381             }
382             assert added == expected
383             pkg_cmd.assert_called_with(
384                 ["pkg", "install", "-yfR", "gettext-runtime", "p5-Mojolicious"],
385                 output_loglevel="trace",
386                 python_shell=False,
387                 env={},
388             )
389 def test_install_with_regex(pkgs):
390     parsed_targets = (
391         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
392         "repository",
393     )
394     pkg_cmd = MagicMock(return_value={"retcode": 0})
395     pkgs_mock = MagicMock(side_effect=pkgs)
396     patches = {
397         "cmd.run_all": pkg_cmd,
398         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
399     }
400     with patch.dict(pkgng.__salt__, patches):
401         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
402             added = pkgng.install(regex=True)
403             expected = {
404                 "gettext-runtime": {"new": "0.20.1", "old": ""},
405                 "p5-Mojolicious": {"new": "8.40", "old": ""},
406             }
407             assert added == expected
408             pkg_cmd.assert_called_with(
409                 ["pkg", "install", "-yx", "gettext-runtime", "p5-Mojolicious"],
410                 output_loglevel="trace",
411                 python_shell=False,
412                 env={},
413             )
414 def test_install_with_batch(pkgs):
415     parsed_targets = (
416         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
417         "repository",
418     )
419     pkg_cmd = MagicMock(return_value={"retcode": 0})
420     pkgs_mock = MagicMock(side_effect=pkgs)
421     patches = {
422         "cmd.run_all": pkg_cmd,
423         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
424     }
425     with patch.dict(pkgng.__salt__, patches):
426         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
427             added = pkgng.install(batch=True)
428             expected = {
429                 "gettext-runtime": {"new": "0.20.1", "old": ""},
430                 "p5-Mojolicious": {"new": "8.40", "old": ""},
431             }
432             assert added == expected
433             pkg_cmd.assert_called_with(
434                 ["pkg", "install", "-y", "gettext-runtime", "p5-Mojolicious"],
435                 output_loglevel="trace",
436                 python_shell=False,
437                 env={"BATCH": "true", "ASSUME_ALWAYS_YES": "YES"},
438             )
439 def test_install_with_pcre(pkgs):
440     parsed_targets = (
441         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
442         "repository",
443     )
444     pkg_cmd = MagicMock(return_value={"retcode": 0})
445     pkgs_mock = MagicMock(side_effect=pkgs)
446     patches = {
447         "cmd.run_all": pkg_cmd,
448         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
449     }
450     with patch.dict(pkgng.__salt__, patches):
451         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
452             added = pkgng.install(pcre=True)
453             expected = {
454                 "gettext-runtime": {"new": "0.20.1", "old": ""},
455                 "p5-Mojolicious": {"new": "8.40", "old": ""},
456             }
457             assert added == expected
458             pkg_cmd.assert_called_with(
459                 ["pkg", "install", "-yX", "gettext-runtime", "p5-Mojolicious"],
460                 output_loglevel="trace",
461                 python_shell=False,
462                 env={},
463             )
464 def test_install_with_orphan(pkgs):
465     parsed_targets = (
466         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
467         "repository",
468     )
469     pkg_cmd = MagicMock(return_value={"retcode": 0})
470     pkgs_mock = MagicMock(side_effect=pkgs)
471     patches = {
472         "cmd.run_all": pkg_cmd,
473         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
474     }
475     with patch.dict(pkgng.__salt__, patches):
476         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
477             added = pkgng.install(orphan=True)
478             expected = {
479                 "gettext-runtime": {"new": "0.20.1", "old": ""},
480                 "p5-Mojolicious": {"new": "8.40", "old": ""},
481             }
482             assert added == expected
483             pkg_cmd.assert_called_with(
484                 ["pkg", "install", "-yA", "gettext-runtime", "p5-Mojolicious"],
485                 output_loglevel="trace",
486                 python_shell=False,
487                 env={},
488             )
489 def test_check_depends():
490     pkg_cmd = MagicMock(return_value="")
491     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
492         result = pkgng.check(depends=True)
493         assert result == ""
494         pkg_cmd.assert_called_with(
495             ["pkg", "check", "-dy"],
496             output_loglevel="trace",
497             python_shell=False,
498         )
499 def test_check_checksum():
500     pkg_cmd = MagicMock(return_value="")
501     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
502         result = pkgng.check(checksum=True)
503         assert result == ""
504         pkg_cmd.assert_called_with(
505             ["pkg", "check", "-s"],
506             output_loglevel="trace",
507             python_shell=False,
508         )
509 def test_check_recompute():
510     pkg_cmd = MagicMock(return_value="")
511     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
512         result = pkgng.check(recompute=True)
513         assert result == ""
514         pkg_cmd.assert_called_with(
515             ["pkg", "check", "-r"],
516             output_loglevel="trace",
517             python_shell=False,
518         )
519 def test_check_checklibs():
520     pkg_cmd = MagicMock(return_value="")
521     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
522         result = pkgng.check(checklibs=True)
523         assert result == ""
524         pkg_cmd.assert_called_with(
525             ["pkg", "check", "-B"],
526             output_loglevel="trace",
527             python_shell=False,
528         )
529 def test_autoremove_with_dryrun():
530     pkg_cmd = MagicMock(return_value="")
531     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
532         result = pkgng.autoremove(dryrun=True)
533         assert result == ""
534         pkg_cmd.assert_called_with(
535             ["pkg", "autoremove", "-n"],
536             output_loglevel="trace",
537             python_shell=False,
538         )
539 def test_autoremove():
540     pkg_cmd = MagicMock(return_value="")
541     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
542         result = pkgng.autoremove()
543         assert result == ""
544         pkg_cmd.assert_called_with(
545             ["pkg", "autoremove", "-y"],
546             output_loglevel="trace",
547             python_shell=False,
548         )
549 def test_audit():
550     pkg_cmd = MagicMock(return_value="")
551     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
552         result = pkgng.audit()
553         assert result == ""
554         pkg_cmd.assert_called_with(
555             ["pkg", "audit", "-F"],
556             output_loglevel="trace",
557             python_shell=False,
558         )
559 def test_version():
560     version = "2.0.6"
561     mock = MagicMock(return_value=version)
562     with patch.dict(pkgng.__salt__, {"pkg_resource.version": mock}):
563         assert pkgng.version(*["mutt"]) == version
564         assert not pkgng.version(*["mutt"]) == "2.0.10"
565 def test_refresh_db_without_forced_flag():
566     pkg_cmd = MagicMock(return_value=0)
567     with patch("salt.utils.pkg.clear_rtag", MagicMock()):
568         with patch.dict(pkgng.__salt__, {"cmd.retcode": pkg_cmd}):
569             result = pkgng.refresh_db()
570             assert result is True
571             pkg_cmd.assert_called_with(
572                 ["pkg", "update"],
573                 python_shell=False,
574             )
575 def test_refresh_db_with_forced_flag():
576     pkg_cmd = MagicMock(return_value=0)
577     with patch("salt.utils.pkg.clear_rtag", MagicMock()):
578         with patch.dict(pkgng.__salt__, {"cmd.retcode": pkg_cmd}):
579             result = pkgng.refresh_db(force=True)
580             assert result is True
581             pkg_cmd.assert_called_with(
582                 ["pkg", "update", "-f"],
583                 python_shell=False,
584             )
585 def test_fetch_with_default_flag():
586     targets = "mutt"
587     pkg_cmd = MagicMock(return_value=targets)
588     patches = {
589         "cmd.run": pkg_cmd,
590         "pkg_resource.stringify": MagicMock(),
591         "pkg_resource.parse_targets": MagicMock(return_value=targets),
592     }
593     with patch.dict(pkgng.__salt__, patches):
594         pkgs = pkgng.fetch(targets)
595         assert pkgs == targets
596     pkg_cmd.assert_called_once_with(
597         ["pkg", "fetch", "-y", "-g", "mutt"],
598         output_loglevel="trace",
599         python_shell=False,
600     )
601 def test_fetch_with_dependency_flag():
602     targets = "mutt"
603     pkg_cmd = MagicMock(return_value=targets)
604     patches = {
605         "cmd.run": pkg_cmd,
606         "pkg_resource.stringify": MagicMock(),
607         "pkg_resource.parse_targets": MagicMock(return_value=targets),
608     }
609     with patch.dict(pkgng.__salt__, patches):
610         pkgs = pkgng.fetch(targets, depends=True)
611         assert pkgs == targets
612     pkg_cmd.assert_called_once_with(
613         ["pkg", "fetch", "-y", "-gd", "mutt"],
614         output_loglevel="trace",
615         python_shell=False,
616     )
617 def test_fetch_with_regex_flag():
618     targets = "mutt"
619     pkg_cmd = MagicMock(return_value=targets)
620     patches = {
621         "cmd.run": pkg_cmd,
622         "pkg_resource.stringify": MagicMock(),
623         "pkg_resource.parse_targets": MagicMock(return_value=targets),
624     }
625     with patch.dict(pkgng.__salt__, patches):
626         pkgs = pkgng.fetch(targets, regex=True)
627         assert pkgs == targets
628     pkg_cmd.assert_called_once_with(
629         ["pkg", "fetch", "-y", "-gx", "mutt"],
630         output_loglevel="trace",
631         python_shell=False,
632     )
633 def test_fetch_with_fromrepo_flag():
634     targets = "mutt"
635     pkg_cmd = MagicMock(return_value=targets)
636     patches = {
637         "cmd.run": pkg_cmd,
638         "pkg_resource.stringify": MagicMock(),
639         "pkg_resource.parse_targets": MagicMock(return_value=targets),
640     }
641     with patch.dict(pkgng.__salt__, patches):
642         pkgs = pkgng.fetch(targets, fromrepo="FreeBSD-poudriere")
643         assert pkgs == targets
644     pkg_cmd.assert_called_once_with(
645         ["pkg", "fetch", "-y", "-r", "FreeBSD-poudriere", "-g", "mutt"],
646         output_loglevel="trace",
647         python_shell=False,
648     )
649 def test_fetch_with_localcache_flag():
650     targets = "mutt"
651     pkg_cmd = MagicMock(return_value=targets)
652     patches = {
653         "cmd.run": pkg_cmd,
654         "pkg_resource.stringify": MagicMock(),
655         "pkg_resource.parse_targets": MagicMock(return_value=targets),
656     }
657     with patch.dict(pkgng.__salt__, patches):
658         pkgs = pkgng.fetch(targets, local=True)
659         assert pkgs == targets
660 <a name="3"></a>    pkg_cmd.assert_called_once_with(
661         ["pkg", "fetch", "-y", "-gL", "mutt"],
662         output_loglevel="trace",
663         python_shell<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=False,
664     )
665 def test_which_with_default_flags():
666     which_cmd = MagicMock(
667         return_value={
668             "stdout": "/usr/local/bin/mutt was installed by package mutt-2.0.6",
669             "retcode": 0,
670         }
671     )
672     with patch.dict(pkgng.__salt__, {"cmd.run"</b></font>: which_cmd}):
673         result = pkgng.which("/usr/local/bin/mutt")
674         assert result
675         which_cmd.assert_called_with(
676             ["pkg", "which", "/usr/local/bin/mutt"],
677             output_loglevel="trace",
678             python_shell=False,
679         )
680 def test_which_with_origin_flag():
681     which_cmd = MagicMock(
682         return_value={
683             "stdout": "/usr/local/bin/mutt was installed by package mail/mutt",
684             "retcode": 0,
685         }
686     )
687     with patch.dict(pkgng.__salt__, {"cmd.run": which_cmd}):
688         result = pkgng.which("/usr/local/bin/mutt", origin=True)
689         assert result
690         which_cmd.assert_called_with(
691             ["pkg", "which", "-o", "/usr/local/bin/mutt"],
692             output_loglevel="trace",
693             python_shell=False,
694         )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
