<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_dig.py &amp; test_pkgng_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_dig.py &amp; test_pkgng_1.py
      </h3>
<h1 align="center">
        6.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_dig.py (25.66845%)<th>test_pkgng_1.py (3.8125496%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(148-166)<td><a href="#" name="0">(126-137)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(122-126)<td><a href="#" name="1">(342-352)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(90-108)<td><a href="#" name="2">(103-111)</a><td align="center"><font color="#ff0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(68-86)<td><a href="#" name="3">(952-966)</a><td align="center"><font color="#ff0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_dig.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.dig as dig
2 from tests.support.mixins import LoaderModuleMockMixin
3 from tests.support.mock import MagicMock, patch
4 from tests.support.unit import TestCase, skipIf
5 _SPF_VALUES = {
6     "dig +short xmission.com TXT": {
7         "pid": 27282,
8         "retcode": 0,
9         "stderr": "",
10         "stdout": '"v=spf1 a mx include:_spf.xmission.com ?all"',
11     },
12     "dig +short _spf.xmission.com TXT": {
13         "pid": 27282,
14         "retcode": 0,
15         "stderr": "",
16         "stdout": '"v=spf1 a mx ip4:198.60.22.0/24 ip4:166.70.13.0/24 ~all"',
17     },
18     "dig +short xmission-redirect.com TXT": {
19         "pid": 27282,
20         "retcode": 0,
21         "stderr": "",
22         "stdout": "v=spf1 redirect=_spf.xmission.com",
23     },
24     "dig +short foo.com TXT": {
25         "pid": 27282,
26         "retcode": 0,
27         "stderr": "",
28         "stdout": "v=spf1 ip4:216.73.93.70/31 ip4:216.73.93.72/31 ~all",
29     },
30 }
31 def _spf_side_effect(key, python_shell=False):
32     return _SPF_VALUES.get(
33         " ".join(key), {"pid": 27310, "retcode": 0, "stderr": "", "stdout": ""}
34     )
35 @skipIf(dig.__virtual__() is False, "Dig must be installed")
36 class DigTestCase(TestCase, LoaderModuleMockMixin):
37     def setup_loader_modules(self):
38         return {dig: {}}
39     def test_check_ip(self):
40         self.assertTrue(dig.check_ip("127.0.0.1"), msg="Not a valid ip address")
41     def test_check_ip_ipv6(self):
42         self.assertTrue(
43             dig.check_ip("1111:2222:3333:4444:5555:6666:7777:8888"),
44             msg="Not a valid ip address",
45         )
46     def test_check_ip_ipv6_valid(self):
47         self.assertTrue(dig.check_ip("2607:fa18:0:3::4"))
48     def test_check_ip_neg(self):
49         self.assertFalse(
50             dig.check_ip("-127.0.0.1"), msg="Did not detect negative value as invalid"
51     def test_check_ip_empty(self):
52         self.assertFalse(dig.check_ip(""), msg<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>="Did not detect empty value as invalid")
53     def test_a(self):
54         dig_mock = MagicMock(
55             return_value={
56                 "pid": 3656,
57                 "retcode": 0,
58                 "stderr": "",
59                 "stdout": (
60                     "74.125.193.104\n"
61                     "74.125.193.105\n"
62                     "74.125.193.99\n"
63                     "74.125.193.106\n"
64                     "74.125.193.103\n"
65                     "74.125.193.147"
66                 ),
67             }
68         )
69         with patch.dict(dig.__salt__, {"cmd.run_all"</b></font>: dig_mock}):
70                 dig.A("www.google.com"),
71                 [
72                     "<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>74.125.193.104",
73                     "74.125.193.105",
74                     "74.125.193.99",
75                     "74.125.193.106",
76                     "74.125.193.103",
77                     "74.125.193.147",
78                 ],
79             )
80     def test_aaaa(self):
81         dig_mock = MagicMock(
82             return_value={
83                 "pid": 25451,
84                 "retcode": 0,
85                 "stderr": "",
86                 "stdout": "2607:f8b0:400f:801::1014",
87             }
88         )
89         with patch.dict(dig.__salt__, {"cmd.run_all"</b></font>: dig_mock}):
90             self.assertEqual(dig.AAAA("www.google.com"), ["2607:f8b0:400f:801::1014"])
91     def test_ns(self):
92         with patch("salt.modules.dig.A", MagicMock(return_value=["ns4.google.com."])):
93             dig_mock = MagicMock(
94                 return_value={
95                     "pid": 26136,
96                     "retcode": 0,
97                     "stderr": "",
98                     "stdout": "ns4.google.com.",
99             )
100             with patch.dict(dig.__salt__, {"cmd.run_all": dig_mock}):
101                 self.assertEqual(dig.NS(<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"google.com"), ["ns4.google.com."])
102     def test_spf(self):
103         dig_mock = MagicMock(side_effect=_spf_side_effect)
104         with patch.dict(dig.__salt__, {"cmd.run_all"</b></font>: dig_mock}):
105             self.assertEqual(dig.SPF("foo.com"), ["216.73.93.70/31", "216.73.93.72/31"])
106     def test_spf_redir(self):
107         dig_mock = MagicMock(side_effect=_spf_side_effect)
108         with patch.dict(dig.__salt__, {"cmd.run_all": dig_mock}):
109             self.assertEqual(
110                 dig.SPF("xmission-redirect.com"), ["198.60.22.0/24", "166.70.13.0/24"]
111             )
112     def test_spf_include(self):
113         with patch.dict(dig.__salt__, {"cmd.run_all": dig_mock}):
114             self.assertEqual(
115                 dig.SPF("xmission.com"), ["<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>198.60.22.0/24", "166.70.13.0/24"]
116             )
117     def test_mx(self):
118         dig_mock = MagicMock(
119             return_value={
120                 "pid": 27780,
121                 "retcode": 0,
122                 "stderr": "",
123                 "stdout": (
124                     "10 aspmx.l.google.com.\n"
125                     "20 alt1.aspmx.l.google.com.\n"
126                     "40 alt3.aspmx.l.google.com.\n"
127                     "50 alt4.aspmx.l.google.com.\n"
128                     "30 alt2.aspmx.l.google.com."
129                 ),
130             }
131         )
132         with patch.dict(dig.__salt__, {"cmd.run_all"</b></font>: dig_mock}):
133             self.assertEqual(
134                 dig.MX("google.com"),
135                 [
136                     ["10", "aspmx.l.google.com."],
137                     ["20", "alt1.aspmx.l.google.com."],
138                     ["40", "alt3.aspmx.l.google.com."],
139                     ["50", "alt4.aspmx.l.google.com."],
140                     ["30", "alt2.aspmx.l.google.com."],
141                 ],
142             )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_pkgng_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import textwrap
2 import pytest
3 import salt.modules.pkgng as pkgng
4 from salt.utils.odict import OrderedDict
5 from tests.support.mock import MagicMock, patch
6 @pytest.fixture
7 def configure_loader_modules():
8     return {pkgng: {}}
9 @pytest.fixture
10 def pkgs():
11     return [
12         {"openvpn": "2.4.8_2"},
13         {"openvpn": "2.4.8_2", "gettext-runtime": "0.20.1", "p5-Mojolicious": "8.40"},
14     ]
15 def test_latest_version(pkgs):
16     pkgs_mock = MagicMock(side_effect=pkgs)
17     search_cmd = MagicMock(return_value="bash-5.1.4")
18     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
19         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
20             result = pkgng.latest_version("bash")
21             search_cmd.assert_called_with(
22                 ["pkg", "search", "-eqS", "name", "-U", "bash"],
23                 output_loglevel="trace",
24                 python_shell=False,
25             )
26             assert result == "5.1.4"
27 def test_latest_version_origin(pkgs):
28     pkgs_mock = MagicMock(side_effect=pkgs)
29     search_cmd = MagicMock(return_value="bash-5.1.4_2")
30     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
31         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
32             result = pkgng.latest_version("shells/bash")
33             search_cmd.assert_called_with(
34                 ["pkg", "search", "-eqS", "origin", "-U", "shells/bash"],
35                 output_loglevel="trace",
36                 python_shell=False,
37             )
38             assert result == "5.1.4_2"
39 def test_latest_version_outofdatedate(pkgs):
40     pkgs_mock = MagicMock(side_effect=pkgs)
41     search_cmd = MagicMock(return_value="openvpn-2.4.8_3")
42     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
43         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
44             result = pkgng.latest_version("openvpn")
45             search_cmd.assert_called_with(
46                 ["pkg", "search", "-eqS", "name", "-U", "openvpn"],
47                 output_loglevel="trace",
48                 python_shell=False,
49             )
50             assert result == "2.4.8_3"
51 def test_latest_version_unavailable(pkgs):
52     pkgs_mock = MagicMock(side_effect=pkgs)
53     search_cmd = MagicMock(return_value="")
54     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
55         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
56             result = pkgng.latest_version("does_not_exist")
57             search_cmd.assert_called_with(
58                 ["pkg", "search", "-eqS", "name", "-U", "does_not_exist"],
59                 output_loglevel="trace",
60                 python_shell=False,
61             )
62 def test_latest_version_uptodate(pkgs):
63     pkgs_mock = MagicMock(side_effect=pkgs)
64     search_cmd = MagicMock(return_value="openvpn-2.4.8_2")
65     with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
66         with patch.dict(pkgng.__salt__, {"cmd.run": search_cmd}):
67             result = pkgng.latest_version("openvpn")
68             search_cmd.assert_called_with(
69                 ["pkg", "search", "-eqS", "name", "-U", "openvpn"],
70                 python_shell=False,
71             )
72             as<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>sert result == ""
73 def test_lock():
74     lock_cmd = MagicMock(return_value={"stdout": "pkga-1.0\npkgb-2.0\n", "retcode": 0})
75     with patch.dict(pkgng.__salt__, {"cmd.run_all"</b></font>: lock_cmd}):
76         result = pkgng.lock("pkga")
77         assert result
78         lock_cmd.assert_called_with(
79             ["pkg", "lock", "-y", "--quiet", "--show-locked", "pkga"],
80             output_loglevel="trace",
81             python_shell=False,
82         )
83         result = pkgng.lock("dummy")
84         assert not result
85             ["pkg", "lock", "-y", "--quiet", "--show-locked", "dummy"],
86             output_loglevel="trace",
87             python_shell=<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>False,
88         )
89 def test_unlock():
90     unlock_cmd = MagicMock(
91         return_value={"stdout": "pkga-1.0\npkgb-2.0\n", "retcode": 0}
92     )
93     with patch.dict(pkgng.__salt__, {"cmd.run_all"</b></font>: unlock_cmd}):
94         result = pkgng.unlock("pkga")
95         assert not result
96         unlock_cmd.assert_called_with(
97             ["pkg", "unlock", "-y", "--quiet", "--show-locked", "pkga"],
98             output_loglevel="trace",
99             python_shell=False,
100         )
101         result = pkgng.unlock("dummy")
102         assert result
103         unlock_cmd.assert_called_with(
104             ["pkg", "unlock", "-y", "--quiet", "--show-locked", "dummy"],
105             output_loglevel="trace",
106             python_shell=False,
107         )
108 def test_locked():
109     lock_cmd = MagicMock(return_value={"stdout": "pkga-1.0\npkgb-2.0\n", "retcode": 0})
110     with patch.dict(pkgng.__salt__, {"cmd.run_all": lock_cmd}):
111         result = pkgng.locked("pkga")
112         assert result
113         lock_cmd.assert_called_with(
114             ["pkg", "lock", "-y", "--quiet", "--show-locked"],
115             output_loglevel="trace",
116             python_shell=False,
117         )
118         result = pkgng.locked("dummy")
119         assert not result
120         lock_cmd.assert_called_with(
121             ["pkg", "lock", "-y", "--quiet", "--show-locked"],
122             output_loglevel="trace",
123             python_shell=False,
124         )
125 def test_list_upgrades_present():
126     pkg_cmd = MagicMock(
127         return_value=textwrap.dedent(
128         )
129     )
130     with patch.dict(pkgng.__salt__, {"cmd.run_stdout": pkg_cmd}):
131         result = pkgng.list_upgrades(refresh=False)
132         assert result == {"pkga": "1.1", "pkgb": "2.1", "pkgc": "3.1", "pkgd": "4.1"}
133         pkg_cmd.assert_called_with(
134             ["pkg", "upgrade", "--dry-run", "--quiet", "--no-repo-update"],
135             output_loglevel="trace",
136             python_shell=False,
137             ignore_retcode=True,
138         )
139 def test_list_upgrades_absent():
140     pkg_cmd = MagicMock(return_value="")
141     with patch.dict(pkgng.__salt__, {"cmd.run_stdout": pkg_cmd}):
142         result = pkgng.list_upgrades(refresh=False)
143         assert result == {}
144         pkg_cmd.assert_called_with(
145             ["pkg", "upgrade", "--dry-run", "--quiet", "--no-repo-update"],
146             output_loglevel="trace",
147             python_shell=False,
148             ignore_retcode=True,
149         )
150 def test_upgrade_without_fromrepo(pkgs):
151     pkg_cmd = MagicMock(return_value={"retcode": 0})
152     pkgs_mock = MagicMock(side_effect=pkgs)
153     with patch.dict(pkgng.__salt__, {"cmd.run_all": pkg_cmd}):
154         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
155             result = pkgng.upgrade()
156             expected = {
157                 "gettext-runtime": {"new": "0.20.1", "old": ""},
158                 "p5-Mojolicious": {"new": "8.40", "old": ""},
159             }
160             assert result == expected
161             pkg_cmd.assert_called_with(
162                 ["pkg", "upgrade", "-y"],
163                 output_loglevel="trace",
164                 python_shell=False,
165             )
166 def test_upgrade_with_fromrepo(pkgs):
167     pkg_cmd = MagicMock(return_value={"retcode": 0})
168     pkgs_mock = MagicMock(side_effect=pkgs)
169     with patch.dict(pkgng.__salt__, {"cmd.run_all": pkg_cmd}):
170         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
171             result = pkgng.upgrade(fromrepo="FreeBSD")
172             expected = {
173                 "gettext-runtime": {"new": "0.20.1", "old": ""},
174                 "p5-Mojolicious": {"new": "8.40", "old": ""},
175             }
176             assert result == expected
177             pkg_cmd.assert_called_with(
178                 ["pkg", "upgrade", "-y", "--repository", "FreeBSD"],
179                 output_loglevel="trace",
180                 python_shell=False,
181             )
182 def test_upgrade_with_fetchonly(pkgs):
183     pkg_cmd = MagicMock(return_value={"retcode": 0})
184     pkgs_mock = MagicMock(side_effect=pkgs)
185     with patch.dict(pkgng.__salt__, {"cmd.run_all": pkg_cmd}):
186         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
187             result = pkgng.upgrade(fetchonly=True)
188             expected = {
189                 "gettext-runtime": {"new": "0.20.1", "old": ""},
190                 "p5-Mojolicious": {"new": "8.40", "old": ""},
191             }
192             assert result == expected
193             pkg_cmd.assert_called_with(
194                 ["pkg", "upgrade", "-Fy"],
195                 output_loglevel="trace",
196                 python_shell=False,
197             )
198 def test_upgrade_with_local(pkgs):
199     pkg_cmd = MagicMock(return_value={"retcode": 0})
200     pkgs_mock = MagicMock(side_effect=pkgs)
201     with patch.dict(pkgng.__salt__, {"cmd.run_all": pkg_cmd}):
202         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
203             result = pkgng.upgrade(local=True)
204             expected = {
205                 "gettext-runtime": {"new": "0.20.1", "old": ""},
206                 "p5-Mojolicious": {"new": "8.40", "old": ""},
207             }
208             assert result == expected
209                 ["pkg", "upgrade", "-Uy"],
210                 output_loglevel="trace",
211                 python_shell=<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>False,
212             )
213 def test_stats_with_local():
214     pkg_cmd = MagicMock(return_value="")
215     with patch.dict(pkgng.__salt__, {"cmd.run"</b></font>: pkg_cmd}):
216         result = pkgng.stats(local=True)
217         assert result == []
218         pkg_cmd.assert_called_with(
219             ["pkg", "stats", "-l"],
220             output_loglevel="trace",
221             python_shell=False,
222         )
223 def test_stats_with_remote():
224     pkg_cmd = MagicMock(return_value="")
225     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
226         result = pkgng.stats(remote=True)
227         assert result == []
228         pkg_cmd.assert_called_with(
229             ["pkg", "stats", "-r"],
230             output_loglevel="trace",
231             python_shell=False,
232         )
233 def test_stats_with_bytes_remote():
234     pkg_cmd = MagicMock(return_value="")
235     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
236         result = pkgng.stats(remote=True, bytes=True)
237         assert result == []
238         pkg_cmd.assert_called_with(
239             ["pkg", "stats", "-rb"],
240             output_loglevel="trace",
241             python_shell=False,
242         )
243 def test_stats_with_bytes_local():
244     pkg_cmd = MagicMock(return_value="")
245     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
246         result = pkgng.stats(local=True, bytes=True)
247         assert result == []
248         pkg_cmd.assert_called_with(
249             ["pkg", "stats", "-lb"],
250             output_loglevel="trace",
251             python_shell=False,
252         )
253 def test_install_without_args(pkgs):
254     parsed_targets = (
255         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
256         "repository",
257     )
258     pkg_cmd = MagicMock(return_value={"retcode": 0})
259     pkgs_mock = MagicMock(side_effect=pkgs)
260     patches = {
261         "cmd.run_all": pkg_cmd,
262         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
263     }
264     with patch.dict(pkgng.__salt__, patches):
265         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
266             added = pkgng.install()
267             expected = {
268                 "gettext-runtime": {"new": "0.20.1", "old": ""},
269                 "p5-Mojolicious": {"new": "8.40", "old": ""},
270             }
271             assert added == expected
272             pkg_cmd.assert_called_with(
273                 ["pkg", "install", "-y", "gettext-runtime", "p5-Mojolicious"],
274                 output_loglevel="trace",
275                 python_shell=False,
276                 env={},
277             )
278 def test_install_with_local(pkgs):
279     parsed_targets = (
280         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
281         "repository",
282     )
283     pkg_cmd = MagicMock(return_value={"retcode": 0})
284     pkgs_mock = MagicMock(side_effect=pkgs)
285     patches = {
286         "cmd.run_all": pkg_cmd,
287         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
288     }
289     with patch.dict(pkgng.__salt__, patches):
290         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
291             added = pkgng.install(local=True)
292             expected = {
293                 "gettext-runtime": {"new": "0.20.1", "old": ""},
294                 "p5-Mojolicious": {"new": "8.40", "old": ""},
295             }
296             assert added == expected
297             pkg_cmd.assert_called_with(
298                 ["pkg", "install", "-yU", "gettext-runtime", "p5-Mojolicious"],
299                 output_loglevel="trace",
300                 python_shell=False,
301                 env={},
302             )
303 def test_install_with_fromrepo(pkgs):
304     parsed_targets = (
305         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
306         "repository",
307     )
308     pkg_cmd = MagicMock(return_value={"retcode": 0})
309     pkgs_mock = MagicMock(side_effect=pkgs)
310     patches = {
311         "cmd.run_all": pkg_cmd,
312         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
313     }
314     with patch.dict(pkgng.__salt__, patches):
315         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
316             added = pkgng.install(fromrepo="FreeBSD")
317             expected = {
318                 "gettext-runtime": {"new": "0.20.1", "old": ""},
319                 "p5-Mojolicious": {"new": "8.40", "old": ""},
320             }
321             assert added == expected
322             pkg_cmd.assert_called_with(
323                 [
324                     "pkg",
325                     "install",
326                     "-r",
327                     "FreeBSD",
328                     "-y",
329                     "gettext-runtime",
330                     "p5-Mojolicious",
331                 ],
332                 output_loglevel="trace",
333                 python_shell=False,
334                 env={},
335             )
336 def test_install_with_glob(pkgs):
337     parsed_targets = (
338         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
339         "repository",
340     )
341     pkg_cmd = MagicMock(return_value={"retcode": 0})
342     pkgs_mock = MagicMock(side_effect=pkgs)
343     patches = {
344         "cmd.run_all": pkg_cmd,
345         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
346     }
347     with patch.dict(pkgng.__salt__, patches):
348         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
349             added = pkgng.install(glob=True)
350             expected = {
351                 "gettext-runtime": {"new": "0.20.1", "old": ""},
352                 "p5-Mojolicious": {"new": "8.40", "old": ""},
353             }
354             assert added == expected
355             pkg_cmd.assert_called_with(
356                 ["pkg", "install", "-yg", "gettext-runtime", "p5-Mojolicious"],
357                 output_loglevel="trace",
358                 python_shell=False,
359                 env={},
360             )
361 def test_install_with_reinstall_requires(pkgs):
362     parsed_targets = (
363         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
364         "repository",
365     )
366     pkg_cmd = MagicMock(return_value={"retcode": 0})
367     pkgs_mock = MagicMock(side_effect=pkgs)
368     patches = {
369         "cmd.run_all": pkg_cmd,
370         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
371     }
372     with patch.dict(pkgng.__salt__, patches):
373         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
374             added = pkgng.install(reinstall_requires=True, force=True)
375             expected = {
376                 "gettext-runtime": {"new": "0.20.1", "old": ""},
377                 "p5-Mojolicious": {"new": "8.40", "old": ""},
378             }
379             assert added == expected
380             pkg_cmd.assert_called_with(
381                 ["pkg", "install", "-yfR", "gettext-runtime", "p5-Mojolicious"],
382                 output_loglevel="trace",
383                 python_shell=False,
384                 env={},
385             )
386 def test_install_with_regex(pkgs):
387     parsed_targets = (
388         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
389         "repository",
390     )
391     pkg_cmd = MagicMock(return_value={"retcode": 0})
392     pkgs_mock = MagicMock(side_effect=pkgs)
393     patches = {
394         "cmd.run_all": pkg_cmd,
395         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
396     }
397     with patch.dict(pkgng.__salt__, patches):
398         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
399             added = pkgng.install(regex=True)
400             expected = {
401                 "gettext-runtime": {"new": "0.20.1", "old": ""},
402                 "p5-Mojolicious": {"new": "8.40", "old": ""},
403             }
404             assert added == expected
405             pkg_cmd.assert_called_with(
406                 ["pkg", "install", "-yx", "gettext-runtime", "p5-Mojolicious"],
407                 output_loglevel="trace",
408                 python_shell=False,
409                 env={},
410             )
411 def test_install_with_batch(pkgs):
412     parsed_targets = (
413         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
414         "repository",
415     )
416     pkg_cmd = MagicMock(return_value={"retcode": 0})
417     pkgs_mock = MagicMock(side_effect=pkgs)
418     patches = {
419         "cmd.run_all": pkg_cmd,
420         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
421     }
422     with patch.dict(pkgng.__salt__, patches):
423         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
424             added = pkgng.install(batch=True)
425             expected = {
426                 "gettext-runtime": {"new": "0.20.1", "old": ""},
427                 "p5-Mojolicious": {"new": "8.40", "old": ""},
428             }
429             assert added == expected
430             pkg_cmd.assert_called_with(
431                 ["pkg", "install", "-y", "gettext-runtime", "p5-Mojolicious"],
432                 output_loglevel="trace",
433                 python_shell=False,
434                 env={"BATCH": "true", "ASSUME_ALWAYS_YES": "YES"},
435             )
436 def test_install_with_pcre(pkgs):
437     parsed_targets = (
438         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
439         "repository",
440     )
441     pkg_cmd = MagicMock(return_value={"retcode": 0})
442     pkgs_mock = MagicMock(side_effect=pkgs)
443     patches = {
444         "cmd.run_all": pkg_cmd,
445         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
446     }
447     with patch.dict(pkgng.__salt__, patches):
448         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
449             added = pkgng.install(pcre=True)
450             expected = {
451                 "gettext-runtime": {"new": "0.20.1", "old": ""},
452                 "p5-Mojolicious": {"new": "8.40", "old": ""},
453             }
454             assert added == expected
455             pkg_cmd.assert_called_with(
456                 ["pkg", "install", "-yX", "gettext-runtime", "p5-Mojolicious"],
457                 output_loglevel="trace",
458                 python_shell=False,
459                 env={},
460             )
461 def test_install_with_orphan(pkgs):
462     parsed_targets = (
463         OrderedDict((("gettext-runtime", None), ("p5-Mojolicious", None))),
464         "repository",
465     )
466     pkg_cmd = MagicMock(return_value={"retcode": 0})
467     pkgs_mock = MagicMock(side_effect=pkgs)
468     patches = {
469         "cmd.run_all": pkg_cmd,
470         "pkg_resource.parse_targets": MagicMock(return_value=parsed_targets),
471     }
472     with patch.dict(pkgng.__salt__, patches):
473         with patch("salt.modules.pkgng.list_pkgs", pkgs_mock):
474             added = pkgng.install(orphan=True)
475             expected = {
476                 "gettext-runtime": {"new": "0.20.1", "old": ""},
477                 "p5-Mojolicious": {"new": "8.40", "old": ""},
478             }
479             assert added == expected
480             pkg_cmd.assert_called_with(
481                 ["pkg", "install", "-yA", "gettext-runtime", "p5-Mojolicious"],
482                 output_loglevel="trace",
483                 python_shell=False,
484                 env={},
485             )
486 def test_check_depends():
487     pkg_cmd = MagicMock(return_value="")
488     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
489         result = pkgng.check(depends=True)
490         assert result == ""
491         pkg_cmd.assert_called_with(
492             ["pkg", "check", "-dy"],
493             output_loglevel="trace",
494             python_shell=False,
495         )
496 def test_check_checksum():
497     pkg_cmd = MagicMock(return_value="")
498     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
499         result = pkgng.check(checksum=True)
500         assert result == ""
501         pkg_cmd.assert_called_with(
502             ["pkg", "check", "-s"],
503             output_loglevel="trace",
504             python_shell=False,
505         )
506 def test_check_recompute():
507     pkg_cmd = MagicMock(return_value="")
508     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
509         result = pkgng.check(recompute=True)
510         assert result == ""
511         pkg_cmd.assert_called_with(
512             ["pkg", "check", "-r"],
513             output_loglevel="trace",
514             python_shell=False,
515         )
516 def test_check_checklibs():
517     pkg_cmd = MagicMock(return_value="")
518     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
519         result = pkgng.check(checklibs=True)
520         assert result == ""
521         pkg_cmd.assert_called_with(
522             ["pkg", "check", "-B"],
523             output_loglevel="trace",
524             python_shell=False,
525         )
526 def test_autoremove_with_dryrun():
527     pkg_cmd = MagicMock(return_value="")
528     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
529         result = pkgng.autoremove(dryrun=True)
530         assert result == ""
531         pkg_cmd.assert_called_with(
532             ["pkg", "autoremove", "-n"],
533             output_loglevel="trace",
534             python_shell=False,
535         )
536 def test_autoremove():
537     pkg_cmd = MagicMock(return_value="")
538     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
539         result = pkgng.autoremove()
540         assert result == ""
541         pkg_cmd.assert_called_with(
542             ["pkg", "autoremove", "-y"],
543             output_loglevel="trace",
544             python_shell=False,
545         )
546 def test_audit():
547     pkg_cmd = MagicMock(return_value="")
548     with patch.dict(pkgng.__salt__, {"cmd.run": pkg_cmd}):
549         result = pkgng.audit()
550         assert result == ""
551         pkg_cmd.assert_called_with(
552             ["pkg", "audit", "-F"],
553             output_loglevel="trace",
554             python_shell=False,
555         )
556 def test_version():
557     version = "2.0.6"
558     mock = MagicMock(return_value=version)
559     with patch.dict(pkgng.__salt__, {"pkg_resource.version": mock}):
560         assert pkgng.version(*["mutt"]) == version
561         assert not pkgng.version(*["mutt"]) == "2.0.10"
562 def test_refresh_db_without_forced_flag():
563     pkg_cmd = MagicMock(return_value=0)
564     with patch("salt.utils.pkg.clear_rtag", MagicMock()):
565         with patch.dict(pkgng.__salt__, {"cmd.retcode": pkg_cmd}):
566             result = pkgng.refresh_db()
567             assert result is True
568             pkg_cmd.assert_called_with(
569                 ["pkg", "update"],
570                 python_shell=False,
571             )
572 def test_refresh_db_with_forced_flag():
573     pkg_cmd = MagicMock(return_value=0)
574     with patch("salt.utils.pkg.clear_rtag", MagicMock()):
575         with patch.dict(pkgng.__salt__, {"cmd.retcode": pkg_cmd}):
576             result = pkgng.refresh_db(force=True)
577             assert result is True
578             pkg_cmd.assert_called_with(
579                 ["pkg", "update", "-f"],
580                 python_shell=False,
581             )
582 def test_fetch_with_default_flag():
583     targets = "mutt"
584     pkg_cmd = MagicMock(return_value=targets)
585     patches = {
586         "cmd.run": pkg_cmd,
587         "pkg_resource.stringify": MagicMock(),
588         "pkg_resource.parse_targets": MagicMock(return_value=targets),
589     }
590     with patch.dict(pkgng.__salt__, patches):
591         pkgs = pkgng.fetch(targets)
592         assert pkgs == targets
593     pkg_cmd.assert_called_once_with(
594         ["pkg", "fetch", "-y", "-g", "mutt"],
595         output_loglevel="trace",
596         python_shell=False,
597     )
598 def test_fetch_with_dependency_flag():
599     targets = "mutt"
600     pkg_cmd = MagicMock(return_value=targets)
601     patches = {
602         "cmd.run": pkg_cmd,
603         "pkg_resource.stringify": MagicMock(),
604         "pkg_resource.parse_targets": MagicMock(return_value=targets),
605     }
606     with patch.dict(pkgng.__salt__, patches):
607         pkgs = pkgng.fetch(targets, depends=True)
608         assert pkgs == targets
609     pkg_cmd.assert_called_once_with(
610         ["pkg", "fetch", "-y", "-gd", "mutt"],
611         output_loglevel="trace",
612         python_shell=False,
613     )
614 def test_fetch_with_regex_flag():
615     targets = "mutt"
616     pkg_cmd = MagicMock(return_value=targets)
617     patches = {
618         "cmd.run": pkg_cmd,
619         "pkg_resource.stringify": MagicMock(),
620         "pkg_resource.parse_targets": MagicMock(return_value=targets),
621     }
622     with patch.dict(pkgng.__salt__, patches):
623         pkgs = pkgng.fetch(targets, regex=True)
624         assert pkgs == targets
625     pkg_cmd.assert_called_once_with(
626         ["pkg", "fetch", "-y", "-gx", "mutt"],
627         output_loglevel="trace",
628         python_shell=False,
629     )
630 def test_fetch_with_fromrepo_flag():
631     targets = "mutt"
632     pkg_cmd = MagicMock(return_value=targets)
633     patches = {
634         "cmd.run": pkg_cmd,
635         "pkg_resource.stringify": MagicMock(),
636         "pkg_resource.parse_targets": MagicMock(return_value=targets),
637     }
638     with patch.dict(pkgng.__salt__, patches):
639         pkgs = pkgng.fetch(targets, fromrepo="FreeBSD-poudriere")
640         assert pkgs == targets
641     pkg_cmd.assert_called_once_with(
642         ["pkg", "fetch", "-y", "-r", "FreeBSD-poudriere", "-g", "mutt"],
643         output_loglevel="trace",
644         python_shell=False,
645     )
646 def test_fetch_with_localcache_flag():
647     targets = "mutt"
648     pkg_cmd = MagicMock(return_value=targets)
649     patches = {
650         "cmd.run": pkg_cmd,
651         "pkg_resource.stringify": MagicMock(),
652         "pkg_resource.parse_targets": MagicMock(return_value=targets),
653     }
654     with patch.dict(pkgng.__salt__, patches):
655         pkgs = pkgng.fetch(targets, local=True)
656         assert pkgs == targets
657         ["pkg", "fetch", "-y", "-gL", "mutt"],
658         output_loglevel="trace",
659         python_shell<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=False,
660     )
661 def test_which_with_default_flags():
662     which_cmd = MagicMock(
663         return_value={
664             "stdout": "/usr/local/bin/mutt was installed by package mutt-2.0.6",
665             "retcode": 0,
666         }
667     )
668     with patch.dict(pkgng.__salt__, {"cmd.run"</b></font>: which_cmd}):
669         result = pkgng.which("/usr/local/bin/mutt")
670         assert result
671         which_cmd.assert_called_with(
672             ["pkg", "which", "/usr/local/bin/mutt"],
673             output_loglevel="trace",
674             python_shell=False,
675         )
676 def test_which_with_origin_flag():
677     which_cmd = MagicMock(
678         return_value={
679             "stdout": "/usr/local/bin/mutt was installed by package mail/mutt",
680             "retcode": 0,
681         }
682     )
683     with patch.dict(pkgng.__salt__, {"cmd.run": which_cmd}):
684         result = pkgng.which("/usr/local/bin/mutt", origin=True)
685         assert result
686         which_cmd.assert_called_with(
687             ["pkg", "which", "-o", "/usr/local/bin/mutt"],
688             output_loglevel="trace",
689             python_shell=False,
690         )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
