<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_docker_network.py &amp; test_mysql_2.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_docker_network.py &amp; test_mysql_2.py
      </h3>
<h1 align="center">
        3.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_docker_network.py (4.949054%)<th>test_mysql_2.py (2.905983%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(447-463)<td><a href="#" name="0">(50-145)</a><td align="center"><font color="#ff0000">20</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(397-407)<td><a href="#" name="1">(182-249)</a><td align="center"><font color="#b20000">14</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_docker_network.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import errno
2 import functools
3 import logging
4 import os
5 import subprocess
6 import tempfile
7 import pytest
8 import salt.utils.files
9 import salt.utils.network
10 import salt.utils.path
11 from salt.exceptions import CommandExecutionError
12 from tests.support.case import ModuleCase
13 from tests.support.docker import random_name, with_network
14 from tests.support.helpers import requires_system_grains
15 from tests.support.mixins import SaltReturnAssertsMixin
16 from tests.support.runtests import RUNTIME_VARS
17 from tests.support.unit import skipIf
18 log = logging.getLogger(__name__)
19 IMAGE_NAME = random_name(prefix="salt_busybox_")
20 IPV6_ENABLED = bool(salt.utils.network.ip_addrs6(include_loopback=True))
21 def network_name(func):
22     @functools.wraps(func)
23     def wrapper(self, *args, **kwargs):
24         name = random_name(prefix="salt_net_")
25         try:
26             return func(self, name, *args, **kwargs)
27         finally:
28             self.run_function("docker.disconnect_all_containers_from_network", [name])
29             try:
30                 self.run_function("docker.remove_network", [name])
31             except CommandExecutionError as exc:
32                 if "No such network" not in exc.__str__():
33                     raise
34     return wrapper
35 def container_name(func):
36     def build_image():
37         image_build_rootdir = tempfile.mkdtemp(dir=RUNTIME_VARS.TMP)
38         script_path = os.path.join(RUNTIME_VARS.BASE_FILES, "mkimage-busybox-static")
39         cmd = [script_path, image_build_rootdir, IMAGE_NAME]
40         log.debug("Running '%s' to build busybox image", " ".join(cmd))
41         process = subprocess.Popen(
42             cmd, close_fds=True, stdout=subprocess.PIPE, stderr=subprocess.STDOUT
43         )
44         output = process.communicate()[0]
45         log.debug("Output from mkimge-busybox-static:\n%s", output)
46         if process.returncode != 0:
47             raise Exception("Failed to build image")
48         try:
49             salt.utils.files.rm_rf(image_build_rootdir)
50         except OSError as exc:
51             if exc.errno != errno.ENOENT:
52                 raise
53     @functools.wraps(func)
54     def wrapper(self, *args, **kwargs):
55         try:
56             self.run_function("docker.inspect_image", [IMAGE_NAME])
57         except CommandExecutionError:
58             pass
59         else:
60             build_image()
61         name = random_name(prefix="salt_test_")
62         self.run_function(
63             "docker.create",
64             name=name,
65             image=IMAGE_NAME,
66             command="sleep 600",
67             start=True,
68         )
69         try:
70             return func(self, name, *args, **kwargs)
71         finally:
72             try:
73                 self.run_function("docker.rm", [name], force=True)
74             except CommandExecutionError as exc:
75                 if "No such container" not in exc.__str__():
76                     raise
77     return wrapper
78 @pytest.mark.destructive_test
79 @pytest.mark.slow_test
80 @skipIf(salt.utils.platform.is_freebsd(), "No Docker on FreeBSD available")
81 @skipIf(not salt.utils.path.which("dockerd"), "Docker not installed")
82 class DockerNetworkTestCase(ModuleCase, SaltReturnAssertsMixin):
83     @classmethod
84     def tearDownClass(cls):
85         cmd = ["docker", "rmi", "--force", IMAGE_NAME]
86         log.debug("Running '%s' to destroy busybox image", " ".join(cmd))
87         process = subprocess.Popen(
88             cmd, close_fds=True, stdout=subprocess.PIPE, stderr=subprocess.STDOUT
89         )
90         output = process.communicate()[0]
91         log.debug("Output from %s:\n%s", " ".join(cmd), output)
92         if process.returncode != 0 and "No such image" not in str(output):
93             raise Exception("Failed to destroy image")
94     def run_state(self, function, **kwargs):
95         ret = super().run_state(function, **kwargs)
96         log.debug("ret = %s", ret)
97         return ret
98     @with_network(create=False)
99     @pytest.mark.slow_test
100     def test_absent(self, net):
101         self.assertSaltTrueReturn(
102             self.run_state("docker_network.present", name=net.name)
103         )
104         ret = self.run_state("docker_network.absent", name=net.name)
105         self.assertSaltTrueReturn(ret)
106         ret = ret[next(iter(ret))]
107         self.assertEqual(ret["changes"], {"removed": True})
108         self.assertEqual(ret["comment"], "Removed network '{}'".format(net.name))
109     @container_name
110     @with_network(create=False)
111     @pytest.mark.slow_test
112     @pytest.mark.skipif(
113         salt.utils.platform.is_photonos() is True,
114         reason="Skip on PhotonOS.  No busybox available.",
115     )
116     def test_absent_with_disconnected_container(self, net, container_name):
117         self.assertSaltTrueReturn(
118             self.run_state(
119                 "docker_network.present", name=net.name, containers=[container_name]
120             )
121         )
122         ret = self.run_state("docker_network.absent", name=net.name)
123         self.assertSaltTrueReturn(ret)
124         ret = ret[next(iter(ret))]
125         self.assertEqual(
126             ret["changes"], {"removed": True, "disconnected": [container_name]}
127         )
128         self.assertEqual(ret["comment"], "Removed network '{}'".format(net.name))
129     @with_network(create=False)
130     @pytest.mark.slow_test
131     def test_absent_when_not_present(self, net):
132         ret = self.run_state("docker_network.absent", name=net.name)
133         self.assertSaltTrueReturn(ret)
134         ret = ret[next(iter(ret))]
135         self.assertEqual(ret["changes"], {})
136         self.assertEqual(ret["comment"], "Network '{}' already absent".format(net.name))
137     @with_network(create=False)
138     @pytest.mark.slow_test
139     def test_present(self, net):
140         ret = self.run_state("docker_network.present", name=net.name)
141         self.assertSaltTrueReturn(ret)
142         ret = ret[next(iter(ret))]
143         self.assertEqual(ret["changes"], {"created": True})
144         self.assertEqual(ret["comment"], "Network '{}' created".format(net.name))
145         self.run_function("docker.inspect_network", [net.name])
146     @container_name
147     @with_network(create=False)
148     @pytest.mark.slow_test
149     @pytest.mark.skipif(
150         salt.utils.platform.is_photonos() is True,
151         reason="Skip on PhotonOS.  No busybox available.",
152     )
153     def test_present_with_containers(self, net, container_name):
154         ret = self.run_state(
155             "docker_network.present", name=net.name, containers=[container_name]
156         )
157         self.assertSaltTrueReturn(ret)
158         ret = ret[next(iter(ret))]
159         self.assertEqual(
160             ret["changes"], {"created": True, "connected": [container_name]}
161         )
162         self.assertEqual(ret["comment"], "Network '{}' created".format(net.name))
163         self.run_function("docker.inspect_network", [net.name])
164     def _test_present_reconnect(self, net, container_name, reconnect=True):
165         ret = self.run_state("docker_network.present", name=net.name, driver="bridge")
166         self.assertSaltTrueReturn(ret)
167         ret = ret[next(iter(ret))]
168         self.assertEqual(ret["changes"], {"created": True})
169         self.assertEqual(ret["comment"], "Network '{}' created".format(net.name))
170         self.run_function(
171             "docker.connect_container_to_network", [container_name, net.name]
172         )
173         ret = self.run_state(
174             "docker_network.present",
175             name=net.name,
176             driver="macvlan",
177             reconnect=reconnect,
178         )
179         self.assertSaltTrueReturn(ret)
180         ret = ret[next(iter(ret))]
181         self.assertEqual(
182             ret["changes"],
183             {
184                 "recreated": True,
185                 "reconnected" if reconnect else "disconnected": [container_name],
186                 net.name: {"Driver": {"old": "bridge", "new": "macvlan"}},
187             },
188         )
189         self.assertEqual(
190             ret["comment"],
191             "Network '{}' was replaced with updated config".format(net.name),
192         )
193     @container_name
194     @with_network(create=False)
195     @pytest.mark.slow_test
196     @pytest.mark.skipif(
197         salt.utils.platform.is_photonos() is True,
198         reason="Skip on PhotonOS.  No busybox available.",
199     )
200     def test_present_with_reconnect(self, net, container_name):
201         self._test_present_reconnect(net, container_name, reconnect=True)
202     @container_name
203     @with_network(create=False)
204     @pytest.mark.slow_test
205     @pytest.mark.skipif(
206         salt.utils.platform.is_photonos() is True,
207         reason="Skip on PhotonOS.  No busybox available.",
208     )
209     def test_present_with_no_reconnect(self, net, container_name):
210         self._test_present_reconnect(net, container_name, reconnect=False)
211     @with_network()
212     @pytest.mark.slow_test
213     def test_present_internal(self, net):
214         self.assertSaltTrueReturn(
215             self.run_state(
216                 "docker_network.present",
217                 name=net.name,
218                 internal=True,
219             )
220         )
221         net_info = self.run_function("docker.inspect_network", [net.name])
222         self.assertIs(net_info["Internal"], True)
223     @with_network()
224     @pytest.mark.slow_test
225     def test_present_labels(self, net):
226         self.assertSaltTrueReturn(
227             self.run_state(
228                 "docker_network.present",
229                 name=net.name,
230                 labels=["foo", "bar=baz", {"hello": "world"}],
231             )
232         )
233         net_info = self.run_function("docker.inspect_network", [net.name])
234         self.assertEqual(
235             net_info["Labels"],
236             {"foo": "", "bar": "baz", "hello": "world"},
237         )
238     @with_network(subnet="fe3f:2180:26:1::/123")
239     @with_network(subnet="10.247.197.96/27")
240     @skipIf(not IPV6_ENABLED, "IPv6 not enabled")
241     @pytest.mark.slow_test
242     def test_present_enable_ipv6(self, net1, net2):
243         self.assertSaltTrueReturn(
244             self.run_state(
245                 "docker_network.present",
246                 name=net1.name,
247                 enable_ipv6=True,
248                 ipam_pools=[{"subnet": net1.subnet}, {"subnet": net2.subnet}],
249             )
250         )
251         net_info = self.run_function("docker.inspect_network", [net1.name])
252         self.assertIs(net_info["EnableIPv6"], True)
253     @requires_system_grains
254     @with_network()
255     @pytest.mark.slow_test
256     def test_present_attachable(self, net, grains):
257         if grains["os_family"] == "RedHat" and grains.get("osmajorrelease", 0) &lt;= 7:
258             self.skipTest("Cannot reliably manage attachable on RHEL &lt;= 7")
259         self.assertSaltTrueReturn(
260             self.run_state(
261                 "docker_network.present",
262                 name=net.name,
263                 attachable=True,
264             )
265         )
266         net_info = self.run_function("docker.inspect_network", [net.name])
267         self.assertIs(net_info["Attachable"], True)
268     @skipIf(True, "Skip until we can set up docker swarm testing")
269     @with_network()
270     def test_present_scope(self, net):
271         self.assertSaltTrueReturn(
272             self.run_state(
273                 "docker_network.present",
274                 name=net.name,
275                 scope="global",
276             )
277         )
278         net_info = self.run_function("docker.inspect_network", [net.name])
279         self.assertIs(net_info["Scope"], "global")
280     @skipIf(True, "Skip until we can set up docker swarm testing")
281     @with_network()
282     def test_present_ingress(self, net):
283         self.assertSaltTrueReturn(
284             self.run_state(
285                 "docker_network.present",
286                 name=net.name,
287                 ingress=True,
288             )
289         )
290         net_info = self.run_function("docker.inspect_network", [net.name])
291         self.assertIs(net_info["Ingress"], True)
292     @with_network(subnet="10.247.197.128/27")
293     @with_network(subnet="10.247.197.96/27")
294     @pytest.mark.slow_test
295     def test_present_with_custom_ipv4(self, net1, net2):
296         self.assertSaltTrueReturn(
297             self.run_state(
298                 "docker_network.present",
299                 name=net1.name,
300                 subnet=net1.subnet,
301                 gateway=net1.gateway,
302             )
303         )
304         ret = self.run_state(
305             "docker_network.present",
306             name=net1.name,  # We want to keep the same network name
307             ipam_pools=[{"subnet": net2.subnet, "gateway": net2.gateway}],
308         )
309         self.assertSaltTrueReturn(ret)
310         ret = ret[next(iter(ret))]
311         expected = {
312             <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"recreated": True,
313             net1.name: {
314                 "IPAM": {
315                     "Config": {
316                         "old": [{"Subnet": net1.subnet, "Gateway": net1.gateway}],
317                         "new": [{"Subnet": net2.subnet, "Gateway": net2.gateway}],
318                     }
319                 }
320             },
321         }
322         self.</b></font>assertEqual(ret["changes"], expected)
323         self.assertEqual(
324             ret["comment"],
325             "Network '{}' was replaced with updated config".format(net1.name),
326         )
327     @with_network(subnet="fe3f:2180:26:1::20/123")
328     @with_network(subnet="fe3f:2180:26:1::/123")
329     @with_network(subnet="10.247.197.96/27")
330     @skipIf(not IPV6_ENABLED, "IPv6 not enabled")
331     @pytest.mark.slow_test
332     def test_present_with_custom_ipv6(self, ipv4_net, ipv6_net1, ipv6_net2):
333         self.assertSaltTrueReturn(
334             self.run_state(
335                 "docker_network.present",
336                 name=ipv4_net.name,
337                 enable_ipv6=True,
338                 ipam_pools=[
339                     {"subnet": ipv4_net.subnet, "gateway": ipv4_net.gateway},
340                     {"subnet": ipv6_net1.subnet, "gateway": ipv6_net1.gateway},
341                 ],
342             )
343         )
344         ret = self.run_state(
345             "docker_network.present",
346             name=ipv4_net.name,  # We want to keep the same network name
347             enable_ipv6=True,
348             ipam_pools=[
349                 {"subnet": ipv4_net.subnet, "gateway": ipv4_net.gateway},
350                 {"subnet": ipv6_net2.subnet, "gateway": ipv6_net2.gateway},
351             ],
352         )
353         self.assertSaltTrueReturn(ret)
354         ret = ret[next(iter(ret))]
355         expected = {
356             <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>"recreated": True,
357             ipv4_net.name: {
358                 "IPAM": {
359                     "Config": {
360                         "old": [
361                             {"Subnet": ipv4_net.subnet, "Gateway": ipv4_net.gateway},
362                             {"Subnet": ipv6_net1.subnet, "Gateway": ipv6_net1.gateway},
363                         ],
364                         "new": [
365                             {"Subnet": ipv4_net.subnet, "Gateway": ipv4_net.gateway},
366                             {"Subnet": ipv6_net2.subnet, "Gateway": ipv6_net2.gateway},
367                         ],
368                     }
369                 }
370             },
371         }
372         self.</b></font>assertEqual(ret["changes"], expected)
373         self.assertEqual(
374             ret["comment"],
375             "Network '{}' was replaced with updated config".format(ipv4_net.name),
376         )
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_mysql_2.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.pillar.mysql as mysql
2 from tests.support.unit import TestCase, skipIf
3 @skipIf(mysql.MySQLdb is None, "MySQL-python module not installed")
4 class MysqlPillarTestCase(TestCase):
5     maxDiff = None
6     def test_001_extract_queries_legacy(self):
7         return_data = mysql.MySQLExtPillar()
8         args, kwargs = ["SELECT blah"], {}
9         qbuffer = return_data.extract_queries(args, kwargs)
10         self.assertEqual(
11             [
12                 [
13                     None,
14                     {
15                         "query": "SELECT blah",
16                         "depth": 0,
17                         "as_list": False,
18                         "as_json": False,
19                         "with_lists": None,
20                         "ignore_null": False,
21                     },
22                 ]
23             ],
24             qbuffer,
25         )
26     def test_002_extract_queries_list(self):
27         return_data = mysql.MySQLExtPillar()
28         args, kwargs = (
29             [
30                 "SELECT blah",
31                 "SELECT blah2",
32                 ("SELECT blah3",),
33                 ("SELECT blah4", 2),
34                 {"query": "SELECT blah5"},
35                 {"query": "SELECT blah6", "depth": 2},
36                 {"query": "SELECT blah7", "as_list": True},
37                 {"query": "SELECT blah8", "with_lists": "1"},
38                 {"query": "SELECT blah9", "with_lists": "1,2"},
39                 {"query": "SELECT json1", "as_json": True},
40             ],
41             {},
42         )
43         self.assertEqual(
44             [
45                 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>[
46                     None,
47                     {
48                         "query": "SELECT blah",
49                         "depth": 0,
50                         "as_list": False,
51                         "as_json": False,
52                         "with_lists": None,
53                         "ignore_null": False,
54                     },
55                 ],
56                 [
57                     None,
58                     {
59                         "query": "SELECT blah2",
60                         "depth": 0,
61                         "as_list": False,
62                         "as_json": False,
63                         "with_lists": None,
64                         "ignore_null": False,
65                     },
66                 ],
67                 [
68                     None,
69                     {
70                         "query": "SELECT blah3",
71                         "depth": 0,
72                         "as_list": False,
73                         "as_json": False,
74                         "with_lists": None,
75                         "ignore_null": False,
76                     },
77                 ],
78                 [
79                     None,
80                     {
81                         "query": "SELECT blah4",
82                         "depth": 2,
83                         "as_list": False,
84                         "as_json": False,
85                         "with_lists": None,
86                         "ignore_null": False,
87                     },
88                 ],
89                 [
90                     None,
91                     {
92                         "query": "SELECT blah5",
93                         "depth": 0,
94                         "as_list": False,
95                         "as_json": False,
96                         "with_lists": None,
97                         "ignore_null": False,
98                     },
99                 ],
100                 [
101                     None,
102                     {
103                         "query": "SELECT blah6",
104                         "depth": 2,
105                         "as_list": False,
106                         "as_json": False,
107                         "with_lists": None,
108                         "ignore_null": False,
109                     },
110                 ],
111                 [
112                     None,
113                     {
114                         "query": "SELECT blah7",
115                         "depth": 0,
116                         "as_list": True,
117                         "as_json": False,
118                         "with_lists": None,
119                         "ignore_null": False,
120                     },
121                 ],
122                 [
123                     None,
124                     {
125                         "query": "SELECT blah8",
126                         "depth": 0,
127                         "as_list": False,
128                         "as_json": False,
129                         "with_lists": [1],
130                         "ignore_null": False,
131                     },
132                 ],
133                 [
134                     None,
135                     {
136                         "query": "SELECT blah9",
137                         "depth": 0,
138                         "as_list": False,
139                         "as_json": False,
140                         "with_lists": [1</b></font>, 2],
141                         "ignore_null": False,
142                     },
143                 ],
144                 [
145                     None,
146                     {
147                         "query": "SELECT json1",
148                         "depth": 0,
149                         "as_list": False,
150                         "as_json": True,
151                         "with_lists": None,
152                         "ignore_null": False,
153                     },
154                 ],
155             ],
156             qbuffer,
157         )
158     def test_003_extract_queries_kwarg(self):
159         return_data = mysql.MySQLExtPillar()
160         args, kwargs = (
161             [],
162             {
163                 "1": "SELECT blah",
164                 "2": "SELECT blah2",
165                 "3": ("SELECT blah3",),
166                 "4": ("SELECT blah4", 2),
167                 "5": {"query": "SELECT blah5"},
168                 "6": {"query": "SELECT blah6", "depth": 2},
169                 "7": {"query": "SELECT blah7", "as_list": True},
170                 "8": {"query": "SELECT json1", "as_json": True},
171             },
172         )
173         self.assertEqual(
174             [
175                 <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>[
176                     "1",
177                     {
178                         "query": "SELECT blah",
179                         "depth": 0,
180                         "as_list": False,
181                         "as_json": False,
182                         "with_lists": None,
183                         "ignore_null": False,
184                     },
185                 ],
186                 [
187                     "2",
188                     {
189                         "query": "SELECT blah2",
190                         "depth": 0,
191                         "as_list": False,
192                         "as_json": False,
193                         "with_lists": None,
194                         "ignore_null": False,
195                     },
196                 ],
197                 [
198                     "3",
199                     {
200                         "query": "SELECT blah3",
201                         "depth": 0,
202                         "as_list": False,
203                         "as_json": False,
204                         "with_lists": None,
205                         "ignore_null": False,
206                     },
207                 ],
208                 [
209                     "4",
210                     {
211                         "query": "SELECT blah4",
212                         "depth": 2,
213                         "as_list": False,
214                         "as_json": False,
215                         "with_lists": None,
216                         "ignore_null": False,
217                     },
218                 ],
219                 [
220                     "5",
221                     {
222                         "query": "SELECT blah5",
223                         "depth": 0,
224                         "as_list": False,
225                         "as_json": False,
226                         "with_lists": None,
227                         "ignore_null": False,
228                     },
229                 ],
230                 [
231                     "6",
232                     {
233                         "query": "SELECT blah6",
234                         "depth": 2,
235                         "as_list": False,
236                         "as_json": False,
237                         "with_lists": None,
238                         "ignore_null": False,
239                     },
240                 ],
241                 [
242                     "7"</b></font>,
243                     {
244                         "query": "SELECT blah7",
245                         "depth": 0,
246                         "as_list": True,
247                         "as_json": False,
248                         "with_lists": None,
249                         "ignore_null": False,
250                     },
251                 ],
252                 [
253                     "8",
254                     {
255                         "query": "SELECT json1",
256                         "depth": 0,
257                         "as_list": False,
258                         "as_json": True,
259                         "with_lists": None,
260                         "ignore_null": False,
261                     },
262                 ],
263             ],
264             qbuffer,
265         )
266     def test_004_extract_queries_mixed(self):
267         return_data = mysql.MySQLExtPillar()
268         args, kwargs = (
269             [
270                 "SELECT blah1",
271                 ("SELECT blah2", 2),
272                 {"query": "SELECT blah3", "as_list": True},
273             ],
274             {
275                 "1": "SELECT blah1",
276                 "2": ("SELECT blah2", 2),
277                 "3": {"query": "SELECT blah3", "as_list": True},
278             },
279         )
280         qbuffer = return_data.extract_queries(args, kwargs)
281         self.assertEqual(
282             [
283                 [
284                     None,
285                     {
286                         "query": "SELECT blah1",
287                         "depth": 0,
288                         "as_list": False,
289                         "as_json": False,
290                         "with_lists": None,
291                         "ignore_null": False,
292                     },
293                 ],
294                 [
295                     None,
296                     {
297                         "query": "SELECT blah2",
298                         "depth": 2,
299                         "as_list": False,
300                         "as_json": False,
301                         "with_lists": None,
302                         "ignore_null": False,
303                     },
304                 ],
305                 [
306                     None,
307                     {
308                         "query": "SELECT blah3",
309                         "depth": 0,
310                         "as_list": True,
311                         "as_json": False,
312                         "with_lists": None,
313                         "ignore_null": False,
314                     },
315                 ],
316                 [
317                     "1",
318                     {
319                         "query": "SELECT blah1",
320                         "depth": 0,
321                         "as_list": False,
322                         "as_json": False,
323                         "with_lists": None,
324                         "ignore_null": False,
325                     },
326                 ],
327                 [
328                     "2",
329                     {
330                         "query": "SELECT blah2",
331                         "depth": 2,
332                         "as_list": False,
333                         "as_json": False,
334                         "with_lists": None,
335                         "ignore_null": False,
336                     },
337                 ],
338                 [
339                     "3",
340                     {
341                         "query": "SELECT blah3",
342                         "depth": 0,
343                         "as_list": True,
344                         "as_json": False,
345                         "with_lists": None,
346                         "ignore_null": False,
347                     },
348                 ],
349             ],
350             qbuffer,
351         )
352     def test_005_extract_queries_bogus_list(self):
353         return_data = mysql.MySQLExtPillar()
354         args, kwargs = (
355             [
356                 "SELECT blah",
357                 "",
358                 "SELECT blah2",
359                 ("SELECT blah3",),
360                 ("",),
361                 ("SELECT blah4", 2),
362                 tuple(),
363                 ("SELECT blah5",),
364                 {"query": "SELECT blah6"},
365                 {"query": ""},
366                 {"query": "SELECT blah7", "depth": 2},
367                 {"not_a_query": "in sight!"},
368                 {"query": "SELECT blah8", "as_list": True},
369             ],
370             {},
371         )
372         qbuffer = return_data.extract_queries(args, kwargs)
373         self.assertEqual(
374             [
375                 [
376                     None,
377                     {
378                         "query": "SELECT blah",
379                         "depth": 0,
380                         "as_list": False,
381                         "as_json": False,
382                         "with_lists": None,
383                         "ignore_null": False,
384                     },
385                 ],
386                 [
387                     None,
388                     {
389                         "query": "SELECT blah2",
390                         "depth": 0,
391                         "as_list": False,
392                         "as_json": False,
393                         "with_lists": None,
394                         "ignore_null": False,
395                     },
396                 ],
397                 [
398                     None,
399                     {
400                         "query": "SELECT blah3",
401                         "depth": 0,
402                         "as_list": False,
403                         "as_json": False,
404                         "with_lists": None,
405                         "ignore_null": False,
406                     },
407                 ],
408                 [
409                     None,
410                     {
411                         "query": "SELECT blah4",
412                         "depth": 2,
413                         "as_list": False,
414                         "as_json": False,
415                         "with_lists": None,
416                         "ignore_null": False,
417                     },
418                 ],
419                 [
420                     None,
421                     {
422                         "query": "SELECT blah5",
423                         "depth": 0,
424                         "as_list": False,
425                         "as_json": False,
426                         "with_lists": None,
427                         "ignore_null": False,
428                     },
429                 ],
430                 [
431                     None,
432                     {
433                         "query": "SELECT blah6",
434                         "depth": 0,
435                         "as_list": False,
436                         "as_json": False,
437                         "with_lists": None,
438                         "ignore_null": False,
439                     },
440                 ],
441                 [
442                     None,
443                     {
444                         "query": "SELECT blah7",
445                         "depth": 2,
446                         "as_list": False,
447                         "as_json": False,
448                         "with_lists": None,
449                         "ignore_null": False,
450                     },
451                 ],
452                 [
453                     None,
454                     {
455                         "query": "SELECT blah8",
456                         "depth": 0,
457                         "as_list": True,
458                         "as_json": False,
459                         "with_lists": None,
460                         "ignore_null": False,
461                     },
462                 ],
463             ],
464             qbuffer,
465         )
466     def test_006_extract_queries_bogus_kwargs(self):
467         return_data = mysql.MySQLExtPillar()
468         args, kwargs = [], {"1": "SELECT blah", "2": "", "3": "SELECT blah2"}
469         qbuffer = return_data.extract_queries(args, kwargs)
470         self.assertEqual(
471             [
472                 [
473                     "1",
474                     {
475                         "query": "SELECT blah",
476                         "depth": 0,
477                         "as_list": False,
478                         "as_json": False,
479                         "with_lists": None,
480                         "ignore_null": False,
481                     },
482                 ],
483                 [
484                     "3",
485                     {
486                         "query": "SELECT blah2",
487                         "depth": 0,
488                         "as_list": False,
489                         "as_json": False,
490                         "with_lists": None,
491                         "ignore_null": False,
492                     },
493                 ],
494             ],
495             qbuffer,
496         )
497     def test_011_enter_root(self):
498         return_data = mysql.MySQLExtPillar()
499         return_data.enter_root("test")
500         self.assertEqual(return_data.result["test"], return_data.focus)
501         return_data.enter_root(None)
502         self.assertEqual(return_data.result, return_data.focus)
503     def test_021_process_fields(self):
504         return_data = mysql.MySQLExtPillar()
505         return_data.process_fields(["a", "b"], 0)
506         self.assertEqual(return_data.num_fields, 2)
507         self.assertEqual(return_data.depth, 1)
508         return_data.process_fields(["a", "b"], 2)
509         self.assertEqual(return_data.num_fields, 2)
510         self.assertEqual(return_data.depth, 1)
511         return_data.process_fields(["a", "b", "c", "d"], 0)
512         self.assertEqual(return_data.num_fields, 4)
513         self.assertEqual(return_data.depth, 3)
514         return_data.process_fields(["a", "b", "c", "d"], 1)
515         self.assertEqual(return_data.num_fields, 4)
516         self.assertEqual(return_data.depth, 1)
517         return_data.process_fields(["a", "b", "c", "d"], 2)
518         self.assertEqual(return_data.num_fields, 4)
519         self.assertEqual(return_data.depth, 2)
520         return_data.process_fields(["a", "b", "c", "d"], 3)
521         self.assertEqual(return_data.num_fields, 4)
522         self.assertEqual(return_data.depth, 3)
523         return_data.process_fields(["a", "b", "c", "d"], 4)
524         self.assertEqual(return_data.num_fields, 4)
525         self.assertEqual(return_data.depth, 3)
526     def test_111_process_results_legacy(self):
527         return_data = mysql.MySQLExtPillar()
528         return_data.process_fields(["a", "b"], 0)
529         return_data.with_lists = []
530         return_data.process_results([[1, 2]])
531         self.assertEqual({1: 2}, return_data.result)
532     def test_112_process_results_legacy_multiple(self):
533         return_data = mysql.MySQLExtPillar()
534         return_data.process_fields(["a", "b"], 0)
535         return_data.with_lists = []
536         return_data.process_results([[1, 2], [3, 4], [5, 6]])
537         self.assertEqual({1: 2, 3: 4, 5: 6}, return_data.result)
538     def test_121_process_results_depth_0(self):
539         return_data = mysql.MySQLExtPillar()
540         return_data.process_fields(["a", "b", "c", "d"], 0)
541         return_data.with_lists = []
542         return_data.enter_root(None)
543         return_data.process_results([[1, 2, 3, 4], [5, 6, 7, 8]])
544         self.assertEqual({1: {2: {3: 4}}, 5: {6: {7: 8}}}, return_data.result)
545     def test_122_process_results_depth_1(self):
546         return_data = mysql.MySQLExtPillar()
547         return_data.process_fields(["a", "b", "c", "d"], 1)
548         return_data.with_lists = []
549         return_data.enter_root(None)
550         return_data.process_results([[1, 2, 3, 4], [5, 6, 7, 8]])
551         self.assertEqual(
552             {1: {"b": 2, "c": 3, "d": 4}, 5: {"b": 6, "c": 7, "d": 8}},
553             return_data.result,
554         )
555     def test_123_process_results_depth_2(self):
556         return_data = mysql.MySQLExtPillar()
557         return_data.process_fields(["a", "b", "c", "d"], 2)
558         return_data.with_lists = []
559         return_data.enter_root(None)
560         return_data.process_results([[1, 2, 3, 4], [5, 6, 7, 8]])
561         self.assertEqual(
562             {1: {2: {"c": 3, "d": 4}}, 5: {6: {"c": 7, "d": 8}}}, return_data.result
563         )
564     def test_124_process_results_depth_3(self):
565         return_data = mysql.MySQLExtPillar()
566         return_data.process_fields(["a", "b", "c", "d"], 3)
567         return_data.with_lists = []
568         return_data.enter_root(None)
569         return_data.process_results([[1, 2, 3, 4], [5, 6, 7, 8]])
570         self.assertEqual({1: {2: {3: 4}}, 5: {6: {7: 8}}}, return_data.result)
571     def test_125_process_results_depth_4(self):
572         return_data = mysql.MySQLExtPillar()
573         return_data.process_fields(["a", "b", "c", "d"], 4)
574         return_data.with_lists = []
575         return_data.enter_root(None)
576         return_data.process_results([[1, 2, 3, 4], [5, 6, 7, 8]])
577         self.assertEqual({1: {2: {3: 4}}, 5: {6: {7: 8}}}, return_data.result)
578     def test_131_process_results_overwrite_legacy_multiple(self):
579         return_data = mysql.MySQLExtPillar()
580         return_data.process_fields(["a", "b"], 0)
581         return_data.with_lists = []
582         return_data.process_results([[1, 2], [3, 4], [1, 6]])
583         self.assertEqual({1: 6, 3: 4}, return_data.result)
584     def test_132_process_results_merge_depth_0(self):
585         return_data = mysql.MySQLExtPillar()
586         return_data.process_fields(["a", "b", "c", "d"], 0)
587         return_data.with_lists = []
588         return_data.enter_root(None)
589         return_data.process_results([[1, 2, 3, 4], [1, 6, 7, 8]])
590         self.assertEqual({1: {2: {3: 4}, 6: {7: 8}}}, return_data.result)
591     def test_133_process_results_overwrite_depth_0(self):
592         return_data = mysql.MySQLExtPillar()
593         return_data.process_fields(["a", "b", "c", "d"], 0)
594         return_data.with_lists = []
595         return_data.enter_root(None)
596         return_data.process_results([[1, 2, 3, 4], [1, 2, 3, 8]])
597         self.assertEqual({1: {2: {3: 8}}}, return_data.result)
598     def test_134_process_results_deepmerge_depth_0(self):
599         return_data = mysql.MySQLExtPillar()
600         return_data.process_fields(["a", "b", "c", "d"], 0)
601         return_data.with_lists = []
602         return_data.enter_root(None)
603         return_data.process_results([[1, 2, 3, 4], [1, 2, 7, 8]])
604         self.assertEqual({1: {2: {3: 4, 7: 8}}}, return_data.result)
605     def test_135_process_results_overwrite_depth_1(self):
606         return_data = mysql.MySQLExtPillar()
607         return_data.process_fields(["a", "b", "c", "d"], 1)
608         return_data.with_lists = []
609         return_data.enter_root(None)
610         return_data.process_results([[1, 2, 3, 4], [1, 6, 7, 8]])
611         self.assertEqual({1: {"b": 6, "c": 7, "d": 8}}, return_data.result)
612     def test_136_process_results_merge_depth_2(self):
613         return_data = mysql.MySQLExtPillar()
614         return_data.process_fields(["a", "b", "c", "d"], 2)
615         return_data.with_lists = []
616         return_data.enter_root(None)
617         return_data.process_results([[1, 2, 3, 4], [1, 6, 7, 8]])
618         self.assertEqual(
619             {1: {2: {"c": 3, "d": 4}, 6: {"c": 7, "d": 8}}}, return_data.result
620         )
621     def test_137_process_results_overwrite_depth_2(self):
622         return_data = mysql.MySQLExtPillar()
623         return_data.process_fields(["a", "b", "c", "d"], 2)
624         return_data.with_lists = []
625         return_data.enter_root(None)
626         return_data.process_results([[1, 2, 3, 4], [1, 2, 7, 8]])
627         self.assertEqual({1: {2: {"c": 7, "d": 8}}}, return_data.result)
628     def test_201_process_results_complexity_multiresults(self):
629         return_data = mysql.MySQLExtPillar()
630         return_data.process_fields(["a", "b", "c", "d"], 2)
631         return_data.with_lists = []
632         return_data.enter_root(None)
633         return_data.process_results([[1, 2, 3, 4]])
634         return_data.process_results([[1, 2, 7, 8]])
635         self.assertEqual({1: {2: {"c": 7, "d": 8}}}, return_data.result)
636     def test_202_process_results_complexity_as_list(self):
637         return_data = mysql.MySQLExtPillar()
638         return_data.process_fields(["a", "b", "c", "d"], 2)
639         return_data.with_lists = []
640         return_data.enter_root(None)
641         return_data.as_list = True
642         return_data.process_results([[1, 2, 3, 4]])
643         return_data.process_results([[1, 2, 7, 8]])
644         self.assertEqual({1: {2: {"c": [3, 7], "d": [4, 8]}}}, return_data.result)
645     def test_203_process_results_complexity_as_list_deeper(self):
646         return_data = mysql.MySQLExtPillar()
647         return_data.process_fields(["a", "b", "c", "d"], 0)
648         return_data.with_lists = []
649         return_data.enter_root(None)
650         return_data.as_list = True
651         return_data.process_results([[1, 2, 3, 4]])
652         return_data.process_results([[1, 2, 3, 8]])
653         self.assertEqual({1: {2: {3: [4, 8]}}}, return_data.result)
654     def test_204_process_results_complexity_as_list_mismatch_depth(self):
655         return_data = mysql.MySQLExtPillar()
656         return_data.as_list = True
657         return_data.with_lists = []
658         return_data.enter_root(None)
659         return_data.process_fields(["a", "b", "c", "d"], 0)
660         return_data.process_results([[1, 2, 3, 4]])
661         return_data.process_results([[1, 2, 3, 5]])
662         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
663         return_data.process_results([[1, 2, 3, 6, 7]])
664         self.assertEqual({1: {2: {3: [4, 5, {6: 7}]}}}, return_data.result)
665     def test_205_process_results_complexity_as_list_mismatch_depth_reversed(self):
666         return_data = mysql.MySQLExtPillar()
667         return_data.as_list = True
668         return_data.with_lists = []
669         return_data.enter_root(None)
670         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
671         return_data.process_results([[1, 2, 3, 6, 7]])
672         return_data.process_results([[1, 2, 3, 8, 9]])
673         return_data.process_fields(["a", "b", "c", "d"], 0)
674         return_data.process_results([[1, 2, 3, 4]])
675         return_data.process_results([[1, 2, 3, 5]])
676         self.assertEqual({1: {2: {3: [{6: 7, 8: 9}, 4, 5]}}}, return_data.result)
677     def test_206_process_results_complexity_as_list_mismatch_depth_weird_order(self):
678         return_data = mysql.MySQLExtPillar()
679         return_data.as_list = True
680         return_data.with_lists = []
681         return_data.enter_root(None)
682         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
683         return_data.process_results([[1, 2, 3, 6, 7]])
684         return_data.process_fields(["a", "b", "c", "d"], 0)
685         return_data.process_results([[1, 2, 3, 4]])
686         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
687         return_data.process_results([[1, 2, 3, 8, 9]])
688         return_data.process_fields(["a", "b", "c", "d"], 0)
689         return_data.process_results([[1, 2, 3, 5]])
690         self.assertEqual({1: {2: {3: [{6: 7}, 4, {8: 9}, 5]}}}, return_data.result)
691     def test_207_process_results_complexity_collision_mismatch_depth(self):
692         return_data = mysql.MySQLExtPillar()
693         return_data.as_list = False
694         return_data.with_lists = []
695         return_data.enter_root(None)
696         return_data.process_fields(["a", "b", "c", "d"], 0)
697         return_data.process_results([[1, 2, 3, 4]])
698         return_data.process_results([[1, 2, 3, 5]])
699         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
700         return_data.process_results([[1, 2, 3, 6, 7]])
701         self.assertEqual({1: {2: {3: {6: 7}}}}, return_data.result)
702     def test_208_process_results_complexity_collision_mismatch_depth_reversed(self):
703         return_data = mysql.MySQLExtPillar()
704         return_data.as_list = False
705         return_data.with_lists = []
706         return_data.enter_root(None)
707         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
708         return_data.process_results([[1, 2, 3, 6, 7]])
709         return_data.process_results([[1, 2, 3, 8, 9]])
710         return_data.process_fields(["a", "b", "c", "d"], 0)
711         return_data.process_results([[1, 2, 3, 4]])
712         return_data.process_results([[1, 2, 3, 5]])
713         self.assertEqual({1: {2: {3: 5}}}, return_data.result)
714     def test_209_process_results_complexity_collision_mismatch_depth_weird_order(self):
715         return_data = mysql.MySQLExtPillar()
716         return_data.as_list = False
717         return_data.with_lists = []
718         return_data.enter_root(None)
719         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
720         return_data.process_results([[1, 2, 3, 6, 7]])
721         return_data.process_fields(["a", "b", "c", "d"], 0)
722         return_data.process_results([[1, 2, 3, 4]])
723         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
724         return_data.process_results([[1, 2, 3, 8, 9]])
725         return_data.process_fields(["a", "b", "c", "d"], 0)
726         return_data.process_results([[1, 2, 3, 5]])
727         self.assertEqual({1: {2: {3: 5}}}, return_data.result)
728     def test_20A_process_results_complexity_as_list_vary(self):
729         return_data = mysql.MySQLExtPillar()
730         return_data.as_list = True
731         return_data.with_lists = []
732         return_data.enter_root(None)
733         return_data.process_fields(["a", "b", "c", "d", "e"], 0)
734         return_data.process_results([[1, 2, 3, 6, 7]])
735         return_data.process_results([[1, 2, 3, 8, 9]])
736         return_data.process_fields(["a", "b", "c", "d"], 0)
737         return_data.process_results([[1, 2, 3, 4]])
738         return_data.as_list = False
739         return_data.process_results([[1, 2, 3, 5]])
740         self.assertEqual({1: {2: {3: 5}}}, return_data.result)
741     def test_207_process_results_complexity_roots_collision(self):
742         return_data = mysql.MySQLExtPillar()
743         return_data.as_list = False
744         return_data.with_lists = []
745         return_data.enter_root(None)
746         return_data.process_fields(["a", "b", "c", "d"], 0)
747         return_data.process_results([[1, 2, 3, 4]])
748         return_data.enter_root(1)
749         return_data.process_results([[5, 6, 7, 8]])
750         self.assertEqual({1: {5: {6: {7: 8}}}}, return_data.result)
751     def test_301_process_results_with_lists(self):
752         return_data = mysql.MySQLExtPillar()
753         return_data.as_list = False
754         return_data.with_lists = [1, 3]
755         return_data.enter_root(None)
756         return_data.process_fields(["a", "b", "c", "d", "e", "v"], 0)
757         return_data.process_results(
758             [
759                 ["a", "b", "c", "d", "e", 1],
760                 ["a", "b", "c", "f", "g", 2],
761                 ["a", "z", "h", "y", "j", 3],
762                 ["a", "z", "h", "y", "k", 4],
763             ]
764         )
765         assert "a" in return_data.result
766         for x in return_data.result["a"]:
767             if "c" in x:
768                 assert list(x.keys()) == ["c"], x.keys()
769                 for y in x["c"]:
770                     if "e" in y:
771                         assert list(y.keys()) == ["e"]
772                         assert y["e"] == 1
773                     elif "g" in y:
774                         assert list(y.keys()) == ["g"]
775                         assert y["g"] == 2
776                     else:
777                         raise ValueError("Unexpected value {}".format(y))
778             elif "h" in x:
779                 assert len(x["h"]) == 1
780                 for y in x["h"]:
781                     if "j" in y:
782                         assert len(y.keys()) == 2
783                         assert y["j"] == 3
784                     elif "h" in y:
785                         assert len(y.keys()) == 2
786                         assert y["k"] == 4
787                     else:
788                         raise ValueError("Unexpected value {}".format(y))
789             else:
790                 raise ValueError("Unexpected value {}".format(x))
791     def test_302_process_results_with_lists_consecutive(self):
792         return_data = mysql.MySQLExtPillar()
793         return_data.as_list = False
794         return_data.with_lists = [1, 2, 3]
795         return_data.enter_root(None)
796         return_data.process_fields(["a", "b", "c", "d", "e", "v"], 0)
797         return_data.process_results(
798             [
799                 ["a", "b", "c", "d", "e", 1],
800                 ["a", "b", "c", "f", "g", 2],
801                 ["a", "z", "h", "y", "j", 3],
802                 ["a", "z", "h", "y", "k", 4],
803             ]
804         )
805         assert "a" in return_data.result
806         for x in return_data.result["a"]:
807             assert len(x) == 1
808             if len(x[0][0]) == 1:
809                 for y in x[0]:
810                     if "e" in y:
811                         assert list(y.keys()) == ["e"]
812                         assert y["e"] == 1
813                     elif "g" in y:
814                         assert list(y.keys()) == ["g"]
815                         assert y["g"] == 2
816                     else:
817                         raise ValueError("Unexpected value {}".format(y))
818             elif len(x[0][0]) == 2:
819                 for y in x[0]:
820                     if "j" in y:
821                         assert len(y.keys()) == 2
822                         assert y["j"] == 3
823                     elif "k" in y:
824                         assert len(y.keys()) == 2
825                         assert y["k"] == 4
826                     else:
827                         raise ValueError("Unexpected value {}".format(len(x[0][0])))
828             else:
829                 raise ValueError("Unexpected value {}".format(x))
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
