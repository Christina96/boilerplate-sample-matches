<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for moosefs.py & riak.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for moosefs.py & riak.py
      </h3>
      <h1 align="center">
        5.8%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>moosefs.py (5.882353%)<TH>riak.py (5.803571%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match49092-0.html#0',2,'match49092-1.html#0',3)" NAME="0">(5-21)<TD><A HREF="javascript:ZweiFrames('match49092-0.html#0',2,'match49092-1.html#0',3)" NAME="0">(5-20)</A><TD ALIGN=center><FONT COLOR="#ff0000">13</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>moosefs.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
<A NAME="0"></A>Module for gathering and managing information about MooseFS
&quot;&quot;&quot;

<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match49092-1.html#0',3,'match49092-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>import salt.utils.path


def __virtual__():
    &quot;&quot;&quot;
    Only load if the mfs commands are installed
    &quot;&quot;&quot;
    if salt.utils.path.which(&quot;mfsgetgoal&quot;):
        return &quot;moosefs&quot;
    return (
        False,
        &quot;The moosefs execution module cannot be loaded: the mfsgetgoal binary is not in&quot;
        &quot; the path.&quot;,
    )


def</B></FONT> dirinfo(path, opts=None):
    &quot;&quot;&quot;
    Return information on a directory located on the Moose

    CLI Example:

    .. code-block:: bash

        salt '*' moosefs.dirinfo /path/to/dir/ [-[n][h|H]]
    &quot;&quot;&quot;
    cmd = &quot;mfsdirinfo&quot;
    ret = {}
    if opts:
        cmd += &quot; -&quot; + opts
    cmd += &quot; &quot; + path
    out = __salt__[&quot;cmd.run_all&quot;](cmd, python_shell=False)

    output = out[&quot;stdout&quot;].splitlines()
    for line in output:
        if not line:
            continue
        comps = line.split(&quot;:&quot;)
        ret[comps[0].strip()] = comps[1].strip()
    return ret


def fileinfo(path):
    &quot;&quot;&quot;
    Return information on a file located on the Moose

    CLI Example:

    .. code-block:: bash

        salt '*' moosefs.fileinfo /path/to/dir/
    &quot;&quot;&quot;
    cmd = &quot;mfsfileinfo &quot; + path
    ret = {}
    chunknum = &quot;&quot;
    out = __salt__[&quot;cmd.run_all&quot;](cmd, python_shell=False)

    output = out[&quot;stdout&quot;].splitlines()
    for line in output:
        if not line:
            continue
        if &quot;/&quot; in line:
            comps = line.split(&quot;/&quot;)

            chunknum = comps[0].strip().split(&quot;:&quot;)
            meta = comps[1].strip().split(&quot; &quot;)

            chunk = chunknum[0].replace(&quot;chunk &quot;, &quot;&quot;)
            loc = chunknum[1].strip()
            id_ = meta[0].replace(&quot;(id:&quot;, &quot;&quot;)
            ver = meta[1].replace(&quot;)&quot;, &quot;&quot;).replace(&quot;ver:&quot;, &quot;&quot;)

            ret[chunknum[0]] = {
                &quot;chunk&quot;: chunk,
                &quot;loc&quot;: loc,
                &quot;id&quot;: id_,
                &quot;ver&quot;: ver,
            }
        if &quot;copy&quot; in line:
            copyinfo = line.strip().split(&quot;:&quot;)
            ret[chunknum[0]][copyinfo[0]] = {
                &quot;copy&quot;: copyinfo[0].replace(&quot;copy &quot;, &quot;&quot;),
                &quot;ip&quot;: copyinfo[1].strip(),
                &quot;port&quot;: copyinfo[2],
            }
    return ret


def mounts():
    &quot;&quot;&quot;
    Return a list of current MooseFS mounts

    CLI Example:

    .. code-block:: bash

        salt '*' moosefs.mounts
    &quot;&quot;&quot;
    cmd = &quot;mount&quot;
    ret = {}
    out = __salt__[&quot;cmd.run_all&quot;](cmd)

    output = out[&quot;stdout&quot;].splitlines()
    for line in output:
        if not line:
            continue
        if &quot;fuse.mfs&quot; in line:
            comps = line.split(&quot; &quot;)
            info1 = comps[0].split(&quot;:&quot;)
            info2 = info1[1].split(&quot;/&quot;)
            ret[comps[2]] = {
                &quot;remote&quot;: {
                    &quot;master&quot;: info1[0],
                    &quot;port&quot;: info2[0],
                    &quot;subfolder&quot;: &quot;/&quot; + info2[1],
                },
                &quot;local&quot;: comps[2],
                &quot;options&quot;: (comps[5].replace(&quot;(&quot;, &quot;&quot;).replace(&quot;)&quot;, &quot;&quot;).split(&quot;,&quot;)),
            }
    return ret


def getgoal(path, opts=None):
    &quot;&quot;&quot;
    Return goal(s) for a file or directory

    CLI Example:

    .. code-block:: bash

        salt '*' moosefs.getgoal /path/to/file [-[n][h|H]]
        salt '*' moosefs.getgoal /path/to/dir/ [-[n][h|H][r]]
    &quot;&quot;&quot;
    cmd = &quot;mfsgetgoal&quot;
    ret = {}
    if opts:
        cmd += &quot; -&quot; + opts
    else:
        opts = &quot;&quot;
    cmd += &quot; &quot; + path
    out = __salt__[&quot;cmd.run_all&quot;](cmd, python_shell=False)

    output = out[&quot;stdout&quot;].splitlines()
    if &quot;r&quot; not in opts:
        goal = output[0].split(&quot;: &quot;)
        ret = {
            &quot;goal&quot;: goal[1],
        }
    else:
        for line in output:
            if not line:
                continue
            if path in line:
                continue
            comps = line.split()
            keytext = comps[0] + &quot; with goal&quot;
            if keytext not in ret:
                ret[keytext] = {}
            ret[keytext][comps[3]] = comps[5]
    return ret
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>riak.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
<A NAME="0"></A>Riak Salt Module
&quot;&quot;&quot;

<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49092-0.html#0',2,'match49092-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>import salt.utils.path


def __virtual__():
    &quot;&quot;&quot;
    Only available on systems with Riak installed.
    &quot;&quot;&quot;
    if salt.utils.path.which(&quot;riak&quot;):
        return True
    return (
        False,
        &quot;The riak execution module failed to load: the riak binary is not in the path.&quot;,
    )


def</B></FONT> __execute_cmd(name, cmd):
    &quot;&quot;&quot;
    Execute Riak commands
    &quot;&quot;&quot;
    return __salt__[&quot;cmd.run_all&quot;](&quot;{} {}&quot;.format(salt.utils.path.which(name), cmd))


def start():
    &quot;&quot;&quot;
    Start Riak

    CLI Example:

    .. code-block:: bash

        salt '*' riak.start
    &quot;&quot;&quot;
    ret = {&quot;comment&quot;: &quot;&quot;, &quot;success&quot;: False}

    cmd = __execute_cmd(&quot;riak&quot;, &quot;start&quot;)

    if cmd[&quot;retcode&quot;] != 0:
        ret[&quot;comment&quot;] = cmd[&quot;stderr&quot;]
    else:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
        ret[&quot;success&quot;] = True

    return ret


def stop():
    &quot;&quot;&quot;
    Stop Riak

    .. versionchanged:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.stop
    &quot;&quot;&quot;
    ret = {&quot;comment&quot;: &quot;&quot;, &quot;success&quot;: False}

    cmd = __execute_cmd(&quot;riak&quot;, &quot;stop&quot;)

    if cmd[&quot;retcode&quot;] != 0:
        ret[&quot;comment&quot;] = cmd[&quot;stderr&quot;]
    else:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
        ret[&quot;success&quot;] = True

    return ret


def cluster_join(username, hostname):
    &quot;&quot;&quot;
    Join a Riak cluster

    .. versionchanged:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.cluster_join &lt;user&gt; &lt;host&gt;

    username - The riak username to join the cluster
    hostname - The riak hostname you are connecting to
    &quot;&quot;&quot;
    ret = {&quot;comment&quot;: &quot;&quot;, &quot;success&quot;: False}

    cmd = __execute_cmd(&quot;riak-admin&quot;, &quot;cluster join {}@{}&quot;.format(username, hostname))

    if cmd[&quot;retcode&quot;] != 0:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
    else:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
        ret[&quot;success&quot;] = True

    return ret


def cluster_leave(username, hostname):
    &quot;&quot;&quot;
    Leave a Riak cluster

    .. versionadded:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.cluster_leave &lt;username&gt; &lt;host&gt;

    username - The riak username to join the cluster
    hostname - The riak hostname you are connecting to
    &quot;&quot;&quot;
    ret = {&quot;comment&quot;: &quot;&quot;, &quot;success&quot;: False}

    cmd = __execute_cmd(&quot;riak-admin&quot;, &quot;cluster leave {}@{}&quot;.format(username, hostname))

    if cmd[&quot;retcode&quot;] != 0:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
    else:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
        ret[&quot;success&quot;] = True

    return ret


def cluster_plan():
    &quot;&quot;&quot;
    Review Cluster Plan

    .. versionchanged:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.cluster_plan
    &quot;&quot;&quot;
    cmd = __execute_cmd(&quot;riak-admin&quot;, &quot;cluster plan&quot;)

    if cmd[&quot;retcode&quot;] != 0:
        return False

    return True


def cluster_commit():
    &quot;&quot;&quot;
    Commit Cluster Changes

    .. versionchanged:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.cluster_commit
    &quot;&quot;&quot;
    ret = {&quot;comment&quot;: &quot;&quot;, &quot;success&quot;: False}

    cmd = __execute_cmd(&quot;riak-admin&quot;, &quot;cluster commit&quot;)

    if cmd[&quot;retcode&quot;] != 0:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
    else:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
        ret[&quot;success&quot;] = True

    return ret


def member_status():
    &quot;&quot;&quot;
    Get cluster member status

    .. versionchanged:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.member_status
    &quot;&quot;&quot;
    ret = {
        &quot;membership&quot;: {},
        &quot;summary&quot;: {&quot;Valid&quot;: 0, &quot;Leaving&quot;: 0, &quot;Exiting&quot;: 0, &quot;Joining&quot;: 0, &quot;Down&quot;: 0},
    }

    out = __execute_cmd(&quot;riak-admin&quot;, &quot;member-status&quot;)[&quot;stdout&quot;].splitlines()

    for line in out:
        if line.startswith((&quot;=&quot;, &quot;-&quot;, &quot;Status&quot;)):
            continue
        if &quot;/&quot; in line:
            # We're in the summary line
            for item in line.split(&quot;/&quot;):
                key, val = item.split(&quot;:&quot;)
                ret[&quot;summary&quot;][key.strip()] = val.strip()

        if len(line.split()) == 4:
            # We're on a node status line
            (status, ring, pending, node) = line.split()

            ret[&quot;membership&quot;][node] = {
                &quot;Status&quot;: status,
                &quot;Ring&quot;: ring,
                &quot;Pending&quot;: pending,
            }

    return ret


def status():
    &quot;&quot;&quot;
    Current node status

    .. versionadded:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.status
    &quot;&quot;&quot;
    ret = {}

    cmd = __execute_cmd(&quot;riak-admin&quot;, &quot;status&quot;)

    for i in cmd[&quot;stdout&quot;].splitlines():
        if &quot;:&quot; in i:
            (name, val) = i.split(&quot;:&quot;, 1)
            ret[name.strip()] = val.strip()

    return ret


def test():
    &quot;&quot;&quot;
    Runs a test of a few standard Riak operations

    .. versionadded:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.test
    &quot;&quot;&quot;
    ret = {&quot;comment&quot;: &quot;&quot;, &quot;success&quot;: False}

    cmd = __execute_cmd(&quot;riak-admin&quot;, &quot;test&quot;)

    if cmd[&quot;retcode&quot;] != 0:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
    else:
        ret[&quot;comment&quot;] = cmd[&quot;stdout&quot;]
        ret[&quot;success&quot;] = True

    return ret


def services():
    &quot;&quot;&quot;
    List available services on a node

    .. versionadded:: 2015.8.0

    CLI Example:

    .. code-block:: bash

        salt '*' riak.services
    &quot;&quot;&quot;
    cmd = __execute_cmd(&quot;riak-admin&quot;, &quot;services&quot;)

    return cmd[&quot;stdout&quot;][1:-1].split(&quot;,&quot;)
</PRE>
</div>
  </div>
</body>
</html>
