<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for netutil.py &amp; setup.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for netutil.py &amp; setup.py
      </h3>
<h1 align="center">
        1.2%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>netutil.py (2.550091%)<th>setup.py (0.84592146%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(20-35)<td><a href="#" name="0">(21-38)</a><td align="center"><font color="#ff0000">14</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>netutil.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>from __future__ import absolute_import, division, print_function
2 import errno
3 import os
4 import sys
5 import socket
6 import stat
7 from salt.ext.tornado.concurrent import dummy_executor, run_on_executor
8 from salt.ext.tornado.ioloop import IOLoop
9 from salt.ext.tornado.platform.auto import set_close_exec
10 from salt.ext.tornado.util import PY3, Configurable, errno_from_exception
11 try:
12     import ssl
13 e</b></font>xcept ImportError:
14     ssl = None
15 try:
16     import certifi
17 except ImportError:
18     if ssl is None or hasattr(ssl, 'create_default_context'):
19         certifi = None
20     else:
21         raise
22 if PY3:
23     xrange = range
24 if hasattr(ssl, 'match_hostname') and hasattr(ssl, 'CertificateError'):  # python 3.2+
25     ssl_match_hostname = ssl.match_hostname
26     SSLCertificateError = ssl.CertificateError
27 elif ssl is None:
28     ssl_match_hostname = SSLCertificateError = None  # type: ignore
29 else:
30     import backports.ssl_match_hostname
31     ssl_match_hostname = backports.ssl_match_hostname.match_hostname
32     SSLCertificateError = backports.ssl_match_hostname.CertificateError  # type: ignore
33 if hasattr(ssl, 'SSLContext'):
34     if hasattr(ssl, 'create_default_context'):
35         _client_ssl_defaults = ssl.create_default_context(
36             ssl.Purpose.SERVER_AUTH)
37         _server_ssl_defaults = ssl.create_default_context(
38             ssl.Purpose.CLIENT_AUTH)
39     else:
40         _client_ssl_defaults = ssl.SSLContext(ssl.PROTOCOL_SSLv23)
41         _client_ssl_defaults.verify_mode = ssl.CERT_REQUIRED
42         _client_ssl_defaults.load_verify_locations(certifi.where())
43         _server_ssl_defaults = ssl.SSLContext(ssl.PROTOCOL_SSLv23)
44         if hasattr(ssl, 'OP_NO_COMPRESSION'):
45             _client_ssl_defaults.options |= ssl.OP_NO_COMPRESSION
46             _server_ssl_defaults.options |= ssl.OP_NO_COMPRESSION
47 elif ssl:
48     _client_ssl_defaults = dict(cert_reqs=ssl.CERT_REQUIRED,
49                                 ca_certs=certifi.where())
50     _server_ssl_defaults = {}
51 else:
52     _client_ssl_defaults = dict(cert_reqs=None,
53                                 ca_certs=None)
54     _server_ssl_defaults = {}
55 u'foo'.encode('idna')
56 u'foo'.encode('latin1')
57 _ERRNO_WOULDBLOCK = (errno.EWOULDBLOCK, errno.EAGAIN)
58 if hasattr(errno, "WSAEWOULDBLOCK"):
59     _ERRNO_WOULDBLOCK += (errno.WSAEWOULDBLOCK,)  # type: ignore
60 _DEFAULT_BACKLOG = 128
61 def bind_sockets(port, address=None, family=socket.AF_UNSPEC,
62                  backlog=_DEFAULT_BACKLOG, flags=None, reuse_port=False):
63     if reuse_port and not hasattr(socket, "SO_REUSEPORT"):
64         raise ValueError("the platform doesn't support SO_REUSEPORT")
65     sockets = []
66     if address == "":
67         address = None
68     if not socket.has_ipv6 and family == socket.AF_UNSPEC:
69         family = socket.AF_INET
70     if flags is None:
71         flags = socket.AI_PASSIVE
72     bound_port = None
73     for res in set(socket.getaddrinfo(address, port, family, socket.SOCK_STREAM,
74                                       0, flags)):
75         af, socktype, proto, canonname, sockaddr = res
76         if (sys.platform == 'darwin' and address == 'localhost' and
77                 af == socket.AF_INET6 and sockaddr[3] != 0):
78             continue
79         try:
80             sock = socket.socket(af, socktype, proto)
81         except socket.error as e:
82             if errno_from_exception(e) == errno.EAFNOSUPPORT:
83                 continue
84             raise
85         set_close_exec(sock.fileno())
86         if os.name != 'nt':
87             sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
88         if reuse_port:
89             sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEPORT, 1)
90         if af == socket.AF_INET6:
91             if hasattr(socket, "IPPROTO_IPV6"):
92                 sock.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, 1)
93         host, requested_port = sockaddr[:2]
94         if requested_port == 0 and bound_port is not None:
95             sockaddr = tuple([host, bound_port] + list(sockaddr[2:]))
96         sock.setblocking(0)
97         sock.bind(sockaddr)
98         bound_port = sock.getsockname()[1]
99         sock.listen(backlog)
100         sockets.append(sock)
101     return sockets
102 if hasattr(socket, 'AF_UNIX'):
103     def bind_unix_socket(file, mode=0o600, backlog=_DEFAULT_BACKLOG):
104         sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
105         set_close_exec(sock.fileno())
106         sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
107         sock.setblocking(0)
108         try:
109             st = os.stat(file)
110         except OSError as err:
111             if errno_from_exception(err) != errno.ENOENT:
112                 raise
113         else:
114             if stat.S_ISSOCK(st.st_mode):
115                 os.remove(file)
116             else:
117                 raise ValueError("File %s exists and is not a socket", file)
118         sock.bind(file)
119         os.chmod(file, mode)
120         sock.listen(backlog)
121         return sock
122 def add_accept_handler(sock, callback, io_loop=None):
123     if io_loop is None:
124         io_loop = IOLoop.current()
125     def accept_handler(fd, events):
126         for i in xrange(_DEFAULT_BACKLOG):
127             try:
128                 connection, address = sock.accept()
129             except socket.error as e:
130                 if errno_from_exception(e) in _ERRNO_WOULDBLOCK:
131                     return
132                 if errno_from_exception(e) == errno.ECONNABORTED:
133                     continue
134                 raise
135             set_close_exec(connection.fileno())
136             callback(connection, address)
137     io_loop.add_handler(sock, accept_handler, IOLoop.READ)
138 def is_valid_ip(ip):
139     if not ip or '\x00' in ip:
140         return False
141     try:
142         res = socket.getaddrinfo(ip, 0, socket.AF_UNSPEC,
143                                  socket.SOCK_STREAM,
144                                  0, socket.AI_NUMERICHOST)
145         return bool(res)
146     except socket.gaierror as e:
147         if e.args[0] == socket.EAI_NONAME:
148             return False
149         raise
150     return True
151 class Resolver(Configurable):
152     @classmethod
153     def configurable_base(cls):
154         return Resolver
155     @classmethod
156     def configurable_default(cls):
157         return BlockingResolver
158     def resolve(self, host, port, family=socket.AF_UNSPEC, callback=None):
159         raise NotImplementedError()
160     def close(self):
161         pass
162 class ExecutorResolver(Resolver):
163     def initialize(self, io_loop=None, executor=None, close_executor=True):
164         self.io_loop = io_loop or IOLoop.current()
165         if executor is not None:
166             self.executor = executor
167             self.close_executor = close_executor
168         else:
169             self.executor = dummy_executor
170             self.close_executor = False
171     def close(self):
172         if self.close_executor:
173             self.executor.shutdown()
174         self.executor = None
175     @run_on_executor
176     def resolve(self, host, port, family=socket.AF_UNSPEC):
177         addrinfo = socket.getaddrinfo(host, port, family, socket.SOCK_STREAM)
178         results = []
179         for family, socktype, proto, canonname, address in addrinfo:
180             results.append((family, address))
181         return results
182 class BlockingResolver(ExecutorResolver):
183     def initialize(self, io_loop=None):
184         super(BlockingResolver, self).initialize(io_loop=io_loop)
185 class ThreadedResolver(ExecutorResolver):
186     _threadpool = None  # type: ignore
187     _threadpool_pid = None  # type: int
188     def initialize(self, io_loop=None, num_threads=10):
189         threadpool = ThreadedResolver._create_threadpool(num_threads)
190         super(ThreadedResolver, self).initialize(
191             io_loop=io_loop, executor=threadpool, close_executor=False)
192     @classmethod
193     def _create_threadpool(cls, num_threads):
194         pid = os.getpid()
195         if cls._threadpool_pid != pid:
196             cls._threadpool = None
197         if cls._threadpool is None:
198             from concurrent.futures import ThreadPoolExecutor
199             cls._threadpool = ThreadPoolExecutor(num_threads)
200             cls._threadpool_pid = pid
201         return cls._threadpool
202 class OverrideResolver(Resolver):
203     def initialize(self, resolver, mapping):
204         self.resolver = resolver
205         self.mapping = mapping
206     def close(self):
207         self.resolver.close()
208     def resolve(self, host, port, *args, **kwargs):
209         if (host, port) in self.mapping:
210             host, port = self.mapping[(host, port)]
211         elif host in self.mapping:
212             host = self.mapping[host]
213         return self.resolver.resolve(host, port, *args, **kwargs)
214 _SSL_CONTEXT_KEYWORDS = frozenset(['ssl_version', 'certfile', 'keyfile',
215                                    'cert_reqs', 'ca_certs', 'ciphers'])
216 def ssl_options_to_context(ssl_options):
217     if isinstance(ssl_options, dict):
218         assert all(k in _SSL_CONTEXT_KEYWORDS for k in ssl_options), ssl_options
219     if (not hasattr(ssl, 'SSLContext') or
220             isinstance(ssl_options, ssl.SSLContext)):
221         return ssl_options
222     context = ssl.SSLContext(
223         ssl_options.get('ssl_version', ssl.PROTOCOL_SSLv23))
224     if 'certfile' in ssl_options:
225         context.load_cert_chain(ssl_options['certfile'], ssl_options.get('keyfile', None))
226     if 'cert_reqs' in ssl_options:
227         context.verify_mode = ssl_options['cert_reqs']
228     if 'ca_certs' in ssl_options:
229         context.load_verify_locations(ssl_options['ca_certs'])
230     if 'ciphers' in ssl_options:
231         context.set_ciphers(ssl_options['ciphers'])
232     if hasattr(ssl, 'OP_NO_COMPRESSION'):
233         context.options |= ssl.OP_NO_COMPRESSION
234     return context
235 def ssl_wrap_socket(socket, ssl_options, server_hostname=None, **kwargs):
236     context = ssl_options_to_context(ssl_options)
237     if hasattr(ssl, 'SSLContext') and isinstance(context, ssl.SSLContext):
238         if server_hostname is not None and getattr(ssl, 'HAS_SNI'):
239             return context.wrap_socket(socket, server_hostname=server_hostname,
240                                        **kwargs)
241         else:
242             return context.wrap_socket(socket, **kwargs)
243     else:
244         return ssl.wrap_socket(socket, **dict(context, **kwargs))  # type: ignore
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>setup.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import contextlib
2 import distutils.dist
3 import glob
4 import operator
5 import os
6 import platform
7 import sys
8 from ctypes.util import find_library
9 from datetime import datetime
10 from distutils.cmd import Command
11 from distutils.command.build import build
12 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>from distutils.command.clean import clean
13 from distutils.command.install_lib import install_lib
14 from distutils.errors import DistutilsArgError
15 from distutils.version import LooseVersion  # pylint: disable=blacklisted-module
16 import setuptools
17 from setuptools import setup
18 from setuptools.command.bdist_egg import bdist_egg
19 from setuptools.command.develop import develop
20 from setuptools.command.install import install
21 from setuptools.command.sdist import sdist
22 try:
23     from urllib2 import urlopen
24 e</b></font>xcept ImportError:
25     from urllib.request import urlopen  # pylint: disable=no-name-in-module
26 try:
27     from wheel.bdist_wheel import bdist_wheel
28     HAS_BDIST_WHEEL = True
29 except ImportError:
30     HAS_BDIST_WHEEL = False
31 try:
32     import zmq
33     HAS_ZMQ = True
34 except ImportError:
35     HAS_ZMQ = False
36 try:
37     DATE = datetime.utcfromtimestamp(int(os.environ["SOURCE_DATE_EPOCH"]))
38 except (KeyError, ValueError):
39     DATE = datetime.utcnow()
40 try:
41     SETUP_DIRNAME = os.path.dirname(__file__)
42 except NameError:
43     SETUP_DIRNAME = os.path.dirname(sys.argv[0])
44 if SETUP_DIRNAME != "":
45     os.chdir(SETUP_DIRNAME)
46 SETUP_DIRNAME = os.path.abspath(SETUP_DIRNAME)
47 BOOTSTRAP_SCRIPT_DISTRIBUTED_VERSION = os.environ.get(
48     "BOOTSTRAP_SCRIPT_VERSION",
49     "v2014.06.21",
50 )
51 IS_OSX_PLATFORM = sys.platform.startswith("darwin")
52 IS_WINDOWS_PLATFORM = sys.platform.startswith("win")
53 if IS_WINDOWS_PLATFORM or IS_OSX_PLATFORM:
54     IS_SMARTOS_PLATFORM = False
55 else:
56     IS_SMARTOS_PLATFORM = os.uname()[0] == "SunOS" and os.uname()[3].startswith(
57         "joyent_"
58     )
59 USE_STATIC_REQUIREMENTS = os.environ.get("USE_STATIC_REQUIREMENTS")
60 if USE_STATIC_REQUIREMENTS is not None:
61     USE_STATIC_REQUIREMENTS = USE_STATIC_REQUIREMENTS == "1"
62 try:
63     import bbfreeze  # pylint: disable=unused-import
64     from esky import bdist_esky  # pylint: disable=unused-import
65     HAS_ESKY = True
66 except ImportError:
67     HAS_ESKY = False
68 SALT_VERSION = os.path.join(os.path.abspath(SETUP_DIRNAME), "salt", "version.py")
69 SALT_VERSION_HARDCODED = os.path.join(
70     os.path.abspath(SETUP_DIRNAME), "salt", "_version.py"
71 )
72 SALT_SYSPATHS_HARDCODED = os.path.join(
73     os.path.abspath(SETUP_DIRNAME), "salt", "_syspaths.py"
74 )
75 SALT_BASE_REQUIREMENTS = [
76     os.path.join(os.path.abspath(SETUP_DIRNAME), "requirements", "base.txt"),
77     os.path.join(os.path.abspath(SETUP_DIRNAME), "requirements", "zeromq.txt"),
78     os.path.join(os.path.abspath(SETUP_DIRNAME), "requirements", "crypto.txt"),
79 ]
80 SALT_LINUX_LOCKED_REQS = [
81     os.path.join(
82         os.path.abspath(SETUP_DIRNAME),
83         "requirements",
84         "static",
85         "pkg",
86         "py{}.{}".format(*sys.version_info),
87         "linux.txt",
88     )
89 ]
90 SALT_OSX_REQS = SALT_BASE_REQUIREMENTS + [
91     os.path.join(os.path.abspath(SETUP_DIRNAME), "requirements", "darwin.txt")
92 ]
93 SALT_OSX_LOCKED_REQS = [
94     os.path.join(
95         os.path.abspath(SETUP_DIRNAME),
96         "requirements",
97         "static",
98         "pkg",
99         "py{}.{}".format(*sys.version_info),
100         "darwin.txt",
101     )
102 ]
103 SALT_WINDOWS_REQS = SALT_BASE_REQUIREMENTS + [
104     os.path.join(os.path.abspath(SETUP_DIRNAME), "requirements", "windows.txt")
105 ]
106 SALT_WINDOWS_LOCKED_REQS = [
107     os.path.join(
108         os.path.abspath(SETUP_DIRNAME),
109         "requirements",
110         "static",
111         "pkg",
112         "py{}.{}".format(*sys.version_info),
113         "windows.txt",
114     )
115 ]
116 SALT_LONG_DESCRIPTION_FILE = os.path.join(os.path.abspath(SETUP_DIRNAME), "README.rst")
117 PACKAGED_FOR_SALT_SSH_FILE = os.path.join(
118     os.path.abspath(SETUP_DIRNAME), ".salt-ssh-package"
119 )
120 PACKAGED_FOR_SALT_SSH = os.path.isfile(PACKAGED_FOR_SALT_SSH_FILE)
121 exec(compile(open(SALT_VERSION).read(), SALT_VERSION, "exec"))
122 def _parse_op(op):
123     op = op.strip()
124     if "&gt;" in op:
125         if "=" in op:
126             return "ge"
127         else:
128             return "gt"
129     elif "&lt;" in op:
130         if "=" in op:
131             return "le"
132         else:
133             return "lt"
134     elif "!" in op:
135         return "ne"
136     else:
137         return "eq"
138 def _parse_ver(ver):
139     if "#" in ver:
140         ver, _ = ver.split("#", 1)
141         ver = ver.strip()
142     return ver.strip("'").strip('"')
143 def _check_ver(pyver, op, wanted):
144     pyver = distutils.version.LooseVersion(pyver)
145     wanted = distutils.version.LooseVersion(wanted)
146     if not isinstance(pyver, str):
147         pyver = str(pyver)
148     if not isinstance(wanted, str):
149         wanted = str(wanted)
150     return getattr(operator, "__{}__".format(op))(pyver, wanted)
151 def _parse_requirements_file(requirements_file):
152     parsed_requirements = []
153     with open(requirements_file) as rfh:
154         for line in rfh.readlines():
155             line = line.strip()
156             if not line or line.startswith(("#", "-r", "--")):
157                 continue
158             if IS_WINDOWS_PLATFORM:
159                 if "libcloud" in line:
160                     continue
161             try:
162                 pkg, pyverspec = line.rsplit(";", 1)
163             except ValueError:
164                 pkg, pyverspec = line, ""
165             pyverspec = pyverspec.strip()
166             if pyverspec and (
167                 not pkg.startswith("pycrypto") or pkg.startswith("pycryptodome")
168             ):
169                 _, op, ver = pyverspec.split(" ", 2)
170                 if not _check_ver(
171                     platform.python_version(), _parse_op(op), _parse_ver(ver)
172                 ):
173                     continue
174             parsed_requirements.append(line)
175     return parsed_requirements
176 class WriteSaltVersion(Command):
177     description = "Write salt's hardcoded version file"
178     user_options = []
179     def initialize_options(self):
180     def finalize_options(self):
181     def run(self):
182         if (
183             not os.path.exists(SALT_VERSION_HARDCODED)
184             or self.distribution.with_salt_version
185         ):
186             if getattr(self.distribution, "salt_version_hardcoded_path", None) is None:
187                 self.distribution.salt_version_hardcoded_path = SALT_VERSION_HARDCODED
188                 sys.stderr.write("This command is not meant to be called on it's own\n")
189                 sys.stderr.flush()
190             if not self.distribution.with_salt_version:
191                 salt_version = (
192                     __saltstack_version__  # pylint: disable=undefined-variable
193                 )
194             else:
195                 from salt.version import SaltStackVersion
196                 salt_version = SaltStackVersion.parse(
197                     self.distribution.with_salt_version
198                 )
199             open(self.distribution.salt_version_hardcoded_path, "w").write(
200                 INSTALL_VERSION_TEMPLATE.format(
201                     date=DATE, full_version_info=salt_version.full_info_all_versions
202                 )
203             )
204 class GenerateSaltSyspaths(Command):
205     description = "Generate salt's hardcoded syspaths file"
206     def initialize_options(self):
207         pass
208     def finalize_options(self):
209         pass
210     def run(self):
211         if getattr(self.distribution, "salt_syspaths_hardcoded_path", None) is None:
212             print("This command is not meant to be called on it's own")
213             exit(1)
214         open(self.distribution.salt_syspaths_hardcoded_path, "w").write(
215             INSTALL_SYSPATHS_TEMPLATE.format(
216                 date=DATE,
217                 root_dir=self.distribution.salt_root_dir,
218                 share_dir=self.distribution.salt_share_dir,
219                 config_dir=self.distribution.salt_config_dir,
220                 cache_dir=self.distribution.salt_cache_dir,
221                 sock_dir=self.distribution.salt_sock_dir,
222                 srv_root_dir=self.distribution.salt_srv_root_dir,
223                 base_file_roots_dir=self.distribution.salt_base_file_roots_dir,
224                 base_pillar_roots_dir=self.distribution.salt_base_pillar_roots_dir,
225                 base_master_roots_dir=self.distribution.salt_base_master_roots_dir,
226                 base_thorium_roots_dir=self.distribution.salt_base_thorium_roots_dir,
227                 logs_dir=self.distribution.salt_logs_dir,
228                 pidfile_dir=self.distribution.salt_pidfile_dir,
229                 spm_parent_path=self.distribution.salt_spm_parent_dir,
230                 spm_formula_path=self.distribution.salt_spm_formula_dir,
231                 spm_pillar_path=self.distribution.salt_spm_pillar_dir,
232                 spm_reactor_path=self.distribution.salt_spm_reactor_dir,
233                 home_dir=self.distribution.salt_home_dir,
234             )
235         )
236 class WriteSaltSshPackagingFile(Command):
237     description = "Write salt's ssh packaging file"
238     user_options = []
239     def initialize_options(self):
240     def finalize_options(self):
241     def run(self):
242         if not os.path.exists(PACKAGED_FOR_SALT_SSH_FILE):
243             if getattr(self.distribution, "salt_ssh_packaging_file", None) is None:
244                 print("This command is not meant to be called on it's own")
245                 exit(1)
246             open(self.distribution.salt_ssh_packaging_file, "w").write(
247                 "Packaged for Salt-SSH\n"
248             )
249 class Develop(develop):
250     user_options = develop.user_options + [
251         (
252             "write-salt-version",
253             None,
254             "Generate Salt's _version.py file which allows proper version "
255             "reporting. This defaults to False on develop/editable setups. "
256             "If WRITE_SALT_VERSION is found in the environment this flag is "
257             "switched to True.",
258         ),
259         (
260             "generate-salt-syspaths",
261             None,
262             "Generate Salt's _syspaths.py file which allows tweaking some "
263             "common paths that salt uses. This defaults to False on "
264             "develop/editable setups. If GENERATE_SALT_SYSPATHS is found in "
265             "the environment this flag is switched to True.",
266         ),
267         (
268             "mimic-salt-install",
269             None,
270             "Mimmic the install command when running the develop command. "
271             "This will generate salt's _version.py and _syspaths.py files. "
272             "Generate Salt's _syspaths.py file which allows tweaking some "
273             "This defaults to False on develop/editable setups. "
274             "If MIMIC_INSTALL is found in the environment this flag is "
275             "switched to True.",
276         ),
277     ]
278     boolean_options = develop.boolean_options + [
279         "write-salt-version",
280         "generate-salt-syspaths",
281         "mimic-salt-install",
282     ]
283     def initialize_options(self):
284         develop.initialize_options(self)
285         self.write_salt_version = False
286         self.generate_salt_syspaths = False
287         self.mimic_salt_install = False
288     def finalize_options(self):
289         develop.finalize_options(self)
290         if "WRITE_SALT_VERSION" in os.environ:
291             self.write_salt_version = True
292         if "GENERATE_SALT_SYSPATHS" in os.environ:
293             self.generate_salt_syspaths = True
294         if "MIMIC_SALT_INSTALL" in os.environ:
295             self.mimic_salt_install = True
296         if self.mimic_salt_install:
297             self.write_salt_version = True
298             self.generate_salt_syspaths = True
299     def run(self):
300         if IS_WINDOWS_PLATFORM:
301             self.distribution.salt_download_windows_dlls = True
302             self.run_command("download-windows-dlls")
303             self.distribution.salt_download_windows_dlls = None
304         if self.write_salt_version is True:
305             self.distribution.running_salt_install = True
306             self.distribution.salt_version_hardcoded_path = SALT_VERSION_HARDCODED
307             self.run_command("write_salt_version")
308         if self.generate_salt_syspaths:
309             self.distribution.salt_syspaths_hardcoded_path = SALT_SYSPATHS_HARDCODED
310             self.run_command("generate_salt_syspaths")
311         develop.run(self)
312 class DownloadWindowsDlls(Command):
313     description = "Download required DLL's for windows"
314     def initialize_options(self):
315         pass
316     def finalize_options(self):
317         pass
318     def run(self):
319         if getattr(self.distribution, "salt_download_windows_dlls", None) is None:
320             print("This command is not meant to be called on it's own")
321             exit(1)
322         try:
323             import pip
324             if LooseVersion(pip.__version__) &lt; LooseVersion("10.0"):
325                 from pip.utils.logging import indent_log
326             else:
327                 from pip._internal.utils.logging import (  # pylint: disable=no-name-in-module
328                     indent_log,
329                 )
330         except ImportError:
331             @contextlib.contextmanager
332             def indent_log():
333                 yield
334         platform_bits, _ = platform.architecture()
335         url = "https://repo.saltproject.io/windows/dependencies/{bits}/{fname}"
336         dest = os.path.join(os.path.dirname(sys.executable), "{fname}")
337         with indent_log():
338             for fname in (
339                 "openssl/1.1.1k/ssleay32.dll",
340                 "openssl/1.1.1k/libeay32.dll",
341                 "libsodium/1.0.18/libsodium.dll",
342             ):
343                 if find_library(fname):
344                     continue
345                 furl = url.format(bits=platform_bits[:2], fname=fname)
346                 fdest = dest.format(fname=os.path.basename(fname))
347                 if not os.path.exists(fdest):
348                     log.info("Downloading {} to {} from {}".format(fname, fdest, furl))
349                     try:
350                         from contextlib import closing
351                         import requests
352                         with closing(requests.get(furl, stream=True)) as req:
353                             if req.status_code == 200:
354                                 with open(fdest, "wb") as wfh:
355                                     for chunk in req.iter_content(chunk_size=4096):
356                                         if chunk:  # filter out keep-alive new chunks
357                                             wfh.write(chunk)
358                                             wfh.flush()
359                             else:
360                                 log.error(
361                                     "Failed to download {} to {} from {}".format(
362                                         fname, fdest, furl
363                                     )
364                                 )
365                     except ImportError:
366                         req = urlopen(furl)
367                         if req.getcode() == 200:
368                             with open(fdest, "wb") as wfh:
369                                 while True:
370                                     chunk = req.read(4096)
371                                     if not chunk:
372                                         break
373                                     wfh.write(chunk)
374                                     wfh.flush()
375                         else:
376                             log.error(
377                                 "Failed to download {} to {} from {}".format(
378                                     fname, fdest, furl
379                                 )
380                             )
381 class Sdist(sdist):
382     def make_release_tree(self, base_dir, files):
383         if self.distribution.ssh_packaging:
384             self.distribution.salt_ssh_packaging_file = PACKAGED_FOR_SALT_SSH_FILE
385             self.run_command("write_salt_ssh_packaging_file")
386             self.filelist.files.append(os.path.basename(PACKAGED_FOR_SALT_SSH_FILE))
387         sdist.make_release_tree(self, base_dir, files)
388         self.distribution.running_salt_sdist = True
389         self.distribution.salt_version_hardcoded_path = os.path.join(
390             base_dir, "salt", "_version.py"
391         )
392         self.run_command("write_salt_version")
393     def make_distribution(self):
394         sdist.make_distribution(self)
395         if self.distribution.ssh_packaging:
396             os.unlink(PACKAGED_FOR_SALT_SSH_FILE)
397 class BDistEgg(bdist_egg):
398     def finalize_options(self):
399         bdist_egg.finalize_options(self)
400         self.distribution.build_egg = True
401         if not self.skip_build:
402             self.run_command("build")
403 class CloudSdist(Sdist):  # pylint: disable=too-many-ancestors
404     user_options = Sdist.user_options + [
405         (
406             "download-bootstrap-script",
407             None,
408             "Download the latest stable bootstrap-salt.sh script. This "
409             "can also be triggered by having `DOWNLOAD_BOOTSTRAP_SCRIPT=1` as an "
410             "environment variable.",
411         )
412     ]
413     boolean_options = Sdist.boolean_options + ["download-bootstrap-script"]
414     def initialize_options(self):
415         Sdist.initialize_options(self)
416         self.skip_bootstrap_download = True
417         self.download_bootstrap_script = False
418     def finalize_options(self):
419         Sdist.finalize_options(self)
420         if "SKIP_BOOTSTRAP_DOWNLOAD" in os.environ:
421             log(
422                 "Please stop using 'SKIP_BOOTSTRAP_DOWNLOAD' and use "
423                 "'DOWNLOAD_BOOTSTRAP_SCRIPT' instead"
424             )
425         if "DOWNLOAD_BOOTSTRAP_SCRIPT" in os.environ:
426             download_bootstrap_script = os.environ.get("DOWNLOAD_BOOTSTRAP_SCRIPT", "0")
427             self.download_bootstrap_script = download_bootstrap_script == "1"
428     def run(self):
429         if self.download_bootstrap_script is True:
430             url = (
431                 "https://github.com/saltstack/salt-bootstrap/raw/{}"
432                 "/bootstrap-salt.sh".format(BOOTSTRAP_SCRIPT_DISTRIBUTED_VERSION)
433             )
434             deploy_path = os.path.join(
435                 SETUP_DIRNAME, "salt", "cloud", "deploy", "bootstrap-salt.sh"
436             )
437             log.info(
438                 "Updating bootstrap-salt.sh."
439                 "\n\tSource:      {}"
440                 "\n\tDestination: {}".format(url, deploy_path)
441             )
442             try:
443                 import requests
444                 req = requests.get(url)
445                 if req.status_code == 200:
446                     script_contents = req.text.encode(req.encoding)
447                 else:
448                     log.error(
449                         "Failed to update the bootstrap-salt.sh script. HTTP "
450                         "Error code: {}".format(req.status_code)
451                     )
452             except ImportError:
453                 req = urlopen(url)
454                 if req.getcode() == 200:
455                     script_contents = req.read()
456                 else:
457                     log.error(
458                         "Failed to update the bootstrap-salt.sh script. HTTP "
459                         "Error code: {}".format(req.getcode())
460                     )
461             try:
462                 with open(deploy_path, "w") as fp_:
463                     fp_.write(script_contents)
464             except OSError as err:
465                 log.error("Failed to write the updated script: {}".format(err))
466         Sdist.run(self)
467     def write_manifest(self):
468         dist_scripts = self.distribution.scripts
469         for script in self.filelist.files[:]:
470             if not script.startswith("scripts/"):
471                 continue
472             if script not in dist_scripts:
473                 self.filelist.files.remove(script)
474         return Sdist.write_manifest(self)
475 class TestCommand(Command):
476     description = "Run tests"
477     user_options = [
478         ("runtests-opts=", "R", "Command line options to pass to runtests.py")
479     ]
480     def initialize_options(self):
481         self.runtests_opts = None
482     def finalize_options(self):
483     def run(self):
484         import subprocess
485         self.run_command("build")
486         build_cmd = self.get_finalized_command("build_ext")
487         runner = os.path.abspath("tests/runtests.py")
488         test_cmd = [sys.executable, runner]
489         if self.runtests_opts:
490             test_cmd.extend(self.runtests_opts.split())
491         print("running test")
492         ret = subprocess.run(
493             test_cmd,
494             stdout=sys.stdout,
495             stderr=sys.stderr,
496             cwd=build_cmd.build_lib,
497             check=False,
498         )
499         sys.exit(ret.returncode)
500 class Clean(clean):
501     def run(self):
502         clean.run(self)
503         for subdir in ("salt", "tests", "doc"):
504             root = os.path.join(os.path.dirname(__file__), subdir)
505             for dirname, _, _ in os.walk(root):
506                 for to_remove_filename in glob.glob("{}/*.py[oc]".format(dirname)):
507                     os.remove(to_remove_filename)
508 if HAS_BDIST_WHEEL:
509     class BDistWheel(bdist_wheel):
510         def finalize_options(self):
511             bdist_wheel.finalize_options(self)
512             self.distribution.build_wheel = True
513 INSTALL_VERSION_TEMPLATE = """\
514 from salt.version import SaltStackVersion
515 __saltstack_version__ = SaltStackVersion{full_version_info!r}
516 class Build(build):
517     def run(self):
518         build.run(self)
519         salt_build_ver_file = os.path.join(self.build_lib, "salt", "_version.py")
520         if getattr(self.distribution, "with_salt_version", False):
521             self.distribution.salt_version_hardcoded_path = salt_build_ver_file
522             self.run_command("write_salt_version")
523         if getattr(self.distribution, "build_egg", False):
524             self.distribution.salt_version_hardcoded_path = salt_build_ver_file
525             self.run_command("write_salt_version")
526         if getattr(self.distribution, "build_wheel", False):
527             self.distribution.salt_version_hardcoded_path = salt_build_ver_file
528             self.run_command("write_salt_version")
529         if getattr(self.distribution, "running_salt_install", False):
530             self.run_command("write_salt_version")
531             self.distribution.salt_syspaths_hardcoded_path = os.path.join(
532                 self.build_lib, "salt", "_syspaths.py"
533             )
534             self.run_command("generate_salt_syspaths")
535 class Install(install):
536     def initialize_options(self):
537         install.initialize_options(self)
538     def finalize_options(self):
539         install.finalize_options(self)
540     def run(self):
541         if LooseVersion(setuptools.__version__) &lt; LooseVersion("9.1"):
542             sys.stderr.write(
543                 "\n\nInstalling Salt requires setuptools &gt;= 9.1\n"
544                 "Available setuptools version is {}\n\n".format(setuptools.__version__)
545             )
546             sys.stderr.flush()
547             sys.exit(1)
548         self.distribution.running_salt_install = True
549         self.distribution.salt_version_hardcoded_path = os.path.join(
550             self.build_lib, "salt", "_version.py"
551         )
552         if IS_WINDOWS_PLATFORM:
553             self.distribution.salt_download_windows_dlls = True
554             self.run_command("download-windows-dlls")
555             self.distribution.salt_download_windows_dlls = None
556         if not os.path.exists(os.path.join(self.build_lib)):
557             if not self.skip_build:
558                 self.run_command("build")
559         else:
560             self.run_command("write_salt_version")
561         install.run(self)
562     @staticmethod
563     def _called_from_setup(run_frame):
564         if run_frame is None:
565             return install._called_from_setup(run_frame)
566         first_call = install._called_from_setup(run_frame)
567         if first_call:
568             return True
569         second_call = install._called_from_setup(run_frame.f_back)
570         if second_call is None:
571             return first_call
572         return second_call
573 class InstallLib(install_lib):
574     def run(self):
575         executables = [
576             "salt/templates/git/ssh-id-wrapper",
577             "salt/templates/lxc/salt_tarball",
578         ]
579         install_lib.run(self)
580         inp = self.get_inputs()
581         out = self.get_outputs()
582         chmod = []
583         for idx, inputfile in enumerate(inp):
584             for executable in executables:
585                 if inputfile.endswith(executable):
586                     chmod.append(idx)
587         for idx in chmod:
588             filename = out[idx]
589             os.chmod(filename, 0o755)
590 class SaltDistribution(distutils.dist.Distribution):
591     global_options = (
592         distutils.dist.Distribution.global_options
593         + [
594             ("ssh-packaging", None, "Run in SSH packaging mode"),
595             (
596                 "salt-transport=",
597                 None,
598                 "The transport to prepare salt for. Currently, the only choice "
599                 "is 'zeromq'. This may be expanded in the future. Defaults to "
600                 "'zeromq'",
601                 "zeromq",
602             ),
603         ]
604         + [
605             (
606                 "with-salt-version=",
607                 None,
608                 "Set a fixed version for Salt instead calculating it",
609             ),
610             ("salt-root-dir=", None, "Salt's pre-configured root directory"),
611             ("salt-share-dir=", None, "Salt's pre-configured share directory"),
612             ("salt-config-dir=", None, "Salt's pre-configured configuration directory"),
613             ("salt-cache-dir=", None, "Salt's pre-configured cache directory"),
614             ("salt-sock-dir=", None, "Salt's pre-configured socket directory"),
615             ("salt-srv-root-dir=", None, "Salt's pre-configured service directory"),
616             (
617                 "salt-base-file-roots-dir=",
618                 None,
619                 "Salt's pre-configured file roots directory",
620             ),
621             (
622                 "salt-base-pillar-roots-dir=",
623                 None,
624                 "Salt's pre-configured pillar roots directory",
625             ),
626             (
627                 "salt-base-master-roots-dir=",
628                 None,
629                 "Salt's pre-configured master roots directory",
630             ),
631             ("salt-logs-dir=", None, "Salt's pre-configured logs directory"),
632             ("salt-pidfile-dir=", None, "Salt's pre-configured pidfiles directory"),
633             (
634                 "salt-spm-formula-dir=",
635                 None,
636                 "Salt's pre-configured SPM formulas directory",
637             ),
638             (
639                 "salt-spm-pillar-dir=",
640                 None,
641                 "Salt's pre-configured SPM pillar directory",
642             ),
643             (
644                 "salt-spm-reactor-dir=",
645                 None,
646                 "Salt's pre-configured SPM reactor directory",
647             ),
648             ("salt-home-dir=", None, "Salt's pre-configured user home directory"),
649         ]
650     )
651     def __init__(self, attrs=None):
652         distutils.dist.Distribution.__init__(self, attrs)
653         self.ssh_packaging = PACKAGED_FOR_SALT_SSH
654         self.salt_transport = None
655         self.salt_root_dir = None
656         self.salt_share_dir = None
657         self.salt_config_dir = None
658         self.salt_cache_dir = None
659         self.salt_sock_dir = None
660         self.salt_srv_root_dir = None
661         self.salt_base_file_roots_dir = None
662         self.salt_base_thorium_roots_dir = None
663         self.salt_base_pillar_roots_dir = None
664         self.salt_base_master_roots_dir = None
665         self.salt_logs_dir = None
666         self.salt_pidfile_dir = None
667         self.salt_spm_parent_dir = None
668         self.salt_spm_formula_dir = None
669         self.salt_spm_pillar_dir = None
670         self.salt_spm_reactor_dir = None
671         self.salt_home_dir = None
672         self.with_salt_version = None
673         self.name = "salt-ssh" if PACKAGED_FOR_SALT_SSH else "salt"
674         self.salt_version = __version__  # pylint: disable=undefined-variable
675         self.description = (
676             "Portable, distributed, remote execution and configuration management"
677             " system"
678         )
679         with open(SALT_LONG_DESCRIPTION_FILE, encoding="utf-8") as f:
680             self.long_description = f.read()
681         self.long_description_content_type = "text/x-rst"
682         self.python_requires = "&gt;=3.5"
683         self.classifiers = [
684             "Programming Language :: Python",
685             "Programming Language :: Cython",
686             "Programming Language :: Python :: 3",
687             "Programming Language :: Python :: 3 :: Only",
688             "Programming Language :: Python :: 3.5",
689             "Programming Language :: Python :: 3.6",
690             "Programming Language :: Python :: 3.7",
691             "Programming Language :: Python :: 3.8",
692             "Programming Language :: Python :: 3.9",
693             "Development Status :: 5 - Production/Stable",
694             "Environment :: Console",
695             "Intended Audience :: Developers",
696             "Intended Audience :: Information Technology",
697             "Intended Audience :: System Administrators",
698             "License :: OSI Approved :: Apache Software License",
699             "Operating System :: POSIX :: Linux",
700             "Topic :: System :: Clustering",
701             "Topic :: System :: Distributed Computing",
702         ]
703         self.author = "Thomas S Hatch"
704         self.author_email = "thatch45@gmail.com"
705         self.url = "https://saltproject.io"
706         self.cmdclass.update(
707             {
708                 "test": TestCommand,
709                 "clean": Clean,
710                 "build": Build,
711                 "sdist": Sdist,
712                 "bdist_egg": BDistEgg,
713                 "install": Install,
714                 "develop": Develop,
715                 "write_salt_version": WriteSaltVersion,
716                 "generate_salt_syspaths": GenerateSaltSyspaths,
717                 "write_salt_ssh_packaging_file": WriteSaltSshPackagingFile,
718             }
719         )
720         if not IS_WINDOWS_PLATFORM:
721             self.cmdclass.update({"sdist": CloudSdist, "install_lib": InstallLib})
722         if IS_WINDOWS_PLATFORM:
723             self.cmdclass.update({"download-windows-dlls": DownloadWindowsDlls})
724         if HAS_BDIST_WHEEL:
725             self.cmdclass["bdist_wheel"] = BDistWheel
726         self.license = "Apache Software License 2.0"
727         self.packages = self.discover_packages()
728         self.zip_safe = False
729         if HAS_ESKY:
730             self.setup_esky()
731         self.update_metadata()
732     def update_metadata(self):
733         for attrname in dir(self):
734             if attrname.startswith("__"):
735                 continue
736             attrvalue = getattr(self, attrname, None)
737             if attrvalue == 0:
738                 continue
739             if attrname == "salt_version":
740                 attrname = "version"
741             if hasattr(self.metadata, "set_{}".format(attrname)):
742                 getattr(self.metadata, "set_{}".format(attrname))(attrvalue)
743             elif hasattr(self.metadata, attrname):
744                 try:
745                     setattr(self.metadata, attrname, attrvalue)
746                 except AttributeError:
747                     pass
748     def discover_packages(self):
749         modules = []
750         for root, _, files in os.walk(os.path.join(SETUP_DIRNAME, "salt")):
751             if "__init__.py" not in files:
752                 continue
753             modules.append(os.path.relpath(root, SETUP_DIRNAME).replace(os.sep, "."))
754         return modules
755     @property
756     def _property_dependency_links(self):
757         return [
758             "https://github.com/saltstack/salt-testing/tarball/develop#egg=SaltTesting"
759         ]
760     @property
761     def _property_tests_require(self):
762         return ["SaltTesting"]
763     @property
764     def _property_package_data(self):
765         package_data = {
766             "salt.templates": [
767                 "rh_ip/*.jinja",
768                 "debian_ip/*.jinja",
769                 "virt/*.jinja",
770                 "git/*",
771                 "lxc/*",
772             ]
773         }
774         if not IS_WINDOWS_PLATFORM:
775             package_data["salt.cloud"] = ["deploy/*.sh"]
776         if not self.ssh_packaging and not PACKAGED_FOR_SALT_SSH:
777             package_data["salt.daemons.flo"] = ["*.flo"]
778         return package_data
779     @property
780     def _property_data_files(self):
781         data_files = [
782             ("share/man/man1", ["doc/man/salt-call.1", "doc/man/salt-run.1"]),
783             ("share/man/man7", ["doc/man/salt.7"]),
784         ]
785         if self.ssh_packaging or PACKAGED_FOR_SALT_SSH:
786             data_files[0][1].append("doc/man/salt-ssh.1")
787             if IS_WINDOWS_PLATFORM:
788                 return data_files
789             data_files[0][1].append("doc/man/salt-cloud.1")
790             return data_files
791         if IS_WINDOWS_PLATFORM:
792             data_files[0][1].extend(
793                 [
794                     "doc/man/salt-api.1",
795                     "doc/man/salt-cp.1",
796                     "doc/man/salt-key.1",
797                     "doc/man/salt-minion.1",
798                     "doc/man/salt-syndic.1",
799                     "doc/man/spm.1",
800                 ]
801             )
802             return data_files
803         data_files[0][1].extend(
804             [
805                 "doc/man/salt-api.1",
806                 "doc/man/salt-cloud.1",
807                 "doc/man/salt-cp.1",
808                 "doc/man/salt-key.1",
809                 "doc/man/salt-master.1",
810                 "doc/man/salt-minion.1",
811                 "doc/man/salt-proxy.1",
812                 "doc/man/spm.1",
813                 "doc/man/salt.1",
814                 "doc/man/salt-ssh.1",
815                 "doc/man/salt-syndic.1",
816             ]
817         )
818         return data_files
819     @property
820     def _property_install_requires(self):
821         install_requires = []
822         if USE_STATIC_REQUIREMENTS is True:
823             if IS_OSX_PLATFORM:
824                 for reqfile in SALT_OSX_LOCKED_REQS:
825                     install_requires += _parse_requirements_file(reqfile)
826             elif IS_WINDOWS_PLATFORM:
827                 for reqfile in SALT_WINDOWS_LOCKED_REQS:
828                     install_requires += _parse_requirements_file(reqfile)
829             else:
830                 for reqfile in SALT_LINUX_LOCKED_REQS:
831                     install_requires += _parse_requirements_file(reqfile)
832             return install_requires
833         elif USE_STATIC_REQUIREMENTS is False:
834             if IS_OSX_PLATFORM:
835                 for reqfile in SALT_OSX_REQS:
836                     install_requires += _parse_requirements_file(reqfile)
837             elif IS_WINDOWS_PLATFORM:
838                 for reqfile in SALT_WINDOWS_REQS:
839                     install_requires += _parse_requirements_file(reqfile)
840             else:
841                 for reqfile in SALT_BASE_REQUIREMENTS:
842                     install_requires += _parse_requirements_file(reqfile)
843         else:
844             if IS_OSX_PLATFORM:
845                 for reqfile in SALT_OSX_LOCKED_REQS:
846                     install_requires += _parse_requirements_file(reqfile)
847             elif IS_WINDOWS_PLATFORM:
848                 for reqfile in SALT_WINDOWS_LOCKED_REQS:
849                     install_requires += _parse_requirements_file(reqfile)
850             else:
851                 for reqfile in SALT_BASE_REQUIREMENTS:
852                     install_requires += _parse_requirements_file(reqfile)
853         return install_requires
854     @property
855     def _property_scripts(self):
856         scripts = ["scripts/salt-call", "scripts/salt-run"]
857         if self.ssh_packaging or PACKAGED_FOR_SALT_SSH:
858             scripts.append("scripts/salt-ssh")
859             if IS_WINDOWS_PLATFORM:
860                 return scripts
861             scripts.extend(["scripts/salt-cloud", "scripts/spm"])
862             return scripts
863         if IS_WINDOWS_PLATFORM:
864             scripts.extend(
865                 [
866                     "scripts/salt-api",
867                     "scripts/salt-cp",
868                     "scripts/salt-key",
869                     "scripts/salt-minion",
870                     "scripts/salt-syndic",
871                     "scripts/spm",
872                 ]
873             )
874             return scripts
875         scripts.extend(
876             [
877                 "scripts/salt",
878                 "scripts/salt-api",
879                 "scripts/salt-cloud",
880                 "scripts/salt-cp",
881                 "scripts/salt-key",
882                 "scripts/salt-master",
883                 "scripts/salt-minion",
884                 "scripts/salt-proxy",
885                 "scripts/salt-ssh",
886                 "scripts/salt-syndic",
887                 "scripts/spm",
888             ]
889         )
890         return scripts
891     @property
892     def _property_entry_points(self):
893         scripts = [
894             "salt-call = salt.scripts:salt_call",
895             "salt-run = salt.scripts:salt_run",
896         ]
897         if self.ssh_packaging or PACKAGED_FOR_SALT_SSH:
898             scripts.append("salt-ssh = salt.scripts:salt_ssh")
899             if IS_WINDOWS_PLATFORM:
900                 return {"console_scripts": scripts}
901             scripts.append("salt-cloud = salt.scripts:salt_cloud")
902             return {"console_scripts": scripts}
903         if IS_WINDOWS_PLATFORM:
904             scripts.extend(
905                 [
906                     "salt-api = salt.scripts:salt_api",
907                     "salt-cp = salt.scripts:salt_cp",
908                     "salt-key = salt.scripts:salt_key",
909                     "salt-minion = salt.scripts:salt_minion",
910                     "salt-syndic = salt.scripts:salt_syndic",
911                     "spm = salt.scripts:salt_spm",
912                 ]
913             )
914             return {"console_scripts": scripts}
915         scripts.extend(
916             [
917                 "salt = salt.scripts:salt_main",
918                 "salt-api = salt.scripts:salt_api",
919                 "salt-cloud = salt.scripts:salt_cloud",
920                 "salt-cp = salt.scripts:salt_cp",
921                 "salt-key = salt.scripts:salt_key",
922                 "salt-master = salt.scripts:salt_master",
923                 "salt-minion = salt.scripts:salt_minion",
924                 "salt-ssh = salt.scripts:salt_ssh",
925                 "salt-syndic = salt.scripts:salt_syndic",
926                 "spm = salt.scripts:salt_spm",
927             ]
928         )
929         return {"console_scripts": scripts}
930     def setup_esky(self):
931         opt_dict = self.get_option_dict("bdist_esky")
932         opt_dict["freezer_module"] = ("setup script", "bbfreeze")
933         opt_dict["freezer_options"] = (
934             "setup script",
935             {"includes": self.get_esky_freezer_includes()},
936         )
937     @property
938     def _property_freezer_options(self):
939         return {"includes": self.get_esky_freezer_includes()}
940     def get_esky_freezer_includes(self):
941         freezer_includes = [
942             "zmq.core.*",
943             "zmq.utils.*",
944             "ast",
945             "csv",
946             "difflib",
947             "distutils",
948             "distutils.version",
949             "numbers",
950             "json",
951             "M2Crypto",
952             "Cookie",
953             "asyncore",
954             "fileinput",
955             "sqlite3",
956             "email",
957             "email.mime.*",
958             "requests",
959             "sqlite3",
960         ]
961         if HAS_ZMQ and hasattr(zmq, "pyzmq_version_info"):
962             if HAS_ZMQ and zmq.pyzmq_version_info() &gt;= (0, 14):
963                 if "zmq.core.*" in freezer_includes:
964                     freezer_includes.remove("zmq.core.*")
965         if IS_WINDOWS_PLATFORM:
966             freezer_includes.extend(
967                 [
968                     "imp",
969                     "win32api",
970                     "win32file",
971                     "win32con",
972                     "win32com",
973                     "win32net",
974                     "win32netcon",
975                     "win32gui",
976                     "win32security",
977                     "ntsecuritycon",
978                     "pywintypes",
979                     "pythoncom",
980                     "_winreg",
981                     "wmi",
982                     "site",
983                     "psutil",
984                     "pytz",
985                 ]
986             )
987         elif IS_SMARTOS_PLATFORM:
988             freezer_includes.extend(
989                 ["cherrypy", "python-dateutil", "pyghmi", "croniter", "mako", "gnupg"]
990             )
991         elif sys.platform.startswith("linux"):
992             freezer_includes.append("spwd")
993             try:
994                 import yum  # pylint: disable=unused-import
995                 freezer_includes.append("yum")
996             except ImportError:
997                 pass
998         elif sys.platform.startswith("sunos"):
999             try:
1000                 from bbfreeze.modulegraph.modulegraph import ModuleGraph
1001                 mgraph = ModuleGraph(sys.path[:])
1002                 for arg in glob.glob("salt/modules/*.py"):
1003                     mgraph.run_script(arg)
1004                 for mod in mgraph.flatten():
1005                     if type(mod).__name__ != "Script" and mod.filename:
1006                         freezer_includes.append(str(os.path.basename(mod.identifier)))
1007             except ImportError:
1008                 pass
1009         return freezer_includes
1010     def parse_command_line(self):
1011         args = distutils.dist.Distribution.parse_command_line(self)
1012         if not self.ssh_packaging and PACKAGED_FOR_SALT_SSH:
1013             self.ssh_packaging = 1
1014         if self.ssh_packaging:
1015             self.metadata.name = "salt-ssh"
1016             self.salt_transport = "ssh"
1017         elif self.salt_transport is None:
1018             self.salt_transport = "zeromq"
1019         if self.salt_transport not in ("zeromq", "both", "ssh", "none"):
1020             raise DistutilsArgError(
1021                 "The value of --salt-transport needs be 'zeromq', "
1022                 "'both', 'ssh', or 'none' not '{}'".format(self.salt_transport)
1023             )
1024         for funcname in dir(self):
1025             if not funcname.startswith("_property_"):
1026                 continue
1027             property_name = funcname.split("_property_", 1)[-1]
1028             setattr(self, property_name, getattr(self, funcname))
1029         return args
1030 if __name__ == "__main__":
1031     setup(distclass=SaltDistribution)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
