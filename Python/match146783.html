<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_win_autoruns.py & test_keystone_2.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_win_autoruns.py & test_keystone_2.py
      </h3>
      <h1 align="center">
        2.4%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_win_autoruns.py (25.0%)<TH>test_keystone_2.py (1.2618296%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match146783-0.html#0',2,'match146783-1.html#0',3)" NAME="0">(11-22)<TD><A HREF="javascript:ZweiFrames('match146783-0.html#0',2,'match146783-1.html#0',3)" NAME="0">(201-213)</A><TD ALIGN=center><FONT COLOR="#ff0000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_win_autoruns.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;


import pytest
import salt.modules.win_autoruns as win_autoruns
<A NAME="0"></A>from tests.support.mock import MagicMock, patch


<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match146783-1.html#0',3,'match146783-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>@pytest.fixture
def define_key():
    return [
        &quot;HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run&quot;,
        &quot;HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /reg:64&quot;,
        &quot;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run&quot;,
    ]


@pytest.fixture
def configure_loader_modules():
    return {wi</B></FONT>n_autoruns: {}}


def test_list(define_key):
    &quot;&quot;&quot;
    Test if it enables win_autoruns the service on the server
    &quot;&quot;&quot;
    with patch(&quot;os.listdir&quot;, MagicMock(return_value=[])):
        ret = {
            define_key[0]: [&quot;SALT&quot;],
            define_key[1]: [&quot;SALT&quot;],
            define_key[2]: [&quot;SALT&quot;],
        }
        mock = MagicMock(return_value=&quot;Windows 7&quot;)
        with patch.dict(win_autoruns.__grains__, {&quot;osfullname&quot;: mock}):
            mock = MagicMock(return_value=&quot;SALT&quot;)
            with patch.dict(win_autoruns.__salt__, {&quot;cmd.run&quot;: mock}):
                assert win_autoruns.list_() == ret
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_keystone_2.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;

import salt.modules.config as config
import salt.modules.keystone as keystone
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, call, patch
from tests.support.unit import TestCase


class MockEC2:
    &quot;&quot;&quot;
    Mock of EC2 class
    &quot;&quot;&quot;

    def __init__(self):
        self.access = &quot;&quot;
        self.secret = &quot;&quot;
        self.tenant_id = &quot;&quot;
        self.user_id = &quot;&quot;
        self.connection_args = &quot;&quot;
        self.profile = &quot;&quot;

    @staticmethod
    def create(userid, tenantid):
        &quot;&quot;&quot;
        Mock of create method
        &quot;&quot;&quot;
        cr_ec2 = MockEC2()
        cr_ec2.tenant_id = tenantid
        cr_ec2.user_id = userid
        return cr_ec2

    def delete(self, userid, accesskey):
        &quot;&quot;&quot;
        Mock of delete method
        &quot;&quot;&quot;
        self.access = accesskey
        self.user_id = userid
        return True

    @staticmethod
    def get(user_id, access, profile, **connection_args):
        &quot;&quot;&quot;
        Mock of get method
        &quot;&quot;&quot;
        cr_ec2 = MockEC2()
        cr_ec2.profile = profile
        cr_ec2.access = access
        cr_ec2.user_id = user_id
        cr_ec2.connection_args = connection_args
        return cr_ec2

    @staticmethod
    def list(user_id):
        &quot;&quot;&quot;
        Mock of list method
        &quot;&quot;&quot;
        cr_ec2 = MockEC2()
        cr_ec2.user_id = user_id
        return [cr_ec2]


class MockEndpoints:
    &quot;&quot;&quot;
    Mock of Endpoints class
    &quot;&quot;&quot;

    def __init__(self):
        self.id = &quot;007&quot;
        self.region = &quot;RegionOne&quot;
        self.adminurl = &quot;adminurl&quot;
        self.internalurl = &quot;internalurl&quot;
        self.publicurl = &quot;publicurl&quot;
        self.service_id = &quot;117&quot;

    @staticmethod
    def list():
        &quot;&quot;&quot;
        Mock of list method
        &quot;&quot;&quot;
        return [MockEndpoints()]

    @staticmethod
    def create(region, service_id, publicurl, adminurl, internalurl):
        &quot;&quot;&quot;
        Mock of create method
        &quot;&quot;&quot;
        return (region, service_id, publicurl, adminurl, internalurl)

    @staticmethod
    def delete(id):
        &quot;&quot;&quot;
        Mock of delete method
        &quot;&quot;&quot;
        return id


class MockServices:
    &quot;&quot;&quot;
    Mock of Services class
    &quot;&quot;&quot;

    flag = None

    def __init__(self):
        self.id = &quot;117&quot;
        self.name = &quot;iptables&quot;
        self.description = &quot;description&quot;
        self.type = &quot;type&quot;

    @staticmethod
    def create(name, service_type, description):
        &quot;&quot;&quot;
        Mock of create method
        &quot;&quot;&quot;
        service = MockServices()
        service.id = &quot;005&quot;
        service.name = name
        service.description = description
        service.type = service_type
        return service

    def get(self, service_id):
        &quot;&quot;&quot;
        Mock of get method
        &quot;&quot;&quot;
        service = MockServices()
        if self.flag == 1:
            service.id = &quot;asd&quot;
            return [service]
        elif self.flag == 2:
            service.id = service_id
            return service
        return [service]

    def list(self):
        &quot;&quot;&quot;
        Mock of list method
        &quot;&quot;&quot;
        service = MockServices()
        if self.flag == 1:
            service.id = &quot;asd&quot;
            return [service]
        return [service]

    @staticmethod
    def delete(service_id):
        &quot;&quot;&quot;
        Mock of delete method
        &quot;&quot;&quot;
        return service_id


class MockRoles:
    &quot;&quot;&quot;
    Mock of Roles class
    &quot;&quot;&quot;

    flag = None

    def __init__(self):
        self.id = &quot;113&quot;
        self.name = &quot;nova&quot;
        self.user_id = &quot;446&quot;
        self.tenant_id = &quot;a1a1&quot;

    @staticmethod
    def create(name):
        &quot;&quot;&quot;
        Mock of create method
        &quot;&quot;&quot;
        return name

    def get(self, role_id):
        &quot;&quot;&quot;
        Mock of get method
        &quot;&quot;&quot;
        role = MockRoles()
        if self.flag == 1:
            role.id = None
            return role
        role.id = role_id
        return role

    @staticmethod
    def list():
        &quot;&quot;&quot;
        Mock of list method
        &quot;&quot;&quot;
        return [MockRoles()]

    @staticmethod
    def delete(role):
        &quot;&quot;&quot;
        Mock of delete method
<A NAME="0"></A>        &quot;&quot;&quot;
        return role

    <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match146783-0.html#0',2,'match146783-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>@staticmethod
    def add_user_role(user_id, role_id, tenant_id):
        &quot;&quot;&quot;
        Mock of add_user_role method
        &quot;&quot;&quot;
        return (user_id, role_id, tenant_id)

    @staticmethod
    def remove_user_role(user_id, role_id, tenant_id):
        &quot;&quot;&quot;
        Mock of remove_user_role method
        &quot;&quot;&quot;
        return (us</B></FONT>er_id, role_id, tenant_id)

    @staticmethod
    def roles_for_user(user, tenant):
        &quot;&quot;&quot;
        Mock of roles_for_user method
        &quot;&quot;&quot;
        role = MockRoles()
        role.user_id = user
        role.tenant_id = tenant
        return [role]


class MockTenants:
    &quot;&quot;&quot;
    Mock of Tenants class
    &quot;&quot;&quot;

    flag = None

    def __init__(self):
        self.id = &quot;446&quot;
        self.name = &quot;nova&quot;
        self.description = &quot;description&quot;
        self.enabled = &quot;True&quot;

    @staticmethod
    def create(name, description, enabled):
        &quot;&quot;&quot;
        Mock of create method
        &quot;&quot;&quot;
        tenant = MockTenants()
        tenant.name = name
        tenant.description = description
        tenant.enabled = enabled
        return tenant

    def get(self, tenant_id):
        &quot;&quot;&quot;
        Mock of get method
        &quot;&quot;&quot;
        tenant = MockTenants()
        if self.flag == 1:
            tenant.id = None
            return tenant
        tenant.id = tenant_id
        return tenant

    @staticmethod
    def list():
        &quot;&quot;&quot;
        Mock of list method
        &quot;&quot;&quot;
        return [MockTenants()]

    @staticmethod
    def delete(tenant_id):
        &quot;&quot;&quot;
        Mock of delete method
        &quot;&quot;&quot;
        return tenant_id


class MockServiceCatalog:
    &quot;&quot;&quot;
    Mock of ServiceCatalog class
    &quot;&quot;&quot;

    def __init__(self):
        self.id = &quot;446&quot;
        self.expires = &quot;No&quot;
        self.user_id = &quot;admin&quot;
        self.tenant_id = &quot;ae04&quot;

    def get_token(self):
        &quot;&quot;&quot;
        Mock of get_token method
        &quot;&quot;&quot;
        return {
            &quot;id&quot;: self.id,
            &quot;expires&quot;: self.expires,
            &quot;user_id&quot;: self.user_id,
            &quot;tenant_id&quot;: self.tenant_id,
        }


class MockUsers:
    &quot;&quot;&quot;
    Mock of Users class
    &quot;&quot;&quot;

    flag = None

    def __init__(self):
        self.id = &quot;446&quot;
        self.name = &quot;nova&quot;
        self.email = &quot;salt@saltstack.com&quot;
        self.enabled = &quot;True&quot;
        self.tenant_id = &quot;a1a1&quot;
        self.password = &quot;salt&quot;

    def create(self, name, password, email, tenant_id, enabled):
        &quot;&quot;&quot;
        Mock of create method
        &quot;&quot;&quot;
        user = MockUsers()
        user.name = name
        user.password = password
        user.email = email
        user.enabled = enabled
        self.tenant_id = tenant_id
        return user

    def get(self, user_id):
        &quot;&quot;&quot;
        Mock of get method
        &quot;&quot;&quot;
        user = MockUsers()
        if self.flag == 1:
            user.id = None
            return user
        user.id = user_id
        return user

    @staticmethod
    def list():
        &quot;&quot;&quot;
        Mock of list method
        &quot;&quot;&quot;
        return [MockUsers()]

    @staticmethod
    def delete(user_id):
        &quot;&quot;&quot;
        Mock of delete method
        &quot;&quot;&quot;
        return user_id

    @staticmethod
    def update(user, name, email, enabled):
        &quot;&quot;&quot;
        Mock of update method
        &quot;&quot;&quot;
        return (user, name, email, enabled)

    @staticmethod
    def update_password(user, password):
        &quot;&quot;&quot;
        Mock of update_password method
        &quot;&quot;&quot;
        return (user, password)


class Unauthorized(Exception):
    &quot;&quot;&quot;
    The base exception class for all exceptions.
    &quot;&quot;&quot;

    def __init__(self, message=&quot;Test&quot;):
        super().__init__(message)
        self.msg = message


class AuthorizationFailure(Exception):
    &quot;&quot;&quot;
    Additional exception class to Unauthorized.
    &quot;&quot;&quot;

    def __init__(self, message=&quot;Test&quot;):
        super().__init__(message)
        self.msg = message


class MockExceptions:
    &quot;&quot;&quot;
    Mock of exceptions class
    &quot;&quot;&quot;

    def __init__(self):
        self.Unauthorized = Unauthorized
        self.AuthorizationFailure = AuthorizationFailure


class MockKeystoneClient:
    &quot;&quot;&quot;
    Mock of keystoneclient module
    &quot;&quot;&quot;

    def __init__(self):
        self.exceptions = MockExceptions()


class MockClient:
    &quot;&quot;&quot;
    Mock of Client class
    &quot;&quot;&quot;

    flag = None

    def __init__(self, profile=None, **conn_args):
        self.ec2 = MockEC2()
        self.endpoints = MockEndpoints()
        self.services = MockServices()
        self.roles = MockRoles()
        self.tenants = MockTenants()
        self.service_catalog = MockServiceCatalog()
        self.users = MockUsers()

    def Client(self, **kwargs):
        &quot;&quot;&quot;
        Mock of Client method
        &quot;&quot;&quot;
        if self.flag == 1:
            raise Unauthorized
        return True


class KeystoneTestCase(TestCase, LoaderModuleMockMixin):
    &quot;&quot;&quot;
    Test cases for salt.modules.keystone
    &quot;&quot;&quot;

    def setup_loader_modules(self):
        return {
            keystone: {
                &quot;auth&quot;: MockClient,
                &quot;client&quot;: MockClient(),
                &quot;keystoneclient&quot;: MockKeystoneClient(),
                &quot;__salt__&quot;: {&quot;config.get&quot;: config.get},
                &quot;__opts__&quot;: {},
            },
            config: {&quot;__opts__&quot;: {}},
        }

    # 'ec2_credentials_create' function tests: 1

    def test_ec2_credentials_create(self):
        &quot;&quot;&quot;
        Test if it create EC2-compatible credentials for user per tenant
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.ec2_credentials_create(), {&quot;Error&quot;: &quot;Could not resolve User ID&quot;}
        )

        self.assertDictEqual(
            keystone.ec2_credentials_create(user_id=&quot;salt&quot;),
            {&quot;Error&quot;: &quot;Could not resolve Tenant ID&quot;},
        )

        self.assertDictEqual(
            keystone.ec2_credentials_create(user_id=&quot;salt&quot;, tenant_id=&quot;72278&quot;),
            {&quot;access&quot;: &quot;&quot;, &quot;tenant_id&quot;: &quot;72278&quot;, &quot;secret&quot;: &quot;&quot;, &quot;user_id&quot;: &quot;salt&quot;},
        )

    # 'ec2_credentials_delete' function tests: 1

    def test_ec2_credentials_delete(self):
        &quot;&quot;&quot;
        Test if it delete EC2-compatible credentials
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.ec2_credentials_delete(), {&quot;Error&quot;: &quot;Could not resolve User ID&quot;}
        )

        self.assertEqual(
            keystone.ec2_credentials_delete(user_id=&quot;salt&quot;, access_key=&quot;72278&quot;),
            'ec2 key &quot;72278&quot; deleted under user id &quot;salt&quot;',
        )

    # 'ec2_credentials_get' function tests: 1

    def test_ec2_credentials_get(self):
        &quot;&quot;&quot;
        Test if it return ec2_credentials for a user
        (keystone ec2-credentials-get)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.ec2_credentials_get(), {&quot;Error&quot;: &quot;Unable to resolve user id&quot;}
        )

        self.assertDictEqual(
            keystone.ec2_credentials_get(user_id=&quot;salt&quot;),
            {&quot;Error&quot;: &quot;Access key is required&quot;},
        )

        self.assertDictEqual(
            keystone.ec2_credentials_get(
                user_id=&quot;salt&quot;, access=&quot;72278&quot;, profile=&quot;openstack1&quot;
            ),
            {
                &quot;salt&quot;: {
                    &quot;access&quot;: &quot;72278&quot;,
                    &quot;secret&quot;: &quot;&quot;,
                    &quot;tenant&quot;: &quot;&quot;,
                    &quot;user_id&quot;: &quot;salt&quot;,
                }
            },
        )

    # 'ec2_credentials_list' function tests: 1

    def test_ec2_credentials_list(self):
        &quot;&quot;&quot;
        Test if it return a list of ec2_credentials
        for a specific user (keystone ec2-credentials-list)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.ec2_credentials_list(), {&quot;Error&quot;: &quot;Unable to resolve user id&quot;}
        )

        self.assertDictEqual(
            keystone.ec2_credentials_list(user_id=&quot;salt&quot;, profile=&quot;openstack1&quot;),
            {&quot;salt&quot;: {&quot;access&quot;: &quot;&quot;, &quot;secret&quot;: &quot;&quot;, &quot;tenant_id&quot;: &quot;&quot;, &quot;user_id&quot;: &quot;salt&quot;}},
        )

    # 'endpoint_get' function tests: 1

    def test_endpoint_get(self):
        &quot;&quot;&quot;
        Test if it return a specific endpoint (keystone endpoint-get)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.endpoint_get(&quot;nova&quot;, &quot;RegionOne&quot;, profile=&quot;openstack&quot;),
            {&quot;Error&quot;: &quot;Could not find the specified service&quot;},
        )

        ret = {&quot;Error&quot;: &quot;Could not find endpoint for the specified service&quot;}
        MockServices.flag = 1
        self.assertDictEqual(
            keystone.endpoint_get(&quot;iptables&quot;, &quot;RegionOne&quot;, profile=&quot;openstack&quot;), ret
        )

        MockServices.flag = 0
        self.assertDictEqual(
            keystone.endpoint_get(&quot;iptables&quot;, &quot;RegionOne&quot;, profile=&quot;openstack&quot;),
            {
                &quot;adminurl&quot;: &quot;adminurl&quot;,
                &quot;id&quot;: &quot;007&quot;,
                &quot;internalurl&quot;: &quot;internalurl&quot;,
                &quot;publicurl&quot;: &quot;publicurl&quot;,
                &quot;region&quot;: &quot;RegionOne&quot;,
                &quot;service_id&quot;: &quot;117&quot;,
            },
        )

    # 'endpoint_list' function tests: 1

    def test_endpoint_list(self):
        &quot;&quot;&quot;
        Test if it return a list of available endpoints
        (keystone endpoints-list)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.endpoint_list(profile=&quot;openstack1&quot;),
            {
                &quot;007&quot;: {
                    &quot;adminurl&quot;: &quot;adminurl&quot;,
                    &quot;id&quot;: &quot;007&quot;,
                    &quot;internalurl&quot;: &quot;internalurl&quot;,
                    &quot;publicurl&quot;: &quot;publicurl&quot;,
                    &quot;region&quot;: &quot;RegionOne&quot;,
                    &quot;service_id&quot;: &quot;117&quot;,
                }
            },
        )

    # 'endpoint_create' function tests: 1

    def test_endpoint_create(self):
        &quot;&quot;&quot;
        Test if it create an endpoint for an Openstack service
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.endpoint_create(&quot;nova&quot;),
            {&quot;Error&quot;: &quot;Could not find the specified service&quot;},
        )

        MockServices.flag = 2
        self.assertDictEqual(
            keystone.endpoint_create(
                &quot;iptables&quot;,
                &quot;http://public/url&quot;,
                &quot;http://internal/url&quot;,
                &quot;http://adminurl/url&quot;,
                &quot;RegionOne&quot;,
            ),
            {
                &quot;adminurl&quot;: &quot;adminurl&quot;,
                &quot;id&quot;: &quot;007&quot;,
                &quot;internalurl&quot;: &quot;internalurl&quot;,
                &quot;publicurl&quot;: &quot;publicurl&quot;,
                &quot;region&quot;: &quot;RegionOne&quot;,
                &quot;service_id&quot;: &quot;117&quot;,
            },
        )

    # 'endpoint_delete' function tests: 1

    def test_endpoint_delete(self):
        &quot;&quot;&quot;
        Test if it delete an endpoint for an Openstack service
        &quot;&quot;&quot;
        ret = {&quot;Error&quot;: &quot;Could not find any endpoints for the service&quot;}
        self.assertDictEqual(keystone.endpoint_delete(&quot;nova&quot;, &quot;RegionOne&quot;), ret)

        with patch.object(
            keystone, &quot;endpoint_get&quot;, MagicMock(side_effect=[{&quot;id&quot;: &quot;117&quot;}, None])
        ):
            self.assertTrue(keystone.endpoint_delete(&quot;iptables&quot;, &quot;RegionOne&quot;))

    # 'role_create' function tests: 1

    def test_role_create(self):
        &quot;&quot;&quot;
        Test if it create named role
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.role_create(&quot;nova&quot;), {&quot;Error&quot;: 'Role &quot;nova&quot; already exists'}
        )

        self.assertDictEqual(
            keystone.role_create(&quot;iptables&quot;), {&quot;Error&quot;: &quot;Unable to resolve role id&quot;}
        )

    # 'role_delete' function tests: 1

    def test_role_delete(self):
        &quot;&quot;&quot;
        Test if it delete a role (keystone role-delete)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.role_delete(), {&quot;Error&quot;: &quot;Unable to resolve role id&quot;}
        )

        self.assertEqual(keystone.role_delete(&quot;iptables&quot;), &quot;Role ID iptables deleted&quot;)

    # 'role_get' function tests: 1

    def test_role_get(self):
        &quot;&quot;&quot;
        Test if it return a specific roles (keystone role-get)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.role_get(), {&quot;Error&quot;: &quot;Unable to resolve role id&quot;}
        )

        self.assertDictEqual(
            keystone.role_get(name=&quot;nova&quot;), {&quot;nova&quot;: {&quot;id&quot;: &quot;113&quot;, &quot;name&quot;: &quot;nova&quot;}}
        )

    # 'role_list' function tests: 1

    def test_role_list(self):
        &quot;&quot;&quot;
        Test if it return a list of available roles (keystone role-list)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.role_list(),
            {
                &quot;nova&quot;: {
                    &quot;id&quot;: &quot;113&quot;,
                    &quot;name&quot;: &quot;nova&quot;,
                    &quot;tenant_id&quot;: &quot;a1a1&quot;,
                    &quot;user_id&quot;: &quot;446&quot;,
                }
            },
        )

    # 'service_create' function tests: 1

    def test_service_create(self):
        &quot;&quot;&quot;
        Test if it add service to Keystone service catalog
        &quot;&quot;&quot;
        MockServices.flag = 2
        self.assertDictEqual(
            keystone.service_create(&quot;nova&quot;, &quot;compute&quot;, &quot;OpenStack Service&quot;),
            {
                &quot;iptables&quot;: {
                    &quot;description&quot;: &quot;description&quot;,
                    &quot;id&quot;: &quot;005&quot;,
                    &quot;name&quot;: &quot;iptables&quot;,
                    &quot;type&quot;: &quot;type&quot;,
                }
            },
        )

    # 'service_delete' function tests: 1

    def test_service_delete(self):
        &quot;&quot;&quot;
        Test if it delete a service from Keystone service catalog
        &quot;&quot;&quot;
        self.assertEqual(
            keystone.service_delete(&quot;iptables&quot;),
            'Keystone service ID &quot;iptables&quot; deleted',
        )

    # 'service_get' function tests: 1

    def test_service_get(self):
        &quot;&quot;&quot;
        Test if it return a list of available services (keystone services-list)
        &quot;&quot;&quot;
        MockServices.flag = 0
        self.assertDictEqual(
            keystone.service_get(), {&quot;Error&quot;: &quot;Unable to resolve service id&quot;}
        )

        MockServices.flag = 2
        self.assertDictEqual(
            keystone.service_get(service_id=&quot;c965&quot;),
            {
                &quot;iptables&quot;: {
                    &quot;description&quot;: &quot;description&quot;,
                    &quot;id&quot;: &quot;c965&quot;,
                    &quot;name&quot;: &quot;iptables&quot;,
                    &quot;type&quot;: &quot;type&quot;,
                }
            },
        )

    # 'service_list' function tests: 1

    def test_service_list(self):
        &quot;&quot;&quot;
        Test if it return a list of available services (keystone services-list)
        &quot;&quot;&quot;
        MockServices.flag = 0
        self.assertDictEqual(
            keystone.service_list(profile=&quot;openstack1&quot;),
            {
                &quot;iptables&quot;: {
                    &quot;description&quot;: &quot;description&quot;,
                    &quot;id&quot;: &quot;117&quot;,
                    &quot;name&quot;: &quot;iptables&quot;,
                    &quot;type&quot;: &quot;type&quot;,
                }
            },
        )

    # 'tenant_create' function tests: 1

    def test_tenant_create(self):
        &quot;&quot;&quot;
        Test if it create a keystone tenant
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.tenant_create(&quot;nova&quot;),
            {
                &quot;nova&quot;: {
                    &quot;description&quot;: &quot;description&quot;,
                    &quot;id&quot;: &quot;446&quot;,
                    &quot;name&quot;: &quot;nova&quot;,
                    &quot;enabled&quot;: &quot;True&quot;,
                }
            },
        )

    # 'tenant_delete' function tests: 1

    def test_tenant_delete(self):
        &quot;&quot;&quot;
        Test if it delete a tenant (keystone tenant-delete)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.tenant_delete(), {&quot;Error&quot;: &quot;Unable to resolve tenant id&quot;}
        )

        self.assertEqual(keystone.tenant_delete(&quot;nova&quot;), &quot;Tenant ID nova deleted&quot;)

    # 'tenant_get' function tests: 1

    def test_tenant_get(self):
        &quot;&quot;&quot;
        Test if it return a specific tenants (keystone tenant-get)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.tenant_get(), {&quot;Error&quot;: &quot;Unable to resolve tenant id&quot;}
        )

        self.assertDictEqual(
            keystone.tenant_get(tenant_id=&quot;446&quot;),
            {
                &quot;nova&quot;: {
                    &quot;description&quot;: &quot;description&quot;,
                    &quot;id&quot;: &quot;446&quot;,
                    &quot;name&quot;: &quot;nova&quot;,
                    &quot;enabled&quot;: &quot;True&quot;,
                }
            },
        )

    # 'tenant_list' function tests: 1

    def test_tenant_list(self):
        &quot;&quot;&quot;
        Test if it return a list of available tenants (keystone tenants-list)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.tenant_list(),
            {
                &quot;nova&quot;: {
                    &quot;description&quot;: &quot;description&quot;,
                    &quot;id&quot;: &quot;446&quot;,
                    &quot;name&quot;: &quot;nova&quot;,
                    &quot;enabled&quot;: &quot;True&quot;,
                }
            },
        )

    # 'tenant_update' function tests: 1

    def test_tenant_update(self):
        &quot;&quot;&quot;
        Test if it update a tenant's information (keystone tenant-update)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.tenant_update(), {&quot;Error&quot;: &quot;Unable to resolve tenant id&quot;}
        )

    # 'token_get' function tests: 1

    def test_token_get(self):
        &quot;&quot;&quot;
        Test if it return the configured tokens (keystone token-get)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.token_get(),
            {&quot;expires&quot;: &quot;No&quot;, &quot;id&quot;: &quot;446&quot;, &quot;tenant_id&quot;: &quot;ae04&quot;, &quot;user_id&quot;: &quot;admin&quot;},
        )

    # 'user_list' function tests: 1

    def test_user_list(self):
        &quot;&quot;&quot;
        Test if it return a list of available users (keystone user-list)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.user_list(),
            {
                &quot;nova&quot;: {
                    &quot;name&quot;: &quot;nova&quot;,
                    &quot;tenant_id&quot;: &quot;a1a1&quot;,
                    &quot;enabled&quot;: &quot;True&quot;,
                    &quot;id&quot;: &quot;446&quot;,
                    &quot;password&quot;: &quot;salt&quot;,
                    &quot;email&quot;: &quot;salt@saltstack.com&quot;,
                }
            },
        )

    # 'user_get' function tests: 1

    def test_user_get(self):
        &quot;&quot;&quot;
        Test if it return a specific users (keystone user-get)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.user_get(), {&quot;Error&quot;: &quot;Unable to resolve user id&quot;}
        )

        self.assertDictEqual(
            keystone.user_get(user_id=&quot;446&quot;),
            {
                &quot;nova&quot;: {
                    &quot;name&quot;: &quot;nova&quot;,
                    &quot;tenant_id&quot;: &quot;a1a1&quot;,
                    &quot;enabled&quot;: &quot;True&quot;,
                    &quot;id&quot;: &quot;446&quot;,
                    &quot;password&quot;: &quot;salt&quot;,
                    &quot;email&quot;: &quot;salt@saltstack.com&quot;,
                }
            },
        )

    # 'user_create' function tests: 1

    def test_user_create(self):
        &quot;&quot;&quot;
        Test if it create a user (keystone user-create)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.user_create(
                name=&quot;nova&quot;,
                password=&quot;salt&quot;,
                email=&quot;salt@saltstack.com&quot;,
                tenant_id=&quot;a1a1&quot;,
            ),
            {
                &quot;nova&quot;: {
                    &quot;name&quot;: &quot;nova&quot;,
                    &quot;tenant_id&quot;: &quot;a1a1&quot;,
                    &quot;enabled&quot;: &quot;True&quot;,
                    &quot;id&quot;: &quot;446&quot;,
                    &quot;password&quot;: &quot;salt&quot;,
                    &quot;email&quot;: &quot;salt@saltstack.com&quot;,
                }
            },
        )

    # 'user_delete' function tests: 1

    def test_user_delete(self):
        &quot;&quot;&quot;
        Test if it delete a user (keystone user-delete)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.user_delete(), {&quot;Error&quot;: &quot;Unable to resolve user id&quot;}
        )

        self.assertEqual(keystone.user_delete(&quot;nova&quot;), &quot;User ID nova deleted&quot;)

    # 'user_update' function tests: 1

    def test_user_update(self):
        &quot;&quot;&quot;
        Test if it update a user's information (keystone user-update)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.user_update(), {&quot;Error&quot;: &quot;Unable to resolve user id&quot;}
        )

        self.assertEqual(keystone.user_update(&quot;nova&quot;), &quot;Info updated for user ID nova&quot;)

    # 'user_verify_password' function tests: 1

    def test_user_verify_password(self):
        &quot;&quot;&quot;
        Test if it verify a user's password
        &quot;&quot;&quot;
        mock = MagicMock(return_value=&quot;http://127.0.0.1:35357/v2.0&quot;)
        with patch.dict(keystone.__salt__, {&quot;config.option&quot;: mock}):
            self.assertDictEqual(
                keystone.user_verify_password(),
                {&quot;Error&quot;: &quot;Unable to resolve user name&quot;},
            )

            self.assertTrue(keystone.user_verify_password(user_id=&quot;446&quot;, name=&quot;nova&quot;))

            MockClient.flag = 1
            self.assertFalse(keystone.user_verify_password(user_id=&quot;446&quot;, name=&quot;nova&quot;))

    # 'user_password_update' function tests: 1

    def test_user_password_update(self):
        &quot;&quot;&quot;
        Test if it update a user's password (keystone user-password-update)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.user_password_update(), {&quot;Error&quot;: &quot;Unable to resolve user id&quot;}
        )

        self.assertEqual(
            keystone.user_password_update(&quot;nova&quot;), &quot;Password updated for user ID nova&quot;
        )

    # 'user_role_add' function tests: 1

    def test_user_role_add(self):
        &quot;&quot;&quot;
        Test if it add role for user in tenant (keystone user-role-add)
        &quot;&quot;&quot;
        self.assertEqual(
            keystone.user_role_add(user=&quot;nova&quot;, tenant=&quot;nova&quot;, role=&quot;nova&quot;),
            '&quot;nova&quot; role added for user &quot;nova&quot; for &quot;nova&quot; tenant/project',
        )

        MockRoles.flag = 1
        self.assertDictEqual(
            keystone.user_role_add(user=&quot;nova&quot;, tenant=&quot;nova&quot;, role=&quot;nova&quot;),
            {&quot;Error&quot;: &quot;Unable to resolve role id&quot;},
        )

        MockTenants.flag = 1
        self.assertDictEqual(
            keystone.user_role_add(user=&quot;nova&quot;, tenant=&quot;nova&quot;),
            {&quot;Error&quot;: &quot;Unable to resolve tenant/project id&quot;},
        )

        MockUsers.flag = 1
        self.assertDictEqual(
            keystone.user_role_add(user=&quot;nova&quot;), {&quot;Error&quot;: &quot;Unable to resolve user id&quot;}
        )

    # 'user_role_remove' function tests: 1

    def test_user_role_remove(self):
        &quot;&quot;&quot;
        Test if it add role for user in tenant (keystone user-role-add)
        &quot;&quot;&quot;
        MockUsers.flag = 1
        self.assertDictEqual(
            keystone.user_role_remove(user=&quot;nova&quot;),
            {&quot;Error&quot;: &quot;Unable to resolve user id&quot;},
        )

        MockUsers.flag = 0
        MockTenants.flag = 1
        self.assertDictEqual(
            keystone.user_role_remove(user=&quot;nova&quot;, tenant=&quot;nova&quot;),
            {&quot;Error&quot;: &quot;Unable to resolve tenant/project id&quot;},
        )

        MockTenants.flag = 0
        MockRoles.flag = 1
        self.assertDictEqual(
            keystone.user_role_remove(user=&quot;nova&quot;, tenant=&quot;nova&quot;, role=&quot;nova&quot;),
            {&quot;Error&quot;: &quot;Unable to resolve role id&quot;},
        )

        ret = '&quot;nova&quot; role removed for user &quot;nova&quot; under &quot;nova&quot; tenant'
        MockRoles.flag = 0
        self.assertEqual(
            keystone.user_role_remove(user=&quot;nova&quot;, tenant=&quot;nova&quot;, role=&quot;nova&quot;), ret
        )

    # 'user_role_list' function tests: 1

    def test_user_role_list(self):
        &quot;&quot;&quot;
        Test if it return a list of available user_roles
        (keystone user-roles-list)
        &quot;&quot;&quot;
        self.assertDictEqual(
            keystone.user_role_list(user=&quot;nova&quot;),
            {&quot;Error&quot;: &quot;Unable to resolve user or tenant/project id&quot;},
        )

        self.assertDictEqual(
            keystone.user_role_list(user_name=&quot;nova&quot;, tenant_name=&quot;nova&quot;),
            {
                &quot;nova&quot;: {
                    &quot;id&quot;: &quot;113&quot;,
                    &quot;name&quot;: &quot;nova&quot;,
                    &quot;tenant_id&quot;: &quot;446&quot;,
                    &quot;user_id&quot;: &quot;446&quot;,
                }
            },
        )

    def test_api_version_verify_ssl(self):
        &quot;&quot;&quot;
        test api_version when using verify_ssl
        &quot;&quot;&quot;
        test_verify = [True, False, None]
        conn_args = {
            &quot;keystone.user&quot;: &quot;admin&quot;,
            &quot;connection_password&quot;: &quot;password&quot;,
            &quot;connection_tenant&quot;: &quot;admin&quot;,
            &quot;connection_tenant_id&quot;: &quot;id&quot;,
            &quot;connection_auth_url&quot;: &quot;https://127.0.0.1/v2.0/&quot;,
            &quot;connection_verify_ssl&quot;: True,
        }

        http_ret = {&quot;dict&quot;: {&quot;version&quot;: {&quot;id&quot;: &quot;id_test&quot;}}}
        for verify in test_verify:
            mock_http = MagicMock(return_value=http_ret)
            patch_http = patch(&quot;salt.utils.http.query&quot;, mock_http)
            conn_args[&quot;connection_verify_ssl&quot;] = verify
            if verify is None:
                conn_args.pop(&quot;connection_verify_ssl&quot;)
                verify = True

            with patch_http:
                ret = keystone.api_version(**conn_args)

            self.assertEqual(
                mock_http.call_args_list,
                [
                    call(
                        &quot;https://127.0.0.1/v2.0/&quot;,
                        decode=True,
                        decode_type=&quot;json&quot;,
                        verify_ssl=verify,
                    )
                ],
            )
</PRE>
</div>
  </div>
</body>
</html>
