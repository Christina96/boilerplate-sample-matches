
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 2.80811232449298%, Tokens: 9</h2>
        <div class="column">
            <h3>wxpy-MDEwOlJlcG9zaXRvcnk4MjU4ODU5Nw==-flat-xiaoi.py</h3>
            <pre><code>1  from __future__ import unicode_literals
2  import collections
3  import hashlib
4  import logging
5  import requests
6  from wxpy.api.messages import Message
7  from wxpy.ext.talk_bot_utils import get_context_user_id, next_topic
8  from wxpy.utils.misc import get_text_without_at_bot
9  from wxpy.utils import enhance_connection
10  logger = logging.getLogger(__name__)
11  from wxpy.compatible import *
12  class XiaoI(object):
13      def __init__(self, key, secret):
14          self.key = key
15          self.secret = secret
16          self.realm = "xiaoi.com"
17          self.http_method = "POST"
18          self.uri = "/ask.do"
19          self.url = "http://nlp.xiaoi.com/ask.do?platform=custom"
20          xauth = self._make_http_header_xauth()
21          headers = {
22              "Content-type": "application/x-www-form-urlencoded",
23              "Accept": "text/plain",
24          }
25          headers.update(xauth)
26          self.session = requests.Session()
27          self.session.headers.update(headers)
28          enhance_connection(self.session)
29      def _make_signature(self):
30          nonce = "4103657107305326101203516108016101205331"
31          sha1 = "{0}:{1}:{2}".format(self.key, self.realm, self.secret).encode("utf-8")
32          sha1 = hashlib.sha1(sha1).hexdigest()
33          sha2 = "{0}:{1}".format(self.http_method, self.uri).encode("utf-8")
<span onclick='openModal()' class='match'>34          sha2 = hashlib.sha1(sha2).hexdigest()
35          signature = "{0}:{1}:{2}".format(sha1, nonce, sha2).encode("utf-8")
</span>36          signature = hashlib.sha1(signature).hexdigest()
37          ret = collections.namedtuple("signature_return", "signature nonce")
38          ret.signature = signature
39          ret.nonce = nonce
40          return ret
41      def _make_http_header_xauth(self):
42          sign = self._make_signature()
43          ret = {
44              "X-Auth": "app_key=\"{0}\",nonce=\"{1}\",signature=\"{2}\"".format(
45                  self.key, sign.nonce, sign.signature)
46          }
47          return ret
48      def do_reply(self, msg):
49          ret = self.reply_text(msg)
50          msg.reply(ret)
51          return ret
52      def reply_text(self, msg):
53          error_response = (
54              "‰∏ª‰∫∫ËøòÊ≤°ÁªôÊàëËÆæÁΩÆËøôÁ±ªËØùÈ¢òÁöÑÂõûÂ§ç",
55          )
56          if isinstance(msg, Message):
57              user_id = get_context_user_id(msg)
58              question = get_text_without_at_bot(msg)
59          else:
60              user_id = "abc"
61              question = msg or ""
62          params = {
63              "question": question,
64              "format": "json",
65              "platform": "custom",
66              "userId": user_id,
67          }
68          resp = self.session.post(self.url, data=params)
69          text = resp.text
70          for err in error_response:
71              if err in text:
72                  return next_topic()
73          return text
</code></pre>
        </div>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-imagetools.py</h3>
            <pre><code>1  import os
2  from . import LOGS, con
3  try:
4      import cv2
5  except ImportError:
6      LOGS.error(f"{__file__}: OpenCv not Installed.")
7  import numpy as np
8  try:
9      from PIL import Image
10  except ImportError:
11      Image = None
12      LOGS.info(f"{__file__}: PIL  not Installed.")
13  from telegraph import upload_file as upf
14  from telethon.errors.rpcerrorlist import (
15      ChatSendMediaForbiddenError,
16      MessageDeleteForbiddenError,
17  )
18  from . import (
19      Redis,
20      async_searcher,
21      download_file,
22      get_string,
23      requests,
24      udB,
25      ultroid_cmd,
26  )
27  @ultroid_cmd(pattern="color$")
28  async def _(event):
29      reply = await event.get_reply_message()
30      if not (reply and reply.media):
31          return await event.eor("`Reply To a Black and White Image`")
32      xx = await event.eor("`Coloring image üé®üñåÔ∏è...`")
33      image = await reply.download_media()
34      img = cv2.VideoCapture(image)
35      ret, frame = img.read()
36      cv2.imwrite("ult.jpg", frame)
37      if udB.get_key("DEEP_API"):
38          key = Redis("DEEP_API")
39      else:
40          key = "quickstart-QUdJIGlzIGNvbWluZy4uLi4K"
41      r = requests.post(
42          "https://api.deepai.org/api/colorizer",
43          files={"image": open("ult.jpg", "rb")},
44          headers={"api-key": key},
45      )
46      os.remove("ult.jpg")
47      os.remove(image)
48      if "status" in r.json():
49          return await event.edit(
50              r.json()["status"] + "\nGet api nd set `{i}setdb DEEP_API key`"
51          )
52      r_json = r.json()["output_url"]
53      await event.client.send_file(event.chat_id, r_json, reply_to=reply)
54      await xx.delete()
55  @ultroid_cmd(pattern="(grey|blur|negative|danger|mirror|quad|sketch|flip|toon)$")
56  async def ult_tools(event):
57      match = event.pattern_match.group(1)
58      ureply = await event.get_reply_message()
59      if not (ureply and (ureply.media)):
60          await event.eor(get_string("cvt_3"))
61          return
62      ultt = await ureply.download_media()
63      xx = await event.eor(get_string("com_1"))
64      if ultt.endswith(".tgs"):
65          xx = await xx.edit(get_string("sts_9"))
66      file = await con.convert(ultt, convert_to="png", outname="ult")
67      ult = cv2.imread(file)
68      if match == "grey":
69          ultroid = cv2.cvtColor(ult, cv2.COLOR_BGR2GRAY)
70      elif match == "blur":
71          ultroid = cv2.GaussianBlur(ult, (35, 35), 0)
72      elif match == "negative":
73          ultroid = cv2.bitwise_not(ult)
74      elif match == "danger":
75          dan = cv2.cvtColor(ult, cv2.COLOR_BGR2RGB)
76          ultroid = cv2.cvtColor(dan, cv2.COLOR_HSV2BGR)
77      elif match == "mirror":
78          ish = cv2.flip(ult, 1)
79          ultroid = cv2.hconcat([ult, ish])
80      elif match == "flip":
81          trn = cv2.flip(ult, 1)
82          ish = cv2.rotate(trn, cv2.ROTATE_180)
83          ultroid = cv2.vconcat([ult, ish])
84      elif match == "quad":
85          ult = cv2.imread(file)
86          roid = cv2.flip(ult, 1)
87          mici = cv2.hconcat([ult, roid])
88          fr = cv2.flip(mici, 1)
89          trn = cv2.rotate(fr, cv2.ROTATE_180)
90          ultroid = cv2.vconcat([mici, trn])
91      elif match == "sketch":
92          gray_image = cv2.cvtColor(ult, cv2.COLOR_BGR2GRAY)
93          inverted_gray_image = 255 - gray_image
94          blurred_img = cv2.GaussianBlur(inverted_gray_image, (21, 21), 0)
95          inverted_blurred_img = 255 - blurred_img
96          ultroid = cv2.divide(gray_image, inverted_blurred_img, scale=256.0)
97      elif match == "toon":
98          height, width, _ = ult.shape
99          samples = np.zeros([height * width, 3], dtype=np.float32)
100          count = 0
101          for x in range(height):
102              for y in range(width):
103                  samples[count] = ult[x][y]
104                  count += 1
105          _, labels, centers = cv2.kmeans(
106              samples,
107              12,
108              None,
109              (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, 10000, 0.0001),
110              5,
111              cv2.KMEANS_PP_CENTERS,
112          )
113          centers = np.uint8(centers)
114          ish = centers[labels.flatten()]
115          ultroid = ish.reshape(ult.shape)
116      cv2.imwrite("ult.jpg", ultroid)
117      await ureply.reply(
118          file="ult.jpg",
119          force_document=False,
120      )
121      await xx.delete()
122      os.remove("ult.jpg")
123      os.remove(file)
124  @ultroid_cmd(pattern="csample (.*)")
125  async def sampl(ult):
126      if color := ult.pattern_match.group(1).strip():
127          img = Image.new("RGB", (200, 100), f"{color}")
128          img.save("csample.png")
129          try:
130              try:
131                  await ult.delete()
132                  await ult.respond(f"Colour Sample for `{color}` !", file="csample.png")
133              except MessageDeleteForbiddenError:
134                  await ult.reply(f"Colour Sample for `{color}` !", file="csample.png")
135          except ChatSendMediaForbiddenError:
136              await ult.eor("Umm! Sending Media is disabled here!")
137      else:
138          await ult.eor("Wrong Color Name/Hex Code specified!")
139  @ultroid_cmd(
140      pattern="blue$",
141  )
142  async def ultd(event):
143      ureply = await event.get_reply_message()
144      xx = await event.eor("`...`")
145      if not (ureply and (ureply.media)):
146          await xx.edit(get_string("cvt_3"))
147          return
148      ultt = await ureply.download_media()
149      if ultt.endswith(".tgs"):
150          await xx.edit(get_string("sts_9"))
151      file = await con.convert(ultt, convert_to="png", outname="ult")
152      got = upf(file)
153      lnk = f"https://graph.org{got[0]}"
154      r = await async_searcher(
155          f"https://nekobot.xyz/api/imagegen?type=blurpify&image={lnk}", re_json=True
156      )
157      ms = r.get("message")
158      if not r["success"]:
159          return await xx.edit(ms)
160      await download_file(ms, "ult.png")
161      img = Image.open("ult.png").convert("RGB")
162      img.save("ult.webp", "webp")
163      await event.client.send_file(
164          event.chat_id,
165          "ult.webp",
166          force_document=False,
167          reply_to=event.reply_to_msg_id,
168      )
169      await xx.delete()
170      os.remove("ult.png")
171      os.remove("ult.webp")
172      os.remove(ultt)
173  @ultroid_cmd(pattern="border( (.*)|$)")
174  async def ok(event):
175      hm = await event.get_reply_message()
176      if not (hm and (hm.photo or hm.sticker)):
177          return await event.eor("`Reply to Sticker or Photo..`")
178      col = event.pattern_match.group(1).strip()
179      wh = 20
180      if not col:
181          col = [255, 255, 255]
182      else:
183          try:
184              if ";" in col:
185                  col_ = col.split(";", maxsplit=1)
186                  wh = int(col_[1])
187                  col = col_[0]
188              col = [int(col) for col in col.split(",")[:2]]
189          except ValueError:
190              return await event.eor("`Not a Valid Input...`")
191      okla = await hm.download_media()
192      img1 = cv2.imread(okla)
193      constant = cv2.copyMakeBorder(img1, wh, wh, wh, wh, cv2.BORDER_CONSTANT, value=col)
194      cv2.imwrite("output.png", constant)
195      await event.client.send_file(event.chat.id, "output.png")
196      os.remove("output.png")
197      os.remove(okla)
198      await event.delete()
199  @ultroid_cmd(pattern="pixelator( (.*)|$)")
200  async def pixelator(event):
201      reply_message = await event.get_reply_message()
202      if not (reply_message and (reply_message.photo or reply_message.sticker)):
203          return await event.eor("`Reply to a photo`")
204      hw = 50
205      try:
206          hw = int(event.pattern_match.group(1).strip())
207      except (ValueError, TypeError):
208          pass
209      msg = await event.eor(get_string("com_1"))
210      image = await reply_message.download_media()
211      input_ = cv2.imread(image)
212      height, width = input_.shape[:2]
213      w, h = (hw, hw)
214      temp = cv2.resize(input_, (w, h), interpolation=cv2.INTER_LINEAR)
215      output = cv2.resize(temp, (width, height), interpolation=cv2.INTER_NEAREST)
<span onclick='openModal()' class='match'>216      cv2.imwrite("output.jpg", output)
217      await msg.respond("‚Ä¢ Pixelated by Ultroid", file="output.jpg")
218      await msg.delete()
219      os.remove("output.jpg")
</span>220      os.remove(image)
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from wxpy-MDEwOlJlcG9zaXRvcnk4MjU4ODU5Nw==-flat-xiaoi.py</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-imagetools.py</div>
                <div class="column column_space"><pre><code>34          sha2 = hashlib.sha1(sha2).hexdigest()
35          signature = "{0}:{1}:{2}".format(sha1, nonce, sha2).encode("utf-8")
</pre></code></div>
                <div class="column column_space"><pre><code>216      cv2.imwrite("output.jpg", output)
217      await msg.respond("‚Ä¢ Pixelated by Ultroid", file="output.jpg")
218      await msg.delete()
219      os.remove("output.jpg")
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    