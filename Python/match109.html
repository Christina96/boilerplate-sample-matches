<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for nexus_1.py &amp; artifactory_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for nexus_1.py &amp; artifactory_1.py
      </h3>
<h1 align="center">
        76.8%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>nexus_1.py (79.228485%)<th>artifactory_1.py (74.68532%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(659-704)<td><a href="#" name="0">(702-746)</a><td align="center"><font color="#ff0000">83</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(705-758)<td><a href="#" name="1">(750-803)</a><td align="center"><font color="#d70000">70</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(597-638)<td><a href="#" name="2">(589-630)</a><td align="center"><font color="#cd0000">67</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(381-414)<td><a href="#" name="3">(323-364)</a><td align="center"><font color="#6e0000">36</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(535-555)<td><a href="#" name="4">(512-537)</a><td align="center"><font color="#590000">29</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(108-178)<td><a href="#" name="5">(175-241)</a><td align="center"><font color="#590000">29</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(493-518)<td><a href="#" name="6">(462-487)</a><td align="center"><font color="#4f0000">26</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(415-441)<td><a href="#" name="7">(366-394)</a><td align="center"><font color="#460000">23</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(465-484)<td><a href="#" name="8">(430-449)</a><td align="center"><font color="#430000">22</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(556-566)<td><a href="#" name="9">(541-551)</a><td align="center"><font color="#400000">21</font>
<tr onclick='openModal("#ad5910")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#ad5910"><font color="#ad5910">-</font><td><a href="#" name="10">(180-205)<td><a href="#" name="10">(95-120)</a><td align="center"><font color="#3d0000">20</font>
<tr onclick='openModal("#b041ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#b041ff"><font color="#b041ff">-</font><td><a href="#" name="11">(443-465)<td><a href="#" name="11">(399-422)</a><td align="center"><font color="#370000">18</font>
<tr onclick='openModal("#571b7e")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#571b7e"><font color="#571b7e">-</font><td><a href="#" name="12">(308-318)<td><a href="#" name="12">(241-252)</a><td align="center"><font color="#340000">17</font>
<tr onclick='openModal("#3b9c9c")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#3b9c9c"><font color="#3b9c9c">-</font><td><a href="#" name="13">(96-106)<td><a href="#" name="13">(82-92)</a><td align="center"><font color="#340000">17</font>
<tr onclick='openModal("#842dce")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#842dce"><font color="#842dce">-</font><td><a href="#" name="14">(644-658)<td><a href="#" name="14">(686-700)</a><td align="center"><font color="#310000">16</font>
<tr onclick='openModal("#f52887")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f52887"><font color="#f52887">-</font><td><a href="#" name="15">(579-596)<td><a href="#" name="15">(564-584)</a><td align="center"><font color="#310000">16</font>
<tr onclick='openModal("#2981b2")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#2981b2"><font color="#2981b2">-</font><td><a href="#" name="16">(521-534)<td><a href="#" name="16">(491-507)</a><td align="center"><font color="#240000">12</font>
<tr onclick='openModal("#3090c7")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#3090c7"><font color="#3090c7">-</font><td><a href="#" name="17">(319-338)<td><a href="#" name="17">(252-278)</a><td align="center"><font color="#240000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>nexus_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import base64
2 import http.client
3 import logging
4 import os
5 import urllib.request
6 from urllib.error import HTTPError, URLError
7 import salt.utils.files
8 import salt.utils.stringutils
9 from salt.exceptions import CommandExecutionError
10 try:
11     import xml.etree.ElementTree as ET
12     HAS_ELEMENT_TREE = True
13 except ImportError:
14     HAS_ELEMENT_TREE = False
15 log = logging.getLogger(__name__)
16 __virtualname__ = "nexus"
17 def __virtual__():
18     if not HAS_ELEMENT_TREE:
19         return (
20             False,
21             "Cannot load {} module: ElementTree library unavailable".format(
22                 __virtualname__
23             ),
24         )
25     else:
26         return True
27 def get_latest_snapshot(
28     nexus_url,
29     repository,
30     group_id,
31     artifact_id,
32     packaging,
33     target_dir="/tmp",
34     target_file=None,
35     classifier=None,
36     username=None,
37     password=None,
38 ):
39     log.debug(
40         "======================== MODULE FUNCTION: nexus.get_latest_snapshot,"
41         " nexus_url=%s, repository=%s, group_id=%s, artifact_id=%s, packaging=%s,"
42         " target_dir=%s, classifier=%s)",
43         nexus_url,
44         repository,
45         group_id,
46         artifact_id,
47         packaging,
48         target_dir,
49         classifier,
50     )
51     headers = {}
52     if username and password:
53         headers["Authorization"] = "Basic {}"<font color="#3b9c9c"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(
54             base64.encodestring("{}:{}".format(username, password)).replace("\n", "")
55         )
56     artifact_metadata = _get_artifact_metadata(
57         nexus_url=nexus_url,
58         repository=repository,
59         group_id=group_id,
60         artifact_id=artifact_id,
61         headers=headers,
62     version =</b></font> artifact_metadata["latest_version"]
63     snapshot_url, file_name = _get_snapshot_url(
64         nexus_url<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=nexus_url,
65         repository=repository,
66         group_id=group_id,
67         artifact_id=artifact_id,
68         version=version,
69         packaging=packaging,
70         classifier=classifier,
71         headers=headers,
72     )
73     target_file = __resolve_target_file(file_name, target_dir, target_file)
74     return __save_artifact(snapshot_url, target_file, headers)
75 def get_snapshot(
76     nexus_url,
77     repository,
78     group_id,
79     artifact_id,
80     packaging,
81     version,
82     snapshot_version=None,
83     target_dir="/tmp",
84     target_file=None,
85     classifier=None,
86     username=None,
87     password=None,
88 ):
89     log.debug(
90         "======================== MODULE FUNCTION: nexus.get_snapshot(nexus_url=%s,"
91         " repository=%s, group_id=%s, artifact_id=%s, packaging=%s, version=%s,"
92         " target_dir=%s, classifier=%s)",
93         nexus_url,
94         repository,
95         group_id,
96         artifact_id,
97         packaging,
98         version,
99         target_dir,
100         classifier,
101     )
102     headers = {}
103     if username and password:
104             base64.</b></font>encodestring("{}:{}".format(username, password)).replace("\n", "")
105         )
106     snapshot_url, file_name <font color="#ad5910"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= _get_snapshot_url(
107         nexus_url=nexus_url,
108         repository=repository,
109         group_id=group_id,
110         artifact_id=artifact_id,
111         version=version,
112         packaging=packaging,
113         snapshot_version=snapshot_version,
114         classifier=classifier,
115         headers=headers,
116     )
117     target_file = __resolve_target_file(file_name, target_dir, target_file)
118     return __save_artifact(snapshot_url, target_file, headers)
119 def get_snapshot_version_string(
120     nexus_url,
121     repository,
122     group_id,
123     artifact_id,
124     packaging,
125     version,
126     classifier=None,
127     username=None,
128     password=</b></font>None,
129 ):
130     log.debug(
131         "======================== MODULE FUNCTION:"
132         " nexus.get_snapshot_version_string(nexus_url=%s, repository=%s, group_id=%s,"
133         " artifact_id=%s, packaging=%s, version=%s, classifier=%s)",
134         nexus_url,
135         repository,
136         group_id,
137         artifact_id,
138         packaging,
139         version,
140         classifier,
141     )
142     headers = {}
143     if username and password:
144         headers["Authorization"] = "Basic {}".format(
145             base64.encodestring("{}:{}".format(username, password)).replace("\n", "")
146         )
147     return _get_snapshot_url(
148         nexus_url=nexus_url,
149         repository=repository,
150         group_id=group_id,
151         artifact_id=artifact_id,
152         version=version,
153         packaging=packaging,
154         classifier=classifier,
155         just_get_version_string=True,
156     )
157 def get_latest_release(
158     nexus_url,
159     repository,
160     group_id,
161     artifact_id,
162     packaging,
163     target_dir="/tmp",
164     target_file=None,
165     classifier=None,
166     username=None,
167     password=None,
168 ):
169     log.debug(
170         "======================== MODULE FUNCTION:"
171         " nexus.get_latest_release(nexus_url=%s, repository=%s, group_id=%s,"
172         " artifact_id=%s, packaging=%s, target_dir=%s, classifier=%s)",
173         nexus_url,
174         repository,
175         group_id,
176         artifact_id,
177         packaging,
178         target_dir,
179         classifier,
180     headers = {}
181     if username and password:
182         headers["Authorization"] = "Basic {}"<font color="#571b7e"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(
183             base64.encodestring("{}:{}".format(username, password)).replace("\n", "")
184         )
185     artifact_metadata = _get_artifact_metadata(
186         nexus_url=nexus_url,
187         repository=repository,
188         group_id=group_id,
189         artifact_id=artifact_id,
190     )
191     version =</b></font> artifact_metadata["latest_version"]
192     release_url, file_name = _get_release_url<font color="#3090c7"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(
193         repository, group_id, artifact_id, packaging, version, nexus_url, classifier
194     )
195     target_file = __resolve_target_file(file_name, target_dir, target_file)
196     return __save_artifact(release_url, target_file, headers)
197 def get_release(
198     nexus_url,
199     repository,
200     group_id,
201     artifact_id,
202     packaging,
203     version,
204     target_dir="/tmp",
205     target_file=None,
206     classifier=None,
207     username=None,
208     password=</b></font>None,
209 ):
210     log.debug(
211         "======================== MODULE FUNCTION: nexus.get_release(nexus_url=%s,"
212         " repository=%s, group_id=%s, artifact_id=%s, packaging=%s, version=%s,"
213         " target_dir=%s, classifier=%s)",
214         nexus_url,
215         repository,
216         group_id,
217         artifact_id,
218         packaging,
219         version,
220         target_dir,
221         classifier,
222     headers = {}
223     if username and password:
224         headers["Authorization"] = "Basic {}"<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(
225             base64.encodestring("{}:{}".format(username, password)).replace("\n", "")
226         )
227     release_url, file_name = _get_release_url(
228         repository, group_id, artifact_id, packaging, version, nexus_url, classifier
229     )
230     target_file = __resolve_target_file(file_name, target_dir, target_file)
231     return __save_artifact(release_url, target_file, headers)
232 def __resolve_target_file(file_name, target_dir, target_file=None):
233     if target_file is None:
234         target_file = os.path.join(target_dir, file_name)
235     return target_file
236 def _get_snapshot_url(
237     nexus_url,
238     repository,
239     group_id,
240     artifact_id,
241     version,
242     packaging,
243     snapshot_version=None,
244     classifier=None,
245     headers=None,
246     just_get_version_string=None,
247 ):
248     if headers is None:
249         headers = {}
250     if</b></font> snapshot_version is None:
251         snapshot_version_metadata <font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= _get_snapshot_version_metadata(
252             nexus_url=nexus_url,
253             repository=repository,
254             group_id=group_id,
255             artifact_id=artifact_id,
256             version=version,
257             headers=headers,
258         )
259         if packaging not in snapshot_version_metadata["snapshot_versions"]:
260             error_message = """Cannot find requested packaging '{packaging}' in the snapshot version metadata.
261                       nexus_url: {nexus_url}
262                       repository: {repository}
263                       group_id: {group_id}
264                       artifact_id: {artifact_id}
265                       packaging: {packaging}
266                       classifier: {classifier}
267                       version: {version}""".format(
268                 nexus_url=nexus_url,
269                 repository=repository,
270                 group_id=group_id,
271                 artifact_id=artifact_id,
272                 packaging=packaging,
273                 classifier=classifier,
274                 version=version,
275             raise nexusError(</b></font>error_message)
276         <font color="#b041ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>if (
277             has_classifier
278             and classifier not in snapshot_version_metadata["snapshot_versions"]
279         ):
280             error_message = """Cannot find requested classifier '{classifier}' in the snapshot version metadata.
281                       nexus_url: {nexus_url}
282                       repository: {repository}
283                       group_id: {group_id}
284                       artifact_id: {artifact_id}
285                       packaging: {packaging}
286                       classifier: {classifier}
287                       version: {version}""".format(
288                 nexus_url=nexus_url,
289                 repository=repository,
290                 group_id=group_id,
291                 artifact_id=artifact_id,
292                 packaging=packaging,
293                 classifier=classifier,
294                 version=version,
295             raise nexusError(error_message)
296         snapshot_version = snapshot_version_metadata["snapshot_versions"][</b></font><font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>packaging]
297     group_url = __get_group_id_subpath(group_id)
298     file_name = "{artifact_id}-{snapshot_version}{classifier}.{packaging}".format(
299         artifact_id=artifact_id,
300         snapshot_version=snapshot_version,
301         packaging=packaging,
302         classifier=__get_classifier_url(classifier),
303     )
304     snapshot_url = "{nexus_url}/{repository}/{group_url}/{artifact_id}/{version}/{file_name}".format(
305         nexus_url=nexus_url,
306         repository=repository,
307         group_url=group_url,
308         artifact_id=artifact_id,
309         version=version,
310         file_name=file_name,
311     )
312     log.debug(</b></font>"snapshot_url=%s", snapshot_url)
313     if just_get_version_string:
314         return snapshot_version
315     else:
316         return snapshot_url, file_name
317 def _get_release_url(
318     repository, group_id, artifact_id, packaging, version, nexus_url, classifier<font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=None
319 ):
320     group_url = __get_group_id_subpath(group_id)
321     file_name = "{artifact_id}-{version}{classifier}.{packaging}".format(
322         artifact_id=artifact_id,
323         version=version,
324         packaging=packaging,
325         classifier=__get_classifier_url(classifier),
326     )
327     release_url = "{nexus_url}/{repository}/{group_url}/{artifact_id}/{version}/{file_name}".format(
328         nexus_url=nexus_url,
329         repository=repository,
330         group_url=group_url,
331         artifact_id=artifact_id,
332         version=version,
333         file_name=file_name,
334     )
335     log.debug("release_url=%s", release_url)
336     return release_url, file_name
337 def _get_artifact_metadata_url(nexus_url, repository, group_id, artifact_id):
338     artifact_metadata_url = (
339         "{nexus_url}/{repository}/{group_url}/{artifact_id}/maven-metadata.xml"<font color="#2981b2"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(
340             nexus_url=nexus_url,
341             repository=repository,
342             group_url=group_url,
343             artifact_id=artifact_id,
344         )
345     )
346     log.debug("artifact_metadata_url=%s", artifact_metadata_url)
347     return artifact_metadata_url
348     artifact_metadata_url =</b></font> _get_artifact_metadata_url(
349         nexus_url<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=nexus_url,
350         repository=repository,
351         group_id=group_id,
352         artifact_id=artifact_id,
353     )
354     try:
355         request = urllib.request.Request(artifact_metadata_url, None, headers)
356         artifact_metadata_xml = urllib.request.urlopen(request).read()
357     except (HTTPError, URLError) as err:
358         message = "Could not fetch data from url: {}. ERROR: {}".format(
359             artifact_metadata_url, err
360         )
361         raise CommandExecutionError(message)
362     log.debug("artifact_metadata_xml=%s", artifact_metadata_xml)
363     return artifact_metadata_xml
364 def _get_artifact_metadata(nexus_url, repository, group_id, artifact_id, headers):
365     metadata_xml =</b></font> _get_artifact_metadata_xml(
366         nexus_url<font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=nexus_url,
367         repository=repository,
368         group_id=group_id,
369         artifact_id=artifact_id,
370         headers=headers,
371     )
372     root = ET.fromstring(metadata_xml)
373     assert group_id == root.find("groupId").text
374     assert artifact_id == root.find("artifactId").text
375     versions = root.find("versioning").find(</b></font>"versions")
376     versionList = []
377     for version in versions.iter("version"):
378         versionList.append(version.text)
379     latest_version = max(versionList)
380     log.debug("latest version=%s", latest_version)
381     return {"latest_version": latest_version}
382     nexus_url, repository, group_id, artifact_id, version
383 ):
384     group_url <font color="#f52887"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= __get_group_id_subpath(group_id)
385     snapshot_version_metadata_url = "{nexus_url}/{repository}/{group_url}/{artifact_id}/{version}/maven-metadata.xml".format(
386         nexus_url=nexus_url,
387         repository=repository,
388         group_url=group_url,
389         artifact_id=artifact_id,
390         version=version,
391     )
392     log.debug("snapshot_version_metadata_url=%s", snapshot_version_metadata_url)
393     return snapshot_version_metadata_url
394 def _get_snapshot_version_metadata_xml(
395     nexus_url, repository, group_id, artifact_id, version, headers
396     snapshot_version_metadata_url =</b></font> _get_snapshot_version_metadata_url(
397         nexus_url<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=nexus_url,
398         repository=repository,
399         group_id=group_id,
400         artifact_id=artifact_id,
401         version=version,
402     )
403     try:
404         request = urllib.request.Request(snapshot_version_metadata_url, None, headers)
405         snapshot_version_metadata_xml = urllib.request.urlopen(request).read()
406     except (HTTPError, URLError) as err:
407         message = "Could not fetch data from url: {}. ERROR: {}".format(
408             snapshot_version_metadata_url, err
409         )
410         raise CommandExecutionError(message)
411     log.debug("snapshot_version_metadata_xml=%s", snapshot_version_metadata_xml)
412     return snapshot_version_metadata_xml
413 def _get_snapshot_version_metadata(
414     nexus_url, repository, group_id, artifact_id, version, headers
415 ):
416     metadata_xml = _get_snapshot_version_metadata_xml(
417         nexus_url=nexus_url,
418         repository=repository,
419         group_id=group_id,
420         artifact_id=artifact_id,
421         version=version,
422         headers=headers,
423     )
424     metadata = ET.fromstring(metadata_xml)
425     assert group_id == metadata.find("groupId").text
426     assert artifact_id == metadata.find("artifactId").text
427     assert version == metadata.find("version").text
428     snapshot_versions = metadata.find("versioning").find("snapshotVersions")
429     extension_version_dict = {}
430     for snapshot_version in snapshot_versions:
431         extension = snapshot_version.find("extension").text
432         value = snapshot_version.find("value").</b></font>text
433         extension_version_dict[extension] = value
434         if snapshot_version.find("classifier") is not None:
435             extension_version_dict[classifier] = value
436     return {"<font color="#842dce"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>snapshot_versions": extension_version_dict}
437 def __save_artifact(artifact_url, target_file, headers):
438     log.debug("__save_artifact(%s, %s)", artifact_url, target_file)
439     result = {"status": False, "changes": {}, "comment": ""}
440     if os.path.isfile(target_file):
441         log.debug("File %s already exists, checking checksum...", target_file)
442         checksum_url = artifact_url + ".sha1"
443         checksum_success, artifact_sum, checksum_comment = __download(
444         )
445         if</b></font> checksum_success:
446             log<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.debug("Downloaded SHA1 SUM: %s", artifact_sum)
447             file_sum = __salt__["file.get_hash"](path=target_file, form="sha1")
448             log.debug("Target file (%s) SHA1 SUM: %s", target_file, file_sum)
449             if artifact_sum == file_sum:
450                 result["status"] = True
451                 result["target_file"] = target_file
452                 result["comment"] = (
453                     "File {} already exists, checksum matches with nexus.\n"
454                     "Checksum URL: {}".format(target_file, checksum_url)
455                 )
456                 return result
457             else:
458                 result["comment"] = (
459                     "File {} already exists, checksum does not match with nexus!\n"
460                     "Checksum URL: {}".format(target_file, checksum_url)
461                 )
462         else:
463             result["status"] = False
464             result["comment"] = checksum_comment
465             return result
466     log.debug("Downloading: %s -&gt; %s", artifact_url, target_file)
467     try:
468         request = urllib.request.Request(artifact_url, None, headers)
469         f = urllib.request.urlopen(request)
470         with salt.utils.files.fopen(target_file, "wb") as local_file:
471             local_file.write(salt.utils.stringutils.to_bytes(f.read()))
472         result["status"] = True
473         result["comment"] = __append_comment(
474             "Artifact downloaded from URL: {}".format(artifact_url),
475             result["comment"],
476         )
477         result["changes"]["downloaded_file"] = target_file
478         result["target_file"] = target_file
479     except (HTTPError, URLError) as e:
480         result["status"] = False
481         result["comment"] = __get_error_comment(e, artifact_url)
482     return result
483 def __get_group_id_subpath(group_id):
484     group_url =</b></font> group_id.replace(".", "/")
485     <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>return group_url
486 def __get_classifier_url(classifier):
487     has_classifier = classifier is not None and classifier != ""
488     return "-" + classifier if has_classifier else ""
489 def __download(request_url, headers):
490     log.debug("Downloading content from %s", request_url)
491     success = False
492     content = None
493     comment = None
494     try:
495         request = urllib.request.Request(request_url, None, headers)
496         url = urllib.request.urlopen(request)
497         content = url.read()
498         success = True
499     except HTTPError as e:
500         comment = __get_error_comment(e, request_url)
501     return success, content, comment
502 def __get_error_comment(http_error, request_url):
503     if http_error.code == http.client.NOT_FOUND:
504         comment = "HTTP Error 404. Request URL: " + request_url
505     elif http_error.code == http.client.CONFLICT:
506         comment = (
507             "HTTP Error 409: Conflict. Requested URL: {}. \nThis error may be caused by"
508             " reading snapshot artifact from non-snapshot repository.".format(
509                 request_url
510             )
511         )
512     else:
513         comment = "HTTP Error {err_code}. Request URL: {url}".format(
514             err_code=http_error.code, url=request_url
515         )
516     return comment
517 def __append_comment(new_comment, current_comment=""):
518     return current_comment + "\n" + new_comment
519 class nexusError(Exception):
520     def __init__(self, value):
521         super().__init__()
522         self.value = value
523     def __str__(self):
524         return repr(self.v</b></font>alue)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>artifactory_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import http.client
2 import logging
3 import os
4 import urllib.request
5 import xml.etree.ElementTree as ET
6 from urllib.error import HTTPError, URLError
7 import salt.utils.files
8 import salt.utils.hashutils
9 import salt.utils.stringutils
10 from salt.exceptions import CommandExecutionError
11 log = logging.getLogger(__name__)
12 __virtualname__ = "artifactory"
13 def __virtual__():
14     return True
15 def get_latest_snapshot(
16     artifactory_url,
17     repository,
18     group_id,
19     artifact_id,
20     packaging,
21     target_dir="/tmp",
22     target_file=None,
23     classifier=None,
24     username=None,
25     password=None,
26     use_literal_group_id=False,
27 ):
28     log.debug(
29         "======================== MODULE FUNCTION: artifactory.get_latest_snapshot,"
30         " artifactory_url=%s, repository=%s, group_id=%s, artifact_id=%s, packaging=%s,"
31         " target_dir=%s, classifier=%s)",
32         artifactory_url,
33         repository,
34         group_id,
35         artifact_id,
36         packaging,
37         target_dir,
38         classifier,
39     )
40     if username and password:
41         headers["Authorization"] = "Basic {}".format(
42             salt.utils.hashutils<font color="#3b9c9c"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.base64_encodestring(
43                 "{}:{}".format(username.replace("\n", ""), password.replace("\n", ""))
44             )
45         )
46     artifact_metadata = _get_artifact_metadata(
47         artifactory_url=artifactory_url,
48         repository=repository,
49         group_id=group_id,
50         artifact_id=artifact_id,
51         headers=headers,
52     )
53     version = artifact_metadata["latest_version"]
54     snapshot_url, file_name <font color="#ad5910"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= _get_snapshot_url(
55         artifactory_url=artifactory_url,
56         repository=repository,
57         group_id=group_id,
58         artifact_id=artifact_id,
59         version=version,
60         packaging=packaging,
61         classifier=classifier,
62         headers=headers,
63         use_literal_group_id=use_literal_group_id,
64     )
65     target_file = __resolve_target_file(file_name, target_dir, target_file)
66     return __save_artifact(snapshot_url, target_file, headers)
67 def get_snapshot(
68     artifactory_url,
69     repository,
70     group_id,
71     artifact_id,
72     packaging,
73     version,
74     snapshot_version=None,
75     target_dir="/tmp",
76     target_file=</b></font>None,
77     classifier=None,
78     username=None,
79     password=None,
80     use_literal_group_id=False,
81 ):
82     log.debug(
83         "======================== MODULE FUNCTION:"
84         " artifactory.get_snapshot(artifactory_url=%s, repository=%s, group_id=%s,"
85         " artifact_id=%s, packaging=%s, version=%s, target_dir=%s, classifier=%s)",
86         artifactory_url,
87         repository,
88         group_id,
89         artifact_id,
90         packaging,
91         version,
92         target_dir,
93         classifier,
94     )
95     headers = {}
96     if username and password:
97         headers["Authorization"] = "Basic {}".format(
98             salt.utils.hashutils.base64_encodestring(
99                 "{}:{}".format(username.replace("\n", ""), password.replace("\n", ""))
100             )
101         )
102         artifactory_url=artifactory_url,
103         repository=repository,
104         group_id<font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=group_id,
105         artifact_id=artifact_id,
106         version=version,
107         packaging=packaging,
108         snapshot_version=snapshot_version,
109         classifier=classifier,
110         headers=headers,
111         use_literal_group_id=use_literal_group_id,
112     )
113     target_file = __resolve_target_file(file_name, target_dir, target_file)
114     return __save_artifact(snapshot_url, target_file, headers)
115 def get_latest_release(
116     artifactory_url,
117     repository,
118     group_id,
119     artifact_id,
120     packaging,
121     target_dir="/tmp",
122     target_file=None,
123     classifier=None,
124     username=None,
125     password=None,
126     use_literal_group_id=False,
127 ):
128     log.debug(
129         "======================== MODULE FUNCTION:"
130         " artifactory.get_latest_release(artifactory_url=%s, repository=%s,"
131         " group_id=%s, artifact_id=%s, packaging=%s, target_dir=%s, classifier=%s)",
132         artifactory_url,
133         repository,
134         group_id,
135         artifact_id,
136         packaging,
137         target_dir,
138         classifier,
139     )
140     if username and password:
141         headers["Authorization"] = "Basic {}".format(
142             salt.</b></font>utils.hashutils<font color="#571b7e"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.base64_encodestring(
143                 "{}:{}".format(username.replace("\n", ""), password.replace("\n", ""))
144             )
145         )
146     version = __find_latest_version(
147         artifactory_url=artifactory_url,
148         repository=repository,
149         group_id=group_id,
150         headers=headers,
151     )
152     release_url, file_name =</b></font> _get_release_url<font color="#3090c7"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>(
153         repository,
154         group_id,
155         artifact_id,
156         packaging,
157         version,
158         artifactory_url,
159         classifier,
160         use_literal_group_id,
161     )
162     target_file = __resolve_target_file(file_name, target_dir, target_file)
163     return __save_artifact(release_url, target_file, headers)
164 def get_release(
165     artifactory_url,
166     repository,
167     group_id,
168     artifact_id,
169     packaging,
170     version,
171     target_dir="/tmp",
172     target_file=None,
173     classifier=None,
174     username=None,
175     password=</b></font>None,
176     use_literal_group_id=False,
177 ):
178     log.debug(
179         "======================== MODULE FUNCTION:"
180         " artifactory.get_release(artifactory_url=%s, repository=%s, group_id=%s,"
181         " artifact_id=%s, packaging=%s, version=%s, target_dir=%s, classifier=%s)",
182         artifactory_url,
183         repository,
184         group_id,
185         artifact_id,
186         packaging,
187         version,
188         target_dir,
189         classifier,
190     )
191     if username and password:
192         headers["Authorization"] = "Basic {}".format(
193             salt.utils.hashutils<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.base64_encodestring(
194                 "{}:{}".format(username.replace("\n", ""), password.replace("\n", ""))
195             )
196         )
197     release_url, file_name = _get_release_url(
198         repository,
199         group_id,
200         artifact_id,
201         packaging,
202         version,
203         artifactory_url,
204         classifier,
205         use_literal_group_id,
206     )
207     target_file = __resolve_target_file(file_name, target_dir, target_file)
208     return __save_artifact(release_url, target_file, headers)
209 def __resolve_target_file(file_name, target_dir, target_file=None):
210     if target_file is None:
211         target_file = os.path.join(target_dir, file_name)
212     return target_file
213 def _get_snapshot_url(
214     artifactory_url,
215     repository,
216     group_id,
217     artifact_id,
218     version,
219     packaging,
220     snapshot_version=None,
221     classifier=None,
222     headers=None,
223     use_literal_group_id=False,
224 ):
225     if headers is None:
226         headers = {}
227     has_classifier = classifier is not None and classifier != ""
228     if</b></font> snapshot_version is None:
229         try:
230             snapshot_version_metadata <font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= _get_snapshot_version_metadata(
231                 artifactory_url=artifactory_url,
232                 repository=repository,
233                 group_id=group_id,
234                 artifact_id=artifact_id,
235                 version=version,
236                 headers=headers,
237             )
238             if (
239                 not has_classifier
240                 and packaging not in snapshot_version_metadata["snapshot_versions"]
241             ):
242                 error_message = """Cannot find requested packaging '{packaging}' in the snapshot version metadata.
243                           artifactory_url: {artifactory_url}
244                           repository: {repository}
245                           group_id: {group_id}
246                           artifact_id: {artifact_id}
247                           packaging: {packaging}
248                           classifier: {classifier}
249                           version: {version}""".format(
250                     artifactory_url=artifactory_url,
251                     repository=repository,
252                     group_id=group_id,
253                     artifact_id=artifact_id,
254                     packaging=packaging,
255                     classifier=classifier,
256                     version=version,
257                 )
258                 raise ArtifactoryError(</b></font>error_message)
259                 packaging if not has_classifier else packaging + ":" + classifier
260             )
261             <font color="#b041ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>if (
262                 has_classifier
263                 and packaging_with_classifier
264                 not in snapshot_version_metadata["snapshot_versions"]
265             ):
266                 error_message = """Cannot find requested classifier '{classifier}' in the snapshot version metadata.
267                           artifactory_url: {artifactory_url}
268                           repository: {repository}
269                           group_id: {group_id}
270                           artifact_id: {artifact_id}
271                           packaging: {packaging}
272                           classifier: {classifier}
273                           version: {version}""".format(
274                     artifactory_url=artifactory_url,
275                     repository=repository,
276                     group_id=group_id,
277                     artifact_id=artifact_id,
278                     packaging=packaging,
279                     classifier=classifier,
280                     version=version,
281                 )
282                 raise ArtifactoryError(error_message)
283             snapshot_version = snapshot_version_metadata["snapshot_versions"][</b></font>
284                 packaging_with_classifier
285             ]
286         except CommandExecutionError as err:
287             log.error(
288                 version,
289             )
290             snapshot_version =<font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b> version
291     group_url = __get_group_id_subpath(group_id, use_literal_group_id)
292     file_name = "{artifact_id}-{snapshot_version}{classifier}.{packaging}".format(
293         artifact_id=artifact_id,
294         snapshot_version=snapshot_version,
295         packaging=packaging,
296         classifier=__get_classifier_url(classifier),
297     )
298     snapshot_url = "{artifactory_url}/{repository}/{group_url}/{artifact_id}/{version}/{file_name}".format(
299         artifactory_url=artifactory_url,
300         repository=repository,
301         group_url=group_url,
302         artifact_id=artifact_id,
303         version=version,
304         file_name=file_name,
305     )
306     log.debug(</b></font>"snapshot_url=%s", snapshot_url)
307     return snapshot_url, file_name
308 def _get_release_url(
309     repository,
310     group_id,
311     artifact_id,
312     packaging,
313     artifactory_url,
314     classifier=None,
315     use_literal_group_id<font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=False,
316 ):
317     group_url = __get_group_id_subpath(group_id, use_literal_group_id)
318     file_name = "{artifact_id}-{version}{classifier}.{packaging}".format(
319         artifact_id=artifact_id,
320         version=version,
321         packaging=packaging,
322         classifier=__get_classifier_url(classifier),
323     )
324     release_url = "{artifactory_url}/{repository}/{group_url}/{artifact_id}/{version}/{file_name}".format(
325         artifactory_url=artifactory_url,
326         repository=repository,
327         group_url=group_url,
328         artifact_id=artifact_id,
329         version=version,
330         file_name=file_name,
331     )
332     log.debug("release_url=%s", release_url)
333     return release_url, file_name
334 def _get_artifact_metadata_url(
335     artifactory_url, repository, group_id, artifact_id, use_literal_group_id=</b></font>False
336     group_url = __get_group_id_subpath(group_id, use_literal_group_id)
337     artifact_metadata_url = "{artifactory_url}/{repository}/{group_url}/{artifact_id}/maven-metadata.xml"<font color="#2981b2"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.format(
338         artifactory_url=artifactory_url,
339         repository=repository,
340         group_url=group_url,
341         artifact_id=artifact_id,
342     )
343     log.debug("artifact_metadata_url=%s", artifact_metadata_url)
344     return artifact_metadata_url
345 def _get_artifact_metadata_xml(
346     artifactory_url,
347     repository,
348     group_id,
349     artifact_id,
350     headers,
351     use_literal_group_id=</b></font>False,
352 ):
353     artifact_metadata_url = _get_artifact_metadata_url(
354         artifactory_url=artifactory_url,
355         repository<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=repository,
356         group_id=group_id,
357         artifact_id=artifact_id,
358         use_literal_group_id=use_literal_group_id,
359     )
360     try:
361         request = urllib.request.Request(artifact_metadata_url, None, headers)
362         artifact_metadata_xml = urllib.request.urlopen(request).read()
363     except (HTTPError, URLError) as err:
364         message = "Could not fetch data from url: {}. ERROR: {}".format(
365             artifact_metadata_url, err
366         )
367         raise CommandExecutionError(message)
368     log.debug("artifact_metadata_xml=%s", artifact_metadata_xml)
369     return artifact_metadata_xml
370 def _get_artifact_metadata(
371     artifactory_url,
372     repository,
373     group_id,
374     artifact_id,
375     headers,
376     use_literal_group_id=</b></font>False,
377     metadata_xml = _get_artifact_metadata_xml(
378         artifactory_url=artifactory_url,
379         repository<font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=repository,
380         group_id=group_id,
381         artifact_id=artifact_id,
382         headers=headers,
383         use_literal_group_id=use_literal_group_id,
384     )
385     root = ET.fromstring(metadata_xml)
386     assert group_id == root.find("groupId").text
387     assert artifact_id == root.find("artifactId").text
388     latest_version = root.find("versioning").find(</b></font>"latest").text
389     return {"latest_version": latest_version}
390 def _get_snapshot_version_metadata_url(
391     artifactory_url,
392     repository,
393     group_id,
394     artifact_id,
395     use_literal_group_id=False,
396 ):
397     group_url <font color="#f52887"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= __get_group_id_subpath(group_id, use_literal_group_id)
398     snapshot_version_metadata_url = "{artifactory_url}/{repository}/{group_url}/{artifact_id}/{version}/maven-metadata.xml".format(
399         artifactory_url=artifactory_url,
400         repository=repository,
401         group_url=group_url,
402         artifact_id=artifact_id,
403         version=version,
404     )
405     log.debug("snapshot_version_metadata_url=%s", snapshot_version_metadata_url)
406     return snapshot_version_metadata_url
407 def _get_snapshot_version_metadata_xml(
408     artifactory_url,
409     repository,
410     group_id,
411     artifact_id,
412     version,
413     headers,
414     use_literal_group_id=</b></font>False,
415 ):
416     snapshot_version_metadata_url = _get_snapshot_version_metadata_url(
417         artifactory_url=artifactory_url,
418         repository<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=repository,
419         group_id=group_id,
420         artifact_id=artifact_id,
421         version=version,
422         use_literal_group_id=use_literal_group_id,
423     )
424     try:
425         request = urllib.request.Request(snapshot_version_metadata_url, None, headers)
426         snapshot_version_metadata_xml = urllib.request.urlopen(request).read()
427     except (HTTPError, URLError) as err:
428         message = "Could not fetch data from url: {}. ERROR: {}".format(
429             snapshot_version_metadata_url, err
430         )
431         raise CommandExecutionError(message)
432     log.debug("snapshot_version_metadata_xml=%s", snapshot_version_metadata_xml)
433     return snapshot_version_metadata_xml
434 def _get_snapshot_version_metadata(
435     artifactory_url, repository, group_id, artifact_id, version, headers
436 ):
437     metadata_xml = _get_snapshot_version_metadata_xml(
438         artifactory_url=artifactory_url,
439         repository=repository,
440         group_id=group_id,
441         artifact_id=artifact_id,
442         version=version,
443         headers=headers,
444     )
445     metadata = ET.fromstring(metadata_xml)
446     assert group_id == metadata.find("groupId").text
447     assert artifact_id == metadata.find("artifactId").text
448     assert version == metadata.find("version").text
449     snapshot_versions = metadata.find("versioning").find("snapshotVersions")
450     extension_version_dict = {}
451     for snapshot_version in snapshot_versions:
452         extension = snapshot_version.find("extension").text
453         value = snapshot_version.find("value").</b></font>text
454         if snapshot_version.find("classifier") is not None:
455             classifier = snapshot_version.find("classifier").text
456             extension_version_dict[extension + ":" + classifier] = value
457         else:
458             extension_version_dict[extension] = value
459     return {"snapshot_versions": extension_version_dict}
460 def __get_latest_version_url(
461     artifactory_url, repository, group_id, artifact_id, use_literal_group_id=False
462 ):
463     group_url = __get_group_id_subpath(group_id, use_literal_group_id)
464     latest_version_url = "{artifactory_url}/api/search/latestVersion?g={group_url}&amp;a={artifact_id}&amp;repos={repository}".format(
465         artifactory_url=artifactory_url,
466         repository=repository,
467         group_url=group_url,
468         artifact_id=artifact_id,
469     )
470     log.debug("latest_version_url=%s", latest_version_url)
471     return latest_version_url
472 def __find_latest_version(
473     artifactory_url,
474     repository,
475     group_id,
476     artifact_id,
477     headers,
478     use_literal_group_id=False,
479 ):
480     latest_version_url = __get_latest_version_url(
481         artifactory_url=artifactory_url,
482         repository=repository,
483         group_id=group_id,
484         artifact_id=artifact_id,
485         use_literal_group_id=use_literal_group_id,
486     )
487     try:
488         request = urllib.request.Request(latest_version_url, None, headers)
489         version = urllib.request.urlopen(request).read()
490     except (HTTPError, URLError) as err:
491         message = "Could not fetch data from url: {}. ERROR: {}".format(
492             latest_version_url, err
493         )
494         raise CommandExecutionError(message)
495     log.debug("Response of: %s", version)
496         raise ArtifactoryError("Unable to find release version")
497     r<font color="#842dce"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>eturn version
498 def __save_artifact(artifact_url, target_file, headers):
499     log.debug("__save_artifact(%s, %s)", artifact_url, target_file)
500     result = {"status": False, "changes": {}, "comment": ""}
501     if os.path.isfile(target_file):
502         log.debug("File %s already exists, checking checksum...", target_file)
503         checksum_url = artifact_url + ".sha1"
504         checksum_success, artifact_sum, checksum_comment = __download(
505             checksum_url, headers
506         if</b></font> checksum_success:
507             artifact_sum = salt.utils.stringutils.to_unicode(artifact_sum)
508             log<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.debug("Downloaded SHA1 SUM: %s", artifact_sum)
509             file_sum = __salt__["file.get_hash"](path=target_file, form="sha1")
510             log.debug("Target file (%s) SHA1 SUM: %s", target_file, file_sum)
511             if artifact_sum == file_sum:
512                 result["status"] = True
513                 result["target_file"] = target_file
514                 result["comment"] = (
515                     "File {} already exists, checksum matches with Artifactory.\n"
516                     "Checksum URL: {}".format(target_file, checksum_url)
517                 )
518                 return result
519             else:
520                 result["comment"] = (
521                     "File {} already exists, checksum does not match with"
522                     " Artifactory!\nChecksum URL: {}".format(target_file, checksum_url)
523                 )
524         else:
525             result["status"] = False
526             result["comment"] = checksum_comment
527             return result
528     log.debug("Downloading: %s -&gt; %s", artifact_url, target_file)
529     try:
530         request = urllib.request.Request(artifact_url, None, headers)
531         f = urllib.request.urlopen(request)
532         with salt.utils.files.fopen(target_file, "wb") as local_file:
533             local_file.write(salt.utils.stringutils.to_bytes(f.read()))
534         result["status"] = True
535         result["comment"] = __append_comment(
536             "Artifact downloaded from URL: {}".format(artifact_url),
537             result["comment"],
538         )
539         result["changes"]["downloaded_file"] = target_file
540         result["target_file"] = target_file
541     except (HTTPError, URLError) as e:
542         result["status"] = False
543         result["comment"] = __get_error_comment(e, artifact_url)
544     return result
545 def __get_group_id_subpath(group_id, use_literal_group_id=</b></font>False):
546         group_url = group_id.replace(".", "/")
547         return group_url
548     <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>return group_id
549 def __get_classifier_url(classifier):
550     has_classifier = classifier is not None and classifier != ""
551     return "-" + classifier if has_classifier else ""
552 def __download(request_url, headers):
553     log.debug("Downloading content from %s", request_url)
554     success = False
555     content = None
556     comment = None
557     try:
558         request = urllib.request.Request(request_url, None, headers)
559         url = urllib.request.urlopen(request)
560         content = url.read()
561         success = True
562     except HTTPError as e:
563         comment = __get_error_comment(e, request_url)
564     return success, content, comment
565 def __get_error_comment(http_error, request_url):
566     if http_error.code == http.client.NOT_FOUND:
567         comment = "HTTP Error 404. Request URL: " + request_url
568     elif http_error.code == http.client.CONFLICT:
569         comment = (
570             "HTTP Error 409: Conflict. Requested URL: {}. \nThis error may be caused by"
571             " reading snapshot artifact from non-snapshot repository.".format(
572                 request_url
573             )
574         )
575     else:
576         comment = "HTTP Error {err_code}. Request URL: {url}".format(
577             err_code=http_error.code, url=request_url
578         )
579     return comment
580 def __append_comment(new_comment, current_comment=""):
581     return current_comment + "\n" + new_comment
582 class ArtifactoryError(Exception):
583     def __init__(self, value):
584         super().__init__()
585         self.value = value
586     def __str__(self):
587         return repr(self.v</b></font>alue)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
