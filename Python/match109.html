<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for nexus_1.py &amp; artifactory_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for nexus_1.py &amp; artifactory_1.py
      </h3>
<h1 align="center">
        76.8%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>nexus_1.py (79.228485%)<th>artifactory_1.py (74.68532%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(659-704)<td><a href="#" name="0">(702-746)</a><td align="center"><font color="#ff0000">83</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(705-758)<td><a href="#" name="1">(750-803)</a><td align="center"><font color="#d70000">70</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(597-638)<td><a href="#" name="2">(589-630)</a><td align="center"><font color="#cd0000">67</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(381-414)<td><a href="#" name="3">(323-364)</a><td align="center"><font color="#6e0000">36</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(535-555)<td><a href="#" name="4">(512-537)</a><td align="center"><font color="#590000">29</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(108-178)<td><a href="#" name="5">(175-241)</a><td align="center"><font color="#590000">29</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(493-518)<td><a href="#" name="6">(462-487)</a><td align="center"><font color="#4f0000">26</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(415-441)<td><a href="#" name="7">(366-394)</a><td align="center"><font color="#460000">23</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(465-484)<td><a href="#" name="8">(430-449)</a><td align="center"><font color="#430000">22</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(556-566)<td><a href="#" name="9">(541-551)</a><td align="center"><font color="#400000">21</font>
<tr onclick='openModal("#ad5910")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#ad5910"><font color="#ad5910">-</font><td><a href="#" name="10">(180-205)<td><a href="#" name="10">(95-120)</a><td align="center"><font color="#3d0000">20</font>
<tr onclick='openModal("#b041ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#b041ff"><font color="#b041ff">-</font><td><a href="#" name="11">(443-465)<td><a href="#" name="11">(399-422)</a><td align="center"><font color="#370000">18</font>
<tr onclick='openModal("#571b7e")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#571b7e"><font color="#571b7e">-</font><td><a href="#" name="12">(308-318)<td><a href="#" name="12">(241-252)</a><td align="center"><font color="#340000">17</font>
<tr onclick='openModal("#3b9c9c")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#3b9c9c"><font color="#3b9c9c">-</font><td><a href="#" name="13">(96-106)<td><a href="#" name="13">(82-92)</a><td align="center"><font color="#340000">17</font>
<tr onclick='openModal("#842dce")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#842dce"><font color="#842dce">-</font><td><a href="#" name="14">(644-658)<td><a href="#" name="14">(686-700)</a><td align="center"><font color="#310000">16</font>
<tr onclick='openModal("#f52887")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f52887"><font color="#f52887">-</font><td><a href="#" name="15">(579-596)<td><a href="#" name="15">(564-584)</a><td align="center"><font color="#310000">16</font>
<tr onclick='openModal("#2981b2")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#2981b2"><font color="#2981b2">-</font><td><a href="#" name="16">(521-534)<td><a href="#" name="16">(491-507)</a><td align="center"><font color="#240000">12</font>
<tr onclick='openModal("#3090c7")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#3090c7"><font color="#3090c7">-</font><td><a href="#" name="17">(319-338)<td><a href="#" name="17">(252-278)</a><td align="center"><font color="#240000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>nexus_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import base64
2 import http.client
3 import logging
4 import os
5 import urllib.request
6 from urllib.error import HTTPError, URLError
7 import salt.utils.files
8 import salt.utils.stringutils
9 from salt.exceptions import CommandExecutionError
10 try:
11     import xml.etree.ElementTree as ET
12     HAS_ELEMENT_TREE = True
13 except ImportError:
14     HAS_ELEMENT_TREE = False
15 log = logging.getLogger(__name__)
16 __virtualname__ = "nexus"
17 def __virtual__():
18     if not HAS_ELEMENT_TREE:
19         return (
20             False,
21             "Cannot load {} module: ElementTree library unavailable".format(
22                 __virtualname__
23             ),
24         )
25     else:
26         return True
27 def get_latest_snapshot(
28     nexus_url,
29     repository,
30     group_id,
31     artifact_id,
32     packaging,
33     target_dir="/tmp",
34     target_file=None,
35     classifier=None,
36     username=None,
37     password=None,
38 ):
39     log.debug(
40         "======================== MODULE FUNCTION: nexus.get_latest_snapshot,"
41         " nexus_url=%s, repository=%s, group_id=%s, artifact_id=%s, packaging=%s,"
42         " target_dir=%s, classifier=%s)",
43         nexus_url,
44         repository,
45         group_id,
46         artifact_id,
47         packaging,
48         target_dir,
49         classifier,
50     )
51 <a name="13"></a>
52     headers = {}
53     if username and password:
54         headers["Authorization"] = "Basic {}"<font color="#3b9c9c"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(
55             base64.encodestring("{}:{}".format(username, password)).replace("\n", "")
56         )
57     artifact_metadata = _get_artifact_metadata(
58         nexus_url=nexus_url,
59         repository=repository,
60         group_id=group_id,
61         artifact_id=artifact_id,
62         headers=headers,
63 <a name="5"></a>    )
64     version =</b></font> artifact_metadata["latest_version"]
65     snapshot_url, file_name = _get_snapshot_url(
66         nexus_url<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=nexus_url,
67         repository=repository,
68         group_id=group_id,
69         artifact_id=artifact_id,
70         version=version,
71         packaging=packaging,
72         classifier=classifier,
73         headers=headers,
74     )
75     target_file = __resolve_target_file(file_name, target_dir, target_file)
76     return __save_artifact(snapshot_url, target_file, headers)
77 def get_snapshot(
78     nexus_url,
79     repository,
80     group_id,
81     artifact_id,
82     packaging,
83     version,
84     snapshot_version=None,
85     target_dir="/tmp",
86     target_file=None,
87     classifier=None,
88     username=None,
89     password=None,
90 ):
91     log.debug(
92         "======================== MODULE FUNCTION: nexus.get_snapshot(nexus_url=%s,"
93         " repository=%s, group_id=%s, artifact_id=%s, packaging=%s, version=%s,"
94         " target_dir=%s, classifier=%s)",
95         nexus_url,
96         repository,
97         group_id,
98         artifact_id,
99         packaging,
100         version,
101         target_dir,
102         classifier,
103     )
104     headers = {}
105     if username and password:
106 <a name="10"></a>        headers["Authorization"] = "Basic {}".format(
107             base64.</b></font>encodestring("{}:{}".format(username, password)).replace("\n", "")
108         )
109     snapshot_url, file_name <font color="#ad5910"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= _get_snapshot_url(
110         nexus_url=nexus_url,
111         repository=repository,
112         group_id=group_id,
113         artifact_id=artifact_id,
114         version=version,
115         packaging=packaging,
116         snapshot_version=snapshot_version,
117         classifier=classifier,
118         headers=headers,
119     )
120     target_file = __resolve_target_file(file_name, target_dir, target_file)
121     return __save_artifact(snapshot_url, target_file, headers)
122 def get_snapshot_version_string(
123     nexus_url,
124     repository,
125     group_id,
126     artifact_id,
127     packaging,
128     version,
129     classifier=None,
130     username=None,
131     password=</b></font>None,
132 ):
133     log.debug(
134         "======================== MODULE FUNCTION:"
135         " nexus.get_snapshot_version_string(nexus_url=%s, repository=%s, group_id=%s,"
136         " artifact_id=%s, packaging=%s, version=%s, classifier=%s)",
137         nexus_url,
138         repository,
139         group_id,
140         artifact_id,
141         packaging,
142         version,
143         classifier,
144     )
145     headers = {}
146     if username and password:
147         headers["Authorization"] = "Basic {}".format(
148             base64.encodestring("{}:{}".format(username, password)).replace("\n", "")
149         )
150     return _get_snapshot_url(
151         nexus_url=nexus_url,
152         repository=repository,
153         group_id=group_id,
154         artifact_id=artifact_id,
155         version=version,
156         packaging=packaging,
157         classifier=classifier,
158         just_get_version_string=True,
159     )
160 def get_latest_release(
161     nexus_url,
162     repository,
163     group_id,
164     artifact_id,
165     packaging,
166     target_dir="/tmp",
167     target_file=None,
168     classifier=None,
169     username=None,
170     password=None,
171 ):
172     log.debug(
173         "======================== MODULE FUNCTION:"
174         " nexus.get_latest_release(nexus_url=%s, repository=%s, group_id=%s,"
175         " artifact_id=%s, packaging=%s, target_dir=%s, classifier=%s)",
176         nexus_url,
177         repository,
178         group_id,
179         artifact_id,
180         packaging,
181         target_dir,
182         classifier,
183 <a name="12"></a>    )
184     headers = {}
185     if username and password:
186         headers["Authorization"] = "Basic {}"<font color="#571b7e"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(
187             base64.encodestring("{}:{}".format(username, password)).replace("\n", "")
188         )
189     artifact_metadata = _get_artifact_metadata(
190         nexus_url=nexus_url,
191         repository=repository,
192         group_id=group_id,
193         artifact_id=artifact_id,
194 <a name="17"></a>        headers=headers,
195     )
196     version =</b></font> artifact_metadata["latest_version"]
197     release_url, file_name = _get_release_url<font color="#3090c7"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>(
198         repository, group_id, artifact_id, packaging, version, nexus_url, classifier
199     )
200     target_file = __resolve_target_file(file_name, target_dir, target_file)
201     return __save_artifact(release_url, target_file, headers)
202 def get_release(
203     nexus_url,
204     repository,
205     group_id,
206     artifact_id,
207     packaging,
208     version,
209     target_dir="/tmp",
210     target_file=None,
211     classifier=None,
212     username=None,
213     password=</b></font>None,
214 ):
215     log.debug(
216         "======================== MODULE FUNCTION: nexus.get_release(nexus_url=%s,"
217         " repository=%s, group_id=%s, artifact_id=%s, packaging=%s, version=%s,"
218         " target_dir=%s, classifier=%s)",
219         nexus_url,
220         repository,
221         group_id,
222         artifact_id,
223         packaging,
224         version,
225         target_dir,
226         classifier,
227 <a name="3"></a>    )
228     headers = {}
229     if username and password:
230         headers["Authorization"] = "Basic {}"<font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(
231             base64.encodestring("{}:{}".format(username, password)).replace("\n", "")
232         )
233     release_url, file_name = _get_release_url(
234         repository, group_id, artifact_id, packaging, version, nexus_url, classifier
235     )
236     target_file = __resolve_target_file(file_name, target_dir, target_file)
237     return __save_artifact(release_url, target_file, headers)
238 def __resolve_target_file(file_name, target_dir, target_file=None):
239     if target_file is None:
240         target_file = os.path.join(target_dir, file_name)
241     return target_file
242 def _get_snapshot_url(
243     nexus_url,
244     repository,
245     group_id,
246     artifact_id,
247     version,
248     packaging,
249     snapshot_version=None,
250     classifier=None,
251     headers=None,
252     just_get_version_string=None,
253 ):
254     if headers is None:
255         headers = {}
256 <a name="7"></a>    has_classifier = classifier is not None and classifier != ""
257     if</b></font> snapshot_version is None:
258         snapshot_version_metadata <font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= _get_snapshot_version_metadata(
259             nexus_url=nexus_url,
260             repository=repository,
261             group_id=group_id,
262             artifact_id=artifact_id,
263             version=version,
264             headers=headers,
265         )
266         if packaging not in snapshot_version_metadata["snapshot_versions"]:
267             error_message = """Cannot find requested packaging '{packaging}' in the snapshot version metadata.
268                       nexus_url: {nexus_url}
269                       repository: {repository}
270                       group_id: {group_id}
271                       artifact_id: {artifact_id}
272                       packaging: {packaging}
273                       classifier: {classifier}
274                       version: {version}""".format(
275                 nexus_url=nexus_url,
276                 repository=repository,
277                 group_id=group_id,
278                 artifact_id=artifact_id,
279                 packaging=packaging,
280                 classifier=classifier,
281                 version=version,
282 <a name="11"></a>            )
283             raise nexusError(</b></font>error_message)
284         <font color="#b041ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>if (
285             has_classifier
286             and classifier not in snapshot_version_metadata["snapshot_versions"]
287         ):
288             error_message = """Cannot find requested classifier '{classifier}' in the snapshot version metadata.
289                       nexus_url: {nexus_url}
290                       repository: {repository}
291                       group_id: {group_id}
292                       artifact_id: {artifact_id}
293                       packaging: {packaging}
294                       classifier: {classifier}
295                       version: {version}""".format(
296                 nexus_url=nexus_url,
297                 repository=repository,
298                 group_id=group_id,
299                 artifact_id=artifact_id,
300                 packaging=packaging,
301                 classifier=classifier,
302                 version=version,
303 <a name="8"></a>            )
304             raise nexusError(error_message)
305         snapshot_version = snapshot_version_metadata["snapshot_versions"][</b></font><font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>packaging]
306     group_url = __get_group_id_subpath(group_id)
307     file_name = "{artifact_id}-{snapshot_version}{classifier}.{packaging}".format(
308         artifact_id=artifact_id,
309         snapshot_version=snapshot_version,
310         packaging=packaging,
311         classifier=__get_classifier_url(classifier),
312     )
313     snapshot_url = "{nexus_url}/{repository}/{group_url}/{artifact_id}/{version}/{file_name}".format(
314         nexus_url=nexus_url,
315         repository=repository,
316         group_url=group_url,
317         artifact_id=artifact_id,
318         version=version,
319         file_name=file_name,
320     )
321     log.debug(</b></font>"snapshot_url=%s", snapshot_url)
322     if just_get_version_string:
323         return snapshot_version
324     else:
325         return snapshot_url, file_name
326 <a name="6"></a>
327 def _get_release_url(
328     repository, group_id, artifact_id, packaging, version, nexus_url, classifier<font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=None
329 ):
330     group_url = __get_group_id_subpath(group_id)
331     file_name = "{artifact_id}-{version}{classifier}.{packaging}".format(
332         artifact_id=artifact_id,
333         version=version,
334         packaging=packaging,
335         classifier=__get_classifier_url(classifier),
336     )
337     release_url = "{nexus_url}/{repository}/{group_url}/{artifact_id}/{version}/{file_name}".format(
338         nexus_url=nexus_url,
339         repository=repository,
340         group_url=group_url,
341         artifact_id=artifact_id,
342         version=version,
343         file_name=file_name,
344     )
345     log.debug("release_url=%s", release_url)
346     return release_url, file_name
347 def _get_artifact_metadata_url(nexus_url, repository, group_id, artifact_id):
348 <a name="16"></a>    group_url =</b></font> __get_group_id_subpath(group_id)
349     artifact_metadata_url = (
350         "{nexus_url}/{repository}/{group_url}/{artifact_id}/maven-metadata.xml"<font color="#2981b2"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.format(
351             nexus_url=nexus_url,
352             repository=repository,
353             group_url=group_url,
354             artifact_id=artifact_id,
355         )
356     )
357     log.debug("artifact_metadata_url=%s", artifact_metadata_url)
358     return artifact_metadata_url
359 <a name="4"></a>def _get_artifact_metadata_xml(nexus_url, repository, group_id, artifact_id, headers):
360     artifact_metadata_url =</b></font> _get_artifact_metadata_url(
361         nexus_url<font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=nexus_url,
362         repository=repository,
363         group_id=group_id,
364         artifact_id=artifact_id,
365     )
366     try:
367         request = urllib.request.Request(artifact_metadata_url, None, headers)
368         artifact_metadata_xml = urllib.request.urlopen(request).read()
369     except (HTTPError, URLError) as err:
370         message = "Could not fetch data from url: {}. ERROR: {}".format(
371             artifact_metadata_url, err
372         )
373         raise CommandExecutionError(message)
374     log.debug("artifact_metadata_xml=%s", artifact_metadata_xml)
375     return artifact_metadata_xml
376 <a name="9"></a>
377 def _get_artifact_metadata(nexus_url, repository, group_id, artifact_id, headers):
378     metadata_xml =</b></font> _get_artifact_metadata_xml(
379         nexus_url<font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=nexus_url,
380         repository=repository,
381         group_id=group_id,
382         artifact_id=artifact_id,
383         headers=headers,
384     )
385     root = ET.fromstring(metadata_xml)
386     assert group_id == root.find("groupId").text
387     assert artifact_id == root.find("artifactId").text
388     versions = root.find("versioning").find(</b></font>"versions")
389     versionList = []
390     for version in versions.iter("version"):
391         versionList.append(version.text)
392     latest_version = max(versionList)
393     log.debug("latest version=%s", latest_version)
394     return {"latest_version": latest_version}
395 <a name="15"></a>def _get_snapshot_version_metadata_url(
396     nexus_url, repository, group_id, artifact_id, version
397 ):
398     group_url <font color="#f52887"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>= __get_group_id_subpath(group_id)
399     snapshot_version_metadata_url = "{nexus_url}/{repository}/{group_url}/{artifact_id}/{version}/maven-metadata.xml".format(
400         nexus_url=nexus_url,
401         repository=repository,
402         group_url=group_url,
403         artifact_id=artifact_id,
404         version=version,
405     )
406     log.debug("snapshot_version_metadata_url=%s", snapshot_version_metadata_url)
407     return snapshot_version_metadata_url
408 def _get_snapshot_version_metadata_xml(
409     nexus_url, repository, group_id, artifact_id, version, headers
410 <a name="2"></a>):
411     snapshot_version_metadata_url =</b></font> _get_snapshot_version_metadata_url(
412         nexus_url<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=nexus_url,
413         repository=repository,
414         group_id=group_id,
415         artifact_id=artifact_id,
416         version=version,
417     )
418     try:
419         request = urllib.request.Request(snapshot_version_metadata_url, None, headers)
420         snapshot_version_metadata_xml = urllib.request.urlopen(request).read()
421     except (HTTPError, URLError) as err:
422         message = "Could not fetch data from url: {}. ERROR: {}".format(
423             snapshot_version_metadata_url, err
424         )
425         raise CommandExecutionError(message)
426     log.debug("snapshot_version_metadata_xml=%s", snapshot_version_metadata_xml)
427     return snapshot_version_metadata_xml
428 def _get_snapshot_version_metadata(
429     nexus_url, repository, group_id, artifact_id, version, headers
430 ):
431     metadata_xml = _get_snapshot_version_metadata_xml(
432         nexus_url=nexus_url,
433         repository=repository,
434         group_id=group_id,
435         artifact_id=artifact_id,
436         version=version,
437         headers=headers,
438     )
439     metadata = ET.fromstring(metadata_xml)
440     assert group_id == metadata.find("groupId").text
441     assert artifact_id == metadata.find("artifactId").text
442     assert version == metadata.find("version").text
443     snapshot_versions = metadata.find("versioning").find("snapshotVersions")
444     extension_version_dict = {}
445     for snapshot_version in snapshot_versions:
446         extension = snapshot_version.find("extension").text
447         value = snapshot_version.find("value").</b></font>text
448         extension_version_dict[extension] = value
449         if snapshot_version.find("classifier") is not None:
450 <a name="14"></a>            classifier = snapshot_version.find("classifier").text
451             extension_version_dict[classifier] = value
452     return {"<font color="#842dce"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>snapshot_versions": extension_version_dict}
453 def __save_artifact(artifact_url, target_file, headers):
454     log.debug("__save_artifact(%s, %s)", artifact_url, target_file)
455     result = {"status": False, "changes": {}, "comment": ""}
456     if os.path.isfile(target_file):
457         log.debug("File %s already exists, checking checksum...", target_file)
458         checksum_url = artifact_url + ".sha1"
459         checksum_success, artifact_sum, checksum_comment = __download(
460 <a name="0"></a>            checksum_url, headers
461         )
462         if</b></font> checksum_success:
463             log<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.debug("Downloaded SHA1 SUM: %s", artifact_sum)
464             file_sum = __salt__["file.get_hash"](path=target_file, form="sha1")
465             log.debug("Target file (%s) SHA1 SUM: %s", target_file, file_sum)
466             if artifact_sum == file_sum:
467                 result["status"] = True
468                 result["target_file"] = target_file
469                 result["comment"] = (
470                     "File {} already exists, checksum matches with nexus.\n"
471                     "Checksum URL: {}".format(target_file, checksum_url)
472                 )
473                 return result
474             else:
475                 result["comment"] = (
476                     "File {} already exists, checksum does not match with nexus!\n"
477                     "Checksum URL: {}".format(target_file, checksum_url)
478                 )
479         else:
480             result["status"] = False
481             result["comment"] = checksum_comment
482             return result
483     log.debug("Downloading: %s -&gt; %s", artifact_url, target_file)
484     try:
485         request = urllib.request.Request(artifact_url, None, headers)
486         f = urllib.request.urlopen(request)
487         with salt.utils.files.fopen(target_file, "wb") as local_file:
488             local_file.write(salt.utils.stringutils.to_bytes(f.read()))
489         result["status"] = True
490         result["comment"] = __append_comment(
491             "Artifact downloaded from URL: {}".format(artifact_url),
492             result["comment"],
493         )
494         result["changes"]["downloaded_file"] = target_file
495         result["target_file"] = target_file
496     except (HTTPError, URLError) as e:
497         result["status"] = False
498         result["comment"] = __get_error_comment(e, artifact_url)
499     return result
500 <a name="1"></a>
501 def __get_group_id_subpath(group_id):
502     group_url =</b></font> group_id.replace(".", "/")
503     <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>return group_url
504 def __get_classifier_url(classifier):
505     has_classifier = classifier is not None and classifier != ""
506     return "-" + classifier if has_classifier else ""
507 def __download(request_url, headers):
508     log.debug("Downloading content from %s", request_url)
509     success = False
510     content = None
511     comment = None
512     try:
513         request = urllib.request.Request(request_url, None, headers)
514         url = urllib.request.urlopen(request)
515         content = url.read()
516         success = True
517     except HTTPError as e:
518         comment = __get_error_comment(e, request_url)
519     return success, content, comment
520 def __get_error_comment(http_error, request_url):
521     if http_error.code == http.client.NOT_FOUND:
522         comment = "HTTP Error 404. Request URL: " + request_url
523     elif http_error.code == http.client.CONFLICT:
524         comment = (
525             "HTTP Error 409: Conflict. Requested URL: {}. \nThis error may be caused by"
526             " reading snapshot artifact from non-snapshot repository.".format(
527                 request_url
528             )
529         )
530     else:
531         comment = "HTTP Error {err_code}. Request URL: {url}".format(
532             err_code=http_error.code, url=request_url
533         )
534     return comment
535 def __append_comment(new_comment, current_comment=""):
536     return current_comment + "\n" + new_comment
537 class nexusError(Exception):
538     def __init__(self, value):
539         super().__init__()
540         self.value = value
541     def __str__(self):
542         return repr(self.v</b></font>alue)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>artifactory_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import http.client
2 import logging
3 import os
4 import urllib.request
5 import xml.etree.ElementTree as ET
6 from urllib.error import HTTPError, URLError
7 import salt.utils.files
8 import salt.utils.hashutils
9 import salt.utils.stringutils
10 from salt.exceptions import CommandExecutionError
11 log = logging.getLogger(__name__)
12 __virtualname__ = "artifactory"
13 def __virtual__():
14     return True
15 def get_latest_snapshot(
16     artifactory_url,
17     repository,
18     group_id,
19     artifact_id,
20     packaging,
21     target_dir="/tmp",
22     target_file=None,
23     classifier=None,
24     username=None,
25     password=None,
26     use_literal_group_id=False,
27 ):
28     log.debug(
29         "======================== MODULE FUNCTION: artifactory.get_latest_snapshot,"
30         " artifactory_url=%s, repository=%s, group_id=%s, artifact_id=%s, packaging=%s,"
31         " target_dir=%s, classifier=%s)",
32         artifactory_url,
33         repository,
34         group_id,
35         artifact_id,
36         packaging,
37         target_dir,
38         classifier,
39     )
40 <a name="13"></a>    headers = {}
41     if username and password:
42         headers["Authorization"] = "Basic {}".format(
43             salt.utils.hashutils<font color="#3b9c9c"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.base64_encodestring(
44                 "{}:{}".format(username.replace("\n", ""), password.replace("\n", ""))
45             )
46         )
47     artifact_metadata = _get_artifact_metadata(
48         artifactory_url=artifactory_url,
49         repository=repository,
50         group_id=group_id,
51         artifact_id=artifact_id,
52         headers=headers,
53 <a name="10"></a>        use_literal_group_id=</b></font>use_literal_group_id,
54     )
55     version = artifact_metadata["latest_version"]
56     snapshot_url, file_name <font color="#ad5910"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= _get_snapshot_url(
57         artifactory_url=artifactory_url,
58         repository=repository,
59         group_id=group_id,
60         artifact_id=artifact_id,
61         version=version,
62         packaging=packaging,
63         classifier=classifier,
64         headers=headers,
65         use_literal_group_id=use_literal_group_id,
66     )
67     target_file = __resolve_target_file(file_name, target_dir, target_file)
68     return __save_artifact(snapshot_url, target_file, headers)
69 def get_snapshot(
70     artifactory_url,
71     repository,
72     group_id,
73     artifact_id,
74     packaging,
75     version,
76     snapshot_version=None,
77     target_dir="/tmp",
78     target_file=</b></font>None,
79     classifier=None,
80     username=None,
81     password=None,
82     use_literal_group_id=False,
83 ):
84     log.debug(
85         "======================== MODULE FUNCTION:"
86         " artifactory.get_snapshot(artifactory_url=%s, repository=%s, group_id=%s,"
87         " artifact_id=%s, packaging=%s, version=%s, target_dir=%s, classifier=%s)",
88         artifactory_url,
89         repository,
90         group_id,
91         artifact_id,
92         packaging,
93         version,
94         target_dir,
95         classifier,
96     )
97     headers = {}
98     if username and password:
99         headers["Authorization"] = "Basic {}".format(
100             salt.utils.hashutils.base64_encodestring(
101                 "{}:{}".format(username.replace("\n", ""), password.replace("\n", ""))
102             )
103         )
104 <a name="5"></a>    snapshot_url, file_name = _get_snapshot_url(
105         artifactory_url=artifactory_url,
106         repository=repository,
107         group_id<font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=group_id,
108         artifact_id=artifact_id,
109         version=version,
110         packaging=packaging,
111         snapshot_version=snapshot_version,
112         classifier=classifier,
113         headers=headers,
114         use_literal_group_id=use_literal_group_id,
115     )
116     target_file = __resolve_target_file(file_name, target_dir, target_file)
117     return __save_artifact(snapshot_url, target_file, headers)
118 def get_latest_release(
119     artifactory_url,
120     repository,
121     group_id,
122     artifact_id,
123     packaging,
124     target_dir="/tmp",
125     target_file=None,
126     classifier=None,
127     username=None,
128     password=None,
129     use_literal_group_id=False,
130 ):
131     log.debug(
132         "======================== MODULE FUNCTION:"
133         " artifactory.get_latest_release(artifactory_url=%s, repository=%s,"
134         " group_id=%s, artifact_id=%s, packaging=%s, target_dir=%s, classifier=%s)",
135         artifactory_url,
136         repository,
137         group_id,
138         artifact_id,
139         packaging,
140         target_dir,
141         classifier,
142     )
143 <a name="12"></a>    headers = {}
144     if username and password:
145         headers["Authorization"] = "Basic {}".format(
146             salt.</b></font>utils.hashutils<font color="#571b7e"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.base64_encodestring(
147                 "{}:{}".format(username.replace("\n", ""), password.replace("\n", ""))
148             )
149         )
150     version = __find_latest_version(
151         artifactory_url=artifactory_url,
152         repository=repository,
153         group_id=group_id,
154 <a name="17"></a>        artifact_id=artifact_id,
155         headers=headers,
156     )
157     release_url, file_name =</b></font> _get_release_url<font color="#3090c7"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>(
158         repository,
159         group_id,
160         artifact_id,
161         packaging,
162         version,
163         artifactory_url,
164         classifier,
165         use_literal_group_id,
166     )
167     target_file = __resolve_target_file(file_name, target_dir, target_file)
168     return __save_artifact(release_url, target_file, headers)
169 def get_release(
170     artifactory_url,
171     repository,
172     group_id,
173     artifact_id,
174     packaging,
175     version,
176     target_dir="/tmp",
177     target_file=None,
178     classifier=None,
179     username=None,
180     password=</b></font>None,
181     use_literal_group_id=False,
182 ):
183     log.debug(
184         "======================== MODULE FUNCTION:"
185         " artifactory.get_release(artifactory_url=%s, repository=%s, group_id=%s,"
186         " artifact_id=%s, packaging=%s, version=%s, target_dir=%s, classifier=%s)",
187         artifactory_url,
188         repository,
189         group_id,
190         artifact_id,
191         packaging,
192         version,
193         target_dir,
194         classifier,
195     )
196 <a name="3"></a>    headers = {}
197     if username and password:
198         headers["Authorization"] = "Basic {}".format(
199             salt.utils.hashutils<font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.base64_encodestring(
200                 "{}:{}".format(username.replace("\n", ""), password.replace("\n", ""))
201             )
202         )
203     release_url, file_name = _get_release_url(
204         repository,
205         group_id,
206         artifact_id,
207         packaging,
208         version,
209         artifactory_url,
210         classifier,
211         use_literal_group_id,
212     )
213     target_file = __resolve_target_file(file_name, target_dir, target_file)
214     return __save_artifact(release_url, target_file, headers)
215 def __resolve_target_file(file_name, target_dir, target_file=None):
216     if target_file is None:
217         target_file = os.path.join(target_dir, file_name)
218     return target_file
219 def _get_snapshot_url(
220     artifactory_url,
221     repository,
222     group_id,
223     artifact_id,
224     version,
225     packaging,
226     snapshot_version=None,
227     classifier=None,
228     headers=None,
229     use_literal_group_id=False,
230 ):
231     if headers is None:
232         headers = {}
233     has_classifier = classifier is not None and classifier != ""
234 <a name="7"></a>
235     if</b></font> snapshot_version is None:
236         try:
237             snapshot_version_metadata <font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= _get_snapshot_version_metadata(
238                 artifactory_url=artifactory_url,
239                 repository=repository,
240                 group_id=group_id,
241                 artifact_id=artifact_id,
242                 version=version,
243                 headers=headers,
244             )
245             if (
246                 not has_classifier
247                 and packaging not in snapshot_version_metadata["snapshot_versions"]
248             ):
249                 error_message = """Cannot find requested packaging '{packaging}' in the snapshot version metadata.
250                           artifactory_url: {artifactory_url}
251                           repository: {repository}
252                           group_id: {group_id}
253                           artifact_id: {artifact_id}
254                           packaging: {packaging}
255                           classifier: {classifier}
256                           version: {version}""".format(
257                     artifactory_url=artifactory_url,
258                     repository=repository,
259                     group_id=group_id,
260                     artifact_id=artifact_id,
261                     packaging=packaging,
262                     classifier=classifier,
263                     version=version,
264                 )
265                 raise ArtifactoryError(</b></font>error_message)
266 <a name="11"></a>            packaging_with_classifier = (
267                 packaging if not has_classifier else packaging + ":" + classifier
268             )
269             <font color="#b041ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>if (
270                 has_classifier
271                 and packaging_with_classifier
272                 not in snapshot_version_metadata["snapshot_versions"]
273             ):
274                 error_message = """Cannot find requested classifier '{classifier}' in the snapshot version metadata.
275                           artifactory_url: {artifactory_url}
276                           repository: {repository}
277                           group_id: {group_id}
278                           artifact_id: {artifact_id}
279                           packaging: {packaging}
280                           classifier: {classifier}
281                           version: {version}""".format(
282                     artifactory_url=artifactory_url,
283                     repository=repository,
284                     group_id=group_id,
285                     artifact_id=artifact_id,
286                     packaging=packaging,
287                     classifier=classifier,
288                     version=version,
289                 )
290                 raise ArtifactoryError(error_message)
291             snapshot_version = snapshot_version_metadata["snapshot_versions"][</b></font>
292                 packaging_with_classifier
293             ]
294         except CommandExecutionError as err:
295             log.error(
296 <a name="8"></a>                "Could not fetch maven-metadata.xml. Assuming snapshot_version=%s.",
297                 version,
298             )
299             snapshot_version =<font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b> version
300     group_url = __get_group_id_subpath(group_id, use_literal_group_id)
301     file_name = "{artifact_id}-{snapshot_version}{classifier}.{packaging}".format(
302         artifact_id=artifact_id,
303         snapshot_version=snapshot_version,
304         packaging=packaging,
305         classifier=__get_classifier_url(classifier),
306     )
307     snapshot_url = "{artifactory_url}/{repository}/{group_url}/{artifact_id}/{version}/{file_name}".format(
308         artifactory_url=artifactory_url,
309         repository=repository,
310         group_url=group_url,
311         artifact_id=artifact_id,
312         version=version,
313         file_name=file_name,
314     )
315     log.debug(</b></font>"snapshot_url=%s", snapshot_url)
316     return snapshot_url, file_name
317 def _get_release_url(
318     repository,
319     group_id,
320     artifact_id,
321     packaging,
322 <a name="6"></a>    version,
323     artifactory_url,
324     classifier=None,
325     use_literal_group_id<font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=False,
326 ):
327     group_url = __get_group_id_subpath(group_id, use_literal_group_id)
328     file_name = "{artifact_id}-{version}{classifier}.{packaging}".format(
329         artifact_id=artifact_id,
330         version=version,
331         packaging=packaging,
332         classifier=__get_classifier_url(classifier),
333     )
334     release_url = "{artifactory_url}/{repository}/{group_url}/{artifact_id}/{version}/{file_name}".format(
335         artifactory_url=artifactory_url,
336         repository=repository,
337         group_url=group_url,
338         artifact_id=artifact_id,
339         version=version,
340         file_name=file_name,
341     )
342     log.debug("release_url=%s", release_url)
343     return release_url, file_name
344 def _get_artifact_metadata_url(
345     artifactory_url, repository, group_id, artifact_id, use_literal_group_id=</b></font>False
346 <a name="16"></a>):
347     group_url = __get_group_id_subpath(group_id, use_literal_group_id)
348     artifact_metadata_url = "{artifactory_url}/{repository}/{group_url}/{artifact_id}/maven-metadata.xml"<font color="#2981b2"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.format(
349         artifactory_url=artifactory_url,
350         repository=repository,
351         group_url=group_url,
352         artifact_id=artifact_id,
353     )
354     log.debug("artifact_metadata_url=%s", artifact_metadata_url)
355     return artifact_metadata_url
356 def _get_artifact_metadata_xml(
357     artifactory_url,
358     repository,
359     group_id,
360     artifact_id,
361     headers,
362     use_literal_group_id=</b></font>False,
363 ):
364 <a name="4"></a>
365     artifact_metadata_url = _get_artifact_metadata_url(
366         artifactory_url=artifactory_url,
367         repository<font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=repository,
368         group_id=group_id,
369         artifact_id=artifact_id,
370         use_literal_group_id=use_literal_group_id,
371     )
372     try:
373         request = urllib.request.Request(artifact_metadata_url, None, headers)
374         artifact_metadata_xml = urllib.request.urlopen(request).read()
375     except (HTTPError, URLError) as err:
376         message = "Could not fetch data from url: {}. ERROR: {}".format(
377             artifact_metadata_url, err
378         )
379         raise CommandExecutionError(message)
380     log.debug("artifact_metadata_xml=%s", artifact_metadata_xml)
381     return artifact_metadata_xml
382 def _get_artifact_metadata(
383     artifactory_url,
384     repository,
385     group_id,
386     artifact_id,
387     headers,
388     use_literal_group_id=</b></font>False,
389 <a name="9"></a>):
390     metadata_xml = _get_artifact_metadata_xml(
391         artifactory_url=artifactory_url,
392         repository<font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=repository,
393         group_id=group_id,
394         artifact_id=artifact_id,
395         headers=headers,
396         use_literal_group_id=use_literal_group_id,
397     )
398     root = ET.fromstring(metadata_xml)
399     assert group_id == root.find("groupId").text
400     assert artifact_id == root.find("artifactId").text
401     latest_version = root.find("versioning").find(</b></font>"latest").text
402     return {"latest_version": latest_version}
403 def _get_snapshot_version_metadata_url(
404     artifactory_url,
405     repository,
406     group_id,
407     artifact_id,
408 <a name="15"></a>    version,
409     use_literal_group_id=False,
410 ):
411     group_url <font color="#f52887"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= __get_group_id_subpath(group_id, use_literal_group_id)
412     snapshot_version_metadata_url = "{artifactory_url}/{repository}/{group_url}/{artifact_id}/{version}/maven-metadata.xml".format(
413         artifactory_url=artifactory_url,
414         repository=repository,
415         group_url=group_url,
416         artifact_id=artifact_id,
417         version=version,
418     )
419     log.debug("snapshot_version_metadata_url=%s", snapshot_version_metadata_url)
420     return snapshot_version_metadata_url
421 def _get_snapshot_version_metadata_xml(
422     artifactory_url,
423     repository,
424     group_id,
425     artifact_id,
426     version,
427     headers,
428     use_literal_group_id=</b></font>False,
429 ):
430 <a name="2"></a>
431     snapshot_version_metadata_url = _get_snapshot_version_metadata_url(
432         artifactory_url=artifactory_url,
433         repository<font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=repository,
434         group_id=group_id,
435         artifact_id=artifact_id,
436         version=version,
437         use_literal_group_id=use_literal_group_id,
438     )
439     try:
440         request = urllib.request.Request(snapshot_version_metadata_url, None, headers)
441         snapshot_version_metadata_xml = urllib.request.urlopen(request).read()
442     except (HTTPError, URLError) as err:
443         message = "Could not fetch data from url: {}. ERROR: {}".format(
444             snapshot_version_metadata_url, err
445         )
446         raise CommandExecutionError(message)
447     log.debug("snapshot_version_metadata_xml=%s", snapshot_version_metadata_xml)
448     return snapshot_version_metadata_xml
449 def _get_snapshot_version_metadata(
450     artifactory_url, repository, group_id, artifact_id, version, headers
451 ):
452     metadata_xml = _get_snapshot_version_metadata_xml(
453         artifactory_url=artifactory_url,
454         repository=repository,
455         group_id=group_id,
456         artifact_id=artifact_id,
457         version=version,
458         headers=headers,
459     )
460     metadata = ET.fromstring(metadata_xml)
461     assert group_id == metadata.find("groupId").text
462     assert artifact_id == metadata.find("artifactId").text
463     assert version == metadata.find("version").text
464     snapshot_versions = metadata.find("versioning").find("snapshotVersions")
465     extension_version_dict = {}
466     for snapshot_version in snapshot_versions:
467         extension = snapshot_version.find("extension").text
468         value = snapshot_version.find("value").</b></font>text
469         if snapshot_version.find("classifier") is not None:
470             classifier = snapshot_version.find("classifier").text
471             extension_version_dict[extension + ":" + classifier] = value
472         else:
473             extension_version_dict[extension] = value
474     return {"snapshot_versions": extension_version_dict}
475 def __get_latest_version_url(
476     artifactory_url, repository, group_id, artifact_id, use_literal_group_id=False
477 ):
478     group_url = __get_group_id_subpath(group_id, use_literal_group_id)
479     latest_version_url = "{artifactory_url}/api/search/latestVersion?g={group_url}&amp;a={artifact_id}&amp;repos={repository}".format(
480         artifactory_url=artifactory_url,
481         repository=repository,
482         group_url=group_url,
483         artifact_id=artifact_id,
484     )
485     log.debug("latest_version_url=%s", latest_version_url)
486     return latest_version_url
487 def __find_latest_version(
488     artifactory_url,
489     repository,
490     group_id,
491     artifact_id,
492     headers,
493     use_literal_group_id=False,
494 ):
495     latest_version_url = __get_latest_version_url(
496         artifactory_url=artifactory_url,
497         repository=repository,
498         group_id=group_id,
499         artifact_id=artifact_id,
500         use_literal_group_id=use_literal_group_id,
501     )
502     try:
503         request = urllib.request.Request(latest_version_url, None, headers)
504         version = urllib.request.urlopen(request).read()
505     except (HTTPError, URLError) as err:
506         message = "Could not fetch data from url: {}. ERROR: {}".format(
507             latest_version_url, err
508         )
509         raise CommandExecutionError(message)
510     log.debug("Response of: %s", version)
511 <a name="14"></a>    if version is None or version == "":
512         raise ArtifactoryError("Unable to find release version")
513     r<font color="#842dce"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>eturn version
514 def __save_artifact(artifact_url, target_file, headers):
515     log.debug("__save_artifact(%s, %s)", artifact_url, target_file)
516     result = {"status": False, "changes": {}, "comment": ""}
517     if os.path.isfile(target_file):
518         log.debug("File %s already exists, checking checksum...", target_file)
519         checksum_url = artifact_url + ".sha1"
520         checksum_success, artifact_sum, checksum_comment = __download(
521             checksum_url, headers
522 <a name="0"></a>        )
523         if</b></font> checksum_success:
524             artifact_sum = salt.utils.stringutils.to_unicode(artifact_sum)
525             log<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.debug("Downloaded SHA1 SUM: %s", artifact_sum)
526             file_sum = __salt__["file.get_hash"](path=target_file, form="sha1")
527             log.debug("Target file (%s) SHA1 SUM: %s", target_file, file_sum)
528             if artifact_sum == file_sum:
529                 result["status"] = True
530                 result["target_file"] = target_file
531                 result["comment"] = (
532                     "File {} already exists, checksum matches with Artifactory.\n"
533                     "Checksum URL: {}".format(target_file, checksum_url)
534                 )
535                 return result
536             else:
537                 result["comment"] = (
538                     "File {} already exists, checksum does not match with"
539                     " Artifactory!\nChecksum URL: {}".format(target_file, checksum_url)
540                 )
541         else:
542             result["status"] = False
543             result["comment"] = checksum_comment
544             return result
545     log.debug("Downloading: %s -&gt; %s", artifact_url, target_file)
546     try:
547         request = urllib.request.Request(artifact_url, None, headers)
548         f = urllib.request.urlopen(request)
549         with salt.utils.files.fopen(target_file, "wb") as local_file:
550             local_file.write(salt.utils.stringutils.to_bytes(f.read()))
551         result["status"] = True
552         result["comment"] = __append_comment(
553             "Artifact downloaded from URL: {}".format(artifact_url),
554             result["comment"],
555         )
556         result["changes"]["downloaded_file"] = target_file
557         result["target_file"] = target_file
558     except (HTTPError, URLError) as e:
559         result["status"] = False
560         result["comment"] = __get_error_comment(e, artifact_url)
561     return result
562 def __get_group_id_subpath(group_id, use_literal_group_id=</b></font>False):
563 <a name="1"></a>    if not use_literal_group_id:
564         group_url = group_id.replace(".", "/")
565         return group_url
566     <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>return group_id
567 def __get_classifier_url(classifier):
568     has_classifier = classifier is not None and classifier != ""
569     return "-" + classifier if has_classifier else ""
570 def __download(request_url, headers):
571     log.debug("Downloading content from %s", request_url)
572     success = False
573     content = None
574     comment = None
575     try:
576         request = urllib.request.Request(request_url, None, headers)
577         url = urllib.request.urlopen(request)
578         content = url.read()
579         success = True
580     except HTTPError as e:
581         comment = __get_error_comment(e, request_url)
582     return success, content, comment
583 def __get_error_comment(http_error, request_url):
584     if http_error.code == http.client.NOT_FOUND:
585         comment = "HTTP Error 404. Request URL: " + request_url
586     elif http_error.code == http.client.CONFLICT:
587         comment = (
588             "HTTP Error 409: Conflict. Requested URL: {}. \nThis error may be caused by"
589             " reading snapshot artifact from non-snapshot repository.".format(
590                 request_url
591             )
592         )
593     else:
594         comment = "HTTP Error {err_code}. Request URL: {url}".format(
595             err_code=http_error.code, url=request_url
596         )
597     return comment
598 def __append_comment(new_comment, current_comment=""):
599     return current_comment + "\n" + new_comment
600 class ArtifactoryError(Exception):
601     def __init__(self, value):
602         super().__init__()
603         self.value = value
604     def __str__(self):
605         return repr(self.v</b></font>alue)
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
