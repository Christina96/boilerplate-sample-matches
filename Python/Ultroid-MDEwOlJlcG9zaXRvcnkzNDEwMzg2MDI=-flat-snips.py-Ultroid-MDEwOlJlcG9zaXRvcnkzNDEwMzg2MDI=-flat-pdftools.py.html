
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 2.9579067121729237%, Tokens: 13</h2>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-snips.py</h3>
            <pre><code>1  import os
2  from telegraph import upload_file as uf
3  from telethon.utils import pack_bot_file_id
4  from pyUltroid._misc import sudoers
5  from pyUltroid.dB.snips_db import add_snip, get_snips, list_snip, rem_snip
6  from pyUltroid.fns.tools import create_tl_btn, format_btn, get_msg_button
7  from . import events, get_string, mediainfo, udB, ultroid_bot, ultroid_cmd
8  from ._inline import something
<span onclick='openModal()' class='match'>9  @ultroid_cmd(pattern="addsnip( (.*)|$)")
10  async def an(e):
11      wrd = (e.pattern_match.group(1).strip()).lower()
12      wt = await e.get_reply_message()
13      if not (wt and wrd):
14          return await e.eor(get_string("snip_1"))
15      if "$" in wrd:
16          wrd = wrd.replace("$", "")
17      btn = format_btn(wt.buttons) if wt.buttons else None
18      if wt and wt.media:
19          wut = mediainfo(wt.media)
20          if wut.startswith(("pic", "gif")):
21              dl = await wt.download_media()
22              variable = uf(dl)
23              os.remove(dl)
24              m = f"https://graph.org{variable[0]}"
25          elif wut == "video":
26              if wt.media.document.size > 8 * 1000 * 1000:
27                  return await e.eor(get_string("com_4"), time=5)
28              dl = await wt.download_media()
29              variable = uf(dl)
30              os.remove(dl)
31              m = f"https://graph.org{variable[0]}"
32          else:
33              m = pack_bot_file_id(wt.media)
34          if wt.text:
35              txt = wt.text
36              if not btn:
37                  txt, btn = get_msg_button(wt.text)
38              add_snip(wrd, txt, m, btn)
39          else:
40              add_snip(wrd, None, m, btn)
41      else:
42          txt = wt.text
43          if not btn:
44              txt, btn = get_msg_button(wt.text)
45          add_snip(wrd, txt, None, btn)
46      await e.eor(f"Done : snip `${wrd}` Saved.")
47      ultroid_bot.add_handler(add_snips, events.NewMessage())
48  @ultroid_cmd(pattern="remsnip( (.*)|$)")
49  async def rs(e):
50      wrd = (e.pattern_match.group(1).strip()).lower()
</span>51      if not wrd:
52          return await e.eor(get_string("snip_2"))
53      if wrd.startswith("$"):
54          wrd = wrd.replace("$", "")
55      rem_snip(wrd)
56      await e.eor(f"Done : snip `${wrd}` Removed.")
57  @ultroid_cmd(pattern="listsnip")
58  async def lsnote(e):
59      if x := list_snip():
60          sd = "SNIPS Found :\n\n"
61          return await e.eor(sd + x)
62      await e.eor("No Snips Found Here")
63  async def add_snips(e):
64      if not e.out and e.sender_id not in sudoers():
65          return
66      xx = [z.replace("$", "") for z in e.text.lower().split() if z.startswith("$")]
67      for z in xx:
68          if k := get_snips(z):
69              msg = k["msg"]
70              media = k["media"]
71              rep = await e.get_reply_message()
72              if rep:
73                  if k.get("button"):
74                      btn = create_tl_btn(k["button"])
75                      return await something(rep, msg, media, btn)
76                  await rep.reply(msg, file=media)
77              else:
78                  await e.delete()
79                  if k.get("button"):
80                      btn = create_tl_btn(k["button"])
81                      return await something(e, msg, media, btn, reply=None)
82                  await ultroid_bot.send_message(e.chat_id, msg, file=media)
83  if udB.get_key("SNIP"):
84      ultroid_bot.add_handler(add_snips, events.NewMessage())
</code></pre>
        </div>
        <div class="column">
            <h3>Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-pdftools.py</h3>
            <pre><code>1  import glob
2  import os
3  import shutil
4  import time
5  import cv2
6  import numpy as np
7  try:
8      from PIL import Image
9  except ImportError:
10      Image = None
11      LOGS.info(f"{__file__}: PIL  not Installed.")
12  from PyPDF2 import PdfFileMerger, PdfFileReader, PdfFileWriter
13  from telethon.errors.rpcerrorlist import PhotoSaveFileInvalidError
14  from pyUltroid.fns.tools import four_point_transform
15  from . import (
16      HNDLR,
17      LOGS,
18      bash,
19      check_filename,
20      downloader,
21      eor,
22      get_string,
23      ultroid_cmd,
24  )
25  if not os.path.isdir("pdf"):
26      os.mkdir("pdf")
27  @ultroid_cmd(
28      pattern="pdf( (.*)|$)",
29  )
30  async def pdfseimg(event):
31      ok = await event.get_reply_message()
32      msg = event.pattern_match.group(1).strip()
33      if not (ok and (ok.document and (ok.document.mime_type == "application/pdf"))):
34          await event.eor("`Reply The pdf u Want to Download..`")
35          return
36      xx = await event.eor(get_string("com_1"))
37      file = ok.media.document
38      k = time.time()
39      filename = "hehe.pdf"
40      result = await downloader(
41          f"pdf/{filename}", file, xx, k, f"Downloading {filename}..."
42      )
43      await xx.delete()
44      pdfp = "pdf/hehe.pdf"
45      pdfp.replace(".pdf", "")
46      pdf = PdfFileReader(pdfp)
47      if not msg:
48          ok = []
49          for num in range(pdf.numPages):
50              pw = PdfFileWriter()
51              pw.addPage(pdf.getPage(num))
52              fil = os.path.join(f"pdf/ult{num + 1}.png")
53              ok.append(fil)
54              with open(fil, "wb") as f:
55                  pw.write(f)
56          os.remove(pdfp)
57          for z in ok:
58              await event.client.send_file(event.chat_id, z)
59          shutil.rmtree("pdf")
60          os.mkdir("pdf")
61          await xx.delete()
62      elif "-" in msg:
63          ok = int(msg.split("-")[-1]) - 1
64          for o in range(ok):
65              pw = PdfFileWriter()
66              pw.addPage(pdf.getPage(o))
67              with open(os.path.join("ult.png"), "wb") as f:
68                  pw.write(f)
69              await event.reply(
70                  file="ult.png",
71              )
72              os.remove("ult.png")
73          os.remove(pdfp)
74      else:
75          o = int(msg) - 1
76          pw = PdfFileWriter()
77          pw.addPage(pdf.getPage(o))
78          with open(os.path.join("ult.png"), "wb") as f:
79              pw.write(f)
80          os.remove(pdfp)
81          try:
82              await event.reply(file="ult.png")
83          except PhotoSaveFileInvalidError:
84              await event.reply(file="ult.png", force_document=True)
85          os.remove("ult.png")
86  @ultroid_cmd(
87      pattern="pdtext( (.*)|$)",
88  )
89  async def pdfsetxt(event):
90      ok = await event.get_reply_message()
91      msg = event.pattern_match.group(1).strip()
92      if not ok and ok.document and ok.document.mime_type == "application/pdf":
93          await event.eor("`Reply The pdf u Want to Download..`")
94          return
95      xx = await event.eor(get_string("com_1"))
96      file = ok.media.document
97      k = time.time()
98      filename = ok.file.name
99      result = await downloader(filename, file, xx, k, f"Downloading {filename}...")
100      await xx.delete()
101      dl = result.name
102      if not msg:
103          pdf = PdfFileReader(dl)
104          text = f"{dl.split('.')[0]}.txt"
105          with open(text, "w") as f:
106              for page_num in range(pdf.numPages):
107                  pageObj = pdf.getPage(page_num)
108                  txt = pageObj.extractText()
109                  f.write(f"Page {page_num + 1}\n")
110                  f.write("".center(100, "-"))
111                  f.write(txt)
112          await event.client.send_file(
113              event.chat_id,
114              text,
115              reply_to=event.reply_to_msg_id,
116          )
117          os.remove(text)
118          os.remove(dl)
119          return
120      if "-" in msg:
121          u, d = msg.split("-")
122          a = PdfFileReader(dl)
123          str = "".join(a.getPage(i).extractText() for i in range(int(u) - 1, int(d)))
124          text = f"{dl.split('.')[0]} {msg}.txt"
125      else:
126          u = int(msg) - 1
127          a = PdfFileReader(dl)
128          str = a.getPage(u).extractText()
129          text = f"{dl.split('.')[0]} Pg-{msg}.txt"
130      with open(text, "w") as f:
131          f.write(str)
132      await event.client.send_file(
133          event.chat_id,
134          text,
135          reply_to=event.reply_to_msg_id,
136      )
137      os.remove(text)
138      os.remove(dl)
<span onclick='openModal()' class='match'>139  @ultroid_cmd(
140      pattern="pdscan( (.*)|$)",
141  )
142  async def imgscan(event):
143      ok = await event.get_reply_message()
144      if not (ok and (ok.media)):
145          await event.eor("`Reply The pdf u Want to Download..`")
146          return
147      if not (
148          ok.photo
149          or (ok.file.name and ok.file.name.endswith(("png", "jpg", "jpeg", "webp")))
150      ):
151          await event.eor("`Reply to a Image only...`")
152          return
153      ultt = await ok.download_media()
154      xx = await event.eor(get_string("com_1"))
155      image = cv2.imread(ultt)
156      original_image = image.copy()
157      ratio = image.shape[0] / 500.0
158      hi, wid = image.shape[:2]
159      ra = 500 / float(hi)
160      dmes = (int(wid * ra), 500)
161      image = cv2.resize(image, dmes, interpolation=cv2.INTER_AREA)
162      image_yuv = cv2.cvtColor(image, cv2.COLOR_BGR2YUV)
163      image_y = np.zeros(image_yuv.shape[:2], np.uint8)
164      image_y[:, :] = image_yuv[:, :, 0]
165      image_blurred = cv2.GaussianBlur(image_y, (3, 3), 0)
166      edges = cv2.Canny(image_blurred, 50, 200, apertureSize=3)
167      contours, hierarchy = cv2.findContours(
168          edges,
169          cv2.RETR_EXTERNAL,
170          cv2.CHAIN_APPROX_SIMPLE,
171      )
172      polygons = []
173      for cnt in contours:
174          hull = cv2.convexHull(cnt)
175          polygons.append(cv2.approxPolyDP(hull, 0.01 * cv2.arcLength(hull, True), False))
176          sortedPoly = sorted(polygons, key=cv2.contourArea, reverse=True)
177          cv2.drawContours(image, sortedPoly[0], -1, (0, 0, 255), 5)
178          simplified_cnt = sortedPoly[0]
179      if len(simplified_cnt) == 4:
180          try:
181              from skimage.filters import threshold_local
182          except ImportError:
183              LOGS.info(f"Scikit-Image is not Installed.")
184              await xx.edit("`Installing Scikit-Image...\nThis may take some long...`")
185              _, __ = await bash("pip install scikit-image")
186              LOGS.info(_)
187              from skimage.filters import threshold_local
188          cropped_image = four_point_transform(
189              original_image,
190              simplified_cnt.reshape(4, 2) * ratio,
191          )
192          gray_image = cv2.cvtColor(cropped_image, cv2.COLOR_BGR2GRAY)
193          T = threshold_local(gray_image, 11, offset=10, method="gaussian")
194          ok = (gray_image > T).astype("uint8") * 255
195      if len(simplified_cnt) != 4:
196          ok = cv2.detailEnhance(original_image, sigma_s=10, sigma_r=0.15)
197      cv2.imwrite("o.png", ok)
198      image1 = Image.open("o.png")
199      im1 = image1.convert("RGB")
200      scann = f"Scanned {ultt.split('.')[0]}.pdf"
201      im1.save(scann)
202      await event.client.send_file(event.chat_id, scann, reply_to=event.reply_to_msg_id)
203      await xx.delete()
204      os.remove(ultt)
205      os.remove("o.png")
206      os.remove(scann)
207  @ultroid_cmd(
208      pattern="pdsave( (.*)|$)",
209  )
210  async def savepdf(event):
211      ok = await event.get_reply_message()
</span>212      if not (ok and (ok.media)):
213          await eor(
214              event,
215              "`Reply to Images/pdf which u want to merge as a single pdf..`",
216          )
217          return
218      ultt = await ok.download_media()
219      if ultt.endswith(("png", "jpg", "jpeg", "webp")):
220          xx = await event.eor(get_string("com_1"))
221          image = cv2.imread(ultt)
222          original_image = image.copy()
223          ratio = image.shape[0] / 500.0
224          h_, _v = image.shape[:2]
225          m_ = 500 / float(h_)
226          image = cv2.resize(image, (int(_v * m_), 500), interpolation=cv2.INTER_AREA)
227          image_yuv = cv2.cvtColor(image, cv2.COLOR_BGR2YUV)
228          image_y = np.zeros(image_yuv.shape[:2], np.uint8)
229          image_y[:, :] = image_yuv[:, :, 0]
230          image_blurred = cv2.GaussianBlur(image_y, (3, 3), 0)
231          edges = cv2.Canny(image_blurred, 50, 200, apertureSize=3)
232          contours, hierarchy = cv2.findContours(
233              edges,
234              cv2.RETR_EXTERNAL,
235              cv2.CHAIN_APPROX_SIMPLE,
236          )
237          polygons = []
238          for cnt in contours:
239              hull = cv2.convexHull(cnt)
240              polygons.append(
241                  cv2.approxPolyDP(hull, 0.01 * cv2.arcLength(hull, True), False),
242              )
243              sortedPoly = sorted(polygons, key=cv2.contourArea, reverse=True)
244              cv2.drawContours(image, sortedPoly[0], -1, (0, 0, 255), 5)
245              simplified_cnt = sortedPoly[0]
246          if len(simplified_cnt) == 4:
247              try:
248                  from skimage.filters import threshold_local
249              except ImportError:
250                  LOGS.info(f"Scikit-Image is not Installed.")
251                  await xx.edit(
252                      "`Installing Scikit-Image...\nThis may take some long...`"
253                  )
254                  _, __ = await bash("pip install scikit-image")
255                  LOGS.info(_)
256                  from skimage.filters import threshold_local
257              cropped_image = four_point_transform(
258                  original_image,
259                  simplified_cnt.reshape(4, 2) * ratio,
260              )
261              gray_image = cv2.cvtColor(cropped_image, cv2.COLOR_BGR2GRAY)
262              T = threshold_local(gray_image, 11, offset=10, method="gaussian")
263              ok = (gray_image > T).astype("uint8") * 255
264          if len(simplified_cnt) != 4:
265              ok = cv2.detailEnhance(original_image, sigma_s=10, sigma_r=0.15)
266          cv2.imwrite("o.png", ok)
267          image1 = Image.open("o.png")
268          im1 = image1.convert("RGB")
269          a = check_filename("pdf/scan.pdf")
270          im1.save(a)
271          await xx.edit(
272              f"Done, Now Reply Another Image/pdf if completed then use {HNDLR}pdsend to merge nd send all as pdf",
273          )
274          os.remove("o.png")
275      elif ultt.endswith(".pdf"):
276          a = check_filename("pdf/scan.pdf")
277          await event.client.download_media(ok, a)
278          await eor(
279              event,
280              f"Done, Now Reply Another Image/pdf if completed then use {HNDLR}pdsend to merge nd send all as pdf",
281          )
282      else:
283          await event.eor("`Reply to a Image/pdf only...`")
284      os.remove(ultt)
285  @ultroid_cmd(
286      pattern="pdsend( (.*)|$)",
287  )
288  async def sendpdf(event):
289      if not os.path.exists("pdf/scan.pdf"):
290          await eor(
291              event,
292              "first select pages by replying .pdsave of which u want to make multi page pdf file",
293          )
294          return
295      msg = event.pattern_match.group(1).strip()
296      ok = f"{msg}.pdf" if msg else "My PDF File.pdf"
297      merger = PdfFileMerger()
298      ok_ = [*sorted(afl)]
299      for item in ok_:
300          if item.endswith("pdf"):
301              merger.append(item)
302      merger.write(ok)
303      await event.client.send_file(event.chat_id, ok_, reply_to=event.reply_to_msg_id)
304      os.remove(ok_)
305      shutil.rmtree("pdf/")
306      os.makedirs("pdf/")
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-snips.py</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Ultroid-MDEwOlJlcG9zaXRvcnkzNDEwMzg2MDI=-flat-pdftools.py</div>
                <div class="column column_space"><pre><code>9  @ultroid_cmd(pattern="addsnip( (.*)|$)")
10  async def an(e):
11      wrd = (e.pattern_match.group(1).strip()).lower()
12      wt = await e.get_reply_message()
13      if not (wt and wrd):
14          return await e.eor(get_string("snip_1"))
15      if "$" in wrd:
16          wrd = wrd.replace("$", "")
17      btn = format_btn(wt.buttons) if wt.buttons else None
18      if wt and wt.media:
19          wut = mediainfo(wt.media)
20          if wut.startswith(("pic", "gif")):
21              dl = await wt.download_media()
22              variable = uf(dl)
23              os.remove(dl)
24              m = f"https://graph.org{variable[0]}"
25          elif wut == "video":
26              if wt.media.document.size > 8 * 1000 * 1000:
27                  return await e.eor(get_string("com_4"), time=5)
28              dl = await wt.download_media()
29              variable = uf(dl)
30              os.remove(dl)
31              m = f"https://graph.org{variable[0]}"
32          else:
33              m = pack_bot_file_id(wt.media)
34          if wt.text:
35              txt = wt.text
36              if not btn:
37                  txt, btn = get_msg_button(wt.text)
38              add_snip(wrd, txt, m, btn)
39          else:
40              add_snip(wrd, None, m, btn)
41      else:
42          txt = wt.text
43          if not btn:
44              txt, btn = get_msg_button(wt.text)
45          add_snip(wrd, txt, None, btn)
46      await e.eor(f"Done : snip `${wrd}` Saved.")
47      ultroid_bot.add_handler(add_snips, events.NewMessage())
48  @ultroid_cmd(pattern="remsnip( (.*)|$)")
49  async def rs(e):
50      wrd = (e.pattern_match.group(1).strip()).lower()
</pre></code></div>
                <div class="column column_space"><pre><code>139  @ultroid_cmd(
140      pattern="pdscan( (.*)|$)",
141  )
142  async def imgscan(event):
143      ok = await event.get_reply_message()
144      if not (ok and (ok.media)):
145          await event.eor("`Reply The pdf u Want to Download..`")
146          return
147      if not (
148          ok.photo
149          or (ok.file.name and ok.file.name.endswith(("png", "jpg", "jpeg", "webp")))
150      ):
151          await event.eor("`Reply to a Image only...`")
152          return
153      ultt = await ok.download_media()
154      xx = await event.eor(get_string("com_1"))
155      image = cv2.imread(ultt)
156      original_image = image.copy()
157      ratio = image.shape[0] / 500.0
158      hi, wid = image.shape[:2]
159      ra = 500 / float(hi)
160      dmes = (int(wid * ra), 500)
161      image = cv2.resize(image, dmes, interpolation=cv2.INTER_AREA)
162      image_yuv = cv2.cvtColor(image, cv2.COLOR_BGR2YUV)
163      image_y = np.zeros(image_yuv.shape[:2], np.uint8)
164      image_y[:, :] = image_yuv[:, :, 0]
165      image_blurred = cv2.GaussianBlur(image_y, (3, 3), 0)
166      edges = cv2.Canny(image_blurred, 50, 200, apertureSize=3)
167      contours, hierarchy = cv2.findContours(
168          edges,
169          cv2.RETR_EXTERNAL,
170          cv2.CHAIN_APPROX_SIMPLE,
171      )
172      polygons = []
173      for cnt in contours:
174          hull = cv2.convexHull(cnt)
175          polygons.append(cv2.approxPolyDP(hull, 0.01 * cv2.arcLength(hull, True), False))
176          sortedPoly = sorted(polygons, key=cv2.contourArea, reverse=True)
177          cv2.drawContours(image, sortedPoly[0], -1, (0, 0, 255), 5)
178          simplified_cnt = sortedPoly[0]
179      if len(simplified_cnt) == 4:
180          try:
181              from skimage.filters import threshold_local
182          except ImportError:
183              LOGS.info(f"Scikit-Image is not Installed.")
184              await xx.edit("`Installing Scikit-Image...\nThis may take some long...`")
185              _, __ = await bash("pip install scikit-image")
186              LOGS.info(_)
187              from skimage.filters import threshold_local
188          cropped_image = four_point_transform(
189              original_image,
190              simplified_cnt.reshape(4, 2) * ratio,
191          )
192          gray_image = cv2.cvtColor(cropped_image, cv2.COLOR_BGR2GRAY)
193          T = threshold_local(gray_image, 11, offset=10, method="gaussian")
194          ok = (gray_image > T).astype("uint8") * 255
195      if len(simplified_cnt) != 4:
196          ok = cv2.detailEnhance(original_image, sigma_s=10, sigma_r=0.15)
197      cv2.imwrite("o.png", ok)
198      image1 = Image.open("o.png")
199      im1 = image1.convert("RGB")
200      scann = f"Scanned {ultt.split('.')[0]}.pdf"
201      im1.save(scann)
202      await event.client.send_file(event.chat_id, scann, reply_to=event.reply_to_msg_id)
203      await xx.delete()
204      os.remove(ultt)
205      os.remove("o.png")
206      os.remove(scann)
207  @ultroid_cmd(
208      pattern="pdsave( (.*)|$)",
209  )
210  async def savepdf(event):
211      ok = await event.get_reply_message()
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    