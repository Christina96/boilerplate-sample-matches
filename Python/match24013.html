<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for test_win_license_1.py & test_poudriere.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for test_win_license_1.py & test_poudriere.py
      </h3>
      <h1 align="center">
        9.1%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>test_win_license_1.py (21.138212%)<TH>test_poudriere.py (5.8690743%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match24013-0.html#0',2,'match24013-1.html#0',3)" NAME="0">(59-66)<TD><A HREF="javascript:ZweiFrames('match24013-0.html#0',2,'match24013-1.html#0',3)" NAME="0">(76-84)</A><TD ALIGN=center><FONT COLOR="#ff0000">13</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match24013-0.html#1',2,'match24013-1.html#1',3)" NAME="1">(19-26)<TD><A HREF="javascript:ZweiFrames('match24013-0.html#1',2,'match24013-1.html#1',3)" NAME="1">(67-75)</A><TD ALIGN=center><FONT COLOR="#ff0000">13</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_win_license_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
import salt.modules.win_license as win_license
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, patch
from tests.support.unit import TestCase


class LicenseTestCase(TestCase, LoaderModuleMockMixin):
    def setup_loader_modules(self):
        return {win_license: {}}

    def test_installed(self):
        &quot;&quot;&quot;
        Test to see if the given license key is installed
        &quot;&quot;&quot;
        mock = MagicMock(return_value=&quot;Partial Product Key: ABCDE&quot;)
<A NAME="1"></A>        with patch.dict(win_license.__salt__, {&quot;cmd.run&quot;: mock}):
            out = win_license.installed(&quot;AAAAA-AAAAA-AAAAA-AAAA-AAAAA-ABCDE&quot;)
            mock.assert_called_once_with(r&quot;cscript C:\Windows\System32\slmgr.vbs /dli&quot;)
            self<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match24013-1.html#1',3,'match24013-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.assertTrue(out)

    def test_installed_diff(self):
        &quot;&quot;&quot;
        Test to see if the given license key is installed when the key is different
        &quot;&quot;&quot;
        mock = MagicMock(return_value=&quot;Partial Product Key: 12345&quot;)
        with patch.dict(win_license.__salt__, {&quot;cmd.run&quot;</B></FONT>: mock}):
            out = win_license.installed(&quot;AAAAA-AAAAA-AAAAA-AAAA-AAAAA-ABCDE&quot;)
            mock.assert_called_once_with(r&quot;cscript C:\Windows\System32\slmgr.vbs /dli&quot;)
            self.assertFalse(out)

    def test_install(self):
        &quot;&quot;&quot;
        Test installing the given product key
        &quot;&quot;&quot;
        mock = MagicMock()
        with patch.dict(win_license.__salt__, {&quot;cmd.run&quot;: mock}):
            win_license.install(&quot;AAAAA-AAAAA-AAAAA-AAAA-AAAAA-ABCDE&quot;)
            mock.assert_called_once_with(
                r&quot;cscript C:\Windows\System32\slmgr.vbs /ipk &quot;
                &quot;AAAAA-AAAAA-AAAAA-AAAA-AAAAA-ABCDE&quot;
            )

    def test_uninstall(self):
        &quot;&quot;&quot;
        Test uninstalling the given product key
        &quot;&quot;&quot;
        mock = MagicMock()
        with patch.dict(win_license.__salt__, {&quot;cmd.run&quot;: mock}):
            win_license.uninstall()
            mock.assert_called_once_with(r&quot;cscript C:\Windows\System32\slmgr.vbs /upk&quot;)

    def test_activate(self):
        &quot;&quot;&quot;
        Test activating the current product key
        &quot;&quot;&quot;
<A NAME="0"></A>        mock = MagicMock()
        with patch.dict(win_license.__salt__, {&quot;cmd.run&quot;: mock}):
            win_license.activate()
            mock<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match24013-1.html#0',3,'match24013-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>.assert_called_once_with(r&quot;cscript C:\Windows\System32\slmgr.vbs /ato&quot;)

    def test_licensed(self):
        &quot;&quot;&quot;
        Test checking if the minion is licensed
        &quot;&quot;&quot;
        mock = MagicMock(return_value=&quot;License Status: Licensed&quot;)
        with patch.dict(win_license.__salt__, {&quot;cmd.run&quot;</B></FONT>: mock}):
            win_license.licensed()
            mock.assert_called_once_with(r&quot;cscript C:\Windows\System32\slmgr.vbs /dli&quot;)

    def test_info(self):
        &quot;&quot;&quot;
        Test getting the info about the current license key
        &quot;&quot;&quot;
        expected = {
            &quot;description&quot;: &quot;Prof&quot;,
            &quot;licensed&quot;: True,
            &quot;name&quot;: &quot;Win7&quot;,
            &quot;partial_key&quot;: &quot;12345&quot;,
        }

        mock = MagicMock(
            return_value=(
                &quot;Name: Win7\r\nDescription: Prof\r\nPartial Product Key: 12345\r\n&quot;
                &quot;License Status: Licensed&quot;
            )
        )
        with patch.dict(win_license.__salt__, {&quot;cmd.run&quot;: mock}):
            out = win_license.info()
            mock.assert_called_once_with(r&quot;cscript C:\Windows\System32\slmgr.vbs /dli&quot;)
            self.assertEqual(out, expected)
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_poudriere.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
&quot;&quot;&quot;
    :codeauthor: Jayesh Kariya &lt;jayeshk@saltstack.com&gt;
&quot;&quot;&quot;

import os

import pytest
import salt.modules.poudriere as poudriere
from tests.support.mock import MagicMock, mock_open, patch


@pytest.fixture
def configure_loader_modules():
    return {poudriere: {}}


def test_is_jail():
    &quot;&quot;&quot;
    Test if it return True if jail exists False if not.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=&quot;salt stack&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.is_jail(&quot;salt&quot;)

        assert not poudriere.is_jail(&quot;SALT&quot;)


def test_make_pkgng_aware():
    &quot;&quot;&quot;
    Test if it make jail ``jname`` pkgng aware.
    &quot;&quot;&quot;
    temp_dir = os.path.join(&quot;tmp&quot;, &quot;salt&quot;)
    conf_file = os.path.join(&quot;tmp&quot;, &quot;salt&quot;, &quot;salt-make.conf&quot;)
    ret1 = &quot;Could not create or find required directory {}&quot;.format(temp_dir)
    ret2 = &quot;Looks like file {} could not be created&quot;.format(conf_file)
    ret3 = {&quot;changes&quot;: &quot;Created {}&quot;.format(conf_file)}
    mock = MagicMock(return_value=temp_dir)
    mock_true = MagicMock(return_value=True)
    with patch.dict(
        poudriere.__salt__, {&quot;config.option&quot;: mock, &quot;file.write&quot;: mock_true}
    ):
        with patch.object(os.path, &quot;isdir&quot;, MagicMock(return_value=False)):
            with patch.object(os, &quot;makedirs&quot;, mock_true):
                assert poudriere.make_pkgng_aware(&quot;salt&quot;) == ret1

        with patch.object(os.path, &quot;isdir&quot;, mock_true):
            assert poudriere.make_pkgng_aware(&quot;salt&quot;) == ret2

            with patch.object(os.path, &quot;isfile&quot;, mock_true):
                assert poudriere.make_pkgng_aware(&quot;salt&quot;) == ret3


def test_parse_config():
    &quot;&quot;&quot;
    Test if it returns a dict of poudriere main configuration definitions.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=&quot;/tmp/salt&quot;)
    with patch.dict(poudriere.__salt__, {&quot;config.option&quot;: mock}), patch(
        &quot;salt.utils.files.fopen&quot;, mock_open()
    ), patch.object(
        poudriere, &quot;_check_config_exists&quot;, MagicMock(side_effect=[True, False])
<A NAME="1"></A>    ):
        assert poudriere.parse_config() == {}

        assert poudriere<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match24013-0.html#1',2,'match24013-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.parse_config() == &quot;Could not find /tmp/salt on file system&quot;


def test_version():
    &quot;&quot;&quot;
    Test if it return poudriere version.
<A NAME="0"></A>    &quot;&quot;&quot;
    mock = MagicMock(return_value=&quot;9.0-RELEASE&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;</B></FONT>: mock}):
        assert poudriere<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match24013-0.html#0',2,'match24013-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>.version() == &quot;9.0-RELEASE&quot;


def test_list_jails():
    &quot;&quot;&quot;
    Test if it return a list of current jails managed by poudriere.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=&quot;salt stack&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;</B></FONT>: mock}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.list_jails() == [&quot;salt stack&quot;]


def test_list_ports():
    &quot;&quot;&quot;
    Test if it return a list of current port trees managed by poudriere.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=&quot;salt stack&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.list_ports() == [&quot;salt stack&quot;]


def test_create_jail():
    &quot;&quot;&quot;
    Test if it creates a new poudriere jail if one does not exist.
    &quot;&quot;&quot;
    mock_stack = MagicMock(return_value=&quot;90amd64 stack&quot;)
    mock_true = MagicMock(return_value=True)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock_stack}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.create_jail(&quot;90amd64&quot;, &quot;amd64&quot;) == &quot;90amd64 already exists&quot;

        with patch.object(poudriere, &quot;make_pkgng_aware&quot;, mock_true):
            assert (
                poudriere.create_jail(&quot;80amd64&quot;, &quot;amd64&quot;)
                == &quot;Issue creating jail 80amd64&quot;
            )

    with patch.object(poudriere, &quot;make_pkgng_aware&quot;, mock_true), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        with patch.object(poudriere, &quot;is_jail&quot;, MagicMock(side_effect=[False, True])):
            with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock_stack}):
                assert (
                    poudriere.create_jail(&quot;80amd64&quot;, &quot;amd64&quot;) == &quot;Created jail 80amd64&quot;
                )


def test_update_jail():
    &quot;&quot;&quot;
    Test if it run freebsd-update on `name` poudriere jail.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=&quot;90amd64 stack&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.update_jail(&quot;90amd64&quot;) == &quot;90amd64 stack&quot;

        assert poudriere.update_jail(&quot;80amd64&quot;) == &quot;Could not find jail 80amd64&quot;


def test_delete_jail():
    &quot;&quot;&quot;
    Test if it deletes poudriere jail with `name`.
    &quot;&quot;&quot;
    ret = &quot;Looks like there was an issue deleting jail 90amd64&quot;
    mock_stack = MagicMock(return_value=&quot;90amd64 stack&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock_stack}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.delete_jail(&quot;90amd64&quot;) == ret

        assert (
            poudriere.delete_jail(&quot;80amd64&quot;)
            == &quot;Looks like jail 80amd64 has not been created&quot;
        )

    ret1 = 'Deleted jail &quot;80amd64&quot; but was unable to remove jail make file'
    with patch.object(
        poudriere, &quot;is_jail&quot;, MagicMock(side_effect=[True, False, True, False])
    ):
        with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock_stack}):
            with patch.object(
                poudriere, &quot;_config_dir&quot;, MagicMock(return_value=&quot;/tmp/salt&quot;)
            ):
                assert poudriere.delete_jail(&quot;80amd64&quot;) == &quot;Deleted jail 80amd64&quot;

                with patch.object(os.path, &quot;isfile&quot;, MagicMock(return_value=True)):
                    assert poudriere.delete_jail(&quot;80amd64&quot;) == ret1


def test_create_ports_tree():
    &quot;&quot;&quot;
    Test if it not working need to run portfetch non interactive.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=&quot;salt stack&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.create_ports_tree() == &quot;salt stack&quot;


def test_update_ports_tree():
    &quot;&quot;&quot;
    Test if it updates the ports tree, either the default
    or the `ports_tree` specified.
    &quot;&quot;&quot;
    mock = MagicMock(return_value=&quot;salt stack&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.update_ports_tree(&quot;staging&quot;) == &quot;salt stack&quot;


def test_bulk_build():
    &quot;&quot;&quot;
    Test if it run bulk build on poudriere server.
    &quot;&quot;&quot;
    ret = &quot;Could not find file /root/pkg_list on filesystem&quot;
    mock = MagicMock(return_value=&quot;salt stack&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.bulk_build(&quot;90amd64&quot;, &quot;/root/pkg_list&quot;) == ret

        with patch.object(os.path, &quot;isfile&quot;, MagicMock(return_value=True)):
            assert (
                poudriere.bulk_build(&quot;90amd64&quot;, &quot;/root/pkg_list&quot;)
                == &quot;Could not find jail 90amd64&quot;
            )

    ret = &quot;There may have been an issue building packages dumping output: 90amd64 stack&quot;
    with patch.object(os.path, &quot;isfile&quot;, MagicMock(return_value=True)), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        mock = MagicMock(return_value=&quot;90amd64 stack packages built&quot;)
        with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock}):
            assert (
                poudriere.bulk_build(&quot;90amd64&quot;, &quot;/root/pkg_list&quot;)
                == &quot;90amd64 stack packages built&quot;
            )

        mock = MagicMock(return_value=&quot;90amd64 stack&quot;)
        with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock}):
            assert poudriere.bulk_build(&quot;90amd64&quot;, &quot;/root/pkg_list&quot;) == ret


def test_info_jail():
    &quot;&quot;&quot;
    Test to stdout the information poudriere jail with `name`.
    &quot;&quot;&quot;
    ret = [&quot;head-amd64&quot;]
    mock_stack = MagicMock(return_value=&quot;head-amd64&quot;)
    with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock_stack}), patch(
        &quot;salt.modules.poudriere._check_config_exists&quot;, MagicMock(return_value=True)
    ):
        assert poudriere.info_jail(&quot;head-amd64&quot;) == ret

        assert poudriere.info_jail(&quot;12-amd64&quot;) == &quot;Could not find jail 12-amd64&quot;

    ret1 = &quot;Could not find jail 12-amd64&quot;
    with patch.object(
        poudriere, &quot;is_jail&quot;, MagicMock(side_effect=[True, False, True, False])
    ):
        with patch.dict(poudriere.__salt__, {&quot;cmd.run&quot;: mock_stack}):
            with patch.object(
                poudriere, &quot;_config_dir&quot;, MagicMock(return_value=&quot;/tmp/salt&quot;)
            ):
                assert poudriere.info_jail(&quot;12-amd64&quot;) == [&quot;head-amd64&quot;]

                with patch.object(os.path, &quot;isfile&quot;, MagicMock(return_value=True)):
                    assert poudriere.info_jail(&quot;12-amd64&quot;) == ret1
</PRE>
</div>
  </div>
</body>
</html>
