<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for template_test.py &amp; test_mysql.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for template_test.py &amp; test_mysql.py
      </h3>
<h1 align="center">
        4.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>template_test.py (5.144291%)<th>test_mysql.py (4.4372296%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(449-456)<td><a href="#" name="0">(378-391)</a><td align="center"><font color="#ff0000">14</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(444-449)<td><a href="#" name="1">(352-364)</a><td align="center"><font color="#ff0000">14</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(464-466)<td><a href="#" name="2">(409-421)</a><td align="center"><font color="#ec0000">13</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>template_test.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 from __future__ import absolute_import, division, print_function
2 import os
3 import sys
4 import traceback
5 from salt.ext.tornado.escape import utf8, native_str, to_unicode
6 from salt.ext.tornado.template import Template, DictLoader, ParseError, Loader
7 from salt.ext.tornado.test.util import unittest, is_coverage_running
8 from salt.ext.tornado.util import ObjectDict, unicode_type, PY3
9 class TemplateTest(unittest.TestCase):
10     def test_simple(self):
11         template = Template("Hello {{ name }}!")
12         self.assertEqual(template.generate(name="Ben"),
13                          b"Hello Ben!")
14     def test_bytes(self):
15         template = Template("Hello {{ name }}!")
16         self.assertEqual(template.generate(name=utf8("Ben")),
17                          b"Hello Ben!")
18     def test_expressions(self):
19         template = Template("2 + 2 = {{ 2 + 2 }}")
20         self.assertEqual(template.generate(), b"2 + 2 = 4")
21     def test_comment(self):
22         template = Template("Hello{# TODO i18n #} {{ name }}!")
23         self.assertEqual(template.generate(name=utf8("Ben")),
24                          b"Hello Ben!")
25     def test_include(self):
26         loader = DictLoader({
27             "index.html": '{% include "header.html" %}\nbody text',
28             "header.html": "header text",
29         })
30         self.assertEqual(loader.load("index.html").generate(),
31                          b"header text\nbody text")
32     def test_extends(self):
33         loader = DictLoader({
34             "base.html": """\
35 &lt;title&gt;{% block title %}default title{% end %}&lt;/title&gt;
36 &lt;body&gt;{% block body %}default body{% end %}&lt;/body&gt;
37 """,
38             "page.html": """\
39 {% extends "base.html" %}
40 {% block title %}page title{% end %}
41 {% block body %}page body{% end %}
42         try:
43             loader.load("test.html").generate()
44             self.fail("did not get expected exception")
45         except ZeroDivisionError:
46             self.assertTrue("# test.html:2" in traceback.format_exc())
47     def test_error_line_number_directive(self):
48         loader = DictLoader({"test.html": """one
49 two{%if 1/0%}
50 three{%end%}
51         try:
52             loader.load("sub.html").generate()
53             self.fail("did not get expected exception")
54         except ZeroDivisionError:
55             self.assertTrue("# sub.html:4 (via base.html:1)" in
56                             traceback.format_exc())
57     def test_multi_includes(self):
58         loader = DictLoader({
59             "a.html": "{% include 'b.html' %}",
60             "b.html": "{% include 'c.html' %}",
61             "c.html": "{{1/0}}",
62         })
63         try:
64             loader.load("a.html").generate()
65             self.fail("did not get expected exception")
66         except ZeroDivisionError:
67             self.assertTrue("# c.html:1 (via b.html:1, a.html:1)" in
68                             traceback.format_exc())
69 class ParseErrorDetailTest(unittest.TestCase):
70     def test_details(self):
71         loader = DictLoader({
72             "foo.html": "\n\n{{",
73         })
74         with self.assertRaises(ParseError) as cm:
75             loader.load("foo.html")
76         self.assertEqual("Missing end expression }} at foo.html:3",
77                          str(cm.exception))
78         self.assertEqual("foo.html", cm.exception.filename)
79         self.assertEqual(3, cm.exception.lineno)
80     def test_custom_parse_error(self):
81         self.assertEqual("asdf at None:0", str(ParseError("asdf")))
82 class AutoEscapeTest(unittest.TestCase):
83     def setUp(self):
84         self.templates = {
85             "escaped.html": "{% autoescape xhtml_escape %}{{ name }}",
86             "unescaped.html": "{% autoescape None %}{{ name }}",
87             "default.html": "{{ name }}",
88             "include.html": """\
89 escaped: {% include 'escaped.html' %}
90 unescaped: {% include 'unescaped.html' %}
91 default: {% include 'default.html' %}
92         self<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertEqual(loader.load("foo.html").generate(),
93                          b"\nasdf ")
94 <a name="0"></a>        self.assertEqual(loader.load("bar.js").generate(),
95                          b"\nqwer ")
96         self.assertEqual(</b></font>loader<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.load("baz.txt").generate(),
97                          b"\t    zxcv\n\n")
98         self.assertEqual(loader.load("include.html").generate(),
99                          b" \t    zxcv\n\n\n")
100         self.assertEqual(loader.load(</b></font>"include.txt").generate(),
101                          b"\t\t\nasdf     ")
102     def test_whitespace_by_loader(self):
103         templates = {
104 <a name="2"></a>            "foo.html": "\t\tfoo\n\n",
105             "bar.txt": "\t\tbar\n\n",
106         }
107         loader = DictLoader(templates, whitespace<font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>='all')
108         self.assertEqual(loader.load("foo.html").generate(), b"\t\tfoo\n\n")
109         self.assertEqual(loader.load("bar.txt").generate(</b></font>), b"\t\tbar\n\n")
110         loader = DictLoader(templates, whitespace='single')
111         self.assertEqual(loader.load("foo.html").generate(), b" foo\n")
112         self.assertEqual(loader.load("bar.txt").generate(), b" bar\n")
113         loader = DictLoader(templates, whitespace='oneline')
114         self.assertEqual(loader.load("foo.html").generate(), b" foo ")
115         self.assertEqual(loader.load("bar.txt").generate(), b" bar ")
116     def test_whitespace_directive(self):
117         loader = DictLoader({
118             "foo.html": """\
119 {% whitespace oneline %}
120     {% for i in range(3) %}
121         {{ i }}
122     {% end %}
123 {% whitespace all %}
124     pre\tformatted
125     :codeauthor: Mike Place (mp@saltstack.com)
126     tests.unit.modules.mysql
127     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
128     Test to see if mysql module properly forms the MySQL query to see if a user exists
129     Do it before test_user_create_when_user_exists mocks the user_exists call
130     Test the creation of a MySQL user in mysql exec module
131     Test changing a MySQL user password in mysql exec module
132                         <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>call()
133                         .cursor()
134                         .execute(
135                             "UPDATE mysql.user SET Password=PASSWORD(%(password)s) WHERE User=%(user)s AND Host = %(host)s;",
136                             {
137                                 "password": "BLUECOW",
138                                 "user": "testuser",
139                                 "host": "localhost",
140                             },
141                         ),
142                         call().cursor().execute("FLUSH PRIVILEGES;"),
143                     )
144                     connect_mock.assert_has_calls(</b></font>calls, any_order=True)
145     connect_mock = MagicMock()
146     with patch.object(mysql, "_connect", connect_mock):
147         with patch.object(mysql, "version", return_value="8.0.11"):
148             with patch.object(mysql, "user_exists", MagicMock(return_value=True)):
149                 with patch.object(
150                     mysql,
151                     "__get_auth_plugin",
152                     MagicMock(return_value="mysql_native_password"),
153                 ):
154 <a name="0"></a>                    with patch.dict(mysql.__salt__, {"config.option": MagicMock()}):
155                         mysql.user_chpass("testuser", password="BLUECOW")
156                         calls = (
157                             <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>call()
158                             .cursor()
159                             .execute(
160                                 "ALTER USER %(user)s@%(host)s IDENTIFIED WITH %(auth_plugin)s BY %(password)s;",
161                                 {
162                                     "password": "BLUECOW",
163                                     "user": "testuser",
164                                     "host": "localhost",
165                                     "auth_plugin": "mysql_native_password",
166                                 },
167                             ),
168                             call().cursor().execute("FLUSH PRIVILEGES;"),
169                         )
170                         connect_mock.assert_has_calls(</b></font>calls, any_order=True)
171     connect_mock = MagicMock()
172     with patch.object(mysql, "_connect", connect_mock):
173         with patch.object(mysql, "version", side_effect=["", "8.0.11", "8.0.11"]):
174             with patch.object(mysql, "user_exists", MagicMock(return_value=True)):
175                 with patch.object(
176                     mysql,
177                     "__get_auth_plugin",
178                     MagicMock(return_value="mysql_native_password"),
179                 ):
180                     with patch.dict(mysql.__salt__, {"config.option": MagicMock()}):
181                         mysql.user_chpass(
182                             "root",
183                             password="new_pass",
184 <a name="2"></a>                            connection_user="root",
185                             connection_pass="old_pass",
186                         )
187                         calls <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>= (
188                             call()
189                             .cursor()
190                             .execute(
191                                 "ALTER USER %(user)s@%(host)s IDENTIFIED WITH %(auth_plugin)s BY %(password)s;",
192                                 {
193                                     "password": "new_pass",
194                                     "user": "root",
195                                     "host": "localhost",
196                                     "auth_plugin": "mysql_native_password",
197                                 },
198                             ),
199                             call().cursor().execute(</b></font>"FLUSH PRIVILEGES;"),
200                         )
201                         connect_mock.assert_has_calls(calls, any_order=True)
202 def test_user_remove():
203     with patch.object(mysql, "user_exists", MagicMock(return_value=True)):
204         _test_call(
205             mysql.user_remove,
206             {
207                 "sql": "DROP USER %(user)s@%(host)s",
208                 "sql_args": {"user": "testuser", "host": "localhost"},
209             },
210             "testuser",
211         )
212 def test_db_check():
213     _test_call(
214         mysql.db_check,
215         "CHECK TABLE `test``'\" db`.`my``'\" table`",
216         "test`'\" db",
217         "my`'\" table",
218     )
219 def test_db_repair():
220     _test_call(
221         mysql.db_repair,
222         "REPAIR TABLE `test``'\" db`.`my``'\" table`",
223         "test`'\" db",
224         "my`'\" table",
225     )
226 def test_db_optimize():
227     _test_call(
228         mysql.db_optimize,
229         "OPTIMIZE TABLE `test``'\" db`.`my``'\" table`",
230         "test`'\" db",
231         "my`'\" table",
232     )
233 def test_db_remove():
234     with patch.object(mysql, "db_exists", MagicMock(return_value=True)):
235         _test_call(mysql.db_remove, "DROP DATABASE `test``'\" db`;", "test`'\" db")
236 def test_db_tables():
237     with patch.object(mysql, "db_exists", MagicMock(return_value=True)):
238         _test_call(mysql.db_tables, "SHOW TABLES IN `test``'\" db`", "test`'\" db")
239 def test_db_exists():
240     _test_call(
241         mysql.db_exists,
242         {
243             "sql": "SHOW DATABASES LIKE %(dbname)s;",
244             "sql_args": {"dbname": r"""test%_`" db"""},
245         },
246         'test%_`" db',
247     )
248 def test_db_create():
249     _test_call(
250         mysql.db_create,
251         "CREATE DATABASE IF NOT EXISTS `test``'\" db`;",
252         "test`'\" db",
253     )
254 def test_alter_db():
255     mock_get_db = {
256         "character_set": "utf8",
257         "collate": "utf8_unicode_ci",
258         "name": "my_test",
259     }
260     mock = MagicMock(return_value=mock_get_db)
261     with patch.object(mysql, "db_get", return_value=mock) as mock_db_get:
262         _test_call(
263             mysql.alter_db,
264             "ALTER DATABASE `my_test` CHARACTER SET utf8 COLLATE utf8_unicode_ci;",
265             "my_test",
266             "utf8",
267             "utf8_unicode_ci",
268         )
269 def test_user_list():
270     _test_call(mysql.user_list, "SELECT User,Host FROM mysql.user")
271 def test_user_info():
272     _test_call(
273         mysql.user_info,
274         {
275             "sql": "SELECT * FROM mysql.user WHERE User = %(user)s AND Host = %(host)s",
276             "sql_args": {"host": "localhost", "user": "mytestuser"},
277         },
278         "mytestuser",
279     )
280 def test_user_grants():
281     with patch.object(mysql, "user_exists", MagicMock(return_value=True)):
282         _test_call(
283             mysql.user_grants,
284             {
285                 "sql": "SHOW GRANTS FOR %(user)s@%(host)s",
286                 "sql_args": {"host": "localhost", "user": "testuser"},
287             },
288             "testuser",
289         )
290 def test_grant_exists_true():
291     mock_grants = [
292         "GRANT USAGE ON *.* TO 'testuser'@'%'",
293         "GRANT SELECT, INSERT, UPDATE ON `testdb`.`testtableone` TO 'testuser'@'%'",
294         "GRANT SELECT(column1,column2) ON `testdb`.`testtableone` TO 'testuser'@'%'",
295         "GRANT SELECT(column1,column2), INSERT(column1,column2) ON `testdb`.`testtableone` TO 'testuser'@'%'",
296         "GRANT SELECT(column1,column2), UPDATE ON `testdb`.`testtableone` TO 'testuser'@'%'",
297         "GRANT SELECT ON `testdb`.`testtabletwo` TO 'testuser'@'%'",
298         "GRANT SELECT ON `testdb`.`testtablethree` TO 'testuser'@'%'",
299     ]
300     with patch.object(mysql, "version", return_value="5.6.41"):
301         mock = MagicMock(return_value=mock_grants)
302         with patch.object(
303             mysql, "user_grants", return_value=mock_grants
304         ) as mock_user_grants:
305             ret = mysql.grant_exists(
306                 "SELECT, INSERT, UPDATE", "testdb.testtableone", "testuser", "%"
307             )
308             assert ret
309 def test_grant_exists_false():
310     mock_grants = [
311         "GRANT USAGE ON *.* TO 'testuser'@'%'",
312         "GRANT SELECT, INSERT, UPDATE ON `testdb`.`testtableone` TO 'testuser'@'%'",
313         "GRANT SELECT(column1,column2) ON `testdb`.`testtableone` TO 'testuser'@'%'",
314         "GRANT SELECT(column1,column2), UPDATE ON `testdb`.`testtableone` TO 'testuser'@'%'",
315         "GRANT SELECT ON `testdb`.`testtablethree` TO 'testuser'@'%'",
316     ]
317     with patch.object(mysql, "version", return_value="5.6.41"):
318         mock = MagicMock(return_value=mock_grants)
319         with patch.object(
320             mysql, "user_grants", return_value=mock_grants
321         ) as mock_user_grants:
322             ret = mysql.grant_exists("SELECT", "testdb.testtabletwo", "testuser", "%")
323             assert not ret
324 def test_grant_exists_all():
325     mock_grants = ["GRANT ALL PRIVILEGES ON testdb.testtableone TO `testuser`@`%`"]
326     with patch.object(mysql, "version", return_value="8.0.10"):
327         mock = MagicMock(return_value=mock_grants)
328         with patch.object(
329             mysql, "user_grants", return_value=mock_grants
330         ) as mock_user_grants:
331             ret = mysql.grant_exists("ALL", "testdb.testtableone", "testuser", "%")
332             assert ret
333     with patch.object(mysql, "version", return_value="8.0.10"):
334         mock = MagicMock(return_value=mock_grants)
335         with patch.object(
336             mysql, "user_grants", return_value=mock_grants
337         ) as mock_user_grants:
338             ret = mysql.grant_exists(
339                 "all privileges", "testdb.testtableone", "testuser", "%"
340             )
341             assert ret
342     mock_grants = ["GRANT ALL PRIVILEGES ON testdb.testtableone TO `testuser`@`%`"]
343     with patch.object(mysql, "version", return_value="5.6.41"):
344         mock = MagicMock(return_value=mock_grants)
345         with patch.object(
346             mysql, "user_grants", return_value=mock_grants
347         ) as mock_user_grants:
348             ret = mysql.grant_exists(
349                 "ALL PRIVILEGES", "testdb.testtableone", "testuser", "%"
350             )
351             assert ret
352     mock_grants = [
353         "GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE, CREATE ROLE, DROP ROLE ON *.* TO `testuser`@`%`",
354         "GRANT BACKUP_ADMIN,BINLOG_ADMIN,CONNECTION_ADMIN,ENCRYPTION_KEY_ADMIN,GROUP_REPLICATION_ADMIN,PERSIST_RO_VARIABLES_ADMIN,REPLICATION_SLAVE_ADMIN,RESOURCE_GROUP_ADMIN,RESOURCE_GROUP_USER,ROLE_ADMIN,SET_USER_ID,SYSTEM_VARIABLES_ADMIN,XA_RECOVER_ADMIN ON *.* TO `testuser`@`%`",
355     ]
356     with patch.object(mysql, "version", return_value="8.0.10"):
357         mock = MagicMock(return_value=mock_grants)
358         with patch.object(
359             mysql, "user_grants", return_value=mock_grants
360         ) as mock_user_grants:
361             ret = mysql.grant_exists("ALL", "*.*", "testuser", "%")
362             assert ret
363     with patch.object(mysql, "version", return_value="8.0.10"):
364         mock = MagicMock(return_value=mock_grants)
365         with patch.object(
366             mysql, "user_grants", return_value=mock_grants
367         ) as mock_user_grants:
368             ret = mysql.grant_exists("all privileges", "*.*", "testuser", "%")
369             assert ret
370 @pytest.mark.skipif(True, reason="TODO: Mock up user_grants()")
371 def test_grant_add():
372     _test_call(
373         mysql.grant_add,
374         "",
375         "SELECT,INSERT,UPDATE",
376         "database.*",
377         "frank",
378         "localhost",
379     )
380 @pytest.mark.skipif(True, reason="TODO: Mock up user_grants()")
381 def test_grant_revoke():
382     _test_call(
383         mysql.grant_revoke,
384         "",
385         "SELECT,INSERT,UPDATE",
386         "database.*",
387         "frank",
388         "localhost",
389     )
390 def test_processlist():
391     _test_call(mysql.processlist, "SHOW FULL PROCESSLIST")
392 def test_get_master_status():
393     _test_call(mysql.get_master_status, "SHOW MASTER STATUS")
394 def test_get_slave_status():
395     _test_call(mysql.get_slave_status, "SHOW SLAVE STATUS")
396 def test_get_slave_status_bad_server():
397     connect_mock = MagicMock(return_value=None)
398     with patch.object(mysql, "_connect", connect_mock):
399         with patch.dict(mysql.__salt__, {"config.option": MagicMock()}):
400             rslt = mysql.get_slave_status()
401             connect_mock.assert_has_calls([call()])
402             assert rslt == []
403 @pytest.mark.skipif(
404     True, reason="MySQL module claims this function is not ready for production"
405 )
406 def test_free_slave():
407     pass
408 def test_query():
409     _test_call(mysql.query, "SELECT * FROM testdb", "testdb", "SELECT * FROM testdb")
410 @pytest.mark.skipif(not HAS_PYMYSQL, reason="Could not import pymysql")
411 def test_query_error():
412     connect_mock = MagicMock()
413     with patch.object(mysql, "_connect", connect_mock):
414         with patch.dict(mysql.__salt__, {"config.option": MagicMock()}):
415             side_effect = mysql.OperationalError(9999, "Something Went Wrong")
416             with patch.object(mysql, "_execute", MagicMock(side_effect=side_effect)):
417                 mysql.query("testdb", "SELECT * FROM testdb")
418         assert "mysql.error" in mysql.__context__
419         expected = "MySQL Error 9999: Something Went Wrong"
420         assert mysql.__context__["mysql.error"] == expected
421 def test_plugin_add():
422     with patch.object(mysql, "plugin_status", MagicMock(return_value="")):
423         _test_call(
424             mysql.plugin_add,
425             'INSTALL PLUGIN auth_socket SONAME "auth_socket.so"',
426             "auth_socket",
427         )
428 def test_plugin_remove():
429     with patch.object(mysql, "plugin_status", MagicMock(return_value="ACTIVE")):
430         _test_call(
431             mysql.plugin_remove,
432             "UNINSTALL PLUGIN auth_socket",
433             "auth_socket",
434         )
435 def test_plugin_status():
436     _test_call(
437         mysql.plugin_status,
438         {
439             "sql": "SELECT PLUGIN_STATUS FROM INFORMATION_SCHEMA.PLUGINS WHERE PLUGIN_NAME = %(name)s",
440             "sql_args": {"name": "auth_socket"},
441         },
442         "auth_socket",
443     )
444 def test_sanitize_comment():
445     input_data = """/*
446     multiline
447     comment
448     */
449     CREATE TABLE test_update (a VARCHAR(25)); # end of line comment
450     insert into test_update values ("some #hash value");            -- ending comment
451     insert into test_update values ("crazy -- not comment"); -- another ending comment
452     -- another comment type
453     output = mysql._sanitize_comments(input_data)
454     assert output == expected_response
455     input_data = """-- --------------------------------------------------------
456                     -- SQL Commands to set up the pmadb as described in the documentation.
457                     --
458                     -- This file is meant for use with MySQL 5 and above!
459                     --
460                     -- This script expects the user pma to already be existing. If we would put a
461                     -- line here to create them too many users might just use this script and end
462                     -- up with having the same password for the controluser.
463                     --
464                     -- This user "pma" must be defined in config.inc.php (controluser/controlpass)
465                     --
466                     -- Please don't forget to set up the tablenames in config.inc.php
467                     --
468                     -- --------------------------------------------------------
469                     --
470                     CREATE DATABASE IF NOT EXISTS `phpmyadmin`
471                       DEFAULT CHARACTER SET utf8 COLLATE utf8_bin;
472                     USE phpmyadmin;
473     Test file_query
474     side_effect = [
475         {"query time": {"human": "0.4ms", "raw": "0.00038"}, "rows affected": 0},
476         {"query time": {"human": "8.9ms", "raw": "0.00893"}, "rows affected": 0},
477     ]
478     expected = {
479         "query time": {"human": "8.9ms", "raw": "0.00893"},
480         "rows affected": 0,
481     }
482     with patch("os.path.exists", MagicMock(return_value=True)):
483         with patch("salt.utils.files.fopen", mock_open(read_data=file_data)):
484             with patch.object(mysql, "query", side_effect=side_effect):
485                 ret = mysql.file_query("database", "filename")
486                 assert ret, expected
487 @pytest.mark.skipif(not HAS_PYMYSQL, reason="Could not import pymysql")
488 def test__connect_pymysql_exception():
489     with patch.dict(mysql.__salt__, {"config.option": MagicMock()}):
490         with patch(
491             "MySQLdb.connect",
492             side_effect=pymysql.err.InternalError(
493                 1698, "Access denied for user 'root'@'localhost'"
494             ),
495         ):
496             ret = mysql._connect()
497             assert "mysql.error" in mysql.__context__
498             assert (
499                 mysql.__context__["mysql.error"]
500                 == "MySQL Error 1698: Access denied for user 'root'@'localhost'"
501             )
502 def test__connect_mysqldb_exception():
503     with patch.dict(mysql.__salt__, {"config.option": MagicMock()}):
504         with patch(
505             "MySQLdb.connect",
506             side_effect=mysql.OperationalError(
507                 1698, "Access denied for user 'root'@'localhost'"
508             ),
509         ):
510             ret = mysql._connect()
511             assert "mysql.error" in mysql.__context__
512             assert (
513                 mysql.__context__["mysql.error"]
514                 == "MySQL Error 1698: Access denied for user 'root'@'localhost'"
515             )
516 def test__connect_mysqldb():
517     mysqldb_connect_mock = MagicMock(autospec=True, return_value=MockMySQLConnect())
518     with patch.dict(mysql.__salt__, {"config.option": MagicMock()}):
519         with patch("MySQLdb.connect", mysqldb_connect_mock):
520             mysql._connect()
521             assert "mysql.error" not in mysql.__context__
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
