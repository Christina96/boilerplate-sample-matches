<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_status_2.py &amp; test_nxos_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_status_2.py &amp; test_nxos_1.py
      </h3>
<h1 align="center">
        7.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_status_2.py (12.914485%)<th>test_nxos_1.py (5.5472264%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(247-253)<td><a href="#" name="0">(1050-1059)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(154-162)<td><a href="#" name="1">(988-996)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(366-370)<td><a href="#" name="2">(1027-1032)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(354-358)<td><a href="#" name="3">(415-420)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(294-298)<td><a href="#" name="4">(80-84)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(258-262)<td><a href="#" name="5">(69-73)</a><td align="center"><font color="#eb0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_status_2.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import os
2 import salt.modules.status as status
3 import salt.utils.platform
4 from salt.exceptions import CommandExecutionError
5 from tests.support.mixins import LoaderModuleMockMixin
6 from tests.support.mock import MagicMock, mock_open, patch
7 from tests.support.unit import TestCase
8 class StatusTestCase(TestCase, LoaderModuleMockMixin):
9     def setup_loader_modules(self):
10         return {status: {}}
11     def _set_up_test_uptime(self):
12         class MockData:
13         m = MockData()
14         m.now = 1477004312
15         m.ut = 1540154.00
16         m.idle = 3047777.32
17         m.ret = {
18             "users": 3,
19             "seconds": 1540154,
20             "since_t": 1475464158,
21             "days": 17,
22             "since_iso": "2016-10-03T03:09:18",
23             "time": "19:49",
24         }
25         return m
26     def _set_up_test_uptime_sunos(self):
27         class MockData:
28         m = MockData()
29         m.ret = {
30             "retcode": 0,
31             "stdout": "unix:0:system_misc:boot_time    1475464158",
32         }
33         return m
34     def test_uptime_linux(self):
35         m = self._set_up_test_uptime()
36         with patch.multiple(
37             salt.utils.platform,
38             is_linux=MagicMock(return_value=True),
39             is_sunos=MagicMock(return_value=False),
40             is_darwin=MagicMock(return_value=False),
41             is_freebsd=MagicMock(return_value=False),
42             is_openbsd=MagicMock(return_value=False),
43             is_netbsd=MagicMock(return_value=False),
44         ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
45             status.__salt__,
46             {"cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"]))},
47         ), patch(
48             "time.time", MagicMock(return_value=m.now)
49         ), patch(
50             "os.path.exists", MagicMock(return_value=True)
51         ):
52             proc_uptime = salt.utils.stringutils.to_str("{} {}".format(m.ut, m.idle))
53             with patch("salt.utils.files.fopen", mock_open(read_data=proc_uptime)):
54                 ret = status.uptime()
55                 self.assertDictEqual(ret, m.ret)
56             with patch("os.path.exists", MagicMock(return_value=False)):
57                 with self.assertRaises(CommandExecutionError):
58                     status.uptime()
59     def test_uptime_sunos(self):
60         m = self._set_up_test_uptime()
61         m2 = self._set_up_test_uptime_sunos()
62         with patch.multiple(
63             salt.utils.platform,
64             is_linux=MagicMock(return_value=False),
65             is_sunos=MagicMock(return_value=True),
66             is_darwin=MagicMock(return_value=False),
67             is_freebsd=MagicMock(return_value=False),
68             is_openbsd=MagicMock(return_value=False),
69             is_netbsd=MagicMock(return_value=False),
70         ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
71             status.__salt__,
72             {
73                 "cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"])),
74                 "cmd.run_all": MagicMock(return_value=m2.ret),
75             },
76         ), patch(
77             "time.time", MagicMock(return_value=m.now)
78         ):
79             ret = status.uptime()
80             self.assertDictEqual(ret, m.ret)
81     def test_uptime_macos(self):
82         m = self._set_up_test_uptime()
83         kern_boottime = (
84             "{{ sec = {0}, usec = {1:0&lt;6} }} Mon Oct 03 03:09:18.23 2016".format(
85                 *str(m.now - m.ut).split(".")
86             )
87         )
88         with patch.multiple(
89             salt.utils.platform,
90             is_linux=MagicMock(return_value=False),
91             is_sunos=MagicMock(return_value=False),
92             is_darwin=MagicMock(return_value=True),
93             is_freebsd=MagicMock(return_value=False),
94             is_openbsd=MagicMock(return_value=False),
95             is_netbsd=MagicMock(return_value=False),
96         ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
97             status.__salt__,
98             {
99                 "cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"])),
100                 "sysctl.get": MagicMock(return_value=kern_boottime),
101             },
102         ), patch(
103             "time.time", MagicMock(return_value=m.now)
104         ):
105             ret = status.uptime()
106             self.assertDictEqual(ret, m.ret)
107 <a name="1"></a>            with patch.dict(
108                 status.__salt__, {"sysctl.get": MagicMock(return_value="")}
109             ):
110                 with self<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertRaises(CommandExecutionError):
111                     status.uptime()
112     def test_uptime_return_success_not_supported(self):
113         with patch.multiple(
114             salt.</b></font>utils.platform,
115             is_linux=MagicMock(return_value=False),
116             is_sunos=MagicMock(return_value=False),
117             is_darwin=MagicMock(return_value=False),
118             is_freebsd=MagicMock(return_value=False),
119             is_openbsd=MagicMock(return_value=False),
120             is_netbsd=MagicMock(return_value=False),
121         ):
122             exc_mock = MagicMock(side_effect=CommandExecutionError)
123             with self.assertRaises(CommandExecutionError):
124                 with patch.dict(status.__salt__, {"cmd.run": exc_mock}):
125                     status.uptime()
126     def _set_up_test_cpustats_openbsd(self):
127         class MockData:
128         m = MockData()
129         m.ret = {
130             "0": {
131                 "User": "0.0%",
132                 "Nice": "0.0%",
133                 "System": "4.5%",
134                 "Interrupt": "0.5%",
135                 "Idle": "95.0%",
136             }
137         }
138         return m
139     def test_cpustats_openbsd(self):
140         m = self._set_up_test_cpustats_openbsd()
141         systat = (
142             "\n\n   1 users Load 0.20 0.07 0.05                        salt.localdomain"
143             " 09:42:42\nCPU                User           Nice        System    "
144             " Interrupt          Idle\n0                  0.0%           0.0%         "
145             " 4.5%          0.5%         95.0%\n"
146         )
147         with patch.multiple(
148             salt.utils.platform,
149             is_linux=MagicMock(return_value=False),
150             is_sunos=MagicMock(return_value=False),
151             is_darwin=MagicMock(return_value=False),
152             is_freebsd=MagicMock(return_value=False),
153             is_openbsd=MagicMock(return_value=True),
154             is_netbsd=MagicMock(return_value=False),
155         ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
156             status.__grains__, {"kernel": "OpenBSD"}
157         ), patch.dict(
158             status.__salt__, {"cmd.run": MagicMock(return_value=systat)}
159         ):
160             ret = status.cpustats()
161             self.assertDictEqual(ret, m.ret)
162     def _set_up_test_cpuinfo_bsd(self):
163         class MockData:
164         m = MockData()
165         m.ret = {
166             "hw.model": "Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz",
167             "hw.ncpu": "4",
168         }
169         return m
170     def test_cpuinfo_freebsd(self):
171         m = self._set_up_test_cpuinfo_bsd()
172         sysctl = "hw.model:Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz\nhw.ncpu:4"
173 <a name="0"></a>
174         with patch.dict(status.__grains__, {"kernel": "FreeBSD"}):
175             with patch.dict(
176                 status.__salt__, {"cmd.run": MagicMock(return_value<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=sysctl)}
177             ):
178                 ret = status.cpuinfo()
179                 self.assertDictEqual(ret, m.ret)
180     def test_cpuinfo_openbsd(self):
181         m = self.</b></font>_set_up_test_cpuinfo_bsd()
182         sysctl = "hw.model=Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz\nhw.ncpu=4"
183 <a name="5"></a>
184         for bsd in ["NetBSD", "OpenBSD"]:
185             with patch.dict(status.__grains__, {"kernel": bsd}):
186                 <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
187                     status.__salt__, {"cmd.run": MagicMock(return_value=sysctl)}
188                 ):
189                     ret = status.cpuinfo()
190                     self.assertDictEqual(</b></font>ret, m.ret)
191     def _set_up_test_meminfo_openbsd(self):
192         class MockData:
193         m = MockData()
194         m.ret = {
195             "active virtual pages": "355M",
196             "free list size": "305M",
197             "page faults": "845",
198             "pages reclaimed": "1",
199             "pages paged in": "2",
200             "pages paged out": "3",
201             "pages freed": "4",
202             "pages scanned": "5",
203         }
204         return m
205     def test_meminfo_openbsd(self):
206         m = self._set_up_test_meminfo_openbsd()
207         vmstat = (
208             " procs    memory       page                    disks    traps         "
209             " cpu\n r   s   avm     fre  flt  re  pi  po  fr  sr cd0 sd0  int   sys  "
210             " cs us sy id\n 2 103  355M    305M  845   1   2   3   4   5   0   1   21  "
211             " 682   86  1  1 98"
212 <a name="4"></a>        )
213         with patch.dict(status.__grains__, {"kernel": "OpenBSD"}):
214             <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
215                 status.__salt__, {"cmd.run": MagicMock(return_value=vmstat)}
216             ):
217                 ret = status.meminfo()
218                 self.assertDictEqual(</b></font>ret, m.ret)
219     def _set_up_test_w_linux(self):
220         class MockData:
221         m = MockData()
222         m.ret = [
223             {
224                 "idle": "0s",
225                 "jcpu": "0.24s",
226                 "login": "13:42",
227                 "pcpu": "0.16s",
228                 "tty": "pts/1",
229                 "user": "root",
230                 "what": "nmap -sV 10.2.2.2",
231             }
232         ]
233         return m
234     def _set_up_test_w_bsd(self):
235         class MockData:
236         m = MockData()
237         m.ret = [
238             {
239                 "idle": "0",
240                 "from": "10.2.2.1",
241                 "login": "1:42PM",
242                 "tty": "p1",
243                 "user": "root",
244                 "what": "nmap -sV 10.2.2.2",
245             }
246         ]
247         return m
248     def test_w_linux(self):
249         m = self._set_up_test_w_linux()
250 <a name="3"></a>        w_output = "root   pts/1  13:42    0s  0.24s  0.16s nmap -sV 10.2.2.2"
251         with patch.dict(status.__grains__, {"kernel": "Linux"}):
252             <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
253                 status.__salt__, {"cmd.run": MagicMock(return_value=w_output)}
254             ):
255                 ret = status.w()
256                 self.assertListEqual(</b></font>ret, m.ret)
257     def test_w_bsd(self):
258         m = self._set_up_test_w_bsd()
259         w_output = "root   p1 10.2.2.1    1:42PM  0 nmap -sV 10.2.2.2"
260 <a name="2"></a>
261         for bsd in ["Darwin", "FreeBSD", "OpenBSD"]:
262             with patch.dict(status.__grains__, {"kernel": bsd}):
263                 <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
264                     status.__salt__, {"cmd.run": MagicMock(return_value=w_output)}
265                 ):
266                     ret = status.w()
267                     self.assertListEqual(</b></font>ret, m.ret)
268     def _set_up_test_status_pid_linux(self):
269         class MockData:
270         m = MockData()
271         m.ret = "2701\n7539\n7540\n7542\n7623"
272         return m
273     def test_status_pid_linux(self):
274         m = self._set_up_test_status_pid_linux()
275         ps = (
276             "UID      PID PPID  C STIME TTY      TIME CMD\nroot     360    2  0 Jun08 ?"
277             "    00:00:00   [jbd2/dm-0-8]\nroot     947    2  0 Jun08 ?    00:00:00  "
278             " [jbd2/dm-1-8]\nroot     949    2  0 Jun08 ?    00:00:09  "
279             " [jbd2/dm-3-8]\nroot     951    2  0 Jun08 ?    00:00:00  "
280             " [jbd2/dm-4-8]\nroot    2701    1  0 Jun08 ?    00:00:28   /usr/sbin/httpd"
281             " -k start\napache  7539 2701  0 04:40 ?    00:00:04     /usr/sbin/httpd -k"
282             " start\napache  7540 2701  0 04:40 ?    00:00:02     /usr/sbin/httpd -k"
283             " start\napache  7542 2701  0 04:40 ?    00:01:46     /usr/sbin/httpd -k"
284             " start\napache  7623 2701  0 04:40 ?    00:02:41     /usr/sbin/httpd -k"
285             " start\nroot    1564    1  0 Jun11 ?    00:07:19   /usr/bin/python3"
286             " /usr/bin/salt-minion -d\nroot    6674 1564  0 19:53 ?    00:00:00    "
287             " /usr/bin/python3 /usr/bin/salt-call status.pid httpd -l debug"
288         )
289         with patch.dict(status.__grains__, {"ps": "ps -efHww"}):
290             with patch.dict(
291                 status.__salt__, {"cmd.run_stdout": MagicMock(return_value=ps)}
292             ):
293                 with patch.object(os, "getpid", return_value="6674"):
294                     ret = status.pid("httpd")
295                     self.assertEqual(ret, m.ret)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_nxos_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.cp as cp_module
2 import salt.modules.file as file_module
3 import salt.modules.nxos as nxos_module
4 import salt.utils.nxos as nxos_utils
5 import salt.utils.pycrypto
6 from salt.exceptions import CommandExecutionError, SaltInvocationError
7 from tests.support.mixins import LoaderModuleMockMixin
8 from tests.support.mock import MagicMock, create_autospec, patch
9 from tests.support.unit import TestCase, skipIf
10 from tests.unit.modules.nxos.nxos_config import (
11     config_input_file,
12     config_result,
13     config_result_file,
14     initial_config,
15     initial_config_file,
16     modified_config,
17     modified_config_file,
18     save_running_config,
19     set_role,
20     template_engine_file_str,
21     template_engine_file_str_file,
22     unset_role,
23 )
24 from tests.unit.modules.nxos.nxos_grains import n9k_grains
25 from tests.unit.modules.nxos.nxos_show_cmd_output import (
26     n9k_get_user_output,
27     n9k_show_user_account,
28     n9k_show_user_account_list,
29     n9k_show_ver,
30     n9k_show_ver_int_list,
31     n9k_show_ver_int_list_structured,
32     n9k_show_ver_list,
33 )
34 from tests.unit.modules.nxos.nxos_show_run import (
35     n9k_running_config,
36     n9k_show_running_config_list,
37     n9k_show_running_inc_username_list,
38 )
39 class NxosTestCase(TestCase, LoaderModuleMockMixin):
40     COPY_RS = "copy running-config startup-config"
41     def setup_loader_modules(self):
42         sendline = create_autospec(
43             nxos_module.sendline, autospec=True, return_value={"command": "fake_output"}
44         )
45         return {nxos_module: {"__proxy__": {"nxos.sendline": sendline}}}
46     @staticmethod
47     def test_check_virtual():
48         result = nxos_module.__virtual__()
49         assert "nxos" in result
50     def test_ping_proxy(self):
51 <a name="5"></a>
52         with patch("salt.utils.platform.is_proxy", return_value=True, autospec=True):
53             <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
54                 nxos_module.__proxy__, {"nxos.ping": MagicMock(return_value=True)}
55             ):
56                 result = nxos_module.ping()
57                 self.assertTrue(</b></font>result)
58     def test_ping_native_minion(self):
59 <a name="4"></a>        """UT: nxos module:ping method - proxy"""
60         with patch("salt.utils.platform.is_proxy", return_value=False, autospec=True):
61             <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
62                 nxos_module.__utils__, {"nxos.ping": MagicMock(return_value=True)}
63             ):
64                 result = nxos_module.ping()
65                 self.assertTrue(</b></font>result)
66     def test_check_password_return_none(self):
67         username = "admin"
68         password = "foo"
69         with patch("salt.modules.nxos.get_user", return_value=None, autospec=True):
70             result = nxos_module.check_password(username, password, encrypted=False)
71             self.assertIsNone(result)
72     def test_check_password_password_nxos_comment(self):
73         username = "admin"
74         password = "foo"
75         with patch("salt.modules.nxos.get_user", return_value="!", autospec=True):
76             result = nxos_module.check_password(username, password, encrypted=False)
77             self.assertFalse(result)
78     @skipIf(
79         "sha256" not in salt.utils.pycrypto.methods,
80         "compatible crypt method for fake data not available",
81     )
82     def test_check_password_password_encrypted_false(self):
83         username = "salt_test"
84         password = "foobar123&amp;"
85         with patch(
86             "salt.modules.nxos.get_user",
87             return_value=n9k_get_user_output,
88             autospec=True,
89         ):
90             result = nxos_module.check_password(username, password, encrypted=False)
91             self.assertTrue(result)
92     def test_check_password_password_encrypted_true(self):
93         username = "salt_test"
94         password = "$5$mkXh6O4T$YUVtA89HbXCnue63kgghPlaqPHyaXhdtxPBbPEHhbRC"
95         with patch(
96             "salt.modules.nxos.get_user",
97             return_value=n9k_get_user_output,
98             autospec=True,
99         ):
100             result = nxos_module.check_password(username, password, encrypted=True)
101             self.assertTrue(result)
102     def test_check_password_password_encrypted_true_negative(self):
103         username = "salt_test"
104         password = "foobar123&amp;"
105         with patch(
106             "salt.modules.nxos.get_user", return_value=n9k_running_config, autospec=True
107         ):
108             result = nxos_module.check_password(username, password, encrypted=True)
109             self.assertFalse(result)
110     def test_check_role_true(self):
111         username = "salt_test"
112         roles = ["network-admin", "dev-ops"]
113         with patch("salt.modules.nxos.get_roles", return_value=roles, autospec=True):
114             result = nxos_module.check_role(username, "dev-ops")
115             self.assertTrue(result)
116     def test_check_role_false(self):
117         username = "salt_test"
118         roles = ["network-admin", "dev-ops"]
119         with patch("salt.modules.nxos.get_roles", return_value=roles, autospec=True):
120             result = nxos_module.check_role(username, "network-operator")
121             self.assertFalse(result)
122     def test_cmd_any_function(self):
123         with patch.dict(
124             nxos_module.__salt__,
125             {
126                 "nxos.check_role": create_autospec(
127                     nxos_module.check_role, return_value=True
128                 )
129             },
130         ):
131             result = nxos_module.cmd(
132                 "check_role",
133                 "salt_test",
134                 "network-admin",
135                 encrypted=True,
136                 __pub_fun="nxos.cmd",
137             )
138             self.assertTrue(result)
139     def test_cmd_function_absent(self):
140         result = nxos_module.cmd(
141             "cool_new_function", "salt_test", "network-admin", encrypted=True
142         )
143         self.assertFalse(result)
144     def test_find_single_match(self):
145         find_pattern = "^vrf context testing$"
146         find_string = "vrf context testing"
147         with patch(
148             "salt.modules.nxos.show_run", return_value=n9k_running_config, autospec=True
149         ):
150             result = nxos_module.find(find_pattern)
151             self.assertIn(find_string, result)
152     def test_find_multiple_matches(self):
153         find_pattern = "^no logging.*$"
154         find_string = "no logging event link-status enable"
155         with patch(
156             "salt.modules.nxos.show_run", return_value=n9k_running_config, autospec=True
157         ):
158             result = nxos_module.find(find_pattern)
159             self.assertIn(find_string, result)
160             self.assertEqual(len(result), 7)
161     def test_get_roles_user_not_configured(self):
162         username = "salt_does_not_exist"
163         user_info = ""
164         with patch("salt.modules.nxos.get_user", return_value=user_info, autospec=True):
165             result = nxos_module.get_roles(username)
166             self.assertEqual(result, [])
167     def test_get_roles_user_configured(self):
168         username = "salt_test"
169         expected_result = ["network-operator", "network-admin", "dev-ops"]
170         with patch("salt.modules.nxos.get_user", return_value=username, autospec=True):
171             for rv in [n9k_show_user_account, n9k_show_user_account_list]:
172                 with patch("salt.modules.nxos.show", return_value=rv, autospec=True):
173                     result = nxos_module.get_roles(username)
174                     self.assertEqual(result.sort(), expected_result.sort())
175     def test_get_roles_user_configured_no_role(self):
176         username = "salt_test"
177         with patch("salt.modules.nxos.get_user", return_value=username, autospec=True):
178             with patch("salt.modules.nxos.show", return_value="", autospec=True):
179                 result = nxos_module.get_roles(username)
180                 self.assertEqual(result, [])
181     def test_get_user_configured(self):
182         username = "salt_test"
183         expected_output = n9k_show_running_inc_username_list[0]
184         for rv in [
185             n9k_show_running_inc_username_list[0],
186             n9k_show_running_inc_username_list,
187         ]:
188             with patch("salt.modules.nxos.show", return_value=rv, autospec=True):
189                 result = nxos_module.get_user(username)
190                 self.assertEqual(result, expected_output)
191     def test_grains(self):
192         nxos_module.DEVICE_DETAILS["grains_cache"] = {}
193         expected_grains = {
194             "software": {
195                 "BIOS": "version 08.36",
196                 "NXOS": "version 9.2(1)",
197                 "BIOS compile time": "06/07/2019",
198                 "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
199                 "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
200             },
201             "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
202             "plugins": ["Core Plugin", "Ethernet Plugin"],
203         }
204         with patch.dict(
205             nxos_module.__salt__,
206             {
207                 "utils.nxos.system_info": create_autospec(
208                     nxos_utils.system_info, return_value=n9k_grains
209                 )
210             },
211         ):
212             with patch(
213                 "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
214             ):
215                 result = nxos_module.grains()
216                 self.assertEqual(result, expected_grains)
217     def test_grains_get_cache(self):
218         expected_grains = {
219             "software": {
220                 "BIOS": "version 08.36",
221                 "NXOS": "version 9.2(1)",
222                 "BIOS compile time": "06/07/2019",
223                 "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
224                 "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
225             },
226             "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
227             "plugins": ["Core Plugin", "Ethernet Plugin"],
228         }
229         nxos_module.DEVICE_DETAILS["grains_cache"] = expected_grains
230         with patch.dict(
231             nxos_module.__salt__,
232             {
233                 "utils.nxos.system_info": create_autospec(
234                     nxos_utils.system_info, return_value=n9k_grains
235                 )
236             },
237         ):
238             with patch(
239                 "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
240             ):
241                 result = nxos_module.grains()
242                 self.assertEqual(result, expected_grains)
243     def test_grains_refresh(self):
244         expected_grains = {
245             "software": {
246                 "BIOS": "version 08.36",
247                 "NXOS": "version 9.2(1)",
248                 "BIOS compile time": "06/07/2019",
249                 "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
250                 "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
251             },
252             "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
253             "plugins": ["Core Plugin", "Ethernet Plugin"],
254         }
255         with patch(
256             "salt.modules.nxos.grains", return_value=expected_grains, autospec=True
257         ):
258             result = nxos_module.grains_refresh()
259             self.assertEqual(result, expected_grains)
260     def test_system_info(self):
261         expected_grains = {
262             "software": {
263                 "BIOS": "version 08.36",
264                 "NXOS": "version 9.2(1)",
265                 "BIOS compile time": "06/07/2019",
266                 "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
267                 "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
268             },
269             "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
270             "plugins": ["Core Plugin", "Ethernet Plugin"],
271         }
272         with patch.dict(
273             nxos_module.__salt__,
274             {
275                 "utils.nxos.system_info": create_autospec(
276                     nxos_utils.system_info, return_value=n9k_grains
277                 )
278             },
279         ):
280             with patch(
281                 "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
282             ):
283                 result = nxos_module.system_info()
284                 self.assertEqual(result, expected_grains)
285     def test_sendline_invalid_method(self):
286         command = "show version"
287         method = "invalid"
288         result = nxos_module.sendline(command, method)
289         self.assertIn("INPUT ERROR", result)
290     def test_sendline_valid_method_proxy(self):
291         command = "show version"
292 <a name="3"></a>        method = "cli_show_ascii"
293         with patch("salt.utils.platform.is_proxy", return_value=True, autospec=True):
294             <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
295                 nxos_module.__proxy__,
296                 {"nxos.sendline": MagicMock(return_value=n9k_show_ver)},
297             ):
298                 result = nxos_module.sendline(command, method)
299                 self.assertIn(</b></font>n9k_show_ver, result)
300     def test_sendline_valid_method_nxapi_uds(self):
301         command = "show version"
302         method = "cli_show_ascii"
303         with patch("salt.utils.platform.is_proxy", MagicMock(return_value=False)):
304             with patch(
305                 "salt.modules.nxos._nxapi_request",
306                 return_value=n9k_show_ver,
307                 autospec=True,
308             ):
309                 result = nxos_module.sendline(command, method)
310                 self.assertIn(n9k_show_ver, result)
311     def test_show_raw_text_invalid(self):
312         command = "show version"
313         raw_text = "invalid"
314         result = nxos_module.show(command, raw_text)
315         self.assertIn("INPUT ERROR", result)
316     def test_show_raw_text_true(self):
317         command = "show version"
318         raw_text = True
319         with patch(
320             "salt.modules.nxos.sendline", autospec=True, return_value=n9k_show_ver
321         ):
322             result = nxos_module.show(command, raw_text)
323             self.assertEqual(result, n9k_show_ver)
324     def test_show_raw_text_true_multiple_commands(self):
325         command = "show bgp sessions ; show processes"
326         raw_text = True
327         data = ["bgp_session_data", "process_data"]
328         with patch("salt.modules.nxos.sendline", autospec=True, return_value=data):
329             result = nxos_module.show(command, raw_text)
330             self.assertEqual(result, data)
331     def test_show_nxapi(self):
332         command = "show version; show interface eth1/1"
333         raw_text = True
334         with patch(
335             "salt.modules.nxos.sendline",
336             autospec=True,
337             return_value=n9k_show_ver_int_list,
338         ):
339             result = nxos_module.show(command, raw_text)
340             self.assertEqual(result[0], n9k_show_ver_int_list[0])
341             self.assertEqual(result[1], n9k_show_ver_int_list[1])
342     def test_show_nxapi_structured(self):
343         command = "show version; show interface eth1/1"
344         raw_text = False
345         with patch(
346             "salt.modules.nxos.sendline",
347             autospec=True,
348             return_value=n9k_show_ver_int_list_structured,
349         ):
350             result = nxos_module.show(command, raw_text)
351             self.assertEqual(result[0], n9k_show_ver_int_list_structured[0])
352             self.assertEqual(result[1], n9k_show_ver_int_list_structured[1])
353     def test_show_run(self):
354         expected_output = n9k_show_running_config_list[0]
355         for rv in [n9k_show_running_config_list[0], n9k_show_running_config_list]:
356             with patch("salt.modules.nxos.show", autospec=True, return_value=rv):
357                 result = nxos_module.show_run()
358                 self.assertEqual(result, expected_output)
359     def test_show_ver(self):
360         expected_output = n9k_show_ver_list[0]
361         for rv in [n9k_show_ver_list[0], n9k_show_ver_list]:
362             with patch("salt.modules.nxos.show", autospec=True, return_value=rv):
363                 result = nxos_module.show_ver()
364                 self.assertEqual(result, expected_output)
365     def test_add_config(self):
366         expected_output = "COMMAND_LIST: feature bgp"
367         with patch(
368             "salt.modules.nxos.config", autospec=True, return_value=expected_output
369         ):
370             result = nxos_module.add_config("feature bgp")
371             self.assertEqual(result, expected_output)
372     def test_config_commands(self):
373         commands = ["no feature ospf", ["no feature ospf"]]
374         expected_output = (
375             "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
376             " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
377             " pim\n feature lldp\n \n"
378         )
379         for cmd_set in commands:
380             with patch(
381                 "salt.modules.nxos.show",
382                 autospec=True,
383                 side_effect=[initial_config, modified_config],
384             ):
385                 mock_cmd = create_autospec(
386                     file_module.apply_template_on_contents,
387                     return_value=template_engine_file_str,
388                 )
389                 with patch.dict(
390                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
391                 ):
392                     with patch(
393                         "salt.modules.nxos._configure_device",
394                         autospec=True,
395                         return_value=config_result,
396                     ):
397                         result = nxos_module.config(cmd_set, save_config=False)
398                         self.assertEqual(result, expected_output)
399     def test_config_commands_template_none(self):
400         commands = ["no feature ospf", ["no feature ospf"]]
401         expected_output = (
402             "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
403             " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
404             " pim\n feature lldp\n \n"
405         )
406         for cmd_set in commands:
407             with patch(
408                 "salt.modules.nxos.show",
409                 autospec=True,
410                 side_effect=[initial_config, modified_config],
411             ):
412                 mock_cmd = create_autospec(
413                     file_module.apply_template_on_contents,
414                     return_value=template_engine_file_str,
415                 )
416                 with patch.dict(
417                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
418                 ):
419                     with patch(
420                         "salt.modules.nxos._configure_device",
421                         autospec=True,
422                         return_value=config_result,
423                     ):
424                         result = nxos_module.config(cmd_set, template_engine=None)
425                         self.assertEqual(result, expected_output)
426     def test_config_commands_string(self):
427         commands = "no feature ospf"
428         expected_output = (
429             "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
430             " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
431             " pim\n feature lldp\n \n"
432         )
433         with patch(
434             "salt.modules.nxos.show",
435             autospec=True,
436             side_effect=[initial_config[0], modified_config[0]],
437         ):
438             mock_cmd = create_autospec(
439                 file_module.apply_template_on_contents,
440                 return_value=template_engine_file_str,
441             )
442             with patch.dict(
443                 nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
444             ):
445                 with patch(
446                     "salt.modules.nxos._configure_device",
447                     autospec=True,
448                     return_value=config_result,
449                 ):
450                     result = nxos_module.config(commands)
451                     self.assertEqual(result, expected_output)
452     def test_config_file(self):
453         config_file = "salt://bgp_config.txt"
454         expected_output = (
455             "COMMAND_LIST: feature bgp ; ! ; router bgp 55 ; address-family ipv4"
456             " unicast ; no client-to-client reflection ; additional-paths send\n\n---"
457             " \n+++ \n@@ -19,6 +19,7 @@\n feature bash-shell\n cfs eth distribute\n"
458             " feature ngmvpn\n+feature bgp\n feature pim\n feature lldp\n \n@@ -233,6"
459             " +234,10 @@\n line console\n line vty\n boot nxos"
460             " bootflash:/nxos.9.2.4.bin \n+router bgp 55\n+  address-family ipv4"
461             " unicast\n+    no client-to-client reflection\n+    additional-paths"
462             " send\n \n no logging logfile\n no logging monitor\n"
463         )
464         with patch(
465             "salt.modules.nxos.show",
466             autospec=True,
467             side_effect=[initial_config_file, modified_config_file],
468         ):
469             mock_cmd = create_autospec(
470                 cp_module.get_file_str, return_value=config_input_file
471             )
472             with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
473                 mock_cmd = create_autospec(
474                     file_module.apply_template_on_contents,
475                     return_value=template_engine_file_str_file,
476                 )
477                 with patch.dict(
478                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
479                 ):
480                     with patch(
481                         "salt.modules.nxos._configure_device",
482                         autospec=True,
483                         return_value=config_result_file,
484                     ):
485                         result = nxos_module.config(config_file=config_file)
486                         self.assertEqual(result, expected_output)
487     def test_config_file_error1(self):
488         config_file = "salt://bgp_config.txt"
489         with patch(
490             "salt.modules.nxos.show",
491             autospec=True,
492             side_effect=[initial_config_file, modified_config_file],
493         ):
494             mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
495             with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
496                 mock_cmd = create_autospec(
497                     file_module.apply_template_on_contents,
498                     return_value=template_engine_file_str_file,
499                 )
500                 with patch.dict(
501                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
502                 ):
503                     with patch(
504                         "salt.modules.nxos._configure_device",
505                         autospec=True,
506                         return_value=config_result_file,
507                     ):
508                         with self.assertRaises(CommandExecutionError):
509                             nxos_module.config(config_file=config_file)
510     def test_config_nxos_error_ssh(self):
511         commands = ["feature bgp", "router bgp 57"]
512         config_result = [
513             ["feature bgp", "router bgp 57"],
514             "bgp instance is already running; Tag is 55",
515         ]
516         expected_output = (
517             "COMMAND_LIST: feature bgp ; router bgp 57\nbgp instance is already"
518             " running; Tag is 55\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature bash-shell\n"
519             " cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature pim\n"
520             " feature lldp\n \n"
521         )
522         with patch(
523             "salt.modules.nxos.show",
524             autospec=True,
525             side_effect=[initial_config[0], modified_config[0]],
526         ):
527             mock_cmd = create_autospec(
528                 file_module.apply_template_on_contents,
529                 return_value=template_engine_file_str,
530             )
531             with patch.dict(
532                 nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
533             ):
534                 with patch(
535                     "salt.modules.nxos._configure_device",
536                     autospec=True,
537                     return_value=config_result,
538                 ):
539                     result = nxos_module.config(commands)
540                     self.assertEqual(result, expected_output)
541     def test_commands_error(self):
542         commands = None
543         with patch(
544             "salt.modules.nxos.show",
545             autospec=True,
546             side_effect=[initial_config_file, modified_config_file],
547         ):
548             mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
549             with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
550                 mock_cmd = create_autospec(
551                     file_module.apply_template_on_contents,
552                     return_value=template_engine_file_str_file,
553                 )
554                 with patch.dict(
555                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
556                 ):
557                     with patch(
558                         "salt.modules.nxos._configure_device",
559                         autospec=True,
560                         return_value=config_result_file,
561                     ):
562                         with self.assertRaises(CommandExecutionError):
563                             nxos_module.config(commands=commands)
564     def test_config_file_error2(self):
565         config_file = None
566         with patch(
567             "salt.modules.nxos.show",
568             autospec=True,
569             side_effect=[initial_config_file, modified_config_file],
570         ):
571             mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
572             with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
573                 mock_cmd = create_autospec(
574                     file_module.apply_template_on_contents,
575                     return_value=template_engine_file_str_file,
576                 )
577                 with patch.dict(
578                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
579                 ):
580                     with patch(
581                         "salt.modules.nxos._configure_device",
582                         autospec=True,
583                         return_value=config_result_file,
584                     ):
585                         with self.assertRaises(CommandExecutionError):
586                             nxos_module.config(config_file=config_file)
587     def test_delete_config(self):
588         for lines in ["feature bgp", ["feature bgp"]]:
589             with patch("salt.modules.nxos.config", autospec=True):
590                 result = nxos_module.delete_config(lines)
591                 nxos_module.config.assert_called_with(["no feature bgp"])
592                 self.assertEqual(result, nxos_module.config.return_value)
593     def test_remove_user(self):
594         with patch("salt.modules.nxos.config", autospec=True):
595             result = nxos_module.remove_user("salt_test")
596             nxos_module.config.assert_called_with("no username salt_test")
597             self.assertEqual(result, nxos_module.config.return_value)
598     def test_replace(self):
599         old_value = "feature bgp"
600         new_value = "feature ospf"
601         with patch(
602             "salt.modules.nxos.show_run",
603             autospec=True,
604             return_value=n9k_show_running_config_list[0],
605         ):
606             with patch(
607                 "salt.modules.nxos.delete_config", autospec=True, return_value=None
608             ):
609                 with patch(
610                     "salt.modules.nxos.add_config", autospec=True, return_value=None
611                 ):
612                     result = nxos_module.replace(old_value, new_value)
613                     self.assertEqual(result["old"], ["feature bgp"])
614                     self.assertEqual(result["new"], ["feature ospf"])
615     def test_replace_full_match_true(self):
616         old_value = "feature bgp"
617         new_value = "feature ospf"
618         with patch(
619             "salt.modules.nxos.show_run",
620             autospec=True,
621             return_value=n9k_show_running_config_list[0],
622         ):
623             with patch(
624                 "salt.modules.nxos.delete_config", autospec=True, return_value=None
625             ):
626                 with patch(
627                     "salt.modules.nxos.add_config", autospec=True, return_value=None
628                 ):
629                     result = nxos_module.replace(old_value, new_value, full_match=True)
630                     self.assertEqual(result["old"], ["feature bgp"])
631                     self.assertEqual(result["new"], ["feature ospf"])
632     def test_replace_no_match(self):
633         old_value = "feature does_not_exist"
634         new_value = "feature ospf"
635         with patch(
636             "salt.modules.nxos.show_run",
637             autospec=True,
638             return_value=n9k_show_running_config_list[0],
639         ):
640             with patch(
641                 "salt.modules.nxos.delete_config", autospec=True, return_value=None
642             ):
643                 with patch(
644                     "salt.modules.nxos.add_config", autospec=True, return_value=None
645                 ):
646                     result = nxos_module.replace(old_value, new_value)
647                     self.assertEqual(result["old"], [])
648                     self.assertEqual(result["new"], [])
649     def test_save_running_config(self):
650         with patch(
651             "salt.modules.nxos.config", autospec=True, return_value=save_running_config
652         ):
653             result = nxos_module.save_running_config()
654             self.assertEqual(result, save_running_config)
655     def test_set_password_enc_false_cs_none(self):
656         username = "devops"
657         password = "test123TMM^&amp;"
658         hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
659         config_line = (
660             "username devops password 5"
661             " $5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
662         )
663         with patch("salt.modules.nxos.get_user", autospec=True):
664             with patch(
665                 "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
666             ):
667                 with patch(
668                     "salt.modules.nxos.config",
669                     autospec=True,
670                     return_value="password_set",
671                 ) as config:
672                     result = nxos_module.set_password(username, password)
673                     config.assert_called_with(config_line)
674                     self.assertEqual("password_set", result)
675     def test_set_password_enc_false_cs_set(self):
676         username = "devops"
677         password = "test123TMM^&amp;"
678         crypt_salt = "ZcZqm15X"
679         hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
680         config_line = (
681             "username devops password 5"
682             " $5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
683         )
684         with patch("salt.modules.nxos.get_user", autospec=True):
685             with patch(
686                 "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
687             ):
688                 with patch(
689                     "salt.modules.nxos.config",
690                     autospec=True,
691                     return_value="password_set",
692                 ) as config:
693                     result = nxos_module.set_password(
694                         username, password, crypt_salt=crypt_salt
695                     )
696                     config.assert_called_with(config_line)
697                     self.assertEqual("password_set", result)
698     def test_set_password_enc_true(self):
699         username = "devops"
700         password = "test123TMM^&amp;"
701         hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
702         config_line = "username devops password 5 test123TMM^&amp;"
703         with patch("salt.modules.nxos.get_user", autospec=True):
704             with patch(
705                 "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
706             ):
707                 with patch(
708                     "salt.modules.nxos.config",
709                     autospec=True,
710                     return_value="password_set",
711                 ) as config:
712                     result = nxos_module.set_password(
713                         username, password, encrypted=True
714                     )
715                     config.assert_called_with(config_line)
716                     self.assertEqual("password_set", result)
717     def test_set_password_role_none(self):
718         username = "devops"
719         password = "test123TMM^&amp;"
720         hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
721         config_line = "username devops password 5 test123TMM^&amp; role devops"
722         with patch("salt.modules.nxos.get_user", autospec=True):
723             with patch(
724                 "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
725             ):
726                 with patch(
727                     "salt.modules.nxos.config",
728                     autospec=True,
729                     return_value="password_set",
730                 ) as config:
731 <a name="1"></a>                    result = nxos_module.set_password(
732                         username, password, encrypted=True, role="devops"
733                     )
734                     config<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assert_called_with(config_line)
735                     self.assertEqual("password_set", result)
736     def test_set_password_blowfish_crypt(self):
737         with self.assertRaises(SaltInvocationError):
738             nxos_module.</b></font>set_password(
739                 "username", "password", encrypted=True, algorithm="blowfish"
740             )
741     def test_set_role(self):
742         username = "salt_test"
743         role = "vdc-admin"
744         with patch("salt.modules.nxos.config", autospec=True, return_value=set_role):
745             result = nxos_module.set_role(username, role)
746             self.assertEqual(result, set_role)
747     def test_unset_role(self):
748         username = "salt_test"
749         role = "vdc-admin"
750         with patch("salt.modules.nxos.config", autospec=True, return_value=unset_role):
751             result = nxos_module.unset_role(username, role)
752             self.assertEqual(result, unset_role)
753     def test_configure_device(self):
754 <a name="2"></a>        """UT: nxos module:_configure_device method"""
755         with patch("salt.utils.platform.is_proxy", autospec=True, return_value=True):
756             <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
757                 nxos_module.__proxy__,
758                 {"nxos.proxy_config": MagicMock(return_value="configured")},
759             ):
760                 result = nxos_module._configure_device("feature bgp")
761                 self.assertEqual(</b></font>result, "configured")
762         with patch("salt.utils.platform.is_proxy", autospec=True, return_value=False):
763             with patch.object(
764                 nxos_module, "_nxapi_config", MagicMock(return_value="configured")
765             ):
766                 nxos_module._configure_device("feature bgp")
767                 self.assertEqual(result, "configured")
768     def test_nxapi_config(self):
769         mock_cmd = MagicMock(return_value={"nxos": {"save_config": False}})
770         with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
771 <a name="0"></a>            with patch(
772                 "salt.modules.nxos._nxapi_request",
773                 return_value="router_data",
774                 autospec<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=True,
775             ):
776                 result = nxos_module._nxapi_config("show version")
777                 self.assertEqual(result, [["show version"], "router_data"])
778     def test_nxapi_config_failure(self):
779         side_effect = ["Failure"</b></font>, "saved_data"]
780         mock_cmd = MagicMock(return_value={"nxos": {"save_config": True}})
781         with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
782             with patch(
783                 "salt.modules.nxos._nxapi_request",
784                 side_effect=side_effect,
785                 autospec=True,
786             ):
787                 result = nxos_module._nxapi_config("show bad_command")
788                 self.assertEqual(result, [["show bad_command"], "Failure"])
789     def test_nxapi_request_proxy(self):
790         with patch("salt.utils.platform.is_proxy", autospec=True, return_value=True):
791             mock_request = create_autospec(
792                 nxos_utils.nxapi_request, return_value="router_data"
793             )
794             with patch.dict(
795                 nxos_module.__proxy__, {"nxos._nxapi_request": mock_request}
796             ):
797                 result = nxos_module._nxapi_request("show version")
798                 self.assertEqual(result, "router_data")
799     def test_nxapi_request_no_proxy(self):
800         with patch("salt.utils.platform.is_proxy", autospec=True, return_value=False):
801             mock_cmd = MagicMock(return_value={"nxos": {"save_config": False}})
802             with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
803                 mock_request = create_autospec(nxos_utils.nxapi_request)
804                 with patch.dict(
805                     nxos_module.__utils__, {"nxos.nxapi_request": mock_request}
806                 ):
807                     result = nxos_module._nxapi_request("show version")
808                     self.assertEqual(result, mock_request.return_value)
809                     mock_request.assert_called_with(
810                         "show version", "cli_conf", **mock_cmd.return_value
811                     )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
