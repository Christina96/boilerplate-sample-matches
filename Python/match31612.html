<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_status_2.py &amp; test_nxos_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_status_2.py &amp; test_nxos_1.py
      </h3>
<h1 align="center">
        7.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_status_2.py (12.914485%)<th>test_nxos_1.py (5.5472264%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(247-253)<td><a href="#" name="0">(1050-1059)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(154-162)<td><a href="#" name="1">(988-996)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(366-370)<td><a href="#" name="2">(1027-1032)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(354-358)<td><a href="#" name="3">(415-420)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(294-298)<td><a href="#" name="4">(80-84)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(258-262)<td><a href="#" name="5">(69-73)</a><td align="center"><font color="#eb0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_status_2.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import os
2 import salt.modules.status as status
3 import salt.utils.platform
4 from salt.exceptions import CommandExecutionError
5 from tests.support.mixins import LoaderModuleMockMixin
6 from tests.support.mock import MagicMock, mock_open, patch
7 from tests.support.unit import TestCase
8 class StatusTestCase(TestCase, LoaderModuleMockMixin):
9     def setup_loader_modules(self):
10         return {status: {}}
11     def _set_up_test_uptime(self):
12         class MockData:
13         m = MockData()
14         m.now = 1477004312
15         m.ut = 1540154.00
16         m.idle = 3047777.32
17         m.ret = {
18             "users": 3,
19             "seconds": 1540154,
20             "since_t": 1475464158,
21             "days": 17,
22             "since_iso": "2016-10-03T03:09:18",
23             "time": "19:49",
24         }
25         return m
26     def _set_up_test_uptime_sunos(self):
27         class MockData:
28         m = MockData()
29         m.ret = {
30             "retcode": 0,
31             "stdout": "unix:0:system_misc:boot_time    1475464158",
32         }
33         return m
34     def test_uptime_linux(self):
35         m = self._set_up_test_uptime()
36         with patch.multiple(
37             salt.utils.platform,
38             is_linux=MagicMock(return_value=True),
39             is_sunos=MagicMock(return_value=False),
40             is_darwin=MagicMock(return_value=False),
41             is_freebsd=MagicMock(return_value=False),
42             is_openbsd=MagicMock(return_value=False),
43             is_netbsd=MagicMock(return_value=False),
44         ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
45             status.__salt__,
46             {"cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"]))},
47         ), patch(
48             "time.time", MagicMock(return_value=m.now)
49         ), patch(
50             "os.path.exists", MagicMock(return_value=True)
51         ):
52             proc_uptime = salt.utils.stringutils.to_str("{} {}".format(m.ut, m.idle))
53             with patch("salt.utils.files.fopen", mock_open(read_data=proc_uptime)):
54                 ret = status.uptime()
55                 self.assertDictEqual(ret, m.ret)
56             with patch("os.path.exists", MagicMock(return_value=False)):
57                 with self.assertRaises(CommandExecutionError):
58                     status.uptime()
59     def test_uptime_sunos(self):
60         m = self._set_up_test_uptime()
61         m2 = self._set_up_test_uptime_sunos()
62         with patch.multiple(
63             salt.utils.platform,
64             is_linux=MagicMock(return_value=False),
65             is_sunos=MagicMock(return_value=True),
66             is_darwin=MagicMock(return_value=False),
67             is_freebsd=MagicMock(return_value=False),
68             is_openbsd=MagicMock(return_value=False),
69             is_netbsd=MagicMock(return_value=False),
70         ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
71             status.__salt__,
72             {
73                 "cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"])),
74                 "cmd.run_all": MagicMock(return_value=m2.ret),
75             },
76         ), patch(
77             "time.time", MagicMock(return_value=m.now)
78         ):
79             ret = status.uptime()
80             self.assertDictEqual(ret, m.ret)
81     def test_uptime_macos(self):
82         m = self._set_up_test_uptime()
83         kern_boottime = (
84             "{{ sec = {0}, usec = {1:0&lt;6} }} Mon Oct 03 03:09:18.23 2016".format(
85                 *str(m.now - m.ut).split(".")
86             )
87         )
88         with patch.multiple(
89             salt.utils.platform,
90             is_linux=MagicMock(return_value=False),
91             is_sunos=MagicMock(return_value=False),
92             is_darwin=MagicMock(return_value=True),
93             is_freebsd=MagicMock(return_value=False),
94             is_openbsd=MagicMock(return_value=False),
95             is_netbsd=MagicMock(return_value=False),
96         ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
97             status.__salt__,
98             {
99                 "cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"])),
100                 "sysctl.get": MagicMock(return_value=kern_boottime),
101             },
102         ), patch(
103             "time.time", MagicMock(return_value=m.now)
104         ):
105             ret = status.uptime()
106             self.assertDictEqual(ret, m.ret)
107                 status.__salt__, {"sysctl.get": MagicMock(return_value="")}
108             ):
109                 with self<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertRaises(CommandExecutionError):
110                     status.uptime()
111     def test_uptime_return_success_not_supported(self):
112         with patch.multiple(
113             salt.</b></font>utils.platform,
114             is_linux=MagicMock(return_value=False),
115             is_sunos=MagicMock(return_value=False),
116             is_darwin=MagicMock(return_value=False),
117             is_freebsd=MagicMock(return_value=False),
118             is_openbsd=MagicMock(return_value=False),
119             is_netbsd=MagicMock(return_value=False),
120         ):
121             exc_mock = MagicMock(side_effect=CommandExecutionError)
122             with self.assertRaises(CommandExecutionError):
123                 with patch.dict(status.__salt__, {"cmd.run": exc_mock}):
124                     status.uptime()
125     def _set_up_test_cpustats_openbsd(self):
126         class MockData:
127         m = MockData()
128         m.ret = {
129             "0": {
130                 "User": "0.0%",
131                 "Nice": "0.0%",
132                 "System": "4.5%",
133                 "Interrupt": "0.5%",
134                 "Idle": "95.0%",
135             }
136         }
137         return m
138     def test_cpustats_openbsd(self):
139         m = self._set_up_test_cpustats_openbsd()
140         systat = (
141             "\n\n   1 users Load 0.20 0.07 0.05                        salt.localdomain"
142             " 09:42:42\nCPU                User           Nice        System    "
143             " Interrupt          Idle\n0                  0.0%           0.0%         "
144             " 4.5%          0.5%         95.0%\n"
145         )
146         with patch.multiple(
147             salt.utils.platform,
148             is_linux=MagicMock(return_value=False),
149             is_sunos=MagicMock(return_value=False),
150             is_darwin=MagicMock(return_value=False),
151             is_freebsd=MagicMock(return_value=False),
152             is_openbsd=MagicMock(return_value=True),
153             is_netbsd=MagicMock(return_value=False),
154         ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
155             status.__grains__, {"kernel": "OpenBSD"}
156         ), patch.dict(
157             status.__salt__, {"cmd.run": MagicMock(return_value=systat)}
158         ):
159             ret = status.cpustats()
160             self.assertDictEqual(ret, m.ret)
161     def _set_up_test_cpuinfo_bsd(self):
162         class MockData:
163         m = MockData()
164         m.ret = {
165             "hw.model": "Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz",
166             "hw.ncpu": "4",
167         }
168         return m
169     def test_cpuinfo_freebsd(self):
170         m = self._set_up_test_cpuinfo_bsd()
171         sysctl = "hw.model:Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz\nhw.ncpu:4"
172         with patch.dict(status.__grains__, {"kernel": "FreeBSD"}):
173             with patch.dict(
174                 status.__salt__, {"cmd.run": MagicMock(return_value<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=sysctl)}
175             ):
176                 ret = status.cpuinfo()
177                 self.assertDictEqual(ret, m.ret)
178     def test_cpuinfo_openbsd(self):
179         m = self.</b></font>_set_up_test_cpuinfo_bsd()
180         sysctl = "hw.model=Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz\nhw.ncpu=4"
181         for bsd in ["NetBSD", "OpenBSD"]:
182             with patch.dict(status.__grains__, {"kernel": bsd}):
183                 <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
184                     status.__salt__, {"cmd.run": MagicMock(return_value=sysctl)}
185                 ):
186                     ret = status.cpuinfo()
187                     self.assertDictEqual(</b></font>ret, m.ret)
188     def _set_up_test_meminfo_openbsd(self):
189         class MockData:
190         m = MockData()
191         m.ret = {
192             "active virtual pages": "355M",
193             "free list size": "305M",
194             "page faults": "845",
195             "pages reclaimed": "1",
196             "pages paged in": "2",
197             "pages paged out": "3",
198             "pages freed": "4",
199             "pages scanned": "5",
200         }
201         return m
202     def test_meminfo_openbsd(self):
203         m = self._set_up_test_meminfo_openbsd()
204         vmstat = (
205             " procs    memory       page                    disks    traps         "
206             " cpu\n r   s   avm     fre  flt  re  pi  po  fr  sr cd0 sd0  int   sys  "
207             " cs us sy id\n 2 103  355M    305M  845   1   2   3   4   5   0   1   21  "
208             " 682   86  1  1 98"
209         with patch.dict(status.__grains__, {"kernel": "OpenBSD"}):
210             <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
211                 status.__salt__, {"cmd.run": MagicMock(return_value=vmstat)}
212             ):
213                 ret = status.meminfo()
214                 self.assertDictEqual(</b></font>ret, m.ret)
215     def _set_up_test_w_linux(self):
216         class MockData:
217         m = MockData()
218         m.ret = [
219             {
220                 "idle": "0s",
221                 "jcpu": "0.24s",
222                 "login": "13:42",
223                 "pcpu": "0.16s",
224                 "tty": "pts/1",
225                 "user": "root",
226                 "what": "nmap -sV 10.2.2.2",
227             }
228         ]
229         return m
230     def _set_up_test_w_bsd(self):
231         class MockData:
232         m = MockData()
233         m.ret = [
234             {
235                 "idle": "0",
236                 "from": "10.2.2.1",
237                 "login": "1:42PM",
238                 "tty": "p1",
239                 "user": "root",
240                 "what": "nmap -sV 10.2.2.2",
241             }
242         ]
243         return m
244     def test_w_linux(self):
245         m = self._set_up_test_w_linux()
246         with patch.dict(status.__grains__, {"kernel": "Linux"}):
247             <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
248                 status.__salt__, {"cmd.run": MagicMock(return_value=w_output)}
249             ):
250                 ret = status.w()
251                 self.assertListEqual(</b></font>ret, m.ret)
252     def test_w_bsd(self):
253         m = self._set_up_test_w_bsd()
254         w_output = "root   p1 10.2.2.1    1:42PM  0 nmap -sV 10.2.2.2"
255         for bsd in ["Darwin", "FreeBSD", "OpenBSD"]:
256             with patch.dict(status.__grains__, {"kernel": bsd}):
257                 <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
258                     status.__salt__, {"cmd.run": MagicMock(return_value=w_output)}
259                 ):
260                     ret = status.w()
261                     self.assertListEqual(</b></font>ret, m.ret)
262     def _set_up_test_status_pid_linux(self):
263         class MockData:
264         m = MockData()
265         m.ret = "2701\n7539\n7540\n7542\n7623"
266         return m
267     def test_status_pid_linux(self):
268         m = self._set_up_test_status_pid_linux()
269         ps = (
270             "UID      PID PPID  C STIME TTY      TIME CMD\nroot     360    2  0 Jun08 ?"
271             "    00:00:00   [jbd2/dm-0-8]\nroot     947    2  0 Jun08 ?    00:00:00  "
272             " [jbd2/dm-1-8]\nroot     949    2  0 Jun08 ?    00:00:09  "
273             " [jbd2/dm-3-8]\nroot     951    2  0 Jun08 ?    00:00:00  "
274             " [jbd2/dm-4-8]\nroot    2701    1  0 Jun08 ?    00:00:28   /usr/sbin/httpd"
275             " -k start\napache  7539 2701  0 04:40 ?    00:00:04     /usr/sbin/httpd -k"
276             " start\napache  7540 2701  0 04:40 ?    00:00:02     /usr/sbin/httpd -k"
277             " start\napache  7542 2701  0 04:40 ?    00:01:46     /usr/sbin/httpd -k"
278             " start\napache  7623 2701  0 04:40 ?    00:02:41     /usr/sbin/httpd -k"
279             " start\nroot    1564    1  0 Jun11 ?    00:07:19   /usr/bin/python3"
280             " /usr/bin/salt-minion -d\nroot    6674 1564  0 19:53 ?    00:00:00    "
281             " /usr/bin/python3 /usr/bin/salt-call status.pid httpd -l debug"
282         )
283         with patch.dict(status.__grains__, {"ps": "ps -efHww"}):
284             with patch.dict(
285                 status.__salt__, {"cmd.run_stdout": MagicMock(return_value=ps)}
286             ):
287                 with patch.object(os, "getpid", return_value="6674"):
288                     ret = status.pid("httpd")
289                     self.assertEqual(ret, m.ret)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_nxos_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 import salt.modules.cp as cp_module
2 import salt.modules.file as file_module
3 import salt.modules.nxos as nxos_module
4 import salt.utils.nxos as nxos_utils
5 import salt.utils.pycrypto
6 from salt.exceptions import CommandExecutionError, SaltInvocationError
7 from tests.support.mixins import LoaderModuleMockMixin
8 from tests.support.mock import MagicMock, create_autospec, patch
9 from tests.support.unit import TestCase, skipIf
10 from tests.unit.modules.nxos.nxos_config import (
11     config_input_file,
12     config_result,
13     config_result_file,
14     initial_config,
15     initial_config_file,
16     modified_config,
17     modified_config_file,
18     save_running_config,
19     set_role,
20     template_engine_file_str,
21     template_engine_file_str_file,
22     unset_role,
23 )
24 from tests.unit.modules.nxos.nxos_grains import n9k_grains
25 from tests.unit.modules.nxos.nxos_show_cmd_output import (
26     n9k_get_user_output,
27     n9k_show_user_account,
28     n9k_show_user_account_list,
29     n9k_show_ver,
30     n9k_show_ver_int_list,
31     n9k_show_ver_int_list_structured,
32     n9k_show_ver_list,
33 )
34 from tests.unit.modules.nxos.nxos_show_run import (
35     n9k_running_config,
36     n9k_show_running_config_list,
37     n9k_show_running_inc_username_list,
38 )
39 class NxosTestCase(TestCase, LoaderModuleMockMixin):
40     COPY_RS = "copy running-config startup-config"
41     def setup_loader_modules(self):
42         sendline = create_autospec(
43             nxos_module.sendline, autospec=True, return_value={"command": "fake_output"}
44         )
45         return {nxos_module: {"__proxy__": {"nxos.sendline": sendline}}}
46     @staticmethod
47     def test_check_virtual():
48         result = nxos_module.__virtual__()
49         assert "nxos" in result
50     def test_ping_proxy(self):
51         with patch("salt.utils.platform.is_proxy", return_value=True, autospec=True):
52             <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
53                 nxos_module.__proxy__, {"nxos.ping": MagicMock(return_value=True)}
54             ):
55                 result = nxos_module.ping()
56                 self.assertTrue(</b></font>result)
57     def test_ping_native_minion(self):
58         with patch("salt.utils.platform.is_proxy", return_value=False, autospec=True):
59             <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
60                 nxos_module.__utils__, {"nxos.ping": MagicMock(return_value=True)}
61             ):
62                 result = nxos_module.ping()
63                 self.assertTrue(</b></font>result)
64     def test_check_password_return_none(self):
65         username = "admin"
66         password = "foo"
67         with patch("salt.modules.nxos.get_user", return_value=None, autospec=True):
68             result = nxos_module.check_password(username, password, encrypted=False)
69             self.assertIsNone(result)
70     def test_check_password_password_nxos_comment(self):
71         username = "admin"
72         password = "foo"
73         with patch("salt.modules.nxos.get_user", return_value="!", autospec=True):
74             result = nxos_module.check_password(username, password, encrypted=False)
75             self.assertFalse(result)
76     @skipIf(
77         "sha256" not in salt.utils.pycrypto.methods,
78         "compatible crypt method for fake data not available",
79     )
80     def test_check_password_password_encrypted_false(self):
81         username = "salt_test"
82         password = "foobar123&amp;"
83         with patch(
84             "salt.modules.nxos.get_user",
85             return_value=n9k_get_user_output,
86             autospec=True,
87         ):
88             result = nxos_module.check_password(username, password, encrypted=False)
89             self.assertTrue(result)
90     def test_check_password_password_encrypted_true(self):
91         username = "salt_test"
92         password = "$5$mkXh6O4T$YUVtA89HbXCnue63kgghPlaqPHyaXhdtxPBbPEHhbRC"
93         with patch(
94             "salt.modules.nxos.get_user",
95             return_value=n9k_get_user_output,
96             autospec=True,
97         ):
98             result = nxos_module.check_password(username, password, encrypted=True)
99             self.assertTrue(result)
100     def test_check_password_password_encrypted_true_negative(self):
101         username = "salt_test"
102         password = "foobar123&amp;"
103         with patch(
104             "salt.modules.nxos.get_user", return_value=n9k_running_config, autospec=True
105         ):
106             result = nxos_module.check_password(username, password, encrypted=True)
107             self.assertFalse(result)
108     def test_check_role_true(self):
109         username = "salt_test"
110         roles = ["network-admin", "dev-ops"]
111         with patch("salt.modules.nxos.get_roles", return_value=roles, autospec=True):
112             result = nxos_module.check_role(username, "dev-ops")
113             self.assertTrue(result)
114     def test_check_role_false(self):
115         username = "salt_test"
116         roles = ["network-admin", "dev-ops"]
117         with patch("salt.modules.nxos.get_roles", return_value=roles, autospec=True):
118             result = nxos_module.check_role(username, "network-operator")
119             self.assertFalse(result)
120     def test_cmd_any_function(self):
121         with patch.dict(
122             nxos_module.__salt__,
123             {
124                 "nxos.check_role": create_autospec(
125                     nxos_module.check_role, return_value=True
126                 )
127             },
128         ):
129             result = nxos_module.cmd(
130                 "check_role",
131                 "salt_test",
132                 "network-admin",
133                 encrypted=True,
134                 __pub_fun="nxos.cmd",
135             )
136             self.assertTrue(result)
137     def test_cmd_function_absent(self):
138         result = nxos_module.cmd(
139             "cool_new_function", "salt_test", "network-admin", encrypted=True
140         )
141         self.assertFalse(result)
142     def test_find_single_match(self):
143         find_pattern = "^vrf context testing$"
144         find_string = "vrf context testing"
145         with patch(
146             "salt.modules.nxos.show_run", return_value=n9k_running_config, autospec=True
147         ):
148             result = nxos_module.find(find_pattern)
149             self.assertIn(find_string, result)
150     def test_find_multiple_matches(self):
151         find_pattern = "^no logging.*$"
152         find_string = "no logging event link-status enable"
153         with patch(
154             "salt.modules.nxos.show_run", return_value=n9k_running_config, autospec=True
155         ):
156             result = nxos_module.find(find_pattern)
157             self.assertIn(find_string, result)
158             self.assertEqual(len(result), 7)
159     def test_get_roles_user_not_configured(self):
160         username = "salt_does_not_exist"
161         user_info = ""
162         with patch("salt.modules.nxos.get_user", return_value=user_info, autospec=True):
163             result = nxos_module.get_roles(username)
164             self.assertEqual(result, [])
165     def test_get_roles_user_configured(self):
166         username = "salt_test"
167         expected_result = ["network-operator", "network-admin", "dev-ops"]
168         with patch("salt.modules.nxos.get_user", return_value=username, autospec=True):
169             for rv in [n9k_show_user_account, n9k_show_user_account_list]:
170                 with patch("salt.modules.nxos.show", return_value=rv, autospec=True):
171                     result = nxos_module.get_roles(username)
172                     self.assertEqual(result.sort(), expected_result.sort())
173     def test_get_roles_user_configured_no_role(self):
174         username = "salt_test"
175         with patch("salt.modules.nxos.get_user", return_value=username, autospec=True):
176             with patch("salt.modules.nxos.show", return_value="", autospec=True):
177                 result = nxos_module.get_roles(username)
178                 self.assertEqual(result, [])
179     def test_get_user_configured(self):
180         username = "salt_test"
181         expected_output = n9k_show_running_inc_username_list[0]
182         for rv in [
183             n9k_show_running_inc_username_list[0],
184             n9k_show_running_inc_username_list,
185         ]:
186             with patch("salt.modules.nxos.show", return_value=rv, autospec=True):
187                 result = nxos_module.get_user(username)
188                 self.assertEqual(result, expected_output)
189     def test_grains(self):
190         nxos_module.DEVICE_DETAILS["grains_cache"] = {}
191         expected_grains = {
192             "software": {
193                 "BIOS": "version 08.36",
194                 "NXOS": "version 9.2(1)",
195                 "BIOS compile time": "06/07/2019",
196                 "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
197                 "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
198             },
199             "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
200             "plugins": ["Core Plugin", "Ethernet Plugin"],
201         }
202         with patch.dict(
203             nxos_module.__salt__,
204             {
205                 "utils.nxos.system_info": create_autospec(
206                     nxos_utils.system_info, return_value=n9k_grains
207                 )
208             },
209         ):
210             with patch(
211                 "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
212             ):
213                 result = nxos_module.grains()
214                 self.assertEqual(result, expected_grains)
215     def test_grains_get_cache(self):
216         expected_grains = {
217             "software": {
218                 "BIOS": "version 08.36",
219                 "NXOS": "version 9.2(1)",
220                 "BIOS compile time": "06/07/2019",
221                 "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
222                 "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
223             },
224             "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
225             "plugins": ["Core Plugin", "Ethernet Plugin"],
226         }
227         nxos_module.DEVICE_DETAILS["grains_cache"] = expected_grains
228         with patch.dict(
229             nxos_module.__salt__,
230             {
231                 "utils.nxos.system_info": create_autospec(
232                     nxos_utils.system_info, return_value=n9k_grains
233                 )
234             },
235         ):
236             with patch(
237                 "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
238             ):
239                 result = nxos_module.grains()
240                 self.assertEqual(result, expected_grains)
241     def test_grains_refresh(self):
242         expected_grains = {
243             "software": {
244                 "BIOS": "version 08.36",
245                 "NXOS": "version 9.2(1)",
246                 "BIOS compile time": "06/07/2019",
247                 "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
248                 "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
249             },
250             "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
251             "plugins": ["Core Plugin", "Ethernet Plugin"],
252         }
253         with patch(
254             "salt.modules.nxos.grains", return_value=expected_grains, autospec=True
255         ):
256             result = nxos_module.grains_refresh()
257             self.assertEqual(result, expected_grains)
258     def test_system_info(self):
259         expected_grains = {
260             "software": {
261                 "BIOS": "version 08.36",
262                 "NXOS": "version 9.2(1)",
263                 "BIOS compile time": "06/07/2019",
264                 "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
265                 "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
266             },
267             "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
268             "plugins": ["Core Plugin", "Ethernet Plugin"],
269         }
270         with patch.dict(
271             nxos_module.__salt__,
272             {
273                 "utils.nxos.system_info": create_autospec(
274                     nxos_utils.system_info, return_value=n9k_grains
275                 )
276             },
277         ):
278             with patch(
279                 "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
280             ):
281                 result = nxos_module.system_info()
282                 self.assertEqual(result, expected_grains)
283     def test_sendline_invalid_method(self):
284         command = "show version"
285         method = "invalid"
286         result = nxos_module.sendline(command, method)
287         self.assertIn("INPUT ERROR", result)
288     def test_sendline_valid_method_proxy(self):
289         command = "show version"
290         with patch("salt.utils.platform.is_proxy", return_value=True, autospec=True):
291             <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
292                 nxos_module.__proxy__,
293                 {"nxos.sendline": MagicMock(return_value=n9k_show_ver)},
294             ):
295                 result = nxos_module.sendline(command, method)
296                 self.assertIn(</b></font>n9k_show_ver, result)
297     def test_sendline_valid_method_nxapi_uds(self):
298         command = "show version"
299         method = "cli_show_ascii"
300         with patch("salt.utils.platform.is_proxy", MagicMock(return_value=False)):
301             with patch(
302                 "salt.modules.nxos._nxapi_request",
303                 return_value=n9k_show_ver,
304                 autospec=True,
305             ):
306                 result = nxos_module.sendline(command, method)
307                 self.assertIn(n9k_show_ver, result)
308     def test_show_raw_text_invalid(self):
309         command = "show version"
310         raw_text = "invalid"
311         result = nxos_module.show(command, raw_text)
312         self.assertIn("INPUT ERROR", result)
313     def test_show_raw_text_true(self):
314         command = "show version"
315         raw_text = True
316         with patch(
317             "salt.modules.nxos.sendline", autospec=True, return_value=n9k_show_ver
318         ):
319             result = nxos_module.show(command, raw_text)
320             self.assertEqual(result, n9k_show_ver)
321     def test_show_raw_text_true_multiple_commands(self):
322         command = "show bgp sessions ; show processes"
323         raw_text = True
324         data = ["bgp_session_data", "process_data"]
325         with patch("salt.modules.nxos.sendline", autospec=True, return_value=data):
326             result = nxos_module.show(command, raw_text)
327             self.assertEqual(result, data)
328     def test_show_nxapi(self):
329         command = "show version; show interface eth1/1"
330         raw_text = True
331         with patch(
332             "salt.modules.nxos.sendline",
333             autospec=True,
334             return_value=n9k_show_ver_int_list,
335         ):
336             result = nxos_module.show(command, raw_text)
337             self.assertEqual(result[0], n9k_show_ver_int_list[0])
338             self.assertEqual(result[1], n9k_show_ver_int_list[1])
339     def test_show_nxapi_structured(self):
340         command = "show version; show interface eth1/1"
341         raw_text = False
342         with patch(
343             "salt.modules.nxos.sendline",
344             autospec=True,
345             return_value=n9k_show_ver_int_list_structured,
346         ):
347             result = nxos_module.show(command, raw_text)
348             self.assertEqual(result[0], n9k_show_ver_int_list_structured[0])
349             self.assertEqual(result[1], n9k_show_ver_int_list_structured[1])
350     def test_show_run(self):
351         expected_output = n9k_show_running_config_list[0]
352         for rv in [n9k_show_running_config_list[0], n9k_show_running_config_list]:
353             with patch("salt.modules.nxos.show", autospec=True, return_value=rv):
354                 result = nxos_module.show_run()
355                 self.assertEqual(result, expected_output)
356     def test_show_ver(self):
357         expected_output = n9k_show_ver_list[0]
358         for rv in [n9k_show_ver_list[0], n9k_show_ver_list]:
359             with patch("salt.modules.nxos.show", autospec=True, return_value=rv):
360                 result = nxos_module.show_ver()
361                 self.assertEqual(result, expected_output)
362     def test_add_config(self):
363         expected_output = "COMMAND_LIST: feature bgp"
364         with patch(
365             "salt.modules.nxos.config", autospec=True, return_value=expected_output
366         ):
367             result = nxos_module.add_config("feature bgp")
368             self.assertEqual(result, expected_output)
369     def test_config_commands(self):
370         commands = ["no feature ospf", ["no feature ospf"]]
371         expected_output = (
372             "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
373             " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
374             " pim\n feature lldp\n \n"
375         )
376         for cmd_set in commands:
377             with patch(
378                 "salt.modules.nxos.show",
379                 autospec=True,
380                 side_effect=[initial_config, modified_config],
381             ):
382                 mock_cmd = create_autospec(
383                     file_module.apply_template_on_contents,
384                     return_value=template_engine_file_str,
385                 )
386                 with patch.dict(
387                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
388                 ):
389                     with patch(
390                         "salt.modules.nxos._configure_device",
391                         autospec=True,
392                         return_value=config_result,
393                     ):
394                         result = nxos_module.config(cmd_set, save_config=False)
395                         self.assertEqual(result, expected_output)
396     def test_config_commands_template_none(self):
397         commands = ["no feature ospf", ["no feature ospf"]]
398         expected_output = (
399             "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
400             " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
401             " pim\n feature lldp\n \n"
402         )
403         for cmd_set in commands:
404             with patch(
405                 "salt.modules.nxos.show",
406                 autospec=True,
407                 side_effect=[initial_config, modified_config],
408             ):
409                 mock_cmd = create_autospec(
410                     file_module.apply_template_on_contents,
411                     return_value=template_engine_file_str,
412                 )
413                 with patch.dict(
414                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
415                 ):
416                     with patch(
417                         "salt.modules.nxos._configure_device",
418                         autospec=True,
419                         return_value=config_result,
420                     ):
421                         result = nxos_module.config(cmd_set, template_engine=None)
422                         self.assertEqual(result, expected_output)
423     def test_config_commands_string(self):
424         commands = "no feature ospf"
425         expected_output = (
426             "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
427             " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
428             " pim\n feature lldp\n \n"
429         )
430         with patch(
431             "salt.modules.nxos.show",
432             autospec=True,
433             side_effect=[initial_config[0], modified_config[0]],
434         ):
435             mock_cmd = create_autospec(
436                 file_module.apply_template_on_contents,
437                 return_value=template_engine_file_str,
438             )
439             with patch.dict(
440                 nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
441             ):
442                 with patch(
443                     "salt.modules.nxos._configure_device",
444                     autospec=True,
445                     return_value=config_result,
446                 ):
447                     result = nxos_module.config(commands)
448                     self.assertEqual(result, expected_output)
449     def test_config_file(self):
450         config_file = "salt://bgp_config.txt"
451         expected_output = (
452             "COMMAND_LIST: feature bgp ; ! ; router bgp 55 ; address-family ipv4"
453             " unicast ; no client-to-client reflection ; additional-paths send\n\n---"
454             " \n+++ \n@@ -19,6 +19,7 @@\n feature bash-shell\n cfs eth distribute\n"
455             " feature ngmvpn\n+feature bgp\n feature pim\n feature lldp\n \n@@ -233,6"
456             " +234,10 @@\n line console\n line vty\n boot nxos"
457             " bootflash:/nxos.9.2.4.bin \n+router bgp 55\n+  address-family ipv4"
458             " unicast\n+    no client-to-client reflection\n+    additional-paths"
459             " send\n \n no logging logfile\n no logging monitor\n"
460         )
461         with patch(
462             "salt.modules.nxos.show",
463             autospec=True,
464             side_effect=[initial_config_file, modified_config_file],
465         ):
466             mock_cmd = create_autospec(
467                 cp_module.get_file_str, return_value=config_input_file
468             )
469             with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
470                 mock_cmd = create_autospec(
471                     file_module.apply_template_on_contents,
472                     return_value=template_engine_file_str_file,
473                 )
474                 with patch.dict(
475                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
476                 ):
477                     with patch(
478                         "salt.modules.nxos._configure_device",
479                         autospec=True,
480                         return_value=config_result_file,
481                     ):
482                         result = nxos_module.config(config_file=config_file)
483                         self.assertEqual(result, expected_output)
484     def test_config_file_error1(self):
485         config_file = "salt://bgp_config.txt"
486         with patch(
487             "salt.modules.nxos.show",
488             autospec=True,
489             side_effect=[initial_config_file, modified_config_file],
490         ):
491             mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
492             with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
493                 mock_cmd = create_autospec(
494                     file_module.apply_template_on_contents,
495                     return_value=template_engine_file_str_file,
496                 )
497                 with patch.dict(
498                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
499                 ):
500                     with patch(
501                         "salt.modules.nxos._configure_device",
502                         autospec=True,
503                         return_value=config_result_file,
504                     ):
505                         with self.assertRaises(CommandExecutionError):
506                             nxos_module.config(config_file=config_file)
507     def test_config_nxos_error_ssh(self):
508         commands = ["feature bgp", "router bgp 57"]
509         config_result = [
510             ["feature bgp", "router bgp 57"],
511             "bgp instance is already running; Tag is 55",
512         ]
513         expected_output = (
514             "COMMAND_LIST: feature bgp ; router bgp 57\nbgp instance is already"
515             " running; Tag is 55\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature bash-shell\n"
516             " cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature pim\n"
517             " feature lldp\n \n"
518         )
519         with patch(
520             "salt.modules.nxos.show",
521             autospec=True,
522             side_effect=[initial_config[0], modified_config[0]],
523         ):
524             mock_cmd = create_autospec(
525                 file_module.apply_template_on_contents,
526                 return_value=template_engine_file_str,
527             )
528             with patch.dict(
529                 nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
530             ):
531                 with patch(
532                     "salt.modules.nxos._configure_device",
533                     autospec=True,
534                     return_value=config_result,
535                 ):
536                     result = nxos_module.config(commands)
537                     self.assertEqual(result, expected_output)
538     def test_commands_error(self):
539         commands = None
540         with patch(
541             "salt.modules.nxos.show",
542             autospec=True,
543             side_effect=[initial_config_file, modified_config_file],
544         ):
545             mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
546             with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
547                 mock_cmd = create_autospec(
548                     file_module.apply_template_on_contents,
549                     return_value=template_engine_file_str_file,
550                 )
551                 with patch.dict(
552                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
553                 ):
554                     with patch(
555                         "salt.modules.nxos._configure_device",
556                         autospec=True,
557                         return_value=config_result_file,
558                     ):
559                         with self.assertRaises(CommandExecutionError):
560                             nxos_module.config(commands=commands)
561     def test_config_file_error2(self):
562         config_file = None
563         with patch(
564             "salt.modules.nxos.show",
565             autospec=True,
566             side_effect=[initial_config_file, modified_config_file],
567         ):
568             mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
569             with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
570                 mock_cmd = create_autospec(
571                     file_module.apply_template_on_contents,
572                     return_value=template_engine_file_str_file,
573                 )
574                 with patch.dict(
575                     nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
576                 ):
577                     with patch(
578                         "salt.modules.nxos._configure_device",
579                         autospec=True,
580                         return_value=config_result_file,
581                     ):
582                         with self.assertRaises(CommandExecutionError):
583                             nxos_module.config(config_file=config_file)
584     def test_delete_config(self):
585         for lines in ["feature bgp", ["feature bgp"]]:
586             with patch("salt.modules.nxos.config", autospec=True):
587                 result = nxos_module.delete_config(lines)
588                 nxos_module.config.assert_called_with(["no feature bgp"])
589                 self.assertEqual(result, nxos_module.config.return_value)
590     def test_remove_user(self):
591         with patch("salt.modules.nxos.config", autospec=True):
592             result = nxos_module.remove_user("salt_test")
593             nxos_module.config.assert_called_with("no username salt_test")
594             self.assertEqual(result, nxos_module.config.return_value)
595     def test_replace(self):
596         old_value = "feature bgp"
597         new_value = "feature ospf"
598         with patch(
599             "salt.modules.nxos.show_run",
600             autospec=True,
601             return_value=n9k_show_running_config_list[0],
602         ):
603             with patch(
604                 "salt.modules.nxos.delete_config", autospec=True, return_value=None
605             ):
606                 with patch(
607                     "salt.modules.nxos.add_config", autospec=True, return_value=None
608                 ):
609                     result = nxos_module.replace(old_value, new_value)
610                     self.assertEqual(result["old"], ["feature bgp"])
611                     self.assertEqual(result["new"], ["feature ospf"])
612     def test_replace_full_match_true(self):
613         old_value = "feature bgp"
614         new_value = "feature ospf"
615         with patch(
616             "salt.modules.nxos.show_run",
617             autospec=True,
618             return_value=n9k_show_running_config_list[0],
619         ):
620             with patch(
621                 "salt.modules.nxos.delete_config", autospec=True, return_value=None
622             ):
623                 with patch(
624                     "salt.modules.nxos.add_config", autospec=True, return_value=None
625                 ):
626                     result = nxos_module.replace(old_value, new_value, full_match=True)
627                     self.assertEqual(result["old"], ["feature bgp"])
628                     self.assertEqual(result["new"], ["feature ospf"])
629     def test_replace_no_match(self):
630         old_value = "feature does_not_exist"
631         new_value = "feature ospf"
632         with patch(
633             "salt.modules.nxos.show_run",
634             autospec=True,
635             return_value=n9k_show_running_config_list[0],
636         ):
637             with patch(
638                 "salt.modules.nxos.delete_config", autospec=True, return_value=None
639             ):
640                 with patch(
641                     "salt.modules.nxos.add_config", autospec=True, return_value=None
642                 ):
643                     result = nxos_module.replace(old_value, new_value)
644                     self.assertEqual(result["old"], [])
645                     self.assertEqual(result["new"], [])
646     def test_save_running_config(self):
647         with patch(
648             "salt.modules.nxos.config", autospec=True, return_value=save_running_config
649         ):
650             result = nxos_module.save_running_config()
651             self.assertEqual(result, save_running_config)
652     def test_set_password_enc_false_cs_none(self):
653         username = "devops"
654         password = "test123TMM^&amp;"
655         hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
656         config_line = (
657             "username devops password 5"
658             " $5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
659         )
660         with patch("salt.modules.nxos.get_user", autospec=True):
661             with patch(
662                 "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
663             ):
664                 with patch(
665                     "salt.modules.nxos.config",
666                     autospec=True,
667                     return_value="password_set",
668                 ) as config:
669                     result = nxos_module.set_password(username, password)
670                     config.assert_called_with(config_line)
671                     self.assertEqual("password_set", result)
672     def test_set_password_enc_false_cs_set(self):
673         username = "devops"
674         password = "test123TMM^&amp;"
675         crypt_salt = "ZcZqm15X"
676         hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
677         config_line = (
678             "username devops password 5"
679             " $5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
680         )
681         with patch("salt.modules.nxos.get_user", autospec=True):
682             with patch(
683                 "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
684             ):
685                 with patch(
686                     "salt.modules.nxos.config",
687                     autospec=True,
688                     return_value="password_set",
689                 ) as config:
690                     result = nxos_module.set_password(
691                         username, password, crypt_salt=crypt_salt
692                     )
693                     config.assert_called_with(config_line)
694                     self.assertEqual("password_set", result)
695     def test_set_password_enc_true(self):
696         username = "devops"
697         password = "test123TMM^&amp;"
698         hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
699         config_line = "username devops password 5 test123TMM^&amp;"
700         with patch("salt.modules.nxos.get_user", autospec=True):
701             with patch(
702                 "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
703             ):
704                 with patch(
705                     "salt.modules.nxos.config",
706                     autospec=True,
707                     return_value="password_set",
708                 ) as config:
709                     result = nxos_module.set_password(
710                         username, password, encrypted=True
711                     )
712                     config.assert_called_with(config_line)
713                     self.assertEqual("password_set", result)
714     def test_set_password_role_none(self):
715         username = "devops"
716         password = "test123TMM^&amp;"
717         hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
718         config_line = "username devops password 5 test123TMM^&amp; role devops"
719         with patch("salt.modules.nxos.get_user", autospec=True):
720             with patch(
721                 "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
722             ):
723                 with patch(
724                     "salt.modules.nxos.config",
725                     autospec=True,
726                     return_value="password_set",
727                 ) as config:
728                         username, password, encrypted=True, role="devops"
729                     )
730                     config<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assert_called_with(config_line)
731                     self.assertEqual("password_set", result)
732     def test_set_password_blowfish_crypt(self):
733         with self.assertRaises(SaltInvocationError):
734             nxos_module.</b></font>set_password(
735                 "username", "password", encrypted=True, algorithm="blowfish"
736             )
737     def test_set_role(self):
738         username = "salt_test"
739         role = "vdc-admin"
740         with patch("salt.modules.nxos.config", autospec=True, return_value=set_role):
741             result = nxos_module.set_role(username, role)
742             self.assertEqual(result, set_role)
743     def test_unset_role(self):
744         username = "salt_test"
745         role = "vdc-admin"
746         with patch("salt.modules.nxos.config", autospec=True, return_value=unset_role):
747             result = nxos_module.unset_role(username, role)
748             self.assertEqual(result, unset_role)
749     def test_configure_device(self):
750         with patch("salt.utils.platform.is_proxy", autospec=True, return_value=True):
751             <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
752                 nxos_module.__proxy__,
753                 {"nxos.proxy_config": MagicMock(return_value="configured")},
754             ):
755                 result = nxos_module._configure_device("feature bgp")
756                 self.assertEqual(</b></font>result, "configured")
757         with patch("salt.utils.platform.is_proxy", autospec=True, return_value=False):
758             with patch.object(
759                 nxos_module, "_nxapi_config", MagicMock(return_value="configured")
760             ):
761                 nxos_module._configure_device("feature bgp")
762                 self.assertEqual(result, "configured")
763     def test_nxapi_config(self):
764         mock_cmd = MagicMock(return_value={"nxos": {"save_config": False}})
765         with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
766                 "salt.modules.nxos._nxapi_request",
767                 return_value="router_data",
768                 autospec<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=True,
769             ):
770                 result = nxos_module._nxapi_config("show version")
771                 self.assertEqual(result, [["show version"], "router_data"])
772     def test_nxapi_config_failure(self):
773         side_effect = ["Failure"</b></font>, "saved_data"]
774         mock_cmd = MagicMock(return_value={"nxos": {"save_config": True}})
775         with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
776             with patch(
777                 "salt.modules.nxos._nxapi_request",
778                 side_effect=side_effect,
779                 autospec=True,
780             ):
781                 result = nxos_module._nxapi_config("show bad_command")
782                 self.assertEqual(result, [["show bad_command"], "Failure"])
783     def test_nxapi_request_proxy(self):
784         with patch("salt.utils.platform.is_proxy", autospec=True, return_value=True):
785             mock_request = create_autospec(
786                 nxos_utils.nxapi_request, return_value="router_data"
787             )
788             with patch.dict(
789                 nxos_module.__proxy__, {"nxos._nxapi_request": mock_request}
790             ):
791                 result = nxos_module._nxapi_request("show version")
792                 self.assertEqual(result, "router_data")
793     def test_nxapi_request_no_proxy(self):
794         with patch("salt.utils.platform.is_proxy", autospec=True, return_value=False):
795             mock_cmd = MagicMock(return_value={"nxos": {"save_config": False}})
796             with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
797                 mock_request = create_autospec(nxos_utils.nxapi_request)
798                 with patch.dict(
799                     nxos_module.__utils__, {"nxos.nxapi_request": mock_request}
800                 ):
801                     result = nxos_module._nxapi_request("show version")
802                     self.assertEqual(result, mock_request.return_value)
803                     mock_request.assert_called_with(
804                         "show version", "cli_conf", **mock_cmd.return_value
805                     )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
