<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for test_status_2.py &amp; test_nxos_1.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for test_status_2.py &amp; test_nxos_1.py
      </h3>
<h1 align="center">
        7.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>test_status_2.py (12.914485%)<th>test_nxos_1.py (5.5472264%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(247-253)<td><a href="#" name="0">(1050-1059)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(154-162)<td><a href="#" name="1">(988-996)</a><td align="center"><font color="#ff0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(366-370)<td><a href="#" name="2">(1027-1032)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(354-358)<td><a href="#" name="3">(415-420)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(294-298)<td><a href="#" name="4">(80-84)</a><td align="center"><font color="#eb0000">12</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(258-262)<td><a href="#" name="5">(69-73)</a><td align="center"><font color="#eb0000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_status_2.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import os
import salt.modules.status as status
import salt.utils.platform
from salt.exceptions import CommandExecutionError
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, mock_open, patch
from tests.support.unit import TestCase
class StatusTestCase(TestCase, LoaderModuleMockMixin):
    def setup_loader_modules(self):
        return {status: {}}
    def _set_up_test_uptime(self):
        class MockData:
        m = MockData()
        m.now = 1477004312
        m.ut = 1540154.00
        m.idle = 3047777.32
        m.ret = {
            "users": 3,
            "seconds": 1540154,
            "since_t": 1475464158,
            "days": 17,
            "since_iso": "2016-10-03T03:09:18",
            "time": "19:49",
        }
        return m
    def _set_up_test_uptime_sunos(self):
        class MockData:
        m = MockData()
        m.ret = {
            "retcode": 0,
            "stdout": "unix:0:system_misc:boot_time    1475464158",
        }
        return m
    def test_uptime_linux(self):
        m = self._set_up_test_uptime()
        with patch.multiple(
            salt.utils.platform,
            is_linux=MagicMock(return_value=True),
            is_sunos=MagicMock(return_value=False),
            is_darwin=MagicMock(return_value=False),
            is_freebsd=MagicMock(return_value=False),
            is_openbsd=MagicMock(return_value=False),
            is_netbsd=MagicMock(return_value=False),
        ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
            status.__salt__,
            {"cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"]))},
        ), patch(
            "time.time", MagicMock(return_value=m.now)
        ), patch(
            "os.path.exists", MagicMock(return_value=True)
        ):
            proc_uptime = salt.utils.stringutils.to_str("{} {}".format(m.ut, m.idle))
            with patch("salt.utils.files.fopen", mock_open(read_data=proc_uptime)):
                ret = status.uptime()
                self.assertDictEqual(ret, m.ret)
            with patch("os.path.exists", MagicMock(return_value=False)):
                with self.assertRaises(CommandExecutionError):
                    status.uptime()
    def test_uptime_sunos(self):
        m = self._set_up_test_uptime()
        m2 = self._set_up_test_uptime_sunos()
        with patch.multiple(
            salt.utils.platform,
            is_linux=MagicMock(return_value=False),
            is_sunos=MagicMock(return_value=True),
            is_darwin=MagicMock(return_value=False),
            is_freebsd=MagicMock(return_value=False),
            is_openbsd=MagicMock(return_value=False),
            is_netbsd=MagicMock(return_value=False),
        ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
            status.__salt__,
            {
                "cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"])),
                "cmd.run_all": MagicMock(return_value=m2.ret),
            },
        ), patch(
            "time.time", MagicMock(return_value=m.now)
        ):
            ret = status.uptime()
            self.assertDictEqual(ret, m.ret)
    def test_uptime_macos(self):
        m = self._set_up_test_uptime()
        kern_boottime = (
            "{{ sec = {0}, usec = {1:0&lt;6} }} Mon Oct 03 03:09:18.23 2016".format(
                *str(m.now - m.ut).split(".")
            )
        )
        with patch.multiple(
            salt.utils.platform,
            is_linux=MagicMock(return_value=False),
            is_sunos=MagicMock(return_value=False),
            is_darwin=MagicMock(return_value=True),
            is_freebsd=MagicMock(return_value=False),
            is_openbsd=MagicMock(return_value=False),
            is_netbsd=MagicMock(return_value=False),
        ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
            status.__salt__,
            {
                "cmd.run": MagicMock(return_value=os.linesep.join(["1", "2", "3"])),
                "sysctl.get": MagicMock(return_value=kern_boottime),
            },
        ), patch(
            "time.time", MagicMock(return_value=m.now)
        ):
            ret = status.uptime()
            self.assertDictEqual(ret, m.ret)
<a name="1"></a>            with patch.dict(
                status.__salt__, {"sysctl.get": MagicMock(return_value="")}
            ):
                with self<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>.assertRaises(CommandExecutionError):
                    status.uptime()
    def test_uptime_return_success_not_supported(self):
        with patch.multiple(
            salt.</b></font>utils.platform,
            is_linux=MagicMock(return_value=False),
            is_sunos=MagicMock(return_value=False),
            is_darwin=MagicMock(return_value=False),
            is_freebsd=MagicMock(return_value=False),
            is_openbsd=MagicMock(return_value=False),
            is_netbsd=MagicMock(return_value=False),
        ):
            exc_mock = MagicMock(side_effect=CommandExecutionError)
            with self.assertRaises(CommandExecutionError):
                with patch.dict(status.__salt__, {"cmd.run": exc_mock}):
                    status.uptime()
    def _set_up_test_cpustats_openbsd(self):
        class MockData:
        m = MockData()
        m.ret = {
            "0": {
                "User": "0.0%",
                "Nice": "0.0%",
                "System": "4.5%",
                "Interrupt": "0.5%",
                "Idle": "95.0%",
            }
        }
        return m
    def test_cpustats_openbsd(self):
        m = self._set_up_test_cpustats_openbsd()
        systat = (
            "\n\n   1 users Load 0.20 0.07 0.05                        salt.localdomain"
            " 09:42:42\nCPU                User           Nice        System    "
            " Interrupt          Idle\n0                  0.0%           0.0%         "
            " 4.5%          0.5%         95.0%\n"
        )
        with patch.multiple(
            salt.utils.platform,
            is_linux=MagicMock(return_value=False),
            is_sunos=MagicMock(return_value=False),
            is_darwin=MagicMock(return_value=False),
            is_freebsd=MagicMock(return_value=False),
            is_openbsd=MagicMock(return_value=True),
            is_netbsd=MagicMock(return_value=False),
        ), patch("salt.utils.path.which", MagicMock(return_value=True)), patch.dict(
            status.__grains__, {"kernel": "OpenBSD"}
        ), patch.dict(
            status.__salt__, {"cmd.run": MagicMock(return_value=systat)}
        ):
            ret = status.cpustats()
            self.assertDictEqual(ret, m.ret)
    def _set_up_test_cpuinfo_bsd(self):
        class MockData:
        m = MockData()
        m.ret = {
            "hw.model": "Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz",
            "hw.ncpu": "4",
        }
        return m
    def test_cpuinfo_freebsd(self):
        m = self._set_up_test_cpuinfo_bsd()
        sysctl = "hw.model:Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz\nhw.ncpu:4"
<a name="0"></a>
        with patch.dict(status.__grains__, {"kernel": "FreeBSD"}):
            with patch.dict(
                status.__salt__, {"cmd.run": MagicMock(return_value<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>=sysctl)}
            ):
                ret = status.cpuinfo()
                self.assertDictEqual(ret, m.ret)
    def test_cpuinfo_openbsd(self):
        m = self.</b></font>_set_up_test_cpuinfo_bsd()
        sysctl = "hw.model=Intel(R) Core(TM) i5-7287U CPU @ 3.30GHz\nhw.ncpu=4"
<a name="5"></a>
        for bsd in ["NetBSD", "OpenBSD"]:
            with patch.dict(status.__grains__, {"kernel": bsd}):
                <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
                    status.__salt__, {"cmd.run": MagicMock(return_value=sysctl)}
                ):
                    ret = status.cpuinfo()
                    self.assertDictEqual(</b></font>ret, m.ret)
    def _set_up_test_meminfo_openbsd(self):
        class MockData:
        m = MockData()
        m.ret = {
            "active virtual pages": "355M",
            "free list size": "305M",
            "page faults": "845",
            "pages reclaimed": "1",
            "pages paged in": "2",
            "pages paged out": "3",
            "pages freed": "4",
            "pages scanned": "5",
        }
        return m
    def test_meminfo_openbsd(self):
        m = self._set_up_test_meminfo_openbsd()
        vmstat = (
            " procs    memory       page                    disks    traps         "
            " cpu\n r   s   avm     fre  flt  re  pi  po  fr  sr cd0 sd0  int   sys  "
            " cs us sy id\n 2 103  355M    305M  845   1   2   3   4   5   0   1   21  "
            " 682   86  1  1 98"
<a name="4"></a>        )
        with patch.dict(status.__grains__, {"kernel": "OpenBSD"}):
            <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
                status.__salt__, {"cmd.run": MagicMock(return_value=vmstat)}
            ):
                ret = status.meminfo()
                self.assertDictEqual(</b></font>ret, m.ret)
    def _set_up_test_w_linux(self):
        class MockData:
        m = MockData()
        m.ret = [
            {
                "idle": "0s",
                "jcpu": "0.24s",
                "login": "13:42",
                "pcpu": "0.16s",
                "tty": "pts/1",
                "user": "root",
                "what": "nmap -sV 10.2.2.2",
            }
        ]
        return m
    def _set_up_test_w_bsd(self):
        class MockData:
        m = MockData()
        m.ret = [
            {
                "idle": "0",
                "from": "10.2.2.1",
                "login": "1:42PM",
                "tty": "p1",
                "user": "root",
                "what": "nmap -sV 10.2.2.2",
            }
        ]
        return m
    def test_w_linux(self):
        m = self._set_up_test_w_linux()
<a name="3"></a>        w_output = "root   pts/1  13:42    0s  0.24s  0.16s nmap -sV 10.2.2.2"
        with patch.dict(status.__grains__, {"kernel": "Linux"}):
            <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
                status.__salt__, {"cmd.run": MagicMock(return_value=w_output)}
            ):
                ret = status.w()
                self.assertListEqual(</b></font>ret, m.ret)
    def test_w_bsd(self):
        m = self._set_up_test_w_bsd()
        w_output = "root   p1 10.2.2.1    1:42PM  0 nmap -sV 10.2.2.2"
<a name="2"></a>
        for bsd in ["Darwin", "FreeBSD", "OpenBSD"]:
            with patch.dict(status.__grains__, {"kernel": bsd}):
                <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>with patch.dict(
                    status.__salt__, {"cmd.run": MagicMock(return_value=w_output)}
                ):
                    ret = status.w()
                    self.assertListEqual(</b></font>ret, m.ret)
    def _set_up_test_status_pid_linux(self):
        class MockData:
        m = MockData()
        m.ret = "2701\n7539\n7540\n7542\n7623"
        return m
    def test_status_pid_linux(self):
        m = self._set_up_test_status_pid_linux()
        ps = (
            "UID      PID PPID  C STIME TTY      TIME CMD\nroot     360    2  0 Jun08 ?"
            "    00:00:00   [jbd2/dm-0-8]\nroot     947    2  0 Jun08 ?    00:00:00  "
            " [jbd2/dm-1-8]\nroot     949    2  0 Jun08 ?    00:00:09  "
            " [jbd2/dm-3-8]\nroot     951    2  0 Jun08 ?    00:00:00  "
            " [jbd2/dm-4-8]\nroot    2701    1  0 Jun08 ?    00:00:28   /usr/sbin/httpd"
            " -k start\napache  7539 2701  0 04:40 ?    00:00:04     /usr/sbin/httpd -k"
            " start\napache  7540 2701  0 04:40 ?    00:00:02     /usr/sbin/httpd -k"
            " start\napache  7542 2701  0 04:40 ?    00:01:46     /usr/sbin/httpd -k"
            " start\napache  7623 2701  0 04:40 ?    00:02:41     /usr/sbin/httpd -k"
            " start\nroot    1564    1  0 Jun11 ?    00:07:19   /usr/bin/python3"
            " /usr/bin/salt-minion -d\nroot    6674 1564  0 19:53 ?    00:00:00    "
            " /usr/bin/python3 /usr/bin/salt-call status.pid httpd -l debug"
        )
        with patch.dict(status.__grains__, {"ps": "ps -efHww"}):
            with patch.dict(
                status.__salt__, {"cmd.run_stdout": MagicMock(return_value=ps)}
            ):
                with patch.object(os, "getpid", return_value="6674"):
                    ret = status.pid("httpd")
                    self.assertEqual(ret, m.ret)
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>test_nxos_1.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
import salt.modules.cp as cp_module
import salt.modules.file as file_module
import salt.modules.nxos as nxos_module
import salt.utils.nxos as nxos_utils
import salt.utils.pycrypto
from salt.exceptions import CommandExecutionError, SaltInvocationError
from tests.support.mixins import LoaderModuleMockMixin
from tests.support.mock import MagicMock, create_autospec, patch
from tests.support.unit import TestCase, skipIf
from tests.unit.modules.nxos.nxos_config import (
    config_input_file,
    config_result,
    config_result_file,
    initial_config,
    initial_config_file,
    modified_config,
    modified_config_file,
    save_running_config,
    set_role,
    template_engine_file_str,
    template_engine_file_str_file,
    unset_role,
)
from tests.unit.modules.nxos.nxos_grains import n9k_grains
from tests.unit.modules.nxos.nxos_show_cmd_output import (
    n9k_get_user_output,
    n9k_show_user_account,
    n9k_show_user_account_list,
    n9k_show_ver,
    n9k_show_ver_int_list,
    n9k_show_ver_int_list_structured,
    n9k_show_ver_list,
)
from tests.unit.modules.nxos.nxos_show_run import (
    n9k_running_config,
    n9k_show_running_config_list,
    n9k_show_running_inc_username_list,
)
class NxosTestCase(TestCase, LoaderModuleMockMixin):
    COPY_RS = "copy running-config startup-config"
    def setup_loader_modules(self):
        sendline = create_autospec(
            nxos_module.sendline, autospec=True, return_value={"command": "fake_output"}
        )
        return {nxos_module: {"__proxy__": {"nxos.sendline": sendline}}}
    @staticmethod
    def test_check_virtual():
        result = nxos_module.__virtual__()
        assert "nxos" in result
    def test_ping_proxy(self):
<a name="5"></a>
        with patch("salt.utils.platform.is_proxy", return_value=True, autospec=True):
            <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
                nxos_module.__proxy__, {"nxos.ping": MagicMock(return_value=True)}
            ):
                result = nxos_module.ping()
                self.assertTrue(</b></font>result)
    def test_ping_native_minion(self):
<a name="4"></a>        """UT: nxos module:ping method - proxy"""
        with patch("salt.utils.platform.is_proxy", return_value=False, autospec=True):
            <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
                nxos_module.__utils__, {"nxos.ping": MagicMock(return_value=True)}
            ):
                result = nxos_module.ping()
                self.assertTrue(</b></font>result)
    def test_check_password_return_none(self):
        username = "admin"
        password = "foo"
        with patch("salt.modules.nxos.get_user", return_value=None, autospec=True):
            result = nxos_module.check_password(username, password, encrypted=False)
            self.assertIsNone(result)
    def test_check_password_password_nxos_comment(self):
        username = "admin"
        password = "foo"
        with patch("salt.modules.nxos.get_user", return_value="!", autospec=True):
            result = nxos_module.check_password(username, password, encrypted=False)
            self.assertFalse(result)
    @skipIf(
        "sha256" not in salt.utils.pycrypto.methods,
        "compatible crypt method for fake data not available",
    )
    def test_check_password_password_encrypted_false(self):
        username = "salt_test"
        password = "foobar123&amp;"
        with patch(
            "salt.modules.nxos.get_user",
            return_value=n9k_get_user_output,
            autospec=True,
        ):
            result = nxos_module.check_password(username, password, encrypted=False)
            self.assertTrue(result)
    def test_check_password_password_encrypted_true(self):
        username = "salt_test"
        password = "$5$mkXh6O4T$YUVtA89HbXCnue63kgghPlaqPHyaXhdtxPBbPEHhbRC"
        with patch(
            "salt.modules.nxos.get_user",
            return_value=n9k_get_user_output,
            autospec=True,
        ):
            result = nxos_module.check_password(username, password, encrypted=True)
            self.assertTrue(result)
    def test_check_password_password_encrypted_true_negative(self):
        username = "salt_test"
        password = "foobar123&amp;"
        with patch(
            "salt.modules.nxos.get_user", return_value=n9k_running_config, autospec=True
        ):
            result = nxos_module.check_password(username, password, encrypted=True)
            self.assertFalse(result)
    def test_check_role_true(self):
        username = "salt_test"
        roles = ["network-admin", "dev-ops"]
        with patch("salt.modules.nxos.get_roles", return_value=roles, autospec=True):
            result = nxos_module.check_role(username, "dev-ops")
            self.assertTrue(result)
    def test_check_role_false(self):
        username = "salt_test"
        roles = ["network-admin", "dev-ops"]
        with patch("salt.modules.nxos.get_roles", return_value=roles, autospec=True):
            result = nxos_module.check_role(username, "network-operator")
            self.assertFalse(result)
    def test_cmd_any_function(self):
        with patch.dict(
            nxos_module.__salt__,
            {
                "nxos.check_role": create_autospec(
                    nxos_module.check_role, return_value=True
                )
            },
        ):
            result = nxos_module.cmd(
                "check_role",
                "salt_test",
                "network-admin",
                encrypted=True,
                __pub_fun="nxos.cmd",
            )
            self.assertTrue(result)
    def test_cmd_function_absent(self):
        result = nxos_module.cmd(
            "cool_new_function", "salt_test", "network-admin", encrypted=True
        )
        self.assertFalse(result)
    def test_find_single_match(self):
        find_pattern = "^vrf context testing$"
        find_string = "vrf context testing"
        with patch(
            "salt.modules.nxos.show_run", return_value=n9k_running_config, autospec=True
        ):
            result = nxos_module.find(find_pattern)
            self.assertIn(find_string, result)
    def test_find_multiple_matches(self):
        find_pattern = "^no logging.*$"
        find_string = "no logging event link-status enable"
        with patch(
            "salt.modules.nxos.show_run", return_value=n9k_running_config, autospec=True
        ):
            result = nxos_module.find(find_pattern)
            self.assertIn(find_string, result)
            self.assertEqual(len(result), 7)
    def test_get_roles_user_not_configured(self):
        username = "salt_does_not_exist"
        user_info = ""
        with patch("salt.modules.nxos.get_user", return_value=user_info, autospec=True):
            result = nxos_module.get_roles(username)
            self.assertEqual(result, [])
    def test_get_roles_user_configured(self):
        username = "salt_test"
        expected_result = ["network-operator", "network-admin", "dev-ops"]
        with patch("salt.modules.nxos.get_user", return_value=username, autospec=True):
            for rv in [n9k_show_user_account, n9k_show_user_account_list]:
                with patch("salt.modules.nxos.show", return_value=rv, autospec=True):
                    result = nxos_module.get_roles(username)
                    self.assertEqual(result.sort(), expected_result.sort())
    def test_get_roles_user_configured_no_role(self):
        username = "salt_test"
        with patch("salt.modules.nxos.get_user", return_value=username, autospec=True):
            with patch("salt.modules.nxos.show", return_value="", autospec=True):
                result = nxos_module.get_roles(username)
                self.assertEqual(result, [])
    def test_get_user_configured(self):
        username = "salt_test"
        expected_output = n9k_show_running_inc_username_list[0]
        for rv in [
            n9k_show_running_inc_username_list[0],
            n9k_show_running_inc_username_list,
        ]:
            with patch("salt.modules.nxos.show", return_value=rv, autospec=True):
                result = nxos_module.get_user(username)
                self.assertEqual(result, expected_output)
    def test_grains(self):
        nxos_module.DEVICE_DETAILS["grains_cache"] = {}
        expected_grains = {
            "software": {
                "BIOS": "version 08.36",
                "NXOS": "version 9.2(1)",
                "BIOS compile time": "06/07/2019",
                "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
                "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
            },
            "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
            "plugins": ["Core Plugin", "Ethernet Plugin"],
        }
        with patch.dict(
            nxos_module.__salt__,
            {
                "utils.nxos.system_info": create_autospec(
                    nxos_utils.system_info, return_value=n9k_grains
                )
            },
        ):
            with patch(
                "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
            ):
                result = nxos_module.grains()
                self.assertEqual(result, expected_grains)
    def test_grains_get_cache(self):
        expected_grains = {
            "software": {
                "BIOS": "version 08.36",
                "NXOS": "version 9.2(1)",
                "BIOS compile time": "06/07/2019",
                "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
                "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
            },
            "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
            "plugins": ["Core Plugin", "Ethernet Plugin"],
        }
        nxos_module.DEVICE_DETAILS["grains_cache"] = expected_grains
        with patch.dict(
            nxos_module.__salt__,
            {
                "utils.nxos.system_info": create_autospec(
                    nxos_utils.system_info, return_value=n9k_grains
                )
            },
        ):
            with patch(
                "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
            ):
                result = nxos_module.grains()
                self.assertEqual(result, expected_grains)
    def test_grains_refresh(self):
        expected_grains = {
            "software": {
                "BIOS": "version 08.36",
                "NXOS": "version 9.2(1)",
                "BIOS compile time": "06/07/2019",
                "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
                "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
            },
            "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
            "plugins": ["Core Plugin", "Ethernet Plugin"],
        }
        with patch(
            "salt.modules.nxos.grains", return_value=expected_grains, autospec=True
        ):
            result = nxos_module.grains_refresh()
            self.assertEqual(result, expected_grains)
    def test_system_info(self):
        expected_grains = {
            "software": {
                "BIOS": "version 08.36",
                "NXOS": "version 9.2(1)",
                "BIOS compile time": "06/07/2019",
                "NXOS image file is": "bootflash:///nxos.9.2.1.bin",
                "NXOS compile time": "7/17/2018 16:00:00 [07/18/2018 00:21:19]",
            },
            "hardware": {"Device name": "n9k-device", "bootflash": "53298520 kB"},
            "plugins": ["Core Plugin", "Ethernet Plugin"],
        }
        with patch.dict(
            nxos_module.__salt__,
            {
                "utils.nxos.system_info": create_autospec(
                    nxos_utils.system_info, return_value=n9k_grains
                )
            },
        ):
            with patch(
                "salt.modules.nxos.show_ver", return_value=n9k_show_ver, autospec=True
            ):
                result = nxos_module.system_info()
                self.assertEqual(result, expected_grains)
    def test_sendline_invalid_method(self):
        command = "show version"
        method = "invalid"
        result = nxos_module.sendline(command, method)
        self.assertIn("INPUT ERROR", result)
    def test_sendline_valid_method_proxy(self):
        command = "show version"
<a name="3"></a>        method = "cli_show_ascii"
        with patch("salt.utils.platform.is_proxy", return_value=True, autospec=True):
            <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
                nxos_module.__proxy__,
                {"nxos.sendline": MagicMock(return_value=n9k_show_ver)},
            ):
                result = nxos_module.sendline(command, method)
                self.assertIn(</b></font>n9k_show_ver, result)
    def test_sendline_valid_method_nxapi_uds(self):
        command = "show version"
        method = "cli_show_ascii"
        with patch("salt.utils.platform.is_proxy", MagicMock(return_value=False)):
            with patch(
                "salt.modules.nxos._nxapi_request",
                return_value=n9k_show_ver,
                autospec=True,
            ):
                result = nxos_module.sendline(command, method)
                self.assertIn(n9k_show_ver, result)
    def test_show_raw_text_invalid(self):
        command = "show version"
        raw_text = "invalid"
        result = nxos_module.show(command, raw_text)
        self.assertIn("INPUT ERROR", result)
    def test_show_raw_text_true(self):
        command = "show version"
        raw_text = True
        with patch(
            "salt.modules.nxos.sendline", autospec=True, return_value=n9k_show_ver
        ):
            result = nxos_module.show(command, raw_text)
            self.assertEqual(result, n9k_show_ver)
    def test_show_raw_text_true_multiple_commands(self):
        command = "show bgp sessions ; show processes"
        raw_text = True
        data = ["bgp_session_data", "process_data"]
        with patch("salt.modules.nxos.sendline", autospec=True, return_value=data):
            result = nxos_module.show(command, raw_text)
            self.assertEqual(result, data)
    def test_show_nxapi(self):
        command = "show version; show interface eth1/1"
        raw_text = True
        with patch(
            "salt.modules.nxos.sendline",
            autospec=True,
            return_value=n9k_show_ver_int_list,
        ):
            result = nxos_module.show(command, raw_text)
            self.assertEqual(result[0], n9k_show_ver_int_list[0])
            self.assertEqual(result[1], n9k_show_ver_int_list[1])
    def test_show_nxapi_structured(self):
        command = "show version; show interface eth1/1"
        raw_text = False
        with patch(
            "salt.modules.nxos.sendline",
            autospec=True,
            return_value=n9k_show_ver_int_list_structured,
        ):
            result = nxos_module.show(command, raw_text)
            self.assertEqual(result[0], n9k_show_ver_int_list_structured[0])
            self.assertEqual(result[1], n9k_show_ver_int_list_structured[1])
    def test_show_run(self):
        expected_output = n9k_show_running_config_list[0]
        for rv in [n9k_show_running_config_list[0], n9k_show_running_config_list]:
            with patch("salt.modules.nxos.show", autospec=True, return_value=rv):
                result = nxos_module.show_run()
                self.assertEqual(result, expected_output)
    def test_show_ver(self):
        expected_output = n9k_show_ver_list[0]
        for rv in [n9k_show_ver_list[0], n9k_show_ver_list]:
            with patch("salt.modules.nxos.show", autospec=True, return_value=rv):
                result = nxos_module.show_ver()
                self.assertEqual(result, expected_output)
    def test_add_config(self):
        expected_output = "COMMAND_LIST: feature bgp"
        with patch(
            "salt.modules.nxos.config", autospec=True, return_value=expected_output
        ):
            result = nxos_module.add_config("feature bgp")
            self.assertEqual(result, expected_output)
    def test_config_commands(self):
        commands = ["no feature ospf", ["no feature ospf"]]
        expected_output = (
            "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
            " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
            " pim\n feature lldp\n \n"
        )
        for cmd_set in commands:
            with patch(
                "salt.modules.nxos.show",
                autospec=True,
                side_effect=[initial_config, modified_config],
            ):
                mock_cmd = create_autospec(
                    file_module.apply_template_on_contents,
                    return_value=template_engine_file_str,
                )
                with patch.dict(
                    nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
                ):
                    with patch(
                        "salt.modules.nxos._configure_device",
                        autospec=True,
                        return_value=config_result,
                    ):
                        result = nxos_module.config(cmd_set, save_config=False)
                        self.assertEqual(result, expected_output)
    def test_config_commands_template_none(self):
        commands = ["no feature ospf", ["no feature ospf"]]
        expected_output = (
            "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
            " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
            " pim\n feature lldp\n \n"
        )
        for cmd_set in commands:
            with patch(
                "salt.modules.nxos.show",
                autospec=True,
                side_effect=[initial_config, modified_config],
            ):
                mock_cmd = create_autospec(
                    file_module.apply_template_on_contents,
                    return_value=template_engine_file_str,
                )
                with patch.dict(
                    nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
                ):
                    with patch(
                        "salt.modules.nxos._configure_device",
                        autospec=True,
                        return_value=config_result,
                    ):
                        result = nxos_module.config(cmd_set, template_engine=None)
                        self.assertEqual(result, expected_output)
    def test_config_commands_string(self):
        commands = "no feature ospf"
        expected_output = (
            "COMMAND_LIST: no feature ospf\n\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature"
            " bash-shell\n cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature"
            " pim\n feature lldp\n \n"
        )
        with patch(
            "salt.modules.nxos.show",
            autospec=True,
            side_effect=[initial_config[0], modified_config[0]],
        ):
            mock_cmd = create_autospec(
                file_module.apply_template_on_contents,
                return_value=template_engine_file_str,
            )
            with patch.dict(
                nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
            ):
                with patch(
                    "salt.modules.nxos._configure_device",
                    autospec=True,
                    return_value=config_result,
                ):
                    result = nxos_module.config(commands)
                    self.assertEqual(result, expected_output)
    def test_config_file(self):
        config_file = "salt://bgp_config.txt"
        expected_output = (
            "COMMAND_LIST: feature bgp ; ! ; router bgp 55 ; address-family ipv4"
            " unicast ; no client-to-client reflection ; additional-paths send\n\n---"
            " \n+++ \n@@ -19,6 +19,7 @@\n feature bash-shell\n cfs eth distribute\n"
            " feature ngmvpn\n+feature bgp\n feature pim\n feature lldp\n \n@@ -233,6"
            " +234,10 @@\n line console\n line vty\n boot nxos"
            " bootflash:/nxos.9.2.4.bin \n+router bgp 55\n+  address-family ipv4"
            " unicast\n+    no client-to-client reflection\n+    additional-paths"
            " send\n \n no logging logfile\n no logging monitor\n"
        )
        with patch(
            "salt.modules.nxos.show",
            autospec=True,
            side_effect=[initial_config_file, modified_config_file],
        ):
            mock_cmd = create_autospec(
                cp_module.get_file_str, return_value=config_input_file
            )
            with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
                mock_cmd = create_autospec(
                    file_module.apply_template_on_contents,
                    return_value=template_engine_file_str_file,
                )
                with patch.dict(
                    nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
                ):
                    with patch(
                        "salt.modules.nxos._configure_device",
                        autospec=True,
                        return_value=config_result_file,
                    ):
                        result = nxos_module.config(config_file=config_file)
                        self.assertEqual(result, expected_output)
    def test_config_file_error1(self):
        config_file = "salt://bgp_config.txt"
        with patch(
            "salt.modules.nxos.show",
            autospec=True,
            side_effect=[initial_config_file, modified_config_file],
        ):
            mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
            with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
                mock_cmd = create_autospec(
                    file_module.apply_template_on_contents,
                    return_value=template_engine_file_str_file,
                )
                with patch.dict(
                    nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
                ):
                    with patch(
                        "salt.modules.nxos._configure_device",
                        autospec=True,
                        return_value=config_result_file,
                    ):
                        with self.assertRaises(CommandExecutionError):
                            nxos_module.config(config_file=config_file)
    def test_config_nxos_error_ssh(self):
        commands = ["feature bgp", "router bgp 57"]
        config_result = [
            ["feature bgp", "router bgp 57"],
            "bgp instance is already running; Tag is 55",
        ]
        expected_output = (
            "COMMAND_LIST: feature bgp ; router bgp 57\nbgp instance is already"
            " running; Tag is 55\n--- \n+++ \n@@ -19,7 +19,6 @@\n feature bash-shell\n"
            " cfs eth distribute\n feature ngmvpn\n-feature ospf\n feature pim\n"
            " feature lldp\n \n"
        )
        with patch(
            "salt.modules.nxos.show",
            autospec=True,
            side_effect=[initial_config[0], modified_config[0]],
        ):
            mock_cmd = create_autospec(
                file_module.apply_template_on_contents,
                return_value=template_engine_file_str,
            )
            with patch.dict(
                nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
            ):
                with patch(
                    "salt.modules.nxos._configure_device",
                    autospec=True,
                    return_value=config_result,
                ):
                    result = nxos_module.config(commands)
                    self.assertEqual(result, expected_output)
    def test_commands_error(self):
        commands = None
        with patch(
            "salt.modules.nxos.show",
            autospec=True,
            side_effect=[initial_config_file, modified_config_file],
        ):
            mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
            with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
                mock_cmd = create_autospec(
                    file_module.apply_template_on_contents,
                    return_value=template_engine_file_str_file,
                )
                with patch.dict(
                    nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
                ):
                    with patch(
                        "salt.modules.nxos._configure_device",
                        autospec=True,
                        return_value=config_result_file,
                    ):
                        with self.assertRaises(CommandExecutionError):
                            nxos_module.config(commands=commands)
    def test_config_file_error2(self):
        config_file = None
        with patch(
            "salt.modules.nxos.show",
            autospec=True,
            side_effect=[initial_config_file, modified_config_file],
        ):
            mock_cmd = create_autospec(cp_module.get_file_str, return_value=False)
            with patch.dict(nxos_module.__salt__, {"cp.get_file_str": mock_cmd}):
                mock_cmd = create_autospec(
                    file_module.apply_template_on_contents,
                    return_value=template_engine_file_str_file,
                )
                with patch.dict(
                    nxos_module.__salt__, {"file.apply_template_on_contents": mock_cmd}
                ):
                    with patch(
                        "salt.modules.nxos._configure_device",
                        autospec=True,
                        return_value=config_result_file,
                    ):
                        with self.assertRaises(CommandExecutionError):
                            nxos_module.config(config_file=config_file)
    def test_delete_config(self):
        for lines in ["feature bgp", ["feature bgp"]]:
            with patch("salt.modules.nxos.config", autospec=True):
                result = nxos_module.delete_config(lines)
                nxos_module.config.assert_called_with(["no feature bgp"])
                self.assertEqual(result, nxos_module.config.return_value)
    def test_remove_user(self):
        with patch("salt.modules.nxos.config", autospec=True):
            result = nxos_module.remove_user("salt_test")
            nxos_module.config.assert_called_with("no username salt_test")
            self.assertEqual(result, nxos_module.config.return_value)
    def test_replace(self):
        old_value = "feature bgp"
        new_value = "feature ospf"
        with patch(
            "salt.modules.nxos.show_run",
            autospec=True,
            return_value=n9k_show_running_config_list[0],
        ):
            with patch(
                "salt.modules.nxos.delete_config", autospec=True, return_value=None
            ):
                with patch(
                    "salt.modules.nxos.add_config", autospec=True, return_value=None
                ):
                    result = nxos_module.replace(old_value, new_value)
                    self.assertEqual(result["old"], ["feature bgp"])
                    self.assertEqual(result["new"], ["feature ospf"])
    def test_replace_full_match_true(self):
        old_value = "feature bgp"
        new_value = "feature ospf"
        with patch(
            "salt.modules.nxos.show_run",
            autospec=True,
            return_value=n9k_show_running_config_list[0],
        ):
            with patch(
                "salt.modules.nxos.delete_config", autospec=True, return_value=None
            ):
                with patch(
                    "salt.modules.nxos.add_config", autospec=True, return_value=None
                ):
                    result = nxos_module.replace(old_value, new_value, full_match=True)
                    self.assertEqual(result["old"], ["feature bgp"])
                    self.assertEqual(result["new"], ["feature ospf"])
    def test_replace_no_match(self):
        old_value = "feature does_not_exist"
        new_value = "feature ospf"
        with patch(
            "salt.modules.nxos.show_run",
            autospec=True,
            return_value=n9k_show_running_config_list[0],
        ):
            with patch(
                "salt.modules.nxos.delete_config", autospec=True, return_value=None
            ):
                with patch(
                    "salt.modules.nxos.add_config", autospec=True, return_value=None
                ):
                    result = nxos_module.replace(old_value, new_value)
                    self.assertEqual(result["old"], [])
                    self.assertEqual(result["new"], [])
    def test_save_running_config(self):
        with patch(
            "salt.modules.nxos.config", autospec=True, return_value=save_running_config
        ):
            result = nxos_module.save_running_config()
            self.assertEqual(result, save_running_config)
    def test_set_password_enc_false_cs_none(self):
        username = "devops"
        password = "test123TMM^&amp;"
        hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
        config_line = (
            "username devops password 5"
            " $5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
        )
        with patch("salt.modules.nxos.get_user", autospec=True):
            with patch(
                "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
            ):
                with patch(
                    "salt.modules.nxos.config",
                    autospec=True,
                    return_value="password_set",
                ) as config:
                    result = nxos_module.set_password(username, password)
                    config.assert_called_with(config_line)
                    self.assertEqual("password_set", result)
    def test_set_password_enc_false_cs_set(self):
        username = "devops"
        password = "test123TMM^&amp;"
        crypt_salt = "ZcZqm15X"
        hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
        config_line = (
            "username devops password 5"
            " $5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
        )
        with patch("salt.modules.nxos.get_user", autospec=True):
            with patch(
                "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
            ):
                with patch(
                    "salt.modules.nxos.config",
                    autospec=True,
                    return_value="password_set",
                ) as config:
                    result = nxos_module.set_password(
                        username, password, crypt_salt=crypt_salt
                    )
                    config.assert_called_with(config_line)
                    self.assertEqual("password_set", result)
    def test_set_password_enc_true(self):
        username = "devops"
        password = "test123TMM^&amp;"
        hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
        config_line = "username devops password 5 test123TMM^&amp;"
        with patch("salt.modules.nxos.get_user", autospec=True):
            with patch(
                "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
            ):
                with patch(
                    "salt.modules.nxos.config",
                    autospec=True,
                    return_value="password_set",
                ) as config:
                    result = nxos_module.set_password(
                        username, password, encrypted=True
                    )
                    config.assert_called_with(config_line)
                    self.assertEqual("password_set", result)
    def test_set_password_role_none(self):
        username = "devops"
        password = "test123TMM^&amp;"
        hashed_pass = "$5$ZcZqm15X$exHN2m6yrPKpYhGArK3Vml3ZjNbJaJYdzWyf0fp1Up2"
        config_line = "username devops password 5 test123TMM^&amp; role devops"
        with patch("salt.modules.nxos.get_user", autospec=True):
            with patch(
                "salt.modules.nxos.gen_hash", autospec=True, return_value=hashed_pass
            ):
                with patch(
                    "salt.modules.nxos.config",
                    autospec=True,
                    return_value="password_set",
                ) as config:
<a name="1"></a>                    result = nxos_module.set_password(
                        username, password, encrypted=True, role="devops"
                    )
                    config<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>.assert_called_with(config_line)
                    self.assertEqual("password_set", result)
    def test_set_password_blowfish_crypt(self):
        with self.assertRaises(SaltInvocationError):
            nxos_module.</b></font>set_password(
                "username", "password", encrypted=True, algorithm="blowfish"
            )
    def test_set_role(self):
        username = "salt_test"
        role = "vdc-admin"
        with patch("salt.modules.nxos.config", autospec=True, return_value=set_role):
            result = nxos_module.set_role(username, role)
            self.assertEqual(result, set_role)
    def test_unset_role(self):
        username = "salt_test"
        role = "vdc-admin"
        with patch("salt.modules.nxos.config", autospec=True, return_value=unset_role):
            result = nxos_module.unset_role(username, role)
            self.assertEqual(result, unset_role)
    def test_configure_device(self):
<a name="2"></a>        """UT: nxos module:_configure_device method"""
        with patch("salt.utils.platform.is_proxy", autospec=True, return_value=True):
            <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>with patch.dict(
                nxos_module.__proxy__,
                {"nxos.proxy_config": MagicMock(return_value="configured")},
            ):
                result = nxos_module._configure_device("feature bgp")
                self.assertEqual(</b></font>result, "configured")
        with patch("salt.utils.platform.is_proxy", autospec=True, return_value=False):
            with patch.object(
                nxos_module, "_nxapi_config", MagicMock(return_value="configured")
            ):
                nxos_module._configure_device("feature bgp")
                self.assertEqual(result, "configured")
    def test_nxapi_config(self):
        mock_cmd = MagicMock(return_value={"nxos": {"save_config": False}})
        with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
<a name="0"></a>            with patch(
                "salt.modules.nxos._nxapi_request",
                return_value="router_data",
                autospec<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>=True,
            ):
                result = nxos_module._nxapi_config("show version")
                self.assertEqual(result, [["show version"], "router_data"])
    def test_nxapi_config_failure(self):
        side_effect = ["Failure"</b></font>, "saved_data"]
        mock_cmd = MagicMock(return_value={"nxos": {"save_config": True}})
        with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
            with patch(
                "salt.modules.nxos._nxapi_request",
                side_effect=side_effect,
                autospec=True,
            ):
                result = nxos_module._nxapi_config("show bad_command")
                self.assertEqual(result, [["show bad_command"], "Failure"])
    def test_nxapi_request_proxy(self):
        with patch("salt.utils.platform.is_proxy", autospec=True, return_value=True):
            mock_request = create_autospec(
                nxos_utils.nxapi_request, return_value="router_data"
            )
            with patch.dict(
                nxos_module.__proxy__, {"nxos._nxapi_request": mock_request}
            ):
                result = nxos_module._nxapi_request("show version")
                self.assertEqual(result, "router_data")
    def test_nxapi_request_no_proxy(self):
        with patch("salt.utils.platform.is_proxy", autospec=True, return_value=False):
            mock_cmd = MagicMock(return_value={"nxos": {"save_config": False}})
            with patch.dict(nxos_module.__salt__, {"config.get": mock_cmd}):
                mock_request = create_autospec(nxos_utils.nxapi_request)
                with patch.dict(
                    nxos_module.__utils__, {"nxos.nxapi_request": mock_request}
                ):
                    result = nxos_module._nxapi_request("show version")
                    self.assertEqual(result, mock_request.return_value)
                    mock_request.assert_called_with(
                        "show version", "cli_conf", **mock_cmd.return_value
                    )
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
