<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for couchdb.py &amp; journald.py</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for couchdb.py &amp; journald.py
      </h3>
<h1 align="center">
        13.7%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>couchdb.py (20.3125%)<th>journald.py (10.4%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(40-57)<td><a href="#" name="0">(4-19)</a><td align="center"><font color="#ff0000">13</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>couchdb.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>import logging
2 from uuid import uuid4
3 from salt.utils.decorators import memoize
4 try:
5     import couchdb
6     HAS_COUCH = True
7 except ImportError:
8     HAS_COUCH = False
9 log = logging.getLogger(__name__)
10 __func_alias__ =</b></font> {"set_": "set"}
11 def __virtual__():
12     return HAS_COUCH
13 @memoize
14 def _construct_uri(profile):
15     return "http://{host}:{port}".format(**profile)
16 def _get_conn(profile):
17     DEFAULT_BASE_URL = _construct_uri(profile) or "http://localhost:5984"
18     server = couchdb.Server()
19     if profile["database"] not in server:
20         server.create(profile["database"])
21     return server
22 def set_(key, value, profile=None):
23     db = _get_db(profile)
24     return db.save({"_id": uuid4().hex, key: value})
25 def get(key, profile=None):
26     db = _get_db(profile)
27     return db.get(key)
28 def _get_db(profile):
29     server = _get_conn(profile)
30     db = _get_db(profile)
31     return db
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>journald.py</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 A simple beacon to watch journald for specific entries
2 """
3 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>import logging
4 import salt.utils.beacons
5 import salt.utils.data
6 try:
7     import systemd.journal  # pylint: disable=no-name-in-module
8     HAS_SYSTEMD = True
9 except ImportError:
10     HAS_SYSTEMD = False
11 log = logging.getLogger(__name__)
12 __virtualname__ =</b></font> "journald"
13 def __virtual__():
14     if HAS_SYSTEMD:
15         return __virtualname__
16     err_msg = "systemd library is missing."
17     log.error("Unable to load %s beacon: %s", __virtualname__, err_msg)
18     return False, err_msg
19 def _get_journal():
20     """
21     Return the active running journal object
22     """
23     if "systemd.journald" in __context__:
24         return __context__["systemd.journald"]
25     __context__["systemd.journald"] = systemd.journal.Reader()
26     __context__["systemd.journald"].seek_tail()
27     __context__["systemd.journald"].get_previous()
28     return __context__["systemd.journald"]
29 def validate(config):
30     """
31     Validate the beacon configuration
32     """
33     if not isinstance(config, list):
34         return (False, "Configuration for journald beacon must be a list.")
35     else:
36         config = salt.utils.beacons.list_to_dict(config)
37         for name in config.get("services", {}):
38             if not isinstance(config["services"][name], dict):
39                 return (
40                     False,
41                     "Services configuration for journald beacon must be a list of"
42                     " dictionaries.",
43                 )
44     return True, "Valid beacon configuration"
45 def beacon(config):
46     """
47     The journald beacon allows for the systemd journal to be parsed and linked
48     objects to be turned into events.
49     This beacons config will return all sshd jornal entries
50     .. code-block:: yaml
51         beacons:
52           journald:
53             - services:
54                 sshd:
55                   SYSLOG_IDENTIFIER: sshd
56                   PRIORITY: 6
57     """
58     ret = []
59     journal = _get_journal()
60     config = salt.utils.beacons.list_to_dict(config)
61     while True:
62         cur = journal.get_next()
63         if not cur:
64             break
65         for name in config.get("services", {}):
66             n_flag = 0
67             for key in config["services"][name]:
68                 if isinstance(key, str):
69                     key = salt.utils.data.decode(key)
70                 if key in cur:
71                     if config["services"][name][key] == cur[key]:
72                         n_flag += 1
73             if n_flag == len(config["services"][name]):
74                 sub = salt.utils.data.simple_types_filter(cur)
75                 sub.update({"tag": name})
76                 ret.append(sub)
77     return ret
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
