
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 11.07107762856207%, Tokens: 14, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>PINRemoteImage-MDEwOlJlcG9zaXRvcnkzOTUzNzEwMw==-flat-yuv_sse2.c</h3>
            <pre><code>1  #include "src/dsp/yuv.h"
2  #if defined(WEBP_USE_SSE2)
3  #include "src/dsp/common_sse2.h"
4  #include <stdlib.h>
5  #include <emmintrin.h>
6  static void ConvertYUV444ToRGB_SSE2(const __m128i* const Y0,
7                                      const __m128i* const U0,
8                                      const __m128i* const V0,
9                                      __m128i* const R,
10                                      __m128i* const G,
11                                      __m128i* const B) {
12    const __m128i k19077 = _mm_set1_epi16(19077);
13    const __m128i k26149 = _mm_set1_epi16(26149);
14    const __m128i k14234 = _mm_set1_epi16(14234);
15    const __m128i k33050 = _mm_set1_epi16((short)33050);
16    const __m128i k17685 = _mm_set1_epi16(17685);
17    const __m128i k6419  = _mm_set1_epi16(6419);
18    const __m128i k13320 = _mm_set1_epi16(13320);
19    const __m128i k8708  = _mm_set1_epi16(8708);
20    const __m128i Y1 = _mm_mulhi_epu16(*Y0, k19077);
21    const __m128i R0 = _mm_mulhi_epu16(*V0, k26149);
22    const __m128i R1 = _mm_sub_epi16(Y1, k14234);
23    const __m128i R2 = _mm_add_epi16(R1, R0);
24    const __m128i G0 = _mm_mulhi_epu16(*U0, k6419);
25    const __m128i G1 = _mm_mulhi_epu16(*V0, k13320);
26    const __m128i G2 = _mm_add_epi16(Y1, k8708);
27    const __m128i G3 = _mm_add_epi16(G0, G1);
28    const __m128i G4 = _mm_sub_epi16(G2, G3);
29    const __m128i B0 = _mm_mulhi_epu16(*U0, k33050);
30    const __m128i B1 = _mm_adds_epu16(B0, Y1);
31    const __m128i B2 = _mm_subs_epu16(B1, k17685);
32    *R = _mm_srai_epi16(R2, 6);   
33    *G = _mm_srai_epi16(G4, 6);   
34    *B = _mm_srli_epi16(B2, 6);   
35  }
36  static WEBP_INLINE __m128i Load_HI_16_SSE2(const uint8_t* src) {
37    const __m128i zero = _mm_setzero_si128();
38    return _mm_unpacklo_epi8(zero, _mm_loadl_epi64((const __m128i*)src));
39  }
40  static WEBP_INLINE __m128i Load_UV_HI_8_SSE2(const uint8_t* src) {
41    const __m128i zero = _mm_setzero_si128();
42    const __m128i tmp0 = _mm_cvtsi32_si128(*(const uint32_t*)src);
43    const __m128i tmp1 = _mm_unpacklo_epi8(zero, tmp0);
44    return _mm_unpacklo_epi16(tmp1, tmp1);   
45  }
46  static void YUV444ToRGB_SSE2(const uint8_t* const y,
47                               const uint8_t* const u,
48                               const uint8_t* const v,
49                               __m128i* const R, __m128i* const G,
50                               __m128i* const B) {
51    const __m128i Y0 = Load_HI_16_SSE2(y), U0 = Load_HI_16_SSE2(u),
52                  V0 = Load_HI_16_SSE2(v);
53    ConvertYUV444ToRGB_SSE2(&Y0, &U0, &V0, R, G, B);
54  }
55  static void YUV420ToRGB_SSE2(const uint8_t* const y,
56                               const uint8_t* const u,
57                               const uint8_t* const v,
58                               __m128i* const R, __m128i* const G,
59                               __m128i* const B) {
60    const __m128i Y0 = Load_HI_16_SSE2(y), U0 = Load_UV_HI_8_SSE2(u),
61                  V0 = Load_UV_HI_8_SSE2(v);
62    ConvertYUV444ToRGB_SSE2(&Y0, &U0, &V0, R, G, B);
63  }
64  static WEBP_INLINE void PackAndStore4_SSE2(const __m128i* const R,
65                                             const __m128i* const G,
66                                             const __m128i* const B,
67                                             const __m128i* const A,
68                                             uint8_t* const dst) {
69    const __m128i rb = _mm_packus_epi16(*R, *B);
70    const __m128i ga = _mm_packus_epi16(*G, *A);
71    const __m128i rg = _mm_unpacklo_epi8(rb, ga);
72    const __m128i ba = _mm_unpackhi_epi8(rb, ga);
73    const __m128i RGBA_lo = _mm_unpacklo_epi16(rg, ba);
74    const __m128i RGBA_hi = _mm_unpackhi_epi16(rg, ba);
75    _mm_storeu_si128((__m128i*)(dst +  0), RGBA_lo);
76    _mm_storeu_si128((__m128i*)(dst + 16), RGBA_hi);
77  }
78  static WEBP_INLINE void PackAndStore4444_SSE2(const __m128i* const R,
79                                                const __m128i* const G,
80                                                const __m128i* const B,
81                                                const __m128i* const A,
82                                                uint8_t* const dst) {
83  #if (WEBP_SWAP_16BIT_CSP == 0)
84    const __m128i rg0 = _mm_packus_epi16(*R, *G);
85    const __m128i ba0 = _mm_packus_epi16(*B, *A);
86  #else
87    const __m128i rg0 = _mm_packus_epi16(*B, *A);
88    const __m128i ba0 = _mm_packus_epi16(*R, *G);
89  #endif
90    const __m128i mask_0xf0 = _mm_set1_epi8(0xf0);
91    const __m128i rb1 = _mm_unpacklo_epi8(rg0, ba0);  
92    const __m128i ga1 = _mm_unpackhi_epi8(rg0, ba0);  
93    const __m128i rb2 = _mm_and_si128(rb1, mask_0xf0);
94    const __m128i ga2 = _mm_srli_epi16(_mm_and_si128(ga1, mask_0xf0), 4);
95    const __m128i rgba4444 = _mm_or_si128(rb2, ga2);
96    _mm_storeu_si128((__m128i*)dst, rgba4444);
97  }
98  static WEBP_INLINE void PackAndStore565_SSE2(const __m128i* const R,
99                                               const __m128i* const G,
100                                               const __m128i* const B,
101                                               uint8_t* const dst) {
102    const __m128i r0 = _mm_packus_epi16(*R, *R);
103    const __m128i g0 = _mm_packus_epi16(*G, *G);
104    const __m128i b0 = _mm_packus_epi16(*B, *B);
105    const __m128i r1 = _mm_and_si128(r0, _mm_set1_epi8(0xf8));
106    const __m128i b1 = _mm_and_si128(_mm_srli_epi16(b0, 3), _mm_set1_epi8(0x1f));
107    const __m128i g1 = _mm_srli_epi16(_mm_and_si128(g0, _mm_set1_epi8(0xe0)), 5);
<span onclick='openModal()' class='match'>108    const __m128i g2 = _mm_slli_epi16(_mm_and_si128(g0, _mm_set1_epi8(0x1c)), 3);
109    const __m128i rg = _mm_or_si128(r1, g1);
110    const __m128i gb = _mm_or_si128(g2, b1);
111  #if (WEBP_SWAP_16BIT_CSP == 0)
112    const __m128i rgb565 = _mm_unpacklo_epi8(rg, gb);
113  #else
114    const __m128i rgb565 = _mm_unpacklo_epi8(gb, rg);
115  #endif
116    _mm_storeu_si128((__m128i*)dst, rgb565);
</span>117  }
118  static WEBP_INLINE void PlanarTo24b_SSE2(__m128i* const in0, __m128i* const in1,
119                                           __m128i* const in2, __m128i* const in3,
120                                           __m128i* const in4, __m128i* const in5,
121                                           uint8_t* const rgb) {
122    VP8PlanarTo24b_SSE2(in0, in1, in2, in3, in4, in5);
123    _mm_storeu_si128((__m128i*)(rgb +  0), *in0);
124    _mm_storeu_si128((__m128i*)(rgb + 16), *in1);
125    _mm_storeu_si128((__m128i*)(rgb + 32), *in2);
126    _mm_storeu_si128((__m128i*)(rgb + 48), *in3);
127    _mm_storeu_si128((__m128i*)(rgb + 64), *in4);
128    _mm_storeu_si128((__m128i*)(rgb + 80), *in5);
129  }
130  void VP8YuvToRgba32_SSE2(const uint8_t* y, const uint8_t* u, const uint8_t* v,
131                           uint8_t* dst) {
132    const __m128i kAlpha = _mm_set1_epi16(255);
133    int n;
134    for (n = 0; n < 32; n += 8, dst += 32) {
135      __m128i R, G, B;
136      YUV444ToRGB_SSE2(y + n, u + n, v + n, &R, &G, &B);
137      PackAndStore4_SSE2(&R, &G, &B, &kAlpha, dst);
138    }
139  }
140  void VP8YuvToBgra32_SSE2(const uint8_t* y, const uint8_t* u, const uint8_t* v,
141                           uint8_t* dst) {
142    const __m128i kAlpha = _mm_set1_epi16(255);
143    int n;
144    for (n = 0; n < 32; n += 8, dst += 32) {
145      __m128i R, G, B;
146      YUV444ToRGB_SSE2(y + n, u + n, v + n, &R, &G, &B);
147      PackAndStore4_SSE2(&B, &G, &R, &kAlpha, dst);
148    }
149  }
150  void VP8YuvToArgb32_SSE2(const uint8_t* y, const uint8_t* u, const uint8_t* v,
151                           uint8_t* dst) {
152    const __m128i kAlpha = _mm_set1_epi16(255);
153    int n;
154    for (n = 0; n < 32; n += 8, dst += 32) {
155      __m128i R, G, B;
156      YUV444ToRGB_SSE2(y + n, u + n, v + n, &R, &G, &B);
157      PackAndStore4_SSE2(&kAlpha, &R, &G, &B, dst);
158    }
159  }
160  void VP8YuvToRgba444432_SSE2(const uint8_t* y, const uint8_t* u,
161                               const uint8_t* v, uint8_t* dst) {
162    const __m128i kAlpha = _mm_set1_epi16(255);
163    int n;
164    for (n = 0; n < 32; n += 8, dst += 16) {
165      __m128i R, G, B;
166      YUV444ToRGB_SSE2(y + n, u + n, v + n, &R, &G, &B);
167      PackAndStore4444_SSE2(&R, &G, &B, &kAlpha, dst);
168    }
169  }
170  void VP8YuvToRgb56532_SSE2(const uint8_t* y, const uint8_t* u, const uint8_t* v,
171                             uint8_t* dst) {
172    int n;
173    for (n = 0; n < 32; n += 8, dst += 16) {
174      __m128i R, G, B;
175      YUV444ToRGB_SSE2(y + n, u + n, v + n, &R, &G, &B);
176      PackAndStore565_SSE2(&R, &G, &B, dst);
177    }
178  }
179  void VP8YuvToRgb32_SSE2(const uint8_t* y, const uint8_t* u, const uint8_t* v,
180                          uint8_t* dst) {
181    __m128i R0, R1, R2, R3, G0, G1, G2, G3, B0, B1, B2, B3;
182    __m128i rgb0, rgb1, rgb2, rgb3, rgb4, rgb5;
183    YUV444ToRGB_SSE2(y + 0, u + 0, v + 0, &R0, &G0, &B0);
184    YUV444ToRGB_SSE2(y + 8, u + 8, v + 8, &R1, &G1, &B1);
185    YUV444ToRGB_SSE2(y + 16, u + 16, v + 16, &R2, &G2, &B2);
186    YUV444ToRGB_SSE2(y + 24, u + 24, v + 24, &R3, &G3, &B3);
187    rgb0 = _mm_packus_epi16(R0, R1);
188    rgb1 = _mm_packus_epi16(R2, R3);
189    rgb2 = _mm_packus_epi16(G0, G1);
190    rgb3 = _mm_packus_epi16(G2, G3);
191    rgb4 = _mm_packus_epi16(B0, B1);
192    rgb5 = _mm_packus_epi16(B2, B3);
193    PlanarTo24b_SSE2(&rgb0, &rgb1, &rgb2, &rgb3, &rgb4, &rgb5, dst);
194  }
195  void VP8YuvToBgr32_SSE2(const uint8_t* y, const uint8_t* u, const uint8_t* v,
196                          uint8_t* dst) {
197    __m128i R0, R1, R2, R3, G0, G1, G2, G3, B0, B1, B2, B3;
198    __m128i bgr0, bgr1, bgr2, bgr3, bgr4, bgr5;
199    YUV444ToRGB_SSE2(y +  0, u +  0, v +  0, &R0, &G0, &B0);
200    YUV444ToRGB_SSE2(y +  8, u +  8, v +  8, &R1, &G1, &B1);
201    YUV444ToRGB_SSE2(y + 16, u + 16, v + 16, &R2, &G2, &B2);
202    YUV444ToRGB_SSE2(y + 24, u + 24, v + 24, &R3, &G3, &B3);
203    bgr0 = _mm_packus_epi16(B0, B1);
204    bgr1 = _mm_packus_epi16(B2, B3);
205    bgr2 = _mm_packus_epi16(G0, G1);
206    bgr3 = _mm_packus_epi16(G2, G3);
207    bgr4 = _mm_packus_epi16(R0, R1);
208    bgr5= _mm_packus_epi16(R2, R3);
209    PlanarTo24b_SSE2(&bgr0, &bgr1, &bgr2, &bgr3, &bgr4, &bgr5, dst);
210  }
211  static void YuvToRgbaRow_SSE2(const uint8_t* y,
212                                const uint8_t* u, const uint8_t* v,
213                                uint8_t* dst, int len) {
214    const __m128i kAlpha = _mm_set1_epi16(255);
215    int n;
216    for (n = 0; n + 8 <= len; n += 8, dst += 32) {
217      __m128i R, G, B;
218      YUV420ToRGB_SSE2(y, u, v, &R, &G, &B);
219      PackAndStore4_SSE2(&R, &G, &B, &kAlpha, dst);
220      y += 8;
221      u += 4;
222      v += 4;
223    }
224    for (; n < len; ++n) {   
225      VP8YuvToRgba(y[0], u[0], v[0], dst);
226      dst += 4;
227      y += 1;
228      u += (n & 1);
229      v += (n & 1);
230    }
231  }
232  static void YuvToBgraRow_SSE2(const uint8_t* y,
233                                const uint8_t* u, const uint8_t* v,
234                                uint8_t* dst, int len) {
235    const __m128i kAlpha = _mm_set1_epi16(255);
236    int n;
237    for (n = 0; n + 8 <= len; n += 8, dst += 32) {
238      __m128i R, G, B;
239      YUV420ToRGB_SSE2(y, u, v, &R, &G, &B);
240      PackAndStore4_SSE2(&B, &G, &R, &kAlpha, dst);
241      y += 8;
242      u += 4;
243      v += 4;
244    }
245    for (; n < len; ++n) {   
246      VP8YuvToBgra(y[0], u[0], v[0], dst);
247      dst += 4;
248      y += 1;
249      u += (n & 1);
250      v += (n & 1);
251    }
252  }
253  static void YuvToArgbRow_SSE2(const uint8_t* y,
254                                const uint8_t* u, const uint8_t* v,
255                                uint8_t* dst, int len) {
256    const __m128i kAlpha = _mm_set1_epi16(255);
257    int n;
258    for (n = 0; n + 8 <= len; n += 8, dst += 32) {
259      __m128i R, G, B;
260      YUV420ToRGB_SSE2(y, u, v, &R, &G, &B);
261      PackAndStore4_SSE2(&kAlpha, &R, &G, &B, dst);
262      y += 8;
263      u += 4;
264      v += 4;
265    }
266    for (; n < len; ++n) {   
267      VP8YuvToArgb(y[0], u[0], v[0], dst);
268      dst += 4;
269      y += 1;
270      u += (n & 1);
271      v += (n & 1);
272    }
273  }
274  static void YuvToRgbRow_SSE2(const uint8_t* y,
275                               const uint8_t* u, const uint8_t* v,
276                               uint8_t* dst, int len) {
277    int n;
278    for (n = 0; n + 32 <= len; n += 32, dst += 32 * 3) {
279      __m128i R0, R1, R2, R3, G0, G1, G2, G3, B0, B1, B2, B3;
280      __m128i rgb0, rgb1, rgb2, rgb3, rgb4, rgb5;
281      YUV420ToRGB_SSE2(y +  0, u +  0, v +  0, &R0, &G0, &B0);
282      YUV420ToRGB_SSE2(y +  8, u +  4, v +  4, &R1, &G1, &B1);
283      YUV420ToRGB_SSE2(y + 16, u +  8, v +  8, &R2, &G2, &B2);
284      YUV420ToRGB_SSE2(y + 24, u + 12, v + 12, &R3, &G3, &B3);
285      rgb0 = _mm_packus_epi16(R0, R1);
286      rgb1 = _mm_packus_epi16(R2, R3);
287      rgb2 = _mm_packus_epi16(G0, G1);
288      rgb3 = _mm_packus_epi16(G2, G3);
289      rgb4 = _mm_packus_epi16(B0, B1);
290      rgb5 = _mm_packus_epi16(B2, B3);
291      PlanarTo24b_SSE2(&rgb0, &rgb1, &rgb2, &rgb3, &rgb4, &rgb5, dst);
292      y += 32;
293      u += 16;
294      v += 16;
295    }
296    for (; n < len; ++n) {   
297      VP8YuvToRgb(y[0], u[0], v[0], dst);
298      dst += 3;
299      y += 1;
300      u += (n & 1);
301      v += (n & 1);
302    }
303  }
304  static void YuvToBgrRow_SSE2(const uint8_t* y,
305                               const uint8_t* u, const uint8_t* v,
306                               uint8_t* dst, int len) {
307    int n;
308    for (n = 0; n + 32 <= len; n += 32, dst += 32 * 3) {
309      __m128i R0, R1, R2, R3, G0, G1, G2, G3, B0, B1, B2, B3;
310      __m128i bgr0, bgr1, bgr2, bgr3, bgr4, bgr5;
311      YUV420ToRGB_SSE2(y +  0, u +  0, v +  0, &R0, &G0, &B0);
312      YUV420ToRGB_SSE2(y +  8, u +  4, v +  4, &R1, &G1, &B1);
313      YUV420ToRGB_SSE2(y + 16, u +  8, v +  8, &R2, &G2, &B2);
314      YUV420ToRGB_SSE2(y + 24, u + 12, v + 12, &R3, &G3, &B3);
315      bgr0 = _mm_packus_epi16(B0, B1);
316      bgr1 = _mm_packus_epi16(B2, B3);
317      bgr2 = _mm_packus_epi16(G0, G1);
318      bgr3 = _mm_packus_epi16(G2, G3);
319      bgr4 = _mm_packus_epi16(R0, R1);
320      bgr5 = _mm_packus_epi16(R2, R3);
321      PlanarTo24b_SSE2(&bgr0, &bgr1, &bgr2, &bgr3, &bgr4, &bgr5, dst);
322      y += 32;
323      u += 16;
324      v += 16;
325    }
326    for (; n < len; ++n) {   
327      VP8YuvToBgr(y[0], u[0], v[0], dst);
328      dst += 3;
329      y += 1;
330      u += (n & 1);
331      v += (n & 1);
332    }
333  }
334  extern void WebPInitSamplersSSE2(void);
335  WEBP_TSAN_IGNORE_FUNCTION void WebPInitSamplersSSE2(void) {
336    WebPSamplers[MODE_RGB]  = YuvToRgbRow_SSE2;
337    WebPSamplers[MODE_RGBA] = YuvToRgbaRow_SSE2;
338    WebPSamplers[MODE_BGR]  = YuvToBgrRow_SSE2;
339    WebPSamplers[MODE_BGRA] = YuvToBgraRow_SSE2;
340    WebPSamplers[MODE_ARGB] = YuvToArgbRow_SSE2;
341  }
342  #define LOAD_16(src) _mm_loadu_si128((const __m128i*)(src))
343  #define STORE_16(V, dst) _mm_storeu_si128((__m128i*)(dst), (V))
344  static WEBP_INLINE void RGB24PackedToPlanarHelper_SSE2(
345      const __m128i* const in &bsol;*in[6]*/, __m128i* const out &bsol;*out[6]*/) {
346    out[0] = _mm_unpacklo_epi8(in[0], in[3]);
347    out[1] = _mm_unpackhi_epi8(in[0], in[3]);
348    out[2] = _mm_unpacklo_epi8(in[1], in[4]);
349    out[3] = _mm_unpackhi_epi8(in[1], in[4]);
350    out[4] = _mm_unpacklo_epi8(in[2], in[5]);
351    out[5] = _mm_unpackhi_epi8(in[2], in[5]);
352  }
353  static WEBP_INLINE void RGB24PackedToPlanar_SSE2(
354      const uint8_t* const rgb, __m128i* const out &bsol;*out[6]*/) {
355    __m128i tmp[6];
356    tmp[0] = _mm_loadu_si128((const __m128i*)(rgb +  0));
357    tmp[1] = _mm_loadu_si128((const __m128i*)(rgb + 16));
358    tmp[2] = _mm_loadu_si128((const __m128i*)(rgb + 32));
359    tmp[3] = _mm_loadu_si128((const __m128i*)(rgb + 48));
360    tmp[4] = _mm_loadu_si128((const __m128i*)(rgb + 64));
361    tmp[5] = _mm_loadu_si128((const __m128i*)(rgb + 80));
362    RGB24PackedToPlanarHelper_SSE2(tmp, out);
363    RGB24PackedToPlanarHelper_SSE2(out, tmp);
364    RGB24PackedToPlanarHelper_SSE2(tmp, out);
365    RGB24PackedToPlanarHelper_SSE2(out, tmp);
366    RGB24PackedToPlanarHelper_SSE2(tmp, out);
367  }
368  static WEBP_INLINE void RGB32PackedToPlanar_SSE2(const uint32_t* const argb,
369                                                   __m128i* const rgb &bsol;*in[6]*/) {
370    const __m128i zero = _mm_setzero_si128();
371    __m128i a0 = LOAD_16(argb + 0);
372    __m128i a1 = LOAD_16(argb + 4);
373    __m128i a2 = LOAD_16(argb + 8);
374    __m128i a3 = LOAD_16(argb + 12);
375    VP8L32bToPlanar_SSE2(&a0, &a1, &a2, &a3);
376    rgb[0] = _mm_unpacklo_epi8(a1, zero);
377    rgb[1] = _mm_unpackhi_epi8(a1, zero);
378    rgb[2] = _mm_unpacklo_epi8(a2, zero);
379    rgb[3] = _mm_unpackhi_epi8(a2, zero);
380    rgb[4] = _mm_unpacklo_epi8(a3, zero);
381    rgb[5] = _mm_unpackhi_epi8(a3, zero);
382  }
383  #define TRANSFORM(RG_LO, RG_HI, GB_LO, GB_HI, MULT_RG, MULT_GB, \
384                    ROUNDER, DESCALE_FIX, OUT) do {               \
385    const __m128i V0_lo = _mm_madd_epi16(RG_LO, MULT_RG);         \
386    const __m128i V0_hi = _mm_madd_epi16(RG_HI, MULT_RG);         \
387    const __m128i V1_lo = _mm_madd_epi16(GB_LO, MULT_GB);         \
388    const __m128i V1_hi = _mm_madd_epi16(GB_HI, MULT_GB);         \
389    const __m128i V2_lo = _mm_add_epi32(V0_lo, V1_lo);            \
390    const __m128i V2_hi = _mm_add_epi32(V0_hi, V1_hi);            \
391    const __m128i V3_lo = _mm_add_epi32(V2_lo, ROUNDER);          \
392    const __m128i V3_hi = _mm_add_epi32(V2_hi, ROUNDER);          \
393    const __m128i V5_lo = _mm_srai_epi32(V3_lo, DESCALE_FIX);     \
394    const __m128i V5_hi = _mm_srai_epi32(V3_hi, DESCALE_FIX);     \
395    (OUT) = _mm_packs_epi32(V5_lo, V5_hi);                        \
396  } while (0)
397  #define MK_CST_16(A, B) _mm_set_epi16((B), (A), (B), (A), (B), (A), (B), (A))
398  static WEBP_INLINE void ConvertRGBToY_SSE2(const __m128i* const R,
399                                             const __m128i* const G,
400                                             const __m128i* const B,
401                                             __m128i* const Y) {
402    const __m128i kRG_y = MK_CST_16(16839, 33059 - 16384);
403    const __m128i kGB_y = MK_CST_16(16384, 6420);
404    const __m128i kHALF_Y = _mm_set1_epi32((16 << YUV_FIX) + YUV_HALF);
405    const __m128i RG_lo = _mm_unpacklo_epi16(*R, *G);
406    const __m128i RG_hi = _mm_unpackhi_epi16(*R, *G);
407    const __m128i GB_lo = _mm_unpacklo_epi16(*G, *B);
408    const __m128i GB_hi = _mm_unpackhi_epi16(*G, *B);
409    TRANSFORM(RG_lo, RG_hi, GB_lo, GB_hi, kRG_y, kGB_y, kHALF_Y, YUV_FIX, *Y);
410  }
411  static WEBP_INLINE void ConvertRGBToUV_SSE2(const __m128i* const R,
412                                              const __m128i* const G,
413                                              const __m128i* const B,
414                                              __m128i* const U,
415                                              __m128i* const V) {
416    const __m128i kRG_u = MK_CST_16(-9719, -19081);
417    const __m128i kGB_u = MK_CST_16(0, 28800);
418    const __m128i kRG_v = MK_CST_16(28800, 0);
419    const __m128i kGB_v = MK_CST_16(-24116, -4684);
420    const __m128i kHALF_UV = _mm_set1_epi32(((128 << YUV_FIX) + YUV_HALF) << 2);
421    const __m128i RG_lo = _mm_unpacklo_epi16(*R, *G);
422    const __m128i RG_hi = _mm_unpackhi_epi16(*R, *G);
423    const __m128i GB_lo = _mm_unpacklo_epi16(*G, *B);
424    const __m128i GB_hi = _mm_unpackhi_epi16(*G, *B);
425    TRANSFORM(RG_lo, RG_hi, GB_lo, GB_hi, kRG_u, kGB_u,
426              kHALF_UV, YUV_FIX + 2, *U);
427    TRANSFORM(RG_lo, RG_hi, GB_lo, GB_hi, kRG_v, kGB_v,
428              kHALF_UV, YUV_FIX + 2, *V);
429  }
430  #undef MK_CST_16
431  #undef TRANSFORM
432  static void ConvertRGB24ToY_SSE2(const uint8_t* rgb, uint8_t* y, int width) {
433    const int max_width = width & ~31;
434    int i;
435    for (i = 0; i < max_width; rgb += 3 * 16 * 2) {
436      __m128i rgb_plane[6];
437      int j;
438      RGB24PackedToPlanar_SSE2(rgb, rgb_plane);
439      for (j = 0; j < 2; ++j, i += 16) {
440        const __m128i zero = _mm_setzero_si128();
441        __m128i r, g, b, Y0, Y1;
442        r = _mm_unpacklo_epi8(rgb_plane[0 + j], zero);
443        g = _mm_unpacklo_epi8(rgb_plane[2 + j], zero);
444        b = _mm_unpacklo_epi8(rgb_plane[4 + j], zero);
445        ConvertRGBToY_SSE2(&r, &g, &b, &Y0);
446        r = _mm_unpackhi_epi8(rgb_plane[0 + j], zero);
447        g = _mm_unpackhi_epi8(rgb_plane[2 + j], zero);
448        b = _mm_unpackhi_epi8(rgb_plane[4 + j], zero);
449        ConvertRGBToY_SSE2(&r, &g, &b, &Y1);
450        STORE_16(_mm_packus_epi16(Y0, Y1), y + i);
451      }
452    }
453    for (; i < width; ++i, rgb += 3) {   
454      y[i] = VP8RGBToY(rgb[0], rgb[1], rgb[2], YUV_HALF);
455    }
456  }
457  static void ConvertBGR24ToY_SSE2(const uint8_t* bgr, uint8_t* y, int width) {
458    const int max_width = width & ~31;
459    int i;
460    for (i = 0; i < max_width; bgr += 3 * 16 * 2) {
461      __m128i bgr_plane[6];
462      int j;
463      RGB24PackedToPlanar_SSE2(bgr, bgr_plane);
464      for (j = 0; j < 2; ++j, i += 16) {
465        const __m128i zero = _mm_setzero_si128();
466        __m128i r, g, b, Y0, Y1;
467        b = _mm_unpacklo_epi8(bgr_plane[0 + j], zero);
468        g = _mm_unpacklo_epi8(bgr_plane[2 + j], zero);
469        r = _mm_unpacklo_epi8(bgr_plane[4 + j], zero);
470        ConvertRGBToY_SSE2(&r, &g, &b, &Y0);
471        b = _mm_unpackhi_epi8(bgr_plane[0 + j], zero);
472        g = _mm_unpackhi_epi8(bgr_plane[2 + j], zero);
473        r = _mm_unpackhi_epi8(bgr_plane[4 + j], zero);
474        ConvertRGBToY_SSE2(&r, &g, &b, &Y1);
475        STORE_16(_mm_packus_epi16(Y0, Y1), y + i);
476      }
477    }
478    for (; i < width; ++i, bgr += 3) {  
479      y[i] = VP8RGBToY(bgr[2], bgr[1], bgr[0], YUV_HALF);
480    }
481  }
482  static void ConvertARGBToY_SSE2(const uint32_t* argb, uint8_t* y, int width) {
483    const int max_width = width & ~15;
484    int i;
485    for (i = 0; i < max_width; i += 16) {
486      __m128i Y0, Y1, rgb[6];
487      RGB32PackedToPlanar_SSE2(&argb[i], rgb);
488      ConvertRGBToY_SSE2(&rgb[0], &rgb[2], &rgb[4], &Y0);
489      ConvertRGBToY_SSE2(&rgb[1], &rgb[3], &rgb[5], &Y1);
490      STORE_16(_mm_packus_epi16(Y0, Y1), y + i);
491    }
492    for (; i < width; ++i) {   
493      const uint32_t p = argb[i];
494      y[i] = VP8RGBToY((p >> 16) & 0xff, (p >> 8) & 0xff, (p >>  0) & 0xff,
495                       YUV_HALF);
496    }
497  }
498  static void HorizontalAddPack_SSE2(const __m128i* const A,
499                                     const __m128i* const B,
500                                     __m128i* const out) {
501    const __m128i k2 = _mm_set1_epi16(2);
502    const __m128i C = _mm_madd_epi16(*A, k2);
503    const __m128i D = _mm_madd_epi16(*B, k2);
504    *out = _mm_packs_epi32(C, D);
505  }
506  static void ConvertARGBToUV_SSE2(const uint32_t* argb,
507                                   uint8_t* u, uint8_t* v,
508                                   int src_width, int do_store) {
509    const int max_width = src_width & ~31;
510    int i;
511    for (i = 0; i < max_width; i += 32, u += 16, v += 16) {
512      __m128i rgb[6], U0, V0, U1, V1;
513      RGB32PackedToPlanar_SSE2(&argb[i], rgb);
514      HorizontalAddPack_SSE2(&rgb[0], &rgb[1], &rgb[0]);
515      HorizontalAddPack_SSE2(&rgb[2], &rgb[3], &rgb[2]);
516      HorizontalAddPack_SSE2(&rgb[4], &rgb[5], &rgb[4]);
517      ConvertRGBToUV_SSE2(&rgb[0], &rgb[2], &rgb[4], &U0, &V0);
518      RGB32PackedToPlanar_SSE2(&argb[i + 16], rgb);
519      HorizontalAddPack_SSE2(&rgb[0], &rgb[1], &rgb[0]);
520      HorizontalAddPack_SSE2(&rgb[2], &rgb[3], &rgb[2]);
521      HorizontalAddPack_SSE2(&rgb[4], &rgb[5], &rgb[4]);
522      ConvertRGBToUV_SSE2(&rgb[0], &rgb[2], &rgb[4], &U1, &V1);
523      U0 = _mm_packus_epi16(U0, U1);
524      V0 = _mm_packus_epi16(V0, V1);
525      if (!do_store) {
526        const __m128i prev_u = LOAD_16(u);
527        const __m128i prev_v = LOAD_16(v);
528        U0 = _mm_avg_epu8(U0, prev_u);
529        V0 = _mm_avg_epu8(V0, prev_v);
530      }
531      STORE_16(U0, u);
532      STORE_16(V0, v);
533    }
534    if (i < src_width) {  
535      WebPConvertARGBToUV_C(argb + i, u, v, src_width - i, do_store);
536    }
537  }
538  static WEBP_INLINE void RGBA32PackedToPlanar_16b_SSE2(
539      const uint16_t* const rgbx,
540      __m128i* const r, __m128i* const g, __m128i* const b) {
541    const __m128i in0 = LOAD_16(rgbx +  0);  
542    const __m128i in1 = LOAD_16(rgbx +  8);  
543    const __m128i in2 = LOAD_16(rgbx + 16);  
544    const __m128i in3 = LOAD_16(rgbx + 24);  
545    const __m128i A0 = _mm_unpacklo_epi16(in0, in1);
546    const __m128i A1 = _mm_unpackhi_epi16(in0, in1);
547    const __m128i A2 = _mm_unpacklo_epi16(in2, in3);
548    const __m128i A3 = _mm_unpackhi_epi16(in2, in3);
549    const __m128i B0 = _mm_unpacklo_epi16(A0, A1);  
550    const __m128i B1 = _mm_unpackhi_epi16(A0, A1);  
551    const __m128i B2 = _mm_unpacklo_epi16(A2, A3);  
552    const __m128i B3 = _mm_unpackhi_epi16(A2, A3);  
553    *r = _mm_unpacklo_epi64(B0, B2);
554    *g = _mm_unpackhi_epi64(B0, B2);
555    *b = _mm_unpacklo_epi64(B1, B3);
556  }
557  static void ConvertRGBA32ToUV_SSE2(const uint16_t* rgb,
558                                     uint8_t* u, uint8_t* v, int width) {
559    const int max_width = width & ~15;
560    const uint16_t* const last_rgb = rgb + 4 * max_width;
561    while (rgb < last_rgb) {
562      __m128i r, g, b, U0, V0, U1, V1;
563      RGBA32PackedToPlanar_16b_SSE2(rgb +  0, &r, &g, &b);
564      ConvertRGBToUV_SSE2(&r, &g, &b, &U0, &V0);
565      RGBA32PackedToPlanar_16b_SSE2(rgb + 32, &r, &g, &b);
566      ConvertRGBToUV_SSE2(&r, &g, &b, &U1, &V1);
567      STORE_16(_mm_packus_epi16(U0, U1), u);
568      STORE_16(_mm_packus_epi16(V0, V1), v);
569      u += 16;
570      v += 16;
571      rgb += 2 * 32;
572    }
573    if (max_width < width) {  
574      WebPConvertRGBA32ToUV_C(rgb, u, v, width - max_width);
575    }
576  }
577  extern void WebPInitConvertARGBToYUVSSE2(void);
578  WEBP_TSAN_IGNORE_FUNCTION void WebPInitConvertARGBToYUVSSE2(void) {
579    WebPConvertARGBToY = ConvertARGBToY_SSE2;
580    WebPConvertARGBToUV = ConvertARGBToUV_SSE2;
581    WebPConvertRGB24ToY = ConvertRGB24ToY_SSE2;
582    WebPConvertBGR24ToY = ConvertBGR24ToY_SSE2;
583    WebPConvertRGBA32ToUV = ConvertRGBA32ToUV_SSE2;
584  }
585  #define MAX_Y ((1 << 10) - 1)    
586  static uint16_t clip_y(int v) {
587    return (v < 0) ? 0 : (v > MAX_Y) ? MAX_Y : (uint16_t)v;
588  }
589  static uint64_t SharpYUVUpdateY_SSE2(const uint16_t* ref, const uint16_t* src,
590                                       uint16_t* dst, int len) {
591    uint64_t diff = 0;
592    uint32_t tmp[4];
593    int i;
594    const __m128i zero = _mm_setzero_si128();
595    const __m128i max = _mm_set1_epi16(MAX_Y);
596    const __m128i one = _mm_set1_epi16(1);
597    __m128i sum = zero;
598    for (i = 0; i + 8 <= len; i += 8) {
599      const __m128i A = _mm_loadu_si128((const __m128i*)(ref + i));
600      const __m128i B = _mm_loadu_si128((const __m128i*)(src + i));
601      const __m128i C = _mm_loadu_si128((const __m128i*)(dst + i));
602      const __m128i D = _mm_sub_epi16(A, B);       
603      const __m128i E = _mm_cmpgt_epi16(zero, D);  
604      const __m128i F = _mm_add_epi16(C, D);       
605      const __m128i G = _mm_or_si128(E, one);      
606      const __m128i H = _mm_max_epi16(_mm_min_epi16(F, max), zero);
607      const __m128i I = _mm_madd_epi16(D, G);      
608      _mm_storeu_si128((__m128i*)(dst + i), H);
609      sum = _mm_add_epi32(sum, I);
610    }
611    _mm_storeu_si128((__m128i*)tmp, sum);
612    diff = tmp[3] + tmp[2] + tmp[1] + tmp[0];
613    for (; i < len; ++i) {
614      const int diff_y = ref[i] - src[i];
615      const int new_y = (int)dst[i] + diff_y;
616      dst[i] = clip_y(new_y);
617      diff += (uint64_t)abs(diff_y);
618    }
619    return diff;
620  }
621  static void SharpYUVUpdateRGB_SSE2(const int16_t* ref, const int16_t* src,
622                                     int16_t* dst, int len) {
623    int i = 0;
624    for (i = 0; i + 8 <= len; i += 8) {
625      const __m128i A = _mm_loadu_si128((const __m128i*)(ref + i));
626      const __m128i B = _mm_loadu_si128((const __m128i*)(src + i));
627      const __m128i C = _mm_loadu_si128((const __m128i*)(dst + i));
628      const __m128i D = _mm_sub_epi16(A, B);   
629      const __m128i E = _mm_add_epi16(C, D);   
630      _mm_storeu_si128((__m128i*)(dst + i), E);
631    }
632    for (; i < len; ++i) {
633      const int diff_uv = ref[i] - src[i];
634      dst[i] += diff_uv;
635    }
636  }
637  static void SharpYUVFilterRow_SSE2(const int16_t* A, const int16_t* B, int len,
638                                     const uint16_t* best_y, uint16_t* out) {
639    int i;
640    const __m128i kCst8 = _mm_set1_epi16(8);
641    const __m128i max = _mm_set1_epi16(MAX_Y);
642    const __m128i zero = _mm_setzero_si128();
643    for (i = 0; i + 8 <= len; i += 8) {
644      const __m128i a0 = _mm_loadu_si128((const __m128i*)(A + i + 0));
645      const __m128i a1 = _mm_loadu_si128((const __m128i*)(A + i + 1));
646      const __m128i b0 = _mm_loadu_si128((const __m128i*)(B + i + 0));
647      const __m128i b1 = _mm_loadu_si128((const __m128i*)(B + i + 1));
648      const __m128i a0b1 = _mm_add_epi16(a0, b1);
649      const __m128i a1b0 = _mm_add_epi16(a1, b0);
650      const __m128i a0a1b0b1 = _mm_add_epi16(a0b1, a1b0);  
651      const __m128i a0a1b0b1_8 = _mm_add_epi16(a0a1b0b1, kCst8);
652      const __m128i a0b1_2 = _mm_add_epi16(a0b1, a0b1);    
653      const __m128i a1b0_2 = _mm_add_epi16(a1b0, a1b0);    
654      const __m128i c0 = _mm_srai_epi16(_mm_add_epi16(a0b1_2, a0a1b0b1_8), 3);
655      const __m128i c1 = _mm_srai_epi16(_mm_add_epi16(a1b0_2, a0a1b0b1_8), 3);
656      const __m128i d0 = _mm_add_epi16(c1, a0);
657      const __m128i d1 = _mm_add_epi16(c0, a1);
658      const __m128i e0 = _mm_srai_epi16(d0, 1);
659      const __m128i e1 = _mm_srai_epi16(d1, 1);
660      const __m128i f0 = _mm_unpacklo_epi16(e0, e1);
661      const __m128i f1 = _mm_unpackhi_epi16(e0, e1);
662      const __m128i g0 = _mm_loadu_si128((const __m128i*)(best_y + 2 * i + 0));
663      const __m128i g1 = _mm_loadu_si128((const __m128i*)(best_y + 2 * i + 8));
664      const __m128i h0 = _mm_add_epi16(g0, f0);
665      const __m128i h1 = _mm_add_epi16(g1, f1);
666      const __m128i i0 = _mm_max_epi16(_mm_min_epi16(h0, max), zero);
667      const __m128i i1 = _mm_max_epi16(_mm_min_epi16(h1, max), zero);
668      _mm_storeu_si128((__m128i*)(out + 2 * i + 0), i0);
669      _mm_storeu_si128((__m128i*)(out + 2 * i + 8), i1);
670    }
671    for (; i < len; ++i) {
672      const int a0b1 = A[i + 0] + B[i + 1];
673      const int a1b0 = A[i + 1] + B[i + 0];
674      const int a0a1b0b1 = a0b1 + a1b0 + 8;
675      const int v0 = (8 * A[i + 0] + 2 * a1b0 + a0a1b0b1) >> 4;
676      const int v1 = (8 * A[i + 1] + 2 * a0b1 + a0a1b0b1) >> 4;
677      out[2 * i + 0] = clip_y(best_y[2 * i + 0] + v0);
678      out[2 * i + 1] = clip_y(best_y[2 * i + 1] + v1);
679    }
680  }
681  #undef MAX_Y
682  extern void WebPInitSharpYUVSSE2(void);
683  WEBP_TSAN_IGNORE_FUNCTION void WebPInitSharpYUVSSE2(void) {
684    WebPSharpYUVUpdateY = SharpYUVUpdateY_SSE2;
685    WebPSharpYUVUpdateRGB = SharpYUVUpdateRGB_SSE2;
686    WebPSharpYUVFilterRow = SharpYUVFilterRow_SSE2;
687  }
688  #else  
689  WEBP_DSP_INIT_STUB(WebPInitSamplersSSE2)
690  WEBP_DSP_INIT_STUB(WebPInitConvertARGBToYUVSSE2)
691  WEBP_DSP_INIT_STUB(WebPInitSharpYUVSSE2)
692  #endif  
</code></pre>
        </div>
        <div class="column">
            <h3>xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-crypto-ops.c</h3>
            <pre><code>1  #include <assert.h>
2  #include <stdint.h>
3  #include "crypto-ops.h"
4  #ifdef _MSC_VER
5  #pragma warning(disable: 4146 4244)
6  #endif
7  static void fe_mul(fe, const fe, const fe);
8  static void fe_sq(fe, const fe);
9  static void ge_madd(ge_p1p1 *, const ge_p3 *, const ge_precomp *);
10  static void ge_msub(ge_p1p1 *, const ge_p3 *, const ge_precomp *);
11  static void ge_p2_0(ge_p2 *);
12  static void ge_p3_dbl(ge_p1p1 *, const ge_p3 *);
13  static void fe_divpowm1(fe, const fe, const fe);
14  uint64_t load_3(const unsigned char *in) {
15    uint64_t result;
16    result = (uint64_t) in[0];
17    result |= ((uint64_t) in[1]) << 8;
18    result |= ((uint64_t) in[2]) << 16;
19    return result;
20  }
21  uint64_t load_4(const unsigned char *in)
22  {
23    uint64_t result;
24    result = (uint64_t) in[0];
25    result |= ((uint64_t) in[1]) << 8;
26    result |= ((uint64_t) in[2]) << 16;
27    result |= ((uint64_t) in[3]) << 24;
28    return result;
29  }
30  static void fe_0(fe h) {
31    h[0] = 0;
32    h[1] = 0;
33    h[2] = 0;
34    h[3] = 0;
35    h[4] = 0;
36    h[5] = 0;
37    h[6] = 0;
38    h[7] = 0;
39    h[8] = 0;
40    h[9] = 0;
41  }
42  static void fe_1(fe h) {
43    h[0] = 1;
44    h[1] = 0;
45    h[2] = 0;
46    h[3] = 0;
47    h[4] = 0;
48    h[5] = 0;
49    h[6] = 0;
50    h[7] = 0;
51    h[8] = 0;
52    h[9] = 0;
53  }
54  void fe_add(fe h, const fe f, const fe g) {
55    int32_t f0 = f[0];
56    int32_t f1 = f[1];
57    int32_t f2 = f[2];
58    int32_t f3 = f[3];
59    int32_t f4 = f[4];
60    int32_t f5 = f[5];
61    int32_t f6 = f[6];
62    int32_t f7 = f[7];
63    int32_t f8 = f[8];
64    int32_t f9 = f[9];
65    int32_t g0 = g[0];
66    int32_t g1 = g[1];
67    int32_t g2 = g[2];
68    int32_t g3 = g[3];
69    int32_t g4 = g[4];
70    int32_t g5 = g[5];
71    int32_t g6 = g[6];
72    int32_t g7 = g[7];
73    int32_t g8 = g[8];
74    int32_t g9 = g[9];
75    int32_t h0 = f0 + g0;
76    int32_t h1 = f1 + g1;
77    int32_t h2 = f2 + g2;
78    int32_t h3 = f3 + g3;
79    int32_t h4 = f4 + g4;
80    int32_t h5 = f5 + g5;
81    int32_t h6 = f6 + g6;
82    int32_t h7 = f7 + g7;
83    int32_t h8 = f8 + g8;
84    int32_t h9 = f9 + g9;
85    h[0] = h0;
86    h[1] = h1;
87    h[2] = h2;
88    h[3] = h3;
89    h[4] = h4;
90    h[5] = h5;
91    h[6] = h6;
92    h[7] = h7;
93    h[8] = h8;
94    h[9] = h9;
95  }
96  static void fe_cmov(fe f, const fe g, unsigned int b) {
97    int32_t f0 = f[0];
98    int32_t f1 = f[1];
99    int32_t f2 = f[2];
100    int32_t f3 = f[3];
101    int32_t f4 = f[4];
102    int32_t f5 = f[5];
103    int32_t f6 = f[6];
104    int32_t f7 = f[7];
105    int32_t f8 = f[8];
106    int32_t f9 = f[9];
107    int32_t g0 = g[0];
108    int32_t g1 = g[1];
109    int32_t g2 = g[2];
110    int32_t g3 = g[3];
111    int32_t g4 = g[4];
112    int32_t g5 = g[5];
113    int32_t g6 = g[6];
114    int32_t g7 = g[7];
115    int32_t g8 = g[8];
116    int32_t g9 = g[9];
117    int32_t x0 = f0 ^ g0;
118    int32_t x1 = f1 ^ g1;
119    int32_t x2 = f2 ^ g2;
120    int32_t x3 = f3 ^ g3;
121    int32_t x4 = f4 ^ g4;
122    int32_t x5 = f5 ^ g5;
123    int32_t x6 = f6 ^ g6;
124    int32_t x7 = f7 ^ g7;
125    int32_t x8 = f8 ^ g8;
126    int32_t x9 = f9 ^ g9;
127    assert((((b - 1) & ~b) | ((b - 2) & ~(b - 1))) == (unsigned int) -1);
128    b = -b;
129    x0 &= b;
130    x1 &= b;
131    x2 &= b;
132    x3 &= b;
133    x4 &= b;
134    x5 &= b;
135    x6 &= b;
136    x7 &= b;
137    x8 &= b;
138    x9 &= b;
139    f[0] = f0 ^ x0;
140    f[1] = f1 ^ x1;
141    f[2] = f2 ^ x2;
142    f[3] = f3 ^ x3;
143    f[4] = f4 ^ x4;
144    f[5] = f5 ^ x5;
145    f[6] = f6 ^ x6;
146    f[7] = f7 ^ x7;
147    f[8] = f8 ^ x8;
148    f[9] = f9 ^ x9;
149  }
150  static void fe_copy(fe h, const fe f) {
151    int32_t f0 = f[0];
152    int32_t f1 = f[1];
153    int32_t f2 = f[2];
154    int32_t f3 = f[3];
155    int32_t f4 = f[4];
156    int32_t f5 = f[5];
157    int32_t f6 = f[6];
158    int32_t f7 = f[7];
159    int32_t f8 = f[8];
160    int32_t f9 = f[9];
161    h[0] = f0;
162    h[1] = f1;
163    h[2] = f2;
164    h[3] = f3;
165    h[4] = f4;
166    h[5] = f5;
167    h[6] = f6;
168    h[7] = f7;
169    h[8] = f8;
170    h[9] = f9;
171  }
172  void fe_invert(fe out, const fe z) {
173    fe t0;
174    fe t1;
175    fe t2;
176    fe t3;
177    int i;
178    fe_sq(t0, z);
179    fe_sq(t1, t0);
180    fe_sq(t1, t1);
181    fe_mul(t1, z, t1);
182    fe_mul(t0, t0, t1);
183    fe_sq(t2, t0);
184    fe_mul(t1, t1, t2);
185    fe_sq(t2, t1);
186    for (i = 0; i < 4; ++i) {
187      fe_sq(t2, t2);
188    }
189    fe_mul(t1, t2, t1);
190    fe_sq(t2, t1);
191    for (i = 0; i < 9; ++i) {
192      fe_sq(t2, t2);
193    }
194    fe_mul(t2, t2, t1);
195    fe_sq(t3, t2);
196    for (i = 0; i < 19; ++i) {
197      fe_sq(t3, t3);
198    }
199    fe_mul(t2, t3, t2);
200    fe_sq(t2, t2);
201    for (i = 0; i < 9; ++i) {
202      fe_sq(t2, t2);
203    }
204    fe_mul(t1, t2, t1);
205    fe_sq(t2, t1);
206    for (i = 0; i < 49; ++i) {
207      fe_sq(t2, t2);
208    }
209    fe_mul(t2, t2, t1);
210    fe_sq(t3, t2);
211    for (i = 0; i < 99; ++i) {
212      fe_sq(t3, t3);
213    }
214    fe_mul(t2, t3, t2);
215    fe_sq(t2, t2);
216    for (i = 0; i < 49; ++i) {
217      fe_sq(t2, t2);
218    }
219    fe_mul(t1, t2, t1);
220    fe_sq(t1, t1);
221    for (i = 0; i < 4; ++i) {
222      fe_sq(t1, t1);
223    }
224    fe_mul(out, t1, t0);
225    return;
226  }
227  static int fe_isnegative(const fe f) {
228    unsigned char s[32];
229    fe_tobytes(s, f);
230    return s[0] & 1;
231  }
232  static int fe_isnonzero(const fe f) {
233    unsigned char s[32];
234    fe_tobytes(s, f);
235    return (((int) (s[0] | s[1] | s[2] | s[3] | s[4] | s[5] | s[6] | s[7] | s[8] |
236      s[9] | s[10] | s[11] | s[12] | s[13] | s[14] | s[15] | s[16] | s[17] |
237      s[18] | s[19] | s[20] | s[21] | s[22] | s[23] | s[24] | s[25] | s[26] |
238      s[27] | s[28] | s[29] | s[30] | s[31]) - 1) >> 8) + 1;
239  }
240  static void fe_mul(fe h, const fe f, const fe g) {
241    int32_t f0 = f[0];
242    int32_t f1 = f[1];
243    int32_t f2 = f[2];
244    int32_t f3 = f[3];
245    int32_t f4 = f[4];
246    int32_t f5 = f[5];
247    int32_t f6 = f[6];
248    int32_t f7 = f[7];
249    int32_t f8 = f[8];
250    int32_t f9 = f[9];
251    int32_t g0 = g[0];
252    int32_t g1 = g[1];
253    int32_t g2 = g[2];
254    int32_t g3 = g[3];
255    int32_t g4 = g[4];
256    int32_t g5 = g[5];
257    int32_t g6 = g[6];
258    int32_t g7 = g[7];
259    int32_t g8 = g[8];
260    int32_t g9 = g[9];
261    int32_t g1_19 = 19 * g1; &bsol;* 1.959375*2^29 */
262    int32_t g2_19 = 19 * g2; &bsol;* 1.959375*2^30; still ok */
263    int32_t g3_19 = 19 * g3;
264    int32_t g4_19 = 19 * g4;
265    int32_t g5_19 = 19 * g5;
266    int32_t g6_19 = 19 * g6;
267    int32_t g7_19 = 19 * g7;
268    int32_t g8_19 = 19 * g8;
269    int32_t g9_19 = 19 * g9;
270    int32_t f1_2 = 2 * f1;
271    int32_t f3_2 = 2 * f3;
272    int32_t f5_2 = 2 * f5;
273    int32_t f7_2 = 2 * f7;
274    int32_t f9_2 = 2 * f9;
275    int64_t f0g0    = f0   * (int64_t) g0;
276    int64_t f0g1    = f0   * (int64_t) g1;
277    int64_t f0g2    = f0   * (int64_t) g2;
278    int64_t f0g3    = f0   * (int64_t) g3;
279    int64_t f0g4    = f0   * (int64_t) g4;
280    int64_t f0g5    = f0   * (int64_t) g5;
281    int64_t f0g6    = f0   * (int64_t) g6;
282    int64_t f0g7    = f0   * (int64_t) g7;
283    int64_t f0g8    = f0   * (int64_t) g8;
284    int64_t f0g9    = f0   * (int64_t) g9;
285    int64_t f1g0    = f1   * (int64_t) g0;
286    int64_t f1g1_2  = f1_2 * (int64_t) g1;
287    int64_t f1g2    = f1   * (int64_t) g2;
288    int64_t f1g3_2  = f1_2 * (int64_t) g3;
289    int64_t f1g4    = f1   * (int64_t) g4;
290    int64_t f1g5_2  = f1_2 * (int64_t) g5;
291    int64_t f1g6    = f1   * (int64_t) g6;
292    int64_t f1g7_2  = f1_2 * (int64_t) g7;
293    int64_t f1g8    = f1   * (int64_t) g8;
294    int64_t f1g9_38 = f1_2 * (int64_t) g9_19;
295    int64_t f2g0    = f2   * (int64_t) g0;
296    int64_t f2g1    = f2   * (int64_t) g1;
297    int64_t f2g2    = f2   * (int64_t) g2;
298    int64_t f2g3    = f2   * (int64_t) g3;
299    int64_t f2g4    = f2   * (int64_t) g4;
300    int64_t f2g5    = f2   * (int64_t) g5;
301    int64_t f2g6    = f2   * (int64_t) g6;
302    int64_t f2g7    = f2   * (int64_t) g7;
303    int64_t f2g8_19 = f2   * (int64_t) g8_19;
304    int64_t f2g9_19 = f2   * (int64_t) g9_19;
305    int64_t f3g0    = f3   * (int64_t) g0;
306    int64_t f3g1_2  = f3_2 * (int64_t) g1;
307    int64_t f3g2    = f3   * (int64_t) g2;
308    int64_t f3g3_2  = f3_2 * (int64_t) g3;
309    int64_t f3g4    = f3   * (int64_t) g4;
310    int64_t f3g5_2  = f3_2 * (int64_t) g5;
311    int64_t f3g6    = f3   * (int64_t) g6;
312    int64_t f3g7_38 = f3_2 * (int64_t) g7_19;
313    int64_t f3g8_19 = f3   * (int64_t) g8_19;
314    int64_t f3g9_38 = f3_2 * (int64_t) g9_19;
315    int64_t f4g0    = f4   * (int64_t) g0;
316    int64_t f4g1    = f4   * (int64_t) g1;
317    int64_t f4g2    = f4   * (int64_t) g2;
318    int64_t f4g3    = f4   * (int64_t) g3;
319    int64_t f4g4    = f4   * (int64_t) g4;
320    int64_t f4g5    = f4   * (int64_t) g5;
321    int64_t f4g6_19 = f4   * (int64_t) g6_19;
322    int64_t f4g7_19 = f4   * (int64_t) g7_19;
323    int64_t f4g8_19 = f4   * (int64_t) g8_19;
324    int64_t f4g9_19 = f4   * (int64_t) g9_19;
325    int64_t f5g0    = f5   * (int64_t) g0;
326    int64_t f5g1_2  = f5_2 * (int64_t) g1;
327    int64_t f5g2    = f5   * (int64_t) g2;
328    int64_t f5g3_2  = f5_2 * (int64_t) g3;
329    int64_t f5g4    = f5   * (int64_t) g4;
330    int64_t f5g5_38 = f5_2 * (int64_t) g5_19;
331    int64_t f5g6_19 = f5   * (int64_t) g6_19;
332    int64_t f5g7_38 = f5_2 * (int64_t) g7_19;
333    int64_t f5g8_19 = f5   * (int64_t) g8_19;
334    int64_t f5g9_38 = f5_2 * (int64_t) g9_19;
335    int64_t f6g0    = f6   * (int64_t) g0;
336    int64_t f6g1    = f6   * (int64_t) g1;
337    int64_t f6g2    = f6   * (int64_t) g2;
338    int64_t f6g3    = f6   * (int64_t) g3;
339    int64_t f6g4_19 = f6   * (int64_t) g4_19;
340    int64_t f6g5_19 = f6   * (int64_t) g5_19;
341    int64_t f6g6_19 = f6   * (int64_t) g6_19;
342    int64_t f6g7_19 = f6   * (int64_t) g7_19;
343    int64_t f6g8_19 = f6   * (int64_t) g8_19;
344    int64_t f6g9_19 = f6   * (int64_t) g9_19;
345    int64_t f7g0    = f7   * (int64_t) g0;
346    int64_t f7g1_2  = f7_2 * (int64_t) g1;
347    int64_t f7g2    = f7   * (int64_t) g2;
348    int64_t f7g3_38 = f7_2 * (int64_t) g3_19;
349    int64_t f7g4_19 = f7   * (int64_t) g4_19;
350    int64_t f7g5_38 = f7_2 * (int64_t) g5_19;
351    int64_t f7g6_19 = f7   * (int64_t) g6_19;
352    int64_t f7g7_38 = f7_2 * (int64_t) g7_19;
353    int64_t f7g8_19 = f7   * (int64_t) g8_19;
354    int64_t f7g9_38 = f7_2 * (int64_t) g9_19;
355    int64_t f8g0    = f8   * (int64_t) g0;
356    int64_t f8g1    = f8   * (int64_t) g1;
357    int64_t f8g2_19 = f8   * (int64_t) g2_19;
358    int64_t f8g3_19 = f8   * (int64_t) g3_19;
359    int64_t f8g4_19 = f8   * (int64_t) g4_19;
360    int64_t f8g5_19 = f8   * (int64_t) g5_19;
361    int64_t f8g6_19 = f8   * (int64_t) g6_19;
362    int64_t f8g7_19 = f8   * (int64_t) g7_19;
363    int64_t f8g8_19 = f8   * (int64_t) g8_19;
364    int64_t f8g9_19 = f8   * (int64_t) g9_19;
365    int64_t f9g0    = f9   * (int64_t) g0;
366    int64_t f9g1_38 = f9_2 * (int64_t) g1_19;
367    int64_t f9g2_19 = f9   * (int64_t) g2_19;
368    int64_t f9g3_38 = f9_2 * (int64_t) g3_19;
369    int64_t f9g4_19 = f9   * (int64_t) g4_19;
370    int64_t f9g5_38 = f9_2 * (int64_t) g5_19;
371    int64_t f9g6_19 = f9   * (int64_t) g6_19;
372    int64_t f9g7_38 = f9_2 * (int64_t) g7_19;
373    int64_t f9g8_19 = f9   * (int64_t) g8_19;
374    int64_t f9g9_38 = f9_2 * (int64_t) g9_19;
375    int64_t h0 = f0g0+f1g9_38+f2g8_19+f3g7_38+f4g6_19+f5g5_38+f6g4_19+f7g3_38+f8g2_19+f9g1_38;
376    int64_t h1 = f0g1+f1g0   +f2g9_19+f3g8_19+f4g7_19+f5g6_19+f6g5_19+f7g4_19+f8g3_19+f9g2_19;
377    int64_t h2 = f0g2+f1g1_2 +f2g0   +f3g9_38+f4g8_19+f5g7_38+f6g6_19+f7g5_38+f8g4_19+f9g3_38;
378    int64_t h3 = f0g3+f1g2   +f2g1   +f3g0   +f4g9_19+f5g8_19+f6g7_19+f7g6_19+f8g5_19+f9g4_19;
379    int64_t h4 = f0g4+f1g3_2 +f2g2   +f3g1_2 +f4g0   +f5g9_38+f6g8_19+f7g7_38+f8g6_19+f9g5_38;
380    int64_t h5 = f0g5+f1g4   +f2g3   +f3g2   +f4g1   +f5g0   +f6g9_19+f7g8_19+f8g7_19+f9g6_19;
381    int64_t h6 = f0g6+f1g5_2 +f2g4   +f3g3_2 +f4g2   +f5g1_2 +f6g0   +f7g9_38+f8g8_19+f9g7_38;
382    int64_t h7 = f0g7+f1g6   +f2g5   +f3g4   +f4g3   +f5g2   +f6g1   +f7g0   +f8g9_19+f9g8_19;
383    int64_t h8 = f0g8+f1g7_2 +f2g6   +f3g5_2 +f4g4   +f5g3_2 +f6g2   +f7g1_2 +f8g0   +f9g9_38;
384    int64_t h9 = f0g9+f1g8   +f2g7   +f3g6   +f4g5   +f5g4   +f6g3   +f7g2   +f8g1   +f9g0   ;
385    int64_t carry0;
386    int64_t carry1;
387    int64_t carry2;
388    int64_t carry3;
389    int64_t carry4;
390    int64_t carry5;
391    int64_t carry6;
392    int64_t carry7;
393    int64_t carry8;
394    int64_t carry9;
395    carry0 = (h0 + (int64_t) (1<<25)) >> 26; h1 += carry0; h0 -= carry0 << 26;
396    carry4 = (h4 + (int64_t) (1<<25)) >> 26; h5 += carry4; h4 -= carry4 << 26;
397    carry1 = (h1 + (int64_t) (1<<24)) >> 25; h2 += carry1; h1 -= carry1 << 25;
398    carry5 = (h5 + (int64_t) (1<<24)) >> 25; h6 += carry5; h5 -= carry5 << 25;
399    carry2 = (h2 + (int64_t) (1<<25)) >> 26; h3 += carry2; h2 -= carry2 << 26;
400    carry6 = (h6 + (int64_t) (1<<25)) >> 26; h7 += carry6; h6 -= carry6 << 26;
401    carry3 = (h3 + (int64_t) (1<<24)) >> 25; h4 += carry3; h3 -= carry3 << 25;
402    carry7 = (h7 + (int64_t) (1<<24)) >> 25; h8 += carry7; h7 -= carry7 << 25;
403    carry4 = (h4 + (int64_t) (1<<25)) >> 26; h5 += carry4; h4 -= carry4 << 26;
404    carry8 = (h8 + (int64_t) (1<<25)) >> 26; h9 += carry8; h8 -= carry8 << 26;
405    carry9 = (h9 + (int64_t) (1<<24)) >> 25; h0 += carry9 * 19; h9 -= carry9 << 25;
406    carry0 = (h0 + (int64_t) (1<<25)) >> 26; h1 += carry0; h0 -= carry0 << 26;
407    h[0] = h0;
408    h[1] = h1;
409    h[2] = h2;
410    h[3] = h3;
411    h[4] = h4;
412    h[5] = h5;
413    h[6] = h6;
414    h[7] = h7;
415    h[8] = h8;
416    h[9] = h9;
417  }
418  static void fe_neg(fe h, const fe f) {
419    int32_t f0 = f[0];
420    int32_t f1 = f[1];
421    int32_t f2 = f[2];
422    int32_t f3 = f[3];
423    int32_t f4 = f[4];
424    int32_t f5 = f[5];
425    int32_t f6 = f[6];
426    int32_t f7 = f[7];
427    int32_t f8 = f[8];
428    int32_t f9 = f[9];
429    int32_t h0 = -f0;
430    int32_t h1 = -f1;
431    int32_t h2 = -f2;
432    int32_t h3 = -f3;
433    int32_t h4 = -f4;
434    int32_t h5 = -f5;
435    int32_t h6 = -f6;
436    int32_t h7 = -f7;
437    int32_t h8 = -f8;
438    int32_t h9 = -f9;
439    h[0] = h0;
440    h[1] = h1;
441    h[2] = h2;
442    h[3] = h3;
443    h[4] = h4;
444    h[5] = h5;
445    h[6] = h6;
446    h[7] = h7;
447    h[8] = h8;
448    h[9] = h9;
449  }
450  static void fe_sq(fe h, const fe f) {
451    int32_t f0 = f[0];
452    int32_t f1 = f[1];
453    int32_t f2 = f[2];
454    int32_t f3 = f[3];
455    int32_t f4 = f[4];
456    int32_t f5 = f[5];
457    int32_t f6 = f[6];
458    int32_t f7 = f[7];
459    int32_t f8 = f[8];
460    int32_t f9 = f[9];
461    int32_t f0_2 = 2 * f0;
462    int32_t f1_2 = 2 * f1;
463    int32_t f2_2 = 2 * f2;
464    int32_t f3_2 = 2 * f3;
465    int32_t f4_2 = 2 * f4;
466    int32_t f5_2 = 2 * f5;
467    int32_t f6_2 = 2 * f6;
468    int32_t f7_2 = 2 * f7;
469    int32_t f5_38 = 38 * f5; &bsol;* 1.959375*2^30 */
470    int32_t f6_19 = 19 * f6; &bsol;* 1.959375*2^30 */
471    int32_t f7_38 = 38 * f7; &bsol;* 1.959375*2^30 */
472    int32_t f8_19 = 19 * f8; &bsol;* 1.959375*2^30 */
473    int32_t f9_38 = 38 * f9; &bsol;* 1.959375*2^30 */
474    int64_t f0f0    = f0   * (int64_t) f0;
475    int64_t f0f1_2  = f0_2 * (int64_t) f1;
476    int64_t f0f2_2  = f0_2 * (int64_t) f2;
477    int64_t f0f3_2  = f0_2 * (int64_t) f3;
478    int64_t f0f4_2  = f0_2 * (int64_t) f4;
479    int64_t f0f5_2  = f0_2 * (int64_t) f5;
480    int64_t f0f6_2  = f0_2 * (int64_t) f6;
481    int64_t f0f7_2  = f0_2 * (int64_t) f7;
482    int64_t f0f8_2  = f0_2 * (int64_t) f8;
483    int64_t f0f9_2  = f0_2 * (int64_t) f9;
484    int64_t f1f1_2  = f1_2 * (int64_t) f1;
485    int64_t f1f2_2  = f1_2 * (int64_t) f2;
486    int64_t f1f3_4  = f1_2 * (int64_t) f3_2;
487    int64_t f1f4_2  = f1_2 * (int64_t) f4;
488    int64_t f1f5_4  = f1_2 * (int64_t) f5_2;
489    int64_t f1f6_2  = f1_2 * (int64_t) f6;
490    int64_t f1f7_4  = f1_2 * (int64_t) f7_2;
491    int64_t f1f8_2  = f1_2 * (int64_t) f8;
492    int64_t f1f9_76 = f1_2 * (int64_t) f9_38;
493    int64_t f2f2    = f2   * (int64_t) f2;
494    int64_t f2f3_2  = f2_2 * (int64_t) f3;
495    int64_t f2f4_2  = f2_2 * (int64_t) f4;
496    int64_t f2f5_2  = f2_2 * (int64_t) f5;
497    int64_t f2f6_2  = f2_2 * (int64_t) f6;
498    int64_t f2f7_2  = f2_2 * (int64_t) f7;
499    int64_t f2f8_38 = f2_2 * (int64_t) f8_19;
500    int64_t f2f9_38 = f2   * (int64_t) f9_38;
501    int64_t f3f3_2  = f3_2 * (int64_t) f3;
502    int64_t f3f4_2  = f3_2 * (int64_t) f4;
503    int64_t f3f5_4  = f3_2 * (int64_t) f5_2;
504    int64_t f3f6_2  = f3_2 * (int64_t) f6;
505    int64_t f3f7_76 = f3_2 * (int64_t) f7_38;
506    int64_t f3f8_38 = f3_2 * (int64_t) f8_19;
507    int64_t f3f9_76 = f3_2 * (int64_t) f9_38;
508    int64_t f4f4    = f4   * (int64_t) f4;
509    int64_t f4f5_2  = f4_2 * (int64_t) f5;
510    int64_t f4f6_38 = f4_2 * (int64_t) f6_19;
511    int64_t f4f7_38 = f4   * (int64_t) f7_38;
512    int64_t f4f8_38 = f4_2 * (int64_t) f8_19;
513    int64_t f4f9_38 = f4   * (int64_t) f9_38;
514    int64_t f5f5_38 = f5   * (int64_t) f5_38;
515    int64_t f5f6_38 = f5_2 * (int64_t) f6_19;
516    int64_t f5f7_76 = f5_2 * (int64_t) f7_38;
517    int64_t f5f8_38 = f5_2 * (int64_t) f8_19;
518    int64_t f5f9_76 = f5_2 * (int64_t) f9_38;
519    int64_t f6f6_19 = f6   * (int64_t) f6_19;
520    int64_t f6f7_38 = f6   * (int64_t) f7_38;
521    int64_t f6f8_38 = f6_2 * (int64_t) f8_19;
522    int64_t f6f9_38 = f6   * (int64_t) f9_38;
523    int64_t f7f7_38 = f7   * (int64_t) f7_38;
524    int64_t f7f8_38 = f7_2 * (int64_t) f8_19;
525    int64_t f7f9_76 = f7_2 * (int64_t) f9_38;
526    int64_t f8f8_19 = f8   * (int64_t) f8_19;
527    int64_t f8f9_38 = f8   * (int64_t) f9_38;
528    int64_t f9f9_38 = f9   * (int64_t) f9_38;
529    int64_t h0 = f0f0  +f1f9_76+f2f8_38+f3f7_76+f4f6_38+f5f5_38;
530    int64_t h1 = f0f1_2+f2f9_38+f3f8_38+f4f7_38+f5f6_38;
531    int64_t h2 = f0f2_2+f1f1_2 +f3f9_76+f4f8_38+f5f7_76+f6f6_19;
532    int64_t h3 = f0f3_2+f1f2_2 +f4f9_38+f5f8_38+f6f7_38;
533    int64_t h4 = f0f4_2+f1f3_4 +f2f2   +f5f9_76+f6f8_38+f7f7_38;
534    int64_t h5 = f0f5_2+f1f4_2 +f2f3_2 +f6f9_38+f7f8_38;
535    int64_t h6 = f0f6_2+f1f5_4 +f2f4_2 +f3f3_2 +f7f9_76+f8f8_19;
536    int64_t h7 = f0f7_2+f1f6_2 +f2f5_2 +f3f4_2 +f8f9_38;
537    int64_t h8 = f0f8_2+f1f7_4 +f2f6_2 +f3f5_4 +f4f4   +f9f9_38;
538    int64_t h9 = f0f9_2+f1f8_2 +f2f7_2 +f3f6_2 +f4f5_2;
539    int64_t carry0;
540    int64_t carry1;
541    int64_t carry2;
542    int64_t carry3;
543    int64_t carry4;
544    int64_t carry5;
545    int64_t carry6;
546    int64_t carry7;
547    int64_t carry8;
548    int64_t carry9;
549    carry0 = (h0 + (int64_t) (1<<25)) >> 26; h1 += carry0; h0 -= carry0 << 26;
550    carry4 = (h4 + (int64_t) (1<<25)) >> 26; h5 += carry4; h4 -= carry4 << 26;
551    carry1 = (h1 + (int64_t) (1<<24)) >> 25; h2 += carry1; h1 -= carry1 << 25;
552    carry5 = (h5 + (int64_t) (1<<24)) >> 25; h6 += carry5; h5 -= carry5 << 25;
553    carry2 = (h2 + (int64_t) (1<<25)) >> 26; h3 += carry2; h2 -= carry2 << 26;
554    carry6 = (h6 + (int64_t) (1<<25)) >> 26; h7 += carry6; h6 -= carry6 << 26;
555    carry3 = (h3 + (int64_t) (1<<24)) >> 25; h4 += carry3; h3 -= carry3 << 25;
556    carry7 = (h7 + (int64_t) (1<<24)) >> 25; h8 += carry7; h7 -= carry7 << 25;
557    carry4 = (h4 + (int64_t) (1<<25)) >> 26; h5 += carry4; h4 -= carry4 << 26;
558    carry8 = (h8 + (int64_t) (1<<25)) >> 26; h9 += carry8; h8 -= carry8 << 26;
559    carry9 = (h9 + (int64_t) (1<<24)) >> 25; h0 += carry9 * 19; h9 -= carry9 << 25;
560    carry0 = (h0 + (int64_t) (1<<25)) >> 26; h1 += carry0; h0 -= carry0 << 26;
561    h[0] = h0;
562    h[1] = h1;
563    h[2] = h2;
564    h[3] = h3;
565    h[4] = h4;
566    h[5] = h5;
567    h[6] = h6;
568    h[7] = h7;
569    h[8] = h8;
570    h[9] = h9;
571  }
572  static void fe_sq2(fe h, const fe f) {
573    int32_t f0 = f[0];
574    int32_t f1 = f[1];
575    int32_t f2 = f[2];
576    int32_t f3 = f[3];
577    int32_t f4 = f[4];
578    int32_t f5 = f[5];
579    int32_t f6 = f[6];
580    int32_t f7 = f[7];
581    int32_t f8 = f[8];
582    int32_t f9 = f[9];
583    int32_t f0_2 = 2 * f0;
584    int32_t f1_2 = 2 * f1;
585    int32_t f2_2 = 2 * f2;
586    int32_t f3_2 = 2 * f3;
587    int32_t f4_2 = 2 * f4;
588    int32_t f5_2 = 2 * f5;
589    int32_t f6_2 = 2 * f6;
590    int32_t f7_2 = 2 * f7;
591    int32_t f5_38 = 38 * f5; &bsol;* 1.959375*2^30 */
592    int32_t f6_19 = 19 * f6; &bsol;* 1.959375*2^30 */
593    int32_t f7_38 = 38 * f7; &bsol;* 1.959375*2^30 */
594    int32_t f8_19 = 19 * f8; &bsol;* 1.959375*2^30 */
595    int32_t f9_38 = 38 * f9; &bsol;* 1.959375*2^30 */
596    int64_t f0f0    = f0   * (int64_t) f0;
597    int64_t f0f1_2  = f0_2 * (int64_t) f1;
598    int64_t f0f2_2  = f0_2 * (int64_t) f2;
599    int64_t f0f3_2  = f0_2 * (int64_t) f3;
600    int64_t f0f4_2  = f0_2 * (int64_t) f4;
601    int64_t f0f5_2  = f0_2 * (int64_t) f5;
602    int64_t f0f6_2  = f0_2 * (int64_t) f6;
603    int64_t f0f7_2  = f0_2 * (int64_t) f7;
604    int64_t f0f8_2  = f0_2 * (int64_t) f8;
605    int64_t f0f9_2  = f0_2 * (int64_t) f9;
606    int64_t f1f1_2  = f1_2 * (int64_t) f1;
607    int64_t f1f2_2  = f1_2 * (int64_t) f2;
608    int64_t f1f3_4  = f1_2 * (int64_t) f3_2;
609    int64_t f1f4_2  = f1_2 * (int64_t) f4;
610    int64_t f1f5_4  = f1_2 * (int64_t) f5_2;
611    int64_t f1f6_2  = f1_2 * (int64_t) f6;
612    int64_t f1f7_4  = f1_2 * (int64_t) f7_2;
613    int64_t f1f8_2  = f1_2 * (int64_t) f8;
614    int64_t f1f9_76 = f1_2 * (int64_t) f9_38;
615    int64_t f2f2    = f2   * (int64_t) f2;
616    int64_t f2f3_2  = f2_2 * (int64_t) f3;
617    int64_t f2f4_2  = f2_2 * (int64_t) f4;
618    int64_t f2f5_2  = f2_2 * (int64_t) f5;
619    int64_t f2f6_2  = f2_2 * (int64_t) f6;
620    int64_t f2f7_2  = f2_2 * (int64_t) f7;
621    int64_t f2f8_38 = f2_2 * (int64_t) f8_19;
622    int64_t f2f9_38 = f2   * (int64_t) f9_38;
623    int64_t f3f3_2  = f3_2 * (int64_t) f3;
624    int64_t f3f4_2  = f3_2 * (int64_t) f4;
625    int64_t f3f5_4  = f3_2 * (int64_t) f5_2;
626    int64_t f3f6_2  = f3_2 * (int64_t) f6;
627    int64_t f3f7_76 = f3_2 * (int64_t) f7_38;
628    int64_t f3f8_38 = f3_2 * (int64_t) f8_19;
629    int64_t f3f9_76 = f3_2 * (int64_t) f9_38;
630    int64_t f4f4    = f4   * (int64_t) f4;
631    int64_t f4f5_2  = f4_2 * (int64_t) f5;
632    int64_t f4f6_38 = f4_2 * (int64_t) f6_19;
633    int64_t f4f7_38 = f4   * (int64_t) f7_38;
634    int64_t f4f8_38 = f4_2 * (int64_t) f8_19;
635    int64_t f4f9_38 = f4   * (int64_t) f9_38;
636    int64_t f5f5_38 = f5   * (int64_t) f5_38;
637    int64_t f5f6_38 = f5_2 * (int64_t) f6_19;
638    int64_t f5f7_76 = f5_2 * (int64_t) f7_38;
639    int64_t f5f8_38 = f5_2 * (int64_t) f8_19;
640    int64_t f5f9_76 = f5_2 * (int64_t) f9_38;
641    int64_t f6f6_19 = f6   * (int64_t) f6_19;
642    int64_t f6f7_38 = f6   * (int64_t) f7_38;
643    int64_t f6f8_38 = f6_2 * (int64_t) f8_19;
644    int64_t f6f9_38 = f6   * (int64_t) f9_38;
645    int64_t f7f7_38 = f7   * (int64_t) f7_38;
646    int64_t f7f8_38 = f7_2 * (int64_t) f8_19;
647    int64_t f7f9_76 = f7_2 * (int64_t) f9_38;
648    int64_t f8f8_19 = f8   * (int64_t) f8_19;
649    int64_t f8f9_38 = f8   * (int64_t) f9_38;
650    int64_t f9f9_38 = f9   * (int64_t) f9_38;
651    int64_t h0 = f0f0  +f1f9_76+f2f8_38+f3f7_76+f4f6_38+f5f5_38;
652    int64_t h1 = f0f1_2+f2f9_38+f3f8_38+f4f7_38+f5f6_38;
653    int64_t h2 = f0f2_2+f1f1_2 +f3f9_76+f4f8_38+f5f7_76+f6f6_19;
654    int64_t h3 = f0f3_2+f1f2_2 +f4f9_38+f5f8_38+f6f7_38;
655    int64_t h4 = f0f4_2+f1f3_4 +f2f2   +f5f9_76+f6f8_38+f7f7_38;
656    int64_t h5 = f0f5_2+f1f4_2 +f2f3_2 +f6f9_38+f7f8_38;
657    int64_t h6 = f0f6_2+f1f5_4 +f2f4_2 +f3f3_2 +f7f9_76+f8f8_19;
658    int64_t h7 = f0f7_2+f1f6_2 +f2f5_2 +f3f4_2 +f8f9_38;
659    int64_t h8 = f0f8_2+f1f7_4 +f2f6_2 +f3f5_4 +f4f4   +f9f9_38;
660    int64_t h9 = f0f9_2+f1f8_2 +f2f7_2 +f3f6_2 +f4f5_2;
661    int64_t carry0;
662    int64_t carry1;
663    int64_t carry2;
664    int64_t carry3;
665    int64_t carry4;
666    int64_t carry5;
667    int64_t carry6;
668    int64_t carry7;
669    int64_t carry8;
670    int64_t carry9;
671    h0 += h0;
672    h1 += h1;
673    h2 += h2;
674    h3 += h3;
675    h4 += h4;
676    h5 += h5;
677    h6 += h6;
678    h7 += h7;
679    h8 += h8;
680    h9 += h9;
681    carry0 = (h0 + (int64_t) (1<<25)) >> 26; h1 += carry0; h0 -= carry0 << 26;
682    carry4 = (h4 + (int64_t) (1<<25)) >> 26; h5 += carry4; h4 -= carry4 << 26;
683    carry1 = (h1 + (int64_t) (1<<24)) >> 25; h2 += carry1; h1 -= carry1 << 25;
684    carry5 = (h5 + (int64_t) (1<<24)) >> 25; h6 += carry5; h5 -= carry5 << 25;
685    carry2 = (h2 + (int64_t) (1<<25)) >> 26; h3 += carry2; h2 -= carry2 << 26;
686    carry6 = (h6 + (int64_t) (1<<25)) >> 26; h7 += carry6; h6 -= carry6 << 26;
687    carry3 = (h3 + (int64_t) (1<<24)) >> 25; h4 += carry3; h3 -= carry3 << 25;
688    carry7 = (h7 + (int64_t) (1<<24)) >> 25; h8 += carry7; h7 -= carry7 << 25;
689    carry4 = (h4 + (int64_t) (1<<25)) >> 26; h5 += carry4; h4 -= carry4 << 26;
690    carry8 = (h8 + (int64_t) (1<<25)) >> 26; h9 += carry8; h8 -= carry8 << 26;
691    carry9 = (h9 + (int64_t) (1<<24)) >> 25; h0 += carry9 * 19; h9 -= carry9 << 25;
692    carry0 = (h0 + (int64_t) (1<<25)) >> 26; h1 += carry0; h0 -= carry0 << 26;
693    h[0] = h0;
694    h[1] = h1;
695    h[2] = h2;
696    h[3] = h3;
697    h[4] = h4;
698    h[5] = h5;
699    h[6] = h6;
700    h[7] = h7;
701    h[8] = h8;
702    h[9] = h9;
703  }
704  static void fe_sub(fe h, const fe f, const fe g) {
705    int32_t f0 = f[0];
706    int32_t f1 = f[1];
707    int32_t f2 = f[2];
708    int32_t f3 = f[3];
709    int32_t f4 = f[4];
710    int32_t f5 = f[5];
711    int32_t f6 = f[6];
712    int32_t f7 = f[7];
713    int32_t f8 = f[8];
714    int32_t f9 = f[9];
715    int32_t g0 = g[0];
716    int32_t g1 = g[1];
717    int32_t g2 = g[2];
718    int32_t g3 = g[3];
719    int32_t g4 = g[4];
720    int32_t g5 = g[5];
721    int32_t g6 = g[6];
722    int32_t g7 = g[7];
723    int32_t g8 = g[8];
724    int32_t g9 = g[9];
725    int32_t h0 = f0 - g0;
726    int32_t h1 = f1 - g1;
727    int32_t h2 = f2 - g2;
728    int32_t h3 = f3 - g3;
729    int32_t h4 = f4 - g4;
730    int32_t h5 = f5 - g5;
731    int32_t h6 = f6 - g6;
732    int32_t h7 = f7 - g7;
733    int32_t h8 = f8 - g8;
734    int32_t h9 = f9 - g9;
735    h[0] = h0;
736    h[1] = h1;
737    h[2] = h2;
738    h[3] = h3;
739    h[4] = h4;
740    h[5] = h5;
741    h[6] = h6;
742    h[7] = h7;
743    h[8] = h8;
744    h[9] = h9;
745  }
746  void fe_tobytes(unsigned char *s, const fe h) {
747    int32_t h0 = h[0];
748    int32_t h1 = h[1];
749    int32_t h2 = h[2];
750    int32_t h3 = h[3];
751    int32_t h4 = h[4];
752    int32_t h5 = h[5];
753    int32_t h6 = h[6];
754    int32_t h7 = h[7];
755    int32_t h8 = h[8];
756    int32_t h9 = h[9];
757    int32_t q;
758    int32_t carry0;
759    int32_t carry1;
760    int32_t carry2;
761    int32_t carry3;
762    int32_t carry4;
763    int32_t carry5;
764    int32_t carry6;
765    int32_t carry7;
766    int32_t carry8;
767    int32_t carry9;
768    q = (19 * h9 + (((int32_t) 1) << 24)) >> 25;
769    q = (h0 + q) >> 26;
770    q = (h1 + q) >> 25;
771    q = (h2 + q) >> 26;
772    q = (h3 + q) >> 25;
773    q = (h4 + q) >> 26;
774    q = (h5 + q) >> 25;
775    q = (h6 + q) >> 26;
776    q = (h7 + q) >> 25;
777    q = (h8 + q) >> 26;
778    q = (h9 + q) >> 25;
779    h0 += 19 * q;
780    carry0 = h0 >> 26; h1 += carry0; h0 -= carry0 << 26;
781    carry1 = h1 >> 25; h2 += carry1; h1 -= carry1 << 25;
782    carry2 = h2 >> 26; h3 += carry2; h2 -= carry2 << 26;
783    carry3 = h3 >> 25; h4 += carry3; h3 -= carry3 << 25;
784    carry4 = h4 >> 26; h5 += carry4; h4 -= carry4 << 26;
785    carry5 = h5 >> 25; h6 += carry5; h5 -= carry5 << 25;
786    carry6 = h6 >> 26; h7 += carry6; h6 -= carry6 << 26;
787    carry7 = h7 >> 25; h8 += carry7; h7 -= carry7 << 25;
788    carry8 = h8 >> 26; h9 += carry8; h8 -= carry8 << 26;
789    carry9 = h9 >> 25;               h9 -= carry9 << 25;
790    s[0] = h0 >> 0;
791    s[1] = h0 >> 8;
792    s[2] = h0 >> 16;
793    s[3] = (h0 >> 24) | (h1 << 2);
794    s[4] = h1 >> 6;
795    s[5] = h1 >> 14;
796    s[6] = (h1 >> 22) | (h2 << 3);
797    s[7] = h2 >> 5;
798    s[8] = h2 >> 13;
799    s[9] = (h2 >> 21) | (h3 << 5);
800    s[10] = h3 >> 3;
801    s[11] = h3 >> 11;
802    s[12] = (h3 >> 19) | (h4 << 6);
803    s[13] = h4 >> 2;
804    s[14] = h4 >> 10;
805    s[15] = h4 >> 18;
806    s[16] = h5 >> 0;
807    s[17] = h5 >> 8;
808    s[18] = h5 >> 16;
809    s[19] = (h5 >> 24) | (h6 << 1);
810    s[20] = h6 >> 7;
811    s[21] = h6 >> 15;
812    s[22] = (h6 >> 23) | (h7 << 3);
813    s[23] = h7 >> 5;
814    s[24] = h7 >> 13;
815    s[25] = (h7 >> 21) | (h8 << 4);
816    s[26] = h8 >> 4;
817    s[27] = h8 >> 12;
818    s[28] = (h8 >> 20) | (h9 << 6);
819    s[29] = h9 >> 2;
820    s[30] = h9 >> 10;
821    s[31] = h9 >> 18;
822  }
823  void ge_add(ge_p1p1 *r, const ge_p3 *p, const ge_cached *q) {
824    fe t0;
825    fe_add(r->X, p->Y, p->X);
826    fe_sub(r->Y, p->Y, p->X);
827    fe_mul(r->Z, r->X, q->YplusX);
828    fe_mul(r->Y, r->Y, q->YminusX);
829    fe_mul(r->T, q->T2d, p->T);
830    fe_mul(r->X, p->Z, q->Z);
831    fe_add(t0, r->X, r->X);
832    fe_sub(r->X, r->Z, r->Y);
833    fe_add(r->Y, r->Z, r->Y);
834    fe_add(r->Z, t0, r->T);
835    fe_sub(r->T, t0, r->T);
836  }
837  static void slide(signed char *r, const unsigned char *a) {
838    int i;
839    int b;
840    int k;
841    for (i = 0; i < 256; ++i) {
842      r[i] = 1 & (a[i >> 3] >> (i & 7));
843    }
844    for (i = 0; i < 256; ++i) {
845      if (r[i]) {
846        for (b = 1; b <= 6 && i + b < 256; ++b) {
847          if (r[i + b]) {
848            if (r[i] + (r[i + b] << b) <= 15) {
849              r[i] += r[i + b] << b; r[i + b] = 0;
850            } else if (r[i] - (r[i + b] << b) >= -15) {
851              r[i] -= r[i + b] << b;
852              for (k = i + b; k < 256; ++k) {
853                if (!r[k]) {
854                  r[k] = 1;
855                  break;
856                }
857                r[k] = 0;
858              }
859            } else
860              break;
861          }
862        }
863      }
864    }
865  }
866  void ge_dsm_precomp(ge_dsmp r, const ge_p3 *s) {
867    ge_p1p1 t;
868    ge_p3 s2, u;
869    ge_p3_to_cached(&r[0], s);
870    ge_p3_dbl(&t, s); ge_p1p1_to_p3(&s2, &t);
871    ge_add(&t, &s2, &r[0]); ge_p1p1_to_p3(&u, &t); ge_p3_to_cached(&r[1], &u);
872    ge_add(&t, &s2, &r[1]); ge_p1p1_to_p3(&u, &t); ge_p3_to_cached(&r[2], &u);
873    ge_add(&t, &s2, &r[2]); ge_p1p1_to_p3(&u, &t); ge_p3_to_cached(&r[3], &u);
874    ge_add(&t, &s2, &r[3]); ge_p1p1_to_p3(&u, &t); ge_p3_to_cached(&r[4], &u);
875    ge_add(&t, &s2, &r[4]); ge_p1p1_to_p3(&u, &t); ge_p3_to_cached(&r[5], &u);
876    ge_add(&t, &s2, &r[5]); ge_p1p1_to_p3(&u, &t); ge_p3_to_cached(&r[6], &u);
877    ge_add(&t, &s2, &r[6]); ge_p1p1_to_p3(&u, &t); ge_p3_to_cached(&r[7], &u);
878  }
879  void ge_double_scalarmult_base_vartime(ge_p2 *r, const unsigned char *a, const ge_p3 *A, const unsigned char *b) {
880    signed char aslide[256];
881    signed char bslide[256];
882    ge_dsmp Ai; &bsol;* A, 3A, 5A, 7A, 9A, 11A, 13A, 15A */
883    ge_p1p1 t;
884    ge_p3 u;
885    int i;
886    slide(aslide, a);
887    slide(bslide, b);
888    ge_dsm_precomp(Ai, A);
889    ge_p2_0(r);
890    for (i = 255; i >= 0; --i) {
891      if (aslide[i] || bslide[i]) break;
892    }
893    for (; i >= 0; --i) {
894      ge_p2_dbl(&t, r);
895      if (aslide[i] > 0) {
896        ge_p1p1_to_p3(&u, &t);
897        ge_add(&t, &u, &Ai[aslide[i]/2]);
898      } else if (aslide[i] < 0) {
899        ge_p1p1_to_p3(&u, &t);
900        ge_sub(&t, &u, &Ai[(-aslide[i])/2]);
901      }
902      if (bslide[i] > 0) {
903        ge_p1p1_to_p3(&u, &t);
904        ge_madd(&t, &u, &ge_Bi[bslide[i]/2]);
905      } else if (bslide[i] < 0) {
906        ge_p1p1_to_p3(&u, &t);
907        ge_msub(&t, &u, &ge_Bi[(-bslide[i])/2]);
908      }
909      ge_p1p1_to_p2(r, &t);
910    }
911  }
912  void ge_triple_scalarmult_base_vartime(ge_p2 *r, const unsigned char *a, const unsigned char *b, const ge_dsmp Bi, const unsigned char *c, const ge_dsmp Ci) {
913    signed char aslide[256];
914    signed char bslide[256];
915    signed char cslide[256];
916    ge_p1p1 t;
917    ge_p3 u;
918    int i;
919    slide(aslide, a);
920    slide(bslide, b);
921    slide(cslide, c);
922    ge_p2_0(r);
923    for (i = 255; i >= 0; --i) {
924      if (aslide[i] || bslide[i] || cslide[i]) break;
925    }
926    for (; i >= 0; --i) {
927      ge_p2_dbl(&t, r);
928      if (aslide[i] > 0) {
929        ge_p1p1_to_p3(&u, &t);
930        ge_madd(&t, &u, &ge_Bi[aslide[i]/2]);
931      } else if (aslide[i] < 0) {
932        ge_p1p1_to_p3(&u, &t);
933        ge_msub(&t, &u, &ge_Bi[(-aslide[i])/2]);
934      }
935      if (bslide[i] > 0) {
936        ge_p1p1_to_p3(&u, &t);
937        ge_add(&t, &u, &Bi[bslide[i]/2]);
938      } else if (bslide[i] < 0) {
939        ge_p1p1_to_p3(&u, &t);
940        ge_sub(&t, &u, &Bi[(-bslide[i])/2]);
941      }
942      if (cslide[i] > 0) {
943        ge_p1p1_to_p3(&u, &t);
944        ge_add(&t, &u, &Ci[cslide[i]/2]);
945      } else if (cslide[i] < 0) {
946        ge_p1p1_to_p3(&u, &t);
947        ge_sub(&t, &u, &Ci[(-cslide[i])/2]);
948      }
949      ge_p1p1_to_p2(r, &t);
950    }
951  }
952  void ge_double_scalarmult_base_vartime_p3(ge_p3 *r3, const unsigned char *a, const ge_p3 *A, const unsigned char *b) {
953    signed char aslide[256];
954    signed char bslide[256];
955    ge_dsmp Ai; &bsol;* A, 3A, 5A, 7A, 9A, 11A, 13A, 15A */
956    ge_p1p1 t;
957    ge_p3 u;
958    ge_p2 r;
959    int i;
960    slide(aslide, a);
961    slide(bslide, b);
962    ge_dsm_precomp(Ai, A);
963    ge_p2_0(&r);
964    for (i = 255; i >= 0; --i) {
965      if (aslide[i] || bslide[i]) break;
966    }
967    for (; i >= 0; --i) {
968      ge_p2_dbl(&t, &r);
969      if (aslide[i] > 0) {
970        ge_p1p1_to_p3(&u, &t);
971        ge_add(&t, &u, &Ai[aslide[i]/2]);
972      } else if (aslide[i] < 0) {
973        ge_p1p1_to_p3(&u, &t);
974        ge_sub(&t, &u, &Ai[(-aslide[i])/2]);
975      }
976      if (bslide[i] > 0) {
977        ge_p1p1_to_p3(&u, &t);
978        ge_madd(&t, &u, &ge_Bi[bslide[i]/2]);
979      } else if (bslide[i] < 0) {
980        ge_p1p1_to_p3(&u, &t);
981        ge_msub(&t, &u, &ge_Bi[(-bslide[i])/2]);
982      }
983      if (i == 0)
984        ge_p1p1_to_p3(r3, &t);
985      else
986        ge_p1p1_to_p2(&r, &t);
987    }
988  }
989  int ge_frombytes_vartime(ge_p3 *h, const unsigned char *s) {
990    fe u;
991    fe v;
992    fe vxx;
993    fe check;
994    int64_t h0 = load_4(s);
995    int64_t h1 = load_3(s + 4) << 6;
996    int64_t h2 = load_3(s + 7) << 5;
997    int64_t h3 = load_3(s + 10) << 3;
998    int64_t h4 = load_3(s + 13) << 2;
<span onclick='openModal()' class='match'>999    int64_t h5 = load_4(s + 16);
1000    int64_t h6 = load_3(s + 20) << 7;
1001    int64_t h7 = load_3(s + 23) << 5;
1002    int64_t h8 = load_3(s + 26) << 4;
1003    int64_t h9 = (load_3(s + 29) & 8388607) << 2;
1004    int64_t carry0;
</span>1005    int64_t carry1;
1006    int64_t carry2;
1007    int64_t carry3;
1008    int64_t carry4;
1009    int64_t carry5;
1010    int64_t carry6;
1011    int64_t carry7;
1012    int64_t carry8;
1013    int64_t carry9;
1014    if (h9 == 33554428 && h8 == 268435440 && h7 == 536870880 && h6 == 2147483520 &&
1015      h5 == 4294967295 && h4 == 67108860 && h3 == 134217720 && h2 == 536870880 &&
1016      h1 == 1073741760 && h0 >= 4294967277) {
1017      return -1;
1018    }
1019    carry9 = (h9 + (int64_t) (1<<24)) >> 25; h0 += carry9 * 19; h9 -= carry9 << 25;
1020    carry1 = (h1 + (int64_t) (1<<24)) >> 25; h2 += carry1; h1 -= carry1 << 25;
1021    carry3 = (h3 + (int64_t) (1<<24)) >> 25; h4 += carry3; h3 -= carry3 << 25;
1022    carry5 = (h5 + (int64_t) (1<<24)) >> 25; h6 += carry5; h5 -= carry5 << 25;
1023    carry7 = (h7 + (int64_t) (1<<24)) >> 25; h8 += carry7; h7 -= carry7 << 25;
1024    carry0 = (h0 + (int64_t) (1<<25)) >> 26; h1 += carry0; h0 -= carry0 << 26;
1025    carry2 = (h2 + (int64_t) (1<<25)) >> 26; h3 += carry2; h2 -= carry2 << 26;
1026    carry4 = (h4 + (int64_t) (1<<25)) >> 26; h5 += carry4; h4 -= carry4 << 26;
1027    carry6 = (h6 + (int64_t) (1<<25)) >> 26; h7 += carry6; h6 -= carry6 << 26;
1028    carry8 = (h8 + (int64_t) (1<<25)) >> 26; h9 += carry8; h8 -= carry8 << 26;
1029    h->Y[0] = h0;
1030    h->Y[1] = h1;
1031    h->Y[2] = h2;
1032    h->Y[3] = h3;
1033    h->Y[4] = h4;
1034    h->Y[5] = h5;
1035    h->Y[6] = h6;
1036    h->Y[7] = h7;
1037    h->Y[8] = h8;
1038    h->Y[9] = h9;
1039    fe_1(h->Z);
1040    fe_sq(u, h->Y);
1041    fe_mul(v, u, fe_d);
1042    fe_sub(u, u, h->Z);       &bsol;* u = y^2-1 */
1043    fe_add(v, v, h->Z);       &bsol;* v = dy^2+1 */
1044    fe_divpowm1(h->X, u, v); &bsol;* x = uv^3(uv^7)^((q-5)/8) */
1045    fe_sq(vxx, h->X);
1046    fe_mul(vxx, vxx, v);
1047    fe_sub(check, vxx, u);    &bsol;* vx^2-u */
1048    if (fe_isnonzero(check)) {
1049      fe_add(check, vxx, u);  &bsol;* vx^2+u */
1050      if (fe_isnonzero(check)) {
1051        return -1;
1052      }
1053      fe_mul(h->X, h->X, fe_sqrtm1);
1054    }
1055    if (fe_isnegative(h->X) != (s[31] >> 7)) {
1056      if (!fe_isnonzero(h->X)) {
1057        return -1;
1058      }
1059      fe_neg(h->X, h->X);
1060    }
1061    fe_mul(h->T, h->X, h->Y);
1062    return 0;
1063  }
1064  static void ge_madd(ge_p1p1 *r, const ge_p3 *p, const ge_precomp *q) {
1065    fe t0;
1066    fe_add(r->X, p->Y, p->X);
1067    fe_sub(r->Y, p->Y, p->X);
1068    fe_mul(r->Z, r->X, q->yplusx);
1069    fe_mul(r->Y, r->Y, q->yminusx);
1070    fe_mul(r->T, q->xy2d, p->T);
1071    fe_add(t0, p->Z, p->Z);
1072    fe_sub(r->X, r->Z, r->Y);
1073    fe_add(r->Y, r->Z, r->Y);
1074    fe_add(r->Z, t0, r->T);
1075    fe_sub(r->T, t0, r->T);
1076  }
1077  static void ge_msub(ge_p1p1 *r, const ge_p3 *p, const ge_precomp *q) {
1078    fe t0;
1079    fe_add(r->X, p->Y, p->X);
1080    fe_sub(r->Y, p->Y, p->X);
1081    fe_mul(r->Z, r->X, q->yminusx);
1082    fe_mul(r->Y, r->Y, q->yplusx);
1083    fe_mul(r->T, q->xy2d, p->T);
1084    fe_add(t0, p->Z, p->Z);
1085    fe_sub(r->X, r->Z, r->Y);
1086    fe_add(r->Y, r->Z, r->Y);
1087    fe_sub(r->Z, t0, r->T);
1088    fe_add(r->T, t0, r->T);
1089  }
1090  void ge_p1p1_to_p2(ge_p2 *r, const ge_p1p1 *p) {
1091    fe_mul(r->X, p->X, p->T);
1092    fe_mul(r->Y, p->Y, p->Z);
1093    fe_mul(r->Z, p->Z, p->T);
1094  }
1095  void ge_p1p1_to_p3(ge_p3 *r, const ge_p1p1 *p) {
1096    fe_mul(r->X, p->X, p->T);
1097    fe_mul(r->Y, p->Y, p->Z);
1098    fe_mul(r->Z, p->Z, p->T);
1099    fe_mul(r->T, p->X, p->Y);
1100  }
1101  static void ge_p2_0(ge_p2 *h) {
1102    fe_0(h->X);
1103    fe_1(h->Y);
1104    fe_1(h->Z);
1105  }
1106  void ge_p2_dbl(ge_p1p1 *r, const ge_p2 *p) {
1107    fe t0;
1108    fe_sq(r->X, p->X);
1109    fe_sq(r->Z, p->Y);
1110    fe_sq2(r->T, p->Z);
1111    fe_add(r->Y, p->X, p->Y);
1112    fe_sq(t0, r->Y);
1113    fe_add(r->Y, r->Z, r->X);
1114    fe_sub(r->Z, r->Z, r->X);
1115    fe_sub(r->X, t0, r->Y);
1116    fe_sub(r->T, r->T, r->Z);
1117  }
1118  static void ge_p3_0(ge_p3 *h) {
1119    fe_0(h->X);
1120    fe_1(h->Y);
1121    fe_1(h->Z);
1122    fe_0(h->T);
1123  }
1124  static void ge_p3_dbl(ge_p1p1 *r, const ge_p3 *p) {
1125    ge_p2 q;
1126    ge_p3_to_p2(&q, p);
1127    ge_p2_dbl(r, &q);
1128  }
1129  void ge_p3_to_cached(ge_cached *r, const ge_p3 *p) {
1130    fe_add(r->YplusX, p->Y, p->X);
1131    fe_sub(r->YminusX, p->Y, p->X);
1132    fe_copy(r->Z, p->Z);
1133    fe_mul(r->T2d, p->T, fe_d2);
1134  }
1135  void ge_p3_to_p2(ge_p2 *r, const ge_p3 *p) {
1136    fe_copy(r->X, p->X);
1137    fe_copy(r->Y, p->Y);
1138    fe_copy(r->Z, p->Z);
1139  }
1140  void ge_p3_tobytes(unsigned char *s, const ge_p3 *h) {
1141    fe recip;
1142    fe x;
1143    fe y;
1144    fe_invert(recip, h->Z);
1145    fe_mul(x, h->X, recip);
1146    fe_mul(y, h->Y, recip);
1147    fe_tobytes(s, y);
1148    s[31] ^= fe_isnegative(x) << 7;
1149  }
1150  static void ge_precomp_0(ge_precomp *h) {
1151    fe_1(h->yplusx);
1152    fe_1(h->yminusx);
1153    fe_0(h->xy2d);
1154  }
1155  static unsigned char equal(signed char b, signed char c) {
1156    unsigned char ub = b;
1157    unsigned char uc = c;
1158    unsigned char x = ub ^ uc; &bsol;* 0: yes; 1..255: no */
1159    uint32_t y = x; &bsol;* 0: yes; 1..255: no */
1160    y -= 1; &bsol;* 4294967295: yes; 0..254: no */
1161    y >>= 31; &bsol;* 1: yes; 0: no */
1162    return y;
1163  }
1164  static unsigned char negative(signed char b) {
1165    unsigned long long x = b; &bsol;* 18446744073709551361..18446744073709551615: yes; 0..255: no */
1166    x >>= 63; &bsol;* 1: yes; 0: no */
1167    return x;
1168  }
1169  static void ge_precomp_cmov(ge_precomp *t, const ge_precomp *u, unsigned char b) {
1170    fe_cmov(t->yplusx, u->yplusx, b);
1171    fe_cmov(t->yminusx, u->yminusx, b);
1172    fe_cmov(t->xy2d, u->xy2d, b);
1173  }
1174  static void select(ge_precomp *t, int pos, signed char b) {
1175    ge_precomp minust;
1176    unsigned char bnegative = negative(b);
1177    unsigned char babs = b - (((-bnegative) & b) << 1);
1178    ge_precomp_0(t);
1179    ge_precomp_cmov(t, &ge_base[pos][0], equal(babs, 1));
1180    ge_precomp_cmov(t, &ge_base[pos][1], equal(babs, 2));
1181    ge_precomp_cmov(t, &ge_base[pos][2], equal(babs, 3));
1182    ge_precomp_cmov(t, &ge_base[pos][3], equal(babs, 4));
1183    ge_precomp_cmov(t, &ge_base[pos][4], equal(babs, 5));
1184    ge_precomp_cmov(t, &ge_base[pos][5], equal(babs, 6));
1185    ge_precomp_cmov(t, &ge_base[pos][6], equal(babs, 7));
1186    ge_precomp_cmov(t, &ge_base[pos][7], equal(babs, 8));
1187    fe_copy(minust.yplusx, t->yminusx);
1188    fe_copy(minust.yminusx, t->yplusx);
1189    fe_neg(minust.xy2d, t->xy2d);
1190    ge_precomp_cmov(t, &minust, bnegative);
1191  }
1192  void ge_scalarmult_base(ge_p3 *h, const unsigned char *a) {
1193    signed char e[64];
1194    signed char carry;
1195    ge_p1p1 r;
1196    ge_p2 s;
1197    ge_precomp t;
1198    int i;
1199    for (i = 0; i < 32; ++i) {
1200      e[2 * i + 0] = (a[i] >> 0) & 15;
1201      e[2 * i + 1] = (a[i] >> 4) & 15;
1202    }
1203    carry = 0;
1204    for (i = 0; i < 63; ++i) {
1205      e[i] += carry;
1206      carry = e[i] + 8;
1207      carry >>= 4;
1208      e[i] -= carry << 4;
1209    }
1210    e[63] += carry;
1211    ge_p3_0(h);
1212    for (i = 1; i < 64; i += 2) {
1213      select(&t, i / 2, e[i]);
1214      ge_madd(&r, h, &t); ge_p1p1_to_p3(h, &r);
1215    }
1216    ge_p3_dbl(&r, h);  ge_p1p1_to_p2(&s, &r);
1217    ge_p2_dbl(&r, &s); ge_p1p1_to_p2(&s, &r);
1218    ge_p2_dbl(&r, &s); ge_p1p1_to_p2(&s, &r);
1219    ge_p2_dbl(&r, &s); ge_p1p1_to_p3(h, &r);
1220    for (i = 0; i < 64; i += 2) {
1221      select(&t, i / 2, e[i]);
1222      ge_madd(&r, h, &t); ge_p1p1_to_p3(h, &r);
1223    }
1224  }
1225  void ge_sub(ge_p1p1 *r, const ge_p3 *p, const ge_cached *q) {
1226    fe t0;
1227    fe_add(r->X, p->Y, p->X);
1228    fe_sub(r->Y, p->Y, p->X);
1229    fe_mul(r->Z, r->X, q->YminusX);
1230    fe_mul(r->Y, r->Y, q->YplusX);
1231    fe_mul(r->T, q->T2d, p->T);
1232    fe_mul(r->X, p->Z, q->Z);
1233    fe_add(t0, r->X, r->X);
1234    fe_sub(r->X, r->Z, r->Y);
1235    fe_add(r->Y, r->Z, r->Y);
1236    fe_sub(r->Z, t0, r->T);
1237    fe_add(r->T, t0, r->T);
1238  }
1239  void ge_tobytes(unsigned char *s, const ge_p2 *h) {
1240    fe recip;
1241    fe x;
1242    fe y;
1243    fe_invert(recip, h->Z);
1244    fe_mul(x, h->X, recip);
1245    fe_mul(y, h->Y, recip);
1246    fe_tobytes(s, y);
1247    s[31] ^= fe_isnegative(x) << 7;
1248  }
1249  void sc_reduce(unsigned char *s) {
1250    int64_t s0 = 2097151 & load_3(s);
1251    int64_t s1 = 2097151 & (load_4(s + 2) >> 5);
1252    int64_t s2 = 2097151 & (load_3(s + 5) >> 2);
1253    int64_t s3 = 2097151 & (load_4(s + 7) >> 7);
1254    int64_t s4 = 2097151 & (load_4(s + 10) >> 4);
1255    int64_t s5 = 2097151 & (load_3(s + 13) >> 1);
1256    int64_t s6 = 2097151 & (load_4(s + 15) >> 6);
1257    int64_t s7 = 2097151 & (load_3(s + 18) >> 3);
1258    int64_t s8 = 2097151 & load_3(s + 21);
1259    int64_t s9 = 2097151 & (load_4(s + 23) >> 5);
1260    int64_t s10 = 2097151 & (load_3(s + 26) >> 2);
1261    int64_t s11 = 2097151 & (load_4(s + 28) >> 7);
1262    int64_t s12 = 2097151 & (load_4(s + 31) >> 4);
1263    int64_t s13 = 2097151 & (load_3(s + 34) >> 1);
1264    int64_t s14 = 2097151 & (load_4(s + 36) >> 6);
1265    int64_t s15 = 2097151 & (load_3(s + 39) >> 3);
1266    int64_t s16 = 2097151 & load_3(s + 42);
1267    int64_t s17 = 2097151 & (load_4(s + 44) >> 5);
1268    int64_t s18 = 2097151 & (load_3(s + 47) >> 2);
1269    int64_t s19 = 2097151 & (load_4(s + 49) >> 7);
1270    int64_t s20 = 2097151 & (load_4(s + 52) >> 4);
1271    int64_t s21 = 2097151 & (load_3(s + 55) >> 1);
1272    int64_t s22 = 2097151 & (load_4(s + 57) >> 6);
1273    int64_t s23 = (load_4(s + 60) >> 3);
1274    int64_t carry0;
1275    int64_t carry1;
1276    int64_t carry2;
1277    int64_t carry3;
1278    int64_t carry4;
1279    int64_t carry5;
1280    int64_t carry6;
1281    int64_t carry7;
1282    int64_t carry8;
1283    int64_t carry9;
1284    int64_t carry10;
1285    int64_t carry11;
1286    int64_t carry12;
1287    int64_t carry13;
1288    int64_t carry14;
1289    int64_t carry15;
1290    int64_t carry16;
1291    s11 += s23 * 666643;
1292    s12 += s23 * 470296;
1293    s13 += s23 * 654183;
1294    s14 -= s23 * 997805;
1295    s15 += s23 * 136657;
1296    s16 -= s23 * 683901;
1297    s10 += s22 * 666643;
1298    s11 += s22 * 470296;
1299    s12 += s22 * 654183;
1300    s13 -= s22 * 997805;
1301    s14 += s22 * 136657;
1302    s15 -= s22 * 683901;
1303    s9 += s21 * 666643;
1304    s10 += s21 * 470296;
1305    s11 += s21 * 654183;
1306    s12 -= s21 * 997805;
1307    s13 += s21 * 136657;
1308    s14 -= s21 * 683901;
1309    s8 += s20 * 666643;
1310    s9 += s20 * 470296;
1311    s10 += s20 * 654183;
1312    s11 -= s20 * 997805;
1313    s12 += s20 * 136657;
1314    s13 -= s20 * 683901;
1315    s7 += s19 * 666643;
1316    s8 += s19 * 470296;
1317    s9 += s19 * 654183;
1318    s10 -= s19 * 997805;
1319    s11 += s19 * 136657;
1320    s12 -= s19 * 683901;
1321    s6 += s18 * 666643;
1322    s7 += s18 * 470296;
1323    s8 += s18 * 654183;
1324    s9 -= s18 * 997805;
1325    s10 += s18 * 136657;
1326    s11 -= s18 * 683901;
1327    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
1328    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
1329    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
1330    carry12 = (s12 + (1<<20)) >> 21; s13 += carry12; s12 -= carry12 << 21;
1331    carry14 = (s14 + (1<<20)) >> 21; s15 += carry14; s14 -= carry14 << 21;
1332    carry16 = (s16 + (1<<20)) >> 21; s17 += carry16; s16 -= carry16 << 21;
1333    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
1334    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
1335    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
1336    carry13 = (s13 + (1<<20)) >> 21; s14 += carry13; s13 -= carry13 << 21;
1337    carry15 = (s15 + (1<<20)) >> 21; s16 += carry15; s15 -= carry15 << 21;
1338    s5 += s17 * 666643;
1339    s6 += s17 * 470296;
1340    s7 += s17 * 654183;
1341    s8 -= s17 * 997805;
1342    s9 += s17 * 136657;
1343    s10 -= s17 * 683901;
1344    s4 += s16 * 666643;
1345    s5 += s16 * 470296;
1346    s6 += s16 * 654183;
1347    s7 -= s16 * 997805;
1348    s8 += s16 * 136657;
1349    s9 -= s16 * 683901;
1350    s3 += s15 * 666643;
1351    s4 += s15 * 470296;
1352    s5 += s15 * 654183;
1353    s6 -= s15 * 997805;
1354    s7 += s15 * 136657;
1355    s8 -= s15 * 683901;
1356    s2 += s14 * 666643;
1357    s3 += s14 * 470296;
1358    s4 += s14 * 654183;
1359    s5 -= s14 * 997805;
1360    s6 += s14 * 136657;
1361    s7 -= s14 * 683901;
1362    s1 += s13 * 666643;
1363    s2 += s13 * 470296;
1364    s3 += s13 * 654183;
1365    s4 -= s13 * 997805;
1366    s5 += s13 * 136657;
1367    s6 -= s13 * 683901;
1368    s0 += s12 * 666643;
1369    s1 += s12 * 470296;
1370    s2 += s12 * 654183;
1371    s3 -= s12 * 997805;
1372    s4 += s12 * 136657;
1373    s5 -= s12 * 683901;
1374    s12 = 0;
1375    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
1376    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
1377    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
1378    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
1379    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
1380    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
1381    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
1382    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
1383    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
1384    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
1385    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
1386    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
1387    s0 += s12 * 666643;
1388    s1 += s12 * 470296;
1389    s2 += s12 * 654183;
1390    s3 -= s12 * 997805;
1391    s4 += s12 * 136657;
1392    s5 -= s12 * 683901;
1393    s12 = 0;
1394    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
1395    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
1396    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
1397    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
1398    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
1399    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
1400    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
1401    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
1402    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
1403    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
1404    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
1405    carry11 = s11 >> 21; s12 += carry11; s11 -= carry11 << 21;
1406    s0 += s12 * 666643;
1407    s1 += s12 * 470296;
1408    s2 += s12 * 654183;
1409    s3 -= s12 * 997805;
1410    s4 += s12 * 136657;
1411    s5 -= s12 * 683901;
1412    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
1413    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
1414    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
1415    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
1416    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
1417    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
1418    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
1419    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
1420    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
1421    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
1422    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
1423    s[0] = s0 >> 0;
1424    s[1] = s0 >> 8;
1425    s[2] = (s0 >> 16) | (s1 << 5);
1426    s[3] = s1 >> 3;
1427    s[4] = s1 >> 11;
1428    s[5] = (s1 >> 19) | (s2 << 2);
1429    s[6] = s2 >> 6;
1430    s[7] = (s2 >> 14) | (s3 << 7);
1431    s[8] = s3 >> 1;
1432    s[9] = s3 >> 9;
1433    s[10] = (s3 >> 17) | (s4 << 4);
1434    s[11] = s4 >> 4;
1435    s[12] = s4 >> 12;
1436    s[13] = (s4 >> 20) | (s5 << 1);
1437    s[14] = s5 >> 7;
1438    s[15] = (s5 >> 15) | (s6 << 6);
1439    s[16] = s6 >> 2;
1440    s[17] = s6 >> 10;
1441    s[18] = (s6 >> 18) | (s7 << 3);
1442    s[19] = s7 >> 5;
1443    s[20] = s7 >> 13;
1444    s[21] = s8 >> 0;
1445    s[22] = s8 >> 8;
1446    s[23] = (s8 >> 16) | (s9 << 5);
1447    s[24] = s9 >> 3;
1448    s[25] = s9 >> 11;
1449    s[26] = (s9 >> 19) | (s10 << 2);
1450    s[27] = s10 >> 6;
1451    s[28] = (s10 >> 14) | (s11 << 7);
1452    s[29] = s11 >> 1;
1453    s[30] = s11 >> 9;
1454    s[31] = s11 >> 17;
1455  }
1456  static void fe_divpowm1(fe r, const fe u, const fe v) {
1457    fe v3, uv7, t0, t1, t2;
1458    int i;
1459    fe_sq(v3, v);
1460    fe_mul(v3, v3, v); &bsol;* v3 = v^3 */
1461    fe_sq(uv7, v3);
1462    fe_mul(uv7, uv7, v);
1463    fe_mul(uv7, uv7, u); &bsol;* uv7 = uv^7 */
1464    fe_sq(t0, uv7);
1465    fe_sq(t1, t0);
1466    fe_sq(t1, t1);
1467    fe_mul(t1, uv7, t1);
1468    fe_mul(t0, t0, t1);
1469    fe_sq(t0, t0);
1470    fe_mul(t0, t1, t0);
1471    fe_sq(t1, t0);
1472    for (i = 0; i < 4; ++i) {
1473      fe_sq(t1, t1);
1474    }
1475    fe_mul(t0, t1, t0);
1476    fe_sq(t1, t0);
1477    for (i = 0; i < 9; ++i) {
1478      fe_sq(t1, t1);
1479    }
1480    fe_mul(t1, t1, t0);
1481    fe_sq(t2, t1);
1482    for (i = 0; i < 19; ++i) {
1483      fe_sq(t2, t2);
1484    }
1485    fe_mul(t1, t2, t1);
1486    for (i = 0; i < 10; ++i) {
1487      fe_sq(t1, t1);
1488    }
1489    fe_mul(t0, t1, t0);
1490    fe_sq(t1, t0);
1491    for (i = 0; i < 49; ++i) {
1492      fe_sq(t1, t1);
1493    }
1494    fe_mul(t1, t1, t0);
1495    fe_sq(t2, t1);
1496    for (i = 0; i < 99; ++i) {
1497      fe_sq(t2, t2);
1498    }
1499    fe_mul(t1, t2, t1);
1500    for (i = 0; i < 50; ++i) {
1501      fe_sq(t1, t1);
1502    }
1503    fe_mul(t0, t1, t0);
1504    fe_sq(t0, t0);
1505    fe_sq(t0, t0);
1506    fe_mul(t0, t0, uv7);
1507    fe_mul(t0, t0, v3);
1508    fe_mul(r, t0, u); &bsol;* u^(m+1)v^(-(m+1)) */
1509  }
1510  static void ge_cached_0(ge_cached *r) {
1511    fe_1(r->YplusX);
1512    fe_1(r->YminusX);
1513    fe_1(r->Z);
1514    fe_0(r->T2d);
1515  }
1516  static void ge_cached_cmov(ge_cached *t, const ge_cached *u, unsigned char b) {
1517    fe_cmov(t->YplusX, u->YplusX, b);
1518    fe_cmov(t->YminusX, u->YminusX, b);
1519    fe_cmov(t->Z, u->Z, b);
1520    fe_cmov(t->T2d, u->T2d, b);
1521  }
1522  void ge_scalarmult(ge_p2 *r, const unsigned char *a, const ge_p3 *A) {
1523    signed char e[64];
1524    int carry, carry2, i;
1525    ge_cached Ai[8]; &bsol;* 1 * A, 2 * A, ..., 8 * A */
1526    ge_p1p1 t;
1527    ge_p3 u;
1528    carry = 0; &bsol;* 0..1 */
1529    for (i = 0; i < 31; i++) {
1530      carry += a[i]; &bsol;* 0..256 */
1531      carry2 = (carry + 8) >> 4; &bsol;* 0..16 */
1532      e[2 * i] = carry - (carry2 << 4); &bsol;* -8..7 */
1533      carry = (carry2 + 8) >> 4; &bsol;* 0..1 */
1534      e[2 * i + 1] = carry2 - (carry << 4); &bsol;* -8..7 */
1535    }
1536    carry += a[31]; &bsol;* 0..128 */
1537    carry2 = (carry + 8) >> 4; &bsol;* 0..8 */
1538    e[62] = carry - (carry2 << 4); &bsol;* -8..7 */
1539    e[63] = carry2; &bsol;* 0..8 */
1540    ge_p3_to_cached(&Ai[0], A);
1541    for (i = 0; i < 7; i++) {
1542      ge_add(&t, A, &Ai[i]);
1543      ge_p1p1_to_p3(&u, &t);
1544      ge_p3_to_cached(&Ai[i + 1], &u);
1545    }
1546    ge_p2_0(r);
1547    for (i = 63; i >= 0; i--) {
1548      signed char b = e[i];
1549      unsigned char bnegative = negative(b);
1550      unsigned char babs = b - (((-bnegative) & b) << 1);
1551      ge_cached cur, minuscur;
1552      ge_p2_dbl(&t, r);
1553      ge_p1p1_to_p2(r, &t);
1554      ge_p2_dbl(&t, r);
1555      ge_p1p1_to_p2(r, &t);
1556      ge_p2_dbl(&t, r);
1557      ge_p1p1_to_p2(r, &t);
1558      ge_p2_dbl(&t, r);
1559      ge_p1p1_to_p3(&u, &t);
1560      ge_cached_0(&cur);
1561      ge_cached_cmov(&cur, &Ai[0], equal(babs, 1));
1562      ge_cached_cmov(&cur, &Ai[1], equal(babs, 2));
1563      ge_cached_cmov(&cur, &Ai[2], equal(babs, 3));
1564      ge_cached_cmov(&cur, &Ai[3], equal(babs, 4));
1565      ge_cached_cmov(&cur, &Ai[4], equal(babs, 5));
1566      ge_cached_cmov(&cur, &Ai[5], equal(babs, 6));
1567      ge_cached_cmov(&cur, &Ai[6], equal(babs, 7));
1568      ge_cached_cmov(&cur, &Ai[7], equal(babs, 8));
1569      fe_copy(minuscur.YplusX, cur.YminusX);
1570      fe_copy(minuscur.YminusX, cur.YplusX);
1571      fe_copy(minuscur.Z, cur.Z);
1572      fe_neg(minuscur.T2d, cur.T2d);
1573      ge_cached_cmov(&cur, &minuscur, bnegative);
1574      ge_add(&t, &u, &cur);
1575      ge_p1p1_to_p2(r, &t);
1576    }
1577  }
1578  void ge_scalarmult_p3(ge_p3 *r3, const unsigned char *a, const ge_p3 *A) {
1579    signed char e[64];
1580    int carry, carry2, i;
1581    ge_cached Ai[8]; &bsol;* 1 * A, 2 * A, ..., 8 * A */
1582    ge_p1p1 t;
1583    ge_p3 u;
1584    ge_p2 r;
1585    carry = 0; &bsol;* 0..1 */
1586    for (i = 0; i < 31; i++) {
1587      carry += a[i]; &bsol;* 0..256 */
1588      carry2 = (carry + 8) >> 4; &bsol;* 0..16 */
1589      e[2 * i] = carry - (carry2 << 4); &bsol;* -8..7 */
1590      carry = (carry2 + 8) >> 4; &bsol;* 0..1 */
1591      e[2 * i + 1] = carry2 - (carry << 4); &bsol;* -8..7 */
1592    }
1593    carry += a[31]; &bsol;* 0..128 */
1594    carry2 = (carry + 8) >> 4; &bsol;* 0..8 */
1595    e[62] = carry - (carry2 << 4); &bsol;* -8..7 */
1596    e[63] = carry2; &bsol;* 0..8 */
1597    ge_p3_to_cached(&Ai[0], A);
1598    for (i = 0; i < 7; i++) {
1599      ge_add(&t, A, &Ai[i]);
1600      ge_p1p1_to_p3(&u, &t);
1601      ge_p3_to_cached(&Ai[i + 1], &u);
1602    }
1603    ge_p2_0(&r);
1604    for (i = 63; i >= 0; i--) {
1605      signed char b = e[i];
1606      unsigned char bnegative = negative(b);
1607      unsigned char babs = b - (((-bnegative) & b) << 1);
1608      ge_cached cur, minuscur;
1609      ge_p2_dbl(&t, &r);
1610      ge_p1p1_to_p2(&r, &t);
1611      ge_p2_dbl(&t, &r);
1612      ge_p1p1_to_p2(&r, &t);
1613      ge_p2_dbl(&t, &r);
1614      ge_p1p1_to_p2(&r, &t);
1615      ge_p2_dbl(&t, &r);
1616      ge_p1p1_to_p3(&u, &t);
1617      ge_cached_0(&cur);
1618      ge_cached_cmov(&cur, &Ai[0], equal(babs, 1));
1619      ge_cached_cmov(&cur, &Ai[1], equal(babs, 2));
1620      ge_cached_cmov(&cur, &Ai[2], equal(babs, 3));
1621      ge_cached_cmov(&cur, &Ai[3], equal(babs, 4));
1622      ge_cached_cmov(&cur, &Ai[4], equal(babs, 5));
1623      ge_cached_cmov(&cur, &Ai[5], equal(babs, 6));
1624      ge_cached_cmov(&cur, &Ai[6], equal(babs, 7));
1625      ge_cached_cmov(&cur, &Ai[7], equal(babs, 8));
1626      fe_copy(minuscur.YplusX, cur.YminusX);
1627      fe_copy(minuscur.YminusX, cur.YplusX);
1628      fe_copy(minuscur.Z, cur.Z);
1629      fe_neg(minuscur.T2d, cur.T2d);
1630      ge_cached_cmov(&cur, &minuscur, bnegative);
1631      ge_add(&t, &u, &cur);
1632      if (i == 0)
1633        ge_p1p1_to_p3(r3, &t);
1634      else
1635        ge_p1p1_to_p2(&r, &t);
1636    }
1637  }
1638  void ge_double_scalarmult_precomp_vartime2(ge_p2 *r, const unsigned char *a, const ge_dsmp Ai, const unsigned char *b, const ge_dsmp Bi) {
1639    signed char aslide[256];
1640    signed char bslide[256];
1641    ge_p1p1 t;
1642    ge_p3 u;
1643    int i;
1644    slide(aslide, a);
1645    slide(bslide, b);
1646    ge_p2_0(r);
1647    for (i = 255; i >= 0; --i) {
1648      if (aslide[i] || bslide[i]) break;
1649    }
1650    for (; i >= 0; --i) {
1651      ge_p2_dbl(&t, r);
1652      if (aslide[i] > 0) {
1653        ge_p1p1_to_p3(&u, &t);
1654        ge_add(&t, &u, &Ai[aslide[i]/2]);
1655      } else if (aslide[i] < 0) {
1656        ge_p1p1_to_p3(&u, &t);
1657        ge_sub(&t, &u, &Ai[(-aslide[i])/2]);
1658      }
1659      if (bslide[i] > 0) {
1660        ge_p1p1_to_p3(&u, &t);
1661        ge_add(&t, &u, &Bi[bslide[i]/2]);
1662      } else if (bslide[i] < 0) {
1663        ge_p1p1_to_p3(&u, &t);
1664        ge_sub(&t, &u, &Bi[(-bslide[i])/2]);
1665      }
1666      ge_p1p1_to_p2(r, &t);
1667    }
1668  }
1669  void ge_triple_scalarmult_precomp_vartime(ge_p2 *r, const unsigned char *a, const ge_dsmp Ai, const unsigned char *b, const ge_dsmp Bi, const unsigned char *c, const ge_dsmp Ci) {
1670    signed char aslide[256];
1671    signed char bslide[256];
1672    signed char cslide[256];
1673    ge_p1p1 t;
1674    ge_p3 u;
1675    int i;
1676    slide(aslide, a);
1677    slide(bslide, b);
1678    slide(cslide, c);
1679    ge_p2_0(r);
1680    for (i = 255; i >= 0; --i) {
1681      if (aslide[i] || bslide[i] || cslide[i]) break;
1682    }
1683    for (; i >= 0; --i) {
1684      ge_p2_dbl(&t, r);
1685      if (aslide[i] > 0) {
1686        ge_p1p1_to_p3(&u, &t);
1687        ge_add(&t, &u, &Ai[aslide[i]/2]);
1688      } else if (aslide[i] < 0) {
1689        ge_p1p1_to_p3(&u, &t);
1690        ge_sub(&t, &u, &Ai[(-aslide[i])/2]);
1691      }
1692      if (bslide[i] > 0) {
1693        ge_p1p1_to_p3(&u, &t);
1694        ge_add(&t, &u, &Bi[bslide[i]/2]);
1695      } else if (bslide[i] < 0) {
1696        ge_p1p1_to_p3(&u, &t);
1697        ge_sub(&t, &u, &Bi[(-bslide[i])/2]);
1698      }
1699      if (cslide[i] > 0) {
1700        ge_p1p1_to_p3(&u, &t);
1701        ge_add(&t, &u, &Ci[cslide[i]/2]);
1702      } else if (cslide[i] < 0) {
1703        ge_p1p1_to_p3(&u, &t);
1704        ge_sub(&t, &u, &Ci[(-cslide[i])/2]);
1705      }
1706      ge_p1p1_to_p2(r, &t);
1707    }
1708  }
1709  void ge_double_scalarmult_precomp_vartime2_p3(ge_p3 *r3, const unsigned char *a, const ge_dsmp Ai, const unsigned char *b, const ge_dsmp Bi) {
1710    signed char aslide[256];
1711    signed char bslide[256];
1712    ge_p1p1 t;
1713    ge_p3 u;
1714    ge_p2 r;
1715    int i;
1716    slide(aslide, a);
1717    slide(bslide, b);
1718    ge_p2_0(&r);
1719    for (i = 255; i >= 0; --i) {
1720      if (aslide[i] || bslide[i]) break;
1721    }
1722    for (; i >= 0; --i) {
1723      ge_p2_dbl(&t, &r);
1724      if (aslide[i] > 0) {
1725        ge_p1p1_to_p3(&u, &t);
1726        ge_add(&t, &u, &Ai[aslide[i]/2]);
1727      } else if (aslide[i] < 0) {
1728        ge_p1p1_to_p3(&u, &t);
1729        ge_sub(&t, &u, &Ai[(-aslide[i])/2]);
1730      }
1731      if (bslide[i] > 0) {
1732        ge_p1p1_to_p3(&u, &t);
1733        ge_add(&t, &u, &Bi[bslide[i]/2]);
1734      } else if (bslide[i] < 0) {
1735        ge_p1p1_to_p3(&u, &t);
1736        ge_sub(&t, &u, &Bi[(-bslide[i])/2]);
1737      }
1738      if (i == 0)
1739        ge_p1p1_to_p3(r3, &t);
1740      else
1741        ge_p1p1_to_p2(&r, &t);
1742    }
1743  }
1744  void ge_double_scalarmult_precomp_vartime(ge_p2 *r, const unsigned char *a, const ge_p3 *A, const unsigned char *b, const ge_dsmp Bi) {
1745    ge_dsmp Ai; &bsol;* A, 3A, 5A, 7A, 9A, 11A, 13A, 15A */
1746    ge_dsm_precomp(Ai, A);
1747    ge_double_scalarmult_precomp_vartime2(r, a, Ai, b, Bi);
1748  }
1749  void ge_mul8(ge_p1p1 *r, const ge_p2 *t) {
1750    ge_p2 u;
1751    ge_p2_dbl(r, t);
1752    ge_p1p1_to_p2(&u, r);
1753    ge_p2_dbl(r, &u);
1754    ge_p1p1_to_p2(&u, r);
1755    ge_p2_dbl(r, &u);
1756  }
1757  void ge_fromfe_frombytes_vartime(ge_p2 *r, const unsigned char *s) {
1758    fe u, v, w, x, y, z;
1759    unsigned char sign;
1760    int64_t h0 = load_4(s);
1761    int64_t h1 = load_3(s + 4) << 6;
1762    int64_t h2 = load_3(s + 7) << 5;
1763    int64_t h3 = load_3(s + 10) << 3;
1764    int64_t h4 = load_3(s + 13) << 2;
1765    int64_t h5 = load_4(s + 16);
1766    int64_t h6 = load_3(s + 20) << 7;
1767    int64_t h7 = load_3(s + 23) << 5;
1768    int64_t h8 = load_3(s + 26) << 4;
1769    int64_t h9 = load_3(s + 29) << 2;
1770    int64_t carry0;
1771    int64_t carry1;
1772    int64_t carry2;
1773    int64_t carry3;
1774    int64_t carry4;
1775    int64_t carry5;
1776    int64_t carry6;
1777    int64_t carry7;
1778    int64_t carry8;
1779    int64_t carry9;
1780    carry9 = (h9 + (int64_t) (1<<24)) >> 25; h0 += carry9 * 19; h9 -= carry9 << 25;
1781    carry1 = (h1 + (int64_t) (1<<24)) >> 25; h2 += carry1; h1 -= carry1 << 25;
1782    carry3 = (h3 + (int64_t) (1<<24)) >> 25; h4 += carry3; h3 -= carry3 << 25;
1783    carry5 = (h5 + (int64_t) (1<<24)) >> 25; h6 += carry5; h5 -= carry5 << 25;
1784    carry7 = (h7 + (int64_t) (1<<24)) >> 25; h8 += carry7; h7 -= carry7 << 25;
1785    carry0 = (h0 + (int64_t) (1<<25)) >> 26; h1 += carry0; h0 -= carry0 << 26;
1786    carry2 = (h2 + (int64_t) (1<<25)) >> 26; h3 += carry2; h2 -= carry2 << 26;
1787    carry4 = (h4 + (int64_t) (1<<25)) >> 26; h5 += carry4; h4 -= carry4 << 26;
1788    carry6 = (h6 + (int64_t) (1<<25)) >> 26; h7 += carry6; h6 -= carry6 << 26;
1789    carry8 = (h8 + (int64_t) (1<<25)) >> 26; h9 += carry8; h8 -= carry8 << 26;
1790    u[0] = h0;
1791    u[1] = h1;
1792    u[2] = h2;
1793    u[3] = h3;
1794    u[4] = h4;
1795    u[5] = h5;
1796    u[6] = h6;
1797    u[7] = h7;
1798    u[8] = h8;
1799    u[9] = h9;
1800    fe_sq2(v, u); &bsol;* 2 * u^2 */
1801    fe_1(w);
1802    fe_add(w, v, w); &bsol;* w = 2 * u^2 + 1 */
1803    fe_sq(x, w); &bsol;* w^2 */
1804    fe_mul(y, fe_ma2, v); &bsol;* -2 * A^2 * u^2 */
1805    fe_add(x, x, y); &bsol;* x = w^2 - 2 * A^2 * u^2 */
1806    fe_divpowm1(r->X, w, x); &bsol;* (w / x)^(m + 1) */
1807    fe_sq(y, r->X);
1808    fe_mul(x, y, x);
1809    fe_sub(y, w, x);
1810    fe_copy(z, fe_ma);
1811    if (fe_isnonzero(y)) {
1812      fe_add(y, w, x);
1813      if (fe_isnonzero(y)) {
1814        goto negative;
1815      } else {
1816        fe_mul(r->X, r->X, fe_fffb1);
1817      }
1818    } else {
1819      fe_mul(r->X, r->X, fe_fffb2);
1820    }
1821    fe_mul(r->X, r->X, u); &bsol;* u * sqrt(2 * A * (A + 2) * w / x) */
1822    fe_mul(z, z, v); &bsol;* -2 * A * u^2 */
1823    sign = 0;
1824    goto setsign;
1825  negative:
1826    fe_mul(x, x, fe_sqrtm1);
1827    fe_sub(y, w, x);
1828    if (fe_isnonzero(y)) {
1829      assert((fe_add(y, w, x), !fe_isnonzero(y)));
1830      fe_mul(r->X, r->X, fe_fffb3);
1831    } else {
1832      fe_mul(r->X, r->X, fe_fffb4);
1833    }
1834    sign = 1;
1835  setsign:
1836    if (fe_isnegative(r->X) != sign) {
1837      assert(fe_isnonzero(r->X));
1838      fe_neg(r->X, r->X);
1839    }
1840    fe_add(r->Z, z, w);
1841    fe_sub(r->Y, z, w);
1842    fe_mul(r->X, r->X, r->Z);
1843  #if !defined(NDEBUG)
1844    {
1845      fe check_x, check_y, check_iz, check_v;
1846      fe_invert(check_iz, r->Z);
1847      fe_mul(check_x, r->X, check_iz);
1848      fe_mul(check_y, r->Y, check_iz);
1849      fe_sq(check_x, check_x);
1850      fe_sq(check_y, check_y);
1851      fe_mul(check_v, check_x, check_y);
1852      fe_mul(check_v, fe_d, check_v);
1853      fe_add(check_v, check_v, check_x);
1854      fe_sub(check_v, check_v, check_y);
1855      fe_1(check_x);
1856      fe_add(check_v, check_v, check_x);
1857      assert(!fe_isnonzero(check_v));
1858    }
1859  #endif
1860  }
1861  void sc_0(unsigned char *s) {
1862    int i;
1863    for (i = 0; i < 32; i++) {
1864      s[i] = 0;
1865    }
1866  }
1867  void sc_reduce32(unsigned char *s) {
1868    int64_t s0 = 2097151 & load_3(s);
1869    int64_t s1 = 2097151 & (load_4(s + 2) >> 5);
1870    int64_t s2 = 2097151 & (load_3(s + 5) >> 2);
1871    int64_t s3 = 2097151 & (load_4(s + 7) >> 7);
1872    int64_t s4 = 2097151 & (load_4(s + 10) >> 4);
1873    int64_t s5 = 2097151 & (load_3(s + 13) >> 1);
1874    int64_t s6 = 2097151 & (load_4(s + 15) >> 6);
1875    int64_t s7 = 2097151 & (load_3(s + 18) >> 3);
1876    int64_t s8 = 2097151 & load_3(s + 21);
1877    int64_t s9 = 2097151 & (load_4(s + 23) >> 5);
1878    int64_t s10 = 2097151 & (load_3(s + 26) >> 2);
1879    int64_t s11 = (load_4(s + 28) >> 7);
1880    int64_t s12 = 0;
1881    int64_t carry0;
1882    int64_t carry1;
1883    int64_t carry2;
1884    int64_t carry3;
1885    int64_t carry4;
1886    int64_t carry5;
1887    int64_t carry6;
1888    int64_t carry7;
1889    int64_t carry8;
1890    int64_t carry9;
1891    int64_t carry10;
1892    int64_t carry11;
1893    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
1894    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
1895    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
1896    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
1897    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
1898    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
1899    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
1900    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
1901    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
1902    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
1903    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
1904    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
1905    s0 += s12 * 666643;
1906    s1 += s12 * 470296;
1907    s2 += s12 * 654183;
1908    s3 -= s12 * 997805;
1909    s4 += s12 * 136657;
1910    s5 -= s12 * 683901;
1911    s12 = 0;
1912    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
1913    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
1914    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
1915    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
1916    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
1917    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
1918    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
1919    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
1920    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
1921    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
1922    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
1923    carry11 = s11 >> 21; s12 += carry11; s11 -= carry11 << 21;
1924    s0 += s12 * 666643;
1925    s1 += s12 * 470296;
1926    s2 += s12 * 654183;
1927    s3 -= s12 * 997805;
1928    s4 += s12 * 136657;
1929    s5 -= s12 * 683901;
1930    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
1931    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
1932    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
1933    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
1934    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
1935    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
1936    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
1937    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
1938    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
1939    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
1940    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
1941    s[0] = s0 >> 0;
1942    s[1] = s0 >> 8;
1943    s[2] = (s0 >> 16) | (s1 << 5);
1944    s[3] = s1 >> 3;
1945    s[4] = s1 >> 11;
1946    s[5] = (s1 >> 19) | (s2 << 2);
1947    s[6] = s2 >> 6;
1948    s[7] = (s2 >> 14) | (s3 << 7);
1949    s[8] = s3 >> 1;
1950    s[9] = s3 >> 9;
1951    s[10] = (s3 >> 17) | (s4 << 4);
1952    s[11] = s4 >> 4;
1953    s[12] = s4 >> 12;
1954    s[13] = (s4 >> 20) | (s5 << 1);
1955    s[14] = s5 >> 7;
1956    s[15] = (s5 >> 15) | (s6 << 6);
1957    s[16] = s6 >> 2;
1958    s[17] = s6 >> 10;
1959    s[18] = (s6 >> 18) | (s7 << 3);
1960    s[19] = s7 >> 5;
1961    s[20] = s7 >> 13;
1962    s[21] = s8 >> 0;
1963    s[22] = s8 >> 8;
1964    s[23] = (s8 >> 16) | (s9 << 5);
1965    s[24] = s9 >> 3;
1966    s[25] = s9 >> 11;
1967    s[26] = (s9 >> 19) | (s10 << 2);
1968    s[27] = s10 >> 6;
1969    s[28] = (s10 >> 14) | (s11 << 7);
1970    s[29] = s11 >> 1;
1971    s[30] = s11 >> 9;
1972    s[31] = s11 >> 17;
1973  }
1974  void sc_add(unsigned char *s, const unsigned char *a, const unsigned char *b) {
1975    int64_t a0 = 2097151 & load_3(a);
1976    int64_t a1 = 2097151 & (load_4(a + 2) >> 5);
1977    int64_t a2 = 2097151 & (load_3(a + 5) >> 2);
1978    int64_t a3 = 2097151 & (load_4(a + 7) >> 7);
1979    int64_t a4 = 2097151 & (load_4(a + 10) >> 4);
1980    int64_t a5 = 2097151 & (load_3(a + 13) >> 1);
1981    int64_t a6 = 2097151 & (load_4(a + 15) >> 6);
1982    int64_t a7 = 2097151 & (load_3(a + 18) >> 3);
1983    int64_t a8 = 2097151 & load_3(a + 21);
1984    int64_t a9 = 2097151 & (load_4(a + 23) >> 5);
1985    int64_t a10 = 2097151 & (load_3(a + 26) >> 2);
1986    int64_t a11 = (load_4(a + 28) >> 7);
1987    int64_t b0 = 2097151 & load_3(b);
1988    int64_t b1 = 2097151 & (load_4(b + 2) >> 5);
1989    int64_t b2 = 2097151 & (load_3(b + 5) >> 2);
1990    int64_t b3 = 2097151 & (load_4(b + 7) >> 7);
1991    int64_t b4 = 2097151 & (load_4(b + 10) >> 4);
1992    int64_t b5 = 2097151 & (load_3(b + 13) >> 1);
1993    int64_t b6 = 2097151 & (load_4(b + 15) >> 6);
1994    int64_t b7 = 2097151 & (load_3(b + 18) >> 3);
1995    int64_t b8 = 2097151 & load_3(b + 21);
1996    int64_t b9 = 2097151 & (load_4(b + 23) >> 5);
1997    int64_t b10 = 2097151 & (load_3(b + 26) >> 2);
1998    int64_t b11 = (load_4(b + 28) >> 7);
1999    int64_t s0 = a0 + b0;
2000    int64_t s1 = a1 + b1;
2001    int64_t s2 = a2 + b2;
2002    int64_t s3 = a3 + b3;
2003    int64_t s4 = a4 + b4;
2004    int64_t s5 = a5 + b5;
2005    int64_t s6 = a6 + b6;
2006    int64_t s7 = a7 + b7;
2007    int64_t s8 = a8 + b8;
2008    int64_t s9 = a9 + b9;
2009    int64_t s10 = a10 + b10;
2010    int64_t s11 = a11 + b11;
2011    int64_t s12 = 0;
2012    int64_t carry0;
2013    int64_t carry1;
2014    int64_t carry2;
2015    int64_t carry3;
2016    int64_t carry4;
2017    int64_t carry5;
2018    int64_t carry6;
2019    int64_t carry7;
2020    int64_t carry8;
2021    int64_t carry9;
2022    int64_t carry10;
2023    int64_t carry11;
2024    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
2025    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
2026    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
2027    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2028    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2029    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2030    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
2031    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
2032    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
2033    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2034    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2035    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2036    s0 += s12 * 666643;
2037    s1 += s12 * 470296;
2038    s2 += s12 * 654183;
2039    s3 -= s12 * 997805;
2040    s4 += s12 * 136657;
2041    s5 -= s12 * 683901;
2042    s12 = 0;
2043    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
2044    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
2045    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
2046    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
2047    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
2048    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
2049    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
2050    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
2051    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
2052    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
2053    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
2054    carry11 = s11 >> 21; s12 += carry11; s11 -= carry11 << 21;
2055    s0 += s12 * 666643;
2056    s1 += s12 * 470296;
2057    s2 += s12 * 654183;
2058    s3 -= s12 * 997805;
2059    s4 += s12 * 136657;
2060    s5 -= s12 * 683901;
2061    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
2062    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
2063    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
2064    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
2065    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
2066    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
2067    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
2068    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
2069    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
2070    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
2071    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
2072    s[0] = s0 >> 0;
2073    s[1] = s0 >> 8;
2074    s[2] = (s0 >> 16) | (s1 << 5);
2075    s[3] = s1 >> 3;
2076    s[4] = s1 >> 11;
2077    s[5] = (s1 >> 19) | (s2 << 2);
2078    s[6] = s2 >> 6;
2079    s[7] = (s2 >> 14) | (s3 << 7);
2080    s[8] = s3 >> 1;
2081    s[9] = s3 >> 9;
2082    s[10] = (s3 >> 17) | (s4 << 4);
2083    s[11] = s4 >> 4;
2084    s[12] = s4 >> 12;
2085    s[13] = (s4 >> 20) | (s5 << 1);
2086    s[14] = s5 >> 7;
2087    s[15] = (s5 >> 15) | (s6 << 6);
2088    s[16] = s6 >> 2;
2089    s[17] = s6 >> 10;
2090    s[18] = (s6 >> 18) | (s7 << 3);
2091    s[19] = s7 >> 5;
2092    s[20] = s7 >> 13;
2093    s[21] = s8 >> 0;
2094    s[22] = s8 >> 8;
2095    s[23] = (s8 >> 16) | (s9 << 5);
2096    s[24] = s9 >> 3;
2097    s[25] = s9 >> 11;
2098    s[26] = (s9 >> 19) | (s10 << 2);
2099    s[27] = s10 >> 6;
2100    s[28] = (s10 >> 14) | (s11 << 7);
2101    s[29] = s11 >> 1;
2102    s[30] = s11 >> 9;
2103    s[31] = s11 >> 17;
2104  }
2105  void sc_sub(unsigned char *s, const unsigned char *a, const unsigned char *b) {
2106    int64_t a0 = 2097151 & load_3(a);
2107    int64_t a1 = 2097151 & (load_4(a + 2) >> 5);
2108    int64_t a2 = 2097151 & (load_3(a + 5) >> 2);
2109    int64_t a3 = 2097151 & (load_4(a + 7) >> 7);
2110    int64_t a4 = 2097151 & (load_4(a + 10) >> 4);
2111    int64_t a5 = 2097151 & (load_3(a + 13) >> 1);
2112    int64_t a6 = 2097151 & (load_4(a + 15) >> 6);
2113    int64_t a7 = 2097151 & (load_3(a + 18) >> 3);
2114    int64_t a8 = 2097151 & load_3(a + 21);
2115    int64_t a9 = 2097151 & (load_4(a + 23) >> 5);
2116    int64_t a10 = 2097151 & (load_3(a + 26) >> 2);
2117    int64_t a11 = (load_4(a + 28) >> 7);
2118    int64_t b0 = 2097151 & load_3(b);
2119    int64_t b1 = 2097151 & (load_4(b + 2) >> 5);
2120    int64_t b2 = 2097151 & (load_3(b + 5) >> 2);
2121    int64_t b3 = 2097151 & (load_4(b + 7) >> 7);
2122    int64_t b4 = 2097151 & (load_4(b + 10) >> 4);
2123    int64_t b5 = 2097151 & (load_3(b + 13) >> 1);
2124    int64_t b6 = 2097151 & (load_4(b + 15) >> 6);
2125    int64_t b7 = 2097151 & (load_3(b + 18) >> 3);
2126    int64_t b8 = 2097151 & load_3(b + 21);
2127    int64_t b9 = 2097151 & (load_4(b + 23) >> 5);
2128    int64_t b10 = 2097151 & (load_3(b + 26) >> 2);
2129    int64_t b11 = (load_4(b + 28) >> 7);
2130    int64_t s0 = a0 - b0;
2131    int64_t s1 = a1 - b1;
2132    int64_t s2 = a2 - b2;
2133    int64_t s3 = a3 - b3;
2134    int64_t s4 = a4 - b4;
2135    int64_t s5 = a5 - b5;
2136    int64_t s6 = a6 - b6;
2137    int64_t s7 = a7 - b7;
2138    int64_t s8 = a8 - b8;
2139    int64_t s9 = a9 - b9;
2140    int64_t s10 = a10 - b10;
2141    int64_t s11 = a11 - b11;
2142    int64_t s12 = 0;
2143    int64_t carry0;
2144    int64_t carry1;
2145    int64_t carry2;
2146    int64_t carry3;
2147    int64_t carry4;
2148    int64_t carry5;
2149    int64_t carry6;
2150    int64_t carry7;
2151    int64_t carry8;
2152    int64_t carry9;
2153    int64_t carry10;
2154    int64_t carry11;
2155    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
2156    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
2157    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
2158    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2159    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2160    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2161    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
2162    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
2163    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
2164    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2165    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2166    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2167    s0 += s12 * 666643;
2168    s1 += s12 * 470296;
2169    s2 += s12 * 654183;
2170    s3 -= s12 * 997805;
2171    s4 += s12 * 136657;
2172    s5 -= s12 * 683901;
2173    s12 = 0;
2174    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
2175    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
2176    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
2177    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
2178    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
2179    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
2180    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
2181    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
2182    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
2183    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
2184    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
2185    carry11 = s11 >> 21; s12 += carry11; s11 -= carry11 << 21;
2186    s0 += s12 * 666643;
2187    s1 += s12 * 470296;
2188    s2 += s12 * 654183;
2189    s3 -= s12 * 997805;
2190    s4 += s12 * 136657;
2191    s5 -= s12 * 683901;
2192    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
2193    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
2194    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
2195    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
2196    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
2197    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
2198    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
2199    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
2200    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
2201    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
2202    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
2203    s[0] = s0 >> 0;
2204    s[1] = s0 >> 8;
2205    s[2] = (s0 >> 16) | (s1 << 5);
2206    s[3] = s1 >> 3;
2207    s[4] = s1 >> 11;
2208    s[5] = (s1 >> 19) | (s2 << 2);
2209    s[6] = s2 >> 6;
2210    s[7] = (s2 >> 14) | (s3 << 7);
2211    s[8] = s3 >> 1;
2212    s[9] = s3 >> 9;
2213    s[10] = (s3 >> 17) | (s4 << 4);
2214    s[11] = s4 >> 4;
2215    s[12] = s4 >> 12;
2216    s[13] = (s4 >> 20) | (s5 << 1);
2217    s[14] = s5 >> 7;
2218    s[15] = (s5 >> 15) | (s6 << 6);
2219    s[16] = s6 >> 2;
2220    s[17] = s6 >> 10;
2221    s[18] = (s6 >> 18) | (s7 << 3);
2222    s[19] = s7 >> 5;
2223    s[20] = s7 >> 13;
2224    s[21] = s8 >> 0;
2225    s[22] = s8 >> 8;
2226    s[23] = (s8 >> 16) | (s9 << 5);
2227    s[24] = s9 >> 3;
2228    s[25] = s9 >> 11;
2229    s[26] = (s9 >> 19) | (s10 << 2);
2230    s[27] = s10 >> 6;
2231    s[28] = (s10 >> 14) | (s11 << 7);
2232    s[29] = s11 >> 1;
2233    s[30] = s11 >> 9;
2234    s[31] = s11 >> 17;
2235  }
2236  void sc_mulsub(unsigned char *s, const unsigned char *a, const unsigned char *b, const unsigned char *c) {
2237    int64_t a0 = 2097151 & load_3(a);
2238    int64_t a1 = 2097151 & (load_4(a + 2) >> 5);
2239    int64_t a2 = 2097151 & (load_3(a + 5) >> 2);
2240    int64_t a3 = 2097151 & (load_4(a + 7) >> 7);
2241    int64_t a4 = 2097151 & (load_4(a + 10) >> 4);
2242    int64_t a5 = 2097151 & (load_3(a + 13) >> 1);
2243    int64_t a6 = 2097151 & (load_4(a + 15) >> 6);
2244    int64_t a7 = 2097151 & (load_3(a + 18) >> 3);
2245    int64_t a8 = 2097151 & load_3(a + 21);
2246    int64_t a9 = 2097151 & (load_4(a + 23) >> 5);
2247    int64_t a10 = 2097151 & (load_3(a + 26) >> 2);
2248    int64_t a11 = (load_4(a + 28) >> 7);
2249    int64_t b0 = 2097151 & load_3(b);
2250    int64_t b1 = 2097151 & (load_4(b + 2) >> 5);
2251    int64_t b2 = 2097151 & (load_3(b + 5) >> 2);
2252    int64_t b3 = 2097151 & (load_4(b + 7) >> 7);
2253    int64_t b4 = 2097151 & (load_4(b + 10) >> 4);
2254    int64_t b5 = 2097151 & (load_3(b + 13) >> 1);
2255    int64_t b6 = 2097151 & (load_4(b + 15) >> 6);
2256    int64_t b7 = 2097151 & (load_3(b + 18) >> 3);
2257    int64_t b8 = 2097151 & load_3(b + 21);
2258    int64_t b9 = 2097151 & (load_4(b + 23) >> 5);
2259    int64_t b10 = 2097151 & (load_3(b + 26) >> 2);
2260    int64_t b11 = (load_4(b + 28) >> 7);
2261    int64_t c0 = 2097151 & load_3(c);
2262    int64_t c1 = 2097151 & (load_4(c + 2) >> 5);
2263    int64_t c2 = 2097151 & (load_3(c + 5) >> 2);
2264    int64_t c3 = 2097151 & (load_4(c + 7) >> 7);
2265    int64_t c4 = 2097151 & (load_4(c + 10) >> 4);
2266    int64_t c5 = 2097151 & (load_3(c + 13) >> 1);
2267    int64_t c6 = 2097151 & (load_4(c + 15) >> 6);
2268    int64_t c7 = 2097151 & (load_3(c + 18) >> 3);
2269    int64_t c8 = 2097151 & load_3(c + 21);
2270    int64_t c9 = 2097151 & (load_4(c + 23) >> 5);
2271    int64_t c10 = 2097151 & (load_3(c + 26) >> 2);
2272    int64_t c11 = (load_4(c + 28) >> 7);
2273    int64_t s0;
2274    int64_t s1;
2275    int64_t s2;
2276    int64_t s3;
2277    int64_t s4;
2278    int64_t s5;
2279    int64_t s6;
2280    int64_t s7;
2281    int64_t s8;
2282    int64_t s9;
2283    int64_t s10;
2284    int64_t s11;
2285    int64_t s12;
2286    int64_t s13;
2287    int64_t s14;
2288    int64_t s15;
2289    int64_t s16;
2290    int64_t s17;
2291    int64_t s18;
2292    int64_t s19;
2293    int64_t s20;
2294    int64_t s21;
2295    int64_t s22;
2296    int64_t s23;
2297    int64_t carry0;
2298    int64_t carry1;
2299    int64_t carry2;
2300    int64_t carry3;
2301    int64_t carry4;
2302    int64_t carry5;
2303    int64_t carry6;
2304    int64_t carry7;
2305    int64_t carry8;
2306    int64_t carry9;
2307    int64_t carry10;
2308    int64_t carry11;
2309    int64_t carry12;
2310    int64_t carry13;
2311    int64_t carry14;
2312    int64_t carry15;
2313    int64_t carry16;
2314    int64_t carry17;
2315    int64_t carry18;
2316    int64_t carry19;
2317    int64_t carry20;
2318    int64_t carry21;
2319    int64_t carry22;
2320    s0 = c0 - a0*b0;
2321    s1 = c1 - (a0*b1 + a1*b0);
2322    s2 = c2 - (a0*b2 + a1*b1 + a2*b0);
2323    s3 = c3 - (a0*b3 + a1*b2 + a2*b1 + a3*b0);
2324    s4 = c4 - (a0*b4 + a1*b3 + a2*b2 + a3*b1 + a4*b0);
2325    s5 = c5 - (a0*b5 + a1*b4 + a2*b3 + a3*b2 + a4*b1 + a5*b0);
2326    s6 = c6 - (a0*b6 + a1*b5 + a2*b4 + a3*b3 + a4*b2 + a5*b1 + a6*b0);
2327    s7 = c7 - (a0*b7 + a1*b6 + a2*b5 + a3*b4 + a4*b3 + a5*b2 + a6*b1 + a7*b0);
2328    s8 = c8 - (a0*b8 + a1*b7 + a2*b6 + a3*b5 + a4*b4 + a5*b3 + a6*b2 + a7*b1 + a8*b0);
2329    s9 = c9 - (a0*b9 + a1*b8 + a2*b7 + a3*b6 + a4*b5 + a5*b4 + a6*b3 + a7*b2 + a8*b1 + a9*b0);
2330    s10 = c10 - (a0*b10 + a1*b9 + a2*b8 + a3*b7 + a4*b6 + a5*b5 + a6*b4 + a7*b3 + a8*b2 + a9*b1 + a10*b0);
2331    s11 = c11 - (a0*b11 + a1*b10 + a2*b9 + a3*b8 + a4*b7 + a5*b6 + a6*b5 + a7*b4 + a8*b3 + a9*b2 + a10*b1 + a11*b0);
2332    s12 = -(a1*b11 + a2*b10 + a3*b9 + a4*b8 + a5*b7 + a6*b6 + a7*b5 + a8*b4 + a9*b3 + a10*b2 + a11*b1);
2333    s13 = -(a2*b11 + a3*b10 + a4*b9 + a5*b8 + a6*b7 + a7*b6 + a8*b5 + a9*b4 + a10*b3 + a11*b2);
2334    s14 = -(a3*b11 + a4*b10 + a5*b9 + a6*b8 + a7*b7 + a8*b6 + a9*b5 + a10*b4 + a11*b3);
2335    s15 = -(a4*b11 + a5*b10 + a6*b9 + a7*b8 + a8*b7 + a9*b6 + a10*b5 + a11*b4);
2336    s16 = -(a5*b11 + a6*b10 + a7*b9 + a8*b8 + a9*b7 + a10*b6 + a11*b5);
2337    s17 = -(a6*b11 + a7*b10 + a8*b9 + a9*b8 + a10*b7 + a11*b6);
2338    s18 = -(a7*b11 + a8*b10 + a9*b9 + a10*b8 + a11*b7);
2339    s19 = -(a8*b11 + a9*b10 + a10*b9 + a11*b8);
2340    s20 = -(a9*b11 + a10*b10 + a11*b9);
2341    s21 = -(a10*b11 + a11*b10);
2342    s22 = -a11*b11;
2343    s23 = 0;
2344    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
2345    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
2346    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
2347    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2348    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2349    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2350    carry12 = (s12 + (1<<20)) >> 21; s13 += carry12; s12 -= carry12 << 21;
2351    carry14 = (s14 + (1<<20)) >> 21; s15 += carry14; s14 -= carry14 << 21;
2352    carry16 = (s16 + (1<<20)) >> 21; s17 += carry16; s16 -= carry16 << 21;
2353    carry18 = (s18 + (1<<20)) >> 21; s19 += carry18; s18 -= carry18 << 21;
2354    carry20 = (s20 + (1<<20)) >> 21; s21 += carry20; s20 -= carry20 << 21;
2355    carry22 = (s22 + (1<<20)) >> 21; s23 += carry22; s22 -= carry22 << 21;
2356    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
2357    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
2358    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
2359    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2360    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2361    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2362    carry13 = (s13 + (1<<20)) >> 21; s14 += carry13; s13 -= carry13 << 21;
2363    carry15 = (s15 + (1<<20)) >> 21; s16 += carry15; s15 -= carry15 << 21;
2364    carry17 = (s17 + (1<<20)) >> 21; s18 += carry17; s17 -= carry17 << 21;
2365    carry19 = (s19 + (1<<20)) >> 21; s20 += carry19; s19 -= carry19 << 21;
2366    carry21 = (s21 + (1<<20)) >> 21; s22 += carry21; s21 -= carry21 << 21;
2367    s11 += s23 * 666643;
2368    s12 += s23 * 470296;
2369    s13 += s23 * 654183;
2370    s14 -= s23 * 997805;
2371    s15 += s23 * 136657;
2372    s16 -= s23 * 683901;
2373    s10 += s22 * 666643;
2374    s11 += s22 * 470296;
2375    s12 += s22 * 654183;
2376    s13 -= s22 * 997805;
2377    s14 += s22 * 136657;
2378    s15 -= s22 * 683901;
2379    s9 += s21 * 666643;
2380    s10 += s21 * 470296;
2381    s11 += s21 * 654183;
2382    s12 -= s21 * 997805;
2383    s13 += s21 * 136657;
2384    s14 -= s21 * 683901;
2385    s8 += s20 * 666643;
2386    s9 += s20 * 470296;
2387    s10 += s20 * 654183;
2388    s11 -= s20 * 997805;
2389    s12 += s20 * 136657;
2390    s13 -= s20 * 683901;
2391    s7 += s19 * 666643;
2392    s8 += s19 * 470296;
2393    s9 += s19 * 654183;
2394    s10 -= s19 * 997805;
2395    s11 += s19 * 136657;
2396    s12 -= s19 * 683901;
2397    s6 += s18 * 666643;
2398    s7 += s18 * 470296;
2399    s8 += s18 * 654183;
2400    s9 -= s18 * 997805;
2401    s10 += s18 * 136657;
2402    s11 -= s18 * 683901;
2403    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2404    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2405    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2406    carry12 = (s12 + (1<<20)) >> 21; s13 += carry12; s12 -= carry12 << 21;
2407    carry14 = (s14 + (1<<20)) >> 21; s15 += carry14; s14 -= carry14 << 21;
2408    carry16 = (s16 + (1<<20)) >> 21; s17 += carry16; s16 -= carry16 << 21;
2409    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2410    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2411    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2412    carry13 = (s13 + (1<<20)) >> 21; s14 += carry13; s13 -= carry13 << 21;
2413    carry15 = (s15 + (1<<20)) >> 21; s16 += carry15; s15 -= carry15 << 21;
2414    s5 += s17 * 666643;
2415    s6 += s17 * 470296;
2416    s7 += s17 * 654183;
2417    s8 -= s17 * 997805;
2418    s9 += s17 * 136657;
2419    s10 -= s17 * 683901;
2420    s4 += s16 * 666643;
2421    s5 += s16 * 470296;
2422    s6 += s16 * 654183;
2423    s7 -= s16 * 997805;
2424    s8 += s16 * 136657;
2425    s9 -= s16 * 683901;
2426    s3 += s15 * 666643;
2427    s4 += s15 * 470296;
2428    s5 += s15 * 654183;
2429    s6 -= s15 * 997805;
2430    s7 += s15 * 136657;
2431    s8 -= s15 * 683901;
2432    s2 += s14 * 666643;
2433    s3 += s14 * 470296;
2434    s4 += s14 * 654183;
2435    s5 -= s14 * 997805;
2436    s6 += s14 * 136657;
2437    s7 -= s14 * 683901;
2438    s1 += s13 * 666643;
2439    s2 += s13 * 470296;
2440    s3 += s13 * 654183;
2441    s4 -= s13 * 997805;
2442    s5 += s13 * 136657;
2443    s6 -= s13 * 683901;
2444    s0 += s12 * 666643;
2445    s1 += s12 * 470296;
2446    s2 += s12 * 654183;
2447    s3 -= s12 * 997805;
2448    s4 += s12 * 136657;
2449    s5 -= s12 * 683901;
2450    s12 = 0;
2451    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
2452    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
2453    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
2454    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2455    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2456    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2457    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
2458    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
2459    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
2460    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2461    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2462    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2463    s0 += s12 * 666643;
2464    s1 += s12 * 470296;
2465    s2 += s12 * 654183;
2466    s3 -= s12 * 997805;
2467    s4 += s12 * 136657;
2468    s5 -= s12 * 683901;
2469    s12 = 0;
2470    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
2471    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
2472    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
2473    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
2474    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
2475    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
2476    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
2477    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
2478    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
2479    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
2480    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
2481    carry11 = s11 >> 21; s12 += carry11; s11 -= carry11 << 21;
2482    s0 += s12 * 666643;
2483    s1 += s12 * 470296;
2484    s2 += s12 * 654183;
2485    s3 -= s12 * 997805;
2486    s4 += s12 * 136657;
2487    s5 -= s12 * 683901;
2488    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
2489    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
2490    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
2491    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
2492    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
2493    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
2494    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
2495    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
2496    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
2497    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
2498    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
2499    s[0] = s0 >> 0;
2500    s[1] = s0 >> 8;
2501    s[2] = (s0 >> 16) | (s1 << 5);
2502    s[3] = s1 >> 3;
2503    s[4] = s1 >> 11;
2504    s[5] = (s1 >> 19) | (s2 << 2);
2505    s[6] = s2 >> 6;
2506    s[7] = (s2 >> 14) | (s3 << 7);
2507    s[8] = s3 >> 1;
2508    s[9] = s3 >> 9;
2509    s[10] = (s3 >> 17) | (s4 << 4);
2510    s[11] = s4 >> 4;
2511    s[12] = s4 >> 12;
2512    s[13] = (s4 >> 20) | (s5 << 1);
2513    s[14] = s5 >> 7;
2514    s[15] = (s5 >> 15) | (s6 << 6);
2515    s[16] = s6 >> 2;
2516    s[17] = s6 >> 10;
2517    s[18] = (s6 >> 18) | (s7 << 3);
2518    s[19] = s7 >> 5;
2519    s[20] = s7 >> 13;
2520    s[21] = s8 >> 0;
2521    s[22] = s8 >> 8;
2522    s[23] = (s8 >> 16) | (s9 << 5);
2523    s[24] = s9 >> 3;
2524    s[25] = s9 >> 11;
2525    s[26] = (s9 >> 19) | (s10 << 2);
2526    s[27] = s10 >> 6;
2527    s[28] = (s10 >> 14) | (s11 << 7);
2528    s[29] = s11 >> 1;
2529    s[30] = s11 >> 9;
2530    s[31] = s11 >> 17;
2531  }
2532  void sc_mul(unsigned char *s, const unsigned char *a, const unsigned char *b) {
2533    int64_t a0 = 2097151 & load_3(a);
2534    int64_t a1 = 2097151 & (load_4(a + 2) >> 5);
2535    int64_t a2 = 2097151 & (load_3(a + 5) >> 2);
2536    int64_t a3 = 2097151 & (load_4(a + 7) >> 7);
2537    int64_t a4 = 2097151 & (load_4(a + 10) >> 4);
2538    int64_t a5 = 2097151 & (load_3(a + 13) >> 1);
2539    int64_t a6 = 2097151 & (load_4(a + 15) >> 6);
2540    int64_t a7 = 2097151 & (load_3(a + 18) >> 3);
2541    int64_t a8 = 2097151 & load_3(a + 21);
2542    int64_t a9 = 2097151 & (load_4(a + 23) >> 5);
2543    int64_t a10 = 2097151 & (load_3(a + 26) >> 2);
2544    int64_t a11 = (load_4(a + 28) >> 7);
2545    int64_t b0 = 2097151 & load_3(b);
2546    int64_t b1 = 2097151 & (load_4(b + 2) >> 5);
2547    int64_t b2 = 2097151 & (load_3(b + 5) >> 2);
2548    int64_t b3 = 2097151 & (load_4(b + 7) >> 7);
2549    int64_t b4 = 2097151 & (load_4(b + 10) >> 4);
2550    int64_t b5 = 2097151 & (load_3(b + 13) >> 1);
2551    int64_t b6 = 2097151 & (load_4(b + 15) >> 6);
2552    int64_t b7 = 2097151 & (load_3(b + 18) >> 3);
2553    int64_t b8 = 2097151 & load_3(b + 21);
2554    int64_t b9 = 2097151 & (load_4(b + 23) >> 5);
2555    int64_t b10 = 2097151 & (load_3(b + 26) >> 2);
2556    int64_t b11 = (load_4(b + 28) >> 7);
2557    int64_t s0;
2558    int64_t s1;
2559    int64_t s2;
2560    int64_t s3;
2561    int64_t s4;
2562    int64_t s5;
2563    int64_t s6;
2564    int64_t s7;
2565    int64_t s8;
2566    int64_t s9;
2567    int64_t s10;
2568    int64_t s11;
2569    int64_t s12;
2570    int64_t s13;
2571    int64_t s14;
2572    int64_t s15;
2573    int64_t s16;
2574    int64_t s17;
2575    int64_t s18;
2576    int64_t s19;
2577    int64_t s20;
2578    int64_t s21;
2579    int64_t s22;
2580    int64_t s23;
2581    int64_t carry0;
2582    int64_t carry1;
2583    int64_t carry2;
2584    int64_t carry3;
2585    int64_t carry4;
2586    int64_t carry5;
2587    int64_t carry6;
2588    int64_t carry7;
2589    int64_t carry8;
2590    int64_t carry9;
2591    int64_t carry10;
2592    int64_t carry11;
2593    int64_t carry12;
2594    int64_t carry13;
2595    int64_t carry14;
2596    int64_t carry15;
2597    int64_t carry16;
2598    int64_t carry17;
2599    int64_t carry18;
2600    int64_t carry19;
2601    int64_t carry20;
2602    int64_t carry21;
2603    int64_t carry22;
2604    s0 = a0*b0;
2605    s1 = (a0*b1 + a1*b0);
2606    s2 = (a0*b2 + a1*b1 + a2*b0);
2607    s3 = (a0*b3 + a1*b2 + a2*b1 + a3*b0);
2608    s4 = (a0*b4 + a1*b3 + a2*b2 + a3*b1 + a4*b0);
2609    s5 = (a0*b5 + a1*b4 + a2*b3 + a3*b2 + a4*b1 + a5*b0);
2610    s6 = (a0*b6 + a1*b5 + a2*b4 + a3*b3 + a4*b2 + a5*b1 + a6*b0);
2611    s7 = (a0*b7 + a1*b6 + a2*b5 + a3*b4 + a4*b3 + a5*b2 + a6*b1 + a7*b0);
2612    s8 = (a0*b8 + a1*b7 + a2*b6 + a3*b5 + a4*b4 + a5*b3 + a6*b2 + a7*b1 + a8*b0);
2613    s9 = (a0*b9 + a1*b8 + a2*b7 + a3*b6 + a4*b5 + a5*b4 + a6*b3 + a7*b2 + a8*b1 + a9*b0);
2614    s10 = (a0*b10 + a1*b9 + a2*b8 + a3*b7 + a4*b6 + a5*b5 + a6*b4 + a7*b3 + a8*b2 + a9*b1 + a10*b0);
2615    s11 = (a0*b11 + a1*b10 + a2*b9 + a3*b8 + a4*b7 + a5*b6 + a6*b5 + a7*b4 + a8*b3 + a9*b2 + a10*b1 + a11*b0);
2616    s12 = (a1*b11 + a2*b10 + a3*b9 + a4*b8 + a5*b7 + a6*b6 + a7*b5 + a8*b4 + a9*b3 + a10*b2 + a11*b1);
2617    s13 = (a2*b11 + a3*b10 + a4*b9 + a5*b8 + a6*b7 + a7*b6 + a8*b5 + a9*b4 + a10*b3 + a11*b2);
2618    s14 = (a3*b11 + a4*b10 + a5*b9 + a6*b8 + a7*b7 + a8*b6 + a9*b5 + a10*b4 + a11*b3);
2619    s15 = (a4*b11 + a5*b10 + a6*b9 + a7*b8 + a8*b7 + a9*b6 + a10*b5 + a11*b4);
2620    s16 = (a5*b11 + a6*b10 + a7*b9 + a8*b8 + a9*b7 + a10*b6 + a11*b5);
2621    s17 = (a6*b11 + a7*b10 + a8*b9 + a9*b8 + a10*b7 + a11*b6);
2622    s18 = (a7*b11 + a8*b10 + a9*b9 + a10*b8 + a11*b7);
2623    s19 = (a8*b11 + a9*b10 + a10*b9 + a11*b8);
2624    s20 = (a9*b11 + a10*b10 + a11*b9);
2625    s21 = (a10*b11 + a11*b10);
2626    s22 = a11*b11;
2627    s23 = 0;
2628    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
2629    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
2630    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
2631    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2632    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2633    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2634    carry12 = (s12 + (1<<20)) >> 21; s13 += carry12; s12 -= carry12 << 21;
2635    carry14 = (s14 + (1<<20)) >> 21; s15 += carry14; s14 -= carry14 << 21;
2636    carry16 = (s16 + (1<<20)) >> 21; s17 += carry16; s16 -= carry16 << 21;
2637    carry18 = (s18 + (1<<20)) >> 21; s19 += carry18; s18 -= carry18 << 21;
2638    carry20 = (s20 + (1<<20)) >> 21; s21 += carry20; s20 -= carry20 << 21;
2639    carry22 = (s22 + (1<<20)) >> 21; s23 += carry22; s22 -= carry22 << 21;
2640    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
2641    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
2642    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
2643    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2644    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2645    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2646    carry13 = (s13 + (1<<20)) >> 21; s14 += carry13; s13 -= carry13 << 21;
2647    carry15 = (s15 + (1<<20)) >> 21; s16 += carry15; s15 -= carry15 << 21;
2648    carry17 = (s17 + (1<<20)) >> 21; s18 += carry17; s17 -= carry17 << 21;
2649    carry19 = (s19 + (1<<20)) >> 21; s20 += carry19; s19 -= carry19 << 21;
2650    carry21 = (s21 + (1<<20)) >> 21; s22 += carry21; s21 -= carry21 << 21;
2651    s11 += s23 * 666643;
2652    s12 += s23 * 470296;
2653    s13 += s23 * 654183;
2654    s14 -= s23 * 997805;
2655    s15 += s23 * 136657;
2656    s16 -= s23 * 683901;
2657    s10 += s22 * 666643;
2658    s11 += s22 * 470296;
2659    s12 += s22 * 654183;
2660    s13 -= s22 * 997805;
2661    s14 += s22 * 136657;
2662    s15 -= s22 * 683901;
2663    s9 += s21 * 666643;
2664    s10 += s21 * 470296;
2665    s11 += s21 * 654183;
2666    s12 -= s21 * 997805;
2667    s13 += s21 * 136657;
2668    s14 -= s21 * 683901;
2669    s8 += s20 * 666643;
2670    s9 += s20 * 470296;
2671    s10 += s20 * 654183;
2672    s11 -= s20 * 997805;
2673    s12 += s20 * 136657;
2674    s13 -= s20 * 683901;
2675    s7 += s19 * 666643;
2676    s8 += s19 * 470296;
2677    s9 += s19 * 654183;
2678    s10 -= s19 * 997805;
2679    s11 += s19 * 136657;
2680    s12 -= s19 * 683901;
2681    s6 += s18 * 666643;
2682    s7 += s18 * 470296;
2683    s8 += s18 * 654183;
2684    s9 -= s18 * 997805;
2685    s10 += s18 * 136657;
2686    s11 -= s18 * 683901;
2687    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2688    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2689    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2690    carry12 = (s12 + (1<<20)) >> 21; s13 += carry12; s12 -= carry12 << 21;
2691    carry14 = (s14 + (1<<20)) >> 21; s15 += carry14; s14 -= carry14 << 21;
2692    carry16 = (s16 + (1<<20)) >> 21; s17 += carry16; s16 -= carry16 << 21;
2693    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2694    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2695    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2696    carry13 = (s13 + (1<<20)) >> 21; s14 += carry13; s13 -= carry13 << 21;
2697    carry15 = (s15 + (1<<20)) >> 21; s16 += carry15; s15 -= carry15 << 21;
2698    s5 += s17 * 666643;
2699    s6 += s17 * 470296;
2700    s7 += s17 * 654183;
2701    s8 -= s17 * 997805;
2702    s9 += s17 * 136657;
2703    s10 -= s17 * 683901;
2704    s4 += s16 * 666643;
2705    s5 += s16 * 470296;
2706    s6 += s16 * 654183;
2707    s7 -= s16 * 997805;
2708    s8 += s16 * 136657;
2709    s9 -= s16 * 683901;
2710    s3 += s15 * 666643;
2711    s4 += s15 * 470296;
2712    s5 += s15 * 654183;
2713    s6 -= s15 * 997805;
2714    s7 += s15 * 136657;
2715    s8 -= s15 * 683901;
2716    s2 += s14 * 666643;
2717    s3 += s14 * 470296;
2718    s4 += s14 * 654183;
2719    s5 -= s14 * 997805;
2720    s6 += s14 * 136657;
2721    s7 -= s14 * 683901;
2722    s1 += s13 * 666643;
2723    s2 += s13 * 470296;
2724    s3 += s13 * 654183;
2725    s4 -= s13 * 997805;
2726    s5 += s13 * 136657;
2727    s6 -= s13 * 683901;
2728    s0 += s12 * 666643;
2729    s1 += s12 * 470296;
2730    s2 += s12 * 654183;
2731    s3 -= s12 * 997805;
2732    s4 += s12 * 136657;
2733    s5 -= s12 * 683901;
2734    s12 = 0;
2735    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
2736    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
2737    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
2738    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2739    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2740    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2741    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
2742    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
2743    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
2744    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2745    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2746    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2747    s0 += s12 * 666643;
2748    s1 += s12 * 470296;
2749    s2 += s12 * 654183;
2750    s3 -= s12 * 997805;
2751    s4 += s12 * 136657;
2752    s5 -= s12 * 683901;
2753    s12 = 0;
2754    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
2755    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
2756    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
2757    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
2758    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
2759    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
2760    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
2761    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
2762    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
2763    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
2764    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
2765    carry11 = s11 >> 21; s12 += carry11; s11 -= carry11 << 21;
2766    s0 += s12 * 666643;
2767    s1 += s12 * 470296;
2768    s2 += s12 * 654183;
2769    s3 -= s12 * 997805;
2770    s4 += s12 * 136657;
2771    s5 -= s12 * 683901;
2772    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
2773    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
2774    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
2775    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
2776    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
2777    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
2778    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
2779    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
2780    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
2781    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
2782    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
2783    s[0] = s0 >> 0;
2784    s[1] = s0 >> 8;
2785    s[2] = (s0 >> 16) | (s1 << 5);
2786    s[3] = s1 >> 3;
2787    s[4] = s1 >> 11;
2788    s[5] = (s1 >> 19) | (s2 << 2);
2789    s[6] = s2 >> 6;
2790    s[7] = (s2 >> 14) | (s3 << 7);
2791    s[8] = s3 >> 1;
2792    s[9] = s3 >> 9;
2793    s[10] = (s3 >> 17) | (s4 << 4);
2794    s[11] = s4 >> 4;
2795    s[12] = s4 >> 12;
2796    s[13] = (s4 >> 20) | (s5 << 1);
2797    s[14] = s5 >> 7;
2798    s[15] = (s5 >> 15) | (s6 << 6);
2799    s[16] = s6 >> 2;
2800    s[17] = s6 >> 10;
2801    s[18] = (s6 >> 18) | (s7 << 3);
2802    s[19] = s7 >> 5;
2803    s[20] = s7 >> 13;
2804    s[21] = s8 >> 0;
2805    s[22] = s8 >> 8;
2806    s[23] = (s8 >> 16) | (s9 << 5);
2807    s[24] = s9 >> 3;
2808    s[25] = s9 >> 11;
2809    s[26] = (s9 >> 19) | (s10 << 2);
2810    s[27] = s10 >> 6;
2811    s[28] = (s10 >> 14) | (s11 << 7);
2812    s[29] = s11 >> 1;
2813    s[30] = s11 >> 9;
2814    s[31] = s11 >> 17;
2815  }
2816  void sc_muladd(unsigned char *s, const unsigned char *a, const unsigned char *b, const unsigned char *c) {
2817    int64_t a0 = 2097151 & load_3(a);
2818    int64_t a1 = 2097151 & (load_4(a + 2) >> 5);
2819    int64_t a2 = 2097151 & (load_3(a + 5) >> 2);
2820    int64_t a3 = 2097151 & (load_4(a + 7) >> 7);
2821    int64_t a4 = 2097151 & (load_4(a + 10) >> 4);
2822    int64_t a5 = 2097151 & (load_3(a + 13) >> 1);
2823    int64_t a6 = 2097151 & (load_4(a + 15) >> 6);
2824    int64_t a7 = 2097151 & (load_3(a + 18) >> 3);
2825    int64_t a8 = 2097151 & load_3(a + 21);
2826    int64_t a9 = 2097151 & (load_4(a + 23) >> 5);
2827    int64_t a10 = 2097151 & (load_3(a + 26) >> 2);
2828    int64_t a11 = (load_4(a + 28) >> 7);
2829    int64_t b0 = 2097151 & load_3(b);
2830    int64_t b1 = 2097151 & (load_4(b + 2) >> 5);
2831    int64_t b2 = 2097151 & (load_3(b + 5) >> 2);
2832    int64_t b3 = 2097151 & (load_4(b + 7) >> 7);
2833    int64_t b4 = 2097151 & (load_4(b + 10) >> 4);
2834    int64_t b5 = 2097151 & (load_3(b + 13) >> 1);
2835    int64_t b6 = 2097151 & (load_4(b + 15) >> 6);
2836    int64_t b7 = 2097151 & (load_3(b + 18) >> 3);
2837    int64_t b8 = 2097151 & load_3(b + 21);
2838    int64_t b9 = 2097151 & (load_4(b + 23) >> 5);
2839    int64_t b10 = 2097151 & (load_3(b + 26) >> 2);
2840    int64_t b11 = (load_4(b + 28) >> 7);
2841    int64_t c0 = 2097151 & load_3(c);
2842    int64_t c1 = 2097151 & (load_4(c + 2) >> 5);
2843    int64_t c2 = 2097151 & (load_3(c + 5) >> 2);
2844    int64_t c3 = 2097151 & (load_4(c + 7) >> 7);
2845    int64_t c4 = 2097151 & (load_4(c + 10) >> 4);
2846    int64_t c5 = 2097151 & (load_3(c + 13) >> 1);
2847    int64_t c6 = 2097151 & (load_4(c + 15) >> 6);
2848    int64_t c7 = 2097151 & (load_3(c + 18) >> 3);
2849    int64_t c8 = 2097151 & load_3(c + 21);
2850    int64_t c9 = 2097151 & (load_4(c + 23) >> 5);
2851    int64_t c10 = 2097151 & (load_3(c + 26) >> 2);
2852    int64_t c11 = (load_4(c + 28) >> 7);
2853    int64_t s0;
2854    int64_t s1;
2855    int64_t s2;
2856    int64_t s3;
2857    int64_t s4;
2858    int64_t s5;
2859    int64_t s6;
2860    int64_t s7;
2861    int64_t s8;
2862    int64_t s9;
2863    int64_t s10;
2864    int64_t s11;
2865    int64_t s12;
2866    int64_t s13;
2867    int64_t s14;
2868    int64_t s15;
2869    int64_t s16;
2870    int64_t s17;
2871    int64_t s18;
2872    int64_t s19;
2873    int64_t s20;
2874    int64_t s21;
2875    int64_t s22;
2876    int64_t s23;
2877    int64_t carry0;
2878    int64_t carry1;
2879    int64_t carry2;
2880    int64_t carry3;
2881    int64_t carry4;
2882    int64_t carry5;
2883    int64_t carry6;
2884    int64_t carry7;
2885    int64_t carry8;
2886    int64_t carry9;
2887    int64_t carry10;
2888    int64_t carry11;
2889    int64_t carry12;
2890    int64_t carry13;
2891    int64_t carry14;
2892    int64_t carry15;
2893    int64_t carry16;
2894    int64_t carry17;
2895    int64_t carry18;
2896    int64_t carry19;
2897    int64_t carry20;
2898    int64_t carry21;
2899    int64_t carry22;
2900    s0 = c0 + a0*b0;
2901    s1 = c1 + (a0*b1 + a1*b0);
2902    s2 = c2 + (a0*b2 + a1*b1 + a2*b0);
2903    s3 = c3 + (a0*b3 + a1*b2 + a2*b1 + a3*b0);
2904    s4 = c4 + (a0*b4 + a1*b3 + a2*b2 + a3*b1 + a4*b0);
2905    s5 = c5 + (a0*b5 + a1*b4 + a2*b3 + a3*b2 + a4*b1 + a5*b0);
2906    s6 = c6 + (a0*b6 + a1*b5 + a2*b4 + a3*b3 + a4*b2 + a5*b1 + a6*b0);
2907    s7 = c7 + (a0*b7 + a1*b6 + a2*b5 + a3*b4 + a4*b3 + a5*b2 + a6*b1 + a7*b0);
2908    s8 = c8 + (a0*b8 + a1*b7 + a2*b6 + a3*b5 + a4*b4 + a5*b3 + a6*b2 + a7*b1 + a8*b0);
2909    s9 = c9 + (a0*b9 + a1*b8 + a2*b7 + a3*b6 + a4*b5 + a5*b4 + a6*b3 + a7*b2 + a8*b1 + a9*b0);
2910    s10 = c10 + (a0*b10 + a1*b9 + a2*b8 + a3*b7 + a4*b6 + a5*b5 + a6*b4 + a7*b3 + a8*b2 + a9*b1 + a10*b0);
2911    s11 = c11 + (a0*b11 + a1*b10 + a2*b9 + a3*b8 + a4*b7 + a5*b6 + a6*b5 + a7*b4 + a8*b3 + a9*b2 + a10*b1 + a11*b0);
2912    s12 = (a1*b11 + a2*b10 + a3*b9 + a4*b8 + a5*b7 + a6*b6 + a7*b5 + a8*b4 + a9*b3 + a10*b2 + a11*b1);
2913    s13 = (a2*b11 + a3*b10 + a4*b9 + a5*b8 + a6*b7 + a7*b6 + a8*b5 + a9*b4 + a10*b3 + a11*b2);
2914    s14 = (a3*b11 + a4*b10 + a5*b9 + a6*b8 + a7*b7 + a8*b6 + a9*b5 + a10*b4 + a11*b3);
2915    s15 = (a4*b11 + a5*b10 + a6*b9 + a7*b8 + a8*b7 + a9*b6 + a10*b5 + a11*b4);
2916    s16 = (a5*b11 + a6*b10 + a7*b9 + a8*b8 + a9*b7 + a10*b6 + a11*b5);
2917    s17 = (a6*b11 + a7*b10 + a8*b9 + a9*b8 + a10*b7 + a11*b6);
2918    s18 = (a7*b11 + a8*b10 + a9*b9 + a10*b8 + a11*b7);
2919    s19 = (a8*b11 + a9*b10 + a10*b9 + a11*b8);
2920    s20 = (a9*b11 + a10*b10 + a11*b9);
2921    s21 = (a10*b11 + a11*b10);
2922    s22 = a11*b11;
2923    s23 = 0;
2924    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
2925    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
2926    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
2927    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2928    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2929    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2930    carry12 = (s12 + (1<<20)) >> 21; s13 += carry12; s12 -= carry12 << 21;
2931    carry14 = (s14 + (1<<20)) >> 21; s15 += carry14; s14 -= carry14 << 21;
2932    carry16 = (s16 + (1<<20)) >> 21; s17 += carry16; s16 -= carry16 << 21;
2933    carry18 = (s18 + (1<<20)) >> 21; s19 += carry18; s18 -= carry18 << 21;
2934    carry20 = (s20 + (1<<20)) >> 21; s21 += carry20; s20 -= carry20 << 21;
2935    carry22 = (s22 + (1<<20)) >> 21; s23 += carry22; s22 -= carry22 << 21;
2936    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
2937    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
2938    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
2939    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2940    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2941    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2942    carry13 = (s13 + (1<<20)) >> 21; s14 += carry13; s13 -= carry13 << 21;
2943    carry15 = (s15 + (1<<20)) >> 21; s16 += carry15; s15 -= carry15 << 21;
2944    carry17 = (s17 + (1<<20)) >> 21; s18 += carry17; s17 -= carry17 << 21;
2945    carry19 = (s19 + (1<<20)) >> 21; s20 += carry19; s19 -= carry19 << 21;
2946    carry21 = (s21 + (1<<20)) >> 21; s22 += carry21; s21 -= carry21 << 21;
2947    s11 += s23 * 666643;
2948    s12 += s23 * 470296;
2949    s13 += s23 * 654183;
2950    s14 -= s23 * 997805;
2951    s15 += s23 * 136657;
2952    s16 -= s23 * 683901;
2953    s10 += s22 * 666643;
2954    s11 += s22 * 470296;
2955    s12 += s22 * 654183;
2956    s13 -= s22 * 997805;
2957    s14 += s22 * 136657;
2958    s15 -= s22 * 683901;
2959    s9 += s21 * 666643;
2960    s10 += s21 * 470296;
2961    s11 += s21 * 654183;
2962    s12 -= s21 * 997805;
2963    s13 += s21 * 136657;
2964    s14 -= s21 * 683901;
2965    s8 += s20 * 666643;
2966    s9 += s20 * 470296;
2967    s10 += s20 * 654183;
2968    s11 -= s20 * 997805;
2969    s12 += s20 * 136657;
2970    s13 -= s20 * 683901;
2971    s7 += s19 * 666643;
2972    s8 += s19 * 470296;
2973    s9 += s19 * 654183;
2974    s10 -= s19 * 997805;
2975    s11 += s19 * 136657;
2976    s12 -= s19 * 683901;
2977    s6 += s18 * 666643;
2978    s7 += s18 * 470296;
2979    s8 += s18 * 654183;
2980    s9 -= s18 * 997805;
2981    s10 += s18 * 136657;
2982    s11 -= s18 * 683901;
2983    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
2984    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
2985    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
2986    carry12 = (s12 + (1<<20)) >> 21; s13 += carry12; s12 -= carry12 << 21;
2987    carry14 = (s14 + (1<<20)) >> 21; s15 += carry14; s14 -= carry14 << 21;
2988    carry16 = (s16 + (1<<20)) >> 21; s17 += carry16; s16 -= carry16 << 21;
2989    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
2990    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
2991    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
2992    carry13 = (s13 + (1<<20)) >> 21; s14 += carry13; s13 -= carry13 << 21;
2993    carry15 = (s15 + (1<<20)) >> 21; s16 += carry15; s15 -= carry15 << 21;
2994    s5 += s17 * 666643;
2995    s6 += s17 * 470296;
2996    s7 += s17 * 654183;
2997    s8 -= s17 * 997805;
2998    s9 += s17 * 136657;
2999    s10 -= s17 * 683901;
3000    s4 += s16 * 666643;
3001    s5 += s16 * 470296;
3002    s6 += s16 * 654183;
3003    s7 -= s16 * 997805;
3004    s8 += s16 * 136657;
3005    s9 -= s16 * 683901;
3006    s3 += s15 * 666643;
3007    s4 += s15 * 470296;
3008    s5 += s15 * 654183;
3009    s6 -= s15 * 997805;
3010    s7 += s15 * 136657;
3011    s8 -= s15 * 683901;
3012    s2 += s14 * 666643;
3013    s3 += s14 * 470296;
3014    s4 += s14 * 654183;
3015    s5 -= s14 * 997805;
3016    s6 += s14 * 136657;
3017    s7 -= s14 * 683901;
3018    s1 += s13 * 666643;
3019    s2 += s13 * 470296;
3020    s3 += s13 * 654183;
3021    s4 -= s13 * 997805;
3022    s5 += s13 * 136657;
3023    s6 -= s13 * 683901;
3024    s0 += s12 * 666643;
3025    s1 += s12 * 470296;
3026    s2 += s12 * 654183;
3027    s3 -= s12 * 997805;
3028    s4 += s12 * 136657;
3029    s5 -= s12 * 683901;
3030    s12 = 0;
3031    carry0 = (s0 + (1<<20)) >> 21; s1 += carry0; s0 -= carry0 << 21;
3032    carry2 = (s2 + (1<<20)) >> 21; s3 += carry2; s2 -= carry2 << 21;
3033    carry4 = (s4 + (1<<20)) >> 21; s5 += carry4; s4 -= carry4 << 21;
3034    carry6 = (s6 + (1<<20)) >> 21; s7 += carry6; s6 -= carry6 << 21;
3035    carry8 = (s8 + (1<<20)) >> 21; s9 += carry8; s8 -= carry8 << 21;
3036    carry10 = (s10 + (1<<20)) >> 21; s11 += carry10; s10 -= carry10 << 21;
3037    carry1 = (s1 + (1<<20)) >> 21; s2 += carry1; s1 -= carry1 << 21;
3038    carry3 = (s3 + (1<<20)) >> 21; s4 += carry3; s3 -= carry3 << 21;
3039    carry5 = (s5 + (1<<20)) >> 21; s6 += carry5; s5 -= carry5 << 21;
3040    carry7 = (s7 + (1<<20)) >> 21; s8 += carry7; s7 -= carry7 << 21;
3041    carry9 = (s9 + (1<<20)) >> 21; s10 += carry9; s9 -= carry9 << 21;
3042    carry11 = (s11 + (1<<20)) >> 21; s12 += carry11; s11 -= carry11 << 21;
3043    s0 += s12 * 666643;
3044    s1 += s12 * 470296;
3045    s2 += s12 * 654183;
3046    s3 -= s12 * 997805;
3047    s4 += s12 * 136657;
3048    s5 -= s12 * 683901;
3049    s12 = 0;
3050    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
3051    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
3052    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
3053    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
3054    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
3055    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
3056    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
3057    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
3058    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
3059    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
3060    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
3061    carry11 = s11 >> 21; s12 += carry11; s11 -= carry11 << 21;
3062    s0 += s12 * 666643;
3063    s1 += s12 * 470296;
3064    s2 += s12 * 654183;
3065    s3 -= s12 * 997805;
3066    s4 += s12 * 136657;
3067    s5 -= s12 * 683901;
3068    carry0 = s0 >> 21; s1 += carry0; s0 -= carry0 << 21;
3069    carry1 = s1 >> 21; s2 += carry1; s1 -= carry1 << 21;
3070    carry2 = s2 >> 21; s3 += carry2; s2 -= carry2 << 21;
3071    carry3 = s3 >> 21; s4 += carry3; s3 -= carry3 << 21;
3072    carry4 = s4 >> 21; s5 += carry4; s4 -= carry4 << 21;
3073    carry5 = s5 >> 21; s6 += carry5; s5 -= carry5 << 21;
3074    carry6 = s6 >> 21; s7 += carry6; s6 -= carry6 << 21;
3075    carry7 = s7 >> 21; s8 += carry7; s7 -= carry7 << 21;
3076    carry8 = s8 >> 21; s9 += carry8; s8 -= carry8 << 21;
3077    carry9 = s9 >> 21; s10 += carry9; s9 -= carry9 << 21;
3078    carry10 = s10 >> 21; s11 += carry10; s10 -= carry10 << 21;
3079    s[0] = s0 >> 0;
3080    s[1] = s0 >> 8;
3081    s[2] = (s0 >> 16) | (s1 << 5);
3082    s[3] = s1 >> 3;
3083    s[4] = s1 >> 11;
3084    s[5] = (s1 >> 19) | (s2 << 2);
3085    s[6] = s2 >> 6;
3086    s[7] = (s2 >> 14) | (s3 << 7);
3087    s[8] = s3 >> 1;
3088    s[9] = s3 >> 9;
3089    s[10] = (s3 >> 17) | (s4 << 4);
3090    s[11] = s4 >> 4;
3091    s[12] = s4 >> 12;
3092    s[13] = (s4 >> 20) | (s5 << 1);
3093    s[14] = s5 >> 7;
3094    s[15] = (s5 >> 15) | (s6 << 6);
3095    s[16] = s6 >> 2;
3096    s[17] = s6 >> 10;
3097    s[18] = (s6 >> 18) | (s7 << 3);
3098    s[19] = s7 >> 5;
3099    s[20] = s7 >> 13;
3100    s[21] = s8 >> 0;
3101    s[22] = s8 >> 8;
3102    s[23] = (s8 >> 16) | (s9 << 5);
3103    s[24] = s9 >> 3;
3104    s[25] = s9 >> 11;
3105    s[26] = (s9 >> 19) | (s10 << 2);
3106    s[27] = s10 >> 6;
3107    s[28] = (s10 >> 14) | (s11 << 7);
3108    s[29] = s11 >> 1;
3109    s[30] = s11 >> 9;
3110    s[31] = s11 >> 17;
3111  }
3112  static int64_t signum(int64_t a) {
3113    return a > 0 ? 1 : a < 0 ? -1 : 0;
3114  }
3115  int sc_check(const unsigned char *s) {
3116    int64_t s0 = load_4(s);
3117    int64_t s1 = load_4(s + 4);
3118    int64_t s2 = load_4(s + 8);
3119    int64_t s3 = load_4(s + 12);
3120    int64_t s4 = load_4(s + 16);
3121    int64_t s5 = load_4(s + 20);
3122    int64_t s6 = load_4(s + 24);
3123    int64_t s7 = load_4(s + 28);
3124    return (signum(1559614444 - s0) + (signum(1477600026 - s1) << 1) + (signum(2734136534 - s2) << 2) + (signum(350157278 - s3) << 3) + (signum(-s4) << 4) + (signum(-s5) << 5) + (signum(-s6) << 6) + (signum(268435456 - s7) << 7)) >> 8;
3125  }
3126  int sc_isnonzero(const unsigned char *s) {
3127    return (((int) (s[0] | s[1] | s[2] | s[3] | s[4] | s[5] | s[6] | s[7] | s[8] |
3128      s[9] | s[10] | s[11] | s[12] | s[13] | s[14] | s[15] | s[16] | s[17] |
3129      s[18] | s[19] | s[20] | s[21] | s[22] | s[23] | s[24] | s[25] | s[26] |
3130      s[27] | s[28] | s[29] | s[30] | s[31]) - 1) >> 8) + 1;
3131  }
3132  int ge_p3_is_point_at_infinity(const ge_p3 *p) {
3133    int n;
3134    for (n = 0; n < 10; ++n)
3135    {
3136      if (p->X[n] | p->T[n])
3137        return 0;
3138      if (p->Y[n] != p->Z[n])
3139        return 0;
3140    }
3141    return 1;
3142  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from PINRemoteImage-MDEwOlJlcG9zaXRvcnkzOTUzNzEwMw==-flat-yuv_sse2.c</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from xmrig-MDEwOlJlcG9zaXRvcnk4ODMyNzQwNg==-flat-crypto-ops.c</div>
                </div>
                <div class="column column_space"><pre><code>108    const __m128i g2 = _mm_slli_epi16(_mm_and_si128(g0, _mm_set1_epi8(0x1c)), 3);
109    const __m128i rg = _mm_or_si128(r1, g1);
110    const __m128i gb = _mm_or_si128(g2, b1);
111  #if (WEBP_SWAP_16BIT_CSP == 0)
112    const __m128i rgb565 = _mm_unpacklo_epi8(rg, gb);
113  #else
114    const __m128i rgb565 = _mm_unpacklo_epi8(gb, rg);
115  #endif
116    _mm_storeu_si128((__m128i*)dst, rgb565);
</pre></code></div>
                <div class="column column_space"><pre><code>999    int64_t h5 = load_4(s + 16);
1000    int64_t h6 = load_3(s + 20) << 7;
1001    int64_t h7 = load_3(s + 23) << 5;
1002    int64_t h8 = load_3(s + 26) << 4;
1003    int64_t h9 = (load_3(s + 29) & 8388607) << 2;
1004    int64_t carry0;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    