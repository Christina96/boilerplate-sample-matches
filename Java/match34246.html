<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for UnixDomainSocketAcceptanceTest.java & DurabilityTest.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for UnixDomainSocketAcceptanceTest.java & DurabilityTest.java
      </h3>
      <h1 align="center">
        8.6%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>UnixDomainSocketAcceptanceTest.java (14.215686%)<TH>DurabilityTest.java (6.1965814%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match34246-0.html#0',2,'match34246-1.html#0',3)" NAME="0">(21-42)<TD><A HREF="javascript:ZweiFrames('match34246-0.html#0',2,'match34246-1.html#0',3)" NAME="0">(21-39)</A><TD ALIGN=center><FONT COLOR="#ff0000">17</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match34246-0.html#1',2,'match34246-1.html#1',3)" NAME="1">(119-128)<TD><A HREF="javascript:ZweiFrames('match34246-0.html#1',2,'match34246-1.html#1',3)" NAME="1">(118-125)</A><TD ALIGN=center><FONT COLOR="#b40000">12</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>UnixDomainSocketAcceptanceTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * #%L
 * UnixDomainSocketAcceptanceTest.java - mongodb-async-driver - Allanbank Consulting, Inc.
 * %%
 * Copyright (C) 2011 - 2014 Allanbank Consulting, Inc.
 * %%
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
<A NAME="0"></A> * #L%
 */

<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match34246-1.html#0',3,'match34246-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>package com.allanbank.mongodb.acceptance;

import static org.junit.Assume.assumeNoException;
import static org.junit.Assume.assumeTrue;

import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.net.InetAddress;
import java.net.InetSocketAddress;
import java.net.Socket;
import java.net.SocketException;
import java.net.URL;
import java.net.URLClassLoader;

import javax.net.SocketFactory;

import org.junit.AfterClass;
import org.junit.BeforeClass;

import com.allanbank.mongodb.MongoClientConfiguration;
import</B></FONT> com.allanbank.mongodb.util.IOUtils;

/**
 * StandAloneAcceptanceTest performs acceptance tests for the driver against a
 * standalone MongoDB shard server.
 * &lt;p&gt;
 * These are not meant to be exhaustive tests of the driver but instead attempt
 * to demonstrate that interactions with the MongoDB processes work.
 * &lt;/p&gt;
 *
 * @copyright 2012-2013, Allanbank Consulting, Inc., All Rights Reserved
 */
public class UnixDomainSocketAcceptanceTest
        extends BasicAcceptanceTestCases {

    /** The local copy of the jar file release. */
    public static final File JAR_FILE;

    /** The name of the last junixsocket release. */
    public static final String LAST_JUNIXSOCKET_RELEASE;

    /** The name of the last junixsocket release. */
    public static final String LAST_JUNIXSOCKET_RELEASE_FILE;

    /** The local copy of the libraries directory from the release. */
    public static final File LIB_DIR;

    /** The local copy of the tar file release. */
    public static final File TAR_FILE;

    /** The Classloader for the junixsocket library. */
    protected static URLClassLoader ourJUnixSocketLibClassLoader = null;

    /** A socket address for connecting to the MongoDB server. */
    protected static InetSocketAddress ourSocketAddress = null;

    static {
        LAST_JUNIXSOCKET_RELEASE = &quot;junixsocket-1.3&quot;;
        LAST_JUNIXSOCKET_RELEASE_FILE = LAST_JUNIXSOCKET_RELEASE
                + &quot;-bin.tar.bz2&quot;;
        TAR_FILE = new File(&quot;target/&quot; + LAST_JUNIXSOCKET_RELEASE_FILE);
        LIB_DIR = new File(&quot;target/&quot; + LAST_JUNIXSOCKET_RELEASE
                + &quot;/lib-native/&quot;);
        JAR_FILE = new File(&quot;target/&quot; + LAST_JUNIXSOCKET_RELEASE + &quot;/dist/&quot;
                + LAST_JUNIXSOCKET_RELEASE + &quot;.jar&quot;);
    }

    /**
     * Starts the standalone server before the tests.
     */
    @BeforeClass
    public static void startServer() {
        startStandAlone();
        buildLargeCollection();

        FileOutputStream out = null;
        InputStream in = null;
        try {
            if (TAR_FILE.exists()) {
                TAR_FILE.delete();
            }
            final URL url = new URL(&quot;http://junixsocket.googlecode.com/files/&quot;
                    + LAST_JUNIXSOCKET_RELEASE_FILE);
            out = new FileOutputStream(TAR_FILE);
            in = url.openStream();

            final byte[] buffer = new byte[4096];
            int read = 0;
            while (0 &lt;= read) {
                out.write(buffer, 0, read);
                read = in.read(buffer);
            }
            out.flush();
            out.close();
<A NAME="1"></A>
            // Now untar the file.
            final ProcessBuilder builder = new ProcessBuilder(&quot;tar&quot;, &quot;xfj&quot;,
                    <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match34246-1.html#1',3,'match34246-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>TAR_FILE.getCanonicalPath());
            builder.directory(TAR_FILE.getParentFile());
            final Process untar = builder.start();
            untar.waitFor();
            assumeTrue(LIB_DIR.isDirectory());
            assumeTrue(JAR_FILE.isFile());

            // Adjust the library path to load the native library.
            System.setProperty(&quot;org.newsclub.net.unix.library.path&quot;,
                    LIB_DIR.getCanonicalPath</B></FONT>());

            // Setup a classloader to load the jar.
            ourJUnixSocketLibClassLoader = new URLClassLoader(
                    new URL[] { JAR_FILE.toURI().toURL() });

            // Create the Socket address to use.
            final Class&lt;?&gt; clazz = ourJUnixSocketLibClassLoader
                    .loadClass(&quot;org.newsclub.net.unix.AFUNIXSocketAddress&quot;);
            ourSocketAddress = (InetSocketAddress) clazz.getConstructor(
                    File.class)
                    .newInstance(new File(&quot;/tmp/mongodb-27017.sock&quot;));

        }
        catch (final Exception e) {
            // Reflection throws too many types and any exception should abort
            // anyway.
            e.printStackTrace();
            assumeNoException(e);
        }
        finally {
            IOUtils.close(out);
            IOUtils.close(in);
        }
    }

    /**
     * Stops the servers running in a standalone mode.
     */
    @AfterClass
    public static void stopServer() {
        ourSocketAddress = null;
        ourJUnixSocketLibClassLoader = null;
        System.clearProperty(&quot;org.newsclub.net.unix.library.path&quot;);

        ourClusterTestSupport.delete(new File(TAR_FILE.getParentFile(),
                LAST_JUNIXSOCKET_RELEASE));

        stopStandAlone();

        if (TAR_FILE.exists()) {
            TAR_FILE.delete();
        }

    }

    /**
     * Sets up to create a connection to MongoDB.
     */
    @Override
    protected MongoClientConfiguration initConfig() {
        super.initConfig();

        myConfig.addServer(ourSocketAddress);
        myConfig.setSocketFactory(new UnixDomainSocketFactory());

        return myConfig;
    }

    /**
     * UnixDomainSocketFactory provides a {@link SocketFactory} implementation
     * based on reflection into the junixsocket library.
     *
     * @copyright 2012-2013, Allanbank Consulting, Inc., All Rights Reserved
     */
    public static class UnixDomainSocketFactory
            extends SocketFactory {

        /**
         * Creates a org.newsclub.net.unix.AFUNIXSocket via reflection.
         */
        @Override
        public Socket createSocket() throws java.io.IOException {
            try {
                final Class&lt;?&gt; clazz = ourJUnixSocketLibClassLoader
                        .loadClass(&quot;org.newsclub.net.unix.AFUNIXSocket&quot;);

                return (Socket) clazz.getMethod(&quot;newInstance&quot;).invoke(null);
            }
            catch (final Exception error) {
                final SocketException socketError = new SocketException(
                        error.getMessage());
                socketError.initCause(error);
                throw socketError;
            }
        }

        /**
         * Always throws a {@link SocketException}.
         */
        @Override
        public Socket createSocket(final InetAddress host, final int port)
                throws SocketException {
            throw new SocketException(
                    &quot;AFUNIX socket does not support connections to a host/port&quot;);
        }

        /**
         * Always throws a {@link SocketException}.
         */
        @Override
        public Socket createSocket(final InetAddress address, final int port,
                final InetAddress localAddress, final int localPort)
                throws SocketException {
            throw new SocketException(
                    &quot;AFUNIX socket does not support connections to a host/port&quot;);
        }

        /**
         * Always throws a {@link SocketException}.
         */
        @Override
        public Socket createSocket(final String host, final int port)
                throws SocketException {
            throw new SocketException(
                    &quot;AFUNIX socket does not support connections to a host/port&quot;);
        }

        /**
         * Always throws a {@link SocketException}.
         */
        @Override
        public Socket createSocket(final String host, final int port,
                final InetAddress localHost, final int localPort)
                throws SocketException {
            throw new SocketException(
                    &quot;AFUNIX socket does not support connections to a host/port&quot;);
        }

    }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>DurabilityTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * #%L
 * DurabilityTest.java - mongodb-async-driver - Allanbank Consulting, Inc.
 * %%
 * Copyright (C) 2011 - 2014 Allanbank Consulting, Inc.
 * %%
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
<A NAME="0"></A> * #L%
 */

<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match34246-0.html#0',2,'match34246-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>package com.allanbank.mongodb;

import static org.hamcrest.CoreMatchers.instanceOf;
import static org.hamcrest.CoreMatchers.sameInstance;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNull;
import static org.junit.Assert.assertSame;
import static org.junit.Assert.assertThat;
import static org.junit.Assert.assertTrue;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.ArrayList;
import java.util.Arrays;
import</B></FONT> java.util.List;
import java.util.Random;

import org.junit.Test;

import com.allanbank.mongodb.bson.builder.BuilderFactory;
import com.allanbank.mongodb.bson.builder.DocumentBuilder;
import com.allanbank.mongodb.bson.impl.ImmutableDocument;

/**
 * DurabilityTest provides tests for the {@link Durability} class.
 *
 * @copyright 2012-2013, Allanbank Consulting, Inc., All Rights Reserved
 */
public class DurabilityTest {

    /**
     * Test method for {@link Durability#asDocument()}.
     */
    @Test
    public void testAsDocument() {
        final DocumentBuilder builder = BuilderFactory.start();
        builder.add(&quot;getlasterror&quot;, 1);
        // This is really bogus but reasonable
        assertEquals(builder.asDocument(), Durability.NONE.asDocument());

        builder.reset();
        builder.add(&quot;getlasterror&quot;, 1);
        builder.add(&quot;w&quot;, 1);
        assertEquals(builder.asDocument(), Durability.ACK.asDocument());

        builder.reset();
        builder.add(&quot;getlasterror&quot;, 1);
        builder.add(&quot;fsync&quot;, true);
        builder.add(&quot;wtimeout&quot;, 123);
        assertEquals(builder.asDocument(), Durability.fsyncDurable(123)
                .asDocument());

        builder.reset();
        builder.add(&quot;getlasterror&quot;, 1);
        builder.add(&quot;j&quot;, true);
        builder.add(&quot;wtimeout&quot;, 124);
        assertEquals(builder.asDocument(), Durability.journalDurable(124)
                .asDocument());

        builder.reset();
        builder.add(&quot;getlasterror&quot;, 1);
        builder.add(&quot;wtimeout&quot;, 125);
        builder.add(&quot;w&quot;, 2);
        assertEquals(builder.asDocument(), Durability.replicaDurable(125)
                .asDocument());

        builder.reset();
        builder.add(&quot;getlasterror&quot;, 1);
        builder.add(&quot;wtimeout&quot;, 126);
        builder.add(&quot;w&quot;, 3);
        assertEquals(builder.asDocument(), Durability.replicaDurable(3, 126)
                .asDocument());

        builder.reset();
        builder.add(&quot;getlasterror&quot;, 1);
        builder.add(&quot;wtimeout&quot;, 127);
        builder.add(&quot;w&quot;, &quot;foo&quot;);
        assertEquals(builder.asDocument(), Durability
                .replicaDurable(&quot;foo&quot;, 127).asDocument());

        builder.reset();
        builder.add(&quot;getlasterror&quot;, 1);
        builder.add(&quot;j&quot;, true);
        builder.add(&quot;wtimeout&quot;, 128);
        builder.add(&quot;w&quot;, &quot;bar&quot;);
        assertEquals(builder.asDocument(),
                Durability.replicaDurable(true, &quot;bar&quot;, 128).asDocument());

        builder.reset();
        builder.add(&quot;getlasterror&quot;, 1);
<A NAME="1"></A>        builder.add(&quot;j&quot;, true);
        builder.add(&quot;wtimeout&quot;, 129);
        builder.add(&quot;w&quot;, 4);
        assertEquals(<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match34246-0.html#1',2,'match34246-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>builder.asDocument(),
                Durability.replicaDurable(true, 4, 129).asDocument());

        // Second call should return the same document.
        final Durability durability = Durability.replicaDurable(true, 4, 129);
        assertThat(durability.asDocument(),
                sameInstance(durability.asDocument()));
        assertThat(durability.asDocument(), instanceOf</B></FONT>(ImmutableDocument.class));
    }

    /**
     * Test method for {@link Durability#equals(java.lang.Object)}.
     */
    @SuppressWarnings(&quot;boxing&quot;)
    @Test
    public void testEqualsObject() {

        final List&lt;Durability&gt; objs1 = new ArrayList&lt;Durability&gt;();
        final List&lt;Durability&gt; objs2 = new ArrayList&lt;Durability&gt;();

        objs1.add(Durability.NONE);
        objs2.add(Durability.NONE);

        objs1.add(Durability.ACK);
        objs2.add(Durability.ACK);

        for (final Boolean waitForFsync : Arrays.asList(Boolean.TRUE,
                Boolean.FALSE)) {
            for (final Boolean waitForJournal : Arrays.asList(Boolean.TRUE,
                    Boolean.FALSE)) {
                for (final Integer waitTimeoutMillis : Arrays.asList(1, 2, 3,
                        4, 10, 100, -1)) {
                    for (final Integer waitForReplicas : Arrays.asList(1, 2, 3,
                            4, 10, 100, -1)) {
                        objs1.add(new Durability(waitForFsync, waitForJournal,
                                waitForReplicas, waitTimeoutMillis));
                        objs2.add(new Durability(waitForFsync, waitForJournal,
                                waitForReplicas, waitTimeoutMillis));
                    }

                    for (final String mode : Arrays.asList(&quot;a&quot;, &quot;b&quot;)) {
                        objs1.add(new Durability(waitForFsync, waitForJournal,
                                mode, waitTimeoutMillis));
                        objs2.add(new Durability(waitForFsync, waitForJournal,
                                mode, waitTimeoutMillis));
                    }
                }
            }
        }

        // Sanity check.
        assertEquals(objs1.size(), objs2.size());

        for (int i = 0; i &lt; objs1.size(); ++i) {
            final Durability obj1 = objs1.get(i);
            Durability obj2 = objs2.get(i);

            assertTrue(obj1.equals(obj1));
            assertEquals(obj1, obj2);

            assertEquals(obj1.hashCode(), obj2.hashCode());

            for (int j = i + 1; j &lt; objs1.size(); ++j) {
                obj2 = objs2.get(j);

                assertFalse(obj1.equals(obj2));
                assertFalse(obj1.hashCode() == obj2.hashCode());
            }

            assertFalse(obj1.equals(&quot;foo&quot;));
            assertFalse(obj1.equals(null));
        }
    }

    /**
     * Test method for {@link Durability#fsyncDurable(int)}.
     */
    @Test
    public void testFsyncDurable() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);

        final Durability durability = Durability.fsyncDurable(wait);

        assertTrue(durability.isWaitForFsync());
        assertFalse(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(0, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
    }

    /**
     * Test method for {@link Durability#journalDurable(int)}.
     */
    @Test
    public void testJournalDurable() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);

        final Durability durability = Durability.journalDurable(wait);

        assertFalse(durability.isWaitForFsync());
        assertTrue(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(0, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
    }

    /**
     * Test method for {@link Durability#readResolve} .
     *
     * @throws IOException
     *             On a failure.
     * @throws ClassNotFoundException
     *             On a failure.
     */
    @Test
    public void testReadResolve() throws IOException, ClassNotFoundException {
        for (final Durability d : Arrays
                .asList(Durability.ACK, Durability.NONE)) {
            final ByteArrayOutputStream out = new ByteArrayOutputStream();
            final ObjectOutputStream oout = new ObjectOutputStream(out);
            oout.writeObject(d);
            oout.close();

            final ByteArrayInputStream in = new ByteArrayInputStream(
                    out.toByteArray());
            final ObjectInputStream oin = new ObjectInputStream(in);

            assertSame(d, oin.readObject());
        }

        final Durability d = Durability.journalDurable(100);
        final ByteArrayOutputStream out = new ByteArrayOutputStream();
        final ObjectOutputStream oout = new ObjectOutputStream(out);
        oout.writeObject(d);
        oout.close();

        final ByteArrayInputStream in = new ByteArrayInputStream(
                out.toByteArray());
        final ObjectInputStream oin = new ObjectInputStream(in);

        final Object read = oin.readObject();
        assertEquals(d, read);
        assertFalse(d == read);
    }

    /**
     * Test method for {@link Durability#replicaDurable(boolean, int, int)} .
     */
    @Test
    public void testReplicaDurableBooleanIntInt() {
        final Random random = new Random(System.currentTimeMillis());
        final boolean journal = random.nextBoolean();
        final int wait = random.nextInt(100000);
        final int replicaCount = random.nextInt(10000);

        final Durability durability = Durability.replicaDurable(journal,
                replicaCount, wait);

        assertFalse(durability.isWaitForFsync());
        assertEquals(Boolean.valueOf(journal),
                Boolean.valueOf(durability.isWaitForJournal()));
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(replicaCount, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
    }

    /**
     * Test method for {@link Durability#replicaDurable(boolean, String, int)} .
     */
    @Test
    public void testReplicaDurableBooleanStringInt() {
        final Random random = new Random(System.currentTimeMillis());
        final boolean journal = random.nextBoolean();
        final int wait = random.nextInt(100000);
        final String tag = String.valueOf(random.nextInt(10000));

        final Durability durability = Durability.replicaDurable(journal, tag,
                wait);

        assertFalse(durability.isWaitForFsync());
        assertEquals(Boolean.valueOf(journal),
                Boolean.valueOf(durability.isWaitForJournal()));
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(0, durability.getWaitForReplicas());
        assertEquals(tag, durability.getWaitForReplicasByMode());
    }

    /**
     * Test method for {@link Durability#replicaDurable(int)}.
     */
    @Test
    public void testReplicaDurableInt() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);

        final Durability durability = Durability.replicaDurable(wait);

        assertFalse(durability.isWaitForFsync());
        assertFalse(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(2, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
        assertNull(durability.getWaitForReplicasByMode());
    }

    /**
     * Test method for {@link Durability#replicaDurable(int, int)}.
     */
    @Test
    public void testReplicaDurableIntInt() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);
        final int replicaCount = random.nextInt(10000);

        final Durability durability = Durability.replicaDurable(replicaCount,
                wait);

        assertFalse(durability.isWaitForFsync());
        assertFalse(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(replicaCount, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
    }

    /**
     * Test method for {@link Durability#replicaDurable(String, int)}.
     */
    @Test
    public void testReplicaDurableStringInt() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);
        final String tag = String.valueOf(random.nextInt(10000));

        final Durability durability = Durability.replicaDurable(tag, wait);

        assertFalse(durability.isWaitForFsync());
        assertFalse(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(0, durability.getWaitForReplicas());
        assertEquals(tag, durability.getWaitForReplicasByMode());

        assertEquals(&quot;{ getlasterror : 1, wtimeout : &quot; + wait + &quot;, w : '&quot; + tag
                + &quot;' }&quot;, durability.toString());
    }

    /**
     * Test method for {@link Durability#valueOf(String)}.
     */
    @Test
    public void testValueOf() {

        assertSame(Durability.ACK, Durability.valueOf(&quot;AcK&quot;));
        assertSame(Durability.ACK, Durability.valueOf(&quot;sAfe&quot;));
        assertSame(Durability.NONE, Durability.valueOf(&quot;NoNe&quot;));

        assertEquals(Durability.replicaDurable(true, 4, 129),
                Durability.valueOf(&quot;{ j : true, wtimeout : 129, w : 4 }&quot;));
        assertEquals(
                Durability.replicaDurable(true, &quot;bar&quot;, 128),
                Durability
                        .valueOf(&quot;{ getlasterror : 1, j : true, wtimeout : 128, w : 'bar' }&quot;));
        assertEquals(
                Durability.replicaDurable(true, &quot;bar&quot;, 128),
                Durability
                        .valueOf(&quot;{ getlasterror : 1, j : 1, wtimeout : 128, w : bar }&quot;));
        assertEquals(
                Durability.replicaDurable(&quot;foo&quot;, 127),
                Durability
                        .valueOf(&quot;{ getlasterror : 1, wtimeout : 127, w : 'foo' }&quot;));
        assertEquals(Durability.replicaDurable(3, 126),
                Durability
                        .valueOf(&quot;{ getlasterror : 1, wtimeout : 126, w : 3 }&quot;));
        assertEquals(Durability.replicaDurable(125),
                Durability.valueOf(&quot;{ wtimeout : 125, w : 2 }&quot;));
        assertEquals(Durability.journalDurable(124),
                Durability.valueOf(&quot;{ wtimeout : 124, j : 1 }&quot;));
        assertEquals(Durability.fsyncDurable(123),
                Durability.valueOf(&quot;{ wtimeout : 123, fsync : 1 }&quot;));

        assertNull(Durability.valueOf(&quot;{ wtimeout : 'a', fsync : 1 }&quot;));
        assertNull(Durability.valueOf(&quot;{ foo : 1 }&quot;));
        assertNull(Durability.valueOf(&quot;foo&quot;));
    }
}
</PRE>
</div>
  </div>
</body>
</html>
