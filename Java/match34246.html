<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for UnixDomainSocketAcceptanceTest.java &amp; DurabilityTest.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for UnixDomainSocketAcceptanceTest.java &amp; DurabilityTest.java
      </h3>
<h1 align="center">
        8.6%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>UnixDomainSocketAcceptanceTest.java (14.215686%)<th>DurabilityTest.java (6.1965814%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(21-42)<td><a href="#" name="0">(21-39)</a><td align="center"><font color="#ff0000">17</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(119-128)<td><a href="#" name="1">(118-125)</a><td align="center"><font color="#b40000">12</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>UnixDomainSocketAcceptanceTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>package com.allanbank.mongodb.acceptance;
import static org.junit.Assume.assumeNoException;
import static org.junit.Assume.assumeTrue;
import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.net.InetAddress;
import java.net.InetSocketAddress;
import java.net.Socket;
import java.net.SocketException;
import java.net.URL;
import java.net.URLClassLoader;
import javax.net.SocketFactory;
import org.junit.AfterClass;
import org.junit.BeforeClass;
import com.allanbank.mongodb.MongoClientConfiguration;
import</b></font> com.allanbank.mongodb.util.IOUtils;
public class UnixDomainSocketAcceptanceTest
        extends BasicAcceptanceTestCases {
    public static final File JAR_FILE;
    public static final String LAST_JUNIXSOCKET_RELEASE;
    public static final String LAST_JUNIXSOCKET_RELEASE_FILE;
    public static final File LIB_DIR;
    public static final File TAR_FILE;
    protected static URLClassLoader ourJUnixSocketLibClassLoader = null;
    protected static InetSocketAddress ourSocketAddress = null;
    static {
        LAST_JUNIXSOCKET_RELEASE = "junixsocket-1.3";
        LAST_JUNIXSOCKET_RELEASE_FILE = LAST_JUNIXSOCKET_RELEASE
                + "-bin.tar.bz2";
        TAR_FILE = new File("target/" + LAST_JUNIXSOCKET_RELEASE_FILE);
        LIB_DIR = new File("target/" + LAST_JUNIXSOCKET_RELEASE
                + "/lib-native/");
        JAR_FILE = new File("target/" + LAST_JUNIXSOCKET_RELEASE + "/dist/"
                + LAST_JUNIXSOCKET_RELEASE + ".jar");
    }
    @BeforeClass
    public static void startServer() {
        startStandAlone();
        buildLargeCollection();
        FileOutputStream out = null;
        InputStream in = null;
        try {
            if (TAR_FILE.exists()) {
                TAR_FILE.delete();
            }
            final URL url = new URL("http://junixsocket.googlecode.com/files/"
                    + LAST_JUNIXSOCKET_RELEASE_FILE);
            out = new FileOutputStream(TAR_FILE);
            in = url.openStream();
            final byte[] buffer = new byte[4096];
            int read = 0;
            while (0 &lt;= read) {
                out.write(buffer, 0, read);
                read = in.read(buffer);
            }
            out.flush();
            out.close();
<a name="1"></a>
            final ProcessBuilder builder = new ProcessBuilder("tar", "xfj",
                    <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>TAR_FILE.getCanonicalPath());
            builder.directory(TAR_FILE.getParentFile());
            final Process untar = builder.start();
            untar.waitFor();
            assumeTrue(LIB_DIR.isDirectory());
            assumeTrue(JAR_FILE.isFile());
            System.setProperty("org.newsclub.net.unix.library.path",
                    LIB_DIR.getCanonicalPath</b></font>());
            ourJUnixSocketLibClassLoader = new URLClassLoader(
                    new URL[] { JAR_FILE.toURI().toURL() });
            final Class&lt;?&gt; clazz = ourJUnixSocketLibClassLoader
                    .loadClass("org.newsclub.net.unix.AFUNIXSocketAddress");
            ourSocketAddress = (InetSocketAddress) clazz.getConstructor(
                    File.class)
                    .newInstance(new File("/tmp/mongodb-27017.sock"));
        }
        catch (final Exception e) {
            e.printStackTrace();
            assumeNoException(e);
        }
        finally {
            IOUtils.close(out);
            IOUtils.close(in);
        }
    }
    @AfterClass
    public static void stopServer() {
        ourSocketAddress = null;
        ourJUnixSocketLibClassLoader = null;
        System.clearProperty("org.newsclub.net.unix.library.path");
        ourClusterTestSupport.delete(new File(TAR_FILE.getParentFile(),
                LAST_JUNIXSOCKET_RELEASE));
        stopStandAlone();
        if (TAR_FILE.exists()) {
            TAR_FILE.delete();
        }
    }
    @Override
    protected MongoClientConfiguration initConfig() {
        super.initConfig();
        myConfig.addServer(ourSocketAddress);
        myConfig.setSocketFactory(new UnixDomainSocketFactory());
        return myConfig;
    }
    public static class UnixDomainSocketFactory
            extends SocketFactory {
        @Override
        public Socket createSocket() throws java.io.IOException {
            try {
                final Class&lt;?&gt; clazz = ourJUnixSocketLibClassLoader
                        .loadClass("org.newsclub.net.unix.AFUNIXSocket");
                return (Socket) clazz.getMethod("newInstance").invoke(null);
            }
            catch (final Exception error) {
                final SocketException socketError = new SocketException(
                        error.getMessage());
                socketError.initCause(error);
                throw socketError;
            }
        }
        @Override
        public Socket createSocket(final InetAddress host, final int port)
                throws SocketException {
            throw new SocketException(
                    "AFUNIX socket does not support connections to a host/port");
        }
        @Override
        public Socket createSocket(final InetAddress address, final int port,
                final InetAddress localAddress, final int localPort)
                throws SocketException {
            throw new SocketException(
                    "AFUNIX socket does not support connections to a host/port");
        }
        @Override
        public Socket createSocket(final String host, final int port)
                throws SocketException {
            throw new SocketException(
                    "AFUNIX socket does not support connections to a host/port");
        }
        @Override
        public Socket createSocket(final String host, final int port,
                final InetAddress localHost, final int localPort)
                throws SocketException {
            throw new SocketException(
                    "AFUNIX socket does not support connections to a host/port");
        }
    }
}
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>DurabilityTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
<font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>package com.allanbank.mongodb;
import static org.hamcrest.CoreMatchers.instanceOf;
import static org.hamcrest.CoreMatchers.sameInstance;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertFalse;
import static org.junit.Assert.assertNull;
import static org.junit.Assert.assertSame;
import static org.junit.Assert.assertThat;
import static org.junit.Assert.assertTrue;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.util.ArrayList;
import java.util.Arrays;
import</b></font> java.util.List;
import java.util.Random;
import org.junit.Test;
import com.allanbank.mongodb.bson.builder.BuilderFactory;
import com.allanbank.mongodb.bson.builder.DocumentBuilder;
import com.allanbank.mongodb.bson.impl.ImmutableDocument;
public class DurabilityTest {
    @Test
    public void testAsDocument() {
        final DocumentBuilder builder = BuilderFactory.start();
        builder.add("getlasterror", 1);
        assertEquals(builder.asDocument(), Durability.NONE.asDocument());
        builder.reset();
        builder.add("getlasterror", 1);
        builder.add("w", 1);
        assertEquals(builder.asDocument(), Durability.ACK.asDocument());
        builder.reset();
        builder.add("getlasterror", 1);
        builder.add("fsync", true);
        builder.add("wtimeout", 123);
        assertEquals(builder.asDocument(), Durability.fsyncDurable(123)
                .asDocument());
        builder.reset();
        builder.add("getlasterror", 1);
        builder.add("j", true);
        builder.add("wtimeout", 124);
        assertEquals(builder.asDocument(), Durability.journalDurable(124)
                .asDocument());
        builder.reset();
        builder.add("getlasterror", 1);
        builder.add("wtimeout", 125);
        builder.add("w", 2);
        assertEquals(builder.asDocument(), Durability.replicaDurable(125)
                .asDocument());
        builder.reset();
        builder.add("getlasterror", 1);
        builder.add("wtimeout", 126);
        builder.add("w", 3);
        assertEquals(builder.asDocument(), Durability.replicaDurable(3, 126)
                .asDocument());
        builder.reset();
        builder.add("getlasterror", 1);
        builder.add("wtimeout", 127);
        builder.add("w", "foo");
        assertEquals(builder.asDocument(), Durability
                .replicaDurable("foo", 127).asDocument());
        builder.reset();
        builder.add("getlasterror", 1);
        builder.add("j", true);
        builder.add("wtimeout", 128);
        builder.add("w", "bar");
        assertEquals(builder.asDocument(),
                Durability.replicaDurable(true, "bar", 128).asDocument());
        builder.reset();
        builder.add("getlasterror", 1);
<a name="1"></a>        builder.add("j", true);
        builder.add("wtimeout", 129);
        builder.add("w", 4);
        assertEquals(<font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>builder.asDocument(),
                Durability.replicaDurable(true, 4, 129).asDocument());
        final Durability durability = Durability.replicaDurable(true, 4, 129);
        assertThat(durability.asDocument(),
                sameInstance(durability.asDocument()));
        assertThat(durability.asDocument(), instanceOf</b></font>(ImmutableDocument.class));
    }
    @SuppressWarnings("boxing")
    @Test
    public void testEqualsObject() {
        final List&lt;Durability&gt; objs1 = new ArrayList&lt;Durability&gt;();
        final List&lt;Durability&gt; objs2 = new ArrayList&lt;Durability&gt;();
        objs1.add(Durability.NONE);
        objs2.add(Durability.NONE);
        objs1.add(Durability.ACK);
        objs2.add(Durability.ACK);
        for (final Boolean waitForFsync : Arrays.asList(Boolean.TRUE,
                Boolean.FALSE)) {
            for (final Boolean waitForJournal : Arrays.asList(Boolean.TRUE,
                    Boolean.FALSE)) {
                for (final Integer waitTimeoutMillis : Arrays.asList(1, 2, 3,
                        4, 10, 100, -1)) {
                    for (final Integer waitForReplicas : Arrays.asList(1, 2, 3,
                            4, 10, 100, -1)) {
                        objs1.add(new Durability(waitForFsync, waitForJournal,
                                waitForReplicas, waitTimeoutMillis));
                        objs2.add(new Durability(waitForFsync, waitForJournal,
                                waitForReplicas, waitTimeoutMillis));
                    }
                    for (final String mode : Arrays.asList("a", "b")) {
                        objs1.add(new Durability(waitForFsync, waitForJournal,
                                mode, waitTimeoutMillis));
                        objs2.add(new Durability(waitForFsync, waitForJournal,
                                mode, waitTimeoutMillis));
                    }
                }
            }
        }
        assertEquals(objs1.size(), objs2.size());
        for (int i = 0; i &lt; objs1.size(); ++i) {
            final Durability obj1 = objs1.get(i);
            Durability obj2 = objs2.get(i);
            assertTrue(obj1.equals(obj1));
            assertEquals(obj1, obj2);
            assertEquals(obj1.hashCode(), obj2.hashCode());
            for (int j = i + 1; j &lt; objs1.size(); ++j) {
                obj2 = objs2.get(j);
                assertFalse(obj1.equals(obj2));
                assertFalse(obj1.hashCode() == obj2.hashCode());
            }
            assertFalse(obj1.equals("foo"));
            assertFalse(obj1.equals(null));
        }
    }
    @Test
    public void testFsyncDurable() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);
        final Durability durability = Durability.fsyncDurable(wait);
        assertTrue(durability.isWaitForFsync());
        assertFalse(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(0, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
    }
    @Test
    public void testJournalDurable() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);
        final Durability durability = Durability.journalDurable(wait);
        assertFalse(durability.isWaitForFsync());
        assertTrue(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(0, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
    }
    @Test
    public void testReadResolve() throws IOException, ClassNotFoundException {
        for (final Durability d : Arrays
                .asList(Durability.ACK, Durability.NONE)) {
            final ByteArrayOutputStream out = new ByteArrayOutputStream();
            final ObjectOutputStream oout = new ObjectOutputStream(out);
            oout.writeObject(d);
            oout.close();
            final ByteArrayInputStream in = new ByteArrayInputStream(
                    out.toByteArray());
            final ObjectInputStream oin = new ObjectInputStream(in);
            assertSame(d, oin.readObject());
        }
        final Durability d = Durability.journalDurable(100);
        final ByteArrayOutputStream out = new ByteArrayOutputStream();
        final ObjectOutputStream oout = new ObjectOutputStream(out);
        oout.writeObject(d);
        oout.close();
        final ByteArrayInputStream in = new ByteArrayInputStream(
                out.toByteArray());
        final ObjectInputStream oin = new ObjectInputStream(in);
        final Object read = oin.readObject();
        assertEquals(d, read);
        assertFalse(d == read);
    }
    @Test
    public void testReplicaDurableBooleanIntInt() {
        final Random random = new Random(System.currentTimeMillis());
        final boolean journal = random.nextBoolean();
        final int wait = random.nextInt(100000);
        final int replicaCount = random.nextInt(10000);
        final Durability durability = Durability.replicaDurable(journal,
                replicaCount, wait);
        assertFalse(durability.isWaitForFsync());
        assertEquals(Boolean.valueOf(journal),
                Boolean.valueOf(durability.isWaitForJournal()));
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(replicaCount, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
    }
    @Test
    public void testReplicaDurableBooleanStringInt() {
        final Random random = new Random(System.currentTimeMillis());
        final boolean journal = random.nextBoolean();
        final int wait = random.nextInt(100000);
        final String tag = String.valueOf(random.nextInt(10000));
        final Durability durability = Durability.replicaDurable(journal, tag,
                wait);
        assertFalse(durability.isWaitForFsync());
        assertEquals(Boolean.valueOf(journal),
                Boolean.valueOf(durability.isWaitForJournal()));
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(0, durability.getWaitForReplicas());
        assertEquals(tag, durability.getWaitForReplicasByMode());
    }
    @Test
    public void testReplicaDurableInt() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);
        final Durability durability = Durability.replicaDurable(wait);
        assertFalse(durability.isWaitForFsync());
        assertFalse(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(2, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
        assertNull(durability.getWaitForReplicasByMode());
    }
    @Test
    public void testReplicaDurableIntInt() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);
        final int replicaCount = random.nextInt(10000);
        final Durability durability = Durability.replicaDurable(replicaCount,
                wait);
        assertFalse(durability.isWaitForFsync());
        assertFalse(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(replicaCount, durability.getWaitForReplicas());
        assertNull(durability.getWaitForReplicasByMode());
    }
    @Test
    public void testReplicaDurableStringInt() {
        final Random random = new Random(System.currentTimeMillis());
        final int wait = random.nextInt(100000);
        final String tag = String.valueOf(random.nextInt(10000));
        final Durability durability = Durability.replicaDurable(tag, wait);
        assertFalse(durability.isWaitForFsync());
        assertFalse(durability.isWaitForJournal());
        assertTrue(durability.isWaitForReply());
        assertEquals(wait, durability.getWaitTimeoutMillis());
        assertEquals(0, durability.getWaitForReplicas());
        assertEquals(tag, durability.getWaitForReplicasByMode());
        assertEquals("{ getlasterror : 1, wtimeout : " + wait + ", w : '" + tag
                + "' }", durability.toString());
    }
    @Test
    public void testValueOf() {
        assertSame(Durability.ACK, Durability.valueOf("AcK"));
        assertSame(Durability.ACK, Durability.valueOf("sAfe"));
        assertSame(Durability.NONE, Durability.valueOf("NoNe"));
        assertEquals(Durability.replicaDurable(true, 4, 129),
                Durability.valueOf("{ j : true, wtimeout : 129, w : 4 }"));
        assertEquals(
                Durability.replicaDurable(true, "bar", 128),
                Durability
                        .valueOf("{ getlasterror : 1, j : true, wtimeout : 128, w : 'bar' }"));
        assertEquals(
                Durability.replicaDurable(true, "bar", 128),
                Durability
                        .valueOf("{ getlasterror : 1, j : 1, wtimeout : 128, w : bar }"));
        assertEquals(
                Durability.replicaDurable("foo", 127),
                Durability
                        .valueOf("{ getlasterror : 1, wtimeout : 127, w : 'foo' }"));
        assertEquals(Durability.replicaDurable(3, 126),
                Durability
                        .valueOf("{ getlasterror : 1, wtimeout : 126, w : 3 }"));
        assertEquals(Durability.replicaDurable(125),
                Durability.valueOf("{ wtimeout : 125, w : 2 }"));
        assertEquals(Durability.journalDurable(124),
                Durability.valueOf("{ wtimeout : 124, j : 1 }"));
        assertEquals(Durability.fsyncDurable(123),
                Durability.valueOf("{ wtimeout : 123, fsync : 1 }"));
        assertNull(Durability.valueOf("{ wtimeout : 'a', fsync : 1 }"));
        assertNull(Durability.valueOf("{ foo : 1 }"));
        assertNull(Durability.valueOf("foo"));
    }
}
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
