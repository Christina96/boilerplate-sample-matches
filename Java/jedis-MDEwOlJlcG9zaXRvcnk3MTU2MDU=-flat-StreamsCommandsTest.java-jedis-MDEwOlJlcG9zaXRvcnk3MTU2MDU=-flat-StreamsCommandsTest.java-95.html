
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 62, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-StreamsCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static java.util.Collections.singletonMap;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertFalse;
5  import static org.junit.Assert.assertNotNull;
6  import static org.junit.Assert.assertNull;
7  import static org.junit.Assert.assertTrue;
8  import static org.junit.Assert.fail;
9  import java.time.Duration;
10  import java.util.HashMap;
11  import java.util.LinkedHashMap;
12  import java.util.List;
13  import java.util.Map;
14  import java.util.Map.Entry;
15  import java.util.concurrent.atomic.AtomicReference;
16  import org.hamcrest.MatcherAssert;
17  import org.hamcrest.Matchers;
18  import org.junit.Test;
19  import redis.clients.jedis.BuilderFactory;
20  import redis.clients.jedis.Jedis;
21  import redis.clients.jedis.Pipeline;
22  import redis.clients.jedis.Response;
23  import redis.clients.jedis.StreamEntryID;
24  import redis.clients.jedis.Transaction;
25  import redis.clients.jedis.exceptions.JedisDataException;
26  import redis.clients.jedis.exceptions.JedisException;
27  import redis.clients.jedis.params.*;
28  import redis.clients.jedis.resps.*;
29  import redis.clients.jedis.util.SafeEncoder;
30  public class StreamsCommandsTest extends JedisCommandsTestBase {
31    @Test
32    public void xadd() {
33      try {
34        Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
35        jedis.xadd(&quot;stream1&quot;, (StreamEntryID) null, map1);
36        fail();
37      } catch (JedisDataException expected) {
38        assertTrue(expected.getMessage().contains(&quot;wrong number of arguments&quot;));
39      }
40      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
41      map1.put(&quot;f1&quot;, &quot;v1&quot;);
42      StreamEntryID id1 = jedis.xadd(&quot;xadd-stream1&quot;, (StreamEntryID) null, map1);
43      assertNotNull(id1);
44      Map&lt;String, String&gt; map2 = new HashMap&lt;&gt;();
45      map2.put(&quot;f1&quot;, &quot;v1&quot;);
46      map2.put(&quot;f2&quot;, &quot;v2&quot;);
47      StreamEntryID id2 = jedis.xadd(&quot;xadd-stream1&quot;, (StreamEntryID) null, map2);
48      assertTrue(id2.compareTo(id1) &gt; 0);
49      Map&lt;String, String&gt; map3 = new HashMap&lt;&gt;();
50      map3.put(&quot;f2&quot;, &quot;v2&quot;);
51      map3.put(&quot;f3&quot;, &quot;v3&quot;);
52      StreamEntryID id3 = jedis.xadd(&quot;xadd-stream2&quot;, (StreamEntryID) null, map3);
53      Map&lt;String, String&gt; map4 = new HashMap&lt;&gt;();
54      map4.put(&quot;f2&quot;, &quot;v2&quot;);
55      map4.put(&quot;f3&quot;, &quot;v3&quot;);
56      StreamEntryID idIn = new StreamEntryID(id3.getTime() + 1, 1L);
57      StreamEntryID id4 = jedis.xadd(&quot;xadd-stream2&quot;, idIn, map4);
58      assertEquals(idIn, id4);
59      assertTrue(id4.compareTo(id3) &gt; 0);
60      Map&lt;String, String&gt; map5 = new HashMap&lt;&gt;();
61      map5.put(&quot;f4&quot;, &quot;v4&quot;);
62      map5.put(&quot;f5&quot;, &quot;v5&quot;);
63      StreamEntryID id5 = jedis.xadd(&quot;xadd-stream2&quot;, (StreamEntryID) null, map5);
64      assertTrue(id5.compareTo(id4) &gt; 0);
65      Map&lt;String, String&gt; map6 = new HashMap&lt;&gt;();
66      map6.put(&quot;f4&quot;, &quot;v4&quot;);
67      map6.put(&quot;f5&quot;, &quot;v5&quot;);
68      StreamEntryID id6 = jedis.xadd(&quot;xadd-stream2&quot;, map6, XAddParams.xAddParams().maxLen(3));
69      assertTrue(id6.compareTo(id5) &gt; 0);
70      assertEquals(3L, jedis.xlen(&quot;xadd-stream2&quot;));
71    }
72    @Test
73    public void xaddWithParams() {
74      try {
75        jedis.xadd(&quot;stream1&quot;, new HashMap&lt;&gt;(), XAddParams.xAddParams());
76        fail();
77      } catch (JedisDataException expected) {
78        assertTrue(expected.getMessage().contains(&quot;wrong number of arguments&quot;));
79      }
80      try {
81        jedis.xadd(&quot;stream1&quot;, XAddParams.xAddParams(), new HashMap&lt;&gt;());
82        fail();
83      } catch (JedisDataException expected) {
84        assertTrue(expected.getMessage().contains(&quot;wrong number of arguments&quot;));
85      }
86      StreamEntryID id1 = jedis.xadd(&quot;xadd-stream1&quot;, (StreamEntryID) null, singletonMap(&quot;f1&quot;, &quot;v1&quot;));
87      assertNotNull(id1);
88      Map&lt;String, String&gt; map2 = new HashMap&lt;&gt;();
89      map2.put(&quot;f1&quot;, &quot;v1&quot;);
90      map2.put(&quot;f2&quot;, &quot;v2&quot;);
91      StreamEntryID id2 = jedis.xadd(&quot;xadd-stream1&quot;, map2, XAddParams.xAddParams());
92      assertTrue(id2.compareTo(id1) &gt; 0);
93      Map&lt;String, String&gt; map3 = new HashMap&lt;&gt;();
94      map3.put(&quot;f2&quot;, &quot;v2&quot;);
95      map3.put(&quot;f3&quot;, &quot;v3&quot;);
96      StreamEntryID id3 = jedis.xadd(&quot;xadd-stream2&quot;, XAddParams.xAddParams(), map3);
97      Map&lt;String, String&gt; map4 = new HashMap&lt;&gt;();
98      map4.put(&quot;f2&quot;, &quot;v2&quot;);
99      map4.put(&quot;f3&quot;, &quot;v3&quot;);
100      StreamEntryID idIn = new StreamEntryID(id3.getTime() + 1, 1L);
101      StreamEntryID id4 = jedis.xadd(&quot;xadd-stream2&quot;, map4, XAddParams.xAddParams().id(idIn));
102      assertEquals(idIn, id4);
103      assertTrue(id4.compareTo(id3) &gt; 0);
104      Map&lt;String, String&gt; map5 = new HashMap&lt;&gt;();
105      map5.put(&quot;f4&quot;, &quot;v4&quot;);
106      map5.put(&quot;f5&quot;, &quot;v5&quot;);
107      StreamEntryID id5 = jedis.xadd(&quot;xadd-stream2&quot;, XAddParams.xAddParams(), map5);
108      assertTrue(id5.compareTo(id4) &gt; 0);
109      Map&lt;String, String&gt; map6 = new HashMap&lt;&gt;();
110      map6.put(&quot;f4&quot;, &quot;v4&quot;);
111      map6.put(&quot;f5&quot;, &quot;v5&quot;);
112      StreamEntryID id6 = jedis.xadd(&quot;xadd-stream2&quot;, map6, XAddParams.xAddParams().maxLen(3).exactTrimming());
113      assertTrue(id6.compareTo(id5) &gt; 0);
114      assertEquals(3L, jedis.xlen(&quot;xadd-stream2&quot;));
115      StreamEntryID id7 = jedis.xadd(&quot;xadd-stream3&quot;, XAddParams.xAddParams().noMkStream().maxLen(3).exactTrimming(), map6);
116      assertNull(id7);
117      assertFalse(jedis.exists(&quot;xadd-stream3&quot;));
118      jedis.xadd(&quot;xadd-stream3&quot;, map6, XAddParams.xAddParams().minId(&quot;2&quot;).id(new StreamEntryID(2)));
119      assertEquals(1L, jedis.xlen(&quot;xadd-stream3&quot;));
120      jedis.xadd(&quot;xadd-stream3&quot;, XAddParams.xAddParams().minId(&quot;4&quot;).id(new StreamEntryID(3)), map6);
121      assertEquals(0L, jedis.xlen(&quot;xadd-stream3&quot;));
122    }
123    @Test
124    public void xaddParamsId() {
125      StreamEntryID id;
126      String key = &quot;kk&quot;;
127      Map&lt;String, String&gt; map = singletonMap(&quot;ff&quot;, &quot;vv&quot;);
128      id = jedis.xadd(key, XAddParams.xAddParams().id(new StreamEntryID(0, 1)), map);
129      assertNotNull(id);
130      assertEquals(&quot;0-1&quot;, id.toString());
131      assertEquals(0, id.getTime());
132      assertEquals(1, id.getSequence());
133      id = jedis.xadd(key, XAddParams.xAddParams().id(2, 3), map);
134      assertNotNull(id);
135      assertEquals(2, id.getTime());
136      assertEquals(3, id.getSequence());
137      id = jedis.xadd(key, XAddParams.xAddParams().id(4), map);
138      assertNotNull(id);
139      assertEquals(4, id.getTime());
140      assertEquals(0, id.getSequence());
141      id = jedis.xadd(key, XAddParams.xAddParams().id(&quot;5-6&quot;), map);
142      assertNotNull(id);
143      assertEquals(5, id.getTime());
144      assertEquals(6, id.getSequence());
145      id = jedis.xadd(key, XAddParams.xAddParams().id(&quot;7-8&quot;.getBytes()), map);
146      assertNotNull(id);
147      assertEquals(7, id.getTime());
148      assertEquals(8, id.getSequence());
149      id = jedis.xadd(key, XAddParams.xAddParams(), map);
150      assertNotNull(id);
151    }
152    @Test
153    public void xdel() {
154      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
155      map1.put(&quot;f1&quot;, &quot;v1&quot;);
156      StreamEntryID id1 = jedis.xadd(&quot;xdel-stream&quot;, (StreamEntryID) null, map1);
157      assertNotNull(id1);
158      StreamEntryID id2 = jedis.xadd(&quot;xdel-stream&quot;, (StreamEntryID) null, map1);
159      assertNotNull(id2);
160      assertEquals(2L, jedis.xlen(&quot;xdel-stream&quot;));
161      assertEquals(1L, jedis.xdel(&quot;xdel-stream&quot;, id1));
162      assertEquals(1L, jedis.xlen(&quot;xdel-stream&quot;));
163    }
164    @Test
165    public void xlen() {
166      assertEquals(0L, jedis.xlen(&quot;xlen-stream&quot;));
167      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
168      map.put(&quot;f1&quot;, &quot;v1&quot;);
169      jedis.xadd(&quot;xlen-stream&quot;, (StreamEntryID) null, map);
170      assertEquals(1L, jedis.xlen(&quot;xlen-stream&quot;));
171      jedis.xadd(&quot;xlen-stream&quot;, (StreamEntryID) null, map);
172      assertEquals(2L, jedis.xlen(&quot;xlen-stream&quot;));
173    }
174    @Test
175    public void xrange() {
176      List&lt;StreamEntry&gt; range = jedis.xrange(&quot;xrange-stream&quot;, (StreamEntryID) null,
177        (StreamEntryID) null, Integer.MAX_VALUE);
178      assertEquals(0, range.size());
179      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
180      map.put(&quot;f1&quot;, &quot;v1&quot;);
181      StreamEntryID id1 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
182      StreamEntryID id2 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
183      List&lt;StreamEntry&gt; range2 = jedis.xrange(&quot;xrange-stream&quot;, (StreamEntryID) null,
184        (StreamEntryID) null, 3);
185      assertEquals(2, range2.size());
186      assertEquals(range2.get(0).toString(), id1 + &quot; &quot; + map);
187      List&lt;StreamEntry&gt; range3 = jedis.xrange(&quot;xrange-stream&quot;, id1, null, 2);
188      assertEquals(2, range3.size());
189      List&lt;StreamEntry&gt; range4 = jedis.xrange(&quot;xrange-stream&quot;, id1, id2, 2);
190      assertEquals(2, range4.size());
191      List&lt;StreamEntry&gt; range5 = jedis.xrange(&quot;xrange-stream&quot;, id1, id2, 1);
192      assertEquals(1, range5.size());
193      List&lt;StreamEntry&gt; range6 = jedis.xrange(&quot;xrange-stream&quot;, id2, null, 4);
194      assertEquals(1, range6.size());
195      StreamEntryID id3 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
196      List&lt;StreamEntry&gt; range7 = jedis.xrange(&quot;xrange-stream&quot;, id3, id3, 4);
197      assertEquals(1, range7.size());
198      List&lt;StreamEntry&gt; range8 = jedis.xrange(&quot;xrange-stream&quot;, (StreamEntryID) null, (StreamEntryID) null);
199      assertEquals(3, range8.size());
200      range8 = jedis.xrange(&quot;xrange-stream&quot;, StreamEntryID.MINIMUM_ID, StreamEntryID.MAXIMUM_ID);
201      assertEquals(3, range8.size());
202    }
203    @Test
204    public void xrangeExclusive() {
205      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
206      map.put(&quot;f1&quot;, &quot;v1&quot;);
207      String id1 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map).toString();
208      jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
209      List&lt;StreamEntry&gt; range2 = jedis.xrange(&quot;xrange-stream&quot;, id1, &quot;+&quot;, 2);
210      assertEquals(2, range2.size());
211      List&lt;StreamEntry&gt; range3 = jedis.xrange(&quot;xrange-stream&quot;, &quot;(&quot; + id1, &quot;+&quot;, 2);
212      assertEquals(1, range3.size());
213    }
214    @Test
215    public void xreadWithParams() {
216      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(&quot;xread-stream1&quot;, new StreamEntryID());
217      assertNull(jedis.xread(XReadParams.xReadParams().block(1), streamQeury1));
218      assertNull(jedis.xread(XReadParams.xReadParams(), streamQeury1));
219      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
220      map.put(&quot;f1&quot;, &quot;v1&quot;);
221      StreamEntryID id1 = jedis.xadd(&quot;xread-stream1&quot;, (StreamEntryID) null, map);
222      StreamEntryID id2 = jedis.xadd(&quot;xread-stream2&quot;, (StreamEntryID) null, map);
223      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams1 = jedis.xread(XReadParams.xReadParams().count(1).block(1), streamQeury1);
224      assertEquals(1, streams1.size());
225      assertEquals(&quot;xread-stream1&quot;, streams1.get(0).getKey());
226      assertEquals(1, streams1.get(0).getValue().size());
227      assertEquals(id1, streams1.get(0).getValue().get(0).getID());
228      assertEquals(map, streams1.get(0).getValue().get(0).getFields());
229      assertNull(jedis.xread(XReadParams.xReadParams().block(1), singletonMap(&quot;xread-stream1&quot;, id1)));
230      assertNull(jedis.xread(XReadParams.xReadParams(), singletonMap(&quot;xread-stream1&quot;, id1)));
231      Map&lt;String, StreamEntryID&gt; streamQuery23 = new LinkedHashMap&lt;&gt;();
232      streamQuery23.put(&quot;xread-stream1&quot;, new StreamEntryID());
233      streamQuery23.put(&quot;xread-stream2&quot;, new StreamEntryID());
234      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams2 = jedis.xread(XReadParams.xReadParams().count(2).block(1), streamQuery23);
235      assertEquals(2, streams2.size());
236    }
237    @Test
238    public void xreadBlockZero() throws InterruptedException {
239      final AtomicReference&lt;StreamEntryID&gt; readId = new AtomicReference&lt;&gt;();
240      Thread t = new Thread(new Runnable() {
241        @Override
242        public void run() {
243          try (Jedis blockJedis = createJedis()) {
244            long startTime = System.currentTimeMillis();
245            List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; read = blockJedis.xread(XReadParams.xReadParams().block(0),
246                singletonMap(&quot;block0-stream&quot;, new StreamEntryID()));
247            long endTime = System.currentTimeMillis();
248            assertTrue(endTime - startTime &gt; 500);
249            assertNotNull(read);
250            readId.set(read.get(0).getValue().get(0).getID());
251          }
252        }
253      }, &quot;xread-block-0-thread&quot;);
254      t.start();
255      Thread.sleep(1000);
256      StreamEntryID addedId = jedis.xadd(&quot;block0-stream&quot;, (StreamEntryID) null, singletonMap(&quot;foo&quot;, &quot;bar&quot;));
257      t.join();
258      assertEquals(addedId, readId.get());
259    }
260    @Test
261    public void xtrim() {
262      Map&lt;String, String&gt; map1 = new HashMap&lt;String, String&gt;();
263      map1.put(&quot;f1&quot;, &quot;v1&quot;);
264      for (int i = 1; i &lt;= 5; i++) {
265        jedis.xadd(&quot;xtrim-stream&quot;, (StreamEntryID) null, map1);
266      }
267      assertEquals(5L, jedis.xlen(&quot;xtrim-stream&quot;));
268      jedis.xtrim(&quot;xtrim-stream&quot;, 3, false);
269      assertEquals(3L, jedis.xlen(&quot;xtrim-stream&quot;));
270    }
271    @Test
272    public void xtrimWithParams() {
273      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
274      map1.put(&quot;f1&quot;, &quot;v1&quot;);
275      for (int i = 1; i &lt;= 5; i++) {
276        jedis.xadd(&quot;xtrim-stream&quot;, new StreamEntryID(&quot;0-&quot; + i), map1);
277      }
278      assertEquals(5L, jedis.xlen(&quot;xtrim-stream&quot;));
279      jedis.xtrim(&quot;xtrim-stream&quot;, XTrimParams.xTrimParams().maxLen(3).exactTrimming());
280      assertEquals(3L, jedis.xlen(&quot;xtrim-stream&quot;));
281      jedis.xtrim(&quot;xtrim-stream&quot;, XTrimParams.xTrimParams().minId(&quot;0-4&quot;).exactTrimming());
282      assertEquals(2L, jedis.xlen(&quot;xtrim-stream&quot;));
283    }
284    @Test
285    public void xrevrange() {
286      List&lt;StreamEntry&gt; range = jedis.xrevrange(&quot;xrevrange-stream&quot;, (StreamEntryID) null,
287        (StreamEntryID) null, Integer.MAX_VALUE);
288      assertEquals(0, range.size());
289      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
290      map.put(&quot;f1&quot;, &quot;v1&quot;);
291      StreamEntryID id1 = jedis.xadd(&quot;xrevrange-stream&quot;, (StreamEntryID) null, map);
292      StreamEntryID id2 = jedis.xadd(&quot;xrevrange-stream&quot;, (StreamEntryID) null, map);
293      List&lt;StreamEntry&gt; range2 = jedis.xrange(&quot;xrevrange-stream&quot;, (StreamEntryID) null,
294        (StreamEntryID) null, 3);
295      assertEquals(2, range2.size());
296      List&lt;StreamEntry&gt; range3 = jedis.xrevrange(&quot;xrevrange-stream&quot;, null, id1, 2);
297      assertEquals(2, range3.size());
298      List&lt;StreamEntry&gt; range4 = jedis.xrevrange(&quot;xrevrange-stream&quot;, id2, id1, 2);
299      assertEquals(2, range4.size());
300      List&lt;StreamEntry&gt; range5 = jedis.xrevrange(&quot;xrevrange-stream&quot;, id2, id1, 1);
301      assertEquals(1, range5.size());
302      List&lt;StreamEntry&gt; range6 = jedis.xrevrange(&quot;xrevrange-stream&quot;, null, id2, 4);
303      assertEquals(1, range6.size());
304      StreamEntryID id3 = jedis.xadd(&quot;xrevrange-stream&quot;, (StreamEntryID) null, map);
305      List&lt;StreamEntry&gt; range7 = jedis.xrevrange(&quot;xrevrange-stream&quot;, id3, id3, 4);
306      assertEquals(1, range7.size());
307      List&lt;StreamEntry&gt; range8 = jedis.xrevrange(&quot;xrevrange-stream&quot;, (StreamEntryID) null, (StreamEntryID) null);
308      assertEquals(3, range8.size());
309      range8 = jedis.xrevrange(&quot;xrevrange-stream&quot;, StreamEntryID.MAXIMUM_ID, StreamEntryID.MINIMUM_ID);
310      assertEquals(3, range8.size());
311    }
312    @Test
313    public void xrevrangeExclusive() {
314      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
315      map.put(&quot;f1&quot;, &quot;v1&quot;);
316      String id1 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map).toString();
317      jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
318      List&lt;StreamEntry&gt; range2 = jedis.xrevrange(&quot;xrange-stream&quot;, &quot;+&quot;, id1, 2);
319      assertEquals(2, range2.size());
320      List&lt;StreamEntry&gt; range3 = jedis.xrevrange(&quot;xrange-stream&quot;, &quot;+&quot;, &quot;(&quot; + id1, 2);
321      assertEquals(1, range3.size());
322    }
323    @Test
324    public void xgroup() {
325      Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
326      map.put(&quot;f1&quot;, &quot;v1&quot;);
327      StreamEntryID id1 = jedis.xadd(&quot;xgroup-stream&quot;, (StreamEntryID) null, map);
328      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xgroup-stream&quot;, &quot;consumer-group-name&quot;, null, false));
329      assertEquals(&quot;OK&quot;, jedis.xgroupSetID(&quot;xgroup-stream&quot;, &quot;consumer-group-name&quot;, id1));
330      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xgroup-stream&quot;, &quot;consumer-group-name1&quot;, StreamEntryID.LAST_ENTRY, false));
331      jedis.xgroupDestroy(&quot;xgroup-stream&quot;, &quot;consumer-group-name&quot;);
332      assertEquals(0L, jedis.xgroupDelConsumer(&quot;xgroup-stream&quot;, &quot;consumer-group-name1&quot;,&quot;myconsumer1&quot;));
333      assertTrue(jedis.xgroupCreateConsumer(&quot;xgroup-stream&quot;, &quot;consumer-group-name1&quot;,&quot;myconsumer2&quot;));
334      assertEquals(0L, jedis.xgroupDelConsumer(&quot;xgroup-stream&quot;, &quot;consumer-group-name1&quot;,&quot;myconsumer2&quot;));
335    }
336    @Test
337    public void xreadGroupWithParams() {
338      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
339      map.put(&quot;f1&quot;, &quot;v1&quot;);
340      jedis.xadd(&quot;xreadGroup-stream1&quot;, (StreamEntryID) null, map);
341      jedis.xgroupCreate(&quot;xreadGroup-stream1&quot;, &quot;xreadGroup-group&quot;, null, false);
342      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(&quot;xreadGroup-stream1&quot;, StreamEntryID.UNRECEIVED_ENTRY);
343      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
344          XReadGroupParams.xReadGroupParams().count(1).noAck(), streamQeury1);
345      assertEquals(1, range.size());
346      assertEquals(1, range.get(0).getValue().size());
347      jedis.xadd(&quot;xreadGroup-stream1&quot;, (StreamEntryID) null, map);
348      jedis.xadd(&quot;xreadGroup-stream2&quot;, (StreamEntryID) null, map);
349      jedis.xgroupCreate(&quot;xreadGroup-stream2&quot;, &quot;xreadGroup-group&quot;, null, false);
350      Map&lt;String, StreamEntryID&gt; streamQeury11 = singletonMap(&quot;xreadGroup-stream1&quot;, StreamEntryID.UNRECEIVED_ENTRY);
351      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams1 = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
352          XReadGroupParams.xReadGroupParams().count(1).block(1).noAck(), streamQeury11);
353      assertEquals(1, streams1.size());
354      assertEquals(1, streams1.get(0).getValue().size());
355      Map&lt;String, StreamEntryID&gt; streamQuery23 = new LinkedHashMap&lt;&gt;();
356      streamQuery23.put(&quot;xreadGroup-stream1&quot;, new StreamEntryID());
357      streamQuery23.put(&quot;xreadGroup-stream2&quot;, new StreamEntryID());
358      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams2 = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
359          XReadGroupParams.xReadGroupParams().count(1).block(1).noAck(), streamQuery23);
360      assertEquals(2, streams2.size());
361      StreamEntryID id4 = jedis.xadd(&quot;xreadGroup-stream1&quot;, (StreamEntryID) null, map);
362      Map&lt;String, StreamEntryID&gt; streamQeuryFresh = singletonMap(&quot;xreadGroup-stream1&quot;, StreamEntryID.UNRECEIVED_ENTRY);
363      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams3 = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
364          XReadGroupParams.xReadGroupParams().count(4).block(100).noAck(), streamQeuryFresh);
365      assertEquals(1, streams3.size());
366      assertEquals(id4, streams3.get(0).getValue().get(0).getID());
367    }
368    @Test
369    public void xreadGroupWithParamsWhenPendingMessageIsDiscarded() {
370      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
371      map1.put(&quot;f1&quot;, &quot;v1&quot;);
372      Map&lt;String, String&gt; map2 = new HashMap&lt;&gt;();
373      map2.put(&quot;f2&quot;, &quot;v2&quot;);
374      XAddParams xAddParams = XAddParams.xAddParams().id(StreamEntryID.NEW_ENTRY).maxLen(2);
375      StreamEntryID firstMessageEntryId = jedis.xadd(&quot;xreadGroup-discard-stream1&quot;, xAddParams, map1);
376      jedis.xadd(&quot;xreadGroup-discard-stream1&quot;, xAddParams, map2);
377      jedis.xgroupCreate(&quot;xreadGroup-discard-stream1&quot;, &quot;xreadGroup-group&quot;, null, false);
378      Map&lt;String, StreamEntryID&gt; streamQuery1 = singletonMap(&quot;xreadGroup-discard-stream1&quot;, StreamEntryID.UNRECEIVED_ENTRY);
379      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
380              XReadGroupParams.xReadGroupParams().count(1), streamQuery1);
381      assertEquals(1, range.size());
382      assertEquals(1, range.get(0).getValue().size());
383      assertEquals(firstMessageEntryId, range.get(0).getValue().get(0).getID());
384      assertEquals(map1, range.get(0).getValue().get(0).getFields());
385      Map&lt;String, String&gt; map3 = new HashMap&lt;&gt;();
386      map3.put(&quot;f3&quot;, &quot;v3&quot;);
387      jedis.xadd(&quot;xreadGroup-discard-stream1&quot;, xAddParams, map3);
388      Map&lt;String, StreamEntryID&gt; streamQueryPending = singletonMap(&quot;xreadGroup-discard-stream1&quot;, new StreamEntryID());
389      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; pendingMessages = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
390              XReadGroupParams.xReadGroupParams().count(1).noAck(), streamQueryPending);
391      assertEquals(1, pendingMessages.size());
392      assertEquals(1, pendingMessages.get(0).getValue().size());
393      assertEquals(firstMessageEntryId, pendingMessages.get(0).getValue().get(0).getID());
394      assertNull(pendingMessages.get(0).getValue().get(0).getFields());
395    }
396    @Test
397    public void xack() {
398      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
399      map.put(&quot;f1&quot;, &quot;v1&quot;);
400      jedis.xadd(&quot;xack-stream&quot;, (StreamEntryID) null, map);
401      jedis.xgroupCreate(&quot;xack-stream&quot;, &quot;xack-group&quot;, null, false);
402      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(
403          &quot;xack-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY);
404      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xack-group&quot;, &quot;xack-consumer&quot;,
405          XReadGroupParams.xReadGroupParams().count(1).block(1), streamQeury1);
406      assertEquals(1, range.size());
407      assertEquals(1L,
408        jedis.xack(&quot;xack-stream&quot;, &quot;xack-group&quot;, range.get(0).getValue().get(0).getID()));
409    }
410    @Test
411    public void xpendingWithParams() {
412      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
413      map.put(&quot;f1&quot;, &quot;v1&quot;);
414      StreamEntryID id1 = jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
415      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, null, false));
416      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(
417              &quot;xpendeing-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY);
418      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xpendeing-group&quot;,
419              &quot;xpendeing-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1), streamQeury1);
420      assertEquals(1, range.size());
421      assertEquals(1, range.get(0).getValue().size());
422      assertEquals(map, range.get(0).getValue().get(0).getFields());
423      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
424              new XPendingParams().count(3).consumer(&quot;xpendeing-consumer&quot;));
425      assertEquals(1, pendingRange.size());
426      assertEquals(id1, pendingRange.get(0).getID());
427      assertEquals(1, pendingRange.get(0).getDeliveredTimes());
428      assertEquals(&quot;xpendeing-consumer&quot;, pendingRange.get(0).getConsumerName());
429      assertTrue(pendingRange.get(0).toString().contains(&quot;xpendeing-consumer&quot;));
430      pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, new XPendingParams().count(3));
431      assertEquals(1, pendingRange.size());
432      assertEquals(id1, pendingRange.get(0).getID());
433      assertEquals(1, pendingRange.get(0).getDeliveredTimes());
434      assertEquals(&quot;xpendeing-consumer&quot;, pendingRange.get(0).getConsumerName());
435      pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
436        new XPendingParams().idle(Duration.ofMinutes(1).toMillis()).count(3));
437      assertEquals(0, pendingRange.size());
438    }
439    @Test
440    public void xpendingRange() {
441      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
442      map.put(&quot;foo&quot;, &quot;bar&quot;);
443      StreamEntryID m1 = jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
444      StreamEntryID m2 = jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
445      jedis.xgroupCreate(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, null, false);
446      Map&lt;String, StreamEntryID&gt; streamQeury = singletonMap(
447          &quot;xpendeing-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY);
448      jedis.xreadGroup(&quot;xpendeing-group&quot;, &quot;consumer1&quot;, XReadGroupParams.xReadGroupParams().count(1), streamQeury);
449      jedis.xreadGroup(&quot;xpendeing-group&quot;, &quot;consumer2&quot;, XReadGroupParams.xReadGroupParams().count(1), streamQeury);
450      List&lt;StreamPendingEntry&gt; response = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
451          XPendingParams.xPendingParams(&quot;(0&quot;, &quot;+&quot;, 5));
452      assertEquals(2, response.size());
453      assertEquals(m1, response.get(0).getID());
454      assertEquals(&quot;consumer1&quot;, response.get(0).getConsumerName());
455      assertEquals(m2, response.get(1).getID());
456      assertEquals(&quot;consumer2&quot;, response.get(1).getConsumerName());
457      response = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
458          XPendingParams.xPendingParams(StreamEntryID.MINIMUM_ID, StreamEntryID.MAXIMUM_ID, 5));
459      assertEquals(2, response.size());
460      assertEquals(m1, response.get(0).getID());
461      assertEquals(&quot;consumer1&quot;, response.get(0).getConsumerName());
462      assertEquals(m2, response.get(1).getID());
463      assertEquals(&quot;consumer2&quot;, response.get(1).getConsumerName());
464    }
465    @Test
466    public void xclaimWithParams() {
467      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
468      map.put(&quot;f1&quot;, &quot;v1&quot;);
469      jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
470      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, null, false));
471      jedis.xreadGroup(&quot;xpendeing-group&quot;, &quot;xpendeing-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
472              singletonMap(&quot;xpendeing-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
473      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
474          XPendingParams.xPendingParams().count(3).consumer(&quot;xpendeing-consumer&quot;));
475      try {
476        Thread.sleep(100);
477      } catch (InterruptedException e) {
478        e.printStackTrace();
479      }
480      List&lt;StreamEntry&gt; streamEntrys = jedis.xclaim(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
481              &quot;xpendeing-consumer2&quot;, 50, XClaimParams.xClaimParams().idle(0).retryCount(0),
482              pendingRange.get(0).getID());
483      assertEquals(1, streamEntrys.size());
484      assertEquals(pendingRange.get(0).getID(), streamEntrys.get(0).getID());
485      assertEquals(&quot;v1&quot;, streamEntrys.get(0).getFields().get(&quot;f1&quot;));
486    }
487    @Test
488    public void xclaimJustId() {
489      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
490      map.put(&quot;f1&quot;, &quot;v1&quot;);
491      jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
492      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, null, false));
493      jedis.xreadGroup(&quot;xpendeing-group&quot;, &quot;xpendeing-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
494          singletonMap(&quot;xpendeing-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
495      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
496          XPendingParams.xPendingParams().count(3).consumer(&quot;xpendeing-consumer&quot;));
497      try {
498        Thread.sleep(100);
499      } catch (InterruptedException e) {
500        e.printStackTrace();
501      }
502      List&lt;StreamEntryID&gt; streamEntryIDS = jedis.xclaimJustId(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
503        &quot;xpendeing-consumer2&quot;, 50, XClaimParams.xClaimParams().idle(0).retryCount(0),
504        pendingRange.get(0).getID());
505      assertEquals(1, streamEntryIDS.size());
506      assertEquals(pendingRange.get(0).getID(), streamEntryIDS.get(0));
507    }
508    @Test
509    public void xautoclaim() {
510      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
511      map.put(&quot;f1&quot;, &quot;v1&quot;);
512      jedis.xadd(&quot;xpending-stream&quot;, (StreamEntryID) null, map);
513      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpending-stream&quot;, &quot;xpending-group&quot;, null, false));
514      jedis.xreadGroup(&quot;xpending-group&quot;, &quot;xpending-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
515          singletonMap(&quot;xpending-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
516      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
517          XPendingParams.xPendingParams().count(3).consumer(&quot;xpending-consumer&quot;));
518      try {
519        Thread.sleep(100);
520      } catch (InterruptedException e) {
<span onclick='openModal()' class='match'>521        e.printStackTrace();
522      }
523      Map.Entry&lt;StreamEntryID, List&lt;StreamEntry&gt;&gt; streamEntrys = jedis.xautoclaim(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
524              &quot;xpending-consumer2&quot;, 50, new StreamEntryID(), new XAutoClaimParams().count(1));
525      assertEquals(1, streamEntrys.getValue().size());
526      assertEquals(pendingRange.get(0).getID(), streamEntrys.getValue().get(0).getID());
</span>527      assertEquals(&quot;v1&quot;, streamEntrys.getValue().get(0).getFields().get(&quot;f1&quot;));
528    }
529    @Test
530    public void xautoclaimBinary() {
531      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
532      map.put(&quot;f1&quot;, &quot;v1&quot;);
533      jedis.xadd(&quot;xpending-stream&quot;, XAddParams.xAddParams(), map);
534      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpending-stream&quot;, &quot;xpending-group&quot;, null, false));
535      jedis.xreadGroup(&quot;xpending-group&quot;, &quot;xpending-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
536          singletonMap(&quot;xpending-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
537      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
538          XPendingParams.xPendingParams().count(3).consumer(&quot;xpending-consumer&quot;));
539      try {
540        Thread.sleep(100);
541      } catch (InterruptedException e) {
542        e.printStackTrace();
543      }
544      List&lt;Object&gt; streamEntrys = jedis.xautoclaim(SafeEncoder.encode(&quot;xpending-stream&quot;),
545              SafeEncoder.encode(&quot;xpending-group&quot;), SafeEncoder.encode(&quot;xpending-consumer2&quot;),
546              50, SafeEncoder.encode(new StreamEntryID().toString()), new XAutoClaimParams().count(1));
547      Map.Entry&lt;StreamEntryID, List&lt;StreamEntry&gt;&gt; res = BuilderFactory.STREAM_AUTO_CLAIM_RESPONSE.build(streamEntrys);
548      assertEquals(1, res.getValue().size());
549      assertEquals(pendingRange.get(0).getID(), res.getValue().get(0).getID());
550      assertEquals(&quot;v1&quot;, res.getValue().get(0).getFields().get(&quot;f1&quot;));
551    }
552    @Test
553    public void xautoclaimJustId() {
554      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
555      map.put(&quot;f1&quot;, &quot;v1&quot;);
556      jedis.xadd(&quot;xpending-stream&quot;, (StreamEntryID) null, map);
557      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpending-stream&quot;, &quot;xpending-group&quot;, null, false));
558      jedis.xreadGroup(&quot;xpending-group&quot;, &quot;xpending-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
559          singletonMap(&quot;xpending-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
560      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
561          XPendingParams.xPendingParams().count(3).consumer(&quot;xpending-consumer&quot;));
562      try {
563        Thread.sleep(100);
564      } catch (InterruptedException e) {
565        e.printStackTrace();
566      }
567      Map.Entry&lt;StreamEntryID, List&lt;StreamEntryID&gt;&gt; streamEntrys = jedis.xautoclaimJustId(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
568              &quot;xpending-consumer2&quot;, 50, new StreamEntryID(), new XAutoClaimParams().count(1));
569      assertEquals(1, streamEntrys.getValue().size());
570      assertEquals(pendingRange.get(0).getID().getTime(), streamEntrys.getValue().get(0).getTime());
571      assertEquals(pendingRange.get(0).getID().getSequence(), streamEntrys.getValue().get(0).getSequence());
572    }
573    @Test
574    public void xautoclaimJustIdBinary() {
575      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
576      map.put(&quot;f1&quot;, &quot;v1&quot;);
577      jedis.xadd(&quot;xpending-stream&quot;, XAddParams.xAddParams(), map);
578      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpending-stream&quot;, &quot;xpending-group&quot;, null, false));
579      jedis.xreadGroup(&quot;xpending-group&quot;, &quot;xpending-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
580          singletonMap(&quot;xpending-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
581      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
582          XPendingParams.xPendingParams().count(3).consumer(&quot;xpending-consumer&quot;));
583      try {
584        Thread.sleep(100);
585      } catch (InterruptedException e) {
586        e.printStackTrace();
587      }
588      List&lt;Object&gt; streamEntrys = jedis.xautoclaimJustId(SafeEncoder.encode(&quot;xpending-stream&quot;),
589              SafeEncoder.encode(&quot;xpending-group&quot;), SafeEncoder.encode(&quot;xpending-consumer2&quot;),
590              50, SafeEncoder.encode(new StreamEntryID().toString()), new XAutoClaimParams().count(1));
591      Map.Entry&lt;StreamEntryID, List&lt;StreamEntryID&gt;&gt; res = BuilderFactory.STREAM_AUTO_CLAIM_JUSTID_RESPONSE.build(streamEntrys);
592      assertEquals(1, res.getValue().size());
593      assertEquals(pendingRange.get(0).getID().getTime(), res.getValue().get(0).getTime());
594      assertEquals(pendingRange.get(0).getID().getSequence(), res.getValue().get(0).getSequence());
595    }
596    @Test
597    public void xinfo() throws InterruptedException {
598      final String STREAM_NAME = &quot;xadd-stream1&quot;;
599      final String F1 = &quot;f1&quot;;
600      final String V1 = &quot;v1&quot;;
601      final String V2 = &quot;v2&quot;;
602      final String G1 = &quot;G1&quot;;
603      final String G2 = &quot;G2&quot;;
604      final String MY_CONSUMER = &quot;myConsumer&quot;;
605      final String MY_CONSUMER2 = &quot;myConsumer2&quot;;
606      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
607      map1.put(F1, V1);
608      StreamEntryID id1 = jedis.xadd(STREAM_NAME, (StreamEntryID) null, map1);
609      map1.put(F1, V2);
610      StreamEntryID id2 = jedis.xadd(STREAM_NAME, (StreamEntryID) null, map1);
611      assertNotNull(id1);
612      StreamInfo streamInfo = jedis.xinfoStream(STREAM_NAME);
613      assertNotNull(id2);
614      jedis.xgroupCreate(STREAM_NAME, G1, StreamEntryID.LAST_ENTRY, false);
615      Map&lt;String, StreamEntryID&gt; streamQeury11 = singletonMap(
616          STREAM_NAME, new StreamEntryID(&quot;0-0&quot;));
617      jedis.xreadGroup(G1, MY_CONSUMER, XReadGroupParams.xReadGroupParams().count(1), streamQeury11);
618      Thread.sleep(1);
619      List&lt;StreamGroupInfo&gt; groupInfo = jedis.xinfoGroups(STREAM_NAME);
620      List&lt;StreamConsumersInfo&gt; consumersInfo = jedis.xinfoConsumers(STREAM_NAME, G1);
621      List&lt;StreamConsumerInfo&gt; consumerInfo = jedis.xinfoConsumers2(STREAM_NAME, G1);
622      assertEquals(2L, streamInfo.getStreamInfo().get(StreamInfo.LENGTH));
623      assertEquals(1L, streamInfo.getStreamInfo().get(StreamInfo.RADIX_TREE_KEYS));
624      assertEquals(2L, streamInfo.getStreamInfo().get(StreamInfo.RADIX_TREE_NODES));
625      assertEquals(0L, streamInfo.getStreamInfo().get(StreamInfo.GROUPS));
626      assertEquals(V1, ((StreamEntry) streamInfo.getStreamInfo().get(StreamInfo.FIRST_ENTRY)).getFields().get(F1));
627      assertEquals(V2, ((StreamEntry) streamInfo.getStreamInfo().get(StreamInfo.LAST_ENTRY)).getFields().get(F1));
628      assertEquals(id2, streamInfo.getStreamInfo().get(StreamInfo.LAST_GENERATED_ID));
629      assertEquals(2, streamInfo.getLength());
630      assertEquals(1, streamInfo.getRadixTreeKeys());
631      assertEquals(2, streamInfo.getRadixTreeNodes());
632      assertEquals(0, streamInfo.getGroups());
633      assertEquals(V1, streamInfo.getFirstEntry().getFields().get(F1));
634      assertEquals(V2, streamInfo.getLastEntry().getFields().get(F1));
635      assertEquals(id2, streamInfo.getLastGeneratedId());
636      assertEquals(1, groupInfo.size());
637      assertEquals(G1, groupInfo.get(0).getGroupInfo().get(StreamGroupInfo.NAME));
638      assertEquals(1L, groupInfo.get(0).getGroupInfo().get(StreamGroupInfo.CONSUMERS));
639      assertEquals(0L, groupInfo.get(0).getGroupInfo().get(StreamGroupInfo.PENDING));
640      assertEquals(id2, groupInfo.get(0).getGroupInfo().get(StreamGroupInfo.LAST_DELIVERED));
641      assertEquals(1, groupInfo.size());
642      assertEquals(G1, groupInfo.get(0).getName());
643      assertEquals(1, groupInfo.get(0).getConsumers());
644      assertEquals(0, groupInfo.get(0).getPending());
645      assertEquals(id2, groupInfo.get(0).getLastDeliveredId());
646      assertEquals(MY_CONSUMER,
647        consumersInfo.get(0).getConsumerInfo().get(StreamConsumersInfo.NAME));
648      assertEquals(0L, consumersInfo.get(0).getConsumerInfo().get(StreamConsumersInfo.PENDING));
649      assertTrue((Long) consumersInfo.get(0).getConsumerInfo().get(StreamConsumersInfo.IDLE) &gt; 0);
650      assertEquals(MY_CONSUMER, consumersInfo.get(0).getName());
651      assertEquals(0L, consumersInfo.get(0).getPending());
652      MatcherAssert.assertThat(consumersInfo.get(0).getIdle(), Matchers.greaterThanOrEqualTo(0L));
653      MatcherAssert.assertThat(consumersInfo.get(0).getInactive(), Matchers.any(Long.class));
654      assertEquals(MY_CONSUMER,
655        consumerInfo.get(0).getConsumerInfo().get(StreamConsumerInfo.NAME));
656      assertEquals(0L, consumerInfo.get(0).getConsumerInfo().get(StreamConsumerInfo.PENDING));
657      assertTrue((Long) consumerInfo.get(0).getConsumerInfo().get(StreamConsumerInfo.IDLE) &gt; 0);
658      assertEquals(MY_CONSUMER, consumerInfo.get(0).getName());
659      assertEquals(0L, consumerInfo.get(0).getPending());
660      MatcherAssert.assertThat(consumerInfo.get(0).getIdle(), Matchers.greaterThanOrEqualTo(0L));
661      MatcherAssert.assertThat(consumerInfo.get(0).getInactive(), Matchers.any(Long.class));
662      jedis.xgroupCreate(STREAM_NAME, G2, StreamEntryID.LAST_ENTRY, false);
663      jedis.xreadGroup(G1, MY_CONSUMER2, XReadGroupParams.xReadGroupParams().count(1), streamQeury11);
664      jedis.xreadGroup(G2, MY_CONSUMER, XReadGroupParams.xReadGroupParams().count(1), streamQeury11);
665      jedis.xreadGroup(G2, MY_CONSUMER2, XReadGroupParams.xReadGroupParams().count(1), streamQeury11);
666      List&lt;StreamGroupInfo&gt; manyGroupsInfo = jedis.xinfoGroups(STREAM_NAME);
667      List&lt;StreamConsumersInfo&gt; manyConsumersInfo = jedis.xinfoConsumers(STREAM_NAME, G2);
668      List&lt;StreamConsumerInfo&gt; manyConsumerInfo = jedis.xinfoConsumers2(STREAM_NAME, G2);
669      assertEquals(2, manyGroupsInfo.size());
670      assertEquals(2, manyConsumersInfo.size());
671      assertEquals(2, manyConsumerInfo.size());
672      StreamFullInfo streamInfoFull = jedis.xinfoStreamFull(STREAM_NAME);
673      assertEquals(2, streamInfoFull.getEntries().size());
674      assertEquals(2, streamInfoFull.getGroups().size());
675      assertEquals(2, streamInfoFull.getLength());
676      assertEquals(1, streamInfoFull.getRadixTreeKeys());
677      assertEquals(2, streamInfoFull.getRadixTreeNodes());
678      assertEquals(0, streamInfo.getGroups());
679      assertEquals(G1, streamInfoFull.getGroups().get(0).getName());
680      assertEquals(G2, streamInfoFull.getGroups().get(1).getName());
681      assertEquals(V1, streamInfoFull.getEntries().get(0).getFields().get(F1));
682      assertEquals(V2, streamInfoFull.getEntries().get(1).getFields().get(F1));
683      assertEquals(id2, streamInfoFull.getLastGeneratedId());
684      streamInfoFull = jedis.xinfoStreamFull(STREAM_NAME, 10);
685      assertEquals(G1, streamInfoFull.getGroups().get(0).getName());
686      assertEquals(G2, streamInfoFull.getGroups().get(1).getName());
687      assertEquals(V1, streamInfoFull.getEntries().get(0).getFields().get(F1));
688      assertEquals(V2, streamInfoFull.getEntries().get(1).getFields().get(F1));
689      assertEquals(id2, streamInfoFull.getLastGeneratedId());
690      try {
691        jedis.xinfoStream(&quot;random&quot;);
692        fail(&quot;Command should fail&quot;);
693      } catch (JedisException e) {
694        assertEquals(&quot;ERR no such key&quot;, e.getMessage());
695      }
696    }
697    @Test
698    public void xinfoStreamFullWithPending() {
699      Map&lt;String, String&gt; map = singletonMap(&quot;f1&quot;, &quot;v1&quot;);
700      StreamEntryID id1 = jedis.xadd(&quot;streamfull2&quot;, (StreamEntryID) null, map);
701      StreamEntryID id2 = jedis.xadd(&quot;streamfull2&quot;, (StreamEntryID) null, map);
702      jedis.xgroupCreate(&quot;streamfull2&quot;, &quot;xreadGroup-group&quot;, null, false);
703      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(&quot;streamfull2&quot;, StreamEntryID.UNRECEIVED_ENTRY);
704      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
705          XReadGroupParams.xReadGroupParams().count(1), streamQeury1);
706      assertEquals(1, range.size());
707      assertEquals(1, range.get(0).getValue().size());
708      StreamFullInfo full = jedis.xinfoStreamFull(&quot;streamfull2&quot;);
709      assertEquals(1, full.getGroups().size());
710      StreamGroupFullInfo group = full.getGroups().get(0);
711      assertEquals(&quot;xreadGroup-group&quot;, group.getName());
712      assertEquals(1, group.getPending().size());
713      List&lt;Object&gt; groupPendingEntry = group.getPending().get(0);
714      assertEquals(id1, groupPendingEntry.get(0));
715      assertEquals(&quot;xreadGroup-consumer&quot;, groupPendingEntry.get(1));
716      assertEquals(1, group.getConsumers().size());
717      StreamConsumerFullInfo consumer = group.getConsumers().get(0);
718      assertEquals(&quot;xreadGroup-consumer&quot;, consumer.getName());
719      MatcherAssert.assertThat(consumer.getSeenTime(), Matchers.greaterThanOrEqualTo(0L));
720      MatcherAssert.assertThat(consumer.getActiveTime(), Matchers.greaterThanOrEqualTo(0L));
721      assertEquals(1, consumer.getPending().size());
722      List&lt;Object&gt; consumerPendingEntry = consumer.getPending().get(0);
723      assertEquals(id1, consumerPendingEntry.get(0));
724    }
725    @Test
726    public void pipeline() {
727      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
728      map.put(&quot;a&quot;, &quot;b&quot;);
729      Pipeline p = jedis.pipelined();
730      Response&lt;StreamEntryID&gt; id1 = p.xadd(&quot;stream1&quot;, StreamEntryID.NEW_ENTRY, map);
731      Response&lt;StreamEntryID&gt; id2 = p.xadd(&quot;stream1&quot;, StreamEntryID.NEW_ENTRY, map);
732      Response&lt;List&lt;StreamEntry&gt;&gt; results = p.xrange(&quot;stream1&quot;, (StreamEntryID) null, (StreamEntryID) null, 2);
733      p.sync();
734      List&lt;StreamEntry&gt; entries = results.get();
735      assertEquals(2, entries.size());
736      assertEquals(id1.get(), entries.get(0).getID());
737      assertEquals(map, entries.get(0).getFields());
738      assertEquals(id2.get(), entries.get(1).getID());
739      assertEquals(map, entries.get(1).getFields());
740      p = jedis.pipelined();
741      Response&lt;List&lt;StreamEntry&gt;&gt; results2 = p.xrevrange(&quot;stream1&quot;, null, id1.get(), 2);
742      p.sync();
743      assertEquals(2, results2.get().size());
744    }
745    @Test
746    public void transaction() {
747      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
748      map.put(&quot;a&quot;, &quot;b&quot;);
749      Transaction t = jedis.multi();
750      Response&lt;StreamEntryID&gt; id1 = t.xadd(&quot;stream1&quot;, StreamEntryID.NEW_ENTRY, map);
751      Response&lt;StreamEntryID&gt; id2 = t.xadd(&quot;stream1&quot;, StreamEntryID.NEW_ENTRY, map);
752      Response&lt;List&lt;StreamEntry&gt;&gt; results = t.xrange(&quot;stream1&quot;, (StreamEntryID) null, (StreamEntryID) null, 2);
753      t.exec();
754      List&lt;StreamEntry&gt; entries = results.get();
755      assertEquals(2, entries.size());
756      assertEquals(id1.get(), entries.get(0).getID());
757      assertEquals(map, entries.get(0).getFields());
758      assertEquals(id2.get(), entries.get(1).getID());
759      assertEquals(map, entries.get(1).getFields());
760    }
761  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-StreamsCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static java.util.Collections.singletonMap;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertFalse;
5  import static org.junit.Assert.assertNotNull;
6  import static org.junit.Assert.assertNull;
7  import static org.junit.Assert.assertTrue;
8  import static org.junit.Assert.fail;
9  import java.time.Duration;
10  import java.util.HashMap;
11  import java.util.LinkedHashMap;
12  import java.util.List;
13  import java.util.Map;
14  import java.util.Map.Entry;
15  import java.util.concurrent.atomic.AtomicReference;
16  import org.hamcrest.MatcherAssert;
17  import org.hamcrest.Matchers;
18  import org.junit.Test;
19  import redis.clients.jedis.BuilderFactory;
20  import redis.clients.jedis.Jedis;
21  import redis.clients.jedis.Pipeline;
22  import redis.clients.jedis.Response;
23  import redis.clients.jedis.StreamEntryID;
24  import redis.clients.jedis.Transaction;
25  import redis.clients.jedis.exceptions.JedisDataException;
26  import redis.clients.jedis.exceptions.JedisException;
27  import redis.clients.jedis.params.*;
28  import redis.clients.jedis.resps.*;
29  import redis.clients.jedis.util.SafeEncoder;
30  public class StreamsCommandsTest extends JedisCommandsTestBase {
31    @Test
32    public void xadd() {
33      try {
34        Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
35        jedis.xadd(&quot;stream1&quot;, (StreamEntryID) null, map1);
36        fail();
37      } catch (JedisDataException expected) {
38        assertTrue(expected.getMessage().contains(&quot;wrong number of arguments&quot;));
39      }
40      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
41      map1.put(&quot;f1&quot;, &quot;v1&quot;);
42      StreamEntryID id1 = jedis.xadd(&quot;xadd-stream1&quot;, (StreamEntryID) null, map1);
43      assertNotNull(id1);
44      Map&lt;String, String&gt; map2 = new HashMap&lt;&gt;();
45      map2.put(&quot;f1&quot;, &quot;v1&quot;);
46      map2.put(&quot;f2&quot;, &quot;v2&quot;);
47      StreamEntryID id2 = jedis.xadd(&quot;xadd-stream1&quot;, (StreamEntryID) null, map2);
48      assertTrue(id2.compareTo(id1) &gt; 0);
49      Map&lt;String, String&gt; map3 = new HashMap&lt;&gt;();
50      map3.put(&quot;f2&quot;, &quot;v2&quot;);
51      map3.put(&quot;f3&quot;, &quot;v3&quot;);
52      StreamEntryID id3 = jedis.xadd(&quot;xadd-stream2&quot;, (StreamEntryID) null, map3);
53      Map&lt;String, String&gt; map4 = new HashMap&lt;&gt;();
54      map4.put(&quot;f2&quot;, &quot;v2&quot;);
55      map4.put(&quot;f3&quot;, &quot;v3&quot;);
56      StreamEntryID idIn = new StreamEntryID(id3.getTime() + 1, 1L);
57      StreamEntryID id4 = jedis.xadd(&quot;xadd-stream2&quot;, idIn, map4);
58      assertEquals(idIn, id4);
59      assertTrue(id4.compareTo(id3) &gt; 0);
60      Map&lt;String, String&gt; map5 = new HashMap&lt;&gt;();
61      map5.put(&quot;f4&quot;, &quot;v4&quot;);
62      map5.put(&quot;f5&quot;, &quot;v5&quot;);
63      StreamEntryID id5 = jedis.xadd(&quot;xadd-stream2&quot;, (StreamEntryID) null, map5);
64      assertTrue(id5.compareTo(id4) &gt; 0);
65      Map&lt;String, String&gt; map6 = new HashMap&lt;&gt;();
66      map6.put(&quot;f4&quot;, &quot;v4&quot;);
67      map6.put(&quot;f5&quot;, &quot;v5&quot;);
68      StreamEntryID id6 = jedis.xadd(&quot;xadd-stream2&quot;, map6, XAddParams.xAddParams().maxLen(3));
69      assertTrue(id6.compareTo(id5) &gt; 0);
70      assertEquals(3L, jedis.xlen(&quot;xadd-stream2&quot;));
71    }
72    @Test
73    public void xaddWithParams() {
74      try {
75        jedis.xadd(&quot;stream1&quot;, new HashMap&lt;&gt;(), XAddParams.xAddParams());
76        fail();
77      } catch (JedisDataException expected) {
78        assertTrue(expected.getMessage().contains(&quot;wrong number of arguments&quot;));
79      }
80      try {
81        jedis.xadd(&quot;stream1&quot;, XAddParams.xAddParams(), new HashMap&lt;&gt;());
82        fail();
83      } catch (JedisDataException expected) {
84        assertTrue(expected.getMessage().contains(&quot;wrong number of arguments&quot;));
85      }
86      StreamEntryID id1 = jedis.xadd(&quot;xadd-stream1&quot;, (StreamEntryID) null, singletonMap(&quot;f1&quot;, &quot;v1&quot;));
87      assertNotNull(id1);
88      Map&lt;String, String&gt; map2 = new HashMap&lt;&gt;();
89      map2.put(&quot;f1&quot;, &quot;v1&quot;);
90      map2.put(&quot;f2&quot;, &quot;v2&quot;);
91      StreamEntryID id2 = jedis.xadd(&quot;xadd-stream1&quot;, map2, XAddParams.xAddParams());
92      assertTrue(id2.compareTo(id1) &gt; 0);
93      Map&lt;String, String&gt; map3 = new HashMap&lt;&gt;();
94      map3.put(&quot;f2&quot;, &quot;v2&quot;);
95      map3.put(&quot;f3&quot;, &quot;v3&quot;);
96      StreamEntryID id3 = jedis.xadd(&quot;xadd-stream2&quot;, XAddParams.xAddParams(), map3);
97      Map&lt;String, String&gt; map4 = new HashMap&lt;&gt;();
98      map4.put(&quot;f2&quot;, &quot;v2&quot;);
99      map4.put(&quot;f3&quot;, &quot;v3&quot;);
100      StreamEntryID idIn = new StreamEntryID(id3.getTime() + 1, 1L);
101      StreamEntryID id4 = jedis.xadd(&quot;xadd-stream2&quot;, map4, XAddParams.xAddParams().id(idIn));
102      assertEquals(idIn, id4);
103      assertTrue(id4.compareTo(id3) &gt; 0);
104      Map&lt;String, String&gt; map5 = new HashMap&lt;&gt;();
105      map5.put(&quot;f4&quot;, &quot;v4&quot;);
106      map5.put(&quot;f5&quot;, &quot;v5&quot;);
107      StreamEntryID id5 = jedis.xadd(&quot;xadd-stream2&quot;, XAddParams.xAddParams(), map5);
108      assertTrue(id5.compareTo(id4) &gt; 0);
109      Map&lt;String, String&gt; map6 = new HashMap&lt;&gt;();
110      map6.put(&quot;f4&quot;, &quot;v4&quot;);
111      map6.put(&quot;f5&quot;, &quot;v5&quot;);
112      StreamEntryID id6 = jedis.xadd(&quot;xadd-stream2&quot;, map6, XAddParams.xAddParams().maxLen(3).exactTrimming());
113      assertTrue(id6.compareTo(id5) &gt; 0);
114      assertEquals(3L, jedis.xlen(&quot;xadd-stream2&quot;));
115      StreamEntryID id7 = jedis.xadd(&quot;xadd-stream3&quot;, XAddParams.xAddParams().noMkStream().maxLen(3).exactTrimming(), map6);
116      assertNull(id7);
117      assertFalse(jedis.exists(&quot;xadd-stream3&quot;));
118      jedis.xadd(&quot;xadd-stream3&quot;, map6, XAddParams.xAddParams().minId(&quot;2&quot;).id(new StreamEntryID(2)));
119      assertEquals(1L, jedis.xlen(&quot;xadd-stream3&quot;));
120      jedis.xadd(&quot;xadd-stream3&quot;, XAddParams.xAddParams().minId(&quot;4&quot;).id(new StreamEntryID(3)), map6);
121      assertEquals(0L, jedis.xlen(&quot;xadd-stream3&quot;));
122    }
123    @Test
124    public void xaddParamsId() {
125      StreamEntryID id;
126      String key = &quot;kk&quot;;
127      Map&lt;String, String&gt; map = singletonMap(&quot;ff&quot;, &quot;vv&quot;);
128      id = jedis.xadd(key, XAddParams.xAddParams().id(new StreamEntryID(0, 1)), map);
129      assertNotNull(id);
130      assertEquals(&quot;0-1&quot;, id.toString());
131      assertEquals(0, id.getTime());
132      assertEquals(1, id.getSequence());
133      id = jedis.xadd(key, XAddParams.xAddParams().id(2, 3), map);
134      assertNotNull(id);
135      assertEquals(2, id.getTime());
136      assertEquals(3, id.getSequence());
137      id = jedis.xadd(key, XAddParams.xAddParams().id(4), map);
138      assertNotNull(id);
139      assertEquals(4, id.getTime());
140      assertEquals(0, id.getSequence());
141      id = jedis.xadd(key, XAddParams.xAddParams().id(&quot;5-6&quot;), map);
142      assertNotNull(id);
143      assertEquals(5, id.getTime());
144      assertEquals(6, id.getSequence());
145      id = jedis.xadd(key, XAddParams.xAddParams().id(&quot;7-8&quot;.getBytes()), map);
146      assertNotNull(id);
147      assertEquals(7, id.getTime());
148      assertEquals(8, id.getSequence());
149      id = jedis.xadd(key, XAddParams.xAddParams(), map);
150      assertNotNull(id);
151    }
152    @Test
153    public void xdel() {
154      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
155      map1.put(&quot;f1&quot;, &quot;v1&quot;);
156      StreamEntryID id1 = jedis.xadd(&quot;xdel-stream&quot;, (StreamEntryID) null, map1);
157      assertNotNull(id1);
158      StreamEntryID id2 = jedis.xadd(&quot;xdel-stream&quot;, (StreamEntryID) null, map1);
159      assertNotNull(id2);
160      assertEquals(2L, jedis.xlen(&quot;xdel-stream&quot;));
161      assertEquals(1L, jedis.xdel(&quot;xdel-stream&quot;, id1));
162      assertEquals(1L, jedis.xlen(&quot;xdel-stream&quot;));
163    }
164    @Test
165    public void xlen() {
166      assertEquals(0L, jedis.xlen(&quot;xlen-stream&quot;));
167      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
168      map.put(&quot;f1&quot;, &quot;v1&quot;);
169      jedis.xadd(&quot;xlen-stream&quot;, (StreamEntryID) null, map);
170      assertEquals(1L, jedis.xlen(&quot;xlen-stream&quot;));
171      jedis.xadd(&quot;xlen-stream&quot;, (StreamEntryID) null, map);
172      assertEquals(2L, jedis.xlen(&quot;xlen-stream&quot;));
173    }
174    @Test
175    public void xrange() {
176      List&lt;StreamEntry&gt; range = jedis.xrange(&quot;xrange-stream&quot;, (StreamEntryID) null,
177        (StreamEntryID) null, Integer.MAX_VALUE);
178      assertEquals(0, range.size());
179      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
180      map.put(&quot;f1&quot;, &quot;v1&quot;);
181      StreamEntryID id1 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
182      StreamEntryID id2 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
183      List&lt;StreamEntry&gt; range2 = jedis.xrange(&quot;xrange-stream&quot;, (StreamEntryID) null,
184        (StreamEntryID) null, 3);
185      assertEquals(2, range2.size());
186      assertEquals(range2.get(0).toString(), id1 + &quot; &quot; + map);
187      List&lt;StreamEntry&gt; range3 = jedis.xrange(&quot;xrange-stream&quot;, id1, null, 2);
188      assertEquals(2, range3.size());
189      List&lt;StreamEntry&gt; range4 = jedis.xrange(&quot;xrange-stream&quot;, id1, id2, 2);
190      assertEquals(2, range4.size());
191      List&lt;StreamEntry&gt; range5 = jedis.xrange(&quot;xrange-stream&quot;, id1, id2, 1);
192      assertEquals(1, range5.size());
193      List&lt;StreamEntry&gt; range6 = jedis.xrange(&quot;xrange-stream&quot;, id2, null, 4);
194      assertEquals(1, range6.size());
195      StreamEntryID id3 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
196      List&lt;StreamEntry&gt; range7 = jedis.xrange(&quot;xrange-stream&quot;, id3, id3, 4);
197      assertEquals(1, range7.size());
198      List&lt;StreamEntry&gt; range8 = jedis.xrange(&quot;xrange-stream&quot;, (StreamEntryID) null, (StreamEntryID) null);
199      assertEquals(3, range8.size());
200      range8 = jedis.xrange(&quot;xrange-stream&quot;, StreamEntryID.MINIMUM_ID, StreamEntryID.MAXIMUM_ID);
201      assertEquals(3, range8.size());
202    }
203    @Test
204    public void xrangeExclusive() {
205      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
206      map.put(&quot;f1&quot;, &quot;v1&quot;);
207      String id1 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map).toString();
208      jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
209      List&lt;StreamEntry&gt; range2 = jedis.xrange(&quot;xrange-stream&quot;, id1, &quot;+&quot;, 2);
210      assertEquals(2, range2.size());
211      List&lt;StreamEntry&gt; range3 = jedis.xrange(&quot;xrange-stream&quot;, &quot;(&quot; + id1, &quot;+&quot;, 2);
212      assertEquals(1, range3.size());
213    }
214    @Test
215    public void xreadWithParams() {
216      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(&quot;xread-stream1&quot;, new StreamEntryID());
217      assertNull(jedis.xread(XReadParams.xReadParams().block(1), streamQeury1));
218      assertNull(jedis.xread(XReadParams.xReadParams(), streamQeury1));
219      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
220      map.put(&quot;f1&quot;, &quot;v1&quot;);
221      StreamEntryID id1 = jedis.xadd(&quot;xread-stream1&quot;, (StreamEntryID) null, map);
222      StreamEntryID id2 = jedis.xadd(&quot;xread-stream2&quot;, (StreamEntryID) null, map);
223      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams1 = jedis.xread(XReadParams.xReadParams().count(1).block(1), streamQeury1);
224      assertEquals(1, streams1.size());
225      assertEquals(&quot;xread-stream1&quot;, streams1.get(0).getKey());
226      assertEquals(1, streams1.get(0).getValue().size());
227      assertEquals(id1, streams1.get(0).getValue().get(0).getID());
228      assertEquals(map, streams1.get(0).getValue().get(0).getFields());
229      assertNull(jedis.xread(XReadParams.xReadParams().block(1), singletonMap(&quot;xread-stream1&quot;, id1)));
230      assertNull(jedis.xread(XReadParams.xReadParams(), singletonMap(&quot;xread-stream1&quot;, id1)));
231      Map&lt;String, StreamEntryID&gt; streamQuery23 = new LinkedHashMap&lt;&gt;();
232      streamQuery23.put(&quot;xread-stream1&quot;, new StreamEntryID());
233      streamQuery23.put(&quot;xread-stream2&quot;, new StreamEntryID());
234      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams2 = jedis.xread(XReadParams.xReadParams().count(2).block(1), streamQuery23);
235      assertEquals(2, streams2.size());
236    }
237    @Test
238    public void xreadBlockZero() throws InterruptedException {
239      final AtomicReference&lt;StreamEntryID&gt; readId = new AtomicReference&lt;&gt;();
240      Thread t = new Thread(new Runnable() {
241        @Override
242        public void run() {
243          try (Jedis blockJedis = createJedis()) {
244            long startTime = System.currentTimeMillis();
245            List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; read = blockJedis.xread(XReadParams.xReadParams().block(0),
246                singletonMap(&quot;block0-stream&quot;, new StreamEntryID()));
247            long endTime = System.currentTimeMillis();
248            assertTrue(endTime - startTime &gt; 500);
249            assertNotNull(read);
250            readId.set(read.get(0).getValue().get(0).getID());
251          }
252        }
253      }, &quot;xread-block-0-thread&quot;);
254      t.start();
255      Thread.sleep(1000);
256      StreamEntryID addedId = jedis.xadd(&quot;block0-stream&quot;, (StreamEntryID) null, singletonMap(&quot;foo&quot;, &quot;bar&quot;));
257      t.join();
258      assertEquals(addedId, readId.get());
259    }
260    @Test
261    public void xtrim() {
262      Map&lt;String, String&gt; map1 = new HashMap&lt;String, String&gt;();
263      map1.put(&quot;f1&quot;, &quot;v1&quot;);
264      for (int i = 1; i &lt;= 5; i++) {
265        jedis.xadd(&quot;xtrim-stream&quot;, (StreamEntryID) null, map1);
266      }
267      assertEquals(5L, jedis.xlen(&quot;xtrim-stream&quot;));
268      jedis.xtrim(&quot;xtrim-stream&quot;, 3, false);
269      assertEquals(3L, jedis.xlen(&quot;xtrim-stream&quot;));
270    }
271    @Test
272    public void xtrimWithParams() {
273      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
274      map1.put(&quot;f1&quot;, &quot;v1&quot;);
275      for (int i = 1; i &lt;= 5; i++) {
276        jedis.xadd(&quot;xtrim-stream&quot;, new StreamEntryID(&quot;0-&quot; + i), map1);
277      }
278      assertEquals(5L, jedis.xlen(&quot;xtrim-stream&quot;));
279      jedis.xtrim(&quot;xtrim-stream&quot;, XTrimParams.xTrimParams().maxLen(3).exactTrimming());
280      assertEquals(3L, jedis.xlen(&quot;xtrim-stream&quot;));
281      jedis.xtrim(&quot;xtrim-stream&quot;, XTrimParams.xTrimParams().minId(&quot;0-4&quot;).exactTrimming());
282      assertEquals(2L, jedis.xlen(&quot;xtrim-stream&quot;));
283    }
284    @Test
285    public void xrevrange() {
286      List&lt;StreamEntry&gt; range = jedis.xrevrange(&quot;xrevrange-stream&quot;, (StreamEntryID) null,
287        (StreamEntryID) null, Integer.MAX_VALUE);
288      assertEquals(0, range.size());
289      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
290      map.put(&quot;f1&quot;, &quot;v1&quot;);
291      StreamEntryID id1 = jedis.xadd(&quot;xrevrange-stream&quot;, (StreamEntryID) null, map);
292      StreamEntryID id2 = jedis.xadd(&quot;xrevrange-stream&quot;, (StreamEntryID) null, map);
293      List&lt;StreamEntry&gt; range2 = jedis.xrange(&quot;xrevrange-stream&quot;, (StreamEntryID) null,
294        (StreamEntryID) null, 3);
295      assertEquals(2, range2.size());
296      List&lt;StreamEntry&gt; range3 = jedis.xrevrange(&quot;xrevrange-stream&quot;, null, id1, 2);
297      assertEquals(2, range3.size());
298      List&lt;StreamEntry&gt; range4 = jedis.xrevrange(&quot;xrevrange-stream&quot;, id2, id1, 2);
299      assertEquals(2, range4.size());
300      List&lt;StreamEntry&gt; range5 = jedis.xrevrange(&quot;xrevrange-stream&quot;, id2, id1, 1);
301      assertEquals(1, range5.size());
302      List&lt;StreamEntry&gt; range6 = jedis.xrevrange(&quot;xrevrange-stream&quot;, null, id2, 4);
303      assertEquals(1, range6.size());
304      StreamEntryID id3 = jedis.xadd(&quot;xrevrange-stream&quot;, (StreamEntryID) null, map);
305      List&lt;StreamEntry&gt; range7 = jedis.xrevrange(&quot;xrevrange-stream&quot;, id3, id3, 4);
306      assertEquals(1, range7.size());
307      List&lt;StreamEntry&gt; range8 = jedis.xrevrange(&quot;xrevrange-stream&quot;, (StreamEntryID) null, (StreamEntryID) null);
308      assertEquals(3, range8.size());
309      range8 = jedis.xrevrange(&quot;xrevrange-stream&quot;, StreamEntryID.MAXIMUM_ID, StreamEntryID.MINIMUM_ID);
310      assertEquals(3, range8.size());
311    }
312    @Test
313    public void xrevrangeExclusive() {
314      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
315      map.put(&quot;f1&quot;, &quot;v1&quot;);
316      String id1 = jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map).toString();
317      jedis.xadd(&quot;xrange-stream&quot;, (StreamEntryID) null, map);
318      List&lt;StreamEntry&gt; range2 = jedis.xrevrange(&quot;xrange-stream&quot;, &quot;+&quot;, id1, 2);
319      assertEquals(2, range2.size());
320      List&lt;StreamEntry&gt; range3 = jedis.xrevrange(&quot;xrange-stream&quot;, &quot;+&quot;, &quot;(&quot; + id1, 2);
321      assertEquals(1, range3.size());
322    }
323    @Test
324    public void xgroup() {
325      Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
326      map.put(&quot;f1&quot;, &quot;v1&quot;);
327      StreamEntryID id1 = jedis.xadd(&quot;xgroup-stream&quot;, (StreamEntryID) null, map);
328      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xgroup-stream&quot;, &quot;consumer-group-name&quot;, null, false));
329      assertEquals(&quot;OK&quot;, jedis.xgroupSetID(&quot;xgroup-stream&quot;, &quot;consumer-group-name&quot;, id1));
330      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xgroup-stream&quot;, &quot;consumer-group-name1&quot;, StreamEntryID.LAST_ENTRY, false));
331      jedis.xgroupDestroy(&quot;xgroup-stream&quot;, &quot;consumer-group-name&quot;);
332      assertEquals(0L, jedis.xgroupDelConsumer(&quot;xgroup-stream&quot;, &quot;consumer-group-name1&quot;,&quot;myconsumer1&quot;));
333      assertTrue(jedis.xgroupCreateConsumer(&quot;xgroup-stream&quot;, &quot;consumer-group-name1&quot;,&quot;myconsumer2&quot;));
334      assertEquals(0L, jedis.xgroupDelConsumer(&quot;xgroup-stream&quot;, &quot;consumer-group-name1&quot;,&quot;myconsumer2&quot;));
335    }
336    @Test
337    public void xreadGroupWithParams() {
338      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
339      map.put(&quot;f1&quot;, &quot;v1&quot;);
340      jedis.xadd(&quot;xreadGroup-stream1&quot;, (StreamEntryID) null, map);
341      jedis.xgroupCreate(&quot;xreadGroup-stream1&quot;, &quot;xreadGroup-group&quot;, null, false);
342      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(&quot;xreadGroup-stream1&quot;, StreamEntryID.UNRECEIVED_ENTRY);
343      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
344          XReadGroupParams.xReadGroupParams().count(1).noAck(), streamQeury1);
345      assertEquals(1, range.size());
346      assertEquals(1, range.get(0).getValue().size());
347      jedis.xadd(&quot;xreadGroup-stream1&quot;, (StreamEntryID) null, map);
348      jedis.xadd(&quot;xreadGroup-stream2&quot;, (StreamEntryID) null, map);
349      jedis.xgroupCreate(&quot;xreadGroup-stream2&quot;, &quot;xreadGroup-group&quot;, null, false);
350      Map&lt;String, StreamEntryID&gt; streamQeury11 = singletonMap(&quot;xreadGroup-stream1&quot;, StreamEntryID.UNRECEIVED_ENTRY);
351      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams1 = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
352          XReadGroupParams.xReadGroupParams().count(1).block(1).noAck(), streamQeury11);
353      assertEquals(1, streams1.size());
354      assertEquals(1, streams1.get(0).getValue().size());
355      Map&lt;String, StreamEntryID&gt; streamQuery23 = new LinkedHashMap&lt;&gt;();
356      streamQuery23.put(&quot;xreadGroup-stream1&quot;, new StreamEntryID());
357      streamQuery23.put(&quot;xreadGroup-stream2&quot;, new StreamEntryID());
358      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams2 = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
359          XReadGroupParams.xReadGroupParams().count(1).block(1).noAck(), streamQuery23);
360      assertEquals(2, streams2.size());
361      StreamEntryID id4 = jedis.xadd(&quot;xreadGroup-stream1&quot;, (StreamEntryID) null, map);
362      Map&lt;String, StreamEntryID&gt; streamQeuryFresh = singletonMap(&quot;xreadGroup-stream1&quot;, StreamEntryID.UNRECEIVED_ENTRY);
363      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; streams3 = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
364          XReadGroupParams.xReadGroupParams().count(4).block(100).noAck(), streamQeuryFresh);
365      assertEquals(1, streams3.size());
366      assertEquals(id4, streams3.get(0).getValue().get(0).getID());
367    }
368    @Test
369    public void xreadGroupWithParamsWhenPendingMessageIsDiscarded() {
370      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
371      map1.put(&quot;f1&quot;, &quot;v1&quot;);
372      Map&lt;String, String&gt; map2 = new HashMap&lt;&gt;();
373      map2.put(&quot;f2&quot;, &quot;v2&quot;);
374      XAddParams xAddParams = XAddParams.xAddParams().id(StreamEntryID.NEW_ENTRY).maxLen(2);
375      StreamEntryID firstMessageEntryId = jedis.xadd(&quot;xreadGroup-discard-stream1&quot;, xAddParams, map1);
376      jedis.xadd(&quot;xreadGroup-discard-stream1&quot;, xAddParams, map2);
377      jedis.xgroupCreate(&quot;xreadGroup-discard-stream1&quot;, &quot;xreadGroup-group&quot;, null, false);
378      Map&lt;String, StreamEntryID&gt; streamQuery1 = singletonMap(&quot;xreadGroup-discard-stream1&quot;, StreamEntryID.UNRECEIVED_ENTRY);
379      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
380              XReadGroupParams.xReadGroupParams().count(1), streamQuery1);
381      assertEquals(1, range.size());
382      assertEquals(1, range.get(0).getValue().size());
383      assertEquals(firstMessageEntryId, range.get(0).getValue().get(0).getID());
384      assertEquals(map1, range.get(0).getValue().get(0).getFields());
385      Map&lt;String, String&gt; map3 = new HashMap&lt;&gt;();
386      map3.put(&quot;f3&quot;, &quot;v3&quot;);
387      jedis.xadd(&quot;xreadGroup-discard-stream1&quot;, xAddParams, map3);
388      Map&lt;String, StreamEntryID&gt; streamQueryPending = singletonMap(&quot;xreadGroup-discard-stream1&quot;, new StreamEntryID());
389      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; pendingMessages = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
390              XReadGroupParams.xReadGroupParams().count(1).noAck(), streamQueryPending);
391      assertEquals(1, pendingMessages.size());
392      assertEquals(1, pendingMessages.get(0).getValue().size());
393      assertEquals(firstMessageEntryId, pendingMessages.get(0).getValue().get(0).getID());
394      assertNull(pendingMessages.get(0).getValue().get(0).getFields());
395    }
396    @Test
397    public void xack() {
398      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
399      map.put(&quot;f1&quot;, &quot;v1&quot;);
400      jedis.xadd(&quot;xack-stream&quot;, (StreamEntryID) null, map);
401      jedis.xgroupCreate(&quot;xack-stream&quot;, &quot;xack-group&quot;, null, false);
402      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(
403          &quot;xack-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY);
404      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xack-group&quot;, &quot;xack-consumer&quot;,
405          XReadGroupParams.xReadGroupParams().count(1).block(1), streamQeury1);
406      assertEquals(1, range.size());
407      assertEquals(1L,
408        jedis.xack(&quot;xack-stream&quot;, &quot;xack-group&quot;, range.get(0).getValue().get(0).getID()));
409    }
410    @Test
411    public void xpendingWithParams() {
412      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
413      map.put(&quot;f1&quot;, &quot;v1&quot;);
414      StreamEntryID id1 = jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
415      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, null, false));
416      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(
417              &quot;xpendeing-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY);
418      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xpendeing-group&quot;,
419              &quot;xpendeing-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1), streamQeury1);
420      assertEquals(1, range.size());
421      assertEquals(1, range.get(0).getValue().size());
422      assertEquals(map, range.get(0).getValue().get(0).getFields());
423      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
424              new XPendingParams().count(3).consumer(&quot;xpendeing-consumer&quot;));
425      assertEquals(1, pendingRange.size());
426      assertEquals(id1, pendingRange.get(0).getID());
427      assertEquals(1, pendingRange.get(0).getDeliveredTimes());
428      assertEquals(&quot;xpendeing-consumer&quot;, pendingRange.get(0).getConsumerName());
429      assertTrue(pendingRange.get(0).toString().contains(&quot;xpendeing-consumer&quot;));
430      pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, new XPendingParams().count(3));
431      assertEquals(1, pendingRange.size());
432      assertEquals(id1, pendingRange.get(0).getID());
433      assertEquals(1, pendingRange.get(0).getDeliveredTimes());
434      assertEquals(&quot;xpendeing-consumer&quot;, pendingRange.get(0).getConsumerName());
435      pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
436        new XPendingParams().idle(Duration.ofMinutes(1).toMillis()).count(3));
437      assertEquals(0, pendingRange.size());
438    }
439    @Test
440    public void xpendingRange() {
441      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
442      map.put(&quot;foo&quot;, &quot;bar&quot;);
443      StreamEntryID m1 = jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
444      StreamEntryID m2 = jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
445      jedis.xgroupCreate(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, null, false);
446      Map&lt;String, StreamEntryID&gt; streamQeury = singletonMap(
447          &quot;xpendeing-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY);
448      jedis.xreadGroup(&quot;xpendeing-group&quot;, &quot;consumer1&quot;, XReadGroupParams.xReadGroupParams().count(1), streamQeury);
449      jedis.xreadGroup(&quot;xpendeing-group&quot;, &quot;consumer2&quot;, XReadGroupParams.xReadGroupParams().count(1), streamQeury);
450      List&lt;StreamPendingEntry&gt; response = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
451          XPendingParams.xPendingParams(&quot;(0&quot;, &quot;+&quot;, 5));
452      assertEquals(2, response.size());
453      assertEquals(m1, response.get(0).getID());
454      assertEquals(&quot;consumer1&quot;, response.get(0).getConsumerName());
455      assertEquals(m2, response.get(1).getID());
456      assertEquals(&quot;consumer2&quot;, response.get(1).getConsumerName());
457      response = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
458          XPendingParams.xPendingParams(StreamEntryID.MINIMUM_ID, StreamEntryID.MAXIMUM_ID, 5));
459      assertEquals(2, response.size());
460      assertEquals(m1, response.get(0).getID());
461      assertEquals(&quot;consumer1&quot;, response.get(0).getConsumerName());
462      assertEquals(m2, response.get(1).getID());
463      assertEquals(&quot;consumer2&quot;, response.get(1).getConsumerName());
464    }
465    @Test
466    public void xclaimWithParams() {
467      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
468      map.put(&quot;f1&quot;, &quot;v1&quot;);
469      jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
470      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, null, false));
471      jedis.xreadGroup(&quot;xpendeing-group&quot;, &quot;xpendeing-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
472              singletonMap(&quot;xpendeing-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
473      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
474          XPendingParams.xPendingParams().count(3).consumer(&quot;xpendeing-consumer&quot;));
475      try {
476        Thread.sleep(100);
477      } catch (InterruptedException e) {
478        e.printStackTrace();
479      }
480      List&lt;StreamEntry&gt; streamEntrys = jedis.xclaim(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
481              &quot;xpendeing-consumer2&quot;, 50, XClaimParams.xClaimParams().idle(0).retryCount(0),
482              pendingRange.get(0).getID());
483      assertEquals(1, streamEntrys.size());
484      assertEquals(pendingRange.get(0).getID(), streamEntrys.get(0).getID());
485      assertEquals(&quot;v1&quot;, streamEntrys.get(0).getFields().get(&quot;f1&quot;));
486    }
487    @Test
488    public void xclaimJustId() {
489      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
490      map.put(&quot;f1&quot;, &quot;v1&quot;);
491      jedis.xadd(&quot;xpendeing-stream&quot;, (StreamEntryID) null, map);
492      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;, null, false));
493      jedis.xreadGroup(&quot;xpendeing-group&quot;, &quot;xpendeing-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
494          singletonMap(&quot;xpendeing-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
495      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
496          XPendingParams.xPendingParams().count(3).consumer(&quot;xpendeing-consumer&quot;));
497      try {
498        Thread.sleep(100);
499      } catch (InterruptedException e) {
500        e.printStackTrace();
501      }
502      List&lt;StreamEntryID&gt; streamEntryIDS = jedis.xclaimJustId(&quot;xpendeing-stream&quot;, &quot;xpendeing-group&quot;,
503        &quot;xpendeing-consumer2&quot;, 50, XClaimParams.xClaimParams().idle(0).retryCount(0),
504        pendingRange.get(0).getID());
505      assertEquals(1, streamEntryIDS.size());
506      assertEquals(pendingRange.get(0).getID(), streamEntryIDS.get(0));
507    }
508    @Test
509    public void xautoclaim() {
510      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
511      map.put(&quot;f1&quot;, &quot;v1&quot;);
512      jedis.xadd(&quot;xpending-stream&quot;, (StreamEntryID) null, map);
513      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpending-stream&quot;, &quot;xpending-group&quot;, null, false));
514      jedis.xreadGroup(&quot;xpending-group&quot;, &quot;xpending-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
515          singletonMap(&quot;xpending-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
516      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
517          XPendingParams.xPendingParams().count(3).consumer(&quot;xpending-consumer&quot;));
518      try {
519        Thread.sleep(100);
520      } catch (InterruptedException e) {
521        e.printStackTrace();
522      }
523      Map.Entry&lt;StreamEntryID, List&lt;StreamEntry&gt;&gt; streamEntrys = jedis.xautoclaim(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
524              &quot;xpending-consumer2&quot;, 50, new StreamEntryID(), new XAutoClaimParams().count(1));
525      assertEquals(1, streamEntrys.getValue().size());
526      assertEquals(pendingRange.get(0).getID(), streamEntrys.getValue().get(0).getID());
527      assertEquals(&quot;v1&quot;, streamEntrys.getValue().get(0).getFields().get(&quot;f1&quot;));
528    }
529    @Test
530    public void xautoclaimBinary() {
531      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
532      map.put(&quot;f1&quot;, &quot;v1&quot;);
533      jedis.xadd(&quot;xpending-stream&quot;, XAddParams.xAddParams(), map);
534      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpending-stream&quot;, &quot;xpending-group&quot;, null, false));
535      jedis.xreadGroup(&quot;xpending-group&quot;, &quot;xpending-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
536          singletonMap(&quot;xpending-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
537      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
538          XPendingParams.xPendingParams().count(3).consumer(&quot;xpending-consumer&quot;));
539      try {
540        Thread.sleep(100);
541      } catch (InterruptedException e) {
542        e.printStackTrace();
543      }
544      List&lt;Object&gt; streamEntrys = jedis.xautoclaim(SafeEncoder.encode(&quot;xpending-stream&quot;),
545              SafeEncoder.encode(&quot;xpending-group&quot;), SafeEncoder.encode(&quot;xpending-consumer2&quot;),
546              50, SafeEncoder.encode(new StreamEntryID().toString()), new XAutoClaimParams().count(1));
547      Map.Entry&lt;StreamEntryID, List&lt;StreamEntry&gt;&gt; res = BuilderFactory.STREAM_AUTO_CLAIM_RESPONSE.build(streamEntrys);
548      assertEquals(1, res.getValue().size());
549      assertEquals(pendingRange.get(0).getID(), res.getValue().get(0).getID());
550      assertEquals(&quot;v1&quot;, res.getValue().get(0).getFields().get(&quot;f1&quot;));
551    }
552    @Test
553    public void xautoclaimJustId() {
554      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
555      map.put(&quot;f1&quot;, &quot;v1&quot;);
556      jedis.xadd(&quot;xpending-stream&quot;, (StreamEntryID) null, map);
557      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpending-stream&quot;, &quot;xpending-group&quot;, null, false));
558      jedis.xreadGroup(&quot;xpending-group&quot;, &quot;xpending-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
559          singletonMap(&quot;xpending-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
560      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
561          XPendingParams.xPendingParams().count(3).consumer(&quot;xpending-consumer&quot;));
562      try {
563        Thread.sleep(100);
564      } catch (InterruptedException e) {
<span onclick='openModal()' class='match'>565        e.printStackTrace();
566      }
567      Map.Entry&lt;StreamEntryID, List&lt;StreamEntryID&gt;&gt; streamEntrys = jedis.xautoclaimJustId(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
568              &quot;xpending-consumer2&quot;, 50, new StreamEntryID(), new XAutoClaimParams().count(1));
569      assertEquals(1, streamEntrys.getValue().size());
570      assertEquals(pendingRange.get(0).getID().getTime(), streamEntrys.getValue().get(0).getTime());
</span>571      assertEquals(pendingRange.get(0).getID().getSequence(), streamEntrys.getValue().get(0).getSequence());
572    }
573    @Test
574    public void xautoclaimJustIdBinary() {
575      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
576      map.put(&quot;f1&quot;, &quot;v1&quot;);
577      jedis.xadd(&quot;xpending-stream&quot;, XAddParams.xAddParams(), map);
578      assertEquals(&quot;OK&quot;, jedis.xgroupCreate(&quot;xpending-stream&quot;, &quot;xpending-group&quot;, null, false));
579      jedis.xreadGroup(&quot;xpending-group&quot;, &quot;xpending-consumer&quot;, XReadGroupParams.xReadGroupParams().count(1).block(1),
580          singletonMap(&quot;xpending-stream&quot;, StreamEntryID.UNRECEIVED_ENTRY));
581      List&lt;StreamPendingEntry&gt; pendingRange = jedis.xpending(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
582          XPendingParams.xPendingParams().count(3).consumer(&quot;xpending-consumer&quot;));
583      try {
584        Thread.sleep(100);
585      } catch (InterruptedException e) {
586        e.printStackTrace();
587      }
588      List&lt;Object&gt; streamEntrys = jedis.xautoclaimJustId(SafeEncoder.encode(&quot;xpending-stream&quot;),
589              SafeEncoder.encode(&quot;xpending-group&quot;), SafeEncoder.encode(&quot;xpending-consumer2&quot;),
590              50, SafeEncoder.encode(new StreamEntryID().toString()), new XAutoClaimParams().count(1));
591      Map.Entry&lt;StreamEntryID, List&lt;StreamEntryID&gt;&gt; res = BuilderFactory.STREAM_AUTO_CLAIM_JUSTID_RESPONSE.build(streamEntrys);
592      assertEquals(1, res.getValue().size());
593      assertEquals(pendingRange.get(0).getID().getTime(), res.getValue().get(0).getTime());
594      assertEquals(pendingRange.get(0).getID().getSequence(), res.getValue().get(0).getSequence());
595    }
596    @Test
597    public void xinfo() throws InterruptedException {
598      final String STREAM_NAME = &quot;xadd-stream1&quot;;
599      final String F1 = &quot;f1&quot;;
600      final String V1 = &quot;v1&quot;;
601      final String V2 = &quot;v2&quot;;
602      final String G1 = &quot;G1&quot;;
603      final String G2 = &quot;G2&quot;;
604      final String MY_CONSUMER = &quot;myConsumer&quot;;
605      final String MY_CONSUMER2 = &quot;myConsumer2&quot;;
606      Map&lt;String, String&gt; map1 = new HashMap&lt;&gt;();
607      map1.put(F1, V1);
608      StreamEntryID id1 = jedis.xadd(STREAM_NAME, (StreamEntryID) null, map1);
609      map1.put(F1, V2);
610      StreamEntryID id2 = jedis.xadd(STREAM_NAME, (StreamEntryID) null, map1);
611      assertNotNull(id1);
612      StreamInfo streamInfo = jedis.xinfoStream(STREAM_NAME);
613      assertNotNull(id2);
614      jedis.xgroupCreate(STREAM_NAME, G1, StreamEntryID.LAST_ENTRY, false);
615      Map&lt;String, StreamEntryID&gt; streamQeury11 = singletonMap(
616          STREAM_NAME, new StreamEntryID(&quot;0-0&quot;));
617      jedis.xreadGroup(G1, MY_CONSUMER, XReadGroupParams.xReadGroupParams().count(1), streamQeury11);
618      Thread.sleep(1);
619      List&lt;StreamGroupInfo&gt; groupInfo = jedis.xinfoGroups(STREAM_NAME);
620      List&lt;StreamConsumersInfo&gt; consumersInfo = jedis.xinfoConsumers(STREAM_NAME, G1);
621      List&lt;StreamConsumerInfo&gt; consumerInfo = jedis.xinfoConsumers2(STREAM_NAME, G1);
622      assertEquals(2L, streamInfo.getStreamInfo().get(StreamInfo.LENGTH));
623      assertEquals(1L, streamInfo.getStreamInfo().get(StreamInfo.RADIX_TREE_KEYS));
624      assertEquals(2L, streamInfo.getStreamInfo().get(StreamInfo.RADIX_TREE_NODES));
625      assertEquals(0L, streamInfo.getStreamInfo().get(StreamInfo.GROUPS));
626      assertEquals(V1, ((StreamEntry) streamInfo.getStreamInfo().get(StreamInfo.FIRST_ENTRY)).getFields().get(F1));
627      assertEquals(V2, ((StreamEntry) streamInfo.getStreamInfo().get(StreamInfo.LAST_ENTRY)).getFields().get(F1));
628      assertEquals(id2, streamInfo.getStreamInfo().get(StreamInfo.LAST_GENERATED_ID));
629      assertEquals(2, streamInfo.getLength());
630      assertEquals(1, streamInfo.getRadixTreeKeys());
631      assertEquals(2, streamInfo.getRadixTreeNodes());
632      assertEquals(0, streamInfo.getGroups());
633      assertEquals(V1, streamInfo.getFirstEntry().getFields().get(F1));
634      assertEquals(V2, streamInfo.getLastEntry().getFields().get(F1));
635      assertEquals(id2, streamInfo.getLastGeneratedId());
636      assertEquals(1, groupInfo.size());
637      assertEquals(G1, groupInfo.get(0).getGroupInfo().get(StreamGroupInfo.NAME));
638      assertEquals(1L, groupInfo.get(0).getGroupInfo().get(StreamGroupInfo.CONSUMERS));
639      assertEquals(0L, groupInfo.get(0).getGroupInfo().get(StreamGroupInfo.PENDING));
640      assertEquals(id2, groupInfo.get(0).getGroupInfo().get(StreamGroupInfo.LAST_DELIVERED));
641      assertEquals(1, groupInfo.size());
642      assertEquals(G1, groupInfo.get(0).getName());
643      assertEquals(1, groupInfo.get(0).getConsumers());
644      assertEquals(0, groupInfo.get(0).getPending());
645      assertEquals(id2, groupInfo.get(0).getLastDeliveredId());
646      assertEquals(MY_CONSUMER,
647        consumersInfo.get(0).getConsumerInfo().get(StreamConsumersInfo.NAME));
648      assertEquals(0L, consumersInfo.get(0).getConsumerInfo().get(StreamConsumersInfo.PENDING));
649      assertTrue((Long) consumersInfo.get(0).getConsumerInfo().get(StreamConsumersInfo.IDLE) &gt; 0);
650      assertEquals(MY_CONSUMER, consumersInfo.get(0).getName());
651      assertEquals(0L, consumersInfo.get(0).getPending());
652      MatcherAssert.assertThat(consumersInfo.get(0).getIdle(), Matchers.greaterThanOrEqualTo(0L));
653      MatcherAssert.assertThat(consumersInfo.get(0).getInactive(), Matchers.any(Long.class));
654      assertEquals(MY_CONSUMER,
655        consumerInfo.get(0).getConsumerInfo().get(StreamConsumerInfo.NAME));
656      assertEquals(0L, consumerInfo.get(0).getConsumerInfo().get(StreamConsumerInfo.PENDING));
657      assertTrue((Long) consumerInfo.get(0).getConsumerInfo().get(StreamConsumerInfo.IDLE) &gt; 0);
658      assertEquals(MY_CONSUMER, consumerInfo.get(0).getName());
659      assertEquals(0L, consumerInfo.get(0).getPending());
660      MatcherAssert.assertThat(consumerInfo.get(0).getIdle(), Matchers.greaterThanOrEqualTo(0L));
661      MatcherAssert.assertThat(consumerInfo.get(0).getInactive(), Matchers.any(Long.class));
662      jedis.xgroupCreate(STREAM_NAME, G2, StreamEntryID.LAST_ENTRY, false);
663      jedis.xreadGroup(G1, MY_CONSUMER2, XReadGroupParams.xReadGroupParams().count(1), streamQeury11);
664      jedis.xreadGroup(G2, MY_CONSUMER, XReadGroupParams.xReadGroupParams().count(1), streamQeury11);
665      jedis.xreadGroup(G2, MY_CONSUMER2, XReadGroupParams.xReadGroupParams().count(1), streamQeury11);
666      List&lt;StreamGroupInfo&gt; manyGroupsInfo = jedis.xinfoGroups(STREAM_NAME);
667      List&lt;StreamConsumersInfo&gt; manyConsumersInfo = jedis.xinfoConsumers(STREAM_NAME, G2);
668      List&lt;StreamConsumerInfo&gt; manyConsumerInfo = jedis.xinfoConsumers2(STREAM_NAME, G2);
669      assertEquals(2, manyGroupsInfo.size());
670      assertEquals(2, manyConsumersInfo.size());
671      assertEquals(2, manyConsumerInfo.size());
672      StreamFullInfo streamInfoFull = jedis.xinfoStreamFull(STREAM_NAME);
673      assertEquals(2, streamInfoFull.getEntries().size());
674      assertEquals(2, streamInfoFull.getGroups().size());
675      assertEquals(2, streamInfoFull.getLength());
676      assertEquals(1, streamInfoFull.getRadixTreeKeys());
677      assertEquals(2, streamInfoFull.getRadixTreeNodes());
678      assertEquals(0, streamInfo.getGroups());
679      assertEquals(G1, streamInfoFull.getGroups().get(0).getName());
680      assertEquals(G2, streamInfoFull.getGroups().get(1).getName());
681      assertEquals(V1, streamInfoFull.getEntries().get(0).getFields().get(F1));
682      assertEquals(V2, streamInfoFull.getEntries().get(1).getFields().get(F1));
683      assertEquals(id2, streamInfoFull.getLastGeneratedId());
684      streamInfoFull = jedis.xinfoStreamFull(STREAM_NAME, 10);
685      assertEquals(G1, streamInfoFull.getGroups().get(0).getName());
686      assertEquals(G2, streamInfoFull.getGroups().get(1).getName());
687      assertEquals(V1, streamInfoFull.getEntries().get(0).getFields().get(F1));
688      assertEquals(V2, streamInfoFull.getEntries().get(1).getFields().get(F1));
689      assertEquals(id2, streamInfoFull.getLastGeneratedId());
690      try {
691        jedis.xinfoStream(&quot;random&quot;);
692        fail(&quot;Command should fail&quot;);
693      } catch (JedisException e) {
694        assertEquals(&quot;ERR no such key&quot;, e.getMessage());
695      }
696    }
697    @Test
698    public void xinfoStreamFullWithPending() {
699      Map&lt;String, String&gt; map = singletonMap(&quot;f1&quot;, &quot;v1&quot;);
700      StreamEntryID id1 = jedis.xadd(&quot;streamfull2&quot;, (StreamEntryID) null, map);
701      StreamEntryID id2 = jedis.xadd(&quot;streamfull2&quot;, (StreamEntryID) null, map);
702      jedis.xgroupCreate(&quot;streamfull2&quot;, &quot;xreadGroup-group&quot;, null, false);
703      Map&lt;String, StreamEntryID&gt; streamQeury1 = singletonMap(&quot;streamfull2&quot;, StreamEntryID.UNRECEIVED_ENTRY);
704      List&lt;Entry&lt;String, List&lt;StreamEntry&gt;&gt;&gt; range = jedis.xreadGroup(&quot;xreadGroup-group&quot;, &quot;xreadGroup-consumer&quot;,
705          XReadGroupParams.xReadGroupParams().count(1), streamQeury1);
706      assertEquals(1, range.size());
707      assertEquals(1, range.get(0).getValue().size());
708      StreamFullInfo full = jedis.xinfoStreamFull(&quot;streamfull2&quot;);
709      assertEquals(1, full.getGroups().size());
710      StreamGroupFullInfo group = full.getGroups().get(0);
711      assertEquals(&quot;xreadGroup-group&quot;, group.getName());
712      assertEquals(1, group.getPending().size());
713      List&lt;Object&gt; groupPendingEntry = group.getPending().get(0);
714      assertEquals(id1, groupPendingEntry.get(0));
715      assertEquals(&quot;xreadGroup-consumer&quot;, groupPendingEntry.get(1));
716      assertEquals(1, group.getConsumers().size());
717      StreamConsumerFullInfo consumer = group.getConsumers().get(0);
718      assertEquals(&quot;xreadGroup-consumer&quot;, consumer.getName());
719      MatcherAssert.assertThat(consumer.getSeenTime(), Matchers.greaterThanOrEqualTo(0L));
720      MatcherAssert.assertThat(consumer.getActiveTime(), Matchers.greaterThanOrEqualTo(0L));
721      assertEquals(1, consumer.getPending().size());
722      List&lt;Object&gt; consumerPendingEntry = consumer.getPending().get(0);
723      assertEquals(id1, consumerPendingEntry.get(0));
724    }
725    @Test
726    public void pipeline() {
727      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
728      map.put(&quot;a&quot;, &quot;b&quot;);
729      Pipeline p = jedis.pipelined();
730      Response&lt;StreamEntryID&gt; id1 = p.xadd(&quot;stream1&quot;, StreamEntryID.NEW_ENTRY, map);
731      Response&lt;StreamEntryID&gt; id2 = p.xadd(&quot;stream1&quot;, StreamEntryID.NEW_ENTRY, map);
732      Response&lt;List&lt;StreamEntry&gt;&gt; results = p.xrange(&quot;stream1&quot;, (StreamEntryID) null, (StreamEntryID) null, 2);
733      p.sync();
734      List&lt;StreamEntry&gt; entries = results.get();
735      assertEquals(2, entries.size());
736      assertEquals(id1.get(), entries.get(0).getID());
737      assertEquals(map, entries.get(0).getFields());
738      assertEquals(id2.get(), entries.get(1).getID());
739      assertEquals(map, entries.get(1).getFields());
740      p = jedis.pipelined();
741      Response&lt;List&lt;StreamEntry&gt;&gt; results2 = p.xrevrange(&quot;stream1&quot;, null, id1.get(), 2);
742      p.sync();
743      assertEquals(2, results2.get().size());
744    }
745    @Test
746    public void transaction() {
747      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
748      map.put(&quot;a&quot;, &quot;b&quot;);
749      Transaction t = jedis.multi();
750      Response&lt;StreamEntryID&gt; id1 = t.xadd(&quot;stream1&quot;, StreamEntryID.NEW_ENTRY, map);
751      Response&lt;StreamEntryID&gt; id2 = t.xadd(&quot;stream1&quot;, StreamEntryID.NEW_ENTRY, map);
752      Response&lt;List&lt;StreamEntry&gt;&gt; results = t.xrange(&quot;stream1&quot;, (StreamEntryID) null, (StreamEntryID) null, 2);
753      t.exec();
754      List&lt;StreamEntry&gt; entries = results.get();
755      assertEquals(2, entries.size());
756      assertEquals(id1.get(), entries.get(0).getID());
757      assertEquals(map, entries.get(0).getFields());
758      assertEquals(id2.get(), entries.get(1).getID());
759      assertEquals(map, entries.get(1).getFields());
760    }
761  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-StreamsCommandsTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-StreamsCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>521        e.printStackTrace();
522      }
523      Map.Entry&lt;StreamEntryID, List&lt;StreamEntry&gt;&gt; streamEntrys = jedis.xautoclaim(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
524              &quot;xpending-consumer2&quot;, 50, new StreamEntryID(), new XAutoClaimParams().count(1));
525      assertEquals(1, streamEntrys.getValue().size());
526      assertEquals(pendingRange.get(0).getID(), streamEntrys.getValue().get(0).getID());
</pre></code></div>
                <div class="column column_space"><pre><code>565        e.printStackTrace();
566      }
567      Map.Entry&lt;StreamEntryID, List&lt;StreamEntryID&gt;&gt; streamEntrys = jedis.xautoclaimJustId(&quot;xpending-stream&quot;, &quot;xpending-group&quot;,
568              &quot;xpending-consumer2&quot;, 50, new StreamEntryID(), new XAutoClaimParams().count(1));
569      assertEquals(1, streamEntrys.getValue().size());
570      assertEquals(pendingRange.get(0).getID().getTime(), streamEntrys.getValue().get(0).getTime());
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    