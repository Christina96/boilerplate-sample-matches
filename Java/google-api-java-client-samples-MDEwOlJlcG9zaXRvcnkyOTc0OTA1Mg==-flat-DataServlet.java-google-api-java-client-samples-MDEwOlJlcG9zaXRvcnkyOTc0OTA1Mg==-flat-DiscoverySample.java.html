
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 6.41399416909621%, Tokens: 12</h2>
        <div class="column">
            <h3>google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-DataServlet.java</h3>
            <pre><code>1  package com.google.api.client.sample.bigquery.appengine.dashboard;
2  import com.google.appengine.api.datastore.Entity;
3  import com.google.appengine.api.users.UserServiceFactory;
4  import com.google.gson.stream.JsonWriter;
5  import java.io.IOException;
6  import java.util.List;
7  import javax.servlet.http.HttpServlet;
8  import javax.servlet.http.HttpServletRequest;
9  import javax.servlet.http.HttpServletResponse;
10  public class DataServlet extends HttpServlet {
11    private static final long serialVersionUID = 1L;
12    private final String[] labels = new String[]
13        {"State", "Year", "Average Mother Age", "Average Father Age", "U.S. Census Region"};
14    private final String[] properties = new String[]
15        {"state", "year", "average_mother_age", "average_father_age", "region"};
16    private final String[] types = new String[] {"string", "number", "number", "number", "string"};
17    @Override
18    protected void doPost(HttpServletRequest request, HttpServletResponse response)
19        throws IOException {
20      JsonWriter jsonWriter = new JsonWriter(response.getWriter()).beginObject();
21      String userId = UserServiceFactory.getUserService().getCurrentUser().getUserId();
22      DatastoreUtils datastoreUtils = new DatastoreUtils(userId);
23      String jobStatus = datastoreUtils.getUserJobStatus();
24      if (("DONE").equalsIgnoreCase(jobStatus)) {
25        List<Entity> results = datastoreUtils.getResults();
26        if (!results.isEmpty()) {
27          writeResultsToMotionChartJson(jsonWriter, results);
28        }
29      }
30      jsonWriter.name("failed").value(datastoreUtils.hasUserQueryFailed());
<span onclick='openModal()' class='match'>31      jsonWriter.name("message").value(datastoreUtils.getUserMessage());
32      jsonWriter.name("lastRun").value(datastoreUtils.getUserLastRunMessage());
33      jsonWriter.endObject().close();
34    }
35    private void writeResultsToMotionChartJson(JsonWriter jsonWriter, Iterable<Entity> results)
36        throws IOException {
37      jsonWriter.name("data").beginObject();
</span>38      jsonWriter.name("cols").beginArray();
39      for (int i = 0; i < properties.length; i++) {
40        jsonWriter.beginObject()
41            .name("id").value(properties[i])
42            .name("label").value(labels[i])
43            .name("type").value(types[i])
44            .endObject();
45      }
46      jsonWriter.endArray();
47      jsonWriter.name("rows").beginArray();
48      for (Entity entity : results) {
49        jsonWriter.beginObject().name("c").beginArray();
50        for (int i = 0; i < properties.length; i++) {
51          String value = "";
52          if (entity.getProperty(properties[i]) != null) {
53            value = String.valueOf(entity.getProperty(properties[i]));
54          }
55          jsonWriter.beginObject().name("v").value(value).endObject();
56        }
57        jsonWriter.endArray().endObject();
58      }
59      jsonWriter.endArray();
60      jsonWriter.endObject();
61    }
62  }
</code></pre>
        </div>
        <div class="column">
            <h3>google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-DiscoverySample.java</h3>
            <pre><code>1  package com.google.api.services.samples.discovery.cmdline;
2  import com.google.api.client.auth.oauth2.Credential;
3  import com.google.api.client.extensions.java6.auth.oauth2.AuthorizationCodeInstalledApp;
4  import com.google.api.client.extensions.jetty.auth.oauth2.LocalServerReceiver;
5  import com.google.api.client.googleapis.auth.oauth2.GoogleAuthorizationCodeFlow;
6  import com.google.api.client.googleapis.auth.oauth2.GoogleClientSecrets;
7  import com.google.api.client.googleapis.javanet.GoogleNetHttpTransport;
8  import com.google.api.client.http.FileContent;
9  import com.google.api.client.http.GenericUrl;
10  import com.google.api.client.http.HttpContent;
11  import com.google.api.client.http.HttpRequest;
12  import com.google.api.client.http.HttpRequestFactory;
13  import com.google.api.client.http.HttpResponseException;
14  import com.google.api.client.http.HttpTransport;
15  import com.google.api.client.http.UriTemplate;
16  import com.google.api.client.json.JsonFactory;
17  import com.google.api.client.json.jackson2.JacksonFactory;
18  import com.google.api.client.util.Lists;
19  import com.google.api.client.util.Maps;
20  import com.google.api.client.util.store.DataStoreFactory;
21  import com.google.api.client.util.store.FileDataStoreFactory;
22  import com.google.api.services.discovery.Discovery;
23  import com.google.api.services.discovery.model.DirectoryList;
24  import com.google.api.services.discovery.model.JsonSchema;
25  import com.google.api.services.discovery.model.RestDescription;
26  import com.google.api.services.discovery.model.RestMethod;
27  import com.google.api.services.discovery.model.RestResource;
28  import com.google.common.base.Joiner;
29  import java.io.File;
30  import java.io.IOException;
31  import java.io.InputStreamReader;
32  import java.math.BigDecimal;
33  import java.math.BigInteger;
34  import java.util.ArrayList;
35  import java.util.Collections;
36  import java.util.HashMap;
37  import java.util.List;
38  import java.util.Map;
39  import java.util.regex.Matcher;
40  import java.util.regex.Pattern;
41  public class DiscoverySample {
42    private static final java.io.File DATA_STORE_DIR =
43        new java.io.File(System.getProperty("user.home"), ".store/discovery_sample");
44    private static FileDataStoreFactory dataStoreFactory;
45    private static HttpTransport httpTransport;
46    private static final JsonFactory JSON_FACTORY = JacksonFactory.getDefaultInstance();
47    static Discovery DISCOVERY;
48    private static final String APP_NAME = "Google Discovery API Client";
49    private static final Pattern API_NAME_PATTERN = Pattern.compile("\\w+");
50    private static final Pattern API_VERSION_PATTERN = Pattern.compile("[\\w.]+");
51    private static final Pattern METHOD_PATTERN = Pattern.compile("((\\w+)\\.)*(\\w+)");
52    public static void main(String[] args) throws Exception {
53      if (args.length == 0) {
54        showMainHelp();
55      } else {
56        String command = args[0];
57        if (command.equals("help")) {
58          help(args);
59        } else if (command.equals("call")) {
60          call(args);
61        } else if (command.equals("discover")) {
62          discover(args);
63        } else {
64          error(null, "unknown command: " + command);
65        }
66      }
67    }
68    private static void help(String[] args) {
69      if (args.length == 1) {
70        showMainHelp();
71      } else {
72        String helpCommand = args[1];
73        if (helpCommand.equals("call")) {
74          System.out.println("Usage: google call apiName apiVersion methodName [parameters]");
75          System.out.println();
76          System.out.println("Examples:");
77          System.out.println("  google call discovery v1 apis.getRest plus v1");
78          System.out.println("  google call plus v1 activities.list me public --max-results 3");
79          System.out.println("  google call calendar v3 calendarList.list");
80          System.out.println("  echo {\"summary\":\"temporary calendar\"} > /tmp/post.json && "
81              + "google call calendar v3 calendars.insert /tmp/post.json");
82        } else if (helpCommand.equals("discover")) {
83          System.out.println("Usage");
84          System.out.println("List all APIs: google discover");
85          System.out.println("List method of an API: google discover <apiName> <apiVersion>");
86          System.out.println();
87          System.out.println("Examples:");
88          System.out.println("  google discover");
89          System.out.println("  google discover plus v1");
90          System.out.println("  google discover moderator v1");
91        } else {
92          error(null, "unknown command: " + helpCommand);
93        }
94      }
95    }
96    private static void showMainHelp() {
<span onclick='openModal()' class='match'>97      System.out.println(APP_NAME);
98      System.out.println();
99      System.out.println("For more help on a specific command, type one of:");
100      System.out.println();
101      System.out.println("  google help call");
102      System.out.println("  google help discover");
103    }
104    private static void error(String command, String detail) {
105      System.err.println("ERROR: " + detail);
106      System.err.println("For help, type: google" + (command == null ? "" : " help " + command));
</span>107      System.exit(1);
108    }
109    private static void putParameter(String argName, Map<String, Object> parameters,
110        String parameterName, JsonSchema parameter, String parameterValue) {
111      Object value = parameterValue;
112      if (parameter != null) {
113        if ("boolean".equals(parameter.getType())) {
114          value = Boolean.valueOf(parameterValue);
115        } else if ("number".equals(parameter.getType())) {
116          value = new BigDecimal(parameterValue);
117        } else if ("integer".equals(parameter.getType())) {
118          value = new BigInteger(parameterValue);
119        }
120      }
121      Object oldValue = parameters.put(parameterName, value);
122      if (oldValue != null) {
123        error("call", "duplicate parameter: " + argName);
124      }
125    }
126    private static void call(String[] args) throws Exception {
127      httpTransport = GoogleNetHttpTransport.newTrustedTransport();
128      DISCOVERY = new Discovery(httpTransport, JSON_FACTORY, null);
129      if (args.length == 1) {
130        error("call", "missing api name");
131      }
132      if (args.length == 2) {
133        error("call", "missing api version");
134      }
135      if (args.length == 3) {
136        error("call", "missing method name");
137      }
138      String apiName = args[1];
139      String apiVersion = args[2];
140      String fullMethodName = args[3];
141      Matcher m = METHOD_PATTERN.matcher(fullMethodName);
142      if (!m.matches()) {
143        error("call", "invalid method name: " + fullMethodName);
144      }
145      RestDescription restDescription = loadGoogleAPI("call", apiName, apiVersion);
146      Map<String, RestMethod> methodMap = null;
147      int curIndex = 0;
148      int nextIndex = fullMethodName.indexOf('.');
149      if (nextIndex == -1) {
150        methodMap = restDescription.getMethods();
151      } else {
152        Map<String, RestResource> resources = restDescription.getResources();
153        while (true) {
154          RestResource resource = resources.get(fullMethodName.substring(curIndex, nextIndex));
155          if (resource == null) {
156            break;
157          }
158          curIndex = nextIndex + 1;
159          nextIndex = fullMethodName.indexOf(curIndex + 1, '.');
160          if (nextIndex == -1) {
161            methodMap = resource.getMethods();
162            break;
163          }
164          resources = resource.getResources();
165        }
166      }
167      RestMethod method =
168          methodMap == null ? null : methodMap.get(fullMethodName.substring(curIndex));
169      if (method == null) {
170        error("call", "method not found: " + fullMethodName);
171      }
172      HashMap<String, Object> parameters = Maps.newHashMap();
173      File requestBodyFile = null;
174      String contentType = "application/json";
175      int i = 4;
176      if (method.getParameterOrder() != null) {
177        for (String parameterName : method.getParameterOrder()) {
178          JsonSchema parameter = method.getParameters().get(parameterName);
179          if (Boolean.TRUE.equals(parameter.getRequired())) {
180            if (i == args.length) {
181              error("call", "missing required parameter: " + parameter);
182            } else {
183              putParameter(null, parameters, parameterName, parameter, args[i++]);
184            }
185          }
186        }
187      }
188      if (!method.getHttpMethod().equals("GET") && !method.getHttpMethod().equals("DELETE")) {
189        String fileName = args[i++];
190        requestBodyFile = new File(fileName);
191        if (!requestBodyFile.canRead()) {
192          error("call", "unable to read file: " + fileName);
193        }
194      }
195      while (i < args.length) {
196        String argName = args[i++];
197        if (!argName.startsWith("--")) {
198          error("call", "optional parameters must start with \"--\": " + argName);
199        }
200        String parameterName = argName.substring(2);
201        if (i == args.length) {
202          error("call", "missing parameter value for: " + argName);
203        }
204        String parameterValue = args[i++];
205        if (parameterName.equals("contentType")) {
206          contentType = parameterValue;
207          if (method.getHttpMethod().equals("GET") || method.getHttpMethod().equals("DELETE")) {
208            error("call", "HTTP content type cannot be specified for this method: " + argName);
209          }
210        } else {
211          JsonSchema parameter = null;
212          if (restDescription.getParameters() != null) {
213            parameter = restDescription.getParameters().get(parameterName);
214          }
215          if (parameter == null && method.getParameters() == null) {
216            parameter = method.getParameters().get(parameterName);
217          }
218          putParameter(argName, parameters, parameterName, parameter, parameterValue);
219        }
220      }
221      GenericUrl url = new GenericUrl(UriTemplate.expand(
222          "https:&bsol;&bsol;www.googleapis.com" + restDescription.getBasePath() + method.getPath(), parameters,
223          true));
224      HttpContent content = null;
225      if (requestBodyFile != null) {
226        content = new FileContent(contentType, requestBodyFile);
227      }
228      try {
229        HttpRequestFactory requestFactory;
230        if (method.getScopes() != null) {
231          List<String> scopes = Lists.newArrayListWithCapacity(method.getScopes().size());
232          for (Object s : method.getScopes()) {
233            scopes.add((String) s);
234          }
235          Credential credential = authorize(method.getId(), scopes);
236          requestFactory = httpTransport.createRequestFactory(credential);
237        } else {
238          requestFactory = httpTransport.createRequestFactory();
239        }
240        HttpRequest request = requestFactory.buildRequest(method.getHttpMethod(), url, content);
241        String response = request.execute().parseAsString();
242        System.out.println(response);
243      } catch (IOException e) {
244        System.err.println(e.getMessage());
245        System.exit(1);
246      } catch (Throwable t) {
247        t.printStackTrace();
248        System.exit(1);
249      }
250    }
251    private static Credential authorize(String methodId, List<String> scopes) throws Exception {
252      GoogleClientSecrets clientSecrets = GoogleClientSecrets.load(JSON_FACTORY,
253          new InputStreamReader(DiscoverySample.class.getResourceAsStream("/client_secrets.json")));
254      if (clientSecrets.getDetails().getClientId().startsWith("Enter")
255          || clientSecrets.getDetails().getClientSecret().startsWith("Enter ")) {
256        System.out.println("Enter Client ID and Secret from https:&bsol;&bsol;code.google.com/apis/console/ "
257            + "into discovery-cmdline-sample/src/main/resources/client_secrets.json");
258        System.exit(1);
259      }
260      GoogleAuthorizationCodeFlow flow = new GoogleAuthorizationCodeFlow.Builder(
261          httpTransport, JSON_FACTORY, clientSecrets, scopes).setDataStoreFactory(dataStoreFactory)
262          .build();
263      return new AuthorizationCodeInstalledApp(flow, new LocalServerReceiver()).authorize("user");
264    }
265    private static RestDescription loadGoogleAPI(String command, String apiName, String apiVersion)
266        throws IOException {
267      if (!API_NAME_PATTERN.matcher(apiName).matches()) {
268        error(command, "invalid API name: " + apiName);
269      }
270      if (!API_VERSION_PATTERN.matcher(apiVersion).matches()) {
271        error(command, "invalid API version: " + apiVersion);
272      }
273      try {
274        return DISCOVERY.apis().getRest(apiName, apiVersion).execute();
275      } catch (HttpResponseException e) {
276        if (e.getStatusCode() == 404) {
277          error(command, "API not found: " + apiName);
278          return null;
279        }
280        throw e;
281      }
282    }
283    private static void processMethods(
284        ArrayList<MethodDetails> result, String resourceName, Map<String, RestMethod> methodMap) {
285      if (methodMap == null) {
286        return;
287      }
288      for (Map.Entry<String, RestMethod> methodEntry : methodMap.entrySet()) {
289        MethodDetails details = new MethodDetails();
290        String methodName = methodEntry.getKey();
291        RestMethod method = methodEntry.getValue();
292        details.name = (resourceName.isEmpty() ? "" : resourceName + ".") + methodName;
293        details.hasContent =
294            !method.getHttpMethod().equals("GET") && !method.getHttpMethod().equals("DELETE");
295        if (method.getParameterOrder() != null) {
296          for (String parameterName : method.getParameterOrder()) {
297            JsonSchema parameter = method.getParameters().get(parameterName);
298            if (Boolean.TRUE.equals(parameter.getRequired())) {
299              details.requiredParameters.add(parameterName);
300            }
301          }
302        }
303        Map<String, JsonSchema> parameters = method.getParameters();
304        if (parameters != null) {
305          for (Map.Entry<String, JsonSchema> parameterEntry : parameters.entrySet()) {
306            String parameterName = parameterEntry.getKey();
307            JsonSchema parameter = parameterEntry.getValue();
308            if (!Boolean.TRUE.equals(parameter.getRequired())) {
309              details.optionalParameters.add(parameterName);
310            }
311          }
312        }
313        result.add(details);
314      }
315    }
316    private static void processResources(
317        ArrayList<MethodDetails> result, String resourceName, Map<String, RestResource> resourceMap) {
318      if (resourceMap == null) {
319        return;
320      }
321      for (Map.Entry<String, RestResource> entry : resourceMap.entrySet()) {
322        RestResource resource = entry.getValue();
323        String curResourceName = (resourceName.isEmpty() ? "" : resourceName + ".") + entry.getKey();
324        processMethods(result, curResourceName, resource.getMethods());
325        processResources(result, curResourceName, resource.getResources());
326      }
327    }
328    private static void discover(String[] args) throws Exception {
329      httpTransport = GoogleNetHttpTransport.newTrustedTransport();
330      dataStoreFactory = new FileDataStoreFactory(DATA_STORE_DIR);
331      DISCOVERY = new Discovery(httpTransport, JSON_FACTORY, null);
332      System.out.println(APP_NAME);
333      if (args.length == 1) {
334        DirectoryList directoryList = DISCOVERY.apis().list().execute();
335        for (DirectoryList.Items item : directoryList.getItems()) {
336          System.out.println();
337          System.out.print(item.getTitle() + " " + item.getVersion());
338          if (item.getLabels() != null) {
339            System.out.print(" (" + Joiner.on(", ").join(item.getLabels()) + ")");
340          }
341          System.out.println();
342          System.out.println("Description: " + item.getDescription());
343          System.out.println("Methods: google discover " + item.getName() + " " + item.getVersion());
344        }
345        System.out.println();
346        return;
347      }
348      if (args.length == 2) {
349        error("discover", "missing api version");
350      }
351      String apiName = args[1];
352      String apiVersion = args[2];
353      System.out.println();
354      System.out.println("API Name: " + apiName);
355      System.out.println("API Version: " + apiVersion);
356      System.out.println();
357      System.out.println("Methods:");
358      RestDescription restDescription = loadGoogleAPI("discover", apiName, apiVersion);
359      ArrayList<MethodDetails> result = Lists.newArrayList();
360      String resourceName = "";
361      processMethods(result, resourceName, restDescription.getMethods());
362      processResources(result, resourceName, restDescription.getResources());
363      Collections.sort(result);
364      for (MethodDetails methodDetail : result) {
365        System.out.println();
366        System.out.print("google call " + apiName + " " + apiVersion + " " + methodDetail.name);
367        for (String param : methodDetail.requiredParameters) {
368          System.out.print(" <" + param + ">");
369        }
370        if (methodDetail.hasContent) {
371          System.out.print(" contentFile");
372        }
373        if (methodDetail.optionalParameters.isEmpty() && !methodDetail.hasContent) {
374          System.out.println();
375        } else {
376          System.out.println(" [optional parameters...]");
377          System.out.println("  --contentType <value> (default is \"application/json\")");
378          for (String param : methodDetail.optionalParameters) {
379            System.out.println("  --" + param + " <value>");
380          }
381        }
382      }
383    }
384  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-DataServlet.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-DiscoverySample.java</div>
                <div class="column column_space"><pre><code>31      jsonWriter.name("message").value(datastoreUtils.getUserMessage());
32      jsonWriter.name("lastRun").value(datastoreUtils.getUserLastRunMessage());
33      jsonWriter.endObject().close();
34    }
35    private void writeResultsToMotionChartJson(JsonWriter jsonWriter, Iterable<Entity> results)
36        throws IOException {
37      jsonWriter.name("data").beginObject();
</pre></code></div>
                <div class="column column_space"><pre><code>97      System.out.println(APP_NAME);
98      System.out.println();
99      System.out.println("For more help on a specific command, type one of:");
100      System.out.println();
101      System.out.println("  google help call");
102      System.out.println("  google help discover");
103    }
104    private static void error(String command, String detail) {
105      System.err.println("ERROR: " + detail);
106      System.err.println("For help, type: google" + (command == null ? "" : " help " + command));
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    