
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 44.58531431590069%, Tokens: 13</h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RedisJsonV2Test.java</h3>
            <pre><code>1  package redis.clients.jedis.modules.json;
2  import static java.util.Collections.singletonList;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.json.Path2.ROOT_PATH;
5  import static redis.clients.jedis.modules.json.JsonObjects.*;
6  import com.google.gson.Gson;
7  import java.util.Arrays;
8  import java.util.Collections;
9  import java.util.List;
10  import org.hamcrest.MatcherAssert;
11  import org.hamcrest.Matchers;
12  import org.json.JSONArray;
13  import org.json.JSONObject;
14  import org.junit.BeforeClass;
15  import org.junit.Test;
16  import redis.clients.jedis.exceptions.JedisDataException;
17  import redis.clients.jedis.json.JsonSetParams;
18  import redis.clients.jedis.json.Path2;
19  import redis.clients.jedis.modules.RedisModuleCommandsTestBase;
20  public class RedisJsonV2Test extends RedisModuleCommandsTestBase {
21    @BeforeClass
22    public static void prepare() {
23      RedisModuleCommandsTestBase.prepare();
24    }
25    private static final Gson gson = new Gson();
26    @Test
27    public void basicSetGetShouldSucceed() {
28      client.jsonSetWithEscape("null", ROOT_PATH, (Object) null);
29      assertJsonArrayEquals(jsonArray((Object) null), client.jsonGet("null", ROOT_PATH));
30      client.jsonSetWithEscape("str", "strong");
31      assertEquals("strong", client.jsonGet("str"));
32      IRLObject obj = new IRLObject();
33      client.jsonSetWithEscape("obj", obj);
34      Object expected = gson.fromJson(gson.toJson(obj), Object.class);
35      assertTrue(expected.equals(client.jsonGet("obj")));
36      Path2 p = Path2.of(".str");
37      client.jsonSet("obj", p, gson.toJson("strung"));
38      assertJsonArrayEquals(jsonArray("strung"), client.jsonGet("obj", p));
39    }
40    @Test
41    public void setExistingPathOnlyIfExistsShouldSucceed() {
42      client.jsonSetWithEscape("obj", new IRLObject());
43      Path2 p = Path2.of(".str");
44      client.jsonSetWithEscape("obj", p, "strangle", JsonSetParams.jsonSetParams().xx());
45      assertJsonArrayEquals(jsonArray("strangle"), client.jsonGet("obj", p));
46    }
47    @Test
48    public void setNonExistingOnlyIfNotExistsShouldSucceed() {
49      client.jsonSet("obj", gson.toJson(new IRLObject()));
<span onclick='openModal()' class='match'>50      Path2 p = Path2.of(".none");
51      client.jsonSet("obj", p, gson.toJson("strangle"), JsonSetParams.jsonSetParams().nx());
52      assertJsonArrayEquals(jsonArray("strangle"), client.jsonGet("obj", p));
53    }
54    @Test
55    public void setWithoutAPathDefaultsToRootPath() {
56      String objStr = gson.toJson(new IRLObject());
</span>57      client.jsonSet("obj1", new JSONObject(objStr));
58      client.jsonSetWithEscape("obj1", (Object) "strangle", JsonSetParams.jsonSetParams().xx());
59      assertJsonArrayEquals(jsonArray("strangle"), client.jsonGet("obj1", ROOT_PATH));
60    }
61    @Test
62    public void setExistingPathOnlyIfNotExistsShouldFail() {
63      client.jsonSetWithEscape("obj", new IRLObject());
64      Path2 p = Path2.of(".str");
65      assertNull(client.jsonSetWithEscape("obj", p, "strangle", JsonSetParams.jsonSetParams().nx()));
66    }
67    @Test
68    public void setNonExistingPathOnlyIfExistsShouldFail() {
69      client.jsonSetWithEscape("obj", new IRLObject());
70      Path2 p = Path2.of(".none");
71      assertNull(client.jsonSetWithEscape("obj", p, "strangle", JsonSetParams.jsonSetParams().xx()));
72    }
73    @Test(expected = JedisDataException.class)
74    public void setException() {
75      client.jsonSet("test", Path2.of(".foo"), "bar");
76    }
77    @Test
78    public void getMultiplePathsShouldSucceed() {
79      IRLObject obj = new IRLObject();
80      client.jsonSetWithEscape("obj", obj);
81      JSONObject result = (JSONObject) client.jsonGet("obj", Path2.of("bool"), Path2.of("str"));
82      assertJsonArrayEquals(jsonArray(true), result.get("$.bool"));
83      assertJsonArrayEquals(jsonArray("string"), result.get("$.str"));
84    }
85    @Test
86    public void getMultiLevels() {
87      JSONObject obj = new JSONObject();
88      obj.put("foo", "John");
89      JSONObject inner = new JSONObject();
90      inner.put("foo", "Jane");
91      obj.put("bar", inner);
92      client.jsonSet("multi", obj);
93      assertJsonArrayEquals(jsonArray("John", "Jane"), client.jsonGet("multi", new Path2("..foo")));
94    }
95    @Test
96    public void toggle() {
97      IRLObject obj = new IRLObject();
98      client.jsonSetWithEscape("obj", obj);
99      Path2 pbool = Path2.of(".bool");
100      assertJsonArrayEquals(jsonArray(true), client.jsonGet("obj", pbool));
101      client.jsonToggle("obj", pbool);
102      assertJsonArrayEquals(jsonArray(false), client.jsonGet("obj", pbool));
103      client.jsonToggle("obj", pbool);
104      assertJsonArrayEquals(jsonArray(true), client.jsonGet("obj", pbool));
105      Path2 pstr = Path2.of(".str");
106      assertEquals(singletonList(null), client.jsonToggle("obj", pstr));
107      assertJsonArrayEquals(jsonArray("string"), client.jsonGet("obj", pstr));
108    }
109    @Test
110    public void getAbsent() {
111      client.jsonSetWithEscape("test", ROOT_PATH, "foo");
112      assertJsonArrayEquals(jsonArray(), client.jsonGet("test", Path2.of(".bar")));
113    }
114    @Test
115    public void delValidShouldSucceed() {
116      client.jsonSetWithEscape("obj", ROOT_PATH, new IRLObject());
117      assertEquals(1L, client.jsonDel("obj", Path2.of(".str")));
118      assertTrue(client.exists("obj"));
119      assertEquals(1L, client.jsonDel("obj"));
120      assertFalse(client.exists("obj"));
121    }
122    @Test
123    public void delNonExistingPathsAreIgnored() {
124      client.jsonSetWithEscape("foobar", ROOT_PATH, new FooBarObject());
125      assertEquals(0L, client.jsonDel("foobar", Path2.of(".foo[1]")));
126    }
127    @Test
128    public void typeChecksShouldSucceed() {
129      client.jsonSet("foobar", ROOT_PATH, new JSONObject(gson.toJson(new FooBarObject())));
130      assertSame(Object.class, client.jsonType("foobar"));
131      assertEquals(singletonList(Object.class), client.jsonType("foobar", ROOT_PATH));
132      assertEquals(singletonList(String.class), client.jsonType("foobar", Path2.of(".foo")));
133      assertEquals(singletonList(int.class), client.jsonType("foobar", Path2.of(".fooI")));
134      assertEquals(singletonList(float.class), client.jsonType("foobar", Path2.of(".fooF")));
135      assertEquals(singletonList(List.class), client.jsonType("foobar", Path2.of(".fooArr")));
136      assertEquals(singletonList(boolean.class), client.jsonType("foobar", Path2.of(".fooB")));
137      assertEquals(Collections.emptyList(), client.jsonType("foobar", Path2.of(".fooErr")));
138    }
139    @Test
140    public void testJsonMerge() {
141      JSONObject json = new JSONObject("{\"person\":{\"name\":\"John Doe\",\"age\":25,\"address\":{\"home\":\"123 Main Street\"},\"phone\":\"123-456-7890\"}}");
142      assertEquals("OK", client.jsonSet("test_merge", json));
143      json = new JSONObject("{\"person\":{\"name\":\"John Doe\",\"age\":30,\"address\":{\"home\":\"123 Main Street\"},\"phone\":\"123-456-7890\"}}");
144      assertEquals("OK", client.jsonMerge("test_merge", Path2.of("$"), "{\"person\":{\"age\":30}}"));
145      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge", Path2.of("$")));
146      assertEquals("OK", client.jsonMerge("test_merge", Path2.of("$.person.address"), "{\"work\":\"Redis office\"}"));
147      json = new JSONObject("{\"person\":{\"name\":\"John Doe\",\"age\":30,\"address\":{\"home\":\"123 Main Street\",\"work\":\"Redis office\"},\"phone\":\"123-456-7890\"}}");
148      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge", Path2.of("$")));
149      assertEquals("OK", client.jsonMerge("test_merge", Path2.of("$.person"), "{\"age\":null}"));
150      json = new JSONObject("{\"person\":{\"name\":\"John Doe\",\"address\":{\"home\":\"123 Main Street\",\"work\":\"Redis office\"},\"phone\":\"123-456-7890\"}}");
151      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge", Path2.of("$")));
152      assertEquals(1L, client.del("test_merge"));
153    }
154    @Test
155    public void testJsonMergeArray()
156    {
157      JSONObject json = new JSONObject("{\"a\":{\"b\":{\"c\":[\"d\",\"e\"]}}}");
158      assertEquals("OK", (client.jsonSet("test_merge_array", Path2.of("$"), json)));
159      assertEquals("OK", (client.jsonMerge("test_merge_array", Path2.of("$.a.b.c"), "[\"f\"]")));
160      json = new JSONObject("{\"a\":{\"b\":{\"c\":[\"f\"]}}}");
161      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge_array", Path2.of("$")));
162      assertEquals("OK", (client.jsonSet("test_merge_array", Path2.of("$"), "{\"a\":{\"b\":{\"c\":\"d\"}}}")));
163      assertEquals("OK", (client.jsonMerge("test_merge_array", Path2.of("$.a.b.c"), "[\"f\"]")));
164      json = new JSONObject("{\"a\":{\"b\":{\"c\":[\"f\"]}}}");
165      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge_array", Path2.of("$")));
166      assertEquals("OK", (client.jsonSet("test_merge_array", Path2.of("$"), "{\"a\":{\"b\":{\"c\":[\"d\",\"e\"]}}}")));
167      assertEquals("OK", (client.jsonMerge("test_merge_array", Path2.of("$.a.b"), "{\"c\":null}")));
168      json = new JSONObject("{\"a\":{\"b\":{}}}");
169      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge_array", Path2.of("$")));
170    }
171    @Test
172    public void mgetWithPathWithAllKeysExist() {
173      Baz baz1 = new Baz("quuz1", "grault1", "waldo1");
174      Baz baz2 = new Baz("quuz2", "grault2", "waldo2");
175      Qux qux1 = new Qux("quux1", "corge1", "garply1", baz1);
176      Qux qux2 = new Qux("quux2", "corge2", "garply2", baz2);
177      client.jsonSet("qux1", new JSONObject(gson.toJson(qux1)));
178      client.jsonSet("qux2", new JSONObject(gson.toJson(qux2)));
179      List<JSONArray> list = client.jsonMGet(Path2.of("baz"), "qux1", "qux2");
180      assertEquals(2, list.size());
181      assertJsonArrayEquals(jsonArray(new JSONObject(gson.toJson(baz1))), list.get(0));
182      assertJsonArrayEquals(jsonArray(new JSONObject(gson.toJson(baz2))), list.get(1));
183    }
184    @Test
185    public void mgetAtRootPathWithMissingKeys() {
186      Baz baz1 = new Baz("quuz1", "grault1", "waldo1");
187      Baz baz2 = new Baz("quuz2", "grault2", "waldo2");
188      Qux qux1 = new Qux("quux1", "corge1", "garply1", baz1);
189      Qux qux2 = new Qux("quux2", "corge2", "garply2", baz2);
190      client.jsonSetWithEscape("qux1", qux1);
191      client.jsonSetWithEscape("qux2", qux2);
192      List<JSONArray> list = client.jsonMGet("qux1", "qux2", "qux3");
193      assertEquals(3, list.size());
194      assertNull(list.get(2));
195      list.removeAll(singletonList(null));
196      assertEquals(2, list.size());
197    }
198    @Test
199    public void arrLen() {
200      client.jsonSet("arr", ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
201      assertEquals(singletonList(5L), client.jsonArrLen("arr", ROOT_PATH));
202    }
203    @Test
204    public void clearArray() {
205      client.jsonSet("foobar", ROOT_PATH, gson.toJson(new FooBarObject()));
206      Path2 arrPath = Path2.of(".fooArr");
207      assertEquals(singletonList(3L), client.jsonArrLen("foobar", arrPath));
208      assertEquals(1L, client.jsonClear("foobar", arrPath));
209      assertEquals(singletonList(0L), client.jsonArrLen("foobar", arrPath));
210      Path2 strPath = Path2.of(".foo");
211      assertEquals(0L, client.jsonClear("foobar", strPath));
212      assertJsonArrayEquals(jsonArray("bar"), client.jsonGet("foobar", strPath));
213    }
214    @Test
215    public void clearObject() {
216      Baz baz = new Baz("quuz", "grault", "waldo");
217      Qux qux = new Qux("quux", "corge", "garply", baz);
218      client.jsonSet("qux", gson.toJson(qux));
219      Path2 objPath = Path2.of(".baz");
220      assertEquals(1L, client.jsonClear("qux", objPath));
221      assertJsonArrayEquals(jsonArray(new JSONObject()), client.jsonGet("qux", objPath));
222    }
223    @Test
224    public void arrAppendSameType() {
225      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: ['ello'] }}";
226      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
227      assertEquals(singletonList(6L), client.jsonArrAppend("test_arrappend", Path2.of(".b"), 4, 5, 6));
228      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3, 4, 5, 6)), client.jsonGet("test_arrappend", Path2.of(".b")));
229    }
230    @Test
231    public void arrAppendMultipleTypes() {
232      Object fooObject = gson.toJson("foo");
233      Object trueObject = gson.toJson(true);
234      Object nullObject = gson.toJson(null);
235      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: ['ello'] }}";
236      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
237      assertEquals(singletonList(6L), client.jsonArrAppend("test_arrappend", Path2.of(".b"), fooObject, trueObject, nullObject));
238      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3, "foo", true, null)), client.jsonGet("test_arrappend", Path2.of(".b")));
239    }
240    @Test
241    public void arrAppendMultipleTypesWithDeepPath() {
242      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: ['ello'] }}";
243      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
244      assertEquals(singletonList(4L), client.jsonArrAppendWithEscape("test_arrappend", Path2.of(".c.d"), "foo", true, null));
245      assertJsonArrayEquals(jsonArray(jsonArray("ello", "foo", true, null)), client.jsonGet("test_arrappend", Path2.of(".c.d")));
246    }
247    @Test
248    public void arrAppendAgaintsEmptyArray() {
249      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: [] }}";
250      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
251      assertEquals(singletonList(3L), client.jsonArrAppendWithEscape("test_arrappend", Path2.of(".c.d"), "a", "b", "c"));
252      assertJsonArrayEquals(jsonArray(jsonArray("a", "b", "c")), client.jsonGet("test_arrappend", Path2.of(".c.d")));
253    }
254    @Test
255    public void arrAppendPathIsNotArray() {
256      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: ['ello'] }}";
257      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
258      assertEquals(singletonList(null), client.jsonArrAppend("test_arrappend", Path2.of(".a"), 1));
259      assertEquals(singletonList(null), client.jsonArrAppend("test_arrappend", Path2.of(".a"), gson.toJson(1)));
260      assertEquals(singletonList(null), client.jsonArrAppendWithEscape("test_arrappend", Path2.of(".a"), 1));
261    }
262    @Test(expected = JedisDataException.class)
263    public void arrIndexAbsentKey() {
264      client.jsonArrIndexWithEscape("quxquux", ROOT_PATH, new JSONObject());
265    }
266    @Test
267    public void arrIndexWithInts() {
268      client.jsonSetWithEscape("quxquux", ROOT_PATH, new int[]{8, 6, 7, 5, 3, 0, 9});
269      assertEquals(singletonList(2L), client.jsonArrIndexWithEscape("quxquux", ROOT_PATH, 7));
270      assertEquals(singletonList(-1L), client.jsonArrIndexWithEscape("quxquux", ROOT_PATH, "7"));
271    }
272    @Test
273    public void arrIndexWithStrings() {
274      client.jsonSetWithEscape("quxquux", ROOT_PATH, new String[]{"8", "6", "7", "5", "3", "0", "9"});
275      assertEquals(singletonList(2L), client.jsonArrIndexWithEscape("quxquux", ROOT_PATH, "7"));
276    }
277    @Test
278    public void arrIndexWithStringsAndPath() {
279      client.jsonSetWithEscape("foobar", ROOT_PATH, new FooBarObject());
280      assertEquals(singletonList(1L), client.jsonArrIndexWithEscape("foobar", Path2.of(".fooArr"), "b"));
281    }
282    @Test
283    public void arrIndexNonExistentPath() {
284      client.jsonSet("foobar", ROOT_PATH, gson.toJson(new FooBarObject()));
285      assertEquals(Collections.emptyList(), client.jsonArrIndex("foobar", Path2.of(".barArr"), gson.toJson("x")));
286    }
287    @Test
288    public void arrInsert() {
289      String json = "['hello', 'world', true, 1, 3, null, false]";
290      client.jsonSet("test_arrinsert", ROOT_PATH, new JSONArray(json));
291      assertEquals(singletonList(8L), client.jsonArrInsertWithEscape("test_arrinsert", ROOT_PATH, 1, "foo"));
292      assertJsonArrayEquals(jsonArray(jsonArray("hello", "foo", "world", true, 1, 3, null, false)),
293          client.jsonGet("test_arrinsert", ROOT_PATH));
294    }
295    @Test
296    public void arrInsertWithNegativeIndex() {
297      String json = "['hello', 'world', true, 1, 3, null, false]";
298      client.jsonSet("test_arrinsert", ROOT_PATH, new JSONArray(json));
299      assertEquals(singletonList(8L), client.jsonArrInsertWithEscape("test_arrinsert", ROOT_PATH, -1, "foo"));
300      assertJsonArrayEquals(jsonArray(jsonArray("hello", "world", true, 1, 3, null, "foo", false)),
301          client.jsonGet("test_arrinsert", ROOT_PATH));
302    }
303    @Test
304    public void arrPop() {
305      client.jsonSet("arr", ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
306      assertEquals(singletonList(4d), client.jsonArrPop("arr", ROOT_PATH));
307      assertEquals(singletonList(3d), client.jsonArrPop("arr", ROOT_PATH, -1));
308      assertEquals(singletonList(0d), client.jsonArrPop("arr", ROOT_PATH, 0));
309    }
310    @Test
311    public void arrTrim() {
312      client.jsonSet("arr", ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
313      assertEquals(singletonList(3L), client.jsonArrTrim("arr", ROOT_PATH, 1, 3));
314      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3)), client.jsonGet("arr", ROOT_PATH));
315    }
316    @Test
317    public void strAppend() {
318      client.jsonSet("str", ROOT_PATH, gson.toJson("foo"));
319      assertEquals(singletonList(6L), client.jsonStrAppend("str", ROOT_PATH, "bar"));
320      assertEquals("foobar", client.jsonGet("str"));
321    }
322    @Test
323    public void strLen() {
324      client.jsonSetWithEscape("str", "foobar");
325      assertEquals(singletonList(6L), client.jsonStrLen("str", ROOT_PATH));
326    }
327    @Test
328    public void numIncrBy() {
329      client.jsonSet("doc", "{\"a\":\"b\",\"b\":[{\"a\":2}, {\"a\":5}, {\"a\":\"c\"}]}");
330      assertJsonArrayEquals(jsonArray((Object) null), client.jsonNumIncrBy("doc", Path2.of(".a"), 1d));
331      assertJsonArrayEquals(jsonArray(null, 4, 7, null), client.jsonNumIncrBy("doc", Path2.of("..a"), 2d));
332      assertJsonArrayEquals(jsonArray((Object) null), client.jsonNumIncrBy("doc", Path2.of("..b"), 0d));
333      assertJsonArrayEquals(jsonArray(), client.jsonNumIncrBy("doc", Path2.of("..c"), 0d));
334    }
335    @Test
336    public void obj() {
337      String json = "{\"a\":[3], \"nested\": {\"a\": {\"b\":2, \"c\": 1}}}";
338      client.jsonSet("doc", ROOT_PATH, json);
339      assertEquals(Arrays.asList(2L), client.jsonObjLen("doc", ROOT_PATH));
340      assertEquals(Arrays.asList(Arrays.asList("a", "nested")), client.jsonObjKeys("doc", ROOT_PATH));
341      assertEquals(Arrays.asList(null, 2L), client.jsonObjLen("doc", Path2.of("..a")));
342      assertEquals(Arrays.asList(null, Arrays.asList("b", "c")), client.jsonObjKeys("doc", Path2.of("..a")));
343    }
344    @Test
345    public void debugMemory() {
346      assertEquals(Collections.emptyList(), client.jsonDebugMemory("json", ROOT_PATH));
347      client.jsonSet("json", new JSONObject("{ foo: 'bar', bar: { foo: 10 }}"));
348      client.jsonDebugMemory("json");
349      assertEquals(1, client.jsonDebugMemory("json", ROOT_PATH).size());
350      assertEquals(2, client.jsonDebugMemory("json", Path2.of("$..foo")).size());
351      assertEquals(1, client.jsonDebugMemory("json", Path2.of("$..bar")).size());
352    }
353    @Test
354    public void resp() {
355      assertNull(client.jsonResp("resp", ROOT_PATH));
356      String json = "{\"foo\": {\"hello\":\"world\"}, \"bar\": [null, 3, 2.5, true]}";
357      client.jsonSet("resp", ROOT_PATH, json);
358      List<List<Object>> fullResp = client.jsonResp("resp", ROOT_PATH);
359      assertEquals(1, fullResp.size());
360      List<Object> resp = fullResp.get(0);
361      assertEquals("{", resp.get(0));
362      assertEquals("foo", resp.get(1));
363      assertEquals(Arrays.asList("{", "hello", "world"), resp.get(2));
364      assertEquals("bar", resp.get(3));
365      List<Object> arr = (List<Object>) resp.get(4);
366      assertEquals("[", arr.get(0));
367      assertNull(arr.get(1));
368      assertEquals(Long.valueOf(3), arr.get(2));
369      MatcherAssert.assertThat(arr.get(3), Matchers.isOneOf("2.5", 2.5));
370      assertEquals("true", arr.get(4));
371    }
372    private void assertJsonArrayEquals(JSONArray a, Object _b) {
373      if (!(_b instanceof JSONArray)) {
374        fail("Actual value is not JSONArray.");
375      }
376      JSONArray b = (JSONArray) _b;
377      assertEquals("JSONArray length mismatch", a.length(), b.length());
378      int length = a.length();
379      for (int index = 0; index < length; index++) {
380        if (a.isNull(index)) {
381          assertTrue(index + "'th element is not null", b.isNull(index));
382          continue;
383        }
384        Object ia = a.get(index);
385        Object ib = b.get(index);
386        if (ia instanceof JSONArray) {
387          assertJsonArrayEquals((JSONArray) ia, ib);
388        } else if (ia instanceof JSONObject) {
389          assertJsonObjectEquals((JSONObject) ia, ib);
390        } else if (ia instanceof Number && ib instanceof Number) {
391          assertEquals(index + "'th element mismatch", ((Number) ia).doubleValue(), ((Number) ib).doubleValue(), 0d);
392        } else {
393          assertEquals(index + "'th element mismatch", ia, ib);
394        }
395      }
396    }
397    private void assertJsonObjectEquals(JSONObject a, Object _b) {
398      if (!(_b instanceof JSONObject)) {
399        fail("Actual value is not JSONObject.");
400      }
401      JSONObject b = (JSONObject) _b;
402      assertEquals("JSONObject length mismatch", a.length(), b.length());
403      assertEquals(a.keySet(), b.keySet());
404      for (String key : a.keySet()) {
405        if (a.isNull(key)) {
406          assertTrue(key + "'s value is not null", b.isNull(key));
407          continue;
408        }
409        Object oa = a.get(key);
410        Object ob = b.get(key);
411        if (oa instanceof JSONArray) {
412          assertJsonArrayEquals((JSONArray) oa, ob);
413        } else if (oa instanceof JSONObject) {
414          assertJsonObjectEquals((JSONObject) oa, ob);
415        } else {
416          assertEquals(key + "'s value mismatch", oa, ob);
417        }
418      }
419    }
420    private static JSONArray jsonArray(Object... objects) {
421      JSONArray arr = new JSONArray();
422      for (Object o : objects) {
423        arr.put(o);
424      }
425      return arr;
426    }
427  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ListCommandsTestBase.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.unified;
2  import static org.junit.Assert.assertArrayEquals;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertNotNull;
5  import static org.junit.Assert.assertNull;
6  import static org.junit.Assert.assertTrue;
7  import static org.junit.Assert.fail;
8  import static redis.clients.jedis.util.AssertUtil.assertByteArrayListEquals;
9  import java.util.ArrayList;
10  import java.util.Arrays;
11  import java.util.Collections;
12  import java.util.List;
13  import org.junit.Test;
14  import org.slf4j.Logger;
15  import org.slf4j.LoggerFactory;
16  import redis.clients.jedis.args.ListPosition;
17  import redis.clients.jedis.args.ListDirection;
18  import redis.clients.jedis.exceptions.JedisDataException;
19  import redis.clients.jedis.params.LPosParams;
20  import redis.clients.jedis.util.KeyValue;
21  public abstract class ListCommandsTestBase extends UnifiedJedisCommandsTestBase {
22    private final Logger logger = LoggerFactory.getLogger(getClass());
23    protected final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
24    protected final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x05 };
25    protected final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
26    protected final byte[] bcar = { 0x09, 0x0A, 0x0B, 0x0C };
27    protected final byte[] bA = { 0x0A };
28    protected final byte[] bB = { 0x0B };
29    protected final byte[] bC = { 0x0C };
30    protected final byte[] b1 = { 0x01 };
31    protected final byte[] b2 = { 0x02 };
32    protected final byte[] b3 = { 0x03 };
33    protected final byte[] bhello = { 0x04, 0x02 };
34    protected final byte[] bx = { 0x02, 0x04 };
35    protected final byte[] bdst = { 0x11, 0x12, 0x13, 0x14 };
36    @Test
37    public void rpush() {
38      assertEquals(1, jedis.rpush("foo", "bar"));
39      assertEquals(2, jedis.rpush("foo", "foo"));
40      assertEquals(4, jedis.rpush("foo", "bar", "foo"));
41      assertEquals(1, jedis.rpush(bfoo, bbar));
42      assertEquals(2, jedis.rpush(bfoo, bfoo));
43      assertEquals(4, jedis.rpush(bfoo, bbar, bfoo));
44    }
45    @Test
46    public void lpush() {
47      assertEquals(1, jedis.lpush("foo", "bar"));
48      assertEquals(2, jedis.lpush("foo", "foo"));
49      assertEquals(4, jedis.lpush("foo", "bar", "foo"));
50      assertEquals(1, jedis.lpush(bfoo, bbar));
51      assertEquals(2, jedis.lpush(bfoo, bfoo));
52      assertEquals(4, jedis.lpush(bfoo, bbar, bfoo));
53    }
54    @Test
55    public void llen() {
56      assertEquals(0, jedis.llen("foo"));
57      jedis.lpush("foo", "bar");
58      jedis.lpush("foo", "car");
59      assertEquals(2, jedis.llen("foo"));
60      assertEquals(0, jedis.llen(bfoo));
61      jedis.lpush(bfoo, bbar);
62      jedis.lpush(bfoo, bcar);
63      assertEquals(2, jedis.llen(bfoo));
64    }
65    @Test
66    public void llenNotOnList() {
67      try {
68        jedis.set("foo", "bar");
69        jedis.llen("foo");
70        fail("JedisDataException expected");
71      } catch (final JedisDataException e) {
72      }
73      try {
74        jedis.set(bfoo, bbar);
75        jedis.llen(bfoo);
76        fail("JedisDataException expected");
77      } catch (final JedisDataException e) {
78      }
79    }
80    @Test
81    public void lrange() {
82      jedis.rpush("foo", "a");
83      jedis.rpush("foo", "b");
84      jedis.rpush("foo", "c");
85      List<String> expected = new ArrayList<String>();
86      expected.add("a");
87      expected.add("b");
88      expected.add("c");
89      List<String> range = jedis.lrange("foo", 0, 2);
90      assertEquals(expected, range);
91      range = jedis.lrange("foo", 0, 20);
92      assertEquals(expected, range);
93      expected = new ArrayList<String>();
94      expected.add("b");
95      expected.add("c");
96      range = jedis.lrange("foo", 1, 2);
97      assertEquals(expected, range);
98      range = jedis.lrange("foo", 2, 1);
99      assertEquals(Collections.<String> emptyList(), range);
100      jedis.rpush(bfoo, bA);
101      jedis.rpush(bfoo, bB);
102      jedis.rpush(bfoo, bC);
103      List<byte[]> bexpected = new ArrayList<byte[]>();
104      bexpected.add(bA);
105      bexpected.add(bB);
106      bexpected.add(bC);
107      List<byte[]> brange = jedis.lrange(bfoo, 0, 2);
108      assertByteArrayListEquals(bexpected, brange);
109      brange = jedis.lrange(bfoo, 0, 20);
110      assertByteArrayListEquals(bexpected, brange);
111      bexpected = new ArrayList<byte[]>();
112      bexpected.add(bB);
113      bexpected.add(bC);
114      brange = jedis.lrange(bfoo, 1, 2);
115      assertByteArrayListEquals(bexpected, brange);
116      brange = jedis.lrange(bfoo, 2, 1);
117      assertByteArrayListEquals(Collections.<byte[]> emptyList(), brange);
118    }
119    @Test
120    public void ltrim() {
121      jedis.lpush("foo", "1");
122      jedis.lpush("foo", "2");
123      jedis.lpush("foo", "3");
124      String status = jedis.ltrim("foo", 0, 1);
125      List<String> expected = new ArrayList<String>();
126      expected.add("3");
127      expected.add("2");
128      assertEquals("OK", status);
129      assertEquals(2, jedis.llen("foo"));
130      assertEquals(expected, jedis.lrange("foo", 0, 100));
131      jedis.lpush(bfoo, b1);
132      jedis.lpush(bfoo, b2);
133      jedis.lpush(bfoo, b3);
134      String bstatus = jedis.ltrim(bfoo, 0, 1);
135      List<byte[]> bexpected = new ArrayList<byte[]>();
136      bexpected.add(b3);
137      bexpected.add(b2);
138      assertEquals("OK", bstatus);
139      assertEquals(2, jedis.llen(bfoo));
140      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
141    }
142    @Test
143    public void lset() {
144      jedis.lpush("foo", "1");
145      jedis.lpush("foo", "2");
146      jedis.lpush("foo", "3");
147      List<String> expected = new ArrayList<String>();
148      expected.add("3");
149      expected.add("bar");
150      expected.add("1");
151      String status = jedis.lset("foo", 1, "bar");
152      assertEquals("OK", status);
153      assertEquals(expected, jedis.lrange("foo", 0, 100));
154      jedis.lpush(bfoo, b1);
155      jedis.lpush(bfoo, b2);
156      jedis.lpush(bfoo, b3);
157      List<byte[]> bexpected = new ArrayList<byte[]>();
158      bexpected.add(b3);
159      bexpected.add(bbar);
160      bexpected.add(b1);
161      String bstatus = jedis.lset(bfoo, 1, bbar);
162      assertEquals("OK", bstatus);
163      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
164    }
165    @Test
166    public void lindex() {
167      jedis.lpush("foo", "1");
168      jedis.lpush("foo", "2");
169      jedis.lpush("foo", "3");
170      assertEquals("3", jedis.lindex("foo", 0));
171      assertNull(jedis.lindex("foo", 100));
172      jedis.lpush(bfoo, b1);
173      jedis.lpush(bfoo, b2);
174      jedis.lpush(bfoo, b3);
175      assertArrayEquals(b3, jedis.lindex(bfoo, 0));
176      assertNull(jedis.lindex(bfoo, 100));
177    }
178    @Test
179    public void lrem() {
180      jedis.lpush("foo", "hello");
181      jedis.lpush("foo", "hello");
182      jedis.lpush("foo", "x");
183      jedis.lpush("foo", "hello");
184      jedis.lpush("foo", "c");
185      jedis.lpush("foo", "b");
186      jedis.lpush("foo", "a");
187      List<String> expected = new ArrayList<String>();
188      expected.add("a");
189      expected.add("b");
190      expected.add("c");
191      expected.add("hello");
192      expected.add("x");
193      assertEquals(2, jedis.lrem("foo", -2, "hello"));
194      assertEquals(expected, jedis.lrange("foo", 0, 1000));
195      assertEquals(0, jedis.lrem("bar", 100, "foo"));
196      jedis.lpush(bfoo, bhello);
197      jedis.lpush(bfoo, bhello);
198      jedis.lpush(bfoo, bx);
199      jedis.lpush(bfoo, bhello);
200      jedis.lpush(bfoo, bC);
201      jedis.lpush(bfoo, bB);
202      jedis.lpush(bfoo, bA);
203      List<byte[]> bexpected = new ArrayList<byte[]>();
204      bexpected.add(bA);
205      bexpected.add(bB);
206      bexpected.add(bC);
207      bexpected.add(bhello);
208      bexpected.add(bx);
209      assertEquals(2, jedis.lrem(bfoo, -2, bhello));
210      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 1000));
211      assertEquals(0, jedis.lrem(bbar, 100, bfoo));
212    }
213    @Test
214    public void lpop() {
215      assertNull(jedis.lpop("foo"));
216      assertNull(jedis.lpop("foo", 0));
217      jedis.rpush("foo", "a");
218      jedis.rpush("foo", "b");
219      jedis.rpush("foo", "c");
220      assertEquals("a", jedis.lpop("foo"));
221      assertEquals(Arrays.asList("b", "c"), jedis.lpop("foo", 10));
222      assertNull(jedis.lpop("foo"));
223      assertNull(jedis.lpop("foo", 1));
224      assertNull(jedis.lpop(bfoo));
225      assertNull(jedis.lpop(bfoo, 0));
226      jedis.rpush(bfoo, bA);
227      jedis.rpush(bfoo, bB);
228      jedis.rpush(bfoo, bC);
229      assertArrayEquals(bA, jedis.lpop(bfoo));
230      assertByteArrayListEquals(Arrays.asList(bB, bC), jedis.lpop(bfoo, 10));
231      assertNull(jedis.lpop(bfoo));
232      assertNull(jedis.lpop(bfoo, 1));
233    }
234    @Test
235    public void rpop() {
236      assertNull(jedis.rpop("foo"));
237      assertNull(jedis.rpop("foo", 0));
238      jedis.rpush("foo", "a");
239      jedis.rpush("foo", "b");
240      jedis.rpush("foo", "c");
241      assertEquals("c", jedis.rpop("foo"));
242      assertEquals(Arrays.asList("b", "a"), jedis.rpop("foo", 10));
243      assertNull(jedis.rpop("foo"));
244      assertNull(jedis.rpop("foo", 1));
245      assertNull(jedis.rpop(bfoo));
246      assertNull(jedis.rpop(bfoo, 0));
247      jedis.rpush(bfoo, bA);
248      jedis.rpush(bfoo, bB);
249      jedis.rpush(bfoo, bC);
250      assertArrayEquals(bC, jedis.rpop(bfoo));
251      assertByteArrayListEquals(Arrays.asList(bB, bA), jedis.rpop(bfoo, 10));
252      assertNull(jedis.rpop(bfoo));
253      assertNull(jedis.rpop(bfoo, 1));
254    }
255    @Test
256    public void rpoplpush() {
257      jedis.rpush("foo", "a");
258      jedis.rpush("foo", "b");
259      jedis.rpush("foo", "c");
260      jedis.rpush("dst", "foo");
261      jedis.rpush("dst", "bar");
262      String element = jedis.rpoplpush("foo", "dst");
263      assertEquals("c", element);
264      List<String> srcExpected = new ArrayList<String>();
265      srcExpected.add("a");
266      srcExpected.add("b");
267      List<String> dstExpected = new ArrayList<String>();
268      dstExpected.add("c");
269      dstExpected.add("foo");
270      dstExpected.add("bar");
271      assertEquals(srcExpected, jedis.lrange("foo", 0, 1000));
272      assertEquals(dstExpected, jedis.lrange("dst", 0, 1000));
273      jedis.rpush(bfoo, bA);
274      jedis.rpush(bfoo, bB);
275      jedis.rpush(bfoo, bC);
276      jedis.rpush(bdst, bfoo);
277      jedis.rpush(bdst, bbar);
278      byte[] belement = jedis.rpoplpush(bfoo, bdst);
279      assertArrayEquals(bC, belement);
280      List<byte[]> bsrcExpected = new ArrayList<byte[]>();
281      bsrcExpected.add(bA);
282      bsrcExpected.add(bB);
283      List<byte[]> bdstExpected = new ArrayList<byte[]>();
284      bdstExpected.add(bC);
285      bdstExpected.add(bfoo);
286      bdstExpected.add(bbar);
287      assertByteArrayListEquals(bsrcExpected, jedis.lrange(bfoo, 0, 1000));
288      assertByteArrayListEquals(bdstExpected, jedis.lrange(bdst, 0, 1000));
289    }
290    @Test
291    public void blpop() throws InterruptedException {
292      List<String> result = jedis.blpop(1, "foo");
293      assertNull(result);
294      jedis.lpush("foo", "bar");
295      result = jedis.blpop(1, "foo");
296      assertNotNull(result);
297      assertEquals(2, result.size());
298      assertEquals("foo", result.get(0));
299      assertEquals("bar", result.get(1));
300      result = jedis.blpop(1, "foo", "foo1");
301      assertNull(result);
302      jedis.lpush("foo", "bar");
303      jedis.lpush("foo1", "bar1");
304      result = jedis.blpop(1, "foo1", "foo");
305      assertNotNull(result);
306      assertEquals(2, result.size());
307      assertEquals("foo1", result.get(0));
308      assertEquals("bar1", result.get(1));
309      jedis.lpush(bfoo, bbar);
310      List<byte[]> bresult = jedis.blpop(1, bfoo);
311      assertNotNull(bresult);
312      assertEquals(2, bresult.size());
313      assertArrayEquals(bfoo, bresult.get(0));
314      assertArrayEquals(bbar, bresult.get(1));
315      bresult = jedis.blpop(1, bfoo, bfoo1);
316      assertNull(bresult);
317      jedis.lpush(bfoo, bbar);
318      jedis.lpush(bfoo1, bcar);
<span onclick='openModal()' class='match'>319      bresult = jedis.blpop(1, bfoo, bfoo1);
320      assertNotNull(bresult);
321      assertEquals(2, bresult.size());
322      assertArrayEquals(bfoo, bresult.get(0));
323      assertArrayEquals(bbar, bresult.get(1));
324    }
325    @Test
326    public void blpopDouble() throws InterruptedException {
327      KeyValue<String, String> result = jedis.blpop(0.1, "foo");
</span>328      assertNull(result);
329      jedis.lpush("foo", "bar");
330      result = jedis.blpop(3.2, "foo");
331      assertNotNull(result);
332      assertEquals("foo", result.getKey());
333      assertEquals("bar", result.getValue());
334      result = jedis.blpop(0.18, "foo", "foo1");
335      assertNull(result);
336      jedis.lpush("foo", "bar");
337      jedis.lpush("foo1", "bar1");
338      result = jedis.blpop(1d, "foo1", "foo");
339      assertNotNull(result);
340      assertEquals("foo1", result.getKey());
341      assertEquals("bar1", result.getValue());
342      jedis.lpush(bfoo, bbar);
343      KeyValue<byte[], byte[]> bresult = jedis.blpop(3.12, bfoo);
344      assertNotNull(bresult);
345      assertArrayEquals(bfoo, bresult.getKey());
346      assertArrayEquals(bbar, bresult.getValue());
347      bresult = jedis.blpop(0.11, bfoo, bfoo1);
348      assertNull(bresult);
349      jedis.lpush(bfoo, bbar);
350      jedis.lpush(bfoo1, bcar);
351      bresult = jedis.blpop(1d, bfoo, bfoo1);
352      assertNotNull(bresult);
353      assertArrayEquals(bfoo, bresult.getKey());
354      assertArrayEquals(bbar, bresult.getValue());
355    }
356    @Test
357    public void blpopDoubleWithSleep() {
358      long startMillis, totalMillis;
359      startMillis = System.currentTimeMillis();
360      KeyValue<String, String> result = jedis.blpop(0.04, "foo");
361      totalMillis = System.currentTimeMillis() - startMillis;
362      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
363      assertNull(result);
364      startMillis = System.currentTimeMillis();
365      new Thread(() -> {
366        try {
367          Thread.sleep(30);
368        } catch(InterruptedException e) {
369          logger.error("", e);
370        }
371        jedis.lpush("foo", "bar");
372      }).start();
373      result = jedis.blpop(1.2, "foo");
374      totalMillis = System.currentTimeMillis() - startMillis;
375      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
376      assertNotNull(result);
377      assertEquals("foo", result.getKey());
378      assertEquals("bar", result.getValue());
379    }
380    @Test
381    public void brpop() throws InterruptedException {
382      List<String> result = jedis.brpop(1, "foo");
383      assertNull(result);
384      jedis.lpush("foo", "bar");
385      result = jedis.brpop(1, "foo");
386      assertNotNull(result);
387      assertEquals(2, result.size());
388      assertEquals("foo", result.get(0));
389      assertEquals("bar", result.get(1));
390      result = jedis.brpop(1, "foo", "foo1");
391      assertNull(result);
392      jedis.lpush("foo", "bar");
393      jedis.lpush("foo1", "bar1");
394      result = jedis.brpop(1, "foo1", "foo");
395      assertNotNull(result);
396      assertEquals(2, result.size());
397      assertEquals("foo1", result.get(0));
398      assertEquals("bar1", result.get(1));
399      jedis.lpush(bfoo, bbar);
400      List<byte[]> bresult = jedis.brpop(1, bfoo);
401      assertNotNull(bresult);
402      assertEquals(2, bresult.size());
403      assertArrayEquals(bfoo, bresult.get(0));
404      assertArrayEquals(bbar, bresult.get(1));
405      bresult = jedis.brpop(1, bfoo, bfoo1);
406      assertNull(bresult);
407      jedis.lpush(bfoo, bbar);
408      jedis.lpush(bfoo1, bcar);
409      bresult = jedis.brpop(1, bfoo, bfoo1);
410      assertNotNull(bresult);
411      assertEquals(2, bresult.size());
412      assertArrayEquals(bfoo, bresult.get(0));
413      assertArrayEquals(bbar, bresult.get(1));
414    }
415    @Test
416    public void brpopDouble() throws InterruptedException {
417      KeyValue<String, String> result = jedis.brpop(0.1, "foo");
418      assertNull(result);
419      jedis.lpush("foo", "bar");
420      result = jedis.brpop(3.2, "foo");
421      assertNotNull(result);
422      assertEquals("foo", result.getKey());
423      assertEquals("bar", result.getValue());
424      result = jedis.brpop(0.18, "foo", "foo1");
425      assertNull(result);
426      jedis.lpush("foo", "bar");
427      jedis.lpush("foo1", "bar1");
428      result = jedis.brpop(1d, "foo1", "foo");
429      assertNotNull(result);
430      assertEquals("foo1", result.getKey());
431      assertEquals("bar1", result.getValue());
432      jedis.lpush(bfoo, bbar);
433      KeyValue<byte[], byte[]> bresult = jedis.brpop(3.12, bfoo);
434      assertNotNull(bresult);
435      assertArrayEquals(bfoo, bresult.getKey());
436      assertArrayEquals(bbar, bresult.getValue());
437      bresult = jedis.brpop(0.11, bfoo, bfoo1);
438      assertNull(bresult);
439      jedis.lpush(bfoo, bbar);
440      jedis.lpush(bfoo1, bcar);
441      bresult = jedis.brpop(1d, bfoo, bfoo1);
442      assertNotNull(bresult);
443      assertArrayEquals(bfoo, bresult.getKey());
444      assertArrayEquals(bbar, bresult.getValue());
445    }
446    @Test
447    public void brpopDoubleWithSleep() {
448      long startMillis, totalMillis;
449      startMillis = System.currentTimeMillis();
450      KeyValue<String, String> result = jedis.brpop(0.04, "foo");
451      totalMillis = System.currentTimeMillis() - startMillis;
452      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
453      assertNull(result);
454      startMillis = System.currentTimeMillis();
455      new Thread(() -> {
456        try {
457          Thread.sleep(30);
458        } catch(InterruptedException e) {
459          logger.error("", e);
460        }
461        jedis.lpush("foo", "bar");
462      }).start();
463      result = jedis.brpop(1.2, "foo");
464      totalMillis = System.currentTimeMillis() - startMillis;
465      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
466      assertNotNull(result);
467      assertEquals("foo", result.getKey());
468      assertEquals("bar", result.getValue());
469    }
470    @Test
471    public void lpushx() {
472      assertEquals(0, jedis.lpushx("foo", "bar"));
473      jedis.lpush("foo", "a");
474      assertEquals(2, jedis.lpushx("foo", "b"));
475      assertEquals(0, jedis.lpushx(bfoo, bbar));
476      jedis.lpush(bfoo, bA);
477      assertEquals(2, jedis.lpushx(bfoo, bB));
478    }
479    @Test
480    public void rpushx() {
481      assertEquals(0, jedis.rpushx("foo", "bar"));
482      jedis.lpush("foo", "a");
483      assertEquals(2, jedis.rpushx("foo", "b"));
484      assertEquals(0, jedis.rpushx(bfoo, bbar));
485      jedis.lpush(bfoo, bA);
486      assertEquals(2, jedis.rpushx(bfoo, bB));
487    }
488    @Test
489    public void linsert() {
490      assertEquals(0, jedis.linsert("foo", ListPosition.BEFORE, "bar", "car"));
491      jedis.lpush("foo", "a");
492      assertEquals(2, jedis.linsert("foo", ListPosition.AFTER, "a", "b"));
493      List<String> expected = new ArrayList<String>();
494      expected.add("a");
495      expected.add("b");
496      assertEquals(expected, jedis.lrange("foo", 0, 100));
497      assertEquals(-1, jedis.linsert("foo", ListPosition.BEFORE, "bar", "car"));
498      assertEquals(0, jedis.linsert(bfoo, ListPosition.BEFORE, bbar, bcar));
499      jedis.lpush(bfoo, bA);
500      assertEquals(2, jedis.linsert(bfoo, ListPosition.AFTER, bA, bB));
501      List<byte[]> bexpected = new ArrayList<byte[]>();
502      bexpected.add(bA);
503      bexpected.add(bB);
504      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
505      assertEquals(-1, jedis.linsert(bfoo, ListPosition.BEFORE, bbar, bcar));
506    }
507    @Test
508    public void brpoplpush() {
509      new Thread(new Runnable() {
510        @Override
511        public void run() {
512          try {
513            Thread.sleep(100);
514          } catch (InterruptedException e) {
515            logger.error("", e);
516          }
517          jedis.lpush("foo", "a");
518        }
519      }).start();
520      String element = jedis.brpoplpush("foo", "bar", 0);
521      assertEquals("a", element);
522      assertEquals(1, jedis.llen("bar"));
523      assertEquals("a", jedis.lrange("bar", 0, -1).get(0));
524      new Thread(new Runnable() {
525        @Override
526        public void run() {
527          try {
528            Thread.sleep(100);
529          } catch (InterruptedException e) {
530            logger.error("", e);
531          }
532          jedis.lpush(bfoo, bA);
533        }
534      }).start();
535      byte[] belement = jedis.brpoplpush(bfoo, bbar, 0);
536      assertArrayEquals(bA, belement);
537      assertEquals(1, jedis.llen("bar"));
538      assertArrayEquals(bA, jedis.lrange(bbar, 0, -1).get(0));
539    }
540    @Test
541    public void lpos() {
542      jedis.rpush("foo", "a");
543      jedis.rpush("foo", "b");
544      jedis.rpush("foo", "c");
545      Long pos = jedis.lpos("foo", "b");
546      assertEquals(1, pos.intValue());
547      pos = jedis.lpos("foo", "d");
548      assertNull(pos);
549      jedis.rpush("foo", "a");
550      jedis.rpush("foo", "b");
551      jedis.rpush("foo", "b");
552      pos = jedis.lpos("foo", "b", LPosParams.lPosParams());
553      assertEquals(1, pos.intValue());
554      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(3));
555      assertEquals(5, pos.intValue());
556      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2));
557      assertEquals(4, pos.intValue());
558      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-5));
559      assertNull(pos);
560      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(1).maxlen(2));
561      assertEquals(1, pos.intValue());
562      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2).maxlen(2));
563      assertNull(pos);
564      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2).maxlen(2));
565      assertEquals(4, pos.intValue());
566      List<Long> expected = new ArrayList<Long>();
567      expected.add(1L);
568      expected.add(4L);
569      expected.add(5L);
570      List<Long> posList = jedis.lpos("foo", "b", LPosParams.lPosParams(), 2);
571      assertEquals(expected.subList(0, 2), posList);
572      posList = jedis.lpos("foo", "b", LPosParams.lPosParams(), 0);
573      assertEquals(expected, posList);
574      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2), 0);
575      assertEquals(expected.subList(1, 3), posList);
576      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2).maxlen(5), 0);
577      assertEquals(expected.subList(1, 2), posList);
578      Collections.reverse(expected);
579      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2), 0);
580      assertEquals(expected.subList(1, 3), posList);
581      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-1).maxlen(5), 2);
582      assertEquals(expected.subList(0, 2), posList);
583      jedis.rpush(bfoo, bA);
584      jedis.rpush(bfoo, bB);
585      jedis.rpush(bfoo, bC);
586      pos = jedis.lpos(bfoo, bB);
587      assertEquals(1, pos.intValue());
588      pos = jedis.lpos(bfoo, b3);
589      assertNull(pos);
590      jedis.rpush(bfoo, bA);
591      jedis.rpush(bfoo, bB);
592      jedis.rpush(bfoo, bA);
593      pos = jedis.lpos(bfoo, bB, LPosParams.lPosParams().rank(2));
594      assertEquals(4, pos.intValue());
595      pos = jedis.lpos(bfoo, bB, LPosParams.lPosParams().rank(-2).maxlen(5));
596      assertEquals(1, pos.intValue());
597      expected.clear();
598      expected.add(0L);
599      expected.add(3L);
600      expected.add(5L);
601      posList = jedis.lpos(bfoo, bA, LPosParams.lPosParams().maxlen(6), 0);
602      assertEquals(expected, posList);
603      posList = jedis.lpos(bfoo, bA, LPosParams.lPosParams().maxlen(6).rank(2), 1);
604      assertEquals(expected.subList(1, 2), posList);
605    }
606    @Test
607    public void lmove() {
608      jedis.rpush("foo", "bar1", "bar2", "bar3");
609      assertEquals("bar3", jedis.lmove("foo", "bar", ListDirection.RIGHT, ListDirection.LEFT));
610      assertEquals(Collections.singletonList("bar3"), jedis.lrange("bar", 0, -1));
611      assertEquals(Arrays.asList("bar1", "bar2"), jedis.lrange("foo", 0, -1));
612      jedis.rpush(bfoo, b1, b2, b3);
613      assertArrayEquals(b3, jedis.lmove(bfoo, bbar, ListDirection.RIGHT, ListDirection.LEFT));
614      assertByteArrayListEquals(Collections.singletonList(b3), jedis.lrange(bbar, 0, -1));
615      assertByteArrayListEquals(Arrays.asList(b1, b2), jedis.lrange(bfoo, 0, -1));
616    }
617    @Test
618    public void blmove() {
619      new Thread(() -> {
620        try {
621          Thread.sleep(100);
622        } catch (InterruptedException e) {
623          logger.error("", e);
624        }
625        jedis.rpush("foo", "bar1", "bar2", "bar3");
626      }).start();
627      assertEquals("bar3", jedis.blmove("foo", "bar", ListDirection.RIGHT, ListDirection.LEFT, 0));
628      assertEquals(Collections.singletonList("bar3"), jedis.lrange("bar", 0, -1));
629      assertEquals(Arrays.asList("bar1", "bar2"), jedis.lrange("foo", 0, -1));
630      new Thread(() -> {
631        try {
632          Thread.sleep(100);
633        } catch (InterruptedException e) {
634          logger.error("", e);
635        }
636        jedis.rpush(bfoo, b1, b2, b3);
637      }).start();
638      assertArrayEquals(b3, jedis.blmove(bfoo, bbar, ListDirection.RIGHT, ListDirection.LEFT, 0));
639      assertByteArrayListEquals(Collections.singletonList(b3), jedis.lrange(bbar, 0, -1));
640      assertByteArrayListEquals(Arrays.asList(b1, b2), jedis.lrange(bfoo, 0, -1));
641    }
642    @Test
643    public void lmpop() {
644      String mylist1 = "mylist1";
645      String mylist2 = "mylist2";
646      jedis.lpush(mylist1, "one", "two", "three", "four", "five");
647      jedis.lpush(mylist2, "one", "two", "three", "four", "five");
648      KeyValue<String, List<String>> elements = jedis.lmpop(ListDirection.LEFT, mylist1, mylist2);
649      assertEquals(mylist1, elements.getKey());
650      assertEquals(1, elements.getValue().size());
651      elements = jedis.lmpop(ListDirection.LEFT, 5, mylist1, mylist2);
652      assertEquals(mylist1, elements.getKey());
653      assertEquals(4, elements.getValue().size());
654      elements = jedis.lmpop(ListDirection.RIGHT, 100, mylist1, mylist2);
655      assertEquals(mylist2, elements.getKey());
656      assertEquals(5, elements.getValue().size());
657      elements = jedis.lmpop(ListDirection.RIGHT, mylist1, mylist2);
658      assertNull(elements);
659    }
660    @Test
661    public void blmpopSimple() {
662      String mylist1 = "mylist1";
663      String mylist2 = "mylist2";
664      jedis.lpush(mylist1, "one", "two", "three", "four", "five");
665      jedis.lpush(mylist2, "one", "two", "three", "four", "five");
666      KeyValue<String, List<String>> elements = jedis.blmpop(1L, ListDirection.LEFT, mylist1, mylist2);
667      assertEquals(mylist1, elements.getKey());
668      assertEquals(1, elements.getValue().size());
669      elements = jedis.blmpop(1L, ListDirection.LEFT, 5, mylist1, mylist2);
670      assertEquals(mylist1, elements.getKey());
671      assertEquals(4, elements.getValue().size());
672      elements = jedis.blmpop(1L, ListDirection.RIGHT, 100, mylist1, mylist2);
673      assertEquals(mylist2, elements.getKey());
674      assertEquals(5, elements.getValue().size());
675      elements = jedis.blmpop(1L, ListDirection.RIGHT, mylist1, mylist2);
676      assertNull(elements);
677    }
678  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RedisJsonV2Test.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ListCommandsTestBase.java</div>
                <div class="column column_space"><pre><code>50      Path2 p = Path2.of(".none");
51      client.jsonSet("obj", p, gson.toJson("strangle"), JsonSetParams.jsonSetParams().nx());
52      assertJsonArrayEquals(jsonArray("strangle"), client.jsonGet("obj", p));
53    }
54    @Test
55    public void setWithoutAPathDefaultsToRootPath() {
56      String objStr = gson.toJson(new IRLObject());
</pre></code></div>
                <div class="column column_space"><pre><code>319      bresult = jedis.blpop(1, bfoo, bfoo1);
320      assertNotNull(bresult);
321      assertEquals(2, bresult.size());
322      assertArrayEquals(bfoo, bresult.get(0));
323      assertArrayEquals(bbar, bresult.get(1));
324    }
325    @Test
326    public void blpopDouble() throws InterruptedException {
327      KeyValue<String, String> result = jedis.blpop(0.1, "foo");
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    