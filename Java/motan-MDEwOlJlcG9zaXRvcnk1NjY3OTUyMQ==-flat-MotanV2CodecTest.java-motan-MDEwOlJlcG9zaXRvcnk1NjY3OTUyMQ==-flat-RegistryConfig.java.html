
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 7.179487179487179%, Tokens: 14, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-MotanV2CodecTest.java</h3>
            <pre><code>1  package com.weibo.api.motan.protocol.v2motan;
<span onclick='openModal()' class='match'>2  import com.weibo.api.motan.common.URLParamType;
3  import com.weibo.api.motan.mock.MockChannel;
4  import com.weibo.api.motan.rpc.*;
5  import com.weibo.api.motan.serialize.DeserializableObject;
6  import com.weibo.api.motan.transport.Channel;
7  import org.junit.Test;
8  import java.io.IOException;
9  import java.util.HashMap;
10  import java.util.Map;
11  import java.util.Random;
12  import static org.junit.Assert.assertEquals;
13  import static org.junit.Assert.assertTrue;
14  public class MotanV2CodecTest {
15      static MotanV2Codec codec = new MotanV2Codec();
</span>16      @Test
17      public void testEncode() throws Exception {
18          Map<String, String> params = new HashMap<String, String>();
19          URL url = new URL("motan2", "localhost", 0, "testService", params);
20          url.getParameters().put(URLParamType.serialize.getName(), URLParamType.serialize.getValue());
21          Channel channel = new MockChannel(url);
22          DefaultRequest request = new DefaultRequest();
23          request.setInterfaceName("com.weibo.test.TestService");
24          request.setRequestId(new Random().nextLong());
25          request.setMethodName("testHello");
26          request.setArguments(new Object[]{"hi!"});
27          Map<String, String> attachs = new HashMap<String, String>();
28          attachs.put("group", "testgroup");
29          request.setAttachments(attachs);
30          byte[] bytes = codec.encode(channel, request);
31          Request newReq = (Request) codec.decode(channel, "localhost", bytes);
32          checkRequest(request, newReq);
33          request.setAttachments(null);
34          bytes = codec.encode(channel, request);
35          newReq = (Request) codec.decode(channel, "localhost", bytes);
36          checkRequest(request, newReq);
37          request.setArguments(new Object[]{"123", 456, true });
38          bytes = codec.encode(channel, request);
39          newReq = (Request) codec.decode(channel, "localhost", bytes);
40          checkRequest(request, newReq);
41          DefaultResponse response = new DefaultResponse();
42          response.setRequestId(8908790);
43          response.setProcessTime(5);
44          response.setValue("xxede");
45          Map<String, String> resAttachs = new HashMap<String, String>();
46          resAttachs.put("res", "testres");
47          resAttachs.put("xxx","eee");
48          response.setAttachments(resAttachs);
49          bytes = codec.encode(channel, response);
50          Response newRes = (Response) codec.decode(channel, "localhost", bytes);
51          checkResponse(response, newRes);
52      }
53      private void checkRequest(Request expect, Request real) throws IOException {
54          assertEquals(expect.toString(), real.toString());
55          assertTrue(real.getArguments()[0] instanceof DeserializableObject);
56          Class[] classes = new Class[expect.getArguments().length];
57          for (int i = 0; i < expect.getArguments().length; i++) {
58              classes[i] = expect.getArguments()[i].getClass();
59          }
60          Object[] result = ((DeserializableObject) real.getArguments()[0]).deserializeMulti(classes);
61          for(int i = 0; i < expect.getArguments().length; i++){
62              assertEquals(expect.getArguments()[i], result[i]);
63          }
64          checkMap(expect.getAttachments(), real.getAttachments());
65      }
66      private void checkResponse(Response expect, Response real)throws  Exception{
67          assertTrue(real.getValue() instanceof DeserializableObject);
68          assertEquals(expect.getValue(), ((DeserializableObject)real.getValue()).deserialize(String.class));
69          checkMap(expect.getAttachments(), real.getAttachments());
70      }
71      private void checkMap(Map<String, String> map1, Map<String, String> map2){
72          if(map1 == null || map2 == null){
73              if(map1 == null && map2 == null){
74                  return;
75              }
76              throw new RuntimeException("map not both null! ");
77          }
78          if(map1.size() != map2.size()){
79              throw new RuntimeException("map size not equals!");
80          }
81          for(Map.Entry<String, String> entry : map1.entrySet()){
82              assertEquals(entry.getValue(), map2.get(entry.getKey()));
83          }
84      }
85  }
</code></pre>
        </div>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-RegistryConfig.java</h3>
            <pre><code>1  package com.weibo.api.motan.config;
2  import com.weibo.api.motan.common.MotanConstants;
<span onclick='openModal()' class='match'>3  import com.weibo.api.motan.common.URLParamType;
4  import com.weibo.api.motan.config.annotation.ConfigDesc;
5  import com.weibo.api.motan.registry.RegistryService;
6  import com.weibo.api.motan.rpc.URL;
7  import com.weibo.api.motan.util.LoggerUtil;
8  import com.weibo.api.motan.util.NetUtils;
9  import com.weibo.api.motan.util.UrlUtils;
10  import org.apache.commons.lang3.StringUtils;
11  import java.util.Collections;
12  import java.util.HashMap;
13  import java.util.List;
14  import java.util.Map;
15  public class RegistryConfig extends AbstractConfig {
16      private static final long serialVersionUID = 3236055928361714933L;
</span>17      private String name;
18      private String regProtocol;
19      private String address;
20      private Integer port;
21      private Integer requestTimeout;
22      private Integer connectTimeout;
23      private Integer registrySessionTimeout;
24      private Integer registryRetryPeriod;
25      private String check;
26      private Boolean register;
27      private Boolean subscribe;
28      private Boolean isDefault;
29      private String excise;
30      private RegistryConfig proxyRegistry;
31      private String meshRegistryName;
32      private Boolean dynamic; 
33      @ConfigDesc(key = "protocol")
34      public String getRegProtocol() {
35          return regProtocol;
36      }
37      public void setRegProtocol(String regProtocol) {
38          this.regProtocol = regProtocol;
39      }
40      public String getAddress() {
41          return address;
42      }
43      public void setAddress(String address) {
44          this.address = address;
45      }
46      public Integer getPort() {
47          return port;
48      }
49      public void setPort(Integer port) {
50          this.port = port;
51      }
52      public String getCheck() {
53          return check;
54      }
55      public void setCheck(String check) {
56          this.check = check;
57      }
58      @Deprecated
59      public void setCheck(Boolean check) {
60          this.check = String.valueOf(check);
61      }
62      public Boolean getRegister() {
63          return register;
64      }
65      public void setRegister(Boolean register) {
66          this.register = register;
67      }
68      public Boolean getSubscribe() {
69          return subscribe;
70      }
71      public void setSubscribe(Boolean subscribe) {
72          this.subscribe = subscribe;
73      }
74      public String getName() {
75          return name;
76      }
77      public void setName(String name) {
78          this.name = name;
79      }
80      public Integer getRequestTimeout() {
81          return requestTimeout;
82      }
83      public void setRequestTimeout(Integer requestTimeout) {
84          this.requestTimeout = requestTimeout;
85      }
86      public Integer getRegistrySessionTimeout() {
87          return registrySessionTimeout;
88      }
89      public void setRegistrySessionTimeout(Integer registrySessionTimeout) {
90          this.registrySessionTimeout = registrySessionTimeout;
91      }
92      public Integer getRegistryRetryPeriod() {
93          return registryRetryPeriod;
94      }
95      public void setRegistryRetryPeriod(Integer registryRetryPeriod) {
96          this.registryRetryPeriod = registryRetryPeriod;
97      }
98      public String getExcise() {
99          return excise;
100      }
101      public void setExcise(String excise) {
102          this.excise = excise;
103      }
104      public void setDefault(boolean isDefault) {
105          this.isDefault = isDefault;
106      }
107      public Boolean isDefault() {
108          return isDefault;
109      }
110      public Integer getConnectTimeout() {
111          return connectTimeout;
112      }
113      public void setConnectTimeout(Integer connectTimeout) {
114          this.connectTimeout = connectTimeout;
115      }
116      public RegistryConfig getProxyRegistry() {
117          return proxyRegistry;
118      }
119      public void setProxyRegistry(RegistryConfig proxyRegistry) {
120          this.proxyRegistry = proxyRegistry;
121      }
122      public String getMeshRegistryName() {
123          return meshRegistryName;
124      }
125      public void setMeshRegistryName(String meshRegistryName) {
126          this.meshRegistryName = meshRegistryName;
127      }
128      public Boolean getDynamic() {
129          return dynamic;
130      }
131      public void setDynamic(Boolean dynamic) {
132          this.dynamic = dynamic;
133      }
134      public enum Excise {
135          excise_static("static"), excise_dynamic("dynamic"), excise_ratio("ratio");
136          private String name;
137          Excise(String n) {
138              this.name = n;
139          }
140          public String getName() {
141              return name;
142          }
143      }
144      public List<URL> toURLs() {
145          String address = getAddress();
146          if (StringUtils.isBlank(address)) {
147              address = NetUtils.LOCALHOST + ":" + MotanConstants.DEFAULT_INT_VALUE;
148          }
149          Map<String, String> map = new HashMap<>();
150          map.putAll(getAddressParams());
151          appendConfigParams(map);
152          map.put(URLParamType.path.getName(), RegistryService.class.getName());
153          map.put(URLParamType.refreshTimestamp.getName(), String.valueOf(System.currentTimeMillis()));
154          if (!map.containsKey(URLParamType.protocol.getName())) {
155              if (address.contains(":&bsol;&bsol;")) {
156                  map.put(URLParamType.protocol.getName(), address.substring(0, address.indexOf(":&bsol;&bsol;")));
157              } else {
158                  map.put(URLParamType.protocol.getName(), MotanConstants.REGISTRY_PROTOCOL_LOCAL);
159              }
160          }
161          if (proxyRegistry != null) {
162              String proxyRegistryString = UrlUtils.urlsToString(proxyRegistry.toURLs());
163              if (StringUtils.isNotBlank(proxyRegistryString)) {
164                  map.put(URLParamType.proxyRegistryUrlString.getName(), proxyRegistryString);
165              } else {
166                  LoggerUtil.warn("parse proxyRegistryString is empty, proxy registry:" + proxyRegistry.getName());
167              }
168          }
169          return UrlUtils.parseURLs(address, map);
170      }
171      public Map<String, String> getAddressParams() {
172          if (StringUtils.isNotBlank(address)) {
173              int index = address.indexOf("?");
174              if (index > -1) {
175                  int end = address.length();
176                  if (address.contains(MotanConstants.COMMA_SEPARATOR)) {
177                      end = address.indexOf(MotanConstants.COMMA_SEPARATOR);
178                  }
179                  return UrlUtils.parseQueryParams(address.substring(index + 1, end));
180              }
181          }
182          return Collections.emptyMap();
183      }
184  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-MotanV2CodecTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-RegistryConfig.java</div>
                </div>
                <div class="column column_space"><pre><code>2  import com.weibo.api.motan.common.URLParamType;
3  import com.weibo.api.motan.mock.MockChannel;
4  import com.weibo.api.motan.rpc.*;
5  import com.weibo.api.motan.serialize.DeserializableObject;
6  import com.weibo.api.motan.transport.Channel;
7  import org.junit.Test;
8  import java.io.IOException;
9  import java.util.HashMap;
10  import java.util.Map;
11  import java.util.Random;
12  import static org.junit.Assert.assertEquals;
13  import static org.junit.Assert.assertTrue;
14  public class MotanV2CodecTest {
15      static MotanV2Codec codec = new MotanV2Codec();
</pre></code></div>
                <div class="column column_space"><pre><code>3  import com.weibo.api.motan.common.URLParamType;
4  import com.weibo.api.motan.config.annotation.ConfigDesc;
5  import com.weibo.api.motan.registry.RegistryService;
6  import com.weibo.api.motan.rpc.URL;
7  import com.weibo.api.motan.util.LoggerUtil;
8  import com.weibo.api.motan.util.NetUtils;
9  import com.weibo.api.motan.util.UrlUtils;
10  import org.apache.commons.lang3.StringUtils;
11  import java.util.Collections;
12  import java.util.HashMap;
13  import java.util.List;
14  import java.util.Map;
15  public class RegistryConfig extends AbstractConfig {
16      private static final long serialVersionUID = 3236055928361714933L;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    