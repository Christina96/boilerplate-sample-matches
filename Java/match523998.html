<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for CaliperMeasure.java &amp; HashedWheelTimerTest.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for CaliperMeasure.java &amp; HashedWheelTimerTest.java
      </h3>
<h1 align="center">
        7.8%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>CaliperMeasure.java (13.259668%)<th>HashedWheelTimerTest.java (5.5555553%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(17-38)<td><a href="#" name="0">(16-33)</a><td align="center"><font color="#ff0000">14</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(92-99)<td><a href="#" name="1">(253-256)</a><td align="center"><font color="#b60000">10</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>CaliperMeasure.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>package io.netty.test.udt.util;
2 import com.google.caliper.Measurement;
3 import com.google.caliper.MeasurementSet;
4 import com.google.caliper.Run;
5 import com.google.caliper.Scenario;
6 import com.google.caliper.ScenarioResult;
7 import com.yammer.metrics.core.Gauge;
8 import com.yammer.metrics.core.Meter;
9 import com.yammer.metrics.core.MetricsRegistry;
10 import com.yammer.metrics.core.Timer;
11 import java.util.HashMap;
12 import java.util.Map;
13 import java.util.concurrent.TimeUnit;
14 publi</b></font>c class CaliperMeasure {
15     public static class SizeGuage extends Gauge&lt;Double&gt; {
16         private volatile Double size = 0.0;
17         @Override
18         public Double value() {
19             return size;
20         }
21         public void value(final double size) {
22             this.size = size;
23         }
24     }
25     private static final Map&lt;String, Integer&gt; RATE_UNIT = new HashMap&lt;String, Integer&gt;();
26     static {
27         RATE_UNIT.put("Rate  B/s", 1);
28         RATE_UNIT.put("Rate KB/s", 1024);
29         RATE_UNIT.put("Rate MB/s", 1024 * 1024);
30         RATE_UNIT.put("Rate GB/s", 1024 * 1024 * 1024);
31     }
32     private static final Map&lt;String, Integer&gt; TIME_UNIT = new HashMap&lt;String, Integer&gt;();
33     static {
34         TIME_UNIT.put("Time ns", 1);
35         TIME_UNIT.put("Time us", 1000);
36         TIME_UNIT.put("Time ms", 1000 * 1000);
37         TIME_UNIT.put("Time s ", 1000 * 1000 * 1000);
38     }
39     private static final Map&lt;String, Integer&gt; SIZE_UNIT = new HashMap&lt;String, Integer&gt;();
40     static {
41         SIZE_UNIT.put("Size  B", 1);
42         SIZE_UNIT.put("Size KB", 1024);
43         SIZE_UNIT.put("Size MB", 1024 * 1024);
44         SIZE_UNIT.put("Size GB", 1024 * 1024 * 1024);
45     }
46 <a name="1"></a>
47     private final Map&lt;Long, Measurement&gt; rateMap = new HashMap&lt;Long, Measurement&gt;();
48     private final Map&lt;Long, Measurement&gt; timeMap = new HashMap&lt;Long, Measurement&gt;();
49     <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>private final Map&lt;Long, Measurement&gt; sizeMap = new HashMap&lt;Long, Measurement&gt;();
50     private final MetricsRegistry metrics = new MetricsRegistry();
51     private final Meter rate = metrics.newMeter(getClass(), "rate", "bytes",
52             TimeUnit.SECONDS);
53     private final Timer time = metrics.newTimer(getClass</b></font>(), "time",
54             TimeUnit.NANOSECONDS, TimeUnit.SECONDS);
55     private final SizeGuage size = new SizeGuage();
56     {
57         metrics.newGauge(getClass(), "", size);
58     }
59     public Meter rate() {
60         return rate;
61     }
62     public Timer time() {
63         return time;
64     }
65     public SizeGuage size() {
66         return size;
67     }
68     private static double filter(final double value) {
69         if (value &lt;= 0.0) {
70             return 1.0;
71         } else {
72             return value;
73         }
74     }
75     @SuppressWarnings("FloatingPointEquality")
76     public void mark() {
77         final double rateValue = filter(rate.oneMinuteRate());
78         final double timeValue = filter(time.mean());
79         final double sizeValue = filter(size.value());
80         if (rateValue == 1.0 &amp;&amp; timeValue == 1.0 &amp;&amp; sizeValue == 1.0) {
81             return;
82         }
83         final Measurement markRate = new Measurement(RATE_UNIT, rateValue,
84                 rateValue);
85         rateMap.put(System.nanoTime(), markRate);
86         final Measurement markTime = new Measurement(TIME_UNIT, timeValue,
87                 timeValue);
88         timeMap.put(System.nanoTime(), markTime);
89         final Measurement markSize = new Measurement(SIZE_UNIT, sizeValue,
90                 sizeValue);
91         sizeMap.put(System.nanoTime(), markSize);
92     }
93     private final Map&lt;String, String&gt; variables = new HashMap&lt;String, String&gt;();
94     public Map&lt;String, String&gt; variables() {
95         return variables;
96     }
97     private static MeasurementSet measurementSet(final Map&lt;Long, Measurement&gt; map) {
98         final Measurement[] array = map.values().toArray(new Measurement[0]);
99         return new MeasurementSet(array);
100     }
101     public void appendTo(final Run run) {
102         final Scenario scenario = new Scenario(variables());
103         final MeasurementSet timeSet = measurementSet(rateMap);
104         final String timeLog = null;
105         final MeasurementSet instSet = measurementSet(timeMap);
106         final String instLog = null;
107         final MeasurementSet heapSet = measurementSet(sizeMap);
108         final String heapLog = null;
109         final ScenarioResult scenarioResult = new ScenarioResult(timeSet,
110                 timeLog, instSet, instLog, heapSet, heapLog);
111         final Map&lt;Scenario, ScenarioResult&gt; measurements = run
112                 .getMeasurements();
113         measurements.put(scenario, scenarioResult);
114     }
115     public void shutdown() {
116         rate.stop();
117         time.stop();
118         metrics.shutdown();
119     }
120 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>HashedWheelTimerTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 /*
2  * Copyright 2013 The Netty Project
3  *
4  * The Netty Project licenses this file to you under the Apache License,
5  * version 2.0 (the "License"); you may not use this file except in compliance
6  * with the License. You may obtain a copy of the License at:
7  *
8  *   https://www.apache.org/licenses/LICENSE-2.0
9  *
10  * Unless required by applicable law or agreed to in writing, software
11  * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
12  * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
13 <a name="0"></a> * License for the specific language governing permissions and limitations
14  * under the License.
15  */
16 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>package io.netty.util;
17 import org.junit.jupiter.api.Test;
18 import java.util.concurrent.BlockingQueue;
19 import java.util.concurrent.CountDownLatch;
20 import java.util.concurrent.Executor;
21 import java.util.concurrent.Executors;
22 import java.util.concurrent.LinkedBlockingQueue;
23 import java.util.concurrent.RejectedExecutionException;
24 import java.util.concurrent.TimeUnit;
25 import static org.junit.jupiter.api.Assertions.assertEquals;
26 import static org.junit.jupiter.api.Assertions.assertFalse;
27 import static org.junit.jupiter.api.Assertions.assertTrue;
28 import static org.junit.jupiter.api.Assertions.fail;
29 publi</b></font>c class HashedWheelTimerTest {
30     @Test
31     public void testScheduleTimeoutShouldNotRunBeforeDelay() throws InterruptedException {
32         final Timer timer = new HashedWheelTimer();
33         final CountDownLatch barrier = new CountDownLatch(1);
34         final Timeout timeout = timer.newTimeout(new TimerTask() {
35             @Override
36             public void run(Timeout timeout) throws Exception {
37                 fail("This should not have run");
38                 barrier.countDown();
39             }
40         }, 10, TimeUnit.SECONDS);
41         assertFalse(barrier.await(3, TimeUnit.SECONDS));
42         assertFalse(timeout.isExpired(), "timer should not expire");
43         timer.stop();
44     }
45     @Test
46     public void testScheduleTimeoutShouldRunAfterDelay() throws InterruptedException {
47         final Timer timer = new HashedWheelTimer();
48         final CountDownLatch barrier = new CountDownLatch(1);
49         final Timeout timeout = timer.newTimeout(new TimerTask() {
50             @Override
51             public void run(Timeout timeout) throws Exception {
52                 barrier.countDown();
53             }
54         }, 2, TimeUnit.SECONDS);
55         assertTrue(barrier.await(3, TimeUnit.SECONDS));
56         assertTrue(timeout.isExpired(), "timer should expire");
57         timer.stop();
58     }
59     @Test
60     @org.junit.jupiter.api.Timeout(value = 3000, unit = TimeUnit.MILLISECONDS)
61     public void testStopTimer() throws InterruptedException {
62         final CountDownLatch latch = new CountDownLatch(3);
63         final Timer timerProcessed = new HashedWheelTimer();
64         for (int i = 0; i &lt; 3; i ++) {
65             timerProcessed.newTimeout(new TimerTask() {
66                 @Override
67                 public void run(final Timeout timeout) throws Exception {
68                     latch.countDown();
69                 }
70             }, 1, TimeUnit.MILLISECONDS);
71         }
72         latch.await();
73         assertEquals(0, timerProcessed.stop().size(), "Number of unprocessed timeouts should be 0");
74         final Timer timerUnprocessed = new HashedWheelTimer();
75         for (int i = 0; i &lt; 5; i ++) {
76             timerUnprocessed.newTimeout(new TimerTask() {
77                 @Override
78                 public void run(Timeout timeout) throws Exception {
79                 }
80             }, 5, TimeUnit.SECONDS);
81         }
82         Thread.sleep(1000L);         assertFalse(timerUnprocessed.stop().isEmpty(), "Number of unprocessed timeouts should be greater than 0");
83     }
84     @Test
85     @org.junit.jupiter.api.Timeout(value = 3000, unit = TimeUnit.MILLISECONDS)
86     public void testTimerShouldThrowExceptionAfterShutdownForNewTimeouts() throws InterruptedException {
87         final CountDownLatch latch = new CountDownLatch(3);
88         final Timer timer = new HashedWheelTimer();
89         for (int i = 0; i &lt; 3; i ++) {
90             timer.newTimeout(new TimerTask() {
91                 @Override
92                 public void run(Timeout timeout) throws Exception {
93                     latch.countDown();
94                 }
95             }, 1, TimeUnit.MILLISECONDS);
96         }
97         latch.await();
98         timer.stop();
99         try {
100             timer.newTimeout(createNoOpTimerTask(), 1, TimeUnit.MILLISECONDS);
101             fail("Expected exception didn't occur.");
102         } catch (IllegalStateException ignored) {
103         }
104     }
105     @Test
106     @org.junit.jupiter.api.Timeout(value = 5000, unit = TimeUnit.MILLISECONDS)
107     public void testTimerOverflowWheelLength() throws InterruptedException {
108         final HashedWheelTimer timer = new HashedWheelTimer(
109             Executors.defaultThreadFactory(), 100, TimeUnit.MILLISECONDS, 32);
110         final CountDownLatch latch = new CountDownLatch(3);
111         timer.newTimeout(new TimerTask() {
112             @Override
113             public void run(final Timeout timeout) throws Exception {
114                 timer.newTimeout(this, 100, TimeUnit.MILLISECONDS);
115                 latch.countDown();
116             }
117         }, 100, TimeUnit.MILLISECONDS);
118         latch.await();
119         assertFalse(timer.stop().isEmpty());
120     }
121     @Test
122     public void testExecutionOnTime() throws InterruptedException {
123         int tickDuration = 200;
124         int timeout = 125;
125         int maxTimeout = 2 * (tickDuration + timeout);
126         final HashedWheelTimer timer = new HashedWheelTimer(tickDuration, TimeUnit.MILLISECONDS);
127         final BlockingQueue&lt;Long&gt; queue = new LinkedBlockingQueue&lt;Long&gt;();
128         int scheduledTasks = 100000;
129         for (int i = 0; i &lt; scheduledTasks; i++) {
130             final long start = System.nanoTime();
131             timer.newTimeout(new TimerTask() {
132                 @Override
133                 public void run(final Timeout timeout) throws Exception {
134                     queue.add(TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - start));
135                 }
136             }, timeout, TimeUnit.MILLISECONDS);
137         }
138         for (int i = 0; i &lt; scheduledTasks; i++) {
139             long delay = queue.take();
140             assertTrue(delay &gt;= timeout &amp;&amp; delay &lt; maxTimeout,
141                 "Timeout + " + scheduledTasks + " delay " + delay + " must be " + timeout + " &lt; " + maxTimeout);
142         }
143         timer.stop();
144     }
145     @Test
146     public void testExecutionOnTaskExecutor() throws InterruptedException {
147         int timeout = 10;
148         final CountDownLatch latch = new CountDownLatch(1);
149         final CountDownLatch timeoutLatch = new CountDownLatch(1);
150         Executor executor = new Executor() {
151             @Override
152             public void execute(Runnable command) {
153                 try {
154                     command.run();
155                 } finally {
156                     latch.countDown();
157                 }
158             }
159         };
160         final HashedWheelTimer timer = new HashedWheelTimer(Executors.defaultThreadFactory(), 100,
161                 TimeUnit.MILLISECONDS, 32, true, 2, executor);
162         timer.newTimeout(new TimerTask() {
163             @Override
164             public void run(final Timeout timeout) throws Exception {
165                 timeoutLatch.countDown();
166             }
167         }, timeout, TimeUnit.MILLISECONDS);
168         latch.await();
169         timeoutLatch.await();
170         timer.stop();
171     }
172     @Test
173     public void testRejectedExecutionExceptionWhenTooManyTimeoutsAreAddedBackToBack() {
174         HashedWheelTimer timer = new HashedWheelTimer(Executors.defaultThreadFactory(), 100,
175             TimeUnit.MILLISECONDS, 32, true, 2);
176         timer.newTimeout(createNoOpTimerTask(), 5, TimeUnit.SECONDS);
177         timer.newTimeout(createNoOpTimerTask(), 5, TimeUnit.SECONDS);
178         try {
179             timer.newTimeout(createNoOpTimerTask(), 1, TimeUnit.MILLISECONDS);
180             fail("Timer allowed adding 3 timeouts when maxPendingTimeouts was 2");
181         } catch (RejectedExecutionException e) {
182         } finally {
183             timer.stop();
184         }
185     }
186     @Test
187     public void testNewTimeoutShouldStopThrowingRejectedExecutionExceptionWhenExistingTimeoutIsCancelled()
188         throws InterruptedException {
189         final int tickDurationMs = 100;
190         final HashedWheelTimer timer = new HashedWheelTimer(Executors.defaultThreadFactory(), tickDurationMs,
191             TimeUnit.MILLISECONDS, 32, true, 2);
192         timer.newTimeout(createNoOpTimerTask(), 5, TimeUnit.SECONDS);
193         Timeout timeoutToCancel = timer.newTimeout(createNoOpTimerTask(), 5, TimeUnit.SECONDS);
194         assertTrue(timeoutToCancel.cancel());
195         Thread.sleep(tickDurationMs * 5);
196         final CountDownLatch secondLatch = new CountDownLatch(1);
197         timer.newTimeout(createCountDownLatchTimerTask(secondLatch), 90, TimeUnit.MILLISECONDS);
198         secondLatch.await();
199         timer.stop();
200     }
201     @Test
202     @org.junit.jupiter.api.Timeout(value = 3000, unit = TimeUnit.MILLISECONDS)
203     public void testNewTimeoutShouldStopThrowingRejectedExecutionExceptionWhenExistingTimeoutIsExecuted()
204         throws InterruptedException {
205         final CountDownLatch latch = new CountDownLatch(1);
206         final HashedWheelTimer timer = new HashedWheelTimer(Executors.defaultThreadFactory(), 25,
207             TimeUnit.MILLISECONDS, 4, true, 2);
208         timer.newTimeout(createNoOpTimerTask(), 5, TimeUnit.SECONDS);
209         timer.newTimeout(createCountDownLatchTimerTask(latch), 90, TimeUnit.MILLISECONDS);
210         latch.await();
211         final CountDownLatch secondLatch = new CountDownLatch(1);
212         timer.newTimeout(createCountDownLatchTimerTask(secondLatch), 90, TimeUnit.MILLISECONDS);
213         secondLatch.await();
214         timer.stop();
215     }
216 <a name="1"></a>
217     @Test()
218     public void reportPendingTimeouts() throws InterruptedException {
219         <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>final CountDownLatch latch = new CountDownLatch(1);
220         final HashedWheelTimer timer = new HashedWheelTimer();
221         final Timeout t1 = timer.newTimeout(createNoOpTimerTask(), 100, TimeUnit.MINUTES);
222         final Timeout t2 = timer.newTimeout(createNoOpTimerTask</b></font>(), 100, TimeUnit.MINUTES);
223         timer.newTimeout(createCountDownLatchTimerTask(latch), 90, TimeUnit.MILLISECONDS);
224         assertEquals(3, timer.pendingTimeouts());
225         t1.cancel();
226         t2.cancel();
227         latch.await();
228         assertEquals(0, timer.pendingTimeouts());
229         timer.stop();
230     }
231     @Test
232     public void testOverflow() throws InterruptedException  {
233         final HashedWheelTimer timer = new HashedWheelTimer();
234         final CountDownLatch latch = new CountDownLatch(1);
235         Timeout timeout = timer.newTimeout(new TimerTask() {
236             @Override
237             public void run(Timeout timeout) {
238                 latch.countDown();
239             }
240         }, Long.MAX_VALUE, TimeUnit.MILLISECONDS);
241         assertFalse(latch.await(1, TimeUnit.SECONDS));
242         timeout.cancel();
243         timer.stop();
244     }
245     private static TimerTask createNoOpTimerTask() {
246         return new TimerTask() {
247             @Override
248             public void run(final Timeout timeout) throws Exception {
249             }
250         };
251     }
252     private static TimerTask createCountDownLatchTimerTask(final CountDownLatch latch) {
253         return new TimerTask() {
254             @Override
255             public void run(final Timeout timeout) throws Exception {
256                 latch.countDown();
257             }
258         };
259     }
260 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
