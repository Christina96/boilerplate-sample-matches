<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for CycleDetectingLockFactoryTest_1.java &amp; AbstractStandardDirectedGraphTest_1.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for CycleDetectingLockFactoryTest_1.java &amp; AbstractStandardDirectedGraphTest_1.java
      </h3>
<h1 align="center">
        24.4%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>CycleDetectingLockFactoryTest_1.java (26.323988%)<th>AbstractStandardDirectedGraphTest_1.java (22.837837%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(292-308)<td><a href="#" name="0">(398-405)</a><td align="center"><font color="#ff0000">17</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(96-110)<td><a href="#" name="1">(35-43)</a><td align="center"><font color="#f00000">16</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(458-469)<td><a href="#" name="2">(312-331)</a><td align="center"><font color="#e10000">15</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(471-481)<td><a href="#" name="3">(182-188)</a><td align="center"><font color="#d20000">14</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(115-122)<td><a href="#" name="4">(55-61)</a><td align="center"><font color="#d20000">14</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(430-445)<td><a href="#" name="5">(130-136)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(246-258)<td><a href="#" name="6">(166-171)</a><td align="center"><font color="#b40000">12</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(447-456)<td><a href="#" name="7">(114-120)</a><td align="center"><font color="#960000">10</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(371-384)<td><a href="#" name="8">(172-177)</a><td align="center"><font color="#960000">10</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(201-206)<td><a href="#" name="9">(451-456)</a><td align="center"><font color="#960000">10</font>
<tr onclick='openModal("#ad5910")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#ad5910"><font color="#ad5910">-</font><td><a href="#" name="10">(182-188)<td><a href="#" name="10">(366-371)</a><td align="center"><font color="#960000">10</font>
<tr onclick='openModal("#b041ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#b041ff"><font color="#b041ff">-</font><td><a href="#" name="11">(166-171)<td><a href="#" name="11">(86-91)</a><td align="center"><font color="#960000">10</font>
<tr onclick='openModal("#571b7e")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#571b7e"><font color="#571b7e">-</font><td><a href="#" name="12">(140-147)<td><a href="#" name="12">(70-75)</a><td align="center"><font color="#960000">10</font>
<tr onclick='openModal("#3b9c9c")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#3b9c9c"><font color="#3b9c9c">-</font><td><a href="#" name="13">(157-165)<td><a href="#" name="13">(153-158)</a><td align="center"><font color="#870000">9</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>CycleDetectingLockFactoryTest_1.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 package com.google.common.util.concurrent;
2 import com.google.common.base.Joiner;
3 import com.google.common.util.concurrent.CycleDetectingLockFactory.Policies;
4 import com.google.common.util.concurrent.CycleDetectingLockFactory.Policy;
5 import com.google.common.util.concurrent.CycleDetectingLockFactory.PotentialDeadlockException;
6 import java.util.concurrent.CountDownLatch;
7 import java.util.concurrent.TimeUnit;
8 import java.util.concurrent.locks.Lock;
9 import java.util.concurrent.locks.ReentrantLock;
10 import java.util.concurrent.locks.ReentrantReadWriteLock;
11 import java.util.regex.Matcher;
12 import java.util.regex.Pattern;
13 import junit.framework.TestCase;
14 public class CycleDetectingLockFactoryTest extends TestCase {
15   private ReentrantLock lockA;
16   private ReentrantLock lockB;
17   private ReentrantLock lockC;
18   private ReentrantReadWriteLock.ReadLock readLockA;
19   private ReentrantReadWriteLock.ReadLock readLockB;
20   private ReentrantReadWriteLock.ReadLock readLockC;
21   private ReentrantReadWriteLock.WriteLock writeLockA;
22   private ReentrantReadWriteLock.WriteLock writeLockB;
23   private ReentrantReadWriteLock.WriteLock writeLockC;
24   private ReentrantLock lock1;
25   private ReentrantLock lock2;
26   private ReentrantLock lock3;
27   private ReentrantLock lock01;
28   private ReentrantLock lock02;
29   private ReentrantLock lock03;
30   @Override
31   protected void setUp() throws Exception {
32     super.setUp();
33     CycleDetectingLockFactory factory = CycleDetectingLockFactory.newInstance(Policies.THROW);
34     lockA = factory.newReentrantLock("LockA");
35     lockB = factory.newReentrantLock("LockB");
36     lockC = factory.newReentrantLock("LockC");
37     ReentrantReadWriteLock readWriteLockA = factory.newReentrantReadWriteLock("ReadWriteA");
38     ReentrantReadWriteLock readWriteLockB = factory.newReentrantReadWriteLock("ReadWriteB");
39     ReentrantReadWriteLock readWriteLockC = factory.newReentrantReadWriteLock("ReadWriteC");
40     readLockA = readWriteLockA.readLock();
41     readLockB = readWriteLockB.readLock();
42     readLockC = readWriteLockC.readLock();
43     writeLockA = readWriteLockA.writeLock();
44     writeLockB = readWriteLockB.writeLock();
45     writeLockC = readWriteLockC.writeLock();
46     CycleDetectingLockFactory.WithExplicitOrdering&lt;MyOrder&gt; factory2 =
47         newInstanceWithExplicitOrdering(MyOrder.class, Policies.THROW);
48     lock1 = factory2.newReentrantLock(MyOrder.FIRST);
49     lock2 = factory2.newReentrantLock(MyOrder.SECOND);
50     lock3 = factory2.newReentrantLock(MyOrder.THIRD);
51     CycleDetectingLockFactory.WithExplicitOrdering&lt;OtherOrder&gt; factory3 =
52         newInstanceWithExplicitOrdering(OtherOrder.class, Policies.THROW);
53     lock01 = factory3.newReentrantLock(OtherOrder.FIRST);
54     lock02 = factory3.newReentrantLock(OtherOrder.SECOND);
55     lock03 = factory3.newReentrantLock(OtherOrder.THIRD);
56   }
57   private &lt;E extends Enum&lt;E&gt;&gt;
58       CycleDetectingLockFactory.WithExplicitOrdering&lt;E&gt; newInstanceWithExplicitOrdering(
59           Class&lt;E&gt; enumClass, Policy policy) {
60     return new CycleDetectingLockFactory.WithExplicitOrdering&lt;E&gt;(
61 <a name="1"></a>        policy, CycleDetectingLockFactory.createNodes(enumClass));
62   }
63   public void testDeadlock_twoLocks() <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>{
64     lockA.lock();
65     lockB.lock();
66     lockA.unlock();
67     lockB.unlock();
68     PotentialDeadlockException firstException = null;
69     lockB.lock();
70     try {
71       lockA.lock();
72       fail("Expected PotentialDeadlockException");
73     } catch (PotentialDeadlockException expected) {
74       checkMessage</b></font>(expected, "LockB -&gt; LockA", "LockA -&gt; LockB");
75       firstException = expected;
76 <a name="4"></a>    }
77     <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>try {
78       lockA.lock();
79       fail("Expected PotentialDeadlockException");
80     } catch (PotentialDeadlockException expected) {
81       checkMessage(expected, "LockB -&gt; LockA", "LockA -&gt; LockB");
82       assertSame(firstException.getCause(), expected.getCause());
83     }</b></font>
84     lockB.unlock();
85     lockA.lock();
86   }
87   public void testDeadlock_threeLocks() {
88     lockA.lock();
89     lockB.lock();
90     lockB.unlock();
91     lockA.unlock();
92 <a name="12"></a>        lockB.lock();
93     lockC.lock();
94     <font color="#571b7e"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>lockB.unlock();
95     try {
96       lockA.lock();
97       fail("Expected PotentialDeadlockException");
98     } catch (PotentialDeadlockException expected) {
99       checkMessage</b></font>(expected, "LockC -&gt; LockA", "LockB -&gt; LockC", "LockA -&gt; LockB");
100     }
101   }
102   public void testReentrancy_noDeadlock() {
103     lockA.lock();
104     lockB.lock();
105 <a name="13"></a>    lockA.lock();   }
106   public void testExplicitOrdering_noViolations() <font color="#3b9c9c"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>{
107     lock1.lock();
108     lock3.lock();
109     lock3.unlock();
110     lock2.lock();
111     lock3.lock();
112 <a name="11"></a>  }
113   public void testExplicitOrderin</b></font>g_violations() {
114     <font color="#b041ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>lock3.lock();
115     try {
116       lock2.lock();
117       fail("Expected PotentialDeadlockException");
118     } catch (PotentialDeadlockException expected) {
119       checkMessage</b></font>(expected, "MyOrder.THIRD -&gt; MyOrder.SECOND");
120     }
121     try {
122       lock1.lock();
123       fail("Expected PotentialDeadlockException");
124     } catch (PotentialDeadlockException expected) {
125       checkMessage(expected, "MyOrder.THIRD -&gt; MyOrder.FIRST");
126 <a name="10"></a>    }
127     lock3.unlock();
128     <font color="#ad5910"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>lock2.lock();
129     try {
130       lock1.lock();
131       fail("Expected PotentialDeadlockException");
132     } catch (PotentialDeadlockException expected) {
133       checkMessage</b></font>(expected, "MyOrder.SECOND -&gt; MyOrder.FIRST");
134     }
135   }
136   public void testDifferentOrderings_noViolations() {
137     lock3.lock();     lock01.lock();   }
138   public void testExplicitOrderings_generalCycleDetection() {
139 <a name="9"></a>    lock3.lock();     lock01.lock(); 
140     <font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>lock3.unlock();
141     try {
142       lock3.lock();
143       fail("Expected PotentialDeadlockException");
144     } catch (PotentialDeadlockException expected) {
145       checkMessage</b></font>(
146           expected, "OtherOrder.FIRST -&gt; MyOrder.THIRD", "MyOrder.THIRD -&gt; OtherOrder.FIRST");
147     }
148     lockA.lock();
149     lock01.unlock();
150     lockB.lock();
151     lockA.unlock();
152     try {
153       lock01.lock();
154       fail("Expected PotentialDeadlockException");
155     } catch (PotentialDeadlockException expected) {
156       checkMessage(
157           expected, "LockB -&gt; OtherOrder.FIRST", "LockA -&gt; LockB", "OtherOrder.FIRST -&gt; LockA");
158     }
159   }
160   public void testExplicitOrdering_cycleWithUnorderedLock() {
161     Lock myLock = CycleDetectingLockFactory.newInstance(Policies.THROW).newReentrantLock("MyLock");
162     lock03.lock();
163     myLock.lock();
164     lock03.unlock();
165     try {
166       lock01.lock();
167       fail("Expected PotentialDeadlockException");
168     } catch (PotentialDeadlockException expected) {
169       checkMessage(
170           expected,
171           "MyLock -&gt; OtherOrder.FIRST",
172           "OtherOrder.THIRD -&gt; MyLock",
173           "OtherOrder.FIRST -&gt; OtherOrder.THIRD");
174     }
175   }
176   public void testExplicitOrdering_reentrantAcquisition() {
177 <a name="6"></a>    CycleDetectingLockFactory.WithExplicitOrdering&lt;OtherOrder&gt; factory =
178         newInstanceWithExplicitOrdering(OtherOrder.class, Policies.THROW);
179     Lock lockA = factory.newReentrantReadWriteLock(OtherOrder.FIRST).readLock();
180     Lock lockB = <font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>factory.newReentrantLock(OtherOrder.SECOND);
181     lockA.lock();
182     lockA.lock();
183     lockB.lock();
184     lockB.lock();
185     lockA.unlock();
186     lockA.unlock();
187     lockB.unlock();
188     lockB.unlock();
189   }
190   public void testExplicitOrdering_acquiringMultipleLocks</b></font>WithSameRank() {
191     CycleDetectingLockFactory.WithExplicitOrdering&lt;OtherOrder&gt; factory =
192         newInstanceWithExplicitOrdering(OtherOrder.class, Policies.THROW);
193     Lock lockA = factory.newReentrantLock(OtherOrder.FIRST);
194     Lock lockB = factory.newReentrantReadWriteLock(OtherOrder.FIRST).readLock();
195     lockA.lock();
196     try {
197       lockB.lock();
198       fail("Expected IllegalStateException");
199     } catch (IllegalStateException expected) {
200     }
201     lockA.unlock();
202     lockB.lock();
203   }
204   public void testReadLock_deadlock() {
205     readLockA.lock();     lockB.lock();
206     lockB.unlock();
207     readLockA.unlock();
208     lockB.lock();
209     try {
210       readLockA.lock();
211       fail("Expected PotentialDeadlockException");
212     } catch (PotentialDeadlockException expected) {
213       checkMessage(expected, "LockB -&gt; ReadWriteA", "ReadWriteA -&gt; LockB");
214     }
215   }
216 <a name="0"></a>
217   public void testReadLock_transitive() {
218     readLockA.lock();     <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>lockB.lock();
219     lockB.unlock();
220     readLockA.unlock();
221     lockB.lock();
222     readLockC.lock();
223     lockB.unlock();
224     readLockC.unlock();
225     readLockC.lock();
226     try {
227       readLockA.lock();
228       fail("Expected PotentialDeadlockException");
229     } catch (PotentialDeadlockException expected) {
230       checkMessage</b></font>(
231           expected, "ReadWriteC -&gt; ReadWriteA", "LockB -&gt; ReadWriteC", "ReadWriteA -&gt; LockB");
232     }
233   }
234   public void testWriteLock_threeLockDeadLock() {
235     writeLockA.lock();
236     writeLockB.lock();
237     writeLockB.unlock();
238     writeLockA.unlock();
239     writeLockB.lock();
240     writeLockC.lock();
241     writeLockB.unlock();
242     try {
243       writeLockA.lock();
244       fail("Expected PotentialDeadlockException");
245     } catch (PotentialDeadlockException expected) {
246       checkMessage(
247           expected,
248           "ReadWriteC -&gt; ReadWriteA",
249           "ReadWriteB -&gt; ReadWriteC",
250           "ReadWriteA -&gt; ReadWriteB");
251     }
252   }
253   public void testWriteToReadLockDowngrading() {
254     writeLockA.lock();     readLockA.lock();
255     writeLockA.unlock();
256     lockB.lock();     readLockA.unlock();
257     try {
258       writeLockA.lock();
259       fail("Expected PotentialDeadlockException");
260     } catch (PotentialDeadlockException expected) {
261       checkMessage(expected, "LockB -&gt; ReadWriteA", "ReadWriteA -&gt; LockB");
262     }
263   }
264   public void testReadWriteLockDeadlock() {
265     writeLockA.lock();     lockB.lock();
266     writeLockA.unlock();
267     lockB.unlock();
268     lockB.lock();
269     try {
270       readLockA.lock();
271       fail("Expected PotentialDeadlockException");
272     } catch (PotentialDeadlockException expected) {
273       checkMessage(expected, "LockB -&gt; ReadWriteA", "ReadWriteA -&gt; LockB");
274 <a name="8"></a>    }
275   }
276   public void testReadWriteLockDeadlock_transitive() <font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>{
277     readLockA.lock();     lockB.lock();
278     readLockA.unlock();
279     lockB.unlock();
280     lockB.lock();
281     lockC.lock();
282     lockB.unlock();
283     lockC.unlock();
284     lockC.lock</b></font>();
285     try {
286       writeLockA.lock();
287       fail("Expected PotentialDeadlockException");
288     } catch (PotentialDeadlockException expected) {
289       checkMessage(expected, "LockC -&gt; ReadWriteA", "LockB -&gt; LockC", "ReadWriteA -&gt; LockB");
290     }
291   }
292   public void testReadWriteLockDeadlock_treatedEquivalently() {
293     readLockA.lock();     writeLockB.lock();
294     readLockA.unlock();
295     writeLockB.unlock();
296     readLockB.lock();
297     try {
298       writeLockA.lock();
299       fail("Expected PotentialDeadlockException");
300     } catch (PotentialDeadlockException expected) {
301       checkMessage(expected, "ReadWriteB -&gt; ReadWriteA", "ReadWriteA -&gt; ReadWriteB");
302     }
303   }
304   public void testDifferentLockFactories() {
305     CycleDetectingLockFactory otherFactory = CycleDetectingLockFactory.newInstance(Policies.WARN);
306     ReentrantLock lockD = otherFactory.newReentrantLock("LockD");
307     lockA.lock();
308     lockD.lock();
309     lockA.unlock();
310     lockD.unlock();
311     lockD.lock();
312     try {
313       lockA.lock();
314       fail("Expected PotentialDeadlockException");
315     } catch (PotentialDeadlockException expected) {
316       checkMessage(expected, "LockD -&gt; LockA", "LockA -&gt; LockD");
317     }
318 <a name="5"></a>  }
319   public void testDifferentLockFactories_policyExecution() {
320     CycleDetectingLockFactory otherFactory = <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>CycleDetectingLockFactory.newInstance(Policies.WARN);
321     ReentrantLock lockD = otherFactory.newReentrantLock("LockD");
322     lockD.lock();
323     lockA.lock();
324     lockA.unlock();
325     lockD.unlock();
326     lockA.lock();
327     lockD.lock();
328   }
329 <a name="7"></a>
330   public void testReentrant</b></font>Lock_tryLock() throws Exception {
331     LockingThread thread = new LockingThread(lockA);
332     <font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>thread.start();
333     thread.waitUntilHoldingLock();
334     assertFalse(lockA.tryLock());
335     thread.releaseLockAndFinish();
336     assertTrue(lockA.tryLock());
337   }
338 <a name="2"></a>
339   public void testReentrantWrite</b></font>Lock_tryLock() throws Exception {
340     LockingThread thread = new LockingThread(writeLockA);
341     <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>thread.start();
342     thread.waitUntilHoldingLock();
343     assertFalse(writeLockA.tryLock());
344     assertFalse(readLockA.tryLock());
345     thread.releaseLockAndFinish();
346     assertTrue(writeLockA.tryLock());
347     assertTrue(readLockA.tryLock());
348   }
349 <a name="3"></a>
350   public void testReentrantReadLock_tryLock() throws Exception {</b></font>
351     LockingThread thread = new LockingThread(readLockA);
352     <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>thread.start();
353     thread.waitUntilHoldingLock();
354     assertFalse(writeLockA.tryLock());
355     assertTrue(readLockA.tryLock());
356     readLockA.unlock();
357     thread.releaseLockAndFinish();
358     assertTrue(writeLockA.tryLock());
359     assertTrue(readLockA.tryLock());
360   }</b></font>
361   private static class LockingThread extends Thread {
362     final CountDownLatch locked = new CountDownLatch(1);
363     final CountDownLatch finishLatch = new CountDownLatch(1);
364     final Lock lock;
365     LockingThread(Lock lock) {
366       this.lock = lock;
367     }
368     @Override
369     public void run() {
370       lock.lock();
371       try {
372         locked.countDown();
373         finishLatch.await(1, TimeUnit.MINUTES);
374       } catch (InterruptedException e) {
375         fail(e.toString());
376       } finally {
377         lock.unlock();
378       }
379     }
380     void waitUntilHoldingLock() throws InterruptedException {
381       locked.await(1, TimeUnit.MINUTES);
382     }
383     void releaseLockAndFinish() throws InterruptedException {
384       finishLatch.countDown();
385       this.join(10000);
386       assertFalse(this.isAlive());
387     }
388   }
389   public void testReentrantReadWriteLock_implDoesNotExposeShadowedLocks() {
390     assertEquals(
391         "Unexpected number of public methods in ReentrantReadWriteLock. "
392             + "The correctness of CycleDetectingReentrantReadWriteLock depends on "
393             + "the fact that the shadowed ReadLock and WriteLock are never used or "
394             + "exposed by the superclass implementation. If the implementation has "
395             + "changed, the code must be re-inspected to ensure that the "
396             + "assumption is still valid.",
397         24,
398         ReentrantReadWriteLock.class.getMethods().length);
399   }
400   private enum MyOrder {
401     FIRST,
402     SECOND,
403     THIRD;
404   }
405   private enum OtherOrder {
406     FIRST,
407     SECOND,
408     THIRD;
409   }
410   private void checkMessage(IllegalStateException exception, String... expectedLockCycle) {
411     String regex = Joiner.on("\\b.*\\b").join(expectedLockCycle);
412     assertContainsRegex(regex, exception.getMessage());
413   }
414   private static void assertContainsRegex(String expectedRegex, String actual) {
415     Pattern pattern = Pattern.compile(expectedRegex);
416     Matcher matcher = pattern.matcher(actual);
417     if (!matcher.find()) {
418       String actualDesc = (actual == null) ? "null" : ('&lt;' + actual + '&gt;');
419       fail("expected to contain regex:&lt;" + expectedRegex + "&gt; but was:" + actualDesc);
420     }
421   }
422 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>AbstractStandardDirectedGraphTest_1.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 package com.google.common.graph;
2 import static com.google.common.graph.GraphConstants.ENDPOINTS_MISMATCH;
3 import static com.google.common.truth.Truth.assertThat;
4 import static com.google.common.truth.TruthJUnit.assume;
5 import static org.junit.Assert.assertTrue;
6 import static org.junit.Assert.fail;
7 import java.util.Set;
8 import org.junit.Test;
9 public abstract class AbstractStandardDirectedGraphTest extends AbstractGraphTest {
10 <a name="1"></a>
11   @Override
12   @Test
13   public void nodes_checkReturnedSetMutability() <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>{
14     assume().that(graphIsMutable()).isTrue();
15     Set&lt;Integer&gt; nodes = graph.nodes();
16     try {
17       nodes.add(N2);
18       fail(ERROR_MODIFIABLE_SET);
19     } catch (UnsupportedOperationException e) {
20       addNode</b></font>(N1);
21       assertThat(graph.nodes()).containsExactlyElementsIn(nodes);
22     }
23   }
24   @Override
25   @Test
26   public void adjacentNodes_checkReturnedSetMutability() {
27     assume().that(graphIsMutable()).isTrue();
28 <a name="4"></a>
29     addNode(N1);
30     Set&lt;Integer&gt; adjacentNodes = graph.adjacentNodes(N1);
31     <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>try {
32       adjacentNodes.add(N2);
33       fail(ERROR_MODIFIABLE_SET);
34     } catch (UnsupportedOperationException e) {
35       putEdge(N1, N2);
36       assertThat(graph.adjacentNodes(N1)).containsExactlyElementsIn(adjacentNodes);
37     }</b></font>
38   }
39   @Override
40   @Test
41   public void predecessors_checkReturnedSetMutability() {
42 <a name="12"></a>    assume().that(graphIsMutable()).isTrue();
43     addNode(N2);
44     Set&lt;Integer&gt; predecessors = <font color="#571b7e"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>graph.predecessors(N2);
45     try {
46       predecessors.add(N1);
47       fail(ERROR_MODIFIABLE_SET);
48     } catch (UnsupportedOperationException e) {
49       putEdge</b></font>(N1, N2);
50       assertThat(graph.predecessors(N2)).containsExactlyElementsIn(predecessors);
51     }
52   }
53   @Override
54   @Test
55   public void successors_checkReturnedSetMutability() {
56 <a name="11"></a>    assume().that(graphIsMutable()).isTrue();
57     addNode(N1);
58     Set&lt;Integer&gt; successors = <font color="#b041ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>graph.successors(N1);
59     try {
60       successors.add(N2);
61       fail(ERROR_MODIFIABLE_SET);
62     } catch (UnsupportedOperationException e) {
63       putEdge</b></font>(N1, N2);
64       assertThat(successors).containsExactlyElementsIn(graph.successors(N1));
65     }
66   }
67   @Override
68   @Test
69   public void incidentEdges_checkReturnedSetMutability() {
70     assume().that(graphIsMutable()).isTrue();
71     addNode(N1);
72     Set&lt;EndpointPair&lt;Integer&gt;&gt; incidentEdges = graph.incidentEdges(N1);
73     try {
74       incidentEdges.add(EndpointPair.ordered(N1, N2));
75       fail(ERROR_MODIFIABLE_SET);
76     } catch (UnsupportedOperationException e) {
77       putEdge(N1, N2);
78       assertThat(incidentEdges).containsExactlyElementsIn(graph.incidentEdges(N1));
79     }
80   }
81 <a name="7"></a>
82   @Test
83   public void predecessors_oneEdge() {
84     <font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>putEdge(N1, N2);
85     assertThat(graph.predecessors(N2)).containsExactly(N1);
86     assertThat(graph.predecessors(N1)).isEmpty();
87   }
88   @Test</b></font>
89   public void successors_oneEdge() {
90     putEdge(N1, N2);
91     assertThat(graph.successors(N1)).containsExactly(N2);
92     assertThat(graph.successors(N2)).isEmpty();
93   }
94 <a name="5"></a>
95   @Test
96   public void incidentEdges_oneEdge() {
97     <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>putEdge(N1, N2);
98     EndpointPair&lt;Integer&gt; expectedEndpoints = EndpointPair.ordered(N1, N2);
99     assertThat(graph.incidentEdges(N1)).containsExactly(expectedEndpoints);
100     assertThat(graph.incidentEdges(N2)).containsExactly(expectedEndpoints);
101   }
102   @Test</b></font>
103   public void inDegree_oneEdge() {
104     putEdge(N1, N2);
105     assertThat(graph.inDegree(N2)).isEqualTo(1);
106     assertThat(graph.inDegree(N1)).isEqualTo(0);
107   }
108   @Test
109   public void outDegree_oneEdge() {
110     putEdge(N1, N2);
111     assertThat(graph.outDegree(N1)).isEqualTo(1);
112     assertThat(graph.outDegree(N2)).isEqualTo(0);
113 <a name="13"></a>  }
114   @Test
115   public void hasEdgeConnecting_correct() <font color="#3b9c9c"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>{
116     putEdge(N1, N2);
117     assertThat(graph.hasEdgeConnecting(EndpointPair.ordered(N1, N2))).isTrue();
118   }
119   @Test</b></font>
120   public void hasEdgeConnecting_backwards() {
121     putEdge(N1, N2);
122     assertThat(graph.hasEdgeConnecting(EndpointPair.ordered(N2, N1))).isFalse();
123   }
124 <a name="6"></a>
125   @Test
126   public void hasEdgeConnecting_mismatch() {
127     <font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>putEdge(N1, N2);
128     assertThat(graph.hasEdgeConnecting(EndpointPair.unordered(N1, N2))).isFalse();
129     assertThat(graph.hasEdgeConnecting(EndpointPair.unordered(N2, N1))).isFalse();
130 <a name="8"></a>  }
131   @Test</b></font>
132   public void adjacentNodes_selfLoop() <font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>{
133     assume().that(graph.allowsSelfLoops()).isTrue();
134     putEdge(N1, N1);
135     putEdge(N1, N2);
136     assertThat(graph.adjacentNodes</b></font>(N1)).containsExactly(N1, N2);
137   }
138 <a name="3"></a>
139   @Test
140   public void predecessors_selfLoop() {
141     <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assume().that(graph.allowsSelfLoops()).isTrue();
142     putEdge(N1, N1);
143     assertThat(graph.predecessors(N1)).containsExactly(N1);
144     putEdge(N4, N1);
145     assertThat(graph.predecessors(N1)).containsExactly(N1, N4);
146   }</b></font>
147   @Test
148   public void successors_selfLoop() {
149     assume().that(graph.allowsSelfLoops()).isTrue();
150     putEdge(N1, N1);
151     assertThat(graph.successors(N1)).containsExactly(N1);
152     putEdge(N1, N2);
153     assertThat(graph.successors(N1)).containsExactly(N1, N2);
154   }
155   @Test
156   public void incidentEdges_selfLoop() {
157     assume().that(graph.allowsSelfLoops()).isTrue();
158     putEdge(N1, N1);
159     assertThat(graph.incidentEdges(N1)).containsExactly(EndpointPair.ordered(N1, N1));
160     putEdge(N1, N2);
161     assertThat(graph.incidentEdges(N1))
162         .containsExactly(EndpointPair.ordered(N1, N1), EndpointPair.ordered(N1, N2));
163   }
164   @Test
165   public void degree_selfLoop() {
166     assume().that(graph.allowsSelfLoops()).isTrue();
167     putEdge(N1, N1);
168     assertThat(graph.degree(N1)).isEqualTo(2);
169     putEdge(N1, N2);
170     assertThat(graph.degree(N1)).isEqualTo(3);
171   }
172   @Test
173   public void inDegree_selfLoop() {
174     assume().that(graph.allowsSelfLoops()).isTrue();
175     putEdge(N1, N1);
176     assertThat(graph.inDegree(N1)).isEqualTo(1);
177     putEdge(N4, N1);
178     assertThat(graph.inDegree(N1)).isEqualTo(2);
179   }
180   @Test
181   public void outDegree_selfLoop() {
182     assume().that(graph.allowsSelfLoops()).isTrue();
183     putEdge(N1, N1);
184     assertThat(graph.outDegree(N1)).isEqualTo(1);
185     putEdge(N1, N2);
186     assertThat(graph.outDegree(N1)).isEqualTo(2);
187   }
188   @Test
189   public void stableIncidentEdgeOrder_edges_returnsInStableOrder() {
190     assume().that(graph.incidentEdgeOrder().type()).isEqualTo(ElementOrder.Type.STABLE);
191     populateStarShapedGraph();
192     assertThat(graph.edges())
193         .containsExactly(
194             EndpointPair.ordered(2, 1),
195             EndpointPair.ordered(1, 4),
196             EndpointPair.ordered(1, 3),
197             EndpointPair.ordered(1, 2),
198             EndpointPair.ordered(3, 1),
199             EndpointPair.ordered(5, 1))
200         .inOrder();
201   }
202   @Test
203   public void stableIncidentEdgeOrder_adjacentNodes_returnsInConnectingEdgeInsertionOrder() {
204     assume().that(graph.incidentEdgeOrder().type()).isEqualTo(ElementOrder.Type.STABLE);
205     populateStarShapedGraph();
206     assertThat(graph.adjacentNodes(1)).containsExactly(2, 4, 3, 5).inOrder();
207   }
208   @Test
209   public void stableIncidentEdgeOrder_predecessors_returnsInConnectingEdgeInsertionOrder() {
210     assume().that(graph.incidentEdgeOrder().type()).isEqualTo(ElementOrder.Type.STABLE);
211     populateStarShapedGraph();
212     assertThat(graph.predecessors(1)).containsExactly(2, 5, 3).inOrder();
213   }
214   @Test
215   public void stableIncidentEdgeOrder_successors_returnsInConnectingEdgeInsertionOrder() {
216     assume().that(graph.incidentEdgeOrder().type()).isEqualTo(ElementOrder.Type.STABLE);
217     populateStarShapedGraph();
218     assertThat(graph.successors(1)).containsExactly(4, 3, 2).inOrder();
219   }
220   @Test
221   public void stableIncidentEdgeOrder_incidentEdges_returnsInEdgeInsertionOrder() {
222     assume().that(graph.incidentEdgeOrder().type()).isEqualTo(ElementOrder.Type.STABLE);
223     populateStarShapedGraph();
224     assertThat(graph.incidentEdges(1))
225         .containsExactly(
226             EndpointPair.ordered(2, 1),
227             EndpointPair.ordered(1, 4),
228             EndpointPair.ordered(1, 3),
229             EndpointPair.ordered(5, 1),
230             EndpointPair.ordered(1, 2),
231             EndpointPair.ordered(3, 1))
232         .inOrder();
233   }
234   @Test
235   public void stableIncidentEdgeOrder_incidentEdges_withSelfLoop_returnsInEdgeInsertionOrder() {
236     assume().that(graph.incidentEdgeOrder().type()).isEqualTo(ElementOrder.Type.STABLE);
237 <a name="2"></a>    assume().that(graph.allowsSelfLoops()).isTrue();
238     putEdge(2, 1);
239     <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>putEdge(1, 1);
240     putEdge(1, 3);
241     putEdge(1, 2);
242     assertThat(graph.incidentEdges(1))
243         .containsExactly(
244             EndpointPair.ordered(2, 1),
245             EndpointPair.ordered(1, 1),
246             EndpointPair.ordered(1, 3),
247             EndpointPair.ordered(1, 2))
248         .inOrder();
249   }
250   private void populateStarShapedGraph() {</b></font>
251     putEdge(2, 1);
252     putEdge(1, 4);
253     putEdge(1, 3);
254     putEdge(5, 1);
255     putEdge(1, 2);
256     putEdge(3, 1);
257   }
258   @Test
259   public void putEdge_existingNodes() {
260     assume().that(graphIsMutable()).isTrue();
261     addNode(N1);
262     addNode(N2);
263     assertThat(graphAsMutableGraph.putEdge(N1, N2)).isTrue();
264   }
265   @Test
266   public void putEdge_existingEdgeBetweenSameNodes() {
267     assume().that(graphIsMutable()).isTrue();
268     assertThat(graphAsMutableGraph.putEdge(N1, N2)).isTrue();
269     assertThat(graphAsMutableGraph.putEdge(N1, N2)).isFalse();
270   }
271   @Test
272 <a name="10"></a>  public void putEdge_orderMismatch() {
273     assume().that(graphIsMutable()).isTrue();
274     EndpointPair&lt;Integer&gt; endpoints = <font color="#ad5910"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>EndpointPair.unordered(N1, N2);
275     try {
276       graphAsMutableGraph.putEdge(endpoints);
277       fail("Expected IllegalArgumentException: " + ENDPOINTS_MISMATCH);
278     } catch (IllegalArgumentException e) {
279       assertThat(e).hasMessageThat().contains</b></font>(ENDPOINTS_MISMATCH);
280     }
281   }
282   @Test
283   public void putEdge_nodesNotInGraph() {
284     assume().that(graphIsMutable()).isTrue();
285     graphAsMutableGraph.addNode(N1);
286     assertTrue(graphAsMutableGraph.putEdge(N1, N5));
287     assertTrue(graphAsMutableGraph.putEdge(N4, N1));
288     assertTrue(graphAsMutableGraph.putEdge(N2, N3));
289     assertThat(graph.nodes()).containsExactly(N1, N5, N4, N2, N3).inOrder();
290     assertThat(graph.successors(N1)).containsExactly(N5);
291     assertThat(graph.successors(N2)).containsExactly(N3);
292     assertThat(graph.successors(N3)).isEmpty();
293     assertThat(graph.successors(N4)).containsExactly(N1);
294     assertThat(graph.successors(N5)).isEmpty();
295   }
296 <a name="0"></a>
297   @Test
298   public void putEdge_doesntAllowSelfLoops() {
299     <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assume().that(graphIsMutable()).isTrue();
300     assume().that(graph.allowsSelfLoops()).isFalse();
301     try {
302       graphAsMutableGraph.putEdge(N1, N1);
303       fail(ERROR_ADDED_SELF_LOOP);
304     } catch (IllegalArgumentException e) {
305       assertThat(e).hasMessageThat().contains</b></font>(ERROR_SELF_LOOP);
306     }
307   }
308   @Test
309   public void putEdge_allowsSelfLoops() {
310     assume().that(graphIsMutable()).isTrue();
311     assume().that(graph.allowsSelfLoops()).isTrue();
312     assertThat(graphAsMutableGraph.putEdge(N1, N1)).isTrue();
313     assertThat(graph.successors(N1)).containsExactly(N1);
314     assertThat(graph.predecessors(N1)).containsExactly(N1);
315   }
316   @Test
317   public void putEdge_existingSelfLoopEdgeBetweenSameNodes() {
318     assume().that(graphIsMutable()).isTrue();
319     assume().that(graph.allowsSelfLoops()).isTrue();
320     graphAsMutableGraph.putEdge(N1, N1);
321     assertThat(graphAsMutableGraph.putEdge(N1, N1)).isFalse();
322   }
323   @Test
324   public void removeEdge_antiparallelEdges() {
325     assume().that(graphIsMutable()).isTrue();
326     putEdge(N1, N2);
327     putEdge(N2, N1);
328     assertThat(graphAsMutableGraph.removeEdge(N1, N2)).isTrue();
329     assertThat(graph.successors(N1)).isEmpty();
330     assertThat(graph.predecessors(N1)).containsExactly(N2);
331     assertThat(graph.edges()).hasSize(1);
332     assertThat(graphAsMutableGraph.removeEdge(N2, N1)).isTrue();
333     assertThat(graph.successors(N1)).isEmpty();
334     assertThat(graph.predecessors(N1)).isEmpty();
335     assertThat(graph.edges()).isEmpty();
336   }
337   @Test
338   public void removeEdge_orderMismatch() {
339 <a name="9"></a>    assume().that(graphIsMutable()).isTrue();
340     putEdge(N1, N2);
341     EndpointPair&lt;Integer&gt; endpoints = <font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>EndpointPair.unordered(N1, N2);
342     try {
343       graphAsMutableGraph.removeEdge(endpoints);
344       fail("Expected IllegalArgumentException: " + ENDPOINTS_MISMATCH);
345     } catch (IllegalArgumentException e) {
346       assertThat(e).hasMessageThat().contains</b></font>(ENDPOINTS_MISMATCH);
347     }
348   }
349   @Test
350   public void removeNode_existingNodeWithSelfLoopEdge() {
351     assume().that(graphIsMutable()).isTrue();
352     assume().that(graph.allowsSelfLoops()).isTrue();
353     addNode(N1);
354     putEdge(N1, N1);
355     assertThat(graphAsMutableGraph.removeNode(N1)).isTrue();
356     assertThat(graph.nodes()).isEmpty();
357   }
358   @Test
359   public void removeEdge_existingSelfLoopEdge() {
360     assume().that(graphIsMutable()).isTrue();
361     assume().that(graph.allowsSelfLoops()).isTrue();
362     putEdge(N1, N1);
363     assertThat(graphAsMutableGraph.removeEdge(N1, N1)).isTrue();
364     assertThat(graph.nodes()).containsExactly(N1);
365     assertThat(graph.successors(N1)).isEmpty();
366   }
367 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
