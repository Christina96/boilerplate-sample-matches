<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for WebSocketServerExtensionHandlerTest.java &amp; WebSocketServerProtocolHandlerTest.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for WebSocketServerExtensionHandlerTest.java &amp; WebSocketServerProtocolHandlerTest.java
      </h3>
<h1 align="center">
        35.9%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>WebSocketServerExtensionHandlerTest.java (55.454544%)<th>WebSocketServerProtocolHandlerTest.java (26.637554%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(159-170)<td><a href="#" name="0">(343-354)</a><td align="center"><font color="#ff0000">18</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(95-105)<td><a href="#" name="1">(318-329)</a><td align="center"><font color="#ff0000">18</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(81-89)<td><a href="#" name="2">(381-393)</a><td align="center"><font color="#ff0000">18</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(18-40)<td><a href="#" name="3">(37-58)</a><td align="center"><font color="#ff0000">18</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(140-148)<td><a href="#" name="4">(330-341)</a><td align="center"><font color="#e20000">16</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(199-207)<td><a href="#" name="5">(371-380)</a><td align="center"><font color="#d40000">15</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(114-120)<td><a href="#" name="6">(357-367)</a><td align="center"><font color="#c60000">14</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(59-65)<td><a href="#" name="7">(305-315)</a><td align="center"><font color="#c60000">14</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(190-199)<td><a href="#" name="8">(77-84)</a><td align="center"><font color="#aa0000">12</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(123-126)<td><a href="#" name="9">(476-481)</a><td align="center"><font color="#9b0000">11</font>
<tr onclick='openModal("#ad5910")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#ad5910"><font color="#ad5910">-</font><td><a href="#" name="10">(223-229)<td><a href="#" name="10">(395-400)</a><td align="center"><font color="#8d0000">10</font>
<tr onclick='openModal("#b041ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#b041ff"><font color="#b041ff">-</font><td><a href="#" name="11">(209-215)<td><a href="#" name="11">(112-122)</a><td align="center"><font color="#8d0000">10</font>
<tr onclick='openModal("#571b7e")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#571b7e"><font color="#571b7e">-</font><td><a href="#" name="12">(52-57)<td><a href="#" name="12">(102-106)</a><td align="center"><font color="#7f0000">9</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>WebSocketServerExtensionHandlerTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 /*
2  * Copyright 2014 The Netty Project
3  *
4  * The Netty Project licenses this file to you under the Apache License,
5  * version 2.0 (the "License"); you may not use this file except in compliance
6  * with the License. You may obtain a copy of the License at:
7  *
8  *   https://www.apache.org/licenses/LICENSE-2.0
9  *
10  * Unless required by applicable law or agreed to in writing, software
11  * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
12  * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
13  * License for the specific language governing permissions and limitations
14  * under the License.
15 <a name="3"></a> */
16 package io.netty.handler.codec.http.websocketx.extensions;
17 <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>import io.netty.channel.ChannelPromise;
18 import io.netty.channel.embedded.EmbeddedChannel;
19 import io.netty.handler.codec.http.HttpHeaderNames;
20 import io.netty.handler.codec.http.HttpRequest;
21 import io.netty.handler.codec.http.HttpResponse;
22 import java.io.IOException;
23 import java.util.Collections;
24 import java.util.List;
25 import org.junit.jupiter.api.Test;
26 import static io.netty.handler.codec.http.websocketx.extensions.WebSocketExtensionTestUtil.*;
27 import static org.junit.jupiter.api.Assertions.assertEquals;
28 import static org.junit.jupiter.api.Assertions.assertFalse;
29 import static org.junit.jupiter.api.Assertions.assertNotNull;
30 import static org.junit.jupiter.api.Assertions.assertNull;
31 import static org.junit.jupiter.api.Assertions.assertTrue;
32 import static org.mockito.Mockito.*;
33 public class WebSocketServerExtensionHandlerTest {
34     WebSocketServerExtensionHandshaker mainHandshakerMock =</b></font>
35             mock(WebSocketServerExtensionHandshaker.class, "mainHandshaker");
36     WebSocketServerExtensionHandshaker fallbackHandshakerMock =
37             mock(WebSocketServerExtensionHandshaker.class, "fallbackHandshaker");
38     WebSocketServerExtension mainExtensionMock =
39             mock(WebSocketServerExtension.class, "mainExtension");
40     WebSocketServerExtension fallbackExtensionMock =
41             mock(WebSocketServerExtension.class, "fallbackExtension");
42 <a name="12"></a>    @Test
43     public void testMainSuccess() {
44         <font color="#571b7e"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>when(mainHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("main"))).
45                 thenReturn(mainExtensionMock);
46         when(mainHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("fallback"))).
47                 thenReturn(null);
48 <a name="7"></a>
49         when(fallbackHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("fallback"))).</b></font>
50                 thenReturn(fallbackExtensionMock);
51         <font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>when(fallbackHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("main"))).
52                 thenReturn(null);
53         when(mainExtensionMock.rsv()).thenReturn(WebSocketExtension.RSV1);
54         when(mainExtensionMock.newReponseData()).thenReturn(
55                 new WebSocketExtensionData("main", Collections.&lt;String, String&gt;emptyMap()));
56         when(mainExtensionMock.newExtensionEncoder</b></font>()).thenReturn(new DummyEncoder());
57         when(mainExtensionMock.newExtensionDecoder()).thenReturn(new DummyDecoder());
58         when(fallbackExtensionMock.rsv()).thenReturn(WebSocketExtension.RSV1);
59         WebSocketServerExtensionHandler extensionHandler =
60                 new WebSocketServerExtensionHandler(mainHandshakerMock, fallbackHandshakerMock);
61         EmbeddedChannel ch = new EmbeddedChannel(extensionHandler);
62         HttpRequest req = newUpgradeRequest("main, fallback");
63         ch.writeInbound(req);
64 <a name="2"></a>        HttpResponse res = newUpgradeResponse(null);
65         ch.writeOutbound(res);
66         <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>HttpResponse res2 = ch.readOutbound();
67         List&lt;WebSocketExtensionData&gt; resExts = WebSocketExtensionUtil.extractExtensions(
68                 res2.headers().get(HttpHeaderNames.SEC_WEBSOCKET_EXTENSIONS));
69         assertNull(ch.pipeline().context(extensionHandler));
70         assertEquals(1, resExts.size());
71         assertEquals("main", resExts.get(0).name());
72         assertTrue(resExts.get</b></font>(0).parameters().isEmpty());
73         assertNotNull(ch.pipeline().get(DummyDecoder.class));
74         assertNotNull(ch.pipeline().get(DummyEncoder.class));
75 <a name="1"></a>
76         verify(mainHandshakerMock, atLeastOnce()).handshakeExtension(webSocketExtensionDataMatcher("main"));
77         verify(mainHandshakerMock, atLeastOnce()).handshakeExtension(webSocketExtensionDataMatcher("fallback"));
78         verify(fallbackHandshakerMock, atLeastOnce()).handshakeExtension(<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>webSocketExtensionDataMatcher("fallback"));
79         verify(mainExtensionMock, atLeastOnce()).rsv();
80         verify(mainExtensionMock).newReponseData();
81         verify(mainExtensionMock).newExtensionEncoder();
82         verify(mainExtensionMock).newExtensionDecoder();
83         verify(fallbackExtensionMock, atLeastOnce()).rsv();
84     }
85     @Test
86     public void testCompatibleExtensionTogetherSuccess() {</b></font>
87         when(mainHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("main"))).
88                 thenReturn(mainExtensionMock);
89         when(mainHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("fallback"))).
90                 thenReturn(null);
91 <a name="6"></a>
92         when(fallbackHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("fallback"))).
93                 thenReturn(fallbackExtensionMock);
94         <font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>when(fallbackHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("main"))).
95                 thenReturn(null);
96         when(mainExtensionMock.rsv()).thenReturn(WebSocketExtension.RSV1);
97         when(mainExtensionMock.newReponseData()).thenReturn(
98                 new WebSocketExtensionData("main", Collections.&lt;String, String&gt;emptyMap()));
99 <a name="9"></a>        when(mainExtensionMock.newExtensionEncoder</b></font>()).thenReturn(new DummyEncoder());
100         when(mainExtensionMock.newExtensionDecoder()).thenReturn(new DummyDecoder());
101         <font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>when(fallbackExtensionMock.rsv()).thenReturn(WebSocketExtension.RSV2);
102         when(fallbackExtensionMock.newReponseData()).thenReturn(
103                 new WebSocketExtensionData("fallback", Collections.&lt;String, String&gt;emptyMap()));
104         when(fallbackExtensionMock.newExtensionEncoder</b></font>()).thenReturn(new Dummy2Encoder());
105         when(fallbackExtensionMock.newExtensionDecoder()).thenReturn(new Dummy2Decoder());
106         WebSocketServerExtensionHandler extensionHandler =
107                 new WebSocketServerExtensionHandler(mainHandshakerMock, fallbackHandshakerMock);
108         EmbeddedChannel ch = new EmbeddedChannel(extensionHandler);
109         HttpRequest req = newUpgradeRequest("main, fallback");
110         ch.writeInbound(req);
111 <a name="4"></a>        HttpResponse res = newUpgradeResponse(null);
112         ch.writeOutbound(res);
113         <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>HttpResponse res2 = ch.readOutbound();
114         List&lt;WebSocketExtensionData&gt; resExts = WebSocketExtensionUtil.extractExtensions(
115                 res2.headers().get(HttpHeaderNames.SEC_WEBSOCKET_EXTENSIONS));
116         assertNull(ch.pipeline().context(extensionHandler));
117         assertEquals(2, resExts.size());
118         assertEquals("main", resExts.get(0).name());
119         assertEquals("fallback", resExts.get(1).name</b></font>());
120         assertNotNull(ch.pipeline().get(DummyDecoder.class));
121         assertNotNull(ch.pipeline().get(DummyEncoder.class));
122         assertNotNull(ch.pipeline().get(Dummy2Decoder.class));
123         assertNotNull(ch.pipeline().get(Dummy2Encoder.class));
124         verify(mainHandshakerMock).handshakeExtension(webSocketExtensionDataMatcher("main"));
125         verify(mainHandshakerMock).handshakeExtension(webSocketExtensionDataMatcher("fallback"));
126 <a name="0"></a>        verify(fallbackHandshakerMock).handshakeExtension(webSocketExtensionDataMatcher("fallback"));
127         verify(mainExtensionMock, times(2)).rsv();
128         verify(mainExtensionMock).newReponseData();
129         <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>verify(mainExtensionMock).newExtensionEncoder();
130         verify(mainExtensionMock).newExtensionDecoder();
131         verify(fallbackExtensionMock, times(2)).rsv();
132         verify(fallbackExtensionMock).newReponseData();
133         verify(fallbackExtensionMock).newExtensionEncoder();
134         verify(fallbackExtensionMock).newExtensionDecoder();
135     }
136     @Test
137     public void testNoneExtensionMatchingSuccess() {</b></font>
138         when(mainHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("unknown"))).
139                 thenReturn(null);
140         when(mainHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("unknown2"))).
141                 thenReturn(null);
142         when(fallbackHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("unknown"))).
143                 thenReturn(null);
144         when(fallbackHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("unknown2"))).
145                 thenReturn(null);
146         WebSocketServerExtensionHandler extensionHandler =
147                 new WebSocketServerExtensionHandler(mainHandshakerMock, fallbackHandshakerMock);
148         EmbeddedChannel ch = new EmbeddedChannel(extensionHandler);
149 <a name="8"></a>        HttpRequest req = newUpgradeRequest("unknown, unknown2");
150         ch.writeInbound(req);
151         HttpResponse res = <font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>newUpgradeResponse(null);
152         ch.writeOutbound(res);
153         HttpResponse res2 = ch.readOutbound();
154 <a name="5"></a>        assertNull(ch.pipeline().context(extensionHandler));
155         assertFalse(res2.headers().contains(HttpHeaderNames.SEC_WEBSOCKET_EXTENSIONS));
156         verify</b></font>(mainHandshakerMock).handshakeExtension(<font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>webSocketExtensionDataMatcher("unknown"));
157         verify(mainHandshakerMock).handshakeExtension(webSocketExtensionDataMatcher("unknown2"));
158         verify(fallbackHandshakerMock).handshakeExtension(webSocketExtensionDataMatcher("unknown"));
159         verify(fallbackHandshakerMock).handshakeExtension(webSocketExtensionDataMatcher("unknown2"));
160     }
161 <a name="11"></a>    @Test
162     public void testExtensionHandlerNotRemovedByFailureWritePromise() {</b></font>
163         <font color="#b041ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>when(mainHandshakerMock.handshakeExtension(webSocketExtensionDataMatcher("main")))
164                 .thenReturn(mainExtensionMock);
165         when(mainExtensionMock.newReponseData()).thenReturn(
166                 new WebSocketExtensionData("main", Collections.&lt;String, String&gt;emptyMap()));
167         WebSocketServerExtensionHandler extensionHandler =</b></font>
168                 new WebSocketServerExtensionHandler(mainHandshakerMock);
169         EmbeddedChannel ch = new EmbeddedChannel(extensionHandler);
170         HttpRequest req = newUpgradeRequest("main");
171 <a name="10"></a>        ch.writeInbound(req);
172         HttpResponse res = newUpgradeResponse(null);
173         <font color="#ad5910"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>ChannelPromise failurePromise = ch.newPromise();
174         ch.writeOneOutbound(res, failurePromise);
175         failurePromise.setFailure(new IOException("Cannot write response"));
176         assertNull(ch.readOutbound());
177         assertNotNull(ch.pipeline</b></font>().context(extensionHandler));
178         assertTrue(ch.finish());
179     }
180 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>WebSocketServerProtocolHandlerTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 /*
2  * Copyright 2012 The Netty Project
3  *
4  * The Netty Project licenses this file to you under the Apache License, version
5  * 2.0 (the "License"); you may not use this file except in compliance with the
6  * License. You may obtain a copy of the License at:
7  *
8  * https://www.apache.org/licenses/LICENSE-2.0
9  *
10  * Unless required by applicable law or agreed to in writing, software
11  * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
12  * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
13  * License for the specific language governing permissions and limitations under
14  * the License.
15  */
16 package io.netty.handler.codec.http.websocketx;
17 import io.netty.buffer.ByteBuf;
18 import io.netty.channel.ChannelHandler;
19 import io.netty.channel.ChannelHandlerContext;
20 import io.netty.channel.ChannelInboundHandlerAdapter;
21 import io.netty.channel.ChannelOutboundHandlerAdapter;
22 import io.netty.channel.ChannelPromise;
23 import io.netty.channel.embedded.EmbeddedChannel;
24 import io.netty.handler.codec.http.DefaultHttpContent;
25 import io.netty.handler.codec.http.DefaultHttpRequest;
26 import io.netty.handler.codec.http.HttpClientCodec;
27 import io.netty.handler.codec.http.HttpHeaderValues;
28 import io.netty.handler.codec.http.HttpRequestDecoder;
29 import io.netty.handler.codec.http.HttpResponseEncoder;
30 import io.netty.handler.codec.http.FullHttpRequest;
31 import io.netty.handler.codec.http.FullHttpResponse;
32 <a name="3"></a>import io.netty.handler.codec.http.HttpMethod;
33 import io.netty.handler.codec.http.HttpRequest;
34 import io.netty.handler.codec.http.HttpObjectAggregator;
35 <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>import io.netty.handler.codec.http.HttpServerCodec;
36 import io.netty.handler.codec.http.HttpHeaderNames;
37 import io.netty.handler.codec.http.LastHttpContent;
38 import io.netty.util.CharsetUtil;
39 import io.netty.util.ReferenceCountUtil;
40 import org.junit.jupiter.api.BeforeEach;
41 import org.junit.jupiter.api.Test;
42 import java.util.ArrayDeque;
43 import java.util.Queue;
44 import static io.netty.handler.codec.http.HttpResponseStatus.*;
45 import static io.netty.handler.codec.http.HttpVersion.*;
46 import static org.junit.jupiter.api.Assertions.assertEquals;
47 import static org.junit.jupiter.api.Assertions.assertFalse;
48 import static org.junit.jupiter.api.Assertions.assertNotNull;
49 import static org.junit.jupiter.api.Assertions.assertNull;
50 import static org.junit.jupiter.api.Assertions.assertTrue;
51 public class WebSocketServerProtocolHandlerTest {
52     private final Queue&lt;FullHttpResponse&gt; responses = new ArrayDeque&lt;FullHttpResponse&gt;()</b></font>;
53     @BeforeEach
54     public void setUp() {
55         responses.clear();
56     }
57     @Test
58     public void testHttpUpgradeRequestFull() {
59         testHttpUpgradeRequest0(true);
60     }
61     @Test
62     public void testHttpUpgradeRequestNonFull() {
63         testHttpUpgradeRequest0(false);
64     }
65 <a name="8"></a>
66     private void testHttpUpgradeRequest0(boolean full) {
67         EmbeddedChannel ch = createChannel(new MockOutboundHandler());
68         ChannelHandlerContext handshakerCtx = <font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ch.pipeline().context(WebSocketServerProtocolHandshakeHandler.class);
69         writeUpgradeRequest(ch, full);
70         FullHttpResponse response = responses.remove();
71         assertEquals(SWITCHING_PROTOCOLS, response.status());
72         response.release();
73         assertNotNull(WebSocketServerProtocolHandler.getHandshaker(handshakerCtx.channel()));
74         assertFalse(ch.finish</b></font>());
75     }
76     @Test
77     public void testWebSocketServerProtocolHandshakeHandlerReplacedBeforeHandshake() {
78         EmbeddedChannel ch = createChannel(new MockOutboundHandler());
79         ChannelHandlerContext handshakerCtx = ch.pipeline().context(WebSocketServerProtocolHandshakeHandler.class);
80         ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {
81             @Override
82             public void userEventTriggered(ChannelHandlerContext ctx, Object evt) {
83                 if (evt instanceof WebSocketServerProtocolHandler.HandshakeComplete) {
84                     assertNull(ctx.pipeline().context(WebSocketServerProtocolHandshakeHandler.class));
85                 }
86             }
87 <a name="12"></a>        });
88         writeUpgradeRequest(ch);
89         FullHttpResponse response = <font color="#571b7e"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>responses.remove();
90         assertEquals(SWITCHING_PROTOCOLS, response.status());
91         response.release();
92         assertNotNull(WebSocketServerProtocolHandler.getHandshaker(handshakerCtx.channel()));
93         assertFalse(ch.finish</b></font>());
94     }
95 <a name="11"></a>    @Test
96     public void testHttpUpgradeRequestInvalidUpgradeHeader() {
97         EmbeddedChannel ch = createChannel();
98         FullHttpRequest httpRequestWithEntity = <font color="#b041ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>new WebSocketRequestBuilder().httpVersion(HTTP_1_1)
99                 .method(HttpMethod.GET)
100                 .uri("/test")
101                 .connection("Upgrade")
102                 .version00()
103                 .upgrade("BogusSocket")
104                 .build();
105         ch.writeInbound(httpRequestWithEntity);
106         FullHttpResponse response = responses.remove()</b></font>;
107         assertEquals(BAD_REQUEST, response.status());
108         assertEquals("not a WebSocket handshake request: missing upgrade", getResponseMessage(response));
109         response.release();
110         assertFalse(ch.finish());
111     }
112     @Test
113     public void testHttpUpgradeRequestMissingWSKeyHeader() {
114         EmbeddedChannel ch = createChannel();
115         HttpRequest httpRequest = new WebSocketRequestBuilder().httpVersion(HTTP_1_1)
116                 .method(HttpMethod.GET)
117                 .uri("/test")
118                 .key(null)
119                 .connection("Upgrade")
120                 .upgrade(HttpHeaderValues.WEBSOCKET)
121                 .version13()
122                 .build();
123         ch.writeInbound(httpRequest);
124         FullHttpResponse response = responses.remove();
125         assertEquals(BAD_REQUEST, response.status());
126         assertEquals("not a WebSocket request: missing key", getResponseMessage(response));
127         response.release();
128         assertFalse(ch.finish());
129     }
130     @Test
131     public void testCreateUTF8Validator() {
132         WebSocketServerProtocolConfig config = WebSocketServerProtocolConfig.newBuilder()
133                 .websocketPath("/test")
134                 .withUTF8Validator(true)
135                 .build();
136         EmbeddedChannel ch = new EmbeddedChannel(
137                 new WebSocketServerProtocolHandler(config),
138                 new HttpRequestDecoder(),
139                 new HttpResponseEncoder(),
140                 new MockOutboundHandler());
141         writeUpgradeRequest(ch);
142         FullHttpResponse response = responses.remove();
143         assertEquals(SWITCHING_PROTOCOLS, response.status());
144         response.release();
145         assertNotNull(ch.pipeline().get(Utf8FrameValidator.class));
146     }
147     @Test
148     public void testDoNotCreateUTF8Validator() {
149         WebSocketServerProtocolConfig config = WebSocketServerProtocolConfig.newBuilder()
150                 .websocketPath("/test")
151                 .withUTF8Validator(false)
152                 .build();
153         EmbeddedChannel ch = new EmbeddedChannel(
154                 new WebSocketServerProtocolHandler(config),
155                 new HttpRequestDecoder(),
156                 new HttpResponseEncoder(),
157                 new MockOutboundHandler());
158         writeUpgradeRequest(ch);
159         FullHttpResponse response = responses.remove();
160         assertEquals(SWITCHING_PROTOCOLS, response.status());
161         response.release();
162         assertNull(ch.pipeline().get(Utf8FrameValidator.class));
163     }
164     @Test
165     public void testHandleTextFrame() {
166         CustomTextFrameHandler customTextFrameHandler = new CustomTextFrameHandler();
167         EmbeddedChannel ch = createChannel(customTextFrameHandler);
168         writeUpgradeRequest(ch);
169         FullHttpResponse response = responses.remove();
170         assertEquals(SWITCHING_PROTOCOLS, response.status());
171         response.release();
172         if (ch.pipeline().context(HttpRequestDecoder.class) != null) {
173             ch.pipeline().remove(HttpRequestDecoder.class);
174         }
175         ch.writeInbound(new TextWebSocketFrame("payload"));
176         assertEquals("processed: payload", customTextFrameHandler.getContent());
177         assertFalse(ch.finish());
178     }
179     @Test
180     public void testCheckWebSocketPathStartWithSlash() {
181         WebSocketRequestBuilder builder = new WebSocketRequestBuilder().httpVersion(HTTP_1_1)
182                 .method(HttpMethod.GET)
183                 .key(HttpHeaderNames.SEC_WEBSOCKET_KEY)
184                 .connection("Upgrade")
185                 .upgrade(HttpHeaderValues.WEBSOCKET)
186                 .version13();
187         WebSocketServerProtocolConfig config = WebSocketServerProtocolConfig.newBuilder()
188                 .websocketPath("/")
189                 .checkStartsWith(true)
190                 .build();
191         FullHttpResponse response;
192         createChannel(config, null).writeInbound(builder.uri("/test").build());
193         response = responses.remove();
194         assertEquals(SWITCHING_PROTOCOLS, response.status());
195         response.release();
196         createChannel(config, null).writeInbound(builder.uri("/?q=v").build());
197         response = responses.remove();
198         assertEquals(SWITCHING_PROTOCOLS, response.status());
199         response.release();
200         createChannel(config, null).writeInbound(builder.uri("/").build());
201         response = responses.remove();
202         assertEquals(SWITCHING_PROTOCOLS, response.status());
203         response.release();
204     }
205     @Test
206     public void testCheckValidWebSocketPath() {
207         HttpRequest httpRequest = new WebSocketRequestBuilder().httpVersion(HTTP_1_1)
208                 .method(HttpMethod.GET)
209                 .uri("/test")
210                 .key(HttpHeaderNames.SEC_WEBSOCKET_KEY)
211                 .connection("Upgrade")
212                 .upgrade(HttpHeaderValues.WEBSOCKET)
213                 .version13()
214                 .build();
215         WebSocketServerProtocolConfig config = WebSocketServerProtocolConfig.newBuilder()
216                 .websocketPath("/test")
217                 .checkStartsWith(true)
218                 .build();
219         EmbeddedChannel ch = new EmbeddedChannel(
220                 new WebSocketServerProtocolHandler(config),
221                 new HttpRequestDecoder(),
222                 new HttpResponseEncoder(),
223                 new MockOutboundHandler());
224         ch.writeInbound(httpRequest);
225         FullHttpResponse response = responses.remove();
226         assertEquals(SWITCHING_PROTOCOLS, response.status());
227         response.release();
228     }
229     @Test
230     public void testCheckInvalidWebSocketPath() {
231         HttpRequest httpRequest = new WebSocketRequestBuilder().httpVersion(HTTP_1_1)
232                 .method(HttpMethod.GET)
233                 .uri("/testabc")
234                 .key(HttpHeaderNames.SEC_WEBSOCKET_KEY)
235                 .connection("Upgrade")
236                 .upgrade(HttpHeaderValues.WEBSOCKET)
237                 .version13()
238                 .build();
239         WebSocketServerProtocolConfig config = WebSocketServerProtocolConfig.newBuilder()
240                 .websocketPath("/test")
241                 .checkStartsWith(true)
242                 .build();
243         EmbeddedChannel ch = new EmbeddedChannel(
244                 new WebSocketServerProtocolHandler(config),
245                 new HttpRequestDecoder(),
246                 new HttpResponseEncoder(),
247                 new MockOutboundHandler());
248         ch.writeInbound(httpRequest);
249         ChannelHandlerContext handshakerCtx = ch.pipeline().context(WebSocketServerProtocolHandshakeHandler.class);
250         assertNull(WebSocketServerProtocolHandler.getHandshaker(handshakerCtx.channel()));
251     }
252     @Test
253 <a name="7"></a>    public void testExplicitCloseFrameSentWhenServerChannelClosed() throws Exception {
254         WebSocketCloseStatus closeStatus = WebSocketCloseStatus.ENDPOINT_UNAVAILABLE;
255         EmbeddedChannel client = createClient();
256         EmbeddedChannel server = <font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>createServer();
257         assertFalse(server.writeInbound(client.readOutbound()));
258         assertFalse(client.writeInbound(server.readOutbound()));
259         assertTrue(server.writeOutbound(new CloseWebSocketFrame(closeStatus)));
260         server.close();
261 <a name="1"></a>        assertTrue(client.writeInbound(server.readOutbound</b></font>()));
262         assertFalse(server.isOpen());
263         CloseWebSocketFrame closeMessage = <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>client.readInbound();
264         assertEquals(closeMessage.statusCode(), closeStatus.code());
265         closeMessage.release();
266         client.close();
267         assertTrue(ReferenceCountUtil.release(client.readOutbound()));
268         assertFalse(client.finishAndReleaseAll());
269         assertFalse(server.finishAndReleaseAll());
270     }
271 <a name="4"></a>
272     @Test
273     public void testCloseFrameSentWhenServerChannelClosedSilently() throws Exception {</b></font>
274         <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>EmbeddedChannel client = createClient();
275         EmbeddedChannel server = createServer();
276         assertFalse(server.writeInbound(client.readOutbound()));
277         assertFalse(client.writeInbound(server.readOutbound()));
278         server.close();
279 <a name="0"></a>        assertTrue(client.writeInbound(server.readOutbound()));
280         assertFalse(server.isOpen</b></font>());
281         CloseWebSocketFrame closeMessage = <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>client.readInbound();
282         assertEquals(closeMessage.statusCode(), WebSocketCloseStatus.NORMAL_CLOSURE.code());
283         closeMessage.release();
284         client.close();
285         assertTrue(ReferenceCountUtil.release(client.readOutbound()));
286         assertFalse(client.finishAndReleaseAll());
287         assertFalse(server.finishAndReleaseAll());
288     }
289     @Test
290 <a name="6"></a>    public void testExplicitCloseFrameSentWhenClientChannelClosed() throws Exception {</b></font>
291         WebSocketCloseStatus closeStatus = WebSocketCloseStatus.INVALID_PAYLOAD_DATA;
292         EmbeddedChannel client = createClient();
293         EmbeddedChannel server = <font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>createServer();
294         assertFalse(server.writeInbound(client.readOutbound()));
295         assertFalse(client.writeInbound(server.readOutbound()));
296         assertTrue(client.writeOutbound(new CloseWebSocketFrame(closeStatus)));
297         client.close();
298         assertFalse(server.writeInbound(client.readOutbound</b></font>()));
299 <a name="5"></a>        assertFalse(client.isOpen());
300         assertFalse(server.isOpen());
301         CloseWebSocketFrame closeMessage = <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>decode(server.&lt;ByteBuf&gt;readOutbound(), CloseWebSocketFrame.class);
302         assertEquals(closeMessage.statusCode(), closeStatus.code());
303         closeMessage.release();
304         assertFalse(client.finishAndReleaseAll());
305         assertFalse(server.finishAndReleaseAll());
306     }
307 <a name="2"></a>
308     @Test
309     public void testCloseFrameSentWhenClientChannelClosedSilently() throws Exception {</b></font>
310         <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>EmbeddedChannel client = createClient();
311         EmbeddedChannel server = createServer();
312         assertFalse(server.writeInbound(client.readOutbound()));
313         assertFalse(client.writeInbound(server.readOutbound()));
314         client.close();
315         assertFalse(server.writeInbound(client.readOutbound()));
316 <a name="10"></a>        assertFalse(client.isOpen());
317         assertFalse(server.isOpen</b></font>());
318         <font color="#ad5910"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>CloseWebSocketFrame closeMessage = decode(server.&lt;ByteBuf&gt;readOutbound(), CloseWebSocketFrame.class);
319         assertEquals(closeMessage, new CloseWebSocketFrame(WebSocketCloseStatus.NORMAL_CLOSURE));
320         closeMessage.release();
321         assertFalse(client.finishAndReleaseAll());
322         assertFalse(server.finishAndReleaseAll</b></font>());
323     }
324     private EmbeddedChannel createClient(ChannelHandler... handlers) throws Exception {
325         WebSocketClientProtocolConfig clientConfig = WebSocketClientProtocolConfig.newBuilder()
326             .webSocketUri("http://test/test")
327             .dropPongFrames(false)
328             .handleCloseFrames(false)
329             .build();
330         EmbeddedChannel ch = new EmbeddedChannel(false, false,
331             new HttpClientCodec(),
332             new HttpObjectAggregator(8192),
333             new WebSocketClientProtocolHandler(clientConfig)
334         );
335         ch.pipeline().addLast(handlers);
336         ch.register();
337         return ch;
338     }
339     private EmbeddedChannel createServer(ChannelHandler... handlers) throws Exception {
340         WebSocketServerProtocolConfig serverConfig = WebSocketServerProtocolConfig.newBuilder()
341             .websocketPath("/test")
342             .dropPongFrames(false)
343             .build();
344         EmbeddedChannel ch = new EmbeddedChannel(false, false,
345             new HttpServerCodec(),
346             new HttpObjectAggregator(8192),
347             new WebSocketServerProtocolHandler(serverConfig)
348         );
349         ch.pipeline().addLast(handlers);
350         ch.register();
351         return ch;
352     }
353     @SuppressWarnings("SameParameterValue")
354     private &lt;T&gt; T decode(ByteBuf input, Class&lt;T&gt; clazz) {
355         EmbeddedChannel ch = new EmbeddedChannel(new WebSocket13FrameDecoder(true, false, 65536, true));
356         assertTrue(ch.writeInbound(input));
357         Object decoded = ch.readInbound();
358         assertNotNull(decoded);
359         assertFalse(ch.finish());
360         return clazz.cast(decoded);
361     }
362     private EmbeddedChannel createChannel() {
363         return createChannel(null);
364     }
365     private EmbeddedChannel createChannel(ChannelHandler handler) {
366         WebSocketServerProtocolConfig serverConfig = WebSocketServerProtocolConfig.newBuilder()
367             .websocketPath("/test")
368             .sendCloseFrame(null)
369             .build();
370         return createChannel(serverConfig, handler);
371     }
372     private EmbeddedChannel createChannel(WebSocketServerProtocolConfig serverConfig, ChannelHandler handler) {
373         return new EmbeddedChannel(
374                 new WebSocketServerProtocolHandler(serverConfig),
375                 new HttpRequestDecoder(),
376                 new HttpResponseEncoder(),
377                 new MockOutboundHandler(),
378                 handler);
379     }
380     private static void writeUpgradeRequest(EmbeddedChannel ch) {
381         writeUpgradeRequest(ch, true);
382     }
383     private static void writeUpgradeRequest(EmbeddedChannel ch, boolean full) {
384         HttpRequest request = WebSocketRequestBuilder.successful();
385         if (full) {
386             ch.writeInbound(request);
387 <a name="9"></a>        } else {
388             if (request instanceof FullHttpRequest) {
389                 FullHttpRequest fullHttpRequest = (FullHttpRequest) request;
390                 HttpRequest req = new DefaultHttpRequest(fullHttpRequest.protocolVersion(), <font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>fullHttpRequest.method(),
391                         fullHttpRequest.uri(), fullHttpRequest.headers().copy());
392                 ch.writeInbound(req);
393                 ch.writeInbound(new DefaultHttpContent(fullHttpRequest.content().copy()));
394                 ch.writeInbound(LastHttpContent.EMPTY_LAST_CONTENT);
395                 fullHttpRequest.release</b></font>();
396             } else {
397                 ch.writeInbound(request);
398             }
399         }
400     }
401     private static String getResponseMessage(FullHttpResponse response) {
402         return response.content().toString(CharsetUtil.UTF_8);
403     }
404     private class MockOutboundHandler extends ChannelOutboundHandlerAdapter {
405         @Override
406         public void write(ChannelHandlerContext ctx, Object msg, ChannelPromise promise) {
407             responses.add((FullHttpResponse) msg);
408             promise.setSuccess();
409         }
410         @Override
411         public void flush(ChannelHandlerContext ctx) {
412         }
413     }
414     private static class CustomTextFrameHandler extends ChannelInboundHandlerAdapter {
415         private String content;
416         @Override
417         public void channelRead(ChannelHandlerContext ctx, Object msg) {
418             assertNull(content);
419             content = "processed: " + ((TextWebSocketFrame) msg).text();
420             ReferenceCountUtil.release(msg);
421         }
422         String getContent() {
423             return content;
424         }
425     }
426 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
