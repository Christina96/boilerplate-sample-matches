
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 12.429378531073446%, Tokens: 11</h2>
        <div class="column">
            <h3>Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-StorageTest.java</h3>
            <pre><code>1  package com.earth2me.essentials;
<span onclick='openModal()' class='match'>2  import java.io.IOException;
3  import junit.framework.TestCase;
4  import org.bukkit.Location;
5  import org.bukkit.World;
6  import org.bukkit.World.Environment;
7  import org.bukkit.plugin.InvalidDescriptionException;
8  import org.junit.Test;
9  public class StorageTest extends TestCase
10  {
11  	Essentials ess;
12  	FakeServer server;
13  	World world;
</span>14  	public StorageTest()
15  	{
16  		server = new FakeServer();
17  		world = server.createWorld("testWorld", Environment.NORMAL);
18  		ess = new Essentials(server);
19  		try
20  		{
21  			ess.setupForTesting(server);
22  		}
23  		catch (InvalidDescriptionException ex)
24  		{
25  			fail("InvalidDescriptionException");
26  		}
27  		catch (IOException ex)
28  		{
29  			fail("IOException");
30  		}
31  	}
32  	@Test
33  	public void testOldUserdata()
34  	{
35  		ExecuteTimer ext = new ExecuteTimer();
36  		ext.start();
37  		OfflinePlayer base1 = server.createPlayer("testPlayer1");
38  		server.addPlayer(base1);
39  		ext.mark("fake user created");
40  		UserData user = (UserData)ess.getUser(base1);
41  		ext.mark("load empty user");
42  		for (int j = 0; j < 1; j++)
43  		{
44  			user.setHome("home", new Location(world, j, j, j));
45  		}
46  		ext.mark("change home 1 times");
47  		user.save();
48  		ext.mark("write user");
49  		user.save();
50  		ext.mark("write user (cached)");
51  		user.reloadConfig();
52  		ext.mark("reloaded file");
53  		user.reloadConfig();
54  		ext.mark("reloaded file (cached)");
55  		System.out.println(ext.end());
56  	}
57  }
</code></pre>
        </div>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-MeshRegistryListener.java</h3>
            <pre><code>1  package com.weibo.api.motan.registry.weibomesh;
2  import com.google.common.collect.ImmutableList;
3  import com.weibo.api.motan.common.URLParamType;
<span onclick='openModal()' class='match'>4  import com.weibo.api.motan.registry.NotifyListener;
5  import com.weibo.api.motan.rpc.URL;
6  import com.weibo.api.motan.util.CollectionUtil;
7  import com.weibo.api.motan.util.ConcurrentHashSet;
8  import com.weibo.api.motan.util.LoggerUtil;
9  import org.apache.commons.lang3.StringUtils;
10  import java.util.List;
11  public class MeshRegistryListener implements NotifyListener {
12      private static int DEFAULT_COPY = 2;
13      private MeshRegistry meshRegistry;
14      private ConcurrentHashSet<NotifyListener> listeners = new ConcurrentHashSet<>();
</span>15      private ImmutableList<URL> meshNodes;
16      private URL subscribeUrl;
17      private List<URL> backupNodes = null;
18      public MeshRegistryListener(MeshRegistry meshRegistry, URL subscribeUrl) {
19          this.meshRegistry = meshRegistry;
20          URL meshNode = subscribeUrl.createCopy();
21          URL meshUrl = meshRegistry.getUrl();
22          meshNode.setHost(meshUrl.getHost());
23          meshNode.setPort(meshUrl.getPort());
24          if (StringUtils.isNotBlank(meshUrl.getParameter(URLParamType.fusingThreshold.getName()))) {
25              meshNode.addParameter(URLParamType.fusingThreshold.getName(), meshUrl.getParameter(URLParamType.fusingThreshold.getName()));
26          }
27          int copy = meshUrl.getIntParameter(MeshRegistry.MESH_PARAM_COPY, DEFAULT_COPY);
28          ImmutableList.Builder builder = ImmutableList.builder();
29          for (int i = 0; i < copy; i++) {
30              builder.add(meshNode);
31          }
32          this.meshNodes = builder.build();
33          this.subscribeUrl = subscribeUrl;
34      }
35      @Override
36      public void notify(URL registryUrl, List<URL> urls) {
37          if (!CollectionUtil.isEmpty(urls)) {
38              this.backupNodes = urls;
39              if (!meshRegistry.isUseMesh()) { 
40                  doNotify(false);
41              }
42          }
43      }
44      public void doNotify(boolean useMesh) {
45          for (NotifyListener listener : listeners) {
46              try {
47                  if (useMesh) {
48                      listener.notify(meshRegistry.getUrl(), meshNodes);
49                  } else {
50                      if (CollectionUtil.isEmpty(backupNodes)) {
51                          LoggerUtil.info("mesh registry backupNodes is empty, not notify. url:" + subscribeUrl.toSimpleString());
52                          return; 
53                      }
54                      listener.notify(meshRegistry.getUrl(), backupNodes);
55                  }
56              } catch (Exception e) {
57                  LoggerUtil.warn("MeshRegistryListner notify fail. listner url:" + subscribeUrl.toSimpleString());
58              }
59          }
60      }
61      public List<URL> getUrls() {
62          if (!meshRegistry.isUseMesh() && !CollectionUtil.isEmpty(backupNodes)) {
63              return backupNodes;
64          }
65          return meshNodes;
66      }
67      public List<URL> getBackupNodes() {
68          return backupNodes;
69      }
70      public List<URL> getMeshNodes() {
71          return meshNodes;
72      }
73      public void addListener(NotifyListener listener) {
74          listeners.add(listener);
75      }
76      public boolean removeListener(NotifyListener listener) {
77          return listeners.remove(listener);
78      }
79  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-StorageTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-MeshRegistryListener.java</div>
                </div>
                <div class="column column_space"><pre><code>2  import java.io.IOException;
3  import junit.framework.TestCase;
4  import org.bukkit.Location;
5  import org.bukkit.World;
6  import org.bukkit.World.Environment;
7  import org.bukkit.plugin.InvalidDescriptionException;
8  import org.junit.Test;
9  public class StorageTest extends TestCase
10  {
11  	Essentials ess;
12  	FakeServer server;
13  	World world;
</pre></code></div>
                <div class="column column_space"><pre><code>4  import com.weibo.api.motan.registry.NotifyListener;
5  import com.weibo.api.motan.rpc.URL;
6  import com.weibo.api.motan.util.CollectionUtil;
7  import com.weibo.api.motan.util.ConcurrentHashSet;
8  import com.weibo.api.motan.util.LoggerUtil;
9  import org.apache.commons.lang3.StringUtils;
10  import java.util.List;
11  public class MeshRegistryListener implements NotifyListener {
12      private static int DEFAULT_COPY = 2;
13      private MeshRegistry meshRegistry;
14      private ConcurrentHashSet<NotifyListener> listeners = new ConcurrentHashSet<>();
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    