
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 13.084112149532709%, Tokens: 16</h2>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-TestProtoBuf.java</h3>
            <pre><code>1  package com.weibo.api.motan.serialize.protobuf;
2  import org.junit.After;
3  import org.junit.Assert;
4  import org.junit.Before;
5  import org.junit.Test;
6  import com.weibo.api.motan.config.ProtocolConfig;
7  import com.weibo.api.motan.config.RefererConfig;
8  import com.weibo.api.motan.config.RegistryConfig;
9  import com.weibo.api.motan.config.ServiceConfig;
10  import com.weibo.api.motan.serialize.protobuf.gen.UserProto.Address;
11  import com.weibo.api.motan.serialize.protobuf.gen.UserProto.User;
12  public class TestProtoBuf {
13  	private ServiceConfig<HelloService> serviceConfig;
14  	private RefererConfig<HelloService> refererConfig;
15  	private HelloService service;
16  	@Before
17  	public void setUp() {
18  		ProtocolConfig protocolConfig = new ProtocolConfig();
19  		protocolConfig.setId("testMotan");
20  		protocolConfig.setName("motan");
21  		protocolConfig.setSerialization("protobuf");
22  		protocolConfig.setCodec("motan");
23  		RegistryConfig registryConfig = new RegistryConfig();
24  		registryConfig.setAddress("127.0.0.1");
25  		registryConfig.setPort(8002);
26  		serviceConfig = new ServiceConfig<HelloService>();
27  		serviceConfig.setRef(new HelloServiceImpl());
28  		serviceConfig.setInterface(HelloService.class);
29  		serviceConfig.setProtocol(protocolConfig);
30  		serviceConfig.setExport("testMotan:18002");
31  		serviceConfig.setRegistry(registryConfig);
32  		serviceConfig.setShareChannel(true);
33  		serviceConfig.export();
34  		refererConfig = new RefererConfig<HelloService>();
35  		refererConfig.setDirectUrl("127.0.0.1:18002");
36  		refererConfig.setProtocol(protocolConfig);
37  		refererConfig.setInterface(HelloService.class);
38  		service = refererConfig.getRef();
39  	}
40  	@Test
41  	public void testPrimitiveType() {
42  		Assert.assertEquals("-1", service.sumAsString(Integer.MAX_VALUE, Integer.MIN_VALUE));
43  		Assert.assertEquals("-1", service.sumAsString(-2, 1));
44  		Assert.assertEquals((Long) 100L, service.boxIfNotZero(100));
45  		Assert.assertNull(service.boxIfNotZero(0));
46  	}
47  	@Test(expected = UnsupportedOperationException.class)
48  	public void testException() {
49  		service.testException();
50  	}
51  	@Test
52  	public void testNull() {
53  		Assert.assertTrue(service.isNull(null));
54  		User user = User.newBuilder().setId(120).setName("zhou").build();
55  		Assert.assertFalse(service.isNull(user));
56  	}
57  	@Test
58  	public void testProtobuf() {
59  		Address address = service.queryByUid(1);
60  		Assert.assertEquals(1, address.getId());
61  		User user = User.newBuilder().setId(120).setName("zhou").setGender(false).addAddress(address).build();
62  		Assert.assertTrue(service.isUserAddress(user, address));
63  		User newOne = service.copy(user);
<span onclick='openModal()' class='match'>64  		Assert.assertEquals(user.getId(), newOne.getId());
65  		Assert.assertEquals(user.getName(), newOne.getName());
66  		Assert.assertEquals(user.getGender(), newOne.getGender());
67  		Assert.assertEquals(user.getAddress(0).getId(), newOne.getAddress(0).getId());
68  	}
69  	@After
</span>70  	public void tearDown() {
71  		refererConfig.destroy();
72  		serviceConfig.unexport();
73  	}
74  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-JedisFactory.java</h3>
            <pre><code>1  package redis.clients.jedis;
2  import java.net.URI;
3  import javax.net.ssl.HostnameVerifier;
4  import javax.net.ssl.SSLParameters;
5  import javax.net.ssl.SSLSocketFactory;
6  import org.apache.commons.pool2.PooledObject;
7  import org.apache.commons.pool2.PooledObjectFactory;
8  import org.apache.commons.pool2.impl.DefaultPooledObject;
9  import org.slf4j.Logger;
10  import org.slf4j.LoggerFactory;
11  import redis.clients.jedis.exceptions.InvalidURIException;
12  import redis.clients.jedis.exceptions.JedisException;
13  import redis.clients.jedis.util.JedisURIHelper;
14  public class JedisFactory implements PooledObjectFactory<Jedis> {
15    private static final Logger logger = LoggerFactory.getLogger(JedisFactory.class);
16    private final JedisSocketFactory jedisSocketFactory;
17    private final JedisClientConfig clientConfig;
18    protected JedisFactory(final String host, final int port, final int connectionTimeout,
19        final int soTimeout, final String password, final int database, final String clientName) {
20      this(host, port, connectionTimeout, soTimeout, password, database, clientName, false, null, null, null);
21    }
22    protected JedisFactory(final String host, final int port, final int connectionTimeout,
23                 final int soTimeout, final String user, final String password, final int database, final String clientName) {
24      this(host, port, connectionTimeout, soTimeout, 0, user, password, database, clientName);
25    }
26    protected JedisFactory(final String host, final int port, final int connectionTimeout, final int soTimeout,
27        final int infiniteSoTimeout, final String user, final String password, final int database, final String clientName) {
28      this(host, port, connectionTimeout, soTimeout, infiniteSoTimeout, user, password, database, clientName, false, null, null, null);
29    }
30    JedisFactory(final int connectionTimeout, final int soTimeout, final int infiniteSoTimeout,
31        final String user, final String password, final int database, final String clientName) {
32      this(connectionTimeout, soTimeout, infiniteSoTimeout, user, password, database, clientName, false, null, null, null);
33    }
34    protected JedisFactory(final String host, final int port, final int connectionTimeout,
35        final int soTimeout, final String password, final int database, final String clientName,
36        final boolean ssl, final SSLSocketFactory sslSocketFactory, final SSLParameters sslParameters,
37        final HostnameVerifier hostnameVerifier) {
38      this(host, port, connectionTimeout, soTimeout, null, password, database, clientName, ssl, sslSocketFactory, sslParameters, hostnameVerifier);
39    }
40    protected JedisFactory(final String host, final int port, final int connectionTimeout,
41                 final int soTimeout, final String user, final String password, final int database, final String clientName,
42                 final boolean ssl, final SSLSocketFactory sslSocketFactory, final SSLParameters sslParameters,
43                 final HostnameVerifier hostnameVerifier) {
44      this(host, port, connectionTimeout, soTimeout, 0, user, password, database, clientName, ssl, sslSocketFactory, sslParameters, hostnameVerifier);
45    }
46    protected JedisFactory(final HostAndPort hostAndPort, final JedisClientConfig clientConfig) {
47      this.clientConfig = DefaultJedisClientConfig.copyConfig(clientConfig);
48      this.jedisSocketFactory = new DefaultJedisSocketFactory(hostAndPort, this.clientConfig);
49    }
50    protected JedisFactory(final String host, final int port, final int connectionTimeout, final int soTimeout,
51        final int infiniteSoTimeout, final String user, final String password, final int database,
52        final String clientName, final boolean ssl, final SSLSocketFactory sslSocketFactory,
53        final SSLParameters sslParameters, final HostnameVerifier hostnameVerifier) {
54      this.clientConfig = DefaultJedisClientConfig.builder().connectionTimeoutMillis(connectionTimeout)
55          .socketTimeoutMillis(soTimeout).blockingSocketTimeoutMillis(infiniteSoTimeout).user(user)
56          .password(password).database(database).clientName(clientName)
57          .ssl(ssl).sslSocketFactory(sslSocketFactory)
58          .sslParameters(sslParameters).hostnameVerifier(hostnameVerifier).build();
59      this.jedisSocketFactory = new DefaultJedisSocketFactory(new HostAndPort(host, port), this.clientConfig);
60    }
61    protected JedisFactory(final JedisSocketFactory jedisSocketFactory, final JedisClientConfig clientConfig) {
62      this.clientConfig = DefaultJedisClientConfig.copyConfig(clientConfig);
63      this.jedisSocketFactory = jedisSocketFactory;
64    }
65    JedisFactory(final int connectionTimeout, final int soTimeout, final int infiniteSoTimeout,
66        final String user, final String password, final int database, final String clientName, final boolean ssl,
67        final SSLSocketFactory sslSocketFactory, final SSLParameters sslParameters, final HostnameVerifier hostnameVerifier) {
<span onclick='openModal()' class='match'>68      this(DefaultJedisClientConfig.builder().connectionTimeoutMillis(connectionTimeout)
69          .socketTimeoutMillis(soTimeout).blockingSocketTimeoutMillis(infiniteSoTimeout).user(user)
70          .password(password).database(database).clientName(clientName)
71          .ssl(ssl).sslSocketFactory(sslSocketFactory)
72          .sslParameters(sslParameters).hostnameVerifier(hostnameVerifier).build());
73    }
74    JedisFactory(final JedisClientConfig clientConfig) {
</span>75      this.clientConfig = clientConfig;
76      this.jedisSocketFactory = new DefaultJedisSocketFactory(clientConfig);
77    }
78    protected JedisFactory(final URI uri, final int connectionTimeout, final int soTimeout,
79        final String clientName) {
80      this(uri, connectionTimeout, soTimeout, clientName, null, null, null);
81    }
82    protected JedisFactory(final URI uri, final int connectionTimeout, final int soTimeout,
83        final String clientName, final SSLSocketFactory sslSocketFactory,
84        final SSLParameters sslParameters, final HostnameVerifier hostnameVerifier) {
85      this(uri, connectionTimeout, soTimeout, 0, clientName, sslSocketFactory, sslParameters, hostnameVerifier);
86    }
87    protected JedisFactory(final URI uri, final int connectionTimeout, final int soTimeout,
88        final int infiniteSoTimeout, final String clientName, final SSLSocketFactory sslSocketFactory,
89        final SSLParameters sslParameters, final HostnameVerifier hostnameVerifier) {
90      if (!JedisURIHelper.isValid(uri)) {
91        throw new InvalidURIException(String.format(
92            "Cannot open Redis connection due invalid URI. %s", uri.toString()));
93      }
94      this.clientConfig = DefaultJedisClientConfig.builder().connectionTimeoutMillis(connectionTimeout)
95          .socketTimeoutMillis(soTimeout).blockingSocketTimeoutMillis(infiniteSoTimeout)
96          .user(JedisURIHelper.getUser(uri)).password(JedisURIHelper.getPassword(uri))
97          .database(JedisURIHelper.getDBIndex(uri)).clientName(clientName)
98          .protocol(JedisURIHelper.getRedisProtocol(uri))
99          .ssl(JedisURIHelper.isRedisSSLScheme(uri)).sslSocketFactory(sslSocketFactory)
100          .sslParameters(sslParameters).hostnameVerifier(hostnameVerifier).build();
101      this.jedisSocketFactory = new DefaultJedisSocketFactory(new HostAndPort(uri.getHost(), uri.getPort()), this.clientConfig);
102    }
103    void setHostAndPort(final HostAndPort hostAndPort) {
104      if (!(jedisSocketFactory instanceof DefaultJedisSocketFactory)) {
105        throw new IllegalStateException("setHostAndPort method has limited capability.");
106      }
107      ((DefaultJedisSocketFactory) jedisSocketFactory).updateHostAndPort(hostAndPort);
108    }
109    @Override
110    public void activateObject(PooledObject<Jedis> pooledJedis) throws Exception {
111      final Jedis jedis = pooledJedis.getObject();
112      if (jedis.getDB() != clientConfig.getDatabase()) {
113        jedis.select(clientConfig.getDatabase());
114      }
115    }
116    @Override
117    public void destroyObject(PooledObject<Jedis> pooledJedis) throws Exception {
118      final Jedis jedis = pooledJedis.getObject();
119      if (jedis.isConnected()) {
120        try {
121          jedis.close();
122        } catch (RuntimeException e) {
123          logger.debug("Error while close", e);
124        }
125      }
126    }
127    @Override
128    public PooledObject<Jedis> makeObject() throws Exception {
129      Jedis jedis = null;
130      try {
131        jedis = new Jedis(jedisSocketFactory, clientConfig);
132        return new DefaultPooledObject<>(jedis);
133      } catch (JedisException je) {
134        logger.debug("Error while makeObject", je);
135        throw je;
136      }
137    }
138    @Override
139    public void passivateObject(PooledObject<Jedis> pooledJedis) throws Exception {
140    }
141    @Override
142    public boolean validateObject(PooledObject<Jedis> pooledJedis) {
143      final Jedis jedis = pooledJedis.getObject();
144      try {
145        boolean targetHasNotChanged = true;
146        if (jedisSocketFactory instanceof DefaultJedisSocketFactory) {
147          HostAndPort targetAddress = ((DefaultJedisSocketFactory) jedisSocketFactory).getHostAndPort();
148          HostAndPort objectAddress = jedis.getConnection().getHostAndPort();
149          targetHasNotChanged = targetAddress.getHost().equals(objectAddress.getHost())
150              && targetAddress.getPort() == objectAddress.getPort();
151        }
152        return targetHasNotChanged
153            && jedis.getConnection().isConnected()
154            && jedis.ping().equals("PONG");
155      } catch (final Exception e) {
156        logger.error("Error while validating pooled Jedis object.", e);
157        return false;
158      }
159    }
160  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-TestProtoBuf.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-JedisFactory.java</div>
                <div class="column column_space"><pre><code>64  		Assert.assertEquals(user.getId(), newOne.getId());
65  		Assert.assertEquals(user.getName(), newOne.getName());
66  		Assert.assertEquals(user.getGender(), newOne.getGender());
67  		Assert.assertEquals(user.getAddress(0).getId(), newOne.getAddress(0).getId());
68  	}
69  	@After
</pre></code></div>
                <div class="column column_space"><pre><code>68      this(DefaultJedisClientConfig.builder().connectionTimeoutMillis(connectionTimeout)
69          .socketTimeoutMillis(soTimeout).blockingSocketTimeoutMillis(infiniteSoTimeout).user(user)
70          .password(password).database(database).clientName(clientName)
71          .ssl(ssl).sslSocketFactory(sslSocketFactory)
72          .sslParameters(sslParameters).hostnameVerifier(hostnameVerifier).build());
73    }
74    JedisFactory(final JedisClientConfig clientConfig) {
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    