
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 3.4055727554179565%, Tokens: 11, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-Commandkit.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package com.earth2me.essentials.commands;
2  import com.earth2me.essentials.CommandSource;
3  import static com.earth2me.essentials.I18n.tl;
4  import com.earth2me.essentials.Kit;
5  import com.earth2me.essentials.User;
6  import com.earth2me.essentials.utils.StringUtil;
7  import java.util.ArrayList;
8  import java.util.List;
9  import java.util.Locale;
10  import java.util.logging.Level;
11  import org.bukkit.Server;
</span>12  public class Commandkit extends EssentialsCommand
13  {
14  	public Commandkit()
15  	{
16  		super("kit");
17  	}
18  	@Override
19  	public void run(final Server server, final User user, final String commandLabel, final String[] args) throws Exception
20  	{
21  		if (args.length < 1)
22  		{
23  			final String kitList = Kit.listKits(ess, user);
24  			user.sendMessage(kitList.length() > 0 ? tl("kits", kitList) : tl("noKits"));
25  			throw new NoChargeException();
26  		}
27  		else if (args.length > 1 && user.isAuthorized("essentials.kit.others"))
28  		{
29  			final User userTo = getPlayer(server, user, args, 1);
30  			final String kitNames = StringUtil.sanitizeString(args[0].toLowerCase(Locale.ENGLISH)).trim();
31  			giveKits(userTo, user, kitNames);
32  		}
33  		else
34  		{
35  			final String kitNames = StringUtil.sanitizeString(args[0].toLowerCase(Locale.ENGLISH)).trim();
36  			giveKits(user, user, kitNames);
37  		}
38  	}
39  	@Override
40  	public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception
41  	{
42  		if (args.length < 2)
43  		{
44  			final String kitList = Kit.listKits(ess, null);
45  			sender.sendMessage(kitList.length() > 0 ? tl("kits", kitList) : tl("noKits"));
46  			throw new NoChargeException();
47  		}
48  		else
49  		{
50  			final User userTo = getPlayer(server, args, 1, true, false);
51  			final String[] kits = args[0].toLowerCase(Locale.ENGLISH).split(",");
52  			for (final String kitName : kits)
53  			{
54  				final Kit kit = new Kit(kitName, ess);
55  				kit.expandItems(userTo);
56  				sender.sendMessage(tl("kitGiveTo", kitName, userTo.getDisplayName()));
57  				userTo.sendMessage(tl("kitReceive", kitName));
58  			}
59  		}
60  	}
61  	private void giveKits(final User userTo, final User userFrom, final String kitNames) throws Exception
62  	{
63  		if (kitNames.isEmpty())
64  		{
65  			throw new Exception(tl("kitNotFound"));
66  		}
67  		String[] kitList = kitNames.split(",");
68  		List<Kit> kits = new ArrayList<Kit>();
69  		for (final String kitName : kitList)
70  		{
71  			if (kitName.isEmpty())
72  			{
73  				throw new Exception(tl("kitNotFound"));
74  			}
75  			Kit kit = new Kit(kitName, ess);
76  			kit.checkPerms(userFrom);
77  			kit.checkDelay(userFrom);
78  			kit.checkAffordable(userFrom);
79  			kits.add(kit);
80  		}
81  		for (final Kit kit : kits)
82  		{
83  			try
84  			{
85  				kit.checkDelay(userFrom);
86  				kit.checkAffordable(userFrom);
87  				kit.setTime(userFrom);
88  				kit.expandItems(userTo);
89  				kit.chargeUser(userTo);
90  				if (!userFrom.equals(userTo))
91  				{
92  					userFrom.sendMessage(tl("kitGiveTo", kit.getName(), userTo.getDisplayName()));
93  				}
94  				userTo.sendMessage(tl("kitReceive", kit.getName()));
95  			}
96  			catch (NoChargeException ex)			
97  			{
98  				if (ess.getSettings().isDebug())
99  				{
100  					ess.getLogger().log(Level.INFO, "Soft kit error, abort spawning " + kit.getName(), ex);
101  				}
102  			}
103  			catch (Exception ex)			
104  			{
105  				ess.showError(userFrom.getSource(), ex, "\\ kit: " + kit.getName());
106  			}
107  		}
108  	}
109  }
</code></pre>
        </div>
        <div class="column">
            <h3>BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-PluginManager.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package net.md_5.bungee.api.plugin;
2  import com.google.common.base.Preconditions;
3  import com.google.common.collect.ArrayListMultimap;
4  import com.google.common.collect.Multimap;
5  import com.google.common.eventbus.Subscribe;
6  import com.google.common.graph.GraphBuilder;
7  import com.google.common.graph.Graphs;
8  import com.google.common.graph.MutableGraph;
9  import java.io.File;
10  import java.io.InputStream;
11  import java.lang.reflect.Method;
</span>12  import java.net.URLClassLoader;
13  import java.util.Arrays;
14  import java.util.Collection;
15  import java.util.Collections;
16  import java.util.HashMap;
17  import java.util.HashSet;
18  import java.util.Iterator;
19  import java.util.LinkedHashMap;
20  import java.util.List;
21  import java.util.Locale;
22  import java.util.Map;
23  import java.util.Set;
24  import java.util.Stack;
25  import java.util.jar.JarEntry;
26  import java.util.jar.JarFile;
27  import java.util.logging.Level;
28  import lombok.RequiredArgsConstructor;
29  import net.md_5.bungee.api.ChatColor;
30  import net.md_5.bungee.api.CommandSender;
31  import net.md_5.bungee.api.ProxyServer;
32  import net.md_5.bungee.api.connection.ProxiedPlayer;
33  import net.md_5.bungee.event.EventBus;
34  import net.md_5.bungee.event.EventHandler;
35  import org.yaml.snakeyaml.LoaderOptions;
36  import org.yaml.snakeyaml.Yaml;
37  import org.yaml.snakeyaml.constructor.Constructor;
38  import org.yaml.snakeyaml.introspector.PropertyUtils;
39  @RequiredArgsConstructor
40  public final class PluginManager
41  {
42      private final ProxyServer proxy;
43      private final Yaml yaml;
44      private final EventBus eventBus;
45      private final Map<String, Plugin> plugins = new LinkedHashMap<>();
46      private final MutableGraph<String> dependencyGraph = GraphBuilder.directed().build();
47      private final LibraryLoader libraryLoader;
48      private final Map<String, Command> commandMap = new HashMap<>();
49      private Map<String, PluginDescription> toLoad = new HashMap<>();
50      private final Multimap<Plugin, Command> commandsByPlugin = ArrayListMultimap.create();
51      private final Multimap<Plugin, Listener> listenersByPlugin = ArrayListMultimap.create();
52      @SuppressWarnings("unchecked")
53      public PluginManager(ProxyServer proxy)
54      {
55          this.proxy = proxy;
56          Constructor yamlConstructor = new Constructor( new LoaderOptions() );
57          PropertyUtils propertyUtils = yamlConstructor.getPropertyUtils();
58          propertyUtils.setSkipMissingProperties( true );
59          yamlConstructor.setPropertyUtils( propertyUtils );
60          yaml = new Yaml( yamlConstructor );
61          eventBus = new EventBus( proxy.getLogger() );
62          LibraryLoader libraryLoader = null;
63          try
64          {
65              libraryLoader = new LibraryLoader( proxy.getLogger() );
66          } catch ( NoClassDefFoundError ex )
67          {
68              proxy.getLogger().warning( "Could not initialize LibraryLoader (missing dependencies?)" );
69          }
70          this.libraryLoader = libraryLoader;
71      }
72      public void registerCommand(Plugin plugin, Command command)
73      {
74          commandMap.put( command.getName().toLowerCase( Locale.ROOT ), command );
75          for ( String alias : command.getAliases() )
76          {
77              commandMap.put( alias.toLowerCase( Locale.ROOT ), command );
78          }
79          commandsByPlugin.put( plugin, command );
80      }
81      public void unregisterCommand(Command command)
82      {
83          while ( commandMap.values().remove( command ) );
84          commandsByPlugin.values().remove( command );
85      }
86      public void unregisterCommands(Plugin plugin)
87      {
88          for ( Iterator<Command> it = commandsByPlugin.get( plugin ).iterator(); it.hasNext(); )
89          {
90              Command command = it.next();
91              while ( commandMap.values().remove( command ) );
92              it.remove();
93          }
94      }
95      private Command getCommandIfEnabled(String commandName, CommandSender sender)
96      {
97          String commandLower = commandName.toLowerCase( Locale.ROOT );
98          if ( ( sender instanceof ProxiedPlayer ) && proxy.getDisabledCommands().contains( commandLower ) )
99          {
100              return null;
101          }
102          return commandMap.get( commandLower );
103      }
104      public boolean isExecutableCommand(String commandName, CommandSender sender)
105      {
106          return getCommandIfEnabled( commandName, sender ) != null;
107      }
108      public boolean dispatchCommand(CommandSender sender, String commandLine)
109      {
110          return dispatchCommand( sender, commandLine, null );
111      }
112      public boolean dispatchCommand(CommandSender sender, String commandLine, List<String> tabResults)
113      {
114          String[] split = commandLine.split( " ", -1 );
115          if ( split.length == 0 || split[0].isEmpty() )
116          {
117              return false;
118          }
119          Command command = getCommandIfEnabled( split[0], sender );
120          if ( command == null )
121          {
122              return false;
123          }
124          if ( !command.hasPermission( sender ) )
125          {
126              if ( tabResults == null )
127              {
128                  sender.sendMessage( ( command.getPermissionMessage() == null ) ? proxy.getTranslation( "no_permission" ) : command.getPermissionMessage() );
129              }
130              return true;
131          }
132          String[] args = Arrays.copyOfRange( split, 1, split.length );
133          try
134          {
135              if ( tabResults == null )
136              {
137                  if ( proxy.getConfig().isLogCommands() )
138                  {
139                      proxy.getLogger().log( Level.INFO, "{0} executed command: /{1}", new Object[]
140                      {
141                          sender.getName(), commandLine
142                      } );
143                  }
144                  command.execute( sender, args );
145              } else if ( commandLine.contains( " " ) && command instanceof TabExecutor )
146              {
147                  for ( String s : ( (TabExecutor) command ).onTabComplete( sender, args ) )
148                  {
149                      tabResults.add( s );
150                  }
151              }
152          } catch ( Exception ex )
153          {
154              sender.sendMessage( ChatColor.RED + "An internal error occurred whilst executing this command, please check the console log for details." );
155              ProxyServer.getInstance().getLogger().log( Level.WARNING, "Error in dispatching command", ex );
156          }
157          return true;
158      }
159      public Collection<Plugin> getPlugins()
160      {
161          return plugins.values();
162      }
163      public Plugin getPlugin(String name)
164      {
165          return plugins.get( name );
166      }
167      public void loadPlugins()
168      {
169          Map<PluginDescription, Boolean> pluginStatuses = new HashMap<>();
170          for ( Map.Entry<String, PluginDescription> entry : toLoad.entrySet() )
171          {
172              PluginDescription plugin = entry.getValue();
173              if ( !enablePlugin( pluginStatuses, new Stack<PluginDescription>(), plugin ) )
174              {
175                  ProxyServer.getInstance().getLogger().log( Level.WARNING, "Failed to enable {0}", entry.getKey() );
176              }
177          }
178          toLoad.clear();
179          toLoad = null;
180      }
181      public void enablePlugins()
182      {
183          for ( Plugin plugin : plugins.values() )
184          {
185              try
186              {
187                  plugin.onEnable();
188                  ProxyServer.getInstance().getLogger().log( Level.INFO, "Enabled plugin {0} version {1} by {2}", new Object[]
189                  {
190                      plugin.getDescription().getName(), plugin.getDescription().getVersion(), plugin.getDescription().getAuthor()
191                  } );
192              } catch ( Throwable t )
193              {
194                  ProxyServer.getInstance().getLogger().log( Level.WARNING, "Exception encountered when loading plugin: " + plugin.getDescription().getName(), t );
195              }
196          }
197      }
198      private boolean enablePlugin(Map<PluginDescription, Boolean> pluginStatuses, Stack<PluginDescription> dependStack, PluginDescription plugin)
199      {
200          if ( pluginStatuses.containsKey( plugin ) )
201          {
202              return pluginStatuses.get( plugin );
203          }
204          Set<String> dependencies = new HashSet<>();
205          dependencies.addAll( plugin.getDepends() );
206          dependencies.addAll( plugin.getSoftDepends() );
207          boolean status = true;
208          for ( String dependName : dependencies )
209          {
210              PluginDescription depend = toLoad.get( dependName );
211              Boolean dependStatus = ( depend != null ) ? pluginStatuses.get( depend ) : Boolean.FALSE;
212              if ( dependStatus == null )
213              {
214                  if ( dependStack.contains( depend ) )
215                  {
216                      StringBuilder dependencyGraph = new StringBuilder();
217                      for ( PluginDescription element : dependStack )
218                      {
219                          dependencyGraph.append( element.getName() ).append( " -> " );
220                      }
221                      dependencyGraph.append( plugin.getName() ).append( " -> " ).append( dependName );
222                      ProxyServer.getInstance().getLogger().log( Level.WARNING, "Circular dependency detected: {0}", dependencyGraph );
223                      status = false;
224                  } else
225                  {
226                      dependStack.push( plugin );
227                      dependStatus = this.enablePlugin( pluginStatuses, dependStack, depend );
228                      dependStack.pop();
229                  }
230              }
231              if ( dependStatus == Boolean.FALSE && plugin.getDepends().contains( dependName ) ) 
232              {
233                  ProxyServer.getInstance().getLogger().log( Level.WARNING, "{0} (required by {1}) is unavailable", new Object[]
234                  {
235                      String.valueOf( dependName ), plugin.getName()
236                  } );
237                  status = false;
238              }
239              dependencyGraph.putEdge( plugin.getName(), dependName );
240              if ( !status )
241              {
242                  break;
243              }
244          }
245          if ( status )
246          {
247              try
248              {
249                  URLClassLoader loader = new PluginClassloader( proxy, plugin, plugin.getFile(), ( libraryLoader != null ) ? libraryLoader.createLoader( plugin ) : null );
250                  Class<?> main = loader.loadClass( plugin.getMain() );
251                  Plugin clazz = (Plugin) main.getDeclaredConstructor().newInstance();
252                  plugins.put( plugin.getName(), clazz );
253                  clazz.onLoad();
254                  ProxyServer.getInstance().getLogger().log( Level.INFO, "Loaded plugin {0} version {1} by {2}", new Object[]
255                  {
256                      plugin.getName(), plugin.getVersion(), plugin.getAuthor()
257                  } );
258              } catch ( Throwable t )
259              {
260                  proxy.getLogger().log( Level.WARNING, "Error loading plugin " + plugin.getName(), t );
261              }
262          }
263          pluginStatuses.put( plugin, status );
264          return status;
265      }
266      public void detectPlugins(File folder)
267      {
268          Preconditions.checkNotNull( folder, "folder" );
269          Preconditions.checkArgument( folder.isDirectory(), "Must load from a directory" );
270          for ( File file : folder.listFiles() )
271          {
272              if ( file.isFile() && file.getName().endsWith( ".jar" ) )
273              {
274                  try ( JarFile jar = new JarFile( file ) )
275                  {
276                      JarEntry pdf = jar.getJarEntry( "bungee.yml" );
277                      if ( pdf == null )
278                      {
279                          pdf = jar.getJarEntry( "plugin.yml" );
280                      }
281                      Preconditions.checkNotNull( pdf, "Plugin must have a plugin.yml or bungee.yml" );
282                      try ( InputStream in = jar.getInputStream( pdf ) )
283                      {
284                          PluginDescription desc = yaml.loadAs( in, PluginDescription.class );
285                          Preconditions.checkNotNull( desc.getName(), "Plugin from %s has no name", file );
286                          Preconditions.checkNotNull( desc.getMain(), "Plugin from %s has no main", file );
287                          desc.setFile( file );
288                          toLoad.put( desc.getName(), desc );
289                      }
290                  } catch ( Exception ex )
291                  {
292                      ProxyServer.getInstance().getLogger().log( Level.WARNING, "Could not load plugin from file " + file, ex );
293                  }
294              }
295          }
296      }
297      public <T extends Event> T callEvent(T event)
298      {
299          Preconditions.checkNotNull( event, "event" );
300          long start = System.nanoTime();
301          eventBus.post( event );
302          event.postCall();
303          long elapsed = System.nanoTime() - start;
304          if ( elapsed > 250000000 )
305          {
306              ProxyServer.getInstance().getLogger().log( Level.WARNING, "Event {0} took {1}ms to process!", new Object[]
307              {
308                  event, elapsed / 1000000
309              } );
310          }
311          return event;
312      }
313      public void registerListener(Plugin plugin, Listener listener)
314      {
315          for ( Method method : listener.getClass().getDeclaredMethods() )
316          {
317              Preconditions.checkArgument( !method.isAnnotationPresent( Subscribe.class ),
318                      "Listener %s has registered using deprecated subscribe annotation! Please update to @EventHandler.", listener );
319          }
320          eventBus.register( listener );
321          listenersByPlugin.put( plugin, listener );
322      }
323      public void unregisterListener(Listener listener)
324      {
325          eventBus.unregister( listener );
326          listenersByPlugin.values().remove( listener );
327      }
328      public void unregisterListeners(Plugin plugin)
329      {
330          for ( Iterator<Listener> it = listenersByPlugin.get( plugin ).iterator(); it.hasNext(); )
331          {
332              eventBus.unregister( it.next() );
333              it.remove();
334          }
335      }
336      public Collection<Map.Entry<String, Command>> getCommands()
337      {
338          return Collections.unmodifiableCollection( commandMap.entrySet() );
339      }
340      boolean isTransitiveDepend(PluginDescription plugin, PluginDescription depend)
341      {
342          Preconditions.checkArgument( plugin != null, "plugin" );
343          Preconditions.checkArgument( depend != null, "depend" );
344          if ( dependencyGraph.nodes().contains( plugin.getName() ) )
345          {
346              if ( Graphs.reachableNodes( dependencyGraph, plugin.getName() ).contains( depend.getName() ) )
347              {
348                  return true;
349              }
350          }
351          return false;
352      }
353  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-Commandkit.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-PluginManager.java</div>
                </div>
                <div class="column column_space"><pre><code>1  package com.earth2me.essentials.commands;
2  import com.earth2me.essentials.CommandSource;
3  import static com.earth2me.essentials.I18n.tl;
4  import com.earth2me.essentials.Kit;
5  import com.earth2me.essentials.User;
6  import com.earth2me.essentials.utils.StringUtil;
7  import java.util.ArrayList;
8  import java.util.List;
9  import java.util.Locale;
10  import java.util.logging.Level;
11  import org.bukkit.Server;
</pre></code></div>
                <div class="column column_space"><pre><code>1  package net.md_5.bungee.api.plugin;
2  import com.google.common.base.Preconditions;
3  import com.google.common.collect.ArrayListMultimap;
4  import com.google.common.collect.Multimap;
5  import com.google.common.eventbus.Subscribe;
6  import com.google.common.graph.GraphBuilder;
7  import com.google.common.graph.Graphs;
8  import com.google.common.graph.MutableGraph;
9  import java.io.File;
10  import java.io.InputStream;
11  import java.lang.reflect.Method;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    