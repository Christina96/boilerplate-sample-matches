
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 3.1104199066874028%, Tokens: 10</h2>
        <div class="column">
            <h3>segmentfault-lessons-MDEwOlJlcG9zaXRvcnk5MzE1NzM4MQ==-flat-PersonSpringBootTest.java</h3>
            <pre><code>1  package com.segmentfault.springbootlesson19.spring.boot;
2  import com.segmentfault.springbootlesson19.configuration.PersonConfiguration;
3  import com.segmentfault.springbootlesson19.domain.Person;
4  import org.junit.Assert;
5  import org.junit.Test;
6  import org.junit.runner.RunWith;
7  import org.springframework.beans.factory.annotation.Autowired;
8  import org.springframework.boot.test.context.SpringBootTest;
9  import org.springframework.test.context.junit4.SpringRunner;
10  @RunWith(SpringRunner.class)
11  @SpringBootTest(classes = PersonConfiguration.class)
12  public class PersonSpringBootTest {
13      @Autowired
14      private Person person;
15      @Test
16      public void testPrimaryPerson() {
<span onclick='openModal()' class='match'>17          Assert.assertEquals(Long.valueOf(1L), person.getId());
18          Assert.assertEquals("小马哥", person.getName());
19          Assert.assertEquals(Integer.valueOf(32), person.getAge());
20      }
21  }
</span></code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ScriptingCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.junit.Assert.*;
3  import java.util.ArrayList;
4  import java.util.Arrays;
5  import java.util.Collections;
6  import java.util.List;
7  import java.util.Map;
8  import org.hamcrest.MatcherAssert;
9  import org.hamcrest.Matchers;
10  import org.junit.Before;
11  import org.junit.Test;
12  import redis.clients.jedis.Jedis;
13  import redis.clients.jedis.args.FlushMode;
14  import redis.clients.jedis.args.FunctionRestorePolicy;
15  import redis.clients.jedis.exceptions.JedisConnectionException;
16  import redis.clients.jedis.exceptions.JedisDataException;
17  import redis.clients.jedis.exceptions.JedisNoScriptException;
18  import redis.clients.jedis.resps.FunctionStats;
19  import redis.clients.jedis.resps.LibraryInfo;
20  import redis.clients.jedis.util.ClientKillerUtil;
21  import redis.clients.jedis.util.SafeEncoder;
22  public class ScriptingCommandsTest extends JedisCommandsTestBase {
23    @Before
24    @Override
25    public void setUp() throws Exception {
26      super.setUp();
27      jedis.functionFlush();
28    }
29    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
30    final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x0A };
31    final byte[] bfoo2 = { 0x01, 0x02, 0x03, 0x04, 0x0B };
32    final byte[] bfoo3 = { 0x01, 0x02, 0x03, 0x04, 0x0C };
33    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
34    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
35    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
36    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
37    final byte[] bfoobar = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 };
38    @SuppressWarnings("unchecked")
39    @Test
40    public void evalMultiBulk() {
41      String script = "return {KEYS[1],KEYS[2],ARGV[1],ARGV[2],ARGV[3]}";
42      List<String> keys = new ArrayList<String>();
43      keys.add("key1");
44      keys.add("key2");
45      List<String> args = new ArrayList<String>();
46      args.add("first");
47      args.add("second");
48      args.add("third");
49      List<String> response = (List<String>) jedis.eval(script, keys, args);
50      assertEquals(5, response.size());
51      assertEquals("key1", response.get(0));
52      assertEquals("key2", response.get(1));
53      assertEquals("first", response.get(2));
54      assertEquals("second", response.get(3));
55      assertEquals("third", response.get(4));
56    }
57    @SuppressWarnings("unchecked")
58    @Test
59    public void evalMultiBulkWithBinaryJedis() {
60      String script = "return {KEYS[1],KEYS[2],ARGV[1],ARGV[2],ARGV[3]}";
61      List<byte[]> keys = new ArrayList<byte[]>();
62      keys.add("key1".getBytes());
63      keys.add("key2".getBytes());
64      List<byte[]> args = new ArrayList<byte[]>();
65      args.add("first".getBytes());
66      args.add("second".getBytes());
67      args.add("third".getBytes());
68      List<byte[]> responses = (List<byte[]>) jedis.eval(script.getBytes(), keys, args);
69      assertEquals(5, responses.size());
70      assertEquals("key1", new String(responses.get(0)));
71      assertEquals("key2", new String(responses.get(1)));
72      assertEquals("first", new String(responses.get(2)));
73      assertEquals("second", new String(responses.get(3)));
74      assertEquals("third", new String(responses.get(4)));
75    }
76    @Test
77    public void evalBulk() {
78      String script = "return KEYS[1]";
79      List<String> keys = new ArrayList<String>();
80      keys.add("key1");
81      List<String> args = new ArrayList<String>();
82      args.add("first");
83      String response = (String) jedis.eval(script, keys, args);
84      assertEquals("key1", response);
85    }
86    @Test
87    public void evalInt() {
88      String script = "return 2";
89      List<String> keys = new ArrayList<String>();
90      keys.add("key1");
91      Long response = (Long) jedis.eval(script, keys, new ArrayList<String>());
92      assertEquals(Long.valueOf(2), response);
93    }
94    @Test
95    public void evalNestedLists() {
96      String script = "return { {KEYS[1]} , {2} }";
97      List<?> results = (List<?>) jedis.eval(script, 1, "key1");
98      MatcherAssert.assertThat((List<String>) results.get(0), Matchers.hasItem("key1"));
99      MatcherAssert.assertThat((List<Long>) results.get(1), Matchers.hasItem(2L));
100    }
101    @Test
102    public void evalNoArgs() {
103      String script = "return KEYS[1]";
104      List<String> keys = new ArrayList<String>();
105      keys.add("key1");
106      String response = (String) jedis.eval(script, keys, new ArrayList<String>());
107      assertEquals("key1", response);
108    }
109    @Test
110    public void evalReadonly() {
111      String script = "return KEYS[1]";
112      List<String> keys = new ArrayList<String>();
113      keys.add("key1");
114      List<String> args = new ArrayList<String>();
115      args.add("first");
116      String response = (String) jedis.evalReadonly(script, keys, args);
117      assertEquals("key1", response);
118    }
119    @Test
120    public void evalsha() {
121      jedis.set("foo", "bar");
122      jedis.eval("return redis.call('get','foo')");
123      String result = (String) jedis.evalsha("6b1bf486c81ceb7edf3c093f4c48582e38c0e791");
124      assertEquals("bar", result);
125    }
126    @Test
127    public void evalshaReadonly() {
128      jedis.set("foo", "bar");
129      jedis.eval("return redis.call('get','foo')");
130      String result = (String) jedis.evalshaReadonly("6b1bf486c81ceb7edf3c093f4c48582e38c0e791",
131              Collections.emptyList(), Collections.emptyList());
132      assertEquals("bar", result);
133    }
134    @Test
135    public void evalshaBinary() {
136      jedis.set(SafeEncoder.encode("foo"), SafeEncoder.encode("bar"));
137      jedis.eval(SafeEncoder.encode("return redis.call('get','foo')"));
138      byte[] result = (byte[]) jedis.evalsha(SafeEncoder
139          .encode("6b1bf486c81ceb7edf3c093f4c48582e38c0e791"));
140      assertArrayEquals(SafeEncoder.encode("bar"), result);
141    }
142    @Test
143    public void evalshaReadonlyBinary() {
144      jedis.set(SafeEncoder.encode("foo"), SafeEncoder.encode("bar"));
145      jedis.eval(SafeEncoder.encode("return redis.call('get','foo')"));
146      byte[] result = (byte[]) jedis.evalshaReadonly(SafeEncoder.encode("6b1bf486c81ceb7edf3c093f4c48582e38c0e791"),
147              Collections.emptyList(), Collections.emptyList());
148      assertArrayEquals(SafeEncoder.encode("bar"), result);
149    }
150    @Test(expected = JedisNoScriptException.class)
151    public void evalshaShaNotFound() {
152      jedis.evalsha("ffffffffffffffffffffffffffffffffffffffff");
153    }
154    @Test
155    public void scriptFlush() {
156      jedis.set("foo", "bar");
157      jedis.eval("return redis.call('get','foo')");
158      jedis.scriptFlush();
159      assertFalse(jedis.scriptExists("6b1bf486c81ceb7edf3c093f4c48582e38c0e791"));
160    }
161    @Test
162    public void scriptFlushMode() {
163      jedis.set("foo", "bar");
164      jedis.eval("return redis.call('get','foo')");
165      String sha1 = "6b1bf486c81ceb7edf3c093f4c48582e38c0e791";
166      assertTrue(jedis.scriptExists(sha1));
167      jedis.scriptFlush(FlushMode.SYNC);
168      assertFalse(jedis.scriptExists(sha1));
169    }
170    @Test
171    public void scriptExists() {
172      jedis.scriptLoad("return redis.call('get','foo')");
173      List<Boolean> exists = jedis.scriptExists("ffffffffffffffffffffffffffffffffffffffff",
174        "6b1bf486c81ceb7edf3c093f4c48582e38c0e791");
175      assertFalse(exists.get(0));
176      assertTrue(exists.get(1));
177    }
178    @Test
179    public void scriptExistsBinary() {
180      jedis.scriptLoad(SafeEncoder.encode("return redis.call('get','foo')"));
181      List<Boolean> exists = jedis.scriptExists(
182        SafeEncoder.encode("ffffffffffffffffffffffffffffffffffffffff"),
183        SafeEncoder.encode("6b1bf486c81ceb7edf3c093f4c48582e38c0e791"));
184      assertFalse(exists.get(0));
185      assertTrue(exists.get(1));
186    }
187    @Test
188    public void scriptLoad() {
189      jedis.scriptLoad("return redis.call('get','foo')");
190      assertTrue(jedis.scriptExists("6b1bf486c81ceb7edf3c093f4c48582e38c0e791"));
191    }
192    @Test
193    public void scriptLoadBinary() {
194      jedis.scriptLoad(SafeEncoder.encode("return redis.call('get','foo')"));
195      assertTrue(jedis.scriptExists(SafeEncoder.encode("6b1bf486c81ceb7edf3c093f4c48582e38c0e791")));
196    }
197    @Test
198    public void scriptKill() {
199      try {
200        jedis.scriptKill();
201      } catch (JedisDataException e) {
202        assertTrue(e.getMessage().contains("No scripts in execution right now."));
203      }
204    }
205    @Test
206    public void scriptEvalReturnNullValues() {
207      jedis.del("key1");
208      jedis.del("key2");
209      String script = "return {redis.call('hget',KEYS[1],ARGV[1]),redis.call('hget',KEYS[2],ARGV[2])}";
210      List<String> results = (List<String>) jedis.eval(script, 2, "key1", "key2", "1", "2");
211      assertEquals(2, results.size());
212      assertNull(results.get(0));
213      assertNull(results.get(1));
214    }
215    @Test
216    public void scriptEvalShaReturnNullValues() {
217      jedis.del("key1");
218      jedis.del("key2");
219      String script = "return {redis.call('hget',KEYS[1],ARGV[1]),redis.call('hget',KEYS[2],ARGV[2])}";
220      String sha = jedis.scriptLoad(script);
221      List<String> results = (List<String>) jedis.evalsha(sha, 2, "key1", "key2", "1", "2");
222      assertEquals(2, results.size());
223      assertNull(results.get(0));
224      assertNull(results.get(1));
225    }
226    @Test
227    public void scriptEvalShaReturnValues() {
228      jedis.hset("foo", "foo1", "bar1");
229      jedis.hset("foobar", "foo2", "bar2");
230      String script = "return {redis.call('hget',KEYS[1],ARGV[1]),redis.call('hget',KEYS[2],ARGV[2])}";
231      String sha = jedis.scriptLoad(script);
232      List<String> results = (List<String>) jedis.evalsha(sha, Arrays.asList("foo", "foobar"), Arrays.asList("foo1", "foo2"));
233      assertEquals(2, results.size());
234      assertEquals("bar1", results.get(0));
235      assertEquals("bar2", results.get(1));
236    }
237    @Test
238    public void scriptEvalShaReturnValuesBinary() {
239      jedis.hset(bfoo, bfoo1, bbar1);
240      jedis.hset(bfoobar, bfoo2, bbar2);
241      byte[] script = "return {redis.call('hget',KEYS[1],ARGV[1]),redis.call('hget',KEYS[2],ARGV[2])}".getBytes();
242      byte[] sha = jedis.scriptLoad(script);
243      List<byte[]> results = (List<byte[]>) jedis.evalsha(sha, Arrays.asList(bfoo, bfoobar), Arrays.asList(bfoo1, bfoo2));
244      assertEquals(2, results.size());
245      assertArrayEquals(bbar1, results.get(0));
246      assertArrayEquals(bbar2, results.get(1));
247    }
248    @Test
249    public void scriptExistsWithBrokenConnection() {
250      Jedis deadClient = createJedis();
251      deadClient.clientSetname("DEAD");
252      ClientKillerUtil.killClient(deadClient, "DEAD");
253      try {
254        deadClient.scriptExists("abcdefg");
255      } catch (JedisConnectionException e) {
256      }
257      assertEquals(true, deadClient.isBroken());
258      deadClient.close();
259    }
260    @Test
261    public void functionLoadAndDelete() {
262      String engine = "Lua";
263      String library = "mylib";
264      String function = "redis.register_function('myfunc', function(keys, args) return args[1] end)";
265      String functionCode = String.format("#!%s name=%s \n %s", engine, library, function);
266      assertEquals(library, jedis.functionLoad(functionCode));
267      assertEquals(library, jedis.functionLoadReplace(functionCode));
268      assertEquals("OK", jedis.functionDelete(library));
269      assertEquals(library, jedis.functionLoad(functionCode.getBytes()));
270      assertEquals(library, jedis.functionLoadReplace(functionCode.getBytes()));
271      assertEquals("OK", jedis.functionDelete(library.getBytes()));
272    }
273    @Test
274    public void functionFlush() {
275      String engine = "Lua";
276      String library = "mylib";
277      String function = "redis.register_function('myfunc', function(keys, args) return args[1] end)";
278      String functionCode = String.format("#!%s name=%s \n %s", engine, library, function);
279      assertEquals(library, jedis.functionLoad(functionCode));
280      jedis.functionFlush();
281      assertEquals(library, jedis.functionLoad(functionCode));
282      jedis.functionFlush(FlushMode.ASYNC);
283      assertEquals(library, jedis.functionLoad(functionCode));
284      jedis.functionFlush(FlushMode.SYNC);
285    }
286    @Test
287    public void functionList() {
288      String engine = "LUA";
289      String library = "mylib";
290      String function = "redis.register_function('myfunc', function(keys, args) return args[1] end)";
291      String functionCode = String.format("#!%s name=%s \n %s", engine, library, function);
292      jedis.functionLoad(functionCode);
293      LibraryInfo response = jedis.functionList().get(0);
294      assertEquals(library, response.getLibraryName());
295      assertEquals(engine, response.getEngine());
296      assertEquals(1, response.getFunctions().size());
297      Map func = response.getFunctions().get(0);
298      assertEquals("myfunc", func.get("name"));
299      assertNull(func.get("description"));
300      assertTrue(((List) func.get("flags")).isEmpty());
301      response = jedis.functionListWithCode().get(0);
302      assertEquals("myfunc", func.get("name"));
303      assertEquals(functionCode, response.getLibraryCode());
304      response = jedis.functionList(library).get(0);
305      assertEquals(library, response.getLibraryName());
306      response = jedis.functionListWithCode(library).get(0);
307      assertEquals(library, response.getLibraryName());
308      assertEquals(functionCode, response.getLibraryCode());
309      List<Object> bresponse = (List<Object>) jedis.functionListBinary().get(0);
310      assertArrayEquals(library.getBytes(), (byte[]) bresponse.get(1));
311      bresponse = (List<Object>) jedis.functionListWithCodeBinary().get(0);
312      assertArrayEquals(library.getBytes(), (byte[]) bresponse.get(1));
313      assertNotNull(bresponse.get(7));
314      bresponse = (List<Object>) jedis.functionList(library.getBytes()).get(0);
315      assertArrayEquals(library.getBytes(), (byte[]) bresponse.get(1));
316      bresponse = (List<Object>) jedis.functionListWithCode(library.getBytes()).get(0);
317      assertArrayEquals(library.getBytes(), (byte[]) bresponse.get(1));
318      assertNotNull(bresponse.get(7));
319    }
320    @Test
321    public void functionDumpRestore() {
322      String engine = "Lua";
323      String library = "mylib";
324      String function = "redis.register_function('myfunc', function(keys, args) return args[1] end)";
325      jedis.functionLoad(String.format("#!%s name=%s \n %s", engine, library, function));
326      byte[] payload = jedis.functionDump();
327      jedis.functionFlush();
328      assertEquals("OK", jedis.functionRestore(payload));
329      jedis.functionFlush();
330      assertEquals("OK", jedis.functionRestore(payload, FunctionRestorePolicy.FLUSH));
331      jedis.functionFlush();
332      assertEquals("OK", jedis.functionRestore(payload, FunctionRestorePolicy.APPEND));
333      jedis.functionFlush();
334      assertEquals("OK", jedis.functionRestore(payload, FunctionRestorePolicy.REPLACE));
335      jedis.functionFlush();
336    }
337    @Test
338    public void functionStatsWithoutRunning() {
339      String engine = "Lua";
340      String library = "mylib";
341      String function = "redis.register_function('myfunc', function(keys, args) return args[1] end)";
342      jedis.functionLoad(String.format("#!%s name=%s \n %s", engine, library, function));
343      FunctionStats stats = jedis.functionStats();
344      assertNull(stats.getRunningScript());
345      assertEquals(1, stats.getEngines().size());
346    }
347    @Test
348    public void functionKillWithoutRunningFunction() {
349      String engine = "Lua";
350      String library = "mylib";
351      String function = "redis.register_function('myfunc', function(keys, args)\n local a = 1 while true do a = a + 1 end \nend)";
352      jedis.functionLoad(String.format("#!%s name=%s \n %s", engine, library, function));
353      try {
354        jedis.functionKill();
355        fail("Should get NOTBUSY error.");
356      } catch (JedisDataException jde) {
357        assertEquals("NOTBUSY No scripts in execution right now.", jde.getMessage());
358      }
359    }
360    @Test
361    public void fcall() {
362      String engine = "Lua";
363      String library = "mylib";
364      String function = "redis.register_function('myfunc', function(keys, args) return args end)";
365      jedis.functionLoad(String.format("#!%s name=%s \n %s", engine, library, function));
366      List<String> args = Arrays.asList("hello");
367      assertEquals(args, jedis.fcall("myfunc", Collections.emptyList(), args));
368    }
369    @Test
370    public void fcallBinary() {
371      String engine = "Lua";
372      String library = "mylib";
373      String function = "redis.register_function('myfunc', function(keys, args) return args[1] end)";
374      jedis.functionLoad(String.format("#!%s name=%s \n %s", engine, library, function));
375      List<byte[]> bargs = Arrays.asList("hello".getBytes());
376      assertArrayEquals("hello".getBytes(), (byte[]) jedis.fcall("myfunc".getBytes(), Collections.emptyList(), bargs));
377    }
378    @Test
379    public void fcallReadonly() {
380      String engine = "Lua";
381      String library = "mylib";
382      String function = "redis.register_function{function_name='noop', callback=function() return 1 end, flags={ 'no-writes' }}";
383      jedis.functionLoad(String.format("#!%s name=%s \n %s", engine, library, function));
<span onclick='openModal()' class='match'>384      assertEquals(Long.valueOf(1), jedis.fcallReadonly("noop", Collections.emptyList(), Collections.emptyList()));
385      assertEquals(Long.valueOf(1), jedis.fcallReadonly("noop".getBytes(), Collections.emptyList(), Collections.emptyList()));
386    }
387  }
</span></code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from segmentfault-lessons-MDEwOlJlcG9zaXRvcnk5MzE1NzM4MQ==-flat-PersonSpringBootTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ScriptingCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>17          Assert.assertEquals(Long.valueOf(1L), person.getId());
18          Assert.assertEquals("小马哥", person.getName());
19          Assert.assertEquals(Integer.valueOf(32), person.getAge());
20      }
21  }
</pre></code></div>
                <div class="column column_space"><pre><code>384      assertEquals(Long.valueOf(1), jedis.fcallReadonly("noop", Collections.emptyList(), Collections.emptyList()));
385      assertEquals(Long.valueOf(1), jedis.fcallReadonly("noop".getBytes(), Collections.emptyList(), Collections.emptyList()));
386    }
387  }
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    