
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 36, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SearchTest.java</h3>
            <pre><code>1  package redis.clients.jedis.modules.search;
2  import static org.junit.Assert.*;
3  import java.util.*;
4  import org.hamcrest.Matchers;
5  import org.junit.BeforeClass;
6  import org.junit.Test;
7  import redis.clients.jedis.exceptions.JedisDataException;
8  import redis.clients.jedis.json.Path;
9  import redis.clients.jedis.search.*;
10  import redis.clients.jedis.search.Schema.*;
11  import redis.clients.jedis.modules.RedisModuleCommandsTestBase;
12  import redis.clients.jedis.util.SafeEncoder;
13  public class SearchTest extends RedisModuleCommandsTestBase {
14    private static final String index = &quot;testindex&quot;;
15    @BeforeClass
16    public static void prepare() {
17      RedisModuleCommandsTestBase.prepare();
18    }
19    private void addDocument(String key, Map&lt;String, Object&gt; map) {
20      client.hset(key, RediSearchUtil.toStringMap(map));
21    }
22    private static Map&lt;String, Object&gt; toMap(Object... values) {
23      Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
24      for (int i = 0; i &lt; values.length; i += 2) {
25        map.put((String) values[i], values[i + 1]);
26      }
27      return map;
28    }
29    private static Map&lt;String, String&gt; toMap(String... values) {
30      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
31      for (int i = 0; i &lt; values.length; i += 2) {
32        map.put(values[i], values[i + 1]);
33      }
34      return map;
35    }
36    @Test
37    public void create() throws Exception {
38      Schema sc = new Schema().addTextField(&quot;first&quot;, 1.0).addTextField(&quot;last&quot;, 1.0).addNumericField(&quot;age&quot;);
39      IndexDefinition rule = new IndexDefinition()
40          .setFilter(&quot;@age&gt;16&quot;)
41          .setPrefixes(new String[]{&quot;student:&quot;, &quot;pupil:&quot;});
42      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions().setDefinition(rule), sc));
43      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
44      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
45      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
46      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
47      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
48      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
49      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
50      SearchResult noFilters = client.ftSearch(index, new Query());
51      assertEquals(4, noFilters.getTotalResults());
52      SearchResult res1 = client.ftSearch(index, new Query(&quot;@first:Jo*&quot;));
53      assertEquals(2, res1.getTotalResults());
54      SearchResult res2 = client.ftSearch(index, new Query(&quot;@first:Pat&quot;));
55      assertEquals(1, res2.getTotalResults());
56      SearchResult res3 = client.ftSearch(index, new Query(&quot;@last:Rod&quot;));
57      assertEquals(0, res3.getTotalResults());
58    }
59    @Test
60    public void createNoParams() throws Exception {
61      Schema sc = new Schema().addTextField(&quot;first&quot;, 1.0).addTextField(&quot;last&quot;, 1.0).addNumericField(&quot;age&quot;);
62      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
63      addDocument(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, 18));
64      addDocument(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, 17));
65      addDocument(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, 21));
66      addDocument(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, 20));
67      SearchResult noFilters = client.ftSearch(index, new Query());
68      assertEquals(4, noFilters.getTotalResults());
69      SearchResult res1 = client.ftSearch(index, new Query(&quot;@first:Jo*&quot;));
70      assertEquals(2, res1.getTotalResults());
71      SearchResult res2 = client.ftSearch(index, new Query(&quot;@first:Pat&quot;));
72      assertEquals(1, res2.getTotalResults());
73      SearchResult res3 = client.ftSearch(index, new Query(&quot;@last:Rod&quot;));
74      assertEquals(0, res3.getTotalResults());
75    }
76    @Test
77    public void createWithFieldNames() throws Exception {
78      Schema sc = new Schema().addField(new TextField(FieldName.of(&quot;first&quot;).as(&quot;given&quot;)))
79          .addField(new TextField(FieldName.of(&quot;last&quot;)));
80      IndexDefinition rule = new IndexDefinition()
81          .setPrefixes(new String[]{&quot;student:&quot;, &quot;pupil:&quot;});
82      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions().setDefinition(rule), sc));
83      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
84      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
85      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
86      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
87      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
88      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
89      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
90      SearchResult noFilters = client.ftSearch(index, new Query());
91      assertEquals(5, noFilters.getTotalResults());
92      SearchResult asOriginal = client.ftSearch(index, new Query(&quot;@first:Jo*&quot;));
93      assertEquals(0, asOriginal.getTotalResults());
94      SearchResult asAttribute = client.ftSearch(index, new Query(&quot;@given:Jo*&quot;));
95      assertEquals(2, asAttribute.getTotalResults());
96      SearchResult nonAttribute = client.ftSearch(index, new Query(&quot;@last:Rod&quot;));
97      assertEquals(1, nonAttribute.getTotalResults());
98    }
99    @Test
100    public void alterAdd() throws Exception {
101      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
102      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
103      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
104      fields.put(&quot;title&quot;, &quot;hello world&quot;);
105      for (int i = 0; i &lt; 100; i++) {
106        addDocument(String.format(&quot;doc%d&quot;, i), fields);
107      }
108      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;));
109      assertEquals(100, res.getTotalResults());
110      assertEquals(&quot;OK&quot;, client.ftAlter(index, new TagField(&quot;tags&quot;, &quot;,&quot;), new TextField(&quot;name&quot;, 0.5)));
111      for (int i = 0; i &lt; 100; i++) {
112        Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
113        fields2.put(&quot;name&quot;, &quot;name&quot; + i);
114        fields2.put(&quot;tags&quot;, String.format(&quot;tagA,tagB,tag%d&quot;, i));
115        addDocument(String.format(&quot;doc%d&quot;, i), fields2);
116      }
117      SearchResult res2 = client.ftSearch(index, new Query(&quot;@tags:{tagA}&quot;));
118      assertEquals(100, res2.getTotalResults());
119      Map&lt;String, Object&gt; info = client.ftInfo(index);
120      assertEquals(index, info.get(&quot;index_name&quot;));
121      assertEquals(&quot;identifier&quot;, ((List) ((List) info.get(&quot;attributes&quot;)).get(1)).get(0));
122      assertEquals(&quot;attribute&quot;, ((List) ((List) info.get(&quot;attributes&quot;)).get(1)).get(2));
123    }
124    @Test
125    public void search() throws Exception {
126      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0).addTextField(&quot;body&quot;, 1.0);
127      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
128      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
129      fields.put(&quot;title&quot;, &quot;hello world&quot;);
130      fields.put(&quot;body&quot;, &quot;lorem ipsum&quot;);
131      for (int i = 0; i &lt; 100; i++) {
132        addDocument(String.format(&quot;doc%d&quot;, i), fields);
133      }
134      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;).limit(0, 5).setWithScores());
135      assertEquals(100, res.getTotalResults());
136      assertEquals(5, res.getDocuments().size());
137      for (Document d : res.getDocuments()) {
138        assertTrue(d.getId().startsWith(&quot;doc&quot;));
139        assertTrue(d.getScore() &lt; 100);
140      }
141      client.del(&quot;doc0&quot;);
142      res = client.ftSearch(index, new Query(&quot;hello world&quot;));
143      assertEquals(99, res.getTotalResults());
144      assertEquals(&quot;OK&quot;, client.ftDropIndex(index));
145      try {
146        client.ftSearch(index, new Query(&quot;hello world&quot;));
147        fail();
148      } catch (JedisDataException e) {
149      }
150    }
151    @Test
152    public void numericFilter() throws Exception {
153      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0).addNumericField(&quot;price&quot;);
154      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
155      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
156      fields.put(&quot;title&quot;, &quot;hello world&quot;);
157      for (int i = 0; i &lt; 100; i++) {
158        fields.put(&quot;price&quot;, i);
159        addDocument(String.format(&quot;doc%d&quot;, i), fields);
160      }
161      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;).
162          addFilter(new Query.NumericFilter(&quot;price&quot;, 0, 49)));
163      assertEquals(50, res.getTotalResults());
164      assertEquals(10, res.getDocuments().size());
165      for (Document d : res.getDocuments()) {
166        long price = Long.valueOf((String) d.get(&quot;price&quot;));
167        assertTrue(price &gt;= 0);
168        assertTrue(price &lt;= 49);
169      }
170      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
171          addFilter(new Query.NumericFilter(&quot;price&quot;, 0, true, 49, true)));
172      assertEquals(48, res.getTotalResults());
173      assertEquals(10, res.getDocuments().size());
174      for (Document d : res.getDocuments()) {
175        long price = Long.valueOf((String) d.get(&quot;price&quot;));
176        assertTrue(price &gt; 0);
177        assertTrue(price &lt; 49);
178      }
179      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
180          addFilter(new Query.NumericFilter(&quot;price&quot;, 50, 100)));
181      assertEquals(50, res.getTotalResults());
182      assertEquals(10, res.getDocuments().size());
183      for (Document d : res.getDocuments()) {
184        long price = Long.valueOf((String) d.get(&quot;price&quot;));
185        assertTrue(price &gt;= 50);
186        assertTrue(price &lt;= 100);
187      }
188      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
189          addFilter(new Query.NumericFilter(&quot;price&quot;, 20, Double.POSITIVE_INFINITY)));
190      assertEquals(80, res.getTotalResults());
191      assertEquals(10, res.getDocuments().size());
192      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
193          addFilter(new Query.NumericFilter(&quot;price&quot;, Double.NEGATIVE_INFINITY, 10)));
194      assertEquals(11, res.getTotalResults());
195      assertEquals(10, res.getDocuments().size());
196    }
197    @Test
198    public void stopwords() throws Exception {
199      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
200      assertEquals(&quot;OK&quot;, client.ftCreate(index,
201          IndexOptions.defaultOptions().setStopwords(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;), sc));
202      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
203      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
204      addDocument(&quot;doc1&quot;, fields);
205      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;));
206      assertEquals(1, res.getTotalResults());
207      res = client.ftSearch(index, new Query(&quot;foo bar&quot;));
208      assertEquals(0, res.getTotalResults());
209    }
210    @Test
211    public void noStopwords() throws Exception {
212      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
213      assertEquals(&quot;OK&quot;, client.ftCreate(index,
214          IndexOptions.defaultOptions().setNoStopwords(), sc));
215      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
216      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
217      fields.put(&quot;title&quot;, &quot;hello world foo bar to be or not to be&quot;);
218      addDocument(&quot;doc1&quot;, fields);
219      assertEquals(1, client.ftSearch(index, new Query(&quot;hello world&quot;)).getTotalResults());
220      assertEquals(1, client.ftSearch(index, new Query(&quot;foo bar&quot;)).getTotalResults());
221      assertEquals(1, client.ftSearch(index, new Query(&quot;to be or not to be&quot;)).getTotalResults());
222    }
223    @Test
224    public void geoFilter() throws Exception {
225      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0).addGeoField(&quot;loc&quot;);
226      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
227      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
228      fields.put(&quot;title&quot;, &quot;hello world&quot;);
229      fields.put(&quot;loc&quot;, &quot;-0.441,51.458&quot;);
230      addDocument(&quot;doc1&quot;, fields);
231      fields.put(&quot;loc&quot;, &quot;-0.1,51.2&quot;);
232      addDocument(&quot;doc2&quot;, fields);
233      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;).
234          addFilter(
235              new Query.GeoFilter(&quot;loc&quot;, -0.44, 51.45,
236                  10, Query.GeoFilter.KILOMETERS)
237          ));
238      assertEquals(1, res.getTotalResults());
239      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
240          addFilter(
241              new Query.GeoFilter(&quot;loc&quot;, -0.44, 51.45,
242                  100, Query.GeoFilter.KILOMETERS)
243          ));
244      assertEquals(2, res.getTotalResults());
245    }
246    @Test
247    public void geoFilterAndGeoCoordinateObject() throws Exception {
248      Schema schema = new Schema().addTextField(&quot;title&quot;, 1.0).addGeoField(&quot;loc&quot;);
249      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), schema));
250      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
251      fields.put(&quot;title&quot;, &quot;hello world&quot;);
252      fields.put(&quot;loc&quot;, new redis.clients.jedis.GeoCoordinate(-0.441, 51.458));
253      addDocument(&quot;doc1&quot;, fields);
254      fields.put(&quot;loc&quot;, new redis.clients.jedis.GeoCoordinate(-0.1, 51.2));
255      addDocument(&quot;doc2&quot;, fields);
256      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;).addFilter(
257          new Query.GeoFilter(&quot;loc&quot;, -0.44, 51.45, 10, Query.GeoFilter.KILOMETERS)));
258      assertEquals(1, res.getTotalResults());
259      res = client.ftSearch(index, new Query(&quot;hello world&quot;).addFilter(
260          new Query.GeoFilter(&quot;loc&quot;, -0.44, 51.45, 100, Query.GeoFilter.KILOMETERS)));
261      assertEquals(2, res.getTotalResults());
262    }
263    @Test
264    public void testQueryFlags() throws Exception {
265      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
266      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
267      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
268      for (int i = 0; i &lt; 100; i++) {
269        fields.put(&quot;title&quot;, i % 2 != 0 ? &quot;hello worlds&quot; : &quot;hello world&quot;);
270        addDocument(String.format(&quot;doc%d&quot;, i), fields);
271      }
272      Query q = new Query(&quot;hello&quot;).setWithScores();
273      SearchResult res = client.ftSearch(index, q);
274      assertEquals(100, res.getTotalResults());
275      assertEquals(10, res.getDocuments().size());
276      for (Document d : res.getDocuments()) {
277        assertTrue(d.getId().startsWith(&quot;doc&quot;));
278        assertTrue(((String) d.get(&quot;title&quot;)).startsWith(&quot;hello world&quot;));
279      }
280      q = new Query(&quot;hello&quot;).setNoContent();
281      res = client.ftSearch(index, q);
282      for (Document d : res.getDocuments()) {
283        assertTrue(d.getId().startsWith(&quot;doc&quot;));
284        assertEquals(1.0, d.getScore(), 0);
285        assertNull(d.get(&quot;title&quot;));
286      }
287      res = client.ftSearch(index, new Query(&quot;hello worlds&quot;));
288      assertEquals(100, res.getTotalResults());
289      res = client.ftSearch(index, new Query(&quot;hello worlds&quot;).setVerbatim());
290      assertEquals(50, res.getTotalResults());
291      res = client.ftSearch(index, new Query(&quot;hello a world&quot;).setVerbatim());
292      assertEquals(50, res.getTotalResults());
293      res = client.ftSearch(index, new Query(&quot;hello a worlds&quot;).setVerbatim());
294      assertEquals(50, res.getTotalResults());
295      res = client.ftSearch(index, new Query(&quot;hello a world&quot;).setVerbatim().setNoStopwords());
296      assertEquals(0, res.getTotalResults());
297    }
298    @Test
299    public void testQueryParams() {
300      Schema sc = new Schema().addNumericField(&quot;numval&quot;);
301      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
302      client.hset(&quot;1&quot;, &quot;numval&quot;, &quot;1&quot;);
303      client.hset(&quot;2&quot;, &quot;numval&quot;, &quot;2&quot;);
304      client.hset(&quot;3&quot;, &quot;numval&quot;, &quot;3&quot;);
305      Query query =  new Query(&quot;@numval:[$min $max]&quot;).addParam(&quot;min&quot;, 1).addParam(&quot;max&quot;, 2).dialect(2);
306      assertEquals(2, client.ftSearch(index, query).getTotalResults());
307    }
308    @Test
309    public void testSortQueryFlags() throws Exception {
310      Schema sc = new Schema().addSortableTextField(&quot;title&quot;, 1.0);
311      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
312      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
313      fields.put(&quot;title&quot;, &quot;b title&quot;);
314      addDocument(&quot;doc1&quot;, fields);
315      fields.put(&quot;title&quot;, &quot;a title&quot;);
316      addDocument(&quot;doc2&quot;, fields);
317      fields.put(&quot;title&quot;, &quot;c title&quot;);
318      addDocument(&quot;doc3&quot;, fields);
319      Query q = new Query(&quot;title&quot;).setSortBy(&quot;title&quot;, true);
320      SearchResult res = client.ftSearch(index, q);
321      assertEquals(3, res.getTotalResults());
322      Document doc1 = res.getDocuments().get(0);
323      assertEquals(&quot;a title&quot;, doc1.get(&quot;title&quot;));
324      doc1 = res.getDocuments().get(1);
325      assertEquals(&quot;b title&quot;, doc1.get(&quot;title&quot;));
326      doc1 = res.getDocuments().get(2);
327      assertEquals(&quot;c title&quot;, doc1.get(&quot;title&quot;));
328    }
329    @Test
330    public void testNullField() throws Exception {
331      Schema sc = new Schema()
332          .addTextField(&quot;title&quot;, 1.0)
333          .addTextField(&quot;genre&quot;, 1.0)
334          .addTextField(&quot;plot&quot;, 1.0)
335          .addSortableNumericField(&quot;release_year&quot;)
336          .addTagField(&quot;tag&quot;)
337          .addGeoField(&quot;loc&quot;);
338      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
339      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
340      fields.put(&quot;title&quot;, &quot;another test with title &quot;);
341      fields.put(&quot;genre&quot;, &quot;Comedy&quot;);
342      fields.put(&quot;plot&quot;, &quot;this is the plot for the test&quot;);
343      fields.put(&quot;tag&quot;, &quot;fun&quot;);
344      fields.put(&quot;release_year&quot;, 2019);
345      fields.put(&quot;loc&quot;, &quot;-0.1,51.2&quot;);
346      addDocument(&quot;doc1&quot;, fields);
347      SearchResult res = client.ftSearch(index, new Query(&quot;title&quot;));
348      assertEquals(1, res.getTotalResults());
<span onclick='openModal()' class='match'>349      fields = new HashMap&lt;&gt;();
350      fields.put(&quot;title&quot;, &quot;another title another test&quot;);
351      fields.put(&quot;genre&quot;, &quot;Action&quot;);
352      fields.put(&quot;plot&quot;, null);
353      fields.put(&quot;tag&quot;, null);
</span>354      try {
355        addDocument(&quot;doc2&quot;, fields);
356        fail(&quot;Should throw NullPointerException.&quot;);
357      } catch (NullPointerException e) {
358      }
359      res = client.ftSearch(index, new Query(&quot;title&quot;));
360      assertEquals(1, res.getTotalResults());
361      fields = new HashMap&lt;&gt;();
362      fields.put(&quot;title&quot;, &quot;another title another test&quot;);
363      fields.put(&quot;genre&quot;, &quot;Action&quot;);
364      fields.put(&quot;release_year&quot;, null);
365      try {
366        addDocument(&quot;doc2&quot;, fields);
367        fail(&quot;Should throw NullPointerException.&quot;);
368      } catch (NullPointerException e) {
369      }
370      res = client.ftSearch(index, new Query(&quot;title&quot;));
371      assertEquals(1, res.getTotalResults());
372    }
373    @Test
374    public void testJsonWithAlias() {
375      Schema sc = new Schema()
376              .addTextField(&quot;$.name&quot;, 1.0).as(&quot;name&quot;)
377              .addNumericField(&quot;$.num&quot;).as(&quot;num&quot;);
378      IndexDefinition definition = new IndexDefinition(IndexDefinition.Type.JSON).setPrefixes(&quot;king:&quot;);
379      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions().setDefinition(definition), sc));
380      Map&lt;String, Object&gt; king1 = new HashMap&lt;&gt;();
381      king1.put(&quot;name&quot;, &quot;henry&quot;);
382      king1.put(&quot;num&quot;, 42);
383      client.jsonSet(&quot;king:1&quot;, Path.ROOT_PATH, king1);
384      Map&lt;String, Object&gt; king2 = new HashMap&lt;&gt;();
385      king2.put(&quot;name&quot;, &quot;james&quot;);
386      king2.put(&quot;num&quot;, 3.14);
387      client.jsonSet(&quot;king:2&quot;, Path.ROOT_PATH, king2);
388      SearchResult res = client.ftSearch(index, new Query(&quot;@name:henry&quot;));
389      assertEquals(1, res.getTotalResults());
390      assertEquals(&quot;king:1&quot;, res.getDocuments().get(0).getId());
391      res = client.ftSearch(index, new Query(&quot;@num:[0 10]&quot;));
392      assertEquals(1, res.getTotalResults());
393      assertEquals(&quot;king:2&quot;, res.getDocuments().get(0).getId());
394    }
395    @Test
396    public void dropIndex() throws Exception {
397      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
398      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
399      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
400      fields.put(&quot;title&quot;, &quot;hello world&quot;);
401      for (int i = 0; i &lt; 100; i++) {
402        addDocument(String.format(&quot;doc%d&quot;, i), fields);
403      }
404      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;));
405      assertEquals(100, res.getTotalResults());
406      assertEquals(&quot;OK&quot;, client.ftDropIndex(index));
407      try {
408        client.ftSearch(index, new Query(&quot;hello world&quot;));
409        fail(&quot;Index should not exist.&quot;);
410      } catch (JedisDataException de) {
411        assertTrue(de.getMessage().contains(&quot;no such index&quot;));
412      }
413      assertEquals(100, client.dbSize());
414    }
415    @Test
416    public void dropIndexDD() throws Exception {
417      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
418      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
419      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
420      fields.put(&quot;title&quot;, &quot;hello world&quot;);
421      for (int i = 0; i &lt; 100; i++) {
422        addDocument(String.format(&quot;doc%d&quot;, i), fields);
423      }
424      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;));
425      assertEquals(100, res.getTotalResults());
426      assertEquals(&quot;OK&quot;, client.ftDropIndexDD(index));
427      Set&lt;String&gt; keys = client.keys(&quot;*&quot;);
428      assertTrue(keys.isEmpty());
429      assertEquals(0, client.dbSize());
430    }
431    @Test
432    public void noStem() throws Exception {
433      Schema sc = new Schema().addTextField(&quot;stemmed&quot;, 1.0).addField(new Schema.TextField(&quot;notStemmed&quot;, 1.0, false, true));
434      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
435      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
436      doc.put(&quot;stemmed&quot;, &quot;located&quot;);
437      doc.put(&quot;notStemmed&quot;, &quot;located&quot;);
438      addDocument(&quot;doc&quot;, doc);
439      SearchResult res = client.ftSearch(index, new Query(&quot;@stemmed:location&quot;));
440      assertEquals(1, res.getTotalResults());
441      res = client.ftSearch(index, new Query(&quot;@notStemmed:location&quot;));
442      assertEquals(0, res.getTotalResults());
443    }
444    @Test
445    public void phoneticMatch() throws Exception {
446      Schema sc = new Schema()
447          .addTextField(&quot;noPhonetic&quot;, 1.0)
448          .addField(new Schema.TextField(&quot;withPhonetic&quot;, 1.0, false, false, false, &quot;dm:en&quot;));
449      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
450      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
451      doc.put(&quot;noPhonetic&quot;, &quot;morfix&quot;);
452      doc.put(&quot;withPhonetic&quot;, &quot;morfix&quot;);
453      addDocument(&quot;doc&quot;, doc);
454      SearchResult res = client.ftSearch(index, new Query(&quot;@withPhonetic:morphix=&gt;{$phonetic:true}&quot;));
455      assertEquals(1, res.getTotalResults());
456      try {
457        client.ftSearch(index, new Query(&quot;@noPhonetic:morphix=&gt;{$phonetic:true}&quot;));
458        fail();
459      } catch (JedisDataException e) {&amp;bsol;*field does not support phonetics*/
460      }
461      SearchResult res3 = client.ftSearch(index, new Query(&quot;@withPhonetic:morphix=&gt;{$phonetic:false}&quot;));
462      assertEquals(0, res3.getTotalResults());
463    }
464    @Test
465    public void info() throws Exception {
466      String MOVIE_ID = &quot;movie_id&quot;;
467      String TITLE = &quot;title&quot;;
468      String GENRE = &quot;genre&quot;;
469      String VOTES = &quot;votes&quot;;
470      String RATING = &quot;rating&quot;;
471      String RELEASE_YEAR = &quot;release_year&quot;;
472      String PLOT = &quot;plot&quot;;
473      String POSTER = &quot;poster&quot;;
474      Schema sc = new Schema()
475          .addTextField(TITLE, 5.0)
476          .addSortableTextField(PLOT, 1.0)
477          .addSortableTagField(GENRE, &quot;,&quot;)
478          .addSortableNumericField(RELEASE_YEAR)
479          .addSortableNumericField(RATING)
480          .addSortableNumericField(VOTES);
481      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
482      Map&lt;String, Object&gt; info = client.ftInfo(index);
483      assertEquals(index, info.get(&quot;index_name&quot;));
484      assertEquals(6, ((List) info.get(&quot;attributes&quot;)).size());
485      assertEquals(&quot;global_idle&quot;, ((List) info.get(&quot;cursor_stats&quot;)).get(0));
486      assertEquals(0L, ((List) info.get(&quot;cursor_stats&quot;)).get(1));
487    }
488    @Test
489    public void noIndex() throws Exception {
490      Schema sc = new Schema()
491          .addField(new Schema.TextField(&quot;f1&quot;, 1.0, true, false, true))
492          .addField(new Schema.TextField(&quot;f2&quot;, 1.0));
493      client.ftCreate(index, IndexOptions.defaultOptions(), sc);
494      Map&lt;String, Object&gt; mm = new HashMap&lt;&gt;();
495      mm.put(&quot;f1&quot;, &quot;MarkZZ&quot;);
496      mm.put(&quot;f2&quot;, &quot;MarkZZ&quot;);
497      addDocument(&quot;doc1&quot;, mm);
498      mm.clear();
499      mm.put(&quot;f1&quot;, &quot;MarkAA&quot;);
500      mm.put(&quot;f2&quot;, &quot;MarkBB&quot;);
501      addDocument(&quot;doc2&quot;, mm);
502      SearchResult res = client.ftSearch(index, new Query(&quot;@f1:Mark*&quot;));
503      assertEquals(0, res.getTotalResults());
504      res = client.ftSearch(index, new Query(&quot;@f2:Mark*&quot;));
505      assertEquals(2, res.getTotalResults());
506      Document[] docs = new Document[2];
507      res = client.ftSearch(index, new Query(&quot;@f2:Mark*&quot;).setSortBy(&quot;f1&quot;, false));
508      assertEquals(2, res.getTotalResults());
509      res.getDocuments().toArray(docs);
510      assertEquals(&quot;doc1&quot;, docs[0].getId());
511      res = client.ftSearch(index, new Query(&quot;@f2:Mark*&quot;).setSortBy(&quot;f1&quot;, true));
512      res.getDocuments().toArray(docs);
513      assertEquals(&quot;doc2&quot;, docs[0].getId());
514    }
515    @Test
516    public void testExplain() throws Exception {
517      Schema sc = new Schema()
518          .addTextField(&quot;f1&quot;, 1.0)
519          .addTextField(&quot;f2&quot;, 1.0)
520          .addTextField(&quot;f3&quot;, 1.0);
521      client.ftCreate(index, IndexOptions.defaultOptions(), sc);
522      String res = client.ftExplain(index, new Query(&quot;@f3:f3_val @f2:f2_val @f1:f1_val&quot;));
523      assertNotNull(res);
524      assertFalse(res.isEmpty());
525    }
526    @Test
527    public void testHighlightSummarize() throws Exception {
528      Schema sc = new Schema().addTextField(&quot;text&quot;, 1.0);
529      client.ftCreate(index, IndexOptions.defaultOptions(), sc);
530      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
531      doc.put(&quot;text&quot;, &quot;Redis is often referred as a data structures server. What this means is that Redis provides access to mutable data structures via a set of commands, which are sent using a server-client model with TCP sockets and a simple protocol. So different processes can query and modify the same data structures in a shared way&quot;);
532      addDocument(&quot;foo&quot;, doc);
533      Query q = new Query(&quot;data&quot;).highlightFields().summarizeFields();
534      SearchResult res = client.ftSearch(index, q);
535      assertEquals(&quot;is often referred as a &lt;b&gt;data&lt;/b&gt; structures server. What this means is that Redis provides... What this means is that Redis provides access to mutable &lt;b&gt;data&lt;/b&gt; structures via a set of commands, which are sent using a... So different processes can query and modify the same &lt;b&gt;data&lt;/b&gt; structures in a shared... &quot;,
536          res.getDocuments().get(0).get(&quot;text&quot;));
537      q = new Query(&quot;data&quot;).highlightFields(new Query.HighlightTags(&quot;&lt;u&gt;&quot;, &quot;&lt;/u&gt;&quot;)).summarizeFields();
538      res = client.ftSearch(index, q);
539      assertEquals(&quot;is often referred as a &lt;u&gt;data&lt;/u&gt; structures server. What this means is that Redis provides... What this means is that Redis provides access to mutable &lt;u&gt;data&lt;/u&gt; structures via a set of commands, which are sent using a... So different processes can query and modify the same &lt;u&gt;data&lt;/u&gt; structures in a shared... &quot;,
540          res.getDocuments().get(0).get(&quot;text&quot;));
541    }
542    @Test
543    public void getTagField() {
544      Schema sc = new Schema()
545          .addTextField(&quot;title&quot;, 1.0)
546          .addTagField(&quot;category&quot;);
547      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
548      Map&lt;String, Object&gt; fields1 = new HashMap&lt;&gt;();
549      fields1.put(&quot;title&quot;, &quot;hello world&quot;);
550      fields1.put(&quot;category&quot;, &quot;red&quot;);
551      addDocument(&quot;foo&quot;, fields1);
552      Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
553      fields2.put(&quot;title&quot;, &quot;hello world&quot;);
554      fields2.put(&quot;category&quot;, &quot;blue&quot;);
555      addDocument(&quot;bar&quot;, fields2);
556      Map&lt;String, Object&gt; fields3 = new HashMap&lt;&gt;();
557      fields3.put(&quot;title&quot;, &quot;hello world&quot;);
558      fields3.put(&quot;category&quot;, &quot;green,yellow&quot;);
559      addDocument(&quot;baz&quot;, fields3);
560      Map&lt;String, Object&gt; fields4 = new HashMap&lt;&gt;();
561      fields4.put(&quot;title&quot;, &quot;hello world&quot;);
562      fields4.put(&quot;category&quot;, &quot;orange;purple&quot;);
563      addDocument(&quot;qux&quot;, fields4);
564      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{red}&quot;)).getTotalResults());
565      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{blue}&quot;)).getTotalResults());
566      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{red}&quot;)).getTotalResults());
567      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{blue}&quot;)).getTotalResults());
568      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{yellow}&quot;)).getTotalResults());
569      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{purple}&quot;)).getTotalResults());
570      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{orange\\;purple}&quot;)).getTotalResults());
571      assertEquals(4, client.ftSearch(index, new Query(&quot;hello&quot;)).getTotalResults());
572      assertEquals(new HashSet&lt;&gt;(Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;orange;purple&quot;)),
573          client.ftTagVals(index, &quot;category&quot;));
574    }
575    @Test
576    public void testGetTagFieldWithNonDefaultSeparator() {
577      Schema sc = new Schema()
578          .addTextField(&quot;title&quot;, 1.0)
579          .addTagField(&quot;category&quot;, &quot;;&quot;);
580      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
581      Map&lt;String, Object&gt; fields1 = new HashMap&lt;&gt;();
582      fields1.put(&quot;title&quot;, &quot;hello world&quot;);
583      fields1.put(&quot;category&quot;, &quot;red&quot;);
584      addDocument(&quot;foo&quot;, fields1);
585      Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
586      fields2.put(&quot;title&quot;, &quot;hello world&quot;);
587      fields2.put(&quot;category&quot;, &quot;blue&quot;);
588      addDocument(&quot;bar&quot;, fields2);
589      Map&lt;String, Object&gt; fields3 = new HashMap&lt;&gt;();
590      fields3.put(&quot;title&quot;, &quot;hello world&quot;);
591      fields3.put(&quot;category&quot;, &quot;green;yellow&quot;);
592      addDocument(&quot;baz&quot;, fields3);
593      Map&lt;String, Object&gt; fields4 = new HashMap&lt;&gt;();
594      fields4.put(&quot;title&quot;, &quot;hello world&quot;);
595      fields4.put(&quot;category&quot;, &quot;orange,purple&quot;);
596      addDocument(&quot;qux&quot;, fields4);
597      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{red}&quot;)).getTotalResults());
598      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{blue}&quot;)).getTotalResults());
599      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{red}&quot;)).getTotalResults());
600      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{blue}&quot;)).getTotalResults());
601      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{yellow}&quot;)).getTotalResults());
602      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{purple}&quot;)).getTotalResults());
603      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{orange\\,purple}&quot;)).getTotalResults());
604      assertEquals(4, client.ftSearch(index, new Query(&quot;hello&quot;)).getTotalResults());
605      assertEquals(new HashSet&lt;&gt;(Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;orange,purple&quot;)),
606          client.ftTagVals(index, &quot;category&quot;));
607    }
608    @Test
609    public void caseSensitiveTagField() {
610      Schema sc = new Schema()
611          .addTextField(&quot;title&quot;, 1.0)
612          .addTagField(&quot;category&quot;, true &amp;bsol;*casesensitive*/);
613      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
614      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
615      fields.put(&quot;title&quot;, &quot;hello world&quot;);
616      fields.put(&quot;category&quot;, &quot;RedX&quot;);
617      addDocument(&quot;foo&quot;, fields);
618      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{redx}&quot;)).getTotalResults());
619      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{redX}&quot;)).getTotalResults());
620      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{Redx}&quot;)).getTotalResults());
621      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{RedX}&quot;)).getTotalResults());
622      assertEquals(1, client.ftSearch(index, new Query(&quot;hello&quot;)).getTotalResults());
623    }
624    @Test
625    public void testReturnFields() throws Exception {
626      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
627      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
628      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
629      doc.put(&quot;field1&quot;, &quot;value1&quot;);
630      doc.put(&quot;field2&quot;, &quot;value2&quot;);
631      addDocument(&quot;doc&quot;, doc);
632      SearchResult res = client.ftSearch(index, new Query(&quot;*&quot;).returnFields(&quot;field1&quot;));
633      assertEquals(1, res.getTotalResults());
634      assertEquals(&quot;value1&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
635      assertNull(res.getDocuments().get(0).get(&quot;field2&quot;));
636    }
637    @Test
638    public void returnWithFieldNames() throws Exception {
639      Schema sc = new Schema().addTextField(&quot;a&quot;, 1).addTextField(&quot;b&quot;, 1).addTextField(&quot;c&quot;, 1);
640      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
641      Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
642      map.put(&quot;a&quot;, &quot;value1&quot;);
643      map.put(&quot;b&quot;, &quot;value2&quot;);
644      map.put(&quot;c&quot;, &quot;value3&quot;);
645      addDocument(&quot;doc&quot;, map);
646      SearchResult res = client.ftSearch(index,
647          new Query().returnFields(FieldName.of(&quot;a&quot;), FieldName.of(&quot;b&quot;).as(&quot;d&quot;)));
648      assertEquals(1, res.getTotalResults());
649      Document doc = res.getDocuments().get(0);
650      assertEquals(&quot;value1&quot;, doc.get(&quot;a&quot;));
651      assertNull(doc.get(&quot;b&quot;));
652      assertEquals(&quot;value2&quot;, doc.get(&quot;d&quot;));
653      assertNull(doc.get(&quot;c&quot;));
654    }
655    @Test
656    public void inKeys() throws Exception {
657      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
658      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
659      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
660      doc.put(&quot;field1&quot;, &quot;value&quot;);
661      doc.put(&quot;field2&quot;, &quot;not&quot;);
662      addDocument(&quot;doc1&quot;, doc);
663      addDocument(&quot;doc2&quot;, doc);
664      SearchResult res = client.ftSearch(index, new Query(&quot;value&quot;).limitKeys(&quot;doc1&quot;));
665      assertEquals(1, res.getTotalResults());
666      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
667      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
668      assertEquals(null, res.getDocuments().get(0).get(&quot;value&quot;));
669    }
670    @Test
671    public void blobField() throws Exception {
672      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0);
673      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
674      byte[] blob = new byte[]{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12};
675      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
676      doc.put(&quot;field1&quot;, &quot;value&quot;);
677      doc.put(&quot;field2&quot;, blob);
678      addDocument(&quot;doc1&quot;, doc);
679      SearchResult res = client.ftSearch(SafeEncoder.encode(index), new Query(&quot;value&quot;));
680      assertEquals(1, res.getTotalResults());
681      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
682      assertEquals(&quot;value&quot;, res.getDocuments().get(0).getString(&quot;field1&quot;));
683      assertArrayEquals(blob, (byte[]) res.getDocuments().get(0).get(&quot;field2&quot;));
684    }
685    @Test
686    public void alias() throws Exception {
687      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0);
688      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
689      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
690      doc.put(&quot;field1&quot;, &quot;value&quot;);
691      addDocument(&quot;doc1&quot;, doc);
692      assertEquals(&quot;OK&quot;, client.ftAliasAdd(&quot;ALIAS1&quot;, index));
693      SearchResult res1 = client.ftSearch(&quot;ALIAS1&quot;, new Query(&quot;*&quot;).returnFields(&quot;field1&quot;));
694      assertEquals(1, res1.getTotalResults());
695      assertEquals(&quot;value&quot;, res1.getDocuments().get(0).get(&quot;field1&quot;));
696      assertEquals(&quot;OK&quot;, client.ftAliasUpdate(&quot;ALIAS2&quot;, index));
697      SearchResult res2 = client.ftSearch(&quot;ALIAS2&quot;, new Query(&quot;*&quot;).returnFields(&quot;field1&quot;));
698      assertEquals(1, res2.getTotalResults());
699      assertEquals(&quot;value&quot;, res2.getDocuments().get(0).get(&quot;field1&quot;));
700      try {
701        client.ftAliasDel(&quot;ALIAS3&quot;);
702        fail(&quot;Should throw JedisDataException&quot;);
703      } catch (JedisDataException e) {
704      }
705      assertEquals(&quot;OK&quot;, client.ftAliasDel(&quot;ALIAS2&quot;));
706      try {
707        client.ftAliasDel(&quot;ALIAS2&quot;);
708        fail(&quot;Should throw JedisDataException&quot;);
709      } catch (JedisDataException e) {
710      }
711    }
712    @Test
713    public void synonym() {
714      Schema sc = new Schema().addTextField(&quot;name&quot;, 1.0).addTextField(&quot;addr&quot;, 1.0);
715      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
716      long group1 = 345L;
717      long group2 = 789L;
718      String group1_str = Long.toString(group1);
719      String group2_str = Long.toString(group2);
720      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group1_str, &quot;girl&quot;, &quot;baby&quot;));
721      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group1_str, &quot;child&quot;));
722      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group2_str, &quot;child&quot;));
723      Map&lt;String, List&lt;String&gt;&gt; dump = client.ftSynDump(index);
724      Map&lt;String, List&lt;String&gt;&gt; expected = new HashMap&lt;&gt;();
725      expected.put(&quot;girl&quot;, Arrays.asList(group1_str));
726      expected.put(&quot;baby&quot;, Arrays.asList(group1_str));
727      expected.put(&quot;child&quot;, Arrays.asList(group1_str, group2_str));
728      assertEquals(expected, dump);
729    }
730    @Test
731    public void slop() {
732      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
733      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
734      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
735      doc.put(&quot;field1&quot;, &quot;ok hi jedis&quot;);
736      addDocument(&quot;doc1&quot;, doc);
737      SearchResult res = client.ftSearch(index, new Query(&quot;ok jedis&quot;).slop(0));
738      assertEquals(0, res.getTotalResults());
739      res = client.ftSearch(index, new Query(&quot;ok jedis&quot;).slop(1));
740      assertEquals(1, res.getTotalResults());
741      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
742      assertEquals(&quot;ok hi jedis&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
743    }
744    @Test
745    public void timeout() {
746      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
747      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
748      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
749      map.put(&quot;field1&quot;, &quot;value&quot;);
750      map.put(&quot;field2&quot;, &quot;not&quot;);
751      client.hset(&quot;doc1&quot;, map);
752      SearchResult res = client.ftSearch(index, new Query(&quot;value&quot;).timeout(1000));
753      assertEquals(1, res.getTotalResults());
754      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
755      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
756      assertEquals(&quot;not&quot;, res.getDocuments().get(0).get(&quot;field2&quot;));
757    }
758    @Test
759    public void inOrder() {
760      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
761      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
762      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
763      map.put(&quot;field1&quot;, &quot;value&quot;);
764      map.put(&quot;field2&quot;, &quot;not&quot;);
765      client.hset(&quot;doc2&quot;, map);
766      client.hset(&quot;doc1&quot;, map);
767      SearchResult res = client.ftSearch(index, new Query(&quot;value&quot;).setInOrder());
768      assertEquals(2, res.getTotalResults());
769      assertEquals(&quot;doc2&quot;, res.getDocuments().get(0).getId());
770      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
771      assertEquals(&quot;not&quot;, res.getDocuments().get(0).get(&quot;field2&quot;));
772    }
773    @Test
774    public void testDialectsWithFTExplain() throws Exception {
775      Map&lt;String, Object&gt; attr = new HashMap&lt;&gt;();
776      attr.put(&quot;TYPE&quot;, &quot;FLOAT32&quot;);
777      attr.put(&quot;DIM&quot;, 2);
778      attr.put(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;);
779      Schema sc = new Schema()
780          .addFlatVectorField(&quot;v&quot;, attr)
781          .addTagField(&quot;title&quot;)
782          .addTextField(&quot;t1&quot;, 1.0)
783          .addTextField(&quot;t2&quot;, 1.0)
784          .addNumericField(&quot;num&quot;);
785      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
786      client.hset(&quot;1&quot;, &quot;t1&quot;, &quot;hello&quot;);
787      String q = &quot;(*)&quot;;
788      Query query = new Query(q).dialect(1);
789      try {
790        client.ftExplain(index, query);
791        fail();
792      } catch (JedisDataException e) {
793        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
794      }
795      query = new Query(q).dialect(2);
796      assertTrue(&quot;Should contain &#x27;WILDCARD&#x27;&quot;, client.ftExplain(index, query).contains(&quot;WILDCARD&quot;));
797      q = &quot;$hello&quot;;
798      query = new Query(q).dialect(1);
799      try {
800        client.ftExplain(index, query);
801        fail();
802      } catch (JedisDataException e) {
803        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
804      }
805      query = new Query(q).dialect(2).addParam(&quot;hello&quot;, &quot;hello&quot;);
806      assertTrue(&quot;Should contain &#x27;UNION {\n  hello\n  +hello(expanded)\n}\n&#x27;&quot;,
807          client.ftExplain(index, query).contains(&quot;UNION {\n  hello\n  +hello(expanded)\n}\n&quot;));
808      q = &quot;@title:(@num:[0 10])&quot;;
809      query = new Query(q).dialect(1);
810      assertTrue(&quot;Should contain &#x27;NUMERIC {0.000000 &lt;= @num &lt;= 10.000000}&#x27;&quot;,
811          client.ftExplain(index, query).contains(&quot;NUMERIC {0.000000 &lt;= @num &lt;= 10.000000}&quot;));
812      query = new Query(q).dialect(2);
813      try {
814        client.ftExplain(index, query);
815        fail();
816      } catch (JedisDataException e) {
817        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
818      }
819      q = &quot;@t1:@t2:@t3:hello&quot;;
820      query = new Query(q).dialect(1);
821      assertTrue(&quot;Should contain &#x27;@NULL:UNION {\n  @NULL:hello\n  @NULL:+hello(expanded)\n}\n&#x27;&quot;,
822          client.ftExplain(index, query).contains(&quot;@NULL:UNION {\n  @NULL:hello\n  @NULL:+hello(expanded)\n}\n&quot;));
823      query = new Query(q).dialect(2);
824      try {
825        client.ftExplain(index, query);
826        fail();
827      } catch (JedisDataException e) {
828        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
829      }
830      q = &quot;@title:{foo}}}}}&quot;;
831      query = new Query(q).dialect(1);
832      assertTrue(&quot;Should contain &#x27;TAG:@title {\n  foo\n}\n&#x27;&quot;,
833          client.ftExplain(index, query).contains(&quot;TAG:@title {\n  foo\n}\n&quot;));
834      query = new Query(q).dialect(2);
835      try {
836        client.ftExplain(index, query);
837        fail();
838      } catch (JedisDataException e) {
839        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
840      }
841      q = &quot;*=&gt;[KNN 10 @v $BLOB]&quot;;
842      query = new Query(q).addParam(&quot;BLOB&quot;, &quot;aaaa&quot;).dialect(1);
843      try {
844        client.ftExplain(index, query);
845        fail();
846      } catch (JedisDataException e) {
847        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
848      }
849      query = new Query(q).addParam(&quot;BLOB&quot;, &quot;aaaa&quot;).dialect(2);
850      assertTrue(&quot;Should contain &#x27;{K=10 nearest vector&#x27;&quot;, client.ftExplain(index, query).contains(&quot;{K=10 nearest vector&quot;));
851      q = &quot;*=&gt;[knn $K @vec_field $BLOB as score]&quot;;
852      query = new Query(q).addParam(&quot;BLOB&quot;, &quot;aaaa&quot;).addParam(&quot;K&quot;, &quot;10&quot;).dialect(1);
853      try {
854        client.ftExplain(index, query);
855        fail();
856      } catch (JedisDataException e) {
857        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
858      }
859      query = new Query(q).addParam(&quot;BLOB&quot;, &quot;aaaa&quot;).addParam(&quot;K&quot;, &quot;10&quot;).dialect(2);
860      assertTrue(&quot;Should contain &#x27;{K=10 nearest vector&#x27;&quot;, client.ftExplain(index, query).contains(&quot;{K=10 nearest vector&quot;));
861    }
862    @Test
863    public void testHNSWVVectorSimilarity() {
864      Map&lt;String, Object&gt; attr = new HashMap&lt;&gt;();
865      attr.put(&quot;TYPE&quot;, &quot;FLOAT32&quot;);
866      attr.put(&quot;DIM&quot;, 2);
867      attr.put(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;);
868      Schema sc = new Schema().addHNSWVectorField(&quot;v&quot;, attr);
869      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
870      client.hset(&quot;a&quot;, &quot;v&quot;, &quot;aaaaaaaa&quot;);
871      client.hset(&quot;b&quot;, &quot;v&quot;, &quot;aaaabaaa&quot;);
872      client.hset(&quot;c&quot;, &quot;v&quot;, &quot;aaaaabaa&quot;);
873      Query query = new Query(&quot;*=&gt;[KNN 2 @v $vec]&quot;)
874          .addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
875          .setSortBy(&quot;__v_score&quot;, true)
876          .returnFields(&quot;__v_score&quot;)
877          .dialect(2);
878      Document doc1 = client.ftSearch(index, query).getDocuments().get(0);
879      assertEquals(&quot;a&quot;, doc1.getId());
880      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
881      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile
882          = client.ftProfileSearch(index, FTProfileParams.profileParams(), query);
883      doc1 = profile.getKey().getDocuments().get(0);
884      assertEquals(&quot;a&quot;, doc1.getId());
885      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
886      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
887      assertEquals(&quot;VECTOR&quot;, iteratorsProfile.get(&quot;Type&quot;));
888    }
889    @Test
890    public void testFlatVectorSimilarity() {
891      Map&lt;String, Object&gt; attr = new HashMap&lt;&gt;();
892      attr.put(&quot;TYPE&quot;, &quot;FLOAT32&quot;);
893      attr.put(&quot;DIM&quot;, 2);
894      attr.put(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;);
895      Schema sc = new Schema().addFlatVectorField(&quot;v&quot;, attr);
896      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
897      client.hset(&quot;a&quot;, &quot;v&quot;, &quot;aaaaaaaa&quot;);
898      client.hset(&quot;b&quot;, &quot;v&quot;, &quot;aaaabaaa&quot;);
899      client.hset(&quot;c&quot;, &quot;v&quot;, &quot;aaaaabaa&quot;);
900      Query query = new Query(&quot;*=&gt;[KNN 2 @v $vec]&quot;)
901          .addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
902          .setSortBy(&quot;__v_score&quot;, true)
903          .returnFields(&quot;__v_score&quot;)
904          .dialect(2);
905      Document doc1 = client.ftSearch(index, query).getDocuments().get(0);
906      assertEquals(&quot;a&quot;, doc1.getId());
907      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
908      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile
909          = client.ftProfileSearch(index, FTProfileParams.profileParams(), query);
910      doc1 = profile.getKey().getDocuments().get(0);
911      assertEquals(&quot;a&quot;, doc1.getId());
912      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
913      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
914      assertEquals(&quot;VECTOR&quot;, iteratorsProfile.get(&quot;Type&quot;));
915    }
916    @Test
917    public void searchProfile() {
918      Schema sc = new Schema().addTextField(&quot;t1&quot;, 1.0).addTextField(&quot;t2&quot;, 1.0);
919      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
920      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
921      map.put(&quot;t1&quot;, &quot;foo&quot;);
922      map.put(&quot;t2&quot;, &quot;bar&quot;);
923      client.hset(&quot;doc1&quot;, map);
924      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
925          FTProfileParams.profileParams(), new Query(&quot;foo&quot;));
926      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
927      assertEquals(&quot;TEXT&quot;, iteratorsProfile.get(&quot;Type&quot;));
928      assertEquals(&quot;foo&quot;, iteratorsProfile.get(&quot;Term&quot;));
929      assertEquals(1L, iteratorsProfile.get(&quot;Counter&quot;));
930      assertEquals(1L, iteratorsProfile.get(&quot;Size&quot;));
931      assertSame(Double.class, iteratorsProfile.get(&quot;Time&quot;).getClass());
932    }
933    @Test
934    public void searchIteration() throws Exception {
935      Schema sc = new Schema().addTextField(&quot;first&quot;, 1.0).addTextField(&quot;last&quot;, 1.0).addNumericField(&quot;age&quot;);
936      IndexDefinition rule = new IndexDefinition();
937      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions().setDefinition(rule), sc));
938      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
939      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
940      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
941      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
942      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
943      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
944      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
945      FtSearchIteration search = client.ftSearchIteration(3, index, new Query());
946      int total = 0;
947      while (!search.isIterationCompleted()) {
948        SearchResult result = search.nextBatch();
949        int count = result.getDocuments().size();
950        assertThat(count, Matchers.lessThanOrEqualTo(3));
951        total += count;
952      }
953      assertEquals(7, total);
954    }
955  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SearchTest.java</h3>
            <pre><code>1  package redis.clients.jedis.modules.search;
2  import static org.junit.Assert.*;
3  import java.util.*;
4  import org.hamcrest.Matchers;
5  import org.junit.BeforeClass;
6  import org.junit.Test;
7  import redis.clients.jedis.exceptions.JedisDataException;
8  import redis.clients.jedis.json.Path;
9  import redis.clients.jedis.search.*;
10  import redis.clients.jedis.search.Schema.*;
11  import redis.clients.jedis.modules.RedisModuleCommandsTestBase;
12  import redis.clients.jedis.util.SafeEncoder;
13  public class SearchTest extends RedisModuleCommandsTestBase {
14    private static final String index = &quot;testindex&quot;;
15    @BeforeClass
16    public static void prepare() {
17      RedisModuleCommandsTestBase.prepare();
18    }
19    private void addDocument(String key, Map&lt;String, Object&gt; map) {
20      client.hset(key, RediSearchUtil.toStringMap(map));
21    }
22    private static Map&lt;String, Object&gt; toMap(Object... values) {
23      Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
24      for (int i = 0; i &lt; values.length; i += 2) {
25        map.put((String) values[i], values[i + 1]);
26      }
27      return map;
28    }
29    private static Map&lt;String, String&gt; toMap(String... values) {
30      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
31      for (int i = 0; i &lt; values.length; i += 2) {
32        map.put(values[i], values[i + 1]);
33      }
34      return map;
35    }
36    @Test
37    public void create() throws Exception {
38      Schema sc = new Schema().addTextField(&quot;first&quot;, 1.0).addTextField(&quot;last&quot;, 1.0).addNumericField(&quot;age&quot;);
39      IndexDefinition rule = new IndexDefinition()
40          .setFilter(&quot;@age&gt;16&quot;)
41          .setPrefixes(new String[]{&quot;student:&quot;, &quot;pupil:&quot;});
42      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions().setDefinition(rule), sc));
43      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
44      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
45      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
46      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
47      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
48      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
49      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
50      SearchResult noFilters = client.ftSearch(index, new Query());
51      assertEquals(4, noFilters.getTotalResults());
52      SearchResult res1 = client.ftSearch(index, new Query(&quot;@first:Jo*&quot;));
53      assertEquals(2, res1.getTotalResults());
54      SearchResult res2 = client.ftSearch(index, new Query(&quot;@first:Pat&quot;));
55      assertEquals(1, res2.getTotalResults());
56      SearchResult res3 = client.ftSearch(index, new Query(&quot;@last:Rod&quot;));
57      assertEquals(0, res3.getTotalResults());
58    }
59    @Test
60    public void createNoParams() throws Exception {
61      Schema sc = new Schema().addTextField(&quot;first&quot;, 1.0).addTextField(&quot;last&quot;, 1.0).addNumericField(&quot;age&quot;);
62      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
63      addDocument(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, 18));
64      addDocument(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, 17));
65      addDocument(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, 21));
66      addDocument(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, 20));
67      SearchResult noFilters = client.ftSearch(index, new Query());
68      assertEquals(4, noFilters.getTotalResults());
69      SearchResult res1 = client.ftSearch(index, new Query(&quot;@first:Jo*&quot;));
70      assertEquals(2, res1.getTotalResults());
71      SearchResult res2 = client.ftSearch(index, new Query(&quot;@first:Pat&quot;));
72      assertEquals(1, res2.getTotalResults());
73      SearchResult res3 = client.ftSearch(index, new Query(&quot;@last:Rod&quot;));
74      assertEquals(0, res3.getTotalResults());
75    }
76    @Test
77    public void createWithFieldNames() throws Exception {
78      Schema sc = new Schema().addField(new TextField(FieldName.of(&quot;first&quot;).as(&quot;given&quot;)))
79          .addField(new TextField(FieldName.of(&quot;last&quot;)));
80      IndexDefinition rule = new IndexDefinition()
81          .setPrefixes(new String[]{&quot;student:&quot;, &quot;pupil:&quot;});
82      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions().setDefinition(rule), sc));
83      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
84      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
85      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
86      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
87      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
88      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
89      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
90      SearchResult noFilters = client.ftSearch(index, new Query());
91      assertEquals(5, noFilters.getTotalResults());
92      SearchResult asOriginal = client.ftSearch(index, new Query(&quot;@first:Jo*&quot;));
93      assertEquals(0, asOriginal.getTotalResults());
94      SearchResult asAttribute = client.ftSearch(index, new Query(&quot;@given:Jo*&quot;));
95      assertEquals(2, asAttribute.getTotalResults());
96      SearchResult nonAttribute = client.ftSearch(index, new Query(&quot;@last:Rod&quot;));
97      assertEquals(1, nonAttribute.getTotalResults());
98    }
99    @Test
100    public void alterAdd() throws Exception {
101      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
102      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
103      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
104      fields.put(&quot;title&quot;, &quot;hello world&quot;);
105      for (int i = 0; i &lt; 100; i++) {
106        addDocument(String.format(&quot;doc%d&quot;, i), fields);
107      }
108      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;));
109      assertEquals(100, res.getTotalResults());
110      assertEquals(&quot;OK&quot;, client.ftAlter(index, new TagField(&quot;tags&quot;, &quot;,&quot;), new TextField(&quot;name&quot;, 0.5)));
111      for (int i = 0; i &lt; 100; i++) {
112        Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
113        fields2.put(&quot;name&quot;, &quot;name&quot; + i);
114        fields2.put(&quot;tags&quot;, String.format(&quot;tagA,tagB,tag%d&quot;, i));
115        addDocument(String.format(&quot;doc%d&quot;, i), fields2);
116      }
117      SearchResult res2 = client.ftSearch(index, new Query(&quot;@tags:{tagA}&quot;));
118      assertEquals(100, res2.getTotalResults());
119      Map&lt;String, Object&gt; info = client.ftInfo(index);
120      assertEquals(index, info.get(&quot;index_name&quot;));
121      assertEquals(&quot;identifier&quot;, ((List) ((List) info.get(&quot;attributes&quot;)).get(1)).get(0));
122      assertEquals(&quot;attribute&quot;, ((List) ((List) info.get(&quot;attributes&quot;)).get(1)).get(2));
123    }
124    @Test
125    public void search() throws Exception {
126      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0).addTextField(&quot;body&quot;, 1.0);
127      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
128      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
129      fields.put(&quot;title&quot;, &quot;hello world&quot;);
130      fields.put(&quot;body&quot;, &quot;lorem ipsum&quot;);
131      for (int i = 0; i &lt; 100; i++) {
132        addDocument(String.format(&quot;doc%d&quot;, i), fields);
133      }
134      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;).limit(0, 5).setWithScores());
135      assertEquals(100, res.getTotalResults());
136      assertEquals(5, res.getDocuments().size());
137      for (Document d : res.getDocuments()) {
138        assertTrue(d.getId().startsWith(&quot;doc&quot;));
139        assertTrue(d.getScore() &lt; 100);
140      }
141      client.del(&quot;doc0&quot;);
142      res = client.ftSearch(index, new Query(&quot;hello world&quot;));
143      assertEquals(99, res.getTotalResults());
144      assertEquals(&quot;OK&quot;, client.ftDropIndex(index));
145      try {
146        client.ftSearch(index, new Query(&quot;hello world&quot;));
147        fail();
148      } catch (JedisDataException e) {
149      }
150    }
151    @Test
152    public void numericFilter() throws Exception {
153      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0).addNumericField(&quot;price&quot;);
154      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
155      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
156      fields.put(&quot;title&quot;, &quot;hello world&quot;);
157      for (int i = 0; i &lt; 100; i++) {
158        fields.put(&quot;price&quot;, i);
159        addDocument(String.format(&quot;doc%d&quot;, i), fields);
160      }
161      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;).
162          addFilter(new Query.NumericFilter(&quot;price&quot;, 0, 49)));
163      assertEquals(50, res.getTotalResults());
164      assertEquals(10, res.getDocuments().size());
165      for (Document d : res.getDocuments()) {
166        long price = Long.valueOf((String) d.get(&quot;price&quot;));
167        assertTrue(price &gt;= 0);
168        assertTrue(price &lt;= 49);
169      }
170      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
171          addFilter(new Query.NumericFilter(&quot;price&quot;, 0, true, 49, true)));
172      assertEquals(48, res.getTotalResults());
173      assertEquals(10, res.getDocuments().size());
174      for (Document d : res.getDocuments()) {
175        long price = Long.valueOf((String) d.get(&quot;price&quot;));
176        assertTrue(price &gt; 0);
177        assertTrue(price &lt; 49);
178      }
179      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
180          addFilter(new Query.NumericFilter(&quot;price&quot;, 50, 100)));
181      assertEquals(50, res.getTotalResults());
182      assertEquals(10, res.getDocuments().size());
183      for (Document d : res.getDocuments()) {
184        long price = Long.valueOf((String) d.get(&quot;price&quot;));
185        assertTrue(price &gt;= 50);
186        assertTrue(price &lt;= 100);
187      }
188      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
189          addFilter(new Query.NumericFilter(&quot;price&quot;, 20, Double.POSITIVE_INFINITY)));
190      assertEquals(80, res.getTotalResults());
191      assertEquals(10, res.getDocuments().size());
192      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
193          addFilter(new Query.NumericFilter(&quot;price&quot;, Double.NEGATIVE_INFINITY, 10)));
194      assertEquals(11, res.getTotalResults());
195      assertEquals(10, res.getDocuments().size());
196    }
197    @Test
198    public void stopwords() throws Exception {
199      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
200      assertEquals(&quot;OK&quot;, client.ftCreate(index,
201          IndexOptions.defaultOptions().setStopwords(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;), sc));
202      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
203      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
204      addDocument(&quot;doc1&quot;, fields);
205      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;));
206      assertEquals(1, res.getTotalResults());
207      res = client.ftSearch(index, new Query(&quot;foo bar&quot;));
208      assertEquals(0, res.getTotalResults());
209    }
210    @Test
211    public void noStopwords() throws Exception {
212      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
213      assertEquals(&quot;OK&quot;, client.ftCreate(index,
214          IndexOptions.defaultOptions().setNoStopwords(), sc));
215      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
216      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
217      fields.put(&quot;title&quot;, &quot;hello world foo bar to be or not to be&quot;);
218      addDocument(&quot;doc1&quot;, fields);
219      assertEquals(1, client.ftSearch(index, new Query(&quot;hello world&quot;)).getTotalResults());
220      assertEquals(1, client.ftSearch(index, new Query(&quot;foo bar&quot;)).getTotalResults());
221      assertEquals(1, client.ftSearch(index, new Query(&quot;to be or not to be&quot;)).getTotalResults());
222    }
223    @Test
224    public void geoFilter() throws Exception {
225      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0).addGeoField(&quot;loc&quot;);
226      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
227      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
228      fields.put(&quot;title&quot;, &quot;hello world&quot;);
229      fields.put(&quot;loc&quot;, &quot;-0.441,51.458&quot;);
230      addDocument(&quot;doc1&quot;, fields);
231      fields.put(&quot;loc&quot;, &quot;-0.1,51.2&quot;);
232      addDocument(&quot;doc2&quot;, fields);
233      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;).
234          addFilter(
235              new Query.GeoFilter(&quot;loc&quot;, -0.44, 51.45,
236                  10, Query.GeoFilter.KILOMETERS)
237          ));
238      assertEquals(1, res.getTotalResults());
239      res = client.ftSearch(index, new Query(&quot;hello world&quot;).
240          addFilter(
241              new Query.GeoFilter(&quot;loc&quot;, -0.44, 51.45,
242                  100, Query.GeoFilter.KILOMETERS)
243          ));
244      assertEquals(2, res.getTotalResults());
245    }
246    @Test
247    public void geoFilterAndGeoCoordinateObject() throws Exception {
248      Schema schema = new Schema().addTextField(&quot;title&quot;, 1.0).addGeoField(&quot;loc&quot;);
249      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), schema));
250      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
251      fields.put(&quot;title&quot;, &quot;hello world&quot;);
252      fields.put(&quot;loc&quot;, new redis.clients.jedis.GeoCoordinate(-0.441, 51.458));
253      addDocument(&quot;doc1&quot;, fields);
254      fields.put(&quot;loc&quot;, new redis.clients.jedis.GeoCoordinate(-0.1, 51.2));
255      addDocument(&quot;doc2&quot;, fields);
256      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;).addFilter(
257          new Query.GeoFilter(&quot;loc&quot;, -0.44, 51.45, 10, Query.GeoFilter.KILOMETERS)));
258      assertEquals(1, res.getTotalResults());
259      res = client.ftSearch(index, new Query(&quot;hello world&quot;).addFilter(
260          new Query.GeoFilter(&quot;loc&quot;, -0.44, 51.45, 100, Query.GeoFilter.KILOMETERS)));
261      assertEquals(2, res.getTotalResults());
262    }
263    @Test
264    public void testQueryFlags() throws Exception {
265      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
266      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
267      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
268      for (int i = 0; i &lt; 100; i++) {
269        fields.put(&quot;title&quot;, i % 2 != 0 ? &quot;hello worlds&quot; : &quot;hello world&quot;);
270        addDocument(String.format(&quot;doc%d&quot;, i), fields);
271      }
272      Query q = new Query(&quot;hello&quot;).setWithScores();
273      SearchResult res = client.ftSearch(index, q);
274      assertEquals(100, res.getTotalResults());
275      assertEquals(10, res.getDocuments().size());
276      for (Document d : res.getDocuments()) {
277        assertTrue(d.getId().startsWith(&quot;doc&quot;));
278        assertTrue(((String) d.get(&quot;title&quot;)).startsWith(&quot;hello world&quot;));
279      }
280      q = new Query(&quot;hello&quot;).setNoContent();
281      res = client.ftSearch(index, q);
282      for (Document d : res.getDocuments()) {
283        assertTrue(d.getId().startsWith(&quot;doc&quot;));
284        assertEquals(1.0, d.getScore(), 0);
285        assertNull(d.get(&quot;title&quot;));
286      }
287      res = client.ftSearch(index, new Query(&quot;hello worlds&quot;));
288      assertEquals(100, res.getTotalResults());
289      res = client.ftSearch(index, new Query(&quot;hello worlds&quot;).setVerbatim());
290      assertEquals(50, res.getTotalResults());
291      res = client.ftSearch(index, new Query(&quot;hello a world&quot;).setVerbatim());
292      assertEquals(50, res.getTotalResults());
293      res = client.ftSearch(index, new Query(&quot;hello a worlds&quot;).setVerbatim());
294      assertEquals(50, res.getTotalResults());
295      res = client.ftSearch(index, new Query(&quot;hello a world&quot;).setVerbatim().setNoStopwords());
296      assertEquals(0, res.getTotalResults());
297    }
298    @Test
299    public void testQueryParams() {
300      Schema sc = new Schema().addNumericField(&quot;numval&quot;);
301      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
302      client.hset(&quot;1&quot;, &quot;numval&quot;, &quot;1&quot;);
303      client.hset(&quot;2&quot;, &quot;numval&quot;, &quot;2&quot;);
304      client.hset(&quot;3&quot;, &quot;numval&quot;, &quot;3&quot;);
305      Query query =  new Query(&quot;@numval:[$min $max]&quot;).addParam(&quot;min&quot;, 1).addParam(&quot;max&quot;, 2).dialect(2);
306      assertEquals(2, client.ftSearch(index, query).getTotalResults());
307    }
308    @Test
309    public void testSortQueryFlags() throws Exception {
310      Schema sc = new Schema().addSortableTextField(&quot;title&quot;, 1.0);
311      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
312      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
313      fields.put(&quot;title&quot;, &quot;b title&quot;);
314      addDocument(&quot;doc1&quot;, fields);
315      fields.put(&quot;title&quot;, &quot;a title&quot;);
316      addDocument(&quot;doc2&quot;, fields);
317      fields.put(&quot;title&quot;, &quot;c title&quot;);
318      addDocument(&quot;doc3&quot;, fields);
319      Query q = new Query(&quot;title&quot;).setSortBy(&quot;title&quot;, true);
320      SearchResult res = client.ftSearch(index, q);
321      assertEquals(3, res.getTotalResults());
322      Document doc1 = res.getDocuments().get(0);
323      assertEquals(&quot;a title&quot;, doc1.get(&quot;title&quot;));
324      doc1 = res.getDocuments().get(1);
325      assertEquals(&quot;b title&quot;, doc1.get(&quot;title&quot;));
326      doc1 = res.getDocuments().get(2);
327      assertEquals(&quot;c title&quot;, doc1.get(&quot;title&quot;));
328    }
329    @Test
330    public void testNullField() throws Exception {
331      Schema sc = new Schema()
332          .addTextField(&quot;title&quot;, 1.0)
333          .addTextField(&quot;genre&quot;, 1.0)
334          .addTextField(&quot;plot&quot;, 1.0)
335          .addSortableNumericField(&quot;release_year&quot;)
336          .addTagField(&quot;tag&quot;)
337          .addGeoField(&quot;loc&quot;);
338      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
339      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
340      fields.put(&quot;title&quot;, &quot;another test with title &quot;);
341      fields.put(&quot;genre&quot;, &quot;Comedy&quot;);
342      fields.put(&quot;plot&quot;, &quot;this is the plot for the test&quot;);
343      fields.put(&quot;tag&quot;, &quot;fun&quot;);
344      fields.put(&quot;release_year&quot;, 2019);
345      fields.put(&quot;loc&quot;, &quot;-0.1,51.2&quot;);
346      addDocument(&quot;doc1&quot;, fields);
347      SearchResult res = client.ftSearch(index, new Query(&quot;title&quot;));
348      assertEquals(1, res.getTotalResults());
349      fields = new HashMap&lt;&gt;();
350      fields.put(&quot;title&quot;, &quot;another title another test&quot;);
351      fields.put(&quot;genre&quot;, &quot;Action&quot;);
352      fields.put(&quot;plot&quot;, null);
353      fields.put(&quot;tag&quot;, null);
354      try {
355        addDocument(&quot;doc2&quot;, fields);
356        fail(&quot;Should throw NullPointerException.&quot;);
357      } catch (NullPointerException e) {
358      }
359      res = client.ftSearch(index, new Query(&quot;title&quot;));
360      assertEquals(1, res.getTotalResults());
<span onclick='openModal()' class='match'>361      fields = new HashMap&lt;&gt;();
362      fields.put(&quot;title&quot;, &quot;another title another test&quot;);
363      fields.put(&quot;genre&quot;, &quot;Action&quot;);
364      fields.put(&quot;release_year&quot;, null);
365      try {
</span>366        addDocument(&quot;doc2&quot;, fields);
367        fail(&quot;Should throw NullPointerException.&quot;);
368      } catch (NullPointerException e) {
369      }
370      res = client.ftSearch(index, new Query(&quot;title&quot;));
371      assertEquals(1, res.getTotalResults());
372    }
373    @Test
374    public void testJsonWithAlias() {
375      Schema sc = new Schema()
376              .addTextField(&quot;$.name&quot;, 1.0).as(&quot;name&quot;)
377              .addNumericField(&quot;$.num&quot;).as(&quot;num&quot;);
378      IndexDefinition definition = new IndexDefinition(IndexDefinition.Type.JSON).setPrefixes(&quot;king:&quot;);
379      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions().setDefinition(definition), sc));
380      Map&lt;String, Object&gt; king1 = new HashMap&lt;&gt;();
381      king1.put(&quot;name&quot;, &quot;henry&quot;);
382      king1.put(&quot;num&quot;, 42);
383      client.jsonSet(&quot;king:1&quot;, Path.ROOT_PATH, king1);
384      Map&lt;String, Object&gt; king2 = new HashMap&lt;&gt;();
385      king2.put(&quot;name&quot;, &quot;james&quot;);
386      king2.put(&quot;num&quot;, 3.14);
387      client.jsonSet(&quot;king:2&quot;, Path.ROOT_PATH, king2);
388      SearchResult res = client.ftSearch(index, new Query(&quot;@name:henry&quot;));
389      assertEquals(1, res.getTotalResults());
390      assertEquals(&quot;king:1&quot;, res.getDocuments().get(0).getId());
391      res = client.ftSearch(index, new Query(&quot;@num:[0 10]&quot;));
392      assertEquals(1, res.getTotalResults());
393      assertEquals(&quot;king:2&quot;, res.getDocuments().get(0).getId());
394    }
395    @Test
396    public void dropIndex() throws Exception {
397      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
398      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
399      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
400      fields.put(&quot;title&quot;, &quot;hello world&quot;);
401      for (int i = 0; i &lt; 100; i++) {
402        addDocument(String.format(&quot;doc%d&quot;, i), fields);
403      }
404      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;));
405      assertEquals(100, res.getTotalResults());
406      assertEquals(&quot;OK&quot;, client.ftDropIndex(index));
407      try {
408        client.ftSearch(index, new Query(&quot;hello world&quot;));
409        fail(&quot;Index should not exist.&quot;);
410      } catch (JedisDataException de) {
411        assertTrue(de.getMessage().contains(&quot;no such index&quot;));
412      }
413      assertEquals(100, client.dbSize());
414    }
415    @Test
416    public void dropIndexDD() throws Exception {
417      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0);
418      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
419      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
420      fields.put(&quot;title&quot;, &quot;hello world&quot;);
421      for (int i = 0; i &lt; 100; i++) {
422        addDocument(String.format(&quot;doc%d&quot;, i), fields);
423      }
424      SearchResult res = client.ftSearch(index, new Query(&quot;hello world&quot;));
425      assertEquals(100, res.getTotalResults());
426      assertEquals(&quot;OK&quot;, client.ftDropIndexDD(index));
427      Set&lt;String&gt; keys = client.keys(&quot;*&quot;);
428      assertTrue(keys.isEmpty());
429      assertEquals(0, client.dbSize());
430    }
431    @Test
432    public void noStem() throws Exception {
433      Schema sc = new Schema().addTextField(&quot;stemmed&quot;, 1.0).addField(new Schema.TextField(&quot;notStemmed&quot;, 1.0, false, true));
434      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
435      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
436      doc.put(&quot;stemmed&quot;, &quot;located&quot;);
437      doc.put(&quot;notStemmed&quot;, &quot;located&quot;);
438      addDocument(&quot;doc&quot;, doc);
439      SearchResult res = client.ftSearch(index, new Query(&quot;@stemmed:location&quot;));
440      assertEquals(1, res.getTotalResults());
441      res = client.ftSearch(index, new Query(&quot;@notStemmed:location&quot;));
442      assertEquals(0, res.getTotalResults());
443    }
444    @Test
445    public void phoneticMatch() throws Exception {
446      Schema sc = new Schema()
447          .addTextField(&quot;noPhonetic&quot;, 1.0)
448          .addField(new Schema.TextField(&quot;withPhonetic&quot;, 1.0, false, false, false, &quot;dm:en&quot;));
449      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
450      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
451      doc.put(&quot;noPhonetic&quot;, &quot;morfix&quot;);
452      doc.put(&quot;withPhonetic&quot;, &quot;morfix&quot;);
453      addDocument(&quot;doc&quot;, doc);
454      SearchResult res = client.ftSearch(index, new Query(&quot;@withPhonetic:morphix=&gt;{$phonetic:true}&quot;));
455      assertEquals(1, res.getTotalResults());
456      try {
457        client.ftSearch(index, new Query(&quot;@noPhonetic:morphix=&gt;{$phonetic:true}&quot;));
458        fail();
459      } catch (JedisDataException e) {&amp;bsol;*field does not support phonetics*/
460      }
461      SearchResult res3 = client.ftSearch(index, new Query(&quot;@withPhonetic:morphix=&gt;{$phonetic:false}&quot;));
462      assertEquals(0, res3.getTotalResults());
463    }
464    @Test
465    public void info() throws Exception {
466      String MOVIE_ID = &quot;movie_id&quot;;
467      String TITLE = &quot;title&quot;;
468      String GENRE = &quot;genre&quot;;
469      String VOTES = &quot;votes&quot;;
470      String RATING = &quot;rating&quot;;
471      String RELEASE_YEAR = &quot;release_year&quot;;
472      String PLOT = &quot;plot&quot;;
473      String POSTER = &quot;poster&quot;;
474      Schema sc = new Schema()
475          .addTextField(TITLE, 5.0)
476          .addSortableTextField(PLOT, 1.0)
477          .addSortableTagField(GENRE, &quot;,&quot;)
478          .addSortableNumericField(RELEASE_YEAR)
479          .addSortableNumericField(RATING)
480          .addSortableNumericField(VOTES);
481      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
482      Map&lt;String, Object&gt; info = client.ftInfo(index);
483      assertEquals(index, info.get(&quot;index_name&quot;));
484      assertEquals(6, ((List) info.get(&quot;attributes&quot;)).size());
485      assertEquals(&quot;global_idle&quot;, ((List) info.get(&quot;cursor_stats&quot;)).get(0));
486      assertEquals(0L, ((List) info.get(&quot;cursor_stats&quot;)).get(1));
487    }
488    @Test
489    public void noIndex() throws Exception {
490      Schema sc = new Schema()
491          .addField(new Schema.TextField(&quot;f1&quot;, 1.0, true, false, true))
492          .addField(new Schema.TextField(&quot;f2&quot;, 1.0));
493      client.ftCreate(index, IndexOptions.defaultOptions(), sc);
494      Map&lt;String, Object&gt; mm = new HashMap&lt;&gt;();
495      mm.put(&quot;f1&quot;, &quot;MarkZZ&quot;);
496      mm.put(&quot;f2&quot;, &quot;MarkZZ&quot;);
497      addDocument(&quot;doc1&quot;, mm);
498      mm.clear();
499      mm.put(&quot;f1&quot;, &quot;MarkAA&quot;);
500      mm.put(&quot;f2&quot;, &quot;MarkBB&quot;);
501      addDocument(&quot;doc2&quot;, mm);
502      SearchResult res = client.ftSearch(index, new Query(&quot;@f1:Mark*&quot;));
503      assertEquals(0, res.getTotalResults());
504      res = client.ftSearch(index, new Query(&quot;@f2:Mark*&quot;));
505      assertEquals(2, res.getTotalResults());
506      Document[] docs = new Document[2];
507      res = client.ftSearch(index, new Query(&quot;@f2:Mark*&quot;).setSortBy(&quot;f1&quot;, false));
508      assertEquals(2, res.getTotalResults());
509      res.getDocuments().toArray(docs);
510      assertEquals(&quot;doc1&quot;, docs[0].getId());
511      res = client.ftSearch(index, new Query(&quot;@f2:Mark*&quot;).setSortBy(&quot;f1&quot;, true));
512      res.getDocuments().toArray(docs);
513      assertEquals(&quot;doc2&quot;, docs[0].getId());
514    }
515    @Test
516    public void testExplain() throws Exception {
517      Schema sc = new Schema()
518          .addTextField(&quot;f1&quot;, 1.0)
519          .addTextField(&quot;f2&quot;, 1.0)
520          .addTextField(&quot;f3&quot;, 1.0);
521      client.ftCreate(index, IndexOptions.defaultOptions(), sc);
522      String res = client.ftExplain(index, new Query(&quot;@f3:f3_val @f2:f2_val @f1:f1_val&quot;));
523      assertNotNull(res);
524      assertFalse(res.isEmpty());
525    }
526    @Test
527    public void testHighlightSummarize() throws Exception {
528      Schema sc = new Schema().addTextField(&quot;text&quot;, 1.0);
529      client.ftCreate(index, IndexOptions.defaultOptions(), sc);
530      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
531      doc.put(&quot;text&quot;, &quot;Redis is often referred as a data structures server. What this means is that Redis provides access to mutable data structures via a set of commands, which are sent using a server-client model with TCP sockets and a simple protocol. So different processes can query and modify the same data structures in a shared way&quot;);
532      addDocument(&quot;foo&quot;, doc);
533      Query q = new Query(&quot;data&quot;).highlightFields().summarizeFields();
534      SearchResult res = client.ftSearch(index, q);
535      assertEquals(&quot;is often referred as a &lt;b&gt;data&lt;/b&gt; structures server. What this means is that Redis provides... What this means is that Redis provides access to mutable &lt;b&gt;data&lt;/b&gt; structures via a set of commands, which are sent using a... So different processes can query and modify the same &lt;b&gt;data&lt;/b&gt; structures in a shared... &quot;,
536          res.getDocuments().get(0).get(&quot;text&quot;));
537      q = new Query(&quot;data&quot;).highlightFields(new Query.HighlightTags(&quot;&lt;u&gt;&quot;, &quot;&lt;/u&gt;&quot;)).summarizeFields();
538      res = client.ftSearch(index, q);
539      assertEquals(&quot;is often referred as a &lt;u&gt;data&lt;/u&gt; structures server. What this means is that Redis provides... What this means is that Redis provides access to mutable &lt;u&gt;data&lt;/u&gt; structures via a set of commands, which are sent using a... So different processes can query and modify the same &lt;u&gt;data&lt;/u&gt; structures in a shared... &quot;,
540          res.getDocuments().get(0).get(&quot;text&quot;));
541    }
542    @Test
543    public void getTagField() {
544      Schema sc = new Schema()
545          .addTextField(&quot;title&quot;, 1.0)
546          .addTagField(&quot;category&quot;);
547      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
548      Map&lt;String, Object&gt; fields1 = new HashMap&lt;&gt;();
549      fields1.put(&quot;title&quot;, &quot;hello world&quot;);
550      fields1.put(&quot;category&quot;, &quot;red&quot;);
551      addDocument(&quot;foo&quot;, fields1);
552      Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
553      fields2.put(&quot;title&quot;, &quot;hello world&quot;);
554      fields2.put(&quot;category&quot;, &quot;blue&quot;);
555      addDocument(&quot;bar&quot;, fields2);
556      Map&lt;String, Object&gt; fields3 = new HashMap&lt;&gt;();
557      fields3.put(&quot;title&quot;, &quot;hello world&quot;);
558      fields3.put(&quot;category&quot;, &quot;green,yellow&quot;);
559      addDocument(&quot;baz&quot;, fields3);
560      Map&lt;String, Object&gt; fields4 = new HashMap&lt;&gt;();
561      fields4.put(&quot;title&quot;, &quot;hello world&quot;);
562      fields4.put(&quot;category&quot;, &quot;orange;purple&quot;);
563      addDocument(&quot;qux&quot;, fields4);
564      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{red}&quot;)).getTotalResults());
565      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{blue}&quot;)).getTotalResults());
566      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{red}&quot;)).getTotalResults());
567      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{blue}&quot;)).getTotalResults());
568      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{yellow}&quot;)).getTotalResults());
569      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{purple}&quot;)).getTotalResults());
570      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{orange\\;purple}&quot;)).getTotalResults());
571      assertEquals(4, client.ftSearch(index, new Query(&quot;hello&quot;)).getTotalResults());
572      assertEquals(new HashSet&lt;&gt;(Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;orange;purple&quot;)),
573          client.ftTagVals(index, &quot;category&quot;));
574    }
575    @Test
576    public void testGetTagFieldWithNonDefaultSeparator() {
577      Schema sc = new Schema()
578          .addTextField(&quot;title&quot;, 1.0)
579          .addTagField(&quot;category&quot;, &quot;;&quot;);
580      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
581      Map&lt;String, Object&gt; fields1 = new HashMap&lt;&gt;();
582      fields1.put(&quot;title&quot;, &quot;hello world&quot;);
583      fields1.put(&quot;category&quot;, &quot;red&quot;);
584      addDocument(&quot;foo&quot;, fields1);
585      Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
586      fields2.put(&quot;title&quot;, &quot;hello world&quot;);
587      fields2.put(&quot;category&quot;, &quot;blue&quot;);
588      addDocument(&quot;bar&quot;, fields2);
589      Map&lt;String, Object&gt; fields3 = new HashMap&lt;&gt;();
590      fields3.put(&quot;title&quot;, &quot;hello world&quot;);
591      fields3.put(&quot;category&quot;, &quot;green;yellow&quot;);
592      addDocument(&quot;baz&quot;, fields3);
593      Map&lt;String, Object&gt; fields4 = new HashMap&lt;&gt;();
594      fields4.put(&quot;title&quot;, &quot;hello world&quot;);
595      fields4.put(&quot;category&quot;, &quot;orange,purple&quot;);
596      addDocument(&quot;qux&quot;, fields4);
597      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{red}&quot;)).getTotalResults());
598      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{blue}&quot;)).getTotalResults());
599      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{red}&quot;)).getTotalResults());
600      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{blue}&quot;)).getTotalResults());
601      assertEquals(1, client.ftSearch(index, new Query(&quot;hello @category:{yellow}&quot;)).getTotalResults());
602      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{purple}&quot;)).getTotalResults());
603      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{orange\\,purple}&quot;)).getTotalResults());
604      assertEquals(4, client.ftSearch(index, new Query(&quot;hello&quot;)).getTotalResults());
605      assertEquals(new HashSet&lt;&gt;(Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;orange,purple&quot;)),
606          client.ftTagVals(index, &quot;category&quot;));
607    }
608    @Test
609    public void caseSensitiveTagField() {
610      Schema sc = new Schema()
611          .addTextField(&quot;title&quot;, 1.0)
612          .addTagField(&quot;category&quot;, true &amp;bsol;*casesensitive*/);
613      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
614      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
615      fields.put(&quot;title&quot;, &quot;hello world&quot;);
616      fields.put(&quot;category&quot;, &quot;RedX&quot;);
617      addDocument(&quot;foo&quot;, fields);
618      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{redx}&quot;)).getTotalResults());
619      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{redX}&quot;)).getTotalResults());
620      assertEquals(0, client.ftSearch(index, new Query(&quot;@category:{Redx}&quot;)).getTotalResults());
621      assertEquals(1, client.ftSearch(index, new Query(&quot;@category:{RedX}&quot;)).getTotalResults());
622      assertEquals(1, client.ftSearch(index, new Query(&quot;hello&quot;)).getTotalResults());
623    }
624    @Test
625    public void testReturnFields() throws Exception {
626      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
627      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
628      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
629      doc.put(&quot;field1&quot;, &quot;value1&quot;);
630      doc.put(&quot;field2&quot;, &quot;value2&quot;);
631      addDocument(&quot;doc&quot;, doc);
632      SearchResult res = client.ftSearch(index, new Query(&quot;*&quot;).returnFields(&quot;field1&quot;));
633      assertEquals(1, res.getTotalResults());
634      assertEquals(&quot;value1&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
635      assertNull(res.getDocuments().get(0).get(&quot;field2&quot;));
636    }
637    @Test
638    public void returnWithFieldNames() throws Exception {
639      Schema sc = new Schema().addTextField(&quot;a&quot;, 1).addTextField(&quot;b&quot;, 1).addTextField(&quot;c&quot;, 1);
640      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
641      Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
642      map.put(&quot;a&quot;, &quot;value1&quot;);
643      map.put(&quot;b&quot;, &quot;value2&quot;);
644      map.put(&quot;c&quot;, &quot;value3&quot;);
645      addDocument(&quot;doc&quot;, map);
646      SearchResult res = client.ftSearch(index,
647          new Query().returnFields(FieldName.of(&quot;a&quot;), FieldName.of(&quot;b&quot;).as(&quot;d&quot;)));
648      assertEquals(1, res.getTotalResults());
649      Document doc = res.getDocuments().get(0);
650      assertEquals(&quot;value1&quot;, doc.get(&quot;a&quot;));
651      assertNull(doc.get(&quot;b&quot;));
652      assertEquals(&quot;value2&quot;, doc.get(&quot;d&quot;));
653      assertNull(doc.get(&quot;c&quot;));
654    }
655    @Test
656    public void inKeys() throws Exception {
657      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
658      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
659      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
660      doc.put(&quot;field1&quot;, &quot;value&quot;);
661      doc.put(&quot;field2&quot;, &quot;not&quot;);
662      addDocument(&quot;doc1&quot;, doc);
663      addDocument(&quot;doc2&quot;, doc);
664      SearchResult res = client.ftSearch(index, new Query(&quot;value&quot;).limitKeys(&quot;doc1&quot;));
665      assertEquals(1, res.getTotalResults());
666      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
667      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
668      assertEquals(null, res.getDocuments().get(0).get(&quot;value&quot;));
669    }
670    @Test
671    public void blobField() throws Exception {
672      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0);
673      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
674      byte[] blob = new byte[]{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12};
675      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
676      doc.put(&quot;field1&quot;, &quot;value&quot;);
677      doc.put(&quot;field2&quot;, blob);
678      addDocument(&quot;doc1&quot;, doc);
679      SearchResult res = client.ftSearch(SafeEncoder.encode(index), new Query(&quot;value&quot;));
680      assertEquals(1, res.getTotalResults());
681      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
682      assertEquals(&quot;value&quot;, res.getDocuments().get(0).getString(&quot;field1&quot;));
683      assertArrayEquals(blob, (byte[]) res.getDocuments().get(0).get(&quot;field2&quot;));
684    }
685    @Test
686    public void alias() throws Exception {
687      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0);
688      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
689      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
690      doc.put(&quot;field1&quot;, &quot;value&quot;);
691      addDocument(&quot;doc1&quot;, doc);
692      assertEquals(&quot;OK&quot;, client.ftAliasAdd(&quot;ALIAS1&quot;, index));
693      SearchResult res1 = client.ftSearch(&quot;ALIAS1&quot;, new Query(&quot;*&quot;).returnFields(&quot;field1&quot;));
694      assertEquals(1, res1.getTotalResults());
695      assertEquals(&quot;value&quot;, res1.getDocuments().get(0).get(&quot;field1&quot;));
696      assertEquals(&quot;OK&quot;, client.ftAliasUpdate(&quot;ALIAS2&quot;, index));
697      SearchResult res2 = client.ftSearch(&quot;ALIAS2&quot;, new Query(&quot;*&quot;).returnFields(&quot;field1&quot;));
698      assertEquals(1, res2.getTotalResults());
699      assertEquals(&quot;value&quot;, res2.getDocuments().get(0).get(&quot;field1&quot;));
700      try {
701        client.ftAliasDel(&quot;ALIAS3&quot;);
702        fail(&quot;Should throw JedisDataException&quot;);
703      } catch (JedisDataException e) {
704      }
705      assertEquals(&quot;OK&quot;, client.ftAliasDel(&quot;ALIAS2&quot;));
706      try {
707        client.ftAliasDel(&quot;ALIAS2&quot;);
708        fail(&quot;Should throw JedisDataException&quot;);
709      } catch (JedisDataException e) {
710      }
711    }
712    @Test
713    public void synonym() {
714      Schema sc = new Schema().addTextField(&quot;name&quot;, 1.0).addTextField(&quot;addr&quot;, 1.0);
715      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
716      long group1 = 345L;
717      long group2 = 789L;
718      String group1_str = Long.toString(group1);
719      String group2_str = Long.toString(group2);
720      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group1_str, &quot;girl&quot;, &quot;baby&quot;));
721      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group1_str, &quot;child&quot;));
722      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group2_str, &quot;child&quot;));
723      Map&lt;String, List&lt;String&gt;&gt; dump = client.ftSynDump(index);
724      Map&lt;String, List&lt;String&gt;&gt; expected = new HashMap&lt;&gt;();
725      expected.put(&quot;girl&quot;, Arrays.asList(group1_str));
726      expected.put(&quot;baby&quot;, Arrays.asList(group1_str));
727      expected.put(&quot;child&quot;, Arrays.asList(group1_str, group2_str));
728      assertEquals(expected, dump);
729    }
730    @Test
731    public void slop() {
732      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
733      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
734      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
735      doc.put(&quot;field1&quot;, &quot;ok hi jedis&quot;);
736      addDocument(&quot;doc1&quot;, doc);
737      SearchResult res = client.ftSearch(index, new Query(&quot;ok jedis&quot;).slop(0));
738      assertEquals(0, res.getTotalResults());
739      res = client.ftSearch(index, new Query(&quot;ok jedis&quot;).slop(1));
740      assertEquals(1, res.getTotalResults());
741      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
742      assertEquals(&quot;ok hi jedis&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
743    }
744    @Test
745    public void timeout() {
746      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
747      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
748      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
749      map.put(&quot;field1&quot;, &quot;value&quot;);
750      map.put(&quot;field2&quot;, &quot;not&quot;);
751      client.hset(&quot;doc1&quot;, map);
752      SearchResult res = client.ftSearch(index, new Query(&quot;value&quot;).timeout(1000));
753      assertEquals(1, res.getTotalResults());
754      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
755      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
756      assertEquals(&quot;not&quot;, res.getDocuments().get(0).get(&quot;field2&quot;));
757    }
758    @Test
759    public void inOrder() {
760      Schema sc = new Schema().addTextField(&quot;field1&quot;, 1.0).addTextField(&quot;field2&quot;, 1.0);
761      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
762      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
763      map.put(&quot;field1&quot;, &quot;value&quot;);
764      map.put(&quot;field2&quot;, &quot;not&quot;);
765      client.hset(&quot;doc2&quot;, map);
766      client.hset(&quot;doc1&quot;, map);
767      SearchResult res = client.ftSearch(index, new Query(&quot;value&quot;).setInOrder());
768      assertEquals(2, res.getTotalResults());
769      assertEquals(&quot;doc2&quot;, res.getDocuments().get(0).getId());
770      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
771      assertEquals(&quot;not&quot;, res.getDocuments().get(0).get(&quot;field2&quot;));
772    }
773    @Test
774    public void testDialectsWithFTExplain() throws Exception {
775      Map&lt;String, Object&gt; attr = new HashMap&lt;&gt;();
776      attr.put(&quot;TYPE&quot;, &quot;FLOAT32&quot;);
777      attr.put(&quot;DIM&quot;, 2);
778      attr.put(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;);
779      Schema sc = new Schema()
780          .addFlatVectorField(&quot;v&quot;, attr)
781          .addTagField(&quot;title&quot;)
782          .addTextField(&quot;t1&quot;, 1.0)
783          .addTextField(&quot;t2&quot;, 1.0)
784          .addNumericField(&quot;num&quot;);
785      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
786      client.hset(&quot;1&quot;, &quot;t1&quot;, &quot;hello&quot;);
787      String q = &quot;(*)&quot;;
788      Query query = new Query(q).dialect(1);
789      try {
790        client.ftExplain(index, query);
791        fail();
792      } catch (JedisDataException e) {
793        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
794      }
795      query = new Query(q).dialect(2);
796      assertTrue(&quot;Should contain &#x27;WILDCARD&#x27;&quot;, client.ftExplain(index, query).contains(&quot;WILDCARD&quot;));
797      q = &quot;$hello&quot;;
798      query = new Query(q).dialect(1);
799      try {
800        client.ftExplain(index, query);
801        fail();
802      } catch (JedisDataException e) {
803        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
804      }
805      query = new Query(q).dialect(2).addParam(&quot;hello&quot;, &quot;hello&quot;);
806      assertTrue(&quot;Should contain &#x27;UNION {\n  hello\n  +hello(expanded)\n}\n&#x27;&quot;,
807          client.ftExplain(index, query).contains(&quot;UNION {\n  hello\n  +hello(expanded)\n}\n&quot;));
808      q = &quot;@title:(@num:[0 10])&quot;;
809      query = new Query(q).dialect(1);
810      assertTrue(&quot;Should contain &#x27;NUMERIC {0.000000 &lt;= @num &lt;= 10.000000}&#x27;&quot;,
811          client.ftExplain(index, query).contains(&quot;NUMERIC {0.000000 &lt;= @num &lt;= 10.000000}&quot;));
812      query = new Query(q).dialect(2);
813      try {
814        client.ftExplain(index, query);
815        fail();
816      } catch (JedisDataException e) {
817        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
818      }
819      q = &quot;@t1:@t2:@t3:hello&quot;;
820      query = new Query(q).dialect(1);
821      assertTrue(&quot;Should contain &#x27;@NULL:UNION {\n  @NULL:hello\n  @NULL:+hello(expanded)\n}\n&#x27;&quot;,
822          client.ftExplain(index, query).contains(&quot;@NULL:UNION {\n  @NULL:hello\n  @NULL:+hello(expanded)\n}\n&quot;));
823      query = new Query(q).dialect(2);
824      try {
825        client.ftExplain(index, query);
826        fail();
827      } catch (JedisDataException e) {
828        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
829      }
830      q = &quot;@title:{foo}}}}}&quot;;
831      query = new Query(q).dialect(1);
832      assertTrue(&quot;Should contain &#x27;TAG:@title {\n  foo\n}\n&#x27;&quot;,
833          client.ftExplain(index, query).contains(&quot;TAG:@title {\n  foo\n}\n&quot;));
834      query = new Query(q).dialect(2);
835      try {
836        client.ftExplain(index, query);
837        fail();
838      } catch (JedisDataException e) {
839        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
840      }
841      q = &quot;*=&gt;[KNN 10 @v $BLOB]&quot;;
842      query = new Query(q).addParam(&quot;BLOB&quot;, &quot;aaaa&quot;).dialect(1);
843      try {
844        client.ftExplain(index, query);
845        fail();
846      } catch (JedisDataException e) {
847        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
848      }
849      query = new Query(q).addParam(&quot;BLOB&quot;, &quot;aaaa&quot;).dialect(2);
850      assertTrue(&quot;Should contain &#x27;{K=10 nearest vector&#x27;&quot;, client.ftExplain(index, query).contains(&quot;{K=10 nearest vector&quot;));
851      q = &quot;*=&gt;[knn $K @vec_field $BLOB as score]&quot;;
852      query = new Query(q).addParam(&quot;BLOB&quot;, &quot;aaaa&quot;).addParam(&quot;K&quot;, &quot;10&quot;).dialect(1);
853      try {
854        client.ftExplain(index, query);
855        fail();
856      } catch (JedisDataException e) {
857        assertTrue(&quot;Should contain &#x27;Syntax error&#x27;&quot;, e.getMessage().contains(&quot;Syntax error&quot;));
858      }
859      query = new Query(q).addParam(&quot;BLOB&quot;, &quot;aaaa&quot;).addParam(&quot;K&quot;, &quot;10&quot;).dialect(2);
860      assertTrue(&quot;Should contain &#x27;{K=10 nearest vector&#x27;&quot;, client.ftExplain(index, query).contains(&quot;{K=10 nearest vector&quot;));
861    }
862    @Test
863    public void testHNSWVVectorSimilarity() {
864      Map&lt;String, Object&gt; attr = new HashMap&lt;&gt;();
865      attr.put(&quot;TYPE&quot;, &quot;FLOAT32&quot;);
866      attr.put(&quot;DIM&quot;, 2);
867      attr.put(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;);
868      Schema sc = new Schema().addHNSWVectorField(&quot;v&quot;, attr);
869      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
870      client.hset(&quot;a&quot;, &quot;v&quot;, &quot;aaaaaaaa&quot;);
871      client.hset(&quot;b&quot;, &quot;v&quot;, &quot;aaaabaaa&quot;);
872      client.hset(&quot;c&quot;, &quot;v&quot;, &quot;aaaaabaa&quot;);
873      Query query = new Query(&quot;*=&gt;[KNN 2 @v $vec]&quot;)
874          .addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
875          .setSortBy(&quot;__v_score&quot;, true)
876          .returnFields(&quot;__v_score&quot;)
877          .dialect(2);
878      Document doc1 = client.ftSearch(index, query).getDocuments().get(0);
879      assertEquals(&quot;a&quot;, doc1.getId());
880      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
881      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile
882          = client.ftProfileSearch(index, FTProfileParams.profileParams(), query);
883      doc1 = profile.getKey().getDocuments().get(0);
884      assertEquals(&quot;a&quot;, doc1.getId());
885      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
886      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
887      assertEquals(&quot;VECTOR&quot;, iteratorsProfile.get(&quot;Type&quot;));
888    }
889    @Test
890    public void testFlatVectorSimilarity() {
891      Map&lt;String, Object&gt; attr = new HashMap&lt;&gt;();
892      attr.put(&quot;TYPE&quot;, &quot;FLOAT32&quot;);
893      attr.put(&quot;DIM&quot;, 2);
894      attr.put(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;);
895      Schema sc = new Schema().addFlatVectorField(&quot;v&quot;, attr);
896      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
897      client.hset(&quot;a&quot;, &quot;v&quot;, &quot;aaaaaaaa&quot;);
898      client.hset(&quot;b&quot;, &quot;v&quot;, &quot;aaaabaaa&quot;);
899      client.hset(&quot;c&quot;, &quot;v&quot;, &quot;aaaaabaa&quot;);
900      Query query = new Query(&quot;*=&gt;[KNN 2 @v $vec]&quot;)
901          .addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
902          .setSortBy(&quot;__v_score&quot;, true)
903          .returnFields(&quot;__v_score&quot;)
904          .dialect(2);
905      Document doc1 = client.ftSearch(index, query).getDocuments().get(0);
906      assertEquals(&quot;a&quot;, doc1.getId());
907      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
908      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile
909          = client.ftProfileSearch(index, FTProfileParams.profileParams(), query);
910      doc1 = profile.getKey().getDocuments().get(0);
911      assertEquals(&quot;a&quot;, doc1.getId());
912      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
913      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
914      assertEquals(&quot;VECTOR&quot;, iteratorsProfile.get(&quot;Type&quot;));
915    }
916    @Test
917    public void searchProfile() {
918      Schema sc = new Schema().addTextField(&quot;t1&quot;, 1.0).addTextField(&quot;t2&quot;, 1.0);
919      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions(), sc));
920      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
921      map.put(&quot;t1&quot;, &quot;foo&quot;);
922      map.put(&quot;t2&quot;, &quot;bar&quot;);
923      client.hset(&quot;doc1&quot;, map);
924      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
925          FTProfileParams.profileParams(), new Query(&quot;foo&quot;));
926      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
927      assertEquals(&quot;TEXT&quot;, iteratorsProfile.get(&quot;Type&quot;));
928      assertEquals(&quot;foo&quot;, iteratorsProfile.get(&quot;Term&quot;));
929      assertEquals(1L, iteratorsProfile.get(&quot;Counter&quot;));
930      assertEquals(1L, iteratorsProfile.get(&quot;Size&quot;));
931      assertSame(Double.class, iteratorsProfile.get(&quot;Time&quot;).getClass());
932    }
933    @Test
934    public void searchIteration() throws Exception {
935      Schema sc = new Schema().addTextField(&quot;first&quot;, 1.0).addTextField(&quot;last&quot;, 1.0).addNumericField(&quot;age&quot;);
936      IndexDefinition rule = new IndexDefinition();
937      assertEquals(&quot;OK&quot;, client.ftCreate(index, IndexOptions.defaultOptions().setDefinition(rule), sc));
938      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
939      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
940      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
941      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
942      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
943      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
944      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
945      FtSearchIteration search = client.ftSearchIteration(3, index, new Query());
946      int total = 0;
947      while (!search.isIterationCompleted()) {
948        SearchResult result = search.nextBatch();
949        int count = result.getDocuments().size();
950        assertThat(count, Matchers.lessThanOrEqualTo(3));
951        total += count;
952      }
953      assertEquals(7, total);
954    }
955  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SearchTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SearchTest.java</div>
                </div>
                <div class="column column_space"><pre><code>349      fields = new HashMap&lt;&gt;();
350      fields.put(&quot;title&quot;, &quot;another title another test&quot;);
351      fields.put(&quot;genre&quot;, &quot;Action&quot;);
352      fields.put(&quot;plot&quot;, null);
353      fields.put(&quot;tag&quot;, null);
</pre></code></div>
                <div class="column column_space"><pre><code>361      fields = new HashMap&lt;&gt;();
362      fields.put(&quot;title&quot;, &quot;another title another test&quot;);
363      fields.put(&quot;genre&quot;, &quot;Action&quot;);
364      fields.put(&quot;release_year&quot;, null);
365      try {
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    