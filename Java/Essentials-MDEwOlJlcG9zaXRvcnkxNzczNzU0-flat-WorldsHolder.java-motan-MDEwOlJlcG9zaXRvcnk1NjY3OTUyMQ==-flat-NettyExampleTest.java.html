
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 16, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-WorldsHolder.java</h3>
            <pre><code>1  package org.anjocaido.groupmanager.dataholder.worlds;
2  import java.io.File;
3  import java.io.FileInputStream;
4  import java.io.IOException;
5  import java.io.InputStream;
6  import java.util.ArrayList;
7  import java.util.HashMap;
8  import java.util.HashSet;
9  import java.util.List;
10  import java.util.Map;
11  import java.util.Properties;
12  import java.util.logging.Level;
13  import java.util.logging.Logger;
14  import org.anjocaido.groupmanager.GroupManager;
15  import org.anjocaido.groupmanager.dataholder.WorldDataHolder;
16  import org.anjocaido.groupmanager.dataholder.OverloadedWorldHolder;
17  import org.anjocaido.groupmanager.permissions.AnjoPermissionsHandler;
18  import org.anjocaido.groupmanager.utils.Tasks;
19  import org.bukkit.World;
20  import org.bukkit.entity.Player;
21  public class WorldsHolder {
22  	private Map<String, OverloadedWorldHolder> worldsData = new HashMap<String, OverloadedWorldHolder>();
23  	private Map<String, String> mirrorsGroup = new HashMap<String, String>();
24  	private Map<String, String> mirrorsUser = new HashMap<String, String>();
25  	private String serverDefaultWorldName;
26  	private GroupManager plugin;
27  	private File worldsFolder;
28  	public WorldsHolder(GroupManager plugin) {
29  		this.plugin = plugin;
30  		resetWorldsHolder();
31  	}
32  	public Map<String, String> getMirrorsGroup() {
33  		return mirrorsGroup;
34  	}
35  	public Map<String, String> getMirrorsUser() {
36  		return mirrorsUser;
37  	}
38  	public boolean isWorldKnown(String name) {
39  		return worldsData.containsKey(name.toLowerCase());
40  	}
41  	public void resetWorldsHolder() {
42  		worldsData = new HashMap<String, OverloadedWorldHolder>();
43  		mirrorsGroup = new HashMap<String, String>();
44  		mirrorsUser = new HashMap<String, String>();
45  		verifyFirstRun();
46  		initialLoad();
47  		if (serverDefaultWorldName == null)
48  			throw new IllegalStateException("There is no default group! OMG!");
49  	}
50  	private void initialLoad() {
51  		initialWorldLoading();
52  		mirrorSetUp();
53  		loadAllSearchedWorlds();
54  	}
55  	private void initialWorldLoading() {
56  		loadWorld(serverDefaultWorldName);
57  	}
58  	private void loadAllSearchedWorlds() {
59  		for (World world : plugin.getServer().getWorlds()) {
60  			GroupManager.logger.log(Level.FINE, "Checking data for " + world.getName() + ".");
61  			if ((!worldsData.containsKey(world.getName().toLowerCase())) && ((!mirrorsGroup.containsKey(world.getName().toLowerCase())) || (!mirrorsUser.containsKey(world.getName().toLowerCase())))) {
62  				if (worldsData.containsKey("all_unnamed_worlds")) {
63  					String usersMirror = mirrorsUser.get("all_unnamed_worlds");
64  					String groupsMirror = mirrorsGroup.get("all_unnamed_worlds");
65  					if (usersMirror != null)
66  						mirrorsUser.put(world.getName().toLowerCase(), usersMirror);
67  					if (groupsMirror != null)
68  						mirrorsGroup.put(world.getName().toLowerCase(), groupsMirror);
69  				}
70  				GroupManager.logger.log(Level.FINE, "Creating folders for " + world.getName() + ".");
71  				setupWorldFolder(world.getName());
72  			}
73  		}
74  		for (File folder : worldsFolder.listFiles()) {
75  			if (folder.isDirectory() && !folder.getName().startsWith(".")) {
76  				GroupManager.logger.info("World Found: " + folder.getName());
77  				if (!worldsData.containsKey(folder.getName().toLowerCase()) && ((!mirrorsGroup.containsKey(folder.getName().toLowerCase())) || (!mirrorsUser.containsKey(folder.getName().toLowerCase())))) {
78  					setupWorldFolder(folder.getName());
79  					loadWorld(folder.getName().toLowerCase());
80  				}
81  			}
82  		}
83  	}
84  	@SuppressWarnings("rawtypes")
85  	public void mirrorSetUp() {
86  		mirrorsGroup.clear();
87  		mirrorsUser.clear();
88  		Map<String, Object> mirrorsMap = plugin.getGMConfig().getMirrorsMap();
89  		HashSet<String> mirroredWorlds = new HashSet<String>();
90  		if (mirrorsMap != null) {
91  			for (String source : mirrorsMap.keySet()) {
92  				setupWorldFolder(source);
93  				if (!worldsData.containsKey(source.toLowerCase()))
94  					loadWorld(source);
95  				if (mirrorsMap.get(source) instanceof ArrayList) {
96  					ArrayList mirrorList = (ArrayList) mirrorsMap.get(source);
97  					for (Object o : mirrorList) {
98  						String world = o.toString().toLowerCase();
99  						if (!world.equalsIgnoreCase(serverDefaultWorldName)) {
<span onclick='openModal()' class='match'>100  							try {
101  								mirrorsGroup.remove(world);
102  								mirrorsUser.remove(world);
103  							} catch (Exception e) {
</span>104  							}
105  							mirrorsGroup.put(world, getWorldData(source).getName());
106  							mirrorsUser.put(world, getWorldData(source).getName());
107  							mirroredWorlds.add(o.toString());
108  						} else
109  							GroupManager.logger.log(Level.WARNING, "Mirroring error with " + o.toString() + ". Recursive loop detected!");
110  					}
111  				} else if (mirrorsMap.get(source) instanceof Map) {
112  					Map subSection = (Map) mirrorsMap.get(source);
113  					for (Object key : subSection.keySet()) {
114  						if (!((String)key).equalsIgnoreCase(serverDefaultWorldName)) {
115  							if (subSection.get(key) instanceof ArrayList) {
116  								ArrayList mirrorList = (ArrayList) subSection.get(key);
117  								for (Object o : mirrorList) {
118  									String type = o.toString().toLowerCase();
119  									try {
120  										if (type.equals("groups"))
121  											mirrorsGroup.remove(((String)key).toLowerCase());
122  										if (type.equals("users"))
123  											mirrorsUser.remove(((String)key).toLowerCase());
124  									} catch (Exception e) {
125  									}
126  									if (type.equals("groups")) {
127  										mirrorsGroup.put(((String)key).toLowerCase(), getWorldData(source).getName());
128  										GroupManager.logger.log(Level.FINE, "Adding groups mirror for " + key + ".");
129  									}
130  									if (type.equals("users")) {
131  										mirrorsUser.put(((String)key).toLowerCase(), getWorldData(source).getName());
132  										GroupManager.logger.log(Level.FINE, "Adding users mirror for " + key + ".");
133  									}
134  								}
135  								mirroredWorlds.add((String)key);
136  							} else
137  								throw new IllegalStateException("Unknown mirroring format for " + (String)key);
138  						} else {
139  							GroupManager.logger.log(Level.WARNING, "Mirroring error with " + (String)key + ". Recursive loop detected!");
140  						}
141  					}
142  				}
143  			}
144  			for (String world : mirroredWorlds) {
145  				if (!worldsData.containsKey(world.toLowerCase())) {
146  					GroupManager.logger.log(Level.FINE, "No data for " + world + ".");
147  					setupWorldFolder(world);
148  					loadWorld(world, true);
149  				}
150  			}
151  		}
152  	}
153  	public void reloadAll() {
154  		GroupManager.getGlobalGroups().load();
155  		ArrayList<WorldDataHolder> alreadyDone = new ArrayList<WorldDataHolder>();
156  		for (WorldDataHolder w : worldsData.values()) {
157  			if (alreadyDone.contains(w)) {
158  				continue;
159  			}
160  			if (!mirrorsGroup.containsKey(w.getName().toLowerCase()))
161  				w.reloadGroups();
162  			if (!mirrorsUser.containsKey(w.getName().toLowerCase()))
163  				w.reloadUsers();
164  			alreadyDone.add(w);
165  		}
166  	}
167  	public void reloadWorld(String worldName) {
168  		if (!mirrorsGroup.containsKey(worldName.toLowerCase()))
169  			getWorldData(worldName).reloadGroups();
170  		if (!mirrorsUser.containsKey(worldName.toLowerCase()))
171  			getWorldData(worldName).reloadUsers();
172  	}
173  	public void saveChanges() {
174  		saveChanges(true);
175  	}
176  	public boolean saveChanges(boolean overwrite) {
177  		boolean changed = false;
178  		ArrayList<WorldDataHolder> alreadyDone = new ArrayList<WorldDataHolder>();
179  		Tasks.removeOldFiles(plugin, plugin.getBackupFolder());
180  		if (GroupManager.getGlobalGroups().haveGroupsChanged()) {
181  			GroupManager.getGlobalGroups().writeGroups(overwrite);
182  		} else {
183  			if (GroupManager.getGlobalGroups().getTimeStampGroups() < GroupManager.getGlobalGroups().getGlobalGroupsFile().lastModified()) {
184  				System.out.print("Newer GlobalGroups file found (Loading changes)!");
185  				GroupManager.getGlobalGroups().load();
186  			}
187  		}
188  		for (OverloadedWorldHolder w : worldsData.values()) {
189  			if (alreadyDone.contains(w)) {
190  				continue;
191  			}
192  			if (w == null) {
193  				GroupManager.logger.severe("WHAT HAPPENED?");
194  				continue;
195  			}
196  			if (!mirrorsGroup.containsKey(w.getName().toLowerCase()))
197  				if (w.haveGroupsChanged()) {
198  					if (overwrite || (!overwrite && (w.getTimeStampGroups() >= w.getGroupsFile().lastModified()))) {
199  						backupFile(w, true);
200  						WorldDataHolder.writeGroups(w, w.getGroupsFile());
201  						changed = true;
202  					} else {
203  						GroupManager.logger.log(Level.WARNING, "Newer Groups file found for " + w.getName() + ", but we have local changes!");
204  						throw new IllegalStateException("Unable to save unless you issue a '/mansave force'");
205  					}
206  				} else {
207  					if (w.getTimeStampGroups() < w.getGroupsFile().lastModified()) {
208  						System.out.print("Newer Groups file found (Loading changes)!");
209  						backupFile(w, true);
210  						w.reloadGroups();
211  						changed = true;
212  					}
213  				}
214  			if (!mirrorsUser.containsKey(w.getName().toLowerCase()))
215  				if (w.haveUsersChanged()) {
216  					if (overwrite || (!overwrite && (w.getTimeStampUsers() >= w.getUsersFile().lastModified()))) {
217  						backupFile(w, false);
218  						WorldDataHolder.writeUsers(w, w.getUsersFile());
219  						changed = true;
220  					} else {
221  						GroupManager.logger.log(Level.WARNING, "Newer Users file found for " + w.getName() + ", but we have local changes!");
222  						throw new IllegalStateException("Unable to save unless you issue a '/mansave force'");
223  					}
224  				} else {
225  					if (w.getTimeStampUsers() < w.getUsersFile().lastModified()) {
226  						System.out.print("Newer Users file found (Loading changes)!");
227  						backupFile(w, false);
228  						w.reloadUsers();
229  						changed = true;
230  					}
231  				}
232  			alreadyDone.add(w);
233  		}
234  		return changed;
235  	}
236  	private void backupFile(OverloadedWorldHolder w, Boolean groups) {
237  		File backupFile = new File(plugin.getBackupFolder(), "bkp_" + w.getName() + (groups ? "_g_" : "_u_") + Tasks.getDateString() + ".yml");
238  		try {
239  			Tasks.copy((groups ? w.getGroupsFile() : w.getUsersFile()), backupFile);
240  		} catch (IOException ex) {
241  			GroupManager.logger.log(Level.SEVERE, null, ex);
242  		}
243  	}
244  	public OverloadedWorldHolder getWorldData(String worldName) {
245  		String worldNameLowered = worldName.toLowerCase();
246  		if (worldsData.containsKey(worldNameLowered))
247  			return getUpdatedWorldData(worldNameLowered);
248  		if (worldsData.containsKey("all_unnamed_worlds")) {
249  			GroupManager.logger.finest("Requested world " + worldName + " not found or badly mirrored. Returning all_unnamed_worlds world...");
250  			return getUpdatedWorldData("all_unnamed_worlds");
251  		}
252  		GroupManager.logger.finest("Requested world " + worldName + " not found or badly mirrored. Returning default world...");
253  		return getDefaultWorld();
254  	}
255  	private OverloadedWorldHolder getUpdatedWorldData(String worldName) {
256  		String worldNameLowered = worldName.toLowerCase();
257  		if (worldsData.containsKey(worldNameLowered)) {
258  			OverloadedWorldHolder data = worldsData.get(worldNameLowered);
259  			data.updateDataSource();
260  			return data;
261  		}
262  		return null;
263  	}
264  	public OverloadedWorldHolder getWorldDataByPlayerName(String playerName) {
265  		List<Player> matchPlayer = plugin.getServer().matchPlayer(playerName);
266  		if (matchPlayer.size() == 1) {
267  			return getWorldData(matchPlayer.get(0));
268  		}
269  		return null;
270  	}
271  	public OverloadedWorldHolder getWorldData(Player player) {
272  		return getWorldData(player.getWorld().getName());
273  	}
274  	public AnjoPermissionsHandler getWorldPermissions(String worldName) {
275  		return getWorldData(worldName).getPermissionsHandler();
276  	}
277  	public AnjoPermissionsHandler getWorldPermissions(Player player) {
278  		return getWorldData(player).getPermissionsHandler();
279  	}
280  	public AnjoPermissionsHandler getWorldPermissionsByPlayerName(String playerName) {
281  		WorldDataHolder dh = getWorldDataByPlayerName(playerName);
282  		if (dh != null) {
283  			return dh.getPermissionsHandler();
284  		}
285  		return null;
286  	}
287  	private void verifyFirstRun() {
288  		if (plugin.getServer().getName().equalsIgnoreCase("BukkitForge")) {
289  			serverDefaultWorldName = "overworld";
290  		} else {
291  			Properties server = new Properties();
292  			try {
293  				server.load(new FileInputStream(new File("server.properties")));
294  				serverDefaultWorldName = server.getProperty("level-name").toLowerCase();
295  			} catch (IOException ex) {
296  				GroupManager.logger.log(Level.SEVERE, null, ex);
297  			}
298  		}
299  		setupWorldFolder(serverDefaultWorldName);
300  	}
301  	public void setupWorldFolder(String worldName) {
302  		String worldNameLowered = worldName.toLowerCase();
303  		worldsFolder = new File(plugin.getDataFolder(), "worlds");
304  		if (!worldsFolder.exists()) {
305  			worldsFolder.mkdirs();
306  		}
307  		File defaultWorldFolder = new File(worldsFolder, worldNameLowered);
308  		if ((!defaultWorldFolder.exists()) && ((!mirrorsGroup.containsKey(worldNameLowered))) || (!mirrorsUser.containsKey(worldNameLowered))) {
309  			File casedWorldFolder = new File(worldsFolder, worldName);
310  			if ((casedWorldFolder.exists()) && (casedWorldFolder.getName().toLowerCase().equals(worldNameLowered))) {
311  				casedWorldFolder.renameTo(new File(worldsFolder, worldNameLowered));
312  			} else {
313  				defaultWorldFolder.mkdirs();
314  			}
315  		}
316  		if (defaultWorldFolder.exists()) {
317  			if (!mirrorsGroup.containsKey(worldNameLowered)) {
318  				File groupsFile = new File(defaultWorldFolder, "groups.yml");
319  				if (!groupsFile.exists() || groupsFile.length() == 0) {
320  					InputStream template = plugin.getResourceAsStream("groups.yml");
321  					try {
322  						Tasks.copy(template, groupsFile);
323  					} catch (IOException ex) {
324  						GroupManager.logger.log(Level.SEVERE, null, ex);
325  					}
326  				}
327  			}
328  			if (!mirrorsUser.containsKey(worldNameLowered)) {
329  				File usersFile = new File(defaultWorldFolder, "users.yml");
330  				if (!usersFile.exists() || usersFile.length() == 0) {
331  					InputStream template = plugin.getResourceAsStream("users.yml");
332  					try {
333  						Tasks.copy(template, usersFile);
334  					} catch (IOException ex) {
335  						GroupManager.logger.log(Level.SEVERE, null, ex);
336  					}
337  				}
338  			}
339  		}
340  	}
341  	public boolean cloneWorld(String fromWorld, String toWorld) {
342  		File fromWorldFolder = new File(worldsFolder, fromWorld.toLowerCase());
343  		File toWorldFolder = new File(worldsFolder, toWorld.toLowerCase());
344  		if (toWorldFolder.exists() || !fromWorldFolder.exists()) {
345  			return false;
346  		}
347  		File fromWorldGroups = new File(fromWorldFolder, "groups.yml");
348  		File fromWorldUsers = new File(fromWorldFolder, "users.yml");
349  		if (!fromWorldGroups.exists() || !fromWorldUsers.exists()) {
350  			return false;
351  		}
352  		File toWorldGroups = new File(toWorldFolder, "groups.yml");
353  		File toWorldUsers = new File(toWorldFolder, "users.yml");
354  		toWorldFolder.mkdirs();
355  		try {
356  			Tasks.copy(fromWorldGroups, toWorldGroups);
357  			Tasks.copy(fromWorldUsers, toWorldUsers);
358  		} catch (IOException ex) {
359  			Logger.getLogger(WorldsHolder.class.getName()).log(Level.SEVERE, null, ex);
360  			return false;
361  		}
362  		return true;
363  	}
364  	public void loadWorld(String worldName) {
365  		loadWorld(worldName, false);
366  	}
367  	public void loadWorld(String worldName, Boolean isMirror) {
368  		String worldNameLowered = worldName.toLowerCase();
369  		if (worldsData.containsKey(worldNameLowered)) {
370  			worldsData.get(worldNameLowered).reload();
371  			return;
372  		}
373  		GroupManager.logger.finest("Trying to load world " + worldName + "...");
374  		File thisWorldFolder = new File(worldsFolder, worldNameLowered);
375  		if ((isMirror) || (thisWorldFolder.exists() && thisWorldFolder.isDirectory())) {
376  			File groupsFile = (mirrorsGroup.containsKey(worldNameLowered)) ? null : new File(thisWorldFolder, "groups.yml");
377  			File usersFile = (mirrorsUser.containsKey(worldNameLowered)) ? null : new File(thisWorldFolder, "users.yml");
378  			if ((groupsFile != null) && (!groupsFile.exists())) {
379  				throw new IllegalArgumentException("Groups file for world '" + worldName + "' doesnt exist: " + groupsFile.getPath());
380  			}
381  			if ((usersFile != null) && (!usersFile.exists())) {
382  				throw new IllegalArgumentException("Users file for world '" + worldName + "' doesnt exist: " + usersFile.getPath());
383  			}
384  			WorldDataHolder tempHolder = new WorldDataHolder(worldNameLowered);
385  			if (mirrorsGroup.containsKey(worldNameLowered))
386  				tempHolder.setGroupsObject(this.getWorldData(mirrorsGroup.get(worldNameLowered)).getGroupsObject());
387  			else
388  				tempHolder.loadGroups(groupsFile);
389  			if (mirrorsUser.containsKey(worldNameLowered))
390  				tempHolder.setUsersObject(this.getWorldData(mirrorsUser.get(worldNameLowered)).getUsersObject());
391  			else
392  				tempHolder.loadUsers(usersFile);
393  			OverloadedWorldHolder thisWorldData = new OverloadedWorldHolder(tempHolder);
394  			tempHolder = null;
395  			thisWorldData.setTimeStamps();
396  			if (thisWorldData != null) {
397  				GroupManager.logger.finest("Successful load of world " + worldName + "...");
398  				worldsData.put(worldNameLowered, thisWorldData);
399  				return;
400  			}
401  		}
402  	}
403  	public boolean isInList(String worldName) {
404  		if (worldsData.containsKey(worldName.toLowerCase()) || mirrorsGroup.containsKey(worldName.toLowerCase()) || mirrorsUser.containsKey(worldName.toLowerCase())) {
405  			return true;
406  		}
407  		return false;
408  	}
409  	public boolean hasOwnData(String worldName) {
410  		if (worldsData.containsKey(worldName.toLowerCase()) && (!mirrorsGroup.containsKey(worldName.toLowerCase()) || !mirrorsUser.containsKey(worldName.toLowerCase()))) {
411  			return true;
412  		}
413  		return false;
414  	}
415  	public OverloadedWorldHolder getDefaultWorld() {
416  		return getUpdatedWorldData(serverDefaultWorldName);
417  	}
418  	public ArrayList<OverloadedWorldHolder> allWorldsDataList() {
419  		ArrayList<OverloadedWorldHolder> list = new ArrayList<OverloadedWorldHolder>();
420  		for (String world : worldsData.keySet()) {
421  			if (!world.equalsIgnoreCase("all_unnamed_worlds")) {
422  				OverloadedWorldHolder data = getWorldData(world);
423  				if (!list.contains(data)) {
424  					String worldNameLowered = data.getName().toLowerCase();
425  					String usersMirror = mirrorsUser.get(worldNameLowered);
426  					String groupsMirror = mirrorsGroup.get(worldNameLowered);
427  					if (usersMirror != null) {
428  						if (groupsMirror != null) {
429  							if (usersMirror == groupsMirror) {
430  								data = getWorldData(usersMirror.toLowerCase());
431  								if (!list.contains(data))
432  									list.add(data);
433  								continue;
434  							}
435  						}
436  					}
437  					list.add(data);
438  				}
439  			}
440  		}
441  		return list;
442  	}
443  }
</code></pre>
        </div>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-NettyExampleTest.java</h3>
            <pre><code>1  package com.weibo.api.motan.transport.netty;
2  import junit.framework.TestCase;
3  import org.junit.Assert;
4  import org.junit.Before;
5  import org.junit.Test;
6  import com.weibo.api.motan.codec.Codec;
7  import com.weibo.api.motan.common.URLParamType;
8  import com.weibo.api.motan.core.extension.ExtensionLoader;
9  import com.weibo.api.motan.rpc.DefaultRequest;
10  import com.weibo.api.motan.rpc.DefaultResponse;
11  import com.weibo.api.motan.rpc.Request;
12  import com.weibo.api.motan.rpc.URL;
13  import com.weibo.api.motan.transport.Channel;
14  import com.weibo.api.motan.transport.MessageHandler;
15  import com.weibo.api.motan.util.RequestIdGenerator;
16  @SuppressWarnings({"rawtypes", "unchecked"})
17  public class NettyExampleTest extends TestCase {
18      private static URL url = null;
19      static {
20          ExtensionLoader loader = ExtensionLoader.getExtensionLoader(Codec.class);
21          loader.addExtensionClass(MockDefaultRpcCodec.class);
22      }
23      @Before
24      public void setUp() {
25          url = new URL("netty", "localhost", 18080, "com.weibo.api.motan.procotol.example.IHello");
26          url.addParameter(URLParamType.codec.getName(), "mockMotan");
27          url.addParameter(URLParamType.requestTimeout.getName(), "2000");
28      }
29      @Test
30      public void testNettyEncodeException() throws Exception {
31          NettyServer nettyServer;
32          nettyServer = new NettyServer(url, new MessageHandler() {
33              @Override
34              public Object handle(Channel channel, Object message) {
35                  Request request = (Request) message;
36                  DefaultResponse response = new DefaultResponse();
37                  response.setRequestId(request.getRequestId());
38                  response.setValue(new UnSerializableClass());
39                  return response;
40              }
41          });
42          nettyServer.open();
43          NettyClient nettyClient = new NettyClient(url);
44          nettyClient.open();
45          DefaultRequest request = new DefaultRequest();
46          request.setRequestId(RequestIdGenerator.getRequestId());
47          request.setInterfaceName(url.getPath());
48          request.setMethodName("helloSerializable");
49          request.setParamtersDesc("com.weibo.api.motan.procotol.example.UnSerializableClass");
50          request.setArguments(new Object[] {new UnSerializableClass()});
51          try {
52              nettyClient.request(request);
53              Assert.assertFalse(true);
54          } catch (Exception e) {
55              Assert.assertTrue(true);
56          }
57          DefaultRequest request1 = new DefaultRequest();
58          request1.setRequestId(RequestIdGenerator.getRequestId());
59          request1.setInterfaceName(url.getPath());
60          request1.setMethodName("helloSerializable");
61          request1.setParamtersDesc("void");
62          try {
63              nettyClient.request(request1);
64              Assert.fail();
65          } catch (Exception e) {
66              Assert.assertTrue(e.getMessage().contains("error_code: 20002"));
67          } finally {
68              nettyClient.close();
69              nettyServer.close();
70          }
71      }
72      @Test
73      public void testNettyRequestDecodeException() throws Exception {
74          NettyServer nettyServer;
75          nettyServer = new NettyServer(url, new MessageHandler() {
76              @Override
77              public Object handle(Channel channel, Object message) {
78                  Request request = (Request) message;
79                  DefaultResponse response = new DefaultResponse();
80                  response.setRequestId(request.getRequestId());
81                  response.setValue("success");
82                  return response;
83              }
84          });
85          nettyServer.open();
86          NettyClient nettyClient = new NettyClient(url);
87          nettyClient.open();
88          DefaultRequest request = new DefaultRequest();
89          request.setRequestId(RequestIdGenerator.getRequestId());
90          request.setInterfaceName(url.getPath());
91          request.setMethodName("hello");
92          request.setParamtersDesc("void");
<span onclick='openModal()' class='match'>93          try {
94              nettyClient.request(request);
95              Assert.assertTrue(false);
96          } catch (Exception e) {
</span>97              Assert.assertTrue(e.getMessage().contains("framework decode error"));
98          } finally {
99              nettyClient.close();
100              nettyServer.close();
101          }
102      }
103      @Test
104      public void testNettyDecodeException() throws Exception {
105          NettyServer nettyServer;
106          nettyServer = new NettyServer(url, new MessageHandler() {
107              @Override
108              public Object handle(Channel channel, Object message) {
109                  Request request = (Request) message;
110                  DefaultResponse response = new DefaultResponse();
111                  response.setRequestId(request.getRequestId());
112                  response.setValue("error");
113                  return response;
114              }
115          });
116          nettyServer.open();
117          NettyClient nettyClient = new NettyClient(url);
118          nettyClient.open();
119          DefaultRequest request = new DefaultRequest();
120          request.setRequestId(RequestIdGenerator.getRequestId());
121          request.setInterfaceName(url.getPath());
122          request.setMethodName("hello");
123          request.setParamtersDesc("void");
124          try {
125              nettyClient.request(request);
126              Assert.assertTrue(false);
127          } catch (Exception e) {
128              Assert.assertTrue(e.getMessage().contains("response dataType not support"));
129          } finally {
130              nettyClient.close();
131              nettyServer.close();
132          }
133      }
134  }
135  class UnSerializableClass {
136      public String hello() {
137          return "I am a unserializable class";
138      }
139  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-WorldsHolder.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-NettyExampleTest.java</div>
                </div>
                <div class="column column_space"><pre><code>100  							try {
101  								mirrorsGroup.remove(world);
102  								mirrorsUser.remove(world);
103  							} catch (Exception e) {
</pre></code></div>
                <div class="column column_space"><pre><code>93          try {
94              nettyClient.request(request);
95              Assert.assertTrue(false);
96          } catch (Exception e) {
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    