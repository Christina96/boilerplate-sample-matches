<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for GroupByScalarPlannerTest.java &amp; Analyzer.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for GroupByScalarPlannerTest.java &amp; Analyzer.java
      </h3>
<h1 align="center">
        10.5%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>GroupByScalarPlannerTest.java (23.966942%)<th>Analyzer.java (6.775701%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(22-47)<td><a href="#" name="0">(22-44)</a><td align="center"><font color="#ff0000">22</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(132-135)<td><a href="#" name="1">(538-544)</a><td align="center"><font color="#680000">9</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(107-111)<td><a href="#" name="2">(473-479)</a><td align="center"><font color="#680000">9</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(83-87)<td><a href="#" name="3">(415-421)</a><td align="center"><font color="#680000">9</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(55-60)<td><a href="#" name="4">(343-350)</a><td align="center"><font color="#680000">9</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>GroupByScalarPlannerTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>package io.crate.planner;
2 import com.carrotsearch.randomizedtesting.RandomizedTest;
3 import io.crate.execution.dsl.phases.MergePhase;
4 import io.crate.execution.dsl.phases.RoutedCollectPhase;
5 import io.crate.execution.dsl.projection.EvalProjection;
6 import io.crate.execution.dsl.projection.GroupProjection;
7 import io.crate.expression.symbol.Function;
8 import io.crate.metadata.RowGranularity;
9 import io.crate.planner.node.dql.Collect;
10 import io.crate.test.integration.CrateDummyClusterServiceUnitTest;
11 import io.crate.testing.SQLExecutor;
12 import io.crate.types.DataTypes;
13 import org.junit.Before;
14 import org.junit.Test;
15 import java.io.IOException;
16 import java.util.List;
17 import static io.crate.planner.operators.LogicalPlannerTest.isPlan;
18 import static io.crate.testing.SymbolMatchers.isFunction;
19 import static io.crate.testing.SymbolMatchers.isReference;
20 import static org.hamcrest.Matchers.contains;
21 import static org.hamcrest.Matchers.instanceOf;
22 import</b></font> static org.hamcrest.Matchers.is;
23 public class GroupByScalarPlannerTest extends CrateDummyClusterServiceUnitTest {
24     private SQLExecutor e;
25 <a name="4"></a>
26     @Before
27     public void prepare() throws IOException {
28         e = <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>SQLExecutor.builder(clusterService, 2, RandomizedTest.getRandom(), List.of())
29             .enableDefaultTables()
30             .build();
31     }
32     @</b></font>Test
33     public void testGroupByWithScalarPlan() throws Exception {
34         Merge merge = e.plan("select id + 1 from users group by id");
35         Collect collect = (Collect) merge.subPlan();
36         RoutedCollectPhase collectPhase = ((RoutedCollectPhase) collect.collectPhase());
37         assertEquals(DataTypes.LONG, collectPhase.outputTypes().get(0));
38         assertThat(collectPhase.maxRowGranularity(), is(RowGranularity.DOC));
39         assertThat(collectPhase.projections().size(), is(2));
40         assertThat(collectPhase.projections().get(0), instanceOf(GroupProjection.class));
41         assertThat(collectPhase.projections().get(0).requiredGranularity(), is(RowGranularity.SHARD));
42         assertThat(collectPhase.projections().get(1), instanceOf(EvalProjection.class));
43         assertThat(collectPhase.projections().get(1).outputs().get(0), instanceOf(Function.class));
44         assertThat(collectPhase.toCollect(), contains(isReference("id", DataTypes.LONG)));
45         GroupProjection groupProjection = (GroupProjection) collectPhase.projections().get(0);
46         assertThat(groupProjection.keys().get(0).valueType(), is(DataTypes.LONG));
47         assertThat(collectPhase.projections().get(1).outputs(), contains(isFunction("add")));
48 <a name="3"></a>
49         MergePhase mergePhase = merge.mergePhase();
50         assertEquals(DataTypes.LONG, <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>mergePhase.inputTypes().iterator().next());
51         assertEquals(DataTypes.LONG, mergePhase.outputTypes().get(0));
52     }
53     @</b></font>Test
54     public void testGroupByWithMultipleScalarPlan() throws Exception {
55         Merge merge = e.plan("select abs(id + 1) from users group by id");
56         Collect collect = (Collect) merge.subPlan();
57         RoutedCollectPhase collectPhase = ((RoutedCollectPhase) collect.collectPhase());
58         assertEquals(DataTypes.LONG, collectPhase.outputTypes().get(0));
59         assertThat(collectPhase.maxRowGranularity(), is(RowGranularity.DOC));
60         assertThat(collectPhase.projections().size(), is(2));
61         assertThat(collectPhase.projections().get(0), instanceOf(GroupProjection.class));
62         assertThat(collectPhase.projections().get(0).requiredGranularity(), is(RowGranularity.SHARD));
63         assertThat(collectPhase.projections().get(1), instanceOf(EvalProjection.class));
64         assertThat(collectPhase.projections().get(1).outputs().get(0), isFunction("abs"));
65         assertThat(collectPhase.toCollect(), contains(isReference("id", DataTypes.LONG)));
66         GroupProjection groupProjection = (GroupProjection) collectPhase.projections().get(0);
67         assertThat(groupProjection.keys().get(0).valueType(), is(DataTypes.LONG));
68 <a name="2"></a>
69         MergePhase mergePhase = merge.mergePhase();
70         assertEquals(DataTypes.LONG, <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>mergePhase.inputTypes().iterator().next());
71         assertEquals(DataTypes.LONG, mergePhase.outputTypes().get(0));
72     }
73     @</b></font>Test
74     public void testGroupByScalarWithMultipleColumnArgumentsPlan() throws Exception {
75         Merge merge = e.plan("select abs(id + other_id) from users group by id, other_id");
76         Merge subplan = (Merge) merge.subPlan();
77         Collect collect = (Collect) subplan.subPlan();
78         RoutedCollectPhase collectPhase = ((RoutedCollectPhase) collect.collectPhase());
79         assertThat(collectPhase.projections().size(), is(1));
80         assertThat(collectPhase.projections().get(0), instanceOf(GroupProjection.class));
81         assertThat(collectPhase.projections().get(0).requiredGranularity(), is(RowGranularity.SHARD));
82         assertThat(collectPhase.toCollect(), contains(isReference("id", DataTypes.LONG), isReference("other_id", DataTypes.LONG)));
83         GroupProjection groupProjection = (GroupProjection) collectPhase.projections().get(0);
84         assertThat(groupProjection.keys().size(), is(2));
85         assertThat(groupProjection.keys().get(0).valueType(), is(DataTypes.LONG));
86         assertThat(groupProjection.keys().get(1).valueType(), is(DataTypes.LONG));
87         MergePhase mergePhase = subplan.mergePhase();
88         assertThat(mergePhase.projections().size(), is(2));
89 <a name="1"></a>        assertThat(mergePhase.projections().get(0), instanceOf(GroupProjection.class));
90         assertThat(mergePhase.projections().get(1), instanceOf(EvalProjection.class));
91         assertThat(<font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>mergePhase.projections().get(1).outputs(), contains(isFunction("abs")));
92     }
93     @</b></font>Test
94     public void test_group_by_scalar_containing_a_table_function_results_in_project_set() {
95         var logicalPlan = e.logicalPlan("SELECT regexp_matches(name, '.*')[1] FROM users GROUP BY 1");
96         var expectedPlan =
97             "GroupHashAggregate[regexp_matches(name, '.*')[1]]\n" +
98             "  └ ProjectSet[regexp_matches(name, '.*'), name]\n" +
99             "    └ Collect[doc.users | [name] | true]";
100         assertThat(logicalPlan, isPlan(expectedPlan));
101     }
102 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>Analyzer.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>package io.crate.analyze;
2 import io.crate.action.sql.SessionContext;
3 import io.crate.analyze.relations.RelationAnalyzer;
4 import io.crate.user.UserManager;
5 import io.crate.execution.ddl.RepositoryService;
6 import io.crate.metadata.CoordinatorTxnCtx;
7 import io.crate.metadata.FulltextAnalyzerResolver;
8 import io.crate.metadata.NodeContext;
9 import io.crate.metadata.Schemas;
10 import io.crate.metadata.settings.session.SessionSettingRegistry;
11 import io.crate.sql.tree.AlterBlobTable;
12 import io.crate.sql.tree.AlterClusterRerouteRetryFailed;
13 import io.crate.sql.tree.AlterTable;
14 import io.crate.sql.tree.AlterTableAddColumn;
15 import io.crate.sql.tree.AlterTableOpenClose;
16 import io.crate.sql.tree.AlterTableRename;
17 import io.crate.sql.tree.AlterTableReroute;
18 import io.crate.sql.tree.AlterUser;
19 import io.crate.sql.tree.AnalyzeStatement;
20 import io.crate.sql.tree.AstVisitor;
21 import io.crate.sql.tree.BeginStatement;
22 import</b></font> io.crate.sql.tree.CommitStatement;
23 import io.crate.sql.tree.CopyFrom;
24 import io.crate.sql.tree.CopyTo;
25 import io.crate.sql.tree.CreateAnalyzer;
26 import io.crate.sql.tree.CreateBlobTable;
27 import io.crate.sql.tree.CreateFunction;
28 import io.crate.sql.tree.CreateRepository;
29 import io.crate.sql.tree.CreateSnapshot;
30 import io.crate.sql.tree.CreateTable;
31 import io.crate.sql.tree.CreateTableAs;
32 import io.crate.sql.tree.CreateUser;
33 import io.crate.sql.tree.CreateView;
34 import io.crate.sql.tree.DeallocateStatement;
35 import io.crate.sql.tree.DecommissionNodeStatement;
36 import io.crate.sql.tree.Delete;
37 import io.crate.sql.tree.DenyPrivilege;
38 import io.crate.sql.tree.DiscardStatement;
39 import io.crate.sql.tree.DropAnalyzer;
40 import io.crate.sql.tree.DropBlobTable;
41 import io.crate.sql.tree.DropCheckConstraint;
42 import io.crate.sql.tree.DropFunction;
43 import io.crate.sql.tree.DropRepository;
44 import io.crate.sql.tree.DropSnapshot;
45 import io.crate.sql.tree.DropTable;
46 import io.crate.sql.tree.DropUser;
47 import io.crate.sql.tree.DropView;
48 import io.crate.sql.tree.Explain;
49 import io.crate.sql.tree.Expression;
50 import io.crate.sql.tree.GCDanglingArtifacts;
51 import io.crate.sql.tree.GrantPrivilege;
52 import io.crate.sql.tree.Insert;
53 import io.crate.sql.tree.KillStatement;
54 import io.crate.sql.tree.OptimizeStatement;
55 import io.crate.sql.tree.Query;
56 import io.crate.sql.tree.RefreshStatement;
57 import io.crate.sql.tree.ResetStatement;
58 import io.crate.sql.tree.RestoreSnapshot;
59 import io.crate.sql.tree.RevokePrivilege;
60 import io.crate.sql.tree.SetSessionAuthorizationStatement;
61 import io.crate.sql.tree.SetStatement;
62 import io.crate.sql.tree.SetTransactionStatement;
63 import io.crate.sql.tree.ShowColumns;
64 import io.crate.sql.tree.ShowCreateTable;
65 import io.crate.sql.tree.ShowSchemas;
66 import io.crate.sql.tree.ShowSessionParameter;
67 import io.crate.sql.tree.ShowTables;
68 import io.crate.sql.tree.ShowTransaction;
69 import io.crate.sql.tree.Statement;
70 import io.crate.sql.tree.SwapTable;
71 import io.crate.sql.tree.Update;
72 import org.elasticsearch.cluster.service.ClusterService;
73 import org.elasticsearch.common.inject.Inject;
74 import org.elasticsearch.common.inject.Singleton;
75 import org.elasticsearch.index.analysis.AnalysisRegistry;
76 @Singleton
77 public class Analyzer {
78     private final AnalyzerDispatcher dispatcher = new AnalyzerDispatcher();
79     private final RelationAnalyzer relationAnalyzer;
80     private final DropTableAnalyzer dropTableAnalyzer;
81     private final DropCheckConstraintAnalyzer dropCheckConstraintAnalyzer;
82     private final CreateTableStatementAnalyzer createTableStatementAnalyzer;
83     private final CreateTableAsAnalyzer createTableAsAnalyzer;
84     private final ExplainStatementAnalyzer explainStatementAnalyzer;
85     private final ShowStatementAnalyzer showStatementAnalyzer;
86     private final CreateBlobTableAnalyzer createBlobTableAnalyzer;
87     private final CreateAnalyzerStatementAnalyzer createAnalyzerStatementAnalyzer;
88     private final DropAnalyzerStatementAnalyzer dropAnalyzerStatementAnalyzer;
89     private final UserManager userManager;
90     private final RefreshTableAnalyzer refreshTableAnalyzer;
91     private final OptimizeTableAnalyzer optimizeTableAnalyzer;
92     private final AlterTableAnalyzer alterTableAnalyzer;
93     private final AlterTableAddColumnAnalyzer alterTableAddColumnAnalyzer;
94     private final InsertAnalyzer insertAnalyzer;
95     private final CopyAnalyzer copyAnalyzer;
96     private final UpdateAnalyzer updateAnalyzer;
97     private final DeleteAnalyzer deleteAnalyzer;
98     private final DropRepositoryAnalyzer dropRepositoryAnalyzer;
99     private final CreateRepositoryAnalyzer createRepositoryAnalyzer;
100     private final DropSnapshotAnalyzer dropSnapshotAnalyzer;
101     private final CreateSnapshotAnalyzer createSnapshotAnalyzer;
102     private final RestoreSnapshotAnalyzer restoreSnapshotAnalyzer;
103     private final CreateFunctionAnalyzer createFunctionAnalyzer;
104     private final DropFunctionAnalyzer dropFunctionAnalyzer;
105     private final PrivilegesAnalyzer privilegesAnalyzer;
106     private final AlterTableRerouteAnalyzer alterTableRerouteAnalyzer;
107     private final UserAnalyzer userAnalyzer;
108     private final ViewAnalyzer viewAnalyzer;
109     private final SwapTableAnalyzer swapTableAnalyzer;
110     private final DecommissionNodeAnalyzer decommissionNodeAnalyzer;
111     private final KillAnalyzer killAnalyzer;
112     private final SetStatementAnalyzer setStatementAnalyzer;
113     private final ResetStatementAnalyzer resetStatementAnalyzer;
114     @Inject
115     public Analyzer(Schemas schemas,
116                     NodeContext nodeCtx,
117                     RelationAnalyzer relationAnalyzer,
118                     ClusterService clusterService,
119                     AnalysisRegistry analysisRegistry,
120                     RepositoryService repositoryService,
121                     UserManager userManager,
122                     SessionSettingRegistry sessionSettingRegistry
123     ) {
124         this.relationAnalyzer = relationAnalyzer;
125         this.dropTableAnalyzer = new DropTableAnalyzer(clusterService, schemas);
126         this.dropCheckConstraintAnalyzer = new DropCheckConstraintAnalyzer(schemas);
127         this.userManager = userManager;
128         this.createTableStatementAnalyzer = new CreateTableStatementAnalyzer(nodeCtx);
129         this.alterTableAnalyzer = new AlterTableAnalyzer(schemas, nodeCtx);
130         this.alterTableAddColumnAnalyzer = new AlterTableAddColumnAnalyzer(schemas, nodeCtx);
131         this.swapTableAnalyzer = new SwapTableAnalyzer(nodeCtx, schemas);
132         this.viewAnalyzer = new ViewAnalyzer(relationAnalyzer, schemas);
133         this.explainStatementAnalyzer = new ExplainStatementAnalyzer(this);
134         this.showStatementAnalyzer = new ShowStatementAnalyzer(this, schemas, sessionSettingRegistry);
135         this.updateAnalyzer = new UpdateAnalyzer(nodeCtx, relationAnalyzer);
136         this.deleteAnalyzer = new DeleteAnalyzer(nodeCtx, relationAnalyzer);
137         this.insertAnalyzer = new InsertAnalyzer(nodeCtx, schemas, relationAnalyzer);
138         this.createTableAsAnalyzer = new CreateTableAsAnalyzer(createTableStatementAnalyzer, insertAnalyzer, relationAnalyzer);
139         this.optimizeTableAnalyzer = new OptimizeTableAnalyzer(schemas, nodeCtx);
140         this.createRepositoryAnalyzer = new CreateRepositoryAnalyzer(repositoryService, nodeCtx);
141         this.dropRepositoryAnalyzer = new DropRepositoryAnalyzer(repositoryService);
142         this.createSnapshotAnalyzer = new CreateSnapshotAnalyzer(repositoryService, nodeCtx);
143         this.dropSnapshotAnalyzer = new DropSnapshotAnalyzer(repositoryService);
144         this.userAnalyzer = new UserAnalyzer(nodeCtx);
145         this.createBlobTableAnalyzer = new CreateBlobTableAnalyzer(schemas, nodeCtx);
146         this.createFunctionAnalyzer = new CreateFunctionAnalyzer(nodeCtx);
147         this.dropFunctionAnalyzer = new DropFunctionAnalyzer();
148         this.refreshTableAnalyzer = new RefreshTableAnalyzer(nodeCtx, schemas);
149         this.restoreSnapshotAnalyzer = new RestoreSnapshotAnalyzer(repositoryService, nodeCtx);
150         FulltextAnalyzerResolver fulltextAnalyzerResolver =
151             new FulltextAnalyzerResolver(clusterService, analysisRegistry);
152         this.createAnalyzerStatementAnalyzer = new CreateAnalyzerStatementAnalyzer(fulltextAnalyzerResolver, nodeCtx);
153         this.dropAnalyzerStatementAnalyzer = new DropAnalyzerStatementAnalyzer(fulltextAnalyzerResolver);
154         this.decommissionNodeAnalyzer = new DecommissionNodeAnalyzer(nodeCtx);
155         this.killAnalyzer = new KillAnalyzer(nodeCtx);
156         this.alterTableRerouteAnalyzer = new AlterTableRerouteAnalyzer(nodeCtx, schemas);
157         this.privilegesAnalyzer = new PrivilegesAnalyzer(userManager.isEnabled(), schemas);
158         this.copyAnalyzer = new CopyAnalyzer(schemas, nodeCtx);
159         this.setStatementAnalyzer = new SetStatementAnalyzer(nodeCtx);
160         this.resetStatementAnalyzer = new ResetStatementAnalyzer(nodeCtx);
161     }
162     public AnalyzedStatement analyze(Statement statement,
163                                      SessionContext sessionContext,
164                                      ParamTypeHints paramTypeHints) {
165         var analyzedStatement = statement.accept(
166             dispatcher,
167             new Analysis(
168                 new CoordinatorTxnCtx(sessionContext),
169                 paramTypeHints));
170         userManager.getAccessControl(sessionContext).ensureMayExecute(analyzedStatement);
171         return analyzedStatement;
172     }
173     AnalyzedStatement analyzedStatement(Statement statement, Analysis analysis) {
174         AnalyzedStatement analyzedStatement = statement.accept(dispatcher, analysis);
175         assert analyzedStatement != null : "analyzed statement must not be null";
176         return analyzedStatement;
177     }
178     @SuppressWarnings("unchecked")
179     private class AnalyzerDispatcher extends AstVisitor&lt;AnalyzedStatement, Analysis&gt; {
180         @Override
181         public AnalyzedStatement visitAlterBlobTable(AlterBlobTable&lt;?&gt; node, Analysis context) {
182             return alterTableAnalyzer.analyze(
183                 (AlterBlobTable&lt;Expression&gt;) node,
184                 context.paramTypeHints(),
185                 context.transactionContext());
186         }
187         @Override
188         public AnalyzedStatement visitAlterClusterDecommissionNode(DecommissionNodeStatement&lt;?&gt; node,
189                                                                    Analysis context) {
190             return decommissionNodeAnalyzer.analyze(
191                 (DecommissionNodeStatement&lt;Expression&gt;) node,
192                 context.transactionContext(),
193                 context.paramTypeHints());
194         }
195         @Override
196         public AnalyzedStatement visitAlterClusterRerouteRetryFailed(AlterClusterRerouteRetryFailed node,
197                                                                      Analysis context) {
198             return new AnalyzedRerouteRetryFailed();
199         }
200         @Override
201         public AnalyzedStatement visitAlterTable(AlterTable&lt;?&gt; node, Analysis context) {
202             return alterTableAnalyzer.analyze(
203                 (AlterTable&lt;Expression&gt;) node,
204                 context.paramTypeHints(),
205                 context.transactionContext());
206         }
207         @Override
208         public AnalyzedStatement visitDropCheckConstraint(DropCheckConstraint&lt;?&gt; node, Analysis context) {
209             return dropCheckConstraintAnalyzer.analyze(
210                 node.table(),
211                 node.name(),
212                 context.transactionContext());
213         }
214         @Override
215         public AnalyzedStatement visitAlterTableAddColumnStatement(AlterTableAddColumn&lt;?&gt; node, Analysis context) {
216             return alterTableAddColumnAnalyzer.analyze(
217                 (AlterTableAddColumn&lt;Expression&gt;) node,
218                 context.paramTypeHints(),
219                 context.transactionContext());
220         }
221         @Override
222         public AnalyzedStatement visitAlterTableOpenClose(AlterTableOpenClose&lt;?&gt; node, Analysis context) {
223             return alterTableAnalyzer.analyze(
224                 (AlterTableOpenClose&lt;Expression&gt;) node,
225                 context.paramTypeHints(),
226                 context.transactionContext());
227         }
228         @Override
229         public AnalyzedStatement visitAlterTableRename(AlterTableRename&lt;?&gt; node, Analysis context) {
230             return alterTableAnalyzer.analyze(
231                 (AlterTableRename&lt;Expression&gt;) node,
232                 context.sessionContext());
233         }
234         @Override
235         public AnalyzedStatement visitAlterTableReroute(AlterTableReroute&lt;?&gt; node, Analysis context) {
236             return alterTableRerouteAnalyzer.analyze(
237                 (AlterTableReroute&lt;Expression&gt;) node,
238                 context.paramTypeHints(),
239                 context.transactionContext());
240         }
241         @Override
242         public AnalyzedStatement visitAlterUser(AlterUser&lt;?&gt; node, Analysis context) {
243             return userAnalyzer.analyze(
244                 (AlterUser&lt;Expression&gt;) node,
245                 context.paramTypeHints(),
246                 context.transactionContext());
247         }
248         @Override
249         public AnalyzedStatement visitAnalyze(AnalyzeStatement analyzeStatement, Analysis analysis) {
250             return new AnalyzedAnalyze();
251         }
252         @Override
253         public AnalyzedStatement visitBegin(BeginStatement node, Analysis context) {
254             return new AnalyzedBegin();
255         }
256         @Override
257         public AnalyzedStatement visitCommit(CommitStatement node, Analysis context) {
258             return new AnalyzedCommit();
259         }
260         @Override
261         public AnalyzedStatement visitCopyFrom(CopyFrom&lt;?&gt; node, Analysis context) {
262             return copyAnalyzer.analyzeCopyFrom(
263                 (CopyFrom&lt;Expression&gt;) node,
264                 context.paramTypeHints(),
265                 context.transactionContext());
266         }
267         @Override
268         public AnalyzedStatement visitCopyTo(CopyTo&lt;?&gt; node, Analysis context) {
269             return copyAnalyzer.analyzeCopyTo(
270                 (CopyTo&lt;Expression&gt;) node,
271                 context.paramTypeHints(),
272                 context.transactionContext());
273         }
274         @Override
275         public AnalyzedStatement visitCreateAnalyzer(CreateAnalyzer&lt;?&gt; node, Analysis context) {
276             return createAnalyzerStatementAnalyzer.analyze(
277                 (CreateAnalyzer&lt;Expression&gt;) node,
278                 context.paramTypeHints(),
279                 context.transactionContext());
280         }
281         @Override
282         public AnalyzedStatement visitCreateBlobTable(CreateBlobTable&lt;?&gt; node,
283                                                       Analysis context) {
284             return createBlobTableAnalyzer.analyze(
285                 (CreateBlobTable&lt;Expression&gt;) node,
286                 context.paramTypeHints(),
287                 context.transactionContext());
288         }
289 <a name="4"></a>
290         @Override
291         public AnalyzedStatement visitCreateFunction(CreateFunction&lt;?&gt; node, Analysis context) {
292             return <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>createFunctionAnalyzer.analyze(
293                 (CreateFunction&lt;Expression&gt;) node,
294                 context.paramTypeHints(),
295                 context.transactionContext(),
296                 context.sessionContext().searchPath());
297         }
298         @</b></font>Override
299         public AnalyzedStatement visitCreateRepository(CreateRepository node, Analysis context) {
300             return createRepositoryAnalyzer.analyze(
301                 (CreateRepository&lt;Expression&gt;) node,
302                 context.paramTypeHints(),
303                 context.transactionContext());
304         }
305         @Override
306         public AnalyzedStatement visitCreateSnapshot(CreateSnapshot&lt;?&gt; node, Analysis context) {
307             return createSnapshotAnalyzer.analyze(
308                 (CreateSnapshot&lt;Expression&gt;) node,
309                 context.paramTypeHints(),
310                 context.transactionContext());
311         }
312         @Override
313         public AnalyzedStatement visitCreateTable(CreateTable node, Analysis analysis) {
314             return createTableStatementAnalyzer.analyze(
315                 (CreateTable&lt;Expression&gt;) node,
316                 analysis.paramTypeHints(),
317                 analysis.transactionContext());
318         }
319         @Override
320         public AnalyzedStatement visitCreateTableAs(CreateTableAs node, Analysis analysis) {
321             return createTableAsAnalyzer.analyze(
322                 node,
323                 analysis.paramTypeHints(),
324                 analysis.transactionContext());
325         }
326         @Override
327         public AnalyzedStatement visitCreateUser(CreateUser&lt;?&gt; node, Analysis context) {
328             return userAnalyzer.analyze(
329                 (CreateUser&lt;Expression&gt;) node,
330                 context.paramTypeHints(),
331                 context.transactionContext());
332         }
333         @Override
334         public AnalyzedStatement visitCreateView(CreateView node, Analysis context) {
335             return viewAnalyzer.analyze(node, context.transactionContext());
336         }
337         @Override
338         public AnalyzedStatement visitDeallocateStatement(DeallocateStatement node, Analysis context) {
339             return DeallocateAnalyzer.analyze(node);
340         }
341         @Override
342         public AnalyzedStatement visitDiscard(DiscardStatement discardStatement, Analysis context) {
343             return new AnalyzedDiscard(discardStatement.target());
344         }
345         @Override
346         public AnalyzedStatement visitDelete(Delete node, Analysis analysis) {
347             return deleteAnalyzer.analyze(
348                 node,
349                 analysis.paramTypeHints(),
350                 analysis.transactionContext());
351         }
352 <a name="3"></a>
353         @Override
354         public AnalyzedStatement visitDenyPrivilege(DenyPrivilege node, Analysis context) {
355             return <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>privilegesAnalyzer.analyzeDeny(
356                 node,
357                 context.sessionContext().sessionUser(),
358                 context.sessionContext().searchPath());
359         }
360         @</b></font>Override
361         public AnalyzedStatement visitDropAnalyzer(DropAnalyzer node, Analysis context) {
362             return dropAnalyzerStatementAnalyzer.analyze(node.name());
363         }
364         @Override
365         public AnalyzedStatement visitDropBlobTable(DropBlobTable&lt;?&gt; node, Analysis context) {
366             return dropTableAnalyzer.analyze(node, context.sessionContext());
367         }
368         @Override
369         public AnalyzedStatement visitDropFunction(DropFunction node, Analysis context) {
370             return dropFunctionAnalyzer.analyze(node, context.sessionContext().searchPath());
371         }
372         @Override
373         public AnalyzedStatement visitDropRepository(DropRepository node, Analysis context) {
374             return dropRepositoryAnalyzer.analyze(node);
375         }
376         @Override
377         public AnalyzedStatement visitDropSnapshot(DropSnapshot node, Analysis context) {
378             return dropSnapshotAnalyzer.analyze(node);
379         }
380         @Override
381         public AnalyzedDropTable visitDropTable(DropTable&lt;?&gt; node, Analysis context) {
382             return dropTableAnalyzer.analyze(node, context.sessionContext());
383         }
384         @Override
385         public AnalyzedStatement visitDropUser(DropUser node, Analysis context) {
386             return new AnalyzedDropUser(node.name(), node.ifExists());
387         }
388         @Override
389         public AnalyzedStatement visitDropView(DropView node, Analysis context) {
390             return viewAnalyzer.analyze(node, context.transactionContext());
391         }
392         @Override
393         protected AnalyzedStatement visitExplain(Explain node, Analysis context) {
394             return explainStatementAnalyzer.analyze(node, context);
395         }
396         @Override
397         public AnalyzedStatement visitGCDanglingArtifacts(GCDanglingArtifacts gcDanglingArtifacts, Analysis context) {
398             return AnalyzedGCDanglingArtifacts.INSTANCE;
399         }
400 <a name="2"></a>
401         @Override
402         public AnalyzedStatement visitGrantPrivilege(GrantPrivilege node, Analysis context) {
403             return <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>privilegesAnalyzer.analyzeGrant(
404                 node,
405                 context.sessionContext().sessionUser(),
406                 context.sessionContext().searchPath());
407         }
408         @</b></font>Override
409         public AnalyzedStatement visitInsert(Insert&lt;?&gt; node, Analysis analysis) {
410             return insertAnalyzer.analyze(
411                 (Insert&lt;Expression&gt;) node,
412                 analysis.paramTypeHints(),
413                 analysis.transactionContext());
414         }
415         @Override
416         public AnalyzedStatement visitKillStatement(KillStatement&lt;?&gt; node, Analysis context) {
417             return killAnalyzer.analyze(
418                 (KillStatement&lt;Expression&gt;) node,
419                 context.paramTypeHints(),
420                 context.transactionContext());
421         }
422         @Override
423         public AnalyzedStatement visitOptimizeStatement(OptimizeStatement&lt;?&gt; node, Analysis context) {
424             return optimizeTableAnalyzer.analyze(
425                 (OptimizeStatement&lt;Expression&gt;) node,
426                 context.paramTypeHints(),
427                 context.transactionContext()
428             );
429         }
430         @Override
431         protected AnalyzedStatement visitQuery(Query node, Analysis context) {
432             return relationAnalyzer.analyze(
433                 node,
434                 context.transactionContext(),
435                 context.paramTypeHints());
436         }
437         @Override
438         public AnalyzedStatement visitRefreshStatement(RefreshStatement&lt;?&gt; node, Analysis context) {
439             return refreshTableAnalyzer.analyze(
440                 (RefreshStatement&lt;Expression&gt;) node,
441                 context.paramTypeHints(),
442                 context.transactionContext()
443             );
444         }
445         public AnalyzedStatement visitResetStatement(ResetStatement&lt;?&gt; node, Analysis context) {
446             return resetStatementAnalyzer.analyze(
447                 (ResetStatement&lt;Expression&gt;) node,
448                 context.paramTypeHints(),
449                 context.transactionContext());
450         }
451         @Override
452         public AnalyzedStatement visitRestoreSnapshot(RestoreSnapshot&lt;?&gt; node, Analysis context) {
453             return restoreSnapshotAnalyzer.analyze(
454                 (RestoreSnapshot&lt;Expression&gt;) node,
455                 context.paramTypeHints(),
456                 context.transactionContext());
457         }
458 <a name="1"></a>
459         @Override
460         public AnalyzedStatement visitRevokePrivilege(RevokePrivilege node, Analysis context) {
461             return <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>privilegesAnalyzer.analyzeRevoke(
462                 node,
463                 context.sessionContext().sessionUser(),
464                 context.sessionContext().searchPath());
465         }
466         @</b></font>Override
467         public AnalyzedStatement visitSetStatement(SetStatement&lt;?&gt; node, Analysis context) {
468             return setStatementAnalyzer.analyze(
469                 (SetStatement&lt;Expression&gt;) node,
470                 context.paramTypeHints(),
471                 context.transactionContext());
472         }
473         @Override
474         public AnalyzedStatement visitSetSessionAuthorizationStatement(SetSessionAuthorizationStatement node,
475                                                                        Analysis context) {
476             return new AnalyzedSetSessionAuthorizationStatement(node.user(), node.scope());
477         }
478         @Override
479         public AnalyzedStatement visitSetTransaction(SetTransactionStatement setTransaction, Analysis analysis) {
480             return new AnalyzedSetTransaction(setTransaction.transactionModes());
481         }
482         @Override
483         protected AnalyzedStatement visitShowColumns(ShowColumns node, Analysis context) {
484             var coordinatorTxnCtx = context.transactionContext();
485             Query query = showStatementAnalyzer.rewriteShowColumns(
486                 node,
487                 coordinatorTxnCtx.sessionContext().searchPath().currentSchema());
488             return relationAnalyzer.analyze(
489                 query,
490                 coordinatorTxnCtx,
491                 context.paramTypeHints());
492         }
493         @Override
494         public AnalyzedStatement visitShowCreateTable(ShowCreateTable&lt;?&gt; node, Analysis context) {
495             return showStatementAnalyzer.analyzeShowCreateTable(node.table(), context);
496         }
497         @Override
498         protected AnalyzedStatement visitShowSchemas(ShowSchemas node, Analysis context) {
499             Query query = showStatementAnalyzer.rewriteShowSchemas(node);
500             return relationAnalyzer.analyze(
501                 query,
502                 context.transactionContext(),
503                 context.paramTypeHints());
504         }
505         @Override
506         public AnalyzedStatement visitShowSessionParameter(ShowSessionParameter node, Analysis context) {
507             showStatementAnalyzer.validateSessionSetting(node.parameter());
508             Query query = showStatementAnalyzer.rewriteShowSessionParameter(node);
509             return relationAnalyzer.analyze(
510                 query,
511                 context.transactionContext(),
512                 context.paramTypeHints());
513         }
514         @Override
515         protected AnalyzedStatement visitShowTables(ShowTables node, Analysis context) {
516             Query query = showStatementAnalyzer.rewriteShowTables(node);
517             return relationAnalyzer.analyze(
518                 query,
519                 context.transactionContext(),
520                 context.paramTypeHints());
521         }
522         @Override
523         public AnalyzedStatement visitShowTransaction(ShowTransaction showTransaction, Analysis context) {
524             return showStatementAnalyzer.analyzeShowTransaction(context);
525         }
526         @Override
527         public AnalyzedStatement visitSwapTable(SwapTable&lt;?&gt; node, Analysis analysis) {
528             return swapTableAnalyzer.analyze(
529                 (SwapTable&lt;Expression&gt;) node,
530                 analysis.transactionContext(),
531                 analysis.paramTypeHints()
532             );
533         }
534         @Override
535         public AnalyzedStatement visitUpdate(Update node, Analysis analysis) {
536             return updateAnalyzer.analyze(
537                 node,
538                 analysis.paramTypeHints(),
539                 analysis.transactionContext());
540         }
541     }
542 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
