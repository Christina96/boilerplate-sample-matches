<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for SysInfoUtilTest.java & SumAggregationTest.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for SysInfoUtilTest.java & SumAggregationTest.java
      </h3>
      <h1 align="center">
        29.2%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>SysInfoUtilTest.java (38.15261%)<TH>SumAggregationTest.java (23.690773%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match234954-0.html#0',2,'match234954-1.html#0',3)" NAME="0">(62-73)<TD><A HREF="javascript:ZweiFrames('match234954-0.html#0',2,'match234954-1.html#0',3)" NAME="0">(74-80)</A><TD ALIGN=center><FONT COLOR="#ff0000">27</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match234954-0.html#1',2,'match234954-1.html#1',3)" NAME="1">(135-147)<TD><A HREF="javascript:ZweiFrames('match234954-0.html#1',2,'match234954-1.html#1',3)" NAME="1">(118-131)</A><TD ALIGN=center><FONT COLOR="#a00000">17</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match234954-0.html#2',2,'match234954-1.html#2',3)" NAME="2">(88-94)<TD><A HREF="javascript:ZweiFrames('match234954-0.html#2',2,'match234954-1.html#2',3)" NAME="2">(81-91)</A><TD ALIGN=center><FONT COLOR="#710000">12</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match234954-0.html#3',2,'match234954-1.html#3',3)" NAME="3">(116-122)<TD><A HREF="javascript:ZweiFrames('match234954-0.html#3',2,'match234954-1.html#3',3)" NAME="3">(210-216)</A><TD ALIGN=center><FONT COLOR="#5e0000">10</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match234954-0.html#4',2,'match234954-1.html#4',3)" NAME="4">(107-112)<TD><A HREF="javascript:ZweiFrames('match234954-0.html#4',2,'match234954-1.html#4',3)" NAME="4">(47-59)</A><TD ALIGN=center><FONT COLOR="#5e0000">10</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match234954-0.html#5',2,'match234954-1.html#5',3)" NAME="5">(51-56)<TD><A HREF="javascript:ZweiFrames('match234954-0.html#5',2,'match234954-1.html#5',3)" NAME="5">(143-148)</A><TD ALIGN=center><FONT COLOR="#5e0000">10</FONT>
<TR><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match234954-0.html#6',2,'match234954-1.html#6',3)" NAME="6">(41-46)<TD><A HREF="javascript:ZweiFrames('match234954-0.html#6',2,'match234954-1.html#6',3)" NAME="6">(164-173)</A><TD ALIGN=center><FONT COLOR="#550000">9</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>SysInfoUtilTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Licensed to Crate.io GmbH (&quot;Crate&quot;) under one or more contributor
 * license agreements.  See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.  Crate licenses
 * this file to you under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.  You may
 * obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations
 * under the License.
 *
 * However, if you have executed another commercial license agreement
 * with Crate these terms will supersede the license and you may use the
 * software solely pursuant to the terms of the relevant commercial agreement.
 */

package io.crate.monitor;

import org.elasticsearch.test.ESTestCase;
import org.hamcrest.core.AnyOf;
import org.junit.Test;

import java.util.List;

import static org.hamcrest.core.AnyOf.anyOf;
import static org.hamcrest.core.Is.is;

public class SysInfoUtilTest extends ESTestCase {

    private static final SysInfo.Builder SYSINFO_BUILDER = new SysInfo.Builder();
    private static final AnyOf&lt;String&gt; X86_64 = anyOf(is(&quot;x86_64&quot;), is(&quot;amd64&quot;), is(&quot;x64&quot;));

<A NAME="6"></A>    private void assertVendorVersionFromGenericLine(String line, String expectedVersionString) {
        SysInfo sysInfo = new SysInfo();
        SYSINFO_BUILDER.parseGenericVendorLine(sysInfo, line);
        assertEquals(<FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match234954-1.html#6',3,'match234954-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>sysInfo.vendorVersion(), expectedVersionString);
    }

    @Test
    public void testParseKeyValue() {
        assertThat(SysInfo.Builder.parseKeyValuePair(&quot;KEY=\&quot;val\&quot;ue\&quot;&quot;), is</B></FONT>(new String[]{&quot;KEY&quot;, &quot;val\&quot;ue&quot;}));
        assertThat(SysInfo.Builder.parseKeyValuePair(&quot;KEY=\&quot;value\&quot;&quot;), is(new String[]{&quot;KEY&quot;, &quot;value&quot;}));
<A NAME="5"></A>        assertThat(SysInfo.Builder.parseKeyValuePair(&quot;KEY=value&quot;), is(new String[]{&quot;KEY&quot;, &quot;value&quot;}));
        assertThat(SysInfo.Builder.parseKeyValuePair(&quot;KEY=&quot;), is(new String[]{&quot;KEY&quot;, &quot;&quot;}));
        assertThat(SysInfo.Builder.parseKeyValuePair(&quot;KEY&quot;), is(new String[]{&quot;KEY&quot;, &quot;&quot;}));
        assertThat(SysInfo.Builder.parseKeyValuePair(&quot;&quot;), is(<FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match234954-1.html#5',3,'match234954-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>new String[]{&quot;&quot;, &quot;&quot;}));
    }

    @Test
    public void testWindows() {
        SysInfo sysInfo = new SysInfo.Builder()</B></FONT>
            .withName(&quot;Windows 10&quot;)
            .withVersion(&quot;10.0&quot;)
<A NAME="0"></A>            .withArch(&quot;x86_64&quot;)
            .gather();
        assertThat(sysInfo.arch(), is(&quot;x86_64&quot;));
        assertThat(sysInfo.description(), <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match234954-1.html#0',3,'match234954-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>is(&quot;Microsoft Windows 10&quot;));
        assertThat(sysInfo.machine(), X86_64);
        assertThat(sysInfo.name(), is(&quot;Win32&quot;));
        assertThat(sysInfo.patchLevel(), is(&quot;&quot;));
        assertThat(sysInfo.vendor(), is(&quot;Microsoft&quot;));
        assertThat(sysInfo.vendorCodeName(), is(&quot;&quot;));
        assertThat(sysInfo.vendorName(), is(&quot;Windows 10&quot;));
        assertThat(sysInfo.vendorVersion(), is(&quot;10&quot;));
        assertThat(sysInfo.version(), is(&quot;10.0&quot;));
    }

    @Test</B></FONT>
    public void testMacOS() {
        SysInfo sysInfo = new SysInfo.Builder()
            .withName(&quot;Mac OS&quot;)
            .withVersion(&quot;10.12.6&quot;)
            .withArch(&quot;x86_64&quot;)
            .gather();
        assertThat(sysInfo.arch(), is(&quot;x86_64&quot;));
        assertThat(sysInfo.description(), is(&quot;Mac OS X (Sierra)&quot;));
        assertThat(sysInfo.machine(), X86_64);
        assertThat(sysInfo.name(), is(&quot;MacOSX&quot;));
        assertThat(sysInfo.patchLevel(), is(&quot;&quot;));
<A NAME="2"></A>        assertThat(sysInfo.vendor(), is(&quot;Apple&quot;));
        assertThat(sysInfo.vendorCodeName(), is(&quot;Sierra&quot;));
        assertThat(sysInfo.vendorName(), is(&quot;Mac OS X&quot;));
        assertThat(<FONT color="#980517"><A HREF="javascript:ZweiFrames('match234954-1.html#2',3,'match234954-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>sysInfo.vendorVersion(), is(&quot;10.12&quot;));
        assertThat(sysInfo.version(), is(&quot;10.12.6&quot;));
    }

    @Test
    public void testDarwin() {
        SysInfo sysInfo = new SysInfo.Builder()</B></FONT>
            .withName(&quot;Darwin&quot;)
            .withVersion(&quot;16.6.0&quot;)
            .withArch(&quot;x86_64&quot;)
            .gather();
        assertThat(sysInfo.arch(), is(&quot;x86_64&quot;));
        assertThat(sysInfo.description(), is(&quot;Mac OS X (Sierra)&quot;));
        assertThat(sysInfo.machine(), X86_64);
        assertThat(sysInfo.name(), is(&quot;MacOSX&quot;));
        assertThat(sysInfo.patchLevel(), is(&quot;&quot;));
<A NAME="4"></A>        assertThat(sysInfo.vendor(), is(&quot;Apple&quot;));
        assertThat(sysInfo.vendorCodeName(), is(&quot;Sierra&quot;));
        assertThat(sysInfo.vendorName(), is(&quot;Mac OS X&quot;));
        assertThat(<FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match234954-1.html#4',3,'match234954-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>sysInfo.vendorVersion(), is(&quot;16.6&quot;));
        assertThat(sysInfo.version(), is(&quot;16.6.0&quot;));
    }

    @Test
    public void testParseRedHatVendorCentOs() {</B></FONT>
<A NAME="3"></A>        SysInfo sysInfo = new SysInfo();
        String release = &quot;CentOS Linux release 7.4.1708 (Core)&quot;;
        SYSINFO_BUILDER.parseRedHatVendorLine(sysInfo, release);
        assertThat(sysInfo.vendor(), <FONT color="#53858b"><A HREF="javascript:ZweiFrames('match234954-1.html#3',3,'match234954-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>is(&quot;CentOS&quot;));
        assertThat(sysInfo.vendorCodeName(), is(&quot;Core&quot;));
    }

    @Test
    public void testParseRedHatVendorRhel() {
        SysInfo sysInfo = new SysInfo()</B></FONT>;
        String release = &quot;Red Hat Enterprise Linux Server release 6.7 (Santiago)&quot;;
        SYSINFO_BUILDER.parseGenericVendorLine(sysInfo, release);
        assertThat(sysInfo.vendorVersion(), is(&quot;6.7&quot;)); // required for parseRedHatVendorLine()
        SYSINFO_BUILDER.parseRedHatVendorLine(sysInfo, release);
        assertThat(sysInfo.vendorVersion(), is(&quot;Enterprise Linux 6&quot;));
        assertThat(sysInfo.vendorCodeName(), is(&quot;Santiago&quot;));
    }

    @Test
<A NAME="1"></A>    public void testGenericVendor() {
        assertVendorVersionFromGenericLine(&quot;&quot;, &quot;&quot;);
        assertVendorVersionFromGenericLine(&quot;8&quot;, &quot;8&quot;);
        <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match234954-1.html#1',3,'match234954-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertVendorVersionFromGenericLine(&quot;8.10&quot;, &quot;8.10&quot;);
        assertVendorVersionFromGenericLine(&quot;8.10.1&quot;, &quot;8.10.1&quot;);
        assertVendorVersionFromGenericLine(&quot;buster/sid&quot;, &quot;&quot;);
        assertVendorVersionFromGenericLine(&quot;jessie&quot;, &quot;&quot;);
        assertVendorVersionFromGenericLine(&quot;jessie 8.10&quot;, &quot;8.10&quot;);
        assertVendorVersionFromGenericLine(&quot;9.1 stretch&quot;, &quot;9.1&quot;);
        assertVendorVersionFromGenericLine(&quot;9.1.x&quot;, &quot;9.1.&quot;);
    }

    @Test
    public void testFailedSysCall() {
        // by default sys call filter is enabled, so any Runtime.getRuntime().exec(...) will fail
        List&lt;String&gt; result = SysInfo.sysCall(new String[]{&quot;undefined&quot;}</B></FONT>, &quot;default&quot;);
        assertThat(result.get(0), is(&quot;default&quot;));
    }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>SumAggregationTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Licensed to Crate.io GmbH (&quot;Crate&quot;) under one or more contributor
 * license agreements.  See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.  Crate licenses
 * this file to you under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.  You may
 * obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations
 * under the License.
 *
 * However, if you have executed another commercial license agreement
 * with Crate these terms will supersede the license and you may use the
 * software solely pursuant to the terms of the relevant commercial agreement.
 */

package io.crate.execution.engine.aggregation.impl;

import io.crate.execution.engine.aggregation.AggregationFunction;
import io.crate.expression.symbol.Literal;
import io.crate.metadata.FunctionImplementation;
import io.crate.metadata.SearchPath;
import io.crate.metadata.functions.Signature;
import io.crate.operation.aggregation.AggregationTestCase;
import io.crate.types.DataType;
import io.crate.types.DataTypes;

import io.crate.types.NumericType;
import org.elasticsearch.Version;
import org.junit.Test;

import java.math.BigDecimal;
import java.util.List;

import static org.hamcrest.Matchers.is;

public class SumAggregationTest extends AggregationTestCase {

<A NAME="4"></A>    private Object executeAggregation(DataType&lt;?&gt; argumentType,
                                      DataType&lt;?&gt; returnType,
                                      Object[][] data) throws Exception {
        return <FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match234954-0.html#4',2,'match234954-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>executeAggregation(
            Signature.aggregate(
                SumAggregation.NAME,
                argumentType.getTypeSignature(),
                returnType.getTypeSignature()
            ),
            data,
            List.of()
        );
    }

    @Test
    public void test_function_implements_doc_values_aggregator_for_numeric_types() {</B></FONT>
        for (var dataType : DataTypes.NUMERIC_PRIMITIVE_TYPES) {
            assertHasDocValueAggregator(SumAggregation.NAME, List.of(dataType));
        }
    }

    @Test
    public void testReturnType() throws Exception {
        DataType&lt;?&gt; type = DataTypes.DOUBLE;
        assertThat(getSum(type).boundSignature().getReturnType(), is(type.getTypeSignature()));

        type = DataTypes.FLOAT;
<A NAME="0"></A>        assertThat(getSum(type).boundSignature().getReturnType(), is(type.getTypeSignature()));

        type = DataTypes.LONG;
        <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match234954-0.html#0',2,'match234954-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertThat(getSum(type).boundSignature().getReturnType(), is(type.getTypeSignature()));
        assertThat(getSum(DataTypes.INTEGER).boundSignature().getReturnType(), is(type.getTypeSignature()));
        assertThat(getSum(DataTypes.SHORT).boundSignature().getReturnType(), is(type.getTypeSignature()));
        assertThat(getSum(DataTypes.BYTE).boundSignature().getReturnType(), is(type.getTypeSignature()));
<A NAME="2"></A>    }

    privat</B></FONT>e FunctionImplementation getSum(DataType&lt;?&gt; type) {
        return <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match234954-0.html#2',2,'match234954-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>nodeCtx.functions().get(
            null,
            &quot;sum&quot;,
            List.of(Literal.of(type, null)),
            SearchPath.pathWithPGCatalogAndDoc()
        );
    }

    @Test
    public void testDouble() throws Exception {
        Object result = executeAggregation</B></FONT>(DataTypes.DOUBLE, DataTypes.DOUBLE, new Object[][]{{0.7d}, {0.3d}});

        assertEquals(1.0d, result);
    }

    @Test
    public void testDoubleSummationWithoutLosingPrecision() throws Exception {
        Object result = executeAggregation(DataTypes.DOUBLE, DataTypes.DOUBLE, new Object[][]{{0.1d}, {0.3d}, {0.2d}});

        assertEquals(0.6d, result);
    }

    @Test
    public void testFloat() throws Exception {
        Object result = executeAggregation(DataTypes.FLOAT, DataTypes.FLOAT, new Object[][]{{0.7f}, {0.3f}});

        assertEquals(1.0f, result);
    }

    @Test
    public void testFloatSummationWithoutLosingPrecision() throws Exception {
        Object[][] rows = new Object[][] { { 0.8f }, { 0.4f }, { 0.2f } };
        Signature signature = Signature.aggregate(
            SumAggregation.NAME,
<A NAME="1"></A>            DataTypes.FLOAT.getTypeSignature(),
            DataTypes.FLOAT.getTypeSignature()
        );
        Object result = <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match234954-0.html#1',2,'match234954-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>executeAggregation(
            signature,
            signature.getArgumentDataTypes(),
            signature.getReturnType().createType(),
            rows,
            false,
            List.of()
        );
        assertThat(result, is(1.4f));
    }

    @Test
    public void testLong() throws Exception {
        Object result = executeAggregation(DataTypes.LONG, DataTypes.LONG, new Object[][]{{7L}, {3L}}</B></FONT>);

        assertEquals(10L, result);
    }

    @Test(expected = ArithmeticException.class)
    public void testLongOverflow() throws Exception {
        executeAggregation(DataTypes.LONG, DataTypes.LONG, new Object[][]{{Long.MAX_VALUE}, {1}});
    }
<A NAME="5"></A>
    @Test(expected = ArithmeticException.class)
    public void testLongUnderflow() throws Exception {
        executeAggregation(DataTypes.LONG, DataTypes.LONG, new Object[][]{{Long.MIN_VALUE}, <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match234954-0.html#5',2,'match234954-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{-1}});
    }

    @Test
    public void testInteger() throws Exception {
        Object result = executeAggregation</B></FONT>(DataTypes.INTEGER, DataTypes.LONG, new Object[][]{{7}, {3}});

        assertEquals(10L, result);
    }

    @Test
    public void testShort() throws Exception {
        Object result = executeAggregation(DataTypes.SHORT, DataTypes.LONG, new Object[][]{{(short) 7}, {(short) 3}});

        assertEquals(10L, result);
    }

    @Test
<A NAME="6"></A>    public void testByte() throws Exception {
        Object result = executeAggregation(DataTypes.BYTE, DataTypes.LONG, new Object[][]{{(byte) 7}, {(byte) 3}});

        <FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match234954-0.html#6',2,'match234954-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertEquals(10L, result);
    }

    @Test
    public void testUnsupportedType() throws Exception {
        expectedException.expect(UnsupportedOperationException.class);
        expectedException.expectMessage(
            &quot;Unknown function: sum(NULL),&quot; +
            &quot; no overload found for matching argument types: (geo_point).&quot;);
        getSum</B></FONT>(DataTypes.GEO_POINT);
    }

    @Test
    public void test_sum_numeric_on_long_non_doc_values_field() {
        //noinspection rawtypes
        Version minNodeVersion = randomBoolean()
            ? Version.CURRENT
            : Version.V_4_0_9;
        var result = execPartialAggregationWithoutDocValues(
            (AggregationFunction) nodeCtx.functions().getQualified(
                NumericSumAggregation.SIGNATURE,
                List.of(DataTypes.NUMERIC),
                DataTypes.NUMERIC
            ), new Object[][]{{1L}, {2L}, {3L}},
            true,
            minNodeVersion

        );
        assertThat(result, is(BigDecimal.valueOf(6)));
    }

    @Test
    public void test_sum_numeric_on_long_non_doc_values_field_with_overflow() {
        //noinspection rawtypes
        Version minNodeVersion = randomBoolean()
            ? Version.CURRENT
            : Version.V_4_0_9;
        var result = execPartialAggregationWithoutDocValues(
            (AggregationFunction) nodeCtx.functions().getQualified(
                NumericSumAggregation.SIGNATURE,
                List.of(DataTypes.NUMERIC),
                DataTypes.NUMERIC
            ), new Object[][]{{Long.MAX_VALUE}, {10L}},
<A NAME="3"></A>            true,
            minNodeVersion
        );
        <FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match234954-0.html#3',2,'match234954-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertThat(result, is(BigDecimal.valueOf(Long.MAX_VALUE).add(BigDecimal.TEN)));
    }

    @Test
    public void test_sum_numeric_on_floating_point_non_doc_values_field() {
        //noinspection rawtypes
        Version minNodeVersion = randomBoolean()</B></FONT>
            ? Version.CURRENT
            : Version.V_4_0_9;
        var result = execPartialAggregationWithoutDocValues(
            (AggregationFunction) nodeCtx.functions().getQualified(
                NumericSumAggregation.SIGNATURE,
                List.of(DataTypes.NUMERIC),
                DataTypes.NUMERIC
            ), new Object[][]{{1d}, {1d}},
            true,
            minNodeVersion
        );
        assertThat(result, is(BigDecimal.valueOf(2.0)));
    }

    @Test
    public void test_sum_numeric_with_precision_and_scale_on_double_non_doc_values_field() {
        var type = NumericType.of(16, 2);
        var expected = type.implicitCast(12.4357);
        assertThat(expected.toString(), is(&quot;12.44&quot;));

        //noinspection rawtypes
        Version minNodeVersion = randomBoolean()
            ? Version.CURRENT
            : Version.V_4_0_9;
        var result = execPartialAggregationWithoutDocValues(
            (AggregationFunction) nodeCtx.functions().getQualified(
                NumericSumAggregation.SIGNATURE,
                List.of(type),
                DataTypes.NUMERIC
            ),
            new Object[][]{{12d}, {0.4357d}},
            true,
            minNodeVersion
        );
        assertThat(result.toString(), is(expected.toString()));
    }
}
</PRE>
</div>
  </div>
</body>
</html>
