
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 5.970149253731343%, Tokens: 10</h2>
        <div class="column">
            <h3>ribbon-MDEwOlJlcG9zaXRvcnk3NjE2MTU4-flat-ExecutionContext.java</h3>
            <pre><code>1  package com.netflix.loadbalancer.reactive;
2  import com.netflix.client.RetryHandler;
3  import com.netflix.client.config.IClientConfig;
4  import com.netflix.client.config.IClientConfigKey;
5  import java.util.Map;
6  import java.util.concurrent.ConcurrentHashMap;
7  public class ExecutionContext<T> {
8      private final Map<String, Object> context;
9      private final ConcurrentHashMap<Object, ChildContext<T>> subContexts;
10      private final T request;
11      private final IClientConfig requestConfig;
12      private final RetryHandler retryHandler;
13      private final IClientConfig clientConfig;
14      private static class ChildContext<T> extends ExecutionContext<T> {
15          private final ExecutionContext<T> parent;
16          ChildContext(ExecutionContext<T> parent) {
17              super(parent.request, parent.requestConfig, parent.clientConfig, parent.retryHandler, null);
18              this.parent = parent;
19          }
20          @Override
21          public ExecutionContext<T> getGlobalContext() {
22              return parent;
23          }
24      }
25      public ExecutionContext(T request, IClientConfig requestConfig, IClientConfig clientConfig, RetryHandler retryHandler) {
26          this.request = request;
27          this.requestConfig = requestConfig;
28          this.clientConfig = clientConfig;
29          this.context = new ConcurrentHashMap<>();
30          this.subContexts = new ConcurrentHashMap<>();
31          this.retryHandler = retryHandler;
32      }
33      ExecutionContext(T request, IClientConfig requestConfig, IClientConfig clientConfig, RetryHandler retryHandler, ConcurrentHashMap<Object, ChildContext<T>> subContexts) {
34          this.request = request;
35          this.requestConfig = requestConfig;
36          this.clientConfig = clientConfig;
37          this.context = new ConcurrentHashMap<>();
38          this.subContexts = subContexts;
39          this.retryHandler = retryHandler;
40      }
41      ExecutionContext<T> getChildContext(Object obj) {
42          if (subContexts == null) {
43              return null;
44          }
45          ChildContext<T> subContext = subContexts.get(obj);
46          if (subContext == null) {
47              subContext = new ChildContext<T>(this);
48              ChildContext<T> old = subContexts.putIfAbsent(obj, subContext);
49              if (old != null) {
50                  subContext = old;
51              }
52          }
53          return subContext;
<span onclick='openModal()' class='match'>54      }
55      public T getRequest() {
56          return request;
57      }
58      public Object get(String name) {
59          return context.get(name);
60      }
61      public <S> S getClientProperty(IClientConfigKey<S> key) {
</span>62          S value;
63          if (requestConfig != null) {
64              value = requestConfig.get(key);
65              if (value != null) {
66                  return value;
67              }
68          }
69          value = clientConfig.get(key);
70          return value;
71      }
72      public void put(String name, Object value) {
73          context.put(name, value);
74      }
75      public IClientConfig getRequestConfig() {
76          return requestConfig;
77      }
78      public ExecutionContext<T> getGlobalContext() {
79          return this;
80      }
81      public RetryHandler getRetryHandler() {
82          return retryHandler;
83      }
84  }
</code></pre>
        </div>
        <div class="column">
            <h3>ribbon-MDEwOlJlcG9zaXRvcnk3NjE2MTU4-flat-AbstractServerPredicate.java</h3>
            <pre><code>1  package com.netflix.loadbalancer;
2  import java.util.List;
3  import java.util.Random;
4  import java.util.concurrent.atomic.AtomicInteger;
5  import javax.annotation.Nullable;
6  import com.google.common.base.Optional;
7  import com.google.common.base.Predicate;
8  import com.google.common.collect.ImmutableList;
9  import com.google.common.collect.Iterables;
10  import com.google.common.collect.Lists;
11  import com.netflix.client.config.IClientConfig;
12  public abstract class AbstractServerPredicate implements Predicate<PredicateKey> {
13      protected IRule rule;
14      private volatile LoadBalancerStats lbStats;
15      private final Random random = new Random();
16      private final AtomicInteger nextIndex = new AtomicInteger();
17      private final Predicate<Server> serverOnlyPredicate =  new Predicate<Server>() {
18          @Override
19          public boolean apply(@Nullable Server input) {                    
20              return AbstractServerPredicate.this.apply(new PredicateKey(input));
21          }
22      };
23      public static AbstractServerPredicate alwaysTrue() {
24          return new AbstractServerPredicate() {        
25              @Override
26              public boolean apply(@Nullable PredicateKey input) {
27                  return true;
28              }
29          };
30      }
31      public AbstractServerPredicate() {
32      }
33      public AbstractServerPredicate(IRule rule) {
34          this.rule = rule;
35      }
36      @Deprecated
37      public AbstractServerPredicate(IRule rule, IClientConfig clientConfig) {
38          this(rule);
39      }
40      @Deprecated
41      public AbstractServerPredicate(LoadBalancerStats lbStats, IClientConfig clientConfig) {
42          this(lbStats);
43      }
44      public AbstractServerPredicate(LoadBalancerStats lbStats) {
45          this.lbStats = lbStats;
46      }
47      protected LoadBalancerStats getLBStats() {
48          if (lbStats != null) {
49              return lbStats;
50          } else if (rule != null) {
51              ILoadBalancer lb = rule.getLoadBalancer();
52              if (lb instanceof AbstractLoadBalancer) {
53                  LoadBalancerStats stats =  ((AbstractLoadBalancer) lb).getLoadBalancerStats();
54                  setLoadBalancerStats(stats);
55                  return stats;
56              } else {
57                  return null;
58              }
59          } else {
60              return null;
61          }
62      }
63      public void setLoadBalancerStats(LoadBalancerStats stats) {
64          this.lbStats = stats;
<span onclick='openModal()' class='match'>65      }
66      public Predicate<Server> getServerOnlyPredicate() {
67          return serverOnlyPredicate;
68      }
69      public List<Server> getEligibleServers(List<Server> servers) {
70          return getEligibleServers(servers, null);
71      }
72      public List<Server> getEligibleServers(List<Server> servers, Object loadBalancerKey) {
</span>73          if (loadBalancerKey == null) {
74              return ImmutableList.copyOf(Iterables.filter(servers, this.getServerOnlyPredicate()));            
75          } else {
76              List<Server> results = Lists.newArrayList();
77              for (Server server: servers) {
78                  if (this.apply(new PredicateKey(loadBalancerKey, server))) {
79                      results.add(server);
80                  }
81              }
82              return results;            
83          }
84      }
85      private int incrementAndGetModulo(int modulo) {
86          for (;;) {
87              int current = nextIndex.get();
88              int next = (current + 1) % modulo;
89              if (nextIndex.compareAndSet(current, next) && current < modulo)
90                  return current;
91          }
92      }
93      public Optional<Server> chooseRandomlyAfterFiltering(List<Server> servers) {
94          List<Server> eligible = getEligibleServers(servers);
95          if (eligible.size() == 0) {
96              return Optional.absent();
97          }
98          return Optional.of(eligible.get(random.nextInt(eligible.size())));
99      }
100      public Optional<Server> chooseRoundRobinAfterFiltering(List<Server> servers) {
101          List<Server> eligible = getEligibleServers(servers);
102          if (eligible.size() == 0) {
103              return Optional.absent();
104          }
105          return Optional.of(eligible.get(incrementAndGetModulo(eligible.size())));
106      }
107      public Optional<Server> chooseRandomlyAfterFiltering(List<Server> servers, Object loadBalancerKey) {
108          List<Server> eligible = getEligibleServers(servers, loadBalancerKey);
109          if (eligible.size() == 0) {
110              return Optional.absent();
111          }
112          return Optional.of(eligible.get(random.nextInt(eligible.size())));
113      }
114      public Optional<Server> chooseRoundRobinAfterFiltering(List<Server> servers, Object loadBalancerKey) {
115          List<Server> eligible = getEligibleServers(servers, loadBalancerKey);
116          if (eligible.size() == 0) {
117              return Optional.absent();
118          }
119          return Optional.of(eligible.get(incrementAndGetModulo(eligible.size())));
120      }
121      public static AbstractServerPredicate ofKeyPredicate(final Predicate<PredicateKey> p) {
122          return new AbstractServerPredicate() {
123              @Override
124              @edu.umd.cs.findbugs.annotations.SuppressWarnings(value = "NP")
125              public boolean apply(PredicateKey input) {
126                  return p.apply(input);
127              }            
128          };        
129      }
130      public static AbstractServerPredicate ofServerPredicate(final Predicate<Server> p) {
131          return new AbstractServerPredicate() {
132              @Override
133              @edu.umd.cs.findbugs.annotations.SuppressWarnings(value = "NP")
134              public boolean apply(PredicateKey input) {
135                  return p.apply(input.getServer());
136              }            
137          };        
138      }
139  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from ribbon-MDEwOlJlcG9zaXRvcnk3NjE2MTU4-flat-ExecutionContext.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from ribbon-MDEwOlJlcG9zaXRvcnk3NjE2MTU4-flat-AbstractServerPredicate.java</div>
                </div>
                <div class="column column_space"><pre><code>54      }
55      public T getRequest() {
56          return request;
57      }
58      public Object get(String name) {
59          return context.get(name);
60      }
61      public <S> S getClientProperty(IClientConfigKey<S> key) {
</pre></code></div>
                <div class="column column_space"><pre><code>65      }
66      public Predicate<Server> getServerOnlyPredicate() {
67          return serverOnlyPredicate;
68      }
69      public List<Server> getEligibleServers(List<Server> servers) {
70          return getEligibleServers(servers, null);
71      }
72      public List<Server> getEligibleServers(List<Server> servers, Object loadBalancerKey) {
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    