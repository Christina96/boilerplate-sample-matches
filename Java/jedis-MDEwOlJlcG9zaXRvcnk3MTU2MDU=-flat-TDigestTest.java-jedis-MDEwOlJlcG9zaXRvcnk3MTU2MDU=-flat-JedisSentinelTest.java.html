
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 16.299559471365637%, Tokens: 11, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-TDigestTest.java</h3>
            <pre><code>1  package redis.clients.jedis.modules.bloom;
2  import static java.util.Collections.singletonList;
3  import static org.junit.Assert.assertEquals;
4  import java.util.Arrays;
5  import java.util.Map;
6  import java.util.Random;
7  import org.junit.BeforeClass;
8  import org.junit.Test;
9  import redis.clients.jedis.bloom.TDigestMergeParams;
10  import redis.clients.jedis.modules.RedisModuleCommandsTestBase;
11  public class TDigestTest extends RedisModuleCommandsTestBase {
12    private static final Random random = new Random();
13    @BeforeClass
14    public static void prepare() {
15      RedisModuleCommandsTestBase.prepare();
16    }
17    private void assertMergedUnmergedNodes(String key, int mergedNodes, int unmergedNodes) {
18      Map<String, Object> info = client.tdigestInfo(key);
19      assertEquals(Long.valueOf(mergedNodes), info.get("Merged nodes"));
20      assertEquals(Long.valueOf(unmergedNodes), info.get("Unmerged nodes"));
21    }
22    private void assertTotalWeight(String key, long totalWeight) {
23      Map<String, Object> info = client.tdigestInfo(key);
24      assertEquals(totalWeight, (Long) info.get("Merged weight")
25          + (Long) info.get("Unmerged weight"));
26    }
27    @Test
28    public void createSimple() {
29      assertEquals("OK", client.tdigestCreate("td-simple"));
30      Map<String, Object> info = client.tdigestInfo("td-simple");
31      assertEquals(Long.valueOf(100), info.get("Compression"));
32    }
33    @Test
34    public void createAndInfo() {
35      for (int i = 100; i < 1000; i += 100) {
36        String key = "td-" + i;
37        assertEquals("OK", client.tdigestCreate(key, i));
38        Map<String, Object> info = client.tdigestInfo(key);
39        assertEquals(Long.valueOf(i), info.get("Compression"));
40      }
41    }
42    @Test
43    public void reset() {
<span onclick='openModal()' class='match'>44      client.tdigestCreate("reset", 100);
45      assertMergedUnmergedNodes("reset", 0, 0);
46      assertEquals("OK", client.tdigestReset("reset"));
47      assertMergedUnmergedNodes("reset", 0, 0);
48      client.tdigestAdd("reset", randomValue(), randomValue(), randomValue());
49      assertMergedUnmergedNodes("reset", 0, 3);
50      assertEquals("OK", client.tdigestReset("reset"));
</span>51      assertMergedUnmergedNodes("reset", 0, 0);
52    }
53    @Test
54    public void add() {
55      client.tdigestCreate("tdadd", 100);
56      assertEquals("OK", client.tdigestAdd("tdadd", randomValue()));
57      assertMergedUnmergedNodes("tdadd", 0, 1);
58      assertEquals("OK", client.tdigestAdd("tdadd", randomValue(), randomValue(), randomValue(), randomValue()));
59      assertMergedUnmergedNodes("tdadd", 0, 5);
60    }
61    @Test
62    public void merge() {
63      client.tdigestCreate("td2", 100);
64      client.tdigestCreate("td4m", 100);
65      assertEquals("OK", client.tdigestMerge("td2", "td4m"));
66      assertMergedUnmergedNodes("td2", 0, 0);
67      client.tdigestAdd("td2", 1, 1, 1);
68      client.tdigestAdd("td4m", 1, 1);
69      assertEquals("OK", client.tdigestMerge("td2", "td4m"));
70      assertMergedUnmergedNodes("td2", 3, 2);
71    }
72    @Test
73    public void mergeMultiAndParams() {
74      client.tdigestCreate("from1", 100);
75      client.tdigestCreate("from2", 200);
76      client.tdigestAdd("from1", 1d);
77      client.tdigestAdd("from2", weightedValue(1d, 10));
78      assertEquals("OK", client.tdigestMerge("to", "from1", "from2"));
79      assertTotalWeight("to", 11l);
80      assertEquals("OK", client.tdigestMerge(TDigestMergeParams.mergeParams()
81          .compression(50).override(), "to", "from1", "from2"));
82      assertEquals(Long.valueOf(50), client.tdigestInfo("to").get("Compression"));
83    }
84    @Test
85    public void cdf() {
86      client.tdigestCreate("tdcdf", 100);
87      assertEquals(singletonList(Double.NaN), client.tdigestCDF("tdcdf", 50));
88      client.tdigestAdd("tdcdf", 1, 1, 1);
89      client.tdigestAdd("tdcdf", 100, 100);
90      assertEquals(singletonList(0.6), client.tdigestCDF("tdcdf", 50));
91      client.tdigestCDF("tdcdf", 25, 50, 75);
92    }
93    @Test
94    public void quantile() {
95      client.tdigestCreate("tdqnt", 100);
96      assertEquals(singletonList(Double.NaN), client.tdigestQuantile("tdqnt", 0.5));
97      client.tdigestAdd("tdqnt", 1, 1, 1);
98      client.tdigestAdd("tdqnt", 100, 100);
99      assertEquals(singletonList(1.0), client.tdigestQuantile("tdqnt", 0.5));
100    }
101    @Test
102    public void minAndMax() {
103      final String key = "tdmnmx";
104      client.tdigestCreate(key, 100);
105      assertEquals(Double.NaN, client.tdigestMin(key), 0d);
106      assertEquals(Double.NaN, client.tdigestMax(key), 0d);
107      client.tdigestAdd(key, 2);
108      client.tdigestAdd(key, 5);
109      assertEquals(2d, client.tdigestMin(key), 0.01);
110      assertEquals(5d, client.tdigestMax(key), 0.01);
111    }
112    @Test
113    public void trimmedMean() {
114      final String key = "trimmed_mean";
115      client.tdigestCreate(key, 500);
116      for (int i = 0; i < 20; i++) {
117        client.tdigestAdd(key, (double) i);
118      }
119      assertEquals(9.5, client.tdigestTrimmedMean(key, 0.1, 0.9), 0.01);
120      assertEquals(9.5, client.tdigestTrimmedMean(key, 0.0, 1.0), 0.01);
121      assertEquals(4.5, client.tdigestTrimmedMean(key, 0.0, 0.5), 0.01);
122      assertEquals(14.5, client.tdigestTrimmedMean(key, 0.5, 1.0), 0.01);
123    }
124    @Test
125    public void rankCommands() {
126      final String key = "ranks";
127      client.tdigestCreate(key);
128      client.tdigestAdd(key, 2d, 3d, 5d);
129      assertEquals(Arrays.asList(0l, 2l), client.tdigestRank(key, 2d, 4d));
130      assertEquals(Arrays.asList(0l, 1l), client.tdigestRevRank(key, 5d, 4d));
131      assertEquals(Arrays.asList(2d, 3d), client.tdigestByRank(key, 0l, 1l));
132      assertEquals(Arrays.asList(5d, 3d), client.tdigestByRevRank(key, 0l, 1l));
133    }
134    private static double randomValue() {
135      return random.nextDouble() * 10000;
136    }
137    private static double[] weightedValue(double value, int weight) {
138      double[] values = new double[weight];
139      Arrays.fill(values, value);
140      return values;
141    }
142  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-JedisSentinelTest.java</h3>
            <pre><code>1  package redis.clients.jedis;
2  import static org.junit.Assert.assertEquals;
3  import static org.junit.Assert.assertNotEquals;
4  import static org.junit.Assert.assertTrue;
5  import static org.junit.Assert.fail;
6  import java.util.HashMap;
7  import java.util.List;
8  import java.util.Map;
9  import org.junit.After;
10  import org.junit.Before;
11  import org.junit.Test;
12  import redis.clients.jedis.exceptions.JedisDataException;
13  import redis.clients.jedis.util.JedisSentinelTestUtil;
14  public class JedisSentinelTest {
15    private static final String MASTER_NAME = "mymaster";
16    private static final String MONITOR_MASTER_NAME = "mymastermonitor";
17    private static final String REMOVE_MASTER_NAME = "mymasterremove";
18    private static final String FAILOVER_MASTER_NAME = "mymasterfailover";
19    private static final String MASTER_IP = "127.0.0.1";
20    protected static HostAndPort master = HostAndPorts.getRedisServers().get(0);
21    protected static HostAndPort slave = HostAndPorts.getRedisServers().get(4);
22    protected static HostAndPort sentinel = HostAndPorts.getSentinelServers().get(0);
23    protected static HostAndPort sentinelForFailover = HostAndPorts.getSentinelServers().get(2);
24    protected static HostAndPort masterForFailover = HostAndPorts.getRedisServers().get(5);
25    @Before
26    public void setup() throws InterruptedException {
27    }
28    @After
29    public void clear() throws InterruptedException {
30      ensureRemoved(MONITOR_MASTER_NAME);
31      ensureRemoved(REMOVE_MASTER_NAME);
32    }
33    @Test
34    public void sentinel() {
35      Jedis j = new Jedis(sentinel);
36      try {
37        List<Map<String, String>> masters = j.sentinelMasters();
38        boolean inMasters = false;
39        for (Map<String, String> master : masters)
40          if (MASTER_NAME.equals(master.get("name"))) inMasters = true;
41        assertTrue(inMasters);
42        List<String> masterHostAndPort = j.sentinelGetMasterAddrByName(MASTER_NAME);
43        HostAndPort masterFromSentinel = new HostAndPort(masterHostAndPort.get(0),
44            Integer.parseInt(masterHostAndPort.get(1)));
45        assertEquals(master.getPort(), masterFromSentinel.getPort());
46        List<Map<String, String>> slaves = j.sentinelReplicas(MASTER_NAME);
47        assertTrue(!slaves.isEmpty());
48        assertEquals(master.getPort(), Integer.parseInt(slaves.get(0).get("master-port")));
49        assertEquals(Long.valueOf(1), j.sentinelReset(MASTER_NAME));
50        assertEquals(Long.valueOf(0), j.sentinelReset("woof" + MASTER_NAME));
51      } finally {
52        j.close();
53      }
54    }
55    @Test
56    public void sentinelFailover() throws InterruptedException {
57      Jedis j = new Jedis(sentinelForFailover);
58      Jedis j2 = new Jedis(sentinelForFailover);
59      try {
60        List<String> masterHostAndPort = j.sentinelGetMasterAddrByName(FAILOVER_MASTER_NAME);
61        HostAndPort currentMaster = new HostAndPort(masterHostAndPort.get(0),
62            Integer.parseInt(masterHostAndPort.get(1)));
63        JedisSentinelTestUtil.waitForNewPromotedMaster(FAILOVER_MASTER_NAME, j, j2);
64        masterHostAndPort = j.sentinelGetMasterAddrByName(FAILOVER_MASTER_NAME);
65        HostAndPort newMaster = new HostAndPort(masterHostAndPort.get(0),
66            Integer.parseInt(masterHostAndPort.get(1)));
67        assertNotEquals(newMaster, currentMaster);
68      } finally {
69        j.close();
70        j2.close();
71      }
72    }
73    @Test
74    public void sentinelMonitor() {
75      Jedis j = new Jedis(sentinel);
76      try {
77        String result = j.sentinelMonitor(MONITOR_MASTER_NAME, MASTER_IP, master.getPort(), 1);
78        assertEquals("OK", result);
79        try {
80          j.sentinelMonitor(MONITOR_MASTER_NAME, MASTER_IP, master.getPort(), 1);
81          fail();
82        } catch (JedisDataException e) {
83        }
84      } finally {
85        j.close();
86      }
87    }
88    @Test
89    public void sentinelRemove() {
90      Jedis j = new Jedis(sentinel);
91      try {
92        ensureMonitored(sentinel, REMOVE_MASTER_NAME, MASTER_IP, master.getPort(), 1);
93        String result = j.sentinelRemove(REMOVE_MASTER_NAME);
94        assertEquals("OK", result);
95        try {
96          result = j.sentinelRemove(REMOVE_MASTER_NAME);
97          assertNotEquals("OK", result);
98          fail();
99        } catch (JedisDataException e) {
100        }
101      } finally {
102        j.close();
103      }
104    }
105    @Test
106    public void sentinelSet() {
107      Jedis j = new Jedis(sentinel);
108      try {
109        Map<String, String> parameterMap = new HashMap<String, String>();
110        parameterMap.put("down-after-milliseconds", String.valueOf(1234));
111        parameterMap.put("parallel-syncs", String.valueOf(3));
112        parameterMap.put("quorum", String.valueOf(2));
113        j.sentinelSet(MASTER_NAME, parameterMap);
114        List<Map<String, String>> masters = j.sentinelMasters();
115        for (Map<String, String> master : masters) {
<span onclick='openModal()' class='match'>116          if (master.get("name").equals(MASTER_NAME)) {
117            assertEquals(1234, Integer.parseInt(master.get("down-after-milliseconds")));
118            assertEquals(3, Integer.parseInt(master.get("parallel-syncs")));
119            assertEquals(2, Integer.parseInt(master.get("quorum")));
</span>120          }
121        }
122        parameterMap.put("quorum", String.valueOf(1));
123        j.sentinelSet(MASTER_NAME, parameterMap);
124      } finally {
125        j.close();
126      }
127    }
128    private void ensureMonitored(HostAndPort sentinel, String masterName, String ip, int port,
129        int quorum) {
130      Jedis j = new Jedis(sentinel);
131      try {
132        j.sentinelMonitor(masterName, ip, port, quorum);
133      } catch (JedisDataException e) {
134      } finally {
135        j.close();
136      }
137    }
138    private void ensureRemoved(String masterName) {
139      Jedis j = new Jedis(sentinel);
140      try {
141        j.sentinelRemove(masterName);
142      } catch (JedisDataException e) {
143      } finally {
144        j.close();
145      }
146    }
147  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-TDigestTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-JedisSentinelTest.java</div>
                </div>
                <div class="column column_space"><pre><code>44      client.tdigestCreate("reset", 100);
45      assertMergedUnmergedNodes("reset", 0, 0);
46      assertEquals("OK", client.tdigestReset("reset"));
47      assertMergedUnmergedNodes("reset", 0, 0);
48      client.tdigestAdd("reset", randomValue(), randomValue(), randomValue());
49      assertMergedUnmergedNodes("reset", 0, 3);
50      assertEquals("OK", client.tdigestReset("reset"));
</pre></code></div>
                <div class="column column_space"><pre><code>116          if (master.get("name").equals(MASTER_NAME)) {
117            assertEquals(1234, Integer.parseInt(master.get("down-after-milliseconds")));
118            assertEquals(3, Integer.parseInt(master.get("parallel-syncs")));
119            assertEquals(2, Integer.parseInt(master.get("quorum")));
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    