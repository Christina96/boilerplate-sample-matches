
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 19, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-PooledPipeliningTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.unified.pooled;
2  import static org.junit.Assert.assertEquals;
3  import java.util.ArrayList;
4  import java.util.Arrays;
5  import java.util.List;
6  import org.junit.After;
7  import org.junit.AfterClass;
8  import org.junit.Before;
9  import org.junit.BeforeClass;
10  import org.junit.Test;
11  import redis.clients.jedis.JedisPooled;
12  import redis.clients.jedis.Pipeline;
13  import redis.clients.jedis.Response;
14  import redis.clients.jedis.Transaction;
15  import redis.clients.jedis.commands.unified.UnifiedJedisCommandsTestBase;
16  public class PooledPipeliningTest extends UnifiedJedisCommandsTestBase {
17    protected Pipeline pipeline;
18    protected Transaction transaction;
19    @BeforeClass
20    public static void prepare() throws InterruptedException {
21      jedis = PooledCommandsTestHelper.getPooled();
22    }
23    @AfterClass
24    public static void cleanUp() {
25      jedis.close();
26    }
27    @Before
28    public void setUp() {
29      PooledCommandsTestHelper.clearData();
30      pipeline = ((JedisPooled) jedis).pipelined();
31      transaction = jedis.multi();
32    }
33    @After
34    public void tearDown() {
35      pipeline.close();
36      transaction.close();
37    }
38    @Test
39    public void simple() {
40      final int count = 10;
41      int totalCount = 0;
42      for (int i = 0; i &lt; count; i++) {
43        jedis.set(&quot;foo&quot; + i, &quot;bar&quot; + i);
44      }
45      totalCount += count;
46      for (int i = 0; i &lt; count; i++) {
47        jedis.rpush(&quot;foobar&quot; + i, &quot;foo&quot; + i, &quot;bar&quot; + i);
48      }
49      totalCount += count;
50      List&lt;Response&lt;?&gt;&gt; responses = new ArrayList&lt;&gt;(totalCount);
51      List&lt;Object&gt; expected = new ArrayList&lt;&gt;(totalCount);
52      for (int i = 0; i &lt; count; i++) {
53        responses.add(pipeline.get(&quot;foo&quot; + i));
54        expected.add(&quot;bar&quot; + i);
55      }
56      for (int i = 0; i &lt; count; i++) {
57        responses.add(pipeline.lrange(&quot;foobar&quot; + i, 0, -1));
<span onclick='openModal()' class='match'>58        expected.add(Arrays.asList(&quot;foo&quot; + i, &quot;bar&quot; + i));
59      }
60      pipeline.sync();
</span>61      for (int i = 0; i &lt; totalCount; i++) {
62        assertEquals(expected.get(i), responses.get(i).get());
63      }
64    }
65    @Test
66    public void transaction() {
67      final int count = 10;
68      int totalCount = 0;
69      for (int i = 0; i &lt; count; i++) {
70        jedis.set(&quot;foo&quot; + i, &quot;bar&quot; + i);
71      }
72      totalCount += count;
73      for (int i = 0; i &lt; count; i++) {
74        jedis.rpush(&quot;foobar&quot; + i, &quot;foo&quot; + i, &quot;bar&quot; + i);
75      }
76      totalCount += count;
77      List&lt;Object&gt; expected = new ArrayList&lt;&gt;(totalCount);
78      for (int i = 0; i &lt; count; i++) {
79        transaction.get(&quot;foo&quot; + i);
80        expected.add(&quot;bar&quot; + i);
81      }
82      for (int i = 0; i &lt; count; i++) {
83        transaction.lrange(&quot;foobar&quot; + i, 0, -1);
84        expected.add(Arrays.asList(&quot;foo&quot; + i, &quot;bar&quot; + i));
85      }
86      List&lt;Object&gt; responses = transaction.exec();
87      for (int i = 0; i &lt; totalCount; i++) {
88        assertEquals(expected.get(i), responses.get(i));
89      }
90    }
91  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ClusterPipeliningTest.java</h3>
            <pre><code>1  package redis.clients.jedis;
2  import static org.junit.Assert.*;
3  import static redis.clients.jedis.Protocol.CLUSTER_HASHSLOTS;
4  import java.util.*;
5  import org.hamcrest.MatcherAssert;
6  import org.hamcrest.Matchers;
7  import org.junit.After;
8  import org.junit.AfterClass;
9  import org.junit.Before;
10  import org.junit.BeforeClass;
11  import org.junit.Test;
12  import redis.clients.jedis.args.*;
13  import redis.clients.jedis.exceptions.JedisDataException;
14  import redis.clients.jedis.params.*;
15  import redis.clients.jedis.providers.ClusterConnectionProvider;
16  import redis.clients.jedis.resps.GeoRadiusResponse;
17  import redis.clients.jedis.resps.StreamEntry;
18  import redis.clients.jedis.resps.Tuple;
19  import redis.clients.jedis.util.AssertUtil;
20  import redis.clients.jedis.util.JedisClusterTestUtil;
21  import redis.clients.jedis.util.SafeEncoder;
22  public class ClusterPipeliningTest {
23    private static final String LOCAL_IP = &quot;127.0.0.1&quot;;
24    private static final DefaultJedisClientConfig DEFAULT_CLIENT_CONFIG
25        = DefaultJedisClientConfig.builder().password(&quot;cluster&quot;).build();
26    private static Jedis node1;
27    private static Jedis node2;
28    private static Jedis node3;
29    private static HostAndPort nodeInfo1 = HostAndPorts.getClusterServers().get(0);
30    private static HostAndPort nodeInfo2 = HostAndPorts.getClusterServers().get(1);
31    private static HostAndPort nodeInfo3 = HostAndPorts.getClusterServers().get(2);
32    private Set&lt;HostAndPort&gt; nodes = new HashSet&lt;&gt;(Arrays.asList(nodeInfo1, nodeInfo2, nodeInfo3));
33    @BeforeClass
34    public static void setUp() throws InterruptedException {
35      node1 = new Jedis(nodeInfo1);
36      node1.auth(&quot;cluster&quot;);
37      node1.flushAll();
38      node2 = new Jedis(nodeInfo2);
39      node2.auth(&quot;cluster&quot;);
40      node2.flushAll();
41      node3 = new Jedis(nodeInfo3);
42      node3.auth(&quot;cluster&quot;);
43      node3.flushAll();
44      node1.clusterMeet(LOCAL_IP, nodeInfo2.getPort());
45      node1.clusterMeet(LOCAL_IP, nodeInfo3.getPort());
46      int slotsPerNode = CLUSTER_HASHSLOTS / 3;
47      int[] node1Slots = new int[slotsPerNode];
48      int[] node2Slots = new int[slotsPerNode + 1];
49      int[] node3Slots = new int[slotsPerNode];
50      for (int i = 0, slot1 = 0, slot2 = 0, slot3 = 0; i &lt; CLUSTER_HASHSLOTS; i++) {
51        if (i &lt; slotsPerNode) {
52          node1Slots[slot1++] = i;
53        } else if (i &gt; slotsPerNode * 2) {
54          node3Slots[slot3++] = i;
55        } else {
56          node2Slots[slot2++] = i;
57        }
58      }
59      node1.clusterAddSlots(node1Slots);
60      node2.clusterAddSlots(node2Slots);
61      node3.clusterAddSlots(node3Slots);
62      JedisClusterTestUtil.waitForClusterReady(node1, node2, node3);
63    }
64    @Before
65    public void prepare() {
66      node1.flushAll();
67      node2.flushAll();
68      node3.flushAll();
69    }
70    @After
71    public void cleanUp() {
72      node1.flushDB();
73      node2.flushDB();
74      node3.flushDB();
75    }
76    @AfterClass
77    public static void tearDown() throws InterruptedException {
78      node1.flushDB();
79      node2.flushDB();
80      node3.flushDB();
81      node1.clusterReset(ClusterResetType.SOFT);
82      node2.clusterReset(ClusterResetType.SOFT);
83      node3.clusterReset(ClusterResetType.SOFT);
84    }
85    @Test
86    public void constructorClientConfig() {
87      try (ClusterPipeline pipe = new ClusterPipeline(nodes, DEFAULT_CLIENT_CONFIG)) {
88        Response&lt;String&gt; r1 = pipe.set(&quot;key1&quot;, &quot;value1&quot;);
89        Response&lt;String&gt; r2 = pipe.set(&quot;key2&quot;, &quot;value2&quot;);
90        Response&lt;String&gt; r3 = pipe.set(&quot;key3&quot;, &quot;value3&quot;);
91        Response&lt;String&gt; r4 = pipe.get(&quot;key1&quot;);
92        Response&lt;String&gt; r5 = pipe.get(&quot;key2&quot;);
93        Response&lt;String&gt; r6 = pipe.get(&quot;key3&quot;);
94        pipe.sync();
95        assertEquals(&quot;OK&quot;, r1.get());
96        assertEquals(&quot;OK&quot;, r2.get());
97        assertEquals(&quot;OK&quot;, r3.get());
98        assertEquals(&quot;value1&quot;, r4.get());
99        assertEquals(&quot;value2&quot;, r5.get());
100        assertEquals(&quot;value3&quot;, r6.get());
101      }
102    }
103    @Test
104    public void constructorPoolConfig() {
105      try (ClusterPipeline pipe = new ClusterPipeline(nodes, DEFAULT_CLIENT_CONFIG, new ConnectionPoolConfig())) {
106        Response&lt;String&gt; r1 = pipe.set(&quot;key1&quot;, &quot;value1&quot;);
107        Response&lt;String&gt; r2 = pipe.set(&quot;key2&quot;, &quot;value2&quot;);
108        Response&lt;String&gt; r3 = pipe.set(&quot;key3&quot;, &quot;value3&quot;);
109        Response&lt;String&gt; r4 = pipe.get(&quot;key1&quot;);
110        Response&lt;String&gt; r5 = pipe.get(&quot;key2&quot;);
111        Response&lt;String&gt; r6 = pipe.get(&quot;key3&quot;);
112        pipe.sync();
113        assertEquals(&quot;OK&quot;, r1.get());
114        assertEquals(&quot;OK&quot;, r2.get());
115        assertEquals(&quot;OK&quot;, r3.get());
116        assertEquals(&quot;value1&quot;, r4.get());
117        assertEquals(&quot;value2&quot;, r5.get());
118        assertEquals(&quot;value3&quot;, r6.get());
119      }
120    }
121    @Test
122    public void constructorConnectionProvider() {
123      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
124          ClusterPipeline pipeline = new ClusterPipeline(provider)) {
125        Response&lt;String&gt; r1 = pipeline.set(&quot;key1&quot;, &quot;value1&quot;);
126        Response&lt;String&gt; r2 = pipeline.set(&quot;key2&quot;, &quot;value2&quot;);
127        Response&lt;String&gt; r3 = pipeline.set(&quot;key3&quot;, &quot;value3&quot;);
128        Response&lt;String&gt; r4 = pipeline.get(&quot;key1&quot;);
129        Response&lt;String&gt; r5 = pipeline.get(&quot;key2&quot;);
130        Response&lt;String&gt; r6 = pipeline.get(&quot;key3&quot;);
131        pipeline.sync();
132        assertEquals(&quot;OK&quot;, r1.get());
133        assertEquals(&quot;OK&quot;, r2.get());
134        assertEquals(&quot;OK&quot;, r3.get());
135        assertEquals(&quot;value1&quot;, r4.get());
136        assertEquals(&quot;value2&quot;, r5.get());
137        assertEquals(&quot;value3&quot;, r6.get());
138      }
139    }
140    @Test
141    public void clusterPipelined() {
142      try (JedisCluster cluster = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG);
143          ClusterPipeline pipeline = cluster.pipelined()) {
144        Response&lt;String&gt; r1 = pipeline.set(&quot;key1&quot;, &quot;value1&quot;);
145        Response&lt;String&gt; r2 = pipeline.set(&quot;key2&quot;, &quot;value2&quot;);
146        Response&lt;String&gt; r3 = pipeline.set(&quot;key3&quot;, &quot;value3&quot;);
147        Response&lt;String&gt; r4 = pipeline.get(&quot;key1&quot;);
148        Response&lt;String&gt; r5 = pipeline.get(&quot;key2&quot;);
149        Response&lt;String&gt; r6 = pipeline.get(&quot;key3&quot;);
150        pipeline.sync();
151        assertEquals(&quot;OK&quot;, r1.get());
152        assertEquals(&quot;OK&quot;, r2.get());
153        assertEquals(&quot;OK&quot;, r3.get());
154        assertEquals(&quot;value1&quot;, r4.get());
155        assertEquals(&quot;value2&quot;, r5.get());
156        assertEquals(&quot;value3&quot;, r6.get());
157      }
158    }
159    @Test
160    public void intermediateSync() {
161      try (JedisCluster cluster = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG);
162          ClusterPipeline pipeline = cluster.pipelined()) {
163        Response&lt;String&gt; r1 = pipeline.set(&quot;key1&quot;, &quot;value1&quot;);
164        Response&lt;String&gt; r2 = pipeline.set(&quot;key2&quot;, &quot;value2&quot;);
165        Response&lt;String&gt; r3 = pipeline.set(&quot;key3&quot;, &quot;value3&quot;);
166        pipeline.sync();
167        assertEquals(&quot;OK&quot;, r1.get());
168        assertEquals(&quot;OK&quot;, r2.get());
169        assertEquals(&quot;OK&quot;, r3.get());
170        Response&lt;String&gt; r4 = pipeline.get(&quot;key1&quot;);
171        Response&lt;String&gt; r5 = pipeline.get(&quot;key2&quot;);
172        Response&lt;String&gt; r6 = pipeline.get(&quot;key3&quot;);
173        pipeline.sync();
174        assertEquals(&quot;value1&quot;, r4.get());
175        assertEquals(&quot;value2&quot;, r5.get());
176        assertEquals(&quot;value3&quot;, r6.get());
177      }
178    }
179    @Test
180    public void intermediateSyncs() {
181      try (JedisCluster cluster = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG);
182          ClusterPipeline pipeline = cluster.pipelined()) {
183        Response&lt;String&gt; r1 = pipeline.set(&quot;key1&quot;, &quot;value1&quot;);
184        Response&lt;String&gt; r2 = pipeline.set(&quot;key2&quot;, &quot;value2&quot;);
185        Response&lt;String&gt; r3 = pipeline.set(&quot;key3&quot;, &quot;value3&quot;);
186        for (int i = 0; i &lt; 100; i++) pipeline.sync();
187        assertEquals(&quot;OK&quot;, r1.get());
188        assertEquals(&quot;OK&quot;, r2.get());
189        assertEquals(&quot;OK&quot;, r3.get());
190        Response&lt;String&gt; r4 = pipeline.get(&quot;key1&quot;);
191        Response&lt;String&gt; r5 = pipeline.get(&quot;key2&quot;);
192        Response&lt;String&gt; r6 = pipeline.get(&quot;key3&quot;);
193        for (int i = 0; i &lt; 100; i++) pipeline.sync();
194        assertEquals(&quot;value1&quot;, r4.get());
195        assertEquals(&quot;value2&quot;, r5.get());
196        assertEquals(&quot;value3&quot;, r6.get());
197      }
198    }
199    @Test
200    public void pipelineResponse() {
201      try (JedisCluster jc = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG)) {
202        jc.set(&quot;string&quot;, &quot;foo&quot;);
203        jc.lpush(&quot;list&quot;, &quot;foo&quot;);
204        jc.hset(&quot;hash&quot;, &quot;foo&quot;, &quot;bar&quot;);
205        jc.zadd(&quot;zset&quot;, 1, &quot;foo&quot;);
206        jc.sadd(&quot;set&quot;, &quot;foo&quot;);
207        jc.setrange(&quot;setrange&quot;, 0, &quot;0123456789&quot;);
208        byte[] bytesForSetRange = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9};
209        jc.setrange(&quot;setrangebytes&quot;.getBytes(), 0, bytesForSetRange);
210      }
211      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
212        ClusterPipeline p = new ClusterPipeline(provider);
213        Response&lt;String&gt; string = p.get(&quot;string&quot;);
214        Response&lt;String&gt; list = p.lpop(&quot;list&quot;);
215        Response&lt;String&gt; hash = p.hget(&quot;hash&quot;, &quot;foo&quot;);
216        Response&lt;List&lt;String&gt;&gt; zset = p.zrange(&quot;zset&quot;, 0, -1);
217        Response&lt;String&gt; set = p.spop(&quot;set&quot;);
218        Response&lt;Boolean&gt; blist = p.exists(&quot;list&quot;);
219        Response&lt;Double&gt; zincrby = p.zincrby(&quot;zset&quot;, 1, &quot;foo&quot;);
220        Response&lt;Long&gt; zcard = p.zcard(&quot;zset&quot;);
221        p.lpush(&quot;list&quot;, &quot;bar&quot;);
222        Response&lt;List&lt;String&gt;&gt; lrange = p.lrange(&quot;list&quot;, 0, -1);
223        Response&lt;Map&lt;String, String&gt;&gt; hgetAll = p.hgetAll(&quot;hash&quot;);
224        p.sadd(&quot;set&quot;, &quot;foo&quot;);
225        Response&lt;Set&lt;String&gt;&gt; smembers = p.smembers(&quot;set&quot;);
226        Response&lt;List&lt;Tuple&gt;&gt; zrangeWithScores = p.zrangeWithScores(&quot;zset&quot;, 0, -1);
227        Response&lt;String&gt; getrange = p.getrange(&quot;setrange&quot;, 1, 3);
228        Response&lt;byte[]&gt; getrangeBytes = p.getrange(&quot;setrangebytes&quot;.getBytes(), 6, 8);
229        p.sync();
230        assertEquals(&quot;foo&quot;, string.get());
231        assertEquals(&quot;foo&quot;, list.get());
232        assertEquals(&quot;bar&quot;, hash.get());
233        assertEquals(&quot;foo&quot;, zset.get().iterator().next());
234        assertEquals(&quot;foo&quot;, set.get());
235        assertEquals(false, blist.get());
236        assertEquals(Double.valueOf(2), zincrby.get());
237        assertEquals(Long.valueOf(1), zcard.get());
238        assertEquals(1, lrange.get().size());
239        assertNotNull(hgetAll.get().get(&quot;foo&quot;));
240        assertEquals(1, smembers.get().size());
241        assertEquals(1, zrangeWithScores.get().size());
242        assertEquals(&quot;123&quot;, getrange.get());
243        byte[] expectedGetRangeBytes = {6, 7, 8};
244        assertArrayEquals(expectedGetRangeBytes, getrangeBytes.get());
245      }
246    }
247    @Test
248    public void pipelineBinarySafeHashCommands() {
249      try (JedisCluster jc = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG)) {
250        jc.hset(&quot;key&quot;.getBytes(), &quot;f1&quot;.getBytes(), &quot;v111&quot;.getBytes());
251        jc.hset(&quot;key&quot;.getBytes(), &quot;f22&quot;.getBytes(), &quot;v2222&quot;.getBytes());
252      }
253      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
254        ClusterPipeline p = new ClusterPipeline(provider);
255        Response&lt;Map&lt;byte[], byte[]&gt;&gt; fmap = p.hgetAll(&quot;key&quot;.getBytes());
256        Response&lt;Set&lt;byte[]&gt;&gt; fkeys = p.hkeys(&quot;key&quot;.getBytes());
257        Response&lt;List&lt;byte[]&gt;&gt; fordered = p.hmget(&quot;key&quot;.getBytes(), &quot;f22&quot;.getBytes(), &quot;f1&quot;.getBytes());
258        Response&lt;List&lt;byte[]&gt;&gt; fvals = p.hvals(&quot;key&quot;.getBytes());
259        p.sync();
260        assertNotNull(fmap.get());
261        Map&lt;byte[], byte[]&gt; map = fmap.get();
262        Set&lt;byte[]&gt; mapKeys = map.keySet();
263        Iterator&lt;byte[]&gt; iterMap = mapKeys.iterator();
264        byte[] firstMapKey = iterMap.next();
265        byte[] secondMapKey = iterMap.next();
266        assertFalse(iterMap.hasNext());
267        verifyHasBothValues(firstMapKey, secondMapKey, &quot;f1&quot;.getBytes(), &quot;f22&quot;.getBytes());
268        byte[] firstMapValue = map.get(firstMapKey);
269        byte[] secondMapValue = map.get(secondMapKey);
270        verifyHasBothValues(firstMapValue, secondMapValue, &quot;v111&quot;.getBytes(), &quot;v2222&quot;.getBytes());
271        assertNotNull(fkeys.get());
272        Iterator&lt;byte[]&gt; iter = fkeys.get().iterator();
273        byte[] firstKey = iter.next();
274        byte[] secondKey = iter.next();
275        assertFalse(iter.hasNext());
276        verifyHasBothValues(firstKey, secondKey, &quot;f1&quot;.getBytes(), &quot;f22&quot;.getBytes());
277        assertNotNull(fordered.get());
278        assertArrayEquals(&quot;v2222&quot;.getBytes(), fordered.get().get(0));
279        assertArrayEquals(&quot;v111&quot;.getBytes(), fordered.get().get(1));
280        assertNotNull(fvals.get());
281        assertEquals(2, fvals.get().size());
282        byte[] firstValue = fvals.get().get(0);
283        byte[] secondValue = fvals.get().get(1);
284        verifyHasBothValues(firstValue, secondValue, &quot;v111&quot;.getBytes(), &quot;v2222&quot;.getBytes());
285      }
286    }
287    private void verifyHasBothValues(byte[] firstKey, byte[] secondKey, byte[] value1, byte[] value2) {
288      assertFalse(Arrays.equals(firstKey, secondKey));
289      assertTrue(Arrays.equals(firstKey, value1) || Arrays.equals(firstKey, value2));
290      assertTrue(Arrays.equals(secondKey, value1) || Arrays.equals(secondKey, value2));
291    }
292    @Test(expected = IllegalStateException.class)
293    public void pipelineResponseWithinPipeline() {
294      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
295        ClusterPipeline p = new ClusterPipeline(provider);
296        Response&lt;String&gt; string = p.get(&quot;string&quot;);
297        string.get();
298        p.sync();
299      }
300    }
301    @Test
302    public void pipelineWithPubSub() {
303      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
304        ClusterPipeline pipelined = new ClusterPipeline(provider);
305        Response&lt;Long&gt; p1 = pipelined.publish(&quot;foo&quot;, &quot;bar&quot;);
306        Response&lt;Long&gt; p2 = pipelined.publish(&quot;foo&quot;.getBytes(), &quot;bar&quot;.getBytes());
307        pipelined.sync();
308        assertEquals(0, p1.get().longValue());
309        assertEquals(0, p2.get().longValue());
310      }
311    }
312    @Test
313    public void canRetrieveUnsetKey() {
314      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
315        ClusterPipeline p = new ClusterPipeline(provider);
316        Response&lt;String&gt; shouldNotExist = p.get(UUID.randomUUID().toString());
317        p.sync();
318        assertNull(shouldNotExist.get());
319      }
320    }
321    @Test
322    public void piplineWithError() {
323      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
324        ClusterPipeline p = new ClusterPipeline(provider);
325        p.set(&quot;foo&quot;, &quot;bar&quot;);
326        Response&lt;Set&lt;String&gt;&gt; error = p.smembers(&quot;foo&quot;);
327        Response&lt;String&gt; r = p.get(&quot;foo&quot;);
328        p.sync();
329        try {
330          error.get();
331          fail();
332        } catch (JedisDataException e) {
333        }
334        assertEquals(r.get(), &quot;bar&quot;);
335      }
336    }
337    @Test
338    public void getSetParams() {
339      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
340      ClusterPipeline p = new ClusterPipeline(provider);
341      Response&lt;String&gt; r1 = p.set(&quot;key1&quot;, &quot;value1&quot;);
342      Response&lt;String&gt; r2 = p.set(&quot;key2&quot;, &quot;value2&quot;);
343      Response&lt;String&gt; r3 = p.set(&quot;key3&quot;, &quot;value3&quot;);
344      Response&lt;String&gt; r4 = p.set(&quot;key3&quot;, &quot;value4&quot;, new SetParams().nx()); 
345      Response&lt;String&gt; r5 = p.get(&quot;key1&quot;);
346      Response&lt;String&gt; r6 = p.get(&quot;key2&quot;);
347      Response&lt;String&gt; r7 = p.get(&quot;key3&quot;);
348      p.sync();
349      assertEquals(&quot;OK&quot;, r1.get());
350      assertEquals(&quot;OK&quot;, r2.get());
351      assertEquals(&quot;OK&quot;, r3.get());
352      assertNull(r4.get());
353      assertEquals(&quot;value1&quot;, r5.get());
354      assertEquals(&quot;value2&quot;, r6.get());
355      assertEquals(&quot;value3&quot;, r7.get());
356    }
357    @Test
358    public void clusterPipelineSort() {
359      List&lt;String&gt; sorted = new ArrayList&lt;&gt;();
360      sorted.add(&quot;1&quot;);
361      sorted.add(&quot;2&quot;);
362      sorted.add(&quot;3&quot;);
363      sorted.add(&quot;4&quot;);
364      sorted.add(&quot;5&quot;);
365      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
366      ClusterPipeline p = new ClusterPipeline(provider);
367      Response&lt;Long&gt; r1 = p.rpush(&quot;key1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;5&quot;, &quot;1&quot;, &quot;4&quot;);
368      Response&lt;List&lt;String&gt;&gt; r2 = p.sort(&quot;key1&quot;);
369      Response&lt;Long&gt; r3 = p.sort(&quot;key1&quot;, &quot;key1&quot;);
370      Response&lt;List&lt;String&gt;&gt; r4 = p.lrange(&quot;key1&quot;, 0, 4);
371      Response&lt;List&lt;String&gt;&gt; r5 = p.sort(&quot;key1&quot;, new SortingParams().limit(0, 2));
372      Response&lt;Long&gt; r6 = p.sort(&quot;key1&quot;, new SortingParams().desc(), &quot;key1&quot;);
373      Response&lt;List&lt;String&gt;&gt; r7 = p.lrange(&quot;key1&quot;, 0, 4);
374      p.sync();
375      assertEquals(Long.valueOf(5), r1.get());
376      assertEquals(sorted, r2.get());
377      assertEquals(Long.valueOf(5), r3.get());
378      assertEquals(sorted, r4.get());
379      assertEquals(2, r5.get().size());
380      assertEquals(Long.valueOf(5), r6.get());
381      Collections.reverse(sorted);
382      assertEquals(sorted, r7.get());
383    }
384    @Test
385    public void clusterPipelineList() {
386      List&lt;String&gt; vals = new ArrayList&lt;&gt;();
387      vals.add(&quot;foobar&quot;);
388      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
389      ClusterPipeline p = new ClusterPipeline(provider);
390      Response&lt;Long&gt; r1 = p.lpush(&quot;my{list}&quot;, &quot;hello&quot;, &quot;hello&quot;, &quot;foo&quot;, &quot;foo&quot;); 
391      Response&lt;Long&gt; r2 = p.rpush(&quot;my{newlist}&quot;, &quot;hello&quot;, &quot;hello&quot;, &quot;foo&quot;, &quot;foo&quot;);  
392      Response&lt;Long&gt; r3 = p.lpos(&quot;my{list}&quot;, &quot;foo&quot;);
393      Response&lt;Long&gt; r4 = p.lpos(&quot;my{list}&quot;, &quot;foo&quot;, new LPosParams().maxlen(1));
394      Response&lt;List&lt;Long&gt;&gt; r5 = p.lpos(&quot;my{list}&quot;, &quot;foo&quot;, new LPosParams().maxlen(1), 2);
395      Response&lt;String&gt; r6 = p.ltrim(&quot;my{list}&quot;, 2, 3); 
396      Response&lt;Long&gt; r7 = p.llen(&quot;my{list}&quot;);
397      Response&lt;String&gt; r8 = p.lindex(&quot;my{list}&quot;, -1);
398      Response&lt;String&gt; r9 = p.lset(&quot;my{list}&quot;, 1, &quot;foobar&quot;); 
399      Response&lt;Long&gt; r10 = p.lrem(&quot;my{list}&quot;, 1, &quot;hello&quot;); 
400      Response&lt;List&lt;String&gt;&gt; r11 = p.lrange(&quot;my{list}&quot;, 0, 10);
401      Response&lt;String&gt; r12 = p.rpop(&quot;my{newlist}&quot;); 
402      Response&lt;List&lt;String&gt;&gt; r13 = p.lpop(&quot;my{list}&quot;, 1); 
403      Response&lt;List&lt;String&gt;&gt; r14 = p.rpop(&quot;my{newlist}&quot;, 2); 
404      Response&lt;Long&gt; r15 = p.linsert(&quot;my{newlist}&quot;, ListPosition.AFTER, &quot;hello&quot;, &quot;world&quot;); 
405      Response&lt;Long&gt; r16 = p.lpushx(&quot;myother{newlist}&quot;, &quot;foo&quot;, &quot;bar&quot;);
406      Response&lt;Long&gt; r17 = p.rpushx(&quot;myother{newlist}&quot;, &quot;foo&quot;, &quot;bar&quot;);
407      Response&lt;String&gt; r18 = p.rpoplpush(&quot;my{newlist}&quot;, &quot;myother{newlist}&quot;);
408      Response&lt;String&gt; r19 = p.lmove(&quot;my{newlist}&quot;, &quot;myother{newlist}&quot;, ListDirection.LEFT, ListDirection.RIGHT);
409      p.sync();
410      assertEquals(Long.valueOf(4), r1.get());
411      assertEquals(Long.valueOf(4), r2.get());
412      assertEquals(Long.valueOf(0), r3.get());
413      assertEquals(Long.valueOf(0), r4.get());
414      assertEquals(1, r5.get().size());
415      assertEquals(&quot;OK&quot;, r6.get());
416      assertEquals(Long.valueOf(2), r7.get());
417      assertEquals(&quot;hello&quot;, r8.get());
418      assertEquals(&quot;OK&quot;, r9.get());
419      assertEquals(Long.valueOf(1), r10.get());
420      assertEquals(vals, r11.get());
421      assertEquals(&quot;foo&quot;, r12.get());
422      assertEquals(vals, r13.get());
423      assertEquals(2, r14.get().size());
424      assertEquals(Long.valueOf(2), r15.get());
425      assertEquals(Long.valueOf(0), r16.get());
426      assertEquals(Long.valueOf(0), r17.get());
427      assertEquals(&quot;world&quot;, r18.get());
428      assertEquals(&quot;hello&quot;, r19.get());
429    }
430    @Test
431    public void clusterPipelineSet() {
432      Set&lt;String&gt; diff = new HashSet&lt;&gt;();
433      diff.add(&quot;bar&quot;);
434      diff.add(&quot;foo&quot;);
435      Set&lt;String&gt; union = new HashSet&lt;&gt;();
436      union.add(&quot;hello&quot;);
437      union.add(&quot;world&quot;);
438      union.add(&quot;bar&quot;);
439      union.add(&quot;foo&quot;);
440      Set&lt;String&gt; inter = new HashSet&lt;&gt;();
441      inter.add(&quot;world&quot;);
442      inter.add(&quot;hello&quot;);
443      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
444      ClusterPipeline p = new ClusterPipeline(provider);
445      Response&lt;Long&gt; r1 = p.sadd(&quot;my{set}&quot;, &quot;hello&quot;, &quot;hello&quot;, &quot;world&quot;, &quot;foo&quot;, &quot;bar&quot;);
446      p.sadd(&quot;mynew{set}&quot;, &quot;hello&quot;, &quot;hello&quot;, &quot;world&quot;);
447      Response&lt;Set&lt;String&gt;&gt; r2 = p.sdiff(&quot;my{set}&quot;, &quot;mynew{set}&quot;);
448      Response&lt;Long&gt; r3 = p.sdiffStore(&quot;diffset{set}&quot;, &quot;my{set}&quot;, &quot;mynew{set}&quot;);
449      Response&lt;Set&lt;String&gt;&gt; r4 = p.smembers(&quot;diffset{set}&quot;);
450      Response&lt;Set&lt;String&gt;&gt; r5 = p.sinter(&quot;my{set}&quot;, &quot;mynew{set}&quot;);
451      Response&lt;Long&gt; r6 = p.sinterstore(&quot;interset{set}&quot;, &quot;my{set}&quot;, &quot;mynew{set}&quot;);
452      Response&lt;Set&lt;String&gt;&gt; r7 = p.smembers(&quot;interset{set}&quot;);
453      Response&lt;Set&lt;String&gt;&gt; r8 = p.sunion(&quot;my{set}&quot;, &quot;mynew{set}&quot;);
454      Response&lt;Long&gt; r9 = p.sunionstore(&quot;unionset{set}&quot;, &quot;my{set}&quot;, &quot;mynew{set}&quot;);
455      Response&lt;Set&lt;String&gt;&gt; r10 = p.smembers(&quot;unionset{set}&quot;);
456      Response&lt;Boolean&gt; r11 = p.sismember(&quot;my{set}&quot;, &quot;foo&quot;);
457      Response&lt;List&lt;Boolean&gt;&gt; r12 = p.smismember(&quot;my{set}&quot;, &quot;foo&quot;, &quot;foobar&quot;);
458      Response&lt;Long&gt; r13 = p.srem(&quot;my{set}&quot;, &quot;foo&quot;);
459      Response&lt;Set&lt;String&gt;&gt; r14 = p.spop(&quot;my{set}&quot;, 1);
460      Response&lt;Long&gt; r15 = p.scard(&quot;my{set}&quot;);
461      Response&lt;String&gt; r16 = p.srandmember(&quot;my{set}&quot;);
462      Response&lt;List&lt;String&gt;&gt; r17 = p.srandmember(&quot;my{set}&quot;, 2);
463      p.sync();
464      assertEquals(Long.valueOf(4), r1.get());
465      assertEquals(diff, r2.get());
466      assertEquals(Long.valueOf(diff.size()), r3.get());
467      assertEquals(diff, r4.get());
468      assertEquals(inter, r5.get());
469      assertEquals(Long.valueOf(inter.size()), r6.get());
470      assertEquals(inter, r7.get());
471      assertEquals(union, r8.get());
472      assertEquals(Long.valueOf(union.size()), r9.get());
473      assertEquals(union, r10.get());
474      assertTrue(r11.get());
475      assertTrue(r12.get().get(0) &amp;&amp; !r12.get().get(1));
476      assertEquals(Long.valueOf(1), r13.get());
477      assertTrue(union.containsAll(r14.get()));
478      assertEquals(Long.valueOf(2), r15.get());
479      assertTrue(union.contains(r16.get()));
480      assertTrue(union.containsAll(r17.get()));
481    }
482    @Test
483    public void clusterPipelineSortedSet() {
484      Map&lt;String, Double&gt; hm = new HashMap&lt;&gt;();
485      hm.put(&quot;a1&quot;, 1d);
486      hm.put(&quot;a2&quot;, 2d);
487      hm.put(&quot;a3&quot;, 3d);
488      Set&lt;String&gt; members = new HashSet&lt;&gt;(hm.keySet());
489      Tuple max = new Tuple(&quot;a3&quot;, 3d);
490      Tuple min = new Tuple(&quot;a1&quot;, 1d);
491      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
492      ClusterPipeline p = new ClusterPipeline(provider);
493      Response&lt;Long&gt; r1 = p.zadd(&quot;myset&quot;, hm);
494      Response&lt;Long&gt; r2 = p.zrank(&quot;myset&quot;, &quot;a3&quot;);
495      Response&lt;Long&gt; r3 = p.zrevrank(&quot;myset&quot;, &quot;a3&quot;);
496      Response&lt;Long&gt; r4 = p.zrem(&quot;myset&quot;, &quot;a1&quot;);
497      Response&lt;Long&gt; r5 = p.zadd(&quot;myset&quot;, 1d, &quot;a1&quot;);
498      Response&lt;Long&gt; r6 = p.zadd(&quot;myotherset&quot;, 2d, &quot;a1&quot;, new ZAddParams().nx());
499      Response&lt;Double&gt; r7 = p.zaddIncr(&quot;myset&quot;, 3d, &quot;a4&quot;, new ZAddParams().xx()); 
500      Response&lt;List&lt;String&gt;&gt; r8 = p.zrevrange(&quot;myset&quot;, 0, 0);
501      Response&lt;List&lt;Tuple&gt;&gt; r9 = p.zrevrangeWithScores(&quot;myset&quot;, 0, 0);
502      Response&lt;String&gt; r10 = p.zrandmember(&quot;myset&quot;);
503      Response&lt;List&lt;String&gt;&gt; r11 = p.zrandmember(&quot;myset&quot;, 2);
504      Response&lt;List&lt;Tuple&gt;&gt; r12 = p.zrandmemberWithScores(&quot;myset&quot;, 1);
505      Response&lt;Double&gt; r13 = p.zscore(&quot;myset&quot;, &quot;a1&quot;);
506      Response&lt;List&lt;Double&gt;&gt; r14 = p.zmscore(&quot;myset&quot;, &quot;a1&quot;, &quot;a2&quot;);
507      Response&lt;Tuple&gt; r15 = p.zpopmax(&quot;myset&quot;);
508      Response&lt;Tuple&gt; r16 = p.zpopmin(&quot;myset&quot;);
509      Response&lt;Long&gt; r17 = p.zcount(&quot;myotherset&quot;, 2, 5);
510      Response&lt;Long&gt; r18 = p.zcount(&quot;myotherset&quot;, &quot;(2&quot;, &quot;5&quot;);
511      p.zadd(&quot;myset&quot;, hm, new ZAddParams().nx()); 
512      Response&lt;List&lt;Tuple&gt;&gt; r19 = p.zpopmax(&quot;myset&quot;, 2);
513      Response&lt;List&lt;Tuple&gt;&gt; r20 = p.zpopmin(&quot;myset&quot;, 1);
514      p.sync();
515      assertEquals(Long.valueOf(3), r1.get());
516      assertEquals(Long.valueOf(2), r2.get());
517      assertEquals(Long.valueOf(0), r3.get());
518      assertEquals(Long.valueOf(1), r4.get());
519      assertEquals(Long.valueOf(1), r5.get());
520      assertEquals(Long.valueOf(1), r6.get());
521      assertNull(r7.get());
522      assertTrue(r8.get().size() == 1 &amp;&amp; r8.get().contains(&quot;a3&quot;));
523      assertTrue(r9.get().size() == 1 &amp;&amp; r9.get().contains(max));
524      assertTrue(members.contains(r10.get()));
525      assertTrue(members.containsAll(r11.get()));
526      assertEquals(1, r12.get().size());
527      assertEquals(Double.valueOf(1), r13.get());
528      assertTrue(hm.values().containsAll(r14.get()));
529      assertEquals(max, r15.get());
530      assertEquals(min, r16.get());
531      assertEquals(Long.valueOf(1), r17.get());
532      assertEquals(Long.valueOf(0), r18.get());
533      assertTrue(r19.get().size() == 2 &amp;&amp; r19.get().contains(max));
534      assertTrue(r20.get().size() == 1 &amp;&amp; r20.get().contains(min));
535    }
536    @Test
537    public void clusterPipelineHash() {
538      Map&lt;String, String&gt; hm = new HashMap&lt;&gt;();
539      hm.put(&quot;field2&quot;, &quot;2&quot;);
540      hm.put(&quot;field3&quot;, &quot;5&quot;);
541      Set&lt;String&gt; keys = new HashSet&lt;&gt;();
542      keys.add(&quot;field2&quot;);
543      List&lt;String&gt; vals = new ArrayList&lt;&gt;();
544      vals.add(&quot;3.5&quot;);
545      List&lt;String&gt; vals2 = new ArrayList&lt;&gt;();
546      vals2.add(&quot;hello&quot;);
547      vals2.add(null);
548      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
549      ClusterPipeline p = new ClusterPipeline(provider);
550      Response&lt;Long&gt; r1 = p.hset(&quot;myhash&quot;, &quot;field1&quot;, &quot;hello&quot;);
551      Response&lt;Long&gt; r2 = p.hsetnx(&quot;myhash&quot;, &quot;field1&quot;, &quot;hello&quot;);
552      Response&lt;String&gt; r3 = p.hget(&quot;myhash&quot;, &quot;field1&quot;);
553      Response&lt;Long&gt; r4 = p.hset(&quot;myotherhash&quot;, hm);
554      Response&lt;String&gt; r5 = p.hmset(&quot;mynewhash&quot;, hm);
555      p.hincrBy(&quot;mynewhash&quot;, &quot;field2&quot;, 1);
556      Response&lt;Double&gt; r6 = p.hincrByFloat(&quot;mynewhash&quot;, &quot;field2&quot;, 0.5);
557      Response&lt;Long&gt; r7 = p.hlen(&quot;myhash&quot;);
558      Response&lt;Long&gt; r8 = p.hdel(&quot;mynewhash&quot;, &quot;field3&quot;);
559      Response&lt;Boolean&gt; r9 = p.hexists(&quot;mynewhash&quot;, &quot;field3&quot;);
560      Response&lt;Set&lt;String&gt;&gt; r10 = p.hkeys(&quot;mynewhash&quot;);
561      Response&lt;List&lt;String&gt;&gt; r11 = p.hvals(&quot;mynewhash&quot;);
562      Response&lt;List&lt;String&gt;&gt; r12 = p.hmget(&quot;myhash&quot;, &quot;field1&quot;, &quot;field2&quot;);
563      Response&lt;String&gt; r13 = p.hrandfield(&quot;myotherhash&quot;);
564      Response&lt;List&lt;String&gt;&gt; r14 = p.hrandfield(&quot;myotherhash&quot;, 4);
565      Response&lt;List&lt;String&gt;&gt; r15 = p.hrandfield(&quot;myotherhash&quot;, -4);
566      Response&lt;Long&gt; r16 = p.hstrlen(&quot;myhash&quot;, &quot;field1&quot;);
567      Response&lt;List&lt;Map.Entry&lt;String, String&gt;&gt;&gt; r17 = p.hrandfieldWithValues(&quot;myotherhash&quot;, 4);
568      Response&lt;List&lt;Map.Entry&lt;String, String&gt;&gt;&gt; r18 = p.hrandfieldWithValues(&quot;myotherhash&quot;, -4);
569      p.sync();
570      assertEquals(Long.valueOf(1), r1.get());
571      assertEquals(Long.valueOf(0), r2.get());
572      assertEquals(&quot;hello&quot;, r3.get());
573      assertEquals(Long.valueOf(2), r4.get());
574      assertEquals(&quot;OK&quot;, r5.get());
575      assertEquals(Double.valueOf(3.5), r6.get());
576      assertEquals(Long.valueOf(1), r7.get());
577      assertEquals(Long.valueOf(1), r8.get());
578      assertFalse(r9.get());
579      assertEquals(keys, r10.get());
580      assertEquals(vals, r11.get());
581      assertEquals(vals2, r12.get());
582      AssertUtil.assertCollectionContains(hm.keySet(), r13.get());
583      assertEquals(2, r14.get().size());
584      assertEquals(4, r15.get().size());
585      assertEquals(Long.valueOf(5), r16.get());
586      assertEquals(2, r17.get().size());
587      assertEquals(4, r18.get().size());
588    }
589    @Test
590    public void clusterPipelineGeo() {
591      Map&lt;String, GeoCoordinate&gt; hm = new HashMap&lt;&gt;();
592      hm.put(&quot;place1&quot;, new GeoCoordinate(2.1909389952632, 41.433791470673));
593      hm.put(&quot;place2&quot;, new GeoCoordinate(2.1873744593677, 41.406342043777));
594      List&lt;GeoCoordinate&gt; values = new ArrayList&lt;&gt;();
595      values.add(new GeoCoordinate(2.19093829393386841, 41.43379028184083523));
596      values.add(new GeoCoordinate(2.18737632036209106, 41.40634178640635099));
597      List&lt;String&gt; hashValues = new ArrayList&lt;&gt;();
598      hashValues.add(&quot;sp3e9yg3kd0&quot;);
599      hashValues.add(&quot;sp3e9cbc3t0&quot;);
600      hashValues.add(null);
601      GeoRadiusParam params = new GeoRadiusParam().withCoord().withHash().withDist();
602      GeoRadiusParam params2 = new GeoRadiusParam().count(1, true);
603      GeoRadiusStoreParam storeParams = new GeoRadiusStoreParam().store(&quot;radius{#}&quot;);
604      GeoRadiusResponse expectedResponse = new GeoRadiusResponse(&quot;place1&quot;.getBytes());
605      expectedResponse.setCoordinate(new GeoCoordinate(2.19093829393386841, 41.43379028184083523));
606      expectedResponse.setDistance(0.0881);
607      expectedResponse.setRawScore(3471609698139488L);
608      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
609      ClusterPipeline p = new ClusterPipeline(provider);
610      Response&lt;Long&gt; r1 = p.geoadd(&quot;barcelona&quot;, hm);
611      p.geoadd(&quot;barcelona{#}&quot;, new GeoAddParams().nx(), hm);
612      Response&lt;Double&gt; r2 = p.geodist(&quot;barcelona&quot;, &quot;place1&quot;, &quot;place2&quot;);
613      Response&lt;Double&gt; r3 = p.geodist(&quot;barcelona&quot;, &quot;place1&quot;, &quot;place2&quot;, GeoUnit.KM);
614      Response&lt;List&lt;String&gt;&gt; r4 = p.geohash(&quot;barcelona&quot;, &quot;place1&quot;, &quot;place2&quot;, &quot;place3&quot;);
615      Response&lt;List&lt;GeoCoordinate&gt;&gt; r5 = p.geopos(&quot;barcelona&quot;, &quot;place1&quot;, &quot;place2&quot;);
616      Response&lt;List&lt;GeoRadiusResponse&gt;&gt; r6 = p.georadius(&quot;barcelona&quot;, 2.191, 41.433, 1000, GeoUnit.M);
617      Response&lt;List&lt;GeoRadiusResponse&gt;&gt; r7 = p.georadiusReadonly(&quot;barcelona&quot;, 2.191, 41.433, 1000, GeoUnit.M);
618      Response&lt;List&lt;GeoRadiusResponse&gt;&gt; r8 = p.georadius(&quot;barcelona&quot;, 2.191, 41.433, 1, GeoUnit.KM, params);
619      Response&lt;List&lt;GeoRadiusResponse&gt;&gt; r9 = p.georadiusReadonly(&quot;barcelona&quot;, 2.191, 41.433, 1, GeoUnit.KM, params);
620      Response&lt;Long&gt; r10 = p.georadiusStore(&quot;barcelona{#}&quot;, 2.191, 41.433, 1000, GeoUnit.M, params2, storeParams);
621      Response&lt;List&lt;String&gt;&gt; r11 = p.zrange(&quot;radius{#}&quot;, 0, -1);
622      Response&lt;List&lt;GeoRadiusResponse&gt;&gt; r12 = p.georadiusByMember(&quot;barcelona&quot;, &quot;place1&quot;, 4, GeoUnit.KM);
623      Response&lt;List&lt;GeoRadiusResponse&gt;&gt; r13 = p.georadiusByMemberReadonly(&quot;barcelona&quot;, &quot;place1&quot;, 4, GeoUnit.KM);
624      Response&lt;List&lt;GeoRadiusResponse&gt;&gt; r14 = p.georadiusByMember(&quot;barcelona&quot;, &quot;place1&quot;, 4, GeoUnit.KM, params2);
625      Response&lt;List&lt;GeoRadiusResponse&gt;&gt; r15 = p.georadiusByMemberReadonly(&quot;barcelona&quot;, &quot;place1&quot;, 4, GeoUnit.KM, params2);
626      Response&lt;Long&gt; r16 = p.georadiusByMemberStore(&quot;barcelona{#}&quot;, &quot;place1&quot;, 4, GeoUnit.KM, params2, storeParams);
627      Response&lt;List&lt;String&gt;&gt; r17 = p.zrange(&quot;radius{#}&quot;, 0, -1);
628      p.sync();
629      assertEquals(Long.valueOf(2), r1.get());
630      assertEquals(Double.valueOf(3067.4157), r2.get());
631      assertEquals(Double.valueOf(3.0674), r3.get());
632      assertEquals(hashValues, r4.get());
633      assertEquals(values, r5.get());
634      assertTrue(r6.get().size() == 1 &amp;&amp; r6.get().get(0).getMemberByString().equals(&quot;place1&quot;));
635      assertTrue(r7.get().size() == 1 &amp;&amp; r7.get().get(0).getMemberByString().equals(&quot;place1&quot;));
636      assertEquals(expectedResponse, r8.get().get(0));
637      assertEquals(expectedResponse, r9.get().get(0));
638      assertEquals(Long.valueOf(1), r10.get());
639      assertTrue(r11.get().size() == 1 &amp;&amp; r11.get().contains(&quot;place1&quot;));
640      assertTrue(r12.get().size() == 2 &amp;&amp; r12.get().get(0).getMemberByString().equals(&quot;place2&quot;));
641      assertTrue(r13.get().size() == 2 &amp;&amp; r13.get().get(0).getMemberByString().equals(&quot;place2&quot;));
642      assertTrue(r14.get().size() == 1 &amp;&amp; r14.get().get(0).getMemberByString().equals(&quot;place2&quot;));
643      assertTrue(r15.get().size() == 1 &amp;&amp; r15.get().get(0).getMemberByString().equals(&quot;place2&quot;));
644      assertEquals(Long.valueOf(1), r16.get());
645      assertTrue(r17.get().size() == 1 &amp;&amp; r17.get().contains(&quot;place2&quot;));
646    }
647    @Test
648    public void clusterPipelineHyperLogLog() {
649      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
650      ClusterPipeline p = new ClusterPipeline(provider);
651      Response&lt;Long&gt; r1 = p.pfadd(&quot;{hll}_1&quot;, &quot;foo&quot;, &quot;bar&quot;, &quot;zap&quot;, &quot;a&quot;);
652      Response&lt;Long&gt; r2 = p.pfadd(&quot;{hll}_2&quot;, &quot;foo&quot;, &quot;bar&quot;, &quot;zap&quot;);
653      Response&lt;Long&gt; r3 = p.pfcount(&quot;{hll}_1&quot;, &quot;{hll}_2&quot;);
654      Response&lt;String&gt; r4 = p.pfmerge(&quot;{hll}3&quot;, &quot;{hll}_1&quot;, &quot;{hll}_2&quot;);
655      Response&lt;Long&gt; r5 = p.pfcount(&quot;{hll}3&quot;);
656      p.sync();
657      assertEquals(Long.valueOf(1), r1.get());
658      assertEquals(Long.valueOf(1), r2.get());
659      assertEquals(Long.valueOf(4), r3.get());
660      assertEquals(&quot;OK&quot;, r4.get());
661      assertEquals(Long.valueOf(4), r5.get());
662    }
663    @Test
664    public void clusterPipelineStringsAndBits() {
665      List&lt;Long&gt; fieldRes = new ArrayList&lt;&gt;();
666      fieldRes.add(1L);
667      fieldRes.add(0L);
668      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
669      ClusterPipeline p = new ClusterPipeline(provider);
670      Response&lt;String&gt; r1 = p.set(&quot;{mykey}&quot;, &quot;foobar&quot;); 
671      p.set(&quot;my{otherkey}&quot;, &quot;foo&quot;);
672      Response&lt;String&gt; r2 = p.substr(&quot;{mykey}&quot;, 0, 2);
673      Response&lt;Long&gt; r3 = p.strlen(&quot;{mykey}&quot;);
674      Response&lt;Long&gt; r4 = p.bitcount(&quot;my{otherkey}&quot;);
675      Response&lt;Long&gt; r5 = p.bitcount(&quot;my{otherkey}&quot;, 1, 1);
676      Response&lt;Long&gt; r6 = p.bitpos(&quot;{mykey}&quot;, true);
677      Response&lt;Long&gt; r7 = p.bitpos(&quot;{mykey}&quot;, false, new BitPosParams(1, 2));
678      Response&lt;List&lt;Long&gt;&gt; r8 = p.bitfield(&quot;mynew{key}&quot;, &quot;INCRBY&quot;, &quot;i5&quot;, &quot;100&quot;, &quot;1&quot;, &quot;GET&quot;, &quot;u4&quot;, &quot;0&quot;);
679      Response&lt;List&lt;Long&gt;&gt; r9 = p.bitfieldReadonly(&quot;hello&quot;, &quot;GET&quot;, &quot;i8&quot;, &quot;17&quot;);
680      p.set(&quot;myother{mykey}&quot;, &quot;abcdef&quot;);
681      Response&lt;Long&gt; r10 = p.bitop(BitOP.AND, &quot;dest{mykey}&quot;, &quot;{mykey}&quot;, &quot;myother{mykey}&quot;);
682      Response&lt;String&gt; r11 = p.get(&quot;dest{mykey}&quot;);
683      Response&lt;Boolean&gt; r12 = p.setbit(&quot;my{otherkey}&quot;, 7, true);
684      Response&lt;Boolean&gt; r13 = p.getbit(&quot;my{otherkey}&quot;, 7);
685      p.sync();
686      assertEquals(&quot;OK&quot;, r1.get());
687      assertEquals(&quot;foo&quot;, r2.get());
688      assertEquals(Long.valueOf(6), r3.get());
689      assertEquals(Long.valueOf(16), r4.get());
690      assertEquals(Long.valueOf(6), r5.get());
691      assertEquals(Long.valueOf(1), r6.get());
692      assertEquals(Long.valueOf(8), r7.get());
693      assertEquals(fieldRes, r8.get());
694      assertEquals(fieldRes.subList(1, 2), r9.get());
695      assertEquals(Long.valueOf(6), r10.get());
696      assertEquals(&quot;`bc`ab&quot;, r11.get());
697      assertFalse(r12.get());
698      assertTrue(r13.get());
699    }
700    @Test
701    public void clusterPipelineStream() {
702      Map&lt;String, String&gt; hm = new HashMap&lt;&gt;();
703      hm.put(&quot;one&quot;, &quot;one&quot;);
704      hm.put(&quot;two&quot;, &quot;two&quot;);
705      hm.put(&quot;three&quot;, &quot;three&quot;);
706      StreamEntryID streamId1 = new StreamEntryID(&quot;1638277876711-0&quot;);
707      StreamEntryID streamId2 = new StreamEntryID(&quot;1638277959731-0&quot;);
708      ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG);
709      ClusterPipeline p = new ClusterPipeline(provider);
710      Response&lt;StreamEntryID&gt; r1 = p.xadd(&quot;mystream&quot;, streamId1, hm);
711      Response&lt;StreamEntryID&gt; r2 = p.xadd(&quot;mystream&quot;, new XAddParams().id(new StreamEntryID(&quot;1638277959731-0&quot;)).maxLen(2).approximateTrimming(), hm);
712      Response&lt;Long&gt; r3 = p.xlen(&quot;mystream&quot;);
713      Response&lt;List&lt;StreamEntry&gt;&gt; r4 = p.xrange(&quot;mystream&quot;, streamId1, streamId2);
714      Response&lt;List&lt;StreamEntry&gt;&gt; r5 = p.xrange(&quot;mystream&quot;, streamId1, streamId2, 1);
715      Response&lt;List&lt;StreamEntry&gt;&gt; r6 = p.xrevrange(&quot;mystream&quot;, streamId2, streamId1);
716      Response&lt;List&lt;StreamEntry&gt;&gt; r7 = p.xrevrange(&quot;mystream&quot;, streamId2, streamId1, 1);
717      Response&lt;String&gt; r8 = p.xgroupCreate(&quot;mystream&quot;, &quot;group&quot;, streamId1, false);
718      Response&lt;String&gt; r9 = p.xgroupSetID(&quot;mystream&quot;, &quot;group&quot;, streamId2);
719      p.sync();
720      assertEquals(streamId1, r1.get());
721      assertEquals(streamId2, r2.get());
722      assertEquals(Long.valueOf(2), r3.get());
723      assertTrue(r4.get().size() == 2
724          &amp;&amp; r4.get().get(0).getID().compareTo(streamId1) == 0
725          &amp;&amp; r4.get().get(1).getID().compareTo(streamId2) == 0);
726      assertTrue(r5.get().size() == 1 &amp;&amp; r5.get().get(0).getID().compareTo(streamId1) == 0);
727      assertTrue(r6.get().size() == 2
728          &amp;&amp; r6.get().get(1).getID().compareTo(streamId1) == 0
729          &amp;&amp; r6.get().get(0).getID().compareTo(streamId2) == 0);
730      assertTrue(r7.get().size() == 1 &amp;&amp; r7.get().get(0).getID().compareTo(streamId2) == 0);
731      assertEquals(&quot;OK&quot;, r8.get());
732      assertEquals(&quot;OK&quot;, r9.get());
733    }
734    @Test
735    public void testEval() {
736      String script = &quot;return &#x27;success!&#x27;&quot;;
737      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
738        ClusterPipeline p = new ClusterPipeline(provider);
739        Response&lt;Object&gt; result = p.eval(script);
740        p.sync();
741        assertEquals(&quot;success!&quot;, result.get());
742      }
743    }
744    @Test
745    public void testEvalWithBinary() {
746      String script = &quot;return &#x27;success!&#x27;&quot;;
747      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
748        ClusterPipeline p = new ClusterPipeline(provider);
749        Response&lt;Object&gt; result = p.eval(SafeEncoder.encode(script));
750        p.sync();
751        assertArrayEquals(SafeEncoder.encode(&quot;success!&quot;), (byte[]) result.get());
752      }
753    }
754    @Test
755    public void testEvalKeyAndArg() {
756      String key = &quot;test&quot;;
757      String arg = &quot;3&quot;;
758      String script = &quot;redis.call(&#x27;INCRBY&#x27;, KEYS[1], ARGV[1]) redis.call(&#x27;INCRBY&#x27;, KEYS[1], ARGV[1])&quot;;
759      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
760        ClusterPipeline p = new ClusterPipeline(provider);
761        p.set(key, &quot;0&quot;);
762        Response&lt;Object&gt; result0 = p.eval(script, Arrays.asList(key), Arrays.asList(arg));
763        p.incr(key);
764        Response&lt;Object&gt; result1 = p.eval(script, Arrays.asList(key), Arrays.asList(arg));
765        Response&lt;String&gt; result2 = p.get(key);
766        p.sync();
767        assertNull(result0.get());
768        assertNull(result1.get());
769        assertEquals(&quot;13&quot;, result2.get());
770      }
771    }
772    @Test
773    public void testEvalKeyAndArgWithBinary() {
774      byte[] bKey = SafeEncoder.encode(&quot;test&quot;);
775      byte[] bArg = SafeEncoder.encode(&quot;3&quot;);
776      byte[] bScript = SafeEncoder.encode(&quot;redis.call(&#x27;INCRBY&#x27;, KEYS[1], ARGV[1]) redis.call(&#x27;INCRBY&#x27;, KEYS[1], ARGV[1])&quot;);
777      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
778        ClusterPipeline bP = new ClusterPipeline(provider);
779        bP.set(bKey, SafeEncoder.encode(&quot;0&quot;));
780        Response&lt;Object&gt; bResult0 = bP.eval(bScript, Arrays.asList(bKey), Arrays.asList(bArg));
781        bP.incr(bKey);
782        Response&lt;Object&gt; bResult1 = bP.eval(bScript, Arrays.asList(bKey), Arrays.asList(bArg));
783        Response&lt;byte[]&gt; bResult2 = bP.get(bKey);
784        bP.sync();
785        assertNull(bResult0.get());
786        assertNull(bResult1.get());
787        assertArrayEquals(SafeEncoder.encode(&quot;13&quot;), bResult2.get());
788      }
789    }
790    @Test
791    public void testEvalNestedLists() {
792      String script = &quot;return { {KEYS[1]} , {2} }&quot;;
793      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
794        ClusterPipeline p = new ClusterPipeline(provider);
795        Response&lt;Object&gt; result = p.eval(script, 1, &quot;key1&quot;);
796        p.sync();
797        List&lt;?&gt; results = (List&lt;?&gt;) result.get();
798        MatcherAssert.assertThat((List&lt;String&gt;) results.get(0), Matchers.hasItem(&quot;key1&quot;));
799        MatcherAssert.assertThat((List&lt;Long&gt;) results.get(1), Matchers.hasItem(2L));
800      }
801    }
802    @Test
803    public void testEvalNestedListsWithBinary() {
804      byte[] bScript = SafeEncoder.encode(&quot;return { {KEYS[1]} , {2} }&quot;);
805      byte[] bKey = SafeEncoder.encode(&quot;key1&quot;);
806      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
807        ClusterPipeline p = new ClusterPipeline(provider);
808        Response&lt;Object&gt; result = p.eval(bScript, 1, bKey);
809        p.sync();
810        List&lt;?&gt; results = (List&lt;?&gt;) result.get();
811        MatcherAssert.assertThat((List&lt;byte[]&gt;) results.get(0), Matchers.hasItem(bKey));
812        MatcherAssert.assertThat((List&lt;Long&gt;) results.get(1), Matchers.hasItem(2L));
813      }
814    }
815    @Test
816    public void testEvalsha() {
817      String script = &quot;return &#x27;success!&#x27;&quot;;
818      String sha1;
819      try (JedisCluster jc = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG)) {
820        sha1 = jc.scriptLoad(script, &quot;sampleKey&quot;);
821        assertTrue(jc.scriptExists(sha1, &quot;sampleKey&quot;));
822      }
823      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
824        ClusterPipeline p = new ClusterPipeline(provider);
825        Response&lt;Object&gt; result = p.evalsha(sha1, 1, &quot;sampleKey&quot;);
826        p.sync();
827        assertEquals(&quot;success!&quot;, result.get());
828      }
829    }
830    @Test
831    public void testEvalshaKeyAndArg() {
832      String key = &quot;test&quot;;
833      String arg = &quot;3&quot;;
834      String script = &quot;redis.call(&#x27;INCRBY&#x27;, KEYS[1], ARGV[1]) redis.call(&#x27;INCRBY&#x27;, KEYS[1], ARGV[1])&quot;;
835      String sha1;
836      try (JedisCluster jc = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG)) {
837        sha1 = jc.scriptLoad(script, key);
838        assertTrue(jc.scriptExists(sha1, key));
839      }
840      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
841        ClusterPipeline p = new ClusterPipeline(provider);
842        p.set(key, &quot;0&quot;);
843        Response&lt;Object&gt; result0 = p.evalsha(sha1, Arrays.asList(key), Arrays.asList(arg));
844        p.incr(key);
845        Response&lt;Object&gt; result1 = p.evalsha(sha1, Arrays.asList(key), Arrays.asList(arg));
846        Response&lt;String&gt; result2 = p.get(key);
847        p.sync();
848        assertNull(result0.get());
849        assertNull(result1.get());
850        assertEquals(&quot;13&quot;, result2.get());
851      }
852    }
853    @Test
854    public void testEvalshaKeyAndArgWithBinary() {
855      byte[] bKey = SafeEncoder.encode(&quot;test&quot;);
856      byte[] bArg = SafeEncoder.encode(&quot;3&quot;);
857      String script = &quot;redis.call(&#x27;INCRBY&#x27;, KEYS[1], ARGV[1]) redis.call(&#x27;INCRBY&#x27;, KEYS[1], ARGV[1])&quot;;
858      byte[] bScript = SafeEncoder.encode(script);
859      byte[] bSha1;
860      try (JedisCluster jc = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG)) {
861        bSha1 = jc.scriptLoad(bScript, bKey);
862        assertTrue(jc.scriptExists(bSha1, bKey));
863      }
864      try (ClusterConnectionProvider provider = new ClusterConnectionProvider(nodes, DEFAULT_CLIENT_CONFIG)) {
865        ClusterPipeline p = new ClusterPipeline(provider);
866        p.set(bKey, SafeEncoder.encode(&quot;0&quot;));
867        Response&lt;Object&gt; result0 = p.evalsha(bSha1, Arrays.asList(bKey), Arrays.asList(bArg));
868        p.incr(bKey);
869        Response&lt;Object&gt; result1 = p.evalsha(bSha1, Arrays.asList(bKey), Arrays.asList(bArg));
870        Response&lt;byte[]&gt; result2 = p.get(bKey);
871        p.sync();
872        assertNull(result0.get());
873        assertNull(result1.get());
874        assertArrayEquals(SafeEncoder.encode(&quot;13&quot;), result2.get());
875      }
876    }
877    @Test
878    public void simple() { 
879      try (JedisCluster jedis = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG)) {
880        final int count = 10;
881        int totalCount = 0;
882        for (int i = 0; i &lt; count; i++) {
883          jedis.set(&quot;foo&quot; + i, &quot;bar&quot; + i);
884        }
885        totalCount += count;
886        for (int i = 0; i &lt; count; i++) {
887          jedis.rpush(&quot;foobar&quot; + i, &quot;foo&quot; + i, &quot;bar&quot; + i);
888        }
889        totalCount += count;
890        List&lt;Response&lt;?&gt;&gt; responses = new ArrayList&lt;&gt;(totalCount);
891        List&lt;Object&gt; expected = new ArrayList&lt;&gt;(totalCount);
892        try (ClusterPipeline pipeline = jedis.pipelined()) {
893          for (int i = 0; i &lt; count; i++) {
894            responses.add(pipeline.get(&quot;foo&quot; + i));
895            expected.add(&quot;bar&quot; + i);
896          }
897          for (int i = 0; i &lt; count; i++) {
898            responses.add(pipeline.lrange(&quot;foobar&quot; + i, 0, -1));
<span onclick='openModal()' class='match'>899            expected.add(Arrays.asList(&quot;foo&quot; + i, &quot;bar&quot; + i));
900          }
901        }
</span>902        for (int i = 0; i &lt; totalCount; i++) {
903          assertEquals(expected.get(i), responses.get(i).get());
904        }
905      }
906    }
907    @Test
908    public void transaction() {
909      try (JedisCluster cluster = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG)) {
910        assertThrows(UnsupportedOperationException.class, () -&gt; cluster.multi());
911      }
912    }
913    @Test(timeout = 10_000L)
914    public void multiple() {
915      final int maxTotal = 100;
916      ConnectionPoolConfig poolConfig = new ConnectionPoolConfig();
917      poolConfig.setMaxTotal(maxTotal);
918      try (JedisCluster cluster = new JedisCluster(nodes, DEFAULT_CLIENT_CONFIG, 5, poolConfig)) {
919        for (int i = 0; i &lt; maxTotal; i++) {
920          assertThreadsCount();
921          String s = Integer.toString(i);
922          try (ClusterPipeline pipeline = cluster.pipelined()) {
923            pipeline.set(s, s);
924            pipeline.sync();
925          }
926          assertThreadsCount();
927        }
928      }
929    }
930    private static void assertThreadsCount() {
931      final ThreadGroup rootGroup = Thread.currentThread().getThreadGroup().getParent();
932      final Thread[] threads = new Thread[rootGroup.activeCount()];
933      rootGroup.enumerate(threads);
934      final int count = (int) Arrays.stream(threads)
935          .filter(thread -&gt; thread != null &amp;&amp; thread.getName() != null
936              &amp;&amp; thread.getName().startsWith(&quot;pool-&quot;))
937          .count();
938      MatcherAssert.assertThat(count, Matchers.lessThanOrEqualTo(20));
939    }
940  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-PooledPipeliningTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ClusterPipeliningTest.java</div>
                </div>
                <div class="column column_space"><pre><code>58        expected.add(Arrays.asList(&quot;foo&quot; + i, &quot;bar&quot; + i));
59      }
60      pipeline.sync();
</pre></code></div>
                <div class="column column_space"><pre><code>899            expected.add(Arrays.asList(&quot;foo&quot; + i, &quot;bar&quot; + i));
900          }
901        }
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    