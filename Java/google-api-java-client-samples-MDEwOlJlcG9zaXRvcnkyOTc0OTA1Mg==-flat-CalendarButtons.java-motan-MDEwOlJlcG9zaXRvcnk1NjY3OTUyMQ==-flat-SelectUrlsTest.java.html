
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 20.276497695852534%, Tokens: 11</h2>
        <div class="column">
            <h3>google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-CalendarButtons.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package com.google.api.services.samples.calendar.appengine.client;
2  import com.google.api.services.samples.calendar.appengine.shared.GwtCalendar;
3  import com.google.gwt.core.client.GWT;
4  import com.google.gwt.event.dom.client.ClickEvent;
5  import com.google.gwt.uibinder.client.UiBinder;
6  import com.google.gwt.uibinder.client.UiField;
7  import com.google.gwt.uibinder.client.UiHandler;
8  import com.google.gwt.user.client.ui.Button;
9  import com.google.gwt.user.client.ui.Composite;
10  import com.google.gwt.user.client.ui.DialogBox;
11  import com.google.gwt.user.client.ui.HorizontalPanel;
</span>12  public class CalendarButtons extends Composite {
13    interface MyUiBinder extends UiBinder<HorizontalPanel, CalendarButtons> {
14    }
15    private static MyUiBinder uiBinder = GWT.create(MyUiBinder.class);
16    @UiField
17    Button deleteButton;
18    @UiField
19    Button updateButton;
20    private final int calendarIndex;
21    private final CalendarGwtSample main;
22    private final GwtCalendar calendar;
23    public CalendarButtons(CalendarGwtSample main, GwtCalendar calendar, int calendarIndex) {
24      this.main = main;
25      this.calendar = calendar;
26      this.calendarIndex = calendarIndex;
27      initWidget(uiBinder.createAndBindUi(this));
28    }
29    @UiHandler("deleteButton")
30    void handleDelete(ClickEvent e) {
31      DialogBox dialogBox = new DialogBox();
32      dialogBox.setAnimationEnabled(true);
33      dialogBox.setText("Are you sure you want to permanently delete the calendar?");
34      DeleteDialogContent content = new DeleteDialogContent(main, dialogBox, calendar, calendarIndex);
35      dialogBox.add(content);
36      dialogBox.show();
37    }
38    @UiHandler("updateButton")
39    void handleUpdate(ClickEvent e) {
40      DialogBox dialogBox = new DialogBox();
41      dialogBox.setAnimationEnabled(true);
42      dialogBox.setText("Update Calendar Title:");
43      UpdateDialogContent content = new UpdateDialogContent(main, dialogBox, calendar, calendarIndex);
44      dialogBox.add(content);
45      dialogBox.show();
46    }
47  }
</code></pre>
        </div>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-SelectUrlsTest.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package com.weibo.api.motan.cluster;
2  import com.weibo.api.motan.cluster.support.ClusterSupport;
3  import com.weibo.api.motan.common.MotanConstants;
4  import com.weibo.api.motan.common.URLParamType;
5  import com.weibo.api.motan.protocol.example.IHello;
6  import com.weibo.api.motan.registry.RegistryService;
7  import com.weibo.api.motan.rpc.URL;
8  import com.weibo.api.motan.util.NetUtils;
9  import junit.framework.Assert;
10  import org.junit.Test;
11  import java.util.ArrayList;
</span>12  import java.util.List;
13  import java.util.Map;
14  import java.util.stream.Collectors;
15  public class SelectUrlsTest {
16      private static int count = 20;
17      private static List<URL> mockRegistryUrls() {
18          URL url1 = new URL("reg_1", "192.168.1.1", 18081, RegistryService.class.getName());
19          List<URL> urls = new ArrayList<>();
20          urls.add(url1);
21          return urls;
22      }
23      private static URL mockRefUrl(){
24          URL refUrl = new URL(MotanConstants.PROTOCOL_MOTAN, NetUtils.getLocalAddress().getHostAddress(), 0, IHello.class.getName());
25          refUrl.addParameter(URLParamType.check.getName(), "false");
26          refUrl.addParameter(URLParamType.maxConnectionPerGroup.getName(), String.valueOf(count * URLParamType.maxClientConnection.getIntValue()));
27          return refUrl;
28      }
29      @Test
30      public void testSelectUrls() {
31          ClusterSupportMask<IHello> clusterSupport = new ClusterSupportMask<>(IHello.class, mockRegistryUrls(), mockRefUrl());
32          List<URL> urls = new ArrayList<>();
33          int notifyCount = 60;
34          urls.addAll(mockUrls(notifyCount, "group1"));
35          urls.addAll(mockUrls(notifyCount, "group2"));
36          List<URL> finalUrls = new ArrayList<>();
37          for (int i = 0; i < 10; i++) {
38              finalUrls.addAll(clusterSupport.selectUrls(clusterSupport.getUrl(), urls));
39          }
40          Map<String, List<URL>> result = finalUrls.stream().collect(Collectors.groupingBy(URL::toSimpleString));
41          Assert.assertEquals(count * 2, result.size());
42      }
43      @Test
44      public void testSelectUrls2() {
45          int notifyCount = 100;
46          checkCount(notifyCount, 60);
47      }
48      public void checkCount(int notifyCount, int split) {
49          ClusterSupportMask<IHello> clusterSupport = new ClusterSupportMask<>(IHello.class, mockRegistryUrls(), mockRefUrl());
50          List<URL> urls = mockUrls(notifyCount, "group1");
51          clusterSupport.selectUrls(clusterSupport.getUrl(), urls.subList(0, split));
52          List<URL> selectUrls = new ArrayList<>();
53          selectUrls.addAll(clusterSupport.selectUrls(clusterSupport.getUrl(), urls));
54          List<URL> addedUrls = new ArrayList<>(selectUrls);
55          addedUrls.retainAll(urls.subList(split, notifyCount));
56          double p = (double)(notifyCount - split) / notifyCount;
57          double z = (addedUrls.size() - p * count) / (Math.sqrt((notifyCount - split) * p * (1 - p)));
58          Assert.assertTrue(Math.abs(z) < 2.7045);
59      }
60      @Test
61      public void testSelectUrls3() {
62          int notifyCount = 60;
63          ClusterSupportMask<IHello> clusterSupport = new ClusterSupportMask<>(IHello.class, mockRegistryUrls(), mockRefUrl());
64          List<URL> urls = mockUrls(notifyCount, "group1");
65          clusterSupport.selectUrls(clusterSupport.getUrl(), urls);
66          List<URL> selectUrls = new ArrayList<>();
67          selectUrls.addAll(clusterSupport.selectUrls(clusterSupport.getUrl(), urls.subList(30, notifyCount)));
68          Assert.assertEquals(count, selectUrls.size());
69      }
70      private List<URL> mockUrls(int size, String group) {
71          List<URL> urls = new ArrayList<>();
72          for (int i = 0; i < size; i++) {
73              URL url = new URL(MotanConstants.PROTOCOL_MOTAN, NetUtils.getLocalAddress().getHostAddress(), i, IHello.class.getName());
74              url.addParameter(URLParamType.nodeType.getName(), MotanConstants.NODE_TYPE_SERVICE);
75              url.addParameter(URLParamType.group.getName(), group);
76              urls.add(url);
77          }
78          return urls;
79      }
80      private static class ClusterSupportMask<T> extends ClusterSupport<T> {
81          public ClusterSupportMask(Class<T> interfaceClass, List<URL> registryUrls, URL refUrl) {
82              super(interfaceClass, registryUrls, refUrl);
83          }
84          @Override
85          public List<URL> selectUrls(URL registryUrl, List<URL> urls) {
86              return super.selectUrls(registryUrl, urls);
87          }
88      }
89  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-CalendarButtons.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-SelectUrlsTest.java</div>
                <div class="column column_space"><pre><code>1  package com.google.api.services.samples.calendar.appengine.client;
2  import com.google.api.services.samples.calendar.appengine.shared.GwtCalendar;
3  import com.google.gwt.core.client.GWT;
4  import com.google.gwt.event.dom.client.ClickEvent;
5  import com.google.gwt.uibinder.client.UiBinder;
6  import com.google.gwt.uibinder.client.UiField;
7  import com.google.gwt.uibinder.client.UiHandler;
8  import com.google.gwt.user.client.ui.Button;
9  import com.google.gwt.user.client.ui.Composite;
10  import com.google.gwt.user.client.ui.DialogBox;
11  import com.google.gwt.user.client.ui.HorizontalPanel;
</pre></code></div>
                <div class="column column_space"><pre><code>1  package com.weibo.api.motan.cluster;
2  import com.weibo.api.motan.cluster.support.ClusterSupport;
3  import com.weibo.api.motan.common.MotanConstants;
4  import com.weibo.api.motan.common.URLParamType;
5  import com.weibo.api.motan.protocol.example.IHello;
6  import com.weibo.api.motan.registry.RegistryService;
7  import com.weibo.api.motan.rpc.URL;
8  import com.weibo.api.motan.util.NetUtils;
9  import junit.framework.Assert;
10  import org.junit.Test;
11  import java.util.ArrayList;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    