
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 26, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AccessControlListCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.hamcrest.MatcherAssert.assertThat;
3  import static org.hamcrest.Matchers.containsString;
4  import static org.hamcrest.Matchers.endsWith;
5  import static org.hamcrest.Matchers.startsWith;
6  import static org.junit.Assert.assertArrayEquals;
7  import static org.junit.Assert.assertEquals;
8  import static org.junit.Assert.assertFalse;
9  import static org.junit.Assert.assertNotNull;
10  import static org.junit.Assert.assertTrue;
11  import static org.junit.Assert.fail;
12  import java.util.Arrays;
13  import java.util.List;
14  import org.hamcrest.Matchers;
15  import org.junit.After;
16  import org.junit.BeforeClass;
17  import org.junit.Test;
18  import redis.clients.jedis.CommandArguments;
19  import redis.clients.jedis.Jedis;
20  import redis.clients.jedis.Protocol;
21  import redis.clients.jedis.Transaction;
22  import redis.clients.jedis.exceptions.JedisAccessControlException;
23  import redis.clients.jedis.exceptions.JedisDataException;
24  import redis.clients.jedis.resps.AccessControlLogEntry;
25  import redis.clients.jedis.resps.AccessControlUser;
26  import redis.clients.jedis.util.RedisVersionUtil;
27  import redis.clients.jedis.util.SafeEncoder;
28  public class AccessControlListCommandsTest extends JedisCommandsTestBase {
29    public static final String USER_NAME = "newuser";
30    public static final String USER_PASSWORD = "secret";
31    @BeforeClass
32    public static void prepare() throws Exception {
33      org.junit.Assume.assumeTrue("Not running ACL test on this version of Redis",
34          RedisVersionUtil.checkRedisMajorVersionNumber(6));
35    }
36    @After
37    @Override
38    public void tearDown() throws Exception {
39      try {
40        jedis.aclDelUser(USER_NAME);
41      } catch (Exception e) { }
42      super.tearDown();
43    }
44    @Test
45    public void aclWhoAmI() {
46      String string = jedis.aclWhoAmI();
47      assertEquals("default", string);
48      byte[] binary = jedis.aclWhoAmIBinary();
49      assertArrayEquals(SafeEncoder.encode("default"), binary);
50    }
51    @Test
52    public void aclListDefault() {
53      assertFalse(jedis.aclList().isEmpty());
54      assertFalse(jedis.aclListBinary().isEmpty());
55    }
56    @Test
57    public void addAndRemoveUser() {
58      int existingUsers = jedis.aclList().size();
59      String status = jedis.aclSetUser(USER_NAME);
60      assertEquals("OK", status);
61      assertEquals(existingUsers + 1, jedis.aclList().size());
62      assertEquals(existingUsers + 1, jedis.aclListBinary().size()); 
63      long count = jedis.aclDelUser(USER_NAME);
64      assertEquals(1, count);
65      assertEquals(existingUsers, jedis.aclList().size());
66      assertEquals(existingUsers, jedis.aclListBinary().size()); 
67    }
68    @Test
69    public void aclUsers() {
70      List<String> users = jedis.aclUsers();
71      assertEquals(2, users.size());
72      assertThat(users, Matchers.hasItem("default"));
73      assertEquals(2, jedis.aclUsersBinary().size()); 
74    }
75    @Test
76    public void aclGetUser() {
77      AccessControlUser userInfo = jedis.aclGetUser("default");
78      assertFalse(userInfo.getFlags().isEmpty());
79      assertEquals(1, userInfo.getPassword().size());
80      assertEquals("+@all", userInfo.getCommands());
81      assertEquals("~*", userInfo.getKeys());
82      jedis.aclSetUser(USER_NAME);
83      userInfo = jedis.aclGetUser(USER_NAME);
84      assertFalse(userInfo.getFlags().isEmpty());
85      assertEquals("off", userInfo.getFlags().get(0));
86      assertTrue(userInfo.getPassword().isEmpty());
87      assertTrue(userInfo.getKeys().isEmpty());
88      jedis.aclSetUser(USER_NAME, "reset", "+@all", "~*", "-@string", "+incr", "-debug",
89        "+debug|digest");
90      userInfo = jedis.aclGetUser(USER_NAME);
91      assertThat(userInfo.getCommands(), containsString("+@all"));
92      assertThat(userInfo.getCommands(), containsString("-@string"));
93      assertThat(userInfo.getCommands(), containsString("+debug|digest"));
94    }
95    @Test
96    public void createUserAndPasswords() {
97      String status = jedis.aclSetUser(USER_NAME, ">" + USER_PASSWORD);
98      assertEquals("OK", status);
99      Jedis jedis2 = new Jedis();
100      try {
101        jedis2.auth(USER_NAME, USER_PASSWORD);
102        fail("Should throw a WRONGPASS exception");
103      } catch (JedisAccessControlException e) {
104        assertThat(e.getMessage(), startsWith("WRONGPASS "));
105      }
106      jedis.aclSetUser(USER_NAME, "on", "+acl");
107      jedis2.auth(USER_NAME, USER_PASSWORD);
108      assertEquals(USER_NAME, jedis2.aclWhoAmI());
109      jedis2.close();
110      try {
111        jedis2.auth(USER_NAME, "wrong-password");
112        fail("Should throw a WRONGPASS exception");
113      } catch (JedisAccessControlException e) {
114        assertThat(e.getMessage(), startsWith("WRONGPASS "));
115      }
116      jedis.aclSetUser(USER_NAME, "<" + USER_PASSWORD);
117      try {
118        jedis2.auth(USER_NAME, USER_PASSWORD);
119        fail("Should throw a WRONGPASS exception");
120      } catch (JedisAccessControlException e) {
121        assertThat(e.getMessage(), startsWith("WRONGPASS "));
122      }
123      jedis.aclDelUser(USER_NAME); 
124      try {
125        jedis2.auth(USER_NAME, "wrong-password");
126        fail("Should throw a WRONGPASS exception");
127      } catch (JedisAccessControlException e) {
128        assertThat(e.getMessage(), startsWith("WRONGPASS "));
129      }
130      jedis2.close();
131    }
132    @Test
133    public void aclSetUserWithAnyPassword() {
134      String status = jedis.aclSetUser(USER_NAME, "nopass");
135      assertEquals("OK", status);
136      status = jedis.aclSetUser(USER_NAME, "on", "+acl");
137      assertEquals("OK", status);
138      Jedis jedis2 = new Jedis();
139      String authResult = jedis2.auth(USER_NAME, "any password");
140      assertEquals("OK", authResult);
141      jedis2.close();
142    }
143    @Test
144    public void aclExcudeSingleCommand() {
145      String status = jedis.aclSetUser(USER_NAME, "nopass");
146      assertEquals("OK", status);
147      status = jedis.aclSetUser(USER_NAME, "on", "+acl");
148      assertEquals("OK", status);
149      status = jedis.aclSetUser(USER_NAME, "allcommands", "allkeys");
150      assertEquals("OK", status);
151      status = jedis.aclSetUser(USER_NAME, "-ping");
152      assertEquals("OK", status);
153      Jedis jedis2 = new Jedis();
154      String authResult = jedis2.auth(USER_NAME, "any password");
155      assertEquals("OK", authResult);
156      jedis2.incr("mycounter");
157      try {
158        jedis2.ping();
159        fail("Should throw a NOPERM exception");
160      } catch (JedisAccessControlException e) {
161        assertThat(e.getMessage(), startsWith("NOPERM "));
162        assertThat(e.getMessage(), endsWith(" has no permissions to run the 'ping' command"));
163      }
164      jedis2.close();
165    }
166    @Test
167    public void aclDryRun() {
168      jedis.aclSetUser(USER_NAME, "nopass", "allkeys", "+set", "-get");
169      assertEquals("OK", jedis.aclDryRun(USER_NAME, "SET", "key", "value"));
170      assertThat(jedis.aclDryRun(USER_NAME, "GET", "key"),
171          endsWith(" has no permissions to run the 'get' command"));
172      assertEquals("OK", jedis.aclDryRun(USER_NAME,
173          new CommandArguments(Protocol.Command.SET).key("ca-key").add("value")));
174      assertThat(jedis.aclDryRun(USER_NAME, new CommandArguments(Protocol.Command.GET).key("ca-key")),
175          endsWith(" has no permissions to run the 'get' command"));
176    }
177    @Test
178    public void aclDryRunBinary() {
179      byte[] username = USER_NAME.getBytes();
180      jedis.aclSetUser(username, "nopass".getBytes(), "allkeys".getBytes(), "+set".getBytes(), "-get".getBytes());
181      assertArrayEquals("OK".getBytes(), jedis.aclDryRunBinary(username,
182          "SET".getBytes(), "key".getBytes(), "value".getBytes()));
183      assertThat(new String(jedis.aclDryRunBinary(username, "GET".getBytes(), "key".getBytes())),
184          endsWith(" has no permissions to run the 'get' command"));
185      assertArrayEquals("OK".getBytes(), jedis.aclDryRunBinary(username,
186          new CommandArguments(Protocol.Command.SET).key("ca-key").add("value")));
187      assertThat(new String(jedis.aclDryRunBinary(username,
188          new CommandArguments(Protocol.Command.GET).key("ca-key"))),
189          endsWith(" has no permissions to run the 'get' command"));
190    }
191    @Test
192    public void aclDelUser() {
193      String statusSetUser = jedis.aclSetUser(USER_NAME);
194      assertEquals("OK", statusSetUser);
195      int before = jedis.aclList().size();
196      assertEquals(1L, jedis.aclDelUser(USER_NAME));
197      int after = jedis.aclList().size();
198      assertEquals(before - 1, after);
199    }
200    @Test
201    public void basicPermissionsTest() {
202      jedis.aclSetUser(USER_NAME, ">" + USER_PASSWORD);
203      jedis.aclSetUser(USER_NAME, "on", "+acl");
204      Jedis jedis2 = new Jedis();
205      jedis2.auth(USER_NAME, USER_PASSWORD);
206      try {
207        jedis2.set("foo", "bar");
208        fail("Should throw a NOPERM exception");
209      } catch (JedisAccessControlException e) {
210        assertThat(e.getMessage(), startsWith("NOPERM "));
211        assertThat(e.getMessage(), endsWith(" has no permissions to run the 'set' command"));
212      }
213      jedis.aclSetUser(USER_NAME, "+set");
214      jedis2.close();
215      jedis2.auth(USER_NAME, USER_PASSWORD);
216      final List<String> nopermKeys = Arrays.asList("NOPERM No permissions to access a key",
217          "NOPERM this user has no permissions to access one of the keys used as arguments");
218      try {
219        jedis2.set("foo", "bar");
220        fail("Should throw a NOPERM exception");
221      } catch (JedisAccessControlException e) {
222        assertThat(e.getMessage(), Matchers.isIn(nopermKeys));
223      }
224      jedis.aclSetUser(USER_NAME, "allcommands", "~foo:*", "~bar:*"); 
225      jedis2.set("foo:1", "a");
226      jedis2.set("bar:2", "b");
227      try {
228        jedis2.set("zap:3", "c");
229        fail("Should throw a NOPERM exception");
230      } catch (JedisAccessControlException e) {
231        assertThat(e.getMessage(), Matchers.isIn(nopermKeys));
232      }
233    }
234    @Test
235    public void aclCatTest() {
236      List<String> categories = jedis.aclCat();
237      assertFalse(categories.isEmpty());
238      List<byte[]> categoriesBinary = jedis.aclCatBinary();
239      assertFalse(categories.isEmpty());
240      assertEquals(categories.size(), categoriesBinary.size());
241      assertFalse(jedis.aclCat("scripting").isEmpty());
242      try {
243        jedis.aclCat("testcategory");
244        fail("Should throw a ERR exception");
245      } catch (Exception e) {
246        assertEquals("ERR Unknown category 'testcategory'", e.getMessage());
247      }
248    }
249    @Test
250    public void aclLogTest() {
251      jedis.aclLogReset();
252      assertTrue(jedis.aclLog().isEmpty());
253      jedis.aclSetUser("antirez", ">foo", "on", "+set", "~object:1234");
254      jedis.aclSetUser("antirez", "+eval", "+multi", "+exec");
255      jedis.auth("antirez", "foo");
256      try {
257        jedis.get("foo");
258        fail("Should have thrown an JedisAccessControlException: user does not have the permission to get(\"foo\")");
259      } catch (JedisAccessControlException e) {
260      }
261      jedis.auth("default", "foobared");
262      List<AccessControlLogEntry> aclEntries = jedis.aclLog();
263      assertEquals("Number of log messages ", 1, aclEntries.size());
264      assertEquals(1, aclEntries.get(0).getCount());
265      assertEquals("antirez", aclEntries.get(0).getUsername());
266      assertEquals("toplevel", aclEntries.get(0).getContext());
267      assertEquals("command", aclEntries.get(0).getReason());
268      assertEquals("get", aclEntries.get(0).getObject());
269      jedis.aclLogReset();
270      assertTrue(jedis.aclLog().isEmpty());
271      jedis.auth("antirez", "foo");
272      for (int i = 0; i < 10; i++) {
273        try {
274          jedis.get("foo");
275          fail("Should have thrown an JedisAccessControlException: user does not have the permission to get(\"foo\")");
276        } catch (JedisAccessControlException e) {
277        }
278      }
279      jedis.auth("default", "foobared");
280      assertEquals("Number of log messages ", 1, jedis.aclLog().size());
281      assertEquals(10, jedis.aclLog().get(0).getCount());
282      assertEquals("get", jedis.aclLog().get(0).getObject());
283      jedis.auth("antirez", "foo");
284      try {
285        jedis.set("somekeynotallowed", "1234");
286        fail("Should have thrown an JedisAccessControlException: user does not have the permission to set(\"somekeynotallowed\", \"1234\")");
287      } catch (JedisAccessControlException e) {
288      }
<span onclick='openModal()' class='match'>289      jedis.auth("default", "foobared");
290      assertEquals("Number of log messages ", 2, jedis.aclLog().size());
291      assertEquals(1, jedis.aclLog().get(0).getCount());
</span>292      assertEquals("somekeynotallowed", jedis.aclLog().get(0).getObject());
293      assertEquals("key", jedis.aclLog().get(0).getReason());
294      jedis.aclLogReset();
295      assertTrue(jedis.aclLog().isEmpty());
296      jedis.auth("antirez", "foo");
297      Transaction t = jedis.multi();
298      t.incr("foo");
299      try {
300        t.exec();
301        fail("Should have thrown an JedisAccessControlException: user does not have the permission to incr(\"foo\")");
302      } catch (Exception e) {
303      }
304      t.close();
305      jedis.auth("default", "foobared");
306      assertEquals("Number of log messages ", 1, jedis.aclLog().size());
307      assertEquals(1, jedis.aclLog().get(0).getCount());
308      assertEquals("multi", jedis.aclLog().get(0).getContext());
309      assertEquals("incr", jedis.aclLog().get(0).getObject());
310      jedis.auth("antirez", "foo");
311      for (int i = 0; i < 5; i++) {
312        try {
313          jedis.incr("foo");
314          fail("Should have thrown an JedisAccessControlException: user does not have the permission to incr(\"foo\")");
315        } catch (JedisAccessControlException e) {
316        }
317      }
318      try {
319        jedis.set("foo-2", "bar");
320        fail("Should have thrown an JedisAccessControlException: user does not have the permission to set(\"foo-2\", \"bar\")");
321      } catch (JedisAccessControlException e) {
322      }
323      jedis.auth("default", "foobared");
324      assertEquals("Number of log messages ", 3, jedis.aclLog().size());
325      assertEquals("Number of log messages ", 2, jedis.aclLog(2).size());
326      assertEquals("Number of log messages ", 3, jedis.aclLogBinary().size());
327      assertEquals("Number of log messages ", 2, jedis.aclLogBinary(2).size());
328      String status = jedis.aclLogReset();
329      assertEquals(status, "OK");
330      jedis.aclDelUser("antirez");
331    }
332    @Test
333    public void aclLogWithEntryID() {
334      try {
335        jedis.auth("wronguser", "wrongpass");
336        fail("wrong user should not passed");
337      } catch (JedisAccessControlException e) {
338      }
339      List<AccessControlLogEntry> aclEntries = jedis.aclLog();
340      assertEquals("Number of log messages ", 1, aclEntries.size());
341      assertEquals(1, aclEntries.get(0).getCount());
342      assertEquals("wronguser", aclEntries.get(0).getUsername());
343      assertEquals("toplevel", aclEntries.get(0).getContext());
344      assertEquals("auth", aclEntries.get(0).getReason());
345      assertEquals("AUTH", aclEntries.get(0).getObject());
346      assertTrue(aclEntries.get(0).getEntryId() >= 0);
347      assertTrue(aclEntries.get(0).getTimestampCreated() > 0);
348      assertEquals(aclEntries.get(0).getTimestampCreated(), aclEntries.get(0).getTimestampLastUpdated());
349      String status = jedis.aclLogReset();
350      assertEquals(status, "OK");
351    }
352    @Test
353    public void aclGenPass() {
354      assertNotNull(jedis.aclGenPass());
355      assertNotNull(jedis.aclGenPassBinary(16));
356      assertNotNull(jedis.aclGenPassBinary(32));
357    }
358    @Test
359    public void aclGenPassBinary() {
360      assertNotNull(jedis.aclGenPassBinary());
361      assertNotNull(jedis.aclGenPassBinary(16));
362      assertNotNull(jedis.aclGenPassBinary(32));
363    }
364    @Test
365    public void aclBinaryCommandsTest() {
366      jedis.aclSetUser(USER_NAME.getBytes());
367      assertNotNull(jedis.aclGetUser(USER_NAME));
368      assertEquals(1L, jedis.aclDelUser(USER_NAME.getBytes()));
369      jedis.aclSetUser(USER_NAME.getBytes(), "reset".getBytes(), "+@all".getBytes(), "~*".getBytes(),
370        "-@string".getBytes(), "+incr".getBytes(), "-debug".getBytes(), "+debug|digest".getBytes(),
371              "resetchannels".getBytes(), "&testchannel:*".getBytes());
372      AccessControlUser userInfo = jedis.aclGetUser(USER_NAME.getBytes());
373      assertThat(userInfo.getCommands(), containsString("+@all"));
374      assertThat(userInfo.getCommands(), containsString("-@string"));
375      assertThat(userInfo.getCommands(), containsString("+debug|digest"));
376      assertEquals("&testchannel:*", userInfo.getChannels());
377      jedis.aclDelUser(USER_NAME.getBytes());
378      jedis.aclSetUser("TEST_USER".getBytes());
379      jedis.aclSetUser("ANOTHER_TEST_USER".getBytes());
380      jedis.aclSetUser("MORE_TEST_USERS".getBytes());
381      assertEquals(3L, jedis.aclDelUser(
382              "TEST_USER".getBytes(),
383              "ANOTHER_TEST_USER".getBytes(),
384              "MORE_TEST_USERS".getBytes()));
385    }
386    @Test
387    public void aclLoadTest() {
388      try {
389        jedis.aclLoad();
390        fail("Should throw a JedisDataException: ERR This Redis instance is not configured to use an ACL file...");
391      } catch (JedisDataException e) {
392        assertThat(e.getMessage(), startsWith("ERR This Redis instance is not configured to use an ACL file."));
393      }
394    }
395    @Test
396    public void aclSaveTest() {
397      try {
398        jedis.aclSave();
399        fail("Should throw a JedisDataException: ERR This Redis instance is not configured to use an ACL file...");
400      } catch (JedisDataException e) {
401        assertThat(e.getMessage(), startsWith("ERR This Redis instance is not configured to use an ACL file."));
402      }
403    }
404  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AccessControlListCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.hamcrest.MatcherAssert.assertThat;
3  import static org.hamcrest.Matchers.containsString;
4  import static org.hamcrest.Matchers.endsWith;
5  import static org.hamcrest.Matchers.startsWith;
6  import static org.junit.Assert.assertArrayEquals;
7  import static org.junit.Assert.assertEquals;
8  import static org.junit.Assert.assertFalse;
9  import static org.junit.Assert.assertNotNull;
10  import static org.junit.Assert.assertTrue;
11  import static org.junit.Assert.fail;
12  import java.util.Arrays;
13  import java.util.List;
14  import org.hamcrest.Matchers;
15  import org.junit.After;
16  import org.junit.BeforeClass;
17  import org.junit.Test;
18  import redis.clients.jedis.CommandArguments;
19  import redis.clients.jedis.Jedis;
20  import redis.clients.jedis.Protocol;
21  import redis.clients.jedis.Transaction;
22  import redis.clients.jedis.exceptions.JedisAccessControlException;
23  import redis.clients.jedis.exceptions.JedisDataException;
24  import redis.clients.jedis.resps.AccessControlLogEntry;
25  import redis.clients.jedis.resps.AccessControlUser;
26  import redis.clients.jedis.util.RedisVersionUtil;
27  import redis.clients.jedis.util.SafeEncoder;
28  public class AccessControlListCommandsTest extends JedisCommandsTestBase {
29    public static final String USER_NAME = "newuser";
30    public static final String USER_PASSWORD = "secret";
31    @BeforeClass
32    public static void prepare() throws Exception {
33      org.junit.Assume.assumeTrue("Not running ACL test on this version of Redis",
34          RedisVersionUtil.checkRedisMajorVersionNumber(6));
35    }
36    @After
37    @Override
38    public void tearDown() throws Exception {
39      try {
40        jedis.aclDelUser(USER_NAME);
41      } catch (Exception e) { }
42      super.tearDown();
43    }
44    @Test
45    public void aclWhoAmI() {
46      String string = jedis.aclWhoAmI();
47      assertEquals("default", string);
48      byte[] binary = jedis.aclWhoAmIBinary();
49      assertArrayEquals(SafeEncoder.encode("default"), binary);
50    }
51    @Test
52    public void aclListDefault() {
53      assertFalse(jedis.aclList().isEmpty());
54      assertFalse(jedis.aclListBinary().isEmpty());
55    }
56    @Test
57    public void addAndRemoveUser() {
58      int existingUsers = jedis.aclList().size();
59      String status = jedis.aclSetUser(USER_NAME);
60      assertEquals("OK", status);
61      assertEquals(existingUsers + 1, jedis.aclList().size());
62      assertEquals(existingUsers + 1, jedis.aclListBinary().size()); 
63      long count = jedis.aclDelUser(USER_NAME);
64      assertEquals(1, count);
65      assertEquals(existingUsers, jedis.aclList().size());
66      assertEquals(existingUsers, jedis.aclListBinary().size()); 
67    }
68    @Test
69    public void aclUsers() {
70      List<String> users = jedis.aclUsers();
71      assertEquals(2, users.size());
72      assertThat(users, Matchers.hasItem("default"));
73      assertEquals(2, jedis.aclUsersBinary().size()); 
74    }
75    @Test
76    public void aclGetUser() {
77      AccessControlUser userInfo = jedis.aclGetUser("default");
78      assertFalse(userInfo.getFlags().isEmpty());
79      assertEquals(1, userInfo.getPassword().size());
80      assertEquals("+@all", userInfo.getCommands());
81      assertEquals("~*", userInfo.getKeys());
82      jedis.aclSetUser(USER_NAME);
83      userInfo = jedis.aclGetUser(USER_NAME);
84      assertFalse(userInfo.getFlags().isEmpty());
85      assertEquals("off", userInfo.getFlags().get(0));
86      assertTrue(userInfo.getPassword().isEmpty());
87      assertTrue(userInfo.getKeys().isEmpty());
88      jedis.aclSetUser(USER_NAME, "reset", "+@all", "~*", "-@string", "+incr", "-debug",
89        "+debug|digest");
90      userInfo = jedis.aclGetUser(USER_NAME);
91      assertThat(userInfo.getCommands(), containsString("+@all"));
92      assertThat(userInfo.getCommands(), containsString("-@string"));
93      assertThat(userInfo.getCommands(), containsString("+debug|digest"));
94    }
95    @Test
96    public void createUserAndPasswords() {
97      String status = jedis.aclSetUser(USER_NAME, ">" + USER_PASSWORD);
98      assertEquals("OK", status);
99      Jedis jedis2 = new Jedis();
100      try {
101        jedis2.auth(USER_NAME, USER_PASSWORD);
102        fail("Should throw a WRONGPASS exception");
103      } catch (JedisAccessControlException e) {
104        assertThat(e.getMessage(), startsWith("WRONGPASS "));
105      }
106      jedis.aclSetUser(USER_NAME, "on", "+acl");
107      jedis2.auth(USER_NAME, USER_PASSWORD);
108      assertEquals(USER_NAME, jedis2.aclWhoAmI());
109      jedis2.close();
110      try {
111        jedis2.auth(USER_NAME, "wrong-password");
112        fail("Should throw a WRONGPASS exception");
113      } catch (JedisAccessControlException e) {
114        assertThat(e.getMessage(), startsWith("WRONGPASS "));
115      }
116      jedis.aclSetUser(USER_NAME, "<" + USER_PASSWORD);
117      try {
118        jedis2.auth(USER_NAME, USER_PASSWORD);
119        fail("Should throw a WRONGPASS exception");
120      } catch (JedisAccessControlException e) {
121        assertThat(e.getMessage(), startsWith("WRONGPASS "));
122      }
123      jedis.aclDelUser(USER_NAME); 
124      try {
125        jedis2.auth(USER_NAME, "wrong-password");
126        fail("Should throw a WRONGPASS exception");
127      } catch (JedisAccessControlException e) {
128        assertThat(e.getMessage(), startsWith("WRONGPASS "));
129      }
130      jedis2.close();
131    }
132    @Test
133    public void aclSetUserWithAnyPassword() {
134      String status = jedis.aclSetUser(USER_NAME, "nopass");
135      assertEquals("OK", status);
136      status = jedis.aclSetUser(USER_NAME, "on", "+acl");
137      assertEquals("OK", status);
138      Jedis jedis2 = new Jedis();
139      String authResult = jedis2.auth(USER_NAME, "any password");
140      assertEquals("OK", authResult);
141      jedis2.close();
142    }
143    @Test
144    public void aclExcudeSingleCommand() {
145      String status = jedis.aclSetUser(USER_NAME, "nopass");
146      assertEquals("OK", status);
147      status = jedis.aclSetUser(USER_NAME, "on", "+acl");
148      assertEquals("OK", status);
149      status = jedis.aclSetUser(USER_NAME, "allcommands", "allkeys");
150      assertEquals("OK", status);
151      status = jedis.aclSetUser(USER_NAME, "-ping");
152      assertEquals("OK", status);
153      Jedis jedis2 = new Jedis();
154      String authResult = jedis2.auth(USER_NAME, "any password");
155      assertEquals("OK", authResult);
156      jedis2.incr("mycounter");
157      try {
158        jedis2.ping();
159        fail("Should throw a NOPERM exception");
160      } catch (JedisAccessControlException e) {
161        assertThat(e.getMessage(), startsWith("NOPERM "));
162        assertThat(e.getMessage(), endsWith(" has no permissions to run the 'ping' command"));
163      }
164      jedis2.close();
165    }
166    @Test
167    public void aclDryRun() {
168      jedis.aclSetUser(USER_NAME, "nopass", "allkeys", "+set", "-get");
169      assertEquals("OK", jedis.aclDryRun(USER_NAME, "SET", "key", "value"));
170      assertThat(jedis.aclDryRun(USER_NAME, "GET", "key"),
171          endsWith(" has no permissions to run the 'get' command"));
172      assertEquals("OK", jedis.aclDryRun(USER_NAME,
173          new CommandArguments(Protocol.Command.SET).key("ca-key").add("value")));
174      assertThat(jedis.aclDryRun(USER_NAME, new CommandArguments(Protocol.Command.GET).key("ca-key")),
175          endsWith(" has no permissions to run the 'get' command"));
176    }
177    @Test
178    public void aclDryRunBinary() {
179      byte[] username = USER_NAME.getBytes();
180      jedis.aclSetUser(username, "nopass".getBytes(), "allkeys".getBytes(), "+set".getBytes(), "-get".getBytes());
181      assertArrayEquals("OK".getBytes(), jedis.aclDryRunBinary(username,
182          "SET".getBytes(), "key".getBytes(), "value".getBytes()));
183      assertThat(new String(jedis.aclDryRunBinary(username, "GET".getBytes(), "key".getBytes())),
184          endsWith(" has no permissions to run the 'get' command"));
185      assertArrayEquals("OK".getBytes(), jedis.aclDryRunBinary(username,
186          new CommandArguments(Protocol.Command.SET).key("ca-key").add("value")));
187      assertThat(new String(jedis.aclDryRunBinary(username,
188          new CommandArguments(Protocol.Command.GET).key("ca-key"))),
189          endsWith(" has no permissions to run the 'get' command"));
190    }
191    @Test
192    public void aclDelUser() {
193      String statusSetUser = jedis.aclSetUser(USER_NAME);
194      assertEquals("OK", statusSetUser);
195      int before = jedis.aclList().size();
196      assertEquals(1L, jedis.aclDelUser(USER_NAME));
197      int after = jedis.aclList().size();
198      assertEquals(before - 1, after);
199    }
200    @Test
201    public void basicPermissionsTest() {
202      jedis.aclSetUser(USER_NAME, ">" + USER_PASSWORD);
203      jedis.aclSetUser(USER_NAME, "on", "+acl");
204      Jedis jedis2 = new Jedis();
205      jedis2.auth(USER_NAME, USER_PASSWORD);
206      try {
207        jedis2.set("foo", "bar");
208        fail("Should throw a NOPERM exception");
209      } catch (JedisAccessControlException e) {
210        assertThat(e.getMessage(), startsWith("NOPERM "));
211        assertThat(e.getMessage(), endsWith(" has no permissions to run the 'set' command"));
212      }
213      jedis.aclSetUser(USER_NAME, "+set");
214      jedis2.close();
215      jedis2.auth(USER_NAME, USER_PASSWORD);
216      final List<String> nopermKeys = Arrays.asList("NOPERM No permissions to access a key",
217          "NOPERM this user has no permissions to access one of the keys used as arguments");
218      try {
219        jedis2.set("foo", "bar");
220        fail("Should throw a NOPERM exception");
221      } catch (JedisAccessControlException e) {
222        assertThat(e.getMessage(), Matchers.isIn(nopermKeys));
223      }
224      jedis.aclSetUser(USER_NAME, "allcommands", "~foo:*", "~bar:*"); 
225      jedis2.set("foo:1", "a");
226      jedis2.set("bar:2", "b");
227      try {
228        jedis2.set("zap:3", "c");
229        fail("Should throw a NOPERM exception");
230      } catch (JedisAccessControlException e) {
231        assertThat(e.getMessage(), Matchers.isIn(nopermKeys));
232      }
233    }
234    @Test
235    public void aclCatTest() {
236      List<String> categories = jedis.aclCat();
237      assertFalse(categories.isEmpty());
238      List<byte[]> categoriesBinary = jedis.aclCatBinary();
239      assertFalse(categories.isEmpty());
240      assertEquals(categories.size(), categoriesBinary.size());
241      assertFalse(jedis.aclCat("scripting").isEmpty());
242      try {
243        jedis.aclCat("testcategory");
244        fail("Should throw a ERR exception");
245      } catch (Exception e) {
246        assertEquals("ERR Unknown category 'testcategory'", e.getMessage());
247      }
248    }
249    @Test
250    public void aclLogTest() {
251      jedis.aclLogReset();
252      assertTrue(jedis.aclLog().isEmpty());
253      jedis.aclSetUser("antirez", ">foo", "on", "+set", "~object:1234");
254      jedis.aclSetUser("antirez", "+eval", "+multi", "+exec");
255      jedis.auth("antirez", "foo");
256      try {
257        jedis.get("foo");
258        fail("Should have thrown an JedisAccessControlException: user does not have the permission to get(\"foo\")");
259      } catch (JedisAccessControlException e) {
260      }
261      jedis.auth("default", "foobared");
262      List<AccessControlLogEntry> aclEntries = jedis.aclLog();
263      assertEquals("Number of log messages ", 1, aclEntries.size());
264      assertEquals(1, aclEntries.get(0).getCount());
265      assertEquals("antirez", aclEntries.get(0).getUsername());
266      assertEquals("toplevel", aclEntries.get(0).getContext());
267      assertEquals("command", aclEntries.get(0).getReason());
268      assertEquals("get", aclEntries.get(0).getObject());
269      jedis.aclLogReset();
270      assertTrue(jedis.aclLog().isEmpty());
271      jedis.auth("antirez", "foo");
272      for (int i = 0; i < 10; i++) {
273        try {
274          jedis.get("foo");
275          fail("Should have thrown an JedisAccessControlException: user does not have the permission to get(\"foo\")");
276        } catch (JedisAccessControlException e) {
277        }
278      }
279      jedis.auth("default", "foobared");
280      assertEquals("Number of log messages ", 1, jedis.aclLog().size());
281      assertEquals(10, jedis.aclLog().get(0).getCount());
282      assertEquals("get", jedis.aclLog().get(0).getObject());
283      jedis.auth("antirez", "foo");
284      try {
285        jedis.set("somekeynotallowed", "1234");
286        fail("Should have thrown an JedisAccessControlException: user does not have the permission to set(\"somekeynotallowed\", \"1234\")");
287      } catch (JedisAccessControlException e) {
288      }
289      jedis.auth("default", "foobared");
290      assertEquals("Number of log messages ", 2, jedis.aclLog().size());
291      assertEquals(1, jedis.aclLog().get(0).getCount());
292      assertEquals("somekeynotallowed", jedis.aclLog().get(0).getObject());
293      assertEquals("key", jedis.aclLog().get(0).getReason());
294      jedis.aclLogReset();
295      assertTrue(jedis.aclLog().isEmpty());
296      jedis.auth("antirez", "foo");
297      Transaction t = jedis.multi();
298      t.incr("foo");
299      try {
300        t.exec();
301        fail("Should have thrown an JedisAccessControlException: user does not have the permission to incr(\"foo\")");
302      } catch (Exception e) {
303      }
304      t.close();
<span onclick='openModal()' class='match'>305      jedis.auth("default", "foobared");
306      assertEquals("Number of log messages ", 1, jedis.aclLog().size());
307      assertEquals(1, jedis.aclLog().get(0).getCount());
</span>308      assertEquals("multi", jedis.aclLog().get(0).getContext());
309      assertEquals("incr", jedis.aclLog().get(0).getObject());
310      jedis.auth("antirez", "foo");
311      for (int i = 0; i < 5; i++) {
312        try {
313          jedis.incr("foo");
314          fail("Should have thrown an JedisAccessControlException: user does not have the permission to incr(\"foo\")");
315        } catch (JedisAccessControlException e) {
316        }
317      }
318      try {
319        jedis.set("foo-2", "bar");
320        fail("Should have thrown an JedisAccessControlException: user does not have the permission to set(\"foo-2\", \"bar\")");
321      } catch (JedisAccessControlException e) {
322      }
323      jedis.auth("default", "foobared");
324      assertEquals("Number of log messages ", 3, jedis.aclLog().size());
325      assertEquals("Number of log messages ", 2, jedis.aclLog(2).size());
326      assertEquals("Number of log messages ", 3, jedis.aclLogBinary().size());
327      assertEquals("Number of log messages ", 2, jedis.aclLogBinary(2).size());
328      String status = jedis.aclLogReset();
329      assertEquals(status, "OK");
330      jedis.aclDelUser("antirez");
331    }
332    @Test
333    public void aclLogWithEntryID() {
334      try {
335        jedis.auth("wronguser", "wrongpass");
336        fail("wrong user should not passed");
337      } catch (JedisAccessControlException e) {
338      }
339      List<AccessControlLogEntry> aclEntries = jedis.aclLog();
340      assertEquals("Number of log messages ", 1, aclEntries.size());
341      assertEquals(1, aclEntries.get(0).getCount());
342      assertEquals("wronguser", aclEntries.get(0).getUsername());
343      assertEquals("toplevel", aclEntries.get(0).getContext());
344      assertEquals("auth", aclEntries.get(0).getReason());
345      assertEquals("AUTH", aclEntries.get(0).getObject());
346      assertTrue(aclEntries.get(0).getEntryId() >= 0);
347      assertTrue(aclEntries.get(0).getTimestampCreated() > 0);
348      assertEquals(aclEntries.get(0).getTimestampCreated(), aclEntries.get(0).getTimestampLastUpdated());
349      String status = jedis.aclLogReset();
350      assertEquals(status, "OK");
351    }
352    @Test
353    public void aclGenPass() {
354      assertNotNull(jedis.aclGenPass());
355      assertNotNull(jedis.aclGenPassBinary(16));
356      assertNotNull(jedis.aclGenPassBinary(32));
357    }
358    @Test
359    public void aclGenPassBinary() {
360      assertNotNull(jedis.aclGenPassBinary());
361      assertNotNull(jedis.aclGenPassBinary(16));
362      assertNotNull(jedis.aclGenPassBinary(32));
363    }
364    @Test
365    public void aclBinaryCommandsTest() {
366      jedis.aclSetUser(USER_NAME.getBytes());
367      assertNotNull(jedis.aclGetUser(USER_NAME));
368      assertEquals(1L, jedis.aclDelUser(USER_NAME.getBytes()));
369      jedis.aclSetUser(USER_NAME.getBytes(), "reset".getBytes(), "+@all".getBytes(), "~*".getBytes(),
370        "-@string".getBytes(), "+incr".getBytes(), "-debug".getBytes(), "+debug|digest".getBytes(),
371              "resetchannels".getBytes(), "&testchannel:*".getBytes());
372      AccessControlUser userInfo = jedis.aclGetUser(USER_NAME.getBytes());
373      assertThat(userInfo.getCommands(), containsString("+@all"));
374      assertThat(userInfo.getCommands(), containsString("-@string"));
375      assertThat(userInfo.getCommands(), containsString("+debug|digest"));
376      assertEquals("&testchannel:*", userInfo.getChannels());
377      jedis.aclDelUser(USER_NAME.getBytes());
378      jedis.aclSetUser("TEST_USER".getBytes());
379      jedis.aclSetUser("ANOTHER_TEST_USER".getBytes());
380      jedis.aclSetUser("MORE_TEST_USERS".getBytes());
381      assertEquals(3L, jedis.aclDelUser(
382              "TEST_USER".getBytes(),
383              "ANOTHER_TEST_USER".getBytes(),
384              "MORE_TEST_USERS".getBytes()));
385    }
386    @Test
387    public void aclLoadTest() {
388      try {
389        jedis.aclLoad();
390        fail("Should throw a JedisDataException: ERR This Redis instance is not configured to use an ACL file...");
391      } catch (JedisDataException e) {
392        assertThat(e.getMessage(), startsWith("ERR This Redis instance is not configured to use an ACL file."));
393      }
394    }
395    @Test
396    public void aclSaveTest() {
397      try {
398        jedis.aclSave();
399        fail("Should throw a JedisDataException: ERR This Redis instance is not configured to use an ACL file...");
400      } catch (JedisDataException e) {
401        assertThat(e.getMessage(), startsWith("ERR This Redis instance is not configured to use an ACL file."));
402      }
403    }
404  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AccessControlListCommandsTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AccessControlListCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>289      jedis.auth("default", "foobared");
290      assertEquals("Number of log messages ", 2, jedis.aclLog().size());
291      assertEquals(1, jedis.aclLog().get(0).getCount());
</pre></code></div>
                <div class="column column_space"><pre><code>305      jedis.auth("default", "foobared");
306      assertEquals("Number of log messages ", 1, jedis.aclLog().size());
307      assertEquals(1, jedis.aclLog().get(0).getCount());
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    