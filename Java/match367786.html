<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for ShardStatsTest.java &amp; GeoJSONUtilsTest.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for ShardStatsTest.java &amp; GeoJSONUtilsTest.java
      </h3>
<h1 align="center">
        24.8%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>ShardStatsTest.java (39.84375%)<th>GeoJSONUtilsTest.java (18.085106%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(81-89)<td><a href="#" name="0">(116-123)</a><td align="center"><font color="#ff0000">16</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(36-47)<td><a href="#" name="1">(153-161)</a><td align="center"><font color="#cf0000">13</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(96-105)<td><a href="#" name="2">(195-209)</a><td align="center"><font color="#bf0000">12</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(48-58)<td><a href="#" name="3">(167-175)</a><td align="center"><font color="#9f0000">10</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>ShardStatsTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 /*
2  * Licensed to Crate.io GmbH ("Crate") under one or more contributor
3  * license agreements.  See the NOTICE file distributed with this work for
4  * additional information regarding copyright ownership.  Crate licenses
5  * this file to you under the Apache License, Version 2.0 (the "License");
6  * you may not use this file except in compliance with the License.  You may
7  * obtain a copy of the License at
8  *
9  *   http://www.apache.org/licenses/LICENSE-2.0
10  *
11  * Unless required by applicable law or agreed to in writing, software
12  * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
13  * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
14  * License for the specific language governing permissions and limitations
15  * under the License.
16  *
17  * However, if you have executed another commercial license agreement
18  * with Crate these terms will supersede the license and you may use the
19  * software solely pursuant to the terms of the relevant commercial agreement.
20  */
21 package io.crate.integrationtests;
22 import org.elasticsearch.test.ESIntegTestCase;
23 import org.junit.Test;
24 import static io.crate.testing.TestingHelpers.printedTable;
25 import static org.hamcrest.Matchers.greaterThanOrEqualTo;
26 import static org.hamcrest.Matchers.is;
27 @ESIntegTestCase.ClusterScope(numDataNodes = 2)
28 public class ShardStatsTest extends SQLIntegrationTestCase {
29 <a name="1"></a>
30     @Test
31     public void testSelectZeroLimit() throws Exception {
32         <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("create table test (col1 int) clustered into 3 shards with (number_of_replicas=0)");
33         ensureGreen();
34         execute("select * from sys.shards limit 0");
35         assertEquals(0L, response.rowCount());
36     }
37     @Test
38     public void testShardSelect() throws Exception {
39         execute("create table test (col1 int) clustered into 3 shards with (number_of_replicas=0)");
40 <a name="3"></a>        ensureGreen();
41         execute</b></font>("select count(*) from sys.shards where table_name='test'");
42         assertEquals(1, <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>response.rowCount());
43         assertEquals(3L, response.rows()[0][0]);
44     }
45     @Test
46     public void testSelectIncludingUnassignedShards() throws Exception {
47         execute("create table locations (id integer primary key, name string) " +
48                 "clustered into 2 shards " +
49                 "with (number_of_replicas=2, \"write.wait_for_active_shards\"=1)");
50         assertBusy</b></font>(() -&gt; {
51             execute("select state, \"primary\", recovery['stage'] from sys.shards where table_name = 'locations' order by state, \"primary\"");
52             assertThat(
53                 printedTable(response.rows()),
54                 is("STARTED| false| DONE\n" +
55                    "STARTED| false| DONE\n" +
56                    "STARTED| true| DONE\n" +
57                    "STARTED| true| DONE\n" +
58                    "UNASSIGNED| false| NULL\n" +
59                    "UNASSIGNED| false| NULL\n")
60             );
61         });
62     }
63     @Test
64     public void testSelectGroupByIncludingUnassignedShards() throws Exception {
65         execute("create table locations (id integer primary key, name string) " +
66                 "clustered into 5 shards " +
67                 "with(number_of_replicas=2 , \"write.wait_for_active_shards\"=1)");
68         ensureYellow();
69 <a name="0"></a>
70         execute("select count(*), state, \"primary\" from sys.shards " +
71                 "group by state, \"primary\" order by state desc");
72         assertThat(<font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>response.rowCount(), greaterThanOrEqualTo(2L));
73         assertEquals(3, response.cols().length);
74         assertThat((Long) response.rows()[0][0], greaterThanOrEqualTo(5L));
75         assertEquals("UNASSIGNED", response.rows()[0][1]);
76         assertEquals(false, response.rows()[0][2]);
77     }
78     @Test
79     public void testSelectCountIncludingUnassignedShards() throws Exception {</b></font>
80         execute("create table locations (id integer primary key, name string) " +
81                 "clustered into 5 shards " +
82                 "with(number_of_replicas=2, \"write.wait_for_active_shards\"=1)");
83 <a name="2"></a>        ensureYellow();
84         execute("select count(*) from sys.shards where table_name='locations'");
85         assertThat(response.rowCount(), <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>is(1L));
86         assertThat((Long) response.rows()[0][0], is(15L));
87     }
88     @Test
89     public void testTableNameBlobTable() throws Exception {
90         execute("create blob table blobs clustered into 2 shards with (number_of_replicas=0)");
91         ensureGreen();
92         execute</b></font>("select schema_name, table_name from sys.shards where table_name = 'blobs'");
93         assertThat(response.rowCount(), is(2L));
94         for (int i = 0; i &lt; response.rowCount(); i++) {
95             assertThat((String) response.rows()[i][0], is("blob"));
96             assertThat((String) response.rows()[i][1], is("blobs"));
97         }
98         execute("create blob table sbolb clustered into 4 shards " +
99             "with (number_of_replicas=0)");
100         ensureYellow();
101         execute("select schema_name, table_name from sys.shards where table_name = 'sbolb'");
102         assertThat(response.rowCount(), is(4L));
103         for (int i = 0; i &lt; response.rowCount(); i++) {
104             assertThat((String) response.rows()[i][0], is("blob"));
105             assertThat((String) response.rows()[i][1], is("sbolb"));
106         }
107         execute("select count(*) from sys.shards " +
108                 "where schema_name='blob' and table_name != 'blobs' " +
109                 "and table_name != 'sbolb'");
110         assertThat(response.rowCount(), is(1L));
111         assertThat((Long) response.rows()[0][0], is(0L));
112     }
113 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>GeoJSONUtilsTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 /*
2  * Licensed to Crate.io GmbH ("Crate") under one or more contributor
3  * license agreements.  See the NOTICE file distributed with this work for
4  * additional information regarding copyright ownership.  Crate licenses
5  * this file to you under the Apache License, Version 2.0 (the "License");
6  * you may not use this file except in compliance with the License.  You may
7  * obtain a copy of the License at
8  *
9  *   http://www.apache.org/licenses/LICENSE-2.0
10  *
11  * Unless required by applicable law or agreed to in writing, software
12  * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
13  * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
14  * License for the specific language governing permissions and limitations
15  * under the License.
16  *
17  * However, if you have executed another commercial license agreement
18  * with Crate these terms will supersede the license and you may use the
19  * software solely pursuant to the terms of the relevant commercial agreement.
20  */
21 package io.crate.geo;
22 import static org.hamcrest.MatcherAssert.assertThat;
23 import static org.hamcrest.Matchers.hasEntry;
24 import static org.hamcrest.Matchers.hasKey;
25 import static org.hamcrest.Matchers.instanceOf;
26 import static org.hamcrest.core.Is.is;
27 import static org.junit.jupiter.api.Assertions.assertThrows;
28 import java.util.List;
29 import java.util.Map;
30 import org.junit.Test;
31 import org.locationtech.jts.geom.Coordinate;
32 import org.locationtech.jts.geom.GeometryFactory;
33 import org.locationtech.jts.geom.LineString;
34 import org.locationtech.jts.geom.LinearRing;
35 import org.locationtech.jts.geom.MultiPolygon;
36 import org.locationtech.jts.geom.Point;
37 import org.locationtech.jts.geom.Polygon;
38 import org.locationtech.jts.geom.impl.CoordinateArraySequenceFactory;
39 import org.locationtech.spatial4j.context.jts.JtsSpatialContext;
40 import org.locationtech.spatial4j.io.WKTWriter;
41 import org.locationtech.spatial4j.shape.Shape;
42 import org.locationtech.spatial4j.shape.jts.JtsGeometry;
43 import org.locationtech.spatial4j.shape.jts.JtsPoint;
44 public class GeoJSONUtilsTest {
45     static {
46         ClassLoader.getSystemClassLoader().setDefaultAssertionStatus(true);
47     }
48     private static final GeometryFactory GEOMETRY_FACTORY = new GeometryFactory(CoordinateArraySequenceFactory.instance());
49     public final static List&lt;Shape&gt; SHAPES = List.&lt;Shape&gt;of(
50         new JtsGeometry(new Polygon(GEOMETRY_FACTORY.createLinearRing(new Coordinate[]{
51             new Coordinate(0.0, 1.0),
52             new Coordinate(100.0, 0.1),
53             new Coordinate(20.0, 23.567),
54             new Coordinate(0.0, 1.0)
55         }), new LinearRing[0], GEOMETRY_FACTORY), JtsSpatialContext.GEO, true, true),
56         new JtsGeometry(new MultiPolygon(
57             new Polygon[]{
58                 new Polygon(GEOMETRY_FACTORY.createLinearRing(new Coordinate[]{
59                     new Coordinate(0.0, 1.0),
60                     new Coordinate(0.1, 1.1),
61                     new Coordinate(1.1, 60.0),
62                     new Coordinate(0.0, 1.0)
63                 }), new LinearRing[0], GEOMETRY_FACTORY),
64                 new Polygon(GEOMETRY_FACTORY.createLinearRing(new Coordinate[]{
65                     new Coordinate(2.0, 1.0),
66                     new Coordinate(2.1, 1.1),
67                     new Coordinate(2.1, 70.0),
68                     new Coordinate(2.0, 1.0)
69                 }), new LinearRing[0], GEOMETRY_FACTORY)
70             },
71             GEOMETRY_FACTORY
72         ), JtsSpatialContext.GEO, true, true),
73         new JtsGeometry(GEOMETRY_FACTORY.createMultiPointFromCoords(new Coordinate[]{
74             new Coordinate(0.0, 0.0),
75             new Coordinate(1.0, 1.0)
76         }), JtsSpatialContext.GEO, true, true),
77         new JtsGeometry(GEOMETRY_FACTORY.createMultiLineString(new LineString[]{
78             GEOMETRY_FACTORY.createLineString(new Coordinate[]{
79                 new Coordinate(0.0, 1.0),
80                 new Coordinate(0.1, 1.1),
81                 new Coordinate(1.1, 80.0),
82                 new Coordinate(0.0, 1.0)
83             }),
84             GEOMETRY_FACTORY.createLineString(new Coordinate[]{
85                 new Coordinate(2.0, 1.0),
86                 new Coordinate(2.1, 1.1),
87                 new Coordinate(2.1, 60.0),
88                 new Coordinate(2.0, 1.0)
89             })
90         }), JtsSpatialContext.GEO, true, true)
91     );
92     @Test
93     public void testShape2Map() throws Exception {
94         for (Shape shape : SHAPES) {
95             Map&lt;String, Object&gt; map = GeoJSONUtils.shape2Map(shape);
96             assertThat(map, hasKey("type"));
97             GeoJSONUtils.validateGeoJson(map);
98         }
99     }
100     @Test
101 <a name="0"></a>    public void testPoint2Map() throws Exception {
102         Point point = GEOMETRY_FACTORY.createPoint(new Coordinate(0.0, 0.0));
103         Shape shape = new JtsPoint(point, JtsSpatialContext.GEO);
104         Map&lt;String, Object&gt; map = <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>GeoJSONUtils.shape2Map(shape);
105         assertThat(map, hasEntry("type", (Object) "Point"));
106         assertThat(map.get("coordinates").getClass().isArray(), is(true));
107         assertThat(((double[]) map.get("coordinates")).length, is(2));
108     }
109     @Test
110     public void testMapFromWktRoundTrip() throws Exception {</b></font>
111         String wkt = "MULTILINESTRING ((10.05 10.28, 20.95 20.89), (20.95 20.89, 31.92 21.45))";
112         Shape shape = GeoJSONUtils.wkt2Shape(wkt);
113         Map&lt;String, Object&gt; map = GeoJSONUtils.shape2Map(shape);
114         Map&lt;String, Object&gt; wktMap = GeoJSONUtils.wkt2Map(wkt);
115         assertThat(map.get("type"), is(wktMap.get("type")));
116         assertThat(map.get("coordinates"), is(wktMap.get("coordinates")));
117         Shape mappedShape = GeoJSONUtils.map2Shape(map);
118         String wktFromMap = new WKTWriter().toString(mappedShape);
119         assertThat(wktFromMap, is(wkt));
120     }
121     @Test
122     public void testInvalidWKT() throws Exception {
123         assertThrows(IllegalArgumentException.class,
124                      () -&gt; GeoJSONUtils.wkt2Map(
125                          "multilinestring (((10.05  10.28  3.4  8.4, 20.95  20.89  4.5  9.5),\n" +
126                          " \n" +
127                          "( 20.95  20.89  4.5  9.5, 31.92  21.45  3.6  8.6)))"),
128                      "Cannot convert WKT \"multilinestring (((10.05  10.28  3.4  8.4, 20.95  20.89  4.5  9.5)");
129     }
130     @Test
131     public void testMap2Shape() throws Exception {
132         Shape shape = GeoJSONUtils.map2Shape(Map.&lt;String, Object&gt;of(
133 <a name="1"></a>            GeoJSONUtils.TYPE_FIELD, GeoJSONUtils.LINE_STRING,
134             GeoJSONUtils.COORDINATES_FIELD, new Double[][]{{0.0, 0.1}, {1.0, 1.1}}
135         ));
136         <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assertThat(shape, instanceOf(JtsGeometry.class));
137         assertThat(((JtsGeometry) shape).getGeom(), instanceOf(LineString.class));
138     }
139     @Test
140     public void testInvalidMap() throws Exception {
141         assertThrows(IllegalArgumentException.class,
142                      () -&gt; GeoJSONUtils.map2Shape(Map.&lt;String, Object&gt;of</b></font>()),
143                      "Cannot convert Map \"{}\" to shape");
144     }
145 <a name="3"></a>
146     @Test
147     public void testValidateMissingType() throws Exception {
148         <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assertThrows(IllegalArgumentException.class,
149                      () -&gt; GeoJSONUtils.validateGeoJson(Map.of()),
150                      "Invalid GeoJSON: type field missing");
151     }
152     @Test
153     public void testValidateWrongType() throws Exception {
154         assertThrows(IllegalArgumentException.class,
155                      () -&gt; GeoJSONUtils.validateGeoJson</b></font>(Map.of(GeoJSONUtils.TYPE_FIELD, "Foo")),
156                      "Invalid GeoJSON: invalid type");
157     }
158     @Test
159     public void testValidateMissingCoordinates() throws Exception {
160         assertThrows(IllegalArgumentException.class,
161                      () -&gt; GeoJSONUtils.validateGeoJson(Map.of(GeoJSONUtils.TYPE_FIELD, GeoJSONUtils.LINE_STRING)),
162                      "Invalid GeoJSON: coordinates field missing");
163     }
164     @Test
165     public void testValidateGeometriesMissing() throws Exception {
166         assertThrows(IllegalArgumentException.class,
167                      () -&gt; GeoJSONUtils.validateGeoJson(Map.of(GeoJSONUtils.TYPE_FIELD, GeoJSONUtils.GEOMETRY_COLLECTION)),
168                      "Invalid GeoJSON: coordinates field missing");
169     }
170 <a name="2"></a>
171     @Test
172     public void testInvalidGeometryCollection() throws Exception {
173         <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assertThrows(IllegalArgumentException.class,
174                      () -&gt; GeoJSONUtils.validateGeoJson(
175                          Map.of(
176                              GeoJSONUtils.TYPE_FIELD, GeoJSONUtils.GEOMETRY_COLLECTION,
177                              GeoJSONUtils.GEOMETRIES_FIELD, List.&lt;Object&gt;of("ABC")
178                          )
179                      ),
180                      "Invalid GeoJSON: invalid GeometryCollection");
181     }
182     @Test
183     public void testValidateInvalidCoordinates() throws Exception {
184         assertThrows(IllegalArgumentException.class,
185                      () -&gt; GeoJSONUtils.validateGeoJson(
186                          Map.of</b></font>(
187                              GeoJSONUtils.TYPE_FIELD, GeoJSONUtils.POINT,
188                              GeoJSONUtils.COORDINATES_FIELD, "ABC"
189                          )
190                      ),
191                      "Invalid GeoJSON: invalid GeometryCollection");
192     }
193     @Test
194     public void testInvalidNestedCoordinates() throws Exception {
195         assertThrows(IllegalArgumentException.class,
196                      () -&gt; GeoJSONUtils.validateGeoJson(
197                          Map.of(
198                              GeoJSONUtils.TYPE_FIELD, GeoJSONUtils.POINT,
199                              GeoJSONUtils.COORDINATES_FIELD, new double[][]{
200                                  {0.0, 1.0},
201                                  {1.0, 0.0}
202                              }
203                          )
204                      ),
205                      "Invalid GeoJSON: invalid coordinate");
206     }
207     @Test
208     public void testInvalidDepthNestedCoordinates() throws Exception {
209         assertThrows(IllegalArgumentException.class,
210                      () -&gt; GeoJSONUtils.validateGeoJson(
211                          Map.of(
212                              GeoJSONUtils.TYPE_FIELD, GeoJSONUtils.POLYGON,
213                              GeoJSONUtils.COORDINATES_FIELD, new double[][]{
214                                  {0.0, 1.0},
215                                  {1.0, 0.0}
216                              }
217                          )
218                      ),
219                      "Invalid GeoJSON: invalid coordinate");
220     }
221 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
