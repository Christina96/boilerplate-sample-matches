
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 9.569377990430622%, Tokens: 10</h2>
        <div class="column">
            <h3>BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-Handshake.java</h3>
            <pre><code>1  package net.md_5.bungee.protocol.packet;
<span onclick='openModal()' class='match'>2  import io.netty.buffer.ByteBuf;
3  import lombok.AllArgsConstructor;
4  import lombok.Data;
5  import lombok.EqualsAndHashCode;
6  import lombok.NoArgsConstructor;
7  import net.md_5.bungee.protocol.AbstractPacketHandler;
8  import net.md_5.bungee.protocol.DefinedPacket;
9  @Data
10  @NoArgsConstructor
</span>11  @AllArgsConstructor
12  @EqualsAndHashCode(callSuper = false)
13  public class Handshake extends DefinedPacket
14  {
15      private int protocolVersion;
16      private String host;
17      private int port;
18      private int requestedProtocol;
19      @Override
20      public void read(ByteBuf buf)
21      {
22          protocolVersion = readVarInt( buf );
23          host = readString( buf, 255 );
24          port = buf.readUnsignedShort();
25          requestedProtocol = readVarInt( buf );
26      }
27      @Override
28      public void write(ByteBuf buf)
29      {
30          writeVarInt( protocolVersion, buf );
31          writeString( host, buf );
32          buf.writeShort( port );
33          writeVarInt( requestedProtocol, buf );
34      }
35      @Override
36      public void handle(AbstractPacketHandler handler) throws Exception
37      {
38          handler.handle( this );
39      }
40  }
</code></pre>
        </div>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-ConsulRegistryService.java</h3>
            <pre><code>1  package com.weibo.service.impl;
2  import com.alibaba.fastjson.JSONObject;
3  import com.ecwid.consul.v1.ConsulClient;
4  import com.ecwid.consul.v1.QueryParams;
5  import com.ecwid.consul.v1.catalog.model.CatalogService;
6  import com.ecwid.consul.v1.health.model.Check;
<span onclick='openModal()' class='match'>7  import com.weibo.service.RegistryService;
8  import com.weibo.utils.ConsulClientWrapper;
9  import org.springframework.beans.factory.annotation.Autowired;
10  import org.springframework.context.annotation.Lazy;
11  import org.springframework.stereotype.Service;
12  import javax.annotation.PostConstruct;
13  import java.util.*;
14  @Service
15  @Lazy
</span>16  public class ConsulRegistryService implements RegistryService {
17      @Autowired
18      private ConsulClientWrapper clientWrapper;
19      private ConsulClient consulClient;
20      public ConsulRegistryService() {
21      }
22      public ConsulRegistryService(ConsulClient consulClient) {
23          this.consulClient = consulClient;
24      }
25      @PostConstruct
26      public void init() {
27          consulClient = clientWrapper.getConsulClient();
28      }
29      public List<String> getDatacenters() {
30          return consulClient.getCatalogDatacenters().getValue();
31      }
32      @Override
33      public List<String> getGroups() {
34          List<String> groups = new ArrayList<String>();
35          for (String dc : getDatacenters()) {
36              QueryParams queryParams = new QueryParams(dc);
37              Map<String, List<String>> serviceMap = consulClient.getCatalogServices(queryParams).getValue();
38              serviceMap.remove("consul");
39              for (String service : serviceMap.keySet()) {
40                  groups.add(formatGroupName(dc, service));
41              }
42          }
43          return groups;
44      }
45      @Override
46      public List<String> getServicesByGroup(String dcGroup) {
47          Set<String> services = new HashSet<String>();
48          List<CatalogService> serviceList = getCatalogServicesByGroup(dcGroup);
49          for (CatalogService service : serviceList) {
50              services.add(formatServiceName(service));
51          }
52          return new ArrayList<String>(services);
53      }
54      private List<CatalogService> getCatalogServicesByGroup(String dcGroup) {
55          QueryParams queryParams = new QueryParams(getDcName(dcGroup));
56          return consulClient.getCatalogService(getGroupName(dcGroup), queryParams).getValue();
57      }
58      @Override
59      public List<JSONObject> getNodes(String dcGroup, String service, String nodeType) {
60          List<JSONObject> results = new ArrayList<JSONObject>();
61          List<Check> checks = consulClient.getHealthChecksForService(getGroupName(dcGroup), new QueryParams(getDcName(dcGroup))).getValue();
62          for (Check check : checks) {
63              String serviceId = check.getServiceId();
64              String[] strings = serviceId.split("-");
65              if (strings[1].equals(service)) {
66                  Check.CheckStatus status = check.getStatus();
67                  JSONObject node = new JSONObject();
68                  if (nodeType.equals(status.toString())) {
69                      node.put("host", strings[0]);
70                      node.put("info", null);
71                      results.add(node);
72                  }
73              }
74          }
75          return results;
76      }
77      @Override
78      public List<JSONObject> getAllNodes(String dcGroup) {
79          List<JSONObject> results = new ArrayList<JSONObject>();
80          List<String> serviceNameSet = getServicesByGroup(dcGroup);
81          for (String dcServiceName : serviceNameSet) {
82              JSONObject service = new JSONObject();
83              service.put("service", dcServiceName);
84              List<JSONObject> availableServer = getNodes(dcGroup, dcServiceName, "PASSING");
85              service.put("server", availableServer);
86              List<JSONObject> unavailableServer = getNodes(dcGroup, dcServiceName, "CRITICAL");
87              service.put("unavailableServer", unavailableServer);
88              service.put("client", null);
89              results.add(service);
90          }
91          return results;
92      }
93      private String formatGroupName(String dc, String groupName) {
94          return dc + ":" + groupName;
95      }
96      private String formatServiceName(CatalogService catalogService) {
97          return catalogService.getServiceId().split("-")[1];
98      }
99      private String getDcName(String dcString) {
100          return dcString.substring(0, dcString.indexOf(":"));
101      }
102      private String getGroupName(String dcGroup) {
103          return dcGroup.substring(dcGroup.indexOf(":") + 1);
104      }
105  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-Handshake.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-ConsulRegistryService.java</div>
                <div class="column column_space"><pre><code>2  import io.netty.buffer.ByteBuf;
3  import lombok.AllArgsConstructor;
4  import lombok.Data;
5  import lombok.EqualsAndHashCode;
6  import lombok.NoArgsConstructor;
7  import net.md_5.bungee.protocol.AbstractPacketHandler;
8  import net.md_5.bungee.protocol.DefinedPacket;
9  @Data
10  @NoArgsConstructor
</pre></code></div>
                <div class="column column_space"><pre><code>7  import com.weibo.service.RegistryService;
8  import com.weibo.utils.ConsulClientWrapper;
9  import org.springframework.beans.factory.annotation.Autowired;
10  import org.springframework.context.annotation.Lazy;
11  import org.springframework.stereotype.Service;
12  import javax.annotation.PostConstruct;
13  import java.util.*;
14  @Service
15  @Lazy
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    