
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 56.33802816901409%, Tokens: 14</h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTestBase.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.unified;
2  import static org.junit.Assert.assertArrayEquals;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertFalse;
5  import static org.junit.Assert.assertTrue;
6  import static org.junit.Assert.assertNotNull;
7  import static org.junit.Assert.assertNull;
8  import static org.junit.Assert.fail;
9  import static redis.clients.jedis.Protocol.Command.BLPOP;
10  import static redis.clients.jedis.Protocol.Command.GET;
11  import static redis.clients.jedis.Protocol.Command.HGETALL;
12  import static redis.clients.jedis.Protocol.Command.LRANGE;
13  import static redis.clients.jedis.Protocol.Command.PING;
14  import static redis.clients.jedis.Protocol.Command.RPUSH;
15  import static redis.clients.jedis.Protocol.Command.SET;
16  import static redis.clients.jedis.Protocol.Command.XINFO;
17  import static redis.clients.jedis.util.SafeEncoder.encode;
18  import static redis.clients.jedis.util.SafeEncoder.encodeObject;
19  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
20  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
21  import java.util.ArrayList;
22  import java.util.Arrays;
23  import java.util.Collections;
24  import java.util.HashMap;
25  import java.util.HashSet;
26  import java.util.List;
27  import java.util.Set;
28  import org.junit.Test;
29  import redis.clients.jedis.ScanIteration;
30  import redis.clients.jedis.StreamEntryID;
31  import redis.clients.jedis.args.ExpiryOption;
32  import redis.clients.jedis.params.ScanParams;
33  import redis.clients.jedis.resps.ScanResult;
34  import redis.clients.jedis.params.RestoreParams;
35  import redis.clients.jedis.exceptions.JedisDataException;
36  import redis.clients.jedis.params.SetParams;
37  import redis.clients.jedis.util.AssertUtil;
38  public abstract class AllKindOfValuesCommandsTestBase extends UnifiedJedisCommandsTestBase {
39    protected final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
40    protected final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x0A };
41    protected final byte[] bfoo2 = { 0x01, 0x02, 0x03, 0x04, 0x0B };
42    protected final byte[] bfoo3 = { 0x01, 0x02, 0x03, 0x04, 0x0C };
43    protected final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
44    protected final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
45    protected final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
46    protected final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
47    protected final byte[] bfoobar = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 };
48    protected final byte[] bfoostar = { 0x01, 0x02, 0x03, 0x04, '*' };
49    protected final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
50    protected final byte[] bnx = { 0x6E, 0x78 };
51    protected final byte[] bex = { 0x65, 0x78 };
52    final int expireSeconds = 2;
53    @Test
54    public void exists() {
55      String status = jedis.set("foo", "bar");
56      assertEquals("OK", status);
57      status = jedis.set(bfoo, bbar);
58      assertEquals("OK", status);
59      assertTrue(jedis.exists("foo"));
60      assertTrue(jedis.exists(bfoo));
61      assertEquals(1L, jedis.del("foo"));
62      assertEquals(1L, jedis.del(bfoo));
63      assertFalse(jedis.exists("foo"));
64      assertFalse(jedis.exists(bfoo));
65    }
66    @Test
67    public void existsMany() {
68      String status = jedis.set("foo1", "bar1");
69      assertEquals("OK", status);
70      status = jedis.set("foo2", "bar2");
71      assertEquals("OK", status);
72      assertEquals(2L, jedis.exists("foo1", "foo2"));
73      assertEquals(1L, jedis.del("foo1"));
74      assertEquals(1L, jedis.exists("foo1", "foo2"));
75    }
76    @Test
77    public void del() {
78      jedis.set("foo1", "bar1");
79      jedis.set("foo2", "bar2");
80      jedis.set("foo3", "bar3");
81      assertEquals(3L, jedis.del("foo1", "foo2", "foo3"));
82      assertFalse(jedis.exists("foo1"));
83      assertFalse(jedis.exists("foo2"));
84      assertFalse(jedis.exists("foo3"));
85      jedis.set("foo1", "bar1");
86      assertEquals(1L, jedis.del("foo1", "foo2"));
87      assertEquals(0L, jedis.del("foo1", "foo2"));
88      jedis.set(bfoo1, bbar1);
89      jedis.set(bfoo2, bbar2);
90      jedis.set(bfoo3, bbar3);
91      assertEquals(3L, jedis.del(bfoo1, bfoo2, bfoo3));
92      assertFalse(jedis.exists(bfoo1));
93      assertFalse(jedis.exists(bfoo2));
94      assertFalse(jedis.exists(bfoo3));
95      jedis.set(bfoo1, bbar1);
96      assertEquals(1, jedis.del(bfoo1, bfoo2));
97      assertEquals(0, jedis.del(bfoo1, bfoo2));
98    }
99    @Test
100    public void unlink() {
101      jedis.set("foo1", "bar1");
102      jedis.set("foo2", "bar2");
103      jedis.set("foo3", "bar3");
104      assertEquals(3, jedis.unlink("foo1", "foo2", "foo3"));
105      assertEquals(0, jedis.exists("foo1", "foo2", "foo3"));
106      jedis.set("foo1", "bar1");
107      assertEquals(1, jedis.unlink("foo1", "foo2"));
108      assertEquals(0, jedis.unlink("foo1", "foo2"));
109      jedis.set("foo", "bar");
110      assertEquals(1, jedis.unlink("foo"));
111      assertFalse(jedis.exists("foo"));
112      jedis.set(bfoo1, bbar1);
113      jedis.set(bfoo2, bbar2);
114      jedis.set(bfoo3, bbar3);
115      assertEquals(3, jedis.unlink(bfoo1, bfoo2, bfoo3));
116      assertEquals(0, jedis.exists(bfoo1, bfoo2, bfoo3));
117      jedis.set(bfoo1, bbar1);
118      assertEquals(1, jedis.unlink(bfoo1, bfoo2));
119      assertEquals(0, jedis.unlink(bfoo1, bfoo2));
120      jedis.set(bfoo, bbar);
121      assertEquals(1, jedis.unlink(bfoo));
122      assertFalse(jedis.exists(bfoo));
123    }
124    @Test
125    public void type() {
126      jedis.set("foo", "bar");
127      assertEquals("string", jedis.type("foo"));
128      jedis.set(bfoo, bbar);
129      assertEquals("string", jedis.type(bfoo));
130    }
131    @Test
132    public void keys() {
133      jedis.set("foo", "bar");
134      jedis.set("foobar", "bar");
135      Set<String> keys = jedis.keys("foo*");
136      AssertUtil.assertCollectionContains(keys, "foo");
137      AssertUtil.assertCollectionContains(keys, "foobar");
138      assertEquals(Collections.emptySet(), jedis.keys("bar*"));
139      jedis.set(bfoo, bbar);
140      jedis.set(bfoobar, bbar);
141      Set<byte[]> bkeys = jedis.keys(bfoostar);
142      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoo);
143      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoobar);
144      assertEquals(Collections.emptySet(), jedis.keys(bbarstar));
145    }
146    @Test
147    public void randomKey() {
148      assertNull(jedis.randomKey());
149      for (int i = 0; i < 100; i++) {
150        jedis.set("foo" + i, "bar"+i);
151      }
152      String key = jedis.randomKey();
153      assertNotNull(key);
154      assertTrue(key.startsWith("foo"));
155      assertEquals(key.replace("foo", "bar"), jedis.get(key));
156    }
157    @Test
158    public void rename() {
159      jedis.set("foo", "bar");
<span onclick='openModal()' class='match'>160      String status = jedis.rename("foo", "bar");
161      assertEquals("OK", status);
162      assertNull(jedis.get("foo"));
163      assertEquals("bar", jedis.get("bar"));
164      jedis.set(bfoo, bbar);
165      String bstatus = jedis.rename(bfoo, bbar);
166      assertEquals("OK", bstatus);
167      assertNull(jedis.get(bfoo));
168      assertArrayEquals(bbar, jedis.get(bbar));
</span>169    }
170    @Test
171    public void renameOldAndNewAreTheSame() {
172      assertEquals("OK", jedis.set("foo", "bar"));
173      assertEquals("OK", jedis.rename("foo", "foo"));
174      assertEquals("OK", jedis.set(bfoo, bbar));
175      assertEquals("OK", jedis.rename(bfoo, bfoo));
176    }
177    @Test
178    public void renamenx() {
179      jedis.set("foo", "bar");
180      assertEquals(1, jedis.renamenx("foo", "bar"));
181      jedis.set("foo", "bar");
182      assertEquals(0, jedis.renamenx("foo", "bar"));
183      jedis.set(bfoo, bbar);
184      assertEquals(1, jedis.renamenx(bfoo, bbar));
185      jedis.set(bfoo, bbar);
186      assertEquals(0, jedis.renamenx(bfoo, bbar));
187    }
188    @Test
189    public void dbSize() {
190      assertEquals(0, jedis.dbSize());
191      jedis.set("foo", "bar");
192      assertEquals(1, jedis.dbSize());
193      jedis.set(bfoo, bbar);
194      assertEquals(2, jedis.dbSize());
195    }
196    @Test
197    public void expire() {
198      assertEquals(0, jedis.expire("foo", 20L));
199      jedis.set("foo", "bar");
200      assertEquals(1, jedis.expire("foo", 20L));
201      assertEquals(0, jedis.expire("foo", 20L, ExpiryOption.NX));
202      assertEquals(0, jedis.expire(bfoo, 20L));
203      jedis.set(bfoo, bbar);
204      assertEquals(1, jedis.expire(bfoo, 20L));
205      assertEquals(0, jedis.expire(bfoo, 20L, ExpiryOption.NX));
206    }
207    @Test
208    public void expireAt() {
209      long unixTime = (System.currentTimeMillis() / 1000L) + 20;
210      assertEquals(0, jedis.expireAt("foo", unixTime));
211      jedis.set("foo", "bar");
212      unixTime = (System.currentTimeMillis() / 1000L) + 20;
213      assertEquals(1, jedis.expireAt("foo", unixTime));
214      assertEquals(1, jedis.expireAt("foo", unixTime, ExpiryOption.XX));
215      assertEquals(0, jedis.expireAt(bfoo, unixTime));
216      jedis.set(bfoo, bbar);
217      unixTime = (System.currentTimeMillis() / 1000L) + 20;
218      assertEquals(1, jedis.expireAt(bfoo, unixTime));
219      assertEquals(1, jedis.expireAt(bfoo, unixTime, ExpiryOption.XX));
220    }
221    @Test
222    public void expireTime() {
223      long unixTime;
224      jedis.set("foo", "bar");
225      unixTime = (System.currentTimeMillis() / 1000L) + 20;
226      jedis.expireAt("foo", unixTime);
227      assertEquals(unixTime, jedis.expireTime("foo"), 0.0001);
228      jedis.set(bfoo, bbar);
229      unixTime = (System.currentTimeMillis() / 1000L) + 20;
230      jedis.expireAt(bfoo, unixTime);
231      assertEquals(unixTime, jedis.expireTime(bfoo), 0.0001);
232    }
233    @Test
234    public void ttl() {
235      assertEquals(-2, jedis.ttl("foo"));
236      jedis.set("foo", "bar");
237      assertEquals(-1, jedis.ttl("foo"));
238      jedis.expire("foo", 20);
239      long ttl = jedis.ttl("foo");
240      assertTrue(ttl >= 0 && ttl <= 20);
241      assertEquals(-2, jedis.ttl(bfoo));
242      jedis.set(bfoo, bbar);
243      assertEquals(-1, jedis.ttl(bfoo));
244      jedis.expire(bfoo, 20);
245      long bttl = jedis.ttl(bfoo);
246      assertTrue(bttl >= 0 && bttl <= 20);
247    }
248    @Test
249    public void touch() throws Exception {
250      assertEquals(0, jedis.touch("foo1", "foo2", "foo3"));
251      jedis.set("foo1", "bar1");
252      Thread.sleep(1100); 
253      assertTrue(jedis.objectIdletime("foo1") > 0);
254      assertEquals(1, jedis.touch("foo1"));
255      assertEquals(0L, jedis.objectIdletime("foo1").longValue());
256      assertEquals(1, jedis.touch("foo1", "foo2", "foo3"));
257      jedis.set("foo2", "bar2");
258      jedis.set("foo3", "bar3");
259      assertEquals(3, jedis.touch("foo1", "foo2", "foo3"));
260      assertEquals(0, jedis.touch(bfoo1, bfoo2, bfoo3));
261      jedis.set(bfoo1, bbar1);
262      Thread.sleep(1100); 
263      assertTrue(jedis.objectIdletime(bfoo1) > 0);
264      assertEquals(1, jedis.touch(bfoo1));
265      assertEquals(0L, jedis.objectIdletime(bfoo1).longValue());
266      assertEquals(1, jedis.touch(bfoo1, bfoo2, bfoo3));
267      jedis.set(bfoo2, bbar2);
268      jedis.set(bfoo3, bbar3);
269      assertEquals(3, jedis.touch(bfoo1, bfoo2, bfoo3));
270    }
271    @Test
272    public void persist() {
273      jedis.setex("foo", 60 * 60, "bar");
274      assertTrue(jedis.ttl("foo") > 0);
275      assertEquals(1, jedis.persist("foo"));
276      assertEquals(-1, jedis.ttl("foo"));
277      jedis.setex(bfoo, 60 * 60, bbar);
278      assertTrue(jedis.ttl(bfoo) > 0);
279      assertEquals(1, jedis.persist(bfoo));
280      assertEquals(-1, jedis.ttl(bfoo));
281    }
282    @Test
283    public void dumpAndRestore() {
284      jedis.set("foo1", "bar");
285      byte[] sv = jedis.dump("foo1");
286      jedis.restore("foo2", 0, sv);
287      assertEquals("bar", jedis.get("foo2"));
288      jedis.set(bfoo1, bbar);
289      sv = jedis.dump(bfoo1);
290      jedis.restore(bfoo2, 0, sv);
291      assertArrayEquals(bbar, jedis.get(bfoo2));
292    }
293    @Test
294    public void restoreParams() {
295      jedis.set("foo", "bar");
296      jedis.set("from", "a");
297      byte[] serialized = jedis.dump("from");
298      try {
299        jedis.restore("foo", 0, serialized);
300        fail("Simple restore on a existing key should fail");
301      } catch (JedisDataException e) {
302      }
303      try {
304        jedis.restore("foo", 0, serialized, RestoreParams.restoreParams());
305        fail("Simple restore on a existing key should fail");
306      } catch (JedisDataException e) {
307      }
308      assertEquals("bar", jedis.get("foo"));
309      jedis.restore("foo", 1000, serialized, RestoreParams.restoreParams().replace());
310      assertEquals("a", jedis.get("foo"));
311      assertTrue(jedis.pttl("foo") <= 1000);
312      jedis.restore("bar", System.currentTimeMillis() + 1000, serialized, RestoreParams.restoreParams().replace().absTtl());
313      assertTrue(jedis.pttl("bar") <= 1000);
314      jedis.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().idleTime(1000));
315      assertEquals(1000, jedis.objectIdletime("bar1").longValue());
316    }
317    @Test
318    public void pexpire() {
319      assertEquals(0, jedis.pexpire("foo", 10000));
320      jedis.set("foo1", "bar1");
321      assertEquals(1, jedis.pexpire("foo1", 10000));
322      jedis.set("foo2", "bar2");
323      assertEquals(1, jedis.pexpire("foo2", 200000000000L));
324      assertEquals(0, jedis.pexpire("foo2", 10000000, ExpiryOption.NX));
325      assertEquals(1, jedis.pexpire("foo2", 10000000, ExpiryOption.XX));
326      assertEquals(0, jedis.pexpire("foo2", 10000, ExpiryOption.GT));
327      assertEquals(1, jedis.pexpire("foo2", 10000, ExpiryOption.LT));
328      long pttl = jedis.pttl("foo2");
329      assertTrue(pttl > 100L);
330      assertEquals(0, jedis.pexpire(bfoo, 10000));
331      jedis.set(bfoo, bbar);
332      assertEquals(1, jedis.pexpire(bfoo, 10000));
333      assertEquals(0, jedis.pexpire(bfoo, 10000, ExpiryOption.NX));
334    }
335    @Test
336    public void pexpireAt() {
337      long unixTime = (System.currentTimeMillis()) + 10000;
338      assertEquals(0, jedis.pexpireAt("foo", unixTime));
339      jedis.set("foo", "bar");
340      assertEquals(1, jedis.pexpireAt("foo", unixTime));
341      assertEquals(0, jedis.pexpireAt(bfoo, unixTime));
342      jedis.set(bfoo, bbar);
343      assertEquals(1, jedis.pexpireAt(bfoo, unixTime));
344    }
345    @Test
346    public void pexpireTime() {
347      long unixTime = (System.currentTimeMillis()) + 10000;
348      jedis.set("foo", "bar");
349      jedis.pexpireAt("foo", unixTime);
350      assertEquals(unixTime, jedis.pexpireTime("foo"), 0.0001);
351      jedis.set(bfoo, bbar);
352      jedis.pexpireAt(bfoo, unixTime);
353      assertEquals(unixTime, jedis.pexpireTime(bfoo), 0.0001);
354    }
355    @Test
356    public void pttl() {
357      assertEquals(-2, jedis.pttl("foo"));
358      jedis.set("foo", "bar");
359      assertEquals(-1, jedis.pttl("foo"));
360      jedis.pexpire("foo", 20000);
361      long pttl = jedis.pttl("foo");
362      assertTrue(pttl >= 0 && pttl <= 20000);
363      assertEquals(-2, jedis.pttl(bfoo));
364      jedis.set(bfoo, bbar);
365      assertEquals(-1, jedis.pttl(bfoo));
366      jedis.pexpire(bfoo, 20000);
367      pttl = jedis.pttl(bfoo);
368      assertTrue(pttl >= 0 && pttl <= 20000);
369    }
370    @Test
371    public void psetex() {
372      long pttl;
373      jedis.psetex("foo", 200000000000L, "bar");
374      pttl = jedis.pttl("foo");
375      assertTrue(pttl > 100000000000L);
376      jedis.psetex(bfoo, 200000000000L, bbar);
377      pttl = jedis.pttl(bfoo);
378      assertTrue(pttl > 100000000000L);
379    }
380    @Test
381    public void scan() {
382      jedis.set("b", "b");
383      jedis.set("a", "a");
384      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
385      assertEquals(SCAN_POINTER_START, result.getCursor());
386      assertFalse(result.getResult().isEmpty());
387      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY);
388      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
389      assertFalse(bResult.getResult().isEmpty());
390    }
391    @Test
392    public void scanMatch() {
393      ScanParams params = new ScanParams();
394      params.match("a*");
395      jedis.set("b", "b");
396      jedis.set("a", "a");
397      jedis.set("aa", "aa");
398      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
399      assertEquals(SCAN_POINTER_START, result.getCursor());
400      assertFalse(result.getResult().isEmpty());
401      params = new ScanParams();
402      params.match(bfoostar);
403      jedis.set(bfoo1, bbar);
404      jedis.set(bfoo2, bbar);
405      jedis.set(bfoo3, bbar);
406      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
407      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
408      assertFalse(bResult.getResult().isEmpty());
409    }
410    @Test
411    public void scanCount() {
412      ScanParams params = new ScanParams();
413      params.count(2);
414      for (int i = 0; i < 10; i++) {
415        jedis.set("a" + i, "a" + i);
416      }
417      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
418      assertFalse(result.getResult().isEmpty());
419      params = new ScanParams();
420      params.count(2);
421      jedis.set(bfoo1, bbar);
422      jedis.set(bfoo2, bbar);
423      jedis.set(bfoo3, bbar);
424      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
425      assertFalse(bResult.getResult().isEmpty());
426    }
427    @Test
428    public void scanType() {
429      ScanParams noParams = new ScanParams();
430      ScanParams pagingParams = new ScanParams().count(4);
431      jedis.set("a", "a");
432      jedis.hset("b", "b", "b");
433      jedis.set("c", "c");
434      jedis.sadd("d", "d");
435      jedis.set("e", "e");
436      jedis.zadd("f", 0d, "f");
437      jedis.set("g", "g");
438      ScanResult<String> scanResult;
439      scanResult = jedis.scan(SCAN_POINTER_START, pagingParams, "string");
440      assertFalse(scanResult.isCompleteIteration());
441      int page1Count = scanResult.getResult().size();
442      scanResult = jedis.scan(scanResult.getCursor(), pagingParams, "string");
443      assertTrue(scanResult.isCompleteIteration());
444      int page2Count = scanResult.getResult().size();
445      assertEquals(4, page1Count + page2Count);
446      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "hash");
447      assertEquals(Collections.singletonList("b"), scanResult.getResult());
448      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "set");
449      assertEquals(Collections.singletonList("d"), scanResult.getResult());
450      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "zset");
451      assertEquals(Collections.singletonList("f"), scanResult.getResult());
452      final byte[] string = "string".getBytes();
453      final byte[] hash = "hash".getBytes();
454      final byte[] set = "set".getBytes();
455      final byte[] zset = "zset".getBytes();
456      ScanResult<byte[]> binaryResult;
457      jedis.set("a", "a");
458      jedis.hset("b", "b", "b");
459      jedis.set("c", "c");
460      jedis.sadd("d", "d");
461      jedis.set("e", "e");
462      jedis.zadd("f", 0d, "f");
463      jedis.set("g", "g");
464      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, pagingParams, string);
465      assertFalse(binaryResult.isCompleteIteration());
466      page1Count = binaryResult.getResult().size();
467      binaryResult = jedis.scan(binaryResult.getCursorAsBytes(), pagingParams, string);
468      assertTrue(binaryResult.isCompleteIteration());
469      page2Count = binaryResult.getResult().size();
470      assertEquals(4, page1Count + page2Count);
471      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, hash);
472      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{98}), binaryResult.getResult());
473      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, set);
474      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{100}), binaryResult.getResult());
475      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, zset);
476      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{102}), binaryResult.getResult());
477    }
478    @Test
479    public void scanIsCompleteIteration() {
480      for (int i = 0; i < 100; i++) {
481        jedis.set("a" + i, "a" + i);
482      }
483      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
484      assertFalse(result.isCompleteIteration());
485      result = scanCompletely(result.getCursor());
486      assertNotNull(result);
487      assertTrue(result.isCompleteIteration());
488    }
489    private ScanResult<String> scanCompletely(String cursor) {
490      ScanResult<String> scanResult;
491      do {
492        scanResult = jedis.scan(cursor);
493        cursor = scanResult.getCursor();
494      } while (!SCAN_POINTER_START.equals(scanResult.getCursor()));
495      return scanResult;
496    }
497    @Test
498    public void setNxExAndGet() {
499      assertEquals("OK", jedis.set("hello", "world", SetParams.setParams().nx().ex(expireSeconds)));
500      assertEquals("world", jedis.get("hello"));
501      assertNull(jedis.set("hello", "bar", SetParams.setParams().nx().ex(expireSeconds)));
502      assertEquals("world", jedis.get("hello"));
503      long ttl = jedis.ttl("hello");
504      assertTrue(ttl > 0 && ttl <= expireSeconds);
505      byte[] bworld = { 0x77, 0x6F, 0x72, 0x6C, 0x64 };
506      byte[] bhello = { 0x68, 0x65, 0x6C, 0x6C, 0x6F };
507      assertEquals("OK", jedis.set(bworld, bhello, SetParams.setParams().nx().ex(expireSeconds)));
508      assertArrayEquals(bhello, jedis.get(bworld));
509      assertNull(jedis.set(bworld, bbar, SetParams.setParams().nx().ex(expireSeconds)));
510      assertArrayEquals(bhello, jedis.get(bworld));
511      long bttl = jedis.ttl(bworld);
512      assertTrue(bttl > 0 && bttl <= expireSeconds);
513    }
514    @Test
515    public void setGetOptionTest() {
516      assertEquals("OK", jedis.set("hello", "world"));
517      assertEquals("world", jedis.setGet("hello", "jedis"));
518      assertEquals("jedis", jedis.get("hello"));
519      assertNull(jedis.setGet("key", "value"));
520    }
521    @Test
522    public void setGet() {
523      assertEquals("OK", jedis.set("hello", "world"));
524      assertEquals("world", jedis.setGet("hello", "jedis", SetParams.setParams()));
525      assertEquals("jedis", jedis.get("hello"));
526      assertNull(jedis.setGet("key", "value", SetParams.setParams()));
527    }
528    @Test
529    public void sendCommandTest() {
530      Object obj = jedis.sendCommand(SET, "x", "1");
531      String returnValue = encode((byte[]) obj);
532      assertEquals("OK", returnValue);
533      obj = jedis.sendCommand(GET, "x");
534      returnValue = encode((byte[]) obj);
535      assertEquals("1", returnValue);
536      jedis.sendCommand(RPUSH, "foo", "a");
537      jedis.sendCommand(RPUSH, "foo", "b");
538      jedis.sendCommand(RPUSH, "foo", "c");
539      obj = jedis.sendCommand(LRANGE, "foo", "0", "2");
540      List<byte[]> list = (List<byte[]>) obj;
541      List<byte[]> expected = new ArrayList<>(3);
542      expected.add("a".getBytes());
543      expected.add("b".getBytes());
544      expected.add("c".getBytes());
545      for (int i = 0; i < 3; i++)
546        assertArrayEquals(expected.get(i), list.get(i));
547      assertEquals("PONG", encode((byte[]) jedis.sendCommand(PING)));
548    }
549    @Test
550    public void sendBlockingCommandTest() {
551      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
552      jedis.sendCommand(RPUSH, "foo", "bar");
553      assertEquals(Arrays.asList("foo", "bar"),
554        encodeObject(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L))));
555      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
556    }
557    @Test
558    public void encodeCompleteResponse() {
559      HashMap<String, String> entry = new HashMap<>();
560      entry.put("foo", "bar");
561      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
562      jedis.xgroupCreate("mystream", "mygroup", null, false);
563      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
564      List encodeObj = (List) encodeObject(obj);
565      assertTrue(encodeObj.size() >= 14);
566      assertEquals(0, encodeObj.size() % 2); 
567      assertEquals(1L, findValueFromMapAsList(encodeObj, "length"));
568      assertEquals(entryID.toString(), findValueFromMapAsList(encodeObj, "last-generated-id"));
569      List<String> entryAsList = new ArrayList<>(2);
570      entryAsList.add("foo");
571      entryAsList.add("bar");
572      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "first-entry")).get(1));
573      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "last-entry")).get(1));
574      assertEquals("PONG", encodeObject(jedis.sendCommand(PING)));
575      entry.put("foo2", "bar2");
576      jedis.hset("hash:test:encode", entry);
577      encodeObj = (List) encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
578      assertEquals(4, encodeObj.size());
579      assertTrue(encodeObj.contains("foo"));
580      assertTrue(encodeObj.contains("foo2"));
581    }
582    private Object findValueFromMapAsList(List list, Object key) {
583      for (int i = 0; i < list.size(); i += 2) {
584        if (key.equals(list.get(i))) {
585          return list.get(i + 1);
586        }
587      }
588      return null;
589    }
590    @Test
591    public void copy() {
592      assertFalse(jedis.copy("unknown", "foo", false));
593      jedis.set("foo1", "bar");
594      assertTrue(jedis.copy("foo1", "foo2", false));
595      assertEquals("bar", jedis.get("foo2"));
596      jedis.set("foo1", "bar1");
597      assertTrue(jedis.copy("foo1", "foo2", true));
598      assertEquals("bar1", jedis.get("foo2"));
599      assertFalse(jedis.copy(bfoobar, bfoo, false));
600      jedis.set(bfoo1, bbar);
601      assertTrue(jedis.copy(bfoo1, bfoo2, false));
602      assertArrayEquals(bbar, jedis.get(bfoo2));
603      jedis.set(bfoo1, bbar1);
604      assertTrue(jedis.copy(bfoo1, bfoo2, true));
605      assertArrayEquals(bbar1, jedis.get(bfoo2));
606    }
607    @Test
608    public void scanIteration() {
609      Set<String> allIn = new HashSet<>(26 * 26);
610      char[] arr = new char[2];
611      for (int i = 0; i < 26; i++) {
612        arr[0] = (char) ('a' + i);
613        for (int j = 0; j < 26; j++) {
614          arr[1] = (char) ('a' + j);
615          String str = new String(arr);
616          jedis.incr(str);
617          allIn.add(str);
618        }
619      }
620      Set<String> allScan = new HashSet<>();
621      ScanIteration scan = jedis.scanIteration(10, "*");
622      while (!scan.isIterationCompleted()) {
623        ScanResult<String> batch = scan.nextBatch();
624        allScan.addAll(batch.getResult());
625      }
626      assertEquals(allIn, allScan);
627    }
628  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ListCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.junit.Assert.assertArrayEquals;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertNotNull;
5  import static org.junit.Assert.assertNull;
6  import static org.junit.Assert.assertTrue;
7  import static org.junit.Assert.fail;
8  import static redis.clients.jedis.util.AssertUtil.assertByteArrayListEquals;
9  import java.util.ArrayList;
10  import java.util.Arrays;
11  import java.util.Collections;
12  import java.util.List;
13  import org.junit.Test;
14  import org.slf4j.Logger;
15  import org.slf4j.LoggerFactory;
16  import redis.clients.jedis.Jedis;
17  import redis.clients.jedis.args.ListPosition;
18  import redis.clients.jedis.args.ListDirection;
19  import redis.clients.jedis.exceptions.JedisDataException;
20  import redis.clients.jedis.params.LPosParams;
21  import redis.clients.jedis.util.KeyValue;
22  public class ListCommandsTest extends JedisCommandsTestBase {
23    private final Logger logger = LoggerFactory.getLogger(getClass());
24    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
25    final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x05 };
26    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
27    final byte[] bcar = { 0x09, 0x0A, 0x0B, 0x0C };
28    final byte[] bA = { 0x0A };
29    final byte[] bB = { 0x0B };
30    final byte[] bC = { 0x0C };
31    final byte[] b1 = { 0x01 };
32    final byte[] b2 = { 0x02 };
33    final byte[] b3 = { 0x03 };
34    final byte[] bhello = { 0x04, 0x02 };
35    final byte[] bx = { 0x02, 0x04 };
36    final byte[] bdst = { 0x11, 0x12, 0x13, 0x14 };
37    @Test
38    public void rpush() {
39      assertEquals(1, jedis.rpush("foo", "bar"));
40      assertEquals(2, jedis.rpush("foo", "foo"));
41      assertEquals(4, jedis.rpush("foo", "bar", "foo"));
42      assertEquals(1, jedis.rpush(bfoo, bbar));
43      assertEquals(2, jedis.rpush(bfoo, bfoo));
44      assertEquals(4, jedis.rpush(bfoo, bbar, bfoo));
45    }
46    @Test
47    public void lpush() {
48      assertEquals(1, jedis.lpush("foo", "bar"));
49      assertEquals(2, jedis.lpush("foo", "foo"));
50      assertEquals(4, jedis.lpush("foo", "bar", "foo"));
51      assertEquals(1, jedis.lpush(bfoo, bbar));
52      assertEquals(2, jedis.lpush(bfoo, bfoo));
53      assertEquals(4, jedis.lpush(bfoo, bbar, bfoo));
54    }
55    @Test
56    public void llen() {
57      assertEquals(0, jedis.llen("foo"));
58      jedis.lpush("foo", "bar");
59      jedis.lpush("foo", "car");
60      assertEquals(2, jedis.llen("foo"));
61      assertEquals(0, jedis.llen(bfoo));
62      jedis.lpush(bfoo, bbar);
63      jedis.lpush(bfoo, bcar);
64      assertEquals(2, jedis.llen(bfoo));
65    }
66    @Test
67    public void llenNotOnList() {
68      try {
69        jedis.set("foo", "bar");
70        jedis.llen("foo");
71        fail("JedisDataException expected");
72      } catch (final JedisDataException e) {
73      }
74      try {
75        jedis.set(bfoo, bbar);
76        jedis.llen(bfoo);
77        fail("JedisDataException expected");
78      } catch (final JedisDataException e) {
79      }
80    }
81    @Test
82    public void lrange() {
83      jedis.rpush("foo", "a");
84      jedis.rpush("foo", "b");
85      jedis.rpush("foo", "c");
86      List<String> expected = new ArrayList<String>();
87      expected.add("a");
88      expected.add("b");
89      expected.add("c");
90      List<String> range = jedis.lrange("foo", 0, 2);
91      assertEquals(expected, range);
92      range = jedis.lrange("foo", 0, 20);
93      assertEquals(expected, range);
94      expected = new ArrayList<String>();
95      expected.add("b");
96      expected.add("c");
97      range = jedis.lrange("foo", 1, 2);
98      assertEquals(expected, range);
99      range = jedis.lrange("foo", 2, 1);
100      assertEquals(Collections.<String> emptyList(), range);
101      jedis.rpush(bfoo, bA);
102      jedis.rpush(bfoo, bB);
103      jedis.rpush(bfoo, bC);
104      List<byte[]> bexpected = new ArrayList<byte[]>();
105      bexpected.add(bA);
106      bexpected.add(bB);
107      bexpected.add(bC);
108      List<byte[]> brange = jedis.lrange(bfoo, 0, 2);
109      assertByteArrayListEquals(bexpected, brange);
110      brange = jedis.lrange(bfoo, 0, 20);
111      assertByteArrayListEquals(bexpected, brange);
112      bexpected = new ArrayList<byte[]>();
113      bexpected.add(bB);
114      bexpected.add(bC);
115      brange = jedis.lrange(bfoo, 1, 2);
116      assertByteArrayListEquals(bexpected, brange);
117      brange = jedis.lrange(bfoo, 2, 1);
118      assertByteArrayListEquals(Collections.<byte[]> emptyList(), brange);
119    }
120    @Test
121    public void ltrim() {
122      jedis.lpush("foo", "1");
123      jedis.lpush("foo", "2");
124      jedis.lpush("foo", "3");
125      String status = jedis.ltrim("foo", 0, 1);
126      List<String> expected = new ArrayList<String>();
127      expected.add("3");
128      expected.add("2");
129      assertEquals("OK", status);
130      assertEquals(2, jedis.llen("foo"));
131      assertEquals(expected, jedis.lrange("foo", 0, 100));
132      jedis.lpush(bfoo, b1);
133      jedis.lpush(bfoo, b2);
134      jedis.lpush(bfoo, b3);
135      String bstatus = jedis.ltrim(bfoo, 0, 1);
136      List<byte[]> bexpected = new ArrayList<byte[]>();
137      bexpected.add(b3);
138      bexpected.add(b2);
139      assertEquals("OK", bstatus);
140      assertEquals(2, jedis.llen(bfoo));
141      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
142    }
143    @Test
144    public void lset() {
145      jedis.lpush("foo", "1");
146      jedis.lpush("foo", "2");
147      jedis.lpush("foo", "3");
148      List<String> expected = new ArrayList<String>();
149      expected.add("3");
150      expected.add("bar");
151      expected.add("1");
152      String status = jedis.lset("foo", 1, "bar");
153      assertEquals("OK", status);
154      assertEquals(expected, jedis.lrange("foo", 0, 100));
155      jedis.lpush(bfoo, b1);
156      jedis.lpush(bfoo, b2);
157      jedis.lpush(bfoo, b3);
158      List<byte[]> bexpected = new ArrayList<byte[]>();
159      bexpected.add(b3);
160      bexpected.add(bbar);
161      bexpected.add(b1);
162      String bstatus = jedis.lset(bfoo, 1, bbar);
163      assertEquals("OK", bstatus);
164      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
165    }
166    @Test
167    public void lindex() {
168      jedis.lpush("foo", "1");
169      jedis.lpush("foo", "2");
170      jedis.lpush("foo", "3");
171      assertEquals("3", jedis.lindex("foo", 0));
172      assertNull(jedis.lindex("foo", 100));
173      jedis.lpush(bfoo, b1);
174      jedis.lpush(bfoo, b2);
175      jedis.lpush(bfoo, b3);
176      assertArrayEquals(b3, jedis.lindex(bfoo, 0));
177      assertNull(jedis.lindex(bfoo, 100));
178    }
179    @Test
180    public void lrem() {
181      jedis.lpush("foo", "hello");
182      jedis.lpush("foo", "hello");
183      jedis.lpush("foo", "x");
184      jedis.lpush("foo", "hello");
185      jedis.lpush("foo", "c");
186      jedis.lpush("foo", "b");
187      jedis.lpush("foo", "a");
188      List<String> expected = new ArrayList<String>();
189      expected.add("a");
190      expected.add("b");
191      expected.add("c");
192      expected.add("hello");
193      expected.add("x");
194      assertEquals(2, jedis.lrem("foo", -2, "hello"));
195      assertEquals(expected, jedis.lrange("foo", 0, 1000));
196      assertEquals(0, jedis.lrem("bar", 100, "foo"));
197      jedis.lpush(bfoo, bhello);
198      jedis.lpush(bfoo, bhello);
199      jedis.lpush(bfoo, bx);
200      jedis.lpush(bfoo, bhello);
201      jedis.lpush(bfoo, bC);
202      jedis.lpush(bfoo, bB);
203      jedis.lpush(bfoo, bA);
204      List<byte[]> bexpected = new ArrayList<byte[]>();
205      bexpected.add(bA);
206      bexpected.add(bB);
207      bexpected.add(bC);
208      bexpected.add(bhello);
209      bexpected.add(bx);
210      assertEquals(2, jedis.lrem(bfoo, -2, bhello));
211      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 1000));
212      assertEquals(0, jedis.lrem(bbar, 100, bfoo));
213    }
214    @Test
215    public void lpop() {
216      assertNull(jedis.lpop("foo"));
217      assertNull(jedis.lpop("foo", 0));
218      jedis.rpush("foo", "a");
219      jedis.rpush("foo", "b");
220      jedis.rpush("foo", "c");
221      assertEquals("a", jedis.lpop("foo"));
222      assertEquals(Arrays.asList("b", "c"), jedis.lpop("foo", 10));
223      assertNull(jedis.lpop("foo"));
224      assertNull(jedis.lpop("foo", 1));
225      assertNull(jedis.lpop(bfoo));
226      assertNull(jedis.lpop(bfoo, 0));
227      jedis.rpush(bfoo, bA);
228      jedis.rpush(bfoo, bB);
229      jedis.rpush(bfoo, bC);
230      assertArrayEquals(bA, jedis.lpop(bfoo));
231      assertByteArrayListEquals(Arrays.asList(bB, bC), jedis.lpop(bfoo, 10));
232      assertNull(jedis.lpop(bfoo));
233      assertNull(jedis.lpop(bfoo, 1));
234    }
235    @Test
236    public void rpop() {
237      assertNull(jedis.rpop("foo"));
238      assertNull(jedis.rpop("foo", 0));
239      jedis.rpush("foo", "a");
240      jedis.rpush("foo", "b");
241      jedis.rpush("foo", "c");
242      assertEquals("c", jedis.rpop("foo"));
243      assertEquals(Arrays.asList("b", "a"), jedis.rpop("foo", 10));
244      assertNull(jedis.rpop("foo"));
245      assertNull(jedis.rpop("foo", 1));
246      assertNull(jedis.rpop(bfoo));
247      assertNull(jedis.rpop(bfoo, 0));
248      jedis.rpush(bfoo, bA);
249      jedis.rpush(bfoo, bB);
250      jedis.rpush(bfoo, bC);
251      assertArrayEquals(bC, jedis.rpop(bfoo));
252      assertByteArrayListEquals(Arrays.asList(bB, bA), jedis.rpop(bfoo, 10));
253      assertNull(jedis.rpop(bfoo));
254      assertNull(jedis.rpop(bfoo, 1));
255    }
256    @Test
257    public void rpoplpush() {
258      jedis.rpush("foo", "a");
259      jedis.rpush("foo", "b");
260      jedis.rpush("foo", "c");
261      jedis.rpush("dst", "foo");
262      jedis.rpush("dst", "bar");
263      String element = jedis.rpoplpush("foo", "dst");
264      assertEquals("c", element);
265      List<String> srcExpected = new ArrayList<String>();
266      srcExpected.add("a");
267      srcExpected.add("b");
268      List<String> dstExpected = new ArrayList<String>();
269      dstExpected.add("c");
270      dstExpected.add("foo");
271      dstExpected.add("bar");
272      assertEquals(srcExpected, jedis.lrange("foo", 0, 1000));
273      assertEquals(dstExpected, jedis.lrange("dst", 0, 1000));
274      jedis.rpush(bfoo, bA);
275      jedis.rpush(bfoo, bB);
276      jedis.rpush(bfoo, bC);
277      jedis.rpush(bdst, bfoo);
278      jedis.rpush(bdst, bbar);
279      byte[] belement = jedis.rpoplpush(bfoo, bdst);
280      assertArrayEquals(bC, belement);
281      List<byte[]> bsrcExpected = new ArrayList<byte[]>();
282      bsrcExpected.add(bA);
283      bsrcExpected.add(bB);
284      List<byte[]> bdstExpected = new ArrayList<byte[]>();
285      bdstExpected.add(bC);
286      bdstExpected.add(bfoo);
287      bdstExpected.add(bbar);
288      assertByteArrayListEquals(bsrcExpected, jedis.lrange(bfoo, 0, 1000));
289      assertByteArrayListEquals(bdstExpected, jedis.lrange(bdst, 0, 1000));
290    }
291    @Test
292    public void blpop() throws InterruptedException {
293      List<String> result = jedis.blpop(1, "foo");
294      assertNull(result);
295      jedis.lpush("foo", "bar");
296      result = jedis.blpop(1, "foo");
297      assertNotNull(result);
298      assertEquals(2, result.size());
299      assertEquals("foo", result.get(0));
300      assertEquals("bar", result.get(1));
301      result = jedis.blpop(1, "foo", "foo1");
302      assertNull(result);
303      jedis.lpush("foo", "bar");
304      jedis.lpush("foo1", "bar1");
305      result = jedis.blpop(1, "foo1", "foo");
306      assertNotNull(result);
307      assertEquals(2, result.size());
308      assertEquals("foo1", result.get(0));
309      assertEquals("bar1", result.get(1));
310      jedis.lpush(bfoo, bbar);
311      List<byte[]> bresult = jedis.blpop(1, bfoo);
312      assertNotNull(bresult);
313      assertEquals(2, bresult.size());
314      assertArrayEquals(bfoo, bresult.get(0));
315      assertArrayEquals(bbar, bresult.get(1));
316      bresult = jedis.blpop(1, bfoo, bfoo1);
317      assertNull(bresult);
318      jedis.lpush(bfoo, bbar);
319      jedis.lpush(bfoo1, bcar);
320      bresult = jedis.blpop(1, bfoo, bfoo1);
321      assertNotNull(bresult);
322      assertEquals(2, bresult.size());
323      assertArrayEquals(bfoo, bresult.get(0));
324      assertArrayEquals(bbar, bresult.get(1));
325    }
326    @Test
327    public void blpopDouble() throws InterruptedException {
328      KeyValue<String, String> result = jedis.blpop(0.1, "foo");
329      assertNull(result);
330      jedis.lpush("foo", "bar");
331      result = jedis.blpop(3.2, "foo");
332      assertNotNull(result);
333      assertEquals("foo", result.getKey());
334      assertEquals("bar", result.getValue());
335      result = jedis.blpop(0.18, "foo", "foo1");
336      assertNull(result);
337      jedis.lpush("foo", "bar");
338      jedis.lpush("foo1", "bar1");
<span onclick='openModal()' class='match'>339      result = jedis.blpop(1d, "foo1", "foo");
340      assertNotNull(result);
341      assertEquals("foo1", result.getKey());
342      assertEquals("bar1", result.getValue());
343      jedis.lpush(bfoo, bbar);
344      KeyValue<byte[], byte[]> bresult = jedis.blpop(3.12, bfoo);
345      assertNotNull(bresult);
346      assertArrayEquals(bfoo, bresult.getKey());
347      assertArrayEquals(bbar, bresult.getValue());
</span>348      bresult = jedis.blpop(0.11, bfoo, bfoo1);
349      assertNull(bresult);
350      jedis.lpush(bfoo, bbar);
351      jedis.lpush(bfoo1, bcar);
352      bresult = jedis.blpop(1d, bfoo, bfoo1);
353      assertNotNull(bresult);
354      assertArrayEquals(bfoo, bresult.getKey());
355      assertArrayEquals(bbar, bresult.getValue());
356    }
357    @Test
358    public void blpopDoubleWithSleep() {
359      long startMillis, totalMillis;
360      startMillis = System.currentTimeMillis();
361      KeyValue<String, String> result = jedis.blpop(0.04, "foo");
362      totalMillis = System.currentTimeMillis() - startMillis;
363      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
364      assertNull(result);
365      startMillis = System.currentTimeMillis();
366      new Thread(() -> {
367        try {
368          Thread.sleep(30);
369        } catch(InterruptedException e) {
370          logger.error("", e);
371        }
372        try (Jedis j = createJedis()) {
373          j.lpush("foo", "bar");
374        }
375      }).start();
376      result = jedis.blpop(1.2, "foo");
377      totalMillis = System.currentTimeMillis() - startMillis;
378      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
379      assertNotNull(result);
380      assertEquals("foo", result.getKey());
381      assertEquals("bar", result.getValue());
382    }
383    @Test
384    public void brpop() throws InterruptedException {
385      List<String> result = jedis.brpop(1, "foo");
386      assertNull(result);
387      jedis.lpush("foo", "bar");
388      result = jedis.brpop(1, "foo");
389      assertNotNull(result);
390      assertEquals(2, result.size());
391      assertEquals("foo", result.get(0));
392      assertEquals("bar", result.get(1));
393      result = jedis.brpop(1, "foo", "foo1");
394      assertNull(result);
395      jedis.lpush("foo", "bar");
396      jedis.lpush("foo1", "bar1");
397      result = jedis.brpop(1, "foo1", "foo");
398      assertNotNull(result);
399      assertEquals(2, result.size());
400      assertEquals("foo1", result.get(0));
401      assertEquals("bar1", result.get(1));
402      jedis.lpush(bfoo, bbar);
403      List<byte[]> bresult = jedis.brpop(1, bfoo);
404      assertNotNull(bresult);
405      assertEquals(2, bresult.size());
406      assertArrayEquals(bfoo, bresult.get(0));
407      assertArrayEquals(bbar, bresult.get(1));
408      bresult = jedis.brpop(1, bfoo, bfoo1);
409      assertNull(bresult);
410      jedis.lpush(bfoo, bbar);
411      jedis.lpush(bfoo1, bcar);
412      bresult = jedis.brpop(1, bfoo, bfoo1);
413      assertNotNull(bresult);
414      assertEquals(2, bresult.size());
415      assertArrayEquals(bfoo, bresult.get(0));
416      assertArrayEquals(bbar, bresult.get(1));
417    }
418    @Test
419    public void brpopDouble() throws InterruptedException {
420      KeyValue<String, String> result = jedis.brpop(0.1, "foo");
421      assertNull(result);
422      jedis.lpush("foo", "bar");
423      result = jedis.brpop(3.2, "foo");
424      assertNotNull(result);
425      assertEquals("foo", result.getKey());
426      assertEquals("bar", result.getValue());
427      result = jedis.brpop(0.18, "foo", "foo1");
428      assertNull(result);
429      jedis.lpush("foo", "bar");
430      jedis.lpush("foo1", "bar1");
431      result = jedis.brpop(1d, "foo1", "foo");
432      assertNotNull(result);
433      assertEquals("foo1", result.getKey());
434      assertEquals("bar1", result.getValue());
435      jedis.lpush(bfoo, bbar);
436      KeyValue<byte[], byte[]> bresult = jedis.brpop(3.12, bfoo);
437      assertNotNull(bresult);
438      assertArrayEquals(bfoo, bresult.getKey());
439      assertArrayEquals(bbar, bresult.getValue());
440      bresult = jedis.brpop(0.11, bfoo, bfoo1);
441      assertNull(bresult);
442      jedis.lpush(bfoo, bbar);
443      jedis.lpush(bfoo1, bcar);
444      bresult = jedis.brpop(1d, bfoo, bfoo1);
445      assertNotNull(bresult);
446      assertArrayEquals(bfoo, bresult.getKey());
447      assertArrayEquals(bbar, bresult.getValue());
448    }
449    @Test
450    public void brpopDoubleWithSleep() {
451      long startMillis, totalMillis;
452      startMillis = System.currentTimeMillis();
453      KeyValue<String, String> result = jedis.brpop(0.04, "foo");
454      totalMillis = System.currentTimeMillis() - startMillis;
455      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
456      assertNull(result);
457      startMillis = System.currentTimeMillis();
458      new Thread(() -> {
459        try {
460          Thread.sleep(30);
461        } catch(InterruptedException e) {
462          logger.error("", e);
463        }
464        try (Jedis j = createJedis()) {
465          j.lpush("foo", "bar");
466        }
467      }).start();
468      result = jedis.brpop(1.2, "foo");
469      totalMillis = System.currentTimeMillis() - startMillis;
470      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
471      assertNotNull(result);
472      assertEquals("foo", result.getKey());
473      assertEquals("bar", result.getValue());
474    }
475    @Test
476    public void lpushx() {
477      assertEquals(0, jedis.lpushx("foo", "bar"));
478      jedis.lpush("foo", "a");
479      assertEquals(2, jedis.lpushx("foo", "b"));
480      assertEquals(0, jedis.lpushx(bfoo, bbar));
481      jedis.lpush(bfoo, bA);
482      assertEquals(2, jedis.lpushx(bfoo, bB));
483    }
484    @Test
485    public void rpushx() {
486      assertEquals(0, jedis.rpushx("foo", "bar"));
487      jedis.lpush("foo", "a");
488      assertEquals(2, jedis.rpushx("foo", "b"));
489      assertEquals(0, jedis.rpushx(bfoo, bbar));
490      jedis.lpush(bfoo, bA);
491      assertEquals(2, jedis.rpushx(bfoo, bB));
492    }
493    @Test
494    public void linsert() {
495      assertEquals(0, jedis.linsert("foo", ListPosition.BEFORE, "bar", "car"));
496      jedis.lpush("foo", "a");
497      assertEquals(2, jedis.linsert("foo", ListPosition.AFTER, "a", "b"));
498      List<String> expected = new ArrayList<String>();
499      expected.add("a");
500      expected.add("b");
501      assertEquals(expected, jedis.lrange("foo", 0, 100));
502      assertEquals(-1, jedis.linsert("foo", ListPosition.BEFORE, "bar", "car"));
503      assertEquals(0, jedis.linsert(bfoo, ListPosition.BEFORE, bbar, bcar));
504      jedis.lpush(bfoo, bA);
505      assertEquals(2, jedis.linsert(bfoo, ListPosition.AFTER, bA, bB));
506      List<byte[]> bexpected = new ArrayList<byte[]>();
507      bexpected.add(bA);
508      bexpected.add(bB);
509      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
510      assertEquals(-1, jedis.linsert(bfoo, ListPosition.BEFORE, bbar, bcar));
511    }
512    @Test
513    public void brpoplpush() {
514      new Thread(new Runnable() {
515        @Override
516        public void run() {
517          try {
518            Thread.sleep(100);
519          } catch (InterruptedException e) {
520            logger.error("", e);
521          }
522          try (Jedis j = createJedis()) {
523            j.lpush("foo", "a");
524          }
525        }
526      }).start();
527      String element = jedis.brpoplpush("foo", "bar", 0);
528      assertEquals("a", element);
529      assertEquals(1, jedis.llen("bar"));
530      assertEquals("a", jedis.lrange("bar", 0, -1).get(0));
531      new Thread(new Runnable() {
532        @Override
533        public void run() {
534          try {
535            Thread.sleep(100);
536          } catch (InterruptedException e) {
537            logger.error("", e);
538          }
539          try (Jedis j = createJedis()) {
540            j.lpush(bfoo, bA);
541          }
542        }
543      }).start();
544      byte[] belement = jedis.brpoplpush(bfoo, bbar, 0);
545      assertArrayEquals(bA, belement);
546      assertEquals(1, jedis.llen("bar"));
547      assertArrayEquals(bA, jedis.lrange(bbar, 0, -1).get(0));
548    }
549    @Test
550    public void lpos() {
551      jedis.rpush("foo", "a");
552      jedis.rpush("foo", "b");
553      jedis.rpush("foo", "c");
554      Long pos = jedis.lpos("foo", "b");
555      assertEquals(1, pos.intValue());
556      pos = jedis.lpos("foo", "d");
557      assertNull(pos);
558      jedis.rpush("foo", "a");
559      jedis.rpush("foo", "b");
560      jedis.rpush("foo", "b");
561      pos = jedis.lpos("foo", "b", LPosParams.lPosParams());
562      assertEquals(1, pos.intValue());
563      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(3));
564      assertEquals(5, pos.intValue());
565      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2));
566      assertEquals(4, pos.intValue());
567      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-5));
568      assertNull(pos);
569      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(1).maxlen(2));
570      assertEquals(1, pos.intValue());
571      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2).maxlen(2));
572      assertNull(pos);
573      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2).maxlen(2));
574      assertEquals(4, pos.intValue());
575      List<Long> expected = new ArrayList<Long>();
576      expected.add(1L);
577      expected.add(4L);
578      expected.add(5L);
579      List<Long> posList = jedis.lpos("foo", "b", LPosParams.lPosParams(), 2);
580      assertEquals(expected.subList(0, 2), posList);
581      posList = jedis.lpos("foo", "b", LPosParams.lPosParams(), 0);
582      assertEquals(expected, posList);
583      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2), 0);
584      assertEquals(expected.subList(1, 3), posList);
585      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2).maxlen(5), 0);
586      assertEquals(expected.subList(1, 2), posList);
587      Collections.reverse(expected);
588      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2), 0);
589      assertEquals(expected.subList(1, 3), posList);
590      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-1).maxlen(5), 2);
591      assertEquals(expected.subList(0, 2), posList);
592      jedis.rpush(bfoo, bA);
593      jedis.rpush(bfoo, bB);
594      jedis.rpush(bfoo, bC);
595      pos = jedis.lpos(bfoo, bB);
596      assertEquals(1, pos.intValue());
597      pos = jedis.lpos(bfoo, b3);
598      assertNull(pos);
599      jedis.rpush(bfoo, bA);
600      jedis.rpush(bfoo, bB);
601      jedis.rpush(bfoo, bA);
602      pos = jedis.lpos(bfoo, bB, LPosParams.lPosParams().rank(2));
603      assertEquals(4, pos.intValue());
604      pos = jedis.lpos(bfoo, bB, LPosParams.lPosParams().rank(-2).maxlen(5));
605      assertEquals(1, pos.intValue());
606      expected.clear();
607      expected.add(0L);
608      expected.add(3L);
609      expected.add(5L);
610      posList = jedis.lpos(bfoo, bA, LPosParams.lPosParams().maxlen(6), 0);
611      assertEquals(expected, posList);
612      posList = jedis.lpos(bfoo, bA, LPosParams.lPosParams().maxlen(6).rank(2), 1);
613      assertEquals(expected.subList(1, 2), posList);
614    }
615    @Test
616    public void lmove() {
617      jedis.rpush("foo", "bar1", "bar2", "bar3");
618      assertEquals("bar3", jedis.lmove("foo", "bar", ListDirection.RIGHT, ListDirection.LEFT));
619      assertEquals(Collections.singletonList("bar3"), jedis.lrange("bar", 0, -1));
620      assertEquals(Arrays.asList("bar1", "bar2"), jedis.lrange("foo", 0, -1));
621      jedis.rpush(bfoo, b1, b2, b3);
622      assertArrayEquals(b3, jedis.lmove(bfoo, bbar, ListDirection.RIGHT, ListDirection.LEFT));
623      assertByteArrayListEquals(Collections.singletonList(b3), jedis.lrange(bbar, 0, -1));
624      assertByteArrayListEquals(Arrays.asList(b1, b2), jedis.lrange(bfoo, 0, -1));
625    }
626    @Test
627    public void blmove() {
628      new Thread(() -> {
629        try {
630          Thread.sleep(100);
631        } catch (InterruptedException e) {
632          logger.error("", e);
633        }
634        try (Jedis j = createJedis()) {
635          j.rpush("foo", "bar1", "bar2", "bar3");
636        }
637      }).start();
638      assertEquals("bar3", jedis.blmove("foo", "bar", ListDirection.RIGHT, ListDirection.LEFT, 0));
639      assertEquals(Collections.singletonList("bar3"), jedis.lrange("bar", 0, -1));
640      assertEquals(Arrays.asList("bar1", "bar2"), jedis.lrange("foo", 0, -1));
641      new Thread(() -> {
642        try {
643          Thread.sleep(100);
644        } catch (InterruptedException e) {
645          logger.error("", e);
646        }
647        try (Jedis j = createJedis()) {
648          j.rpush(bfoo, b1, b2, b3);
649        }
650      }).start();
651      assertArrayEquals(b3, jedis.blmove(bfoo, bbar, ListDirection.RIGHT, ListDirection.LEFT, 0));
652      assertByteArrayListEquals(Collections.singletonList(b3), jedis.lrange(bbar, 0, -1));
653      assertByteArrayListEquals(Arrays.asList(b1, b2), jedis.lrange(bfoo, 0, -1));
654    }
655    @Test
656    public void lmpop() {
657      String mylist1 = "mylist1";
658      String mylist2 = "mylist2";
659      jedis.lpush(mylist1, "one", "two", "three", "four", "five");
660      jedis.lpush(mylist2, "one", "two", "three", "four", "five");
661      KeyValue<String, List<String>> elements = jedis.lmpop(ListDirection.LEFT, mylist1, mylist2);
662      assertEquals(mylist1, elements.getKey());
663      assertEquals(1, elements.getValue().size());
664      elements = jedis.lmpop(ListDirection.LEFT, 5, mylist1, mylist2);
665      assertEquals(mylist1, elements.getKey());
666      assertEquals(4, elements.getValue().size());
667      elements = jedis.lmpop(ListDirection.RIGHT, 100, mylist1, mylist2);
668      assertEquals(mylist2, elements.getKey());
669      assertEquals(5, elements.getValue().size());
670      elements = jedis.lmpop(ListDirection.RIGHT, mylist1, mylist2);
671      assertNull(elements);
672    }
673    @Test
674    public void blmpopSimple() {
675      String mylist1 = "mylist1";
676      String mylist2 = "mylist2";
677      jedis.lpush(mylist1, "one", "two", "three", "four", "five");
678      jedis.lpush(mylist2, "one", "two", "three", "four", "five");
679      KeyValue<String, List<String>> elements = jedis.blmpop(1L, ListDirection.LEFT, mylist1, mylist2);
680      assertEquals(mylist1, elements.getKey());
681      assertEquals(1, elements.getValue().size());
682      elements = jedis.blmpop(1L, ListDirection.LEFT, 5, mylist1, mylist2);
683      assertEquals(mylist1, elements.getKey());
684      assertEquals(4, elements.getValue().size());
685      elements = jedis.blmpop(1L, ListDirection.RIGHT, 100, mylist1, mylist2);
686      assertEquals(mylist2, elements.getKey());
687      assertEquals(5, elements.getValue().size());
688      elements = jedis.blmpop(1L, ListDirection.RIGHT, mylist1, mylist2);
689      assertNull(elements);
690    }
691  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTestBase.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ListCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>160      String status = jedis.rename("foo", "bar");
161      assertEquals("OK", status);
162      assertNull(jedis.get("foo"));
163      assertEquals("bar", jedis.get("bar"));
164      jedis.set(bfoo, bbar);
165      String bstatus = jedis.rename(bfoo, bbar);
166      assertEquals("OK", bstatus);
167      assertNull(jedis.get(bfoo));
168      assertArrayEquals(bbar, jedis.get(bbar));
</pre></code></div>
                <div class="column column_space"><pre><code>339      result = jedis.blpop(1d, "foo1", "foo");
340      assertNotNull(result);
341      assertEquals("foo1", result.getKey());
342      assertEquals("bar1", result.getValue());
343      jedis.lpush(bfoo, bbar);
344      KeyValue<byte[], byte[]> bresult = jedis.blpop(3.12, bfoo);
345      assertNotNull(bresult);
346      assertArrayEquals(bfoo, bresult.getKey());
347      assertArrayEquals(bbar, bresult.getValue());
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    