<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for ImmutableRangeSetTest.java & ImmutableListTest.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for ImmutableRangeSetTest.java & ImmutableListTest.java
      </h3>
      <h1 align="center">
        30.7%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>ImmutableRangeSetTest.java (34.46215%)<TH>ImmutableListTest.java (27.76886%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#0',2,'match71742-1.html#0',3)" NAME="0">(205-228)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#0',2,'match71742-1.html#0',3)" NAME="0">(503-522)</A><TD ALIGN=center><FONT COLOR="#ff0000">48</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#1',2,'match71742-1.html#1',3)" NAME="1">(134-145)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#1',2,'match71742-1.html#1',3)" NAME="1">(666-675)</A><TD ALIGN=center><FONT COLOR="#7a0000">23</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#2',2,'match71742-1.html#2',3)" NAME="2">(167-178)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#2',2,'match71742-1.html#2',3)" NAME="2">(742-755)</A><TD ALIGN=center><FONT COLOR="#5a0000">17</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#3',2,'match71742-1.html#3',3)" NAME="3">(17-38)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#3',2,'match71742-1.html#3',3)" NAME="3">(44-66)</A><TD ALIGN=center><FONT COLOR="#550000">16</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#4',2,'match71742-1.html#4',3)" NAME="4">(498-509)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#4',2,'match71742-1.html#4',3)" NAME="4">(724-732)</A><TD ALIGN=center><FONT COLOR="#4f0000">15</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#5',2,'match71742-1.html#5',3)" NAME="5">(511-518)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#5',2,'match71742-1.html#5',3)" NAME="5">(405-413)</A><TD ALIGN=center><FONT COLOR="#4a0000">14</FONT>
<TR><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#6',2,'match71742-1.html#6',3)" NAME="6">(597-604)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#6',2,'match71742-1.html#6',3)" NAME="6">(709-714)</A><TD ALIGN=center><FONT COLOR="#3f0000">12</FONT>
<TR><TD BGCOLOR="#38a4a5"><FONT COLOR="#38a4a5">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#7',2,'match71742-1.html#7',3)" NAME="7">(541-545)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#7',2,'match71742-1.html#7',3)" NAME="7">(494-501)</A><TD ALIGN=center><FONT COLOR="#3f0000">12</FONT>
<TR><TD BGCOLOR="#c58917"><FONT COLOR="#c58917">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#8',2,'match71742-1.html#8',3)" NAME="8">(373-380)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#8',2,'match71742-1.html#8',3)" NAME="8">(763-770)</A><TD ALIGN=center><FONT COLOR="#3f0000">12</FONT>
<TR><TD BGCOLOR="#83a33a"><FONT COLOR="#83a33a">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#9',2,'match71742-1.html#9',3)" NAME="9">(311-319)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#9',2,'match71742-1.html#9',3)" NAME="9">(643-650)</A><TD ALIGN=center><FONT COLOR="#3f0000">12</FONT>
<TR><TD BGCOLOR="#ad5910"><FONT COLOR="#ad5910">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#10',2,'match71742-1.html#10',3)" NAME="10">(104-117)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#10',2,'match71742-1.html#10',3)" NAME="10">(72-78)</A><TD ALIGN=center><FONT COLOR="#3f0000">12</FONT>
<TR><TD BGCOLOR="#b041ff"><FONT COLOR="#b041ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#11',2,'match71742-1.html#11',3)" NAME="11">(493-498)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#11',2,'match71742-1.html#11',3)" NAME="11">(138-144)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#571b7e"><FONT COLOR="#571b7e">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#12',2,'match71742-1.html#12',3)" NAME="12">(482-487)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#12',2,'match71742-1.html#12',3)" NAME="12">(128-134)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#3b9c9c"><FONT COLOR="#3b9c9c">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#13',2,'match71742-1.html#13',3)" NAME="13">(380-387)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#13',2,'match71742-1.html#13',3)" NAME="13">(253-259)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#842dce"><FONT COLOR="#842dce">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#14',2,'match71742-1.html#14',3)" NAME="14">(357-364)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#14',2,'match71742-1.html#14',3)" NAME="14">(244-250)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#f52887"><FONT COLOR="#f52887">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#15',2,'match71742-1.html#15',3)" NAME="15">(341-348)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#15',2,'match71742-1.html#15',3)" NAME="15">(212-218)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#2981b2"><FONT COLOR="#2981b2">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#16',2,'match71742-1.html#16',3)" NAME="16">(325-332)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#16',2,'match71742-1.html#16',3)" NAME="16">(204-210)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#3090c7"><FONT COLOR="#3090c7">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#17',2,'match71742-1.html#17',3)" NAME="17">(283-290)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#17',2,'match71742-1.html#17',3)" NAME="17">(118-124)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#800517"><FONT COLOR="#800517">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#18',2,'match71742-1.html#18',3)" NAME="18">(252-262)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#18',2,'match71742-1.html#18',3)" NAME="18">(715-721)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#f62817"><FONT COLOR="#f62817">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#19',2,'match71742-1.html#19',3)" NAME="19">(150-155)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#19',2,'match71742-1.html#19',3)" NAME="19">(393-398)</A><TD ALIGN=center><FONT COLOR="#3a0000">11</FONT>
<TR><TD BGCOLOR="#4e9258"><FONT COLOR="#4e9258">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#20',2,'match71742-1.html#20',3)" NAME="20">(534-538)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#20',2,'match71742-1.html#20',3)" NAME="20">(264-269)</A><TD ALIGN=center><FONT COLOR="#2f0000">9</FONT>
<TR><TD BGCOLOR="#947010"><FONT COLOR="#947010">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#21',2,'match71742-1.html#21',3)" NAME="21">(521-524)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#21',2,'match71742-1.html#21',3)" NAME="21">(331-336)</A><TD ALIGN=center><FONT COLOR="#2f0000">9</FONT>
<TR><TD BGCOLOR="#4cc417"><FONT COLOR="#4cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#22',2,'match71742-1.html#22',3)" NAME="22">(433-437)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#22',2,'match71742-1.html#22',3)" NAME="22">(285-289)</A><TD ALIGN=center><FONT COLOR="#2f0000">9</FONT>
<TR><TD BGCOLOR="#f660ab"><FONT COLOR="#f660ab">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#23',2,'match71742-1.html#23',3)" NAME="23">(201-205)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#23',2,'match71742-1.html#23',3)" NAME="23">(277-283)</A><TD ALIGN=center><FONT COLOR="#2f0000">9</FONT>
<TR><TD BGCOLOR="#79764d"><FONT COLOR="#79764d">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#24',2,'match71742-1.html#24',3)" NAME="24">(178-184)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#24',2,'match71742-1.html#24',3)" NAME="24">(149-154)</A><TD ALIGN=center><FONT COLOR="#2f0000">9</FONT>
<TR><TD BGCOLOR="#5eac10"><FONT COLOR="#5eac10">-</FONT><TD><A HREF="javascript:ZweiFrames('match71742-0.html#25',2,'match71742-1.html#25',3)" NAME="25">(97-102)<TD><A HREF="javascript:ZweiFrames('match71742-0.html#25',2,'match71742-1.html#25',3)" NAME="25">(345-350)</A><TD ALIGN=center><FONT COLOR="#2f0000">9</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>ImmutableRangeSetTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2012 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */
<A NAME="3"></A>
package com.google.common.collect;

<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match71742-1.html#3',3,'match71742-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>import static com.google.common.truth.Truth.assertThat;

import com.google.common.annotations.GwtIncompatible;
import com.google.common.collect.testing.NavigableSetTestSuiteBuilder;
import com.google.common.collect.testing.SampleElements;
import com.google.common.collect.testing.TestSetGenerator;
import com.google.common.collect.testing.features.CollectionFeature;
import com.google.common.collect.testing.features.CollectionSize;
import com.google.common.testing.CollectorTester;
import com.google.common.testing.SerializableTester;
import java.math.BigInteger;
import java.util.List;
import java.util.Set;
import junit.framework.Test;
import junit.framework.TestSuite;

/**
 * Tests for {@link ImmutableRangeSet}.
 *
 * @author Louis Wasserman
 */
@</B></FONT>GwtIncompatible // ImmutableRangeSet
public class ImmutableRangeSetTest extends AbstractRangeSetTest {

  static final class ImmutableRangeSetIntegerAsSetGenerator implements TestSetGenerator&lt;Integer&gt; {
    @Override
    public SampleElements&lt;Integer&gt; samples() {
      return new SampleElements&lt;&gt;(1, 4, 3, 2, 5);
    }

    @Override
    public Integer[] createArray(int length) {
      return new Integer[length];
    }

    @Override
    public Iterable&lt;Integer&gt; order(List&lt;Integer&gt; insertionOrder) {
      return Ordering.natural().sortedCopy(insertionOrder);
    }

    @Override
    public Set&lt;Integer&gt; create(Object... elements) {
      ImmutableRangeSet.Builder&lt;Integer&gt; builder = ImmutableRangeSet.builder();
      for (Object o : elements) {
        Integer i = (Integer) o;
        builder.add(Range.singleton(i));
      }
      return builder.build().asSet(DiscreteDomain.integers());
    }
  }

  static final class ImmutableRangeSetBigIntegerAsSetGenerator
      implements TestSetGenerator&lt;BigInteger&gt; {
    @Override
    public SampleElements&lt;BigInteger&gt; samples() {
      return new SampleElements&lt;&gt;(
          BigInteger.valueOf(1),
          BigInteger.valueOf(4),
          BigInteger.valueOf(3),
          BigInteger.valueOf(2),
          BigInteger.valueOf(5));
    }

    @Override
    public BigInteger[] createArray(int length) {
      return new BigInteger[length];
    }

    @Override
    public Iterable&lt;BigInteger&gt; order(List&lt;BigInteger&gt; insertionOrder) {
      return Ordering.natural().sortedCopy(insertionOrder);
    }

    @Override
    public Set&lt;BigInteger&gt; create(Object... elements) {
      ImmutableRangeSet.Builder&lt;BigInteger&gt; builder = ImmutableRangeSet.builder();
      for (Object o : elements) {
<A NAME="25"></A>        BigInteger i = (BigInteger) o;
        builder.add(Range.closedOpen(i, i.add(BigInteger.ONE)));
      }
      return <FONT color="#5eac10"><A HREF="javascript:ZweiFrames('match71742-1.html#25',3,'match71742-top.html#25',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>builder.build().asSet(DiscreteDomain.bigIntegers());
    }
  }

<A NAME="10"></A>  public static Test suite() {
    TestSuite suite = new</B></FONT> TestSuite();
    suite.addTestSuite(ImmutableRangeSetTest.class);
    <FONT color="#ad5910"><A HREF="javascript:ZweiFrames('match71742-1.html#10',3,'match71742-top.html#10',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>suite.addTest(
        NavigableSetTestSuiteBuilder.using(new ImmutableRangeSetIntegerAsSetGenerator())
            .named(&quot;ImmutableRangeSet.asSet[DiscreteDomain.integers[]]&quot;)
            .withFeatures(
                CollectionSize.ANY,
                CollectionFeature.REJECTS_DUPLICATES_AT_CREATION,
                CollectionFeature.ALLOWS_NULL_QUERIES,
                CollectionFeature.KNOWN_ORDER,
                CollectionFeature.NON_STANDARD_TOSTRING,
                CollectionFeature.SERIALIZABLE)
            .createTestSuite());

    suite.addTest(
        NavigableSetTestSuiteBuilder.using(new</B></FONT> ImmutableRangeSetBigIntegerAsSetGenerator())
            .named(&quot;ImmutableRangeSet.asSet[DiscreteDomain.bigIntegers[]]&quot;)
            .withFeatures(
                CollectionSize.ANY,
                CollectionFeature.REJECTS_DUPLICATES_AT_CREATION,
                CollectionFeature.ALLOWS_NULL_QUERIES,
                CollectionFeature.KNOWN_ORDER,
                CollectionFeature.NON_STANDARD_TOSTRING,
                CollectionFeature.SERIALIZABLE)
            .createTestSuite());
    return suite;
  }

  public void testEmpty() {
<A NAME="1"></A>    ImmutableRangeSet&lt;Integer&gt; rangeSet = ImmutableRangeSet.of();

    assertThat(rangeSet.asRanges()).isEmpty();
    assertEquals(ImmutableRangeSet.&lt;Integer&gt;all(), <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match71742-1.html#1',3,'match71742-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>rangeSet.complement());
    assertFalse(rangeSet.contains(0));
    assertFalse(rangeSet.intersects(Range.singleton(0)));
    assertFalse(rangeSet.encloses(Range.singleton(0)));
    assertTrue(rangeSet.enclosesAll(rangeSet));
    assertTrue(rangeSet.isEmpty());
  }

  public void testAll() {
    ImmutableRangeSet&lt;Integer&gt; rangeSet = ImmutableRangeSet.all();

    assertThat(rangeSet.asRanges()).contains(Range.&lt;Integer&gt;all</B></FONT>());
    assertTrue(rangeSet.contains(0));
<A NAME="19"></A>    assertTrue(rangeSet.intersects(Range.singleton(0)));
    assertTrue(rangeSet.intersects(Range.&lt;Integer&gt;all()));
    assertTrue(rangeSet.encloses(Range.&lt;Integer&gt;all()));
    <FONT color="#f62817"><A HREF="javascript:ZweiFrames('match71742-1.html#19',3,'match71742-top.html#19',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertTrue(rangeSet.enclosesAll(rangeSet));
    assertEquals(ImmutableRangeSet.&lt;Integer&gt;of(), rangeSet.complement());
  }

  public void testSingleBoundedRange() {
    ImmutableRangeSet&lt;Integer&gt; rangeSet = ImmutableRangeSet.of</B></FONT>(Range.closedOpen(1, 5));

    assertThat(rangeSet.asRanges()).contains(Range.closedOpen(1, 5));

    assertTrue(rangeSet.intersects(Range.closed(3, 4)));
    assertTrue(rangeSet.intersects(Range.closedOpen(0, 2)));
    assertTrue(rangeSet.intersects(Range.closedOpen(3, 7)));
    assertTrue(rangeSet.intersects(Range.greaterThan(2)));
    assertFalse(rangeSet.intersects(Range.greaterThan(7)));
<A NAME="2"></A>
    assertTrue(rangeSet.encloses(Range.closed(3, 4)));
    assertTrue(rangeSet.encloses(Range.closedOpen(1, 4)));
    assertTrue(rangeSet.encloses(<FONT color="#980517"><A HREF="javascript:ZweiFrames('match71742-1.html#2',3,'match71742-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Range.closedOpen(1, 5)));
    assertFalse(rangeSet.encloses(Range.greaterThan(2)));

    assertTrue(rangeSet.contains(3));
    assertFalse(rangeSet.contains(5));
    assertFalse(rangeSet.contains(0));

    RangeSet&lt;Integer&gt; expectedComplement = TreeRangeSet.create();
<A NAME="24"></A>    expectedComplement.add(Range.lessThan(1));
    expectedComplement.add(Range.atLeast(5));

    assertEquals</B></FONT>(expectedComplement, <FONT color="#79764d"><A HREF="javascript:ZweiFrames('match71742-1.html#24',3,'match71742-top.html#24',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>rangeSet.complement());
  }

  public void testSingleBoundedBelowRange() {
    ImmutableRangeSet&lt;Integer&gt; rangeSet = ImmutableRangeSet.of(Range.greaterThan(2));

    assertThat(rangeSet.asRanges()).contains</B></FONT>(Range.greaterThan(2));

    assertTrue(rangeSet.intersects(Range.closed(3, 4)));
    assertTrue(rangeSet.intersects(Range.closedOpen(1, 5)));
    assertFalse(rangeSet.intersects(Range.lessThan(1)));
    assertTrue(rangeSet.intersects(Range.greaterThan(1)));
    assertTrue(rangeSet.intersects(Range.greaterThan(3)));

    assertTrue(rangeSet.encloses(Range.closed(3, 4)));
    assertTrue(rangeSet.encloses(Range.greaterThan(3)));
    assertFalse(rangeSet.encloses(Range.closedOpen(1, 5)));

    assertTrue(rangeSet.contains(3));
    assertTrue(rangeSet.contains(5));
<A NAME="23"></A>    assertFalse(rangeSet.contains(0));
    assertFalse(rangeSet.contains(2));

    <FONT color="#f660ab"><A HREF="javascript:ZweiFrames('match71742-1.html#23',3,'match71742-top.html#23',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertEquals(ImmutableRangeSet.of(Range.atMost(2)), rangeSet.complement());
<A NAME="0"></A>  }

  public void testSingleBoundedAboveRange() {
    ImmutableRangeSet&lt;Integer&gt; rangeSet = <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match71742-1.html#0',3,'match71742-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ImmutableRangeSet.of(Range.atMost(3))</B></FONT>;

    assertThat(rangeSet.asRanges()).contains(Range.atMost(3));

    assertTrue(rangeSet.intersects(Range.closed(3, 4)));
    assertTrue(rangeSet.intersects(Range.closedOpen(1, 5)));
    assertFalse(rangeSet.intersects(Range.closedOpen(4, 5)));
    assertTrue(rangeSet.intersects(Range.lessThan(1)));
    assertTrue(rangeSet.intersects(Range.greaterThan(1)));
    assertFalse(rangeSet.intersects(Range.greaterThan(3)));

    assertTrue(rangeSet.encloses(Range.closed(2, 3)));
    assertTrue(rangeSet.encloses(Range.lessThan(1)));
    assertFalse(rangeSet.encloses(Range.closedOpen(1, 5)));

    assertTrue(rangeSet.contains(3));
    assertTrue(rangeSet.contains(0));
    assertFalse(rangeSet.contains(4));
    assertFalse(rangeSet.contains(5));

    assertEquals(ImmutableRangeSet.of(Range.greaterThan(3)), rangeSet.complement());
  }

  public void testMultipleB</B></FONT>oundedRanges() {
    ImmutableRangeSet&lt;Integer&gt; rangeSet =
        ImmutableRangeSet.&lt;Integer&gt;builder()
            .add(Range.closed(5, 8))
            .add(Range.closedOpen(1, 3))
            .build();

    assertThat(rangeSet.asRanges())
        .containsExactly(Range.closedOpen(1, 3), Range.closed(5, 8))
        .inOrder();

    assertTrue(rangeSet.intersects(Range.closed(1, 2)));
    assertTrue(rangeSet.intersects(Range.open(5, 8)));
    assertFalse(rangeSet.intersects(Range.closed(3, 4)));
    assertTrue(rangeSet.intersects(Range.greaterThan(5)));
    assertFalse(rangeSet.intersects(Range.greaterThan(8)));

    assertTrue(rangeSet.encloses(Range.closed(1, 2)));
    assertTrue(rangeSet.encloses(Range.open(5, 8)));
    assertFalse(rangeSet.encloses(Range.closed(1, 8)));
    assertFalse(rangeSet.encloses(Range.greaterThan(5)));
<A NAME="18"></A>
    RangeSet&lt;Integer&gt; expectedComplement =
        ImmutableRangeSet.&lt;Integer&gt;builder()
            .add(<FONT color="#800517"><A HREF="javascript:ZweiFrames('match71742-1.html#18',3,'match71742-top.html#18',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Range.lessThan(1))
            .add(Range.closedOpen(3, 5))
            .add(Range.greaterThan(8))
            .build();

    assertEquals(expectedComplement, rangeSet.complement());
  }

  public void testMultipleBoundedBelowRanges() {
    ImmutableRangeSet&lt;Integer&gt; rangeSet =
        ImmutableRangeSet.&lt;Integer&gt;builder()</B></FONT>
            .add(Range.greaterThan(6))
            .add(Range.closedOpen(1, 3))
            .build();

    assertThat(rangeSet.asRanges())
        .containsExactly(Range.closedOpen(1, 3), Range.greaterThan(6))
        .inOrder();

    assertTrue(rangeSet.intersects(Range.closed(1, 2)));
    assertTrue(rangeSet.intersects(Range.open(6, 8)));
    assertFalse(rangeSet.intersects(Range.closed(3, 6)));
    assertTrue(rangeSet.intersects(Range.greaterThan(5)));
    assertFalse(rangeSet.intersects(Range.lessThan(1)));

    assertTrue(rangeSet.encloses(Range.closed(1, 2)));
    assertTrue(rangeSet.encloses(Range.open(6, 8)));
    assertFalse(rangeSet.encloses(Range.closed(1, 8)));
<A NAME="17"></A>    assertFalse(rangeSet.encloses(Range.greaterThan(5)));

    RangeSet&lt;Integer&gt; expectedComplement =
        ImmutableRangeSet.&lt;Integer&gt;builder().add(Range.lessThan(1)).add(<FONT color="#3090c7"><A HREF="javascript:ZweiFrames('match71742-1.html#17',3,'match71742-top.html#17',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Range.closed(3, 6)).build();

    assertEquals(expectedComplement, rangeSet.complement());
  }

  public void testMultipleBoundedAboveRanges() {
    ImmutableRangeSet&lt;Integer&gt; rangeSet =
        ImmutableRangeSet.&lt;Integer&gt;builder()</B></FONT>
            .add(Range.atMost(0))
            .add(Range.closedOpen(2, 5))
            .build();

    assertThat(rangeSet.asRanges())
        .containsExactly(Range.atMost(0), Range.closedOpen(2, 5))
        .inOrder();

    assertTrue(rangeSet.intersects(Range.closed(2, 4)));
    assertTrue(rangeSet.intersects(Range.open(-5, -2)));
    assertTrue(rangeSet.intersects(Range.closed(1, 8)));
    assertFalse(rangeSet.intersects(Range.singleton(1)));
    assertFalse(rangeSet.intersects(Range.greaterThan(5)));

    assertTrue(rangeSet.encloses(Range.closed(2, 4)));
    assertTrue(rangeSet.encloses(Range.open(-5, -2)));
    assertFalse(rangeSet.encloses(Range.closed(1, 8)));
<A NAME="9"></A>    assertFalse(rangeSet.encloses(Range.greaterThan(5)));

    RangeSet&lt;Integer&gt; expectedComplement =
        ImmutableRangeSet.&lt;Integer&gt;builder().add(Range.open(0, 2)).add(<FONT color="#83a33a"><A HREF="javascript:ZweiFrames('match71742-1.html#9',3,'match71742-top.html#9',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Range.atLeast(5)).build();

    assertEquals(expectedComplement, rangeSet.complement());
  }

  @SuppressWarnings(&quot;DoNotCall&quot;)
  public void testAddUnsupported() {
    RangeSet&lt;Integer&gt; rangeSet =
        ImmutableRangeSet.&lt;Integer&gt;builder()</B></FONT>
            .add(Range.closed(5, 8))
            .add(Range.closedOpen(1, 3))
<A NAME="16"></A>            .build();

    try {
      rangeSet.add(<FONT color="#2981b2"><A HREF="javascript:ZweiFrames('match71742-1.html#16',3,'match71742-top.html#16',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Range.open(3, 4));
      fail();
    } catch (UnsupportedOperationException expected) {
      // success
    }
  }

  @SuppressWarnings(&quot;Do</B></FONT>NotCall&quot;)
  public void testAddAllUnsupported() {
    RangeSet&lt;Integer&gt; rangeSet =
        ImmutableRangeSet.&lt;Integer&gt;builder()
            .add(Range.closed(5, 8))
            .add(Range.closedOpen(1, 3))
<A NAME="15"></A>            .build();

    try {
      rangeSet.addAll(<FONT color="#f52887"><A HREF="javascript:ZweiFrames('match71742-1.html#15',3,'match71742-top.html#15',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ImmutableRangeSet.&lt;Integer&gt;of());
      fail();
    } catch (UnsupportedOperationException expected) {
      // success
    }
  }

  @SuppressWarnings(&quot;Do</B></FONT>NotCall&quot;)
  public void testRemoveUnsupported() {
    RangeSet&lt;Integer&gt; rangeSet =
        ImmutableRangeSet.&lt;Integer&gt;builder()
            .add(Range.closed(5, 8))
            .add(Range.closedOpen(1, 3))
<A NAME="14"></A>            .build();

    try {
      rangeSet.remove(<FONT color="#842dce"><A HREF="javascript:ZweiFrames('match71742-1.html#14',3,'match71742-top.html#14',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Range.closed(6, 7));
      fail();
    } catch (UnsupportedOperationException expected) {
      // success
    }
  }

  @SuppressWarnings(&quot;DoNot</B></FONT>Call&quot;)
  public void testRemoveAllUnsupported() {
    RangeSet&lt;Integer&gt; rangeSet =
        ImmutableRangeSet.&lt;Integer&gt;builder()
            .add(Range.closed(5, 8))
            .add(Range.closedOpen(1, 3))
<A NAME="8"></A>            .build();

    try {
      rangeSet.removeAll(<FONT color="#c58917"><A HREF="javascript:ZweiFrames('match71742-1.html#8',3,'match71742-top.html#8',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ImmutableRangeSet.&lt;Integer&gt;of());
      fail();
    } catch (UnsupportedOperationException expected) {
      // success
<A NAME="13"></A>    }

    try {
      rangeSet.removeAll(ImmutableRangeSet.of</B></FONT>(<FONT color="#3b9c9c"><A HREF="javascript:ZweiFrames('match71742-1.html#13',3,'match71742-top.html#13',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Range.closed(6, 8)));
      fail();
    } catch (UnsupportedOperationException expected) {
      // success
    }
  }

  @AndroidIncomp</B></FONT>atible // slow
  public void testExhaustive() {
    @SuppressWarnings(&quot;unchecked&quot;)
    ImmutableSet&lt;Range&lt;Integer&gt;&gt; ranges =
        ImmutableSet.of(
            Range.&lt;Integer&gt;all(),
            Range.&lt;Integer&gt;closedOpen(3, 5),
            Range.singleton(1),
            Range.lessThan(2),
            Range.greaterThan(10),
            Range.atMost(4),
            Range.atLeast(3),
            Range.closed(4, 6),
            Range.closedOpen(1, 3),
            Range.openClosed(5, 7),
            Range.open(3, 4));
    subsets:
    for (Set&lt;Range&lt;Integer&gt;&gt; subset : Sets.powerSet(ranges)) {
      assertEquals(TreeRangeSet.create(subset), ImmutableRangeSet.unionOf(subset));

      RangeSet&lt;Integer&gt; mutable = TreeRangeSet.create();
      ImmutableRangeSet.Builder&lt;Integer&gt; builder = ImmutableRangeSet.builder();

      boolean anyOverlaps = false;
      for (Range&lt;Integer&gt; range : subset) {
        boolean overlaps = false;
        for (Range&lt;Integer&gt; other : mutable.asRanges()) {
          if (other.isConnected(range) &amp;&amp; !other.intersection(range).isEmpty()) {
            overlaps = true;
            anyOverlaps = true;
            break;
          }
        }

        try {
          ImmutableRangeSet&lt;Integer&gt; unused = builder.add(range).build();
          assertFalse(overlaps);
          mutable.add(range);
        } catch (IllegalArgumentException e) {
          assertTrue(overlaps);
          continue subsets;
        }
      }
<A NAME="22"></A>
      if (anyOverlaps) {
        try {
          RangeSet&lt;Integer&gt; copy = <FONT color="#4cc417"><A HREF="javascript:ZweiFrames('match71742-1.html#22',3,'match71742-top.html#22',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ImmutableRangeSet.copyOf(subset);
          fail();
        } catch (IllegalArgumentException expected) {
        }
      }</B></FONT> else {
        RangeSet&lt;Integer&gt; copy = ImmutableRangeSet.copyOf(subset);
        assertEquals(mutable, copy);
      }

      ImmutableRangeSet&lt;Integer&gt; built = builder.build();
      assertEquals(mutable, built);
      assertEquals(ImmutableRangeSet.copyOf(mutable), built);
      assertEquals(mutable.complement(), built.complement());

      for (int i = 0; i &lt;= 11; i++) {
        assertEquals(mutable.contains(i), built.contains(i));
      }

      SerializableTester.reserializeAndAssert(built);
      SerializableTester.reserializeAndAssert(built.asRanges());
    }
  }

  private static final ImmutableRangeSet&lt;Integer&gt; RANGE_SET_ONE =
      ImmutableRangeSet.&lt;Integer&gt;builder()
          .add(Range.closed(2, 4))
          .add(Range.open(6, 7))
          .add(Range.closedOpen(8, 10))
          .add(Range.openClosed(15, 17))
          .build();

  private static final ImmutableRangeSet&lt;Integer&gt; RANGE_SET_TWO =
      ImmutableRangeSet.&lt;Integer&gt;builder()
          .add(Range.openClosed(0, 3))
          .add(Range.closed(5, 8))
          .add(Range.closedOpen(12, 15))
          .add(Range.open(19, 20))
          .build();

  public void testUnion() {
    RangeSet&lt;Integer&gt; expected =
        ImmutableRangeSet.&lt;Integer&gt;builder()
            .add(Range.openClosed(0, 4))
            .add(Range.closedOpen(5, 10))
            .add(Range.closedOpen(12, 15))
            .add(Range.openClosed(15, 17))
<A NAME="12"></A>            .add(Range.open(19, 20))
            .build();

    <FONT color="#571b7e"><A HREF="javascript:ZweiFrames('match71742-1.html#12',3,'match71742-top.html#12',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertThat(RANGE_SET_ONE.union(RANGE_SET_TWO)).isEqualTo(expected);
  }

  public void testIntersection() {
    RangeSet&lt;Integer&gt; expected =
        ImmutableRangeSet.&lt;Integer&gt;builder()</B></FONT>
            .add(Range.closed(2, 3))
            .add(Range.open(6, 7))
<A NAME="11"></A>            .add(Range.singleton(8))
            .build();

    <FONT color="#b041ff"><A HREF="javascript:ZweiFrames('match71742-1.html#11',3,'match71742-top.html#11',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertThat(RANGE_SET_ONE.intersection(RANGE_SET_TWO)).isEqualTo(expected);
  }
<A NAME="4"></A>
  public void testDifference() {
    RangeSet&lt;Integer&gt; expected =
        <FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match71742-1.html#4',3,'match71742-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ImmutableRangeSet.&lt;Integer&gt;builder()</B></FONT>
            .add(Range.openClosed(3, 4))
            .add(Range.open(8, 10))
            .add(Range.openClosed(15, 17))
            .build();

    assertThat(RANGE_SET_ONE.difference(RANGE_SET_TWO)).isEqualTo(expected);
  }

  public void testAsSet() {
<A NAME="5"></A>    ImmutableSortedSet&lt;Integer&gt; expectedSet = ImmutableSortedSet.of(2, 3, 4, 8, 9, 16, 17);
    ImmutableSortedSet&lt;Integer&gt; asSet = RANGE_SET_ONE.asSet</B></FONT>(DiscreteDomain.integers());
    assertEquals(expectedSet, asSet);
    <FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match71742-1.html#5',3,'match71742-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertThat(asSet).containsExactlyElementsIn(expectedSet).inOrder();
    assertTrue(asSet.containsAll(expectedSet));
    SerializableTester.reserializeAndAssert(asSet);
  }

  public void testAsSetHeadSet() {
    ImmutableSortedSet&lt;Integer&gt; expectedSet = ImmutableSortedSet.of(2, 3, 4, 8, 9, 16, 17);
<A NAME="21"></A>    ImmutableSortedSet&lt;Integer&gt; asSet = RANGE_SET_ONE.asSet(DiscreteDomain.integers</B></FONT>());

    for (int i = 0; i &lt;= 20; i++) {
      <FONT color="#947010"><A HREF="javascript:ZweiFrames('match71742-1.html#21',3,'match71742-top.html#21',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertEquals(asSet.headSet(i, false), expectedSet.headSet(i, false));
      assertEquals(asSet.headSet(i, true), expectedSet.headSet(i, true));
    }
  }</B></FONT>

  public void testAsSetTailSet() {
    ImmutableSortedSet&lt;Integer&gt; expectedSet = ImmutableSortedSet.of(2, 3, 4, 8, 9, 16, 17);
    ImmutableSortedSet&lt;Integer&gt; asSet = RANGE_SET_ONE.asSet(DiscreteDomain.integers());

    for (int i = 0; i &lt;= 20; i++) {
<A NAME="20"></A>      assertEquals(asSet.tailSet(i, false), expectedSet.tailSet(i, false));
      assertEquals(asSet.tailSet(i, true), expectedSet.tailSet(i, true));
    }
  <FONT color="#4e9258"><A HREF="javascript:ZweiFrames('match71742-1.html#20',3,'match71742-top.html#20',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}

  public void testAsSetSubSet() {
    ImmutableSortedSet&lt;Integer&gt; expectedSet = ImmutableSortedSet.of(2, 3, 4, 8, 9, 16, 17);
<A NAME="7"></A>    ImmutableSortedSet&lt;Integer&gt; asSet = RANGE_SET_ONE.asSet(DiscreteDomain.integers</B></FONT>());

    for (int i = 0; i &lt;= 20; i++) {
      for (<FONT color="#38a4a5"><A HREF="javascript:ZweiFrames('match71742-1.html#7',3,'match71742-top.html#7',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>int j = i + 1; j &lt;= 20; j++) {
        assertEquals(expectedSet.subSet(i, false, j, false), asSet.subSet(i, false, j, false));
        assertEquals(expectedSet.subSet(i, true, j, false), asSet.subSet(i, true, j, false));
        assertEquals(expectedSet.subSet(i, false, j, true), asSet.subSet(i, false, j, true));
        assertEquals</B></FONT>(expectedSet.subSet(i, true, j, true), asSet.subSet(i, true, j, true));
      }
    }
  }

  public void testSubRangeSet() {
    ImmutableList.Builder&lt;Range&lt;Integer&gt;&gt; rangesBuilder = ImmutableList.builder();
    rangesBuilder.add(Range.&lt;Integer&gt;all());
    for (int i = -2; i &lt;= 2; i++) {
      for (BoundType boundType : BoundType.values()) {
        rangesBuilder.add(Range.upTo(i, boundType));
        rangesBuilder.add(Range.downTo(i, boundType));
      }
      for (int j = i + 1; j &lt;= 2; j++) {
        for (BoundType lbType : BoundType.values()) {
          for (BoundType ubType : BoundType.values()) {
            rangesBuilder.add(Range.range(i, lbType, j, ubType));
          }
        }
      }
    }
    ImmutableList&lt;Range&lt;Integer&gt;&gt; ranges = rangesBuilder.build();
    for (int i = -2; i &lt;= 2; i++) {
      rangesBuilder.add(Range.closedOpen(i, i));
      rangesBuilder.add(Range.openClosed(i, i));
    }
    ImmutableList&lt;Range&lt;Integer&gt;&gt; subRanges = rangesBuilder.build();
    for (Range&lt;Integer&gt; range1 : ranges) {
      for (Range&lt;Integer&gt; range2 : ranges) {
        if (!range1.isConnected(range2) || range1.intersection(range2).isEmpty()) {
          ImmutableRangeSet&lt;Integer&gt; rangeSet =
              ImmutableRangeSet.&lt;Integer&gt;builder().add(range1).add(range2).build();
          for (Range&lt;Integer&gt; subRange : subRanges) {
            RangeSet&lt;Integer&gt; expected = TreeRangeSet.create();
            for (Range&lt;Integer&gt; range : rangeSet.asRanges()) {
              if (range.isConnected(subRange)) {
                expected.add(range.intersection(subRange));
              }
            }
            ImmutableRangeSet&lt;Integer&gt; subRangeSet = rangeSet.subRangeSet(subRange);
            assertEquals(expected, subRangeSet);
            assertEquals(expected.asRanges(), subRangeSet.asRanges());
            if (!expected.isEmpty()) {
              assertEquals(expected.span(), subRangeSet.span());
            }
            for (int i = -3; i &lt;= 3; i++) {
              assertEquals(expected.contains(i), subRangeSet.contains(i));
            }
          }
<A NAME="6"></A>        }
      }
    }
  <FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match71742-1.html#6',3,'match71742-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}

  public void testToImmutableRangeSet() {
    Range&lt;Integer&gt; rangeOne = Range.closedOpen(1, 5);
    Range&lt;Integer&gt; rangeTwo = Range.openClosed(6, 7);
    ImmutableRangeSet&lt;Integer&gt; ranges =
        ImmutableRangeSet.copyOf(ImmutableList.of(rangeOne, rangeTwo));
    CollectorTester.of(ImmutableRangeSet.&lt;Integer&gt;toImmutableRangeSet())</B></FONT>
        .expectCollects(ranges, rangeOne, rangeTwo);
  }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>ImmutableListTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2007 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.google.common.collect;

import static com.google.common.collect.Iterables.getOnlyElement;
import static com.google.common.collect.Iterables.unmodifiableIterable;
import static com.google.common.collect.Sets.newHashSet;
import static com.google.common.collect.testing.features.CollectionFeature.ALLOWS_NULL_QUERIES;
import static com.google.common.collect.testing.features.CollectionFeature.SERIALIZABLE;
import static java.lang.reflect.Proxy.newProxyInstance;
import static java.util.Arrays.asList;

import com.google.common.annotations.GwtCompatible;
import com.google.common.annotations.GwtIncompatible;
import com.google.common.collect.testing.Helpers;
import com.google.common.collect.testing.ListTestSuiteBuilder;
import com.google.common.collect.testing.MinimalCollection;
import com.google.common.collect.testing.MinimalIterable;
import com.google.common.collect.testing.features.CollectionSize;
import com.google.common.collect.testing.google.ListGenerators.BuilderAddAllListGenerator;
import com.google.common.collect.testing.google.ListGenerators.BuilderReversedListGenerator;
import com.google.common.collect.testing.google.ListGenerators.ImmutableListHeadSubListGenerator;
import com.google.common.collect.testing.google.ListGenerators.ImmutableListMiddleSubListGenerator;
import com.google.common.collect.testing.google.ListGenerators.ImmutableListOfGenerator;
import com.google.common.collect.testing.google.ListGenerators.ImmutableListTailSubListGenerator;
import com.google.common.collect.testing.google.ListGenerators.UnhashableElementsImmutableListGenerator;
<A NAME="3"></A>import com.google.common.collect.testing.testers.ListHashCodeTester;
import com.google.common.testing.CollectorTester;
import com.google.common.testing.NullPointerTester;
<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#3',2,'match71742-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>import com.google.common.testing.SerializableTester;
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;
import java.util.List;
import java.util.Set;
import java.util.concurrent.CopyOnWriteArrayList;
import junit.framework.Test;
import junit.framework.TestCase;
import junit.framework.TestSuite;

/**
 * Unit test for {@link ImmutableList}.
 *
 * @author Kevin Bourrillion
 * @author George van den Driessche
 * @author Jared Levy
 */
@</B></FONT>GwtCompatible(emulated = true)
public class ImmutableListTest extends TestCase {

<A NAME="10"></A>  @GwtIncompatible // suite
  public static Test suite() {
    TestSuite suite = new TestSuite();
    <FONT color="#ad5910"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#10',2,'match71742-top.html#10',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>suite.addTest(
        ListTestSuiteBuilder.using(new ImmutableListOfGenerator())
            .named(&quot;ImmutableList&quot;)
            .withFeatures(CollectionSize.ANY, SERIALIZABLE, ALLOWS_NULL_QUERIES)
            .createTestSuite());
    suite.addTest(
        ListTestSuiteBuilder.using(new</B></FONT> BuilderAddAllListGenerator())
            .named(&quot;ImmutableList, built with Builder.add&quot;)
            .withFeatures(CollectionSize.ANY, SERIALIZABLE, ALLOWS_NULL_QUERIES)
            .createTestSuite());
    suite.addTest(
        ListTestSuiteBuilder.using(new BuilderAddAllListGenerator())
            .named(&quot;ImmutableList, built with Builder.addAll&quot;)
            .withFeatures(CollectionSize.ANY, SERIALIZABLE, ALLOWS_NULL_QUERIES)
            .createTestSuite());
    suite.addTest(
        ListTestSuiteBuilder.using(new BuilderReversedListGenerator())
            .named(&quot;ImmutableList, reversed&quot;)
            .withFeatures(CollectionSize.ANY, SERIALIZABLE, ALLOWS_NULL_QUERIES)
            .createTestSuite());
    suite.addTest(
        ListTestSuiteBuilder.using(new ImmutableListHeadSubListGenerator())
            .named(&quot;ImmutableList, head subList&quot;)
            .withFeatures(CollectionSize.ANY, SERIALIZABLE, ALLOWS_NULL_QUERIES)
            .createTestSuite());
    suite.addTest(
        ListTestSuiteBuilder.using(new ImmutableListTailSubListGenerator())
            .named(&quot;ImmutableList, tail subList&quot;)
            .withFeatures(CollectionSize.ANY, SERIALIZABLE, ALLOWS_NULL_QUERIES)
            .createTestSuite());
    suite.addTest(
        ListTestSuiteBuilder.using(new ImmutableListMiddleSubListGenerator())
            .named(&quot;ImmutableList, middle subList&quot;)
            .withFeatures(CollectionSize.ANY, SERIALIZABLE, ALLOWS_NULL_QUERIES)
            .createTestSuite());
    suite.addTest(
        ListTestSuiteBuilder.using(new UnhashableElementsImmutableListGenerator())
            .suppressing(ListHashCodeTester.getHashCodeMethod())
            .named(&quot;ImmutableList, unhashable values&quot;)
            .withFeatures(CollectionSize.ANY, ALLOWS_NULL_QUERIES)
            .createTestSuite());
    return suite;
  }
<A NAME="17"></A>
  public static class CreationTests extends TestCase {
    public void testCreation_noArgs() {
      List&lt;String&gt; list = <FONT color="#3090c7"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#17',2,'match71742-top.html#17',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.of();
      assertEquals(Collections.emptyList(), list);
    }

    public void testCreation_oneElement() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;);
      assertEquals(Collections.singletonList</B></FONT>(&quot;a&quot;), list);
<A NAME="12"></A>    }

    public void testCreation_twoElements() {
      List&lt;String&gt; list = <FONT color="#571b7e"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#12',2,'match71742-top.html#12',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.of(&quot;a&quot;, &quot;b&quot;);
      assertEquals(Lists.newArrayList(&quot;a&quot;, &quot;b&quot;), list);
    }

    public void testCreation_threeElements() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);
      assertEquals(Lists.newArrayList</B></FONT>(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;), list);
<A NAME="11"></A>    }

    public void testCreation_fourElements() {
      List&lt;String&gt; list = <FONT color="#b041ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#11',2,'match71742-top.html#11',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;);
      assertEquals(Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;), list);
    }

    public void testCreation_fiveElements() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;);
      assertEquals(Lists.newArrayList</B></FONT>(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;), list);
    }
<A NAME="24"></A>
    public void testCreation_sixElements() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;);
      assertEquals(<FONT color="#79764d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#24',2,'match71742-top.html#24',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;), list);
    }

    public void testCreation_sevenElements() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;);
      assertEquals(Lists.newArrayList</B></FONT>(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;), list);
    }

    public void testCreation_eightElements() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;);
      assertEquals(Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;), list);
    }

    public void testCreation_nineElements() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;);
      assertEquals(Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;), list);
    }

    public void testCreation_tenElements() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;);
      assertEquals(Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;), list);
    }

    public void testCreation_elevenElements() {
      List&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;);
      assertEquals(Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;), list);
    }

    // Varargs versions

    public void testCreation_twelveElements() {
      List&lt;String&gt; list =
          ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;);
      assertEquals(
          Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;), list);
    }

    public void testCreation_thirteenElements() {
      List&lt;String&gt; list =
          ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;, &quot;m&quot;);
      assertEquals(
          Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;, &quot;m&quot;),
          list);
    }

    public void testCreation_fourteenElements() {
      List&lt;String&gt; list =
          ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;, &quot;m&quot;, &quot;n&quot;);
      assertEquals(
          Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;, &quot;m&quot;, &quot;n&quot;),
          list);
    }
<A NAME="16"></A>
    public void testCreation_singletonNull() {
      try {
        <FONT color="#2981b2"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#16',2,'match71742-top.html#16',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.of((String) null);
        fail();
      } catch (NullPointerException expected) {
      }
    }
<A NAME="15"></A>
    public void testCreat</B></FONT>ion_withNull() {
      try {
        <FONT color="#f52887"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#15',2,'match71742-top.html#15',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.of(&quot;a&quot;, null, &quot;b&quot;);
        fail();
      } catch (NullPointerException expected) {
      }
    }

    public void testCrea</B></FONT>tion_generic() {
      List&lt;String&gt; a = ImmutableList.of(&quot;a&quot;);
      // only verify that there is no compile warning
      ImmutableList&lt;List&lt;String&gt;&gt; unused = ImmutableList.of(a, a);
    }

    public void testCreation_arrayOfArray() {
      String[] array = new String[] {&quot;a&quot;};
      List&lt;String[]&gt; list = ImmutableList.&lt;String[]&gt;of(array);
      assertEquals(Collections.singletonList(array), list);
    }

    public void testCopyOf_emptyArray() {
      String[] array = new String[0];
      List&lt;String&gt; list = ImmutableList.copyOf(array);
      assertEquals(Collections.emptyList(), list);
    }

    public void testCopyOf_arrayOfOneElement() {
      String[] array = new String[] {&quot;a&quot;};
      List&lt;String&gt; list = ImmutableList.copyOf(array);
      assertEquals(Collections.singletonList(&quot;a&quot;), list);
    }
<A NAME="14"></A>
    public void testCopyOf_nullArray() {
      try {
        <FONT color="#842dce"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#14',2,'match71742-top.html#14',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.copyOf((String[]) null);
        fail();
      } catch (NullPointerException expected) {
      }
    }

<A NAME="13"></A>    public void testCopyOf_arrayContai</B></FONT>ningOnlyNull() {
      String[] array = new String[] {null};
      try {
        <FONT color="#3b9c9c"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#13',2,'match71742-top.html#13',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.copyOf(array);
        fail();
      } catch (NullPointerException expected) {
      }
    }

    public void testCopyOf_coll</B></FONT>ection_empty() {
      // &quot;&lt;String&gt;&quot; is required to work around a javac 1.5 bug.
<A NAME="20"></A>      Collection&lt;String&gt; c = MinimalCollection.&lt;String&gt;of();
      List&lt;String&gt; list = ImmutableList.copyOf(c);
      assertEquals(Collections.emptyList(), list);
    <FONT color="#4e9258"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#20',2,'match71742-top.html#20',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}

    public void testCopyOf_collection_oneElement() {
      Collection&lt;String&gt; c = MinimalCollection.of(&quot;a&quot;);
      List&lt;String&gt; list = ImmutableList.copyOf(c);
      assertEquals</B></FONT>(Collections.singletonList(&quot;a&quot;), list);
    }

    public void testCopyOf_collection_general() {
      Collection&lt;String&gt; c = MinimalCollection.of(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;);
<A NAME="23"></A>      List&lt;String&gt; list = ImmutableList.copyOf(c);
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;), list);
      List&lt;String&gt; mutableList = asList(&quot;a&quot;, &quot;b&quot;);
      list = <FONT color="#f660ab"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#23',2,'match71742-top.html#23',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.copyOf(mutableList);
      mutableList.set(0, &quot;c&quot;);
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;), list);
    }

<A NAME="22"></A>    public void testCopyOf_collectionContainingNull() {
      Collection&lt;String&gt; c = MinimalCollection.of(&quot;a&quot;, null, &quot;b&quot;)</B></FONT>;
      try {
        <FONT color="#4cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#22',2,'match71742-top.html#22',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.copyOf(c);
        fail();
      } catch (NullPointerException expected) {
      }
    }</B></FONT>

    public void testCopyOf_iterator_empty() {
      Iterator&lt;String&gt; iterator = Iterators.emptyIterator();
      List&lt;String&gt; list = ImmutableList.copyOf(iterator);
      assertEquals(Collections.emptyList(), list);
    }

    public void testCopyOf_iterator_oneElement() {
      Iterator&lt;String&gt; iterator = Iterators.singletonIterator(&quot;a&quot;);
      List&lt;String&gt; list = ImmutableList.copyOf(iterator);
      assertEquals(Collections.singletonList(&quot;a&quot;), list);
    }

    public void testCopyOf_iterator_general() {
      Iterator&lt;String&gt; iterator = asList(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;).iterator();
      List&lt;String&gt; list = ImmutableList.copyOf(iterator);
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;), list);
    }

    public void testCopyOf_iteratorContainingNull() {
      Iterator&lt;String&gt; iterator = asList(&quot;a&quot;, null, &quot;b&quot;).iterator();
      try {
        ImmutableList.copyOf(iterator);
        fail();
      } catch (NullPointerException expected) {
      }
    }

    public void testCopyOf_iteratorNull() {
      try {
        ImmutableList.copyOf((Iterator&lt;String&gt;) null);
        fail();
      } catch (NullPointerException expected) {
      }
    }

    public void testCopyOf_concurrentlyMutating() {
      List&lt;String&gt; sample = Lists.newArrayList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);
<A NAME="21"></A>      for (int delta : new int[] {-1, 0, 1}) {
        for (int i = 0; i &lt; sample.size(); i++) {
          Collection&lt;String&gt; misleading = Helpers.misleadingSizeCollection(delta);
          List&lt;String&gt; expected = <FONT color="#947010"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#21',2,'match71742-top.html#21',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>sample.subList(0, i);
          misleading.addAll(expected);
          assertEquals(expected, ImmutableList.copyOf(misleading));
          assertEquals(expected, ImmutableList.copyOf((Iterable&lt;String&gt;) misleading));
        }
      }</B></FONT>
    }

    private static class CountingIterable implements Iterable&lt;String&gt; {
      int count = 0;

<A NAME="25"></A>      @Override
      public Iterator&lt;String&gt; iterator() {
        count++;
        return <FONT color="#5eac10"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#25',2,'match71742-top.html#25',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>asList(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;).iterator();
      }
    }

    public void testCopyOf_plainIterable() {
      CountingIterable iterable = new</B></FONT> CountingIterable();
      List&lt;String&gt; list = ImmutableList.copyOf(iterable);
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;), list);
    }

    public void testCopyOf_plainIterable_iteratesOnce() {
      CountingIterable iterable = new CountingIterable();
      ImmutableList&lt;String&gt; unused = ImmutableList.copyOf(iterable);
      assertEquals(1, iterable.count);
    }

    public void testCopyOf_shortcut_empty() {
      Collection&lt;String&gt; c = ImmutableList.of();
      assertSame(c, ImmutableList.copyOf(c));
    }

    public void testCopyOf_shortcut_singleton() {
      Collection&lt;String&gt; c = ImmutableList.of(&quot;a&quot;);
      assertSame(c, ImmutableList.copyOf(c));
    }

    public void testCopyOf_shortcut_immutableList() {
      Collection&lt;String&gt; c = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);
      assertSame(c, ImmutableList.copyOf(c));
    }

    public void testBuilderAddArrayHandlesNulls() {
      String[] elements = {&quot;a&quot;, null, &quot;b&quot;};
      ImmutableList.Builder&lt;String&gt; builder = ImmutableList.builder();
      try {
        builder.add(elements);
        fail(&quot;Expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }
      ImmutableList&lt;String&gt; result = builder.build();

      /*
       * Maybe it rejects all elements, or maybe it adds &quot;a&quot; before failing.
       * Either way is fine with us.
       */
<A NAME="19"></A>      if (result.isEmpty()) {
        return;
      }
      <FONT color="#f62817"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#19',2,'match71742-top.html#19',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertTrue(ImmutableList.of(&quot;a&quot;).equals(result));
      assertEquals(1, result.size());
    }

    public void testBuilderAddCollectionHandlesNulls() {
      List&lt;String&gt; elements = Arrays.asList</B></FONT>(&quot;a&quot;, null, &quot;b&quot;);
      ImmutableList.Builder&lt;String&gt; builder = ImmutableList.builder();
      try {
        builder.addAll(elements);
<A NAME="5"></A>        fail(&quot;Expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }
      ImmutableList&lt;String&gt; result = <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#5',2,'match71742-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>builder.build();
      assertEquals(ImmutableList.of(&quot;a&quot;), result);
      assertEquals(1, result.size());
    }

    public void testSortedCopyOf_natural() {
      Collection&lt;Integer&gt; c = MinimalCollection.of(4, 16, 10, -1, 5);
      ImmutableList&lt;Integer&gt; list = ImmutableList.sortedCopyOf(c);
      assertEquals</B></FONT>(asList(-1, 4, 5, 10, 16), list);
    }

    public void testSortedCopyOf_natural_empty() {
      Collection&lt;Integer&gt; c = MinimalCollection.of();
      ImmutableList&lt;Integer&gt; list = ImmutableList.sortedCopyOf(c);
      assertEquals(asList(), list);
    }

    public void testSortedCopyOf_natural_singleton() {
      Collection&lt;Integer&gt; c = MinimalCollection.of(100);
      ImmutableList&lt;Integer&gt; list = ImmutableList.sortedCopyOf(c);
      assertEquals(asList(100), list);
    }

    public void testSortedCopyOf_natural_containsNull() {
      Collection&lt;Integer&gt; c = MinimalCollection.of(1, 3, null, 2);
      try {
        ImmutableList.sortedCopyOf(c);
        fail(&quot;Expected NPE&quot;);
      } catch (NullPointerException expected) {
      }
    }

    public void testSortedCopyOf() {
      Collection&lt;String&gt; c = MinimalCollection.of(&quot;a&quot;, &quot;b&quot;, &quot;A&quot;, &quot;c&quot;);
      List&lt;String&gt; list = ImmutableList.sortedCopyOf(String.CASE_INSENSITIVE_ORDER, c);
      assertEquals(asList(&quot;a&quot;, &quot;A&quot;, &quot;b&quot;, &quot;c&quot;), list);
    }

    public void testSortedCopyOf_empty() {
      Collection&lt;String&gt; c = MinimalCollection.of();
      List&lt;String&gt; list = ImmutableList.sortedCopyOf(String.CASE_INSENSITIVE_ORDER, c);
      assertEquals(asList(), list);
    }

    public void testSortedCopyOf_singleton() {
      Collection&lt;String&gt; c = MinimalCollection.of(&quot;a&quot;);
      List&lt;String&gt; list = ImmutableList.sortedCopyOf(String.CASE_INSENSITIVE_ORDER, c);
      assertEquals(asList(&quot;a&quot;), list);
    }

    public void testSortedCopyOf_containsNull() {
      Collection&lt;String&gt; c = MinimalCollection.of(&quot;a&quot;, &quot;b&quot;, &quot;A&quot;, null, &quot;c&quot;);
      try {
        ImmutableList.sortedCopyOf(String.CASE_INSENSITIVE_ORDER, c);
        fail(&quot;Expected NPE&quot;);
      } catch (NullPointerException expected) {
      }
    }

    public void testToImmutableList() {
      CollectorTester.of(ImmutableList.&lt;String&gt;toImmutableList())
          .expectCollects(ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;), &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;);
    }
  }

  @GwtIncompatible // reflection
  public static class ConcurrentTests extends TestCase {
    enum WrapWithIterable {
      WRAP,
      NO_WRAP
    }

    private static void runConcurrentlyMutatedTest(
        Collection&lt;Integer&gt; initialContents,
        Iterable&lt;ListFrobber&gt; actionsToPerformConcurrently,
        WrapWithIterable wrap) {
      ConcurrentlyMutatedList&lt;Integer&gt; concurrentlyMutatedList =
          newConcurrentlyMutatedList(initialContents, actionsToPerformConcurrently);

      Iterable&lt;Integer&gt; iterableToCopy =
          wrap == WrapWithIterable.WRAP
              ? unmodifiableIterable(concurrentlyMutatedList)
              : concurrentlyMutatedList;

      ImmutableList&lt;Integer&gt; copyOfIterable = ImmutableList.copyOf(iterableToCopy);

<A NAME="7"></A>      assertTrue(concurrentlyMutatedList.getAllStates().contains(copyOfIterable));
    }

    private static void runConcurrentlyMutatedTest(<FONT color="#38a4a5"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#7',2,'match71742-top.html#7',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>WrapWithIterable wrap) {
      /*
       * TODO: Iterate over many array sizes and all possible operation lists,
       * performing adds and removes in different ways.
       */
      runConcurrentlyMutatedTest(elements(), ops(add(1), add(2)), wrap);
<A NAME="0"></A>
      runConcurrentlyMutatedTest(elements(), ops(add(1), nop</B></FONT>()), wrap);

      <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#0',2,'match71742-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>runConcurrentlyMutatedTest(elements(), ops(add(1), remove()), wrap);

      runConcurrentlyMutatedTest(elements(), ops(nop(), add(1)), wrap);

      runConcurrentlyMutatedTest(elements(1), ops(remove(), nop()), wrap);

      runConcurrentlyMutatedTest(elements(1), ops(remove(), add(2)), wrap);

      runConcurrentlyMutatedTest(elements(1, 2), ops(remove(), remove()), wrap);

      runConcurrentlyMutatedTest(elements(1, 2), ops(remove(), nop()), wrap);

      runConcurrentlyMutatedTest(elements(1, 2), ops(remove(), add(3)), wrap);

      runConcurrentlyMutatedTest(elements(1, 2), ops(nop(), remove()), wrap);

      runConcurrentlyMutatedTest(elements(1, 2, 3), ops(remove(), remove()), wrap);
    }

    private </B></FONT>static ImmutableList&lt;Integer&gt; elements(Integer... elements) {
      return ImmutableList.copyOf(elements);
    }

    private static ImmutableList&lt;ListFrobber&gt; ops(ListFrobber... elements) {
      return ImmutableList.copyOf(elements);
    }

    public void testCopyOf_concurrentlyMutatedList() {
      runConcurrentlyMutatedTest(WrapWithIterable.NO_WRAP);
    }

    public void testCopyOf_concurrentlyMutatedIterable() {
      runConcurrentlyMutatedTest(WrapWithIterable.WRAP);
    }

    /** An operation to perform on a list. */
    interface ListFrobber {
      void perform(List&lt;Integer&gt; list);
    }

    static ListFrobber add(final int element) {
      return new ListFrobber() {
        @Override
        public void perform(List&lt;Integer&gt; list) {
          list.add(0, element);
        }
      };
    }

    static ListFrobber remove() {
      return new ListFrobber() {
        @Override
        public void perform(List&lt;Integer&gt; list) {
          list.remove(0);
        }
      };
    }

    static ListFrobber nop() {
      return new ListFrobber() {
        @Override
        public void perform(List&lt;Integer&gt; list) {}
      };
    }

    /** A list that mutates itself after every call to each of its {@link List} methods. */
    interface ConcurrentlyMutatedList&lt;E&gt; extends List&lt;E&gt; {
      /**
       * The elements of a {@link ConcurrentlyMutatedList} are added and removed over time. This
       * method returns every state that the list has passed through at some point.
       */
      Set&lt;List&lt;E&gt;&gt; getAllStates();
    }

    /**
     * Returns a {@link ConcurrentlyMutatedList} that performs the given operations as its
     * concurrent modifications. The mutations occur in the same thread as the triggering method
     * call.
     */
    private static ConcurrentlyMutatedList&lt;Integer&gt; newConcurrentlyMutatedList(
        final Collection&lt;Integer&gt; initialContents,
        final Iterable&lt;ListFrobber&gt; actionsToPerformConcurrently) {
      InvocationHandler invocationHandler =
          new InvocationHandler() {
            final CopyOnWriteArrayList&lt;Integer&gt; delegate =
                new CopyOnWriteArrayList&lt;&gt;(initialContents);

            final Method getAllStatesMethod =
                getOnlyElement(asList(ConcurrentlyMutatedList.class.getDeclaredMethods()));

            final Iterator&lt;ListFrobber&gt; remainingActions = actionsToPerformConcurrently.iterator();

            final Set&lt;List&lt;Integer&gt;&gt; allStates = newHashSet();

            @Override
            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
              return method.equals(getAllStatesMethod)
                  ? getAllStates()
                  : invokeListMethod(method, args);
            }

            private Set&lt;List&lt;Integer&gt;&gt; getAllStates() {
              return allStates;
            }

            private Object invokeListMethod(Method method, Object[] args) throws Throwable {
              try {
                Object returnValue = method.invoke(delegate, args);
                mutateDelegate();
                return returnValue;
              } catch (InvocationTargetException e) {
                throw e.getCause();
              } catch (IllegalAccessException e) {
                throw new AssertionError(e);
              }
            }

            private void mutateDelegate() {
              allStates.add(ImmutableList.copyOf(delegate));
              remainingActions.next().perform(delegate);
              allStates.add(ImmutableList.copyOf(delegate));
            }
          };

      @SuppressWarnings(&quot;unchecked&quot;)
      ConcurrentlyMutatedList&lt;Integer&gt; list =
          (ConcurrentlyMutatedList&lt;Integer&gt;)
              newProxyInstance(
                  ImmutableListTest.CreationTests.class.getClassLoader(),
                  new Class[] {ConcurrentlyMutatedList.class},
                  invocationHandler);
      return list;
    }
  }

  public static class BasicTests extends TestCase {

<A NAME="9"></A>    @GwtIncompatible // NullPointerTester
    public void testNullPointers() {
      NullPointerTester tester = new NullPointerTester();
      <FONT color="#83a33a"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#9',2,'match71742-top.html#9',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>tester.testAllPublicStaticMethods(ImmutableList.class);
      tester.testAllPublicInstanceMethods(ImmutableList.of(1, 2, 3));
    }

    @GwtIncompatible // SerializableTester
    public void testSerialization_empty() {
      Collection&lt;String&gt; c = ImmutableList.of();
      assertSame(c, SerializableTester.reserialize</B></FONT>(c));
    }

    @GwtIncompatible // SerializableTester
    public void testSerialization_singleton() {
      Collection&lt;String&gt; c = ImmutableList.of(&quot;a&quot;);
      SerializableTester.reserializeAndAssert(c);
    }

    @GwtIncompatible // SerializableTester
    public void testSerialization_multiple() {
      Collection&lt;String&gt; c = ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);
      SerializableTester.reserializeAndAssert(c);
<A NAME="1"></A>    }

    public void testEquals_immutableList() {
      Collection&lt;String&gt; c = <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#1',2,'match71742-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;);
      assertTrue(c.equals(ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)));
      assertFalse(c.equals(ImmutableList.of(&quot;a&quot;, &quot;c&quot;, &quot;b&quot;)));
      assertFalse(c.equals(ImmutableList.of(&quot;a&quot;, &quot;b&quot;)));
      assertFalse(c.equals(ImmutableList.of(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;)));
    }

    public void testBuilderAdd() {
      ImmutableList&lt;String&gt; list =
          new ImmutableList.Builder&lt;String&gt;().add</B></FONT>(&quot;a&quot;).add(&quot;b&quot;).add(&quot;a&quot;).add(&quot;c&quot;).build();
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;, &quot;c&quot;), list);
    }

    @GwtIncompatible(&quot;Builder impl&quot;)
    public void testBuilderForceCopy() {
      ImmutableList.Builder&lt;Integer&gt; builder = ImmutableList.builder();
      Object[] prevArray = null;
      for (int i = 0; i &lt; 10; i++) {
        builder.add(i);
        assertNotSame(builder.contents, prevArray);
        prevArray = builder.contents;
        ImmutableList&lt;Integer&gt; unused = builder.build();
      }
    }

    @GwtIncompatible
    public void testBuilderExactlySizedReusesArray() {
      ImmutableList.Builder&lt;Integer&gt; builder = ImmutableList.builderWithExpectedSize(10);
      Object[] builderArray = builder.contents;
      for (int i = 0; i &lt; 10; i++) {
        builder.add(i);
      }
      Object[] builderArrayAfterAdds = builder.contents;
      RegularImmutableList&lt;Integer&gt; list = (RegularImmutableList&lt;Integer&gt;) builder.build();
      Object[] listInternalArray = list.array;
      assertSame(builderArray, builderArrayAfterAdds);
      assertSame(builderArray, listInternalArray);
    }

    public void testBuilderAdd_varargs() {
<A NAME="6"></A>      ImmutableList&lt;String&gt; list =
          new ImmutableList.Builder&lt;String&gt;().add(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;, &quot;c&quot;).build();
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;, &quot;c&quot;), list);
    <FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#6',2,'match71742-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}

    public void testBuilderAddAll_iterable() {
<A NAME="18"></A>      List&lt;String&gt; a = asList(&quot;a&quot;, &quot;b&quot;);
      List&lt;String&gt; b = asList(&quot;c&quot;, &quot;d&quot;);
      ImmutableList&lt;String&gt; list = new ImmutableList.Builder&lt;String&gt;().addAll</B></FONT>(a).addAll(b).build();
      <FONT color="#800517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#18',2,'match71742-top.html#18',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;), list);
      b.set(0, &quot;f&quot;);
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;), list);
    }

    public void testBuilderAddAll_iterator() {
<A NAME="4"></A>      List&lt;String&gt; a = asList</B></FONT>(&quot;a&quot;, &quot;b&quot;);
      List&lt;String&gt; b = asList(&quot;c&quot;, &quot;d&quot;);
      ImmutableList&lt;String&gt; list =
          new ImmutableList.Builder&lt;String&gt;().addAll(<FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#4',2,'match71742-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>a.iterator()).addAll(b.iterator()).build();
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;), list);
      b.set(0, &quot;f&quot;);
      assertEquals(asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;), list);
    }

    public void testComplexBuilder() {
      List&lt;Integer&gt; colorElem = asList(0x00, 0x33, 0x66, 0x99, 0xCC, 0xFF);
      ImmutableList.Builder&lt;Integer&gt; webSafeColorsBuilder = ImmutableList.builder</B></FONT>();
      for (Integer red : colorElem) {
        for (Integer green : colorElem) {
          for (Integer blue : colorElem) {
            webSafeColorsBuilder.add((red &lt;&lt; 16) + (green &lt;&lt; 8) + blue);
          }
        }
<A NAME="2"></A>      }
      ImmutableList&lt;Integer&gt; webSafeColors = webSafeColorsBuilder.build();
      assertEquals(216, webSafeColors.size());
      Integer[] webSafeColorArray = webSafeColors.toArray(new Integer[<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#2',2,'match71742-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>webSafeColors.size()]);
      assertEquals(0x000000, (int) webSafeColorArray[0]);
      assertEquals(0x000033, (int) webSafeColorArray[1]);
      assertEquals(0x000066, (int) webSafeColorArray[2]);
      assertEquals(0x003300, (int) webSafeColorArray[6]);
      assertEquals(0x330000, (int) webSafeColorArray[36]);
      assertEquals(0x000066, (int) webSafeColors.get(2));
      assertEquals(0x003300, (int) webSafeColors.get(6));
      ImmutableList&lt;Integer&gt; addedColor = webSafeColorsBuilder.add(0x00BFFF).build();
      assertEquals(
          &quot;Modifying the builder should not have changed any already&quot; + &quot; built sets&quot;,
          216,
          webSafeColors.size());
      assertEquals(&quot;the new array should be one bigger than webSafeColors&quot;, 217, addedColor.size</B></FONT>());
      Integer[] appendColorArray = addedColor.toArray(new Integer[addedColor.size()]);
      assertEquals(0x00BFFF, (int) appendColorArray[216]);
    }

<A NAME="8"></A>    public void testBuilderAddHandlesNullsCorrectly() {
      ImmutableList.Builder&lt;String&gt; builder = ImmutableList.builder();
      try {
        <FONT color="#c58917"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match71742-0.html#8',2,'match71742-top.html#8',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>builder.add((String) null);
        fail(&quot;expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }

      try {
        builder.add((String[]) null);
        fail</B></FONT>(&quot;expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }

      try {
        builder.add(&quot;a&quot;, null, &quot;b&quot;);
        fail(&quot;expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }
    }

    public void testBuilderAddAllHandlesNullsCorrectly() {
      ImmutableList.Builder&lt;String&gt; builder = ImmutableList.builder();
      try {
        builder.addAll((Iterable&lt;String&gt;) null);
        fail(&quot;expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }

      try {
        builder.addAll((Iterator&lt;String&gt;) null);
        fail(&quot;expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }

      builder = ImmutableList.builder();
      List&lt;String&gt; listWithNulls = asList(&quot;a&quot;, null, &quot;b&quot;);
      try {
        builder.addAll(listWithNulls);
        fail(&quot;expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }

      builder = ImmutableList.builder();
      Iterator&lt;String&gt; iteratorWithNulls = asList(&quot;a&quot;, null, &quot;b&quot;).iterator();
      try {
        builder.addAll(iteratorWithNulls);
        fail(&quot;expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }

      Iterable&lt;String&gt; iterableWithNulls = MinimalIterable.of(&quot;a&quot;, null, &quot;b&quot;);
      try {
        builder.addAll(iterableWithNulls);
        fail(&quot;expected NullPointerException&quot;);
      } catch (NullPointerException expected) {
      }
    }

    public void testAsList() {
      ImmutableList&lt;String&gt; list = ImmutableList.of(&quot;a&quot;, &quot;b&quot;);
      assertSame(list, list.asList());
    }
  }
}
</PRE>
</div>
  </div>
</body>
</html>
