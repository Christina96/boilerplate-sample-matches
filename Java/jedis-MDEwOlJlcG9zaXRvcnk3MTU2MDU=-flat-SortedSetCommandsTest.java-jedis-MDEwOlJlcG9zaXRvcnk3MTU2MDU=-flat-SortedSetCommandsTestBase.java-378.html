
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 4395, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SortedSetCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static java.util.Collections.singletonList;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
5  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
6  import static redis.clients.jedis.util.AssertUtil.assertByteArrayListEquals;
7  import java.util.*;
8  import org.junit.Test;
9  import redis.clients.jedis.args.SortedSetOption;
10  import redis.clients.jedis.params.*;
11  import redis.clients.jedis.resps.ScanResult;
12  import redis.clients.jedis.resps.Tuple;
13  import redis.clients.jedis.util.AssertUtil;
14  import redis.clients.jedis.util.KeyValue;
15  import redis.clients.jedis.util.SafeEncoder;
16  public class SortedSetCommandsTest extends JedisCommandsTestBase {
17    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
18    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
19    final byte[] bcar = { 0x09, 0x0A, 0x0B, 0x0C };
20    final byte[] ba = { 0x0A };
21    final byte[] bb = { 0x0B };
22    final byte[] bc = { 0x0C };
23    final byte[] bInclusiveB = { 0x5B, 0x0B };
24    final byte[] bExclusiveC = { 0x28, 0x0C };
25    final byte[] bLexMinusInf = { 0x2D };
26    final byte[] bLexPlusInf = { 0x2B };
27    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
28    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
29    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
30    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, &#x27;*&#x27; };
31    @Test
32    public void zadd() {
33      assertEquals(1, jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;));
34      assertEquals(1, jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;));
35      assertEquals(1, jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;));
36      assertEquals(0, jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;));
37      assertEquals(1, jedis.zadd(bfoo, 1d, ba));
38      assertEquals(1, jedis.zadd(bfoo, 10d, bb));
39      assertEquals(1, jedis.zadd(bfoo, 0.1d, bc));
40      assertEquals(0, jedis.zadd(bfoo, 2d, ba));
41    }
42    @Test
43    public void zaddWithParams() {
44      jedis.del(&quot;foo&quot;);
45      assertEquals(0L, jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().xx()));
46      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
47      assertEquals(0L, jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx()));
48      assertEquals(Double.valueOf(1d), jedis.zscore(&quot;foo&quot;, &quot;a&quot;));
49      Map&lt;String, Double&gt; scoreMembers = new HashMap&lt;String, Double&gt;();
50      scoreMembers.put(&quot;a&quot;, 2d);
51      scoreMembers.put(&quot;b&quot;, 1d);
52      assertEquals(2L, jedis.zadd(&quot;foo&quot;, scoreMembers, ZAddParams.zAddParams().ch()));
53      jedis.zadd(&quot;foo&quot;, 3d, &quot;a&quot;, ZAddParams.zAddParams().lt());
54      assertEquals(Double.valueOf(2d), jedis.zscore(&quot;foo&quot;, &quot;a&quot;));
55      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().lt());
56      assertEquals(Double.valueOf(1d), jedis.zscore(&quot;foo&quot;, &quot;a&quot;));
57      jedis.zadd(&quot;foo&quot;, 0d, &quot;b&quot;, ZAddParams.zAddParams().gt());
58      assertEquals(Double.valueOf(1d), jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
59      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;, ZAddParams.zAddParams().gt());
60      assertEquals(Double.valueOf(2d), jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
61      assertNull(jedis.zaddIncr(&quot;foo&quot;, 1d, &quot;b&quot;, ZAddParams.zAddParams().nx()));
62      assertEquals(Double.valueOf(2d), jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
63      assertEquals(Double.valueOf(3d), jedis.zaddIncr(&quot;foo&quot;, 1d,&quot;b&quot;, ZAddParams.zAddParams().xx()));
64      assertEquals(Double.valueOf(3d), jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
65      jedis.del(bfoo);
66      assertEquals(0L, jedis.zadd(bfoo, 1d, ba, ZAddParams.zAddParams().xx()));
67      jedis.zadd(bfoo, 1d, ba);
68      assertEquals(0L, jedis.zadd(bfoo, 2d, ba, ZAddParams.zAddParams().nx()));
69      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, ba));
70      Map&lt;byte[], Double&gt; binaryScoreMembers = new HashMap&lt;byte[], Double&gt;();
71      binaryScoreMembers.put(ba, 2d);
72      binaryScoreMembers.put(bb, 1d);
73      assertEquals(2L, jedis.zadd(bfoo, binaryScoreMembers, ZAddParams.zAddParams().ch()));
74      jedis.zadd(bfoo, 3d, ba, ZAddParams.zAddParams().lt());
75      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, ba));
76      jedis.zadd(bfoo, 1d, ba, ZAddParams.zAddParams().lt());
77      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, ba));
78      jedis.zadd(bfoo, 0d, bb, ZAddParams.zAddParams().gt());
79      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, bb));
80      jedis.zadd(bfoo, 2d, bb, ZAddParams.zAddParams().gt());
81      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, bb));
82      assertNull(jedis.zaddIncr(bfoo, 1d, bb, ZAddParams.zAddParams().nx()));
83      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, bb));
84      assertEquals(Double.valueOf(3d), jedis.zaddIncr(bfoo, 1d, bb, ZAddParams.zAddParams().xx()));
85      assertEquals(Double.valueOf(3d), jedis.zscore(bfoo, bb));
86    }
87    @Test
88    public void zrange() {
89      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
90      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
91      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
92      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
93      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
94      expected.add(&quot;c&quot;);
95      expected.add(&quot;a&quot;);
96      List&lt;String&gt; range = jedis.zrange(&quot;foo&quot;, 0, 1);
97      assertEquals(expected, range);
98      expected.add(&quot;b&quot;);
99      range = jedis.zrange(&quot;foo&quot;, 0, 100);
100      assertEquals(expected, range);
101      jedis.zadd(bfoo, 1d, ba);
102      jedis.zadd(bfoo, 10d, bb);
103      jedis.zadd(bfoo, 0.1d, bc);
104      jedis.zadd(bfoo, 2d, ba);
105      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
106      bexpected.add(bc);
107      bexpected.add(ba);
108      List&lt;byte[]&gt; brange = jedis.zrange(bfoo, 0, 1);
109      assertByteArrayListEquals(bexpected, brange);
110      bexpected.add(bb);
111      brange = jedis.zrange(bfoo, 0, 100);
112      assertByteArrayListEquals(bexpected, brange);
113    }
114    @Test
115    public void zrangeByLex() {
116      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
117      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
118      jedis.zadd(&quot;foo&quot;, 1, &quot;bb&quot;);
119      jedis.zadd(&quot;foo&quot;, 1, &quot;d&quot;);
120      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
121      expected.add(&quot;bb&quot;);
122      expected.add(&quot;c&quot;);
123      assertEquals(expected, jedis.zrangeByLex(&quot;foo&quot;, &quot;(aa&quot;, &quot;[c&quot;));
124      expected.clear();
125      expected.add(&quot;bb&quot;);
126      expected.add(&quot;c&quot;);
127      assertEquals(expected, jedis.zrangeByLex(&quot;foo&quot;, &quot;-&quot;, &quot;+&quot;, 1, 2));
128    }
129    @Test
130    public void zrangeByLexBinary() {
131      jedis.zadd(bfoo, 1, ba);
132      jedis.zadd(bfoo, 1, bc);
133      jedis.zadd(bfoo, 1, bb);
134      List&lt;byte[]&gt; bExpected = new ArrayList&lt;byte[]&gt;();
135      bExpected.add(bb);
136      assertByteArrayListEquals(bExpected, jedis.zrangeByLex(bfoo, bInclusiveB, bExclusiveC));
137      bExpected.clear();
138      bExpected.add(ba);
139      bExpected.add(bb);
140      assertByteArrayListEquals(bExpected, jedis.zrangeByLex(bfoo, bLexMinusInf, bLexPlusInf, 0, 2));
141    }
142    @Test
143    public void zrevrangeByLex() {
144      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
145      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
146      jedis.zadd(&quot;foo&quot;, 1, &quot;bb&quot;);
147      jedis.zadd(&quot;foo&quot;, 1, &quot;d&quot;);
148      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
149      expected.add(&quot;c&quot;);
150      expected.add(&quot;bb&quot;);
151      assertEquals(expected, jedis.zrevrangeByLex(&quot;foo&quot;, &quot;[c&quot;, &quot;(aa&quot;));
152      expected.clear();
153      expected.add(&quot;c&quot;);
154      expected.add(&quot;bb&quot;);
155      assertEquals(expected, jedis.zrevrangeByLex(&quot;foo&quot;, &quot;+&quot;, &quot;-&quot;, 1, 2));
156    }
157    @Test
158    public void zrevrangeByLexBinary() {
159      jedis.zadd(bfoo, 1, ba);
160      jedis.zadd(bfoo, 1, bc);
161      jedis.zadd(bfoo, 1, bb);
162      List&lt;byte[]&gt; bExpected = new ArrayList&lt;byte[]&gt;();
163      bExpected.add(bb);
164      assertByteArrayListEquals(bExpected, jedis.zrevrangeByLex(bfoo, bExclusiveC, bInclusiveB));
165      bExpected.clear();
166      bExpected.add(bc);
167      bExpected.add(bb);
168      assertByteArrayListEquals(bExpected, jedis.zrevrangeByLex(bfoo, bLexPlusInf, bLexMinusInf, 0, 2));
169    }
170    @Test
171    public void zrevrange() {
172      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
173      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
174      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
175      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
176      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
177      expected.add(&quot;b&quot;);
178      expected.add(&quot;a&quot;);
179      List&lt;String&gt; range = jedis.zrevrange(&quot;foo&quot;, 0, 1);
180      assertEquals(expected, range);
181      expected.add(&quot;c&quot;);
182      range = jedis.zrevrange(&quot;foo&quot;, 0, 100);
183      assertEquals(expected, range);
184      jedis.zadd(bfoo, 1d, ba);
185      jedis.zadd(bfoo, 10d, bb);
186      jedis.zadd(bfoo, 0.1d, bc);
187      jedis.zadd(bfoo, 2d, ba);
188      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
189      bexpected.add(bb);
190      bexpected.add(ba);
191      List&lt;byte[]&gt; brange = jedis.zrevrange(bfoo, 0, 1);
192      assertByteArrayListEquals(bexpected, brange);
193      bexpected.add(bc);
194      brange = jedis.zrevrange(bfoo, 0, 100);
195      assertByteArrayListEquals(bexpected, brange);
196    }
197    @Test
198    public void zrem() {
199      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
200      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
201      assertEquals(1, jedis.zrem(&quot;foo&quot;, &quot;a&quot;));
202      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
203      expected.add(&quot;b&quot;);
204      assertEquals(expected, jedis.zrange(&quot;foo&quot;, 0, 100));
205      assertEquals(0, jedis.zrem(&quot;foo&quot;, &quot;bar&quot;));
206      jedis.zadd(bfoo, 1d, ba);
207      jedis.zadd(bfoo, 2d, bb);
208      assertEquals(1, jedis.zrem(bfoo, ba));
209      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
210      bexpected.add(bb);
211      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
212      assertEquals(0, jedis.zrem(bfoo, bbar));
213    }
214    @Test
215    public void zincrby() {
216      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
217      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
218      assertEquals(3d, jedis.zincrby(&quot;foo&quot;, 2d, &quot;a&quot;), 0);
219      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
220      expected.add(&quot;b&quot;);
221      expected.add(&quot;a&quot;);
222      assertEquals(expected, jedis.zrange(&quot;foo&quot;, 0, 100));
223      jedis.zadd(bfoo, 1d, ba);
224      jedis.zadd(bfoo, 2d, bb);
225      assertEquals(3d, jedis.zincrby(bfoo, 2d, ba), 0);
226      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
227      bexpected.add(bb);
228      bexpected.add(ba);
229      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
230    }
231    @Test
232    public void zincrbyWithParams() {
233      jedis.del(&quot;foo&quot;);
234      assertNull(jedis.zincrby(&quot;foo&quot;, 2d, &quot;a&quot;, ZIncrByParams.zIncrByParams().xx()));
235      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
236      assertNull(jedis.zincrby(&quot;foo&quot;, 1d, &quot;a&quot;, ZIncrByParams.zIncrByParams().nx()));
237      assertEquals(Double.valueOf(2d), jedis.zscore(&quot;foo&quot;, &quot;a&quot;));
238      jedis.del(bfoo);
239      assertNull(jedis.zincrby(bfoo, 2d, ba, ZIncrByParams.zIncrByParams().xx()));
240      jedis.zadd(bfoo, 2d, ba);
241      assertNull(jedis.zincrby(bfoo, 1d, ba, ZIncrByParams.zIncrByParams().nx()));
242      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, ba));
243    }
244    @Test
245    public void zrank() {
246      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
247      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
248      long rank = jedis.zrank(&quot;foo&quot;, &quot;a&quot;);
249      assertEquals(0, rank);
250      rank = jedis.zrank(&quot;foo&quot;, &quot;b&quot;);
<span onclick='openModal()' class='match'>251      assertEquals(1, rank);
252      assertNull(jedis.zrank(&quot;car&quot;, &quot;b&quot;));
253      jedis.zadd(bfoo, 1d, ba);
254      jedis.zadd(bfoo, 2d, bb);
255      long brank = jedis.zrank(bfoo, ba);
256      assertEquals(0, brank);
257      brank = jedis.zrank(bfoo, bb);
258      assertEquals(1, brank);
259      assertNull(jedis.zrank(bcar, bb));
260    }
261    @Test
262    public void zrankWithScore() {
263      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
264      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
265      KeyValue&lt;Long, Double&gt; keyValue = jedis.zrankWithScore(&quot;foo&quot;, &quot;a&quot;);
266      assertEquals(Long.valueOf(0), keyValue.getKey());
267      assertEquals(Double.valueOf(1d), keyValue.getValue());
268      keyValue = jedis.zrankWithScore(&quot;foo&quot;, &quot;b&quot;);
269      assertEquals(Long.valueOf(1), keyValue.getKey());
270      assertEquals(Double.valueOf(2d), keyValue.getValue());
271      assertNull(jedis.zrankWithScore(&quot;car&quot;, &quot;b&quot;));
272      jedis.zadd(bfoo, 1d, ba);
273      jedis.zadd(bfoo, 2d, bb);
274      keyValue = jedis.zrankWithScore(bfoo, ba);
275      assertEquals(Long.valueOf(0), keyValue.getKey());
276      assertEquals(Double.valueOf(1d), keyValue.getValue());
277      keyValue = jedis.zrankWithScore(bfoo, bb);
278      assertEquals(Long.valueOf(1), keyValue.getKey());
279      assertEquals(Double.valueOf(2d), keyValue.getValue());
280      assertNull(jedis.zrankWithScore(bcar, bb));
281    }
282    @Test
283    public void zrevrank() {
284      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
285      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
286      long rank = jedis.zrevrank(&quot;foo&quot;, &quot;a&quot;);
287      assertEquals(1, rank);
288      rank = jedis.zrevrank(&quot;foo&quot;, &quot;b&quot;);
289      assertEquals(0, rank);
290      jedis.zadd(bfoo, 1d, ba);
291      jedis.zadd(bfoo, 2d, bb);
292      long brank = jedis.zrevrank(bfoo, ba);
293      assertEquals(1, brank);
294      brank = jedis.zrevrank(bfoo, bb);
295      assertEquals(0, brank);
296    }
297    @Test
298    public void zrangeWithScores() {
299      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
300      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
301      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
302      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
303      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
304      expected.add(new Tuple(&quot;c&quot;, 0.1d));
305      expected.add(new Tuple(&quot;a&quot;, 2d));
306      List&lt;Tuple&gt; range = jedis.zrangeWithScores(&quot;foo&quot;, 0, 1);
307      assertEquals(expected, range);
308      expected.add(new Tuple(&quot;b&quot;, 10d));
309      range = jedis.zrangeWithScores(&quot;foo&quot;, 0, 100);
310      assertEquals(expected, range);
311      jedis.zadd(bfoo, 1d, ba);
312      jedis.zadd(bfoo, 10d, bb);
313      jedis.zadd(bfoo, 0.1d, bc);
314      jedis.zadd(bfoo, 2d, ba);
315      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
316      bexpected.add(new Tuple(bc, 0.1d));
317      bexpected.add(new Tuple(ba, 2d));
318      List&lt;Tuple&gt; brange = jedis.zrangeWithScores(bfoo, 0, 1);
319      assertEquals(bexpected, brange);
320      bexpected.add(new Tuple(bb, 10d));
321      brange = jedis.zrangeWithScores(bfoo, 0, 100);
322      assertEquals(bexpected, brange);
323    }
324    @Test
325    public void zrevrangeWithScores() {
326      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
327      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
328      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
329      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
330      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
331      expected.add(new Tuple(&quot;b&quot;, 10d));
332      expected.add(new Tuple(&quot;a&quot;, 2d));
333      List&lt;Tuple&gt; range = jedis.zrevrangeWithScores(&quot;foo&quot;, 0, 1);
334      assertEquals(expected, range);
335      expected.add(new Tuple(&quot;c&quot;, 0.1d));
336      range = jedis.zrevrangeWithScores(&quot;foo&quot;, 0, 100);
337      assertEquals(expected, range);
338      jedis.zadd(bfoo, 1d, ba);
339      jedis.zadd(bfoo, 10d, bb);
340      jedis.zadd(bfoo, 0.1d, bc);
341      jedis.zadd(bfoo, 2d, ba);
342      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
343      bexpected.add(new Tuple(bb, 10d));
344      bexpected.add(new Tuple(ba, 2d));
345      List&lt;Tuple&gt; brange = jedis.zrevrangeWithScores(bfoo, 0, 1);
346      assertEquals(bexpected, brange);
347      bexpected.add(new Tuple(bc, 0.1d));
348      brange = jedis.zrevrangeWithScores(bfoo, 0, 100);
349      assertEquals(bexpected, brange);
350    }
351    @Test
352    public void zcard() {
353      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
354      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
355      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
356      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
357      assertEquals(3, jedis.zcard(&quot;foo&quot;));
358      jedis.zadd(bfoo, 1d, ba);
359      jedis.zadd(bfoo, 10d, bb);
360      jedis.zadd(bfoo, 0.1d, bc);
361      jedis.zadd(bfoo, 2d, ba);
362      assertEquals(3, jedis.zcard(bfoo));
363    }
364    @Test
365    public void zscore() {
366      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
367      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
368      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
369      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
370      assertEquals((Double) 10d, jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
371      assertEquals((Double) 0.1d, jedis.zscore(&quot;foo&quot;, &quot;c&quot;));
372      assertNull(jedis.zscore(&quot;foo&quot;, &quot;s&quot;));
373      jedis.zadd(bfoo, 1d, ba);
374      jedis.zadd(bfoo, 10d, bb);
375      jedis.zadd(bfoo, 0.1d, bc);
376      jedis.zadd(bfoo, 2d, ba);
377      assertEquals((Double) 10d, jedis.zscore(bfoo, bb));
378      assertEquals((Double) 0.1d, jedis.zscore(bfoo, bc));
379      assertNull(jedis.zscore(bfoo, SafeEncoder.encode(&quot;s&quot;)));
380    }
381    @Test
382    public void zmscore() {
383      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
384      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
385      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
386      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
387      assertEquals(Arrays.asList(10d, 0.1d, null), jedis.zmscore(&quot;foo&quot;, &quot;b&quot;, &quot;c&quot;, &quot;s&quot;));
388      jedis.zadd(bfoo, 1d, ba);
389      jedis.zadd(bfoo, 10d, bb);
390      jedis.zadd(bfoo, 0.1d, bc);
391      jedis.zadd(bfoo, 2d, ba);
392      assertEquals(Arrays.asList(10d, 0.1d, null),
393        jedis.zmscore(bfoo, bb, bc, SafeEncoder.encode(&quot;s&quot;)));
394    }
395    @Test
396    public void zpopmax() {
397      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
398      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
399      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
400      jedis.zadd(&quot;foo&quot;, 2d, &quot;d&quot;);
401      Tuple actual = jedis.zpopmax(&quot;foo&quot;);
402      Tuple expected = new Tuple(&quot;b&quot;, 10d);
403      assertEquals(expected, actual);
404      actual = jedis.zpopmax(&quot;foo&quot;);
405      expected = new Tuple(&quot;d&quot;, 2d);
406      assertEquals(expected, actual);
407      actual = jedis.zpopmax(&quot;foo&quot;);
408      expected = new Tuple(&quot;a&quot;, 1d);
409      assertEquals(expected, actual);
410      actual = jedis.zpopmax(&quot;foo&quot;);
411      expected = new Tuple(&quot;c&quot;, 0.1d);
412      assertEquals(expected, actual);
413      actual = jedis.zpopmax(&quot;foo&quot;);
414      assertNull(actual);
415      jedis.zadd(bfoo, 1d, ba);
416      jedis.zadd(bfoo, 10d, bb);
417      jedis.zadd(bfoo, 0.1d, bc);
418      jedis.zadd(bfoo, 2d, ba);
419      actual = jedis.zpopmax(bfoo);
420      expected = new Tuple(bb, 10d);
421      assertEquals(expected, actual);
422      actual = jedis.zpopmax(bfoo);
423      expected = new Tuple(ba, 2d);
424      assertEquals(expected, actual);
425      actual = jedis.zpopmax(bfoo);
426      expected = new Tuple(bc, 0.1d);
427      assertEquals(expected, actual);
428      actual = jedis.zpopmax(bfoo);
429      assertNull(actual);
430    }
431    @Test
432    public void zpopmaxWithCount() {
433      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
434      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
435      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
436      jedis.zadd(&quot;foo&quot;, 2d, &quot;d&quot;);
437      jedis.zadd(&quot;foo&quot;, 0.03, &quot;e&quot;);
438      List&lt;Tuple&gt; actual = jedis.zpopmax(&quot;foo&quot;, 2);
439      assertEquals(2, actual.size());
440      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
441      expected.add(new Tuple(&quot;b&quot;, 10d));
442      expected.add(new Tuple(&quot;d&quot;, 2d));
443      assertEquals(expected, actual);
444      actual = jedis.zpopmax(&quot;foo&quot;, 3);
445      assertEquals(3, actual.size());
446      expected.clear();
447      expected.add(new Tuple(&quot;a&quot;, 1d));
448      expected.add(new Tuple(&quot;c&quot;, 0.1d));
449      expected.add(new Tuple(&quot;e&quot;, 0.03d));
450      assertEquals(expected, actual);
451      actual = jedis.zpopmax(&quot;foo&quot;, 1);
452      expected.clear();
453      assertEquals(expected, actual);
454      jedis.zadd(bfoo, 1d, ba);
455      jedis.zadd(bfoo, 10d, bb);
456      jedis.zadd(bfoo, 0.1d, bc);
457      jedis.zadd(bfoo, 2d, ba);
458      actual = jedis.zpopmax(bfoo, 1);
459      expected.clear();
460      expected.add(new Tuple(bb, 10d));
461      assertEquals(expected, actual);
462      actual = jedis.zpopmax(bfoo, 1);
463      expected.clear();
464      expected.add(new Tuple(ba, 2d));
465      assertEquals(expected, actual);
466      actual = jedis.zpopmax(bfoo, 1);
467      expected.clear();
468      expected.add(new Tuple(bc, 0.1d));
469      assertEquals(expected, actual);
470      actual = jedis.zpopmax(bfoo, 1);
471      expected.clear();
472      assertEquals(expected, actual);
473    }
474    @Test
475    public void zpopmin() {
476      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
477      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
478      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
479      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx());
480      List&lt;Tuple&gt; range = jedis.zpopmin(&quot;foo&quot;, 2);
481      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
482      expected.add(new Tuple(&quot;c&quot;, 0.1d));
483      expected.add(new Tuple(&quot;a&quot;, 1d));
484      assertEquals(expected, range);
485      assertEquals(new Tuple(&quot;b&quot;, 10d), jedis.zpopmin(&quot;foo&quot;));
486      jedis.zadd(bfoo, 1d, ba);
487      jedis.zadd(bfoo, 10d, bb);
488      jedis.zadd(bfoo, 0.1d, bc);
489      jedis.zadd(bfoo, 2d, ba);
490      List&lt;Tuple&gt; brange = jedis.zpopmin(bfoo, 2);
491      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
492      bexpected.add(new Tuple(bc, 0.1d));
493      bexpected.add(new Tuple(ba, 2d));
494      assertEquals(bexpected, brange);
495      assertEquals(new Tuple(bb, 10d), jedis.zpopmin(bfoo));
496    }
497    @Test
498    public void zcount() {
499      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
500      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
501      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
502      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
503      assertEquals(2, jedis.zcount(&quot;foo&quot;, 0.01d, 2.1d));
504      assertEquals(3, jedis.zcount(&quot;foo&quot;, &quot;(0.01&quot;, &quot;+inf&quot;));
505      jedis.zadd(bfoo, 1d, ba);
506      jedis.zadd(bfoo, 10d, bb);
507      jedis.zadd(bfoo, 0.1d, bc);
508      jedis.zadd(bfoo, 2d, ba);
509      assertEquals(2, jedis.zcount(bfoo, 0.01d, 2.1d));
510      assertEquals(3, jedis.zcount(bfoo, SafeEncoder.encode(&quot;(0.01&quot;), SafeEncoder.encode(&quot;+inf&quot;)));
511    }
512    @Test
513    public void zlexcount() {
514      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
515      jedis.zadd(&quot;foo&quot;, 1, &quot;b&quot;);
516      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
517      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
518      assertEquals(2, jedis.zlexcount(&quot;foo&quot;, &quot;[aa&quot;, &quot;(c&quot;));
519      assertEquals(4, jedis.zlexcount(&quot;foo&quot;, &quot;-&quot;, &quot;+&quot;));
520      assertEquals(3, jedis.zlexcount(&quot;foo&quot;, &quot;-&quot;, &quot;(c&quot;));
521      assertEquals(3, jedis.zlexcount(&quot;foo&quot;, &quot;[aa&quot;, &quot;+&quot;));
522    }
523    @Test
524    public void zlexcountBinary() {
525      jedis.zadd(bfoo, 1, ba);
526      jedis.zadd(bfoo, 1, bc);
527      jedis.zadd(bfoo, 1, bb);
528      assertEquals(1, jedis.zlexcount(bfoo, bInclusiveB, bExclusiveC));
529      assertEquals(3, jedis.zlexcount(bfoo, bLexMinusInf, bLexPlusInf));
530    }
531    @Test
532    public void zrangebyscore() {
533      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
534      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
535      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
536      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
537      List&lt;String&gt; range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d);
538      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
539      expected.add(&quot;c&quot;);
540      expected.add(&quot;a&quot;);
541      assertEquals(expected, range);
542      range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d, 0, 1);
543      expected = new ArrayList&lt;String&gt;();
544      expected.add(&quot;c&quot;);
545      assertEquals(expected, range);
546      range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d, 1, 1);
547      List&lt;String&gt; range2 = jedis.zrangeByScore(&quot;foo&quot;, &quot;-inf&quot;, &quot;(2&quot;);
548      assertEquals(expected, range2);
549      expected = new ArrayList&lt;String&gt;();
550      expected.add(&quot;a&quot;);
551      assertEquals(expected, range);
552      jedis.zadd(bfoo, 1d, ba);
553      jedis.zadd(bfoo, 10d, bb);
554      jedis.zadd(bfoo, 0.1d, bc);
555      jedis.zadd(bfoo, 2d, ba);
556      List&lt;byte[]&gt; brange = jedis.zrangeByScore(bfoo, 0d, 2d);
557      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
558      bexpected.add(bc);
559      bexpected.add(ba);
560      assertByteArrayListEquals(bexpected, brange);
561      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 0, 1);
562      bexpected = new ArrayList&lt;byte[]&gt;();
563      bexpected.add(bc);
564      assertByteArrayListEquals(bexpected, brange);
565      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 1, 1);
566      List&lt;byte[]&gt; brange2 = jedis.zrangeByScore(bfoo, SafeEncoder.encode(&quot;-inf&quot;),
567        SafeEncoder.encode(&quot;(2&quot;));
568      assertByteArrayListEquals(bexpected, brange2);
569      bexpected = new ArrayList&lt;byte[]&gt;();
570      bexpected.add(ba);
571      assertByteArrayListEquals(bexpected, brange);
572    }
573    @Test
574    public void zrevrangebyscore() {
575      jedis.zadd(&quot;foo&quot;, 1.0d, &quot;a&quot;);
576      jedis.zadd(&quot;foo&quot;, 2.0d, &quot;b&quot;);
577      jedis.zadd(&quot;foo&quot;, 3.0d, &quot;c&quot;);
578      jedis.zadd(&quot;foo&quot;, 4.0d, &quot;d&quot;);
579      jedis.zadd(&quot;foo&quot;, 5.0d, &quot;e&quot;);
580      List&lt;String&gt; range = jedis.zrevrangeByScore(&quot;foo&quot;, 3d, Double.NEGATIVE_INFINITY, 0, 1);
581      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
582      expected.add(&quot;c&quot;);
583      assertEquals(expected, range);
584      range = jedis.zrevrangeByScore(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
585      expected = new ArrayList&lt;String&gt;();
586      expected.add(&quot;c&quot;);
587      expected.add(&quot;b&quot;);
588      assertEquals(expected, range);
589      range = jedis.zrevrangeByScore(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
590      expected = new ArrayList&lt;String&gt;();
591      expected.add(&quot;b&quot;);
592      assertEquals(expected, range);
593      range = jedis.zrevrangeByScore(&quot;foo&quot;, 4d, 2d);
594      expected = new ArrayList&lt;String&gt;();
595      expected.add(&quot;d&quot;);
596      expected.add(&quot;c&quot;);
597      expected.add(&quot;b&quot;);
598      assertEquals(expected, range);
599      range = jedis.zrevrangeByScore(&quot;foo&quot;, &quot;4&quot;, &quot;2&quot;, 0, 2);
600      expected = new ArrayList&lt;String&gt;();
601      expected.add(&quot;d&quot;);
602      expected.add(&quot;c&quot;);
603      assertEquals(expected, range);
604      range = jedis.zrevrangeByScore(&quot;foo&quot;, &quot;+inf&quot;, &quot;(4&quot;);
605      expected = new ArrayList&lt;String&gt;();
606      expected.add(&quot;e&quot;);
607      assertEquals(expected, range);
608      jedis.zadd(bfoo, 1d, ba);
609      jedis.zadd(bfoo, 10d, bb);
610      jedis.zadd(bfoo, 0.1d, bc);
611      jedis.zadd(bfoo, 2d, ba);
612      List&lt;byte[]&gt; brange = jedis.zrevrangeByScore(bfoo, 2d, 0d);
613      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
614      bexpected.add(ba);
615      bexpected.add(bc);
616      assertByteArrayListEquals(bexpected, brange);
617      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 0, 1);
618      bexpected = new ArrayList&lt;byte[]&gt;();
619      bexpected.add(ba);
620      assertByteArrayListEquals(bexpected, brange);
621      List&lt;byte[]&gt; brange2 = jedis.zrevrangeByScore(bfoo, SafeEncoder.encode(&quot;+inf&quot;),
622        SafeEncoder.encode(&quot;(2&quot;));
623      bexpected = new ArrayList&lt;byte[]&gt;();
624      bexpected.add(bb);
625      assertByteArrayListEquals(bexpected, brange2);
626      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 1, 1);
627      bexpected = new ArrayList&lt;byte[]&gt;();
628      bexpected.add(bc);
629      assertByteArrayListEquals(bexpected, brange);
630    }
631    @Test
632    public void zrangebyscoreWithScores() {
633      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
634      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
635      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
636      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
637      List&lt;Tuple&gt; range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d);
638      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
639      expected.add(new Tuple(&quot;c&quot;, 0.1d));
640      expected.add(new Tuple(&quot;a&quot;, 2d));
641      assertEquals(expected, range);
642      range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d, 0, 1);
643      expected = new ArrayList&lt;Tuple&gt;();
644      expected.add(new Tuple(&quot;c&quot;, 0.1d));
645      assertEquals(expected, range);
646      range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d, 1, 1);
647      expected = new ArrayList&lt;Tuple&gt;();
648      expected.add(new Tuple(&quot;a&quot;, 2d));
649      assertEquals(expected, range);
650      jedis.zadd(bfoo, 1d, ba);
651      jedis.zadd(bfoo, 10d, bb);
652      jedis.zadd(bfoo, 0.1d, bc);
653      jedis.zadd(bfoo, 2d, ba);
654      List&lt;Tuple&gt; brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d);
655      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
656      bexpected.add(new Tuple(bc, 0.1d));
657      bexpected.add(new Tuple(ba, 2d));
658      assertEquals(bexpected, brange);
659      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 0, 1);
660      bexpected = new ArrayList&lt;Tuple&gt;();
661      bexpected.add(new Tuple(bc, 0.1d));
662      assertEquals(bexpected, brange);
663      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 1, 1);
664      bexpected = new ArrayList&lt;Tuple&gt;();
665      bexpected.add(new Tuple(ba, 2d));
666      assertEquals(bexpected, brange);
667    }
668    @Test
669    public void zrangeParams() {
670      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
671      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
672      jedis.zadd(&quot;foo&quot;, 1, &quot;bb&quot;);
673      jedis.zadd(&quot;foo&quot;, 1, &quot;d&quot;);
674      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
</span>675      expected.add(&quot;c&quot;);
676      expected.add(&quot;bb&quot;);
677      assertEquals(expected, jedis.zrange(&quot;foo&quot;, ZRangeParams.zrangeByLexParams(&quot;[c&quot;, &quot;(aa&quot;).rev()));
678      assertNotNull(jedis.zrangeWithScores(&quot;foo&quot;, ZRangeParams.zrangeByScoreParams(0, 1)));
679      jedis.zadd(bfoo, 1, ba);
680      jedis.zadd(bfoo, 1, bc);
681      jedis.zadd(bfoo, 1, bb);
682      List&lt;byte[]&gt; bExpected = new ArrayList&lt;byte[]&gt;();
683      bExpected.add(bb);
684      assertByteArrayListEquals(bExpected, jedis.zrange(bfoo, ZRangeParams.zrangeByLexParams(bExclusiveC, bInclusiveB).rev()));
685      assertNotNull(jedis.zrangeWithScores(bfoo, ZRangeParams.zrangeByScoreParams(0, 1).limit(0, 3)));
686    }
687    @Test
688    public void zrangestore() {
689      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
690      jedis.zadd(&quot;foo&quot;, 2, &quot;c&quot;);
691      jedis.zadd(&quot;foo&quot;, 3, &quot;bb&quot;);
692      long stored = jedis.zrangestore(&quot;bar&quot;, &quot;foo&quot;, ZRangeParams.zrangeByScoreParams(1, 2));
693      assertEquals(2, stored);
694      List&lt;String&gt; range = jedis.zrange(&quot;bar&quot;, 0, -1);
695      List&lt;String&gt; expected = new ArrayList&lt;&gt;();
696      expected.add(&quot;aa&quot;);
697      expected.add(&quot;c&quot;);
698      assertEquals(expected, range);
699      jedis.zadd(bfoo, 1d, ba);
700      jedis.zadd(bfoo, 10d, bb);
701      jedis.zadd(bfoo, 0.1d, bc);
702      jedis.zadd(bfoo, 2d, ba);
703      long bstored = jedis.zrangestore(bbar, bfoo, ZRangeParams.zrangeParams(0, 1).rev());
704      assertEquals(2, bstored);
705      List&lt;byte[]&gt; brange = jedis.zrevrange(bbar, 0, 1);
706      List&lt;byte[]&gt; bexpected = new ArrayList&lt;&gt;();
707      bexpected.add(bb);
708      bexpected.add(ba);
709      assertByteArrayListEquals(bexpected, brange);
710    }
711    @Test
712    public void zrevrangebyscoreWithScores() {
713      jedis.zadd(&quot;foo&quot;, 1.0d, &quot;a&quot;);
714      jedis.zadd(&quot;foo&quot;, 2.0d, &quot;b&quot;);
715      jedis.zadd(&quot;foo&quot;, 3.0d, &quot;c&quot;);
716      jedis.zadd(&quot;foo&quot;, 4.0d, &quot;d&quot;);
717      jedis.zadd(&quot;foo&quot;, 5.0d, &quot;e&quot;);
718      List&lt;Tuple&gt; range = jedis.zrevrangeByScoreWithScores(&quot;foo&quot;, 3d, Double.NEGATIVE_INFINITY, 0, 1);
719      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
720      expected.add(new Tuple(&quot;c&quot;, 3.0d));
721      assertEquals(expected, range);
722      range = jedis.zrevrangeByScoreWithScores(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
723      expected = new ArrayList&lt;Tuple&gt;();
724      expected.add(new Tuple(&quot;c&quot;, 3.0d));
725      expected.add(new Tuple(&quot;b&quot;, 2.0d));
726      assertEquals(expected, range);
727      range = jedis.zrevrangeByScoreWithScores(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
728      expected = new ArrayList&lt;Tuple&gt;();
729      expected.add(new Tuple(&quot;b&quot;, 2.0d));
730      assertEquals(expected, range);
731      range = jedis.zrevrangeByScoreWithScores(&quot;foo&quot;, 4d, 2d);
732      expected = new ArrayList&lt;Tuple&gt;();
733      expected.add(new Tuple(&quot;d&quot;, 4.0d));
734      expected.add(new Tuple(&quot;c&quot;, 3.0d));
735      expected.add(new Tuple(&quot;b&quot;, 2.0d));
736      assertEquals(expected, range);
737      jedis.zadd(bfoo, 1d, ba);
738      jedis.zadd(bfoo, 10d, bb);
739      jedis.zadd(bfoo, 0.1d, bc);
740      jedis.zadd(bfoo, 2d, ba);
741      List&lt;Tuple&gt; brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d);
742      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
743      bexpected.add(new Tuple(ba, 2d));
744      bexpected.add(new Tuple(bc, 0.1d));
745      assertEquals(bexpected, brange);
746      brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d, 0, 1);
747      bexpected = new ArrayList&lt;Tuple&gt;();
748      bexpected.add(new Tuple(ba, 2d));
749      assertEquals(bexpected, brange);
750      brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d, 1, 1);
751      bexpected = new ArrayList&lt;Tuple&gt;();
752      bexpected.add(new Tuple(bc, 0.1d));
753      assertEquals(bexpected, brange);
754    }
755    @Test
756    public void zremrangeByRank() {
757      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
758      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
759      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
760      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
761      assertEquals(1, jedis.zremrangeByRank(&quot;foo&quot;, 0, 0));
762      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
763      expected.add(&quot;a&quot;);
764      expected.add(&quot;b&quot;);
765      assertEquals(expected, jedis.zrange(&quot;foo&quot;, 0, 100));
766      jedis.zadd(bfoo, 1d, ba);
767      jedis.zadd(bfoo, 10d, bb);
768      jedis.zadd(bfoo, 0.1d, bc);
769      jedis.zadd(bfoo, 2d, ba);
770      assertEquals(1, jedis.zremrangeByRank(bfoo, 0, 0));
771      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
772      bexpected.add(ba);
773      bexpected.add(bb);
774      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
775    }
776    @Test
777    public void zremrangeByScore() {
778      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
779      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
780      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
781      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
782      assertEquals(2, jedis.zremrangeByScore(&quot;foo&quot;, 0, 2));
783      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
784      expected.add(&quot;b&quot;);
785      assertEquals(expected, jedis.zrange(&quot;foo&quot;, 0, 100));
786      jedis.zadd(bfoo, 1d, ba);
787      jedis.zadd(bfoo, 10d, bb);
788      jedis.zadd(bfoo, 0.1d, bc);
789      jedis.zadd(bfoo, 2d, ba);
790      assertEquals(2, jedis.zremrangeByScore(bfoo, 0, 2));
791      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
792      bexpected.add(bb);
793      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
794    }
795    @Test
796    public void zremrangeByScoreExclusive() {
797      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
798      jedis.zadd(&quot;foo&quot;, 0d, &quot;c&quot;);
799      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
800      assertEquals(1, jedis.zremrangeByScore(&quot;foo&quot;, &quot;(0&quot;, &quot;(2&quot;));
801      jedis.zadd(bfoo, 1d, ba);
802      jedis.zadd(bfoo, 0d, bc);
803      jedis.zadd(bfoo, 2d, bb);
804      assertEquals(1, jedis.zremrangeByScore(bfoo, &quot;(0&quot;.getBytes(), &quot;(2&quot;.getBytes()));
805    }
806    @Test
807    public void zremrangeByLex() {
808      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
809      jedis.zadd(&quot;foo&quot;, 1, &quot;b&quot;);
810      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
811      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
812      assertEquals(2, jedis.zremrangeByLex(&quot;foo&quot;, &quot;[aa&quot;, &quot;(c&quot;));
813      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
814      expected.add(&quot;a&quot;);
815      expected.add(&quot;c&quot;);
816      assertEquals(expected, jedis.zrangeByLex(&quot;foo&quot;, &quot;-&quot;, &quot;+&quot;));
817    }
818    @Test
819    public void zremrangeByLexBinary() {
820      jedis.zadd(bfoo, 1, ba);
821      jedis.zadd(bfoo, 1, bc);
822      jedis.zadd(bfoo, 1, bb);
823      assertEquals(1, jedis.zremrangeByLex(bfoo, bInclusiveB, bExclusiveC));
824      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
825      bexpected.add(ba);
826      bexpected.add(bc);
827      assertByteArrayListEquals(bexpected, jedis.zrangeByLex(bfoo, bLexMinusInf, bLexPlusInf));
828    }
829    @Test
830    public void zunion() {
831      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
832      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
833      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
834      jedis.zadd(&quot;bar&quot;, 2, &quot;b&quot;);
835      ZParams params = new ZParams();
836      params.weights(2, 2.5);
837      params.aggregate(ZParams.Aggregate.SUM);
838      List&lt;String&gt; expected = new ArrayList&lt;&gt;();
839      expected.add(&quot;a&quot;);
840      expected.add(&quot;b&quot;);
841      assertEquals(expected, jedis.zunion(params, &quot;foo&quot;, &quot;bar&quot;));
842      List&lt;Tuple&gt; expectedTuple = new ArrayList&lt;&gt;();
843      expectedTuple.add(new Tuple(&quot;a&quot;, new Double(7)));
844      expectedTuple.add(new Tuple(&quot;b&quot;, new Double(9)));
845      assertEquals(expectedTuple, jedis.zunionWithScores(params, &quot;foo&quot;, &quot;bar&quot;));
846      jedis.zadd(bfoo, 1, ba);
847      jedis.zadd(bfoo, 2, bb);
848      jedis.zadd(bbar, 2, ba);
849      jedis.zadd(bbar, 2, bb);
850      List&lt;byte[]&gt; bexpected = new ArrayList&lt;&gt;();
851      bexpected.add(ba);
852      bexpected.add(bb);
853      AssertUtil.assertByteArrayListEquals(bexpected, jedis.zunion(params, bfoo, bbar));
854      List&lt;Tuple&gt; bexpectedTuple = new ArrayList&lt;&gt;();
855      bexpectedTuple.add(new Tuple(ba, new Double(7)));
856      bexpectedTuple.add(new Tuple(bb, new Double(9)));
857      assertEquals(bexpectedTuple, jedis.zunionWithScores(params, bfoo, bbar));
858    }
859    @Test
860    public void zunionstore() {
861      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
862      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
863      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
864      jedis.zadd(&quot;bar&quot;, 2, &quot;b&quot;);
865      assertEquals(2, jedis.zunionstore(&quot;dst&quot;, &quot;foo&quot;, &quot;bar&quot;));
866      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
867      expected.add(new Tuple(&quot;a&quot;, new Double(3)));
868      expected.add(new Tuple(&quot;b&quot;, new Double(4)));
869      assertEquals(expected, jedis.zrangeWithScores(&quot;dst&quot;, 0, 100));
870      jedis.zadd(bfoo, 1, ba);
871      jedis.zadd(bfoo, 2, bb);
872      jedis.zadd(bbar, 2, ba);
873      jedis.zadd(bbar, 2, bb);
874      assertEquals(2, jedis.zunionstore(SafeEncoder.encode(&quot;dst&quot;), bfoo, bbar));
875      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
876      bexpected.add(new Tuple(ba, new Double(3)));
877      bexpected.add(new Tuple(bb, new Double(4)));
878      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode(&quot;dst&quot;), 0, 100));
879    }
880    @Test
881    public void zunionstoreParams() {
882      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
883      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
884      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
885      jedis.zadd(&quot;bar&quot;, 2, &quot;b&quot;);
886      ZParams params = new ZParams();
887      params.weights(2, 2.5);
888      params.aggregate(ZParams.Aggregate.SUM);
889      assertEquals(2, jedis.zunionstore(&quot;dst&quot;, params, &quot;foo&quot;, &quot;bar&quot;));
890      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
891      expected.add(new Tuple(&quot;a&quot;, new Double(7)));
892      expected.add(new Tuple(&quot;b&quot;, new Double(9)));
893      assertEquals(expected, jedis.zrangeWithScores(&quot;dst&quot;, 0, 100));
894      jedis.zadd(bfoo, 1, ba);
895      jedis.zadd(bfoo, 2, bb);
896      jedis.zadd(bbar, 2, ba);
897      jedis.zadd(bbar, 2, bb);
898      ZParams bparams = new ZParams();
899      bparams.weights(2, 2.5);
900      bparams.aggregate(ZParams.Aggregate.SUM);
901      assertEquals(2, jedis.zunionstore(SafeEncoder.encode(&quot;dst&quot;), bparams, bfoo, bbar));
902      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
903      bexpected.add(new Tuple(ba, new Double(7)));
904      bexpected.add(new Tuple(bb, new Double(9)));
905      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode(&quot;dst&quot;), 0, 100));
906    }
907    @Test
908    public void zinter() {
909      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
910      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
911      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
912      ZParams params = new ZParams();
913      params.weights(2, 2.5);
914      params.aggregate(ZParams.Aggregate.SUM);
915      assertEquals(singletonList(&quot;a&quot;), jedis.zinter(params, &quot;foo&quot;, &quot;bar&quot;));
916      assertEquals(singletonList(new Tuple(&quot;a&quot;, new Double(7))),
917        jedis.zinterWithScores(params, &quot;foo&quot;, &quot;bar&quot;));
918      jedis.zadd(bfoo, 1, ba);
919      jedis.zadd(bfoo, 2, bb);
920      jedis.zadd(bbar, 2, ba);
921      ZParams bparams = new ZParams();
922      bparams.weights(2, 2.5);
923      bparams.aggregate(ZParams.Aggregate.SUM);
924      AssertUtil.assertByteArrayListEquals(singletonList(ba), jedis.zinter(params, bfoo, bbar));
925      assertEquals(singletonList(new Tuple(ba, new Double(7))),
926        jedis.zinterWithScores(bparams, bfoo, bbar));
927    }
928    @Test
929    public void zinterstore() {
930      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
931      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
932      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
933      assertEquals(1, jedis.zinterstore(&quot;dst&quot;, &quot;foo&quot;, &quot;bar&quot;));
934      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
935      expected.add(new Tuple(&quot;a&quot;, new Double(3)));
936      assertEquals(expected, jedis.zrangeWithScores(&quot;dst&quot;, 0, 100));
937      jedis.zadd(bfoo, 1, ba);
938      jedis.zadd(bfoo, 2, bb);
939      jedis.zadd(bbar, 2, ba);
940      assertEquals(1, jedis.zinterstore(SafeEncoder.encode(&quot;dst&quot;), bfoo, bbar));
941      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
942      bexpected.add(new Tuple(ba, new Double(3)));
943      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode(&quot;dst&quot;), 0, 100));
944    }
945    @Test
946    public void zintertoreParams() {
947      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
948      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
949      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
950      ZParams params = new ZParams();
951      params.weights(2, 2.5);
952      params.aggregate(ZParams.Aggregate.SUM);
953      assertEquals(1, jedis.zinterstore(&quot;dst&quot;, params, &quot;foo&quot;, &quot;bar&quot;));
954      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
955      expected.add(new Tuple(&quot;a&quot;, new Double(7)));
956      assertEquals(expected, jedis.zrangeWithScores(&quot;dst&quot;, 0, 100));
957      jedis.zadd(bfoo, 1, ba);
958      jedis.zadd(bfoo, 2, bb);
959      jedis.zadd(bbar, 2, ba);
960      ZParams bparams = new ZParams();
961      bparams.weights(2, 2.5);
962      bparams.aggregate(ZParams.Aggregate.SUM);
963      assertEquals(1, jedis.zinterstore(SafeEncoder.encode(&quot;dst&quot;), bparams, bfoo, bbar));
964      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
965      bexpected.add(new Tuple(ba, new Double(7)));
966      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode(&quot;dst&quot;), 0, 100));
967    }
968    @Test
969    public void zintercard() {
970      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
971      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
972      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
973      jedis.zadd(&quot;bar&quot;, 1, &quot;b&quot;);
974      assertEquals(2, jedis.zintercard(&quot;foo&quot;, &quot;bar&quot;));
975      assertEquals(1, jedis.zintercard(1, &quot;foo&quot;, &quot;bar&quot;));
976      jedis.zadd(bfoo, 1, ba);
977      jedis.zadd(bfoo, 2, bb);
978      jedis.zadd(bbar, 2, ba);
979      jedis.zadd(bbar, 2, bb);
980      assertEquals(2, jedis.zintercard(bfoo, bbar));
981      assertEquals(1, jedis.zintercard(1, bfoo, bbar));
982    }
983    @Test
984    public void zscan() {
985      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
986      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
987      ScanResult&lt;Tuple&gt; result = jedis.zscan(&quot;foo&quot;, SCAN_POINTER_START);
988      assertEquals(SCAN_POINTER_START, result.getCursor());
989      assertFalse(result.getResult().isEmpty());
990      jedis.zadd(bfoo, 1, ba);
991      jedis.zadd(bfoo, 1, bb);
992      ScanResult&lt;Tuple&gt; bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY);
993      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
994      assertFalse(bResult.getResult().isEmpty());
995    }
996    @Test
997    public void zscanMatch() {
998      ScanParams params = new ScanParams();
999      params.match(&quot;a*&quot;);
1000      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
1001      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
1002      jedis.zadd(&quot;foo&quot;, 11, &quot;aa&quot;);
1003      ScanResult&lt;Tuple&gt; result = jedis.zscan(&quot;foo&quot;, SCAN_POINTER_START, params);
1004      assertEquals(SCAN_POINTER_START, result.getCursor());
1005      assertFalse(result.getResult().isEmpty());
1006      params = new ScanParams();
1007      params.match(bbarstar);
1008      jedis.zadd(bfoo, 2, bbar1);
1009      jedis.zadd(bfoo, 1, bbar2);
1010      jedis.zadd(bfoo, 11, bbar3);
1011      ScanResult&lt;Tuple&gt; bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY, params);
1012      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
1013      assertFalse(bResult.getResult().isEmpty());
1014    }
1015    @Test
1016    public void zscanCount() {
1017      ScanParams params = new ScanParams();
1018      params.count(2);
1019      jedis.zadd(&quot;foo&quot;, 1, &quot;a1&quot;);
1020      jedis.zadd(&quot;foo&quot;, 2, &quot;a2&quot;);
1021      jedis.zadd(&quot;foo&quot;, 3, &quot;a3&quot;);
1022      jedis.zadd(&quot;foo&quot;, 4, &quot;a4&quot;);
1023      jedis.zadd(&quot;foo&quot;, 5, &quot;a5&quot;);
1024      ScanResult&lt;Tuple&gt; result = jedis.zscan(&quot;foo&quot;, SCAN_POINTER_START, params);
1025      assertFalse(result.getResult().isEmpty());
1026      params = new ScanParams();
1027      params.count(2);
1028      jedis.zadd(bfoo, 2, bbar1);
1029      jedis.zadd(bfoo, 1, bbar2);
1030      jedis.zadd(bfoo, 11, bbar3);
1031      ScanResult&lt;Tuple&gt; bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY, params);
1032      assertFalse(bResult.getResult().isEmpty());
1033    }
1034    @Test
1035    public void infinity() {
1036      jedis.zadd(&quot;key&quot;, Double.POSITIVE_INFINITY, &quot;pos&quot;);
1037      assertEquals(Double.POSITIVE_INFINITY, jedis.zscore(&quot;key&quot;, &quot;pos&quot;), 0d);
1038      jedis.zadd(&quot;key&quot;, Double.NEGATIVE_INFINITY, &quot;neg&quot;);
1039      assertEquals(Double.NEGATIVE_INFINITY, jedis.zscore(&quot;key&quot;, &quot;neg&quot;), 0d);
1040      jedis.zadd(&quot;key&quot;, 0d, &quot;zero&quot;);
1041      List&lt;Tuple&gt; set = jedis.zrangeWithScores(&quot;key&quot;, 0, -1);
1042      Iterator&lt;Tuple&gt; itr = set.iterator();
1043      assertEquals(Double.NEGATIVE_INFINITY, itr.next().getScore(), 0d);
1044      assertEquals(0d, itr.next().getScore(), 0d);
1045      assertEquals(Double.POSITIVE_INFINITY, itr.next().getScore(), 0d);
1046    }
1047    @Test
1048    public void bzpopmax() {
1049      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1050      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
1051      jedis.zadd(&quot;bar&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
1052      assertEquals(new KeyValue&lt;&gt;(&quot;foo&quot;, new Tuple(&quot;b&quot;, 10d)), jedis.bzpopmax(0, &quot;foo&quot;, &quot;bar&quot;));
1053      jedis.zadd(bfoo, 1d, ba);
1054      jedis.zadd(bfoo, 10d, bb);
1055      jedis.zadd(bbar, 0.1d, bc);
1056      KeyValue&lt;byte[], Tuple&gt; actual = jedis.bzpopmax(0, bfoo, bbar);
1057      assertArrayEquals(bfoo, actual.getKey());
1058      assertEquals(new Tuple(bb, 10d), actual.getValue());
1059    }
1060    @Test
1061    public void bzpopmin() {
1062      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1063      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
1064      jedis.zadd(&quot;bar&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
1065      assertEquals(new KeyValue&lt;&gt;(&quot;bar&quot;, new Tuple(&quot;c&quot;, 0.1)), jedis.bzpopmin(0, &quot;bar&quot;, &quot;foo&quot;));
1066      jedis.zadd(bfoo, 1d, ba);
1067      jedis.zadd(bfoo, 10d, bb);
1068      jedis.zadd(bbar, 0.1d, bc);
1069      KeyValue&lt;byte[], Tuple&gt; actual = jedis.bzpopmin(0, bbar, bfoo);
1070      assertArrayEquals(bbar, (byte[]) actual.getKey());
1071      assertEquals(new Tuple(bc, 0.1), actual.getValue());
1072    }
1073    @Test
1074    public void zdiff() {
1075      jedis.zadd(&quot;foo&quot;, 1.0, &quot;a&quot;);
1076      jedis.zadd(&quot;foo&quot;, 2.0, &quot;b&quot;);
1077      jedis.zadd(&quot;bar&quot;, 1.0, &quot;a&quot;);
1078      assertEquals(0, jedis.zdiff(&quot;bar1&quot;, &quot;bar2&quot;).size());
1079      assertEquals(singletonList(&quot;b&quot;), jedis.zdiff(&quot;foo&quot;, &quot;bar&quot;));
1080      assertEquals(singletonList(new Tuple(&quot;b&quot;, 2.0d)), jedis.zdiffWithScores(&quot;foo&quot;, &quot;bar&quot;));
1081      jedis.zadd(bfoo, 1.0, ba);
1082      jedis.zadd(bfoo, 2.0, bb);
1083      jedis.zadd(bbar, 1.0, ba);
1084      assertEquals(0, jedis.zdiff(bbar1, bbar2).size());
1085      List&lt;byte[]&gt; bactual = jedis.zdiff(bfoo, bbar);
1086      assertEquals(1, bactual.size());
1087      assertArrayEquals(bb, bactual.iterator().next());
1088      assertEquals(singletonList(new Tuple(bb, 2.0d)), jedis.zdiffWithScores(bfoo, bbar));
1089    }
1090    @Test
1091    public void zdiffstore() {
1092      jedis.zadd(&quot;foo&quot;, 1.0, &quot;a&quot;);
1093      jedis.zadd(&quot;foo&quot;, 2.0, &quot;b&quot;);
1094      jedis.zadd(&quot;bar&quot;, 1.0, &quot;a&quot;);
1095      assertEquals(0, jedis.zdiffstore(&quot;bar3&quot;, &quot;bar1&quot;, &quot;bar2&quot;));
1096      assertEquals(1, jedis.zdiffstore(&quot;bar3&quot;, &quot;foo&quot;, &quot;bar&quot;));
1097      assertEquals(singletonList(&quot;b&quot;), jedis.zrange(&quot;bar3&quot;, 0, -1));
1098      jedis.zadd(bfoo, 1.0, ba);
1099      jedis.zadd(bfoo, 2.0, bb);
1100      jedis.zadd(bbar, 1.0, ba);
1101      assertEquals(0, jedis.zdiffstore(bbar3, bbar1, bbar2));
1102      assertEquals(1, jedis.zdiffstore(bbar3, bfoo, bbar));
1103      List&lt;byte[]&gt; bactual = jedis.zrange(bbar3, 0, -1);
1104      assertArrayEquals(bb, bactual.iterator().next());
1105    }
1106    @Test
1107    public void zrandmember() {
1108      assertNull(jedis.zrandmember(&quot;foo&quot;));
1109      assertEquals(Collections.emptyList(), jedis.zrandmember(&quot;foo&quot;, 1));
1110      assertEquals(Collections.emptyList(), jedis.zrandmemberWithScores(&quot;foo&quot;, 1));
1111      Map&lt;String, Double&gt; hash = new HashMap&lt;&gt;();
1112      hash.put(&quot;bar1&quot;, 1d);
1113      hash.put(&quot;bar2&quot;, 10d);
1114      hash.put(&quot;bar3&quot;, 0.1d);
1115      jedis.zadd(&quot;foo&quot;, hash);
1116      AssertUtil.assertCollectionContains(hash.keySet(), jedis.zrandmember(&quot;foo&quot;));
1117      assertEquals(2, jedis.zrandmember(&quot;foo&quot;, 2).size());
1118      List&lt;Tuple&gt; actual = jedis.zrandmemberWithScores(&quot;foo&quot;, 2);
1119      assertEquals(2, actual.size());
1120      actual.forEach(t -&gt; assertEquals(hash.get(t.getElement()), t.getScore(), 0d));
1121      assertNull(jedis.zrandmember(bfoo));
1122      assertEquals(Collections.emptyList(), jedis.zrandmember(bfoo, 1));
1123      assertEquals(Collections.emptyList(), jedis.zrandmemberWithScores(bfoo, 1));
1124      Map&lt;byte[], Double&gt; bhash = new HashMap&lt;&gt;();
1125      bhash.put(bbar1, 1d);
1126      bhash.put(bbar2, 10d);
1127      bhash.put(bbar3, 0.1d);
1128      jedis.zadd(bfoo, bhash);
1129      AssertUtil.assertByteArrayCollectionContains(bhash.keySet(), jedis.zrandmember(bfoo));
1130      assertEquals(2, jedis.zrandmember(bfoo, 2).size());
1131      List&lt;Tuple&gt; bactual = jedis.zrandmemberWithScores(bfoo, 2);
1132      assertEquals(2, bactual.size());
1133      bactual.forEach(t -&gt; assertEquals(getScoreFromByteMap(bhash, t.getBinaryElement()), t.getScore(), 0d));
1134    }
1135    private Double getScoreFromByteMap(Map&lt;byte[], Double&gt; bhash, byte[] key) {
1136      for (Map.Entry&lt;byte[], Double&gt; en : bhash.entrySet()) {
1137        if (Arrays.equals(en.getKey(), key)) {
1138          return en.getValue();
1139        }
1140      }
1141      return null;
1142    }
1143    @Test
1144    public void zmpop() {
1145      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1146      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
1147      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
1148      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1149      KeyValue&lt;String, List&lt;Tuple&gt;&gt; single = jedis.zmpop(SortedSetOption.MAX, &quot;foo&quot;);
1150      KeyValue&lt;String, List&lt;Tuple&gt;&gt; range = jedis.zmpop(SortedSetOption.MIN, 2, &quot;foo&quot;);
1151      assertEquals(new Tuple(&quot;b&quot;, 10d), single.getValue().get(0));
1152      assertEquals(2, range.getValue().size());
1153      assertNull(jedis.zmpop(SortedSetOption.MAX, &quot;foo&quot;));
1154    }
1155    @Test
1156    public void bzmpopSimple() {
1157      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1158      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
1159      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
1160      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1161      KeyValue&lt;String, List&lt;Tuple&gt;&gt; single = jedis.bzmpop(1L, SortedSetOption.MAX, &quot;foo&quot;);
1162      KeyValue&lt;String, List&lt;Tuple&gt;&gt; range = jedis.bzmpop(1L, SortedSetOption.MIN, 2, &quot;foo&quot;);
1163      assertEquals(new Tuple(&quot;b&quot;, 10d), single.getValue().get(0));
1164      assertEquals(2, range.getValue().size());
1165      assertNull(jedis.bzmpop(1L, SortedSetOption.MAX, &quot;foo&quot;));
1166    }
1167  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SortedSetCommandsTestBase.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.unified;
2  import static java.util.Collections.singletonList;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
5  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
6  import static redis.clients.jedis.util.AssertUtil.assertByteArrayListEquals;
7  import java.util.*;
8  import org.junit.Test;
9  import redis.clients.jedis.args.SortedSetOption;
10  import redis.clients.jedis.params.*;
11  import redis.clients.jedis.resps.ScanResult;
12  import redis.clients.jedis.resps.Tuple;
13  import redis.clients.jedis.util.AssertUtil;
14  import redis.clients.jedis.util.KeyValue;
15  import redis.clients.jedis.util.SafeEncoder;
16  public abstract class SortedSetCommandsTestBase extends UnifiedJedisCommandsTestBase {
17    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
18    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
19    final byte[] bcar = { 0x09, 0x0A, 0x0B, 0x0C };
20    final byte[] ba = { 0x0A };
21    final byte[] bb = { 0x0B };
22    final byte[] bc = { 0x0C };
23    final byte[] bInclusiveB = { 0x5B, 0x0B };
24    final byte[] bExclusiveC = { 0x28, 0x0C };
25    final byte[] bLexMinusInf = { 0x2D };
26    final byte[] bLexPlusInf = { 0x2B };
27    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
28    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
29    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
30    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, &#x27;*&#x27; };
31    @Test
32    public void zadd() {
33      assertEquals(1, jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;));
34      assertEquals(1, jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;));
35      assertEquals(1, jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;));
36      assertEquals(0, jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;));
37      assertEquals(1, jedis.zadd(bfoo, 1d, ba));
38      assertEquals(1, jedis.zadd(bfoo, 10d, bb));
39      assertEquals(1, jedis.zadd(bfoo, 0.1d, bc));
40      assertEquals(0, jedis.zadd(bfoo, 2d, ba));
41    }
42    @Test
43    public void zaddWithParams() {
44      jedis.del(&quot;foo&quot;);
45      assertEquals(0L, jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().xx()));
46      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
47      assertEquals(0L, jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx()));
48      assertEquals(Double.valueOf(1d), jedis.zscore(&quot;foo&quot;, &quot;a&quot;));
49      Map&lt;String, Double&gt; scoreMembers = new HashMap&lt;String, Double&gt;();
50      scoreMembers.put(&quot;a&quot;, 2d);
51      scoreMembers.put(&quot;b&quot;, 1d);
52      assertEquals(2L, jedis.zadd(&quot;foo&quot;, scoreMembers, ZAddParams.zAddParams().ch()));
53      jedis.zadd(&quot;foo&quot;, 3d, &quot;a&quot;, ZAddParams.zAddParams().lt());
54      assertEquals(Double.valueOf(2d), jedis.zscore(&quot;foo&quot;, &quot;a&quot;));
55      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().lt());
56      assertEquals(Double.valueOf(1d), jedis.zscore(&quot;foo&quot;, &quot;a&quot;));
57      jedis.zadd(&quot;foo&quot;, 0d, &quot;b&quot;, ZAddParams.zAddParams().gt());
58      assertEquals(Double.valueOf(1d), jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
59      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;, ZAddParams.zAddParams().gt());
60      assertEquals(Double.valueOf(2d), jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
61      assertNull(jedis.zaddIncr(&quot;foo&quot;, 1d, &quot;b&quot;, ZAddParams.zAddParams().nx()));
62      assertEquals(Double.valueOf(2d), jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
63      assertEquals(Double.valueOf(3d), jedis.zaddIncr(&quot;foo&quot;, 1d,&quot;b&quot;, ZAddParams.zAddParams().xx()));
64      assertEquals(Double.valueOf(3d), jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
65      jedis.del(bfoo);
66      assertEquals(0L, jedis.zadd(bfoo, 1d, ba, ZAddParams.zAddParams().xx()));
67      jedis.zadd(bfoo, 1d, ba);
68      assertEquals(0L, jedis.zadd(bfoo, 2d, ba, ZAddParams.zAddParams().nx()));
69      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, ba));
70      Map&lt;byte[], Double&gt; binaryScoreMembers = new HashMap&lt;byte[], Double&gt;();
71      binaryScoreMembers.put(ba, 2d);
72      binaryScoreMembers.put(bb, 1d);
73      assertEquals(2L, jedis.zadd(bfoo, binaryScoreMembers, ZAddParams.zAddParams().ch()));
74      jedis.zadd(bfoo, 3d, ba, ZAddParams.zAddParams().lt());
75      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, ba));
76      jedis.zadd(bfoo, 1d, ba, ZAddParams.zAddParams().lt());
77      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, ba));
78      jedis.zadd(bfoo, 0d, bb, ZAddParams.zAddParams().gt());
79      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, bb));
80      jedis.zadd(bfoo, 2d, bb, ZAddParams.zAddParams().gt());
81      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, bb));
82      assertNull(jedis.zaddIncr(bfoo, 1d, bb, ZAddParams.zAddParams().nx()));
83      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, bb));
84      assertEquals(Double.valueOf(3d), jedis.zaddIncr(bfoo, 1d, bb, ZAddParams.zAddParams().xx()));
85      assertEquals(Double.valueOf(3d), jedis.zscore(bfoo, bb));
86    }
87    @Test
88    public void zrange() {
89      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
90      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
91      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
92      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
93      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
94      expected.add(&quot;c&quot;);
95      expected.add(&quot;a&quot;);
96      List&lt;String&gt; range = jedis.zrange(&quot;foo&quot;, 0, 1);
97      assertEquals(expected, range);
98      expected.add(&quot;b&quot;);
99      range = jedis.zrange(&quot;foo&quot;, 0, 100);
100      assertEquals(expected, range);
101      jedis.zadd(bfoo, 1d, ba);
102      jedis.zadd(bfoo, 10d, bb);
103      jedis.zadd(bfoo, 0.1d, bc);
104      jedis.zadd(bfoo, 2d, ba);
105      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
106      bexpected.add(bc);
107      bexpected.add(ba);
108      List&lt;byte[]&gt; brange = jedis.zrange(bfoo, 0, 1);
109      assertByteArrayListEquals(bexpected, brange);
110      bexpected.add(bb);
111      brange = jedis.zrange(bfoo, 0, 100);
112      assertByteArrayListEquals(bexpected, brange);
113    }
114    @Test
115    public void zrangeByLex() {
116      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
117      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
118      jedis.zadd(&quot;foo&quot;, 1, &quot;bb&quot;);
119      jedis.zadd(&quot;foo&quot;, 1, &quot;d&quot;);
120      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
121      expected.add(&quot;bb&quot;);
122      expected.add(&quot;c&quot;);
123      assertEquals(expected, jedis.zrangeByLex(&quot;foo&quot;, &quot;(aa&quot;, &quot;[c&quot;));
124      expected.clear();
125      expected.add(&quot;bb&quot;);
126      expected.add(&quot;c&quot;);
127      assertEquals(expected, jedis.zrangeByLex(&quot;foo&quot;, &quot;-&quot;, &quot;+&quot;, 1, 2));
128    }
129    @Test
130    public void zrangeByLexBinary() {
131      jedis.zadd(bfoo, 1, ba);
132      jedis.zadd(bfoo, 1, bc);
133      jedis.zadd(bfoo, 1, bb);
134      List&lt;byte[]&gt; bExpected = new ArrayList&lt;byte[]&gt;();
135      bExpected.add(bb);
136      assertByteArrayListEquals(bExpected, jedis.zrangeByLex(bfoo, bInclusiveB, bExclusiveC));
137      bExpected.clear();
138      bExpected.add(ba);
139      bExpected.add(bb);
140      assertByteArrayListEquals(bExpected, jedis.zrangeByLex(bfoo, bLexMinusInf, bLexPlusInf, 0, 2));
141    }
142    @Test
143    public void zrevrangeByLex() {
144      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
145      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
146      jedis.zadd(&quot;foo&quot;, 1, &quot;bb&quot;);
147      jedis.zadd(&quot;foo&quot;, 1, &quot;d&quot;);
148      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
149      expected.add(&quot;c&quot;);
150      expected.add(&quot;bb&quot;);
151      assertEquals(expected, jedis.zrevrangeByLex(&quot;foo&quot;, &quot;[c&quot;, &quot;(aa&quot;));
152      expected.clear();
153      expected.add(&quot;c&quot;);
154      expected.add(&quot;bb&quot;);
155      assertEquals(expected, jedis.zrevrangeByLex(&quot;foo&quot;, &quot;+&quot;, &quot;-&quot;, 1, 2));
156    }
157    @Test
158    public void zrevrangeByLexBinary() {
159      jedis.zadd(bfoo, 1, ba);
160      jedis.zadd(bfoo, 1, bc);
161      jedis.zadd(bfoo, 1, bb);
162      List&lt;byte[]&gt; bExpected = new ArrayList&lt;byte[]&gt;();
163      bExpected.add(bb);
164      assertByteArrayListEquals(bExpected, jedis.zrevrangeByLex(bfoo, bExclusiveC, bInclusiveB));
165      bExpected.clear();
166      bExpected.add(bc);
167      bExpected.add(bb);
168      assertByteArrayListEquals(bExpected, jedis.zrevrangeByLex(bfoo, bLexPlusInf, bLexMinusInf, 0, 2));
169    }
170    @Test
171    public void zrevrange() {
172      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
173      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
174      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
175      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
176      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
177      expected.add(&quot;b&quot;);
178      expected.add(&quot;a&quot;);
179      List&lt;String&gt; range = jedis.zrevrange(&quot;foo&quot;, 0, 1);
180      assertEquals(expected, range);
181      expected.add(&quot;c&quot;);
182      range = jedis.zrevrange(&quot;foo&quot;, 0, 100);
183      assertEquals(expected, range);
184      jedis.zadd(bfoo, 1d, ba);
185      jedis.zadd(bfoo, 10d, bb);
186      jedis.zadd(bfoo, 0.1d, bc);
187      jedis.zadd(bfoo, 2d, ba);
188      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
189      bexpected.add(bb);
190      bexpected.add(ba);
191      List&lt;byte[]&gt; brange = jedis.zrevrange(bfoo, 0, 1);
192      assertByteArrayListEquals(bexpected, brange);
193      bexpected.add(bc);
194      brange = jedis.zrevrange(bfoo, 0, 100);
195      assertByteArrayListEquals(bexpected, brange);
196    }
197    @Test
198    public void zrangeParams() {
199      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
200      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
201      jedis.zadd(&quot;foo&quot;, 1, &quot;bb&quot;);
202      jedis.zadd(&quot;foo&quot;, 1, &quot;d&quot;);
203      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
204      expected.add(&quot;c&quot;);
205      expected.add(&quot;bb&quot;);
206      assertEquals(expected, jedis.zrange(&quot;foo&quot;, ZRangeParams.zrangeByLexParams(&quot;[c&quot;, &quot;(aa&quot;).rev()));
207      assertNotNull(jedis.zrangeWithScores(&quot;foo&quot;, ZRangeParams.zrangeByScoreParams(0, 1)));
208      jedis.zadd(bfoo, 1, ba);
209      jedis.zadd(bfoo, 1, bc);
210      jedis.zadd(bfoo, 1, bb);
211      List&lt;byte[]&gt; bExpected = new ArrayList&lt;byte[]&gt;();
212      bExpected.add(bb);
213      assertByteArrayListEquals(bExpected, jedis.zrange(bfoo, ZRangeParams.zrangeByLexParams(bExclusiveC, bInclusiveB).rev()));
214      assertNotNull(jedis.zrangeWithScores(bfoo, ZRangeParams.zrangeByScoreParams(0, 1).limit(0, 3)));
215    }
216    @Test
217    public void zrangestore() {
218      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
219      jedis.zadd(&quot;foo&quot;, 2, &quot;c&quot;);
220      jedis.zadd(&quot;foo&quot;, 3, &quot;bb&quot;);
221      long stored = jedis.zrangestore(&quot;bar&quot;, &quot;foo&quot;, ZRangeParams.zrangeByScoreParams(1, 2));
222      assertEquals(2, stored);
223      List&lt;String&gt; range = jedis.zrange(&quot;bar&quot;, 0, -1);
224      List&lt;String&gt; expected = new ArrayList&lt;&gt;();
225      expected.add(&quot;aa&quot;);
226      expected.add(&quot;c&quot;);
227      assertEquals(expected, range);
228      jedis.zadd(bfoo, 1d, ba);
229      jedis.zadd(bfoo, 10d, bb);
230      jedis.zadd(bfoo, 0.1d, bc);
231      jedis.zadd(bfoo, 2d, ba);
232      long bstored = jedis.zrangestore(bbar, bfoo, ZRangeParams.zrangeParams(0, 1).rev());
233      assertEquals(2, bstored);
234      List&lt;byte[]&gt; brange = jedis.zrevrange(bbar, 0, 1);
235      List&lt;byte[]&gt; bexpected = new ArrayList&lt;&gt;();
236      bexpected.add(bb);
237      bexpected.add(ba);
238      assertByteArrayListEquals(bexpected, brange);
239    }
240    @Test
241    public void zrem() {
242      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
243      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
244      assertEquals(1, jedis.zrem(&quot;foo&quot;, &quot;a&quot;));
245      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
246      expected.add(&quot;b&quot;);
247      assertEquals(expected, jedis.zrange(&quot;foo&quot;, 0, 100));
248      assertEquals(0, jedis.zrem(&quot;foo&quot;, &quot;bar&quot;));
249      jedis.zadd(bfoo, 1d, ba);
250      jedis.zadd(bfoo, 2d, bb);
251      assertEquals(1, jedis.zrem(bfoo, ba));
252      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
253      bexpected.add(bb);
254      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
255      assertEquals(0, jedis.zrem(bfoo, bbar));
256    }
257    @Test
258    public void zincrby() {
259      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
260      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
261      assertEquals(3d, jedis.zincrby(&quot;foo&quot;, 2d, &quot;a&quot;), 0);
262      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
263      expected.add(&quot;b&quot;);
264      expected.add(&quot;a&quot;);
265      assertEquals(expected, jedis.zrange(&quot;foo&quot;, 0, 100));
266      jedis.zadd(bfoo, 1d, ba);
267      jedis.zadd(bfoo, 2d, bb);
268      assertEquals(3d, jedis.zincrby(bfoo, 2d, ba), 0);
269      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
270      bexpected.add(bb);
271      bexpected.add(ba);
272      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
273    }
274    @Test
275    public void zincrbyWithParams() {
276      jedis.del(&quot;foo&quot;);
277      assertNull(jedis.zincrby(&quot;foo&quot;, 2d, &quot;a&quot;, ZIncrByParams.zIncrByParams().xx()));
278      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
279      assertNull(jedis.zincrby(&quot;foo&quot;, 1d, &quot;a&quot;, ZIncrByParams.zIncrByParams().nx()));
280      assertEquals(Double.valueOf(2d), jedis.zscore(&quot;foo&quot;, &quot;a&quot;));
281      jedis.del(bfoo);
282      assertNull(jedis.zincrby(bfoo, 2d, ba, ZIncrByParams.zIncrByParams().xx()));
283      jedis.zadd(bfoo, 2d, ba);
284      assertNull(jedis.zincrby(bfoo, 1d, ba, ZIncrByParams.zIncrByParams().nx()));
285      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, ba));
286    }
287    @Test
288    public void zrank() {
289      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
290      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
291      long rank = jedis.zrank(&quot;foo&quot;, &quot;a&quot;);
292      assertEquals(0, rank);
293      rank = jedis.zrank(&quot;foo&quot;, &quot;b&quot;);
<span onclick='openModal()' class='match'>294      assertEquals(1, rank);
295      assertNull(jedis.zrank(&quot;car&quot;, &quot;b&quot;));
296      jedis.zadd(bfoo, 1d, ba);
297      jedis.zadd(bfoo, 2d, bb);
298      long brank = jedis.zrank(bfoo, ba);
299      assertEquals(0, brank);
300      brank = jedis.zrank(bfoo, bb);
301      assertEquals(1, brank);
302      assertNull(jedis.zrank(bcar, bb));
303    }
304    @Test
305    public void zrankWithScore() {
306      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
307      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
308      KeyValue&lt;Long, Double&gt; keyValue = jedis.zrankWithScore(&quot;foo&quot;, &quot;a&quot;);
309      assertEquals(Long.valueOf(0), keyValue.getKey());
310      assertEquals(Double.valueOf(1d), keyValue.getValue());
311      keyValue = jedis.zrankWithScore(&quot;foo&quot;, &quot;b&quot;);
312      assertEquals(Long.valueOf(1), keyValue.getKey());
313      assertEquals(Double.valueOf(2d), keyValue.getValue());
314      assertNull(jedis.zrankWithScore(&quot;car&quot;, &quot;b&quot;));
315      jedis.zadd(bfoo, 1d, ba);
316      jedis.zadd(bfoo, 2d, bb);
317      keyValue = jedis.zrankWithScore(bfoo, ba);
318      assertEquals(Long.valueOf(0), keyValue.getKey());
319      assertEquals(Double.valueOf(1d), keyValue.getValue());
320      keyValue = jedis.zrankWithScore(bfoo, bb);
321      assertEquals(Long.valueOf(1), keyValue.getKey());
322      assertEquals(Double.valueOf(2d), keyValue.getValue());
323      assertNull(jedis.zrankWithScore(bcar, bb));
324    }
325    @Test
326    public void zrevrank() {
327      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
328      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
329      long rank = jedis.zrevrank(&quot;foo&quot;, &quot;a&quot;);
330      assertEquals(1, rank);
331      rank = jedis.zrevrank(&quot;foo&quot;, &quot;b&quot;);
332      assertEquals(0, rank);
333      jedis.zadd(bfoo, 1d, ba);
334      jedis.zadd(bfoo, 2d, bb);
335      long brank = jedis.zrevrank(bfoo, ba);
336      assertEquals(1, brank);
337      brank = jedis.zrevrank(bfoo, bb);
338      assertEquals(0, brank);
339    }
340    @Test
341    public void zrangeWithScores() {
342      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
343      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
344      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
345      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
346      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
347      expected.add(new Tuple(&quot;c&quot;, 0.1d));
348      expected.add(new Tuple(&quot;a&quot;, 2d));
349      List&lt;Tuple&gt; range = jedis.zrangeWithScores(&quot;foo&quot;, 0, 1);
350      assertEquals(expected, range);
351      expected.add(new Tuple(&quot;b&quot;, 10d));
352      range = jedis.zrangeWithScores(&quot;foo&quot;, 0, 100);
353      assertEquals(expected, range);
354      jedis.zadd(bfoo, 1d, ba);
355      jedis.zadd(bfoo, 10d, bb);
356      jedis.zadd(bfoo, 0.1d, bc);
357      jedis.zadd(bfoo, 2d, ba);
358      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
359      bexpected.add(new Tuple(bc, 0.1d));
360      bexpected.add(new Tuple(ba, 2d));
361      List&lt;Tuple&gt; brange = jedis.zrangeWithScores(bfoo, 0, 1);
362      assertEquals(bexpected, brange);
363      bexpected.add(new Tuple(bb, 10d));
364      brange = jedis.zrangeWithScores(bfoo, 0, 100);
365      assertEquals(bexpected, brange);
366    }
367    @Test
368    public void zrevrangeWithScores() {
369      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
370      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
371      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
372      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
373      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
374      expected.add(new Tuple(&quot;b&quot;, 10d));
375      expected.add(new Tuple(&quot;a&quot;, 2d));
376      List&lt;Tuple&gt; range = jedis.zrevrangeWithScores(&quot;foo&quot;, 0, 1);
377      assertEquals(expected, range);
378      expected.add(new Tuple(&quot;c&quot;, 0.1d));
379      range = jedis.zrevrangeWithScores(&quot;foo&quot;, 0, 100);
380      assertEquals(expected, range);
381      jedis.zadd(bfoo, 1d, ba);
382      jedis.zadd(bfoo, 10d, bb);
383      jedis.zadd(bfoo, 0.1d, bc);
384      jedis.zadd(bfoo, 2d, ba);
385      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
386      bexpected.add(new Tuple(bb, 10d));
387      bexpected.add(new Tuple(ba, 2d));
388      List&lt;Tuple&gt; brange = jedis.zrevrangeWithScores(bfoo, 0, 1);
389      assertEquals(bexpected, brange);
390      bexpected.add(new Tuple(bc, 0.1d));
391      brange = jedis.zrevrangeWithScores(bfoo, 0, 100);
392      assertEquals(bexpected, brange);
393    }
394    @Test
395    public void zcard() {
396      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
397      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
398      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
399      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
400      assertEquals(3, jedis.zcard(&quot;foo&quot;));
401      jedis.zadd(bfoo, 1d, ba);
402      jedis.zadd(bfoo, 10d, bb);
403      jedis.zadd(bfoo, 0.1d, bc);
404      jedis.zadd(bfoo, 2d, ba);
405      assertEquals(3, jedis.zcard(bfoo));
406    }
407    @Test
408    public void zscore() {
409      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
410      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
411      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
412      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
413      assertEquals((Double) 10d, jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
414      assertEquals((Double) 0.1d, jedis.zscore(&quot;foo&quot;, &quot;c&quot;));
415      assertNull(jedis.zscore(&quot;foo&quot;, &quot;s&quot;));
416      jedis.zadd(bfoo, 1d, ba);
417      jedis.zadd(bfoo, 10d, bb);
418      jedis.zadd(bfoo, 0.1d, bc);
419      jedis.zadd(bfoo, 2d, ba);
420      assertEquals((Double) 10d, jedis.zscore(bfoo, bb));
421      assertEquals((Double) 0.1d, jedis.zscore(bfoo, bc));
422      assertNull(jedis.zscore(bfoo, SafeEncoder.encode(&quot;s&quot;)));
423    }
424    @Test
425    public void zmscore() {
426      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
427      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
428      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
429      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
430      assertEquals(Arrays.asList(10d, 0.1d, null), jedis.zmscore(&quot;foo&quot;, &quot;b&quot;, &quot;c&quot;, &quot;s&quot;));
431      jedis.zadd(bfoo, 1d, ba);
432      jedis.zadd(bfoo, 10d, bb);
433      jedis.zadd(bfoo, 0.1d, bc);
434      jedis.zadd(bfoo, 2d, ba);
435      assertEquals(Arrays.asList(10d, 0.1d, null),
436        jedis.zmscore(bfoo, bb, bc, SafeEncoder.encode(&quot;s&quot;)));
437    }
438    @Test
439    public void zpopmax() {
440      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
441      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
442      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
443      jedis.zadd(&quot;foo&quot;, 2d, &quot;d&quot;);
444      Tuple actual = jedis.zpopmax(&quot;foo&quot;);
445      Tuple expected = new Tuple(&quot;b&quot;, 10d);
446      assertEquals(expected, actual);
447      actual = jedis.zpopmax(&quot;foo&quot;);
448      expected = new Tuple(&quot;d&quot;, 2d);
449      assertEquals(expected, actual);
450      actual = jedis.zpopmax(&quot;foo&quot;);
451      expected = new Tuple(&quot;a&quot;, 1d);
452      assertEquals(expected, actual);
453      actual = jedis.zpopmax(&quot;foo&quot;);
454      expected = new Tuple(&quot;c&quot;, 0.1d);
455      assertEquals(expected, actual);
456      actual = jedis.zpopmax(&quot;foo&quot;);
457      assertNull(actual);
458      jedis.zadd(bfoo, 1d, ba);
459      jedis.zadd(bfoo, 10d, bb);
460      jedis.zadd(bfoo, 0.1d, bc);
461      jedis.zadd(bfoo, 2d, ba);
462      actual = jedis.zpopmax(bfoo);
463      expected = new Tuple(bb, 10d);
464      assertEquals(expected, actual);
465      actual = jedis.zpopmax(bfoo);
466      expected = new Tuple(ba, 2d);
467      assertEquals(expected, actual);
468      actual = jedis.zpopmax(bfoo);
469      expected = new Tuple(bc, 0.1d);
470      assertEquals(expected, actual);
471      actual = jedis.zpopmax(bfoo);
472      assertNull(actual);
473    }
474    @Test
475    public void zpopmaxWithCount() {
476      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
477      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
478      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
479      jedis.zadd(&quot;foo&quot;, 2d, &quot;d&quot;);
480      jedis.zadd(&quot;foo&quot;, 0.03, &quot;e&quot;);
481      List&lt;Tuple&gt; actual = jedis.zpopmax(&quot;foo&quot;, 2);
482      assertEquals(2, actual.size());
483      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
484      expected.add(new Tuple(&quot;b&quot;, 10d));
485      expected.add(new Tuple(&quot;d&quot;, 2d));
486      assertEquals(expected, actual);
487      actual = jedis.zpopmax(&quot;foo&quot;, 3);
488      assertEquals(3, actual.size());
489      expected.clear();
490      expected.add(new Tuple(&quot;a&quot;, 1d));
491      expected.add(new Tuple(&quot;c&quot;, 0.1d));
492      expected.add(new Tuple(&quot;e&quot;, 0.03d));
493      assertEquals(expected, actual);
494      actual = jedis.zpopmax(&quot;foo&quot;, 1);
495      expected.clear();
496      assertEquals(expected, actual);
497      jedis.zadd(bfoo, 1d, ba);
498      jedis.zadd(bfoo, 10d, bb);
499      jedis.zadd(bfoo, 0.1d, bc);
500      jedis.zadd(bfoo, 2d, ba);
501      actual = jedis.zpopmax(bfoo, 1);
502      expected.clear();
503      expected.add(new Tuple(bb, 10d));
504      assertEquals(expected, actual);
505      actual = jedis.zpopmax(bfoo, 1);
506      expected.clear();
507      expected.add(new Tuple(ba, 2d));
508      assertEquals(expected, actual);
509      actual = jedis.zpopmax(bfoo, 1);
510      expected.clear();
511      expected.add(new Tuple(bc, 0.1d));
512      assertEquals(expected, actual);
513      actual = jedis.zpopmax(bfoo, 1);
514      expected.clear();
515      assertEquals(expected, actual);
516    }
517    @Test
518    public void zpopmin() {
519      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
520      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
521      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
522      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx());
523      List&lt;Tuple&gt; range = jedis.zpopmin(&quot;foo&quot;, 2);
524      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
525      expected.add(new Tuple(&quot;c&quot;, 0.1d));
526      expected.add(new Tuple(&quot;a&quot;, 1d));
527      assertEquals(expected, range);
528      assertEquals(new Tuple(&quot;b&quot;, 10d), jedis.zpopmin(&quot;foo&quot;));
529      jedis.zadd(bfoo, 1d, ba);
530      jedis.zadd(bfoo, 10d, bb);
531      jedis.zadd(bfoo, 0.1d, bc);
532      jedis.zadd(bfoo, 2d, ba);
533      List&lt;Tuple&gt; brange = jedis.zpopmin(bfoo, 2);
534      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
535      bexpected.add(new Tuple(bc, 0.1d));
536      bexpected.add(new Tuple(ba, 2d));
537      assertEquals(bexpected, brange);
538      assertEquals(new Tuple(bb, 10d), jedis.zpopmin(bfoo));
539    }
540    @Test
541    public void zcount() {
542      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
543      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
544      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
545      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
546      assertEquals(2, jedis.zcount(&quot;foo&quot;, 0.01d, 2.1d));
547      assertEquals(3, jedis.zcount(&quot;foo&quot;, &quot;(0.01&quot;, &quot;+inf&quot;));
548      jedis.zadd(bfoo, 1d, ba);
549      jedis.zadd(bfoo, 10d, bb);
550      jedis.zadd(bfoo, 0.1d, bc);
551      jedis.zadd(bfoo, 2d, ba);
552      assertEquals(2, jedis.zcount(bfoo, 0.01d, 2.1d));
553      assertEquals(3, jedis.zcount(bfoo, SafeEncoder.encode(&quot;(0.01&quot;), SafeEncoder.encode(&quot;+inf&quot;)));
554    }
555    @Test
556    public void zlexcount() {
557      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
558      jedis.zadd(&quot;foo&quot;, 1, &quot;b&quot;);
559      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
560      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
561      assertEquals(2, jedis.zlexcount(&quot;foo&quot;, &quot;[aa&quot;, &quot;(c&quot;));
562      assertEquals(4, jedis.zlexcount(&quot;foo&quot;, &quot;-&quot;, &quot;+&quot;));
563      assertEquals(3, jedis.zlexcount(&quot;foo&quot;, &quot;-&quot;, &quot;(c&quot;));
564      assertEquals(3, jedis.zlexcount(&quot;foo&quot;, &quot;[aa&quot;, &quot;+&quot;));
565    }
566    @Test
567    public void zlexcountBinary() {
568      jedis.zadd(bfoo, 1, ba);
569      jedis.zadd(bfoo, 1, bc);
570      jedis.zadd(bfoo, 1, bb);
571      assertEquals(1, jedis.zlexcount(bfoo, bInclusiveB, bExclusiveC));
572      assertEquals(3, jedis.zlexcount(bfoo, bLexMinusInf, bLexPlusInf));
573    }
574    @Test
575    public void zrangebyscore() {
576      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
577      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
578      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
579      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
580      List&lt;String&gt; range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d);
581      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
582      expected.add(&quot;c&quot;);
583      expected.add(&quot;a&quot;);
584      assertEquals(expected, range);
585      range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d, 0, 1);
586      expected = new ArrayList&lt;String&gt;();
587      expected.add(&quot;c&quot;);
588      assertEquals(expected, range);
589      range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d, 1, 1);
590      List&lt;String&gt; range2 = jedis.zrangeByScore(&quot;foo&quot;, &quot;-inf&quot;, &quot;(2&quot;);
591      assertEquals(expected, range2);
592      expected = new ArrayList&lt;String&gt;();
593      expected.add(&quot;a&quot;);
594      assertEquals(expected, range);
595      jedis.zadd(bfoo, 1d, ba);
596      jedis.zadd(bfoo, 10d, bb);
597      jedis.zadd(bfoo, 0.1d, bc);
598      jedis.zadd(bfoo, 2d, ba);
599      List&lt;byte[]&gt; brange = jedis.zrangeByScore(bfoo, 0d, 2d);
600      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
601      bexpected.add(bc);
602      bexpected.add(ba);
603      assertByteArrayListEquals(bexpected, brange);
604      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 0, 1);
605      bexpected = new ArrayList&lt;byte[]&gt;();
606      bexpected.add(bc);
607      assertByteArrayListEquals(bexpected, brange);
608      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 1, 1);
609      List&lt;byte[]&gt; brange2 = jedis.zrangeByScore(bfoo, SafeEncoder.encode(&quot;-inf&quot;),
610        SafeEncoder.encode(&quot;(2&quot;));
611      assertByteArrayListEquals(bexpected, brange2);
612      bexpected = new ArrayList&lt;byte[]&gt;();
613      bexpected.add(ba);
614      assertByteArrayListEquals(bexpected, brange);
615    }
616    @Test
617    public void zrevrangebyscore() {
618      jedis.zadd(&quot;foo&quot;, 1.0d, &quot;a&quot;);
619      jedis.zadd(&quot;foo&quot;, 2.0d, &quot;b&quot;);
620      jedis.zadd(&quot;foo&quot;, 3.0d, &quot;c&quot;);
621      jedis.zadd(&quot;foo&quot;, 4.0d, &quot;d&quot;);
622      jedis.zadd(&quot;foo&quot;, 5.0d, &quot;e&quot;);
623      List&lt;String&gt; range = jedis.zrevrangeByScore(&quot;foo&quot;, 3d, Double.NEGATIVE_INFINITY, 0, 1);
624      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
625      expected.add(&quot;c&quot;);
626      assertEquals(expected, range);
627      range = jedis.zrevrangeByScore(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
628      expected = new ArrayList&lt;String&gt;();
629      expected.add(&quot;c&quot;);
630      expected.add(&quot;b&quot;);
631      assertEquals(expected, range);
632      range = jedis.zrevrangeByScore(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
633      expected = new ArrayList&lt;String&gt;();
634      expected.add(&quot;b&quot;);
635      assertEquals(expected, range);
636      range = jedis.zrevrangeByScore(&quot;foo&quot;, 4d, 2d);
637      expected = new ArrayList&lt;String&gt;();
638      expected.add(&quot;d&quot;);
639      expected.add(&quot;c&quot;);
640      expected.add(&quot;b&quot;);
641      assertEquals(expected, range);
642      range = jedis.zrevrangeByScore(&quot;foo&quot;, &quot;4&quot;, &quot;2&quot;, 0, 2);
643      expected = new ArrayList&lt;String&gt;();
644      expected.add(&quot;d&quot;);
645      expected.add(&quot;c&quot;);
646      assertEquals(expected, range);
647      range = jedis.zrevrangeByScore(&quot;foo&quot;, &quot;+inf&quot;, &quot;(4&quot;);
648      expected = new ArrayList&lt;String&gt;();
649      expected.add(&quot;e&quot;);
650      assertEquals(expected, range);
651      jedis.zadd(bfoo, 1d, ba);
652      jedis.zadd(bfoo, 10d, bb);
653      jedis.zadd(bfoo, 0.1d, bc);
654      jedis.zadd(bfoo, 2d, ba);
655      List&lt;byte[]&gt; brange = jedis.zrevrangeByScore(bfoo, 2d, 0d);
656      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
657      bexpected.add(ba);
658      bexpected.add(bc);
659      assertByteArrayListEquals(bexpected, brange);
660      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 0, 1);
661      bexpected = new ArrayList&lt;byte[]&gt;();
662      bexpected.add(ba);
663      assertByteArrayListEquals(bexpected, brange);
664      List&lt;byte[]&gt; brange2 = jedis.zrevrangeByScore(bfoo, SafeEncoder.encode(&quot;+inf&quot;),
665        SafeEncoder.encode(&quot;(2&quot;));
666      bexpected = new ArrayList&lt;byte[]&gt;();
667      bexpected.add(bb);
668      assertByteArrayListEquals(bexpected, brange2);
669      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 1, 1);
670      bexpected = new ArrayList&lt;byte[]&gt;();
671      bexpected.add(bc);
672      assertByteArrayListEquals(bexpected, brange);
673    }
674    @Test
675    public void zrangebyscoreWithScores() {
676      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
677      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
678      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
679      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
680      List&lt;Tuple&gt; range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d);
681      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
682      expected.add(new Tuple(&quot;c&quot;, 0.1d));
683      expected.add(new Tuple(&quot;a&quot;, 2d));
684      assertEquals(expected, range);
685      range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d, 0, 1);
686      expected = new ArrayList&lt;Tuple&gt;();
687      expected.add(new Tuple(&quot;c&quot;, 0.1d));
688      assertEquals(expected, range);
689      range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d, 1, 1);
690      expected = new ArrayList&lt;Tuple&gt;();
691      expected.add(new Tuple(&quot;a&quot;, 2d));
692      assertEquals(expected, range);
693      jedis.zadd(bfoo, 1d, ba);
694      jedis.zadd(bfoo, 10d, bb);
695      jedis.zadd(bfoo, 0.1d, bc);
696      jedis.zadd(bfoo, 2d, ba);
697      List&lt;Tuple&gt; brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d);
698      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
699      bexpected.add(new Tuple(bc, 0.1d));
700      bexpected.add(new Tuple(ba, 2d));
701      assertEquals(bexpected, brange);
702      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 0, 1);
703      bexpected = new ArrayList&lt;Tuple&gt;();
704      bexpected.add(new Tuple(bc, 0.1d));
705      assertEquals(bexpected, brange);
706      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 1, 1);
707      bexpected = new ArrayList&lt;Tuple&gt;();
708      bexpected.add(new Tuple(ba, 2d));
709      assertEquals(bexpected, brange);
710    }
711    @Test
712    public void zrevrangebyscoreWithScores() {
713      jedis.zadd(&quot;foo&quot;, 1.0d, &quot;a&quot;);
714      jedis.zadd(&quot;foo&quot;, 2.0d, &quot;b&quot;);
715      jedis.zadd(&quot;foo&quot;, 3.0d, &quot;c&quot;);
716      jedis.zadd(&quot;foo&quot;, 4.0d, &quot;d&quot;);
717      jedis.zadd(&quot;foo&quot;, 5.0d, &quot;e&quot;);
</span>718      List&lt;Tuple&gt; range = jedis.zrevrangeByScoreWithScores(&quot;foo&quot;, 3d, Double.NEGATIVE_INFINITY, 0, 1);
719      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
720      expected.add(new Tuple(&quot;c&quot;, 3.0d));
721      assertEquals(expected, range);
722      range = jedis.zrevrangeByScoreWithScores(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
723      expected = new ArrayList&lt;Tuple&gt;();
724      expected.add(new Tuple(&quot;c&quot;, 3.0d));
725      expected.add(new Tuple(&quot;b&quot;, 2.0d));
726      assertEquals(expected, range);
727      range = jedis.zrevrangeByScoreWithScores(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
728      expected = new ArrayList&lt;Tuple&gt;();
729      expected.add(new Tuple(&quot;b&quot;, 2.0d));
730      assertEquals(expected, range);
731      range = jedis.zrevrangeByScoreWithScores(&quot;foo&quot;, 4d, 2d);
732      expected = new ArrayList&lt;Tuple&gt;();
733      expected.add(new Tuple(&quot;d&quot;, 4.0d));
734      expected.add(new Tuple(&quot;c&quot;, 3.0d));
735      expected.add(new Tuple(&quot;b&quot;, 2.0d));
736      assertEquals(expected, range);
737      jedis.zadd(bfoo, 1d, ba);
738      jedis.zadd(bfoo, 10d, bb);
739      jedis.zadd(bfoo, 0.1d, bc);
740      jedis.zadd(bfoo, 2d, ba);
741      List&lt;Tuple&gt; brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d);
742      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
743      bexpected.add(new Tuple(ba, 2d));
744      bexpected.add(new Tuple(bc, 0.1d));
745      assertEquals(bexpected, brange);
746      brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d, 0, 1);
747      bexpected = new ArrayList&lt;Tuple&gt;();
748      bexpected.add(new Tuple(ba, 2d));
749      assertEquals(bexpected, brange);
750      brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d, 1, 1);
751      bexpected = new ArrayList&lt;Tuple&gt;();
752      bexpected.add(new Tuple(bc, 0.1d));
753      assertEquals(bexpected, brange);
754    }
755    @Test
756    public void zremrangeByRank() {
757      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
758      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
759      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
760      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
761      assertEquals(1, jedis.zremrangeByRank(&quot;foo&quot;, 0, 0));
762      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
763      expected.add(&quot;a&quot;);
764      expected.add(&quot;b&quot;);
765      assertEquals(expected, jedis.zrange(&quot;foo&quot;, 0, 100));
766      jedis.zadd(bfoo, 1d, ba);
767      jedis.zadd(bfoo, 10d, bb);
768      jedis.zadd(bfoo, 0.1d, bc);
769      jedis.zadd(bfoo, 2d, ba);
770      assertEquals(1, jedis.zremrangeByRank(bfoo, 0, 0));
771      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
772      bexpected.add(ba);
773      bexpected.add(bb);
774      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
775    }
776    @Test
777    public void zremrangeByScore() {
778      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
779      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
780      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
781      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
782      assertEquals(2, jedis.zremrangeByScore(&quot;foo&quot;, 0, 2));
783      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
784      expected.add(&quot;b&quot;);
785      assertEquals(expected, jedis.zrange(&quot;foo&quot;, 0, 100));
786      jedis.zadd(bfoo, 1d, ba);
787      jedis.zadd(bfoo, 10d, bb);
788      jedis.zadd(bfoo, 0.1d, bc);
789      jedis.zadd(bfoo, 2d, ba);
790      assertEquals(2, jedis.zremrangeByScore(bfoo, 0, 2));
791      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
792      bexpected.add(bb);
793      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
794    }
795    @Test
796    public void zremrangeByScoreExclusive() {
797      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
798      jedis.zadd(&quot;foo&quot;, 0d, &quot;c&quot;);
799      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
800      assertEquals(1, jedis.zremrangeByScore(&quot;foo&quot;, &quot;(0&quot;, &quot;(2&quot;));
801      jedis.zadd(bfoo, 1d, ba);
802      jedis.zadd(bfoo, 0d, bc);
803      jedis.zadd(bfoo, 2d, bb);
804      assertEquals(1, jedis.zremrangeByScore(bfoo, &quot;(0&quot;.getBytes(), &quot;(2&quot;.getBytes()));
805    }
806    @Test
807    public void zremrangeByLex() {
808      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
809      jedis.zadd(&quot;foo&quot;, 1, &quot;b&quot;);
810      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
811      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
812      assertEquals(2, jedis.zremrangeByLex(&quot;foo&quot;, &quot;[aa&quot;, &quot;(c&quot;));
813      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
814      expected.add(&quot;a&quot;);
815      expected.add(&quot;c&quot;);
816      assertEquals(expected, jedis.zrangeByLex(&quot;foo&quot;, &quot;-&quot;, &quot;+&quot;));
817    }
818    @Test
819    public void zremrangeByLexBinary() {
820      jedis.zadd(bfoo, 1, ba);
821      jedis.zadd(bfoo, 1, bc);
822      jedis.zadd(bfoo, 1, bb);
823      assertEquals(1, jedis.zremrangeByLex(bfoo, bInclusiveB, bExclusiveC));
824      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
825      bexpected.add(ba);
826      bexpected.add(bc);
827      assertByteArrayListEquals(bexpected, jedis.zrangeByLex(bfoo, bLexMinusInf, bLexPlusInf));
828    }
829    @Test
830    public void zunion() {
831      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
832      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
833      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
834      jedis.zadd(&quot;bar&quot;, 2, &quot;b&quot;);
835      ZParams params = new ZParams();
836      params.weights(2, 2.5);
837      params.aggregate(ZParams.Aggregate.SUM);
838      List&lt;String&gt; expected = new ArrayList&lt;&gt;();
839      expected.add(&quot;a&quot;);
840      expected.add(&quot;b&quot;);
841      assertEquals(expected, jedis.zunion(params, &quot;foo&quot;, &quot;bar&quot;));
842      List&lt;Tuple&gt; expectedTuple = new ArrayList&lt;&gt;();
843      expectedTuple.add(new Tuple(&quot;a&quot;, new Double(7)));
844      expectedTuple.add(new Tuple(&quot;b&quot;, new Double(9)));
845      assertEquals(expectedTuple, jedis.zunionWithScores(params, &quot;foo&quot;, &quot;bar&quot;));
846      jedis.zadd(bfoo, 1, ba);
847      jedis.zadd(bfoo, 2, bb);
848      jedis.zadd(bbar, 2, ba);
849      jedis.zadd(bbar, 2, bb);
850      List&lt;byte[]&gt; bexpected = new ArrayList&lt;&gt;();
851      bexpected.add(ba);
852      bexpected.add(bb);
853      AssertUtil.assertByteArrayListEquals(bexpected, jedis.zunion(params, bfoo, bbar));
854      List&lt;Tuple&gt; bexpectedTuple = new ArrayList&lt;&gt;();
855      bexpectedTuple.add(new Tuple(ba, new Double(7)));
856      bexpectedTuple.add(new Tuple(bb, new Double(9)));
857      assertEquals(bexpectedTuple, jedis.zunionWithScores(params, bfoo, bbar));
858    }
859    @Test
860    public void zunionstore() {
861      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
862      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
863      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
864      jedis.zadd(&quot;bar&quot;, 2, &quot;b&quot;);
865      assertEquals(2, jedis.zunionstore(&quot;dst&quot;, &quot;foo&quot;, &quot;bar&quot;));
866      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
867      expected.add(new Tuple(&quot;a&quot;, new Double(3)));
868      expected.add(new Tuple(&quot;b&quot;, new Double(4)));
869      assertEquals(expected, jedis.zrangeWithScores(&quot;dst&quot;, 0, 100));
870      jedis.zadd(bfoo, 1, ba);
871      jedis.zadd(bfoo, 2, bb);
872      jedis.zadd(bbar, 2, ba);
873      jedis.zadd(bbar, 2, bb);
874      assertEquals(2, jedis.zunionstore(SafeEncoder.encode(&quot;dst&quot;), bfoo, bbar));
875      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
876      bexpected.add(new Tuple(ba, new Double(3)));
877      bexpected.add(new Tuple(bb, new Double(4)));
878      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode(&quot;dst&quot;), 0, 100));
879    }
880    @Test
881    public void zunionstoreParams() {
882      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
883      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
884      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
885      jedis.zadd(&quot;bar&quot;, 2, &quot;b&quot;);
886      ZParams params = new ZParams();
887      params.weights(2, 2.5);
888      params.aggregate(ZParams.Aggregate.SUM);
889      assertEquals(2, jedis.zunionstore(&quot;dst&quot;, params, &quot;foo&quot;, &quot;bar&quot;));
890      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
891      expected.add(new Tuple(&quot;a&quot;, new Double(7)));
892      expected.add(new Tuple(&quot;b&quot;, new Double(9)));
893      assertEquals(expected, jedis.zrangeWithScores(&quot;dst&quot;, 0, 100));
894      jedis.zadd(bfoo, 1, ba);
895      jedis.zadd(bfoo, 2, bb);
896      jedis.zadd(bbar, 2, ba);
897      jedis.zadd(bbar, 2, bb);
898      ZParams bparams = new ZParams();
899      bparams.weights(2, 2.5);
900      bparams.aggregate(ZParams.Aggregate.SUM);
901      assertEquals(2, jedis.zunionstore(SafeEncoder.encode(&quot;dst&quot;), bparams, bfoo, bbar));
902      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
903      bexpected.add(new Tuple(ba, new Double(7)));
904      bexpected.add(new Tuple(bb, new Double(9)));
905      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode(&quot;dst&quot;), 0, 100));
906    }
907    @Test
908    public void zinter() {
909      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
910      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
911      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
912      ZParams params = new ZParams();
913      params.weights(2, 2.5);
914      params.aggregate(ZParams.Aggregate.SUM);
915      assertEquals(singletonList(&quot;a&quot;), jedis.zinter(params, &quot;foo&quot;, &quot;bar&quot;));
916      assertEquals(singletonList(new Tuple(&quot;a&quot;, new Double(7))),
917        jedis.zinterWithScores(params, &quot;foo&quot;, &quot;bar&quot;));
918      jedis.zadd(bfoo, 1, ba);
919      jedis.zadd(bfoo, 2, bb);
920      jedis.zadd(bbar, 2, ba);
921      ZParams bparams = new ZParams();
922      bparams.weights(2, 2.5);
923      bparams.aggregate(ZParams.Aggregate.SUM);
924      AssertUtil.assertByteArrayListEquals(singletonList(ba), jedis.zinter(params, bfoo, bbar));
925      assertEquals(singletonList(new Tuple(ba, new Double(7))),
926        jedis.zinterWithScores(bparams, bfoo, bbar));
927    }
928    @Test
929    public void zinterstore() {
930      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
931      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
932      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
933      assertEquals(1, jedis.zinterstore(&quot;dst&quot;, &quot;foo&quot;, &quot;bar&quot;));
934      assertEquals(singletonList(new Tuple(&quot;a&quot;, new Double(3))),
935          jedis.zrangeWithScores(&quot;dst&quot;, 0, 100));
936      jedis.zadd(bfoo, 1, ba);
937      jedis.zadd(bfoo, 2, bb);
938      jedis.zadd(bbar, 2, ba);
939      assertEquals(1, jedis.zinterstore(SafeEncoder.encode(&quot;dst&quot;), bfoo, bbar));
940      assertEquals(singletonList(new Tuple(ba, new Double(3))),
941          jedis.zrangeWithScores(SafeEncoder.encode(&quot;dst&quot;), 0, 100));
942    }
943    @Test
944    public void zintertoreParams() {
945      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
946      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
947      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
948      ZParams params = new ZParams();
949      params.weights(2, 2.5);
950      params.aggregate(ZParams.Aggregate.SUM);
951      assertEquals(1, jedis.zinterstore(&quot;dst&quot;, params, &quot;foo&quot;, &quot;bar&quot;));
952      assertEquals(singletonList(new Tuple(&quot;a&quot;, new Double(7))),
953          jedis.zrangeWithScores(&quot;dst&quot;, 0, 100));
954      jedis.zadd(bfoo, 1, ba);
955      jedis.zadd(bfoo, 2, bb);
956      jedis.zadd(bbar, 2, ba);
957      ZParams bparams = new ZParams();
958      bparams.weights(2, 2.5);
959      bparams.aggregate(ZParams.Aggregate.SUM);
960      assertEquals(1, jedis.zinterstore(SafeEncoder.encode(&quot;dst&quot;), bparams, bfoo, bbar));
961      assertEquals(singletonList(new Tuple(ba, new Double(7))),
962          jedis.zrangeWithScores(SafeEncoder.encode(&quot;dst&quot;), 0, 100));
963    }
964    @Test
965    public void zintercard() {
966      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
967      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
968      jedis.zadd(&quot;bar&quot;, 2, &quot;a&quot;);
969      jedis.zadd(&quot;bar&quot;, 1, &quot;b&quot;);
970      assertEquals(2, jedis.zintercard(&quot;foo&quot;, &quot;bar&quot;));
971      assertEquals(1, jedis.zintercard(1, &quot;foo&quot;, &quot;bar&quot;));
972      jedis.zadd(bfoo, 1, ba);
973      jedis.zadd(bfoo, 2, bb);
974      jedis.zadd(bbar, 2, ba);
975      jedis.zadd(bbar, 2, bb);
976      assertEquals(2, jedis.zintercard(bfoo, bbar));
977      assertEquals(1, jedis.zintercard(1, bfoo, bbar));
978    }
979    @Test
980    public void zscan() {
981      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
982      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
983      ScanResult&lt;Tuple&gt; result = jedis.zscan(&quot;foo&quot;, SCAN_POINTER_START);
984      assertEquals(SCAN_POINTER_START, result.getCursor());
985      assertFalse(result.getResult().isEmpty());
986      jedis.zadd(bfoo, 1, ba);
987      jedis.zadd(bfoo, 1, bb);
988      ScanResult&lt;Tuple&gt; bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY);
989      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
990      assertFalse(bResult.getResult().isEmpty());
991    }
992    @Test
993    public void zscanMatch() {
994      ScanParams params = new ScanParams();
995      params.match(&quot;a*&quot;);
996      jedis.zadd(&quot;foo&quot;, 2, &quot;b&quot;);
997      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
998      jedis.zadd(&quot;foo&quot;, 11, &quot;aa&quot;);
999      ScanResult&lt;Tuple&gt; result = jedis.zscan(&quot;foo&quot;, SCAN_POINTER_START, params);
1000      assertEquals(SCAN_POINTER_START, result.getCursor());
1001      assertFalse(result.getResult().isEmpty());
1002      params = new ScanParams();
1003      params.match(bbarstar);
1004      jedis.zadd(bfoo, 2, bbar1);
1005      jedis.zadd(bfoo, 1, bbar2);
1006      jedis.zadd(bfoo, 11, bbar3);
1007      ScanResult&lt;Tuple&gt; bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY, params);
1008      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
1009      assertFalse(bResult.getResult().isEmpty());
1010    }
1011    @Test
1012    public void zscanCount() {
1013      ScanParams params = new ScanParams();
1014      params.count(2);
1015      jedis.zadd(&quot;foo&quot;, 1, &quot;a1&quot;);
1016      jedis.zadd(&quot;foo&quot;, 2, &quot;a2&quot;);
1017      jedis.zadd(&quot;foo&quot;, 3, &quot;a3&quot;);
1018      jedis.zadd(&quot;foo&quot;, 4, &quot;a4&quot;);
1019      jedis.zadd(&quot;foo&quot;, 5, &quot;a5&quot;);
1020      ScanResult&lt;Tuple&gt; result = jedis.zscan(&quot;foo&quot;, SCAN_POINTER_START, params);
1021      assertFalse(result.getResult().isEmpty());
1022      params = new ScanParams();
1023      params.count(2);
1024      jedis.zadd(bfoo, 2, bbar1);
1025      jedis.zadd(bfoo, 1, bbar2);
1026      jedis.zadd(bfoo, 11, bbar3);
1027      ScanResult&lt;Tuple&gt; bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY, params);
1028      assertFalse(bResult.getResult().isEmpty());
1029    }
1030    @Test
1031    public void infinity() {
1032      jedis.zadd(&quot;key&quot;, Double.POSITIVE_INFINITY, &quot;pos&quot;);
1033      assertEquals(Double.POSITIVE_INFINITY, jedis.zscore(&quot;key&quot;, &quot;pos&quot;), 0d);
1034      jedis.zadd(&quot;key&quot;, Double.NEGATIVE_INFINITY, &quot;neg&quot;);
1035      assertEquals(Double.NEGATIVE_INFINITY, jedis.zscore(&quot;key&quot;, &quot;neg&quot;), 0d);
1036      jedis.zadd(&quot;key&quot;, 0d, &quot;zero&quot;);
1037      List&lt;Tuple&gt; set = jedis.zrangeWithScores(&quot;key&quot;, 0, -1);
1038      Iterator&lt;Tuple&gt; itr = set.iterator();
1039      assertEquals(Double.NEGATIVE_INFINITY, itr.next().getScore(), 0d);
1040      assertEquals(0d, itr.next().getScore(), 0d);
1041      assertEquals(Double.POSITIVE_INFINITY, itr.next().getScore(), 0d);
1042    }
1043    @Test
1044    public void bzpopmax() {
1045      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1046      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
1047      jedis.zadd(&quot;bar&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
1048      assertEquals(new KeyValue&lt;&gt;(&quot;foo&quot;, new Tuple(&quot;b&quot;, 10d)), jedis.bzpopmax(0, &quot;foo&quot;, &quot;bar&quot;));
1049      jedis.zadd(bfoo, 1d, ba);
1050      jedis.zadd(bfoo, 10d, bb);
1051      jedis.zadd(bbar, 0.1d, bc);
1052      KeyValue&lt;byte[], Tuple&gt; actual = jedis.bzpopmax(0, bfoo, bbar);
1053      assertArrayEquals(bfoo, actual.getKey());
1054      assertEquals(new Tuple(bb, 10d), actual.getValue());
1055    }
1056    @Test
1057    public void bzpopmin() {
1058      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1059      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
1060      jedis.zadd(&quot;bar&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
1061      assertEquals(new KeyValue&lt;&gt;(&quot;bar&quot;, new Tuple(&quot;c&quot;, 0.1)), jedis.bzpopmin(0, &quot;bar&quot;, &quot;foo&quot;));
1062      jedis.zadd(bfoo, 1d, ba);
1063      jedis.zadd(bfoo, 10d, bb);
1064      jedis.zadd(bbar, 0.1d, bc);
1065      KeyValue&lt;byte[], Tuple&gt; actual = jedis.bzpopmin(0, bbar, bfoo);
1066      assertArrayEquals(bbar, (byte[]) actual.getKey());
1067      assertEquals(new Tuple(bc, 0.1), actual.getValue());
1068    }
1069    @Test
1070    public void zdiff() {
1071      jedis.zadd(&quot;foo&quot;, 1.0, &quot;a&quot;);
1072      jedis.zadd(&quot;foo&quot;, 2.0, &quot;b&quot;);
1073      jedis.zadd(&quot;bar&quot;, 1.0, &quot;a&quot;);
1074      assertEquals(0, jedis.zdiff(&quot;bar1&quot;, &quot;bar2&quot;).size());
1075      assertEquals(singletonList(&quot;b&quot;), jedis.zdiff(&quot;foo&quot;, &quot;bar&quot;));
1076      assertEquals(singletonList(new Tuple(&quot;b&quot;, 2.0d)), jedis.zdiffWithScores(&quot;foo&quot;, &quot;bar&quot;));
1077      jedis.zadd(bfoo, 1.0, ba);
1078      jedis.zadd(bfoo, 2.0, bb);
1079      jedis.zadd(bbar, 1.0, ba);
1080      assertEquals(0, jedis.zdiff(bbar1, bbar2).size());
1081      List&lt;byte[]&gt; bactual = jedis.zdiff(bfoo, bbar);
1082      assertEquals(1, bactual.size());
1083      assertArrayEquals(bb, bactual.iterator().next());
1084      assertEquals(singletonList(new Tuple(bb, 2.0d)), jedis.zdiffWithScores(bfoo, bbar));
1085    }
1086    @Test
1087    public void zdiffstore() {
1088      jedis.zadd(&quot;foo&quot;, 1.0, &quot;a&quot;);
1089      jedis.zadd(&quot;foo&quot;, 2.0, &quot;b&quot;);
1090      jedis.zadd(&quot;bar&quot;, 1.0, &quot;a&quot;);
1091      assertEquals(0, jedis.zdiffstore(&quot;bar3&quot;, &quot;bar1&quot;, &quot;bar2&quot;));
1092      assertEquals(1, jedis.zdiffstore(&quot;bar3&quot;, &quot;foo&quot;, &quot;bar&quot;));
1093      assertEquals(singletonList(&quot;b&quot;), jedis.zrange(&quot;bar3&quot;, 0, -1));
1094      jedis.zadd(bfoo, 1.0, ba);
1095      jedis.zadd(bfoo, 2.0, bb);
1096      jedis.zadd(bbar, 1.0, ba);
1097      assertEquals(0, jedis.zdiffstore(bbar3, bbar1, bbar2));
1098      assertEquals(1, jedis.zdiffstore(bbar3, bfoo, bbar));
1099      List&lt;byte[]&gt; bactual = jedis.zrange(bbar3, 0, -1);
1100      assertArrayEquals(bb, bactual.iterator().next());
1101    }
1102    @Test
1103    public void zrandmember() {
1104      assertNull(jedis.zrandmember(&quot;foo&quot;));
1105      assertEquals(Collections.emptyList(), jedis.zrandmember(&quot;foo&quot;, 1));
1106      assertEquals(Collections.emptyList(), jedis.zrandmemberWithScores(&quot;foo&quot;, 1));
1107      Map&lt;String, Double&gt; hash = new HashMap&lt;&gt;();
1108      hash.put(&quot;bar1&quot;, 1d);
1109      hash.put(&quot;bar2&quot;, 10d);
1110      hash.put(&quot;bar3&quot;, 0.1d);
1111      jedis.zadd(&quot;foo&quot;, hash);
1112      AssertUtil.assertCollectionContains(hash.keySet(), jedis.zrandmember(&quot;foo&quot;));
1113      assertEquals(2, jedis.zrandmember(&quot;foo&quot;, 2).size());
1114      List&lt;Tuple&gt; actual = jedis.zrandmemberWithScores(&quot;foo&quot;, 2);
1115      assertEquals(2, actual.size());
1116      actual.forEach(t -&gt; assertEquals(hash.get(t.getElement()), t.getScore(), 0d));
1117      assertNull(jedis.zrandmember(bfoo));
1118      assertEquals(Collections.emptyList(), jedis.zrandmember(bfoo, 1));
1119      assertEquals(Collections.emptyList(), jedis.zrandmemberWithScores(bfoo, 1));
1120      Map&lt;byte[], Double&gt; bhash = new HashMap&lt;&gt;();
1121      bhash.put(bbar1, 1d);
1122      bhash.put(bbar2, 10d);
1123      bhash.put(bbar3, 0.1d);
1124      jedis.zadd(bfoo, bhash);
1125      AssertUtil.assertByteArrayCollectionContains(bhash.keySet(), jedis.zrandmember(bfoo));
1126      assertEquals(2, jedis.zrandmember(bfoo, 2).size());
1127      List&lt;Tuple&gt; bactual = jedis.zrandmemberWithScores(bfoo, 2);
1128      assertEquals(2, bactual.size());
1129      bactual.forEach(t -&gt; assertEquals(getScoreFromByteMap(bhash, t.getBinaryElement()), t.getScore(), 0d));
1130    }
1131    private Double getScoreFromByteMap(Map&lt;byte[], Double&gt; bhash, byte[] key) {
1132      for (Map.Entry&lt;byte[], Double&gt; en : bhash.entrySet()) {
1133        if (Arrays.equals(en.getKey(), key)) {
1134          return en.getValue();
1135        }
1136      }
1137      return null;
1138    }
1139    @Test
1140    public void zmpop() {
1141      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1142      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
1143      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
1144      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1145      KeyValue&lt;String, List&lt;Tuple&gt;&gt; single = jedis.zmpop(SortedSetOption.MAX, &quot;foo&quot;);
1146      KeyValue&lt;String, List&lt;Tuple&gt;&gt; range = jedis.zmpop(SortedSetOption.MIN, 2, &quot;foo&quot;);
1147      assertEquals(new Tuple(&quot;b&quot;, 10d), single.getValue().get(0));
1148      assertEquals(2, range.getValue().size());
1149      assertNull(jedis.zmpop(SortedSetOption.MAX, &quot;foo&quot;));
1150    }
1151    @Test
1152    public void bzmpopSimple() {
1153      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1154      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
1155      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
1156      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx());
1157      KeyValue&lt;String, List&lt;Tuple&gt;&gt; single = jedis.bzmpop(1L, SortedSetOption.MAX, &quot;foo&quot;);
1158      KeyValue&lt;String, List&lt;Tuple&gt;&gt; range = jedis.bzmpop(1L, SortedSetOption.MIN, 2, &quot;foo&quot;);
1159      assertEquals(new Tuple(&quot;b&quot;, 10d), single.getValue().get(0));
1160      assertEquals(2, range.getValue().size());
1161      assertNull(jedis.bzmpop(1L, SortedSetOption.MAX, &quot;foo&quot;));
1162    }
1163  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SortedSetCommandsTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SortedSetCommandsTestBase.java</div>
                </div>
                <div class="column column_space"><pre><code>251      assertEquals(1, rank);
252      assertNull(jedis.zrank(&quot;car&quot;, &quot;b&quot;));
253      jedis.zadd(bfoo, 1d, ba);
254      jedis.zadd(bfoo, 2d, bb);
255      long brank = jedis.zrank(bfoo, ba);
256      assertEquals(0, brank);
257      brank = jedis.zrank(bfoo, bb);
258      assertEquals(1, brank);
259      assertNull(jedis.zrank(bcar, bb));
260    }
261    @Test
262    public void zrankWithScore() {
263      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
264      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
265      KeyValue&lt;Long, Double&gt; keyValue = jedis.zrankWithScore(&quot;foo&quot;, &quot;a&quot;);
266      assertEquals(Long.valueOf(0), keyValue.getKey());
267      assertEquals(Double.valueOf(1d), keyValue.getValue());
268      keyValue = jedis.zrankWithScore(&quot;foo&quot;, &quot;b&quot;);
269      assertEquals(Long.valueOf(1), keyValue.getKey());
270      assertEquals(Double.valueOf(2d), keyValue.getValue());
271      assertNull(jedis.zrankWithScore(&quot;car&quot;, &quot;b&quot;));
272      jedis.zadd(bfoo, 1d, ba);
273      jedis.zadd(bfoo, 2d, bb);
274      keyValue = jedis.zrankWithScore(bfoo, ba);
275      assertEquals(Long.valueOf(0), keyValue.getKey());
276      assertEquals(Double.valueOf(1d), keyValue.getValue());
277      keyValue = jedis.zrankWithScore(bfoo, bb);
278      assertEquals(Long.valueOf(1), keyValue.getKey());
279      assertEquals(Double.valueOf(2d), keyValue.getValue());
280      assertNull(jedis.zrankWithScore(bcar, bb));
281    }
282    @Test
283    public void zrevrank() {
284      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
285      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
286      long rank = jedis.zrevrank(&quot;foo&quot;, &quot;a&quot;);
287      assertEquals(1, rank);
288      rank = jedis.zrevrank(&quot;foo&quot;, &quot;b&quot;);
289      assertEquals(0, rank);
290      jedis.zadd(bfoo, 1d, ba);
291      jedis.zadd(bfoo, 2d, bb);
292      long brank = jedis.zrevrank(bfoo, ba);
293      assertEquals(1, brank);
294      brank = jedis.zrevrank(bfoo, bb);
295      assertEquals(0, brank);
296    }
297    @Test
298    public void zrangeWithScores() {
299      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
300      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
301      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
302      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
303      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
304      expected.add(new Tuple(&quot;c&quot;, 0.1d));
305      expected.add(new Tuple(&quot;a&quot;, 2d));
306      List&lt;Tuple&gt; range = jedis.zrangeWithScores(&quot;foo&quot;, 0, 1);
307      assertEquals(expected, range);
308      expected.add(new Tuple(&quot;b&quot;, 10d));
309      range = jedis.zrangeWithScores(&quot;foo&quot;, 0, 100);
310      assertEquals(expected, range);
311      jedis.zadd(bfoo, 1d, ba);
312      jedis.zadd(bfoo, 10d, bb);
313      jedis.zadd(bfoo, 0.1d, bc);
314      jedis.zadd(bfoo, 2d, ba);
315      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
316      bexpected.add(new Tuple(bc, 0.1d));
317      bexpected.add(new Tuple(ba, 2d));
318      List&lt;Tuple&gt; brange = jedis.zrangeWithScores(bfoo, 0, 1);
319      assertEquals(bexpected, brange);
320      bexpected.add(new Tuple(bb, 10d));
321      brange = jedis.zrangeWithScores(bfoo, 0, 100);
322      assertEquals(bexpected, brange);
323    }
324    @Test
325    public void zrevrangeWithScores() {
326      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
327      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
328      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
329      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
330      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
331      expected.add(new Tuple(&quot;b&quot;, 10d));
332      expected.add(new Tuple(&quot;a&quot;, 2d));
333      List&lt;Tuple&gt; range = jedis.zrevrangeWithScores(&quot;foo&quot;, 0, 1);
334      assertEquals(expected, range);
335      expected.add(new Tuple(&quot;c&quot;, 0.1d));
336      range = jedis.zrevrangeWithScores(&quot;foo&quot;, 0, 100);
337      assertEquals(expected, range);
338      jedis.zadd(bfoo, 1d, ba);
339      jedis.zadd(bfoo, 10d, bb);
340      jedis.zadd(bfoo, 0.1d, bc);
341      jedis.zadd(bfoo, 2d, ba);
342      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
343      bexpected.add(new Tuple(bb, 10d));
344      bexpected.add(new Tuple(ba, 2d));
345      List&lt;Tuple&gt; brange = jedis.zrevrangeWithScores(bfoo, 0, 1);
346      assertEquals(bexpected, brange);
347      bexpected.add(new Tuple(bc, 0.1d));
348      brange = jedis.zrevrangeWithScores(bfoo, 0, 100);
349      assertEquals(bexpected, brange);
350    }
351    @Test
352    public void zcard() {
353      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
354      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
355      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
356      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
357      assertEquals(3, jedis.zcard(&quot;foo&quot;));
358      jedis.zadd(bfoo, 1d, ba);
359      jedis.zadd(bfoo, 10d, bb);
360      jedis.zadd(bfoo, 0.1d, bc);
361      jedis.zadd(bfoo, 2d, ba);
362      assertEquals(3, jedis.zcard(bfoo));
363    }
364    @Test
365    public void zscore() {
366      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
367      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
368      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
369      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
370      assertEquals((Double) 10d, jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
371      assertEquals((Double) 0.1d, jedis.zscore(&quot;foo&quot;, &quot;c&quot;));
372      assertNull(jedis.zscore(&quot;foo&quot;, &quot;s&quot;));
373      jedis.zadd(bfoo, 1d, ba);
374      jedis.zadd(bfoo, 10d, bb);
375      jedis.zadd(bfoo, 0.1d, bc);
376      jedis.zadd(bfoo, 2d, ba);
377      assertEquals((Double) 10d, jedis.zscore(bfoo, bb));
378      assertEquals((Double) 0.1d, jedis.zscore(bfoo, bc));
379      assertNull(jedis.zscore(bfoo, SafeEncoder.encode(&quot;s&quot;)));
380    }
381    @Test
382    public void zmscore() {
383      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
384      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
385      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
386      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
387      assertEquals(Arrays.asList(10d, 0.1d, null), jedis.zmscore(&quot;foo&quot;, &quot;b&quot;, &quot;c&quot;, &quot;s&quot;));
388      jedis.zadd(bfoo, 1d, ba);
389      jedis.zadd(bfoo, 10d, bb);
390      jedis.zadd(bfoo, 0.1d, bc);
391      jedis.zadd(bfoo, 2d, ba);
392      assertEquals(Arrays.asList(10d, 0.1d, null),
393        jedis.zmscore(bfoo, bb, bc, SafeEncoder.encode(&quot;s&quot;)));
394    }
395    @Test
396    public void zpopmax() {
397      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
398      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
399      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
400      jedis.zadd(&quot;foo&quot;, 2d, &quot;d&quot;);
401      Tuple actual = jedis.zpopmax(&quot;foo&quot;);
402      Tuple expected = new Tuple(&quot;b&quot;, 10d);
403      assertEquals(expected, actual);
404      actual = jedis.zpopmax(&quot;foo&quot;);
405      expected = new Tuple(&quot;d&quot;, 2d);
406      assertEquals(expected, actual);
407      actual = jedis.zpopmax(&quot;foo&quot;);
408      expected = new Tuple(&quot;a&quot;, 1d);
409      assertEquals(expected, actual);
410      actual = jedis.zpopmax(&quot;foo&quot;);
411      expected = new Tuple(&quot;c&quot;, 0.1d);
412      assertEquals(expected, actual);
413      actual = jedis.zpopmax(&quot;foo&quot;);
414      assertNull(actual);
415      jedis.zadd(bfoo, 1d, ba);
416      jedis.zadd(bfoo, 10d, bb);
417      jedis.zadd(bfoo, 0.1d, bc);
418      jedis.zadd(bfoo, 2d, ba);
419      actual = jedis.zpopmax(bfoo);
420      expected = new Tuple(bb, 10d);
421      assertEquals(expected, actual);
422      actual = jedis.zpopmax(bfoo);
423      expected = new Tuple(ba, 2d);
424      assertEquals(expected, actual);
425      actual = jedis.zpopmax(bfoo);
426      expected = new Tuple(bc, 0.1d);
427      assertEquals(expected, actual);
428      actual = jedis.zpopmax(bfoo);
429      assertNull(actual);
430    }
431    @Test
432    public void zpopmaxWithCount() {
433      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
434      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
435      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
436      jedis.zadd(&quot;foo&quot;, 2d, &quot;d&quot;);
437      jedis.zadd(&quot;foo&quot;, 0.03, &quot;e&quot;);
438      List&lt;Tuple&gt; actual = jedis.zpopmax(&quot;foo&quot;, 2);
439      assertEquals(2, actual.size());
440      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
441      expected.add(new Tuple(&quot;b&quot;, 10d));
442      expected.add(new Tuple(&quot;d&quot;, 2d));
443      assertEquals(expected, actual);
444      actual = jedis.zpopmax(&quot;foo&quot;, 3);
445      assertEquals(3, actual.size());
446      expected.clear();
447      expected.add(new Tuple(&quot;a&quot;, 1d));
448      expected.add(new Tuple(&quot;c&quot;, 0.1d));
449      expected.add(new Tuple(&quot;e&quot;, 0.03d));
450      assertEquals(expected, actual);
451      actual = jedis.zpopmax(&quot;foo&quot;, 1);
452      expected.clear();
453      assertEquals(expected, actual);
454      jedis.zadd(bfoo, 1d, ba);
455      jedis.zadd(bfoo, 10d, bb);
456      jedis.zadd(bfoo, 0.1d, bc);
457      jedis.zadd(bfoo, 2d, ba);
458      actual = jedis.zpopmax(bfoo, 1);
459      expected.clear();
460      expected.add(new Tuple(bb, 10d));
461      assertEquals(expected, actual);
462      actual = jedis.zpopmax(bfoo, 1);
463      expected.clear();
464      expected.add(new Tuple(ba, 2d));
465      assertEquals(expected, actual);
466      actual = jedis.zpopmax(bfoo, 1);
467      expected.clear();
468      expected.add(new Tuple(bc, 0.1d));
469      assertEquals(expected, actual);
470      actual = jedis.zpopmax(bfoo, 1);
471      expected.clear();
472      assertEquals(expected, actual);
473    }
474    @Test
475    public void zpopmin() {
476      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
477      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
478      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
479      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx());
480      List&lt;Tuple&gt; range = jedis.zpopmin(&quot;foo&quot;, 2);
481      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
482      expected.add(new Tuple(&quot;c&quot;, 0.1d));
483      expected.add(new Tuple(&quot;a&quot;, 1d));
484      assertEquals(expected, range);
485      assertEquals(new Tuple(&quot;b&quot;, 10d), jedis.zpopmin(&quot;foo&quot;));
486      jedis.zadd(bfoo, 1d, ba);
487      jedis.zadd(bfoo, 10d, bb);
488      jedis.zadd(bfoo, 0.1d, bc);
489      jedis.zadd(bfoo, 2d, ba);
490      List&lt;Tuple&gt; brange = jedis.zpopmin(bfoo, 2);
491      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
492      bexpected.add(new Tuple(bc, 0.1d));
493      bexpected.add(new Tuple(ba, 2d));
494      assertEquals(bexpected, brange);
495      assertEquals(new Tuple(bb, 10d), jedis.zpopmin(bfoo));
496    }
497    @Test
498    public void zcount() {
499      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
500      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
501      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
502      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
503      assertEquals(2, jedis.zcount(&quot;foo&quot;, 0.01d, 2.1d));
504      assertEquals(3, jedis.zcount(&quot;foo&quot;, &quot;(0.01&quot;, &quot;+inf&quot;));
505      jedis.zadd(bfoo, 1d, ba);
506      jedis.zadd(bfoo, 10d, bb);
507      jedis.zadd(bfoo, 0.1d, bc);
508      jedis.zadd(bfoo, 2d, ba);
509      assertEquals(2, jedis.zcount(bfoo, 0.01d, 2.1d));
510      assertEquals(3, jedis.zcount(bfoo, SafeEncoder.encode(&quot;(0.01&quot;), SafeEncoder.encode(&quot;+inf&quot;)));
511    }
512    @Test
513    public void zlexcount() {
514      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
515      jedis.zadd(&quot;foo&quot;, 1, &quot;b&quot;);
516      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
517      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
518      assertEquals(2, jedis.zlexcount(&quot;foo&quot;, &quot;[aa&quot;, &quot;(c&quot;));
519      assertEquals(4, jedis.zlexcount(&quot;foo&quot;, &quot;-&quot;, &quot;+&quot;));
520      assertEquals(3, jedis.zlexcount(&quot;foo&quot;, &quot;-&quot;, &quot;(c&quot;));
521      assertEquals(3, jedis.zlexcount(&quot;foo&quot;, &quot;[aa&quot;, &quot;+&quot;));
522    }
523    @Test
524    public void zlexcountBinary() {
525      jedis.zadd(bfoo, 1, ba);
526      jedis.zadd(bfoo, 1, bc);
527      jedis.zadd(bfoo, 1, bb);
528      assertEquals(1, jedis.zlexcount(bfoo, bInclusiveB, bExclusiveC));
529      assertEquals(3, jedis.zlexcount(bfoo, bLexMinusInf, bLexPlusInf));
530    }
531    @Test
532    public void zrangebyscore() {
533      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
534      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
535      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
536      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
537      List&lt;String&gt; range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d);
538      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
539      expected.add(&quot;c&quot;);
540      expected.add(&quot;a&quot;);
541      assertEquals(expected, range);
542      range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d, 0, 1);
543      expected = new ArrayList&lt;String&gt;();
544      expected.add(&quot;c&quot;);
545      assertEquals(expected, range);
546      range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d, 1, 1);
547      List&lt;String&gt; range2 = jedis.zrangeByScore(&quot;foo&quot;, &quot;-inf&quot;, &quot;(2&quot;);
548      assertEquals(expected, range2);
549      expected = new ArrayList&lt;String&gt;();
550      expected.add(&quot;a&quot;);
551      assertEquals(expected, range);
552      jedis.zadd(bfoo, 1d, ba);
553      jedis.zadd(bfoo, 10d, bb);
554      jedis.zadd(bfoo, 0.1d, bc);
555      jedis.zadd(bfoo, 2d, ba);
556      List&lt;byte[]&gt; brange = jedis.zrangeByScore(bfoo, 0d, 2d);
557      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
558      bexpected.add(bc);
559      bexpected.add(ba);
560      assertByteArrayListEquals(bexpected, brange);
561      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 0, 1);
562      bexpected = new ArrayList&lt;byte[]&gt;();
563      bexpected.add(bc);
564      assertByteArrayListEquals(bexpected, brange);
565      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 1, 1);
566      List&lt;byte[]&gt; brange2 = jedis.zrangeByScore(bfoo, SafeEncoder.encode(&quot;-inf&quot;),
567        SafeEncoder.encode(&quot;(2&quot;));
568      assertByteArrayListEquals(bexpected, brange2);
569      bexpected = new ArrayList&lt;byte[]&gt;();
570      bexpected.add(ba);
571      assertByteArrayListEquals(bexpected, brange);
572    }
573    @Test
574    public void zrevrangebyscore() {
575      jedis.zadd(&quot;foo&quot;, 1.0d, &quot;a&quot;);
576      jedis.zadd(&quot;foo&quot;, 2.0d, &quot;b&quot;);
577      jedis.zadd(&quot;foo&quot;, 3.0d, &quot;c&quot;);
578      jedis.zadd(&quot;foo&quot;, 4.0d, &quot;d&quot;);
579      jedis.zadd(&quot;foo&quot;, 5.0d, &quot;e&quot;);
580      List&lt;String&gt; range = jedis.zrevrangeByScore(&quot;foo&quot;, 3d, Double.NEGATIVE_INFINITY, 0, 1);
581      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
582      expected.add(&quot;c&quot;);
583      assertEquals(expected, range);
584      range = jedis.zrevrangeByScore(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
585      expected = new ArrayList&lt;String&gt;();
586      expected.add(&quot;c&quot;);
587      expected.add(&quot;b&quot;);
588      assertEquals(expected, range);
589      range = jedis.zrevrangeByScore(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
590      expected = new ArrayList&lt;String&gt;();
591      expected.add(&quot;b&quot;);
592      assertEquals(expected, range);
593      range = jedis.zrevrangeByScore(&quot;foo&quot;, 4d, 2d);
594      expected = new ArrayList&lt;String&gt;();
595      expected.add(&quot;d&quot;);
596      expected.add(&quot;c&quot;);
597      expected.add(&quot;b&quot;);
598      assertEquals(expected, range);
599      range = jedis.zrevrangeByScore(&quot;foo&quot;, &quot;4&quot;, &quot;2&quot;, 0, 2);
600      expected = new ArrayList&lt;String&gt;();
601      expected.add(&quot;d&quot;);
602      expected.add(&quot;c&quot;);
603      assertEquals(expected, range);
604      range = jedis.zrevrangeByScore(&quot;foo&quot;, &quot;+inf&quot;, &quot;(4&quot;);
605      expected = new ArrayList&lt;String&gt;();
606      expected.add(&quot;e&quot;);
607      assertEquals(expected, range);
608      jedis.zadd(bfoo, 1d, ba);
609      jedis.zadd(bfoo, 10d, bb);
610      jedis.zadd(bfoo, 0.1d, bc);
611      jedis.zadd(bfoo, 2d, ba);
612      List&lt;byte[]&gt; brange = jedis.zrevrangeByScore(bfoo, 2d, 0d);
613      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
614      bexpected.add(ba);
615      bexpected.add(bc);
616      assertByteArrayListEquals(bexpected, brange);
617      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 0, 1);
618      bexpected = new ArrayList&lt;byte[]&gt;();
619      bexpected.add(ba);
620      assertByteArrayListEquals(bexpected, brange);
621      List&lt;byte[]&gt; brange2 = jedis.zrevrangeByScore(bfoo, SafeEncoder.encode(&quot;+inf&quot;),
622        SafeEncoder.encode(&quot;(2&quot;));
623      bexpected = new ArrayList&lt;byte[]&gt;();
624      bexpected.add(bb);
625      assertByteArrayListEquals(bexpected, brange2);
626      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 1, 1);
627      bexpected = new ArrayList&lt;byte[]&gt;();
628      bexpected.add(bc);
629      assertByteArrayListEquals(bexpected, brange);
630    }
631    @Test
632    public void zrangebyscoreWithScores() {
633      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
634      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
635      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
636      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
637      List&lt;Tuple&gt; range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d);
638      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
639      expected.add(new Tuple(&quot;c&quot;, 0.1d));
640      expected.add(new Tuple(&quot;a&quot;, 2d));
641      assertEquals(expected, range);
642      range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d, 0, 1);
643      expected = new ArrayList&lt;Tuple&gt;();
644      expected.add(new Tuple(&quot;c&quot;, 0.1d));
645      assertEquals(expected, range);
646      range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d, 1, 1);
647      expected = new ArrayList&lt;Tuple&gt;();
648      expected.add(new Tuple(&quot;a&quot;, 2d));
649      assertEquals(expected, range);
650      jedis.zadd(bfoo, 1d, ba);
651      jedis.zadd(bfoo, 10d, bb);
652      jedis.zadd(bfoo, 0.1d, bc);
653      jedis.zadd(bfoo, 2d, ba);
654      List&lt;Tuple&gt; brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d);
655      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
656      bexpected.add(new Tuple(bc, 0.1d));
657      bexpected.add(new Tuple(ba, 2d));
658      assertEquals(bexpected, brange);
659      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 0, 1);
660      bexpected = new ArrayList&lt;Tuple&gt;();
661      bexpected.add(new Tuple(bc, 0.1d));
662      assertEquals(bexpected, brange);
663      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 1, 1);
664      bexpected = new ArrayList&lt;Tuple&gt;();
665      bexpected.add(new Tuple(ba, 2d));
666      assertEquals(bexpected, brange);
667    }
668    @Test
669    public void zrangeParams() {
670      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
671      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
672      jedis.zadd(&quot;foo&quot;, 1, &quot;bb&quot;);
673      jedis.zadd(&quot;foo&quot;, 1, &quot;d&quot;);
674      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
</pre></code></div>
                <div class="column column_space"><pre><code>294      assertEquals(1, rank);
295      assertNull(jedis.zrank(&quot;car&quot;, &quot;b&quot;));
296      jedis.zadd(bfoo, 1d, ba);
297      jedis.zadd(bfoo, 2d, bb);
298      long brank = jedis.zrank(bfoo, ba);
299      assertEquals(0, brank);
300      brank = jedis.zrank(bfoo, bb);
301      assertEquals(1, brank);
302      assertNull(jedis.zrank(bcar, bb));
303    }
304    @Test
305    public void zrankWithScore() {
306      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
307      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
308      KeyValue&lt;Long, Double&gt; keyValue = jedis.zrankWithScore(&quot;foo&quot;, &quot;a&quot;);
309      assertEquals(Long.valueOf(0), keyValue.getKey());
310      assertEquals(Double.valueOf(1d), keyValue.getValue());
311      keyValue = jedis.zrankWithScore(&quot;foo&quot;, &quot;b&quot;);
312      assertEquals(Long.valueOf(1), keyValue.getKey());
313      assertEquals(Double.valueOf(2d), keyValue.getValue());
314      assertNull(jedis.zrankWithScore(&quot;car&quot;, &quot;b&quot;));
315      jedis.zadd(bfoo, 1d, ba);
316      jedis.zadd(bfoo, 2d, bb);
317      keyValue = jedis.zrankWithScore(bfoo, ba);
318      assertEquals(Long.valueOf(0), keyValue.getKey());
319      assertEquals(Double.valueOf(1d), keyValue.getValue());
320      keyValue = jedis.zrankWithScore(bfoo, bb);
321      assertEquals(Long.valueOf(1), keyValue.getKey());
322      assertEquals(Double.valueOf(2d), keyValue.getValue());
323      assertNull(jedis.zrankWithScore(bcar, bb));
324    }
325    @Test
326    public void zrevrank() {
327      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
328      jedis.zadd(&quot;foo&quot;, 2d, &quot;b&quot;);
329      long rank = jedis.zrevrank(&quot;foo&quot;, &quot;a&quot;);
330      assertEquals(1, rank);
331      rank = jedis.zrevrank(&quot;foo&quot;, &quot;b&quot;);
332      assertEquals(0, rank);
333      jedis.zadd(bfoo, 1d, ba);
334      jedis.zadd(bfoo, 2d, bb);
335      long brank = jedis.zrevrank(bfoo, ba);
336      assertEquals(1, brank);
337      brank = jedis.zrevrank(bfoo, bb);
338      assertEquals(0, brank);
339    }
340    @Test
341    public void zrangeWithScores() {
342      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
343      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
344      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
345      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
346      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
347      expected.add(new Tuple(&quot;c&quot;, 0.1d));
348      expected.add(new Tuple(&quot;a&quot;, 2d));
349      List&lt;Tuple&gt; range = jedis.zrangeWithScores(&quot;foo&quot;, 0, 1);
350      assertEquals(expected, range);
351      expected.add(new Tuple(&quot;b&quot;, 10d));
352      range = jedis.zrangeWithScores(&quot;foo&quot;, 0, 100);
353      assertEquals(expected, range);
354      jedis.zadd(bfoo, 1d, ba);
355      jedis.zadd(bfoo, 10d, bb);
356      jedis.zadd(bfoo, 0.1d, bc);
357      jedis.zadd(bfoo, 2d, ba);
358      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
359      bexpected.add(new Tuple(bc, 0.1d));
360      bexpected.add(new Tuple(ba, 2d));
361      List&lt;Tuple&gt; brange = jedis.zrangeWithScores(bfoo, 0, 1);
362      assertEquals(bexpected, brange);
363      bexpected.add(new Tuple(bb, 10d));
364      brange = jedis.zrangeWithScores(bfoo, 0, 100);
365      assertEquals(bexpected, brange);
366    }
367    @Test
368    public void zrevrangeWithScores() {
369      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
370      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
371      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
372      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
373      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
374      expected.add(new Tuple(&quot;b&quot;, 10d));
375      expected.add(new Tuple(&quot;a&quot;, 2d));
376      List&lt;Tuple&gt; range = jedis.zrevrangeWithScores(&quot;foo&quot;, 0, 1);
377      assertEquals(expected, range);
378      expected.add(new Tuple(&quot;c&quot;, 0.1d));
379      range = jedis.zrevrangeWithScores(&quot;foo&quot;, 0, 100);
380      assertEquals(expected, range);
381      jedis.zadd(bfoo, 1d, ba);
382      jedis.zadd(bfoo, 10d, bb);
383      jedis.zadd(bfoo, 0.1d, bc);
384      jedis.zadd(bfoo, 2d, ba);
385      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
386      bexpected.add(new Tuple(bb, 10d));
387      bexpected.add(new Tuple(ba, 2d));
388      List&lt;Tuple&gt; brange = jedis.zrevrangeWithScores(bfoo, 0, 1);
389      assertEquals(bexpected, brange);
390      bexpected.add(new Tuple(bc, 0.1d));
391      brange = jedis.zrevrangeWithScores(bfoo, 0, 100);
392      assertEquals(bexpected, brange);
393    }
394    @Test
395    public void zcard() {
396      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
397      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
398      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
399      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
400      assertEquals(3, jedis.zcard(&quot;foo&quot;));
401      jedis.zadd(bfoo, 1d, ba);
402      jedis.zadd(bfoo, 10d, bb);
403      jedis.zadd(bfoo, 0.1d, bc);
404      jedis.zadd(bfoo, 2d, ba);
405      assertEquals(3, jedis.zcard(bfoo));
406    }
407    @Test
408    public void zscore() {
409      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
410      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
411      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
412      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
413      assertEquals((Double) 10d, jedis.zscore(&quot;foo&quot;, &quot;b&quot;));
414      assertEquals((Double) 0.1d, jedis.zscore(&quot;foo&quot;, &quot;c&quot;));
415      assertNull(jedis.zscore(&quot;foo&quot;, &quot;s&quot;));
416      jedis.zadd(bfoo, 1d, ba);
417      jedis.zadd(bfoo, 10d, bb);
418      jedis.zadd(bfoo, 0.1d, bc);
419      jedis.zadd(bfoo, 2d, ba);
420      assertEquals((Double) 10d, jedis.zscore(bfoo, bb));
421      assertEquals((Double) 0.1d, jedis.zscore(bfoo, bc));
422      assertNull(jedis.zscore(bfoo, SafeEncoder.encode(&quot;s&quot;)));
423    }
424    @Test
425    public void zmscore() {
426      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
427      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
428      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
429      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
430      assertEquals(Arrays.asList(10d, 0.1d, null), jedis.zmscore(&quot;foo&quot;, &quot;b&quot;, &quot;c&quot;, &quot;s&quot;));
431      jedis.zadd(bfoo, 1d, ba);
432      jedis.zadd(bfoo, 10d, bb);
433      jedis.zadd(bfoo, 0.1d, bc);
434      jedis.zadd(bfoo, 2d, ba);
435      assertEquals(Arrays.asList(10d, 0.1d, null),
436        jedis.zmscore(bfoo, bb, bc, SafeEncoder.encode(&quot;s&quot;)));
437    }
438    @Test
439    public void zpopmax() {
440      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
441      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
442      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
443      jedis.zadd(&quot;foo&quot;, 2d, &quot;d&quot;);
444      Tuple actual = jedis.zpopmax(&quot;foo&quot;);
445      Tuple expected = new Tuple(&quot;b&quot;, 10d);
446      assertEquals(expected, actual);
447      actual = jedis.zpopmax(&quot;foo&quot;);
448      expected = new Tuple(&quot;d&quot;, 2d);
449      assertEquals(expected, actual);
450      actual = jedis.zpopmax(&quot;foo&quot;);
451      expected = new Tuple(&quot;a&quot;, 1d);
452      assertEquals(expected, actual);
453      actual = jedis.zpopmax(&quot;foo&quot;);
454      expected = new Tuple(&quot;c&quot;, 0.1d);
455      assertEquals(expected, actual);
456      actual = jedis.zpopmax(&quot;foo&quot;);
457      assertNull(actual);
458      jedis.zadd(bfoo, 1d, ba);
459      jedis.zadd(bfoo, 10d, bb);
460      jedis.zadd(bfoo, 0.1d, bc);
461      jedis.zadd(bfoo, 2d, ba);
462      actual = jedis.zpopmax(bfoo);
463      expected = new Tuple(bb, 10d);
464      assertEquals(expected, actual);
465      actual = jedis.zpopmax(bfoo);
466      expected = new Tuple(ba, 2d);
467      assertEquals(expected, actual);
468      actual = jedis.zpopmax(bfoo);
469      expected = new Tuple(bc, 0.1d);
470      assertEquals(expected, actual);
471      actual = jedis.zpopmax(bfoo);
472      assertNull(actual);
473    }
474    @Test
475    public void zpopmaxWithCount() {
476      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
477      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
478      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
479      jedis.zadd(&quot;foo&quot;, 2d, &quot;d&quot;);
480      jedis.zadd(&quot;foo&quot;, 0.03, &quot;e&quot;);
481      List&lt;Tuple&gt; actual = jedis.zpopmax(&quot;foo&quot;, 2);
482      assertEquals(2, actual.size());
483      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
484      expected.add(new Tuple(&quot;b&quot;, 10d));
485      expected.add(new Tuple(&quot;d&quot;, 2d));
486      assertEquals(expected, actual);
487      actual = jedis.zpopmax(&quot;foo&quot;, 3);
488      assertEquals(3, actual.size());
489      expected.clear();
490      expected.add(new Tuple(&quot;a&quot;, 1d));
491      expected.add(new Tuple(&quot;c&quot;, 0.1d));
492      expected.add(new Tuple(&quot;e&quot;, 0.03d));
493      assertEquals(expected, actual);
494      actual = jedis.zpopmax(&quot;foo&quot;, 1);
495      expected.clear();
496      assertEquals(expected, actual);
497      jedis.zadd(bfoo, 1d, ba);
498      jedis.zadd(bfoo, 10d, bb);
499      jedis.zadd(bfoo, 0.1d, bc);
500      jedis.zadd(bfoo, 2d, ba);
501      actual = jedis.zpopmax(bfoo, 1);
502      expected.clear();
503      expected.add(new Tuple(bb, 10d));
504      assertEquals(expected, actual);
505      actual = jedis.zpopmax(bfoo, 1);
506      expected.clear();
507      expected.add(new Tuple(ba, 2d));
508      assertEquals(expected, actual);
509      actual = jedis.zpopmax(bfoo, 1);
510      expected.clear();
511      expected.add(new Tuple(bc, 0.1d));
512      assertEquals(expected, actual);
513      actual = jedis.zpopmax(bfoo, 1);
514      expected.clear();
515      assertEquals(expected, actual);
516    }
517    @Test
518    public void zpopmin() {
519      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;, ZAddParams.zAddParams().nx());
520      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;, ZAddParams.zAddParams().nx());
521      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;, ZAddParams.zAddParams().nx());
522      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;, ZAddParams.zAddParams().nx());
523      List&lt;Tuple&gt; range = jedis.zpopmin(&quot;foo&quot;, 2);
524      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
525      expected.add(new Tuple(&quot;c&quot;, 0.1d));
526      expected.add(new Tuple(&quot;a&quot;, 1d));
527      assertEquals(expected, range);
528      assertEquals(new Tuple(&quot;b&quot;, 10d), jedis.zpopmin(&quot;foo&quot;));
529      jedis.zadd(bfoo, 1d, ba);
530      jedis.zadd(bfoo, 10d, bb);
531      jedis.zadd(bfoo, 0.1d, bc);
532      jedis.zadd(bfoo, 2d, ba);
533      List&lt;Tuple&gt; brange = jedis.zpopmin(bfoo, 2);
534      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
535      bexpected.add(new Tuple(bc, 0.1d));
536      bexpected.add(new Tuple(ba, 2d));
537      assertEquals(bexpected, brange);
538      assertEquals(new Tuple(bb, 10d), jedis.zpopmin(bfoo));
539    }
540    @Test
541    public void zcount() {
542      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
543      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
544      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
545      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
546      assertEquals(2, jedis.zcount(&quot;foo&quot;, 0.01d, 2.1d));
547      assertEquals(3, jedis.zcount(&quot;foo&quot;, &quot;(0.01&quot;, &quot;+inf&quot;));
548      jedis.zadd(bfoo, 1d, ba);
549      jedis.zadd(bfoo, 10d, bb);
550      jedis.zadd(bfoo, 0.1d, bc);
551      jedis.zadd(bfoo, 2d, ba);
552      assertEquals(2, jedis.zcount(bfoo, 0.01d, 2.1d));
553      assertEquals(3, jedis.zcount(bfoo, SafeEncoder.encode(&quot;(0.01&quot;), SafeEncoder.encode(&quot;+inf&quot;)));
554    }
555    @Test
556    public void zlexcount() {
557      jedis.zadd(&quot;foo&quot;, 1, &quot;a&quot;);
558      jedis.zadd(&quot;foo&quot;, 1, &quot;b&quot;);
559      jedis.zadd(&quot;foo&quot;, 1, &quot;c&quot;);
560      jedis.zadd(&quot;foo&quot;, 1, &quot;aa&quot;);
561      assertEquals(2, jedis.zlexcount(&quot;foo&quot;, &quot;[aa&quot;, &quot;(c&quot;));
562      assertEquals(4, jedis.zlexcount(&quot;foo&quot;, &quot;-&quot;, &quot;+&quot;));
563      assertEquals(3, jedis.zlexcount(&quot;foo&quot;, &quot;-&quot;, &quot;(c&quot;));
564      assertEquals(3, jedis.zlexcount(&quot;foo&quot;, &quot;[aa&quot;, &quot;+&quot;));
565    }
566    @Test
567    public void zlexcountBinary() {
568      jedis.zadd(bfoo, 1, ba);
569      jedis.zadd(bfoo, 1, bc);
570      jedis.zadd(bfoo, 1, bb);
571      assertEquals(1, jedis.zlexcount(bfoo, bInclusiveB, bExclusiveC));
572      assertEquals(3, jedis.zlexcount(bfoo, bLexMinusInf, bLexPlusInf));
573    }
574    @Test
575    public void zrangebyscore() {
576      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
577      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
578      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
579      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
580      List&lt;String&gt; range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d);
581      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
582      expected.add(&quot;c&quot;);
583      expected.add(&quot;a&quot;);
584      assertEquals(expected, range);
585      range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d, 0, 1);
586      expected = new ArrayList&lt;String&gt;();
587      expected.add(&quot;c&quot;);
588      assertEquals(expected, range);
589      range = jedis.zrangeByScore(&quot;foo&quot;, 0d, 2d, 1, 1);
590      List&lt;String&gt; range2 = jedis.zrangeByScore(&quot;foo&quot;, &quot;-inf&quot;, &quot;(2&quot;);
591      assertEquals(expected, range2);
592      expected = new ArrayList&lt;String&gt;();
593      expected.add(&quot;a&quot;);
594      assertEquals(expected, range);
595      jedis.zadd(bfoo, 1d, ba);
596      jedis.zadd(bfoo, 10d, bb);
597      jedis.zadd(bfoo, 0.1d, bc);
598      jedis.zadd(bfoo, 2d, ba);
599      List&lt;byte[]&gt; brange = jedis.zrangeByScore(bfoo, 0d, 2d);
600      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
601      bexpected.add(bc);
602      bexpected.add(ba);
603      assertByteArrayListEquals(bexpected, brange);
604      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 0, 1);
605      bexpected = new ArrayList&lt;byte[]&gt;();
606      bexpected.add(bc);
607      assertByteArrayListEquals(bexpected, brange);
608      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 1, 1);
609      List&lt;byte[]&gt; brange2 = jedis.zrangeByScore(bfoo, SafeEncoder.encode(&quot;-inf&quot;),
610        SafeEncoder.encode(&quot;(2&quot;));
611      assertByteArrayListEquals(bexpected, brange2);
612      bexpected = new ArrayList&lt;byte[]&gt;();
613      bexpected.add(ba);
614      assertByteArrayListEquals(bexpected, brange);
615    }
616    @Test
617    public void zrevrangebyscore() {
618      jedis.zadd(&quot;foo&quot;, 1.0d, &quot;a&quot;);
619      jedis.zadd(&quot;foo&quot;, 2.0d, &quot;b&quot;);
620      jedis.zadd(&quot;foo&quot;, 3.0d, &quot;c&quot;);
621      jedis.zadd(&quot;foo&quot;, 4.0d, &quot;d&quot;);
622      jedis.zadd(&quot;foo&quot;, 5.0d, &quot;e&quot;);
623      List&lt;String&gt; range = jedis.zrevrangeByScore(&quot;foo&quot;, 3d, Double.NEGATIVE_INFINITY, 0, 1);
624      List&lt;String&gt; expected = new ArrayList&lt;String&gt;();
625      expected.add(&quot;c&quot;);
626      assertEquals(expected, range);
627      range = jedis.zrevrangeByScore(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
628      expected = new ArrayList&lt;String&gt;();
629      expected.add(&quot;c&quot;);
630      expected.add(&quot;b&quot;);
631      assertEquals(expected, range);
632      range = jedis.zrevrangeByScore(&quot;foo&quot;, 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
633      expected = new ArrayList&lt;String&gt;();
634      expected.add(&quot;b&quot;);
635      assertEquals(expected, range);
636      range = jedis.zrevrangeByScore(&quot;foo&quot;, 4d, 2d);
637      expected = new ArrayList&lt;String&gt;();
638      expected.add(&quot;d&quot;);
639      expected.add(&quot;c&quot;);
640      expected.add(&quot;b&quot;);
641      assertEquals(expected, range);
642      range = jedis.zrevrangeByScore(&quot;foo&quot;, &quot;4&quot;, &quot;2&quot;, 0, 2);
643      expected = new ArrayList&lt;String&gt;();
644      expected.add(&quot;d&quot;);
645      expected.add(&quot;c&quot;);
646      assertEquals(expected, range);
647      range = jedis.zrevrangeByScore(&quot;foo&quot;, &quot;+inf&quot;, &quot;(4&quot;);
648      expected = new ArrayList&lt;String&gt;();
649      expected.add(&quot;e&quot;);
650      assertEquals(expected, range);
651      jedis.zadd(bfoo, 1d, ba);
652      jedis.zadd(bfoo, 10d, bb);
653      jedis.zadd(bfoo, 0.1d, bc);
654      jedis.zadd(bfoo, 2d, ba);
655      List&lt;byte[]&gt; brange = jedis.zrevrangeByScore(bfoo, 2d, 0d);
656      List&lt;byte[]&gt; bexpected = new ArrayList&lt;byte[]&gt;();
657      bexpected.add(ba);
658      bexpected.add(bc);
659      assertByteArrayListEquals(bexpected, brange);
660      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 0, 1);
661      bexpected = new ArrayList&lt;byte[]&gt;();
662      bexpected.add(ba);
663      assertByteArrayListEquals(bexpected, brange);
664      List&lt;byte[]&gt; brange2 = jedis.zrevrangeByScore(bfoo, SafeEncoder.encode(&quot;+inf&quot;),
665        SafeEncoder.encode(&quot;(2&quot;));
666      bexpected = new ArrayList&lt;byte[]&gt;();
667      bexpected.add(bb);
668      assertByteArrayListEquals(bexpected, brange2);
669      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 1, 1);
670      bexpected = new ArrayList&lt;byte[]&gt;();
671      bexpected.add(bc);
672      assertByteArrayListEquals(bexpected, brange);
673    }
674    @Test
675    public void zrangebyscoreWithScores() {
676      jedis.zadd(&quot;foo&quot;, 1d, &quot;a&quot;);
677      jedis.zadd(&quot;foo&quot;, 10d, &quot;b&quot;);
678      jedis.zadd(&quot;foo&quot;, 0.1d, &quot;c&quot;);
679      jedis.zadd(&quot;foo&quot;, 2d, &quot;a&quot;);
680      List&lt;Tuple&gt; range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d);
681      List&lt;Tuple&gt; expected = new ArrayList&lt;Tuple&gt;();
682      expected.add(new Tuple(&quot;c&quot;, 0.1d));
683      expected.add(new Tuple(&quot;a&quot;, 2d));
684      assertEquals(expected, range);
685      range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d, 0, 1);
686      expected = new ArrayList&lt;Tuple&gt;();
687      expected.add(new Tuple(&quot;c&quot;, 0.1d));
688      assertEquals(expected, range);
689      range = jedis.zrangeByScoreWithScores(&quot;foo&quot;, 0d, 2d, 1, 1);
690      expected = new ArrayList&lt;Tuple&gt;();
691      expected.add(new Tuple(&quot;a&quot;, 2d));
692      assertEquals(expected, range);
693      jedis.zadd(bfoo, 1d, ba);
694      jedis.zadd(bfoo, 10d, bb);
695      jedis.zadd(bfoo, 0.1d, bc);
696      jedis.zadd(bfoo, 2d, ba);
697      List&lt;Tuple&gt; brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d);
698      List&lt;Tuple&gt; bexpected = new ArrayList&lt;Tuple&gt;();
699      bexpected.add(new Tuple(bc, 0.1d));
700      bexpected.add(new Tuple(ba, 2d));
701      assertEquals(bexpected, brange);
702      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 0, 1);
703      bexpected = new ArrayList&lt;Tuple&gt;();
704      bexpected.add(new Tuple(bc, 0.1d));
705      assertEquals(bexpected, brange);
706      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 1, 1);
707      bexpected = new ArrayList&lt;Tuple&gt;();
708      bexpected.add(new Tuple(ba, 2d));
709      assertEquals(bexpected, brange);
710    }
711    @Test
712    public void zrevrangebyscoreWithScores() {
713      jedis.zadd(&quot;foo&quot;, 1.0d, &quot;a&quot;);
714      jedis.zadd(&quot;foo&quot;, 2.0d, &quot;b&quot;);
715      jedis.zadd(&quot;foo&quot;, 3.0d, &quot;c&quot;);
716      jedis.zadd(&quot;foo&quot;, 4.0d, &quot;d&quot;);
717      jedis.zadd(&quot;foo&quot;, 5.0d, &quot;e&quot;);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    