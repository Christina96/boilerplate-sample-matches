<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for ActionPlugin.java &amp; WindowProjector.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for ActionPlugin.java &amp; WindowProjector.java
      </h3>
<h1 align="center">
        5.5%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>ActionPlugin.java (10.679611%)<th>WindowProjector.java (3.7414966%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(20-32)<td><a href="#" name="0">(22-33)</a><td align="center"><font color="#ff0000">11</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>ActionPlugin.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>package org.elasticsearch.plugins;
2 import org.elasticsearch.action.ActionType;
3 import org.elasticsearch.action.support.TransportAction;
4 import org.elasticsearch.action.support.TransportActions;
5 import org.elasticsearch.common.Strings;
6 import org.elasticsearch.transport.TransportRequest;
7 import org.elasticsearch.transport.TransportResponse;
8 import java.util.Collection;
9 import java.util.Collections;
10 import java.util.List;
11 import</b></font> java.util.Objects;
12 public interface ActionPlugin {
13     default List&lt;ActionHandler&lt;? extends TransportRequest, ? extends TransportResponse&gt;&gt; getActions() {
14         return Collections.emptyList();
15     }
16     default Collection&lt;String&gt; getRestHeaders() {
17         return Collections.emptyList();
18     }
19     final class ActionHandler&lt;Request extends TransportRequest, Response extends TransportResponse&gt; {
20         private final ActionType&lt;Response&gt; action;
21         private final Class&lt;? extends TransportAction&lt;Request, Response&gt;&gt; transportAction;
22         private final Class&lt;?&gt;[] supportTransportActions;
23         public ActionHandler(ActionType&lt;Response&gt; action, Class&lt;? extends TransportAction&lt;Request, Response&gt;&gt; transportAction,
24                              Class&lt;?&gt;... supportTransportActions) {
25             this.action = action;
26             this.transportAction = transportAction;
27             this.supportTransportActions = supportTransportActions;
28         }
29         public ActionType&lt;Response&gt; getAction() {
30             return action;
31         }
32         public Class&lt;? extends TransportAction&lt;Request, Response&gt;&gt; getTransportAction() {
33             return transportAction;
34         }
35         public Class&lt;?&gt;[] getSupportTransportActions() {
36             return supportTransportActions;
37         }
38         @Override
39         public String toString() {
40             StringBuilder b = new StringBuilder().append(action.name()).append(" is handled by ").append(transportAction.getName());
41             if (supportTransportActions.length &gt; 0) {
42                 b.append('[').append(Strings.arrayToCommaDelimitedString(supportTransportActions)).append(']');
43             }
44             return b.toString();
45         }
46         @Override
47         public boolean equals(Object obj) {
48             if (obj == null || obj.getClass() != ActionHandler.class) {
49                 return false;
50             }
51             ActionHandler&lt;?, ?&gt; other = (ActionHandler&lt;?, ?&gt;) obj;
52             return Objects.equals(action, other.action)
53                     &amp;&amp; Objects.equals(transportAction, other.transportAction)
54                     &amp;&amp; Objects.deepEquals(supportTransportActions, other.supportTransportActions);
55         }
56         @Override
57         public int hashCode() {
58             return Objects.hash(action, transportAction, supportTransportActions);
59         }
60     }
61 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>WindowProjector.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 /*
2  * Licensed to Crate.io GmbH ("Crate") under one or more contributor
3  * license agreements.  See the NOTICE file distributed with this work for
4  * additional information regarding copyright ownership.  Crate licenses
5  * this file to you under the Apache License, Version 2.0 (the "License");
6  * you may not use this file except in compliance with the License.  You may
7  * obtain a copy of the License at
8  *
9  *   http://www.apache.org/licenses/LICENSE-2.0
10  *
11  * Unless required by applicable law or agreed to in writing, software
12  * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
13  * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
14  * License for the specific language governing permissions and limitations
15  * under the License.
16  *
17  * However, if you have executed another commercial license agreement
18  * with Crate these terms will supersede the license and you may use the
19 <a name="0"></a> * software solely pursuant to the terms of the relevant commercial agreement.
20  */
21 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>package io.crate.execution.engine.window;
22 import io.crate.analyze.OrderBy;
23 import io.crate.analyze.WindowDefinition;
24 import io.crate.breaker.RamAccounting;
25 import io.crate.breaker.RowAccountingWithEstimators;
26 import io.crate.data.Input;
27 import io.crate.data.Projector;
28 import io.crate.data.Row;
29 import io.crate.execution.dsl.projection.WindowAggProjection;
30 import io.crate.execution.engine.aggregation.AggregationFunction;
31 import</b></font> io.crate.execution.engine.collect.CollectExpression;
32 import io.crate.expression.ExpressionsInput;
33 import io.crate.expression.InputFactory;
34 import io.crate.expression.symbol.InputColumn;
35 import io.crate.expression.symbol.Literal;
36 import io.crate.expression.symbol.Symbol;
37 import io.crate.expression.symbol.SymbolType;
38 import io.crate.expression.symbol.Symbols;
39 import io.crate.memory.MemoryManager;
40 import io.crate.metadata.FunctionImplementation;
41 import io.crate.metadata.NodeContext;
42 import io.crate.metadata.TransactionContext;
43 import io.crate.sql.tree.WindowFrame;
44 import io.crate.types.DataType;
45 import io.crate.types.IntervalType;
46 import org.elasticsearch.Version;
47 import javax.annotation.Nullable;
48 import java.util.ArrayList;
49 import java.util.Comparator;
50 import java.util.List;
51 import java.util.concurrent.Executor;
52 import java.util.function.BiFunction;
53 import java.util.function.IntSupplier;
54 import java.util.function.Supplier;
55 import static io.crate.analyze.SymbolEvaluator.evaluateWithoutParams;
56 import static io.crate.execution.engine.sort.Comparators.createComparator;
57 public class WindowProjector {
58     public static Projector fromProjection(WindowAggProjection projection,
59                                            NodeContext nodeCtx,
60                                            InputFactory inputFactory,
61                                            TransactionContext txnCtx,
62                                            RamAccounting ramAccounting,
63                                            MemoryManager memoryManager,
64                                            Version minNodeVersion,
65                                            Version indexVersionCreated,
66                                            IntSupplier numThreads,
67                                            Executor executor) {
68         var windowFunctionSymbols = projection.windowFunctions();
69         var numWindowFunctions = windowFunctionSymbols.size();
70         assert numWindowFunctions &gt; 0 : "WindowAggProjection must have at least 1 window function.";
71         ArrayList&lt;WindowFunction&gt; windowFunctions = new ArrayList&lt;&gt;(numWindowFunctions);
72         ArrayList&lt;CollectExpression&lt;Row, ?&gt;&gt; windowFuncArgsExpressions = new ArrayList&lt;&gt;(numWindowFunctions);
73         Input[][] windowFuncArgsInputs = new Input[numWindowFunctions][];
74         Boolean[] ignoreNulls = new Boolean[numWindowFunctions];
75         for (int idx = 0; idx &lt; numWindowFunctions; idx++) {
76             var windowFunctionSymbol = windowFunctionSymbols.get(idx);
77             InputFactory.Context&lt;CollectExpression&lt;Row, ?&gt;&gt; ctx = inputFactory.ctxForInputColumns(txnCtx);
78             ctx.add(windowFunctionSymbol.arguments());
79             FunctionImplementation impl = nodeCtx.functions().getQualified(
80                 windowFunctionSymbol,
81                 txnCtx.sessionSettings().searchPath()
82             );
83             assert impl != null : "Function implementation not found using full qualified lookup";
84             if (impl instanceof AggregationFunction) {
85                 var filterInputFactoryCtx = inputFactory.ctxForInputColumns(txnCtx);
86                 var filterSymbol = windowFunctionSymbol.filter();
87                 //noinspection unchecked
88                 Input&lt;Boolean&gt; filterInput = filterSymbol == null
89                     ? Literal.BOOLEAN_TRUE
90                     : (Input&lt;Boolean&gt;) filterInputFactoryCtx.add(filterSymbol);
91                 ExpressionsInput&lt;Row, Boolean&gt; filter = new ExpressionsInput&lt;&gt;(
92                     filterInput,
93                     filterInputFactoryCtx.expressions());
94                 windowFunctions.add(
95                     new AggregateToWindowFunctionAdapter(
96                         (AggregationFunction) impl,
97                         filter,
98                         indexVersionCreated,
99                         ramAccounting,
100                         memoryManager,
101                         minNodeVersion
102                     )
103                 );
104             } else if (impl instanceof WindowFunction) {
105                 windowFunctions.add((WindowFunction) impl);
106             } else {
107                 throw new AssertionError("Function needs to be either a window or an aggregate function");
108             }
109             windowFuncArgsExpressions.addAll(ctx.expressions());
110             windowFuncArgsInputs[idx] = ctx.topLevelInputs().toArray(new Input[0]);
111             ignoreNulls[idx] = windowFunctionSymbol.ignoreNulls();
112         }
113         var windowDefinition = projection.windowDefinition();
114         var partitions = windowDefinition.partitions();
115         Supplier&lt;InputFactory.Context&lt;CollectExpression&lt;Row, ?&gt;&gt;&gt; createInputFactoryContext =
116             () -&gt; inputFactory.ctxForInputColumns(txnCtx);
117         int arrayListElementOverHead = 32;
118         RowAccountingWithEstimators accounting = new RowAccountingWithEstimators(
119             Symbols.typeView(projection.standalone()), ramAccounting, arrayListElementOverHead);
120         Comparator&lt;Object[]&gt; cmpPartitionBy = partitions.isEmpty()
121             ? null
122             : createComparator(createInputFactoryContext, new OrderBy(windowDefinition.partitions()));
123         Comparator&lt;Object[]&gt; cmpOrderBy = createComparator(createInputFactoryContext, windowDefinition.orderBy());
124         int numCellsInSourceRow = projection.standalone().size();
125         ComputeFrameBoundary&lt;Object[]&gt; computeFrameStart = createComputeStartFrameBoundary(
126             numCellsInSourceRow,
127             txnCtx,
128             nodeCtx,
129             windowDefinition,
130             cmpOrderBy
131         );
132         ComputeFrameBoundary&lt;Object[]&gt; computeFrameEnd = createComputeEndFrameBoundary(
133             numCellsInSourceRow,
134             txnCtx,
135             nodeCtx,
136             windowDefinition,
137             cmpOrderBy
138         );
139         return sourceRows -&gt; WindowFunctionBatchIterator.of(
140             sourceRows,
141             accounting,
142             computeFrameStart,
143             computeFrameEnd,
144             cmpPartitionBy,
145             cmpOrderBy,
146             numCellsInSourceRow,
147             numThreads,
148             executor,
149             windowFunctions,
150             windowFuncArgsExpressions,
151             ignoreNulls,
152             windowFuncArgsInputs
153         );
154     }
155     static ComputeFrameBoundary&lt;Object[]&gt; createComputeEndFrameBoundary(int numCellsInSourceRow,
156                                                                         TransactionContext txnCtx,
157                                                                         NodeContext nodeCtx,
158                                                                         WindowDefinition windowDefinition,
159                                                                         Comparator&lt;Object[]&gt; cmpOrderBy) {
160         var frameDefinition = windowDefinition.windowFrameDefinition();
161         var frameBoundEnd = frameDefinition.end();
162         var framingMode = frameDefinition.mode();
163         DataType offsetType = frameBoundEnd.value().valueType();
164         Object offsetValue = evaluateWithoutParams(txnCtx, nodeCtx, frameBoundEnd.value());
165         Object[] endProbeValues = new Object[numCellsInSourceRow];
166         BiFunction&lt;Object[], Object[], Object[]&gt; updateProbeValues;
167         if (offsetValue != null &amp;&amp; framingMode == WindowFrame.Mode.RANGE) {
168             updateProbeValues = createUpdateProbeValueFunction(
169                 windowDefinition, ArithmeticOperatorsFactory::getAddFunction, offsetValue, offsetType);
170         } else {
171             updateProbeValues = (currentRow, x) -&gt; x;
172         }
173         return (partitionStart, partitionEnd, currentIndex, sortedRows) -&gt; frameBoundEnd.type().getEnd(
174             framingMode,
175             partitionStart,
176             partitionEnd,
177             currentIndex,
178             offsetValue,
179             updateProbeValues.apply(sortedRows.get(currentIndex), endProbeValues),
180             cmpOrderBy,
181             sortedRows
182         );
183     }
184     static ComputeFrameBoundary&lt;Object[]&gt; createComputeStartFrameBoundary(int numCellsInSourceRow,
185                                                                           TransactionContext txnCtx,
186                                                                           NodeContext nodeCtx,
187                                                                           WindowDefinition windowDefinition,
188                                                                           @Nullable Comparator&lt;Object[]&gt; cmpOrderBy) {
189         var frameDefinition = windowDefinition.windowFrameDefinition();
190         var frameBoundStart = frameDefinition.start();
191         var framingMode = frameDefinition.mode();
192         DataType offsetType = frameBoundStart.value().valueType();
193         Object offsetValue = evaluateWithoutParams(txnCtx, nodeCtx, frameBoundStart.value());
194         Object[] startProbeValues = new Object[numCellsInSourceRow];
195         BiFunction&lt;Object[], Object[], Object[]&gt; updateStartProbeValue;
196         if (offsetValue != null &amp;&amp; framingMode == WindowFrame.Mode.RANGE) {
197             updateStartProbeValue = createUpdateProbeValueFunction(
198                 windowDefinition, ArithmeticOperatorsFactory::getSubtractFunction, offsetValue, offsetType);
199         } else {
200             updateStartProbeValue = (currentRow, x) -&gt; x;
201         }
202         return (partitionStart, partitionEnd, currentIndex, sortedRows) -&gt; frameBoundStart.type().getStart(
203             framingMode,
204             partitionStart,
205             partitionEnd,
206             currentIndex,
207             offsetValue,
208             updateStartProbeValue.apply(sortedRows.get(currentIndex), startProbeValues),
209             cmpOrderBy,
210             sortedRows
211         );
212     }
213     private static BiFunction&lt;Object[], Object[], Object[]&gt; createUpdateProbeValueFunction(WindowDefinition windowDefinition,
214                                                                                            BiFunction&lt;DataType&lt;?&gt;, DataType&lt;?&gt;, BiFunction&gt; getOffsetApplicationFunction,
215                                                                                            Object offsetValue,
216                                                                                            DataType&lt;?&gt; offsetType) {
217         OrderBy windowOrdering = windowDefinition.orderBy();
218         assert windowOrdering != null : "The window definition must be ordered if custom offsets are specified";
219         List&lt;Symbol&gt; orderBySymbols = windowOrdering.orderBySymbols();
220         if (orderBySymbols.size() != 1) {
221             throw new IllegalArgumentException("Must have exactly 1 ORDER BY expression if using &lt;offset&gt; FOLLOWING/PRECEDING");
222         }
223         int offsetColumnPosition;
224         Symbol orderSymbol = orderBySymbols.get(0);
225         BiFunction applyOffsetOnOrderingValue = getOffsetApplicationFunction.apply(orderSymbol.valueType(), offsetType);
226         if (orderSymbol.symbolType() == SymbolType.LITERAL) {
227             offsetColumnPosition = -1;
228         } else {
229             assert orderSymbol instanceof InputColumn
230                 : "ORDER BY expression must resolve to an InputColumn, but got: " + orderSymbol;
231             offsetColumnPosition = ((InputColumn) orderSymbol).index();
232         }
233         var finalOffsetValue =
234             offsetType.id() == IntervalType.ID ? offsetType.sanitizeValue(offsetValue) : orderSymbol.valueType().sanitizeValue(offsetValue);
235         return (currentRow, x) -&gt; {
236             if (offsetColumnPosition != -1) {
237                 x[offsetColumnPosition] = applyOffsetOnOrderingValue.apply(currentRow[offsetColumnPosition], finalOffsetValue);
238             }
239             return x;
240         };
241     }
242 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
