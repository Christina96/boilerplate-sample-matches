<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for WherePKIntegrationTest.java &amp; PostgresWireProtocolTest.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for WherePKIntegrationTest.java &amp; PostgresWireProtocolTest.java
      </h3>
<h1 align="center">
        33.3%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>WherePKIntegrationTest.java (52.27818%)<th>PostgresWireProtocolTest.java (24.521935%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(144-161)<td><a href="#" name="0">(253-262)</a><td align="center"><font color="#ff0000">27</font>
<tr onclick='openModal("#f63526")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#f63526"><font color="#f63526">-</font><td><a href="#" name="1">(238-249)<td><a href="#" name="1">(370-379)</a><td align="center"><font color="#f50000">26</font>
<tr onclick='openModal("#980517")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#980517"><font color="#980517">-</font><td><a href="#" name="2">(269-284)<td><a href="#" name="2">(321-327)</a><td align="center"><font color="#ec0000">25</font>
<tr onclick='openModal("#53858b")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#53858b"><font color="#53858b">-</font><td><a href="#" name="3">(119-134)<td><a href="#" name="3">(516-529)</a><td align="center"><font color="#b30000">19</font>
<tr onclick='openModal("#6cc417")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#6cc417"><font color="#6cc417">-</font><td><a href="#" name="4">(302-315)<td><a href="#" name="4">(535-544)</a><td align="center"><font color="#8d0000">15</font>
<tr onclick='openModal("#151b8d")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#151b8d"><font color="#151b8d">-</font><td><a href="#" name="5">(166-176)<td><a href="#" name="5">(226-241)</a><td align="center"><font color="#8d0000">15</font>
<tr onclick='openModal("#8c8774")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#8c8774"><font color="#8c8774">-</font><td><a href="#" name="6">(72-78)<td><a href="#" name="6">(305-309)</a><td align="center"><font color="#8d0000">15</font>
<tr onclick='openModal("#38a4a5")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#38a4a5"><font color="#38a4a5">-</font><td><a href="#" name="7">(213-227)<td><a href="#" name="7">(315-319)</a><td align="center"><font color="#7a0000">13</font>
<tr onclick='openModal("#c58917")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#c58917"><font color="#c58917">-</font><td><a href="#" name="8">(93-98)<td><a href="#" name="8">(553-556)</a><td align="center"><font color="#710000">12</font>
<tr onclick='openModal("#83a33a")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#83a33a"><font color="#83a33a">-</font><td><a href="#" name="9">(112-118)<td><a href="#" name="9">(180-189)</a><td align="center"><font color="#670000">11</font>
<tr onclick='openModal("#ad5910")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#ad5910"><font color="#ad5910">-</font><td><a href="#" name="10">(53-57)<td><a href="#" name="10">(262-265)</a><td align="center"><font color="#670000">11</font>
<tr onclick='openModal("#b041ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#b041ff"><font color="#b041ff">-</font><td><a href="#" name="11">(193-198)<td><a href="#" name="11">(415-420)</a><td align="center"><font color="#5e0000">10</font>
<tr onclick='openModal("#571b7e")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#571b7e"><font color="#571b7e">-</font><td><a href="#" name="12">(22-34)<td><a href="#" name="12">(22-32)</a><td align="center"><font color="#5e0000">10</font>
<tr onclick='openModal("#3b9c9c")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#3b9c9c"><font color="#3b9c9c">-</font><td><a href="#" name="13">(136-141)<td><a href="#" name="13">(379-382)</a><td align="center"><font color="#550000">9</font>
</td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>WherePKIntegrationTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 /*
2  * Licensed to Crate.io GmbH ("Crate") under one or more contributor
3  * license agreements.  See the NOTICE file distributed with this work for
4  * additional information regarding copyright ownership.  Crate licenses
5  * this file to you under the Apache License, Version 2.0 (the "License");
6  * you may not use this file except in compliance with the License.  You may
7  * obtain a copy of the License at
8  *
9  *   http://www.apache.org/licenses/LICENSE-2.0
10  *
11  * Unless required by applicable law or agreed to in writing, software
12  * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
13  * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
14  * License for the specific language governing permissions and limitations
15  * under the License.
16  *
17  * However, if you have executed another commercial license agreement
18  * with Crate these terms will supersede the license and you may use the
19 <a name="12"></a> * software solely pursuant to the terms of the relevant commercial agreement.
20  */
21 <font color="#571b7e"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>package io.crate.integrationtests;
22 import io.crate.testing.TestingHelpers;
23 import io.crate.common.collections.MapBuilder;
24 import org.hamcrest.Matchers;
25 import org.junit.Test;
26 import org.locationtech.spatial4j.shape.Point;
27 import java.util.Arrays;
28 import java.util.List;
29 import static org.hamcrest.Matchers.arrayContaining;
30 import</b></font> static org.hamcrest.core.Is.is;
31 public class WherePKIntegrationTest extends SQLIntegrationTestCase {
32     @Test
33     public void testWherePkColInWithLimit() throws Exception {
34         execute("create table users (" +
35                 "   id int primary key," +
36                 "   name string" +
37                 ") clustered into 2 shards with (number_of_replicas = 0)");
38         ensureYellow();
39         execute("insert into users (id, name) values (?, ?)", new Object[][]{
40             new Object[]{1, "Arthur"},
41             new Object[]{2, "Trillian"},
42             new Object[]{3, "Marvin"},
43             new Object[]{4, "Slartibartfast"},
44 <a name="10"></a>        });
45         execute("refresh table users");
46         <font color="#ad5910"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("select name from users where id in (1, 3, 4) order by name desc limit 2");
47         assertThat(response.rowCount(), is(2L));
48         assertThat((String) response.rows()[0][0], is("Slartibartfast"));
49         assertThat((String) response.rows()[1][0], is("Marvin"));
50     }</b></font>
51     @Test
52     public void testWherePKWithFunctionInOutputsAndOrderBy() throws Exception {
53         execute("create table users (" +
54                 "   id int primary key," +
55                 "   name string" +
56                 ") clustered into 2 shards with (number_of_replicas = 0)");
57         ensureYellow();
58         execute("insert into users (id, name) values (?, ?)", new Object[][]{
59             new Object[]{1, "Arthur"},
60             new Object[]{2, "Trillian"},
61 <a name="6"></a>            new Object[]{3, "Marvin"},
62             new Object[]{4, "Slartibartfast"},
63         });
64         <font color="#8c8774"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("refresh table users");
65         execute("select substr(name, 1, 1) from users where id in (1, 2, 3) order by substr(name, 1, 1) desc");
66         assertThat(response.rowCount(), is(3L));
67         assertThat((String) response.rows()[0][0], is("T"));
68         assertThat((String) response.rows()[1][0], is("M"));
69         assertThat((String) response.rows()[2][0], is("A"));
70     }</b></font>
71     @Test
72     public void testWherePKWithOrderBySymbolThatIsMissingInSelectList() throws Exception {
73         execute("create table users (" +
74                 "   id int primary key," +
75                 "   name string" +
76                 ") clustered into 2 shards with (number_of_replicas = 0)");
77         ensureYellow();
78         execute("insert into users (id, name) values (?, ?)", new Object[][]{
79             new Object[]{1, "Arthur"},
80             new Object[]{2, "Trillian"},
81 <a name="8"></a>            new Object[]{3, "Marvin"},
82             new Object[]{4, "Slartibartfast"},
83         });
84         <font color="#c58917"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("refresh table users");
85         execute("select name from users where id in (1, 2, 3) order by id desc");
86         assertThat(response.rowCount(), is(3L));
87         assertThat((String) response.rows()[0][0], is("Marvin"));
88         assertThat((String) response.rows()[1][0], is("Trillian"));
89         assertThat</b></font>((String) response.rows()[2][0], is("Arthur"));
90     }
91     @Test
92     public void testWherePKWithOrderBySymbolThatIsAlsoInSelectList() throws Exception {
93         execute("create table users (" +
94                 "   id int primary key," +
95                 "   name string" +
96                 ") clustered into 2 shards with (number_of_replicas = 0)");
97         ensureYellow();
98         execute("insert into users (id, name) values (?, ?)", new Object[][]{
99 <a name="9"></a>            new Object[]{1, "Arthur"},
100             new Object[]{2, "Trillian"},
101             });
102         <font color="#83a33a"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("refresh table users");
103         execute("select name from users where id = 1 order by name desc");
104         assertThat(TestingHelpers.printedTable(response.rows()), is("Arthur\n"));
105     }
106 <a name="3"></a>
107     @Test
108     public void testWherePkColLimit0() throws Exception {</b></font>
109         <font color="#53858b"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("create table users (id int primary key, name string) " +
110                 "clustered into 1 shards with (number_of_replicas = 0)");
111         ensureYellow();
112         execute("insert into users (id, name) values (1, 'Arthur')");
113         execute("refresh table users");
114         execute("select name from users where id = 1 limit 0");
115         assertThat(response.rowCount(), is(0L));
116     }
117     @Test
118     public void testWherePkIsNull() throws Exception {
119         execute("create table t (s string primary key) with (number_of_replicas = 0)");
120         ensureYellow();
121 <a name="13"></a>        execute("select * from t where s in (null)");
122         assertThat(response.rowCount(), is</b></font>(0L));
123         <font color="#3b9c9c"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("select * from t where s in ('foo', null, 'bar')");
124         assertThat(response.rowCount(), is(0L));
125         execute("select * from t where s is null");
126         assertThat(response.rowCount(), is(0L));
127 <a name="0"></a>    }</b></font>
128     @Test
129     public void testWhereComplexPkIsNull() throws Exception <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>{
130         execute("create table t (i integer, s string, primary key (i, s)) with (number_of_replicas = 0)");
131         ensureYellow();
132         execute("select * from t where s in (null)");
133         assertThat(response.rowCount(), is(0L));
134         execute("select * from t where i in (null)");
135         assertThat(response.rowCount(), is(0L));
136         execute("select * from t where s in ('foo', null, 'bar')");
137         assertThat(response.rowCount(), is(0L));
138         execute("select * from t where i in (1, null, 2)");
139         assertThat(response.rowCount(), is(0L));
140         execute("select * from t where s is null");
141         assertThat(response.rowCount(), is(0L));
142         execute("select * from t where i is null");
143         assertThat(response.rowCount(), is</b></font>(0L));
144     }
145 <a name="5"></a>
146     @Test
147     public void testSelectNestedObjectWherePk() throws Exception {
148         <font color="#151b8d"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("create table items (id string primary key, details object as (tags array(string)) )" +
149                 "clustered into 3 shards with (number_of_replicas = '0-1')");
150         execute("insert into items (id, details) values (?, ?)", new Object[]{
151             "123", MapBuilder.newMapBuilder().put("tags", Arrays.asList("small", "blue")).map()
152         });
153         execute("refresh table items");
154         execute("select id, details['tags'] from items where id = '123'");
155         assertThat(response.rowCount(), is(1L));
156         assertThat</b></font>(response.rows()[0][0], is("123"));
157         //noinspection unchecked
158         List&lt;Object&gt; tags = (List&lt;Object&gt;) response.rows()[0][1];
159         assertThat(tags, Matchers.contains("small", "blue"));
160     }
161     @Test
162     public void testSelectByIdWithCustomRoutingUsesSearch() throws Exception {
163         execute("create table users (name string)" +
164                 "clustered by (name) with (number_of_replicas = '0')");
165         execute("insert into users values ('hoschi'), ('galoschi'), ('x')");
166         execute("refresh table users");
167 <a name="11"></a>        execute("select _id from users");
168         for (Object[] row : response.rows()) {
169             execute("select name from users where _id=?", row);
170             <font color="#b041ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>assertThat(response.rowCount(), is(1L));
171         }
172     }
173     @Test
174     public void testSelectByIdWithPartitionsUsesSearch() throws Exception {</b></font>
175         execute("create table users (name string)" +
176                 "  with (number_of_replicas = '0')");
177         execute("insert into users values ('hoschi'), ('galoschi'), ('x')");
178         execute("refresh table users");
179         execute("select _id from users");
180         for (Object[] row : response.rows()) {
181             execute("select name from users where _id=?", row);
182             assertThat(response.rowCount(), is(1L));
183         }
184 <a name="7"></a>    }
185     @Test
186     public void testEmptyClusteredByUnderId() throws Exception <font color="#38a4a5"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>{
187         execute("create table auto_id (" +
188                 "  location geo_point, " +
189                 "  name string" +
190                 ") with (number_of_replicas=0)");
191         ensureYellow();
192         execute("insert into auto_id (name, location) values (',', [36.567, 52.998]), ('Dornbirn', [54.45, 4.567])");
193         execute("refresh table auto_id");
194         execute("select * from auto_id where _id=''");
195         assertThat(response.cols(), is(arrayContaining("location", "name")));
196         assertThat(response.rowCount(), is</b></font>(0L));
197     }
198     @Test
199     public void testEmptyClusteredByExplicit() throws Exception {
200         execute("create table explicit_routing (" +
201                 "  location geo_point, " +
202 <a name="1"></a>                "  name string " +
203                 ") clustered by (name) with (number_of_replicas=0)");
204         ensureYellow();
205         <font color="#f63526"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("insert into explicit_routing (name, location) values (',', [36.567, 52.998]), ('Dornbirn', [54.45, 4.567])");
206         execute("refresh table explicit_routing");
207         execute("select * from explicit_routing where name=''");
208         assertThat(response.cols(), is(arrayContaining("location", "name")));
209         assertThat(response.rowCount(), is(0L));
210         execute("select * from explicit_routing where name=','");
211         assertThat(response.cols(), is(arrayContaining("location", "name")));
212         assertThat(response.rowCount(), is(1L));
213         Point point = (Point) response.rows()[0][0];
214         assertThat(point.getX(), Matchers.closeTo(36.567d, 0.01));
215         assertThat(point.getY(), Matchers.closeTo</b></font>(52.998d, 0.01));
216     }
217     @Test
218     public void testQueryOnEmptyClusteredByColumn() throws Exception {
219         execute("create table expl_routing (id int primary key, name string primary key) " +
220                 "clustered by (name) with (number_of_replicas = 0)");
221         ensureYellow();
222         if (randomInt(1) == 0) {
223             execute("insert into expl_routing (id, name) values (?, ?)", new Object[][]{
224                 new Object[]{1, ""},
225                 new Object[]{2, ""},
226                 new Object[]{1, "1"}
227             });
228         } else {
229             execute("insert into expl_routing (id, name) values (?, ?)", new Object[]{1, ""});
230 <a name="2"></a>            execute("insert into expl_routing (id, name) values (?, ?)", new Object[]{2, ""});
231             execute("insert into expl_routing (id, name) values (?, ?)", new Object[]{1, "1"});
232         }
233         <font color="#980517"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>execute("refresh table expl_routing");
234         execute("select count(*) from expl_routing where name = ''");
235         assertThat((Long) response.rows()[0][0], is(2L));
236         execute("select * from expl_routing where name = '' order by id");
237         assertThat(response.rowCount(), is(2L));
238         assertThat((Integer) response.rows()[0][0], is(1));
239         assertThat((Integer) response.rows()[1][0], is(2));
240         execute("delete from expl_routing where name = ''");
241         assertThat(response.rowCount(), is(2L));
242         refresh();
243         execute("select count(*) from expl_routing");
244         assertThat((Long) response.rows()[0][0], is(1L));
245     }</b></font>
246     @Test
247     public void testDeleteByQueryCommaRouting() throws Exception {
248         execute("create table explicit_routing (" +
249                 "  name string," +
250                 "  location geo_point" +
251                 ") clustered by (name) into 3 shards with (number_of_replicas=0)");
252         ensureYellow();
253         execute("insert into explicit_routing (name, location) values ('A', [36.567, 52.998]), ('W', [54.45, 4.567])");
254         execute("refresh table explicit_routing");
255 <a name="4"></a>
256         execute("delete from explicit_routing where name='A,W'");
257         assertThat(response.rowCount(), <font color="#6cc417"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>is(0L));
258         execute("refresh table explicit_routing");
259         execute("select * from explicit_routing");
260         assertThat(response.rowCount(), is(2L));
261     }
262     @Test
263     public void test_select_where_pk_and_additional_filter() {
264         execute("create table t1 (id int primary key, x int) with (refresh_interval=0)");
265         execute("insert into t1 (id, x) values (1, 1)");
266         execute("select id from t1 where id = 1 and x = 2");
267         assertThat</b></font>(response.rowCount(), is(0L));
268         execute("select id from t1 where id = 1 and x = 1");
269         assertThat(response.rowCount(), is(1L));
270     }
271 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>PostgresWireProtocolTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 /*
2  * Licensed to Crate.io GmbH ("Crate") under one or more contributor
3  * license agreements.  See the NOTICE file distributed with this work for
4  * additional information regarding copyright ownership.  Crate licenses
5  * this file to you under the Apache License, Version 2.0 (the "License");
6  * you may not use this file except in compliance with the License.  You may
7  * obtain a copy of the License at
8  *
9  *   http://www.apache.org/licenses/LICENSE-2.0
10  *
11  * Unless required by applicable law or agreed to in writing, software
12  * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
13  * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
14  * License for the specific language governing permissions and limitations
15  * under the License.
16  *
17  * However, if you have executed another commercial license agreement
18  * with Crate these terms will supersede the license and you may use the
19 <a name="12"></a> * software solely pursuant to the terms of the relevant commercial agreement.
20  */
21 <font color="#571b7e"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>package io.crate.protocols.postgres;
22 import io.crate.action.sql.DescribeResult;
23 import io.crate.action.sql.SQLOperations;
24 import io.crate.action.sql.Session;
25 import io.crate.action.sql.SessionContext;
26 import io.crate.auth.Authentication;
27 import io.crate.auth.AuthenticationMethod;
28 import io.crate.auth.AccessControl;
29 import io.crate.auth.AlwaysOKAuthentication;
30 import</b></font> io.crate.user.User;
31 import io.crate.user.UserManager;
32 import io.crate.exceptions.JobKilledException;
33 import io.crate.execution.engine.collect.stats.JobsLogs;
34 import io.crate.planner.DependencyCarrier;
35 import io.crate.protocols.postgres.types.PGTypes;
36 import io.crate.test.integration.CrateDummyClusterServiceUnitTest;
37 import io.crate.testing.SQLExecutor;
38 import io.crate.types.DataTypes;
39 import io.crate.user.StubUserManager;
40 import io.netty.buffer.ByteBuf;
41 import io.netty.buffer.Unpooled;
42 import io.netty.channel.Channel;
43 import io.netty.channel.ChannelHandler;
44 import io.netty.channel.embedded.EmbeddedChannel;
45 import org.elasticsearch.Version;
46 import org.elasticsearch.common.inject.Provider;
47 import org.elasticsearch.common.settings.SecureString;
48 import org.elasticsearch.common.settings.Settings;
49 import org.junit.After;
50 import org.junit.Before;
51 import org.junit.Test;
52 import org.mockito.Mockito;
53 import javax.annotation.Nullable;
54 import java.nio.charset.StandardCharsets;
55 import java.util.ArrayList;
56 import java.util.Arrays;
57 import java.util.Collections;
58 import java.util.List;
59 import java.util.Map;
60 import java.util.concurrent.CompletableFuture;
61 import java.util.concurrent.TimeUnit;
62 import java.util.concurrent.atomic.AtomicBoolean;
63 import static org.hamcrest.Matchers.is;
64 import static org.hamcrest.Matchers.isOneOf;
65 import static org.mockito.ArgumentMatchers.anyChar;
66 import static org.mockito.ArgumentMatchers.anyString;
67 import static org.mockito.Mockito.any;
68 import static org.mockito.Mockito.mock;
69 import static org.mockito.Mockito.times;
70 import static org.mockito.Mockito.verify;
71 import static org.mockito.Mockito.when;
72 public class PostgresWireProtocolTest extends CrateDummyClusterServiceUnitTest {
73     private static final Provider&lt;UserManager&gt; USER_MANAGER_PROVIDER = StubUserManager::new;
74     private SQLOperations sqlOperations;
75     private List&lt;Session&gt; sessions = new ArrayList&lt;&gt;();
76     private EmbeddedChannel channel;
77     @Before
78     public void prepare() throws Exception {
79         SQLExecutor e = SQLExecutor.builder(clusterService)
80             .addTable("create table users (name text not null)")
81             .build();
82         sqlOperations = new SQLOperations(
83             e.nodeCtx,
84             e.analyzer,
85             e.planner,
86             () -&gt; mock(DependencyCarrier.class),
87             new JobsLogs(() -&gt; true),
88             Settings.EMPTY,
89             clusterService,
90             USER_MANAGER_PROVIDER
91         ) {
92             @Override
93             public Session createSession(@Nullable String defaultSchema, @Nullable User user) {
94                 Session session = super.createSession(defaultSchema, user);
95                 sessions.add(session);
96                 return session;
97             }
98         };
99     }
100     @After
101     public void dispose() throws Exception {
102         if (channel != null) {
103             channel.finishAndReleaseAll();
104             channel.close().awaitUninterruptibly().get(5, TimeUnit.SECONDS);
105             channel = null;
106         }
107     }
108     @Test
109     public void testHandleEmptySimpleQuery() throws Exception {
110         PostgresWireProtocol ctx =
111             new PostgresWireProtocol(
112                 mock(SQLOperations.class),
113                 sessionContext -&gt; AccessControl.DISABLED,
114                 new AlwaysOKAuthentication(userName -&gt; null),
115                 null);
116         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
117         ByteBuf buffer = Unpooled.buffer();
118         try {
119             Messages.writeCString(buffer, ";".getBytes(StandardCharsets.UTF_8));
120             ctx.handleSimpleQuery(buffer, new DelayableWriteChannel(channel));
121         } finally {
122             buffer.release();
123         }
124         ByteBuf firstResponse = channel.readOutbound();
125         byte[] responseBytes = new byte[5];
126         try {
127             firstResponse.readBytes(responseBytes);
128             assertThat(responseBytes, is(new byte[]{'I', 0, 0, 0, 4}));
129         } finally {
130             firstResponse.release();
131         }
132         ByteBuf secondResponse = channel.readOutbound();
133         try {
134             responseBytes = new byte[6];
135             secondResponse.readBytes(responseBytes);
136             assertThat(responseBytes, is(new byte[]{'Z', 0, 0, 0, 5, 'I'}));
137         } finally {
138             secondResponse.release();
139         }
140     }
141     @Test
142     public void test_channel_is_flushed_after_receiving_flush_request() throws Exception {
143         SQLOperations sqlOperations = mock(SQLOperations.class);
144         Session session = mock(Session.class);
145         when(sqlOperations.createSession(any(String.class), any(User.class))).thenReturn(session);
146         PostgresWireProtocol ctx =
147             new PostgresWireProtocol(
148                 sqlOperations,
149                 sessionContext -&gt; AccessControl.DISABLED,
150                 new AlwaysOKAuthentication(userName -&gt; User.CRATE_USER),
151                 null);
152         AtomicBoolean flushed = new AtomicBoolean(false);
153         channel = new EmbeddedChannel(ctx.decoder, ctx.handler) {
154             @Override
155             public Channel flush() {
156                 flushed.set(true);
157                 return super.flush();
158             }
159         };
160 <a name="9"></a>        ByteBuf buffer = Unpooled.buffer();
161         ClientMessages.sendStartupMessage(buffer, "doc");
162         ClientMessages.sendParseMessage(buffer, "", "select ?", new int[0]);
163         <font color="#83a33a"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ClientMessages.sendFlush(buffer);
164         channel.writeInbound(buffer);
165         channel.releaseInbound();
166         assertThat(flushed.get(), is(true));
167     }
168     @Test
169     public void testBindMessageCanBeReadIfTypeForParamsIsUnknown() throws Exception {</b></font>
170         PostgresWireProtocol ctx =
171             new PostgresWireProtocol(
172                 sqlOperations,
173                 sessionContext -&gt; AccessControl.DISABLED,
174                 new AlwaysOKAuthentication(userName -&gt; User.CRATE_USER),
175                 null);
176         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
177         ByteBuf buffer = Unpooled.buffer();
178         ClientMessages.sendStartupMessage(buffer, "doc");
179         ClientMessages.sendParseMessage(buffer, "S1", "select ?, ?", new int[0]); 
180         List&lt;Object&gt; params = Arrays.asList(10, 20);
181         ClientMessages.sendBindMessage(buffer, "P1", "S1", params);
182         channel.writeInbound(buffer);
183         channel.releaseInbound();
184         Session session = sessions.get(0);
185         assertThat(session.getQuery("P1"), is("select ?, ?"));
186     }
187     @Test
188     public void testDescribePortalMessage() throws Exception {
189         PostgresWireProtocol ctx =
190             new PostgresWireProtocol(
191                 sqlOperations,
192                 sessionContext -&gt; AccessControl.DISABLED,
193                 new AlwaysOKAuthentication(userName -&gt; User.CRATE_USER),
194                 null);
195         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
196 <a name="5"></a>        {
197             ByteBuf buffer = Unpooled.buffer();
198             <font color="#151b8d"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>ClientMessages.sendStartupMessage(buffer, "doc");
199             ClientMessages.sendParseMessage(buffer,
200                 "S1",
201                 "select ? in (1, 2, 3)",
202                 new int[] { PGTypes.get(DataTypes.INTEGER).oid() });
203                 ClientMessages.sendBindMessage(buffer,
204                     "P1",
205                     "S1",
206                     Collections.singletonList(1));
207             channel.writeInbound(buffer);
208             channel.releaseInbound();
209             channel.flushOutbound();
210             channel.releaseOutbound();
211             channel.outboundMessages</b></font>().clear();
212         }
213         {
214             ByteBuf buffer = Unpooled.buffer();
215             ClientMessages.sendDescribeMessage(buffer, ClientMessages.DescribeType.PORTAL, "P1");
216             channel.writeInbound(buffer);
217             channel.releaseInbound();
218 <a name="0"></a>                        channel.flushOutbound();
219             ByteBuf response = channel.readOutbound();
220             try <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>{
221                 assertThat(response.readByte(), is((byte) 'T'));
222                 assertThat(response.readInt(), is(46));
223                 assertThat(response.readShort(), is((short) 1));
224                 assertThat(PostgresWireProtocol.readCString(response), is("($1 = ANY([1, 2, 3]))"));
225 <a name="10"></a>                assertThat(response.readInt(), is(0));
226                 assertThat(response.readShort(), is((short) 0));
227                 assertThat(response.readInt(), is(PGTypes.get(DataTypes.BOOLEAN).oid()));
228                 assertThat(response.readShort(), is</b></font>(<font color="#ad5910"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>PGTypes.get(DataTypes.BOOLEAN).typeLen()));
229                 assertThat(response.readInt(), is(PGTypes.get(DataTypes.LONG).typeMod()));
230                 assertThat(response.readShort(), is((short) 0));
231             }</b></font> finally {
232                 response.release();
233             }
234         }
235     }
236     @Test
237     public void testDescribeStatementMessage() throws Exception {
238         PostgresWireProtocol ctx =
239             new PostgresWireProtocol(
240                 sqlOperations,
241                 sessionContext -&gt; AccessControl.DISABLED,
242                 new AlwaysOKAuthentication(userName -&gt; User.CRATE_USER),
243                 null);
244         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
245         {
246             ByteBuf buffer = Unpooled.buffer();
247             ClientMessages.sendStartupMessage(buffer, "doc");
248             ClientMessages.sendParseMessage(buffer, "S1", "select ? in (1, 2, 3)", new int[0]);
249             channel.writeInbound(buffer);
250             channel.releaseInbound();
251             channel.flushOutbound();
252             channel.releaseOutbound();
253             channel.outboundMessages().clear();
254         }
255         {
256             ByteBuf buffer = Unpooled.buffer();
257             ClientMessages.sendDescribeMessage(buffer, ClientMessages.DescribeType.STATEMENT, "S1");
258             channel.writeInbound(buffer);
259             channel.releaseInbound();
260 <a name="6"></a>            channel.flushOutbound();
261             ByteBuf response = channel.readOutbound();
262             try {
263                 <font color="#8c8774"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assertThat(response.readByte(), is((byte) 't'));
264                 assertThat(response.readInt(), is(10));
265                 assertThat(response.readShort(), is((short) 1));
266                 assertThat(response.readInt(), is(PGTypes.get(DataTypes.INTEGER).oid()));
267             }</b></font> finally {
268                 response.release();
269             }
270 <a name="7"></a>
271             response = channel.readOutbound();
272             try <font color="#38a4a5"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>{
273                 assertThat(response.readByte(), is((byte) 'T'));
274                 assertThat(response.readInt(), is(46));
275 <a name="2"></a>                assertThat(response.readShort(), is((short) 1));
276                 assertThat(PostgresWireProtocol.readCString(response), is</b></font>("($1 = ANY([1, 2, 3]))"));
277                 <font color="#980517"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assertThat(response.readInt(), is(0));
278                 assertThat(response.readShort(), is((short) 0));
279                 assertThat(response.readInt(), is(PGTypes.get(DataTypes.BOOLEAN).oid()));
280                 assertThat(response.readShort(), is(PGTypes.get(DataTypes.BOOLEAN).typeLen()));
281                 assertThat(response.readInt(), is(PGTypes.get(DataTypes.LONG).typeMod()));
282                 assertThat(response.readShort(), is((short) 0));
283             }</b></font> finally {
284                 response.release();
285             }
286         }
287     }
288     @Test
289     public void test_row_description_for_statement_on_single_table_includes_table_oid() throws Exception {
290         PostgresWireProtocol ctx =
291             new PostgresWireProtocol(
292                 sqlOperations,
293                 sessionContext -&gt; AccessControl.DISABLED,
294                 new AlwaysOKAuthentication(userName -&gt; User.CRATE_USER),
295                 null);
296         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
297         {
298             ByteBuf buffer = Unpooled.buffer();
299             ClientMessages.sendStartupMessage(buffer, "doc");
300             ClientMessages.sendParseMessage(buffer, "S1", "SELECT name FROM users", new int[0]);
301             channel.writeInbound(buffer);
302             channel.releaseInbound();
303             channel.flushOutbound();
304             channel.releaseOutbound();
305             channel.outboundMessages().clear();
306         }
307         {
308             ByteBuf buffer = Unpooled.buffer();
309             ClientMessages.sendDescribeMessage(buffer, ClientMessages.DescribeType.STATEMENT, "S1");
310             channel.writeInbound(buffer);
311             channel.releaseInbound();
312             channel.flushOutbound();
313             ByteBuf response = channel.readOutbound();
314             response.release();
315 <a name="1"></a>                        response = channel.readOutbound();
316             try {
317                 <font color="#f63526"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assertThat(response.readByte(), is((byte) 'T'));
318                 assertThat(response.readInt(), is(29));
319                 assertThat(response.readShort(), is((short) 1));
320                 assertThat(PostgresWireProtocol.readCString(response), is("name"));
321                 assertThat("table_oid", response.readInt(), is(893280107));
322 <a name="13"></a>                assertThat("attr_num", response.readShort(), is((short) 1));
323                 var pgType = PGTypes.get(DataTypes.STRING);
324                 assertThat(response.readInt(), is(pgType.oid()));
325                 assertThat(response.readShort</b></font>(), is(<font color="#3b9c9c"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>pgType.typeLen()));
326                 assertThat(response.readInt(), is(pgType.typeMod()));
327                 assertThat("format_code", response.readShort(), is((short) 0));
328             }</b></font> finally {
329                 response.release();
330             }
331         }
332     }
333     @Test
334     public void testSslRejection() {
335         PostgresWireProtocol ctx =
336             new PostgresWireProtocol(
337                 mock(SQLOperations.class),
338                 sessionContext -&gt; AccessControl.DISABLED,
339                 new AlwaysOKAuthentication(userName -&gt; null),
340                 null);
341         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
342         ByteBuf buffer = Unpooled.buffer();
343         ClientMessages.sendSslReqMessage(buffer);
344         channel.writeInbound(buffer);
345         ByteBuf responseBuffer = channel.readOutbound();
346         try {
347             byte response = responseBuffer.readByte();
348             assertEquals(response, 'N');
349         } finally {
350             responseBuffer.release();
351         }
352 <a name="11"></a>
353         for (Map.Entry&lt;String, ChannelHandler&gt; entry : channel.pipeline()) {
354             <font color="#b041ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>assertThat(entry.getValue(), isOneOf(ctx.decoder, ctx.handler));
355         }
356     }
357     @Test
358     public void testCrateServerVersionIsReceivedOnStartup() throws Exception {</b></font>
359         PostgresWireProtocol ctx = new PostgresWireProtocol(
360             sqlOperations, sessionContext -&gt; AccessControl.DISABLED, new AlwaysOKAuthentication(userName -&gt; User.CRATE_USER), null);
361         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
362         ByteBuf buf = Unpooled.buffer();
363         ClientMessages.sendStartupMessage(buf, "doc");
364         channel.writeInbound(buf);
365         channel.releaseInbound();
366         ByteBuf respBuf;
367         respBuf = channel.readOutbound();
368         try {
369             assertThat((char) respBuf.readByte(), is('R'));         } finally {
370             respBuf.release();
371         }
372         respBuf = channel.readOutbound();
373         try {
374             assertThat((char) respBuf.readByte(), is('S'));             respBuf.readInt();             String key = PostgresWireProtocol.readCString(respBuf);
375             String value = PostgresWireProtocol.readCString(respBuf);
376             assertThat(key, is("crate_version"));
377             assertThat(value, is(Version.CURRENT.externalNumber()));
378         } finally {
379             respBuf.release();
380         }
381     }
382     @Test
383     public void testPasswordMessageAuthenticationProcess() throws Exception {
384         PostgresWireProtocol ctx =
385             new PostgresWireProtocol(
386                 mock(SQLOperations.class),
387                 sessionContext -&gt; AccessControl.DISABLED,
388                 new Authentication() {
389                     @Override
390                     public AuthenticationMethod resolveAuthenticationType(String user, ConnectionProperties connectionProperties) {
391                         return new AuthenticationMethod() {
392                             @Nullable
393                             @Override
394                             public User authenticate(String userName, @Nullable SecureString passwd, ConnectionProperties connProperties) {
395                                 return null;
396                             }
397                             @Override
398                             public String name() {
399                                 return "password";
400                             }
401                         };
402                     }
403                 },
404                 null);
405         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
406         ByteBuf respBuf;
407         ByteBuf buffer = Unpooled.buffer();
408         ClientMessages.sendStartupMessage(buffer, "doc");
409         channel.writeInbound(buffer);
410         respBuf = channel.readOutbound();
411         try {
412             assertThat((char) respBuf.readByte(), is('R'));         } finally {
413             respBuf.release();
414         }
415         buffer = Unpooled.buffer();
416         ClientMessages.sendPasswordMessage(buffer, "pw");
417         channel.writeInbound(buffer);
418         respBuf = channel.readOutbound();
419         try {
420             assertThat((char) respBuf.readByte(), is('R'));         } finally {
421             respBuf.release();
422         }
423     }
424     @Test
425     public void testSessionCloseOnTerminationMessage() throws Exception {
426         SQLOperations sqlOperations = mock(SQLOperations.class);
427         Session session = mock(Session.class);
428         when(sqlOperations.createSession(any(String.class), any(User.class))).thenReturn(session);
429         PostgresWireProtocol ctx =
430             new PostgresWireProtocol(
431                 sqlOperations,
432                 sessionContext -&gt; AccessControl.DISABLED,
433                 new AlwaysOKAuthentication(userName -&gt; User.CRATE_USER),
434 <a name="3"></a>                null);
435         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
436         ByteBuf buffer = <font color="#53858b"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>Unpooled.buffer();
437         ClientMessages.sendStartupMessage(buffer, "doc");
438         ClientMessages.sendTermination(buffer);
439         channel.writeInbound(buffer);
440         channel.releaseInbound();
441         verify(session, times(1)).close();
442     }
443     @Test
444     public void testHandleMultipleSimpleQueries() {
445         submitQueriesThroughSimpleQueryMode("select 'first'; select 'second';", null);
446         readReadyForQueryMessage(channel);
447         assertThat(channel.outboundMessages().size() , is</b></font>(0));
448     }
449 <a name="4"></a>    @Test
450     public void testHandleMultipleSimpleQueriesWithQueryFailure() {
451         submitQueriesThroughSimpleQueryMode("select 'first'; select 'second';", new RuntimeException("fail"));
452         <font color="#6cc417"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>readErrorResponse(channel, (byte) 110);
453         readReadyForQueryMessage(channel);
454         assertThat(channel.outboundMessages().size() , is(0));
455     }
456     @Test
457     public void testKillExceptionSendsReadyForQuery() {
458         submitQueriesThroughSimpleQueryMode("select 1;", JobKilledException.of("with fire"));
459         readErrorResponse(channel, (byte) 75);
460         readReadyForQueryMessage</b></font>(channel);
461     }
462     private void submitQueriesThroughSimpleQueryMode(String statements, @Nullable Throwable failure) {
463         SQLOperations sqlOperations = Mockito.mock(SQLOperations.class);
464         Session session = mock(Session.class);
465 <a name="8"></a>        SessionContext sessionContext = new SessionContext(User.CRATE_USER);
466         when(session.sessionContext()).thenReturn(sessionContext);
467         when(sqlOperations.createSession(any(String.class), any(User.class))).thenReturn(session);
468         DescribeResult describeResult = <font color="#c58917"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>mock(DescribeResult.class);
469         when(describeResult.getFields()).thenReturn(null);
470         when(session.describe(anyChar(), anyString())).thenReturn(describeResult);
471         when(session.transactionState</b></font>()).thenReturn(TransactionState.IDLE);
472         PostgresWireProtocol ctx =
473             new PostgresWireProtocol(
474                 sqlOperations,
475                 sessionCtx -&gt; AccessControl.DISABLED,
476                 new AlwaysOKAuthentication(userName -&gt; User.CRATE_USER),
477                 null);
478         channel = new EmbeddedChannel(ctx.decoder, ctx.handler);
479         if (failure != null) {
480             when(session.sync()).thenAnswer(invocationOnMock -&gt; {
481                 Messages.sendErrorResponse(channel, AccessControl.DISABLED, failure);
482                 return CompletableFuture.failedFuture(failure);
483             });
484         } else {
485             when(session.sync()).thenReturn(CompletableFuture.completedFuture(null));
486         }
487         sendStartupMessage(channel);
488         readAuthenticationOK(channel);
489         skipParameterMessages(channel);
490         readReadyForQueryMessage(channel);
491         ByteBuf query = Unpooled.buffer();
492         try {
493             Messages.writeCString(query, statements.getBytes(StandardCharsets.UTF_8));
494             ctx.handleSimpleQuery(query, new DelayableWriteChannel(channel));
495         } finally {
496             query.release();
497         }
498     }
499     private static void sendStartupMessage(EmbeddedChannel channel) {
500         ByteBuf startupMsg = Unpooled.buffer();
501         ClientMessages.sendStartupMessage(startupMsg, "db");
502         channel.writeInbound(startupMsg);
503         channel.releaseInbound();
504     }
505     private static void readAuthenticationOK(EmbeddedChannel channel) {
506         ByteBuf response = channel.readOutbound();
507         byte[] responseBytes = new byte[9];
508         response.readBytes(responseBytes);
509         response.release();
510         assertThat(responseBytes, is(new byte[]{'R', 0, 0, 0, 8, 0, 0, 0, 0}));
511     }
512     private static void skipParameterMessages(EmbeddedChannel channel) {
513         int messagesToSkip = 0;
514         for (Object msg : channel.outboundMessages()) {
515             ByteBuf buf = (ByteBuf) msg;
516             byte messageType = buf.getByte(0);
517             if (messageType != 'S') {
518                 break;
519             }
520             messagesToSkip++;
521         }
522         for (int i = 0; i &lt; messagesToSkip; i++) {
523             ByteBuf resp = channel.readOutbound();
524             resp.release();
525         }
526     }
527     private static void readReadyForQueryMessage(EmbeddedChannel channel) {
528         ByteBuf response = channel.readOutbound();
529         byte[] responseBytes = new byte[6];
530         response.readBytes(responseBytes);
531         response.release();
532         assertThat(responseBytes, is(new byte[]{'Z', 0, 0, 0, 5, 'I'}));
533     }
534     private static void readErrorResponse(EmbeddedChannel channel, byte len) {
535         ByteBuf response = channel.readOutbound();
536         byte[] responseBytes = new byte[5];
537         response.readBytes(responseBytes);
538         response.release();
539         assertThat(responseBytes, is(new byte[]{'E', 0, 0, 0, len}));
540     }
541 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
