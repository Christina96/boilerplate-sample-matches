<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for DataTypeAnalyzer.java & ESFileStore.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for DataTypeAnalyzer.java & ESFileStore.java
      </h3>
      <h1 align="center">
        14.7%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>DataTypeAnalyzer.java (25.609756%)<TH>ESFileStore.java (10.344828%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match1220002-0.html#0',2,'match1220002-1.html#0',3)" NAME="0">(22-36)<TD><A HREF="javascript:ZweiFrames('match1220002-0.html#0',2,'match1220002-1.html#0',3)" NAME="0">(20-40)</A><TD ALIGN=center><FONT COLOR="#ff0000">12</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match1220002-0.html#1',2,'match1220002-1.html#1',3)" NAME="1">(43-48)<TD><A HREF="javascript:ZweiFrames('match1220002-0.html#1',2,'match1220002-1.html#1',3)" NAME="1">(131-136)</A><TD ALIGN=center><FONT COLOR="#bf0000">9</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>DataTypeAnalyzer.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Licensed to Crate.io GmbH (&quot;Crate&quot;) under one or more contributor
 * license agreements.  See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.  Crate licenses
 * this file to you under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.  You may
 * obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations
 * under the License.
 *
 * However, if you have executed another commercial license agreement
 * with Crate these terms will supersede the license and you may use the
<A NAME="0"></A> * software solely pursuant to the terms of the relevant commercial agreement.
 */

<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match1220002-1.html#0',3,'match1220002-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>package io.crate.analyze;

import io.crate.sql.tree.CollectionColumnType;
import io.crate.sql.tree.ColumnDefinition;
import io.crate.sql.tree.ColumnType;
import io.crate.sql.tree.DefaultTraversalVisitor;
import io.crate.sql.tree.ObjectColumnType;
import io.crate.types.ArrayType;
import io.crate.types.DataType;
import io.crate.types.DataTypes;
import io.crate.types.ObjectType;

import java.util.Locale;

publi</B></FONT>c final class DataTypeAnalyzer extends DefaultTraversalVisitor&lt;DataType&lt;?&gt;, Void&gt; {

    private DataTypeAnalyzer() {
    }
<A NAME="1"></A>
    private static final DataTypeAnalyzer INSTANCE = new DataTypeAnalyzer();

    public static DataType&lt;?&gt; convert(<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match1220002-1.html#1',3,'match1220002-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ColumnType&lt;?&gt; columnType) {
        return columnType.accept(INSTANCE, null);
    }

    @Override
    public DataType&lt;?&gt; visitColumnType(ColumnType&lt;?&gt; node</B></FONT>, Void context) {
        String typeName = node.name();
        if (typeName == null) {
            return DataTypes.NOT_SUPPORTED;
        } else {
            return DataTypes.of(typeName.toLowerCase(Locale.ENGLISH), node.parameters());
        }
    }

    @Override
    public DataType&lt;?&gt; visitObjectColumnType(ObjectColumnType&lt;?&gt; node, Void context) {
        ObjectType.Builder builder = ObjectType.builder();
        for (ColumnDefinition&lt;?&gt; columnDefinition : node.nestedColumns()) {
            ColumnType&lt;?&gt; type = columnDefinition.type();
            // can be null for generated columns, as then the type is inferred from the expression.
            builder.setInnerType(
                columnDefinition.ident(),
                type == null ? DataTypes.UNDEFINED : type.accept(this, context)
            );
        }
        return builder.build();
    }

    @Override
    public DataType&lt;?&gt; visitCollectionColumnType(CollectionColumnType&lt;?&gt; node, Void context) {
        DataType&lt;?&gt; innerType = node.innerType().accept(this, context);
        return new ArrayType&lt;&gt;(innerType);
    }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>ESFileStore.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Licensed to Elasticsearch under one or more contributor
 * license agreements. See the NOTICE file distributed with
 * this work for additional information regarding copyright
 * ownership. Elasticsearch licenses this file to you under
 * the Apache License, Version 2.0 (the &quot;License&quot;); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
<A NAME="0"></A> * under the License.
 */

<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1220002-0.html#0',2,'match1220002-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>package org.elasticsearch.env;

import org.apache.lucene.util.Constants;
import io.crate.common.SuppressForbidden;
import org.elasticsearch.common.io.PathUtils;

import java.io.IOException;
import java.nio.file.FileStore;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.attribute.FileAttributeView;
import java.nio.file.attribute.FileStoreAttributeView;
import java.util.List;

/**
 * Implementation of FileStore that supports
 * additional features, such as SSD detection and better
 * filesystem information for the root filesystem.
 * @see Environment#getFileStore(Path)
 */
class</B></FONT> ESFileStore extends FileStore {
    /** Underlying filestore */
    final FileStore in;
    private int majorDeviceNumber;
    private int minorDeviceNumber;

    @SuppressForbidden(reason = &quot;tries to determine if disk is spinning&quot;)
    // TODO: move PathUtils to be package-private here instead of
    // public+forbidden api!
    ESFileStore(final FileStore in) {
        this.in = in;
        if (Constants.LINUX) {
            try {
                final List&lt;String&gt; lines = Files.readAllLines(PathUtils.get(&quot;/proc/self/mountinfo&quot;));
                for (final String line : lines) {
                    final String[] fields = line.trim().split(&quot;\\s+&quot;);
                    final String mountPoint = fields[4];
                    if (mountPoint.equals(getMountPointLinux(in))) {
                        final String[] deviceNumbers = fields[2].split(&quot;:&quot;);
                        majorDeviceNumber = Integer.parseInt(deviceNumbers[0]);
                        minorDeviceNumber = Integer.parseInt(deviceNumbers[1]);
                        break;
                    }
                }
            } catch (final Exception e) {
                majorDeviceNumber = -1;
                minorDeviceNumber = -1;
            }
        } else {
            majorDeviceNumber = -1;
            minorDeviceNumber = -1;
        }
    }

    // these are hacks that are not guaranteed
    private static String getMountPointLinux(final FileStore store) {
        String desc = store.toString();
        int index = desc.lastIndexOf(&quot; (&quot;);
        if (index != -1) {
            return desc.substring(0, index);
        } else {
            return desc;
        }
    }

    @Override
    public String name() {
        return in.name();
    }

    @Override
    public String type() {
        return in.type();
    }

    @Override
    public boolean isReadOnly() {
        return in.isReadOnly();
    }

    @Override
    public long getTotalSpace() throws IOException {
        long result = in.getTotalSpace();
        if (result &lt; 0) {
            // see https://bugs.openjdk.java.net/browse/JDK-8162520:
            result = Long.MAX_VALUE;
        }
        return result;
    }

    @Override
    public long getUsableSpace() throws IOException {
        long result = in.getUsableSpace();
        if (result &lt; 0) {
            // see https://bugs.openjdk.java.net/browse/JDK-8162520:
            result = Long.MAX_VALUE;
        }
        return result;
    }

    @Override
    public long getUnallocatedSpace() throws IOException {
        long result = in.getUnallocatedSpace();
        if (result &lt; 0) {
            // see https://bugs.openjdk.java.net/browse/JDK-8162520:
            result = Long.MAX_VALUE;
        }
        return result;
<A NAME="1"></A>    }

    @Override
    public boolean supportsFileAttributeView(<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1220002-0.html#1',2,'match1220002-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Class&lt;? extends FileAttributeView&gt; type) {
        return in.supportsFileAttributeView(type);
    }

    @Override
    public boolean supportsFileAttributeView(String name</B></FONT>) {
        if (&quot;lucene&quot;.equals(name)) {
            return true;
        } else {
            return in.supportsFileAttributeView(name);
        }
    }

    @Override
    public &lt;V extends FileStoreAttributeView&gt; V getFileStoreAttributeView(Class&lt;V&gt; type) {
        return in.getFileStoreAttributeView(type);
    }

    @Override
    public Object getAttribute(String attribute) throws IOException {
        switch (attribute) {
            // for the partition
            case &quot;lucene:major_device_number&quot;:
                return majorDeviceNumber;
            case &quot;lucene:minor_device_number&quot;:
                return minorDeviceNumber;
            default:
                return in.getAttribute(attribute);
        }
    }

    @Override
    public String toString() {
        return in.toString();
    }
}
</PRE>
</div>
  </div>
</body>
</html>
