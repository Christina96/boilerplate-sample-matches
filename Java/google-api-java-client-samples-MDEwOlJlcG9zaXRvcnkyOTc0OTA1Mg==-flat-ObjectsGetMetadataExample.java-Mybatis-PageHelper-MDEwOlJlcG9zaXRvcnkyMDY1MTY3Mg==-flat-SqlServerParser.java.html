
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 3.9568345323741005%, Tokens: 11, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-ObjectsGetMetadataExample.java</h3>
            <pre><code>1  package com.google.api.services.samples.storage.examples;
<span onclick='openModal()' class='match'>2  import com.google.api.client.auth.oauth2.Credential;
3  import com.google.api.client.googleapis.javanet.GoogleNetHttpTransport;
4  import com.google.api.client.http.HttpTransport;
5  import com.google.api.client.json.JsonFactory;
6  import com.google.api.client.json.jackson2.JacksonFactory;
7  import com.google.api.services.samples.storage.util.CredentialsProvider;
8  import com.google.api.services.storage.Storage;
9  import com.google.api.services.storage.model.StorageObject;
10  import java.io.IOException;
11  public class ObjectsGetMetadataExample {
12    private static final String BUCKET_NAME = "*** bucket name ***";
</span>13    private static final String OBJECT_NAME = "*** object name ***";
14    public static StorageObject get(Storage storage, String bucketName, String objectName)
15        throws IOException {
16      Storage.Objects.Get getObject = storage.objects().get(bucketName, objectName);
17      return getObject.execute(); 
18    }
19    public static void main(String[] args) throws Exception {
20      HttpTransport httpTransport = GoogleNetHttpTransport.newTrustedTransport();
21      JsonFactory jsonFactory = JacksonFactory.getDefaultInstance();
22      Credential credential = CredentialsProvider.authorize(httpTransport, jsonFactory);
23      Storage storage = new Storage.Builder(httpTransport, jsonFactory, credential)
24          .setApplicationName("Google-ObjectsGetMetadataExample/1.0").build();
25      StorageObject object = get(storage, BUCKET_NAME, OBJECT_NAME);
26      System.out.println(object.getName() + " (size: " + object.getSize() + ")");
27    }
28  }
</code></pre>
        </div>
        <div class="column">
            <h3>Mybatis-PageHelper-MDEwOlJlcG9zaXRvcnkyMDY1MTY3Mg==-flat-SqlServerParser.java</h3>
            <pre><code>1  package com.github.pagehelper.parser;
2  import com.github.pagehelper.JSqlParser;
3  import com.github.pagehelper.PageException;
<span onclick='openModal()' class='match'>4  import net.sf.jsqlparser.expression.Alias;
5  import net.sf.jsqlparser.expression.Expression;
6  import net.sf.jsqlparser.expression.LongValue;
7  import net.sf.jsqlparser.expression.operators.relational.GreaterThan;
8  import net.sf.jsqlparser.schema.Column;
9  import net.sf.jsqlparser.schema.Table;
10  import net.sf.jsqlparser.statement.Statement;
11  import net.sf.jsqlparser.statement.select.*;
12  import java.util.*;
13  public class SqlServerParser {
14      public static final    String     START_ROW                = String.valueOf(Long.MIN_VALUE);
</span>15      public static final    String     PAGE_SIZE                = String.valueOf(Long.MAX_VALUE);
16      protected static final String     WRAP_TABLE               = "WRAP_OUTER_TABLE";
17      protected static final String     PAGE_TABLE_NAME          = "PAGE_TABLE_ALIAS";
18      public static final    Alias      PAGE_TABLE_ALIAS         = new Alias(PAGE_TABLE_NAME);
19      protected static final String     PAGE_ROW_NUMBER          = "PAGE_ROW_NUMBER";
20      protected static final Column     PAGE_ROW_NUMBER_COLUMN   = new Column(PAGE_ROW_NUMBER);
21      protected static final Top        TOP100_PERCENT;
22      protected static final String     PAGE_COLUMN_ALIAS_PREFIX = "ROW_ALIAS_";
23      static {
24          TOP100_PERCENT = new Top();
25          TOP100_PERCENT.setExpression(new LongValue(100));
26          TOP100_PERCENT.setPercentage(true);
27      }
28      private final JSqlParser jSqlParser;
29      public SqlServerParser() {
30          this.jSqlParser = JSqlParser.DEFAULT;
31      }
32      public SqlServerParser(JSqlParser jSqlParser) {
33          this.jSqlParser = jSqlParser;
34      }
35      public String convertToPageSql(String sql) {
36          return convertToPageSql(sql, null, null);
37      }
38      public String convertToPageSql(String sql, Integer offset, Integer limit) {
39          Statement stmt;
40          try {
41              stmt = jSqlParser.parse(sql);
42          } catch (Throwable e) {
43              throw new PageException("不支持该SQL转换为分页查询!", e);
44          }
45          if (!(stmt instanceof Select)) {
46              throw new PageException("分页语句必须是Select查询!");
47          }
48          Select pageSelect = getPageSelect((Select) stmt);
49          String pageSql = pageSelect.toString();
50          if (offset != null) {
51              pageSql = pageSql.replace(START_ROW, String.valueOf(offset));
52          }
53          if (limit != null) {
54              pageSql = pageSql.replace(PAGE_SIZE, String.valueOf(limit));
55          }
56          return pageSql;
57      }
58      protected Select getPageSelect(Select select) {
59          SelectBody selectBody = select.getSelectBody();
60          if (selectBody instanceof SetOperationList) {
61              selectBody = wrapSetOperationList((SetOperationList) selectBody);
62          }
63          if (((PlainSelect) selectBody).getTop() != null) {
64              throw new PageException("被分页的语句已经包含了Top，不能再通过分页插件进行分页查询!");
65          }
66          List<SelectItem> selectItems = getSelectItems((PlainSelect) selectBody);
67          List<SelectItem> autoItems = new ArrayList<SelectItem>();
68          SelectItem orderByColumn = addRowNumber((PlainSelect) selectBody, autoItems);
69          ((PlainSelect) selectBody).addSelectItems(autoItems.toArray(new SelectItem[autoItems.size()]));
70          processSelectBody(selectBody, 0);
71          PlainSelect innerSelectBody = new PlainSelect();
72          innerSelectBody.addSelectItems(orderByColumn);
73          innerSelectBody.addSelectItems(selectItems.toArray(new SelectItem[selectItems.size()]));
74          SubSelect fromInnerItem = new SubSelect();
75          fromInnerItem.setSelectBody(selectBody);
76          fromInnerItem.setAlias(PAGE_TABLE_ALIAS);
77          innerSelectBody.setFromItem(fromInnerItem);
78          Select newSelect = new Select();
79          PlainSelect newSelectBody = new PlainSelect();
80          Top top = new Top();
81          top.setExpression(new LongValue(Long.MAX_VALUE));
82          newSelectBody.setTop(top);
83          List<OrderByElement> orderByElements = new ArrayList<OrderByElement>();
84          OrderByElement orderByElement = new OrderByElement();
85          orderByElement.setExpression(PAGE_ROW_NUMBER_COLUMN);
86          orderByElements.add(orderByElement);
87          newSelectBody.setOrderByElements(orderByElements);
88          GreaterThan greaterThan = new GreaterThan();
89          greaterThan.setLeftExpression(PAGE_ROW_NUMBER_COLUMN);
90          greaterThan.setRightExpression(new LongValue(Long.MIN_VALUE));
91          newSelectBody.setWhere(greaterThan);
92          newSelectBody.setSelectItems(selectItems);
93          SubSelect fromItem = new SubSelect();
94          fromItem.setSelectBody(innerSelectBody); 
95          fromItem.setAlias(PAGE_TABLE_ALIAS);
96          newSelectBody.setFromItem(fromItem);
97          newSelect.setSelectBody(newSelectBody);
98          if (isNotEmptyList(select.getWithItemsList())) {
99              newSelect.setWithItemsList(select.getWithItemsList());
100          }
101          return newSelect;
102      }
103      protected SelectBody wrapSetOperationList(SetOperationList setOperationList) {
104          SelectBody setSelectBody = setOperationList.getSelects().get(setOperationList.getSelects().size() - 1);
105          if (!(setSelectBody instanceof PlainSelect)) {
106              throw new PageException("目前无法处理该SQL，您可以将该SQL发送给abel533@gmail.com协助作者解决!");
107          }
108          PlainSelect plainSelect = (PlainSelect) setSelectBody;
109          PlainSelect selectBody = new PlainSelect();
110          List<SelectItem> selectItems = getSelectItems(plainSelect);
111          selectBody.setSelectItems(selectItems);
112          SubSelect fromItem = new SubSelect();
113          fromItem.setSelectBody(setOperationList);
114          fromItem.setAlias(new Alias(WRAP_TABLE));
115          selectBody.setFromItem(fromItem);
116          if (isNotEmptyList(plainSelect.getOrderByElements())) {
117              selectBody.setOrderByElements(plainSelect.getOrderByElements());
118              plainSelect.setOrderByElements(null);
119          }
120          return selectBody;
121      }
122      protected List<SelectItem> getSelectItems(PlainSelect plainSelect) {
123          List<SelectItem> selectItems = new ArrayList<SelectItem>();
124          for (SelectItem selectItem : plainSelect.getSelectItems()) {
125              if (selectItem instanceof SelectExpressionItem) {
126                  SelectExpressionItem selectExpressionItem = (SelectExpressionItem) selectItem;
127                  if (selectExpressionItem.getAlias() != null) {
128                      Column column = new Column(selectExpressionItem.getAlias().getName());
129                      SelectExpressionItem expressionItem = new SelectExpressionItem(column);
130                      selectItems.add(expressionItem);
131                  } else if (selectExpressionItem.getExpression() instanceof Column) {
132                      Column column = (Column) selectExpressionItem.getExpression();
133                      SelectExpressionItem item = null;
134                      if (column.getTable() != null) {
135                          Column newColumn = new Column(column.getColumnName());
136                          item = new SelectExpressionItem(newColumn);
137                          selectItems.add(item);
138                      } else {
139                          selectItems.add(selectItem);
140                      }
141                  } else {
142                      selectItems.add(selectItem);
143                  }
144              } else if (selectItem instanceof AllTableColumns) {
145                  selectItems.add(new AllColumns());
146              } else {
147                  selectItems.add(selectItem);
148              }
149          }
150          for (SelectItem selectItem : selectItems) {
151              if (selectItem instanceof AllColumns) {
152                  return Collections.singletonList(selectItem);
153              }
154          }
155          return selectItems;
156      }
157      protected SelectItem addRowNumber(PlainSelect plainSelect, List<SelectItem> autoItems) {
158          StringBuilder orderByBuilder = new StringBuilder();
159          orderByBuilder.append("ROW_NUMBER() OVER (");
160          if (isNotEmptyList(plainSelect.getOrderByElements())) {
161              orderByBuilder.append(PlainSelect.orderByToString(
162                      getOrderByElements(plainSelect, autoItems)).substring(1));
163              plainSelect.setOrderByElements(null);
164          } else {
165              orderByBuilder.append("ORDER BY RAND()");
166          }
167          orderByBuilder.append(") ");
168          orderByBuilder.append(PAGE_ROW_NUMBER);
169          return new SelectExpressionItem(new Column(orderByBuilder.toString()));
170      }
171      protected void processSelectBody(SelectBody selectBody, int level) {
172          if (selectBody != null) {
173              if (selectBody instanceof PlainSelect) {
174                  processPlainSelect((PlainSelect) selectBody, level + 1);
175              } else if (selectBody instanceof WithItem) {
176                  WithItem withItem = (WithItem) selectBody;
177                  if (withItem.getSubSelect() != null) {
178                      processSelectBody(withItem.getSubSelect().getSelectBody(), level + 1);
179                  }
180              } else {
181                  SetOperationList operationList = (SetOperationList) selectBody;
182                  if (operationList.getSelects() != null && operationList.getSelects().size() > 0) {
183                      List<SelectBody> plainSelects = operationList.getSelects();
184                      for (SelectBody plainSelect : plainSelects) {
185                          processSelectBody(plainSelect, level + 1);
186                      }
187                  }
188              }
189          }
190      }
191      protected void processPlainSelect(PlainSelect plainSelect, int level) {
192          if (level > 1) {
193              if (isNotEmptyList(plainSelect.getOrderByElements())) {
194                  if (plainSelect.getTop() == null) {
195                      plainSelect.setTop(TOP100_PERCENT);
196                  }
197              }
198          }
199          if (plainSelect.getFromItem() != null) {
200              processFromItem(plainSelect.getFromItem(), level + 1);
201          }
202          if (plainSelect.getJoins() != null && plainSelect.getJoins().size() > 0) {
203              List<Join> joins = plainSelect.getJoins();
204              for (Join join : joins) {
205                  if (join.getRightItem() != null) {
206                      processFromItem(join.getRightItem(), level + 1);
207                  }
208              }
209          }
210      }
211      protected void processFromItem(FromItem fromItem, int level) {
212          if (fromItem instanceof SubJoin) {
213              SubJoin subJoin = (SubJoin) fromItem;
214              if (subJoin.getJoinList() != null && subJoin.getJoinList().size() > 0) {
215                  for (Join join : subJoin.getJoinList()) {
216                      if (join.getRightItem() != null) {
217                          processFromItem(join.getRightItem(), level + 1);
218                      }
219                  }
220              }
221              if (subJoin.getLeft() != null) {
222                  processFromItem(subJoin.getLeft(), level + 1);
223              }
224          } else if (fromItem instanceof SubSelect) {
225              SubSelect subSelect = (SubSelect) fromItem;
226              if (subSelect.getSelectBody() != null) {
227                  processSelectBody(subSelect.getSelectBody(), level + 1);
228              }
229          } else if (fromItem instanceof ValuesList) {
230          } else if (fromItem instanceof LateralSubSelect) {
231              LateralSubSelect lateralSubSelect = (LateralSubSelect) fromItem;
232              if (lateralSubSelect.getSubSelect() != null) {
233                  SubSelect subSelect = lateralSubSelect.getSubSelect();
234                  if (subSelect.getSelectBody() != null) {
235                      processSelectBody(subSelect.getSelectBody(), level + 1);
236                  }
237              }
238          }
239      }
240      public boolean isNotEmptyList(List<?> list) {
241          if (list == null || list.size() == 0) {
242              return false;
243          }
244          return true;
245      }
246      protected OrderByElement cloneOrderByElement(OrderByElement orig, String alias) {
247          return cloneOrderByElement(orig, new Column(alias));
248      }
249      protected OrderByElement cloneOrderByElement(OrderByElement orig, Expression expression) {
250          OrderByElement element = new OrderByElement();
251          element.setAsc(orig.isAsc());
252          element.setAscDescPresent(orig.isAscDescPresent());
253          element.setNullOrdering(orig.getNullOrdering());
254          element.setExpression(expression);
255          return element;
256      }
257      protected List<OrderByElement> getOrderByElements(PlainSelect plainSelect,
258                                                        List<SelectItem> autoItems) {
259          List<OrderByElement> orderByElements = plainSelect.getOrderByElements();
260          ListIterator<OrderByElement> iterator = orderByElements.listIterator();
261          OrderByElement orderByElement;
262          Map<String, SelectExpressionItem> selectMap = new HashMap<String, SelectExpressionItem>();
263          Set<String> aliases = new HashSet<String>();
264          boolean allColumns = false;
265          Set<String> allColumnsTables = new HashSet<String>();
266          for (SelectItem item : plainSelect.getSelectItems()) {
267              if (item instanceof SelectExpressionItem) {
268                  SelectExpressionItem expItem = (SelectExpressionItem) item;
269                  selectMap.put(expItem.getExpression().toString(), expItem);
270                  Alias alias = expItem.getAlias();
271                  if (alias != null) {
272                      aliases.add(alias.getName());
273                  }
274              } else if (item instanceof AllColumns) {
275                  allColumns = true;
276              } else if (item instanceof AllTableColumns) {
277                  allColumnsTables.add(((AllTableColumns) item).getTable().getName());
278              }
279          }
280          int aliasNo = 1;
281          while (iterator.hasNext()) {
282              orderByElement = iterator.next();
283              Expression expression = orderByElement.getExpression();
284              SelectExpressionItem selectExpressionItem = selectMap.get(expression.toString());
285              if (selectExpressionItem != null) { 
286                  Alias alias = selectExpressionItem.getAlias();
287                  if (alias != null) { 
288                      iterator.set(cloneOrderByElement(orderByElement, alias.getName()));
289                  } else { 
290                      if (expression instanceof Column) {
291                          ((Column) expression).setTable(null);
292                      } else {
293                          throw new PageException("列 \"" + expression + "\" 需要定义别名");
294                      }
295                  }
296              } else { 
297                  if (expression instanceof Column) { 
298                      Table table = ((Column) expression).getTable();
299                      if (table == null) { 
300                          if (allColumns ||
301                                  (allColumnsTables.size() == 1 && plainSelect.getJoins() == null) ||
302                                  aliases.contains(((Column) expression).getColumnName())) {
303                              continue;
304                          }
305                      } else { 
306                          String tableName = table.getName();
307                          if (allColumns || allColumnsTables.contains(tableName)) {
308                              ((Column) expression).setTable(null);
309                              continue;
310                          }
311                      }
312                  }
313                  String aliasName = PAGE_COLUMN_ALIAS_PREFIX + aliasNo++;
314                  SelectExpressionItem item = new SelectExpressionItem();
315                  item.setExpression(expression);
316                  item.setAlias(new Alias(aliasName));
317                  autoItems.add(item);
318                  iterator.set(cloneOrderByElement(orderByElement, aliasName));
319              }
320          }
321          return orderByElements;
322      }
323  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-ObjectsGetMetadataExample.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Mybatis-PageHelper-MDEwOlJlcG9zaXRvcnkyMDY1MTY3Mg==-flat-SqlServerParser.java</div>
                </div>
                <div class="column column_space"><pre><code>2  import com.google.api.client.auth.oauth2.Credential;
3  import com.google.api.client.googleapis.javanet.GoogleNetHttpTransport;
4  import com.google.api.client.http.HttpTransport;
5  import com.google.api.client.json.JsonFactory;
6  import com.google.api.client.json.jackson2.JacksonFactory;
7  import com.google.api.services.samples.storage.util.CredentialsProvider;
8  import com.google.api.services.storage.Storage;
9  import com.google.api.services.storage.model.StorageObject;
10  import java.io.IOException;
11  public class ObjectsGetMetadataExample {
12    private static final String BUCKET_NAME = "*** bucket name ***";
</pre></code></div>
                <div class="column column_space"><pre><code>4  import net.sf.jsqlparser.expression.Alias;
5  import net.sf.jsqlparser.expression.Expression;
6  import net.sf.jsqlparser.expression.LongValue;
7  import net.sf.jsqlparser.expression.operators.relational.GreaterThan;
8  import net.sf.jsqlparser.schema.Column;
9  import net.sf.jsqlparser.schema.Table;
10  import net.sf.jsqlparser.statement.Statement;
11  import net.sf.jsqlparser.statement.select.*;
12  import java.util.*;
13  public class SqlServerParser {
14      public static final    String     START_ROW                = String.valueOf(Long.MIN_VALUE);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    