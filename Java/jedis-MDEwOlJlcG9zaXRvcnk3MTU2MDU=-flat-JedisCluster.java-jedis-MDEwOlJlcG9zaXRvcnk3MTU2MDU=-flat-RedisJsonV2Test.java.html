
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 5.990016638935108%, Tokens: 12</h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-JedisCluster.java</h3>
            <pre><code>1  package redis.clients.jedis;
2  import java.time.Duration;
3  import java.util.Collections;
4  import java.util.Map;
5  import java.util.Set;
6  import org.apache.commons.pool2.impl.GenericObjectPoolConfig;
7  import redis.clients.jedis.providers.ClusterConnectionProvider;
8  import redis.clients.jedis.util.JedisClusterCRC16;
9  public class JedisCluster extends UnifiedJedis {
10    public static final int DEFAULT_TIMEOUT = 2000;
11    public static final int DEFAULT_MAX_ATTEMPTS = 5;
12    public JedisCluster(HostAndPort node) {
13      this(Collections.singleton(node));
14    }
15    public JedisCluster(HostAndPort node, int timeout) {
16      this(Collections.singleton(node), timeout);
17    }
18    public JedisCluster(HostAndPort node, int timeout, int maxAttempts) {
19      this(Collections.singleton(node), timeout, maxAttempts);
20    }
21    public JedisCluster(HostAndPort node, final GenericObjectPoolConfig<Connection> poolConfig) {
22      this(Collections.singleton(node), poolConfig);
23    }
24    public JedisCluster(HostAndPort node, int timeout, final GenericObjectPoolConfig<Connection> poolConfig) {
25      this(Collections.singleton(node), timeout, poolConfig);
26    }
27    public JedisCluster(HostAndPort node, int timeout, int maxAttempts,
28        final GenericObjectPoolConfig<Connection> poolConfig) {
29      this(Collections.singleton(node), timeout, maxAttempts, poolConfig);
30    }
31    public JedisCluster(HostAndPort node, int connectionTimeout, int soTimeout, int maxAttempts,
32        final GenericObjectPoolConfig<Connection> poolConfig) {
33      this(Collections.singleton(node), connectionTimeout, soTimeout, maxAttempts, poolConfig);
34    }
35    public JedisCluster(HostAndPort node, int connectionTimeout, int soTimeout, int maxAttempts,
36        String password, final GenericObjectPoolConfig<Connection> poolConfig) {
37      this(Collections.singleton(node), connectionTimeout, soTimeout, maxAttempts, password,
38          poolConfig);
39    }
40    public JedisCluster(HostAndPort node, int connectionTimeout, int soTimeout, int maxAttempts,
41        String password, String clientName, final GenericObjectPoolConfig<Connection> poolConfig) {
42      this(Collections.singleton(node), connectionTimeout, soTimeout, maxAttempts, password,
43          clientName, poolConfig);
44    }
45    public JedisCluster(HostAndPort node, int connectionTimeout, int soTimeout, int maxAttempts,
46        String user, String password, String clientName,
47        final GenericObjectPoolConfig<Connection> poolConfig) {
48      this(Collections.singleton(node), connectionTimeout, soTimeout, maxAttempts, user, password,
49          clientName, poolConfig);
50    }
51    public JedisCluster(HostAndPort node, int connectionTimeout, int soTimeout, int maxAttempts,
52        String password, String clientName, final GenericObjectPoolConfig<Connection> poolConfig,
53        boolean ssl) {
54      this(Collections.singleton(node), connectionTimeout, soTimeout, maxAttempts, password,
55          clientName, poolConfig, ssl);
56    }
57    public JedisCluster(HostAndPort node, int connectionTimeout, int soTimeout, int maxAttempts,
58        String user, String password, String clientName,
59        final GenericObjectPoolConfig<Connection> poolConfig, boolean ssl) {
60      this(Collections.singleton(node), connectionTimeout, soTimeout, maxAttempts, user, password,
61          clientName, poolConfig, ssl);
62    }
63    public JedisCluster(HostAndPort node, final JedisClientConfig clientConfig, int maxAttempts,
64        final GenericObjectPoolConfig<Connection> poolConfig) {
65      this(Collections.singleton(node), clientConfig, maxAttempts, poolConfig);
66    }
67    public JedisCluster(Set<HostAndPort> nodes) {
68      this(nodes, DEFAULT_TIMEOUT);
69    }
70    public JedisCluster(Set<HostAndPort> nodes, int timeout) {
71      this(nodes, DefaultJedisClientConfig.builder().timeoutMillis(timeout).build());
72    }
73    public JedisCluster(Set<HostAndPort> nodes, int timeout, int maxAttempts) {
74      this(nodes, DefaultJedisClientConfig.builder().timeoutMillis(timeout).build(), maxAttempts);
75    }
76    public JedisCluster(Set<HostAndPort> nodes, String user, String password) {
77      this(nodes, DefaultJedisClientConfig.builder().user(user).password(password).build());
78    }
79    public JedisCluster(Set<HostAndPort> nodes, String user, String password,
80        HostAndPortMapper hostAndPortMap) {
81      this(nodes, DefaultJedisClientConfig.builder().user(user).password(password)
82          .hostAndPortMapper(hostAndPortMap).build());
83    }
84    public JedisCluster(Set<HostAndPort> nodes, final GenericObjectPoolConfig<Connection> poolConfig) {
85      this(nodes, DEFAULT_TIMEOUT, DEFAULT_MAX_ATTEMPTS, poolConfig);
86    }
87    public JedisCluster(Set<HostAndPort> nodes, int timeout,
88        final GenericObjectPoolConfig<Connection> poolConfig) {
89      this(nodes, timeout, DEFAULT_MAX_ATTEMPTS, poolConfig);
90    }
91    public JedisCluster(Set<HostAndPort> clusterNodes, int timeout, int maxAttempts,
92        final GenericObjectPoolConfig<Connection> poolConfig) {
93      this(clusterNodes, timeout, timeout, maxAttempts, poolConfig);
94    }
95    public JedisCluster(Set<HostAndPort> clusterNodes, int connectionTimeout, int soTimeout,
96        int maxAttempts, final GenericObjectPoolConfig<Connection> poolConfig) {
97      this(clusterNodes, connectionTimeout, soTimeout, maxAttempts, null, poolConfig);
98    }
99    public JedisCluster(Set<HostAndPort> clusterNodes, int connectionTimeout, int soTimeout,
100        int maxAttempts, String password, GenericObjectPoolConfig<Connection> poolConfig) {
101      this(clusterNodes, connectionTimeout, soTimeout, maxAttempts, password, null, poolConfig);
102    }
103    public JedisCluster(Set<HostAndPort> clusterNodes, int connectionTimeout, int soTimeout,
104        int maxAttempts, String password, String clientName,
105        GenericObjectPoolConfig<Connection> poolConfig) {
106      this(clusterNodes, connectionTimeout, soTimeout, maxAttempts, null, password, clientName,
107          poolConfig);
108    }
109    public JedisCluster(Set<HostAndPort> clusterNodes, int connectionTimeout, int soTimeout,
110        int maxAttempts, String user, String password, String clientName,
111        GenericObjectPoolConfig<Connection> poolConfig) {
112      this(clusterNodes, DefaultJedisClientConfig.builder().connectionTimeoutMillis(connectionTimeout)
113          .socketTimeoutMillis(soTimeout).user(user).password(password).clientName(clientName).build(),
114          maxAttempts, poolConfig);
115    }
116    public JedisCluster(Set<HostAndPort> clusterNodes, int connectionTimeout, int soTimeout,
117        int infiniteSoTimeout, int maxAttempts, String user, String password, String clientName,
118        GenericObjectPoolConfig<Connection> poolConfig) {
119      this(clusterNodes, DefaultJedisClientConfig.builder().connectionTimeoutMillis(connectionTimeout)
120          .socketTimeoutMillis(soTimeout).blockingSocketTimeoutMillis(infiniteSoTimeout)
121          .user(user).password(password).clientName(clientName).build(), maxAttempts, poolConfig);
122    }
123    public JedisCluster(Set<HostAndPort> clusterNodes, int connectionTimeout, int soTimeout,
124        int maxAttempts, String password, String clientName,
125        GenericObjectPoolConfig<Connection> poolConfig, boolean ssl) {
126      this(clusterNodes, connectionTimeout, soTimeout, maxAttempts, null, password, clientName,
127          poolConfig, ssl);
128    }
129    public JedisCluster(Set<HostAndPort> clusterNodes, int connectionTimeout, int soTimeout,
130        int maxAttempts, String user, String password, String clientName,
<span onclick='openModal()' class='match'>131        GenericObjectPoolConfig<Connection> poolConfig, boolean ssl) {
132      this(clusterNodes, DefaultJedisClientConfig.builder().connectionTimeoutMillis(connectionTimeout)
133          .socketTimeoutMillis(soTimeout).user(user).password(password).clientName(clientName).ssl(ssl).build(),
134          maxAttempts, poolConfig);
135    }
136    public JedisCluster(Set<HostAndPort> clusterNodes, JedisClientConfig clientConfig,
</span>137        int maxAttempts, GenericObjectPoolConfig<Connection> poolConfig) {
138      this(clusterNodes, clientConfig, maxAttempts,
139          Duration.ofMillis((long) clientConfig.getSocketTimeoutMillis() * maxAttempts), poolConfig);
140    }
141    public JedisCluster(Set<HostAndPort> clusterNodes, JedisClientConfig clientConfig,
142        int maxAttempts, Duration maxTotalRetriesDuration,
143        GenericObjectPoolConfig<Connection> poolConfig) {
144      super(clusterNodes, clientConfig, poolConfig, maxAttempts, maxTotalRetriesDuration);
145    }
146    public JedisCluster(Set<HostAndPort> clusterNodes, JedisClientConfig clientConfig) {
147      this(clusterNodes, clientConfig, DEFAULT_MAX_ATTEMPTS);
148    }
149    public JedisCluster(Set<HostAndPort> clusterNodes, JedisClientConfig clientConfig, int maxAttempts) {
150      super(clusterNodes, clientConfig, maxAttempts);
151    }
152    public JedisCluster(Set<HostAndPort> clusterNodes, JedisClientConfig clientConfig, int maxAttempts,
153        Duration maxTotalRetriesDuration) {
154      super(clusterNodes, clientConfig, maxAttempts, maxTotalRetriesDuration);
155    }
156    public JedisCluster(ClusterConnectionProvider provider, int maxAttempts,
157        Duration maxTotalRetriesDuration) {
158      super(provider, maxAttempts, maxTotalRetriesDuration);
159    }
160    public Map<String, ConnectionPool> getClusterNodes() {
161      return ((ClusterConnectionProvider) provider).getNodes();
162    }
163    public Connection getConnectionFromSlot(int slot) {
164      return ((ClusterConnectionProvider) provider).getConnectionFromSlot(slot);
165    }
166    public long spublish(String channel, String message) {
167      return executeCommand(commandObjects.spublish(channel, message));
168    }
169    public long spublish(byte[] channel, byte[] message) {
170      return executeCommand(commandObjects.spublish(channel, message));
171    }
172    public void ssubscribe(final JedisShardedPubSub jedisPubSub, final String... channels) {
173      try (Connection connection = getConnectionFromSlot(JedisClusterCRC16.getSlot(channels[0]))) {
174        jedisPubSub.proceed(connection, channels);
175      }
176    }
177    public void ssubscribe(BinaryJedisShardedPubSub jedisPubSub, final byte[]... channels) {
178      try (Connection connection = getConnectionFromSlot(JedisClusterCRC16.getSlot(channels[0]))) {
179        jedisPubSub.proceed(connection, channels);
180      }
181    }
182    @Override
183    public ClusterPipeline pipelined() {
184      return new ClusterPipeline((ClusterConnectionProvider) provider, (ClusterCommandObjects) commandObjects);
185    }
186    @Override
187    public Transaction multi() {
188      throw new UnsupportedOperationException();
189    }
190  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RedisJsonV2Test.java</h3>
            <pre><code>1  package redis.clients.jedis.modules.json;
2  import static java.util.Collections.singletonList;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.json.Path2.ROOT_PATH;
5  import static redis.clients.jedis.modules.json.JsonObjects.*;
6  import com.google.gson.Gson;
7  import java.util.Arrays;
8  import java.util.Collections;
9  import java.util.List;
10  import org.hamcrest.MatcherAssert;
11  import org.hamcrest.Matchers;
12  import org.json.JSONArray;
13  import org.json.JSONObject;
14  import org.junit.BeforeClass;
15  import org.junit.Test;
16  import redis.clients.jedis.exceptions.JedisDataException;
17  import redis.clients.jedis.json.JsonSetParams;
18  import redis.clients.jedis.json.Path2;
19  import redis.clients.jedis.modules.RedisModuleCommandsTestBase;
20  public class RedisJsonV2Test extends RedisModuleCommandsTestBase {
21    @BeforeClass
22    public static void prepare() {
23      RedisModuleCommandsTestBase.prepare();
24    }
25    private static final Gson gson = new Gson();
26    @Test
27    public void basicSetGetShouldSucceed() {
28      client.jsonSetWithEscape("null", ROOT_PATH, (Object) null);
29      assertJsonArrayEquals(jsonArray((Object) null), client.jsonGet("null", ROOT_PATH));
30      client.jsonSetWithEscape("str", "strong");
31      assertEquals("strong", client.jsonGet("str"));
32      IRLObject obj = new IRLObject();
33      client.jsonSetWithEscape("obj", obj);
34      Object expected = gson.fromJson(gson.toJson(obj), Object.class);
35      assertTrue(expected.equals(client.jsonGet("obj")));
36      Path2 p = Path2.of(".str");
37      client.jsonSet("obj", p, gson.toJson("strung"));
38      assertJsonArrayEquals(jsonArray("strung"), client.jsonGet("obj", p));
39    }
40    @Test
41    public void setExistingPathOnlyIfExistsShouldSucceed() {
42      client.jsonSetWithEscape("obj", new IRLObject());
43      Path2 p = Path2.of(".str");
44      client.jsonSetWithEscape("obj", p, "strangle", JsonSetParams.jsonSetParams().xx());
45      assertJsonArrayEquals(jsonArray("strangle"), client.jsonGet("obj", p));
46    }
47    @Test
48    public void setNonExistingOnlyIfNotExistsShouldSucceed() {
49      client.jsonSet("obj", gson.toJson(new IRLObject()));
50      Path2 p = Path2.of(".none");
51      client.jsonSet("obj", p, gson.toJson("strangle"), JsonSetParams.jsonSetParams().nx());
52      assertJsonArrayEquals(jsonArray("strangle"), client.jsonGet("obj", p));
53    }
54    @Test
55    public void setWithoutAPathDefaultsToRootPath() {
56      String objStr = gson.toJson(new IRLObject());
57      client.jsonSet("obj1", new JSONObject(objStr));
58      client.jsonSetWithEscape("obj1", (Object) "strangle", JsonSetParams.jsonSetParams().xx());
59      assertJsonArrayEquals(jsonArray("strangle"), client.jsonGet("obj1", ROOT_PATH));
60    }
61    @Test
62    public void setExistingPathOnlyIfNotExistsShouldFail() {
63      client.jsonSetWithEscape("obj", new IRLObject());
64      Path2 p = Path2.of(".str");
65      assertNull(client.jsonSetWithEscape("obj", p, "strangle", JsonSetParams.jsonSetParams().nx()));
66    }
67    @Test
68    public void setNonExistingPathOnlyIfExistsShouldFail() {
69      client.jsonSetWithEscape("obj", new IRLObject());
70      Path2 p = Path2.of(".none");
71      assertNull(client.jsonSetWithEscape("obj", p, "strangle", JsonSetParams.jsonSetParams().xx()));
72    }
73    @Test(expected = JedisDataException.class)
74    public void setException() {
75      client.jsonSet("test", Path2.of(".foo"), "bar");
76    }
77    @Test
78    public void getMultiplePathsShouldSucceed() {
79      IRLObject obj = new IRLObject();
80      client.jsonSetWithEscape("obj", obj);
<span onclick='openModal()' class='match'>81      JSONObject result = (JSONObject) client.jsonGet("obj", Path2.of("bool"), Path2.of("str"));
82      assertJsonArrayEquals(jsonArray(true), result.get("$.bool"));
83      assertJsonArrayEquals(jsonArray("string"), result.get("$.str"));
84    }
85    @Test
</span>86    public void getMultiLevels() {
87      JSONObject obj = new JSONObject();
88      obj.put("foo", "John");
89      JSONObject inner = new JSONObject();
90      inner.put("foo", "Jane");
91      obj.put("bar", inner);
92      client.jsonSet("multi", obj);
93      assertJsonArrayEquals(jsonArray("John", "Jane"), client.jsonGet("multi", new Path2("..foo")));
94    }
95    @Test
96    public void toggle() {
97      IRLObject obj = new IRLObject();
98      client.jsonSetWithEscape("obj", obj);
99      Path2 pbool = Path2.of(".bool");
100      assertJsonArrayEquals(jsonArray(true), client.jsonGet("obj", pbool));
101      client.jsonToggle("obj", pbool);
102      assertJsonArrayEquals(jsonArray(false), client.jsonGet("obj", pbool));
103      client.jsonToggle("obj", pbool);
104      assertJsonArrayEquals(jsonArray(true), client.jsonGet("obj", pbool));
105      Path2 pstr = Path2.of(".str");
106      assertEquals(singletonList(null), client.jsonToggle("obj", pstr));
107      assertJsonArrayEquals(jsonArray("string"), client.jsonGet("obj", pstr));
108    }
109    @Test
110    public void getAbsent() {
111      client.jsonSetWithEscape("test", ROOT_PATH, "foo");
112      assertJsonArrayEquals(jsonArray(), client.jsonGet("test", Path2.of(".bar")));
113    }
114    @Test
115    public void delValidShouldSucceed() {
116      client.jsonSetWithEscape("obj", ROOT_PATH, new IRLObject());
117      assertEquals(1L, client.jsonDel("obj", Path2.of(".str")));
118      assertTrue(client.exists("obj"));
119      assertEquals(1L, client.jsonDel("obj"));
120      assertFalse(client.exists("obj"));
121    }
122    @Test
123    public void delNonExistingPathsAreIgnored() {
124      client.jsonSetWithEscape("foobar", ROOT_PATH, new FooBarObject());
125      assertEquals(0L, client.jsonDel("foobar", Path2.of(".foo[1]")));
126    }
127    @Test
128    public void typeChecksShouldSucceed() {
129      client.jsonSet("foobar", ROOT_PATH, new JSONObject(gson.toJson(new FooBarObject())));
130      assertSame(Object.class, client.jsonType("foobar"));
131      assertEquals(singletonList(Object.class), client.jsonType("foobar", ROOT_PATH));
132      assertEquals(singletonList(String.class), client.jsonType("foobar", Path2.of(".foo")));
133      assertEquals(singletonList(int.class), client.jsonType("foobar", Path2.of(".fooI")));
134      assertEquals(singletonList(float.class), client.jsonType("foobar", Path2.of(".fooF")));
135      assertEquals(singletonList(List.class), client.jsonType("foobar", Path2.of(".fooArr")));
136      assertEquals(singletonList(boolean.class), client.jsonType("foobar", Path2.of(".fooB")));
137      assertEquals(Collections.emptyList(), client.jsonType("foobar", Path2.of(".fooErr")));
138    }
139    @Test
140    public void testJsonMerge() {
141      JSONObject json = new JSONObject("{\"person\":{\"name\":\"John Doe\",\"age\":25,\"address\":{\"home\":\"123 Main Street\"},\"phone\":\"123-456-7890\"}}");
142      assertEquals("OK", client.jsonSet("test_merge", json));
143      json = new JSONObject("{\"person\":{\"name\":\"John Doe\",\"age\":30,\"address\":{\"home\":\"123 Main Street\"},\"phone\":\"123-456-7890\"}}");
144      assertEquals("OK", client.jsonMerge("test_merge", Path2.of("$"), "{\"person\":{\"age\":30}}"));
145      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge", Path2.of("$")));
146      assertEquals("OK", client.jsonMerge("test_merge", Path2.of("$.person.address"), "{\"work\":\"Redis office\"}"));
147      json = new JSONObject("{\"person\":{\"name\":\"John Doe\",\"age\":30,\"address\":{\"home\":\"123 Main Street\",\"work\":\"Redis office\"},\"phone\":\"123-456-7890\"}}");
148      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge", Path2.of("$")));
149      assertEquals("OK", client.jsonMerge("test_merge", Path2.of("$.person"), "{\"age\":null}"));
150      json = new JSONObject("{\"person\":{\"name\":\"John Doe\",\"address\":{\"home\":\"123 Main Street\",\"work\":\"Redis office\"},\"phone\":\"123-456-7890\"}}");
151      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge", Path2.of("$")));
152      assertEquals(1L, client.del("test_merge"));
153    }
154    @Test
155    public void testJsonMergeArray()
156    {
157      JSONObject json = new JSONObject("{\"a\":{\"b\":{\"c\":[\"d\",\"e\"]}}}");
158      assertEquals("OK", (client.jsonSet("test_merge_array", Path2.of("$"), json)));
159      assertEquals("OK", (client.jsonMerge("test_merge_array", Path2.of("$.a.b.c"), "[\"f\"]")));
160      json = new JSONObject("{\"a\":{\"b\":{\"c\":[\"f\"]}}}");
161      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge_array", Path2.of("$")));
162      assertEquals("OK", (client.jsonSet("test_merge_array", Path2.of("$"), "{\"a\":{\"b\":{\"c\":\"d\"}}}")));
163      assertEquals("OK", (client.jsonMerge("test_merge_array", Path2.of("$.a.b.c"), "[\"f\"]")));
164      json = new JSONObject("{\"a\":{\"b\":{\"c\":[\"f\"]}}}");
165      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge_array", Path2.of("$")));
166      assertEquals("OK", (client.jsonSet("test_merge_array", Path2.of("$"), "{\"a\":{\"b\":{\"c\":[\"d\",\"e\"]}}}")));
167      assertEquals("OK", (client.jsonMerge("test_merge_array", Path2.of("$.a.b"), "{\"c\":null}")));
168      json = new JSONObject("{\"a\":{\"b\":{}}}");
169      assertJsonArrayEquals(jsonArray(json), client.jsonGet("test_merge_array", Path2.of("$")));
170    }
171    @Test
172    public void mgetWithPathWithAllKeysExist() {
173      Baz baz1 = new Baz("quuz1", "grault1", "waldo1");
174      Baz baz2 = new Baz("quuz2", "grault2", "waldo2");
175      Qux qux1 = new Qux("quux1", "corge1", "garply1", baz1);
176      Qux qux2 = new Qux("quux2", "corge2", "garply2", baz2);
177      client.jsonSet("qux1", new JSONObject(gson.toJson(qux1)));
178      client.jsonSet("qux2", new JSONObject(gson.toJson(qux2)));
179      List<JSONArray> list = client.jsonMGet(Path2.of("baz"), "qux1", "qux2");
180      assertEquals(2, list.size());
181      assertJsonArrayEquals(jsonArray(new JSONObject(gson.toJson(baz1))), list.get(0));
182      assertJsonArrayEquals(jsonArray(new JSONObject(gson.toJson(baz2))), list.get(1));
183    }
184    @Test
185    public void mgetAtRootPathWithMissingKeys() {
186      Baz baz1 = new Baz("quuz1", "grault1", "waldo1");
187      Baz baz2 = new Baz("quuz2", "grault2", "waldo2");
188      Qux qux1 = new Qux("quux1", "corge1", "garply1", baz1);
189      Qux qux2 = new Qux("quux2", "corge2", "garply2", baz2);
190      client.jsonSetWithEscape("qux1", qux1);
191      client.jsonSetWithEscape("qux2", qux2);
192      List<JSONArray> list = client.jsonMGet("qux1", "qux2", "qux3");
193      assertEquals(3, list.size());
194      assertNull(list.get(2));
195      list.removeAll(singletonList(null));
196      assertEquals(2, list.size());
197    }
198    @Test
199    public void arrLen() {
200      client.jsonSet("arr", ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
201      assertEquals(singletonList(5L), client.jsonArrLen("arr", ROOT_PATH));
202    }
203    @Test
204    public void clearArray() {
205      client.jsonSet("foobar", ROOT_PATH, gson.toJson(new FooBarObject()));
206      Path2 arrPath = Path2.of(".fooArr");
207      assertEquals(singletonList(3L), client.jsonArrLen("foobar", arrPath));
208      assertEquals(1L, client.jsonClear("foobar", arrPath));
209      assertEquals(singletonList(0L), client.jsonArrLen("foobar", arrPath));
210      Path2 strPath = Path2.of(".foo");
211      assertEquals(0L, client.jsonClear("foobar", strPath));
212      assertJsonArrayEquals(jsonArray("bar"), client.jsonGet("foobar", strPath));
213    }
214    @Test
215    public void clearObject() {
216      Baz baz = new Baz("quuz", "grault", "waldo");
217      Qux qux = new Qux("quux", "corge", "garply", baz);
218      client.jsonSet("qux", gson.toJson(qux));
219      Path2 objPath = Path2.of(".baz");
220      assertEquals(1L, client.jsonClear("qux", objPath));
221      assertJsonArrayEquals(jsonArray(new JSONObject()), client.jsonGet("qux", objPath));
222    }
223    @Test
224    public void arrAppendSameType() {
225      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: ['ello'] }}";
226      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
227      assertEquals(singletonList(6L), client.jsonArrAppend("test_arrappend", Path2.of(".b"), 4, 5, 6));
228      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3, 4, 5, 6)), client.jsonGet("test_arrappend", Path2.of(".b")));
229    }
230    @Test
231    public void arrAppendMultipleTypes() {
232      Object fooObject = gson.toJson("foo");
233      Object trueObject = gson.toJson(true);
234      Object nullObject = gson.toJson(null);
235      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: ['ello'] }}";
236      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
237      assertEquals(singletonList(6L), client.jsonArrAppend("test_arrappend", Path2.of(".b"), fooObject, trueObject, nullObject));
238      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3, "foo", true, null)), client.jsonGet("test_arrappend", Path2.of(".b")));
239    }
240    @Test
241    public void arrAppendMultipleTypesWithDeepPath() {
242      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: ['ello'] }}";
243      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
244      assertEquals(singletonList(4L), client.jsonArrAppendWithEscape("test_arrappend", Path2.of(".c.d"), "foo", true, null));
245      assertJsonArrayEquals(jsonArray(jsonArray("ello", "foo", true, null)), client.jsonGet("test_arrappend", Path2.of(".c.d")));
246    }
247    @Test
248    public void arrAppendAgaintsEmptyArray() {
249      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: [] }}";
250      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
251      assertEquals(singletonList(3L), client.jsonArrAppendWithEscape("test_arrappend", Path2.of(".c.d"), "a", "b", "c"));
252      assertJsonArrayEquals(jsonArray(jsonArray("a", "b", "c")), client.jsonGet("test_arrappend", Path2.of(".c.d")));
253    }
254    @Test
255    public void arrAppendPathIsNotArray() {
256      String json = "{ a: 'hello', b: [1, 2, 3], c: { d: ['ello'] }}";
257      client.jsonSet("test_arrappend", ROOT_PATH, new JSONObject(json));
258      assertEquals(singletonList(null), client.jsonArrAppend("test_arrappend", Path2.of(".a"), 1));
259      assertEquals(singletonList(null), client.jsonArrAppend("test_arrappend", Path2.of(".a"), gson.toJson(1)));
260      assertEquals(singletonList(null), client.jsonArrAppendWithEscape("test_arrappend", Path2.of(".a"), 1));
261    }
262    @Test(expected = JedisDataException.class)
263    public void arrIndexAbsentKey() {
264      client.jsonArrIndexWithEscape("quxquux", ROOT_PATH, new JSONObject());
265    }
266    @Test
267    public void arrIndexWithInts() {
268      client.jsonSetWithEscape("quxquux", ROOT_PATH, new int[]{8, 6, 7, 5, 3, 0, 9});
269      assertEquals(singletonList(2L), client.jsonArrIndexWithEscape("quxquux", ROOT_PATH, 7));
270      assertEquals(singletonList(-1L), client.jsonArrIndexWithEscape("quxquux", ROOT_PATH, "7"));
271    }
272    @Test
273    public void arrIndexWithStrings() {
274      client.jsonSetWithEscape("quxquux", ROOT_PATH, new String[]{"8", "6", "7", "5", "3", "0", "9"});
275      assertEquals(singletonList(2L), client.jsonArrIndexWithEscape("quxquux", ROOT_PATH, "7"));
276    }
277    @Test
278    public void arrIndexWithStringsAndPath() {
279      client.jsonSetWithEscape("foobar", ROOT_PATH, new FooBarObject());
280      assertEquals(singletonList(1L), client.jsonArrIndexWithEscape("foobar", Path2.of(".fooArr"), "b"));
281    }
282    @Test
283    public void arrIndexNonExistentPath() {
284      client.jsonSet("foobar", ROOT_PATH, gson.toJson(new FooBarObject()));
285      assertEquals(Collections.emptyList(), client.jsonArrIndex("foobar", Path2.of(".barArr"), gson.toJson("x")));
286    }
287    @Test
288    public void arrInsert() {
289      String json = "['hello', 'world', true, 1, 3, null, false]";
290      client.jsonSet("test_arrinsert", ROOT_PATH, new JSONArray(json));
291      assertEquals(singletonList(8L), client.jsonArrInsertWithEscape("test_arrinsert", ROOT_PATH, 1, "foo"));
292      assertJsonArrayEquals(jsonArray(jsonArray("hello", "foo", "world", true, 1, 3, null, false)),
293          client.jsonGet("test_arrinsert", ROOT_PATH));
294    }
295    @Test
296    public void arrInsertWithNegativeIndex() {
297      String json = "['hello', 'world', true, 1, 3, null, false]";
298      client.jsonSet("test_arrinsert", ROOT_PATH, new JSONArray(json));
299      assertEquals(singletonList(8L), client.jsonArrInsertWithEscape("test_arrinsert", ROOT_PATH, -1, "foo"));
300      assertJsonArrayEquals(jsonArray(jsonArray("hello", "world", true, 1, 3, null, "foo", false)),
301          client.jsonGet("test_arrinsert", ROOT_PATH));
302    }
303    @Test
304    public void arrPop() {
305      client.jsonSet("arr", ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
306      assertEquals(singletonList(4d), client.jsonArrPop("arr", ROOT_PATH));
307      assertEquals(singletonList(3d), client.jsonArrPop("arr", ROOT_PATH, -1));
308      assertEquals(singletonList(0d), client.jsonArrPop("arr", ROOT_PATH, 0));
309    }
310    @Test
311    public void arrTrim() {
312      client.jsonSet("arr", ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
313      assertEquals(singletonList(3L), client.jsonArrTrim("arr", ROOT_PATH, 1, 3));
314      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3)), client.jsonGet("arr", ROOT_PATH));
315    }
316    @Test
317    public void strAppend() {
318      client.jsonSet("str", ROOT_PATH, gson.toJson("foo"));
319      assertEquals(singletonList(6L), client.jsonStrAppend("str", ROOT_PATH, "bar"));
320      assertEquals("foobar", client.jsonGet("str"));
321    }
322    @Test
323    public void strLen() {
324      client.jsonSetWithEscape("str", "foobar");
325      assertEquals(singletonList(6L), client.jsonStrLen("str", ROOT_PATH));
326    }
327    @Test
328    public void numIncrBy() {
329      client.jsonSet("doc", "{\"a\":\"b\",\"b\":[{\"a\":2}, {\"a\":5}, {\"a\":\"c\"}]}");
330      assertJsonArrayEquals(jsonArray((Object) null), client.jsonNumIncrBy("doc", Path2.of(".a"), 1d));
331      assertJsonArrayEquals(jsonArray(null, 4, 7, null), client.jsonNumIncrBy("doc", Path2.of("..a"), 2d));
332      assertJsonArrayEquals(jsonArray((Object) null), client.jsonNumIncrBy("doc", Path2.of("..b"), 0d));
333      assertJsonArrayEquals(jsonArray(), client.jsonNumIncrBy("doc", Path2.of("..c"), 0d));
334    }
335    @Test
336    public void obj() {
337      String json = "{\"a\":[3], \"nested\": {\"a\": {\"b\":2, \"c\": 1}}}";
338      client.jsonSet("doc", ROOT_PATH, json);
339      assertEquals(Arrays.asList(2L), client.jsonObjLen("doc", ROOT_PATH));
340      assertEquals(Arrays.asList(Arrays.asList("a", "nested")), client.jsonObjKeys("doc", ROOT_PATH));
341      assertEquals(Arrays.asList(null, 2L), client.jsonObjLen("doc", Path2.of("..a")));
342      assertEquals(Arrays.asList(null, Arrays.asList("b", "c")), client.jsonObjKeys("doc", Path2.of("..a")));
343    }
344    @Test
345    public void debugMemory() {
346      assertEquals(Collections.emptyList(), client.jsonDebugMemory("json", ROOT_PATH));
347      client.jsonSet("json", new JSONObject("{ foo: 'bar', bar: { foo: 10 }}"));
348      client.jsonDebugMemory("json");
349      assertEquals(1, client.jsonDebugMemory("json", ROOT_PATH).size());
350      assertEquals(2, client.jsonDebugMemory("json", Path2.of("$..foo")).size());
351      assertEquals(1, client.jsonDebugMemory("json", Path2.of("$..bar")).size());
352    }
353    @Test
354    public void resp() {
355      assertNull(client.jsonResp("resp", ROOT_PATH));
356      String json = "{\"foo\": {\"hello\":\"world\"}, \"bar\": [null, 3, 2.5, true]}";
357      client.jsonSet("resp", ROOT_PATH, json);
358      List<List<Object>> fullResp = client.jsonResp("resp", ROOT_PATH);
359      assertEquals(1, fullResp.size());
360      List<Object> resp = fullResp.get(0);
361      assertEquals("{", resp.get(0));
362      assertEquals("foo", resp.get(1));
363      assertEquals(Arrays.asList("{", "hello", "world"), resp.get(2));
364      assertEquals("bar", resp.get(3));
365      List<Object> arr = (List<Object>) resp.get(4);
366      assertEquals("[", arr.get(0));
367      assertNull(arr.get(1));
368      assertEquals(Long.valueOf(3), arr.get(2));
369      MatcherAssert.assertThat(arr.get(3), Matchers.isOneOf("2.5", 2.5));
370      assertEquals("true", arr.get(4));
371    }
372    private void assertJsonArrayEquals(JSONArray a, Object _b) {
373      if (!(_b instanceof JSONArray)) {
374        fail("Actual value is not JSONArray.");
375      }
376      JSONArray b = (JSONArray) _b;
377      assertEquals("JSONArray length mismatch", a.length(), b.length());
378      int length = a.length();
379      for (int index = 0; index < length; index++) {
380        if (a.isNull(index)) {
381          assertTrue(index + "'th element is not null", b.isNull(index));
382          continue;
383        }
384        Object ia = a.get(index);
385        Object ib = b.get(index);
386        if (ia instanceof JSONArray) {
387          assertJsonArrayEquals((JSONArray) ia, ib);
388        } else if (ia instanceof JSONObject) {
389          assertJsonObjectEquals((JSONObject) ia, ib);
390        } else if (ia instanceof Number && ib instanceof Number) {
391          assertEquals(index + "'th element mismatch", ((Number) ia).doubleValue(), ((Number) ib).doubleValue(), 0d);
392        } else {
393          assertEquals(index + "'th element mismatch", ia, ib);
394        }
395      }
396    }
397    private void assertJsonObjectEquals(JSONObject a, Object _b) {
398      if (!(_b instanceof JSONObject)) {
399        fail("Actual value is not JSONObject.");
400      }
401      JSONObject b = (JSONObject) _b;
402      assertEquals("JSONObject length mismatch", a.length(), b.length());
403      assertEquals(a.keySet(), b.keySet());
404      for (String key : a.keySet()) {
405        if (a.isNull(key)) {
406          assertTrue(key + "'s value is not null", b.isNull(key));
407          continue;
408        }
409        Object oa = a.get(key);
410        Object ob = b.get(key);
411        if (oa instanceof JSONArray) {
412          assertJsonArrayEquals((JSONArray) oa, ob);
413        } else if (oa instanceof JSONObject) {
414          assertJsonObjectEquals((JSONObject) oa, ob);
415        } else {
416          assertEquals(key + "'s value mismatch", oa, ob);
417        }
418      }
419    }
420    private static JSONArray jsonArray(Object... objects) {
421      JSONArray arr = new JSONArray();
422      for (Object o : objects) {
423        arr.put(o);
424      }
425      return arr;
426    }
427  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-JedisCluster.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RedisJsonV2Test.java</div>
                <div class="column column_space"><pre><code>131        GenericObjectPoolConfig<Connection> poolConfig, boolean ssl) {
132      this(clusterNodes, DefaultJedisClientConfig.builder().connectionTimeoutMillis(connectionTimeout)
133          .socketTimeoutMillis(soTimeout).user(user).password(password).clientName(clientName).ssl(ssl).build(),
134          maxAttempts, poolConfig);
135    }
136    public JedisCluster(Set<HostAndPort> clusterNodes, JedisClientConfig clientConfig,
</pre></code></div>
                <div class="column column_space"><pre><code>81      JSONObject result = (JSONObject) client.jsonGet("obj", Path2.of("bool"), Path2.of("str"));
82      assertJsonArrayEquals(jsonArray(true), result.get("$.bool"));
83      assertJsonArrayEquals(jsonArray("string"), result.get("$.str"));
84    }
85    @Test
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    