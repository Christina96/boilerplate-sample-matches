
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 18, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.hamcrest.MatcherAssert.assertThat;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.Protocol.Command.BLPOP;
5  import static redis.clients.jedis.Protocol.Command.HGETALL;
6  import static redis.clients.jedis.Protocol.Command.GET;
7  import static redis.clients.jedis.Protocol.Command.LRANGE;
8  import static redis.clients.jedis.Protocol.Command.PING;
9  import static redis.clients.jedis.Protocol.Command.RPUSH;
10  import static redis.clients.jedis.Protocol.Command.SET;
11  import static redis.clients.jedis.Protocol.Command.XINFO;
12  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
13  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
14  import java.util.*;
15  import org.hamcrest.Matchers;
16  import org.junit.Assume;
17  import org.junit.Test;
18  import redis.clients.jedis.HostAndPort;
19  import redis.clients.jedis.Jedis;
20  import redis.clients.jedis.args.ExpiryOption;
21  import redis.clients.jedis.params.ScanParams;
22  import redis.clients.jedis.resps.ScanResult;
23  import redis.clients.jedis.StreamEntryID;
24  import redis.clients.jedis.args.FlushMode;
25  import redis.clients.jedis.params.RestoreParams;
26  import redis.clients.jedis.HostAndPorts;
27  import redis.clients.jedis.RedisProtocol;
28  import redis.clients.jedis.util.SafeEncoder;
29  import redis.clients.jedis.exceptions.JedisDataException;
30  import redis.clients.jedis.params.SetParams;
31  import redis.clients.jedis.util.AssertUtil;
32  import redis.clients.jedis.util.KeyValue;
33  import redis.clients.jedis.util.RedisProtocolUtil;
34  public class AllKindOfValuesCommandsTest extends JedisCommandsTestBase {
35    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
36    final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x0A };
37    final byte[] bfoo2 = { 0x01, 0x02, 0x03, 0x04, 0x0B };
38    final byte[] bfoo3 = { 0x01, 0x02, 0x03, 0x04, 0x0C };
39    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
40    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
41    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
42    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
43    final byte[] bfoobar = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 };
44    final byte[] bfoostar = { 0x01, 0x02, 0x03, 0x04, '*' };
45    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
46    final byte[] bnx = { 0x6E, 0x78 };
47    final byte[] bex = { 0x65, 0x78 };
48    final int expireSeconds = 2;
49    private static final HostAndPort lfuHnp = HostAndPorts.getRedisServers().get(7);
50    @Test
51    public void ping() {
52      String status = jedis.ping();
53      assertEquals("PONG", status);
54    }
55    @Test
56    public void pingWithMessage() {
57      String argument = "message";
58      assertEquals(argument, jedis.ping(argument));
59      assertArrayEquals(bfoobar, jedis.ping(bfoobar));
60    }
61    @Test
62    public void exists() {
63      String status = jedis.set("foo", "bar");
64      assertEquals("OK", status);
65      status = jedis.set(bfoo, bbar);
66      assertEquals("OK", status);
67      assertTrue(jedis.exists("foo"));
68      assertTrue(jedis.exists(bfoo));
69      assertEquals(1L, jedis.del("foo"));
70      assertEquals(1L, jedis.del(bfoo));
71      assertFalse(jedis.exists("foo"));
72      assertFalse(jedis.exists(bfoo));
73    }
74    @Test
75    public void existsMany() {
76      String status = jedis.set("foo1", "bar1");
77      assertEquals("OK", status);
78      status = jedis.set("foo2", "bar2");
79      assertEquals("OK", status);
80      assertEquals(2L, jedis.exists("foo1", "foo2"));
81      assertEquals(1L, jedis.del("foo1"));
82      assertEquals(1L, jedis.exists("foo1", "foo2"));
83    }
84    @Test
85    public void del() {
86      jedis.set("foo1", "bar1");
87      jedis.set("foo2", "bar2");
88      jedis.set("foo3", "bar3");
89      assertEquals(3L, jedis.del("foo1", "foo2", "foo3"));
90      assertFalse(jedis.exists("foo1"));
91      assertFalse(jedis.exists("foo2"));
92      assertFalse(jedis.exists("foo3"));
93      jedis.set("foo1", "bar1");
94      assertEquals(1L, jedis.del("foo1", "foo2"));
95      assertEquals(0L, jedis.del("foo1", "foo2"));
96      jedis.set(bfoo1, bbar1);
97      jedis.set(bfoo2, bbar2);
98      jedis.set(bfoo3, bbar3);
99      assertEquals(3L, jedis.del(bfoo1, bfoo2, bfoo3));
100      assertFalse(jedis.exists(bfoo1));
101      assertFalse(jedis.exists(bfoo2));
102      assertFalse(jedis.exists(bfoo3));
103      jedis.set(bfoo1, bbar1);
104      assertEquals(1, jedis.del(bfoo1, bfoo2));
105      assertEquals(0, jedis.del(bfoo1, bfoo2));
106    }
107    @Test
108    public void unlink() {
109      jedis.set("foo1", "bar1");
110      jedis.set("foo2", "bar2");
111      jedis.set("foo3", "bar3");
112      assertEquals(3, jedis.unlink("foo1", "foo2", "foo3"));
113      assertEquals(0, jedis.exists("foo1", "foo2", "foo3"));
114      jedis.set("foo1", "bar1");
115      assertEquals(1, jedis.unlink("foo1", "foo2"));
116      assertEquals(0, jedis.unlink("foo1", "foo2"));
117      jedis.set("foo", "bar");
118      assertEquals(1, jedis.unlink("foo"));
119      assertFalse(jedis.exists("foo"));
120      jedis.set(bfoo1, bbar1);
121      jedis.set(bfoo2, bbar2);
122      jedis.set(bfoo3, bbar3);
123      assertEquals(3, jedis.unlink(bfoo1, bfoo2, bfoo3));
124      assertEquals(0, jedis.exists(bfoo1, bfoo2, bfoo3));
125      jedis.set(bfoo1, bbar1);
126      assertEquals(1, jedis.unlink(bfoo1, bfoo2));
127      assertEquals(0, jedis.unlink(bfoo1, bfoo2));
128      jedis.set(bfoo, bbar);
129      assertEquals(1, jedis.unlink(bfoo));
130      assertFalse(jedis.exists(bfoo));
131    }
132    @Test
133    public void type() {
134      jedis.set("foo", "bar");
135      assertEquals("string", jedis.type("foo"));
136      jedis.set(bfoo, bbar);
137      assertEquals("string", jedis.type(bfoo));
138    }
139    @Test
140    public void keys() {
141      jedis.set("foo", "bar");
142      jedis.set("foobar", "bar");
143      Set<String> keys = jedis.keys("foo*");
144      AssertUtil.assertCollectionContains(keys, "foo");
145      AssertUtil.assertCollectionContains(keys, "foobar");
146      assertEquals(Collections.emptySet(), jedis.keys("bar*"));
147      jedis.set(bfoo, bbar);
148      jedis.set(bfoobar, bbar);
149      Set<byte[]> bkeys = jedis.keys(bfoostar);
150      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoo);
151      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoobar);
152      assertEquals(Collections.emptySet(), jedis.keys(bbarstar));
153    }
154    @Test
155    public void randomKey() {
156      assertNull(jedis.randomKey());
157      jedis.set("foo", "bar");
158      assertEquals("foo", jedis.randomKey());
159      jedis.set("bar", "foo");
160      String randomkey = jedis.randomKey();
161      assertTrue(randomkey.equals("foo") || randomkey.equals("bar"));
162      jedis.del("foo");
163      jedis.del("bar");
164      assertNull(jedis.randomKey());
165      jedis.set(bfoo, bbar);
166      assertArrayEquals(bfoo, jedis.randomBinaryKey());
167      jedis.set(bbar, bfoo);
168      byte[] randomBkey = jedis.randomBinaryKey();
169      assertTrue(Arrays.equals(randomBkey, bfoo) || Arrays.equals(randomBkey, bbar));
170    }
171    @Test
172    public void rename() {
173      jedis.set("foo", "bar");
174      String status = jedis.rename("foo", "bar");
175      assertEquals("OK", status);
176      assertNull(jedis.get("foo"));
177      assertEquals("bar", jedis.get("bar"));
178      jedis.set(bfoo, bbar);
179      String bstatus = jedis.rename(bfoo, bbar);
180      assertEquals("OK", bstatus);
181      assertNull(jedis.get(bfoo));
182      assertArrayEquals(bbar, jedis.get(bbar));
183    }
184    @Test
185    public void renameOldAndNewAreTheSame() {
186      assertEquals("OK", jedis.set("foo", "bar"));
187      assertEquals("OK", jedis.rename("foo", "foo"));
188      assertEquals("OK", jedis.set(bfoo, bbar));
189      assertEquals("OK", jedis.rename(bfoo, bfoo));
190    }
191    @Test
192    public void renamenx() {
193      jedis.set("foo", "bar");
194      assertEquals(1, jedis.renamenx("foo", "bar"));
195      jedis.set("foo", "bar");
196      assertEquals(0, jedis.renamenx("foo", "bar"));
197      jedis.set(bfoo, bbar);
198      assertEquals(1, jedis.renamenx(bfoo, bbar));
199      jedis.set(bfoo, bbar);
200      assertEquals(0, jedis.renamenx(bfoo, bbar));
201    }
202    @Test
203    public void dbSize() {
204      assertEquals(0, jedis.dbSize());
205      jedis.set("foo", "bar");
206      assertEquals(1, jedis.dbSize());
207      jedis.set(bfoo, bbar);
208      assertEquals(2, jedis.dbSize());
209    }
210    @Test
211    public void expire() {
212      assertEquals(0, jedis.expire("foo", 20L));
213      jedis.set("foo", "bar");
214      assertEquals(1, jedis.expire("foo", 20L));
215      assertEquals(0, jedis.expire("foo", 20L, ExpiryOption.NX));
216      assertEquals(0, jedis.expire(bfoo, 20L));
217      jedis.set(bfoo, bbar);
218      assertEquals(1, jedis.expire(bfoo, 20L));
219      assertEquals(0, jedis.expire(bfoo, 20L, ExpiryOption.NX));
220    }
221    @Test
222    public void expireAt() {
223      long unixTime = (System.currentTimeMillis() / 1000L) + 20;
224      assertEquals(0, jedis.expireAt("foo", unixTime));
225      jedis.set("foo", "bar");
226      unixTime = (System.currentTimeMillis() / 1000L) + 20;
227      assertEquals(1, jedis.expireAt("foo", unixTime));
228      assertEquals(1, jedis.expireAt("foo", unixTime, ExpiryOption.XX));
229      assertEquals(0, jedis.expireAt(bfoo, unixTime));
230      jedis.set(bfoo, bbar);
231      unixTime = (System.currentTimeMillis() / 1000L) + 20;
232      assertEquals(1, jedis.expireAt(bfoo, unixTime));
233      assertEquals(1, jedis.expireAt(bfoo, unixTime, ExpiryOption.XX));
234    }
235    @Test
236    public void expireTime() {
237      long unixTime;
238      jedis.set("foo", "bar");
239      unixTime = (System.currentTimeMillis() / 1000L) + 20;
240      jedis.expireAt("foo", unixTime);
241      assertEquals(unixTime, jedis.expireTime("foo"), 0.0001);
242      jedis.set(bfoo, bbar);
243      unixTime = (System.currentTimeMillis() / 1000L) + 20;
244      jedis.expireAt(bfoo, unixTime);
245      assertEquals(unixTime, jedis.expireTime(bfoo), 0.0001);
246    }
247    @Test
248    public void ttl() {
249      assertEquals(-2, jedis.ttl("foo"));
250      jedis.set("foo", "bar");
251      assertEquals(-1, jedis.ttl("foo"));
252      jedis.expire("foo", 20);
253      long ttl = jedis.ttl("foo");
254      assertTrue(ttl >= 0 && ttl <= 20);
255      assertEquals(-2, jedis.ttl(bfoo));
256      jedis.set(bfoo, bbar);
257      assertEquals(-1, jedis.ttl(bfoo));
258      jedis.expire(bfoo, 20);
259      long bttl = jedis.ttl(bfoo);
260      assertTrue(bttl >= 0 && bttl <= 20);
261    }
262    @Test
263    public void touch() throws Exception {
264      assertEquals(0, jedis.touch("foo1", "foo2", "foo3"));
265      jedis.set("foo1", "bar1");
266      Thread.sleep(1100); 
267      assertTrue(jedis.objectIdletime("foo1") > 0);
268      assertEquals(1, jedis.touch("foo1"));
269      assertEquals(0L, jedis.objectIdletime("foo1").longValue());
270      assertEquals(1, jedis.touch("foo1", "foo2", "foo3"));
271      jedis.set("foo2", "bar2");
272      jedis.set("foo3", "bar3");
273      assertEquals(3, jedis.touch("foo1", "foo2", "foo3"));
274      assertEquals(0, jedis.touch(bfoo1, bfoo2, bfoo3));
275      jedis.set(bfoo1, bbar1);
276      Thread.sleep(1100); 
277      assertTrue(jedis.objectIdletime(bfoo1) > 0);
278      assertEquals(1, jedis.touch(bfoo1));
279      assertEquals(0L, jedis.objectIdletime(bfoo1).longValue());
280      assertEquals(1, jedis.touch(bfoo1, bfoo2, bfoo3));
281      jedis.set(bfoo2, bbar2);
282      jedis.set(bfoo3, bbar3);
283      assertEquals(3, jedis.touch(bfoo1, bfoo2, bfoo3));
284    }
285    @Test
286    public void select() {
287      jedis.set("foo", "bar");
288      String status = jedis.select(1);
289      assertEquals("OK", status);
290      assertNull(jedis.get("foo"));
291      status = jedis.select(0);
292      assertEquals("OK", status);
293      assertEquals("bar", jedis.get("foo"));
294      jedis.set(bfoo, bbar);
295      String bstatus = jedis.select(1);
296      assertEquals("OK", bstatus);
297      assertNull(jedis.get(bfoo));
298      bstatus = jedis.select(0);
299      assertEquals("OK", bstatus);
300      assertArrayEquals(bbar, jedis.get(bfoo));
301    }
302    @Test
303    public void getDB() {
304      assertEquals(0, jedis.getDB());
305      jedis.select(1);
306      assertEquals(1, jedis.getDB());
307    }
308    @Test
309    public void move() {
310      assertEquals(0, jedis.move("foo", 1));
311      jedis.set("foo", "bar");
312      assertEquals(1, jedis.move("foo", 1));
313      assertNull(jedis.get("foo"));
314      jedis.select(1);
315      assertEquals("bar", jedis.get("foo"));
316      jedis.select(0);
317      assertEquals(0, jedis.move(bfoo, 1));
318      jedis.set(bfoo, bbar);
319      assertEquals(1, jedis.move(bfoo, 1));
320      assertNull(jedis.get(bfoo));
321      jedis.select(1);
322      assertArrayEquals(bbar, jedis.get(bfoo));
323    }
324    @Test
325    public void swapDB() {
326      jedis.set("foo1", "bar1");
327      jedis.select(1);
328      assertNull(jedis.get("foo1"));
329      jedis.set("foo2", "bar2");
330      String status = jedis.swapDB(0, 1);
331      assertEquals("OK", status);
332      assertEquals("bar1", jedis.get("foo1"));
333      assertNull(jedis.get("foo2"));
334      jedis.select(0);
335      assertNull(jedis.get("foo1"));
336      assertEquals("bar2", jedis.get("foo2"));
337      jedis.set(bfoo1, bbar1);
338      jedis.select(1);
339      assertArrayEquals(null, jedis.get(bfoo1));
340      jedis.set(bfoo2, bbar2);
341      status = jedis.swapDB(0, 1);
342      assertEquals("OK", status);
343      assertArrayEquals(bbar1, jedis.get(bfoo1));
344      assertArrayEquals(null, jedis.get(bfoo2));
345      jedis.select(0);
346      assertArrayEquals(null, jedis.get(bfoo1));
347      assertArrayEquals(bbar2, jedis.get(bfoo2));
348    }
349    @Test
350    public void flushDB() {
351      jedis.set("foo", "bar");
352      assertEquals(1, jedis.dbSize());
353      jedis.set("bar", "foo");
354      jedis.move("bar", 1);
355      String status = jedis.flushDB();
356      assertEquals("OK", status);
357      assertEquals(0, jedis.dbSize());
358      jedis.select(1);
359      assertEquals(1, jedis.dbSize());
360      assertEquals("OK", jedis.flushDB(FlushMode.SYNC));
361      assertEquals(0, jedis.dbSize());
362      jedis.select(0);
363      jedis.set(bfoo, bbar);
364      assertEquals(1, jedis.dbSize());
365      jedis.set(bbar, bfoo);
366      jedis.move(bbar, 1);
367      String bstatus = jedis.flushDB();
368      assertEquals("OK", bstatus);
369      assertEquals(0, jedis.dbSize());
370      jedis.select(1);
371      assertEquals(1, jedis.dbSize());
372      assertEquals("OK", jedis.flushDB(FlushMode.ASYNC));
373      assertEquals(0, jedis.dbSize());
374    }
375    @Test
376    public void flushAll() {
377      jedis.set("foo", "bar");
378      assertEquals(1, jedis.dbSize());
379      jedis.set("bar", "foo");
380      jedis.move("bar", 1);
381      String status = jedis.flushAll();
382      assertEquals("OK", status);
383      assertEquals(0, jedis.dbSize());
384      jedis.select(1);
385      assertEquals(0, jedis.dbSize());
386      jedis.set("foo", "bar");
387      assertEquals(1, jedis.dbSize());
388      assertEquals("OK", jedis.flushAll(FlushMode.SYNC));
389      assertEquals(0, jedis.dbSize());
390      jedis.select(0);
391      jedis.set(bfoo, bbar);
392      assertEquals(1, jedis.dbSize());
393      jedis.set(bbar, bfoo);
<span onclick='openModal()' class='match'>394      jedis.move(bbar, 1);
395      String bstatus = jedis.flushAll();
396      assertEquals("OK", bstatus);
</span>397      assertEquals(0, jedis.dbSize());
398      jedis.select(1);
399      assertEquals(0, jedis.dbSize());
400      jedis.set(bfoo, bbar);
401      assertEquals(1, jedis.dbSize());
402      assertEquals("OK", jedis.flushAll(FlushMode.ASYNC));
403      assertEquals(0, jedis.dbSize());
404    }
405    @Test
406    public void persist() {
407      jedis.setex("foo", 60 * 60, "bar");
408      assertTrue(jedis.ttl("foo") > 0);
409      assertEquals(1, jedis.persist("foo"));
410      assertEquals(-1, jedis.ttl("foo"));
411      jedis.setex(bfoo, 60 * 60, bbar);
412      assertTrue(jedis.ttl(bfoo) > 0);
413      assertEquals(1, jedis.persist(bfoo));
414      assertEquals(-1, jedis.ttl(bfoo));
415    }
416    @Test
417    public void echo() {
418      String result = jedis.echo("hello world");
419      assertEquals("hello world", result);
420      byte[] bresult = jedis.echo(SafeEncoder.encode("hello world"));
421      assertArrayEquals(SafeEncoder.encode("hello world"), bresult);
422    }
423    @Test
424    public void dumpAndRestore() {
425      jedis.set("foo1", "bar");
426      byte[] sv = jedis.dump("foo1");
427      jedis.restore("foo2", 0, sv);
428      assertEquals("bar", jedis.get("foo2"));
429      jedis.set(bfoo1, bbar);
430      sv = jedis.dump(bfoo1);
431      jedis.restore(bfoo2, 0, sv);
432      assertArrayEquals(bbar, jedis.get(bfoo2));
433    }
434    @Test
435    public void restoreParams() {
436      Jedis jedis2 = new Jedis(hnp.getHost(), 6380, 500);
437      jedis2.auth("foobared");
438      jedis2.flushAll();
439      jedis2.set("foo", "bar");
440      jedis.set("from", "a");
441      byte[] serialized = jedis.dump("from");
442      try {
443        jedis2.restore("foo", 0, serialized);
444        fail("Simple restore on a existing key should fail");
445      } catch (JedisDataException e) {
446      }
447      try {
448        jedis2.restore("foo", 0, serialized, RestoreParams.restoreParams());
449        fail("Simple restore on a existing key should fail");
450      } catch (JedisDataException e) {
451      }
452      assertEquals("bar", jedis2.get("foo"));
453      jedis2.restore("foo", 1000, serialized, RestoreParams.restoreParams().replace());
454      assertEquals("a", jedis2.get("foo"));
455      assertTrue(jedis2.pttl("foo") <= 1000);
456      jedis2.restore("bar", System.currentTimeMillis() + 1000, serialized, RestoreParams.restoreParams().replace().absTtl());
457      assertTrue(jedis2.pttl("bar") <= 1000);
458      jedis2.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().idleTime(1000));
459      assertEquals(1000, jedis2.objectIdletime("bar1").longValue());
460      jedis2.close();
461      Jedis lfuJedis = new Jedis(lfuHnp.getHost(), lfuHnp.getPort(), 500);
462      lfuJedis.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().frequency(90));
463      assertEquals(90, lfuJedis.objectFreq("bar1").longValue());
464      lfuJedis.close();
465    }
466    @Test
467    public void pexpire() {
468      assertEquals(0, jedis.pexpire("foo", 10000));
469      jedis.set("foo1", "bar1");
470      assertEquals(1, jedis.pexpire("foo1", 10000));
471      jedis.set("foo2", "bar2");
472      assertEquals(1, jedis.pexpire("foo2", 200000000000L));
473      assertEquals(0, jedis.pexpire("foo2", 10000000, ExpiryOption.NX));
474      assertEquals(1, jedis.pexpire("foo2", 10000000, ExpiryOption.XX));
475      assertEquals(0, jedis.pexpire("foo2", 10000, ExpiryOption.GT));
476      assertEquals(1, jedis.pexpire("foo2", 10000, ExpiryOption.LT));
477      long pttl = jedis.pttl("foo2");
478      assertTrue(pttl > 100L);
479      assertEquals(0, jedis.pexpire(bfoo, 10000));
480      jedis.set(bfoo, bbar);
481      assertEquals(1, jedis.pexpire(bfoo, 10000));
482      assertEquals(0, jedis.pexpire(bfoo, 10000, ExpiryOption.NX));
483    }
484    @Test
485    public void pexpireAt() {
486      long unixTime = (System.currentTimeMillis()) + 10000;
487      assertEquals(0, jedis.pexpireAt("foo", unixTime));
488      jedis.set("foo", "bar");
489      assertEquals(1, jedis.pexpireAt("foo", unixTime));
490      assertEquals(0, jedis.pexpireAt(bfoo, unixTime));
491      jedis.set(bfoo, bbar);
492      assertEquals(1, jedis.pexpireAt(bfoo, unixTime));
493    }
494    @Test
495    public void pexpireTime() {
496      long unixTime = (System.currentTimeMillis()) + 10000;
497      jedis.set("foo", "bar");
498      jedis.pexpireAt("foo", unixTime);
499      assertEquals(unixTime, jedis.pexpireTime("foo"), 0.0001);
500      jedis.set(bfoo, bbar);
501      jedis.pexpireAt(bfoo, unixTime);
502      assertEquals(unixTime, jedis.pexpireTime(bfoo), 0.0001);
503    }
504    @Test
505    public void pttl() {
506      assertEquals(-2, jedis.pttl("foo"));
507      jedis.set("foo", "bar");
508      assertEquals(-1, jedis.pttl("foo"));
509      jedis.pexpire("foo", 20000);
510      long pttl = jedis.pttl("foo");
511      assertTrue(pttl >= 0 && pttl <= 20000);
512      assertEquals(-2, jedis.pttl(bfoo));
513      jedis.set(bfoo, bbar);
514      assertEquals(-1, jedis.pttl(bfoo));
515      jedis.pexpire(bfoo, 20000);
516      pttl = jedis.pttl(bfoo);
517      assertTrue(pttl >= 0 && pttl <= 20000);
518    }
519    @Test
520    public void psetex() {
521      long pttl;
522      jedis.psetex("foo", 200000000000L, "bar");
523      pttl = jedis.pttl("foo");
524      assertTrue(pttl > 100000000000L);
525      jedis.psetex(bfoo, 200000000000L, bbar);
526      pttl = jedis.pttl(bfoo);
527      assertTrue(pttl > 100000000000L);
528    }
529    @Test
530    public void scan() {
531      jedis.set("b", "b");
532      jedis.set("a", "a");
533      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
534      assertEquals(SCAN_POINTER_START, result.getCursor());
535      assertFalse(result.getResult().isEmpty());
536      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY);
537      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
538      assertFalse(bResult.getResult().isEmpty());
539    }
540    @Test
541    public void scanMatch() {
542      ScanParams params = new ScanParams();
543      params.match("a*");
544      jedis.set("b", "b");
545      jedis.set("a", "a");
546      jedis.set("aa", "aa");
547      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
548      assertEquals(SCAN_POINTER_START, result.getCursor());
549      assertFalse(result.getResult().isEmpty());
550      params = new ScanParams();
551      params.match(bfoostar);
552      jedis.set(bfoo1, bbar);
553      jedis.set(bfoo2, bbar);
554      jedis.set(bfoo3, bbar);
555      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
556      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
557      assertFalse(bResult.getResult().isEmpty());
558    }
559    @Test
560    public void scanCount() {
561      ScanParams params = new ScanParams();
562      params.count(2);
563      for (int i = 0; i < 10; i++) {
564        jedis.set("a" + i, "a" + i);
565      }
566      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
567      assertFalse(result.getResult().isEmpty());
568      params = new ScanParams();
569      params.count(2);
570      jedis.set(bfoo1, bbar);
571      jedis.set(bfoo2, bbar);
572      jedis.set(bfoo3, bbar);
573      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
574      assertFalse(bResult.getResult().isEmpty());
575    }
576    @Test
577    public void scanType() {
578      ScanParams noParams = new ScanParams();
579      ScanParams pagingParams = new ScanParams().count(4);
580      jedis.set("a", "a");
581      jedis.hset("b", "b", "b");
582      jedis.set("c", "c");
583      jedis.sadd("d", "d");
584      jedis.set("e", "e");
585      jedis.zadd("f", 0d, "f");
586      jedis.set("g", "g");
587      ScanResult<String> scanResult;
588      scanResult = jedis.scan(SCAN_POINTER_START, pagingParams, "string");
589      assertFalse(scanResult.isCompleteIteration());
590      int page1Count = scanResult.getResult().size();
591      scanResult = jedis.scan(scanResult.getCursor(), pagingParams, "string");
592      assertTrue(scanResult.isCompleteIteration());
593      int page2Count = scanResult.getResult().size();
594      assertEquals(4, page1Count + page2Count);
595      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "hash");
596      assertEquals(Collections.singletonList("b"), scanResult.getResult());
597      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "set");
598      assertEquals(Collections.singletonList("d"), scanResult.getResult());
599      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "zset");
600      assertEquals(Collections.singletonList("f"), scanResult.getResult());
601      final byte[] string = "string".getBytes();
602      final byte[] hash = "hash".getBytes();
603      final byte[] set = "set".getBytes();
604      final byte[] zset = "zset".getBytes();
605      ScanResult<byte[]> binaryResult;
606      jedis.set("a", "a");
607      jedis.hset("b", "b", "b");
608      jedis.set("c", "c");
609      jedis.sadd("d", "d");
610      jedis.set("e", "e");
611      jedis.zadd("f", 0d, "f");
612      jedis.set("g", "g");
613      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, pagingParams, string);
614      assertFalse(binaryResult.isCompleteIteration());
615      page1Count = binaryResult.getResult().size();
616      binaryResult = jedis.scan(binaryResult.getCursorAsBytes(), pagingParams, string);
617      assertTrue(binaryResult.isCompleteIteration());
618      page2Count = binaryResult.getResult().size();
619      assertEquals(4, page1Count + page2Count);
620      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, hash);
621      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{98}), binaryResult.getResult());
622      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, set);
623      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{100}), binaryResult.getResult());
624      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, zset);
625      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{102}), binaryResult.getResult());
626    }
627    @Test
628    public void scanIsCompleteIteration() {
629      for (int i = 0; i < 100; i++) {
630        jedis.set("a" + i, "a" + i);
631      }
632      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
633      assertFalse(result.isCompleteIteration());
634      result = scanCompletely(result.getCursor());
635      assertNotNull(result);
636      assertTrue(result.isCompleteIteration());
637    }
638    private ScanResult<String> scanCompletely(String cursor) {
639      ScanResult<String> scanResult;
640      do {
641        scanResult = jedis.scan(cursor);
642        cursor = scanResult.getCursor();
643      } while (!SCAN_POINTER_START.equals(scanResult.getCursor()));
644      return scanResult;
645    }
646    @Test
647    public void setNxExAndGet() {
648      assertEquals("OK", jedis.set("hello", "world", SetParams.setParams().nx().ex(expireSeconds)));
649      assertEquals("world", jedis.get("hello"));
650      assertNull(jedis.set("hello", "bar", SetParams.setParams().nx().ex(expireSeconds)));
651      assertEquals("world", jedis.get("hello"));
652      long ttl = jedis.ttl("hello");
653      assertTrue(ttl > 0 && ttl <= expireSeconds);
654      byte[] bworld = { 0x77, 0x6F, 0x72, 0x6C, 0x64 };
655      byte[] bhello = { 0x68, 0x65, 0x6C, 0x6C, 0x6F };
656      assertEquals("OK", jedis.set(bworld, bhello, SetParams.setParams().nx().ex(expireSeconds)));
657      assertArrayEquals(bhello, jedis.get(bworld));
658      assertNull(jedis.set(bworld, bbar, SetParams.setParams().nx().ex(expireSeconds)));
659      assertArrayEquals(bhello, jedis.get(bworld));
660      long bttl = jedis.ttl(bworld);
661      assertTrue(bttl > 0 && bttl <= expireSeconds);
662    }
663    @Test
664    public void setGetOptionTest() {
665      assertEquals("OK", jedis.set("hello", "world"));
666      assertEquals("world", jedis.setGet("hello", "jedis"));
667      assertEquals("jedis", jedis.get("hello"));
668      assertNull(jedis.setGet("key", "value"));
669    }
670    @Test
671    public void setGet() {
672      assertEquals("OK", jedis.set("hello", "world"));
673      assertEquals("world", jedis.setGet("hello", "jedis", SetParams.setParams()));
674      assertEquals("jedis", jedis.get("hello"));
675      assertNull(jedis.setGet("key", "value", SetParams.setParams()));
676    }
677    @Test
678    public void sendCommandTest() {
679      Object obj = jedis.sendCommand(SET, "x", "1");
680      String returnValue = SafeEncoder.encode((byte[]) obj);
681      assertEquals("OK", returnValue);
682      obj = jedis.sendCommand(GET, "x");
683      returnValue = SafeEncoder.encode((byte[]) obj);
684      assertEquals("1", returnValue);
685      jedis.sendCommand(RPUSH, "foo", "a");
686      jedis.sendCommand(RPUSH, "foo", "b");
687      jedis.sendCommand(RPUSH, "foo", "c");
688      obj = jedis.sendCommand(LRANGE, "foo", "0", "2");
689      List<byte[]> list = (List<byte[]>) obj;
690      List<byte[]> expected = new ArrayList<>(3);
691      expected.add("a".getBytes());
692      expected.add("b".getBytes());
693      expected.add("c".getBytes());
694      for (int i = 0; i < 3; i++)
695        assertArrayEquals(expected.get(i), list.get(i));
696      assertEquals("PONG", SafeEncoder.encode((byte[]) jedis.sendCommand(PING)));
697    }
698    @Test
699    public void sendBlockingCommandTest() {
700      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
701      jedis.sendCommand(RPUSH, "foo", "bar");
702      assertEquals(Arrays.asList("foo", "bar"),
703        SafeEncoder.encodeObject(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L))));
704      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
705    }
706    @Test
707    public void encodeCompleteResponsePing() {
708      assertEquals("PONG", SafeEncoder.encodeObject(jedis.sendCommand(PING)));
709    }
710    @Test
711    public void encodeCompleteResponseHgetall() {
712      Assume.assumeFalse(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
713      HashMap<String, String> entries = new HashMap<>();
714      entries.put("foo", "bar");
715      entries.put("foo2", "bar2");
716      jedis.hset("hash:test:encode", entries);
717      List encodeObj = (List) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
718      assertEquals(4, encodeObj.size());
719      entries.forEach((k, v) -> {
720        assertThat((Iterable<String>) encodeObj, Matchers.hasItem(k));
721        assertEquals(v, findValueFromMapAsList(encodeObj, k));
722      });
723    }
724    @Test
725    public void encodeCompleteResponseHgetallResp3() {
726      Assume.assumeTrue(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
727      HashMap<String, String> entries = new HashMap<>();
728      entries.put("foo", "bar");
729      entries.put("foo2", "bar2");
730      jedis.hset("hash:test:encode", entries);
731      List<KeyValue> encodeObj = (List<KeyValue>) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
732      assertEquals(2, encodeObj.size());
733      encodeObj.forEach(kv -> {
734        assertThat(entries, Matchers.hasEntry(kv.getKey(), kv.getValue()));
735      });
736    }
737    @Test
738    public void encodeCompleteResponseXinfoStream() {
739      Assume.assumeFalse(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
740      HashMap<String, String> entry = new HashMap<>();
741      entry.put("foo", "bar");
742      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
743      jedis.xgroupCreate("mystream", "mygroup", null, false);
744      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
745      List encodeObj = (List) SafeEncoder.encodeObject(obj);
746      assertThat(encodeObj.size(), Matchers.greaterThanOrEqualTo(14));
747      assertEquals("must have even number of elements", 0, encodeObj.size() % 2); 
748      assertEquals(1L, findValueFromMapAsList(encodeObj, "length"));
749      assertEquals(entryID.toString(), findValueFromMapAsList(encodeObj, "last-generated-id"));
750      List<String> entryAsList = new ArrayList<>(2);
751      entryAsList.add("foo");
752      entryAsList.add("bar");
753      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "first-entry")).get(1));
754      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "last-entry")).get(1));
755    }
756    @Test
757    public void encodeCompleteResponseXinfoStreamResp3() {
758      Assume.assumeTrue(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
759      HashMap<String, String> entry = new HashMap<>();
760      entry.put("foo", "bar");
761      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
762      jedis.xgroupCreate("mystream", "mygroup", null, false);
763      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
764      List<KeyValue> encodeObj = (List<KeyValue>) SafeEncoder.encodeObject(obj);
765      assertThat(encodeObj.size(), Matchers.greaterThanOrEqualTo(7));
766      assertEquals(1L, findValueFromMapAsKeyValueList(encodeObj, "length"));
767      assertEquals(entryID.toString(), findValueFromMapAsKeyValueList(encodeObj, "last-generated-id"));
768      List<String> entryAsList = new ArrayList<>(2);
769      entryAsList.add("foo");
770      entryAsList.add("bar");
771      assertEquals(entryAsList, ((List) findValueFromMapAsKeyValueList(encodeObj, "first-entry")).get(1));
772      assertEquals(entryAsList, ((List) findValueFromMapAsKeyValueList(encodeObj, "last-entry")).get(1));
773    }
774    private Object findValueFromMapAsList(List list, Object key) {
775      for (int i = 0; i < list.size(); i += 2) {
776        if (key.equals(list.get(i))) {
777          return list.get(i + 1);
778        }
779      }
780      return null;
781    }
782    private Object findValueFromMapAsKeyValueList(List<KeyValue> list, Object key) {
783      for (KeyValue kv : list) {
784        if (key.equals(kv.getKey())) {
785          return kv.getValue();
786        }
787      }
788      return null;
789    }
790    @Test
791    public void copy() {
792      assertFalse(jedis.copy("unknown", "foo", false));
793      jedis.set("foo1", "bar");
794      assertTrue(jedis.copy("foo1", "foo2", false));
795      assertEquals("bar", jedis.get("foo2"));
796      assertTrue(jedis.copy("foo1", "foo3", 2, false));
797      jedis.select(2);
798      assertEquals("bar", jedis.get("foo3"));
799      jedis.select(0); 
800      jedis.set("foo1", "bar1");
801      assertTrue(jedis.copy("foo1", "foo2", true));
802      assertEquals("bar1", jedis.get("foo2"));
803      assertFalse(jedis.copy(bfoobar, bfoo, false));
804      jedis.set(bfoo1, bbar);
805      assertTrue(jedis.copy(bfoo1, bfoo2, false));
806      assertArrayEquals(bbar, jedis.get(bfoo2));
807      assertTrue(jedis.copy(bfoo1, bfoo3, 3, false));
808      jedis.select(3);
809      assertArrayEquals(bbar, jedis.get(bfoo3));
810      jedis.select(0); 
811      jedis.set(bfoo1, bbar1);
812      assertTrue(jedis.copy(bfoo1, bfoo2, true));
813      assertArrayEquals(bbar1, jedis.get(bfoo2));
814    }
815  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.hamcrest.MatcherAssert.assertThat;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.Protocol.Command.BLPOP;
5  import static redis.clients.jedis.Protocol.Command.HGETALL;
6  import static redis.clients.jedis.Protocol.Command.GET;
7  import static redis.clients.jedis.Protocol.Command.LRANGE;
8  import static redis.clients.jedis.Protocol.Command.PING;
9  import static redis.clients.jedis.Protocol.Command.RPUSH;
10  import static redis.clients.jedis.Protocol.Command.SET;
11  import static redis.clients.jedis.Protocol.Command.XINFO;
12  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
13  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
14  import java.util.*;
15  import org.hamcrest.Matchers;
16  import org.junit.Assume;
17  import org.junit.Test;
18  import redis.clients.jedis.HostAndPort;
19  import redis.clients.jedis.Jedis;
20  import redis.clients.jedis.args.ExpiryOption;
21  import redis.clients.jedis.params.ScanParams;
22  import redis.clients.jedis.resps.ScanResult;
23  import redis.clients.jedis.StreamEntryID;
24  import redis.clients.jedis.args.FlushMode;
25  import redis.clients.jedis.params.RestoreParams;
26  import redis.clients.jedis.HostAndPorts;
27  import redis.clients.jedis.RedisProtocol;
28  import redis.clients.jedis.util.SafeEncoder;
29  import redis.clients.jedis.exceptions.JedisDataException;
30  import redis.clients.jedis.params.SetParams;
31  import redis.clients.jedis.util.AssertUtil;
32  import redis.clients.jedis.util.KeyValue;
33  import redis.clients.jedis.util.RedisProtocolUtil;
34  public class AllKindOfValuesCommandsTest extends JedisCommandsTestBase {
35    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
36    final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x0A };
37    final byte[] bfoo2 = { 0x01, 0x02, 0x03, 0x04, 0x0B };
38    final byte[] bfoo3 = { 0x01, 0x02, 0x03, 0x04, 0x0C };
39    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
40    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
41    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
42    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
43    final byte[] bfoobar = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 };
44    final byte[] bfoostar = { 0x01, 0x02, 0x03, 0x04, '*' };
45    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
46    final byte[] bnx = { 0x6E, 0x78 };
47    final byte[] bex = { 0x65, 0x78 };
48    final int expireSeconds = 2;
49    private static final HostAndPort lfuHnp = HostAndPorts.getRedisServers().get(7);
50    @Test
51    public void ping() {
52      String status = jedis.ping();
53      assertEquals("PONG", status);
54    }
55    @Test
56    public void pingWithMessage() {
57      String argument = "message";
58      assertEquals(argument, jedis.ping(argument));
59      assertArrayEquals(bfoobar, jedis.ping(bfoobar));
60    }
61    @Test
62    public void exists() {
63      String status = jedis.set("foo", "bar");
64      assertEquals("OK", status);
65      status = jedis.set(bfoo, bbar);
66      assertEquals("OK", status);
67      assertTrue(jedis.exists("foo"));
68      assertTrue(jedis.exists(bfoo));
69      assertEquals(1L, jedis.del("foo"));
70      assertEquals(1L, jedis.del(bfoo));
71      assertFalse(jedis.exists("foo"));
72      assertFalse(jedis.exists(bfoo));
73    }
74    @Test
75    public void existsMany() {
76      String status = jedis.set("foo1", "bar1");
77      assertEquals("OK", status);
78      status = jedis.set("foo2", "bar2");
79      assertEquals("OK", status);
80      assertEquals(2L, jedis.exists("foo1", "foo2"));
81      assertEquals(1L, jedis.del("foo1"));
82      assertEquals(1L, jedis.exists("foo1", "foo2"));
83    }
84    @Test
85    public void del() {
86      jedis.set("foo1", "bar1");
87      jedis.set("foo2", "bar2");
88      jedis.set("foo3", "bar3");
89      assertEquals(3L, jedis.del("foo1", "foo2", "foo3"));
90      assertFalse(jedis.exists("foo1"));
91      assertFalse(jedis.exists("foo2"));
92      assertFalse(jedis.exists("foo3"));
93      jedis.set("foo1", "bar1");
94      assertEquals(1L, jedis.del("foo1", "foo2"));
95      assertEquals(0L, jedis.del("foo1", "foo2"));
96      jedis.set(bfoo1, bbar1);
97      jedis.set(bfoo2, bbar2);
98      jedis.set(bfoo3, bbar3);
99      assertEquals(3L, jedis.del(bfoo1, bfoo2, bfoo3));
100      assertFalse(jedis.exists(bfoo1));
101      assertFalse(jedis.exists(bfoo2));
102      assertFalse(jedis.exists(bfoo3));
103      jedis.set(bfoo1, bbar1);
104      assertEquals(1, jedis.del(bfoo1, bfoo2));
105      assertEquals(0, jedis.del(bfoo1, bfoo2));
106    }
107    @Test
108    public void unlink() {
109      jedis.set("foo1", "bar1");
110      jedis.set("foo2", "bar2");
111      jedis.set("foo3", "bar3");
112      assertEquals(3, jedis.unlink("foo1", "foo2", "foo3"));
113      assertEquals(0, jedis.exists("foo1", "foo2", "foo3"));
114      jedis.set("foo1", "bar1");
115      assertEquals(1, jedis.unlink("foo1", "foo2"));
116      assertEquals(0, jedis.unlink("foo1", "foo2"));
117      jedis.set("foo", "bar");
118      assertEquals(1, jedis.unlink("foo"));
119      assertFalse(jedis.exists("foo"));
120      jedis.set(bfoo1, bbar1);
121      jedis.set(bfoo2, bbar2);
122      jedis.set(bfoo3, bbar3);
123      assertEquals(3, jedis.unlink(bfoo1, bfoo2, bfoo3));
124      assertEquals(0, jedis.exists(bfoo1, bfoo2, bfoo3));
125      jedis.set(bfoo1, bbar1);
126      assertEquals(1, jedis.unlink(bfoo1, bfoo2));
127      assertEquals(0, jedis.unlink(bfoo1, bfoo2));
128      jedis.set(bfoo, bbar);
129      assertEquals(1, jedis.unlink(bfoo));
130      assertFalse(jedis.exists(bfoo));
131    }
132    @Test
133    public void type() {
134      jedis.set("foo", "bar");
135      assertEquals("string", jedis.type("foo"));
136      jedis.set(bfoo, bbar);
137      assertEquals("string", jedis.type(bfoo));
138    }
139    @Test
140    public void keys() {
141      jedis.set("foo", "bar");
142      jedis.set("foobar", "bar");
143      Set<String> keys = jedis.keys("foo*");
144      AssertUtil.assertCollectionContains(keys, "foo");
145      AssertUtil.assertCollectionContains(keys, "foobar");
146      assertEquals(Collections.emptySet(), jedis.keys("bar*"));
147      jedis.set(bfoo, bbar);
148      jedis.set(bfoobar, bbar);
149      Set<byte[]> bkeys = jedis.keys(bfoostar);
150      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoo);
151      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoobar);
152      assertEquals(Collections.emptySet(), jedis.keys(bbarstar));
153    }
154    @Test
155    public void randomKey() {
156      assertNull(jedis.randomKey());
157      jedis.set("foo", "bar");
158      assertEquals("foo", jedis.randomKey());
159      jedis.set("bar", "foo");
160      String randomkey = jedis.randomKey();
161      assertTrue(randomkey.equals("foo") || randomkey.equals("bar"));
162      jedis.del("foo");
163      jedis.del("bar");
164      assertNull(jedis.randomKey());
165      jedis.set(bfoo, bbar);
166      assertArrayEquals(bfoo, jedis.randomBinaryKey());
167      jedis.set(bbar, bfoo);
168      byte[] randomBkey = jedis.randomBinaryKey();
169      assertTrue(Arrays.equals(randomBkey, bfoo) || Arrays.equals(randomBkey, bbar));
170    }
171    @Test
172    public void rename() {
173      jedis.set("foo", "bar");
174      String status = jedis.rename("foo", "bar");
175      assertEquals("OK", status);
176      assertNull(jedis.get("foo"));
177      assertEquals("bar", jedis.get("bar"));
178      jedis.set(bfoo, bbar);
179      String bstatus = jedis.rename(bfoo, bbar);
180      assertEquals("OK", bstatus);
181      assertNull(jedis.get(bfoo));
182      assertArrayEquals(bbar, jedis.get(bbar));
183    }
184    @Test
185    public void renameOldAndNewAreTheSame() {
186      assertEquals("OK", jedis.set("foo", "bar"));
187      assertEquals("OK", jedis.rename("foo", "foo"));
188      assertEquals("OK", jedis.set(bfoo, bbar));
189      assertEquals("OK", jedis.rename(bfoo, bfoo));
190    }
191    @Test
192    public void renamenx() {
193      jedis.set("foo", "bar");
194      assertEquals(1, jedis.renamenx("foo", "bar"));
195      jedis.set("foo", "bar");
196      assertEquals(0, jedis.renamenx("foo", "bar"));
197      jedis.set(bfoo, bbar);
198      assertEquals(1, jedis.renamenx(bfoo, bbar));
199      jedis.set(bfoo, bbar);
200      assertEquals(0, jedis.renamenx(bfoo, bbar));
201    }
202    @Test
203    public void dbSize() {
204      assertEquals(0, jedis.dbSize());
205      jedis.set("foo", "bar");
206      assertEquals(1, jedis.dbSize());
207      jedis.set(bfoo, bbar);
208      assertEquals(2, jedis.dbSize());
209    }
210    @Test
211    public void expire() {
212      assertEquals(0, jedis.expire("foo", 20L));
213      jedis.set("foo", "bar");
214      assertEquals(1, jedis.expire("foo", 20L));
215      assertEquals(0, jedis.expire("foo", 20L, ExpiryOption.NX));
216      assertEquals(0, jedis.expire(bfoo, 20L));
217      jedis.set(bfoo, bbar);
218      assertEquals(1, jedis.expire(bfoo, 20L));
219      assertEquals(0, jedis.expire(bfoo, 20L, ExpiryOption.NX));
220    }
221    @Test
222    public void expireAt() {
223      long unixTime = (System.currentTimeMillis() / 1000L) + 20;
224      assertEquals(0, jedis.expireAt("foo", unixTime));
225      jedis.set("foo", "bar");
226      unixTime = (System.currentTimeMillis() / 1000L) + 20;
227      assertEquals(1, jedis.expireAt("foo", unixTime));
228      assertEquals(1, jedis.expireAt("foo", unixTime, ExpiryOption.XX));
229      assertEquals(0, jedis.expireAt(bfoo, unixTime));
230      jedis.set(bfoo, bbar);
231      unixTime = (System.currentTimeMillis() / 1000L) + 20;
232      assertEquals(1, jedis.expireAt(bfoo, unixTime));
233      assertEquals(1, jedis.expireAt(bfoo, unixTime, ExpiryOption.XX));
234    }
235    @Test
236    public void expireTime() {
237      long unixTime;
238      jedis.set("foo", "bar");
239      unixTime = (System.currentTimeMillis() / 1000L) + 20;
240      jedis.expireAt("foo", unixTime);
241      assertEquals(unixTime, jedis.expireTime("foo"), 0.0001);
242      jedis.set(bfoo, bbar);
243      unixTime = (System.currentTimeMillis() / 1000L) + 20;
244      jedis.expireAt(bfoo, unixTime);
245      assertEquals(unixTime, jedis.expireTime(bfoo), 0.0001);
246    }
247    @Test
248    public void ttl() {
249      assertEquals(-2, jedis.ttl("foo"));
250      jedis.set("foo", "bar");
251      assertEquals(-1, jedis.ttl("foo"));
252      jedis.expire("foo", 20);
253      long ttl = jedis.ttl("foo");
254      assertTrue(ttl >= 0 && ttl <= 20);
255      assertEquals(-2, jedis.ttl(bfoo));
256      jedis.set(bfoo, bbar);
257      assertEquals(-1, jedis.ttl(bfoo));
258      jedis.expire(bfoo, 20);
259      long bttl = jedis.ttl(bfoo);
260      assertTrue(bttl >= 0 && bttl <= 20);
261    }
262    @Test
263    public void touch() throws Exception {
264      assertEquals(0, jedis.touch("foo1", "foo2", "foo3"));
265      jedis.set("foo1", "bar1");
266      Thread.sleep(1100); 
267      assertTrue(jedis.objectIdletime("foo1") > 0);
268      assertEquals(1, jedis.touch("foo1"));
269      assertEquals(0L, jedis.objectIdletime("foo1").longValue());
270      assertEquals(1, jedis.touch("foo1", "foo2", "foo3"));
271      jedis.set("foo2", "bar2");
272      jedis.set("foo3", "bar3");
273      assertEquals(3, jedis.touch("foo1", "foo2", "foo3"));
274      assertEquals(0, jedis.touch(bfoo1, bfoo2, bfoo3));
275      jedis.set(bfoo1, bbar1);
276      Thread.sleep(1100); 
277      assertTrue(jedis.objectIdletime(bfoo1) > 0);
278      assertEquals(1, jedis.touch(bfoo1));
279      assertEquals(0L, jedis.objectIdletime(bfoo1).longValue());
280      assertEquals(1, jedis.touch(bfoo1, bfoo2, bfoo3));
281      jedis.set(bfoo2, bbar2);
282      jedis.set(bfoo3, bbar3);
283      assertEquals(3, jedis.touch(bfoo1, bfoo2, bfoo3));
284    }
285    @Test
286    public void select() {
287      jedis.set("foo", "bar");
288      String status = jedis.select(1);
289      assertEquals("OK", status);
290      assertNull(jedis.get("foo"));
291      status = jedis.select(0);
292      assertEquals("OK", status);
293      assertEquals("bar", jedis.get("foo"));
294      jedis.set(bfoo, bbar);
295      String bstatus = jedis.select(1);
296      assertEquals("OK", bstatus);
297      assertNull(jedis.get(bfoo));
298      bstatus = jedis.select(0);
299      assertEquals("OK", bstatus);
300      assertArrayEquals(bbar, jedis.get(bfoo));
301    }
302    @Test
303    public void getDB() {
304      assertEquals(0, jedis.getDB());
305      jedis.select(1);
306      assertEquals(1, jedis.getDB());
307    }
308    @Test
309    public void move() {
310      assertEquals(0, jedis.move("foo", 1));
311      jedis.set("foo", "bar");
312      assertEquals(1, jedis.move("foo", 1));
313      assertNull(jedis.get("foo"));
314      jedis.select(1);
315      assertEquals("bar", jedis.get("foo"));
316      jedis.select(0);
317      assertEquals(0, jedis.move(bfoo, 1));
318      jedis.set(bfoo, bbar);
319      assertEquals(1, jedis.move(bfoo, 1));
320      assertNull(jedis.get(bfoo));
321      jedis.select(1);
322      assertArrayEquals(bbar, jedis.get(bfoo));
323    }
324    @Test
325    public void swapDB() {
326      jedis.set("foo1", "bar1");
327      jedis.select(1);
328      assertNull(jedis.get("foo1"));
329      jedis.set("foo2", "bar2");
330      String status = jedis.swapDB(0, 1);
331      assertEquals("OK", status);
332      assertEquals("bar1", jedis.get("foo1"));
333      assertNull(jedis.get("foo2"));
334      jedis.select(0);
335      assertNull(jedis.get("foo1"));
336      assertEquals("bar2", jedis.get("foo2"));
337      jedis.set(bfoo1, bbar1);
338      jedis.select(1);
339      assertArrayEquals(null, jedis.get(bfoo1));
340      jedis.set(bfoo2, bbar2);
341      status = jedis.swapDB(0, 1);
342      assertEquals("OK", status);
343      assertArrayEquals(bbar1, jedis.get(bfoo1));
344      assertArrayEquals(null, jedis.get(bfoo2));
345      jedis.select(0);
346      assertArrayEquals(null, jedis.get(bfoo1));
347      assertArrayEquals(bbar2, jedis.get(bfoo2));
348    }
349    @Test
350    public void flushDB() {
351      jedis.set("foo", "bar");
352      assertEquals(1, jedis.dbSize());
353      jedis.set("bar", "foo");
354      jedis.move("bar", 1);
355      String status = jedis.flushDB();
356      assertEquals("OK", status);
357      assertEquals(0, jedis.dbSize());
358      jedis.select(1);
359      assertEquals(1, jedis.dbSize());
360      assertEquals("OK", jedis.flushDB(FlushMode.SYNC));
361      assertEquals(0, jedis.dbSize());
362      jedis.select(0);
363      jedis.set(bfoo, bbar);
364      assertEquals(1, jedis.dbSize());
365      jedis.set(bbar, bfoo);
<span onclick='openModal()' class='match'>366      jedis.move(bbar, 1);
367      String bstatus = jedis.flushDB();
368      assertEquals("OK", bstatus);
</span>369      assertEquals(0, jedis.dbSize());
370      jedis.select(1);
371      assertEquals(1, jedis.dbSize());
372      assertEquals("OK", jedis.flushDB(FlushMode.ASYNC));
373      assertEquals(0, jedis.dbSize());
374    }
375    @Test
376    public void flushAll() {
377      jedis.set("foo", "bar");
378      assertEquals(1, jedis.dbSize());
379      jedis.set("bar", "foo");
380      jedis.move("bar", 1);
381      String status = jedis.flushAll();
382      assertEquals("OK", status);
383      assertEquals(0, jedis.dbSize());
384      jedis.select(1);
385      assertEquals(0, jedis.dbSize());
386      jedis.set("foo", "bar");
387      assertEquals(1, jedis.dbSize());
388      assertEquals("OK", jedis.flushAll(FlushMode.SYNC));
389      assertEquals(0, jedis.dbSize());
390      jedis.select(0);
391      jedis.set(bfoo, bbar);
392      assertEquals(1, jedis.dbSize());
393      jedis.set(bbar, bfoo);
394      jedis.move(bbar, 1);
395      String bstatus = jedis.flushAll();
396      assertEquals("OK", bstatus);
397      assertEquals(0, jedis.dbSize());
398      jedis.select(1);
399      assertEquals(0, jedis.dbSize());
400      jedis.set(bfoo, bbar);
401      assertEquals(1, jedis.dbSize());
402      assertEquals("OK", jedis.flushAll(FlushMode.ASYNC));
403      assertEquals(0, jedis.dbSize());
404    }
405    @Test
406    public void persist() {
407      jedis.setex("foo", 60 * 60, "bar");
408      assertTrue(jedis.ttl("foo") > 0);
409      assertEquals(1, jedis.persist("foo"));
410      assertEquals(-1, jedis.ttl("foo"));
411      jedis.setex(bfoo, 60 * 60, bbar);
412      assertTrue(jedis.ttl(bfoo) > 0);
413      assertEquals(1, jedis.persist(bfoo));
414      assertEquals(-1, jedis.ttl(bfoo));
415    }
416    @Test
417    public void echo() {
418      String result = jedis.echo("hello world");
419      assertEquals("hello world", result);
420      byte[] bresult = jedis.echo(SafeEncoder.encode("hello world"));
421      assertArrayEquals(SafeEncoder.encode("hello world"), bresult);
422    }
423    @Test
424    public void dumpAndRestore() {
425      jedis.set("foo1", "bar");
426      byte[] sv = jedis.dump("foo1");
427      jedis.restore("foo2", 0, sv);
428      assertEquals("bar", jedis.get("foo2"));
429      jedis.set(bfoo1, bbar);
430      sv = jedis.dump(bfoo1);
431      jedis.restore(bfoo2, 0, sv);
432      assertArrayEquals(bbar, jedis.get(bfoo2));
433    }
434    @Test
435    public void restoreParams() {
436      Jedis jedis2 = new Jedis(hnp.getHost(), 6380, 500);
437      jedis2.auth("foobared");
438      jedis2.flushAll();
439      jedis2.set("foo", "bar");
440      jedis.set("from", "a");
441      byte[] serialized = jedis.dump("from");
442      try {
443        jedis2.restore("foo", 0, serialized);
444        fail("Simple restore on a existing key should fail");
445      } catch (JedisDataException e) {
446      }
447      try {
448        jedis2.restore("foo", 0, serialized, RestoreParams.restoreParams());
449        fail("Simple restore on a existing key should fail");
450      } catch (JedisDataException e) {
451      }
452      assertEquals("bar", jedis2.get("foo"));
453      jedis2.restore("foo", 1000, serialized, RestoreParams.restoreParams().replace());
454      assertEquals("a", jedis2.get("foo"));
455      assertTrue(jedis2.pttl("foo") <= 1000);
456      jedis2.restore("bar", System.currentTimeMillis() + 1000, serialized, RestoreParams.restoreParams().replace().absTtl());
457      assertTrue(jedis2.pttl("bar") <= 1000);
458      jedis2.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().idleTime(1000));
459      assertEquals(1000, jedis2.objectIdletime("bar1").longValue());
460      jedis2.close();
461      Jedis lfuJedis = new Jedis(lfuHnp.getHost(), lfuHnp.getPort(), 500);
462      lfuJedis.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().frequency(90));
463      assertEquals(90, lfuJedis.objectFreq("bar1").longValue());
464      lfuJedis.close();
465    }
466    @Test
467    public void pexpire() {
468      assertEquals(0, jedis.pexpire("foo", 10000));
469      jedis.set("foo1", "bar1");
470      assertEquals(1, jedis.pexpire("foo1", 10000));
471      jedis.set("foo2", "bar2");
472      assertEquals(1, jedis.pexpire("foo2", 200000000000L));
473      assertEquals(0, jedis.pexpire("foo2", 10000000, ExpiryOption.NX));
474      assertEquals(1, jedis.pexpire("foo2", 10000000, ExpiryOption.XX));
475      assertEquals(0, jedis.pexpire("foo2", 10000, ExpiryOption.GT));
476      assertEquals(1, jedis.pexpire("foo2", 10000, ExpiryOption.LT));
477      long pttl = jedis.pttl("foo2");
478      assertTrue(pttl > 100L);
479      assertEquals(0, jedis.pexpire(bfoo, 10000));
480      jedis.set(bfoo, bbar);
481      assertEquals(1, jedis.pexpire(bfoo, 10000));
482      assertEquals(0, jedis.pexpire(bfoo, 10000, ExpiryOption.NX));
483    }
484    @Test
485    public void pexpireAt() {
486      long unixTime = (System.currentTimeMillis()) + 10000;
487      assertEquals(0, jedis.pexpireAt("foo", unixTime));
488      jedis.set("foo", "bar");
489      assertEquals(1, jedis.pexpireAt("foo", unixTime));
490      assertEquals(0, jedis.pexpireAt(bfoo, unixTime));
491      jedis.set(bfoo, bbar);
492      assertEquals(1, jedis.pexpireAt(bfoo, unixTime));
493    }
494    @Test
495    public void pexpireTime() {
496      long unixTime = (System.currentTimeMillis()) + 10000;
497      jedis.set("foo", "bar");
498      jedis.pexpireAt("foo", unixTime);
499      assertEquals(unixTime, jedis.pexpireTime("foo"), 0.0001);
500      jedis.set(bfoo, bbar);
501      jedis.pexpireAt(bfoo, unixTime);
502      assertEquals(unixTime, jedis.pexpireTime(bfoo), 0.0001);
503    }
504    @Test
505    public void pttl() {
506      assertEquals(-2, jedis.pttl("foo"));
507      jedis.set("foo", "bar");
508      assertEquals(-1, jedis.pttl("foo"));
509      jedis.pexpire("foo", 20000);
510      long pttl = jedis.pttl("foo");
511      assertTrue(pttl >= 0 && pttl <= 20000);
512      assertEquals(-2, jedis.pttl(bfoo));
513      jedis.set(bfoo, bbar);
514      assertEquals(-1, jedis.pttl(bfoo));
515      jedis.pexpire(bfoo, 20000);
516      pttl = jedis.pttl(bfoo);
517      assertTrue(pttl >= 0 && pttl <= 20000);
518    }
519    @Test
520    public void psetex() {
521      long pttl;
522      jedis.psetex("foo", 200000000000L, "bar");
523      pttl = jedis.pttl("foo");
524      assertTrue(pttl > 100000000000L);
525      jedis.psetex(bfoo, 200000000000L, bbar);
526      pttl = jedis.pttl(bfoo);
527      assertTrue(pttl > 100000000000L);
528    }
529    @Test
530    public void scan() {
531      jedis.set("b", "b");
532      jedis.set("a", "a");
533      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
534      assertEquals(SCAN_POINTER_START, result.getCursor());
535      assertFalse(result.getResult().isEmpty());
536      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY);
537      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
538      assertFalse(bResult.getResult().isEmpty());
539    }
540    @Test
541    public void scanMatch() {
542      ScanParams params = new ScanParams();
543      params.match("a*");
544      jedis.set("b", "b");
545      jedis.set("a", "a");
546      jedis.set("aa", "aa");
547      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
548      assertEquals(SCAN_POINTER_START, result.getCursor());
549      assertFalse(result.getResult().isEmpty());
550      params = new ScanParams();
551      params.match(bfoostar);
552      jedis.set(bfoo1, bbar);
553      jedis.set(bfoo2, bbar);
554      jedis.set(bfoo3, bbar);
555      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
556      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
557      assertFalse(bResult.getResult().isEmpty());
558    }
559    @Test
560    public void scanCount() {
561      ScanParams params = new ScanParams();
562      params.count(2);
563      for (int i = 0; i < 10; i++) {
564        jedis.set("a" + i, "a" + i);
565      }
566      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
567      assertFalse(result.getResult().isEmpty());
568      params = new ScanParams();
569      params.count(2);
570      jedis.set(bfoo1, bbar);
571      jedis.set(bfoo2, bbar);
572      jedis.set(bfoo3, bbar);
573      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
574      assertFalse(bResult.getResult().isEmpty());
575    }
576    @Test
577    public void scanType() {
578      ScanParams noParams = new ScanParams();
579      ScanParams pagingParams = new ScanParams().count(4);
580      jedis.set("a", "a");
581      jedis.hset("b", "b", "b");
582      jedis.set("c", "c");
583      jedis.sadd("d", "d");
584      jedis.set("e", "e");
585      jedis.zadd("f", 0d, "f");
586      jedis.set("g", "g");
587      ScanResult<String> scanResult;
588      scanResult = jedis.scan(SCAN_POINTER_START, pagingParams, "string");
589      assertFalse(scanResult.isCompleteIteration());
590      int page1Count = scanResult.getResult().size();
591      scanResult = jedis.scan(scanResult.getCursor(), pagingParams, "string");
592      assertTrue(scanResult.isCompleteIteration());
593      int page2Count = scanResult.getResult().size();
594      assertEquals(4, page1Count + page2Count);
595      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "hash");
596      assertEquals(Collections.singletonList("b"), scanResult.getResult());
597      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "set");
598      assertEquals(Collections.singletonList("d"), scanResult.getResult());
599      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "zset");
600      assertEquals(Collections.singletonList("f"), scanResult.getResult());
601      final byte[] string = "string".getBytes();
602      final byte[] hash = "hash".getBytes();
603      final byte[] set = "set".getBytes();
604      final byte[] zset = "zset".getBytes();
605      ScanResult<byte[]> binaryResult;
606      jedis.set("a", "a");
607      jedis.hset("b", "b", "b");
608      jedis.set("c", "c");
609      jedis.sadd("d", "d");
610      jedis.set("e", "e");
611      jedis.zadd("f", 0d, "f");
612      jedis.set("g", "g");
613      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, pagingParams, string);
614      assertFalse(binaryResult.isCompleteIteration());
615      page1Count = binaryResult.getResult().size();
616      binaryResult = jedis.scan(binaryResult.getCursorAsBytes(), pagingParams, string);
617      assertTrue(binaryResult.isCompleteIteration());
618      page2Count = binaryResult.getResult().size();
619      assertEquals(4, page1Count + page2Count);
620      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, hash);
621      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{98}), binaryResult.getResult());
622      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, set);
623      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{100}), binaryResult.getResult());
624      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, zset);
625      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{102}), binaryResult.getResult());
626    }
627    @Test
628    public void scanIsCompleteIteration() {
629      for (int i = 0; i < 100; i++) {
630        jedis.set("a" + i, "a" + i);
631      }
632      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
633      assertFalse(result.isCompleteIteration());
634      result = scanCompletely(result.getCursor());
635      assertNotNull(result);
636      assertTrue(result.isCompleteIteration());
637    }
638    private ScanResult<String> scanCompletely(String cursor) {
639      ScanResult<String> scanResult;
640      do {
641        scanResult = jedis.scan(cursor);
642        cursor = scanResult.getCursor();
643      } while (!SCAN_POINTER_START.equals(scanResult.getCursor()));
644      return scanResult;
645    }
646    @Test
647    public void setNxExAndGet() {
648      assertEquals("OK", jedis.set("hello", "world", SetParams.setParams().nx().ex(expireSeconds)));
649      assertEquals("world", jedis.get("hello"));
650      assertNull(jedis.set("hello", "bar", SetParams.setParams().nx().ex(expireSeconds)));
651      assertEquals("world", jedis.get("hello"));
652      long ttl = jedis.ttl("hello");
653      assertTrue(ttl > 0 && ttl <= expireSeconds);
654      byte[] bworld = { 0x77, 0x6F, 0x72, 0x6C, 0x64 };
655      byte[] bhello = { 0x68, 0x65, 0x6C, 0x6C, 0x6F };
656      assertEquals("OK", jedis.set(bworld, bhello, SetParams.setParams().nx().ex(expireSeconds)));
657      assertArrayEquals(bhello, jedis.get(bworld));
658      assertNull(jedis.set(bworld, bbar, SetParams.setParams().nx().ex(expireSeconds)));
659      assertArrayEquals(bhello, jedis.get(bworld));
660      long bttl = jedis.ttl(bworld);
661      assertTrue(bttl > 0 && bttl <= expireSeconds);
662    }
663    @Test
664    public void setGetOptionTest() {
665      assertEquals("OK", jedis.set("hello", "world"));
666      assertEquals("world", jedis.setGet("hello", "jedis"));
667      assertEquals("jedis", jedis.get("hello"));
668      assertNull(jedis.setGet("key", "value"));
669    }
670    @Test
671    public void setGet() {
672      assertEquals("OK", jedis.set("hello", "world"));
673      assertEquals("world", jedis.setGet("hello", "jedis", SetParams.setParams()));
674      assertEquals("jedis", jedis.get("hello"));
675      assertNull(jedis.setGet("key", "value", SetParams.setParams()));
676    }
677    @Test
678    public void sendCommandTest() {
679      Object obj = jedis.sendCommand(SET, "x", "1");
680      String returnValue = SafeEncoder.encode((byte[]) obj);
681      assertEquals("OK", returnValue);
682      obj = jedis.sendCommand(GET, "x");
683      returnValue = SafeEncoder.encode((byte[]) obj);
684      assertEquals("1", returnValue);
685      jedis.sendCommand(RPUSH, "foo", "a");
686      jedis.sendCommand(RPUSH, "foo", "b");
687      jedis.sendCommand(RPUSH, "foo", "c");
688      obj = jedis.sendCommand(LRANGE, "foo", "0", "2");
689      List<byte[]> list = (List<byte[]>) obj;
690      List<byte[]> expected = new ArrayList<>(3);
691      expected.add("a".getBytes());
692      expected.add("b".getBytes());
693      expected.add("c".getBytes());
694      for (int i = 0; i < 3; i++)
695        assertArrayEquals(expected.get(i), list.get(i));
696      assertEquals("PONG", SafeEncoder.encode((byte[]) jedis.sendCommand(PING)));
697    }
698    @Test
699    public void sendBlockingCommandTest() {
700      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
701      jedis.sendCommand(RPUSH, "foo", "bar");
702      assertEquals(Arrays.asList("foo", "bar"),
703        SafeEncoder.encodeObject(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L))));
704      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
705    }
706    @Test
707    public void encodeCompleteResponsePing() {
708      assertEquals("PONG", SafeEncoder.encodeObject(jedis.sendCommand(PING)));
709    }
710    @Test
711    public void encodeCompleteResponseHgetall() {
712      Assume.assumeFalse(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
713      HashMap<String, String> entries = new HashMap<>();
714      entries.put("foo", "bar");
715      entries.put("foo2", "bar2");
716      jedis.hset("hash:test:encode", entries);
717      List encodeObj = (List) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
718      assertEquals(4, encodeObj.size());
719      entries.forEach((k, v) -> {
720        assertThat((Iterable<String>) encodeObj, Matchers.hasItem(k));
721        assertEquals(v, findValueFromMapAsList(encodeObj, k));
722      });
723    }
724    @Test
725    public void encodeCompleteResponseHgetallResp3() {
726      Assume.assumeTrue(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
727      HashMap<String, String> entries = new HashMap<>();
728      entries.put("foo", "bar");
729      entries.put("foo2", "bar2");
730      jedis.hset("hash:test:encode", entries);
731      List<KeyValue> encodeObj = (List<KeyValue>) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
732      assertEquals(2, encodeObj.size());
733      encodeObj.forEach(kv -> {
734        assertThat(entries, Matchers.hasEntry(kv.getKey(), kv.getValue()));
735      });
736    }
737    @Test
738    public void encodeCompleteResponseXinfoStream() {
739      Assume.assumeFalse(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
740      HashMap<String, String> entry = new HashMap<>();
741      entry.put("foo", "bar");
742      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
743      jedis.xgroupCreate("mystream", "mygroup", null, false);
744      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
745      List encodeObj = (List) SafeEncoder.encodeObject(obj);
746      assertThat(encodeObj.size(), Matchers.greaterThanOrEqualTo(14));
747      assertEquals("must have even number of elements", 0, encodeObj.size() % 2); 
748      assertEquals(1L, findValueFromMapAsList(encodeObj, "length"));
749      assertEquals(entryID.toString(), findValueFromMapAsList(encodeObj, "last-generated-id"));
750      List<String> entryAsList = new ArrayList<>(2);
751      entryAsList.add("foo");
752      entryAsList.add("bar");
753      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "first-entry")).get(1));
754      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "last-entry")).get(1));
755    }
756    @Test
757    public void encodeCompleteResponseXinfoStreamResp3() {
758      Assume.assumeTrue(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
759      HashMap<String, String> entry = new HashMap<>();
760      entry.put("foo", "bar");
761      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
762      jedis.xgroupCreate("mystream", "mygroup", null, false);
763      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
764      List<KeyValue> encodeObj = (List<KeyValue>) SafeEncoder.encodeObject(obj);
765      assertThat(encodeObj.size(), Matchers.greaterThanOrEqualTo(7));
766      assertEquals(1L, findValueFromMapAsKeyValueList(encodeObj, "length"));
767      assertEquals(entryID.toString(), findValueFromMapAsKeyValueList(encodeObj, "last-generated-id"));
768      List<String> entryAsList = new ArrayList<>(2);
769      entryAsList.add("foo");
770      entryAsList.add("bar");
771      assertEquals(entryAsList, ((List) findValueFromMapAsKeyValueList(encodeObj, "first-entry")).get(1));
772      assertEquals(entryAsList, ((List) findValueFromMapAsKeyValueList(encodeObj, "last-entry")).get(1));
773    }
774    private Object findValueFromMapAsList(List list, Object key) {
775      for (int i = 0; i < list.size(); i += 2) {
776        if (key.equals(list.get(i))) {
777          return list.get(i + 1);
778        }
779      }
780      return null;
781    }
782    private Object findValueFromMapAsKeyValueList(List<KeyValue> list, Object key) {
783      for (KeyValue kv : list) {
784        if (key.equals(kv.getKey())) {
785          return kv.getValue();
786        }
787      }
788      return null;
789    }
790    @Test
791    public void copy() {
792      assertFalse(jedis.copy("unknown", "foo", false));
793      jedis.set("foo1", "bar");
794      assertTrue(jedis.copy("foo1", "foo2", false));
795      assertEquals("bar", jedis.get("foo2"));
796      assertTrue(jedis.copy("foo1", "foo3", 2, false));
797      jedis.select(2);
798      assertEquals("bar", jedis.get("foo3"));
799      jedis.select(0); 
800      jedis.set("foo1", "bar1");
801      assertTrue(jedis.copy("foo1", "foo2", true));
802      assertEquals("bar1", jedis.get("foo2"));
803      assertFalse(jedis.copy(bfoobar, bfoo, false));
804      jedis.set(bfoo1, bbar);
805      assertTrue(jedis.copy(bfoo1, bfoo2, false));
806      assertArrayEquals(bbar, jedis.get(bfoo2));
807      assertTrue(jedis.copy(bfoo1, bfoo3, 3, false));
808      jedis.select(3);
809      assertArrayEquals(bbar, jedis.get(bfoo3));
810      jedis.select(0); 
811      jedis.set(bfoo1, bbar1);
812      assertTrue(jedis.copy(bfoo1, bfoo2, true));
813      assertArrayEquals(bbar1, jedis.get(bfoo2));
814    }
815  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>394      jedis.move(bbar, 1);
395      String bstatus = jedis.flushAll();
396      assertEquals("OK", bstatus);
</pre></code></div>
                <div class="column column_space"><pre><code>366      jedis.move(bbar, 1);
367      String bstatus = jedis.flushDB();
368      assertEquals("OK", bstatus);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    