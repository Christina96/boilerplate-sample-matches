<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for RepositoriesModule.java & DataTypeTest.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for RepositoriesModule.java & DataTypeTest.java
      </h3>
      <h1 align="center">
        13.3%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>RepositoriesModule.java (24.137932%)<TH>DataTypeTest.java (9.180327%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match1468140-0.html#0',2,'match1468140-1.html#0',3)" NAME="0">(20-43)<TD><A HREF="javascript:ZweiFrames('match1468140-0.html#0',2,'match1468140-1.html#0',3)" NAME="0">(22-42)</A><TD ALIGN=center><FONT COLOR="#ff0000">17</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match1468140-0.html#1',2,'match1468140-1.html#1',3)" NAME="1">(77-83)<TD><A HREF="javascript:ZweiFrames('match1468140-0.html#1',2,'match1468140-1.html#1',3)" NAME="1">(63-70)</A><TD ALIGN=center><FONT COLOR="#a50000">11</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>RepositoriesModule.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Licensed to Elasticsearch under one or more contributor
 * license agreements. See the NOTICE file distributed with
 * this work for additional information regarding copyright
 * ownership. Elasticsearch licenses this file to you under
 * the Apache License, Version 2.0 (the &quot;License&quot;); you may
 * not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
<A NAME="0"></A> * under the License.
 */

<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match1468140-1.html#0',3,'match1468140-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>package org.elasticsearch.repositories;

import org.elasticsearch.cluster.metadata.RepositoryMetadata;
import org.elasticsearch.cluster.service.ClusterService;
import org.elasticsearch.common.inject.AbstractModule;
import org.elasticsearch.common.inject.multibindings.MapBinder;
import org.elasticsearch.common.xcontent.NamedXContentRegistry;
import org.elasticsearch.env.Environment;
import org.elasticsearch.plugins.RepositoryPlugin;
import org.elasticsearch.repositories.fs.FsRepository;
import org.elasticsearch.threadpool.ThreadPool;

import io.crate.analyze.repositories.TypeSettings;
import org.elasticsearch.transport.TransportService;

import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Sets up classes for Snapshot/Restore.
 */
publi</B></FONT>c class RepositoriesModule extends AbstractModule {

    private final RepositoriesService repositoriesService;

    public RepositoriesModule(Environment env,
                              List&lt;RepositoryPlugin&gt; repoPlugins,
                              TransportService transportService,
                              ClusterService clusterService,
                              ThreadPool threadPool,
                              NamedXContentRegistry namedXContentRegistry) {
        Map&lt;String, Repository.Factory&gt; factories = new HashMap&lt;&gt;();
        factories.put(FsRepository.TYPE, new Repository.Factory() {

            @Override
            public TypeSettings settings() {
                return new TypeSettings(FsRepository.mandatorySettings(), FsRepository.optionalSettings());
            }

            @Override
            public Repository create(RepositoryMetadata metadata) throws Exception {
                return new FsRepository(metadata, env, namedXContentRegistry, clusterService);
            }
        });

        for (RepositoryPlugin repoPlugin : repoPlugins) {
            Map&lt;String, Repository.Factory&gt; newRepoTypes = repoPlugin.getRepositories(env, namedXContentRegistry, clusterService);
            for (Map.Entry&lt;String, Repository.Factory&gt; entry : newRepoTypes.entrySet()) {
                if (factories.put(entry.getKey(), entry.getValue()) != null) {
                    throw new IllegalArgumentException(&quot;Repository type [&quot; + entry.getKey() + &quot;] is already registered&quot;);
                }
            }
<A NAME="1"></A>        }

        Map&lt;String, Repository.Factory&gt; repositoryTypes = Collections.unmodifiableMap(factories);
        repositoriesService = new RepositoriesService(<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match1468140-1.html#1',3,'match1468140-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>env.settings(), clusterService, transportService, repositoryTypes, threadPool);
    }

    @Override
    protected void configure() {
        Map&lt;String, Repository.Factory&gt; repositoryTypes = repositoriesService.typesRegistry();
        MapBinder&lt;String, Repository.Factory&gt; typesBinder = MapBinder.newMapBinder(binder</B></FONT>(), String.class, Repository.Factory.class);
        repositoryTypes.forEach((k, v) -&gt; typesBinder.addBinding(k).toInstance(v));

        MapBinder&lt;String, TypeSettings&gt; typeSettingsBinder = MapBinder.newMapBinder(
            binder(),
            String.class,
            TypeSettings.class);
        for (var e : repositoryTypes.entrySet()) {
            String repoScheme = e.getKey();
            var repoSettings = e.getValue().settings();
            typeSettingsBinder.addBinding(repoScheme).toInstance(repoSettings);
        }
    }

    public RepositoriesService repositoryService() {
        return repositoriesService;
    }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>DataTypeTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Licensed to Crate.io GmbH (&quot;Crate&quot;) under one or more contributor
 * license agreements.  See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.  Crate licenses
 * this file to you under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.  You may
 * obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations
 * under the License.
 *
 * However, if you have executed another commercial license agreement
 * with Crate these terms will supersede the license and you may use the
<A NAME="0"></A> * software solely pursuant to the terms of the relevant commercial agreement.
 */

<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1468140-0.html#0',2,'match1468140-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>package io.crate;

import io.crate.types.ObjectType;
import org.elasticsearch.test.ESTestCase;
import io.crate.types.ArrayType;
import io.crate.types.DataType;
import io.crate.types.DataTypes;
import org.elasticsearch.common.io.stream.BytesStreamOutput;
import org.elasticsearch.common.io.stream.StreamInput;
import org.hamcrest.Matchers;
import org.junit.Test;

import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static org.hamcrest.Matchers.is;

publi</B></FONT>c class DataTypeTest extends ESTestCase {

    @Test
    public void testStreaming() throws Exception {
        String s1 = &quot;hello&quot;;
        BytesStreamOutput out = new BytesStreamOutput();
        Streamer streamer = DataTypes.STRING.streamer();
        streamer.writeValueTo(out, s1);
        StreamInput in = out.bytes().streamInput();
        String b2 = (String) streamer.readValueFrom(in);
        assertEquals(s1, b2);
    }

    @Test
    public void testStreamingNull() throws Exception {
        String s1 = null;
        BytesStreamOutput out = new BytesStreamOutput();
        Streamer streamer = DataTypes.STRING.streamer();
<A NAME="1"></A>        streamer.writeValueTo(out, s1);
        StreamInput in = out.bytes().streamInput();
        String s2 = (String) streamer.readValueFrom(in);
        <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1468140-0.html#1',2,'match1468140-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertNull(s2);
    }

    @Test
    public void testForValueWithList() {
        List&lt;String&gt; strings = Arrays.asList(&quot;foo&quot;, &quot;bar&quot;);
        DataType dataType = DataTypes.guessType(strings);
        assertEquals</B></FONT>(dataType, new ArrayType(DataTypes.STRING));

        List&lt;Integer&gt; integers = Arrays.asList(1, 2, 3);
        dataType = DataTypes.guessType(integers);
        assertEquals(dataType, new ArrayType(DataTypes.INTEGER));
    }

    @Test
    public void testForValueWithArray() {
        Boolean[] booleans = new Boolean[]{true, false};
        DataType dataType = DataTypes.guessType(booleans);
        assertEquals(dataType, new ArrayType(DataTypes.BOOLEAN));
    }

    @Test
    public void testForValueWithTimestampArrayAsString() {
        String[] strings = {&quot;2013-09-10T21:51:43&quot;, &quot;2013-11-10T21:51:43&quot;};
        DataType dataType = DataTypes.guessType(strings);
        assertEquals(dataType, new ArrayType(DataTypes.STRING));
    }

    @Test
    public void testForValueWithObjectList() {
        Map&lt;String, Object&gt; objA = new HashMap&lt;&gt;();
        objA.put(&quot;a&quot;, 1);

        Map&lt;String, Object&gt; objB = new HashMap&lt;&gt;();
        Map&lt;String, Object&gt; objBNested = new HashMap&lt;&gt;();

        objB.put(&quot;b&quot;, objBNested);
        objBNested.put(&quot;bn1&quot;, 1);
        objBNested.put(&quot;bn2&quot;, 2);

        List&lt;Object&gt; objects = List.of(objA, objB);
        DataType&lt;?&gt; dataType = DataTypes.guessType(objects);
        assertEquals(dataType, new ArrayType&lt;&gt;(DataTypes.UNTYPED_OBJECT));
    }

    @Test
    public void testForValueWithArrayWithNullValues() {
        DataType dataType = DataTypes.guessType(new String[]{&quot;foo&quot;, null, &quot;bar&quot;});
        assertEquals(dataType, new ArrayType(DataTypes.STRING));
    }

    @Test
    public void testForValueNestedList() {
        List&lt;List&lt;String&gt;&gt; nestedStrings = Arrays.asList(
            Arrays.asList(&quot;foo&quot;, &quot;bar&quot;),
            Arrays.asList(&quot;f&quot;, &quot;b&quot;));
        assertEquals(new ArrayType(new ArrayType(DataTypes.STRING)), DataTypes.guessType(nestedStrings));
    }

    @Test(expected = IllegalArgumentException.class)
    public void testForValueMixedDataTypeInList() {
        List&lt;Object&gt; objects = Arrays.&lt;Object&gt;asList(&quot;foo&quot;, 1);
        DataTypes.guessType(objects);
    }

    @Test
    public void testListCanContainMixedTypeIfSafeCastIsPossible() {
        List&lt;Object&gt; objects = Arrays.asList(1, null, 1.2f, 0);
        Collections.shuffle(objects);
        DataType&lt;?&gt; dataType = DataTypes.guessType(objects);
        assertThat(dataType, Matchers.is(new ArrayType(DataTypes.FLOAT)));
    }

    @Test
    public void testForValueWithEmptyList() {
        List&lt;Object&gt; objects = Arrays.&lt;Object&gt;asList();
        DataType type = DataTypes.guessType(objects);
        assertEquals(type, new ArrayType(DataTypes.UNDEFINED));
    }

    @Test
    public void test_is_compatible_type_with_same_names_different_inner_types() {
        ObjectType obj1 = ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.INTEGER).build();
        ObjectType obj2 = ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.STRING).build();
        assertThat(DataTypes.isCompatibleType(obj1, obj2), is(false));
    }

    @Test
    public void test_is_compatible_type_with_same_names_same_inner_types() {
        ObjectType obj1 = ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.STRING).build();
        ObjectType obj2 = ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.STRING).build();
        assertThat(DataTypes.isCompatibleType(obj1, obj2), is(true));
    }

    @Test
    public void test_is_compatible_type_with_different_names_same_inner_types() {
        ObjectType obj1 = ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.STRING).build();
        ObjectType obj2 = ObjectType.builder().setInnerType(&quot;b&quot;, DataTypes.STRING).build();
        assertThat(DataTypes.isCompatibleType(obj1, obj2), is(true));
    }

    @Test
    public void test_is_compatible_type_on_nested_types_with_same_names_same_inner_types() {
        ObjectType obj1 = ObjectType.builder()
            .setInnerType(&quot;obj&quot;,
                          ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.INTEGER).build()).build();
        ObjectType obj2 = ObjectType.builder()
            .setInnerType(&quot;obj&quot;,
                          ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.INTEGER).build()).build();
        assertThat(DataTypes.isCompatibleType(obj1, obj2), is(true));
    }

    @Test
    public void test_is_compatible_type_on_nested_types_with_same_names_different_inner_types() {
        ObjectType obj1 = ObjectType.builder()
            .setInnerType(&quot;obj&quot;,
                          ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.INTEGER).build()).build();
        ObjectType obj2 = ObjectType.builder()
            .setInnerType(&quot;obj&quot;,
                          ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.STRING).build()).build();
        assertThat(DataTypes.isCompatibleType(obj1, obj2), is(false));
    }

    @Test
    public void test_is_compatible_type_on_nested_types_with_different_names_same_inner_types() {
        ObjectType obj1 = ObjectType.builder()
            .setInnerType(&quot;obj1&quot;,
                          ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.INTEGER).build()).build();
        ObjectType obj2 = ObjectType.builder()
            .setInnerType(&quot;obj2&quot;,
                          ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.INTEGER).build()).build();
        assertThat(DataTypes.isCompatibleType(obj1, obj2), is(true));

        ObjectType obj3 = ObjectType.builder()
            .setInnerType(&quot;obj&quot;,
                          ObjectType.builder().setInnerType(&quot;a&quot;, DataTypes.INTEGER).build()).build();
        ObjectType obj4 = ObjectType.builder()
            .setInnerType(&quot;obj&quot;,
                          ObjectType.builder().setInnerType(&quot;b&quot;, DataTypes.INTEGER).build()).build();
        assertThat(DataTypes.isCompatibleType(obj3, obj4), is(true));
    }
}
</PRE>
</div>
  </div>
</body>
</html>
