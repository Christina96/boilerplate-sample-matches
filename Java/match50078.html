<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for MapsTransformValuesUnmodifiableIteratorTest.java & FilesTest_1.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for MapsTransformValuesUnmodifiableIteratorTest.java & FilesTest_1.java
      </h3>
      <h1 align="center">
        34.4%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>MapsTransformValuesUnmodifiableIteratorTest.java (50.45208%)<TH>FilesTest_1.java (26.172607%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#0',2,'match50078-1.html#0',3)" NAME="0">(254-270)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#0',2,'match50078-1.html#0',3)" NAME="0">(638-652)</A><TD ALIGN=center><FONT COLOR="#ff0000">26</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#1',2,'match50078-1.html#1',3)" NAME="1">(239-249)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#1',2,'match50078-1.html#1',3)" NAME="1">(621-633)</A><TD ALIGN=center><FONT COLOR="#eb0000">24</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#2',2,'match50078-1.html#2',3)" NAME="2">(308-320)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#2',2,'match50078-1.html#2',3)" NAME="2">(449-465)</A><TD ALIGN=center><FONT COLOR="#c40000">20</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#3',2,'match50078-1.html#3',3)" NAME="3">(168-178)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#3',2,'match50078-1.html#3',3)" NAME="3">(111-121)</A><TD ALIGN=center><FONT COLOR="#c40000">20</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#4',2,'match50078-1.html#4',3)" NAME="4">(219-231)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#4',2,'match50078-1.html#4',3)" NAME="4">(342-352)</A><TD ALIGN=center><FONT COLOR="#b00000">18</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#5',2,'match50078-1.html#5',3)" NAME="5">(183-192)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#5',2,'match50078-1.html#5',3)" NAME="5">(193-204)</A><TD ALIGN=center><FONT COLOR="#b00000">18</FONT>
<TR><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#6',2,'match50078-1.html#6',3)" NAME="6">(277-290)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#6',2,'match50078-1.html#6',3)" NAME="6">(516-525)</A><TD ALIGN=center><FONT COLOR="#a60000">17</FONT>
<TR><TD BGCOLOR="#38a4a5"><FONT COLOR="#38a4a5">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#7',2,'match50078-1.html#7',3)" NAME="7">(358-364)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#7',2,'match50078-1.html#7',3)" NAME="7">(54-70)</A><TD ALIGN=center><FONT COLOR="#9c0000">16</FONT>
<TR><TD BGCOLOR="#c58917"><FONT COLOR="#c58917">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#8',2,'match50078-1.html#8',3)" NAME="8">(197-205)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#8',2,'match50078-1.html#8',3)" NAME="8">(228-237)</A><TD ALIGN=center><FONT COLOR="#930000">15</FONT>
<TR><TD BGCOLOR="#83a33a"><FONT COLOR="#83a33a">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#9',2,'match50078-1.html#9',3)" NAME="9">(211-218)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#9',2,'match50078-1.html#9',3)" NAME="9">(131-138)</A><TD ALIGN=center><FONT COLOR="#890000">14</FONT>
<TR><TD BGCOLOR="#ad5910"><FONT COLOR="#ad5910">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#10',2,'match50078-1.html#10',3)" NAME="10">(290-299)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#10',2,'match50078-1.html#10',3)" NAME="10">(587-598)</A><TD ALIGN=center><FONT COLOR="#750000">12</FONT>
<TR><TD BGCOLOR="#b041ff"><FONT COLOR="#b041ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#11',2,'match50078-1.html#11',3)" NAME="11">(206-211)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#11',2,'match50078-1.html#11',3)" NAME="11">(253-259)</A><TD ALIGN=center><FONT COLOR="#6b0000">11</FONT>
<TR><TD BGCOLOR="#571b7e"><FONT COLOR="#571b7e">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#12',2,'match50078-1.html#12',3)" NAME="12">(17-28)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#12',2,'match50078-1.html#12',3)" NAME="12">(17-29)</A><TD ALIGN=center><FONT COLOR="#6b0000">11</FONT>
<TR><TD BGCOLOR="#3b9c9c"><FONT COLOR="#3b9c9c">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#13',2,'match50078-1.html#13',3)" NAME="13">(370-376)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#13',2,'match50078-1.html#13',3)" NAME="13">(294-299)</A><TD ALIGN=center><FONT COLOR="#620000">10</FONT>
<TR><TD BGCOLOR="#842dce"><FONT COLOR="#842dce">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#14',2,'match50078-1.html#14',3)" NAME="14">(339-346)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#14',2,'match50078-1.html#14',3)" NAME="14">(271-277)</A><TD ALIGN=center><FONT COLOR="#620000">10</FONT>
<TR><TD BGCOLOR="#f52887"><FONT COLOR="#f52887">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#15',2,'match50078-1.html#15',3)" NAME="15">(61-67)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#15',2,'match50078-1.html#15',3)" NAME="15">(432-438)</A><TD ALIGN=center><FONT COLOR="#620000">10</FONT>
<TR><TD BGCOLOR="#2981b2"><FONT COLOR="#2981b2">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#16',2,'match50078-1.html#16',3)" NAME="16">(379-383)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#16',2,'match50078-1.html#16',3)" NAME="16">(355-358)</A><TD ALIGN=center><FONT COLOR="#580000">9</FONT>
<TR><TD BGCOLOR="#3090c7"><FONT COLOR="#3090c7">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#17',2,'match50078-1.html#17',3)" NAME="17">(152-158)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#17',2,'match50078-1.html#17',3)" NAME="17">(472-478)</A><TD ALIGN=center><FONT COLOR="#580000">9</FONT>
<TR><TD BGCOLOR="#800517"><FONT COLOR="#800517">-</FONT><TD><A HREF="javascript:ZweiFrames('match50078-0.html#18',2,'match50078-1.html#18',3)" NAME="18">(49-55)<TD><A HREF="javascript:ZweiFrames('match50078-0.html#18',2,'match50078-1.html#18',3)" NAME="18">(99-105)</A><TD ALIGN=center><FONT COLOR="#580000">9</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>MapsTransformValuesUnmodifiableIteratorTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2011 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
<A NAME="12"></A> * limitations under the License.
 */

<FONT color="#571b7e"><A HREF="javascript:ZweiFrames('match50078-1.html#12',3,'match50078-top.html#12',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>package com.google.common.collect;

import com.google.common.annotations.GwtCompatible;
import com.google.common.base.Function;
import com.google.common.base.Functions;
import com.google.common.collect.testing.MapInterfaceTest;
import java.util.Collection;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import</B></FONT> org.checkerframework.checker.nullness.qual.Nullable;

/**
 * Tests for {@link Maps#transformValues} when the backing map's views have iterators that don't
 * support {@code remove()}.
 *
 * @author Jared Levy
 */
@GwtCompatible
public class MapsTransformValuesUnmodifiableIteratorTest extends MapInterfaceTest&lt;String, String&gt; {
  // TODO(jlevy): Move shared code of this class and MapsTransformValuesTest
  // to a superclass.

  public MapsTransformValuesUnmodifiableIteratorTest() {
    super(true, true, false /*supportsPut*/, true, true, false);
  }

  private static class UnmodifiableIteratorMap&lt;K, V&gt; extends ForwardingMap&lt;K, V&gt; {
<A NAME="18"></A>    final Map&lt;K, V&gt; delegate;

    UnmodifiableIteratorMap(Map&lt;K, V&gt; delegate) {
      <FONT color="#800517"><A HREF="javascript:ZweiFrames('match50078-1.html#18',3,'match50078-top.html#18',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>this.delegate = delegate;
    }

    @Override
    protected Map&lt;K, V&gt; delegate() {
      return delegate;
    }</B></FONT>

    @Override
<A NAME="15"></A>    public Set&lt;K&gt; keySet() {
      return new ForwardingSet&lt;K&gt;() {
        @Override
        protected Set&lt;K&gt; delegate() <FONT color="#f52887"><A HREF="javascript:ZweiFrames('match50078-1.html#15',3,'match50078-top.html#15',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
          return delegate.keySet();
        }

        @Override
        public Iterator&lt;K&gt; iterator() {
          return Iterators.unmodifiableIterator</B></FONT>(delegate.keySet().iterator());
        }

        @Override
        public boolean removeAll(Collection&lt;?&gt; c) {
          return delegate.keySet().removeAll(c);
        }

        @Override
        public boolean retainAll(Collection&lt;?&gt; c) {
          return delegate.keySet().retainAll(c);
        }
      };
    }

    @Override
    public Collection&lt;V&gt; values() {
      return new ForwardingCollection&lt;V&gt;() {
        @Override
        protected Collection&lt;V&gt; delegate() {
          return delegate.values();
        }

        @Override
        public Iterator&lt;V&gt; iterator() {
          return Iterators.unmodifiableIterator(delegate.values().iterator());
        }

        @Override
        public boolean removeAll(Collection&lt;?&gt; c) {
          return delegate.values().removeAll(c);
        }

        @Override
        public boolean retainAll(Collection&lt;?&gt; c) {
          return delegate.values().retainAll(c);
        }
      };
    }

    @Override
    public Set&lt;Entry&lt;K, V&gt;&gt; entrySet() {
      return new ForwardingSet&lt;Entry&lt;K, V&gt;&gt;() {
        @Override
        protected Set&lt;Entry&lt;K, V&gt;&gt; delegate() {
          return delegate.entrySet();
        }

        @Override
        public Iterator&lt;Entry&lt;K, V&gt;&gt; iterator() {
          return Iterators.unmodifiableIterator(delegate.entrySet().iterator());
        }

        @Override
        public boolean removeAll(Collection&lt;?&gt; c) {
          return delegate.entrySet().removeAll(c);
        }

        @Override
        public boolean retainAll(Collection&lt;?&gt; c) {
          return delegate.entrySet().retainAll(c);
        }
      };
    }
  }

  @Override
  protected Map&lt;String, String&gt; makeEmptyMap() {
    Map&lt;String, Integer&gt; underlying = Maps.newHashMap();
    return Maps.transformValues(
        new UnmodifiableIteratorMap&lt;String, Integer&gt;(underlying), Functions.toStringFunction());
  }

  @Override
  protected Map&lt;String, String&gt; makePopulatedMap() {
    Map&lt;String, Integer&gt; underlying = Maps.newHashMap();
    underlying.put(&quot;a&quot;, 1);
    underlying.put(&quot;b&quot;, 2);
    underlying.put(&quot;c&quot;, 3);
    return Maps.transformValues(
        new UnmodifiableIteratorMap&lt;String, Integer&gt;(underlying), Functions.toStringFunction());
  }
<A NAME="17"></A>
  @Override
  protected String getKeyNotInPopulatedMap() throws UnsupportedOperationException {
    <FONT color="#3090c7"><A HREF="javascript:ZweiFrames('match50078-1.html#17',3,'match50078-top.html#17',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>return &quot;z&quot;;
  }

  @Override
  protected String getValueNotInPopulatedMap() throws UnsupportedOperationException {
    return &quot;26&quot;;
  }</B></FONT>

  /** Helper assertion comparing two maps */
  private void assertMapsEqual(Map&lt;?, ?&gt; expected, Map&lt;?, ?&gt; map) {
    assertEquals(expected, map);
    assertEquals(expected.hashCode(), map.hashCode());
    assertEquals(expected.entrySet(), map.entrySet());
<A NAME="3"></A>
    // Assert that expectedValues &gt; mapValues and that
    // mapValues &gt; expectedValues; i.e. that expectedValues == mapValues.
    <FONT color="#53858b"><A HREF="javascript:ZweiFrames('match50078-1.html#3',3,'match50078-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Collection&lt;?&gt; expectedValues = expected.values();
    Collection&lt;?&gt; mapValues = map.values();
    assertEquals(expectedValues.size(), mapValues.size());
    assertTrue(expectedValues.containsAll(mapValues));
    assertTrue(mapValues.containsAll(expectedValues));
  }

  public void testTransformEmptyMapEquality() {
    Map&lt;String, String&gt; map =
        Maps.transformValues(ImmutableMap.&lt;String, Integer&gt;of(), Functions.toStringFunction());
    assertMapsEqual</B></FONT>(Maps.newHashMap(), map);
  }
<A NAME="5"></A>
  public void testTransformSingletonMapEquality() {
    Map&lt;String, String&gt; map =
        Maps.transformValues(<FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match50078-1.html#5',3,'match50078-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ImmutableMap.of(&quot;a&quot;, 1), Functions.toStringFunction());
    Map&lt;String, String&gt; expected = ImmutableMap.of(&quot;a&quot;, &quot;1&quot;);
    assertMapsEqual(expected, map);
    assertEquals(expected.get(&quot;a&quot;), map.get(&quot;a&quot;));
  }

  public void testTransformIdentityFunctionEquality() {
    Map&lt;String, Integer&gt; underlying = ImmutableMap.of(&quot;a&quot;, 1);
    Map&lt;String, Integer&gt; map = Maps.transformValues(underlying, Functions.&lt;Integer&gt;identity());
    assertMapsEqual</B></FONT>(underlying, map);
  }
<A NAME="8"></A>
  public void testTransformPutEntryIsUnsupported() {
    Map&lt;String, String&gt; map =
        Maps.transformValues(ImmutableMap.of(&quot;a&quot;, 1), <FONT color="#c58917"><A HREF="javascript:ZweiFrames('match50078-1.html#8',3,'match50078-top.html#8',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Functions.toStringFunction());
    try {
      map.put(&quot;b&quot;, &quot;2&quot;);
      fail();
    } catch (UnsupportedOperationException expected) {
    }
<A NAME="11"></A>
    try {
      map.putAll(ImmutableMap.of</B></FONT>(&quot;b&quot;, &quot;2&quot;));
      <FONT color="#b041ff"><A HREF="javascript:ZweiFrames('match50078-1.html#11',3,'match50078-top.html#11',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>fail();
    } catch (UnsupportedOperationException expected) {
<A NAME="9"></A>    }

    try {
      <FONT color="#83a33a"><A HREF="javascript:ZweiFrames('match50078-1.html#9',3,'match50078-top.html#9',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>map.entrySet().iterator().next</B></FONT>().setValue(&quot;one&quot;);
      fail();
    } catch (UnsupportedOperationException expected) {
    }
  }
<A NAME="4"></A>
  public void testTransformRemoveEntry() {
    Map&lt;String, Integer&gt; underlying = Maps.newHashMap</B></FONT>();
    <FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match50078-1.html#4',3,'match50078-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>underlying.put(&quot;a&quot;, 1);
    Map&lt;String, String&gt; map = Maps.transformValues(underlying, Functions.toStringFunction());
    assertEquals(&quot;1&quot;, map.remove(&quot;a&quot;));
    assertNull(map.remove(&quot;b&quot;));
  }

  public void testTransformEqualityOfMapsWithNullValues() {
    Map&lt;String, String&gt; underlying = Maps.newHashMap();
    underlying.put(&quot;a&quot;, null);
    underlying.put(&quot;b&quot;, &quot;&quot;);

    Map&lt;String, Boolean&gt; map =
        Maps.transformValues</B></FONT>(
            underlying,
            new Function&lt;String, Boolean&gt;() {
              @Override
              public Boolean apply(@Nullable String from) {
<A NAME="1"></A>                return from == null;
              }
            });
    Map&lt;String, Boolean&gt; expected = <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match50078-1.html#1',3,'match50078-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>ImmutableMap.of(&quot;a&quot;, true, &quot;b&quot;, false);
    assertMapsEqual(expected, map);
    assertEquals(expected.get(&quot;a&quot;), map.get(&quot;a&quot;));
    assertEquals(expected.containsKey(&quot;a&quot;), map.containsKey(&quot;a&quot;));
    assertEquals(expected.get(&quot;b&quot;), map.get(&quot;b&quot;));
    assertEquals(expected.containsKey(&quot;b&quot;), map.containsKey(&quot;b&quot;));
    assertEquals(expected.get(&quot;c&quot;), map.get(&quot;c&quot;));
    assertEquals(expected.containsKey(&quot;c&quot;), map.containsKey(&quot;c&quot;));
  }

  public void testTransformReflectsUnderlyingMap() {</B></FONT>
    Map&lt;String, Integer&gt; underlying = Maps.newHashMap();
<A NAME="0"></A>    underlying.put(&quot;a&quot;, 1);
    underlying.put(&quot;b&quot;, 2);
    underlying.put(&quot;c&quot;, 3);
    Map&lt;String, String&gt; map = <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match50078-1.html#0',3,'match50078-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Maps.transformValues(underlying, Functions.toStringFunction());
    assertEquals(underlying.size(), map.size());

    underlying.put(&quot;d&quot;, 4);
    assertEquals(underlying.size(), map.size());
    assertEquals(&quot;4&quot;, map.get(&quot;d&quot;));

    underlying.remove(&quot;c&quot;);
    assertEquals(underlying.size(), map.size());
    assertFalse(map.containsKey(&quot;c&quot;));

    underlying.clear();
    assertEquals(underlying.size(), map.size());
  }

  public void testTransformChangesAreReflectedInUnderlyingMap() {
    Map&lt;String, Integer&gt; underlying = Maps.newLinkedHashMap()</B></FONT>;
    underlying.put(&quot;a&quot;, 1);
    underlying.put(&quot;b&quot;, 2);
    underlying.put(&quot;c&quot;, 3);
<A NAME="6"></A>    underlying.put(&quot;d&quot;, 4);
    underlying.put(&quot;e&quot;, 5);
    underlying.put(&quot;f&quot;, 6);
    <FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match50078-1.html#6',3,'match50078-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>underlying.put(&quot;g&quot;, 7);
    Map&lt;String, String&gt; map = Maps.transformValues(underlying, Functions.toStringFunction());

    map.remove(&quot;a&quot;);
    assertFalse(underlying.containsKey(&quot;a&quot;));

    Set&lt;String&gt; keys = map.keySet();
    keys.remove(&quot;b&quot;);
    assertFalse(underlying.containsKey(&quot;b&quot;));

<A NAME="10"></A>    Iterator&lt;String&gt; keyIterator = keys.iterator();
    keyIterator.next();
    keyIterator.remove();
    assertFalse</B></FONT>(<FONT color="#ad5910"><A HREF="javascript:ZweiFrames('match50078-1.html#10',3,'match50078-top.html#10',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>underlying.containsKey(&quot;c&quot;));

    Collection&lt;String&gt; values = map.values();
    values.remove(&quot;4&quot;);
    assertFalse(underlying.containsKey(&quot;d&quot;));

    Iterator&lt;String&gt; valueIterator = values.iterator();
    valueIterator.next();
    valueIterator.remove();
    assertFalse(underlying.containsKey</B></FONT>(&quot;e&quot;));

    Set&lt;Entry&lt;String, String&gt;&gt; entries = map.entrySet();
    Entry&lt;String, String&gt; firstEntry = entries.iterator().next();
    entries.remove(firstEntry);
    assertFalse(underlying.containsKey(&quot;f&quot;));
<A NAME="2"></A>
    Iterator&lt;Entry&lt;String, String&gt;&gt; entryIterator = entries.iterator();
    entryIterator.next();
    <FONT color="#980517"><A HREF="javascript:ZweiFrames('match50078-1.html#2',3,'match50078-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>entryIterator.remove();
    assertFalse(underlying.containsKey(&quot;g&quot;));

    assertTrue(underlying.isEmpty());
    assertTrue(map.isEmpty());
    assertTrue(keys.isEmpty());
    assertTrue(values.isEmpty());
    assertTrue(entries.isEmpty());
  }

  public void testTransformEquals() {
    Map&lt;String, Integer&gt; underlying = ImmutableMap.of(&quot;a&quot;, 0, &quot;b&quot;, 1, &quot;c&quot;, 2);
    Map&lt;String, Integer&gt; expected = Maps.transformValues(underlying, Functions.&lt;Integer&gt;identity())</B></FONT>;

    assertMapsEqual(expected, expected);

    Map&lt;String, Integer&gt; equalToUnderlying = Maps.newTreeMap();
    equalToUnderlying.putAll(underlying);
    Map&lt;String, Integer&gt; map =
        Maps.transformValues(equalToUnderlying, Functions.&lt;Integer&gt;identity());
    assertMapsEqual(expected, map);

    map =
        Maps.transformValues(
            ImmutableMap.of(&quot;a&quot;, 1, &quot;b&quot;, 2, &quot;c&quot;, 3),
            new Function&lt;Integer, Integer&gt;() {
              @Override
              public Integer apply(Integer from) {
<A NAME="14"></A>                return from - 1;
              }
            });
    <FONT color="#842dce"><A HREF="javascript:ZweiFrames('match50078-1.html#14',3,'match50078-top.html#14',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertMapsEqual(expected, map);
  }

  public void testTransformEntrySetContains() {
    Map&lt;String, Boolean&gt; underlying = Maps.newHashMap();
    underlying.put(&quot;a&quot;, null);
    underlying.put(&quot;b&quot;, true);
    underlying.put</B></FONT>(null, true);

    Map&lt;String, Boolean&gt; map =
        Maps.transformValues(
            underlying,
            new Function&lt;Boolean, Boolean&gt;() {
              @Override
              public Boolean apply(@Nullable Boolean from) {
                return (from == null) ? true : null;
<A NAME="7"></A>              }
            });

    Set&lt;Entry&lt;String, Boolean&gt;&gt; entries = <FONT color="#38a4a5"><A HREF="javascript:ZweiFrames('match50078-1.html#7',3,'match50078-top.html#7',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>map.entrySet();
    assertTrue(entries.contains(Maps.immutableEntry(&quot;a&quot;, true)));
    assertTrue(entries.contains(Maps.immutableEntry(&quot;b&quot;, (Boolean) null)));
    assertTrue(entries.contains(Maps.immutableEntry((String) null, (Boolean) null)));

    assertFalse(entries.contains(Maps.immutableEntry(&quot;c&quot;, (Boolean) null)));
    assertFalse(entries.contains(Maps.immutableEntry</B></FONT>((String) null, true)));
  }

<A NAME="13"></A>  @Override
  public void testKeySetRemoveAllNullFromEmpty() {
    try {
      <FONT color="#3b9c9c"><A HREF="javascript:ZweiFrames('match50078-1.html#13',3,'match50078-top.html#13',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>super.testKeySetRemoveAllNullFromEmpty();
    } catch (RuntimeException tolerated) {
      // GWT's HashMap.keySet().removeAll(null) doesn't throws NPE.
    }
  }

<A NAME="16"></A>  @Override</B></FONT>
  public void testEntrySetRemoveAllNullFromEmpty() {
    try {
      <FONT color="#2981b2"><A HREF="javascript:ZweiFrames('match50078-1.html#16',3,'match50078-top.html#16',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>super.testEntrySetRemoveAllNullFromEmpty();
    } catch (RuntimeException tolerated) {
      // GWT's HashMap.entrySet().removeAll(null) doesn't throws NPE.
    }
  }</B></FONT>
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>FilesTest_1.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2007 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
<A NAME="12"></A> * limitations under the License.
 */

<FONT color="#571b7e"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#12',2,'match50078-top.html#12',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>package com.google.common.io;

import static com.google.common.truth.Truth.assertThat;

import com.google.common.base.Charsets;
import com.google.common.collect.ImmutableList;
import com.google.common.hash.Hashing;
import com.google.common.primitives.Bytes;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.ByteArrayOutputStream;
import java.io.File;
import</B></FONT> java.io.FileNotFoundException;
import java.io.IOException;
import java.io.PrintWriter;
import java.io.RandomAccessFile;
import java.nio.ByteBuffer;
import java.nio.MappedByteBuffer;
import java.nio.channels.FileChannel.MapMode;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Random;
import junit.framework.TestSuite;

/**
 * Unit test for {@link Files}.
 *
 * &lt;p&gt;Note: {@link Files#fileTraverser()} is tested in {@link FilesFileTraverserTest}.
 *
 * @author Chris Nokleberg
 */

public class FilesTest extends IoTestCase {
<A NAME="7"></A>
  public static TestSuite suite() {
    TestSuite suite = new TestSuite();
    <FONT color="#38a4a5"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#7',2,'match50078-top.html#7',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>suite.addTest(
        ByteSourceTester.tests(
            &quot;Files.asByteSource[File]&quot;, SourceSinkFactories.fileByteSourceFactory(), true));
    suite.addTest(
        ByteSinkTester.tests(&quot;Files.asByteSink[File]&quot;, SourceSinkFactories.fileByteSinkFactory()));
    suite.addTest(
        ByteSinkTester.tests(
            &quot;Files.asByteSink[File, APPEND]&quot;, SourceSinkFactories.appendingFileByteSinkFactory()));
    suite.addTest(
        CharSourceTester.tests(
            &quot;Files.asCharSource[File, Charset]&quot;,
            SourceSinkFactories.fileCharSourceFactory(),
            false));
    suite.addTest(
        CharSinkTester.tests(
            &quot;Files.asCharSink[File, Charset]&quot;, SourceSinkFactories.fileCharSinkFactory()));
    suite.addTest</B></FONT>(
        CharSinkTester.tests(
            &quot;Files.asCharSink[File, Charset, APPEND]&quot;,
            SourceSinkFactories.appendingFileCharSinkFactory()));
    suite.addTestSuite(FilesTest.class);
    return suite;
  }

  public void testRoundTripSources() throws Exception {
    File asciiFile = getTestFile(&quot;ascii.txt&quot;);
    ByteSource byteSource = Files.asByteSource(asciiFile);
    assertSame(byteSource, byteSource.asCharSource(Charsets.UTF_8).asByteSource(Charsets.UTF_8));
  }

  public void testToByteArray() throws IOException {
    File asciiFile = getTestFile(&quot;ascii.txt&quot;);
    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    assertTrue(Arrays.equals(ASCII.getBytes(Charsets.US_ASCII), Files.toByteArray(asciiFile)));
    assertTrue(Arrays.equals(I18N.getBytes(Charsets.UTF_8), Files.toByteArray(i18nFile)));
    assertTrue(Arrays.equals(I18N.getBytes(Charsets.UTF_8), Files.asByteSource(i18nFile).read()));
  }

  /** A {@link File} that provides a specialized value for {@link File#length()}. */
  private static class BadLengthFile extends File {

    private final long badLength;
<A NAME="18"></A>
    public BadLengthFile(File delegate, long badLength) {
      super(delegate.getPath());
      <FONT color="#800517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#18',2,'match50078-top.html#18',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>this.badLength = badLength;
    }

    @Override
    public long length() {
      return badLength;
    }</B></FONT>

    private static final long serialVersionUID = 0;
<A NAME="3"></A>  }

  public void testToString() throws IOException {
    <FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#3',2,'match50078-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>File asciiFile = getTestFile(&quot;ascii.txt&quot;);
    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    assertEquals(ASCII, Files.toString(asciiFile, Charsets.US_ASCII));
    assertEquals(I18N, Files.toString(i18nFile, Charsets.UTF_8));
    assertThat(Files.toString(i18nFile, Charsets.US_ASCII)).isNotEqualTo(I18N);
  }

  public void testWriteString() throws IOException {
    File temp = createTempFile();
    Files.write(I18N, temp, Charsets.UTF_16LE);
    assertEquals(I18N, Files.toString</B></FONT>(temp, Charsets.UTF_16LE));
  }

  public void testWriteBytes() throws IOException {
    File temp = createTempFile();
    byte[] data = newPreFilledByteArray(2000);
    Files.write(data, temp);
<A NAME="9"></A>    assertTrue(Arrays.equals(data, Files.toByteArray(temp)));

    try {
      <FONT color="#83a33a"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#9',2,'match50078-top.html#9',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Files.write(null, temp);
      fail(&quot;expected exception&quot;);
    } catch (NullPointerException expected) {
    }
  }

  public void testAppendString() throws IOException {
    File temp = createTempFile</B></FONT>();
    Files.append(I18N, temp, Charsets.UTF_16LE);
    assertEquals(I18N, Files.toString(temp, Charsets.UTF_16LE));
    Files.append(I18N, temp, Charsets.UTF_16LE);
    assertEquals(I18N + I18N, Files.toString(temp, Charsets.UTF_16LE));
    Files.append(I18N, temp, Charsets.UTF_16LE);
    assertEquals(I18N + I18N + I18N, Files.toString(temp, Charsets.UTF_16LE));
  }

  public void testCopyToOutputStream() throws IOException {
    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    ByteArrayOutputStream out = new ByteArrayOutputStream();
    Files.copy(i18nFile, out);
    assertEquals(I18N, out.toString(&quot;UTF-8&quot;));
  }

  public void testCopyToAppendable() throws IOException {
    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    StringBuilder sb = new StringBuilder();
    Files.copy(i18nFile, Charsets.UTF_8, sb);
    assertEquals(I18N, sb.toString());
  }

  public void testCopyFile() throws IOException {
    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    File temp = createTempFile();
    Files.copy(i18nFile, temp);
    assertEquals(I18N, Files.toString(temp, Charsets.UTF_8));
  }

  public void testCopyEqualFiles() throws IOException {
    File temp1 = createTempFile();
    File temp2 = file(temp1.getPath());
    assertEquals(temp1, temp2);
    Files.write(ASCII, temp1, Charsets.UTF_8);
    try {
      Files.copy(temp1, temp2);
      fail(&quot;Expected an IAE to be thrown but wasn't&quot;);
    } catch (IllegalArgumentException expected) {
    }
    assertEquals(ASCII, Files.toString(temp1, Charsets.UTF_8));
  }

  public void testCopySameFile() throws IOException {
    File temp = createTempFile();
    Files.write(ASCII, temp, Charsets.UTF_8);
    try {
      Files.copy(temp, temp);
      fail(&quot;Expected an IAE to be thrown but wasn't&quot;);
    } catch (IllegalArgumentException expected) {
    }
    assertEquals(ASCII, Files.toString(temp, Charsets.UTF_8));
<A NAME="5"></A>  }

  public void testCopyIdenticalFiles() throws IOException {
    File temp1 = <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#5',2,'match50078-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>createTempFile();
    Files.write(ASCII, temp1, Charsets.UTF_8);
    File temp2 = createTempFile();
    Files.write(ASCII, temp2, Charsets.UTF_8);
    Files.copy(temp1, temp2);
    assertEquals(ASCII, Files.toString(temp2, Charsets.UTF_8));
  }

  public void testEqual() throws IOException {
    File asciiFile = getTestFile(&quot;ascii.txt&quot;);
    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    assertFalse(Files.equal</B></FONT>(asciiFile, i18nFile));
    assertTrue(Files.equal(asciiFile, asciiFile));

    File temp = createTempFile();
    Files.copy(asciiFile, temp);
    assertTrue(Files.equal(asciiFile, temp));

    Files.copy(i18nFile, temp);
    assertTrue(Files.equal(i18nFile, temp));

    Files.copy(asciiFile, temp);
    RandomAccessFile rf = new RandomAccessFile(temp, &quot;rw&quot;);
    rf.writeByte(0);
    rf.close();
    assertEquals(asciiFile.length(), temp.length());
    assertFalse(Files.equal(asciiFile, temp));

    assertTrue(Files.asByteSource(asciiFile).contentEquals(Files.asByteSource(asciiFile)));

    // 0-length files have special treatment (/proc, etc.)
    assertTrue(Files.equal(asciiFile, new BadLengthFile(asciiFile, 0)));
<A NAME="8"></A>  }

  public void testNewReader() throws IOException {
    File asciiFile = <FONT color="#c58917"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#8',2,'match50078-top.html#8',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>getTestFile(&quot;ascii.txt&quot;);
    try {
      Files.newReader(asciiFile, null);
      fail(&quot;expected exception&quot;);
    } catch (NullPointerException expected) {
    }

    try {
      Files.newReader(null, Charsets.UTF_8);
      fail</B></FONT>(&quot;expected exception&quot;);
    } catch (NullPointerException expected) {
    }

    BufferedReader r = Files.newReader(asciiFile, Charsets.US_ASCII);
    try {
      assertEquals(ASCII, r.readLine());
    } finally {
      r.close();
    }
  }

  public void testNewWriter() throws IOException {
<A NAME="11"></A>    File temp = createTempFile();
    try {
      Files.newWriter(temp, null);
      <FONT color="#b041ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#11',2,'match50078-top.html#11',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>fail(&quot;expected exception&quot;);
    } catch (NullPointerException expected) {
    }

    try {
      Files.newWriter(null, Charsets.UTF_8);
      fail</B></FONT>(&quot;expected exception&quot;);
    } catch (NullPointerException expected) {
    }

    BufferedWriter w = Files.newWriter(temp, Charsets.UTF_8);
    try {
      w.write(I18N);
    } finally {
      w.close();
<A NAME="14"></A>    }

    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    assertTrue(<FONT color="#842dce"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#14',2,'match50078-top.html#14',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Files.equal(i18nFile, temp));
  }

  public void testTouch() throws IOException {
    File temp = createTempFile();
    assertTrue(temp.exists());
    assertTrue</B></FONT>(temp.delete());
    assertFalse(temp.exists());
    Files.touch(temp);
    assertTrue(temp.exists());
    Files.touch(temp);
    assertTrue(temp.exists());

    try {
      Files.touch(
          new File(temp.getPath()) {
            @Override
            public boolean setLastModified(long t) {
              return false;
            }
<A NAME="13"></A>
            private static final long serialVersionUID = 0;
          });
      <FONT color="#3b9c9c"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#13',2,'match50078-top.html#13',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>fail(&quot;expected exception&quot;);
    } catch (IOException expected) {
    }
  }

  public void t</B></FONT>estTouchTime() throws IOException {
    File temp = createTempFile();
    assertTrue(temp.exists());
    temp.setLastModified(0);
    assertEquals(0, temp.lastModified());
    Files.touch(temp);
    assertThat(temp.lastModified()).isNotEqualTo(0);
  }

  public void testCreateParentDirs_root() throws IOException {
    File file = root();
    assertNull(file.getParentFile());
    assertNull(file.getCanonicalFile().getParentFile());
    Files.createParentDirs(file);
  }

  public void testCreateParentDirs_relativePath() throws IOException {
    File file = file(&quot;nonexistent.file&quot;);
    assertNull(file.getParentFile());
    assertNotNull(file.getCanonicalFile().getParentFile());
    Files.createParentDirs(file);
  }

  public void testCreateParentDirs_noParentsNeeded() throws IOException {
    File file = file(getTempDir(), &quot;nonexistent.file&quot;);
    assertTrue(file.getParentFile().exists());
    Files.createParentDirs(file);
  }

  public void testCreateParentDirs_oneParentNeeded() throws IOException {
    File file = file(getTempDir(), &quot;parent&quot;, &quot;nonexistent.file&quot;);
    File parent = file.getParentFile();
    assertFalse(parent.exists());
    try {
      Files.createParentDirs(file);
      assertTrue(parent.exists());
    } finally {
      assertTrue(parent.delete());
    }
  }
<A NAME="4"></A>
  public void testCreateParentDirs_multipleParentsNeeded() throws IOException {
    File file = file(getTempDir(), &quot;grandparent&quot;, &quot;parent&quot;, &quot;nonexistent.file&quot;);
    File parent = <FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#4',2,'match50078-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>file.getParentFile();
    File grandparent = parent.getParentFile();
    assertFalse(grandparent.exists());
    Files.createParentDirs(file);
    assertTrue(parent.exists());
  }

  public void testCreateParentDirs_nonDirectoryParentExists() throws IOException {
    File parent = getTestFile(&quot;ascii.txt&quot;);
    assertTrue(parent.isFile());
<A NAME="16"></A>    File file = file</B></FONT>(parent, &quot;foo&quot;);
    try {
      Files.createParentDirs(file);
      <FONT color="#2981b2"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#16',2,'match50078-top.html#16',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>fail();
    } catch (IOException expected) {
    }
  }</B></FONT>

  public void testCreateTempDir() {
    File temp = Files.createTempDir();
    assertTrue(temp.exists());
    assertTrue(temp.isDirectory());
    assertThat(temp.listFiles()).isEmpty();
    assertTrue(temp.delete());
  }

  public void testMove() throws IOException {
    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    File temp1 = createTempFile();
    File temp2 = createTempFile();

    Files.copy(i18nFile, temp1);
    moveHelper(true, temp1, temp2);
    assertTrue(Files.equal(temp2, i18nFile));
  }

  public void testMoveViaCopy() throws IOException {
    File i18nFile = getTestFile(&quot;i18n.txt&quot;);
    File temp1 = createTempFile();
    File temp2 = createTempFile();

    Files.copy(i18nFile, temp1);
    moveHelper(true, new UnmovableFile(temp1, false, true), temp2);
    assertTrue(Files.equal(temp2, i18nFile));
  }

  public void testMoveFailures() throws IOException {
    File temp1 = createTempFile();
    File temp2 = createTempFile();

    moveHelper(false, new UnmovableFile(temp1, false, false), temp2);
    moveHelper(
        false, new UnmovableFile(temp1, false, false), new UnmovableFile(temp2, true, false));

    try {
      File asciiFile = getTestFile(&quot;ascii.txt&quot;);
      moveHelper(false, asciiFile, asciiFile);
      fail(&quot;expected exception&quot;);
    } catch (IllegalArgumentException expected) {
    }
  }

  private void moveHelper(boolean success, File from, File to) throws IOException {
    try {
      Files.move(from, to);
      if (success) {
        assertFalse(from.exists());
        assertTrue(to.exists());
      } else {
        fail(&quot;expected exception&quot;);
      }
    } catch (IOException possiblyExpected) {
      if (success) {
        throw possiblyExpected;
      }
    }
  }

  private static class UnmovableFile extends File {

    private final boolean canRename;
    private final boolean canDelete;

    public UnmovableFile(File file, boolean canRename, boolean canDelete) {
      super(file.getPath());
      this.canRename = canRename;
      this.canDelete = canDelete;
<A NAME="15"></A>    }

    @Override
    public boolean renameTo(File to) <FONT color="#f52887"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#15',2,'match50078-top.html#15',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{
      return canRename &amp;&amp; super.renameTo(to);
    }

    @Override
    public boolean delete() {
      return canDelete &amp;&amp; super.delete</B></FONT>();
    }

    private static final long serialVersionUID = 0;
  }

  public void testLineReading() throws IOException {
    File temp = createTempFile();
<A NAME="2"></A>    assertNull(Files.readFirstLine(temp, Charsets.UTF_8));
    assertTrue(Files.readLines(temp, Charsets.UTF_8).isEmpty());

    PrintWriter w = new PrintWriter(<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#2',2,'match50078-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Files.newWriter(temp, Charsets.UTF_8));
    w.println(&quot;hello&quot;);
    w.println(&quot;&quot;);
    w.println(&quot; world  &quot;);
    w.println(&quot;&quot;);
    w.close();

    assertEquals(&quot;hello&quot;, Files.readFirstLine(temp, Charsets.UTF_8));
    assertEquals(
        ImmutableList.of(&quot;hello&quot;, &quot;&quot;, &quot; world  &quot;, &quot;&quot;), Files.readLines(temp, Charsets.UTF_8));

    assertTrue(temp.delete());
  }

  public void testReadLines_withLineProcessor() throws IOException {
    File temp = createTempFile();
    LineProcessor&lt;List&lt;String&gt;&gt; collect =</B></FONT>
        new LineProcessor&lt;List&lt;String&gt;&gt;() {
          List&lt;String&gt; collector = new ArrayList&lt;&gt;();

<A NAME="17"></A>          @Override
          public boolean processLine(String line) {
            collector.add(line);
            <FONT color="#3090c7"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#17',2,'match50078-top.html#17',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>return true;
          }

          @Override
          public List&lt;String&gt; getResult() {
            return collector;
          }</B></FONT>
        };
    assertThat(Files.readLines(temp, Charsets.UTF_8, collect)).isEmpty();

    PrintWriter w = new PrintWriter(Files.newWriter(temp, Charsets.UTF_8));
    w.println(&quot;hello&quot;);
    w.println(&quot;&quot;);
    w.println(&quot; world  &quot;);
    w.println(&quot;&quot;);
    w.close();
    Files.readLines(temp, Charsets.UTF_8, collect);
    assertThat(collect.getResult()).containsExactly(&quot;hello&quot;, &quot;&quot;, &quot; world  &quot;, &quot;&quot;).inOrder();

    LineProcessor&lt;List&lt;String&gt;&gt; collectNonEmptyLines =
        new LineProcessor&lt;List&lt;String&gt;&gt;() {
          List&lt;String&gt; collector = new ArrayList&lt;&gt;();

          @Override
          public boolean processLine(String line) {
            if (line.length() &gt; 0) {
              collector.add(line);
            }
            return true;
          }

          @Override
          public List&lt;String&gt; getResult() {
            return collector;
          }
        };
    Files.readLines(temp, Charsets.UTF_8, collectNonEmptyLines);
    assertThat(collectNonEmptyLines.getResult()).containsExactly(&quot;hello&quot;, &quot; world  &quot;).inOrder();

    assertTrue(temp.delete());
  }
<A NAME="6"></A>
  public void testHash() throws IOException {
    File asciiFile = getTestFile(&quot;ascii.txt&quot;);
    File i18nFile = <FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#6',2,'match50078-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>getTestFile(&quot;i18n.txt&quot;);

    String init = &quot;d41d8cd98f00b204e9800998ecf8427e&quot;;
    assertEquals(init, Hashing.md5().newHasher().hash().toString());

    String asciiHash = &quot;e5df5a39f2b8cb71b24e1d8038f93131&quot;;
    assertEquals(asciiHash, Files.hash(asciiFile, Hashing.md5()).toString());

    String i18nHash = &quot;7fa826962ce2079c8334cd4ebf33aea4&quot;;
    assertEquals(i18nHash, Files.hash(i18nFile, Hashing.md5</B></FONT>()).toString());
  }

  public void testMap() throws IOException {
    // Test data
    int size = 1024;
    byte[] bytes = newPreFilledByteArray(size);

    // Setup
    File file = createTempFile();
    Files.write(bytes, file);

    // Test
    MappedByteBuffer actual = Files.map(file);

    // Verify
    ByteBuffer expected = ByteBuffer.wrap(bytes);
    assertTrue(&quot;ByteBuffers should be equal.&quot;, expected.equals(actual));
  }

  public void testMap_noSuchFile() throws IOException {
    // Setup
    File file = createTempFile();
    boolean deleted = file.delete();
    assertTrue(deleted);

    // Test
    try {
      Files.map(file);
      fail(&quot;Should have thrown FileNotFoundException.&quot;);
    } catch (FileNotFoundException expected) {
    }
  }

  public void testMap_readWrite() throws IOException {
    // Test data
    int size = 1024;
    byte[] expectedBytes = new byte[size];
    byte[] bytes = newPreFilledByteArray(1024);

    // Setup
    File file = createTempFile();
    Files.write(bytes, file);

    Random random = new Random();
    random.nextBytes(expectedBytes);

    // Test
    MappedByteBuffer map = Files.map(file, MapMode.READ_WRITE);
    map.put(expectedBytes);

    // Verify
    byte[] actualBytes = Files.toByteArray(file);
    assertTrue(Arrays.equals(expectedBytes, actualBytes));
  }

  public void testMap_readWrite_creates() throws IOException {
    // Test data
    int size = 1024;
<A NAME="10"></A>    byte[] expectedBytes = newPreFilledByteArray(1024);

    // Setup
    File file = <FONT color="#ad5910"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#10',2,'match50078-top.html#10',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>createTempFile();
    boolean deleted = file.delete();
    assertTrue(deleted);
    assertFalse(file.exists());

    // Test
    MappedByteBuffer map = Files.map(file, MapMode.READ_WRITE, size);
    map.put(expectedBytes);

    // Verify
    assertTrue(file.exists());
    assertTrue</B></FONT>(file.isFile());
    assertEquals(size, file.length());
    byte[] actualBytes = Files.toByteArray(file);
    assertTrue(Arrays.equals(expectedBytes, actualBytes));
  }

  public void testMap_readWrite_max_value_plus_1() throws IOException {
    // Setup
    File file = createTempFile();
    // Test
    try {
      Files.map(file, MapMode.READ_WRITE, (long) Integer.MAX_VALUE + 1);
      fail(&quot;Should throw when size exceeds Integer.MAX_VALUE&quot;);
    } catch (IllegalArgumentException expected) {
    }
  }

  public void testGetFileExtension() {
    assertEquals(&quot;txt&quot;, Files.getFileExtension(&quot;.txt&quot;));
    assertEquals(&quot;txt&quot;, Files.getFileExtension(&quot;blah.txt&quot;));
<A NAME="1"></A>    assertEquals(&quot;txt&quot;, Files.getFileExtension(&quot;blah..txt&quot;));
    assertEquals(&quot;txt&quot;, Files.getFileExtension(&quot;.blah.txt&quot;));
    assertEquals(&quot;txt&quot;, Files.getFileExtension(&quot;/tmp/blah.txt&quot;));
    <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#1',2,'match50078-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertEquals(&quot;gz&quot;, Files.getFileExtension(&quot;blah.tar.gz&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;/&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;.&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;..&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;...&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;blah&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;blah.&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;.blah.&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;/foo.bar/blah&quot;));
    assertEquals(&quot;&quot;, Files.getFileExtension(&quot;/foo/.bar/blah&quot;));
  }

  public void testGetNameWithoutExtension() {</B></FONT>
    assertEquals(&quot;&quot;, Files.getNameWithoutExtension(&quot;.txt&quot;));
<A NAME="0"></A>    assertEquals(&quot;blah&quot;, Files.getNameWithoutExtension(&quot;blah.txt&quot;));
    assertEquals(&quot;blah.&quot;, Files.getNameWithoutExtension(&quot;blah..txt&quot;));
    assertEquals(&quot;.blah&quot;, Files.getNameWithoutExtension(&quot;.blah.txt&quot;));
    assertEquals(&quot;blah&quot;, <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match50078-0.html#0',2,'match50078-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Files.getNameWithoutExtension(&quot;/tmp/blah.txt&quot;));
    assertEquals(&quot;blah.tar&quot;, Files.getNameWithoutExtension(&quot;blah.tar.gz&quot;));
    assertEquals(&quot;&quot;, Files.getNameWithoutExtension(&quot;/&quot;));
    assertEquals(&quot;&quot;, Files.getNameWithoutExtension(&quot;.&quot;));
    assertEquals(&quot;.&quot;, Files.getNameWithoutExtension(&quot;..&quot;));
    assertEquals(&quot;..&quot;, Files.getNameWithoutExtension(&quot;...&quot;));
    assertEquals(&quot;blah&quot;, Files.getNameWithoutExtension(&quot;blah&quot;));
    assertEquals(&quot;blah&quot;, Files.getNameWithoutExtension(&quot;blah.&quot;));
    assertEquals(&quot;.blah&quot;, Files.getNameWithoutExtension(&quot;.blah.&quot;));
    assertEquals(&quot;blah&quot;, Files.getNameWithoutExtension(&quot;/foo.bar/blah&quot;));
    assertEquals(&quot;blah&quot;, Files.getNameWithoutExtension(&quot;/foo/.bar/blah&quot;));
  }

  public void testReadBytes() throws IOException {
    ByteProcessor&lt;byte[]&gt; processor =</B></FONT>
        new ByteProcessor&lt;byte[]&gt;() {
          private final ByteArrayOutputStream out = new ByteArrayOutputStream();

          @Override
          public boolean processBytes(byte[] buffer, int offset, int length) throws IOException {
            if (length &gt;= 0) {
              out.write(buffer, offset, length);
            }
            return true;
          }

          @Override
          public byte[] getResult() {
            return out.toByteArray();
          }
        };

    File asciiFile = getTestFile(&quot;ascii.txt&quot;);
    byte[] result = Files.readBytes(asciiFile, processor);
    assertEquals(Bytes.asList(Files.toByteArray(asciiFile)), Bytes.asList(result));
  }

  public void testReadBytes_returnFalse() throws IOException {
    ByteProcessor&lt;byte[]&gt; processor =
        new ByteProcessor&lt;byte[]&gt;() {
          private final ByteArrayOutputStream out = new ByteArrayOutputStream();

          @Override
          public boolean processBytes(byte[] buffer, int offset, int length) throws IOException {
            if (length &gt; 0) {
              out.write(buffer, offset, 1);
              return false;
            } else {
              return true;
            }
          }

          @Override
          public byte[] getResult() {
            return out.toByteArray();
          }
        };

    File asciiFile = getTestFile(&quot;ascii.txt&quot;);
    byte[] result = Files.readBytes(asciiFile, processor);
    assertEquals(1, result.length);
  }

  public void testPredicates() throws IOException {
    File asciiFile = getTestFile(&quot;ascii.txt&quot;);
    File dir = asciiFile.getParentFile();
    assertTrue(Files.isDirectory().apply(dir));
    assertFalse(Files.isFile().apply(dir));

    assertFalse(Files.isDirectory().apply(asciiFile));
    assertTrue(Files.isFile().apply(asciiFile));
  }

  /** Returns a root path for the file system. */
  private static File root() {
    return File.listRoots()[0];
  }

  /** Returns a {@code File} object for the given path parts. */
  private static File file(String first, String... more) {
    return file(new File(first), more);
  }

  /** Returns a {@code File} object for the given path parts. */
  private static File file(File first, String... more) {
    // not very efficient, but should definitely be correct
    File file = first;
    for (String name : more) {
      file = new File(file, name);
    }
    return file;
  }
}
</PRE>
</div>
  </div>
</body>
</html>
