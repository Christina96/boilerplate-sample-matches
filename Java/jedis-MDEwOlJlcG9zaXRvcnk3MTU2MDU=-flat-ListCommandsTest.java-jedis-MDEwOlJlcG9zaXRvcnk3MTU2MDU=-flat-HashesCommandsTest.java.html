
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 15, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ListCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.junit.Assert.assertArrayEquals;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertNotNull;
5  import static org.junit.Assert.assertNull;
6  import static org.junit.Assert.assertTrue;
7  import static org.junit.Assert.fail;
8  import static redis.clients.jedis.util.AssertUtil.assertByteArrayListEquals;
9  import java.util.ArrayList;
10  import java.util.Arrays;
11  import java.util.Collections;
12  import java.util.List;
13  import org.junit.Test;
14  import org.slf4j.Logger;
15  import org.slf4j.LoggerFactory;
16  import redis.clients.jedis.Jedis;
17  import redis.clients.jedis.args.ListPosition;
18  import redis.clients.jedis.args.ListDirection;
19  import redis.clients.jedis.exceptions.JedisDataException;
20  import redis.clients.jedis.params.LPosParams;
21  import redis.clients.jedis.util.KeyValue;
22  public class ListCommandsTest extends JedisCommandsTestBase {
23    private final Logger logger = LoggerFactory.getLogger(getClass());
24    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
25    final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x05 };
26    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
27    final byte[] bcar = { 0x09, 0x0A, 0x0B, 0x0C };
28    final byte[] bA = { 0x0A };
29    final byte[] bB = { 0x0B };
30    final byte[] bC = { 0x0C };
31    final byte[] b1 = { 0x01 };
32    final byte[] b2 = { 0x02 };
33    final byte[] b3 = { 0x03 };
34    final byte[] bhello = { 0x04, 0x02 };
35    final byte[] bx = { 0x02, 0x04 };
36    final byte[] bdst = { 0x11, 0x12, 0x13, 0x14 };
37    @Test
38    public void rpush() {
39      assertEquals(1, jedis.rpush("foo", "bar"));
40      assertEquals(2, jedis.rpush("foo", "foo"));
41      assertEquals(4, jedis.rpush("foo", "bar", "foo"));
42      assertEquals(1, jedis.rpush(bfoo, bbar));
43      assertEquals(2, jedis.rpush(bfoo, bfoo));
44      assertEquals(4, jedis.rpush(bfoo, bbar, bfoo));
45    }
46    @Test
47    public void lpush() {
48      assertEquals(1, jedis.lpush("foo", "bar"));
49      assertEquals(2, jedis.lpush("foo", "foo"));
50      assertEquals(4, jedis.lpush("foo", "bar", "foo"));
51      assertEquals(1, jedis.lpush(bfoo, bbar));
52      assertEquals(2, jedis.lpush(bfoo, bfoo));
53      assertEquals(4, jedis.lpush(bfoo, bbar, bfoo));
54    }
55    @Test
56    public void llen() {
57      assertEquals(0, jedis.llen("foo"));
58      jedis.lpush("foo", "bar");
59      jedis.lpush("foo", "car");
60      assertEquals(2, jedis.llen("foo"));
61      assertEquals(0, jedis.llen(bfoo));
62      jedis.lpush(bfoo, bbar);
63      jedis.lpush(bfoo, bcar);
<span onclick='openModal()' class='match'>64      assertEquals(2, jedis.llen(bfoo));
65    }
66    @Test
67    public void llenNotOnList() {
</span>68      try {
69        jedis.set("foo", "bar");
70        jedis.llen("foo");
71        fail("JedisDataException expected");
72      } catch (final JedisDataException e) {
73      }
74      try {
75        jedis.set(bfoo, bbar);
76        jedis.llen(bfoo);
77        fail("JedisDataException expected");
78      } catch (final JedisDataException e) {
79      }
80    }
81    @Test
82    public void lrange() {
83      jedis.rpush("foo", "a");
84      jedis.rpush("foo", "b");
85      jedis.rpush("foo", "c");
86      List<String> expected = new ArrayList<String>();
87      expected.add("a");
88      expected.add("b");
89      expected.add("c");
90      List<String> range = jedis.lrange("foo", 0, 2);
91      assertEquals(expected, range);
92      range = jedis.lrange("foo", 0, 20);
93      assertEquals(expected, range);
94      expected = new ArrayList<String>();
95      expected.add("b");
96      expected.add("c");
97      range = jedis.lrange("foo", 1, 2);
98      assertEquals(expected, range);
99      range = jedis.lrange("foo", 2, 1);
100      assertEquals(Collections.<String> emptyList(), range);
101      jedis.rpush(bfoo, bA);
102      jedis.rpush(bfoo, bB);
103      jedis.rpush(bfoo, bC);
104      List<byte[]> bexpected = new ArrayList<byte[]>();
105      bexpected.add(bA);
106      bexpected.add(bB);
107      bexpected.add(bC);
108      List<byte[]> brange = jedis.lrange(bfoo, 0, 2);
109      assertByteArrayListEquals(bexpected, brange);
110      brange = jedis.lrange(bfoo, 0, 20);
111      assertByteArrayListEquals(bexpected, brange);
112      bexpected = new ArrayList<byte[]>();
113      bexpected.add(bB);
114      bexpected.add(bC);
115      brange = jedis.lrange(bfoo, 1, 2);
116      assertByteArrayListEquals(bexpected, brange);
117      brange = jedis.lrange(bfoo, 2, 1);
118      assertByteArrayListEquals(Collections.<byte[]> emptyList(), brange);
119    }
120    @Test
121    public void ltrim() {
122      jedis.lpush("foo", "1");
123      jedis.lpush("foo", "2");
124      jedis.lpush("foo", "3");
125      String status = jedis.ltrim("foo", 0, 1);
126      List<String> expected = new ArrayList<String>();
127      expected.add("3");
128      expected.add("2");
129      assertEquals("OK", status);
130      assertEquals(2, jedis.llen("foo"));
131      assertEquals(expected, jedis.lrange("foo", 0, 100));
132      jedis.lpush(bfoo, b1);
133      jedis.lpush(bfoo, b2);
134      jedis.lpush(bfoo, b3);
135      String bstatus = jedis.ltrim(bfoo, 0, 1);
136      List<byte[]> bexpected = new ArrayList<byte[]>();
137      bexpected.add(b3);
138      bexpected.add(b2);
139      assertEquals("OK", bstatus);
140      assertEquals(2, jedis.llen(bfoo));
141      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
142    }
143    @Test
144    public void lset() {
145      jedis.lpush("foo", "1");
146      jedis.lpush("foo", "2");
147      jedis.lpush("foo", "3");
148      List<String> expected = new ArrayList<String>();
149      expected.add("3");
150      expected.add("bar");
151      expected.add("1");
152      String status = jedis.lset("foo", 1, "bar");
153      assertEquals("OK", status);
154      assertEquals(expected, jedis.lrange("foo", 0, 100));
155      jedis.lpush(bfoo, b1);
156      jedis.lpush(bfoo, b2);
157      jedis.lpush(bfoo, b3);
158      List<byte[]> bexpected = new ArrayList<byte[]>();
159      bexpected.add(b3);
160      bexpected.add(bbar);
161      bexpected.add(b1);
162      String bstatus = jedis.lset(bfoo, 1, bbar);
163      assertEquals("OK", bstatus);
164      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
165    }
166    @Test
167    public void lindex() {
168      jedis.lpush("foo", "1");
169      jedis.lpush("foo", "2");
170      jedis.lpush("foo", "3");
171      assertEquals("3", jedis.lindex("foo", 0));
172      assertNull(jedis.lindex("foo", 100));
173      jedis.lpush(bfoo, b1);
174      jedis.lpush(bfoo, b2);
175      jedis.lpush(bfoo, b3);
176      assertArrayEquals(b3, jedis.lindex(bfoo, 0));
177      assertNull(jedis.lindex(bfoo, 100));
178    }
179    @Test
180    public void lrem() {
181      jedis.lpush("foo", "hello");
182      jedis.lpush("foo", "hello");
183      jedis.lpush("foo", "x");
184      jedis.lpush("foo", "hello");
185      jedis.lpush("foo", "c");
186      jedis.lpush("foo", "b");
187      jedis.lpush("foo", "a");
188      List<String> expected = new ArrayList<String>();
189      expected.add("a");
190      expected.add("b");
191      expected.add("c");
192      expected.add("hello");
193      expected.add("x");
194      assertEquals(2, jedis.lrem("foo", -2, "hello"));
195      assertEquals(expected, jedis.lrange("foo", 0, 1000));
196      assertEquals(0, jedis.lrem("bar", 100, "foo"));
197      jedis.lpush(bfoo, bhello);
198      jedis.lpush(bfoo, bhello);
199      jedis.lpush(bfoo, bx);
200      jedis.lpush(bfoo, bhello);
201      jedis.lpush(bfoo, bC);
202      jedis.lpush(bfoo, bB);
203      jedis.lpush(bfoo, bA);
204      List<byte[]> bexpected = new ArrayList<byte[]>();
205      bexpected.add(bA);
206      bexpected.add(bB);
207      bexpected.add(bC);
208      bexpected.add(bhello);
209      bexpected.add(bx);
210      assertEquals(2, jedis.lrem(bfoo, -2, bhello));
211      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 1000));
212      assertEquals(0, jedis.lrem(bbar, 100, bfoo));
213    }
214    @Test
215    public void lpop() {
216      assertNull(jedis.lpop("foo"));
217      assertNull(jedis.lpop("foo", 0));
218      jedis.rpush("foo", "a");
219      jedis.rpush("foo", "b");
220      jedis.rpush("foo", "c");
221      assertEquals("a", jedis.lpop("foo"));
222      assertEquals(Arrays.asList("b", "c"), jedis.lpop("foo", 10));
223      assertNull(jedis.lpop("foo"));
224      assertNull(jedis.lpop("foo", 1));
225      assertNull(jedis.lpop(bfoo));
226      assertNull(jedis.lpop(bfoo, 0));
227      jedis.rpush(bfoo, bA);
228      jedis.rpush(bfoo, bB);
229      jedis.rpush(bfoo, bC);
230      assertArrayEquals(bA, jedis.lpop(bfoo));
231      assertByteArrayListEquals(Arrays.asList(bB, bC), jedis.lpop(bfoo, 10));
232      assertNull(jedis.lpop(bfoo));
233      assertNull(jedis.lpop(bfoo, 1));
234    }
235    @Test
236    public void rpop() {
237      assertNull(jedis.rpop("foo"));
238      assertNull(jedis.rpop("foo", 0));
239      jedis.rpush("foo", "a");
240      jedis.rpush("foo", "b");
241      jedis.rpush("foo", "c");
242      assertEquals("c", jedis.rpop("foo"));
243      assertEquals(Arrays.asList("b", "a"), jedis.rpop("foo", 10));
244      assertNull(jedis.rpop("foo"));
245      assertNull(jedis.rpop("foo", 1));
246      assertNull(jedis.rpop(bfoo));
247      assertNull(jedis.rpop(bfoo, 0));
248      jedis.rpush(bfoo, bA);
249      jedis.rpush(bfoo, bB);
250      jedis.rpush(bfoo, bC);
251      assertArrayEquals(bC, jedis.rpop(bfoo));
252      assertByteArrayListEquals(Arrays.asList(bB, bA), jedis.rpop(bfoo, 10));
253      assertNull(jedis.rpop(bfoo));
254      assertNull(jedis.rpop(bfoo, 1));
255    }
256    @Test
257    public void rpoplpush() {
258      jedis.rpush("foo", "a");
259      jedis.rpush("foo", "b");
260      jedis.rpush("foo", "c");
261      jedis.rpush("dst", "foo");
262      jedis.rpush("dst", "bar");
263      String element = jedis.rpoplpush("foo", "dst");
264      assertEquals("c", element);
265      List<String> srcExpected = new ArrayList<String>();
266      srcExpected.add("a");
267      srcExpected.add("b");
268      List<String> dstExpected = new ArrayList<String>();
269      dstExpected.add("c");
270      dstExpected.add("foo");
271      dstExpected.add("bar");
272      assertEquals(srcExpected, jedis.lrange("foo", 0, 1000));
273      assertEquals(dstExpected, jedis.lrange("dst", 0, 1000));
274      jedis.rpush(bfoo, bA);
275      jedis.rpush(bfoo, bB);
276      jedis.rpush(bfoo, bC);
277      jedis.rpush(bdst, bfoo);
278      jedis.rpush(bdst, bbar);
279      byte[] belement = jedis.rpoplpush(bfoo, bdst);
280      assertArrayEquals(bC, belement);
281      List<byte[]> bsrcExpected = new ArrayList<byte[]>();
282      bsrcExpected.add(bA);
283      bsrcExpected.add(bB);
284      List<byte[]> bdstExpected = new ArrayList<byte[]>();
285      bdstExpected.add(bC);
286      bdstExpected.add(bfoo);
287      bdstExpected.add(bbar);
288      assertByteArrayListEquals(bsrcExpected, jedis.lrange(bfoo, 0, 1000));
289      assertByteArrayListEquals(bdstExpected, jedis.lrange(bdst, 0, 1000));
290    }
291    @Test
292    public void blpop() throws InterruptedException {
293      List<String> result = jedis.blpop(1, "foo");
294      assertNull(result);
295      jedis.lpush("foo", "bar");
296      result = jedis.blpop(1, "foo");
297      assertNotNull(result);
298      assertEquals(2, result.size());
299      assertEquals("foo", result.get(0));
300      assertEquals("bar", result.get(1));
301      result = jedis.blpop(1, "foo", "foo1");
302      assertNull(result);
303      jedis.lpush("foo", "bar");
304      jedis.lpush("foo1", "bar1");
305      result = jedis.blpop(1, "foo1", "foo");
306      assertNotNull(result);
307      assertEquals(2, result.size());
308      assertEquals("foo1", result.get(0));
309      assertEquals("bar1", result.get(1));
310      jedis.lpush(bfoo, bbar);
311      List<byte[]> bresult = jedis.blpop(1, bfoo);
312      assertNotNull(bresult);
313      assertEquals(2, bresult.size());
314      assertArrayEquals(bfoo, bresult.get(0));
315      assertArrayEquals(bbar, bresult.get(1));
316      bresult = jedis.blpop(1, bfoo, bfoo1);
317      assertNull(bresult);
318      jedis.lpush(bfoo, bbar);
319      jedis.lpush(bfoo1, bcar);
320      bresult = jedis.blpop(1, bfoo, bfoo1);
321      assertNotNull(bresult);
322      assertEquals(2, bresult.size());
323      assertArrayEquals(bfoo, bresult.get(0));
324      assertArrayEquals(bbar, bresult.get(1));
325    }
326    @Test
327    public void blpopDouble() throws InterruptedException {
328      KeyValue<String, String> result = jedis.blpop(0.1, "foo");
329      assertNull(result);
330      jedis.lpush("foo", "bar");
331      result = jedis.blpop(3.2, "foo");
332      assertNotNull(result);
333      assertEquals("foo", result.getKey());
334      assertEquals("bar", result.getValue());
335      result = jedis.blpop(0.18, "foo", "foo1");
336      assertNull(result);
337      jedis.lpush("foo", "bar");
338      jedis.lpush("foo1", "bar1");
339      result = jedis.blpop(1d, "foo1", "foo");
340      assertNotNull(result);
341      assertEquals("foo1", result.getKey());
342      assertEquals("bar1", result.getValue());
343      jedis.lpush(bfoo, bbar);
344      KeyValue<byte[], byte[]> bresult = jedis.blpop(3.12, bfoo);
345      assertNotNull(bresult);
346      assertArrayEquals(bfoo, bresult.getKey());
347      assertArrayEquals(bbar, bresult.getValue());
348      bresult = jedis.blpop(0.11, bfoo, bfoo1);
349      assertNull(bresult);
350      jedis.lpush(bfoo, bbar);
351      jedis.lpush(bfoo1, bcar);
352      bresult = jedis.blpop(1d, bfoo, bfoo1);
353      assertNotNull(bresult);
354      assertArrayEquals(bfoo, bresult.getKey());
355      assertArrayEquals(bbar, bresult.getValue());
356    }
357    @Test
358    public void blpopDoubleWithSleep() {
359      long startMillis, totalMillis;
360      startMillis = System.currentTimeMillis();
361      KeyValue<String, String> result = jedis.blpop(0.04, "foo");
362      totalMillis = System.currentTimeMillis() - startMillis;
363      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
364      assertNull(result);
365      startMillis = System.currentTimeMillis();
366      new Thread(() -> {
367        try {
368          Thread.sleep(30);
369        } catch(InterruptedException e) {
370          logger.error("", e);
371        }
372        try (Jedis j = createJedis()) {
373          j.lpush("foo", "bar");
374        }
375      }).start();
376      result = jedis.blpop(1.2, "foo");
377      totalMillis = System.currentTimeMillis() - startMillis;
378      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
379      assertNotNull(result);
380      assertEquals("foo", result.getKey());
381      assertEquals("bar", result.getValue());
382    }
383    @Test
384    public void brpop() throws InterruptedException {
385      List<String> result = jedis.brpop(1, "foo");
386      assertNull(result);
387      jedis.lpush("foo", "bar");
388      result = jedis.brpop(1, "foo");
389      assertNotNull(result);
390      assertEquals(2, result.size());
391      assertEquals("foo", result.get(0));
392      assertEquals("bar", result.get(1));
393      result = jedis.brpop(1, "foo", "foo1");
394      assertNull(result);
395      jedis.lpush("foo", "bar");
396      jedis.lpush("foo1", "bar1");
397      result = jedis.brpop(1, "foo1", "foo");
398      assertNotNull(result);
399      assertEquals(2, result.size());
400      assertEquals("foo1", result.get(0));
401      assertEquals("bar1", result.get(1));
402      jedis.lpush(bfoo, bbar);
403      List<byte[]> bresult = jedis.brpop(1, bfoo);
404      assertNotNull(bresult);
405      assertEquals(2, bresult.size());
406      assertArrayEquals(bfoo, bresult.get(0));
407      assertArrayEquals(bbar, bresult.get(1));
408      bresult = jedis.brpop(1, bfoo, bfoo1);
409      assertNull(bresult);
410      jedis.lpush(bfoo, bbar);
411      jedis.lpush(bfoo1, bcar);
412      bresult = jedis.brpop(1, bfoo, bfoo1);
413      assertNotNull(bresult);
414      assertEquals(2, bresult.size());
415      assertArrayEquals(bfoo, bresult.get(0));
416      assertArrayEquals(bbar, bresult.get(1));
417    }
418    @Test
419    public void brpopDouble() throws InterruptedException {
420      KeyValue<String, String> result = jedis.brpop(0.1, "foo");
421      assertNull(result);
422      jedis.lpush("foo", "bar");
423      result = jedis.brpop(3.2, "foo");
424      assertNotNull(result);
425      assertEquals("foo", result.getKey());
426      assertEquals("bar", result.getValue());
427      result = jedis.brpop(0.18, "foo", "foo1");
428      assertNull(result);
429      jedis.lpush("foo", "bar");
430      jedis.lpush("foo1", "bar1");
431      result = jedis.brpop(1d, "foo1", "foo");
432      assertNotNull(result);
433      assertEquals("foo1", result.getKey());
434      assertEquals("bar1", result.getValue());
435      jedis.lpush(bfoo, bbar);
436      KeyValue<byte[], byte[]> bresult = jedis.brpop(3.12, bfoo);
437      assertNotNull(bresult);
438      assertArrayEquals(bfoo, bresult.getKey());
439      assertArrayEquals(bbar, bresult.getValue());
440      bresult = jedis.brpop(0.11, bfoo, bfoo1);
441      assertNull(bresult);
442      jedis.lpush(bfoo, bbar);
443      jedis.lpush(bfoo1, bcar);
444      bresult = jedis.brpop(1d, bfoo, bfoo1);
445      assertNotNull(bresult);
446      assertArrayEquals(bfoo, bresult.getKey());
447      assertArrayEquals(bbar, bresult.getValue());
448    }
449    @Test
450    public void brpopDoubleWithSleep() {
451      long startMillis, totalMillis;
452      startMillis = System.currentTimeMillis();
453      KeyValue<String, String> result = jedis.brpop(0.04, "foo");
454      totalMillis = System.currentTimeMillis() - startMillis;
455      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
456      assertNull(result);
457      startMillis = System.currentTimeMillis();
458      new Thread(() -> {
459        try {
460          Thread.sleep(30);
461        } catch(InterruptedException e) {
462          logger.error("", e);
463        }
464        try (Jedis j = createJedis()) {
465          j.lpush("foo", "bar");
466        }
467      }).start();
468      result = jedis.brpop(1.2, "foo");
469      totalMillis = System.currentTimeMillis() - startMillis;
470      assertTrue("TotalMillis=" + totalMillis, totalMillis < 200);
471      assertNotNull(result);
472      assertEquals("foo", result.getKey());
473      assertEquals("bar", result.getValue());
474    }
475    @Test
476    public void lpushx() {
477      assertEquals(0, jedis.lpushx("foo", "bar"));
478      jedis.lpush("foo", "a");
479      assertEquals(2, jedis.lpushx("foo", "b"));
480      assertEquals(0, jedis.lpushx(bfoo, bbar));
481      jedis.lpush(bfoo, bA);
482      assertEquals(2, jedis.lpushx(bfoo, bB));
483    }
484    @Test
485    public void rpushx() {
486      assertEquals(0, jedis.rpushx("foo", "bar"));
487      jedis.lpush("foo", "a");
488      assertEquals(2, jedis.rpushx("foo", "b"));
489      assertEquals(0, jedis.rpushx(bfoo, bbar));
490      jedis.lpush(bfoo, bA);
491      assertEquals(2, jedis.rpushx(bfoo, bB));
492    }
493    @Test
494    public void linsert() {
495      assertEquals(0, jedis.linsert("foo", ListPosition.BEFORE, "bar", "car"));
496      jedis.lpush("foo", "a");
497      assertEquals(2, jedis.linsert("foo", ListPosition.AFTER, "a", "b"));
498      List<String> expected = new ArrayList<String>();
499      expected.add("a");
500      expected.add("b");
501      assertEquals(expected, jedis.lrange("foo", 0, 100));
502      assertEquals(-1, jedis.linsert("foo", ListPosition.BEFORE, "bar", "car"));
503      assertEquals(0, jedis.linsert(bfoo, ListPosition.BEFORE, bbar, bcar));
504      jedis.lpush(bfoo, bA);
505      assertEquals(2, jedis.linsert(bfoo, ListPosition.AFTER, bA, bB));
506      List<byte[]> bexpected = new ArrayList<byte[]>();
507      bexpected.add(bA);
508      bexpected.add(bB);
509      assertByteArrayListEquals(bexpected, jedis.lrange(bfoo, 0, 100));
510      assertEquals(-1, jedis.linsert(bfoo, ListPosition.BEFORE, bbar, bcar));
511    }
512    @Test
513    public void brpoplpush() {
514      new Thread(new Runnable() {
515        @Override
516        public void run() {
517          try {
518            Thread.sleep(100);
519          } catch (InterruptedException e) {
520            logger.error("", e);
521          }
522          try (Jedis j = createJedis()) {
523            j.lpush("foo", "a");
524          }
525        }
526      }).start();
527      String element = jedis.brpoplpush("foo", "bar", 0);
528      assertEquals("a", element);
529      assertEquals(1, jedis.llen("bar"));
530      assertEquals("a", jedis.lrange("bar", 0, -1).get(0));
531      new Thread(new Runnable() {
532        @Override
533        public void run() {
534          try {
535            Thread.sleep(100);
536          } catch (InterruptedException e) {
537            logger.error("", e);
538          }
539          try (Jedis j = createJedis()) {
540            j.lpush(bfoo, bA);
541          }
542        }
543      }).start();
544      byte[] belement = jedis.brpoplpush(bfoo, bbar, 0);
545      assertArrayEquals(bA, belement);
546      assertEquals(1, jedis.llen("bar"));
547      assertArrayEquals(bA, jedis.lrange(bbar, 0, -1).get(0));
548    }
549    @Test
550    public void lpos() {
551      jedis.rpush("foo", "a");
552      jedis.rpush("foo", "b");
553      jedis.rpush("foo", "c");
554      Long pos = jedis.lpos("foo", "b");
555      assertEquals(1, pos.intValue());
556      pos = jedis.lpos("foo", "d");
557      assertNull(pos);
558      jedis.rpush("foo", "a");
559      jedis.rpush("foo", "b");
560      jedis.rpush("foo", "b");
561      pos = jedis.lpos("foo", "b", LPosParams.lPosParams());
562      assertEquals(1, pos.intValue());
563      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(3));
564      assertEquals(5, pos.intValue());
565      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2));
566      assertEquals(4, pos.intValue());
567      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-5));
568      assertNull(pos);
569      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(1).maxlen(2));
570      assertEquals(1, pos.intValue());
571      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2).maxlen(2));
572      assertNull(pos);
573      pos = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2).maxlen(2));
574      assertEquals(4, pos.intValue());
575      List<Long> expected = new ArrayList<Long>();
576      expected.add(1L);
577      expected.add(4L);
578      expected.add(5L);
579      List<Long> posList = jedis.lpos("foo", "b", LPosParams.lPosParams(), 2);
580      assertEquals(expected.subList(0, 2), posList);
581      posList = jedis.lpos("foo", "b", LPosParams.lPosParams(), 0);
582      assertEquals(expected, posList);
583      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2), 0);
584      assertEquals(expected.subList(1, 3), posList);
585      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(2).maxlen(5), 0);
586      assertEquals(expected.subList(1, 2), posList);
587      Collections.reverse(expected);
588      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-2), 0);
589      assertEquals(expected.subList(1, 3), posList);
590      posList = jedis.lpos("foo", "b", LPosParams.lPosParams().rank(-1).maxlen(5), 2);
591      assertEquals(expected.subList(0, 2), posList);
592      jedis.rpush(bfoo, bA);
593      jedis.rpush(bfoo, bB);
594      jedis.rpush(bfoo, bC);
595      pos = jedis.lpos(bfoo, bB);
596      assertEquals(1, pos.intValue());
597      pos = jedis.lpos(bfoo, b3);
598      assertNull(pos);
599      jedis.rpush(bfoo, bA);
600      jedis.rpush(bfoo, bB);
601      jedis.rpush(bfoo, bA);
602      pos = jedis.lpos(bfoo, bB, LPosParams.lPosParams().rank(2));
603      assertEquals(4, pos.intValue());
604      pos = jedis.lpos(bfoo, bB, LPosParams.lPosParams().rank(-2).maxlen(5));
605      assertEquals(1, pos.intValue());
606      expected.clear();
607      expected.add(0L);
608      expected.add(3L);
609      expected.add(5L);
610      posList = jedis.lpos(bfoo, bA, LPosParams.lPosParams().maxlen(6), 0);
611      assertEquals(expected, posList);
612      posList = jedis.lpos(bfoo, bA, LPosParams.lPosParams().maxlen(6).rank(2), 1);
613      assertEquals(expected.subList(1, 2), posList);
614    }
615    @Test
616    public void lmove() {
617      jedis.rpush("foo", "bar1", "bar2", "bar3");
618      assertEquals("bar3", jedis.lmove("foo", "bar", ListDirection.RIGHT, ListDirection.LEFT));
619      assertEquals(Collections.singletonList("bar3"), jedis.lrange("bar", 0, -1));
620      assertEquals(Arrays.asList("bar1", "bar2"), jedis.lrange("foo", 0, -1));
621      jedis.rpush(bfoo, b1, b2, b3);
622      assertArrayEquals(b3, jedis.lmove(bfoo, bbar, ListDirection.RIGHT, ListDirection.LEFT));
623      assertByteArrayListEquals(Collections.singletonList(b3), jedis.lrange(bbar, 0, -1));
624      assertByteArrayListEquals(Arrays.asList(b1, b2), jedis.lrange(bfoo, 0, -1));
625    }
626    @Test
627    public void blmove() {
628      new Thread(() -> {
629        try {
630          Thread.sleep(100);
631        } catch (InterruptedException e) {
632          logger.error("", e);
633        }
634        try (Jedis j = createJedis()) {
635          j.rpush("foo", "bar1", "bar2", "bar3");
636        }
637      }).start();
638      assertEquals("bar3", jedis.blmove("foo", "bar", ListDirection.RIGHT, ListDirection.LEFT, 0));
639      assertEquals(Collections.singletonList("bar3"), jedis.lrange("bar", 0, -1));
640      assertEquals(Arrays.asList("bar1", "bar2"), jedis.lrange("foo", 0, -1));
641      new Thread(() -> {
642        try {
643          Thread.sleep(100);
644        } catch (InterruptedException e) {
645          logger.error("", e);
646        }
647        try (Jedis j = createJedis()) {
648          j.rpush(bfoo, b1, b2, b3);
649        }
650      }).start();
651      assertArrayEquals(b3, jedis.blmove(bfoo, bbar, ListDirection.RIGHT, ListDirection.LEFT, 0));
652      assertByteArrayListEquals(Collections.singletonList(b3), jedis.lrange(bbar, 0, -1));
653      assertByteArrayListEquals(Arrays.asList(b1, b2), jedis.lrange(bfoo, 0, -1));
654    }
655    @Test
656    public void lmpop() {
657      String mylist1 = "mylist1";
658      String mylist2 = "mylist2";
659      jedis.lpush(mylist1, "one", "two", "three", "four", "five");
660      jedis.lpush(mylist2, "one", "two", "three", "four", "five");
661      KeyValue<String, List<String>> elements = jedis.lmpop(ListDirection.LEFT, mylist1, mylist2);
662      assertEquals(mylist1, elements.getKey());
663      assertEquals(1, elements.getValue().size());
664      elements = jedis.lmpop(ListDirection.LEFT, 5, mylist1, mylist2);
665      assertEquals(mylist1, elements.getKey());
666      assertEquals(4, elements.getValue().size());
667      elements = jedis.lmpop(ListDirection.RIGHT, 100, mylist1, mylist2);
668      assertEquals(mylist2, elements.getKey());
669      assertEquals(5, elements.getValue().size());
670      elements = jedis.lmpop(ListDirection.RIGHT, mylist1, mylist2);
671      assertNull(elements);
672    }
673    @Test
674    public void blmpopSimple() {
675      String mylist1 = "mylist1";
676      String mylist2 = "mylist2";
677      jedis.lpush(mylist1, "one", "two", "three", "four", "five");
678      jedis.lpush(mylist2, "one", "two", "three", "four", "five");
679      KeyValue<String, List<String>> elements = jedis.blmpop(1L, ListDirection.LEFT, mylist1, mylist2);
680      assertEquals(mylist1, elements.getKey());
681      assertEquals(1, elements.getValue().size());
682      elements = jedis.blmpop(1L, ListDirection.LEFT, 5, mylist1, mylist2);
683      assertEquals(mylist1, elements.getKey());
684      assertEquals(4, elements.getValue().size());
685      elements = jedis.blmpop(1L, ListDirection.RIGHT, 100, mylist1, mylist2);
686      assertEquals(mylist2, elements.getKey());
687      assertEquals(5, elements.getValue().size());
688      elements = jedis.blmpop(1L, ListDirection.RIGHT, mylist1, mylist2);
689      assertNull(elements);
690    }
691  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-HashesCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.junit.Assert.assertArrayEquals;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertFalse;
5  import static org.junit.Assert.assertTrue;
6  import static org.junit.Assert.assertNull;
7  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
8  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
9  import java.util.ArrayList;
10  import java.util.Collections;
11  import java.util.HashMap;
12  import java.util.LinkedHashMap;
13  import java.util.LinkedHashSet;
14  import java.util.List;
15  import java.util.Map;
16  import java.util.Set;
17  import org.junit.Test;
18  import redis.clients.jedis.Pipeline;
19  import redis.clients.jedis.Response;
20  import redis.clients.jedis.params.ScanParams;
21  import redis.clients.jedis.resps.ScanResult;
22  import redis.clients.jedis.util.AssertUtil;
23  import redis.clients.jedis.util.JedisByteHashMap;
24  public class HashesCommandsTest extends JedisCommandsTestBase {
25    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
26    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
27    final byte[] bcar = { 0x09, 0x0A, 0x0B, 0x0C };
28    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
29    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
30    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
31    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
32    @Test
33    public void hset() {
34      assertEquals(1, jedis.hset("foo", "bar", "car"));
35      assertEquals(0, jedis.hset("foo", "bar", "foo"));
36      assertEquals(1, jedis.hset(bfoo, bbar, bcar));
37      assertEquals(0, jedis.hset(bfoo, bbar, bfoo));
38    }
39    @Test
40    public void hget() {
41      jedis.hset("foo", "bar", "car");
42      assertNull(jedis.hget("bar", "foo"));
43      assertNull(jedis.hget("foo", "car"));
44      assertEquals("car", jedis.hget("foo", "bar"));
45      jedis.hset(bfoo, bbar, bcar);
46      assertNull(jedis.hget(bbar, bfoo));
47      assertNull(jedis.hget(bfoo, bcar));
48      assertArrayEquals(bcar, jedis.hget(bfoo, bbar));
49    }
50    @Test
51    public void hsetnx() {
52      assertEquals(1, jedis.hsetnx("foo", "bar", "car"));
53      assertEquals("car", jedis.hget("foo", "bar"));
54      assertEquals(0, jedis.hsetnx("foo", "bar", "foo"));
55      assertEquals("car", jedis.hget("foo", "bar"));
56      assertEquals(1, jedis.hsetnx("foo", "car", "bar"));
57      assertEquals("bar", jedis.hget("foo", "car"));
58      assertEquals(1, jedis.hsetnx(bfoo, bbar, bcar));
59      assertArrayEquals(bcar, jedis.hget(bfoo, bbar));
60      assertEquals(0, jedis.hsetnx(bfoo, bbar, bfoo));
61      assertArrayEquals(bcar, jedis.hget(bfoo, bbar));
62      assertEquals(1, jedis.hsetnx(bfoo, bcar, bbar));
63      assertArrayEquals(bbar, jedis.hget(bfoo, bcar));
64    }
65    @Test
66    public void hmset() {
67      Map<String, String> hash = new HashMap<String, String>();
68      hash.put("bar", "car");
69      hash.put("car", "bar");
70      assertEquals("OK", jedis.hmset("foo", hash));
71      assertEquals("car", jedis.hget("foo", "bar"));
72      assertEquals("bar", jedis.hget("foo", "car"));
73      Map<byte[], byte[]> bhash = new HashMap<byte[], byte[]>();
74      bhash.put(bbar, bcar);
75      bhash.put(bcar, bbar);
76      assertEquals("OK", jedis.hmset(bfoo, bhash));
77      assertArrayEquals(bcar, jedis.hget(bfoo, bbar));
78      assertArrayEquals(bbar, jedis.hget(bfoo, bcar));
79    }
80    @Test
81    public void hsetVariadic() {
82      Map<String, String> hash = new HashMap<String, String>();
83      hash.put("bar", "car");
84      hash.put("car", "bar");
85      assertEquals(2, jedis.hset("foo", hash));
86      assertEquals("car", jedis.hget("foo", "bar"));
87      assertEquals("bar", jedis.hget("foo", "car"));
88      Map<byte[], byte[]> bhash = new HashMap<byte[], byte[]>();
89      bhash.put(bbar, bcar);
90      bhash.put(bcar, bbar);
91      assertEquals(2, jedis.hset(bfoo, bhash));
92      assertArrayEquals(bcar, jedis.hget(bfoo, bbar));
93      assertArrayEquals(bbar, jedis.hget(bfoo, bcar));
94    }
95    @Test
96    public void hmget() {
97      Map<String, String> hash = new HashMap<String, String>();
98      hash.put("bar", "car");
99      hash.put("car", "bar");
100      jedis.hmset("foo", hash);
101      List<String> values = jedis.hmget("foo", "bar", "car", "foo");
102      List<String> expected = new ArrayList<String>();
103      expected.add("car");
104      expected.add("bar");
105      expected.add(null);
106      assertEquals(expected, values);
107      Map<byte[], byte[]> bhash = new HashMap<byte[], byte[]>();
108      bhash.put(bbar, bcar);
109      bhash.put(bcar, bbar);
110      jedis.hmset(bfoo, bhash);
111      List<byte[]> bvalues = jedis.hmget(bfoo, bbar, bcar, bfoo);
112      List<byte[]> bexpected = new ArrayList<byte[]>();
113      bexpected.add(bcar);
114      bexpected.add(bbar);
115      bexpected.add(null);
116      AssertUtil.assertByteArrayListEquals(bexpected, bvalues);
117    }
118    @Test
119    public void hincrBy() {
120      assertEquals(1, jedis.hincrBy("foo", "bar", 1));
121      assertEquals(0, jedis.hincrBy("foo", "bar", -1));
122      assertEquals(-10, jedis.hincrBy("foo", "bar", -10));
123      assertEquals(1, jedis.hincrBy(bfoo, bbar, 1));
124      assertEquals(0, jedis.hincrBy(bfoo, bbar, -1));
125      assertEquals(-10, jedis.hincrBy(bfoo, bbar, -10));
126    }
127    @Test
128    public void hincrByFloat() {
129      assertEquals(1.5d, jedis.hincrByFloat("foo", "bar", 1.5d), 0);
130      assertEquals(0d, jedis.hincrByFloat("foo", "bar", -1.5d), 0);
131      assertEquals(-10.7d, jedis.hincrByFloat("foo", "bar", -10.7d), 0);
132      assertEquals(1.5d, jedis.hincrByFloat(bfoo, bbar, 1.5d), 0d);
133      assertEquals(0d, jedis.hincrByFloat(bfoo, bbar, -1.5d), 0d);
134      assertEquals(-10.7d, jedis.hincrByFloat(bfoo, bbar, -10.7d), 0d);
135    }
136    @Test
137    public void hexists() {
138      Map<String, String> hash = new HashMap<String, String>();
139      hash.put("bar", "car");
140      hash.put("car", "bar");
141      jedis.hmset("foo", hash);
142      assertFalse(jedis.hexists("bar", "foo"));
143      assertFalse(jedis.hexists("foo", "foo"));
144      assertTrue(jedis.hexists("foo", "bar"));
145      Map<byte[], byte[]> bhash = new HashMap<byte[], byte[]>();
146      bhash.put(bbar, bcar);
147      bhash.put(bcar, bbar);
148      jedis.hmset(bfoo, bhash);
149      assertFalse(jedis.hexists(bbar, bfoo));
150      assertFalse(jedis.hexists(bfoo, bfoo));
151      assertTrue(jedis.hexists(bfoo, bbar));
152    }
153    @Test
154    public void hdel() {
155      Map<String, String> hash = new HashMap<>();
156      hash.put("bar", "car");
157      hash.put("car", "bar");
158      jedis.hmset("foo", hash);
159      assertEquals(0, jedis.hdel("bar", "foo"));
160      assertEquals(0, jedis.hdel("foo", "foo"));
161      assertEquals(1, jedis.hdel("foo", "bar"));
162      assertNull(jedis.hget("foo", "bar"));
163      Map<byte[], byte[]> bhash = new HashMap<>();
164      bhash.put(bbar, bcar);
165      bhash.put(bcar, bbar);
166      jedis.hmset(bfoo, bhash);
167      assertEquals(0, jedis.hdel(bbar, bfoo));
168      assertEquals(0, jedis.hdel(bfoo, bfoo));
169      assertEquals(1, jedis.hdel(bfoo, bbar));
170      assertNull(jedis.hget(bfoo, bbar));
171      jedis.hmset("foo", hash);
172      assertEquals(2, jedis.hdel("foo", "bar", "car", "dne"));
173      jedis.hmset(bfoo, bhash);
174      assertEquals(2, jedis.hdel(bfoo, bbar, bcar, bbar1));
175    }
176    @Test
177    public void hlen() {
178      Map<String, String> hash = new HashMap<String, String>();
179      hash.put("bar", "car");
180      hash.put("car", "bar");
181      jedis.hmset("foo", hash);
182      assertEquals(0, jedis.hlen("bar"));
183      assertEquals(2, jedis.hlen("foo"));
184      Map<byte[], byte[]> bhash = new HashMap<byte[], byte[]>();
185      bhash.put(bbar, bcar);
186      bhash.put(bcar, bbar);
187      jedis.hmset(bfoo, bhash);
188      assertEquals(0, jedis.hlen(bbar));
<span onclick='openModal()' class='match'>189      assertEquals(2, jedis.hlen(bfoo));
190    }
191    @Test
192    public void hkeys() {
</span>193      Map<String, String> hash = new LinkedHashMap<String, String>();
194      hash.put("bar", "car");
195      hash.put("car", "bar");
196      jedis.hmset("foo", hash);
197      Set<String> keys = jedis.hkeys("foo");
198      Set<String> expected = new LinkedHashSet<String>();
199      expected.add("bar");
200      expected.add("car");
201      assertEquals(expected, keys);
202      Map<byte[], byte[]> bhash = new LinkedHashMap<byte[], byte[]>();
203      bhash.put(bbar, bcar);
204      bhash.put(bcar, bbar);
205      jedis.hmset(bfoo, bhash);
206      Set<byte[]> bkeys = jedis.hkeys(bfoo);
207      Set<byte[]> bexpected = new LinkedHashSet<byte[]>();
208      bexpected.add(bbar);
209      bexpected.add(bcar);
210      AssertUtil.assertByteArraySetEquals(bexpected, bkeys);
211    }
212    @Test
213    public void hvals() {
214      Map<String, String> hash = new LinkedHashMap<String, String>();
215      hash.put("bar", "car");
216      hash.put("car", "bar");
217      jedis.hmset("foo", hash);
218      List<String> vals = jedis.hvals("foo");
219      assertEquals(2, vals.size());
220      AssertUtil.assertCollectionContains(vals, "bar");
221      AssertUtil.assertCollectionContains(vals, "car");
222      Map<byte[], byte[]> bhash = new LinkedHashMap<byte[], byte[]>();
223      bhash.put(bbar, bcar);
224      bhash.put(bcar, bbar);
225      jedis.hmset(bfoo, bhash);
226      List<byte[]> bvals = jedis.hvals(bfoo);
227      assertEquals(2, bvals.size());
228      AssertUtil.assertByteArrayCollectionContains(bvals, bbar);
229      AssertUtil.assertByteArrayCollectionContains(bvals, bcar);
230    }
231    @Test
232    public void hgetAll() {
233      Map<String, String> h = new HashMap<String, String>();
234      h.put("bar", "car");
235      h.put("car", "bar");
236      jedis.hmset("foo", h);
237      Map<String, String> hash = jedis.hgetAll("foo");
238      assertEquals(2, hash.size());
239      assertEquals("car", hash.get("bar"));
240      assertEquals("bar", hash.get("car"));
241      Map<byte[], byte[]> bh = new HashMap<byte[], byte[]>();
242      bh.put(bbar, bcar);
243      bh.put(bcar, bbar);
244      jedis.hmset(bfoo, bh);
245      Map<byte[], byte[]> bhash = jedis.hgetAll(bfoo);
246      assertEquals(2, bhash.size());
247      assertArrayEquals(bcar, bhash.get(bbar));
248      assertArrayEquals(bbar, bhash.get(bcar));
249    }
250    @Test
251    public void hgetAllPipeline() {
252      Map<byte[], byte[]> bh = new HashMap<byte[], byte[]>();
253      bh.put(bbar, bcar);
254      bh.put(bcar, bbar);
255      jedis.hmset(bfoo, bh);
256      Pipeline pipeline = jedis.pipelined();
257      Response<Map<byte[], byte[]>> bhashResponse = pipeline.hgetAll(bfoo);
258      pipeline.sync();
259      Map<byte[], byte[]> bhash = bhashResponse.get();
260      assertEquals(2, bhash.size());
261      assertArrayEquals(bcar, bhash.get(bbar));
262      assertArrayEquals(bbar, bhash.get(bcar));
263    }
264    @Test
265    public void hscan() {
266      jedis.hset("foo", "b", "b");
267      jedis.hset("foo", "a", "a");
268      ScanResult<Map.Entry<String, String>> result = jedis.hscan("foo", SCAN_POINTER_START);
269      assertEquals(SCAN_POINTER_START, result.getCursor());
270      assertFalse(result.getResult().isEmpty());
271      jedis.hset(bfoo, bbar, bcar);
272      ScanResult<Map.Entry<byte[], byte[]>> bResult = jedis.hscan(bfoo, SCAN_POINTER_START_BINARY);
273      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
274      assertFalse(bResult.getResult().isEmpty());
275    }
276    @Test
277    public void hscanMatch() {
278      ScanParams params = new ScanParams();
279      params.match("a*");
280      jedis.hset("foo", "b", "b");
281      jedis.hset("foo", "a", "a");
282      jedis.hset("foo", "aa", "aa");
283      ScanResult<Map.Entry<String, String>> result = jedis.hscan("foo", SCAN_POINTER_START, params);
284      assertEquals(SCAN_POINTER_START, result.getCursor());
285      assertFalse(result.getResult().isEmpty());
286      params = new ScanParams();
287      params.match(bbarstar);
288      jedis.hset(bfoo, bbar, bcar);
289      jedis.hset(bfoo, bbar1, bcar);
290      jedis.hset(bfoo, bbar2, bcar);
291      jedis.hset(bfoo, bbar3, bcar);
292      ScanResult<Map.Entry<byte[], byte[]>> bResult = jedis.hscan(bfoo, SCAN_POINTER_START_BINARY,
293        params);
294      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
295      assertFalse(bResult.getResult().isEmpty());
296    }
297    @Test
298    public void hscanCount() {
299      ScanParams params = new ScanParams();
300      params.count(2);
301      for (int i = 0; i < 10; i++) {
302        jedis.hset("foo", "a" + i, "a" + i);
303      }
304      ScanResult<Map.Entry<String, String>> result = jedis.hscan("foo", SCAN_POINTER_START, params);
305      assertFalse(result.getResult().isEmpty());
306      params = new ScanParams();
307      params.count(2);
308      jedis.hset(bfoo, bbar, bcar);
309      jedis.hset(bfoo, bbar1, bcar);
310      jedis.hset(bfoo, bbar2, bcar);
311      jedis.hset(bfoo, bbar3, bcar);
312      ScanResult<Map.Entry<byte[], byte[]>> bResult = jedis.hscan(bfoo, SCAN_POINTER_START_BINARY,
313        params);
314      assertFalse(bResult.getResult().isEmpty());
315    }
316    @Test
317    public void testHstrLen_EmptyHash() {
318      Long response = jedis.hstrlen("myhash", "k1");
319      assertEquals(0l, response.longValue());
320    }
321    @Test
322    public void testHstrLen() {
323      Map<String, String> values = new HashMap<>();
324      values.put("key", "value");
325      jedis.hmset("myhash", values);
326      Long response = jedis.hstrlen("myhash", "key");
327      assertEquals(5l, response.longValue());
328    }
329    @Test
330    public void testBinaryHstrLen() {
331      Map<byte[], byte[]> values = new HashMap<>();
332      values.put(bbar, bcar);
333      jedis.hmset(bfoo, values);
334      Long response = jedis.hstrlen(bfoo, bbar);
335      assertEquals(4l, response.longValue());
336    }
337    @Test
338    public void hrandfield() {
339      assertNull(jedis.hrandfield("foo"));
340      assertEquals(Collections.emptyList(), jedis.hrandfield("foo", 1));
341      assertEquals(Collections.emptyList(), jedis.hrandfieldWithValues("foo", 1));
342      assertEquals(Collections.emptyList(), jedis.hrandfieldWithValues("foo", -1));
343      Map<String, String> hash = new LinkedHashMap<>();
344      hash.put("bar", "bar");
345      hash.put("car", "car");
346      hash.put("bar1", "bar1");
347      jedis.hset("foo", hash);
348      assertTrue(hash.containsKey(jedis.hrandfield("foo")));
349      assertEquals(2, jedis.hrandfield("foo", 2).size());
350      List<Map.Entry<String, String>> actual = jedis.hrandfieldWithValues("foo", 2);
351      assertEquals(2, actual.size());
352      actual.forEach(e -> assertEquals(hash.get(e.getKey()), e.getValue()));
353      actual = jedis.hrandfieldWithValues("foo", 5);
354      assertEquals(3, actual.size());
355      actual.forEach(e -> assertEquals(hash.get(e.getKey()), e.getValue()));
356      actual = jedis.hrandfieldWithValues("foo", -5);
357      assertEquals(5, actual.size());
358      actual.forEach(e -> assertEquals(hash.get(e.getKey()), e.getValue()));
359      assertNull(jedis.hrandfield(bfoo));
360      assertEquals(Collections.emptyList(), jedis.hrandfield(bfoo, 1));
361      assertEquals(Collections.emptyList(), jedis.hrandfieldWithValues(bfoo, 1));
362      assertEquals(Collections.emptyList(), jedis.hrandfieldWithValues(bfoo, -1));
363      Map<byte[], byte[]> bhash = new JedisByteHashMap();
364      bhash.put(bbar, bbar);
365      bhash.put(bcar, bcar);
366      bhash.put(bbar1, bbar1);
367      jedis.hset(bfoo, bhash);
368      assertTrue(bhash.containsKey(jedis.hrandfield(bfoo)));
369      assertEquals(2, jedis.hrandfield(bfoo, 2).size());
370      List<Map.Entry<byte[], byte[]>> bactual = jedis.hrandfieldWithValues(bfoo, 2);
371      assertEquals(2, bactual.size());
372      bactual.forEach(e -> assertArrayEquals(bhash.get(e.getKey()), e.getValue()));
373      bactual = jedis.hrandfieldWithValues(bfoo, 5);
374      assertEquals(3, bactual.size());
375      bactual.forEach(e -> assertArrayEquals(bhash.get(e.getKey()), e.getValue()));
376      bactual = jedis.hrandfieldWithValues(bfoo, -5);
377      assertEquals(5, bactual.size());
378      bactual.forEach(e -> assertArrayEquals(bhash.get(e.getKey()), e.getValue()));
379    }
380  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ListCommandsTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-HashesCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>64      assertEquals(2, jedis.llen(bfoo));
65    }
66    @Test
67    public void llenNotOnList() {
</pre></code></div>
                <div class="column column_space"><pre><code>189      assertEquals(2, jedis.hlen(bfoo));
190    }
191    @Test
192    public void hkeys() {
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    