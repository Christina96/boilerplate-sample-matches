
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 3.571428571428571%, Tokens: 10</h2>
        <div class="column">
            <h3>Mybatis-PageHelper-MDEwOlJlcG9zaXRvcnkyMDY1MTY3Mg==-flat-PageTest.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package com.github.pagehelper.test.reasonable;
2  import com.github.pagehelper.PageHelper;
3  import com.github.pagehelper.PageInfo;
4  import com.github.pagehelper.mapper.UserMapper;
5  import com.github.pagehelper.model.User;
6  import com.github.pagehelper.util.MybatisReasonableHelper;
7  import org.apache.ibatis.session.SqlSession;
8  import org.junit.Test;
9  import java.util.List;
10  import static org.junit.Assert.assertEquals;
</span>11  public class PageTest {
12      @Test
13      public void testMapperWithStartPage() {
14          SqlSession sqlSession = MybatisReasonableHelper.getSqlSession();
15          UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
16          try {
17              PageHelper.startPage(20, 50);
18              List<User> list = userMapper.selectAll();
19              PageInfo<User> page = new PageInfo<User>(list);
20              assertEquals(33, list.size());
21              assertEquals(151, page.getStartRow());
22              assertEquals(4, page.getPageNum());
23              assertEquals(183, page.getTotal());
24              PageHelper.startPage(-3, 50);
25              list = userMapper.selectAll();
26              page = new PageInfo<User>(list);
27              assertEquals(50, list.size());
28              assertEquals(1, page.getStartRow());
29              assertEquals(1, page.getPageNum());
30              assertEquals(183, page.getTotal());
31          } finally {
32              sqlSession.close();
33          }
34      }
35      @Test
36      public void testMapperWithStartPageAndReasonableFalse() {
37          SqlSession sqlSession = MybatisReasonableHelper.getSqlSession();
38          UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
39          try {
40              PageHelper.startPage(20, 50, true, false, false);
41              List<User> list = userMapper.selectAll();
42              PageInfo<User> page = new PageInfo<User>(list);
43              assertEquals(0, list.size());
44              assertEquals(0, page.getStartRow());
45              assertEquals(20, page.getPageNum());
46              assertEquals(183, page.getTotal());
47              PageHelper.startPage(4, 50, true, false, false);
48              list = userMapper.selectAll();
49              page = new PageInfo<User>(list);
50              assertEquals(33, list.size());
51              assertEquals(151, page.getStartRow());
52              assertEquals(4, page.getPageNum());
53              assertEquals(183, page.getTotal());
54              PageHelper.startPage(-1, 50, true, false, false);
55              list = userMapper.selectAll();
56              page = new PageInfo<User>(list);
57              assertEquals(0, list.size());
58              assertEquals(0, page.getStartRow());
59              assertEquals(-1, page.getPageNum());
60              assertEquals(183, page.getTotal());
61          } finally {
62              sqlSession.close();
63          }
64      }
65      @Test
66      public void testMapperWithStartPageAndReasonableTrue() {
67          SqlSession sqlSession = MybatisReasonableHelper.getSqlSession();
68          UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
69          try {
70              PageHelper.startPage(20, 50, true, true, false);
71              List<User> list = userMapper.selectAll();
72              PageInfo<User> page = new PageInfo<User>(list);
73              assertEquals(33, list.size());
74              assertEquals(151, page.getStartRow());
75              assertEquals(4, page.getPageNum());
76              assertEquals(183, page.getTotal());
77              PageHelper.startPage(4, 50, true, true, false);
78              list = userMapper.selectAll();
79              page = new PageInfo<User>(list);
80              assertEquals(33, list.size());
81              assertEquals(151, page.getStartRow());
82              assertEquals(4, page.getPageNum());
83              assertEquals(183, page.getTotal());
84              PageHelper.startPage(-1, 50, true, true, false);
85              list = userMapper.selectAll();
86              page = new PageInfo<User>(list);
87              assertEquals(50, list.size());
88              assertEquals(1, page.getStartRow());
89              assertEquals(1, page.getPageNum());
90              assertEquals(183, page.getTotal());
91          } finally {
92              sqlSession.close();
93          }
94      }
95      @Test
96      public void testMapperWithStartPageAndPageSizeZeroFalse() {
97          SqlSession sqlSession = MybatisReasonableHelper.getSqlSession();
98          UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
99          try {
100              PageHelper.startPage(1, 0, true, true, false);
101              List<User> list = userMapper.selectAll();
102              PageInfo<User> page = new PageInfo<User>(list);
103              assertEquals(0, list.size());
104              assertEquals(0, page.getStartRow());
105              assertEquals(1, page.getPageNum());
106              assertEquals(183, page.getTotal());
107              PageHelper.startPage(1, Integer.MAX_VALUE, true, true, false);
108              list = userMapper.selectAll();
109              page = new PageInfo<User>(list);
110              assertEquals(183, list.size());
111              assertEquals(1, page.getStartRow());
112              assertEquals(1, page.getPageNum());
113              assertEquals(183, page.getTotal());
114          } finally {
115              sqlSession.close();
116          }
117      }
118      @Test
119      public void testMapperWithStartPageAndPageSizeZeroTrue() {
120          SqlSession sqlSession = MybatisReasonableHelper.getSqlSession();
121          UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
122          try {
123              PageHelper.startPage(1, 0, true, true, true);
124              List<User> list = userMapper.selectAll();
125              PageInfo<User> page = new PageInfo<User>(list);
126              assertEquals(183, list.size());
127              assertEquals(1, page.getStartRow());
128              assertEquals(1, page.getPageNum());
129              assertEquals(183, page.getTotal());
130              PageHelper.startPage(1, -1, true, true, true);
131              list = userMapper.selectAll();
132              page = new PageInfo<User>(list);
133              assertEquals(0, list.size());
134              assertEquals(0, page.getStartRow());
135              assertEquals(1, page.getPageNum());
136              assertEquals(183, page.getTotal());
137          } finally {
138              sqlSession.close();
139          }
140      }
141  }
</code></pre>
        </div>
        <div class="column">
            <h3>ribbon-MDEwOlJlcG9zaXRvcnk3NjE2MTU4-flat-NFHttpClient.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package com.netflix.http4;
2  import com.google.common.util.concurrent.ThreadFactoryBuilder;
3  import com.netflix.client.config.ClientConfigFactory;
4  import com.netflix.client.config.CommonClientConfigKey;
5  import com.netflix.client.config.IClientConfig;
6  import com.netflix.client.config.IClientConfigKey;
7  import com.netflix.client.config.Property;
8  import com.netflix.servo.annotations.DataSourceType;
9  import com.netflix.servo.annotations.Monitor;
10  import com.netflix.servo.monitor.Monitors;
</span>11  import com.netflix.servo.monitor.Stopwatch;
12  import com.netflix.servo.monitor.Timer;
13  import org.apache.http.Header;
14  import org.apache.http.HttpHost;
15  import org.apache.http.HttpRequest;
16  import org.apache.http.client.ClientProtocolException;
17  import org.apache.http.client.ResponseHandler;
18  import org.apache.http.client.methods.HttpUriRequest;
19  import org.apache.http.client.params.ClientPNames;
20  import org.apache.http.client.params.HttpClientParams;
21  import org.apache.http.client.utils.URIUtils;
22  import org.apache.http.conn.ClientConnectionManager;
23  import org.apache.http.conn.routing.HttpRoute;
24  import org.apache.http.impl.client.DefaultHttpClient;
25  import org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager;
26  import org.apache.http.message.BasicHeader;
27  import org.apache.http.params.HttpParams;
28  import org.apache.http.params.HttpProtocolParams;
29  import org.apache.http.protocol.HttpContext;
30  import org.slf4j.Logger;
31  import org.slf4j.LoggerFactory;
32  import java.io.IOException;
33  import java.net.URI;
34  import java.util.ArrayList;
35  import java.util.List;
36  import java.util.concurrent.Executors;
37  import java.util.concurrent.ScheduledExecutorService;
38  import java.util.concurrent.ThreadFactory;
39  import java.util.concurrent.TimeUnit;
40  import java.util.concurrent.atomic.AtomicInteger;
41  public class NFHttpClient extends DefaultHttpClient {
42  	private static final Logger LOGGER = LoggerFactory.getLogger(NFHttpClient.class);
43  	private static IClientConfigKey<Integer> RETRIES = new CommonClientConfigKey<Integer>("%s.nfhttpclient.retries", 3) {};
44  	private static IClientConfigKey<Integer> SLEEP_TIME_FACTOR_MS = new CommonClientConfigKey<Integer>("%s.nfhttpclient.sleepTimeFactorMs", 10) {};
45  	private static IClientConfigKey<Integer> CONN_IDLE_EVICT_TIME_MILLIS = new CommonClientConfigKey<Integer>("%s.nfhttpclient.connIdleEvictTimeMilliSeconds", 30*1000) {};
46  	protected static final String EXECUTE_TRACER = "HttpClient-ExecuteTimer";
47  	private static ScheduledExecutorService connectionPoolCleanUpScheduler;
48  	private HttpHost httpHost = null;
49  	private HttpRoute httpRoute = null;
50  	private static AtomicInteger numNonNamedHttpClients = new AtomicInteger();
51  	private final String name;
52  	ConnectionPoolCleaner connPoolCleaner;
53  	Property<Integer> connIdleEvictTimeMilliSeconds;
54  	private Property<Integer> retriesProperty;
55  	private Property<Integer> sleepTimeFactorMsProperty;
56  	private Timer tracer; 
57  	private Property<Integer> maxTotalConnectionProperty;
58  	private Property<Integer> maxConnectionPerHostProperty;
59  	static {
60  	    ThreadFactory factory = (new ThreadFactoryBuilder()).setDaemon(true)
61  	            .setNameFormat("Connection pool clean up thread")
62  	            .build();
63  	    connectionPoolCleanUpScheduler = Executors.newScheduledThreadPool(2, factory);
64  	}
65  	protected NFHttpClient(String host, int port){
66  		super(new ThreadSafeClientConnManager());
67  		this.name = "UNNAMED_" + numNonNamedHttpClients.incrementAndGet();
68  		httpHost = new HttpHost(host, port);
69  		httpRoute = new HttpRoute(httpHost);
70  		init(createDefaultConfig(), false);
71  	}   
72  	protected NFHttpClient(){
73  		super(new ThreadSafeClientConnManager());
74  		this.name = "UNNAMED_" + numNonNamedHttpClients.incrementAndGet();
75  		init(createDefaultConfig(), false);
76  	}
77  	private static IClientConfig createDefaultConfig() {
78  		IClientConfig config = ClientConfigFactory.DEFAULT.newConfig();
79  		config.loadProperties("default");
80  		return config;
81  	}
82  	protected NFHttpClient(String name) {
83  	    this(name, createDefaultConfig(), true);
84  	}
85      protected NFHttpClient(String name, IClientConfig config) {
86          this(name, config, true);
87      }
88      protected NFHttpClient(String name, IClientConfig config, boolean registerMonitor) {
89          super(new MonitoredConnectionManager(name));
90          this.name = name;
91          init(config, registerMonitor);
92      }
93  	void init(IClientConfig config, boolean registerMonitor) {
94  		HttpParams params = getParams();
95  		HttpProtocolParams.setContentCharset(params, "UTF-8");  
96  		params.setParameter(ClientPNames.CONNECTION_MANAGER_FACTORY_CLASS_NAME, 
97  				ThreadSafeClientConnManager.class.getName());
98  		HttpClientParams.setRedirecting(params, config.get(CommonClientConfigKey.FollowRedirects, true));
99  		List<Header> defaultHeaders = new ArrayList<Header>();
100  		defaultHeaders.add(new BasicHeader("Netflix.NFHttpClient.Version", "1.0"));
101  		defaultHeaders.add(new BasicHeader("X-netflix-httpclientname", name));
102  		params.setParameter(ClientPNames.DEFAULT_HEADERS, defaultHeaders);
103  		connPoolCleaner = new ConnectionPoolCleaner(name, this.getConnectionManager(), connectionPoolCleanUpScheduler);
104  		this.retriesProperty = config.getGlobalProperty(RETRIES.format(name));
105  		this.sleepTimeFactorMsProperty = config.getGlobalProperty(SLEEP_TIME_FACTOR_MS.format(name));
106  		setHttpRequestRetryHandler(
107  				new NFHttpMethodRetryHandler(this.name, this.retriesProperty.getOrDefault(), false,
108  						this.sleepTimeFactorMsProperty.getOrDefault()));
109  	    tracer = Monitors.newTimer(EXECUTE_TRACER + "-" + name, TimeUnit.MILLISECONDS);
110  	    if (registerMonitor) {
111              Monitors.registerObject(name, this);
112  	    }
113  	    maxTotalConnectionProperty = config.getDynamicProperty(CommonClientConfigKey.MaxTotalHttpConnections);
114  	    maxTotalConnectionProperty.onChange(newValue ->
115  	    	((ThreadSafeClientConnManager) getConnectionManager()).setMaxTotal(newValue)
116  	    );
117  	    maxConnectionPerHostProperty = config.getDynamicProperty(CommonClientConfigKey.MaxHttpConnectionsPerHost);
118  	    maxConnectionPerHostProperty.onChange(newValue ->
119  			((ThreadSafeClientConnManager) getConnectionManager()).setDefaultMaxPerRoute(newValue)
120          );
121  		connIdleEvictTimeMilliSeconds = config.getGlobalProperty(CONN_IDLE_EVICT_TIME_MILLIS.format(name));
122  	}
123  	public void initConnectionCleanerTask(){
124  		connPoolCleaner.setConnIdleEvictTimeMilliSeconds(getConnIdleEvictTimeMilliSeconds());
125  		connPoolCleaner.initTask();
126  	}
127  	@Monitor(name = "HttpClient-ConnPoolCleaner", type = DataSourceType.INFORMATIONAL)
128  	public ConnectionPoolCleaner getConnPoolCleaner() {
129  		return connPoolCleaner;
130  	}
131  	@Monitor(name = "HttpClient-ConnIdleEvictTimeMilliSeconds", type = DataSourceType.INFORMATIONAL)
132  	public Property<Integer> getConnIdleEvictTimeMilliSeconds() {
133  		return connIdleEvictTimeMilliSeconds;
134  	}
135  	@Monitor(name="HttpClient-ConnectionsInPool", type = DataSourceType.GAUGE)    
136  	public int getConnectionsInPool() {
137  		ClientConnectionManager connectionManager = this.getConnectionManager();
138  		if (connectionManager != null) {
139  			return ((ThreadSafeClientConnManager)connectionManager).getConnectionsInPool();
140  		} else {
141  			return 0;
142  		}
143  	}
144  	@Monitor(name = "HttpClient-MaxTotalConnections", type = DataSourceType.INFORMATIONAL)
145  	public int getMaxTotalConnnections() {
146  		ClientConnectionManager connectionManager = this.getConnectionManager();
147  		if (connectionManager != null) {
148  			return ((ThreadSafeClientConnManager)connectionManager).getMaxTotal();
149  		} else {
150  			return 0;
151  		}
152  	}
153  	@Monitor(name = "HttpClient-MaxConnectionsPerHost", type = DataSourceType.INFORMATIONAL)
154  	public int getMaxConnectionsPerHost() {
155  		ClientConnectionManager connectionManager = this.getConnectionManager();
156  		if (connectionManager != null) {
157  			if(httpRoute == null)
158  				return ((ThreadSafeClientConnManager)connectionManager).getDefaultMaxPerRoute();
159  			else
160  				return ((ThreadSafeClientConnManager)connectionManager).getMaxForRoute(httpRoute);
161  		} else {
162  			return 0;
163  		}
164  	}
165  	@Monitor(name = "HttpClient-NumRetries", type = DataSourceType.INFORMATIONAL)
166  	public int getNumRetries() {
167  		return this.retriesProperty.getOrDefault();
168  	}
169  	public void setConnIdleEvictTimeMilliSeconds(Property<Integer> connIdleEvictTimeMilliSeconds) {
170  		this.connIdleEvictTimeMilliSeconds = connIdleEvictTimeMilliSeconds;
171  	}
172  	@Monitor(name = "HttpClient-SleepTimeFactorMs", type = DataSourceType.INFORMATIONAL)
173  	public int getSleepTimeFactorMs() {
174  		return this.sleepTimeFactorMsProperty.getOrDefault();
175  	}
176  	private static HttpHost determineTarget(HttpUriRequest request) throws ClientProtocolException {
177  		HttpHost target = null;
178  		URI requestURI = request.getURI();
179  		if (requestURI.isAbsolute()) {
180  			target = URIUtils.extractHost(requestURI);
181  			if (target == null) {
182  				throw new ClientProtocolException(
183  						"URI does not specify a valid host name: " + requestURI);
184  			}
185  		}
186  		return target;
187  	}
188  	@Override
189  	public <T> T execute(
190  			final HttpUriRequest request,
191  			final ResponseHandler<? extends T> responseHandler)
192  					throws IOException, ClientProtocolException {
193  		return this.execute(request, responseHandler, null);
194  	}
195  	@Override
196  	public <T> T execute(
197  			final HttpUriRequest request,
198  			final ResponseHandler<? extends T> responseHandler,
199  			final HttpContext context)
200  					throws IOException, ClientProtocolException {
201  		HttpHost target = null;
202  		if(httpHost == null)
203  			target = determineTarget(request);
204  		else
205  			target = httpHost;
206  		return this.execute(target, request, responseHandler, context);
207  	}
208  	@Override
209  	public <T> T execute(
210  			final HttpHost target,
211  			final HttpRequest request,
212  			final ResponseHandler<? extends T> responseHandler)
213  					throws IOException, ClientProtocolException {
214  		return this.execute(target, request, responseHandler, null);
215  	}
216  	@Override
217  	public <T> T execute(
218  			final HttpHost target,
219  			final HttpRequest request,
220  			final ResponseHandler<? extends T> responseHandler,
221  			final HttpContext context)
222  					throws IOException, ClientProtocolException {
223  	    Stopwatch sw = tracer.start();
224  		try{
225  			LOGGER.debug("Executing HTTP method: {}, uri: {}", request.getRequestLine().getMethod(), request.getRequestLine().getUri());
226  			return super.execute(target, request, responseHandler, context);
227  		}finally{
228  			sw.stop();
229  		}
230  	}
231  	public void shutdown() {
232  	    if (connPoolCleaner != null) {
233  	        connPoolCleaner.shutdown();
234  	    }
235  	    getConnectionManager().shutdown();
236  	}
237  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Mybatis-PageHelper-MDEwOlJlcG9zaXRvcnkyMDY1MTY3Mg==-flat-PageTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from ribbon-MDEwOlJlcG9zaXRvcnk3NjE2MTU4-flat-NFHttpClient.java</div>
                </div>
                <div class="column column_space"><pre><code>1  package com.github.pagehelper.test.reasonable;
2  import com.github.pagehelper.PageHelper;
3  import com.github.pagehelper.PageInfo;
4  import com.github.pagehelper.mapper.UserMapper;
5  import com.github.pagehelper.model.User;
6  import com.github.pagehelper.util.MybatisReasonableHelper;
7  import org.apache.ibatis.session.SqlSession;
8  import org.junit.Test;
9  import java.util.List;
10  import static org.junit.Assert.assertEquals;
</pre></code></div>
                <div class="column column_space"><pre><code>1  package com.netflix.http4;
2  import com.google.common.util.concurrent.ThreadFactoryBuilder;
3  import com.netflix.client.config.ClientConfigFactory;
4  import com.netflix.client.config.CommonClientConfigKey;
5  import com.netflix.client.config.IClientConfig;
6  import com.netflix.client.config.IClientConfigKey;
7  import com.netflix.client.config.Property;
8  import com.netflix.servo.annotations.DataSourceType;
9  import com.netflix.servo.annotations.Monitor;
10  import com.netflix.servo.monitor.Monitors;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    