
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 9.75609756097561%, Tokens: 14</h2>
        <div class="column">
            <h3>Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-GMUserEvent.java</h3>
            <pre><code>1  package org.anjocaido.groupmanager.events;
2  import org.anjocaido.groupmanager.GroupManager;
3  import org.anjocaido.groupmanager.data.User;
4  import org.bukkit.event.Event;
5  import org.bukkit.event.HandlerList;
6  public class GMUserEvent extends Event {
7  	private static final HandlerList handlers = new HandlerList();
8  	@Override
9  	public HandlerList getHandlers() {
10  		return handlers;
11  	}
12  	public static HandlerList getHandlerList() {
13  		return handlers;
14  	}
15  	protected User user;
16  	protected String userName;
17  	protected Action action;
18  	public GMUserEvent(User user, Action action) {
19  		super();
20  		this.user = user;
21  		this.action = action;
22  		this.userName = user.getLastName();
23  	}
24  	public GMUserEvent(String userName, Action action) {
25  		super();
26  		this.userName = userName;
27  		this.action = action;
28  	}
29  	public Action getAction() {
30  		return this.action;
31  	}
32  	public User getUser() {
33  		return user;
34  	}
35  	public String getUserName() {
36  		return userName;
37  	}
38  	public enum Action {
39  		USER_PERMISSIONS_CHANGED, USER_INHERITANCE_CHANGED, USER_INFO_CHANGED, USER_GROUP_CHANGED, USER_SUBGROUP_CHANGED, USER_ADDED, USER_REMOVED,
40  	}
41  	public void schedule(final GMUserEvent event) {
42  		synchronized (GroupManager.getGMEventHandler().getServer()) {
<span onclick='openModal()' class='match'>43  			if (GroupManager.getGMEventHandler().getServer().getScheduler().scheduleSyncDelayedTask(GroupManager.getGMEventHandler().getPlugin(), new Runnable() {
44  				@Override
45  				public void run() {
46  					GroupManager.getGMEventHandler().getServer().getPluginManager().callEvent(event);
</span>47  				}
48  			}, 1) == -1)
49  				GroupManager.logger.warning("Could not schedule GM Event.");
50  		}
51  	}
52  }
</code></pre>
        </div>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-NettyServerTest.java</h3>
            <pre><code>1  package com.weibo.api.motan.transport.netty4;
2  import com.weibo.api.motan.common.MotanConstants;
3  import com.weibo.api.motan.common.URLParamType;
4  import com.weibo.api.motan.rpc.*;
5  import com.weibo.api.motan.transport.Channel;
6  import com.weibo.api.motan.transport.MessageHandler;
7  import com.weibo.api.motan.util.MotanSwitcherUtil;
8  import com.weibo.api.motan.util.RequestIdGenerator;
9  import org.junit.After;
10  import org.junit.Assert;
11  import org.junit.Before;
12  import org.junit.Test;
13  import java.util.HashMap;
14  import java.util.HashSet;
15  import java.util.Map;
16  import java.util.Set;
17  import static org.junit.Assert.fail;
18  public class NettyServerTest {
19      private NettyServer nettyServer;
20      private URL url;
21      private String interfaceName = "com.weibo.api.motan.protocol.example.IHello";
22      @Before
23      public void setUp() {
24          Map<String, String> parameters = new HashMap<>();
25          parameters.put("requestTimeout", "500");
26          url = new URL("netty", "localhost", 18080, interfaceName, parameters);
27          url.addParameter(URLParamType.asyncInitConnection.getName(), "false");
28      }
29      @After
30      public void tearDown() {
31          if (nettyServer != null) {
32              nettyServer.close();
33          }
34      }
35      @Test
36      public void testMaxServerConnection() throws InterruptedException {
37          int minClientConnection = 5;
38          int maxServerConnection = 7;
39          url.addParameter(URLParamType.minClientConnection.getName(), String.valueOf(minClientConnection));
40          url.addParameter(URLParamType.maxServerConnection.getName(), String.valueOf(maxServerConnection));
41          url.addParameter(URLParamType.requestTimeout.getName(), "10000");
42          nettyServer = new NettyServer(url, new MessageHandler() {
43              @Override
44              public Object handle(Channel channel, Object message) {
45                  Request request = (Request) message;
46                  DefaultResponse response = new DefaultResponse();
47                  response.setRequestId(request.getRequestId());
48                  response.setValue("method: " + request.getMethodName() + " requestId: " + request.getRequestId());
49                  return response;
50              }
51          });
52          nettyServer.open();
53          Assert.assertEquals(0, nettyServer.channelManage.getChannels().size());
54          NettyClient nettyClient = new NettyClient(url);
55          nettyClient.open();
56          Thread.sleep(100);
57          Assert.assertEquals(minClientConnection, nettyServer.channelManage.getChannels().size());
58          NettyClient nettyClient2 = new NettyClient(url);
59          nettyClient2.open();
60          Thread.sleep(100);
61          Assert.assertTrue(nettyServer.channelManage.getChannels().size() < minClientConnection * 2);
62          nettyClient.close();
63          nettyClient2.close();
64          Thread.sleep(100);
65          Assert.assertEquals(0, nettyServer.channelManage.getChannels().size());
66      }
67      @Test
68      public void testServerTrace() throws InterruptedException {
69          MotanSwitcherUtil.setSwitcherValue(MotanConstants.MOTAN_TRACE_INFO_SWITCHER, true);
70          final Set<String> serverTraceKey = new HashSet<>();
71          serverTraceKey.add(MotanConstants.TRACE_SRECEIVE);
72          serverTraceKey.add(MotanConstants.TRACE_SDECODE);
73          serverTraceKey.add(MotanConstants.TRACE_SEXECUTOR_START);
74          serverTraceKey.add(MotanConstants.TRACE_PROCESS);
75          serverTraceKey.add(MotanConstants.TRACE_SENCODE);
76          serverTraceKey.add(MotanConstants.TRACE_SSEND);
77          nettyServer = new NettyServer(url, new MessageHandler() {
78              @Override
79              public Object handle(Channel channel, Object message) {
80                  final Request request = (Request) message;
81                  if (request instanceof Traceable) {
82                      if (((Traceable) request).getTraceableContext().getReceiveTime() != 0) {
83                          serverTraceKey.remove(MotanConstants.TRACE_SRECEIVE);
84                      }
85                      serverTraceKey.removeAll(((Traceable) request).getTraceableContext().getTraceInfoMap().keySet());
86                  }
87                  final DefaultResponse response = new DefaultResponse();
<span onclick='openModal()' class='match'>88                  response.setRequestId(request.getRequestId());
89                  response.setValue("method: " + request.getMethodName() + " requestId: " + request.getRequestId());
90                  response.addFinishCallback(new Runnable() {
91                      @Override
92                      public void run() {
93                          serverTraceKey.removeAll(((Traceable) response).getTraceableContext().getTraceInfoMap().keySet());
</span>94                          if (((Traceable) response).getTraceableContext().getSendTime() != 0) {
95                              serverTraceKey.remove(MotanConstants.TRACE_SSEND);
96                          }
97                      }
98                  }, null);
99                  return response;
100              }
101          });
102          nettyServer.open();
103          DefaultRequest request = new DefaultRequest();
104          request.setRequestId(RequestIdGenerator.getRequestId());
105          request.setInterfaceName(interfaceName);
106          request.setMethodName("hello");
107          request.setParamtersDesc("void");
108          TraceableContext requestTraceableContext = request.getTraceableContext();
109          Assert.assertEquals(0, requestTraceableContext.getSendTime());
110          Assert.assertEquals(0, requestTraceableContext.getReceiveTime());
111          NettyClient nettyClient = new NettyClient(url);
112          nettyClient.open();
113          Response response;
114          try {
115              response = nettyClient.request(request);
116              Object result = response.getValue();
117              Assert.assertEquals("method: " + request.getMethodName() + " requestId: " + request.getRequestId(), result);
118              Assert.assertNotNull(requestTraceableContext.getTraceInfo(MotanConstants.TRACE_CONNECTION));
119              Assert.assertNotNull(requestTraceableContext.getTraceInfo(MotanConstants.TRACE_CENCODE));
120              Assert.assertFalse(0 == requestTraceableContext.getSendTime());
121              if (response instanceof Traceable) {
122                  Assert.assertFalse(0 == ((Traceable) response).getTraceableContext().getReceiveTime());
123                  Assert.assertNotNull(((Traceable) response).getTraceableContext().getTraceInfo(MotanConstants.TRACE_CDECODE));
124              }
125          } catch (Exception e) {
126              fail();
127          }
128          Thread.sleep(100);
129          nettyClient.close();
130          Assert.assertTrue(serverTraceKey.isEmpty());
131      }
132  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-GMUserEvent.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-NettyServerTest.java</div>
                </div>
                <div class="column column_space"><pre><code>43  			if (GroupManager.getGMEventHandler().getServer().getScheduler().scheduleSyncDelayedTask(GroupManager.getGMEventHandler().getPlugin(), new Runnable() {
44  				@Override
45  				public void run() {
46  					GroupManager.getGMEventHandler().getServer().getPluginManager().callEvent(event);
</pre></code></div>
                <div class="column column_space"><pre><code>88                  response.setRequestId(request.getRequestId());
89                  response.setValue("method: " + request.getMethodName() + " requestId: " + request.getRequestId());
90                  response.addFinishCallback(new Runnable() {
91                      @Override
92                      public void run() {
93                          serverTraceKey.removeAll(((Traceable) response).getTraceableContext().getTraceInfoMap().keySet());
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    