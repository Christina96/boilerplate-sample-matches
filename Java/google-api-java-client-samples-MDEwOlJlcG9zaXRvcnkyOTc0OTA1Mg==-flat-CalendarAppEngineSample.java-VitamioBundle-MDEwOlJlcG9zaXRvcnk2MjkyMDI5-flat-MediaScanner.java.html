
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 3.559870550161812%, Tokens: 11, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-CalendarAppEngineSample.java</h3>
            <pre><code>1  package com.google.api.services.samples.calendar.appengine.server;
<span onclick='openModal()' class='match'>2  import com.google.api.client.auth.oauth2.AuthorizationCodeFlow;
3  import com.google.api.client.extensions.appengine.auth.oauth2.AbstractAppEngineAuthorizationCodeServlet;
4  import com.google.appengine.api.users.UserService;
5  import com.google.appengine.api.users.UserServiceFactory;
6  import java.io.IOException;
7  import java.io.PrintWriter;
8  import javax.servlet.ServletException;
9  import javax.servlet.http.HttpServletRequest;
10  import javax.servlet.http.HttpServletResponse;
11  public class CalendarAppEngineSample extends AbstractAppEngineAuthorizationCodeServlet {
12    static final String APP_NAME = "Google Calendar Data API Sample Web Client";
</span>13    static final String GWT_MODULE_NAME = "calendar";
14    private static final long serialVersionUID = 1L;
15    @Override
16    protected void doGet(HttpServletRequest request, HttpServletResponse response)
17        throws IOException {
18      response.setContentType("text/html");
19      response.setCharacterEncoding("UTF-8");
20      PrintWriter writer = response.getWriter();
21      writer.println("<!doctype html><html><head>");
22      writer.println("<meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\">");
23      writer.println("<title>" + APP_NAME + "</title>");
24      writer.println(
25          "<link type=\"text/css\" rel=\"stylesheet\" href=\"" + GWT_MODULE_NAME + ".css\">");
26      writer.println("<script type=\"text/javascript\" language=\"javascript\" " + "src=\""
27          + GWT_MODULE_NAME + "/" + GWT_MODULE_NAME + ".nocache.js\"></script>");
28      writer.println("</head><body>");
29      UserService userService = UserServiceFactory.getUserService();
30      writer.println("<div class=\"header\"><b>" + request.getUserPrincipal().getName() + "</b> | "
31          + "<a href=\"" + userService.createLogoutURL(request.getRequestURL().toString())
32          + "\">Log out</a> | "
33          + "<a href=\"http:&bsol;&bsol;code.google.com/p/google-api-java-client/source/browse"
34          + "/calendar-appengine-sample?repo=samples\">See source code for "
35          + "this sample</a></div>");
36      writer.println("<div id=\"main\"/>");
37      writer.println("</body></html>");
38    }
39    @Override
40    protected String getRedirectUri(HttpServletRequest req) throws ServletException, IOException {
41      return Utils.getRedirectUri(req);
42    }
43    @Override
44    protected AuthorizationCodeFlow initializeFlow() throws IOException {
45      return Utils.newFlow();
46    }
47  }
</code></pre>
        </div>
        <div class="column">
            <h3>VitamioBundle-MDEwOlJlcG9zaXRvcnk2MjkyMDI5-flat-MediaScanner.java</h3>
            <pre><code>1  package io.vov.vitamio;
2  import android.content.ContentProviderClient;
3  import android.content.ContentUris;
4  import android.content.ContentValues;
5  import android.content.Context;
6  import android.database.Cursor;
7  import android.database.SQLException;
8  import android.net.Uri;
9  import android.os.RemoteException;
<span onclick='openModal()' class='match'>10  import android.text.TextUtils;
11  import io.vov.vitamio.provider.MediaStore;
12  import io.vov.vitamio.provider.MediaStore.Video;
13  import io.vov.vitamio.utils.ContextUtils;
14  import io.vov.vitamio.utils.FileUtils;
15  import io.vov.vitamio.utils.Log;
16  import java.io.File;
17  import java.util.HashMap;
18  import java.util.Iterator;
19  public class MediaScanner {
20    private static final String[] VIDEO_PROJECTION = new String[]{Video.Media._ID, Video.Media.DATA, Video.Media.DATE_MODIFIED,};
</span>21    private static final int ID_VIDEO_COLUMN_INDEX = 0;
22    private static final int PATH_VIDEO_COLUMN_INDEX = 1;
23    private static final int DATE_MODIFIED_VIDEO_COLUMN_INDEX = 2;
24    private Context mContext;
25    private ContentProviderClient mProvider;
26    private boolean mCaseInsensitivePaths;
27    private HashMap<String, FileCacheEntry> mFileCache;
28    private MyMediaScannerClient mClient = new MyMediaScannerClient();
29    public MediaScanner(Context ctx) {
30      mContext = ctx;
31      native_init(mClient);
32    }
33    private static native boolean loadFFmpeg_native(String ffmpegPath);
34    private void initialize() {
35      mCaseInsensitivePaths = true;
36    }
37    private void prescan(String filePath) throws RemoteException {
38      mProvider = mContext.getContentResolver().acquireContentProviderClient(MediaStore.AUTHORITY);
39      Cursor c = null;
40      String where = null;
41      String[] selectionArgs = null;
42      if (mFileCache == null)
43        mFileCache = new HashMap<String, FileCacheEntry>();
44      else
45        mFileCache.clear();
46      try {
47        if (filePath != null) {
48          where = Video.Media.DATA + "=?";
49          selectionArgs = new String[]{filePath};
50        }
51        c = mProvider.query(Video.Media.CONTENT_URI, VIDEO_PROJECTION, where, selectionArgs, null);
52        if (c != null) {
53          try {
54            while (c.moveToNext()) {
55              long rowId = c.getLong(ID_VIDEO_COLUMN_INDEX);
56              String path = c.getString(PATH_VIDEO_COLUMN_INDEX);
57              long lastModified = c.getLong(DATE_MODIFIED_VIDEO_COLUMN_INDEX);
58              if (path.startsWith("/")) {
59                File tempFile = new File(path);
60                if (!TextUtils.isEmpty(filePath) && !tempFile.exists()) {
61                  mProvider.delete(Video.Media.CONTENT_URI, where, selectionArgs);
62                  return;
63                }
64                path = FileUtils.getCanonical(tempFile);
65                String key = mCaseInsensitivePaths ? path.toLowerCase() : path;
66                mFileCache.put(key, new FileCacheEntry(Video.Media.CONTENT_URI, rowId, path, lastModified));
67              }
68            }
69          } finally {
70            c.close();
71            c = null;
72          }
73        }
74      } finally {
75        if (c != null) {
76          c.close();
77        }
78      }
79    }
80    ;
81    private void postscan(String[] directories) throws RemoteException {
82      Iterator<FileCacheEntry> iterator = mFileCache.values().iterator();
83      while (iterator.hasNext()) {
84        FileCacheEntry entry = iterator.next();
85        String path = entry.mPath;
86        if (!entry.mSeenInFileSystem) {
87          if (inScanDirectory(path, directories) && !new File(path).exists()) {
88            mProvider.delete(ContentUris.withAppendedId(entry.mTableUri, entry.mRowId), null, null);
89            iterator.remove();
90          }
91        }
92      }
93      mFileCache.clear();
94      mFileCache = null;
95      mProvider.release();
96      mProvider = null;
97    }
98    private boolean inScanDirectory(String path, String[] directories) {
99      for (int i = 0; i < directories.length; i++) {
100        if (path.startsWith(directories[i]))
101          return true;
102      }
103      return false;
104    }
105    public void scanDirectories(String[] directories) {
106      try {
107        long start = System.currentTimeMillis();
108        prescan(null);
109        long prescan = System.currentTimeMillis();
110        for (int i = 0; i < directories.length; i++) {
111          if (!TextUtils.isEmpty(directories[i])) {
112            directories[i] = ContextUtils.fixLastSlash(directories[i]);
113            processDirectory(directories[i], MediaFile.sFileExtensions);
114          }
115        }
116        long scan = System.currentTimeMillis();
117        postscan(directories);
118        long end = System.currentTimeMillis();
119        Log.d(" prescan time: %dms", prescan - start);
120        Log.d("    scan time: %dms", scan - prescan);
121        Log.d("postscan time: %dms", end - scan);
122        Log.d("   total time: %dms", end - start);
123      } catch (SQLException e) {
124        Log.e("SQLException in MediaScanner.scan()", e);
125      } catch (UnsupportedOperationException e) {
126        Log.e("UnsupportedOperationException in MediaScanner.scan()", e);
127      } catch (RemoteException e) {
128        Log.e("RemoteException in MediaScanner.scan()", e);
129      }
130    }
131    public Uri scanSingleFile(String path, String mimeType) {
132      try {
133        prescan(path);
134        File file = new File(path);
135        long lastModifiedSeconds = file.lastModified() / 1000;
136        return mClient.doScanFile(path, lastModifiedSeconds, file.length(), true);
137      } catch (RemoteException e) {
138        Log.e("RemoteException in MediaScanner.scanFile()", e);
139        return null;
140      }
141    }
142    static {
143      String LIB_ROOT = Vitamio.getLibraryPath();
144      Log.i("LIB ROOT: %s", LIB_ROOT);
145      System.load(LIB_ROOT + "libstlport_shared.so");
146      System.load(LIB_ROOT + "libvscanner.so");
147      loadFFmpeg_native(LIB_ROOT + "libffmpeg.so");
148    }
149    private native void processDirectory(String path, String extensions);
150    private native boolean processFile(String path, String mimeType);
151    private native final void native_init(MediaScannerClient client);
152    public native void release();
153    private native final void native_finalize();
154    @Override
155    protected void finalize() throws Throwable {
156      try {
157        native_finalize();
158      } finally {
159        super.finalize();
160      }
161    }
162    private static class FileCacheEntry {
163      Uri mTableUri;
164      long mRowId;
165      String mPath;
166      long mLastModified;
167      boolean mLastModifiedChanged;
168      boolean mSeenInFileSystem;
169      FileCacheEntry(Uri tableUri, long rowId, String path, long lastModified) {
170        mTableUri = tableUri;
171        mRowId = rowId;
172        mPath = path;
173        mLastModified = lastModified;
174        mSeenInFileSystem = false;
175        mLastModifiedChanged = false;
176      }
177      @Override
178      public String toString() {
179        return mPath;
180      }
181    }
182    private class MyMediaScannerClient implements MediaScannerClient {
183      private String mMimeType;
184      private int mFileType;
185      private String mPath;
186      private long mLastModified;
187      private long mFileSize;
188      private String mTitle;
189      private String mArtist;
190      private String mAlbum;
191      private String mLanguage;
192      private long mDuration;
193      private int mWidth;
194      private int mHeight;
195      public FileCacheEntry beginFile(String path, long lastModified, long fileSize) {
196        int lastSlash = path.lastIndexOf('/');
197        if (lastSlash >= 0 && lastSlash + 2 < path.length()) {
198          if (path.regionMatches(lastSlash + 1, "._", 0, 2))
199            return null;
200          if (path.regionMatches(true, path.length() - 4, ".jpg", 0, 4)) {
201            if (path.regionMatches(true, lastSlash + 1, "AlbumArt_{", 0, 10) || path.regionMatches(true, lastSlash + 1, "AlbumArt.", 0, 9)) {
202              return null;
203            }
204            int length = path.length() - lastSlash - 1;
205            if ((length == 17 && path.regionMatches(true, lastSlash + 1, "AlbumArtSmall", 0, 13)) || (length == 10 && path.regionMatches(true, lastSlash + 1, "Folder", 0, 6))) {
206              return null;
207            }
208          }
209        }
210        MediaFile.MediaFileType mediaFileType = MediaFile.getFileType(path);
211        if (mediaFileType != null) {
212          mFileType = mediaFileType.fileType;
213          mMimeType = mediaFileType.mimeType;
214        }
215        String key = FileUtils.getCanonical(new File(path));
216        if (mCaseInsensitivePaths)
217          key = path.toLowerCase();
218        FileCacheEntry entry = mFileCache.get(key);
219        if (entry == null) {
220          entry = new FileCacheEntry(null, 0, path, 0);
221          mFileCache.put(key, entry);
222        }
223        entry.mSeenInFileSystem = true;
224        long delta = lastModified - entry.mLastModified;
225        if (delta > 1 || delta < -1) {
226          entry.mLastModified = lastModified;
227          entry.mLastModifiedChanged = true;
228        }
229        mPath = path;
230        mLastModified = lastModified;
231        mFileSize = fileSize;
232        mTitle = null;
233        mDuration = 0;
234        return entry;
235      }
236      public void scanFile(String path, long lastModified, long fileSize) {
237        Log.i("scanFile: %s", path);
238        doScanFile(path, lastModified, fileSize, false);
239      }
240      public Uri doScanFile(String path, long lastModified, long fileSize, boolean scanAlways) {
241        Uri result = null;
242        try {
243          FileCacheEntry entry = beginFile(path, lastModified, fileSize);
244          if (entry != null && (entry.mLastModifiedChanged || scanAlways)) {
245            if (processFile(path, null)) {
246              result = endFile(entry);
247            } else {
248              if (mCaseInsensitivePaths)
249                mFileCache.remove(path.toLowerCase());
250              else
251                mFileCache.remove(path);
252            }
253          }
254        } catch (RemoteException e) {
255          Log.e("RemoteException in MediaScanner.scanFile()", e);
256        }
257        return result;
258      }
259      private int parseSubstring(String s, int start, int defaultValue) {
260        int length = s.length();
261        if (start == length)
262          return defaultValue;
263        char ch = s.charAt(start++);
264        if (ch < '0' || ch > '9')
265          return defaultValue;
266        int result = ch - '0';
267        while (start < length) {
268          ch = s.charAt(start++);
269          if (ch < '0' || ch > '9')
270            return result;
271          result = result * 10 + (ch - '0');
272        }
273        return result;
274      }
275      public void handleStringTag(String name, byte[] valueBytes, String valueEncoding) {
276        String value;
277        try {
278          value = new String(valueBytes, valueEncoding);
279        } catch (Exception e) {
280          Log.e("handleStringTag", e);
281          value = new String(valueBytes);
282        }
283        Log.i("%s : %s", name, value);
284        if (name.equalsIgnoreCase("title")) {
285          mTitle = value;
286        } else if (name.equalsIgnoreCase("artist")) {
287          mArtist = value.trim();
288        } else if (name.equalsIgnoreCase("albumartist")) {
289          if (TextUtils.isEmpty(mArtist))
290            mArtist = value.trim();
291        } else if (name.equalsIgnoreCase("album")) {
292          mAlbum = value.trim();
293        } else if (name.equalsIgnoreCase("language")) {
294          mLanguage = value.trim();
295        } else if (name.equalsIgnoreCase("duration")) {
296          mDuration = parseSubstring(value, 0, 0);
297        } else if (name.equalsIgnoreCase("width")) {
298          mWidth = parseSubstring(value, 0, 0);
299        } else if (name.equalsIgnoreCase("height")) {
300          mHeight = parseSubstring(value, 0, 0);
301        }
302      }
303      public void setMimeType(String mimeType) {
304        Log.i("setMimeType: %s", mimeType);
305        mMimeType = mimeType;
306        mFileType = MediaFile.getFileTypeForMimeType(mimeType);
307      }
308      private ContentValues toValues() {
309        ContentValues map = new ContentValues();
310        map.put(MediaStore.MediaColumns.DATA, mPath);
311        map.put(MediaStore.MediaColumns.DATE_MODIFIED, mLastModified);
312        map.put(MediaStore.MediaColumns.SIZE, mFileSize);
313        map.put(MediaStore.MediaColumns.MIME_TYPE, mMimeType);
314        map.put(MediaStore.MediaColumns.TITLE, mTitle);
315        if (MediaFile.isVideoFileType(mFileType)) {
316          map.put(Video.Media.DURATION, mDuration);
317          map.put(Video.Media.LANGUAGE, mLanguage);
318          map.put(Video.Media.ALBUM, mAlbum);
319          map.put(Video.Media.ARTIST, mArtist);
320          map.put(Video.Media.WIDTH, mWidth);
321          map.put(Video.Media.HEIGHT, mHeight);
322        }
323        return map;
324      }
325      private Uri endFile(FileCacheEntry entry) throws RemoteException {
326        Uri tableUri;
327        boolean isVideo = MediaFile.isVideoFileType(mFileType) && mWidth > 0 && mHeight > 0;
328        if (isVideo) {
329          tableUri = Video.Media.CONTENT_URI;
330        } else {
331          return null;
332        }
333        entry.mTableUri = tableUri;
334        ContentValues values = toValues();
335        String title = values.getAsString(MediaStore.MediaColumns.TITLE);
336        if (TextUtils.isEmpty(title)) {
337          title = values.getAsString(MediaStore.MediaColumns.DATA);
338          int lastSlash = title.lastIndexOf('/');
339          if (lastSlash >= 0) {
340            lastSlash++;
341            if (lastSlash < title.length())
342              title = title.substring(lastSlash);
343          }
344          int lastDot = title.lastIndexOf('.');
345          if (lastDot > 0)
346            title = title.substring(0, lastDot);
347          values.put(MediaStore.MediaColumns.TITLE, title);
348        }
349        long rowId = entry.mRowId;
350        Uri result = null;
351        if (rowId == 0) {
352          result = mProvider.insert(tableUri, values);
353          if (result != null) {
354            rowId = ContentUris.parseId(result);
355            entry.mRowId = rowId;
356          }
357        } else {
358          result = ContentUris.withAppendedId(tableUri, rowId);
359          mProvider.update(result, values, null, null);
360        }
361        return result;
362      }
363      public void addNoMediaFolder(String path) {
364        ContentValues values = new ContentValues();
365        values.put(MediaStore.MediaColumns.DATA, "");
366        String[] pathSpec = new String[]{path + '%'};
367        try {
368          mProvider.update(Video.Media.CONTENT_URI, values, MediaStore.MediaColumns.DATA + " LIKE ?", pathSpec);
369        } catch (RemoteException e) {
370          throw new RuntimeException();
371        }
372      }
373    }
374  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from google-api-java-client-samples-MDEwOlJlcG9zaXRvcnkyOTc0OTA1Mg==-flat-CalendarAppEngineSample.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from VitamioBundle-MDEwOlJlcG9zaXRvcnk2MjkyMDI5-flat-MediaScanner.java</div>
                </div>
                <div class="column column_space"><pre><code>2  import com.google.api.client.auth.oauth2.AuthorizationCodeFlow;
3  import com.google.api.client.extensions.appengine.auth.oauth2.AbstractAppEngineAuthorizationCodeServlet;
4  import com.google.appengine.api.users.UserService;
5  import com.google.appengine.api.users.UserServiceFactory;
6  import java.io.IOException;
7  import java.io.PrintWriter;
8  import javax.servlet.ServletException;
9  import javax.servlet.http.HttpServletRequest;
10  import javax.servlet.http.HttpServletResponse;
11  public class CalendarAppEngineSample extends AbstractAppEngineAuthorizationCodeServlet {
12    static final String APP_NAME = "Google Calendar Data API Sample Web Client";
</pre></code></div>
                <div class="column column_space"><pre><code>10  import android.text.TextUtils;
11  import io.vov.vitamio.provider.MediaStore;
12  import io.vov.vitamio.provider.MediaStore.Video;
13  import io.vov.vitamio.utils.ContextUtils;
14  import io.vov.vitamio.utils.FileUtils;
15  import io.vov.vitamio.utils.Log;
16  import java.io.File;
17  import java.util.HashMap;
18  import java.util.Iterator;
19  public class MediaScanner {
20    private static final String[] VIDEO_PROJECTION = new String[]{Video.Media._ID, Video.Media.DATA, Video.Media.DATE_MODIFIED,};
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    