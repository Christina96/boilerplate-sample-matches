
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 48.275862068965516%, Tokens: 15</h2>
        <div class="column">
            <h3>ribbon-MDEwOlJlcG9zaXRvcnk3NjE2MTU4-flat-ServerStatusChangeListenerTest.java</h3>
            <pre><code>1  package com.netflix.loadbalancer;
2  import static java.util.Arrays.asList;
3  import static java.util.Collections.singletonList;
4  import static org.hamcrest.CoreMatchers.hasItem;
5  import static org.hamcrest.CoreMatchers.is;
6  import static org.hamcrest.core.AllOf.allOf;
7  import static org.junit.Assert.*;
8  import java.util.ArrayList;
9  import java.util.Collection;
10  import java.util.List;
11  import java.util.Queue;
12  import java.util.concurrent.ConcurrentLinkedQueue;
13  import java.util.concurrent.CountDownLatch;
14  import java.util.concurrent.TimeUnit;
15  import java.util.concurrent.atomic.AtomicReference;
16  import org.junit.Before;
17  import org.junit.Test;
18  public class ServerStatusChangeListenerTest {
19      private class NoPingTaskLoadBalancer extends BaseLoadBalancer {
20          @Override
21          void setupPingTask() {}
22      }
23      private final Server server1 = new Server("server1");
24      private final Server server2 = new Server("server2");
25      private BaseLoadBalancer lb;
26      private AtomicReference<List<Server>> serversReceivedByListener;
27      @Before
28      public void setupLoadbalancerAndListener() {
29          lb = new NoPingTaskLoadBalancer();
30          lb.setServersList(asList(server1, server2));
31          serversReceivedByListener = new AtomicReference<List<Server>>();
32          lb.addServerStatusChangeListener(new ServerStatusChangeListener() {
33              @Override
34              public void serverStatusChanged(final Collection<Server> servers) {
35                  serversReceivedByListener.set(new ArrayList<Server>(servers));
36              }
37          });
38      }
39      @Test
40      public void markServerDownByIdShouldBeReceivedByListener() {
<span onclick='openModal()' class='match'>41          lb.markServerDown(server1.getId());
42          assertThat(serversReceivedByListener.get(), is(singletonList(server1)));
43          lb.markServerDown(server2.getId());
44          assertThat(serversReceivedByListener.get(), is(singletonList(server2)));
45      }
46      @Test
</span>47      public void markServerDownByObjectShouldBeReceivedByListener() {
48          lb.markServerDown(server1);
49          assertThat(serversReceivedByListener.get(), is(singletonList(server1)));
50          lb.markServerDown(server2);
51          assertThat(serversReceivedByListener.get(), is(singletonList(server2)));
52      }
53      @Test
54      public void changeServerStatusByPingShouldBeReceivedByListener() throws InterruptedException {
55          final PingConstant ping = new PingConstant();
56          ping.setConstant(false);
57          lb.setPing(ping);
58          lb.forceQuickPing();
59          assertThat(serversReceivedByListener.get(), allOf(hasItem(server1), hasItem(server2)));
60          ping.setConstant(true);
61          serversReceivedByListener.set(null);
62          lb.forceQuickPing();
63          assertFalse(serversReceivedByListener.get().isEmpty());
64          assertThat(serversReceivedByListener.get(), allOf(hasItem(server1), hasItem(server2)));
65      }
66  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SlowlogCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.junit.Assert.assertArrayEquals;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertNotNull;
5  import static org.junit.Assert.assertTrue;
6  import java.util.Arrays;
7  import java.util.List;
8  import org.junit.After;
9  import org.junit.Before;
10  import org.junit.Test;
11  import redis.clients.jedis.Protocol;
12  import redis.clients.jedis.resps.Slowlog;
13  import redis.clients.jedis.util.SafeEncoder;
14  public class SlowlogCommandsTest extends JedisCommandsTestBase {
15    private static final List<String> LOCAL_IPS = Arrays.asList("127.0.0.1", "[::1]");
16    private static final String SLOWLOG_TIME_PARAM = "slowlog-log-slower-than";
17    private static final String ZERO_STRING = "0";
18    private String slowlogTimeValue;
19    @Before
20    @Override
21    public void setUp() throws Exception {
22      super.setUp();
23      slowlogTimeValue = jedis.configGet(SLOWLOG_TIME_PARAM).get(1);
24    }
25    @After
26    @Override
27    public void tearDown() throws Exception {
28      jedis.configSet(SLOWLOG_TIME_PARAM, slowlogTimeValue);
29      super.tearDown();
30    }
31    @Test
32    public void slowlog() {
33      jedis.configSet(SLOWLOG_TIME_PARAM, ZERO_STRING);
34      jedis.set("foo", "bar");
35      jedis.set("foo2", "bar2");
36      List<Slowlog> reducedLog = jedis.slowlogGet(1);
37      assertEquals(1, reducedLog.size());
38      Slowlog log = reducedLog.get(0);
39      assertTrue(log.getId() > 0);
40      assertTrue(log.getTimeStamp() > 0);
41      assertTrue(log.getExecutionTime() >= 0);
42      assertNotNull(log.getArgs());
43      List<Object> breducedLog = jedis.slowlogGetBinary(1);
44      assertEquals(1, breducedLog.size());
45      List<Slowlog> log1 = jedis.slowlogGet();
46      List<Object> blog1 = jedis.slowlogGetBinary();
47      assertNotNull(log1);
48      assertNotNull(blog1);
49      assertTrue(jedis.slowlogLen() > 5 && jedis.slowlogLen() < 12);
50      assertTrue(jedis.slowlogGet().toString().contains("SLOWLOG"));
51    }
52    @Test
53    public void slowlogObjectDetails() {
54      final String clientName = "slowlog-object-client";
55      jedis.clientSetname(clientName);
56      jedis.slowlogReset();
57      jedis.configSet(SLOWLOG_TIME_PARAM, ZERO_STRING);
58      List<Slowlog> logs = jedis.slowlogGet(); 
59      assertEquals(1, logs.size());
60      Slowlog log = logs.get(0);
61      assertTrue(log.getId() > 0);
62      assertTrue(log.getTimeStamp() > 0);
63      assertTrue(log.getExecutionTime() > 0);
64      assertEquals(4, log.getArgs().size());
65      assertEquals(SafeEncoder.encode(Protocol.Command.CONFIG.getRaw()), log.getArgs().get(0));
66      assertEquals(SafeEncoder.encode(Protocol.Keyword.SET.getRaw()), log.getArgs().get(1));
67      assertEquals(SLOWLOG_TIME_PARAM, log.getArgs().get(2));
<span onclick='openModal()' class='match'>68      assertEquals(ZERO_STRING, log.getArgs().get(3));
69      assertTrue(LOCAL_IPS.contains(log.getClientIpPort().getHost()));
70      assertTrue(log.getClientIpPort().getPort() > 0);
71      assertEquals(clientName, log.getClientName());
72    }
73    @Test
</span>74    public void slowlogBinaryDetails() {
75      final byte[] clientName = SafeEncoder.encode("slowlog-binary-client");
76      jedis.clientSetname(clientName);
77      jedis.slowlogReset();
78      jedis.configSet(SafeEncoder.encode(SLOWLOG_TIME_PARAM), SafeEncoder.encode(ZERO_STRING));
79      List<Object> logs = jedis.slowlogGetBinary(); 
80      assertEquals(1, logs.size());
81      List<Object> log = (List<Object>) logs.get(0);
82      assertTrue((Long) log.get(0) > 0);
83      assertTrue((Long) log.get(1) > 0);
84      assertTrue((Long) log.get(2) > 0);
85      List<Object> args = (List<Object>) log.get(3);
86      assertEquals(4, args.size());
87      assertArrayEquals(Protocol.Command.CONFIG.getRaw(), (byte[]) args.get(0));
88      assertArrayEquals(Protocol.Keyword.SET.getRaw(), (byte[]) args.get(1));
89      assertArrayEquals(SafeEncoder.encode(SLOWLOG_TIME_PARAM), (byte[]) args.get(2));
90      assertArrayEquals(Protocol.toByteArray(0), (byte[]) args.get(3));
91      assertTrue(((byte[]) log.get(4)).length > 0);
92      assertArrayEquals(clientName, (byte[]) log.get(5));
93    }
94  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from ribbon-MDEwOlJlcG9zaXRvcnk3NjE2MTU4-flat-ServerStatusChangeListenerTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SlowlogCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>41          lb.markServerDown(server1.getId());
42          assertThat(serversReceivedByListener.get(), is(singletonList(server1)));
43          lb.markServerDown(server2.getId());
44          assertThat(serversReceivedByListener.get(), is(singletonList(server2)));
45      }
46      @Test
</pre></code></div>
                <div class="column column_space"><pre><code>68      assertEquals(ZERO_STRING, log.getArgs().get(3));
69      assertTrue(LOCAL_IPS.contains(log.getClientIpPort().getHost()));
70      assertTrue(log.getClientIpPort().getPort() > 0);
71      assertEquals(clientName, log.getClientName());
72    }
73    @Test
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    