
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 11.428571428571429%, Tokens: 20</h2>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-OpenTracingFilter.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package com.weibo.api.motan.filter.opentracing;
2  import io.opentracing.NoopTracer;
3  import io.opentracing.Span;
4  import io.opentracing.SpanContext;
5  import io.opentracing.Tracer;
6  import io.opentracing.Tracer.SpanBuilder;
7  import io.opentracing.propagation.Format;
8  import io.opentracing.propagation.TextMap;
9  import io.opentracing.propagation.TextMapExtractAdapter;
10  import java.util.Iterator;
11  import java.util.Map.Entry;
12  import com.weibo.api.motan.core.extension.Activation;
13  import com.weibo.api.motan.core.extension.SpiMeta;
14  import com.weibo.api.motan.filter.Filter;
15  import com.weibo.api.motan.rpc.Caller;
16  import com.weibo.api.motan.rpc.Provider;
17  import com.weibo.api.motan.rpc.Request;
18  import com.weibo.api.motan.rpc.Response;
19  import com.weibo.api.motan.util.LoggerUtil;
20  import com.weibo.api.motan.util.MotanFrameworkUtil;
</span>21  @SpiMeta(name = "opentracing")
22  @Activation(sequence = 30)
23  public class OpenTracingFilter implements Filter {
24      @Override
25      public Response filter(Caller<?> caller, Request request) {
26          Tracer tracer = getTracer();
27          if (tracer == null || tracer instanceof NoopTracer) {
28              return caller.call(request);
29          }
30          if (caller instanceof Provider) { 
31              return processProviderTrace(tracer, caller, request);
32          } else { 
33              return processRefererTrace(tracer, caller, request);
34          }
35      }
36      protected Tracer getTracer(){
37          return OpenTracingContext.getTracer();
38      }
39      protected Response processRefererTrace(Tracer tracer, Caller<?> caller, Request request) {
40          String operationName = buildOperationName(request);
41          SpanBuilder spanBuilder = tracer.buildSpan(operationName);
42          Span activeSpan = OpenTracingContext.getActiveSpan();
43          if (activeSpan != null) {
44              spanBuilder.asChildOf(activeSpan);
45          }
46          Span span = spanBuilder.start();
47          span.setTag("requestId", request.getRequestId());
48          attachTraceInfo(tracer, span, request);
49          return process(caller, request, span);
50      }
51      protected Response process(Caller<?> caller, Request request, Span span) {
52          Exception ex = null;
53          boolean exception = true;
54          try {
55              Response response = caller.call(request);
56              if (response.getException() != null) {
57                  ex = response.getException();
58              } else {
59                  exception = false;
60              }
61              return response;
62          } catch (RuntimeException e) {
63              ex = e;
64              throw e;
65          } finally {
66              try {
67                  if (exception) {
68                      span.log("request fail." + (ex == null ? "unknown exception" : ex.getMessage()));
69                  } else {
70                      span.log("request success.");
71                  }
72                  span.finish();
73              } catch (Exception e) {
74                  LoggerUtil.error("opentracing span finish error!", e);
75              }
76          }
77      }
78      protected String buildOperationName(Request request) {
79          return "Motan_" + MotanFrameworkUtil.getGroupMethodString(request);
80      }
81      protected void attachTraceInfo(Tracer tracer, Span span, final Request request) {
82          tracer.inject(span.context(), Format.Builtin.TEXT_MAP, new TextMap() {
83              @Override
84              public void put(String key, String value) {
85                  request.setAttachment(key, value);
86              }
87              @Override
88              public Iterator<Entry<String, String>> iterator() {
89                  throw new UnsupportedOperationException("TextMapInjectAdapter should only be used with Tracer.inject()");
90              }
91          });
92      }
93      protected Response processProviderTrace(Tracer tracer, Caller<?> caller, Request request) {
94          Span span = extractTraceInfo(request, tracer);
95          span.setTag("requestId", request.getRequestId());
96          OpenTracingContext.setActiveSpan(span);
97          return process(caller, request, span);
98      }
99      protected Span extractTraceInfo(Request request, Tracer tracer) {
100          String operationName = buildOperationName(request);
101          SpanBuilder span = tracer.buildSpan(operationName);
102          try {
103              SpanContext spanContext = tracer.extract(Format.Builtin.TEXT_MAP, new TextMapExtractAdapter(request.getAttachments()));
104              if (spanContext != null) {
105                  span.asChildOf(spanContext);
106              }
107          } catch (Exception e) {
108              span.withTag("Error", "extract from request fail, error msg:" + e.getMessage());
109          }
110          return span.start();
111      }
112  }
</code></pre>
        </div>
        <div class="column">
            <h3>Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-EssentialsSpawnPlayerListener.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package com.earth2me.essentials.spawn;
2  import static com.earth2me.essentials.I18n.tl;
3  import com.earth2me.essentials.Kit;
4  import com.earth2me.essentials.OfflinePlayer;
5  import com.earth2me.essentials.User;
6  import com.earth2me.essentials.textreader.IText;
7  import com.earth2me.essentials.textreader.KeywordReplacer;
8  import com.earth2me.essentials.textreader.SimpleTextPager;
9  import net.ess3.api.IEssentials;
10  import java.util.List;
11  import java.util.Locale;
12  import java.util.Map;
13  import java.util.logging.Level;
14  import java.util.logging.Logger;
15  import org.bukkit.Bukkit;
16  import org.bukkit.Location;
17  import org.bukkit.entity.Player;
18  import org.bukkit.event.Listener;
19  import org.bukkit.event.player.PlayerJoinEvent;
20  import org.bukkit.event.player.PlayerRespawnEvent;
</span>21  import org.bukkit.event.player.PlayerTeleportEvent.TeleportCause;
22  public class EssentialsSpawnPlayerListener implements Listener
23  {
24  	private static final Logger LOGGER = Bukkit.getLogger();
25  	private final transient IEssentials ess;
26  	private final transient SpawnStorage spawns;
27  	public EssentialsSpawnPlayerListener(final IEssentials ess, final SpawnStorage spawns)
28  	{
29  		super();
30  		this.ess = ess;
31  		this.spawns = spawns;
32  	}
33  	public void onPlayerRespawn(final PlayerRespawnEvent event)
34  	{
35  		final User user = ess.getUser(event.getPlayer());
36  		if (user.isJailed() && user.getJail() != null && !user.getJail().isEmpty())
37  		{
38  			return;
39  		}
40  		if (ess.getSettings().getRespawnAtHome())
41  		{
42  			Location home;
43  			final Location bed = user.getBase().getBedSpawnLocation();
44  			if (bed != null)
45  			{
46  				home = bed;
47  			}
48  			else
49  			{
50  				home = user.getHome(user.getLocation());
51  			}
52  			if (home != null)
53  			{
54  				event.setRespawnLocation(home);
55  				return;
56  			}
57  		}
58  		final Location spawn = spawns.getSpawn(user.getGroup());
59  		if (spawn != null)
60  		{
61  			event.setRespawnLocation(spawn);
62  		}
63  	}
64  	public void onPlayerJoin(final PlayerJoinEvent event)
65  	{
66  		ess.runTaskAsynchronously(new Runnable()
67  		{
68  			@Override
69  			public void run()
70  			{
71  				delayedJoin(event.getPlayer());
72  			}
73  		});
74  	}
75  	public void delayedJoin(Player player)
76  	{
77  		if (player.hasPlayedBefore())
78  		{
79  			LOGGER.log(Level.FINE, "Old player join");
80  			return;
81  		}
82  		final User user = ess.getUser(player);
83  		if (!"none".equalsIgnoreCase(ess.getSettings().getNewbieSpawn()))
84  		{
85  			ess.scheduleSyncDelayedTask(new NewPlayerTeleport(user), 1L);
86  		}
87  		ess.scheduleSyncDelayedTask(new Runnable()
88  		{
89  			@Override
90  			public void run()
91  			{
92  				if (!user.getBase().isOnline()) {
93  					return;
94  				}
95  				if (ess.getSettings().getAnnounceNewPlayers())
96  				{
97  					final IText output = new KeywordReplacer(ess.getSettings().getAnnounceNewPlayerFormat(), user.getSource(), ess);
98  					final SimpleTextPager pager = new SimpleTextPager(output);
99  					for (String line : pager.getLines())
100  					{
101  						ess.broadcastMessage(user, line);
102  					}
103  				}
104  				final String kitName = ess.getSettings().getNewPlayerKit();
105  				if (!kitName.isEmpty())
106  				{
107  					try
108  					{
109  						final Kit kit = new Kit(kitName.toLowerCase(Locale.ENGLISH), ess);
110  						kit.expandItems(user);
111  					}
112  					catch (Exception ex)
113  					{
114  						LOGGER.log(Level.WARNING, ex.getMessage());
115  					}
116  				}
117  				LOGGER.log(Level.FINE, "New player join");
118  			}
119  		}, 2L);
120  	}
121  	private class NewPlayerTeleport implements Runnable
122  	{
123  		private final transient User user;
124  		public NewPlayerTeleport(final User user)
125  		{
126  			this.user = user;
127  		}
128  		@Override
129  		public void run()
130  		{
131  			if (user.getBase() instanceof OfflinePlayer || !user.getBase().isOnline())
132  			{
133  				return;
134  			}
135  			try
136  			{
137  				final Location spawn = spawns.getSpawn(ess.getSettings().getNewbieSpawn());
138  				if (spawn != null)
139  				{
140  					user.getTeleport().now(spawn, false, TeleportCause.PLUGIN);
141  				}
142  			}
143  			catch (Exception ex)
144  			{
145  				Bukkit.getLogger().log(Level.WARNING, tl("teleportNewPlayerError"), ex);
146  			}
147  		}
148  	}
149  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-OpenTracingFilter.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-EssentialsSpawnPlayerListener.java</div>
                <div class="column column_space"><pre><code>1  package com.weibo.api.motan.filter.opentracing;
2  import io.opentracing.NoopTracer;
3  import io.opentracing.Span;
4  import io.opentracing.SpanContext;
5  import io.opentracing.Tracer;
6  import io.opentracing.Tracer.SpanBuilder;
7  import io.opentracing.propagation.Format;
8  import io.opentracing.propagation.TextMap;
9  import io.opentracing.propagation.TextMapExtractAdapter;
10  import java.util.Iterator;
11  import java.util.Map.Entry;
12  import com.weibo.api.motan.core.extension.Activation;
13  import com.weibo.api.motan.core.extension.SpiMeta;
14  import com.weibo.api.motan.filter.Filter;
15  import com.weibo.api.motan.rpc.Caller;
16  import com.weibo.api.motan.rpc.Provider;
17  import com.weibo.api.motan.rpc.Request;
18  import com.weibo.api.motan.rpc.Response;
19  import com.weibo.api.motan.util.LoggerUtil;
20  import com.weibo.api.motan.util.MotanFrameworkUtil;
</pre></code></div>
                <div class="column column_space"><pre><code>1  package com.earth2me.essentials.spawn;
2  import static com.earth2me.essentials.I18n.tl;
3  import com.earth2me.essentials.Kit;
4  import com.earth2me.essentials.OfflinePlayer;
5  import com.earth2me.essentials.User;
6  import com.earth2me.essentials.textreader.IText;
7  import com.earth2me.essentials.textreader.KeywordReplacer;
8  import com.earth2me.essentials.textreader.SimpleTextPager;
9  import net.ess3.api.IEssentials;
10  import java.util.List;
11  import java.util.Locale;
12  import java.util.Map;
13  import java.util.logging.Level;
14  import java.util.logging.Logger;
15  import org.bukkit.Bukkit;
16  import org.bukkit.Location;
17  import org.bukkit.entity.Player;
18  import org.bukkit.event.Listener;
19  import org.bukkit.event.player.PlayerJoinEvent;
20  import org.bukkit.event.player.PlayerRespawnEvent;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    