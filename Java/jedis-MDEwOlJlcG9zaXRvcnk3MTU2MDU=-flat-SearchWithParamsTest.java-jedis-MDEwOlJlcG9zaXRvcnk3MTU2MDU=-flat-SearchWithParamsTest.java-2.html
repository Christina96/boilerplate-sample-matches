
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 33, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SearchWithParamsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.modules.search;
2  import static org.junit.Assert.*;
3  import static redis.clients.jedis.util.AssertUtil.assertOK;
4  import java.util.*;
5  import java.util.stream.Collectors;
6  import org.hamcrest.Matchers;
7  import org.junit.BeforeClass;
8  import org.junit.Test;
9  import redis.clients.jedis.GeoCoordinate;
10  import redis.clients.jedis.args.GeoUnit;
11  import redis.clients.jedis.args.SortingOrder;
12  import redis.clients.jedis.exceptions.JedisDataException;
13  import redis.clients.jedis.json.Path;
14  import redis.clients.jedis.search.*;
15  import redis.clients.jedis.search.schemafields.*;
16  import redis.clients.jedis.search.schemafields.VectorField.VectorAlgorithm;
17  import redis.clients.jedis.modules.RedisModuleCommandsTestBase;
18  public class SearchWithParamsTest extends RedisModuleCommandsTestBase {
19    private static final String index = &quot;testindex&quot;;
20    @BeforeClass
21    public static void prepare() {
22      RedisModuleCommandsTestBase.prepare();
23    }
24    private void addDocument(String key, Map&lt;String, Object&gt; map) {
25      client.hset(key, RediSearchUtil.toStringMap(map));
26    }
27    private static Map&lt;String, Object&gt; toMap(Object... values) {
28      Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
29      for (int i = 0; i &lt; values.length; i += 2) {
30        map.put((String) values[i], values[i + 1]);
31      }
32      return map;
33    }
34    private static Map&lt;String, String&gt; toMap(String... values) {
35      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
36      for (int i = 0; i &lt; values.length; i += 2) {
37        map.put(values[i], values[i + 1]);
38      }
39      return map;
40    }
41    @Test
42    public void create() {
43      assertOK(client.ftCreate(index,
44          FTCreateParams.createParams()
45              .filter(&quot;@age&gt;16&quot;)
46              .prefix(&quot;student:&quot;, &quot;pupil:&quot;),
47          TextField.of(&quot;first&quot;), TextField.of(&quot;last&quot;), NumericField.of(&quot;age&quot;)));
48      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
49      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
50      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
51      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
52      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
53      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
54      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
55      SearchResult noFilters = client.ftSearch(index);
56      assertEquals(4, noFilters.getTotalResults());
57      SearchResult res1 = client.ftSearch(index, &quot;@first:Jo*&quot;);
58      assertEquals(2, res1.getTotalResults());
59      SearchResult res2 = client.ftSearch(index, &quot;@first:Pat&quot;);
60      assertEquals(1, res2.getTotalResults());
61      SearchResult res3 = client.ftSearch(index, &quot;@last:Rod&quot;);
62      assertEquals(0, res3.getTotalResults());
63    }
64    @Test
65    public void createNoParams() {
66      assertOK(client.ftCreate(index,
67          TextField.of(&quot;first&quot;).weight(1),
68          TextField.of(&quot;last&quot;).weight(1),
69          NumericField.of(&quot;age&quot;)));
70      addDocument(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, 18));
71      addDocument(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, 17));
72      addDocument(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, 21));
73      addDocument(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, 20));
74      SearchResult noFilters = client.ftSearch(index);
75      assertEquals(4, noFilters.getTotalResults());
76      SearchResult res1 = client.ftSearch(index, &quot;@first:Jo*&quot;);
77      assertEquals(2, res1.getTotalResults());
78      SearchResult res2 = client.ftSearch(index, &quot;@first:Pat&quot;);
79      assertEquals(1, res2.getTotalResults());
80      SearchResult res3 = client.ftSearch(index, &quot;@last:Rod&quot;);
81      assertEquals(0, res3.getTotalResults());
82    }
83    @Test
84    public void createWithFieldNames() {
85      assertOK(client.ftCreate(index,
86          FTCreateParams.createParams()
87              .addPrefix(&quot;student:&quot;).addPrefix(&quot;pupil:&quot;),
88          TextField.of(&quot;first&quot;).as(&quot;given&quot;),
89          TextField.of(FieldName.of(&quot;last&quot;).as(&quot;family&quot;))));
90      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
91      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
92      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
93      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
94      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
95      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
96      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
97      SearchResult noFilters = client.ftSearch(index);
98      assertEquals(5, noFilters.getTotalResults());
99      SearchResult asFirst = client.ftSearch(index, &quot;@first:Jo*&quot;);
100      assertEquals(0, asFirst.getTotalResults());
101      SearchResult asGiven = client.ftSearch(index, &quot;@given:Jo*&quot;);
102      assertEquals(2, asGiven.getTotalResults());
103      SearchResult nonLast = client.ftSearch(index, &quot;@last:Rod&quot;);
104      assertEquals(0, nonLast.getTotalResults());
105      SearchResult asFamily = client.ftSearch(index, &quot;@family:Rod&quot;);
106      assertEquals(1, asFamily.getTotalResults());
107    }
108    @Test
109    public void alterAdd() {
110      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;)));
111      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
112      fields.put(&quot;title&quot;, &quot;hello world&quot;);
113      for (int i = 0; i &lt; 100; i++) {
114        addDocument(String.format(&quot;doc%d&quot;, i), fields);
115      }
116      SearchResult res = client.ftSearch(index, &quot;hello world&quot;);
117      assertEquals(100, res.getTotalResults());
118      assertOK(client.ftAlter(index,
119          TagField.of(&quot;tags&quot;),
120          TextField.of(&quot;name&quot;).weight(0.5)));
121      for (int i = 0; i &lt; 100; i++) {
122        Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
123        fields2.put(&quot;name&quot;, &quot;name&quot; + i);
124        fields2.put(&quot;tags&quot;, String.format(&quot;tagA,tagB,tag%d&quot;, i));
125        addDocument(String.format(&quot;doc%d&quot;, i), fields2);
126      }
127      SearchResult res2 = client.ftSearch(index, &quot;@tags:{tagA}&quot;);
128      assertEquals(100, res2.getTotalResults());
129      Map&lt;String, Object&gt; info = client.ftInfo(index);
130      assertEquals(index, info.get(&quot;index_name&quot;));
131      assertEquals(&quot;identifier&quot;, ((List) ((List) info.get(&quot;attributes&quot;)).get(1)).get(0));
132      assertEquals(&quot;attribute&quot;, ((List) ((List) info.get(&quot;attributes&quot;)).get(1)).get(2));
133    }
134    @Test
135    public void search() {
136      assertOK(client.ftCreate(index, FTCreateParams.createParams(),
137          TextField.of(&quot;title&quot;), TextField.of(&quot;body&quot;)));
138      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
139      fields.put(&quot;title&quot;, &quot;hello world&quot;);
140      fields.put(&quot;body&quot;, &quot;lorem ipsum&quot;);
141      for (int i = 0; i &lt; 100; i++) {
142        addDocument(String.format(&quot;doc%d&quot;, i), fields);
143      }
144      SearchResult res = client.ftSearch(index, &quot;hello world&quot;,
145          FTSearchParams.searchParams().limit(0, 5).withScores());
146      assertEquals(100, res.getTotalResults());
147      assertEquals(5, res.getDocuments().size());
148      for (Document d : res.getDocuments()) {
149        assertTrue(d.getId().startsWith(&quot;doc&quot;));
150        assertTrue(d.getScore() &lt; 100);
151      }
152      client.del(&quot;doc0&quot;);
153      res = client.ftSearch(index, &quot;hello world&quot;);
154      assertEquals(99, res.getTotalResults());
155      assertEquals(&quot;OK&quot;, client.ftDropIndex(index));
156      try {
157        client.ftSearch(index, &quot;hello world&quot;);
158        fail();
159      } catch (JedisDataException e) {
160      }
161    }
162    @Test
163    public void numericFilter() {
164      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;), NumericField.of(&quot;price&quot;)));
165      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
166      fields.put(&quot;title&quot;, &quot;hello world&quot;);
167      for (int i = 0; i &lt; 100; i++) {
168        fields.put(&quot;price&quot;, i);
169        addDocument(String.format(&quot;doc%d&quot;, i), fields);
170      }
171      SearchResult res = client.ftSearch(index, &quot;hello world&quot;,
172          FTSearchParams.searchParams().filter(&quot;price&quot;, 0, 49));
173      assertEquals(50, res.getTotalResults());
174      assertEquals(10, res.getDocuments().size());
175      for (Document d : res.getDocuments()) {
176        long price = Long.valueOf((String) d.get(&quot;price&quot;));
177        assertTrue(price &gt;= 0);
178        assertTrue(price &lt;= 49);
179      }
180      res = client.ftSearch(index, &quot;hello world&quot;,
181          FTSearchParams.searchParams().filter(&quot;price&quot;, 0, true, 49, true));
182      assertEquals(48, res.getTotalResults());
183      assertEquals(10, res.getDocuments().size());
184      for (Document d : res.getDocuments()) {
185        long price = Long.valueOf((String) d.get(&quot;price&quot;));
186        assertTrue(price &gt; 0);
187        assertTrue(price &lt; 49);
188      }
189      res = client.ftSearch(index, &quot;hello world&quot;,
190          FTSearchParams.searchParams().filter(&quot;price&quot;, 50, 100));
191      assertEquals(50, res.getTotalResults());
192      assertEquals(10, res.getDocuments().size());
193      for (Document d : res.getDocuments()) {
194        long price = Long.valueOf((String) d.get(&quot;price&quot;));
195        assertTrue(price &gt;= 50);
196        assertTrue(price &lt;= 100);
197      }
198      res = client.ftSearch(index, &quot;hello world&quot;,
199          FTSearchParams.searchParams()
200              .filter(&quot;price&quot;, 20, Double.POSITIVE_INFINITY));
201      assertEquals(80, res.getTotalResults());
202      assertEquals(10, res.getDocuments().size());
203      res = client.ftSearch(index, &quot;hello world&quot;,
204          FTSearchParams.searchParams()
205              .filter(&quot;price&quot;, Double.NEGATIVE_INFINITY, 10));
206      assertEquals(11, res.getTotalResults());
207      assertEquals(10, res.getDocuments().size());
208    }
209    @Test
210    public void stopwords() {
211      assertOK(client.ftCreate(index,
212          FTCreateParams.createParams()
213              .stopwords(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;),
<span onclick='openModal()' class='match'>214          TextField.of(&quot;title&quot;)));
215      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
216      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
217      addDocument(&quot;doc1&quot;, fields);
</span>218      SearchResult res = client.ftSearch(index, &quot;hello world&quot;);
219      assertEquals(1, res.getTotalResults());
220      res = client.ftSearch(index, &quot;foo bar&quot;);
221      assertEquals(0, res.getTotalResults());
222    }
223    @Test
224    public void noStopwords() {
225      assertOK(client.ftCreate(index,
226          FTCreateParams.createParams().noStopwords(),
227          TextField.of(&quot;title&quot;)));
228      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
229      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
230      fields.put(&quot;title&quot;, &quot;hello world foo bar to be or not to be&quot;);
231      addDocument(&quot;doc1&quot;, fields);
232      assertEquals(1, client.ftSearch(index, &quot;hello world&quot;).getTotalResults());
233      assertEquals(1, client.ftSearch(index, &quot;foo bar&quot;).getTotalResults());
234      assertEquals(1, client.ftSearch(index, &quot;to be or not to be&quot;).getTotalResults());
235    }
236    @Test
237    public void geoFilter() {
238      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;), GeoField.of(&quot;loc&quot;)));
239      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
240      fields.put(&quot;title&quot;, &quot;hello world&quot;);
241      fields.put(&quot;loc&quot;, &quot;-0.441,51.458&quot;);
242      addDocument(&quot;doc1&quot;, fields);
243      fields.put(&quot;loc&quot;, &quot;-0.1,51.2&quot;);
244      addDocument(&quot;doc2&quot;, fields);
245      SearchResult res = client.ftSearch(index, &quot;hello world&quot;,
246          FTSearchParams.searchParams().
247              geoFilter(&quot;loc&quot;, -0.44, 51.45, 10, GeoUnit.KM));
248      assertEquals(1, res.getTotalResults());
249      res = client.ftSearch(index, &quot;hello world&quot;,
250          FTSearchParams.searchParams().
251              geoFilter(&quot;loc&quot;, -0.44, 51.45, 100, GeoUnit.KM));
252      assertEquals(2, res.getTotalResults());
253    }
254    @Test
255    public void geoFilterAndGeoCoordinateObject() {
256      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;), GeoField.of(&quot;loc&quot;)));
257      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
258      fields.put(&quot;title&quot;, &quot;hello world&quot;);
259      fields.put(&quot;loc&quot;, new GeoCoordinate(-0.441, 51.458));
260      addDocument(&quot;doc1&quot;, fields);
261      fields.put(&quot;loc&quot;, new GeoCoordinate(-0.1, 51.2));
262      addDocument(&quot;doc2&quot;, fields);
263      SearchResult res = client.ftSearch(index, &quot;hello world&quot;,
264          FTSearchParams.searchParams()
265              .geoFilter(new FTSearchParams.GeoFilter(&quot;loc&quot;, -0.44, 51.45, 10, GeoUnit.KM)));
266      assertEquals(1, res.getTotalResults());
267      res = client.ftSearch(index, &quot;hello world&quot;,
268          FTSearchParams.searchParams()
269              .geoFilter(new FTSearchParams.GeoFilter(&quot;loc&quot;, -0.44, 51.45, 100, GeoUnit.KM)));
270      assertEquals(2, res.getTotalResults());
271    }
272    @Test
273    public void testQueryFlags() {
274      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;)));
275      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
276      for (int i = 0; i &lt; 100; i++) {
277        fields.put(&quot;title&quot;, i % 2 != 0 ? &quot;hello worlds&quot; : &quot;hello world&quot;);
278        addDocument(String.format(&quot;doc%d&quot;, i), fields);
279      }
280      SearchResult res = client.ftSearch(index, &quot;hello&quot;,
281          FTSearchParams.searchParams().withScores());
282      assertEquals(100, res.getTotalResults());
283      assertEquals(10, res.getDocuments().size());
284      for (Document d : res.getDocuments()) {
285        assertTrue(d.getId().startsWith(&quot;doc&quot;));
286        assertTrue(((String) d.get(&quot;title&quot;)).startsWith(&quot;hello world&quot;));
287      }
288      res = client.ftSearch(index, &quot;hello&quot;,
289          FTSearchParams.searchParams().noContent());
290      for (Document d : res.getDocuments()) {
291        assertTrue(d.getId().startsWith(&quot;doc&quot;));
292        assertEquals(1.0, d.getScore(), 0);
293        assertNull(d.get(&quot;title&quot;));
294      }
295      res = client.ftSearch(index, &quot;hello worlds&quot;);
296      assertEquals(100, res.getTotalResults());
297      res = client.ftSearch(index, &quot;hello worlds&quot;, FTSearchParams.searchParams().verbatim());
298      assertEquals(50, res.getTotalResults());
299      res = client.ftSearch(index, &quot;hello a world&quot;, FTSearchParams.searchParams().verbatim());
300      assertEquals(50, res.getTotalResults());
301      res = client.ftSearch(index, &quot;hello a worlds&quot;, FTSearchParams.searchParams().verbatim());
302      assertEquals(50, res.getTotalResults());
303      res = client.ftSearch(index, &quot;hello a world&quot;, FTSearchParams.searchParams().verbatim().noStopwords());
304      assertEquals(0, res.getTotalResults());
305    }
306    @Test
307    public void testQueryParams() {
308      assertOK(client.ftCreate(index, NumericField.of(&quot;numval&quot;)));
309      client.hset(&quot;1&quot;, &quot;numval&quot;, &quot;1&quot;);
310      client.hset(&quot;2&quot;, &quot;numval&quot;, &quot;2&quot;);
311      client.hset(&quot;3&quot;, &quot;numval&quot;, &quot;3&quot;);
312      assertEquals(2, client.ftSearch(index, &quot;@numval:[$min $max]&quot;,
313          FTSearchParams.searchParams().addParam(&quot;min&quot;, 1).addParam(&quot;max&quot;, 2)
314              .dialect(2)).getTotalResults());
315      Map&lt;String, Object&gt; paramValues = new HashMap&lt;&gt;();
316      paramValues.put(&quot;min&quot;, 1);
317      paramValues.put(&quot;max&quot;, 2);
318      assertEquals(2, client.ftSearch(index, &quot;@numval:[$min $max]&quot;,
319          FTSearchParams.searchParams().params(paramValues)
320              .dialect(2)).getTotalResults());
321    }
322    @Test
323    public void testSortQueryFlags() {
324      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;).sortable()));
325      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
326      fields.put(&quot;title&quot;, &quot;b title&quot;);
327      addDocument(&quot;doc1&quot;, fields);
328      fields.put(&quot;title&quot;, &quot;a title&quot;);
329      addDocument(&quot;doc2&quot;, fields);
330      fields.put(&quot;title&quot;, &quot;c title&quot;);
331      addDocument(&quot;doc3&quot;, fields);
332      SearchResult res = client.ftSearch(index, &quot;title&quot;,
333          FTSearchParams.searchParams().sortBy(&quot;title&quot;, SortingOrder.ASC));
334      assertEquals(3, res.getTotalResults());
335      Document doc1 = res.getDocuments().get(0);
336      assertEquals(&quot;a title&quot;, doc1.get(&quot;title&quot;));
337      doc1 = res.getDocuments().get(1);
338      assertEquals(&quot;b title&quot;, doc1.get(&quot;title&quot;));
339      doc1 = res.getDocuments().get(2);
340      assertEquals(&quot;c title&quot;, doc1.get(&quot;title&quot;));
341    }
342    @Test
343    public void testJsonWithAlias() {
344      assertOK(client.ftCreate(index,
345          FTCreateParams.createParams()
346              .on(IndexDataType.JSON)
347              .prefix(&quot;king:&quot;),
348          TextField.of(&quot;$.name&quot;).as(&quot;name&quot;),
349          NumericField.of(&quot;$.num&quot;).as(&quot;num&quot;)));
350      Map&lt;String, Object&gt; king1 = new HashMap&lt;&gt;();
351      king1.put(&quot;name&quot;, &quot;henry&quot;);
352      king1.put(&quot;num&quot;, 42);
353      client.jsonSet(&quot;king:1&quot;, Path.ROOT_PATH, king1);
354      Map&lt;String, Object&gt; king2 = new HashMap&lt;&gt;();
355      king2.put(&quot;name&quot;, &quot;james&quot;);
356      king2.put(&quot;num&quot;, 3.14);
357      client.jsonSet(&quot;king:2&quot;, Path.ROOT_PATH, king2);
358      SearchResult res = client.ftSearch(index, &quot;@name:henry&quot;);
359      assertEquals(1, res.getTotalResults());
360      assertEquals(&quot;king:1&quot;, res.getDocuments().get(0).getId());
361      res = client.ftSearch(index, &quot;@num:[0 10]&quot;);
362      assertEquals(1, res.getTotalResults());
363      assertEquals(&quot;king:2&quot;, res.getDocuments().get(0).getId());
364    }
365    @Test
366    public void dropIndex() {
367      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;)));
368      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
369      fields.put(&quot;title&quot;, &quot;hello world&quot;);
370      for (int i = 0; i &lt; 100; i++) {
371        addDocument(String.format(&quot;doc%d&quot;, i), fields);
372      }
373      SearchResult res = client.ftSearch(index, &quot;hello world&quot;);
374      assertEquals(100, res.getTotalResults());
375      assertEquals(&quot;OK&quot;, client.ftDropIndex(index));
376      try {
377        client.ftSearch(index, &quot;hello world&quot;);
378        fail(&quot;Index should not exist.&quot;);
379      } catch (JedisDataException de) {
380        assertTrue(de.getMessage().contains(&quot;no such index&quot;));
381      }
382      assertEquals(100, client.dbSize());
383    }
384    @Test
385    public void dropIndexDD() {
386      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;)));
387      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
388      fields.put(&quot;title&quot;, &quot;hello world&quot;);
389      for (int i = 0; i &lt; 100; i++) {
390        addDocument(String.format(&quot;doc%d&quot;, i), fields);
391      }
392      SearchResult res = client.ftSearch(index, &quot;hello world&quot;);
393      assertEquals(100, res.getTotalResults());
394      assertEquals(&quot;OK&quot;, client.ftDropIndexDD(index));
395      Set&lt;String&gt; keys = client.keys(&quot;*&quot;);
396      assertTrue(keys.isEmpty());
397      assertEquals(0, client.dbSize());
398    }
399    @Test
400    public void noStem() {
401      assertOK(client.ftCreate(index, new TextField(&quot;stemmed&quot;).weight(1.0),
402          new TextField(&quot;notStemmed&quot;).weight(1.0).noStem()));
403      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
404      doc.put(&quot;stemmed&quot;, &quot;located&quot;);
405      doc.put(&quot;notStemmed&quot;, &quot;located&quot;);
406      addDocument(&quot;doc&quot;, doc);
407      SearchResult res = client.ftSearch(index, &quot;@stemmed:location&quot;);
408      assertEquals(1, res.getTotalResults());
409      res = client.ftSearch(index, &quot;@notStemmed:location&quot;);
410      assertEquals(0, res.getTotalResults());
411    }
412    @Test
413    public void phoneticMatch() {
414      assertOK(client.ftCreate(index, new TextField(&quot;noPhonetic&quot;).weight(1.0),
415          new TextField(&quot;withPhonetic&quot;).weight(1.0).phonetic(&quot;dm:en&quot;)));
416      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
417      doc.put(&quot;noPhonetic&quot;, &quot;morfix&quot;);
418      doc.put(&quot;withPhonetic&quot;, &quot;morfix&quot;);
419      addDocument(&quot;doc&quot;, doc);
420      SearchResult res = client.ftSearch(index, &quot;@withPhonetic:morphix=&gt;{$phonetic:true}&quot;);
421      assertEquals(1, res.getTotalResults());
422      try {
423        client.ftSearch(index, &quot;@noPhonetic:morphix=&gt;{$phonetic:true}&quot;);
424        fail();
425      } catch (JedisDataException e) {&amp;bsol;*field does not support phonetics*/
426      }
427      SearchResult res3 = client.ftSearch(index, &quot;@withPhonetic:morphix=&gt;{$phonetic:false}&quot;);
428      assertEquals(0, res3.getTotalResults());
429    }
430    @Test
431    public void info() {
432      Collection&lt;SchemaField&gt; sc = new ArrayList&lt;&gt;();
433      sc.add(TextField.of(&quot;title&quot;).weight(5));
434      sc.add(TextField.of(&quot;plot&quot;).sortable());
435      sc.add(TagField.of(&quot;genre&quot;).separator(&#x27;,&#x27;).sortable());
436      sc.add(NumericField.of(&quot;release_year&quot;).sortable());
437      sc.add(NumericField.of(&quot;rating&quot;).sortable());
438      sc.add(NumericField.of(&quot;votes&quot;).sortable());
439      assertOK(client.ftCreate(index, sc));
440      Map&lt;String, Object&gt; info = client.ftInfo(index);
441      assertEquals(index, info.get(&quot;index_name&quot;));
442      assertEquals(6, ((List) info.get(&quot;attributes&quot;)).size());
443      assertEquals(&quot;global_idle&quot;, ((List) info.get(&quot;cursor_stats&quot;)).get(0));
444      assertEquals(0L, ((List) info.get(&quot;cursor_stats&quot;)).get(1));
445    }
446    @Test
447    public void noIndexAndSortBy() {
448      assertOK(client.ftCreate(index, TextField.of(&quot;f1&quot;).sortable().noIndex(), TextField.of(&quot;f2&quot;)));
449      Map&lt;String, Object&gt; mm = new HashMap&lt;&gt;();
450      mm.put(&quot;f1&quot;, &quot;MarkZZ&quot;);
451      mm.put(&quot;f2&quot;, &quot;MarkZZ&quot;);
452      addDocument(&quot;doc1&quot;, mm);
453      mm.clear();
454      mm.put(&quot;f1&quot;, &quot;MarkAA&quot;);
455      mm.put(&quot;f2&quot;, &quot;MarkBB&quot;);
456      addDocument(&quot;doc2&quot;, mm);
457      SearchResult res = client.ftSearch(index, &quot;@f1:Mark*&quot;);
458      assertEquals(0, res.getTotalResults());
459      res = client.ftSearch(index, &quot;@f2:Mark*&quot;);
460      assertEquals(2, res.getTotalResults());
461      res = client.ftSearch(index, &quot;@f2:Mark*&quot;,
462          FTSearchParams.searchParams().sortBy(&quot;f1&quot;, SortingOrder.DESC));
463      assertEquals(2, res.getTotalResults());
464      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
465      res = client.ftSearch(index, &quot;@f2:Mark*&quot;,
466          FTSearchParams.searchParams().sortBy(&quot;f1&quot;, SortingOrder.ASC));
467      assertEquals(&quot;doc2&quot;, res.getDocuments().get(0).getId());
468    }
469    @Test
470    public void testHighlightSummarize() {
471      assertOK(client.ftCreate(index, TextField.of(&quot;text&quot;).weight(1)));
472      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
473      doc.put(&quot;text&quot;, &quot;Redis is often referred as a data structures server. What this means is that &quot;
474          + &quot;Redis provides access to mutable data structures via a set of commands, which are sent &quot;
475          + &quot;using a server-client model with TCP sockets and a simple protocol. So different &quot;
476          + &quot;processes can query and modify the same data structures in a shared way&quot;);
477      addDocument(&quot;foo&quot;, doc);
478      SearchResult res = client.ftSearch(index, &quot;data&quot;, FTSearchParams.searchParams().highlight().summarize());
479      assertEquals(&quot;is often referred as a &lt;b&gt;data&lt;/b&gt; structures server. What this means is that &quot;
480          + &quot;Redis provides... What this means is that Redis provides access to mutable &lt;b&gt;data&lt;/b&gt; &quot;
481          + &quot;structures via a set of commands, which are sent using a... So different processes can &quot;
482          + &quot;query and modify the same &lt;b&gt;data&lt;/b&gt; structures in a shared... &quot;,
483          res.getDocuments().get(0).get(&quot;text&quot;));
484      res = client.ftSearch(index, &quot;data&quot;, FTSearchParams.searchParams()
485          .highlight(FTSearchParams.highlightParams().tags(&quot;&lt;u&gt;&quot;, &quot;&lt;/u&gt;&quot;))
486          .summarize());
487      assertEquals(&quot;is often referred as a &lt;u&gt;data&lt;/u&gt; structures server. What this means is that &quot;
488          + &quot;Redis provides... What this means is that Redis provides access to mutable &lt;u&gt;data&lt;/u&gt; &quot;
489          + &quot;structures via a set of commands, which are sent using a... So different processes can &quot;
490          + &quot;query and modify the same &lt;u&gt;data&lt;/u&gt; structures in a shared... &quot;,
491          res.getDocuments().get(0).get(&quot;text&quot;));
492    }
493    @Test
494    public void getTagField() {
495      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;), TagField.of(&quot;category&quot;)));
496      Map&lt;String, Object&gt; fields1 = new HashMap&lt;&gt;();
497      fields1.put(&quot;title&quot;, &quot;hello world&quot;);
498      fields1.put(&quot;category&quot;, &quot;red&quot;);
499      addDocument(&quot;foo&quot;, fields1);
500      Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
501      fields2.put(&quot;title&quot;, &quot;hello world&quot;);
502      fields2.put(&quot;category&quot;, &quot;blue&quot;);
503      addDocument(&quot;bar&quot;, fields2);
504      Map&lt;String, Object&gt; fields3 = new HashMap&lt;&gt;();
505      fields3.put(&quot;title&quot;, &quot;hello world&quot;);
506      fields3.put(&quot;category&quot;, &quot;green,yellow&quot;);
507      addDocument(&quot;baz&quot;, fields3);
508      Map&lt;String, Object&gt; fields4 = new HashMap&lt;&gt;();
509      fields4.put(&quot;title&quot;, &quot;hello world&quot;);
510      fields4.put(&quot;category&quot;, &quot;orange;purple&quot;);
511      addDocument(&quot;qux&quot;, fields4);
512      assertEquals(1, client.ftSearch(index, &quot;@category:{red}&quot;).getTotalResults());
513      assertEquals(1, client.ftSearch(index, &quot;@category:{blue}&quot;).getTotalResults());
514      assertEquals(1, client.ftSearch(index, &quot;hello @category:{red}&quot;).getTotalResults());
515      assertEquals(1, client.ftSearch(index, &quot;hello @category:{blue}&quot;).getTotalResults());
516      assertEquals(1, client.ftSearch(index, &quot;@category:{yellow}&quot;).getTotalResults());
517      assertEquals(0, client.ftSearch(index, &quot;@category:{purple}&quot;).getTotalResults());
518      assertEquals(1, client.ftSearch(index, &quot;@category:{orange\\;purple}&quot;).getTotalResults());
519      assertEquals(4, client.ftSearch(index, &quot;hello&quot;).getTotalResults());
520      assertEquals(new HashSet&lt;&gt;(Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;orange;purple&quot;)),
521          client.ftTagVals(index, &quot;category&quot;));
522    }
523    @Test
524    public void testGetTagFieldWithNonDefaultSeparator() {
525      assertOK(client.ftCreate(index,
526          TextField.of(&quot;title&quot;),
527          TagField.of(&quot;category&quot;).separator(&#x27;;&#x27;)));
528      Map&lt;String, Object&gt; fields1 = new HashMap&lt;&gt;();
529      fields1.put(&quot;title&quot;, &quot;hello world&quot;);
530      fields1.put(&quot;category&quot;, &quot;red&quot;);
531      addDocument(&quot;foo&quot;, fields1);
532      Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
533      fields2.put(&quot;title&quot;, &quot;hello world&quot;);
534      fields2.put(&quot;category&quot;, &quot;blue&quot;);
535      addDocument(&quot;bar&quot;, fields2);
536      Map&lt;String, Object&gt; fields3 = new HashMap&lt;&gt;();
537      fields3.put(&quot;title&quot;, &quot;hello world&quot;);
538      fields3.put(&quot;category&quot;, &quot;green;yellow&quot;);
539      addDocument(&quot;baz&quot;, fields3);
540      Map&lt;String, Object&gt; fields4 = new HashMap&lt;&gt;();
541      fields4.put(&quot;title&quot;, &quot;hello world&quot;);
542      fields4.put(&quot;category&quot;, &quot;orange,purple&quot;);
543      addDocument(&quot;qux&quot;, fields4);
544      assertEquals(1, client.ftSearch(index, &quot;@category:{red}&quot;).getTotalResults());
545      assertEquals(1, client.ftSearch(index, &quot;@category:{blue}&quot;).getTotalResults());
546      assertEquals(1, client.ftSearch(index, &quot;hello @category:{red}&quot;).getTotalResults());
547      assertEquals(1, client.ftSearch(index, &quot;hello @category:{blue}&quot;).getTotalResults());
548      assertEquals(1, client.ftSearch(index, &quot;hello @category:{yellow}&quot;).getTotalResults());
549      assertEquals(0, client.ftSearch(index, &quot;@category:{purple}&quot;).getTotalResults());
550      assertEquals(1, client.ftSearch(index, &quot;@category:{orange\\,purple}&quot;).getTotalResults());
551      assertEquals(4, client.ftSearch(index, &quot;hello&quot;).getTotalResults());
552      assertEquals(new HashSet&lt;&gt;(Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;orange,purple&quot;)),
553          client.ftTagVals(index, &quot;category&quot;));
554    }
555    @Test
556    public void caseSensitiveTagField() {
557      assertOK(client.ftCreate(index,
558          TextField.of(&quot;title&quot;),
559          TagField.of(&quot;category&quot;).caseSensitive()));
560      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
561      fields.put(&quot;title&quot;, &quot;hello world&quot;);
562      fields.put(&quot;category&quot;, &quot;RedX&quot;);
563      addDocument(&quot;foo&quot;, fields);
564      assertEquals(0, client.ftSearch(index, &quot;@category:{redx}&quot;).getTotalResults());
565      assertEquals(0, client.ftSearch(index, &quot;@category:{redX}&quot;).getTotalResults());
566      assertEquals(0, client.ftSearch(index, &quot;@category:{Redx}&quot;).getTotalResults());
567      assertEquals(1, client.ftSearch(index, &quot;@category:{RedX}&quot;).getTotalResults());
568      assertEquals(1, client.ftSearch(index, &quot;hello&quot;).getTotalResults());
569    }
570    @Test
571    public void testReturnFields() {
572      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
573      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
574      doc.put(&quot;field1&quot;, &quot;value1&quot;);
575      doc.put(&quot;field2&quot;, &quot;value2&quot;);
576      addDocument(&quot;doc&quot;, doc);
577      SearchResult res = client.ftSearch(index, &quot;*&quot;,
578          FTSearchParams.searchParams().returnFields(&quot;field1&quot;));
579      assertEquals(1, res.getTotalResults());
580      Document ret = res.getDocuments().get(0);
581      assertEquals(&quot;value1&quot;, ret.get(&quot;field1&quot;));
582      assertNull(ret.get(&quot;field2&quot;));
583    }
584    @Test
585    public void returnWithFieldNames() {
586      assertOK(client.ftCreate(index, TextField.of(&quot;a&quot;), TextField.of(&quot;b&quot;), TextField.of(&quot;c&quot;)));
587      Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
588      map.put(&quot;a&quot;, &quot;value1&quot;);
589      map.put(&quot;b&quot;, &quot;value2&quot;);
590      map.put(&quot;c&quot;, &quot;value3&quot;);
591      addDocument(&quot;doc&quot;, map);
592      SearchResult res = client.ftSearch(index, &quot;*&quot;,
593          FTSearchParams.searchParams().returnFields(
594              FieldName.of(&quot;a&quot;), FieldName.of(&quot;b&quot;).as(&quot;d&quot;)));
595      assertEquals(1, res.getTotalResults());
596      Document doc = res.getDocuments().get(0);
597      assertEquals(&quot;value1&quot;, doc.get(&quot;a&quot;));
598      assertNull(doc.get(&quot;b&quot;));
599      assertEquals(&quot;value2&quot;, doc.get(&quot;d&quot;));
600      assertNull(doc.get(&quot;c&quot;));
601    }
602    @Test
603    public void inKeys() {
604      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
605      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
606      doc.put(&quot;field1&quot;, &quot;value&quot;);
607      doc.put(&quot;field2&quot;, &quot;not&quot;);
608      addDocument(&quot;doc1&quot;, doc);
609      addDocument(&quot;doc2&quot;, doc);
610      SearchResult res = client.ftSearch(index, &quot;value&quot;,
611          FTSearchParams.searchParams().inKeys(&quot;doc1&quot;));
612      assertEquals(1, res.getTotalResults());
613      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
614      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
615      assertEquals(null, res.getDocuments().get(0).get(&quot;value&quot;));
616    }
617    @Test
618    public void alias() {
619      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;)));
620      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
621      doc.put(&quot;field1&quot;, &quot;value&quot;);
622      addDocument(&quot;doc1&quot;, doc);
623      assertEquals(&quot;OK&quot;, client.ftAliasAdd(&quot;ALIAS1&quot;, index));
624      SearchResult res1 = client.ftSearch(&quot;ALIAS1&quot;, &quot;*&quot;,
625          FTSearchParams.searchParams().returnFields(&quot;field1&quot;));
626      assertEquals(1, res1.getTotalResults());
627      assertEquals(&quot;value&quot;, res1.getDocuments().get(0).get(&quot;field1&quot;));
628      assertEquals(&quot;OK&quot;, client.ftAliasUpdate(&quot;ALIAS2&quot;, index));
629      SearchResult res2 = client.ftSearch(&quot;ALIAS2&quot;, &quot;*&quot;,
630          FTSearchParams.searchParams().returnFields(&quot;field1&quot;));
631      assertEquals(1, res2.getTotalResults());
632      assertEquals(&quot;value&quot;, res2.getDocuments().get(0).get(&quot;field1&quot;));
633      try {
634        client.ftAliasDel(&quot;ALIAS3&quot;);
635        fail(&quot;Should throw JedisDataException&quot;);
636      } catch (JedisDataException e) {
637      }
638      assertEquals(&quot;OK&quot;, client.ftAliasDel(&quot;ALIAS2&quot;));
639      try {
640        client.ftAliasDel(&quot;ALIAS2&quot;);
641        fail(&quot;Should throw JedisDataException&quot;);
642      } catch (JedisDataException e) {
643      }
644    }
645    @Test
646    public void synonym() {
647      assertOK(client.ftCreate(index, TextField.of(&quot;name&quot;).weight(1), TextField.of(&quot;addr&quot;).weight(1)));
648      long group1 = 345L;
649      long group2 = 789L;
650      String group1_str = Long.toString(group1);
651      String group2_str = Long.toString(group2);
652      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group1_str, &quot;girl&quot;, &quot;baby&quot;));
653      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group1_str, &quot;child&quot;));
654      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group2_str, &quot;child&quot;));
655      Map&lt;String, List&lt;String&gt;&gt; dump = client.ftSynDump(index);
656      Map&lt;String, List&lt;String&gt;&gt; expected = new HashMap&lt;&gt;();
657      expected.put(&quot;girl&quot;, Arrays.asList(group1_str));
658      expected.put(&quot;baby&quot;, Arrays.asList(group1_str));
659      expected.put(&quot;child&quot;, Arrays.asList(group1_str, group2_str));
660      assertEquals(expected, dump);
661    }
662    @Test
663    public void slop() {
664      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
665      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
666      doc.put(&quot;field1&quot;, &quot;ok hi jedis&quot;);
667      addDocument(&quot;doc1&quot;, doc);
668      SearchResult res = client.ftSearch(index, &quot;ok jedis&quot;, FTSearchParams.searchParams().slop(0));
669      assertEquals(0, res.getTotalResults());
670      res = client.ftSearch(index, &quot;ok jedis&quot;, FTSearchParams.searchParams().slop(1));
671      assertEquals(1, res.getTotalResults());
672      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
673      assertEquals(&quot;ok hi jedis&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
674    }
675    @Test
676    public void timeout() {
677      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
678      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
679      map.put(&quot;field1&quot;, &quot;value&quot;);
680      map.put(&quot;field2&quot;, &quot;not&quot;);
681      client.hset(&quot;doc1&quot;, map);
682      SearchResult res = client.ftSearch(index, &quot;value&quot;, FTSearchParams.searchParams().timeout(1000));
683      assertEquals(1, res.getTotalResults());
684      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
685      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
686      assertEquals(&quot;not&quot;, res.getDocuments().get(0).get(&quot;field2&quot;));
687    }
688    @Test
689    public void inOrder() {
690      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
691      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
692      map.put(&quot;field1&quot;, &quot;value&quot;);
693      map.put(&quot;field2&quot;, &quot;not&quot;);
694      client.hset(&quot;doc2&quot;, map);
695      client.hset(&quot;doc1&quot;, map);
696      SearchResult res = client.ftSearch(index, &quot;value&quot;, FTSearchParams.searchParams().inOrder());
697      assertEquals(2, res.getTotalResults());
698      assertEquals(&quot;doc2&quot;, res.getDocuments().get(0).getId());
699      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
700      assertEquals(&quot;not&quot;, res.getDocuments().get(0).get(&quot;field2&quot;));
701    }
702    @Test
703    public void testHNSWVVectorSimilarity() {
704      Map&lt;String, Object&gt; attr = new HashMap&lt;&gt;();
705      attr.put(&quot;TYPE&quot;, &quot;FLOAT32&quot;);
706      attr.put(&quot;DIM&quot;, 2);
707      attr.put(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;);
708      assertOK(client.ftCreate(index, VectorField.builder().fieldName(&quot;v&quot;)
709          .algorithm(VectorField.VectorAlgorithm.HNSW).attributes(attr).build()));
710      client.hset(&quot;a&quot;, &quot;v&quot;, &quot;aaaaaaaa&quot;);
711      client.hset(&quot;b&quot;, &quot;v&quot;, &quot;aaaabaaa&quot;);
712      client.hset(&quot;c&quot;, &quot;v&quot;, &quot;aaaaabaa&quot;);
713      FTSearchParams searchParams = FTSearchParams.searchParams()
714          .addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
715          .sortBy(&quot;__v_score&quot;, SortingOrder.ASC)
716          .returnFields(&quot;__v_score&quot;)
717          .dialect(2);
718      Document doc1 = client.ftSearch(index, &quot;*=&gt;[KNN 2 @v $vec]&quot;, searchParams).getDocuments().get(0);
719      assertEquals(&quot;a&quot;, doc1.getId());
720      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
721    }
722    @Test
723    public void testFlatVectorSimilarity() {
724      assertOK(client.ftCreate(index,
725          VectorField.builder().fieldName(&quot;v&quot;)
726              .algorithm(VectorField.VectorAlgorithm.FLAT)
727              .addAttribute(&quot;TYPE&quot;, &quot;FLOAT32&quot;)
728              .addAttribute(&quot;DIM&quot;, 2)
729              .addAttribute(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;)
730              .build()
731      ));
732      client.hset(&quot;a&quot;, &quot;v&quot;, &quot;aaaaaaaa&quot;);
733      client.hset(&quot;b&quot;, &quot;v&quot;, &quot;aaaabaaa&quot;);
734      client.hset(&quot;c&quot;, &quot;v&quot;, &quot;aaaaabaa&quot;);
735      FTSearchParams searchParams = FTSearchParams.searchParams()
736          .addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
737          .sortBy(&quot;__v_score&quot;, SortingOrder.ASC)
738          .returnFields(&quot;__v_score&quot;)
739          .dialect(2);
740      Document doc1 = client.ftSearch(index, &quot;*=&gt;[KNN 2 @v $vec]&quot;, searchParams).getDocuments().get(0);
741      assertEquals(&quot;a&quot;, doc1.getId());
742      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
743    }
744    @Test
745    public void searchProfile() {
746      assertOK(client.ftCreate(index, TextField.of(&quot;t1&quot;), TextField.of(&quot;t2&quot;)));
747      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
748      map.put(&quot;t1&quot;, &quot;foo&quot;);
749      map.put(&quot;t2&quot;, &quot;bar&quot;);
750      client.hset(&quot;doc1&quot;, map);
751      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
752          FTProfileParams.profileParams(), &quot;foo&quot;, FTSearchParams.searchParams());
753      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
754      assertEquals(&quot;TEXT&quot;, iteratorsProfile.get(&quot;Type&quot;));
755      assertEquals(&quot;foo&quot;, iteratorsProfile.get(&quot;Term&quot;));
756      assertEquals(1L, iteratorsProfile.get(&quot;Counter&quot;));
757      assertEquals(1L, iteratorsProfile.get(&quot;Size&quot;));
758      assertSame(Double.class, iteratorsProfile.get(&quot;Time&quot;).getClass());
759    }
760    @Test
761    public void vectorSearchProfile() {
762      assertOK(client.ftCreate(index, VectorField.builder().fieldName(&quot;v&quot;)
763          .algorithm(VectorAlgorithm.FLAT).addAttribute(&quot;TYPE&quot;, &quot;FLOAT32&quot;)
764          .addAttribute(&quot;DIM&quot;, 2).addAttribute(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;).build(),
765          TextField.of(&quot;t&quot;)));
766      client.hset(&quot;1&quot;, toMap(&quot;v&quot;, &quot;bababaca&quot;, &quot;t&quot;, &quot;hello&quot;));
767      client.hset(&quot;2&quot;, toMap(&quot;v&quot;, &quot;babababa&quot;, &quot;t&quot;, &quot;hello&quot;));
768      client.hset(&quot;3&quot;, toMap(&quot;v&quot;, &quot;aabbaabb&quot;, &quot;t&quot;, &quot;hello&quot;));
769      client.hset(&quot;4&quot;, toMap(&quot;v&quot;, &quot;bbaabbaa&quot;, &quot;t&quot;, &quot;hello world&quot;));
770      client.hset(&quot;5&quot;, toMap(&quot;v&quot;, &quot;aaaabbbb&quot;, &quot;t&quot;, &quot;hello world&quot;));
771      FTSearchParams searchParams = FTSearchParams.searchParams().addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
772          .sortBy(&quot;__v_score&quot;, SortingOrder.ASC).noContent().dialect(2);
773      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
774          FTProfileParams.profileParams(), &quot;*=&gt;[KNN 3 @v $vec]&quot;, searchParams);
775      assertEquals(3, profile.getKey().getTotalResults());
776      assertEquals(Arrays.asList(4, 2, 1).toString(), profile.getKey().getDocuments()
777          .stream().map(Document::getId).collect(Collectors.toList()).toString());
778      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
779      assertEquals(&quot;VECTOR&quot;, iteratorsProfile.get(&quot;Type&quot;));
780      assertEquals(3L, iteratorsProfile.get(&quot;Counter&quot;));
781      List&lt;Map&lt;String, Object&gt;&gt; resultProcessorsProfile = (List&lt;Map&lt;String, Object&gt;&gt;) profile.getValue().get(&quot;Result processors profile&quot;);
782      assertEquals(3l, resultProcessorsProfile.get(1).get(&quot;Counter&quot;));
783    }
784    @Test
785    public void maxPrefixExpansionSearchProfile() {
786      final String configParam = &quot;MAXPREFIXEXPANSIONS&quot;;
787      String configValue = client.ftConfigGet(configParam).get(configParam);
788      client.ftConfigSet(configParam, &quot;2&quot;);
789      assertOK(client.ftCreate(index, TextField.of(&quot;t&quot;)));
790      client.hset(&quot;1&quot;, Collections.singletonMap(&quot;t&quot;, &quot;foo1&quot;));
791      client.hset(&quot;2&quot;, Collections.singletonMap(&quot;t&quot;, &quot;foo2&quot;));
792      client.hset(&quot;3&quot;, Collections.singletonMap(&quot;t&quot;, &quot;foo3&quot;));
793      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
794          FTProfileParams.profileParams(), &quot;foo*&quot;, FTSearchParams.searchParams().limit(0, 0));
795      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
796      assertEquals(&quot;Max prefix expansion reached&quot;, iteratorsProfile.get(&quot;Warning&quot;));
797      client.ftConfigSet(configParam, configValue);
798    }
799    @Test
800    public void notIteratorSearchProfile() {
801      assertOK(client.ftCreate(index, TextField.of(&quot;t&quot;)));
802      client.hset(&quot;1&quot;, Collections.singletonMap(&quot;t&quot;, &quot;foo&quot;));
803      client.hset(&quot;2&quot;, Collections.singletonMap(&quot;t&quot;, &quot;bar&quot;));
804      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
805          FTProfileParams.profileParams(), &quot;foo -@t:baz&quot;, FTSearchParams.searchParams().noContent());
806      Map&lt;String, Object&gt; depth0 = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
807      assertEquals(&quot;INTERSECT&quot;, depth0.get(&quot;Type&quot;));
808      List&lt;Map&lt;String, Object&gt;&gt; depth0_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth0.get(&quot;Child iterators&quot;);
809      assertEquals(&quot;TEXT&quot;, depth0_children.get(0).get(&quot;Type&quot;));
810      Map&lt;String, Object&gt; depth1 = depth0_children.get(1);
811      assertEquals(&quot;NOT&quot;, depth1.get(&quot;Type&quot;));
812      List&lt;Map&lt;String, Object&gt;&gt; depth1_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth1.get(&quot;Child iterators&quot;);
813      assertEquals(1, depth1_children.size());
814      assertEquals(&quot;EMPTY&quot;, depth1_children.get(0).get(&quot;Type&quot;));
815    }
816    @Test
817    public void deepReplySearchProfile() {
818      assertOK(client.ftCreate(index, TextField.of(&quot;t&quot;)));
819      client.hset(&quot;1&quot;, Collections.singletonMap(&quot;t&quot;, &quot;hello&quot;));
820      client.hset(&quot;2&quot;, Collections.singletonMap(&quot;t&quot;, &quot;world&quot;));
821      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile
822          = client.ftProfileSearch(index, FTProfileParams.profileParams(),
823              &quot;hello(hello(hello(hello(hello(hello)))))&quot;, FTSearchParams.searchParams().noContent());
824      Map&lt;String, Object&gt; depth0 = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
825      assertEquals(&quot;INTERSECT&quot;, depth0.get(&quot;Type&quot;));
826      List&lt;Map&lt;String, Object&gt;&gt; depth0_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth0.get(&quot;Child iterators&quot;);
827      assertEquals(&quot;TEXT&quot;, depth0_children.get(0).get(&quot;Type&quot;));
828      Map&lt;String, Object&gt; depth1 = depth0_children.get(1);
829      assertEquals(&quot;INTERSECT&quot;, depth1.get(&quot;Type&quot;));
830      List&lt;Map&lt;String, Object&gt;&gt; depth1_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth1.get(&quot;Child iterators&quot;);
831      assertEquals(&quot;TEXT&quot;, depth1_children.get(0).get(&quot;Type&quot;));
832      Map&lt;String, Object&gt; depth2 = depth1_children.get(1);
833      assertEquals(&quot;INTERSECT&quot;, depth2.get(&quot;Type&quot;));
834      List&lt;Map&lt;String, Object&gt;&gt; depth2_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth2.get(&quot;Child iterators&quot;);
835      assertEquals(&quot;TEXT&quot;, depth2_children.get(0).get(&quot;Type&quot;));
836      Map&lt;String, Object&gt; depth3 = depth2_children.get(1);
837      assertEquals(&quot;INTERSECT&quot;, depth3.get(&quot;Type&quot;));
838      List&lt;Map&lt;String, Object&gt;&gt; depth3_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth3.get(&quot;Child iterators&quot;);
839      assertEquals(&quot;TEXT&quot;, depth3_children.get(0).get(&quot;Type&quot;));
840      Map&lt;String, Object&gt; depth4 = depth3_children.get(1);
841      assertEquals(&quot;INTERSECT&quot;, depth4.get(&quot;Type&quot;));
842      List&lt;Map&lt;String, Object&gt;&gt; depth4_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth4.get(&quot;Child iterators&quot;);
843      assertEquals(&quot;TEXT&quot;, depth4_children.get(0).get(&quot;Type&quot;));
844      Map&lt;String, Object&gt; depth5 = depth4_children.get(1);
845      assertEquals(&quot;TEXT&quot;, depth5.get(&quot;Type&quot;));
846      assertNull(depth5.get(&quot;Child iterators&quot;));
847    }
848    @Test
849    public void limitedSearchProfile() {
850      assertOK(client.ftCreate(index, TextField.of(&quot;t&quot;)));
851      client.hset(&quot;1&quot;, Collections.singletonMap(&quot;t&quot;, &quot;hello&quot;));
852      client.hset(&quot;2&quot;, Collections.singletonMap(&quot;t&quot;, &quot;hell&quot;));
853      client.hset(&quot;3&quot;, Collections.singletonMap(&quot;t&quot;, &quot;help&quot;));
854      client.hset(&quot;4&quot;, Collections.singletonMap(&quot;t&quot;, &quot;helowa&quot;));
855      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
856          FTProfileParams.profileParams().limited(), &quot;%hell% hel*&quot;, FTSearchParams.searchParams().noContent());
857      Map&lt;String, Object&gt; depth0 = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
858      assertEquals(&quot;INTERSECT&quot;, depth0.get(&quot;Type&quot;));
859      assertEquals(3L, depth0.get(&quot;Counter&quot;));
860      List&lt;Map&lt;String, Object&gt;&gt; depth0_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth0.get(&quot;Child iterators&quot;);
861      assertFalse(depth0_children.isEmpty());
862      for (Map&lt;String, Object&gt; depth1 : depth0_children) {
863        assertEquals(&quot;UNION&quot;, depth1.get(&quot;Type&quot;));
864        assertNotNull(depth1.get(&quot;Query type&quot;));
865        List depth1_children = (List) depth1.get(&quot;Child iterators&quot;);
866        assertEquals(1, depth1_children.size());
867        assertSame(String.class, depth1_children.get(0).getClass());
868      }
869    }
870    @Test
871    public void list() {
872      assertEquals(Collections.emptyList(), client.ftList());
873      final int count = 20;
874      Set&lt;String&gt; names = new HashSet&lt;&gt;();
875      for (int i = 0; i &lt; count; i++) {
876        final String name = &quot;idx&quot; + i;
877        assertOK(client.ftCreate(name, TextField.of(&quot;t&quot; + i)));
878        names.add(name);
879      }
880      assertEquals(names, new HashSet&lt;&gt;(client.ftList()));
881    }
882    @Test
883    public void broadcast() {
884      String reply = client.ftCreate(index, TextField.of(&quot;t&quot;));
885      assertOK(reply);
886    }
887    @Test
888    public void searchIteration() {
889      assertOK(client.ftCreate(index, FTCreateParams.createParams(),
890          TextField.of(&quot;first&quot;), TextField.of(&quot;last&quot;), NumericField.of(&quot;age&quot;)));
891      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
892      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
893      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
894      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
895      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
896      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
897      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
898      FtSearchIteration search = client.ftSearchIteration(3, index, &quot;*&quot;, FTSearchParams.searchParams());
899      int total = 0;
900      while (!search.isIterationCompleted()) {
901        SearchResult result = search.nextBatch();
902        int count = result.getDocuments().size();
903        assertThat(count, Matchers.lessThanOrEqualTo(3));
904        total += count;
905      }
906      assertEquals(7, total);
907    }
908    @Test
909    public void searchIterationCollect() {
910      assertOK(client.ftCreate(index, FTCreateParams.createParams(),
911          TextField.of(&quot;first&quot;), TextField.of(&quot;last&quot;), NumericField.of(&quot;age&quot;)));
912      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
913      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
914      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
915      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
916      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
917      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
918      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
919      ArrayList&lt;Document&gt; collect = new ArrayList&lt;&gt;();
920      client.ftSearchIteration(3, index, &quot;*&quot;, FTSearchParams.searchParams()).collect(collect);
921      assertEquals(7, collect.size());
922      assertEquals(Arrays.asList(&quot;profesor:5555&quot;, &quot;student:1111&quot;, &quot;pupil:2222&quot;, &quot;student:3333&quot;,
923          &quot;pupil:4444&quot;, &quot;student:5555&quot;, &quot;teacher:6666&quot;).stream().collect(Collectors.toSet()),
924          collect.stream().map(Document::getId).collect(Collectors.toSet()));
925    }
926  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SearchWithParamsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.modules.search;
2  import static org.junit.Assert.*;
3  import static redis.clients.jedis.util.AssertUtil.assertOK;
4  import java.util.*;
5  import java.util.stream.Collectors;
6  import org.hamcrest.Matchers;
7  import org.junit.BeforeClass;
8  import org.junit.Test;
9  import redis.clients.jedis.GeoCoordinate;
10  import redis.clients.jedis.args.GeoUnit;
11  import redis.clients.jedis.args.SortingOrder;
12  import redis.clients.jedis.exceptions.JedisDataException;
13  import redis.clients.jedis.json.Path;
14  import redis.clients.jedis.search.*;
15  import redis.clients.jedis.search.schemafields.*;
16  import redis.clients.jedis.search.schemafields.VectorField.VectorAlgorithm;
17  import redis.clients.jedis.modules.RedisModuleCommandsTestBase;
18  public class SearchWithParamsTest extends RedisModuleCommandsTestBase {
19    private static final String index = &quot;testindex&quot;;
20    @BeforeClass
21    public static void prepare() {
22      RedisModuleCommandsTestBase.prepare();
23    }
24    private void addDocument(String key, Map&lt;String, Object&gt; map) {
25      client.hset(key, RediSearchUtil.toStringMap(map));
26    }
27    private static Map&lt;String, Object&gt; toMap(Object... values) {
28      Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
29      for (int i = 0; i &lt; values.length; i += 2) {
30        map.put((String) values[i], values[i + 1]);
31      }
32      return map;
33    }
34    private static Map&lt;String, String&gt; toMap(String... values) {
35      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
36      for (int i = 0; i &lt; values.length; i += 2) {
37        map.put(values[i], values[i + 1]);
38      }
39      return map;
40    }
41    @Test
42    public void create() {
43      assertOK(client.ftCreate(index,
44          FTCreateParams.createParams()
45              .filter(&quot;@age&gt;16&quot;)
46              .prefix(&quot;student:&quot;, &quot;pupil:&quot;),
47          TextField.of(&quot;first&quot;), TextField.of(&quot;last&quot;), NumericField.of(&quot;age&quot;)));
48      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
49      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
50      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
51      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
52      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
53      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
54      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
55      SearchResult noFilters = client.ftSearch(index);
56      assertEquals(4, noFilters.getTotalResults());
57      SearchResult res1 = client.ftSearch(index, &quot;@first:Jo*&quot;);
58      assertEquals(2, res1.getTotalResults());
59      SearchResult res2 = client.ftSearch(index, &quot;@first:Pat&quot;);
60      assertEquals(1, res2.getTotalResults());
61      SearchResult res3 = client.ftSearch(index, &quot;@last:Rod&quot;);
62      assertEquals(0, res3.getTotalResults());
63    }
64    @Test
65    public void createNoParams() {
66      assertOK(client.ftCreate(index,
67          TextField.of(&quot;first&quot;).weight(1),
68          TextField.of(&quot;last&quot;).weight(1),
69          NumericField.of(&quot;age&quot;)));
70      addDocument(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, 18));
71      addDocument(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, 17));
72      addDocument(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, 21));
73      addDocument(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, 20));
74      SearchResult noFilters = client.ftSearch(index);
75      assertEquals(4, noFilters.getTotalResults());
76      SearchResult res1 = client.ftSearch(index, &quot;@first:Jo*&quot;);
77      assertEquals(2, res1.getTotalResults());
78      SearchResult res2 = client.ftSearch(index, &quot;@first:Pat&quot;);
79      assertEquals(1, res2.getTotalResults());
80      SearchResult res3 = client.ftSearch(index, &quot;@last:Rod&quot;);
81      assertEquals(0, res3.getTotalResults());
82    }
83    @Test
84    public void createWithFieldNames() {
85      assertOK(client.ftCreate(index,
86          FTCreateParams.createParams()
87              .addPrefix(&quot;student:&quot;).addPrefix(&quot;pupil:&quot;),
88          TextField.of(&quot;first&quot;).as(&quot;given&quot;),
89          TextField.of(FieldName.of(&quot;last&quot;).as(&quot;family&quot;))));
90      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
91      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
92      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
93      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
94      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
95      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
96      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
97      SearchResult noFilters = client.ftSearch(index);
98      assertEquals(5, noFilters.getTotalResults());
99      SearchResult asFirst = client.ftSearch(index, &quot;@first:Jo*&quot;);
100      assertEquals(0, asFirst.getTotalResults());
101      SearchResult asGiven = client.ftSearch(index, &quot;@given:Jo*&quot;);
102      assertEquals(2, asGiven.getTotalResults());
103      SearchResult nonLast = client.ftSearch(index, &quot;@last:Rod&quot;);
104      assertEquals(0, nonLast.getTotalResults());
105      SearchResult asFamily = client.ftSearch(index, &quot;@family:Rod&quot;);
106      assertEquals(1, asFamily.getTotalResults());
107    }
108    @Test
109    public void alterAdd() {
110      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;)));
111      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
112      fields.put(&quot;title&quot;, &quot;hello world&quot;);
113      for (int i = 0; i &lt; 100; i++) {
114        addDocument(String.format(&quot;doc%d&quot;, i), fields);
115      }
116      SearchResult res = client.ftSearch(index, &quot;hello world&quot;);
117      assertEquals(100, res.getTotalResults());
118      assertOK(client.ftAlter(index,
119          TagField.of(&quot;tags&quot;),
120          TextField.of(&quot;name&quot;).weight(0.5)));
121      for (int i = 0; i &lt; 100; i++) {
122        Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
123        fields2.put(&quot;name&quot;, &quot;name&quot; + i);
124        fields2.put(&quot;tags&quot;, String.format(&quot;tagA,tagB,tag%d&quot;, i));
125        addDocument(String.format(&quot;doc%d&quot;, i), fields2);
126      }
127      SearchResult res2 = client.ftSearch(index, &quot;@tags:{tagA}&quot;);
128      assertEquals(100, res2.getTotalResults());
129      Map&lt;String, Object&gt; info = client.ftInfo(index);
130      assertEquals(index, info.get(&quot;index_name&quot;));
131      assertEquals(&quot;identifier&quot;, ((List) ((List) info.get(&quot;attributes&quot;)).get(1)).get(0));
132      assertEquals(&quot;attribute&quot;, ((List) ((List) info.get(&quot;attributes&quot;)).get(1)).get(2));
133    }
134    @Test
135    public void search() {
136      assertOK(client.ftCreate(index, FTCreateParams.createParams(),
137          TextField.of(&quot;title&quot;), TextField.of(&quot;body&quot;)));
138      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
139      fields.put(&quot;title&quot;, &quot;hello world&quot;);
140      fields.put(&quot;body&quot;, &quot;lorem ipsum&quot;);
141      for (int i = 0; i &lt; 100; i++) {
142        addDocument(String.format(&quot;doc%d&quot;, i), fields);
143      }
144      SearchResult res = client.ftSearch(index, &quot;hello world&quot;,
145          FTSearchParams.searchParams().limit(0, 5).withScores());
146      assertEquals(100, res.getTotalResults());
147      assertEquals(5, res.getDocuments().size());
148      for (Document d : res.getDocuments()) {
149        assertTrue(d.getId().startsWith(&quot;doc&quot;));
150        assertTrue(d.getScore() &lt; 100);
151      }
152      client.del(&quot;doc0&quot;);
153      res = client.ftSearch(index, &quot;hello world&quot;);
154      assertEquals(99, res.getTotalResults());
155      assertEquals(&quot;OK&quot;, client.ftDropIndex(index));
156      try {
157        client.ftSearch(index, &quot;hello world&quot;);
158        fail();
159      } catch (JedisDataException e) {
160      }
161    }
162    @Test
163    public void numericFilter() {
164      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;), NumericField.of(&quot;price&quot;)));
165      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
166      fields.put(&quot;title&quot;, &quot;hello world&quot;);
167      for (int i = 0; i &lt; 100; i++) {
168        fields.put(&quot;price&quot;, i);
169        addDocument(String.format(&quot;doc%d&quot;, i), fields);
170      }
171      SearchResult res = client.ftSearch(index, &quot;hello world&quot;,
172          FTSearchParams.searchParams().filter(&quot;price&quot;, 0, 49));
173      assertEquals(50, res.getTotalResults());
174      assertEquals(10, res.getDocuments().size());
175      for (Document d : res.getDocuments()) {
176        long price = Long.valueOf((String) d.get(&quot;price&quot;));
177        assertTrue(price &gt;= 0);
178        assertTrue(price &lt;= 49);
179      }
180      res = client.ftSearch(index, &quot;hello world&quot;,
181          FTSearchParams.searchParams().filter(&quot;price&quot;, 0, true, 49, true));
182      assertEquals(48, res.getTotalResults());
183      assertEquals(10, res.getDocuments().size());
184      for (Document d : res.getDocuments()) {
185        long price = Long.valueOf((String) d.get(&quot;price&quot;));
186        assertTrue(price &gt; 0);
187        assertTrue(price &lt; 49);
188      }
189      res = client.ftSearch(index, &quot;hello world&quot;,
190          FTSearchParams.searchParams().filter(&quot;price&quot;, 50, 100));
191      assertEquals(50, res.getTotalResults());
192      assertEquals(10, res.getDocuments().size());
193      for (Document d : res.getDocuments()) {
194        long price = Long.valueOf((String) d.get(&quot;price&quot;));
195        assertTrue(price &gt;= 50);
196        assertTrue(price &lt;= 100);
197      }
198      res = client.ftSearch(index, &quot;hello world&quot;,
199          FTSearchParams.searchParams()
200              .filter(&quot;price&quot;, 20, Double.POSITIVE_INFINITY));
201      assertEquals(80, res.getTotalResults());
202      assertEquals(10, res.getDocuments().size());
203      res = client.ftSearch(index, &quot;hello world&quot;,
204          FTSearchParams.searchParams()
205              .filter(&quot;price&quot;, Double.NEGATIVE_INFINITY, 10));
206      assertEquals(11, res.getTotalResults());
207      assertEquals(10, res.getDocuments().size());
208    }
209    @Test
210    public void stopwords() {
211      assertOK(client.ftCreate(index,
212          FTCreateParams.createParams()
213              .stopwords(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;),
214          TextField.of(&quot;title&quot;)));
215      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
216      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
217      addDocument(&quot;doc1&quot;, fields);
218      SearchResult res = client.ftSearch(index, &quot;hello world&quot;);
219      assertEquals(1, res.getTotalResults());
220      res = client.ftSearch(index, &quot;foo bar&quot;);
221      assertEquals(0, res.getTotalResults());
222    }
223    @Test
224    public void noStopwords() {
225      assertOK(client.ftCreate(index,
226          FTCreateParams.createParams().noStopwords(),
<span onclick='openModal()' class='match'>227          TextField.of(&quot;title&quot;)));
228      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
229      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
230      fields.put(&quot;title&quot;, &quot;hello world foo bar to be or not to be&quot;);
</span>231      addDocument(&quot;doc1&quot;, fields);
232      assertEquals(1, client.ftSearch(index, &quot;hello world&quot;).getTotalResults());
233      assertEquals(1, client.ftSearch(index, &quot;foo bar&quot;).getTotalResults());
234      assertEquals(1, client.ftSearch(index, &quot;to be or not to be&quot;).getTotalResults());
235    }
236    @Test
237    public void geoFilter() {
238      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;), GeoField.of(&quot;loc&quot;)));
239      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
240      fields.put(&quot;title&quot;, &quot;hello world&quot;);
241      fields.put(&quot;loc&quot;, &quot;-0.441,51.458&quot;);
242      addDocument(&quot;doc1&quot;, fields);
243      fields.put(&quot;loc&quot;, &quot;-0.1,51.2&quot;);
244      addDocument(&quot;doc2&quot;, fields);
245      SearchResult res = client.ftSearch(index, &quot;hello world&quot;,
246          FTSearchParams.searchParams().
247              geoFilter(&quot;loc&quot;, -0.44, 51.45, 10, GeoUnit.KM));
248      assertEquals(1, res.getTotalResults());
249      res = client.ftSearch(index, &quot;hello world&quot;,
250          FTSearchParams.searchParams().
251              geoFilter(&quot;loc&quot;, -0.44, 51.45, 100, GeoUnit.KM));
252      assertEquals(2, res.getTotalResults());
253    }
254    @Test
255    public void geoFilterAndGeoCoordinateObject() {
256      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;), GeoField.of(&quot;loc&quot;)));
257      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
258      fields.put(&quot;title&quot;, &quot;hello world&quot;);
259      fields.put(&quot;loc&quot;, new GeoCoordinate(-0.441, 51.458));
260      addDocument(&quot;doc1&quot;, fields);
261      fields.put(&quot;loc&quot;, new GeoCoordinate(-0.1, 51.2));
262      addDocument(&quot;doc2&quot;, fields);
263      SearchResult res = client.ftSearch(index, &quot;hello world&quot;,
264          FTSearchParams.searchParams()
265              .geoFilter(new FTSearchParams.GeoFilter(&quot;loc&quot;, -0.44, 51.45, 10, GeoUnit.KM)));
266      assertEquals(1, res.getTotalResults());
267      res = client.ftSearch(index, &quot;hello world&quot;,
268          FTSearchParams.searchParams()
269              .geoFilter(new FTSearchParams.GeoFilter(&quot;loc&quot;, -0.44, 51.45, 100, GeoUnit.KM)));
270      assertEquals(2, res.getTotalResults());
271    }
272    @Test
273    public void testQueryFlags() {
274      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;)));
275      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
276      for (int i = 0; i &lt; 100; i++) {
277        fields.put(&quot;title&quot;, i % 2 != 0 ? &quot;hello worlds&quot; : &quot;hello world&quot;);
278        addDocument(String.format(&quot;doc%d&quot;, i), fields);
279      }
280      SearchResult res = client.ftSearch(index, &quot;hello&quot;,
281          FTSearchParams.searchParams().withScores());
282      assertEquals(100, res.getTotalResults());
283      assertEquals(10, res.getDocuments().size());
284      for (Document d : res.getDocuments()) {
285        assertTrue(d.getId().startsWith(&quot;doc&quot;));
286        assertTrue(((String) d.get(&quot;title&quot;)).startsWith(&quot;hello world&quot;));
287      }
288      res = client.ftSearch(index, &quot;hello&quot;,
289          FTSearchParams.searchParams().noContent());
290      for (Document d : res.getDocuments()) {
291        assertTrue(d.getId().startsWith(&quot;doc&quot;));
292        assertEquals(1.0, d.getScore(), 0);
293        assertNull(d.get(&quot;title&quot;));
294      }
295      res = client.ftSearch(index, &quot;hello worlds&quot;);
296      assertEquals(100, res.getTotalResults());
297      res = client.ftSearch(index, &quot;hello worlds&quot;, FTSearchParams.searchParams().verbatim());
298      assertEquals(50, res.getTotalResults());
299      res = client.ftSearch(index, &quot;hello a world&quot;, FTSearchParams.searchParams().verbatim());
300      assertEquals(50, res.getTotalResults());
301      res = client.ftSearch(index, &quot;hello a worlds&quot;, FTSearchParams.searchParams().verbatim());
302      assertEquals(50, res.getTotalResults());
303      res = client.ftSearch(index, &quot;hello a world&quot;, FTSearchParams.searchParams().verbatim().noStopwords());
304      assertEquals(0, res.getTotalResults());
305    }
306    @Test
307    public void testQueryParams() {
308      assertOK(client.ftCreate(index, NumericField.of(&quot;numval&quot;)));
309      client.hset(&quot;1&quot;, &quot;numval&quot;, &quot;1&quot;);
310      client.hset(&quot;2&quot;, &quot;numval&quot;, &quot;2&quot;);
311      client.hset(&quot;3&quot;, &quot;numval&quot;, &quot;3&quot;);
312      assertEquals(2, client.ftSearch(index, &quot;@numval:[$min $max]&quot;,
313          FTSearchParams.searchParams().addParam(&quot;min&quot;, 1).addParam(&quot;max&quot;, 2)
314              .dialect(2)).getTotalResults());
315      Map&lt;String, Object&gt; paramValues = new HashMap&lt;&gt;();
316      paramValues.put(&quot;min&quot;, 1);
317      paramValues.put(&quot;max&quot;, 2);
318      assertEquals(2, client.ftSearch(index, &quot;@numval:[$min $max]&quot;,
319          FTSearchParams.searchParams().params(paramValues)
320              .dialect(2)).getTotalResults());
321    }
322    @Test
323    public void testSortQueryFlags() {
324      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;).sortable()));
325      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
326      fields.put(&quot;title&quot;, &quot;b title&quot;);
327      addDocument(&quot;doc1&quot;, fields);
328      fields.put(&quot;title&quot;, &quot;a title&quot;);
329      addDocument(&quot;doc2&quot;, fields);
330      fields.put(&quot;title&quot;, &quot;c title&quot;);
331      addDocument(&quot;doc3&quot;, fields);
332      SearchResult res = client.ftSearch(index, &quot;title&quot;,
333          FTSearchParams.searchParams().sortBy(&quot;title&quot;, SortingOrder.ASC));
334      assertEquals(3, res.getTotalResults());
335      Document doc1 = res.getDocuments().get(0);
336      assertEquals(&quot;a title&quot;, doc1.get(&quot;title&quot;));
337      doc1 = res.getDocuments().get(1);
338      assertEquals(&quot;b title&quot;, doc1.get(&quot;title&quot;));
339      doc1 = res.getDocuments().get(2);
340      assertEquals(&quot;c title&quot;, doc1.get(&quot;title&quot;));
341    }
342    @Test
343    public void testJsonWithAlias() {
344      assertOK(client.ftCreate(index,
345          FTCreateParams.createParams()
346              .on(IndexDataType.JSON)
347              .prefix(&quot;king:&quot;),
348          TextField.of(&quot;$.name&quot;).as(&quot;name&quot;),
349          NumericField.of(&quot;$.num&quot;).as(&quot;num&quot;)));
350      Map&lt;String, Object&gt; king1 = new HashMap&lt;&gt;();
351      king1.put(&quot;name&quot;, &quot;henry&quot;);
352      king1.put(&quot;num&quot;, 42);
353      client.jsonSet(&quot;king:1&quot;, Path.ROOT_PATH, king1);
354      Map&lt;String, Object&gt; king2 = new HashMap&lt;&gt;();
355      king2.put(&quot;name&quot;, &quot;james&quot;);
356      king2.put(&quot;num&quot;, 3.14);
357      client.jsonSet(&quot;king:2&quot;, Path.ROOT_PATH, king2);
358      SearchResult res = client.ftSearch(index, &quot;@name:henry&quot;);
359      assertEquals(1, res.getTotalResults());
360      assertEquals(&quot;king:1&quot;, res.getDocuments().get(0).getId());
361      res = client.ftSearch(index, &quot;@num:[0 10]&quot;);
362      assertEquals(1, res.getTotalResults());
363      assertEquals(&quot;king:2&quot;, res.getDocuments().get(0).getId());
364    }
365    @Test
366    public void dropIndex() {
367      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;)));
368      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
369      fields.put(&quot;title&quot;, &quot;hello world&quot;);
370      for (int i = 0; i &lt; 100; i++) {
371        addDocument(String.format(&quot;doc%d&quot;, i), fields);
372      }
373      SearchResult res = client.ftSearch(index, &quot;hello world&quot;);
374      assertEquals(100, res.getTotalResults());
375      assertEquals(&quot;OK&quot;, client.ftDropIndex(index));
376      try {
377        client.ftSearch(index, &quot;hello world&quot;);
378        fail(&quot;Index should not exist.&quot;);
379      } catch (JedisDataException de) {
380        assertTrue(de.getMessage().contains(&quot;no such index&quot;));
381      }
382      assertEquals(100, client.dbSize());
383    }
384    @Test
385    public void dropIndexDD() {
386      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;)));
387      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
388      fields.put(&quot;title&quot;, &quot;hello world&quot;);
389      for (int i = 0; i &lt; 100; i++) {
390        addDocument(String.format(&quot;doc%d&quot;, i), fields);
391      }
392      SearchResult res = client.ftSearch(index, &quot;hello world&quot;);
393      assertEquals(100, res.getTotalResults());
394      assertEquals(&quot;OK&quot;, client.ftDropIndexDD(index));
395      Set&lt;String&gt; keys = client.keys(&quot;*&quot;);
396      assertTrue(keys.isEmpty());
397      assertEquals(0, client.dbSize());
398    }
399    @Test
400    public void noStem() {
401      assertOK(client.ftCreate(index, new TextField(&quot;stemmed&quot;).weight(1.0),
402          new TextField(&quot;notStemmed&quot;).weight(1.0).noStem()));
403      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
404      doc.put(&quot;stemmed&quot;, &quot;located&quot;);
405      doc.put(&quot;notStemmed&quot;, &quot;located&quot;);
406      addDocument(&quot;doc&quot;, doc);
407      SearchResult res = client.ftSearch(index, &quot;@stemmed:location&quot;);
408      assertEquals(1, res.getTotalResults());
409      res = client.ftSearch(index, &quot;@notStemmed:location&quot;);
410      assertEquals(0, res.getTotalResults());
411    }
412    @Test
413    public void phoneticMatch() {
414      assertOK(client.ftCreate(index, new TextField(&quot;noPhonetic&quot;).weight(1.0),
415          new TextField(&quot;withPhonetic&quot;).weight(1.0).phonetic(&quot;dm:en&quot;)));
416      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
417      doc.put(&quot;noPhonetic&quot;, &quot;morfix&quot;);
418      doc.put(&quot;withPhonetic&quot;, &quot;morfix&quot;);
419      addDocument(&quot;doc&quot;, doc);
420      SearchResult res = client.ftSearch(index, &quot;@withPhonetic:morphix=&gt;{$phonetic:true}&quot;);
421      assertEquals(1, res.getTotalResults());
422      try {
423        client.ftSearch(index, &quot;@noPhonetic:morphix=&gt;{$phonetic:true}&quot;);
424        fail();
425      } catch (JedisDataException e) {&amp;bsol;*field does not support phonetics*/
426      }
427      SearchResult res3 = client.ftSearch(index, &quot;@withPhonetic:morphix=&gt;{$phonetic:false}&quot;);
428      assertEquals(0, res3.getTotalResults());
429    }
430    @Test
431    public void info() {
432      Collection&lt;SchemaField&gt; sc = new ArrayList&lt;&gt;();
433      sc.add(TextField.of(&quot;title&quot;).weight(5));
434      sc.add(TextField.of(&quot;plot&quot;).sortable());
435      sc.add(TagField.of(&quot;genre&quot;).separator(&#x27;,&#x27;).sortable());
436      sc.add(NumericField.of(&quot;release_year&quot;).sortable());
437      sc.add(NumericField.of(&quot;rating&quot;).sortable());
438      sc.add(NumericField.of(&quot;votes&quot;).sortable());
439      assertOK(client.ftCreate(index, sc));
440      Map&lt;String, Object&gt; info = client.ftInfo(index);
441      assertEquals(index, info.get(&quot;index_name&quot;));
442      assertEquals(6, ((List) info.get(&quot;attributes&quot;)).size());
443      assertEquals(&quot;global_idle&quot;, ((List) info.get(&quot;cursor_stats&quot;)).get(0));
444      assertEquals(0L, ((List) info.get(&quot;cursor_stats&quot;)).get(1));
445    }
446    @Test
447    public void noIndexAndSortBy() {
448      assertOK(client.ftCreate(index, TextField.of(&quot;f1&quot;).sortable().noIndex(), TextField.of(&quot;f2&quot;)));
449      Map&lt;String, Object&gt; mm = new HashMap&lt;&gt;();
450      mm.put(&quot;f1&quot;, &quot;MarkZZ&quot;);
451      mm.put(&quot;f2&quot;, &quot;MarkZZ&quot;);
452      addDocument(&quot;doc1&quot;, mm);
453      mm.clear();
454      mm.put(&quot;f1&quot;, &quot;MarkAA&quot;);
455      mm.put(&quot;f2&quot;, &quot;MarkBB&quot;);
456      addDocument(&quot;doc2&quot;, mm);
457      SearchResult res = client.ftSearch(index, &quot;@f1:Mark*&quot;);
458      assertEquals(0, res.getTotalResults());
459      res = client.ftSearch(index, &quot;@f2:Mark*&quot;);
460      assertEquals(2, res.getTotalResults());
461      res = client.ftSearch(index, &quot;@f2:Mark*&quot;,
462          FTSearchParams.searchParams().sortBy(&quot;f1&quot;, SortingOrder.DESC));
463      assertEquals(2, res.getTotalResults());
464      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
465      res = client.ftSearch(index, &quot;@f2:Mark*&quot;,
466          FTSearchParams.searchParams().sortBy(&quot;f1&quot;, SortingOrder.ASC));
467      assertEquals(&quot;doc2&quot;, res.getDocuments().get(0).getId());
468    }
469    @Test
470    public void testHighlightSummarize() {
471      assertOK(client.ftCreate(index, TextField.of(&quot;text&quot;).weight(1)));
472      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
473      doc.put(&quot;text&quot;, &quot;Redis is often referred as a data structures server. What this means is that &quot;
474          + &quot;Redis provides access to mutable data structures via a set of commands, which are sent &quot;
475          + &quot;using a server-client model with TCP sockets and a simple protocol. So different &quot;
476          + &quot;processes can query and modify the same data structures in a shared way&quot;);
477      addDocument(&quot;foo&quot;, doc);
478      SearchResult res = client.ftSearch(index, &quot;data&quot;, FTSearchParams.searchParams().highlight().summarize());
479      assertEquals(&quot;is often referred as a &lt;b&gt;data&lt;/b&gt; structures server. What this means is that &quot;
480          + &quot;Redis provides... What this means is that Redis provides access to mutable &lt;b&gt;data&lt;/b&gt; &quot;
481          + &quot;structures via a set of commands, which are sent using a... So different processes can &quot;
482          + &quot;query and modify the same &lt;b&gt;data&lt;/b&gt; structures in a shared... &quot;,
483          res.getDocuments().get(0).get(&quot;text&quot;));
484      res = client.ftSearch(index, &quot;data&quot;, FTSearchParams.searchParams()
485          .highlight(FTSearchParams.highlightParams().tags(&quot;&lt;u&gt;&quot;, &quot;&lt;/u&gt;&quot;))
486          .summarize());
487      assertEquals(&quot;is often referred as a &lt;u&gt;data&lt;/u&gt; structures server. What this means is that &quot;
488          + &quot;Redis provides... What this means is that Redis provides access to mutable &lt;u&gt;data&lt;/u&gt; &quot;
489          + &quot;structures via a set of commands, which are sent using a... So different processes can &quot;
490          + &quot;query and modify the same &lt;u&gt;data&lt;/u&gt; structures in a shared... &quot;,
491          res.getDocuments().get(0).get(&quot;text&quot;));
492    }
493    @Test
494    public void getTagField() {
495      assertOK(client.ftCreate(index, TextField.of(&quot;title&quot;), TagField.of(&quot;category&quot;)));
496      Map&lt;String, Object&gt; fields1 = new HashMap&lt;&gt;();
497      fields1.put(&quot;title&quot;, &quot;hello world&quot;);
498      fields1.put(&quot;category&quot;, &quot;red&quot;);
499      addDocument(&quot;foo&quot;, fields1);
500      Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
501      fields2.put(&quot;title&quot;, &quot;hello world&quot;);
502      fields2.put(&quot;category&quot;, &quot;blue&quot;);
503      addDocument(&quot;bar&quot;, fields2);
504      Map&lt;String, Object&gt; fields3 = new HashMap&lt;&gt;();
505      fields3.put(&quot;title&quot;, &quot;hello world&quot;);
506      fields3.put(&quot;category&quot;, &quot;green,yellow&quot;);
507      addDocument(&quot;baz&quot;, fields3);
508      Map&lt;String, Object&gt; fields4 = new HashMap&lt;&gt;();
509      fields4.put(&quot;title&quot;, &quot;hello world&quot;);
510      fields4.put(&quot;category&quot;, &quot;orange;purple&quot;);
511      addDocument(&quot;qux&quot;, fields4);
512      assertEquals(1, client.ftSearch(index, &quot;@category:{red}&quot;).getTotalResults());
513      assertEquals(1, client.ftSearch(index, &quot;@category:{blue}&quot;).getTotalResults());
514      assertEquals(1, client.ftSearch(index, &quot;hello @category:{red}&quot;).getTotalResults());
515      assertEquals(1, client.ftSearch(index, &quot;hello @category:{blue}&quot;).getTotalResults());
516      assertEquals(1, client.ftSearch(index, &quot;@category:{yellow}&quot;).getTotalResults());
517      assertEquals(0, client.ftSearch(index, &quot;@category:{purple}&quot;).getTotalResults());
518      assertEquals(1, client.ftSearch(index, &quot;@category:{orange\\;purple}&quot;).getTotalResults());
519      assertEquals(4, client.ftSearch(index, &quot;hello&quot;).getTotalResults());
520      assertEquals(new HashSet&lt;&gt;(Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;orange;purple&quot;)),
521          client.ftTagVals(index, &quot;category&quot;));
522    }
523    @Test
524    public void testGetTagFieldWithNonDefaultSeparator() {
525      assertOK(client.ftCreate(index,
526          TextField.of(&quot;title&quot;),
527          TagField.of(&quot;category&quot;).separator(&#x27;;&#x27;)));
528      Map&lt;String, Object&gt; fields1 = new HashMap&lt;&gt;();
529      fields1.put(&quot;title&quot;, &quot;hello world&quot;);
530      fields1.put(&quot;category&quot;, &quot;red&quot;);
531      addDocument(&quot;foo&quot;, fields1);
532      Map&lt;String, Object&gt; fields2 = new HashMap&lt;&gt;();
533      fields2.put(&quot;title&quot;, &quot;hello world&quot;);
534      fields2.put(&quot;category&quot;, &quot;blue&quot;);
535      addDocument(&quot;bar&quot;, fields2);
536      Map&lt;String, Object&gt; fields3 = new HashMap&lt;&gt;();
537      fields3.put(&quot;title&quot;, &quot;hello world&quot;);
538      fields3.put(&quot;category&quot;, &quot;green;yellow&quot;);
539      addDocument(&quot;baz&quot;, fields3);
540      Map&lt;String, Object&gt; fields4 = new HashMap&lt;&gt;();
541      fields4.put(&quot;title&quot;, &quot;hello world&quot;);
542      fields4.put(&quot;category&quot;, &quot;orange,purple&quot;);
543      addDocument(&quot;qux&quot;, fields4);
544      assertEquals(1, client.ftSearch(index, &quot;@category:{red}&quot;).getTotalResults());
545      assertEquals(1, client.ftSearch(index, &quot;@category:{blue}&quot;).getTotalResults());
546      assertEquals(1, client.ftSearch(index, &quot;hello @category:{red}&quot;).getTotalResults());
547      assertEquals(1, client.ftSearch(index, &quot;hello @category:{blue}&quot;).getTotalResults());
548      assertEquals(1, client.ftSearch(index, &quot;hello @category:{yellow}&quot;).getTotalResults());
549      assertEquals(0, client.ftSearch(index, &quot;@category:{purple}&quot;).getTotalResults());
550      assertEquals(1, client.ftSearch(index, &quot;@category:{orange\\,purple}&quot;).getTotalResults());
551      assertEquals(4, client.ftSearch(index, &quot;hello&quot;).getTotalResults());
552      assertEquals(new HashSet&lt;&gt;(Arrays.asList(&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;orange,purple&quot;)),
553          client.ftTagVals(index, &quot;category&quot;));
554    }
555    @Test
556    public void caseSensitiveTagField() {
557      assertOK(client.ftCreate(index,
558          TextField.of(&quot;title&quot;),
559          TagField.of(&quot;category&quot;).caseSensitive()));
560      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
561      fields.put(&quot;title&quot;, &quot;hello world&quot;);
562      fields.put(&quot;category&quot;, &quot;RedX&quot;);
563      addDocument(&quot;foo&quot;, fields);
564      assertEquals(0, client.ftSearch(index, &quot;@category:{redx}&quot;).getTotalResults());
565      assertEquals(0, client.ftSearch(index, &quot;@category:{redX}&quot;).getTotalResults());
566      assertEquals(0, client.ftSearch(index, &quot;@category:{Redx}&quot;).getTotalResults());
567      assertEquals(1, client.ftSearch(index, &quot;@category:{RedX}&quot;).getTotalResults());
568      assertEquals(1, client.ftSearch(index, &quot;hello&quot;).getTotalResults());
569    }
570    @Test
571    public void testReturnFields() {
572      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
573      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
574      doc.put(&quot;field1&quot;, &quot;value1&quot;);
575      doc.put(&quot;field2&quot;, &quot;value2&quot;);
576      addDocument(&quot;doc&quot;, doc);
577      SearchResult res = client.ftSearch(index, &quot;*&quot;,
578          FTSearchParams.searchParams().returnFields(&quot;field1&quot;));
579      assertEquals(1, res.getTotalResults());
580      Document ret = res.getDocuments().get(0);
581      assertEquals(&quot;value1&quot;, ret.get(&quot;field1&quot;));
582      assertNull(ret.get(&quot;field2&quot;));
583    }
584    @Test
585    public void returnWithFieldNames() {
586      assertOK(client.ftCreate(index, TextField.of(&quot;a&quot;), TextField.of(&quot;b&quot;), TextField.of(&quot;c&quot;)));
587      Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
588      map.put(&quot;a&quot;, &quot;value1&quot;);
589      map.put(&quot;b&quot;, &quot;value2&quot;);
590      map.put(&quot;c&quot;, &quot;value3&quot;);
591      addDocument(&quot;doc&quot;, map);
592      SearchResult res = client.ftSearch(index, &quot;*&quot;,
593          FTSearchParams.searchParams().returnFields(
594              FieldName.of(&quot;a&quot;), FieldName.of(&quot;b&quot;).as(&quot;d&quot;)));
595      assertEquals(1, res.getTotalResults());
596      Document doc = res.getDocuments().get(0);
597      assertEquals(&quot;value1&quot;, doc.get(&quot;a&quot;));
598      assertNull(doc.get(&quot;b&quot;));
599      assertEquals(&quot;value2&quot;, doc.get(&quot;d&quot;));
600      assertNull(doc.get(&quot;c&quot;));
601    }
602    @Test
603    public void inKeys() {
604      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
605      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
606      doc.put(&quot;field1&quot;, &quot;value&quot;);
607      doc.put(&quot;field2&quot;, &quot;not&quot;);
608      addDocument(&quot;doc1&quot;, doc);
609      addDocument(&quot;doc2&quot;, doc);
610      SearchResult res = client.ftSearch(index, &quot;value&quot;,
611          FTSearchParams.searchParams().inKeys(&quot;doc1&quot;));
612      assertEquals(1, res.getTotalResults());
613      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
614      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
615      assertEquals(null, res.getDocuments().get(0).get(&quot;value&quot;));
616    }
617    @Test
618    public void alias() {
619      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;)));
620      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
621      doc.put(&quot;field1&quot;, &quot;value&quot;);
622      addDocument(&quot;doc1&quot;, doc);
623      assertEquals(&quot;OK&quot;, client.ftAliasAdd(&quot;ALIAS1&quot;, index));
624      SearchResult res1 = client.ftSearch(&quot;ALIAS1&quot;, &quot;*&quot;,
625          FTSearchParams.searchParams().returnFields(&quot;field1&quot;));
626      assertEquals(1, res1.getTotalResults());
627      assertEquals(&quot;value&quot;, res1.getDocuments().get(0).get(&quot;field1&quot;));
628      assertEquals(&quot;OK&quot;, client.ftAliasUpdate(&quot;ALIAS2&quot;, index));
629      SearchResult res2 = client.ftSearch(&quot;ALIAS2&quot;, &quot;*&quot;,
630          FTSearchParams.searchParams().returnFields(&quot;field1&quot;));
631      assertEquals(1, res2.getTotalResults());
632      assertEquals(&quot;value&quot;, res2.getDocuments().get(0).get(&quot;field1&quot;));
633      try {
634        client.ftAliasDel(&quot;ALIAS3&quot;);
635        fail(&quot;Should throw JedisDataException&quot;);
636      } catch (JedisDataException e) {
637      }
638      assertEquals(&quot;OK&quot;, client.ftAliasDel(&quot;ALIAS2&quot;));
639      try {
640        client.ftAliasDel(&quot;ALIAS2&quot;);
641        fail(&quot;Should throw JedisDataException&quot;);
642      } catch (JedisDataException e) {
643      }
644    }
645    @Test
646    public void synonym() {
647      assertOK(client.ftCreate(index, TextField.of(&quot;name&quot;).weight(1), TextField.of(&quot;addr&quot;).weight(1)));
648      long group1 = 345L;
649      long group2 = 789L;
650      String group1_str = Long.toString(group1);
651      String group2_str = Long.toString(group2);
652      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group1_str, &quot;girl&quot;, &quot;baby&quot;));
653      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group1_str, &quot;child&quot;));
654      assertEquals(&quot;OK&quot;, client.ftSynUpdate(index, group2_str, &quot;child&quot;));
655      Map&lt;String, List&lt;String&gt;&gt; dump = client.ftSynDump(index);
656      Map&lt;String, List&lt;String&gt;&gt; expected = new HashMap&lt;&gt;();
657      expected.put(&quot;girl&quot;, Arrays.asList(group1_str));
658      expected.put(&quot;baby&quot;, Arrays.asList(group1_str));
659      expected.put(&quot;child&quot;, Arrays.asList(group1_str, group2_str));
660      assertEquals(expected, dump);
661    }
662    @Test
663    public void slop() {
664      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
665      Map&lt;String, Object&gt; doc = new HashMap&lt;&gt;();
666      doc.put(&quot;field1&quot;, &quot;ok hi jedis&quot;);
667      addDocument(&quot;doc1&quot;, doc);
668      SearchResult res = client.ftSearch(index, &quot;ok jedis&quot;, FTSearchParams.searchParams().slop(0));
669      assertEquals(0, res.getTotalResults());
670      res = client.ftSearch(index, &quot;ok jedis&quot;, FTSearchParams.searchParams().slop(1));
671      assertEquals(1, res.getTotalResults());
672      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
673      assertEquals(&quot;ok hi jedis&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
674    }
675    @Test
676    public void timeout() {
677      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
678      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
679      map.put(&quot;field1&quot;, &quot;value&quot;);
680      map.put(&quot;field2&quot;, &quot;not&quot;);
681      client.hset(&quot;doc1&quot;, map);
682      SearchResult res = client.ftSearch(index, &quot;value&quot;, FTSearchParams.searchParams().timeout(1000));
683      assertEquals(1, res.getTotalResults());
684      assertEquals(&quot;doc1&quot;, res.getDocuments().get(0).getId());
685      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
686      assertEquals(&quot;not&quot;, res.getDocuments().get(0).get(&quot;field2&quot;));
687    }
688    @Test
689    public void inOrder() {
690      assertOK(client.ftCreate(index, TextField.of(&quot;field1&quot;), TextField.of(&quot;field2&quot;)));
691      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
692      map.put(&quot;field1&quot;, &quot;value&quot;);
693      map.put(&quot;field2&quot;, &quot;not&quot;);
694      client.hset(&quot;doc2&quot;, map);
695      client.hset(&quot;doc1&quot;, map);
696      SearchResult res = client.ftSearch(index, &quot;value&quot;, FTSearchParams.searchParams().inOrder());
697      assertEquals(2, res.getTotalResults());
698      assertEquals(&quot;doc2&quot;, res.getDocuments().get(0).getId());
699      assertEquals(&quot;value&quot;, res.getDocuments().get(0).get(&quot;field1&quot;));
700      assertEquals(&quot;not&quot;, res.getDocuments().get(0).get(&quot;field2&quot;));
701    }
702    @Test
703    public void testHNSWVVectorSimilarity() {
704      Map&lt;String, Object&gt; attr = new HashMap&lt;&gt;();
705      attr.put(&quot;TYPE&quot;, &quot;FLOAT32&quot;);
706      attr.put(&quot;DIM&quot;, 2);
707      attr.put(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;);
708      assertOK(client.ftCreate(index, VectorField.builder().fieldName(&quot;v&quot;)
709          .algorithm(VectorField.VectorAlgorithm.HNSW).attributes(attr).build()));
710      client.hset(&quot;a&quot;, &quot;v&quot;, &quot;aaaaaaaa&quot;);
711      client.hset(&quot;b&quot;, &quot;v&quot;, &quot;aaaabaaa&quot;);
712      client.hset(&quot;c&quot;, &quot;v&quot;, &quot;aaaaabaa&quot;);
713      FTSearchParams searchParams = FTSearchParams.searchParams()
714          .addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
715          .sortBy(&quot;__v_score&quot;, SortingOrder.ASC)
716          .returnFields(&quot;__v_score&quot;)
717          .dialect(2);
718      Document doc1 = client.ftSearch(index, &quot;*=&gt;[KNN 2 @v $vec]&quot;, searchParams).getDocuments().get(0);
719      assertEquals(&quot;a&quot;, doc1.getId());
720      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
721    }
722    @Test
723    public void testFlatVectorSimilarity() {
724      assertOK(client.ftCreate(index,
725          VectorField.builder().fieldName(&quot;v&quot;)
726              .algorithm(VectorField.VectorAlgorithm.FLAT)
727              .addAttribute(&quot;TYPE&quot;, &quot;FLOAT32&quot;)
728              .addAttribute(&quot;DIM&quot;, 2)
729              .addAttribute(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;)
730              .build()
731      ));
732      client.hset(&quot;a&quot;, &quot;v&quot;, &quot;aaaaaaaa&quot;);
733      client.hset(&quot;b&quot;, &quot;v&quot;, &quot;aaaabaaa&quot;);
734      client.hset(&quot;c&quot;, &quot;v&quot;, &quot;aaaaabaa&quot;);
735      FTSearchParams searchParams = FTSearchParams.searchParams()
736          .addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
737          .sortBy(&quot;__v_score&quot;, SortingOrder.ASC)
738          .returnFields(&quot;__v_score&quot;)
739          .dialect(2);
740      Document doc1 = client.ftSearch(index, &quot;*=&gt;[KNN 2 @v $vec]&quot;, searchParams).getDocuments().get(0);
741      assertEquals(&quot;a&quot;, doc1.getId());
742      assertEquals(&quot;0&quot;, doc1.get(&quot;__v_score&quot;));
743    }
744    @Test
745    public void searchProfile() {
746      assertOK(client.ftCreate(index, TextField.of(&quot;t1&quot;), TextField.of(&quot;t2&quot;)));
747      Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
748      map.put(&quot;t1&quot;, &quot;foo&quot;);
749      map.put(&quot;t2&quot;, &quot;bar&quot;);
750      client.hset(&quot;doc1&quot;, map);
751      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
752          FTProfileParams.profileParams(), &quot;foo&quot;, FTSearchParams.searchParams());
753      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
754      assertEquals(&quot;TEXT&quot;, iteratorsProfile.get(&quot;Type&quot;));
755      assertEquals(&quot;foo&quot;, iteratorsProfile.get(&quot;Term&quot;));
756      assertEquals(1L, iteratorsProfile.get(&quot;Counter&quot;));
757      assertEquals(1L, iteratorsProfile.get(&quot;Size&quot;));
758      assertSame(Double.class, iteratorsProfile.get(&quot;Time&quot;).getClass());
759    }
760    @Test
761    public void vectorSearchProfile() {
762      assertOK(client.ftCreate(index, VectorField.builder().fieldName(&quot;v&quot;)
763          .algorithm(VectorAlgorithm.FLAT).addAttribute(&quot;TYPE&quot;, &quot;FLOAT32&quot;)
764          .addAttribute(&quot;DIM&quot;, 2).addAttribute(&quot;DISTANCE_METRIC&quot;, &quot;L2&quot;).build(),
765          TextField.of(&quot;t&quot;)));
766      client.hset(&quot;1&quot;, toMap(&quot;v&quot;, &quot;bababaca&quot;, &quot;t&quot;, &quot;hello&quot;));
767      client.hset(&quot;2&quot;, toMap(&quot;v&quot;, &quot;babababa&quot;, &quot;t&quot;, &quot;hello&quot;));
768      client.hset(&quot;3&quot;, toMap(&quot;v&quot;, &quot;aabbaabb&quot;, &quot;t&quot;, &quot;hello&quot;));
769      client.hset(&quot;4&quot;, toMap(&quot;v&quot;, &quot;bbaabbaa&quot;, &quot;t&quot;, &quot;hello world&quot;));
770      client.hset(&quot;5&quot;, toMap(&quot;v&quot;, &quot;aaaabbbb&quot;, &quot;t&quot;, &quot;hello world&quot;));
771      FTSearchParams searchParams = FTSearchParams.searchParams().addParam(&quot;vec&quot;, &quot;aaaaaaaa&quot;)
772          .sortBy(&quot;__v_score&quot;, SortingOrder.ASC).noContent().dialect(2);
773      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
774          FTProfileParams.profileParams(), &quot;*=&gt;[KNN 3 @v $vec]&quot;, searchParams);
775      assertEquals(3, profile.getKey().getTotalResults());
776      assertEquals(Arrays.asList(4, 2, 1).toString(), profile.getKey().getDocuments()
777          .stream().map(Document::getId).collect(Collectors.toList()).toString());
778      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
779      assertEquals(&quot;VECTOR&quot;, iteratorsProfile.get(&quot;Type&quot;));
780      assertEquals(3L, iteratorsProfile.get(&quot;Counter&quot;));
781      List&lt;Map&lt;String, Object&gt;&gt; resultProcessorsProfile = (List&lt;Map&lt;String, Object&gt;&gt;) profile.getValue().get(&quot;Result processors profile&quot;);
782      assertEquals(3l, resultProcessorsProfile.get(1).get(&quot;Counter&quot;));
783    }
784    @Test
785    public void maxPrefixExpansionSearchProfile() {
786      final String configParam = &quot;MAXPREFIXEXPANSIONS&quot;;
787      String configValue = client.ftConfigGet(configParam).get(configParam);
788      client.ftConfigSet(configParam, &quot;2&quot;);
789      assertOK(client.ftCreate(index, TextField.of(&quot;t&quot;)));
790      client.hset(&quot;1&quot;, Collections.singletonMap(&quot;t&quot;, &quot;foo1&quot;));
791      client.hset(&quot;2&quot;, Collections.singletonMap(&quot;t&quot;, &quot;foo2&quot;));
792      client.hset(&quot;3&quot;, Collections.singletonMap(&quot;t&quot;, &quot;foo3&quot;));
793      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
794          FTProfileParams.profileParams(), &quot;foo*&quot;, FTSearchParams.searchParams().limit(0, 0));
795      Map&lt;String, Object&gt; iteratorsProfile = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
796      assertEquals(&quot;Max prefix expansion reached&quot;, iteratorsProfile.get(&quot;Warning&quot;));
797      client.ftConfigSet(configParam, configValue);
798    }
799    @Test
800    public void notIteratorSearchProfile() {
801      assertOK(client.ftCreate(index, TextField.of(&quot;t&quot;)));
802      client.hset(&quot;1&quot;, Collections.singletonMap(&quot;t&quot;, &quot;foo&quot;));
803      client.hset(&quot;2&quot;, Collections.singletonMap(&quot;t&quot;, &quot;bar&quot;));
804      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
805          FTProfileParams.profileParams(), &quot;foo -@t:baz&quot;, FTSearchParams.searchParams().noContent());
806      Map&lt;String, Object&gt; depth0 = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
807      assertEquals(&quot;INTERSECT&quot;, depth0.get(&quot;Type&quot;));
808      List&lt;Map&lt;String, Object&gt;&gt; depth0_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth0.get(&quot;Child iterators&quot;);
809      assertEquals(&quot;TEXT&quot;, depth0_children.get(0).get(&quot;Type&quot;));
810      Map&lt;String, Object&gt; depth1 = depth0_children.get(1);
811      assertEquals(&quot;NOT&quot;, depth1.get(&quot;Type&quot;));
812      List&lt;Map&lt;String, Object&gt;&gt; depth1_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth1.get(&quot;Child iterators&quot;);
813      assertEquals(1, depth1_children.size());
814      assertEquals(&quot;EMPTY&quot;, depth1_children.get(0).get(&quot;Type&quot;));
815    }
816    @Test
817    public void deepReplySearchProfile() {
818      assertOK(client.ftCreate(index, TextField.of(&quot;t&quot;)));
819      client.hset(&quot;1&quot;, Collections.singletonMap(&quot;t&quot;, &quot;hello&quot;));
820      client.hset(&quot;2&quot;, Collections.singletonMap(&quot;t&quot;, &quot;world&quot;));
821      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile
822          = client.ftProfileSearch(index, FTProfileParams.profileParams(),
823              &quot;hello(hello(hello(hello(hello(hello)))))&quot;, FTSearchParams.searchParams().noContent());
824      Map&lt;String, Object&gt; depth0 = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
825      assertEquals(&quot;INTERSECT&quot;, depth0.get(&quot;Type&quot;));
826      List&lt;Map&lt;String, Object&gt;&gt; depth0_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth0.get(&quot;Child iterators&quot;);
827      assertEquals(&quot;TEXT&quot;, depth0_children.get(0).get(&quot;Type&quot;));
828      Map&lt;String, Object&gt; depth1 = depth0_children.get(1);
829      assertEquals(&quot;INTERSECT&quot;, depth1.get(&quot;Type&quot;));
830      List&lt;Map&lt;String, Object&gt;&gt; depth1_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth1.get(&quot;Child iterators&quot;);
831      assertEquals(&quot;TEXT&quot;, depth1_children.get(0).get(&quot;Type&quot;));
832      Map&lt;String, Object&gt; depth2 = depth1_children.get(1);
833      assertEquals(&quot;INTERSECT&quot;, depth2.get(&quot;Type&quot;));
834      List&lt;Map&lt;String, Object&gt;&gt; depth2_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth2.get(&quot;Child iterators&quot;);
835      assertEquals(&quot;TEXT&quot;, depth2_children.get(0).get(&quot;Type&quot;));
836      Map&lt;String, Object&gt; depth3 = depth2_children.get(1);
837      assertEquals(&quot;INTERSECT&quot;, depth3.get(&quot;Type&quot;));
838      List&lt;Map&lt;String, Object&gt;&gt; depth3_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth3.get(&quot;Child iterators&quot;);
839      assertEquals(&quot;TEXT&quot;, depth3_children.get(0).get(&quot;Type&quot;));
840      Map&lt;String, Object&gt; depth4 = depth3_children.get(1);
841      assertEquals(&quot;INTERSECT&quot;, depth4.get(&quot;Type&quot;));
842      List&lt;Map&lt;String, Object&gt;&gt; depth4_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth4.get(&quot;Child iterators&quot;);
843      assertEquals(&quot;TEXT&quot;, depth4_children.get(0).get(&quot;Type&quot;));
844      Map&lt;String, Object&gt; depth5 = depth4_children.get(1);
845      assertEquals(&quot;TEXT&quot;, depth5.get(&quot;Type&quot;));
846      assertNull(depth5.get(&quot;Child iterators&quot;));
847    }
848    @Test
849    public void limitedSearchProfile() {
850      assertOK(client.ftCreate(index, TextField.of(&quot;t&quot;)));
851      client.hset(&quot;1&quot;, Collections.singletonMap(&quot;t&quot;, &quot;hello&quot;));
852      client.hset(&quot;2&quot;, Collections.singletonMap(&quot;t&quot;, &quot;hell&quot;));
853      client.hset(&quot;3&quot;, Collections.singletonMap(&quot;t&quot;, &quot;help&quot;));
854      client.hset(&quot;4&quot;, Collections.singletonMap(&quot;t&quot;, &quot;helowa&quot;));
855      Map.Entry&lt;SearchResult, Map&lt;String, Object&gt;&gt; profile = client.ftProfileSearch(index,
856          FTProfileParams.profileParams().limited(), &quot;%hell% hel*&quot;, FTSearchParams.searchParams().noContent());
857      Map&lt;String, Object&gt; depth0 = (Map&lt;String, Object&gt;) profile.getValue().get(&quot;Iterators profile&quot;);
858      assertEquals(&quot;INTERSECT&quot;, depth0.get(&quot;Type&quot;));
859      assertEquals(3L, depth0.get(&quot;Counter&quot;));
860      List&lt;Map&lt;String, Object&gt;&gt; depth0_children = (List&lt;Map&lt;String, Object&gt;&gt;) depth0.get(&quot;Child iterators&quot;);
861      assertFalse(depth0_children.isEmpty());
862      for (Map&lt;String, Object&gt; depth1 : depth0_children) {
863        assertEquals(&quot;UNION&quot;, depth1.get(&quot;Type&quot;));
864        assertNotNull(depth1.get(&quot;Query type&quot;));
865        List depth1_children = (List) depth1.get(&quot;Child iterators&quot;);
866        assertEquals(1, depth1_children.size());
867        assertSame(String.class, depth1_children.get(0).getClass());
868      }
869    }
870    @Test
871    public void list() {
872      assertEquals(Collections.emptyList(), client.ftList());
873      final int count = 20;
874      Set&lt;String&gt; names = new HashSet&lt;&gt;();
875      for (int i = 0; i &lt; count; i++) {
876        final String name = &quot;idx&quot; + i;
877        assertOK(client.ftCreate(name, TextField.of(&quot;t&quot; + i)));
878        names.add(name);
879      }
880      assertEquals(names, new HashSet&lt;&gt;(client.ftList()));
881    }
882    @Test
883    public void broadcast() {
884      String reply = client.ftCreate(index, TextField.of(&quot;t&quot;));
885      assertOK(reply);
886    }
887    @Test
888    public void searchIteration() {
889      assertOK(client.ftCreate(index, FTCreateParams.createParams(),
890          TextField.of(&quot;first&quot;), TextField.of(&quot;last&quot;), NumericField.of(&quot;age&quot;)));
891      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
892      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
893      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
894      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
895      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
896      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
897      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
898      FtSearchIteration search = client.ftSearchIteration(3, index, &quot;*&quot;, FTSearchParams.searchParams());
899      int total = 0;
900      while (!search.isIterationCompleted()) {
901        SearchResult result = search.nextBatch();
902        int count = result.getDocuments().size();
903        assertThat(count, Matchers.lessThanOrEqualTo(3));
904        total += count;
905      }
906      assertEquals(7, total);
907    }
908    @Test
909    public void searchIterationCollect() {
910      assertOK(client.ftCreate(index, FTCreateParams.createParams(),
911          TextField.of(&quot;first&quot;), TextField.of(&quot;last&quot;), NumericField.of(&quot;age&quot;)));
912      client.hset(&quot;profesor:5555&quot;, toMap(&quot;first&quot;, &quot;Albert&quot;, &quot;last&quot;, &quot;Blue&quot;, &quot;age&quot;, &quot;55&quot;));
913      client.hset(&quot;student:1111&quot;, toMap(&quot;first&quot;, &quot;Joe&quot;, &quot;last&quot;, &quot;Dod&quot;, &quot;age&quot;, &quot;18&quot;));
914      client.hset(&quot;pupil:2222&quot;, toMap(&quot;first&quot;, &quot;Jen&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;14&quot;));
915      client.hset(&quot;student:3333&quot;, toMap(&quot;first&quot;, &quot;El&quot;, &quot;last&quot;, &quot;Mark&quot;, &quot;age&quot;, &quot;17&quot;));
916      client.hset(&quot;pupil:4444&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Shu&quot;, &quot;age&quot;, &quot;21&quot;));
917      client.hset(&quot;student:5555&quot;, toMap(&quot;first&quot;, &quot;Joen&quot;, &quot;last&quot;, &quot;Ko&quot;, &quot;age&quot;, &quot;20&quot;));
918      client.hset(&quot;teacher:6666&quot;, toMap(&quot;first&quot;, &quot;Pat&quot;, &quot;last&quot;, &quot;Rod&quot;, &quot;age&quot;, &quot;20&quot;));
919      ArrayList&lt;Document&gt; collect = new ArrayList&lt;&gt;();
920      client.ftSearchIteration(3, index, &quot;*&quot;, FTSearchParams.searchParams()).collect(collect);
921      assertEquals(7, collect.size());
922      assertEquals(Arrays.asList(&quot;profesor:5555&quot;, &quot;student:1111&quot;, &quot;pupil:2222&quot;, &quot;student:3333&quot;,
923          &quot;pupil:4444&quot;, &quot;student:5555&quot;, &quot;teacher:6666&quot;).stream().collect(Collectors.toSet()),
924          collect.stream().map(Document::getId).collect(Collectors.toSet()));
925    }
926  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SearchWithParamsTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SearchWithParamsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>214          TextField.of(&quot;title&quot;)));
215      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
216      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
217      addDocument(&quot;doc1&quot;, fields);
</pre></code></div>
                <div class="column column_space"><pre><code>227          TextField.of(&quot;title&quot;)));
228      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
229      fields.put(&quot;title&quot;, &quot;hello world foo bar&quot;);
230      fields.put(&quot;title&quot;, &quot;hello world foo bar to be or not to be&quot;);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    