
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 32, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-AnjoPermissionsHandler.java</h3>
            <pre><code>1  package org.anjocaido.groupmanager.permissions;
2  import java.util.ArrayList;
3  import java.util.Iterator;
4  import java.util.LinkedHashSet;
5  import java.util.LinkedList;
6  import java.util.List;
7  import java.util.Map;
8  import java.util.Set;
9  import org.anjocaido.groupmanager.GroupManager;
10  import org.anjocaido.groupmanager.data.Group;
11  import org.anjocaido.groupmanager.data.User;
12  import org.anjocaido.groupmanager.dataholder.WorldDataHolder;
13  import org.anjocaido.groupmanager.utils.PermissionCheckResult;
14  import org.bukkit.Bukkit;
15  import org.bukkit.entity.Player;
16  public class AnjoPermissionsHandler extends PermissionsReaderInterface {
17  	WorldDataHolder ph = null;
18  	public AnjoPermissionsHandler(WorldDataHolder holder) {
19  		ph = holder;
20  	}
21  	@Override
22  	public boolean has(Player player, String permission) {
23  		return permission(player, permission);
24  	}
25  	@Override
26  	public boolean permission(Player player, String permission) {
27  		return checkUserPermission(ph.getUser(player.getName()).updatePlayer(player), permission);
28  	}
29  	public boolean permission(String playerName, String permission) {
30  		return checkUserPermission(ph.getUser(playerName), permission);
31  	}
32  	@Override
33  	public String getGroup(String userName) {
34  		return ph.getUser(userName).getGroup().getName();
35  	}
36  	@Override
37  	public List&lt;String&gt; getAllPlayersPermissions(String userName) {
38  		List&lt;String&gt; perms = new ArrayList&lt;String&gt;();
39  		perms.addAll(getAllPlayersPermissions(userName, true));
40  		return perms;
41  	}
42  	@Override
43  	public Set&lt;String&gt; getAllPlayersPermissions(String userName, Boolean includeChildren) {
44  		Set&lt;String&gt; playerPermArray = new LinkedHashSet&lt;String&gt;();
45  		Set&lt;String&gt; overrides = new LinkedHashSet&lt;String&gt;();
46  		playerPermArray.addAll(populatePerms(ph.getUser(userName).getPermissionList(), includeChildren));
47  		ArrayList&lt;String&gt; alreadyProcessed = new ArrayList&lt;String&gt;();
48  		for (String group : getGroups(userName)) {
49  			if (!alreadyProcessed.contains(group)) {
50  				alreadyProcessed.add(group);
51  				Set&lt;String&gt; groupPermArray = new LinkedHashSet&lt;String&gt;();
52  				if (group.startsWith(&quot;g:&quot;) &amp;&amp; GroupManager.getGlobalGroups().hasGroup(group)) {
53  					groupPermArray = populatePerms(GroupManager.getGlobalGroups().getGroupsPermissions(group), includeChildren);
54  				} else {
55  					groupPermArray = populatePerms(ph.getGroup(group).getPermissionList(), includeChildren);
56  				}
57  				for (String perm : groupPermArray) {
58  					boolean negated = (perm.startsWith(&quot;-&quot;));
59  					if (perm.startsWith(&quot;+&quot;)) {
60  						overrides.add(perm.substring(1));
61  						continue;
62  					}
63  					if ((!negated &amp;&amp; !playerPermArray.contains(perm) &amp;&amp; !wildcardNegation(playerPermArray, perm)) || (negated &amp;&amp; !playerPermArray.contains(perm.substring(1)) &amp;&amp; !wildcardNegation(playerPermArray, perm.substring(1))))
64  						playerPermArray.add(perm);
65  				}
66  			}
67  		}
68  		Iterator&lt;String&gt; itr = overrides.iterator();
69  		while (itr.hasNext()) {
70  			String node = itr.next();
71  			if (playerPermArray.contains(&quot;-&quot; + node)) {
72  				playerPermArray.remove(&quot;-&quot; + node);
73  			}
74  			playerPermArray.add(node);
75  		}
76  		return playerPermArray;
77  	}
78  	private boolean wildcardNegation(Set&lt;String&gt; playerPermArray, String node) {
79  		if (playerPermArray.contains(&quot;-&quot; + node))
80  			return true;
81  		final String[] parts = node.split(&quot;\\.&quot;);
82  		final StringBuilder builder = new StringBuilder(node.length());
83  		for (String part : parts) {
84  			builder.append(&#x27;*&#x27;);
85  			if (playerPermArray.contains(&quot;-&quot; + builder.toString())) {
86  				GroupManager.logger.fine(&quot;Wildcard Negation found for &quot; + node);
87  				return true;
88  			}
89  			builder.deleteCharAt(builder.length() - 1);
90  			builder.append(part).append(&#x27;.&#x27;);
91  		}
92  		GroupManager.logger.fine(&quot;No Negation found for &quot; + node);
93  		return false;
94  	}
95  	private Set&lt;String&gt; populatePerms(List&lt;String&gt; permsList, boolean includeChildren) {
96  		List&lt;String&gt; perms = new ArrayList&lt;String&gt;(permsList);
97  		Set&lt;String&gt; permArray = new LinkedHashSet&lt;String&gt;();
98  		Boolean allPerms = false;
99  		if (perms.contains(&quot;*&quot;)) {
100  			permArray.addAll(GroupManager.BukkitPermissions.getAllRegisteredPermissions(includeChildren));
101  			allPerms = true;
102  			perms.remove(&quot;*&quot;);
103  			perms.remove(&quot;groupmanager.noofflineperms&quot;);
104  		}
105  		for (String perm : perms) {
106  			boolean negated = perm.startsWith(&quot;-&quot;);
107  			if (!permArray.contains(perm)) {
108  				permArray.add(perm);
109  				if ((negated) &amp;&amp; (permArray.contains(perm.substring(1))))
110  					permArray.remove(perm.substring(1));
111  				if ((includeChildren) || (negated &amp;&amp; allPerms)) {
112  					Map&lt;String, Boolean&gt; children = GroupManager.BukkitPermissions.getAllChildren((negated ? perm.substring(1) : perm), new LinkedHashSet&lt;String&gt;());
113  					if (children != null) {
114  						if (negated)
115  							if (allPerms) {
116  								for (String child : children.keySet())
117  									if (children.get(child))
118  										if (permArray.contains(child))
119  											permArray.remove(child);
120  							} else {
121  								for (String child : children.keySet())
122  									if (children.get(child))
123  										if ((!permArray.contains(child)) &amp;&amp; (!permArray.contains(&quot;-&quot; + child)))
124  											permArray.add(child);
125  							}
126  					}
127  				}
128  			}
129  		}
130  		return permArray;
131  	}
132  	@Override
133  	public boolean inGroup(String name, String group) {
134  		if (hasGroupInInheritance(ph.getUser(name).getGroup(), group)) {
135  			return true;
136  		}
137  		for (Group subGroup : ph.getUser(name).subGroupListCopy()) {
138  			if (hasGroupInInheritance(subGroup, group)) {
139  				return true;
140  			}
141  		}
142  		return false;
143  	}
144  	@Override
145  	public String getUserPrefix(String user) {
146  		String prefix = ph.getUser(user).getVariables().getVarString(&quot;prefix&quot;);
147  		if (prefix.length() != 0) {
148  			return prefix;
149  		}
150  		return getGroupPrefix(getGroup(user));
151  	}
152  	@Override
153  	public String getUserSuffix(String user) {
154  		String suffix = ph.getUser(user).getVariables().getVarString(&quot;suffix&quot;);
155  		if (suffix.length() != 0) {
156  			return suffix;
157  		}
158  		return getGroupSuffix(getGroup(user));
159  	}
160  	public String getPrimaryGroup(String user) {
161  		return getGroup(user);
162  	}
163  	public boolean canUserBuild(String userName) {
164  		return getPermissionBoolean(userName, &quot;build&quot;);
165  	}
166  	@Override
167  	public String getGroupPrefix(String groupName) {
168  		Group g = ph.getGroup(groupName);
169  		if (g == null) {
170  			return &quot;&quot;;
171  		}
172  		return g.getVariables().getVarString(&quot;prefix&quot;);
173  	}
174  	@Override
175  	public String getGroupSuffix(String groupName) {
176  		Group g = ph.getGroup(groupName);
177  		if (g == null) {
178  			return &quot;&quot;;
179  		}
180  		return g.getVariables().getVarString(&quot;suffix&quot;);
181  	}
182  	@Override
183  	public boolean canGroupBuild(String groupName) {
184  		Group g = ph.getGroup(groupName);
185  		if (g == null) {
186  			return false;
187  		}
188  		return g.getVariables().getVarBoolean(&quot;build&quot;);
189  	}
190  	@Override
191  	public String getGroupPermissionString(String groupName, String variable) {
192  		Group start = ph.getGroup(groupName);
193  		if (start == null) {
194  			return null;
195  		}
196  		Group result = nextGroupWithVariable(start, variable);
197  		if (result == null) {
198  			return null;
199  		}
200  		return result.getVariables().getVarString(variable);
201  	}
202  	@Override
203  	public int getGroupPermissionInteger(String groupName, String variable) {
204  		Group start = ph.getGroup(groupName);
205  		if (start == null) {
206  			return -1;
207  		}
208  		Group result = nextGroupWithVariable(start, variable);
209  		if (result == null) {
210  			return -1;
211  		}
212  		return result.getVariables().getVarInteger(variable);
213  	}
214  	@Override
215  	public boolean getGroupPermissionBoolean(String group, String variable) {
216  		Group start = ph.getGroup(group);
217  		if (start == null) {
218  			return false;
219  		}
220  		Group result = nextGroupWithVariable(start, variable);
221  		if (result == null) {
222  			return false;
223  		}
224  		return result.getVariables().getVarBoolean(variable);
225  	}
226  	@Override
227  	public double getGroupPermissionDouble(String group, String variable) {
228  		Group start = ph.getGroup(group);
229  		if (start == null) {
230  			return -1;
231  		}
232  		Group result = nextGroupWithVariable(start, variable);
233  		if (result == null) {
234  			return -1;
235  		}
236  		return result.getVariables().getVarDouble(variable);
237  	}
238  	@Override
239  	public String getUserPermissionString(String user, String variable) {
240  		User auser = ph.getUser(user);
241  		if (auser == null) {
242  			return &quot;&quot;;
243  		}
244  		return auser.getVariables().getVarString(variable);
245  	}
246  	@Override
247  	public int getUserPermissionInteger(String user, String variable) {
248  		User auser = ph.getUser(user);
249  		if (auser == null) {
250  			return -1;
251  		}
252  		return auser.getVariables().getVarInteger(variable);
253  	}
254  	@Override
255  	public boolean getUserPermissionBoolean(String user, String variable) {
256  		User auser = ph.getUser(user);
257  		if (auser == null) {
258  			return false;
259  		}
260  		return auser.getVariables().getVarBoolean(variable);
261  	}
262  	@Override
263  	public double getUserPermissionDouble(String user, String variable) {
264  		User auser = ph.getUser(user);
265  		if (auser == null) {
266  			return -1;
267  		}
268  		return auser.getVariables().getVarDouble(variable);
269  	}
270  	@Override
271  	public String getPermissionString(String user, String variable) {
272  		User auser = ph.getUser(user);
273  		if (auser == null) {
274  			return &quot;&quot;;
275  		}
276  		if (auser.getVariables().hasVar(variable)) {
277  			return auser.getVariables().getVarString(variable);
278  		}
279  		Group start = auser.getGroup();
280  		if (start == null) {
281  			return &quot;&quot;;
282  		}
283  		Group result = nextGroupWithVariable(start, variable);
284  		if (result == null) {
285  			if (!auser.isSubGroupsEmpty())
286  				for (Group subGroup : auser.subGroupListCopy()) {
287  					result = nextGroupWithVariable(subGroup, variable);
288  					if (result != null)
289  						continue;
290  				}
291  			if (result == null)
292  				return &quot;&quot;;
293  		}
294  		return result.getVariables().getVarString(variable);
295  	}
296  	@Override
297  	public int getPermissionInteger(String user, String variable) {
298  		User auser = ph.getUser(user);
299  		if (auser == null) {
300  			return -1;
301  		}
302  		if (auser.getVariables().hasVar(variable)) {
303  			return auser.getVariables().getVarInteger(variable);
304  		}
305  		Group start = auser.getGroup();
306  		if (start == null) {
307  			return -1;
308  		}
309  		Group result = nextGroupWithVariable(start, variable);
310  		if (result == null) {
311  			if (!auser.isSubGroupsEmpty())
312  				for (Group subGroup : auser.subGroupListCopy()) {
313  					result = nextGroupWithVariable(subGroup, variable);
314  					if (result != null)
315  						continue;
316  				}
317  			if (result == null)
318  				return -1;
319  		}
320  		return result.getVariables().getVarInteger(variable);
321  	}
322  	@Override
323  	public boolean getPermissionBoolean(String user, String variable) {
324  		User auser = ph.getUser(user);
325  		if (auser == null) {
326  			return false;
327  		}
328  		if (auser.getVariables().hasVar(variable)) {
329  			return auser.getVariables().getVarBoolean(variable);
330  		}
331  		Group start = auser.getGroup();
332  		if (start == null) {
333  			return false;
334  		}
335  		Group result = nextGroupWithVariable(start, variable);
336  		if (result == null) {
337  			if (!auser.isSubGroupsEmpty())
338  				for (Group subGroup : auser.subGroupListCopy()) {
339  					result = nextGroupWithVariable(subGroup, variable);
340  					if (result != null)
341  						continue;
342  				}
343  			if (result == null)
344  				return false;
345  		}
346  		return result.getVariables().getVarBoolean(variable);
347  	}
348  	@Override
349  	public double getPermissionDouble(String user, String variable) {
350  		User auser = ph.getUser(user);
351  		if (auser == null) {
352  			return -1.0D;
353  		}
354  		if (auser.getVariables().hasVar(variable)) {
355  			return auser.getVariables().getVarDouble(variable);
356  		}
357  		Group start = auser.getGroup();
358  		if (start == null) {
359  			return -1.0D;
360  		}
361  		Group result = nextGroupWithVariable(start, variable);
362  		if (result == null) {
363  			if (!auser.isSubGroupsEmpty())
364  				for (Group subGroup : auser.subGroupListCopy()) {
365  					result = nextGroupWithVariable(subGroup, variable);
366  					if (result != null)
367  						continue;
368  				}
369  			if (result == null)
370  				return -1.0D;
371  		}
372  		return result.getVariables().getVarDouble(variable);
373  	}
374  	public PermissionCheckResult checkUserOnlyPermission(User user, String permission) {
375  		user.sortPermissions();
376  		PermissionCheckResult result = new PermissionCheckResult();
377  		result.askedPermission = permission;
378  		result.owner = user;
379  		for (String access : user.getPermissionList()) {
380  			result.resultType = comparePermissionString(access, permission);
381  			if (result.resultType != PermissionCheckResult.Type.NOTFOUND) {
382  				result.accessLevel = access;
383  				return result;
384  			}
385  		}
386  		result.resultType = PermissionCheckResult.Type.NOTFOUND;
387  		return result;
388  	}
389  	public PermissionCheckResult checkGroupOnlyPermission(Group group, String permission) {
390  		group.sortPermissions();
391  		PermissionCheckResult result = new PermissionCheckResult();
392  		result.owner = group;
393  		result.askedPermission = permission;
394  		for (String access : group.getPermissionList()) {
395  			result.resultType = comparePermissionString(access, permission);
396  			if (result.resultType != PermissionCheckResult.Type.NOTFOUND) {
397  				result.accessLevel = access;
398  				return result;
399  			}
400  		}
401  		result.resultType = PermissionCheckResult.Type.NOTFOUND;
402  		return result;
403  	}
404  	public boolean checkUserPermission(User user, String permission) {
405  		PermissionCheckResult result = checkFullGMPermission(user, permission, true);
406  		if (result.resultType == PermissionCheckResult.Type.EXCEPTION || result.resultType == PermissionCheckResult.Type.FOUND) {
407  			return true;
408  		}
409  		return false;
410  	}
411  	public PermissionCheckResult checkFullUserPermission(User user, String targetPermission) {
412  		return checkFullGMPermission(user, targetPermission, true);
413  	}
414  	public PermissionCheckResult checkFullGMPermission(User user, String targetPermission, Boolean checkBukkit) {
415  		if (user == null || targetPermission == null || targetPermission.isEmpty()
416  				|| (!Bukkit.getServer().getOnlineMode()
417  				&amp;&amp; (checkPermission(user, &quot;groupmanager.noofflineperms&quot;, false).resultType == PermissionCheckResult.Type.FOUND))) {
418  			PermissionCheckResult result = new PermissionCheckResult();
419  			result.accessLevel = targetPermission;
420  			result.resultType = PermissionCheckResult.Type.NOTFOUND;
421  			return result;
422  		}
423  		return checkPermission(user, targetPermission, checkBukkit);
424  	}
425  	private PermissionCheckResult checkPermission(User user, String targetPermission, Boolean checkBukkit) {
426  		PermissionCheckResult result = new PermissionCheckResult();
427  		result.accessLevel = targetPermission;
428  		result.resultType = PermissionCheckResult.Type.NOTFOUND;
429  		if (checkBukkit) {
430  			final Player player = user.getBukkitPlayer();
431  			if ((player != null) &amp;&amp; player.hasPermission(targetPermission)) {
432  				result.resultType = PermissionCheckResult.Type.FOUND;
433  				result.owner = user;
434  				return result;
435  			}
436  		}
437  		PermissionCheckResult resultUser = checkUserOnlyPermission(user, targetPermission);
438  		if (resultUser.resultType != PermissionCheckResult.Type.NOTFOUND) {
439  			resultUser.accessLevel = targetPermission;
440  			if (resultUser.resultType == PermissionCheckResult.Type.EXCEPTION) {
441  				return resultUser;
442  			}
443  			result = resultUser;
444  		}
445  		PermissionCheckResult resultGroup = checkGroupPermissionWithInheritance(user.getGroup(), targetPermission);
446  		if (resultGroup.resultType != PermissionCheckResult.Type.NOTFOUND) {
447  			resultGroup.accessLevel = targetPermission;
448  			if (resultGroup.resultType == PermissionCheckResult.Type.EXCEPTION) {
449  				return resultGroup;
450  			}
451  			if (result.resultType == PermissionCheckResult.Type.NOTFOUND) {
452  				result = resultGroup;
453  			}
454  		}
455  		boolean negated = (result.resultType == PermissionCheckResult.Type.NEGATION);
456  		for (Group subGroup : user.subGroupListCopy()) {
457  			PermissionCheckResult resultSubGroup = checkGroupPermissionWithInheritance(subGroup, targetPermission);
458  			if (resultSubGroup.resultType != PermissionCheckResult.Type.NOTFOUND) {
459  				resultSubGroup.accessLevel = targetPermission;
460  				if (resultSubGroup.resultType == PermissionCheckResult.Type.EXCEPTION) {
461  					return resultSubGroup;
462  				} else if ((resultSubGroup.resultType == PermissionCheckResult.Type.FOUND) &amp;&amp; (result.resultType != PermissionCheckResult.Type.NEGATION) &amp;&amp; !negated) {
463  					result = resultSubGroup;
464  				} else if ((resultSubGroup.resultType == PermissionCheckResult.Type.NEGATION) &amp;&amp; !negated) {
465  					result = resultSubGroup;
466  				}
467  			}
468  		}
469  		return result;
470  	}
471  	public Group nextGroupWithVariable(Group start, String targetVariable) {
472  		if (start == null || targetVariable == null) {
473  			return null;
474  		}
475  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
476  		ArrayList&lt;Group&gt; alreadyVisited = new ArrayList&lt;Group&gt;();
477  		stack.push(start);
478  		alreadyVisited.add(start);
479  		while (!stack.isEmpty()) {
480  			Group now = stack.pop();
481  			if (now.getVariables().hasVar(targetVariable)) {
482  				return now;
483  			}
484  			for (String sonName : now.getInherits()) {
485  				Group son = ph.getGroup(sonName);
486  				if (son != null &amp;&amp; !alreadyVisited.contains(son)) {
487  					stack.push(son);
488  					alreadyVisited.add(son);
489  				}
490  			}
491  		}
492  		return null;
493  	}
494  	public boolean hasGroupInInheritance(Group start, String askedGroup) {
495  		if (start == null || askedGroup == null) {
496  			return false;
497  		}
498  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
499  		ArrayList&lt;Group&gt; alreadyVisited = new ArrayList&lt;Group&gt;();
500  		stack.push(start);
501  		alreadyVisited.add(start);
502  		while (!stack.isEmpty()) {
503  			Group now = stack.pop();
504  			if (now.getName().equalsIgnoreCase(askedGroup)) {
505  				return true;
506  			}
507  			for (String sonName : now.getInherits()) {
508  				Group son = ph.getGroup(sonName);
509  				if (son != null &amp;&amp; !alreadyVisited.contains(son)) {
510  					stack.push(son);
511  					alreadyVisited.add(son);
512  				}
513  			}
514  		}
515  		return false;
516  	}
517  	public PermissionCheckResult checkGroupPermissionWithInheritance(Group start, String targetPermission) {
518  		if (start == null || targetPermission == null) {
519  			return null;
520  		}
521  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
522  		List&lt;Group&gt; alreadyVisited = new ArrayList&lt;Group&gt;();
523  		PermissionCheckResult result = new PermissionCheckResult();
524  		stack.push(start);
525  		alreadyVisited.add(start);
526  		result.askedPermission = targetPermission;
527  		result.resultType = PermissionCheckResult.Type.NOTFOUND;
528  		while (!stack.isEmpty()) {
529  			Group now = stack.pop();
530  			PermissionCheckResult resultNow = checkGroupOnlyPermission(now, targetPermission);
531  			if (!resultNow.resultType.equals(PermissionCheckResult.Type.NOTFOUND)) {
532  				if (resultNow.resultType.equals(PermissionCheckResult.Type.EXCEPTION)) {
533  					resultNow.accessLevel = targetPermission;
534  					return resultNow;
535  				}
536  				result = resultNow;
537  			}
538  			for (String sonName : now.getInherits()) {
539  				Group son = ph.getGroup(sonName);
540  				if (son != null &amp;&amp; !alreadyVisited.contains(son)) {
541  					stack.add(son);
542  					alreadyVisited.add(son);
543  				}
544  			}
545  		}
546  		return result;
547  	}
548  	public ArrayList&lt;String&gt; listAllGroupsInherited(Group start) {
549  		if (start == null) {
550  			return null;
551  		}
552  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
553  		ArrayList&lt;String&gt; alreadyVisited = new ArrayList&lt;String&gt;();
554  		stack.push(start);
555  		alreadyVisited.add(start.getName());
556  		while (!stack.isEmpty()) {
557  			Group now = stack.pop();
558  			for (String sonName : now.getInherits()) {
559  				Group son = ph.getGroup(sonName);
560  				if (son != null &amp;&amp; !alreadyVisited.contains(son.getName())) {
561  					stack.push(son);
562  					alreadyVisited.add(son.getName());
563  				}
564  			}
565  		}
566  		return alreadyVisited;
567  	}
568  	public PermissionCheckResult.Type comparePermissionString(String userAccessLevel, String fullPermissionName) {
569  		int userAccessLevelLength;
570  		if (userAccessLevel == null || fullPermissionName == null || fullPermissionName.length() == 0 || (userAccessLevelLength = userAccessLevel.length()) == 0) {
571  			return PermissionCheckResult.Type.NOTFOUND;
572  		}
573  		PermissionCheckResult.Type result = PermissionCheckResult.Type.FOUND;
574  		int userAccessLevelOffset = 0;
575  		if (userAccessLevel.charAt(0) == &#x27;+&#x27;) {
576  			userAccessLevelOffset = 1;
577  			result = PermissionCheckResult.Type.EXCEPTION;
578  		} else if (userAccessLevel.charAt(0) == &#x27;-&#x27;) {
579  			userAccessLevelOffset = 1;
580  			result = PermissionCheckResult.Type.NEGATION;
581  		}
582  		if (fullPermissionName.equals(userAccessLevel)) {
583  			return result;
584  		}
585  		if (&quot;groupmanager.noofflineperms&quot;.equals(fullPermissionName)) {
586  			result = PermissionCheckResult.Type.NOTFOUND;
587  		}
588  		if (&quot;*&quot;.regionMatches(0, userAccessLevel, userAccessLevelOffset, userAccessLevelLength - userAccessLevelOffset)) {
589  			return result;
590  		}
591  		int fullPermissionNameOffset;
592  		if (fullPermissionName.charAt(0) == &#x27;+&#x27; || fullPermissionName.charAt(0) == &#x27;-&#x27;) {
593  			fullPermissionNameOffset = 1;
594  		} else {
595  			fullPermissionNameOffset = 0;
596  		}
597  		if (userAccessLevel.charAt(userAccessLevel.length() - 1) == &#x27;*&#x27;) {
598  			return userAccessLevel.regionMatches(true, userAccessLevelOffset, fullPermissionName, fullPermissionNameOffset, userAccessLevelLength - userAccessLevelOffset - 1) ? result : PermissionCheckResult.Type.NOTFOUND;
599  		} else {
600  			return userAccessLevel.regionMatches(true, userAccessLevelOffset, fullPermissionName, fullPermissionNameOffset, Math.max(userAccessLevelLength - userAccessLevelOffset, fullPermissionName.length() - fullPermissionNameOffset)) ? result : PermissionCheckResult.Type.NOTFOUND;
601  		}
602  	}
603  	@Override
604  	public String[] getGroups(String userName) {
605  		ArrayList&lt;String&gt; allGroups = listAllGroupsInherited(ph.getUser(userName).getGroup());
606  		for (Group subg : ph.getUser(userName).subGroupListCopy()) {
607  			allGroups.addAll(listAllGroupsInherited(subg));
608  		}
609  		String[] arr = new String[allGroups.size()];
610  		return allGroups.toArray(arr);
611  	}
612  	@SuppressWarnings(&quot;unused&quot;)
613  	private Group breadthFirstSearch(Group start, String targerPermission) {
614  		if (start == null || targerPermission == null) {
615  			return null;
616  		}
617  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
618  		ArrayList&lt;Group&gt; alreadyVisited = new ArrayList&lt;Group&gt;();
619  		stack.push(start);
620  		alreadyVisited.add(start);
621  		while (!stack.isEmpty()) {
622  			Group now = stack.pop();
623  			PermissionCheckResult resultNow = checkGroupOnlyPermission(now, targerPermission);
624  			if (resultNow.resultType.equals(PermissionCheckResult.Type.EXCEPTION) || resultNow.resultType.equals(PermissionCheckResult.Type.FOUND)) {
625  				return now;
626  			}
627  			if (resultNow.resultType.equals(PermissionCheckResult.Type.NEGATION)) {
628  				return null;
629  			}
630  			for (String sonName : now.getInherits()) {
631  				Group son = ph.getGroup(sonName);
632  				if (son != null &amp;&amp; !alreadyVisited.contains(son)) {
633  					stack.push(son);
634  					alreadyVisited.add(son);
635  				}
636  			}
637  		}
638  		return null;
639  	}
640  	@Override
641  	public Group getDefaultGroup() {
642  		return ph.getDefaultGroup();
643  	}
644  	@Override
645  	public String getInfoString(String entryName, String path, boolean isGroup) {
646  		if (isGroup) {
647  			Group data = ph.getGroup(entryName);
648  			if (data == null) {
649  				return null;
650  			}
651  			return data.getVariables().getVarString(path);
652  		} else {
653  			User data = ph.getUser(entryName);
654  			if (data == null) {
655  				return null;
656  			}
657  			return data.getVariables().getVarString(path);
658  		}
659  	}
660  	@Override
661  	public int getInfoInteger(String entryName, String path, boolean isGroup) {
662  		if (isGroup) {
663  			Group data = ph.getGroup(entryName);
664  			if (data == null) {
665  				return -1;
666  			}
667  			return data.getVariables().getVarInteger(path);
668  		} else {
669  			User data = ph.getUser(entryName);
670  			if (data == null) {
671  				return -1;
672  			}
673  			return data.getVariables().getVarInteger(path);
674  		}
675  	}
676  	@Override
677  	public double getInfoDouble(String entryName, String path, boolean isGroup) {
678  		if (isGroup) {
679  			Group data = ph.getGroup(entryName);
680  			if (data == null) {
681  				return -1;
682  			}
683  			return data.getVariables().getVarDouble(path);
684  		} else {
685  			User data = ph.getUser(entryName);
686  			if (data == null) {
687  				return -1;
688  			}
689  			return data.getVariables().getVarDouble(path);
690  		}
691  	}
692  	@Override
693  	public boolean getInfoBoolean(String entryName, String path, boolean isGroup) {
694  		if (isGroup) {
695  			Group data = ph.getGroup(entryName);
696  			if (data == null) {
697  				return false;
698  			}
<span onclick='openModal()' class='match'>699  			return data.getVariables().getVarBoolean(path);
700  		} else {
701  			User data = ph.getUser(entryName);
702  			if (data == null) {
703  				return false;
</span>704  			}
705  			return data.getVariables().getVarBoolean(path);
706  		}
707  	}
708  	@Override
709  	public void addUserInfo(String name, String path, Object data) {
710  		ph.getUser(name).getVariables().addVar(path, data);
711  	}
712  	@Override
713  	public void removeUserInfo(String name, String path) {
714  		ph.getUser(name).getVariables().removeVar(path);
715  	}
716  	@Override
717  	public void addGroupInfo(String name, String path, Object data) {
718  		ph.getGroup(name).getVariables().addVar(path, data);
719  	}
720  	@Override
721  	public void removeGroupInfo(String name, String path) {
722  		ph.getGroup(name).getVariables().removeVar(path);
723  	}
724  }
</code></pre>
        </div>
        <div class="column">
            <h3>Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-AnjoPermissionsHandler.java</h3>
            <pre><code>1  package org.anjocaido.groupmanager.permissions;
2  import java.util.ArrayList;
3  import java.util.Iterator;
4  import java.util.LinkedHashSet;
5  import java.util.LinkedList;
6  import java.util.List;
7  import java.util.Map;
8  import java.util.Set;
9  import org.anjocaido.groupmanager.GroupManager;
10  import org.anjocaido.groupmanager.data.Group;
11  import org.anjocaido.groupmanager.data.User;
12  import org.anjocaido.groupmanager.dataholder.WorldDataHolder;
13  import org.anjocaido.groupmanager.utils.PermissionCheckResult;
14  import org.bukkit.Bukkit;
15  import org.bukkit.entity.Player;
16  public class AnjoPermissionsHandler extends PermissionsReaderInterface {
17  	WorldDataHolder ph = null;
18  	public AnjoPermissionsHandler(WorldDataHolder holder) {
19  		ph = holder;
20  	}
21  	@Override
22  	public boolean has(Player player, String permission) {
23  		return permission(player, permission);
24  	}
25  	@Override
26  	public boolean permission(Player player, String permission) {
27  		return checkUserPermission(ph.getUser(player.getName()).updatePlayer(player), permission);
28  	}
29  	public boolean permission(String playerName, String permission) {
30  		return checkUserPermission(ph.getUser(playerName), permission);
31  	}
32  	@Override
33  	public String getGroup(String userName) {
34  		return ph.getUser(userName).getGroup().getName();
35  	}
36  	@Override
37  	public List&lt;String&gt; getAllPlayersPermissions(String userName) {
38  		List&lt;String&gt; perms = new ArrayList&lt;String&gt;();
39  		perms.addAll(getAllPlayersPermissions(userName, true));
40  		return perms;
41  	}
42  	@Override
43  	public Set&lt;String&gt; getAllPlayersPermissions(String userName, Boolean includeChildren) {
44  		Set&lt;String&gt; playerPermArray = new LinkedHashSet&lt;String&gt;();
45  		Set&lt;String&gt; overrides = new LinkedHashSet&lt;String&gt;();
46  		playerPermArray.addAll(populatePerms(ph.getUser(userName).getPermissionList(), includeChildren));
47  		ArrayList&lt;String&gt; alreadyProcessed = new ArrayList&lt;String&gt;();
48  		for (String group : getGroups(userName)) {
49  			if (!alreadyProcessed.contains(group)) {
50  				alreadyProcessed.add(group);
51  				Set&lt;String&gt; groupPermArray = new LinkedHashSet&lt;String&gt;();
52  				if (group.startsWith(&quot;g:&quot;) &amp;&amp; GroupManager.getGlobalGroups().hasGroup(group)) {
53  					groupPermArray = populatePerms(GroupManager.getGlobalGroups().getGroupsPermissions(group), includeChildren);
54  				} else {
55  					groupPermArray = populatePerms(ph.getGroup(group).getPermissionList(), includeChildren);
56  				}
57  				for (String perm : groupPermArray) {
58  					boolean negated = (perm.startsWith(&quot;-&quot;));
59  					if (perm.startsWith(&quot;+&quot;)) {
60  						overrides.add(perm.substring(1));
61  						continue;
62  					}
63  					if ((!negated &amp;&amp; !playerPermArray.contains(perm) &amp;&amp; !wildcardNegation(playerPermArray, perm)) || (negated &amp;&amp; !playerPermArray.contains(perm.substring(1)) &amp;&amp; !wildcardNegation(playerPermArray, perm.substring(1))))
64  						playerPermArray.add(perm);
65  				}
66  			}
67  		}
68  		Iterator&lt;String&gt; itr = overrides.iterator();
69  		while (itr.hasNext()) {
70  			String node = itr.next();
71  			if (playerPermArray.contains(&quot;-&quot; + node)) {
72  				playerPermArray.remove(&quot;-&quot; + node);
73  			}
74  			playerPermArray.add(node);
75  		}
76  		return playerPermArray;
77  	}
78  	private boolean wildcardNegation(Set&lt;String&gt; playerPermArray, String node) {
79  		if (playerPermArray.contains(&quot;-&quot; + node))
80  			return true;
81  		final String[] parts = node.split(&quot;\\.&quot;);
82  		final StringBuilder builder = new StringBuilder(node.length());
83  		for (String part : parts) {
84  			builder.append(&#x27;*&#x27;);
85  			if (playerPermArray.contains(&quot;-&quot; + builder.toString())) {
86  				GroupManager.logger.fine(&quot;Wildcard Negation found for &quot; + node);
87  				return true;
88  			}
89  			builder.deleteCharAt(builder.length() - 1);
90  			builder.append(part).append(&#x27;.&#x27;);
91  		}
92  		GroupManager.logger.fine(&quot;No Negation found for &quot; + node);
93  		return false;
94  	}
95  	private Set&lt;String&gt; populatePerms(List&lt;String&gt; permsList, boolean includeChildren) {
96  		List&lt;String&gt; perms = new ArrayList&lt;String&gt;(permsList);
97  		Set&lt;String&gt; permArray = new LinkedHashSet&lt;String&gt;();
98  		Boolean allPerms = false;
99  		if (perms.contains(&quot;*&quot;)) {
100  			permArray.addAll(GroupManager.BukkitPermissions.getAllRegisteredPermissions(includeChildren));
101  			allPerms = true;
102  			perms.remove(&quot;*&quot;);
103  			perms.remove(&quot;groupmanager.noofflineperms&quot;);
104  		}
105  		for (String perm : perms) {
106  			boolean negated = perm.startsWith(&quot;-&quot;);
107  			if (!permArray.contains(perm)) {
108  				permArray.add(perm);
109  				if ((negated) &amp;&amp; (permArray.contains(perm.substring(1))))
110  					permArray.remove(perm.substring(1));
111  				if ((includeChildren) || (negated &amp;&amp; allPerms)) {
112  					Map&lt;String, Boolean&gt; children = GroupManager.BukkitPermissions.getAllChildren((negated ? perm.substring(1) : perm), new LinkedHashSet&lt;String&gt;());
113  					if (children != null) {
114  						if (negated)
115  							if (allPerms) {
116  								for (String child : children.keySet())
117  									if (children.get(child))
118  										if (permArray.contains(child))
119  											permArray.remove(child);
120  							} else {
121  								for (String child : children.keySet())
122  									if (children.get(child))
123  										if ((!permArray.contains(child)) &amp;&amp; (!permArray.contains(&quot;-&quot; + child)))
124  											permArray.add(child);
125  							}
126  					}
127  				}
128  			}
129  		}
130  		return permArray;
131  	}
132  	@Override
133  	public boolean inGroup(String name, String group) {
134  		if (hasGroupInInheritance(ph.getUser(name).getGroup(), group)) {
135  			return true;
136  		}
137  		for (Group subGroup : ph.getUser(name).subGroupListCopy()) {
138  			if (hasGroupInInheritance(subGroup, group)) {
139  				return true;
140  			}
141  		}
142  		return false;
143  	}
144  	@Override
145  	public String getUserPrefix(String user) {
146  		String prefix = ph.getUser(user).getVariables().getVarString(&quot;prefix&quot;);
147  		if (prefix.length() != 0) {
148  			return prefix;
149  		}
150  		return getGroupPrefix(getGroup(user));
151  	}
152  	@Override
153  	public String getUserSuffix(String user) {
154  		String suffix = ph.getUser(user).getVariables().getVarString(&quot;suffix&quot;);
155  		if (suffix.length() != 0) {
156  			return suffix;
157  		}
158  		return getGroupSuffix(getGroup(user));
159  	}
160  	public String getPrimaryGroup(String user) {
161  		return getGroup(user);
162  	}
163  	public boolean canUserBuild(String userName) {
164  		return getPermissionBoolean(userName, &quot;build&quot;);
165  	}
166  	@Override
167  	public String getGroupPrefix(String groupName) {
168  		Group g = ph.getGroup(groupName);
169  		if (g == null) {
170  			return &quot;&quot;;
171  		}
172  		return g.getVariables().getVarString(&quot;prefix&quot;);
173  	}
174  	@Override
175  	public String getGroupSuffix(String groupName) {
176  		Group g = ph.getGroup(groupName);
177  		if (g == null) {
178  			return &quot;&quot;;
179  		}
180  		return g.getVariables().getVarString(&quot;suffix&quot;);
181  	}
182  	@Override
183  	public boolean canGroupBuild(String groupName) {
184  		Group g = ph.getGroup(groupName);
185  		if (g == null) {
186  			return false;
187  		}
188  		return g.getVariables().getVarBoolean(&quot;build&quot;);
189  	}
190  	@Override
191  	public String getGroupPermissionString(String groupName, String variable) {
192  		Group start = ph.getGroup(groupName);
193  		if (start == null) {
194  			return null;
195  		}
196  		Group result = nextGroupWithVariable(start, variable);
197  		if (result == null) {
198  			return null;
199  		}
200  		return result.getVariables().getVarString(variable);
201  	}
202  	@Override
203  	public int getGroupPermissionInteger(String groupName, String variable) {
204  		Group start = ph.getGroup(groupName);
205  		if (start == null) {
206  			return -1;
207  		}
208  		Group result = nextGroupWithVariable(start, variable);
209  		if (result == null) {
210  			return -1;
211  		}
212  		return result.getVariables().getVarInteger(variable);
213  	}
214  	@Override
215  	public boolean getGroupPermissionBoolean(String group, String variable) {
216  		Group start = ph.getGroup(group);
217  		if (start == null) {
218  			return false;
219  		}
220  		Group result = nextGroupWithVariable(start, variable);
221  		if (result == null) {
222  			return false;
223  		}
224  		return result.getVariables().getVarBoolean(variable);
225  	}
226  	@Override
227  	public double getGroupPermissionDouble(String group, String variable) {
228  		Group start = ph.getGroup(group);
229  		if (start == null) {
230  			return -1;
231  		}
232  		Group result = nextGroupWithVariable(start, variable);
233  		if (result == null) {
234  			return -1;
235  		}
236  		return result.getVariables().getVarDouble(variable);
237  	}
238  	@Override
239  	public String getUserPermissionString(String user, String variable) {
240  		User auser = ph.getUser(user);
241  		if (auser == null) {
242  			return &quot;&quot;;
243  		}
244  		return auser.getVariables().getVarString(variable);
245  	}
246  	@Override
247  	public int getUserPermissionInteger(String user, String variable) {
248  		User auser = ph.getUser(user);
249  		if (auser == null) {
250  			return -1;
251  		}
252  		return auser.getVariables().getVarInteger(variable);
253  	}
254  	@Override
255  	public boolean getUserPermissionBoolean(String user, String variable) {
256  		User auser = ph.getUser(user);
257  		if (auser == null) {
258  			return false;
259  		}
260  		return auser.getVariables().getVarBoolean(variable);
261  	}
262  	@Override
263  	public double getUserPermissionDouble(String user, String variable) {
264  		User auser = ph.getUser(user);
265  		if (auser == null) {
266  			return -1;
267  		}
268  		return auser.getVariables().getVarDouble(variable);
269  	}
270  	@Override
271  	public String getPermissionString(String user, String variable) {
272  		User auser = ph.getUser(user);
273  		if (auser == null) {
274  			return &quot;&quot;;
275  		}
276  		if (auser.getVariables().hasVar(variable)) {
277  			return auser.getVariables().getVarString(variable);
278  		}
279  		Group start = auser.getGroup();
280  		if (start == null) {
281  			return &quot;&quot;;
282  		}
283  		Group result = nextGroupWithVariable(start, variable);
284  		if (result == null) {
285  			if (!auser.isSubGroupsEmpty())
286  				for (Group subGroup : auser.subGroupListCopy()) {
287  					result = nextGroupWithVariable(subGroup, variable);
288  					if (result != null)
289  						continue;
290  				}
291  			if (result == null)
292  				return &quot;&quot;;
293  		}
294  		return result.getVariables().getVarString(variable);
295  	}
296  	@Override
297  	public int getPermissionInteger(String user, String variable) {
298  		User auser = ph.getUser(user);
299  		if (auser == null) {
300  			return -1;
301  		}
302  		if (auser.getVariables().hasVar(variable)) {
303  			return auser.getVariables().getVarInteger(variable);
304  		}
305  		Group start = auser.getGroup();
306  		if (start == null) {
307  			return -1;
308  		}
309  		Group result = nextGroupWithVariable(start, variable);
310  		if (result == null) {
311  			if (!auser.isSubGroupsEmpty())
312  				for (Group subGroup : auser.subGroupListCopy()) {
313  					result = nextGroupWithVariable(subGroup, variable);
314  					if (result != null)
315  						continue;
316  				}
317  			if (result == null)
318  				return -1;
319  		}
320  		return result.getVariables().getVarInteger(variable);
321  	}
322  	@Override
323  	public boolean getPermissionBoolean(String user, String variable) {
324  		User auser = ph.getUser(user);
325  		if (auser == null) {
326  			return false;
327  		}
328  		if (auser.getVariables().hasVar(variable)) {
329  			return auser.getVariables().getVarBoolean(variable);
330  		}
331  		Group start = auser.getGroup();
332  		if (start == null) {
333  			return false;
334  		}
335  		Group result = nextGroupWithVariable(start, variable);
336  		if (result == null) {
337  			if (!auser.isSubGroupsEmpty())
338  				for (Group subGroup : auser.subGroupListCopy()) {
339  					result = nextGroupWithVariable(subGroup, variable);
340  					if (result != null)
341  						continue;
342  				}
343  			if (result == null)
344  				return false;
345  		}
346  		return result.getVariables().getVarBoolean(variable);
347  	}
348  	@Override
349  	public double getPermissionDouble(String user, String variable) {
350  		User auser = ph.getUser(user);
351  		if (auser == null) {
352  			return -1.0D;
353  		}
354  		if (auser.getVariables().hasVar(variable)) {
355  			return auser.getVariables().getVarDouble(variable);
356  		}
357  		Group start = auser.getGroup();
358  		if (start == null) {
359  			return -1.0D;
360  		}
361  		Group result = nextGroupWithVariable(start, variable);
362  		if (result == null) {
363  			if (!auser.isSubGroupsEmpty())
364  				for (Group subGroup : auser.subGroupListCopy()) {
365  					result = nextGroupWithVariable(subGroup, variable);
366  					if (result != null)
367  						continue;
368  				}
369  			if (result == null)
370  				return -1.0D;
371  		}
372  		return result.getVariables().getVarDouble(variable);
373  	}
374  	public PermissionCheckResult checkUserOnlyPermission(User user, String permission) {
375  		user.sortPermissions();
376  		PermissionCheckResult result = new PermissionCheckResult();
377  		result.askedPermission = permission;
378  		result.owner = user;
379  		for (String access : user.getPermissionList()) {
380  			result.resultType = comparePermissionString(access, permission);
381  			if (result.resultType != PermissionCheckResult.Type.NOTFOUND) {
382  				result.accessLevel = access;
383  				return result;
384  			}
385  		}
386  		result.resultType = PermissionCheckResult.Type.NOTFOUND;
387  		return result;
388  	}
389  	public PermissionCheckResult checkGroupOnlyPermission(Group group, String permission) {
390  		group.sortPermissions();
391  		PermissionCheckResult result = new PermissionCheckResult();
392  		result.owner = group;
393  		result.askedPermission = permission;
394  		for (String access : group.getPermissionList()) {
395  			result.resultType = comparePermissionString(access, permission);
396  			if (result.resultType != PermissionCheckResult.Type.NOTFOUND) {
397  				result.accessLevel = access;
398  				return result;
399  			}
400  		}
401  		result.resultType = PermissionCheckResult.Type.NOTFOUND;
402  		return result;
403  	}
404  	public boolean checkUserPermission(User user, String permission) {
405  		PermissionCheckResult result = checkFullGMPermission(user, permission, true);
406  		if (result.resultType == PermissionCheckResult.Type.EXCEPTION || result.resultType == PermissionCheckResult.Type.FOUND) {
407  			return true;
408  		}
409  		return false;
410  	}
411  	public PermissionCheckResult checkFullUserPermission(User user, String targetPermission) {
412  		return checkFullGMPermission(user, targetPermission, true);
413  	}
414  	public PermissionCheckResult checkFullGMPermission(User user, String targetPermission, Boolean checkBukkit) {
415  		if (user == null || targetPermission == null || targetPermission.isEmpty()
416  				|| (!Bukkit.getServer().getOnlineMode()
417  				&amp;&amp; (checkPermission(user, &quot;groupmanager.noofflineperms&quot;, false).resultType == PermissionCheckResult.Type.FOUND))) {
418  			PermissionCheckResult result = new PermissionCheckResult();
419  			result.accessLevel = targetPermission;
420  			result.resultType = PermissionCheckResult.Type.NOTFOUND;
421  			return result;
422  		}
423  		return checkPermission(user, targetPermission, checkBukkit);
424  	}
425  	private PermissionCheckResult checkPermission(User user, String targetPermission, Boolean checkBukkit) {
426  		PermissionCheckResult result = new PermissionCheckResult();
427  		result.accessLevel = targetPermission;
428  		result.resultType = PermissionCheckResult.Type.NOTFOUND;
429  		if (checkBukkit) {
430  			final Player player = user.getBukkitPlayer();
431  			if ((player != null) &amp;&amp; player.hasPermission(targetPermission)) {
432  				result.resultType = PermissionCheckResult.Type.FOUND;
433  				result.owner = user;
434  				return result;
435  			}
436  		}
437  		PermissionCheckResult resultUser = checkUserOnlyPermission(user, targetPermission);
438  		if (resultUser.resultType != PermissionCheckResult.Type.NOTFOUND) {
439  			resultUser.accessLevel = targetPermission;
440  			if (resultUser.resultType == PermissionCheckResult.Type.EXCEPTION) {
441  				return resultUser;
442  			}
443  			result = resultUser;
444  		}
445  		PermissionCheckResult resultGroup = checkGroupPermissionWithInheritance(user.getGroup(), targetPermission);
446  		if (resultGroup.resultType != PermissionCheckResult.Type.NOTFOUND) {
447  			resultGroup.accessLevel = targetPermission;
448  			if (resultGroup.resultType == PermissionCheckResult.Type.EXCEPTION) {
449  				return resultGroup;
450  			}
451  			if (result.resultType == PermissionCheckResult.Type.NOTFOUND) {
452  				result = resultGroup;
453  			}
454  		}
455  		boolean negated = (result.resultType == PermissionCheckResult.Type.NEGATION);
456  		for (Group subGroup : user.subGroupListCopy()) {
457  			PermissionCheckResult resultSubGroup = checkGroupPermissionWithInheritance(subGroup, targetPermission);
458  			if (resultSubGroup.resultType != PermissionCheckResult.Type.NOTFOUND) {
459  				resultSubGroup.accessLevel = targetPermission;
460  				if (resultSubGroup.resultType == PermissionCheckResult.Type.EXCEPTION) {
461  					return resultSubGroup;
462  				} else if ((resultSubGroup.resultType == PermissionCheckResult.Type.FOUND) &amp;&amp; (result.resultType != PermissionCheckResult.Type.NEGATION) &amp;&amp; !negated) {
463  					result = resultSubGroup;
464  				} else if ((resultSubGroup.resultType == PermissionCheckResult.Type.NEGATION) &amp;&amp; !negated) {
465  					result = resultSubGroup;
466  				}
467  			}
468  		}
469  		return result;
470  	}
471  	public Group nextGroupWithVariable(Group start, String targetVariable) {
472  		if (start == null || targetVariable == null) {
473  			return null;
474  		}
475  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
476  		ArrayList&lt;Group&gt; alreadyVisited = new ArrayList&lt;Group&gt;();
477  		stack.push(start);
478  		alreadyVisited.add(start);
479  		while (!stack.isEmpty()) {
480  			Group now = stack.pop();
481  			if (now.getVariables().hasVar(targetVariable)) {
482  				return now;
483  			}
484  			for (String sonName : now.getInherits()) {
485  				Group son = ph.getGroup(sonName);
486  				if (son != null &amp;&amp; !alreadyVisited.contains(son)) {
487  					stack.push(son);
488  					alreadyVisited.add(son);
489  				}
490  			}
491  		}
492  		return null;
493  	}
494  	public boolean hasGroupInInheritance(Group start, String askedGroup) {
495  		if (start == null || askedGroup == null) {
496  			return false;
497  		}
498  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
499  		ArrayList&lt;Group&gt; alreadyVisited = new ArrayList&lt;Group&gt;();
500  		stack.push(start);
501  		alreadyVisited.add(start);
502  		while (!stack.isEmpty()) {
503  			Group now = stack.pop();
504  			if (now.getName().equalsIgnoreCase(askedGroup)) {
505  				return true;
506  			}
507  			for (String sonName : now.getInherits()) {
508  				Group son = ph.getGroup(sonName);
509  				if (son != null &amp;&amp; !alreadyVisited.contains(son)) {
510  					stack.push(son);
511  					alreadyVisited.add(son);
512  				}
513  			}
514  		}
515  		return false;
516  	}
517  	public PermissionCheckResult checkGroupPermissionWithInheritance(Group start, String targetPermission) {
518  		if (start == null || targetPermission == null) {
519  			return null;
520  		}
521  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
522  		List&lt;Group&gt; alreadyVisited = new ArrayList&lt;Group&gt;();
523  		PermissionCheckResult result = new PermissionCheckResult();
524  		stack.push(start);
525  		alreadyVisited.add(start);
526  		result.askedPermission = targetPermission;
527  		result.resultType = PermissionCheckResult.Type.NOTFOUND;
528  		while (!stack.isEmpty()) {
529  			Group now = stack.pop();
530  			PermissionCheckResult resultNow = checkGroupOnlyPermission(now, targetPermission);
531  			if (!resultNow.resultType.equals(PermissionCheckResult.Type.NOTFOUND)) {
532  				if (resultNow.resultType.equals(PermissionCheckResult.Type.EXCEPTION)) {
533  					resultNow.accessLevel = targetPermission;
534  					return resultNow;
535  				}
536  				result = resultNow;
537  			}
538  			for (String sonName : now.getInherits()) {
539  				Group son = ph.getGroup(sonName);
540  				if (son != null &amp;&amp; !alreadyVisited.contains(son)) {
541  					stack.add(son);
542  					alreadyVisited.add(son);
543  				}
544  			}
545  		}
546  		return result;
547  	}
548  	public ArrayList&lt;String&gt; listAllGroupsInherited(Group start) {
549  		if (start == null) {
550  			return null;
551  		}
552  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
553  		ArrayList&lt;String&gt; alreadyVisited = new ArrayList&lt;String&gt;();
554  		stack.push(start);
555  		alreadyVisited.add(start.getName());
556  		while (!stack.isEmpty()) {
557  			Group now = stack.pop();
558  			for (String sonName : now.getInherits()) {
559  				Group son = ph.getGroup(sonName);
560  				if (son != null &amp;&amp; !alreadyVisited.contains(son.getName())) {
561  					stack.push(son);
562  					alreadyVisited.add(son.getName());
563  				}
564  			}
565  		}
566  		return alreadyVisited;
567  	}
568  	public PermissionCheckResult.Type comparePermissionString(String userAccessLevel, String fullPermissionName) {
569  		int userAccessLevelLength;
570  		if (userAccessLevel == null || fullPermissionName == null || fullPermissionName.length() == 0 || (userAccessLevelLength = userAccessLevel.length()) == 0) {
571  			return PermissionCheckResult.Type.NOTFOUND;
572  		}
573  		PermissionCheckResult.Type result = PermissionCheckResult.Type.FOUND;
574  		int userAccessLevelOffset = 0;
575  		if (userAccessLevel.charAt(0) == &#x27;+&#x27;) {
576  			userAccessLevelOffset = 1;
577  			result = PermissionCheckResult.Type.EXCEPTION;
578  		} else if (userAccessLevel.charAt(0) == &#x27;-&#x27;) {
579  			userAccessLevelOffset = 1;
580  			result = PermissionCheckResult.Type.NEGATION;
581  		}
582  		if (fullPermissionName.equals(userAccessLevel)) {
583  			return result;
584  		}
585  		if (&quot;groupmanager.noofflineperms&quot;.equals(fullPermissionName)) {
586  			result = PermissionCheckResult.Type.NOTFOUND;
587  		}
588  		if (&quot;*&quot;.regionMatches(0, userAccessLevel, userAccessLevelOffset, userAccessLevelLength - userAccessLevelOffset)) {
589  			return result;
590  		}
591  		int fullPermissionNameOffset;
592  		if (fullPermissionName.charAt(0) == &#x27;+&#x27; || fullPermissionName.charAt(0) == &#x27;-&#x27;) {
593  			fullPermissionNameOffset = 1;
594  		} else {
595  			fullPermissionNameOffset = 0;
596  		}
597  		if (userAccessLevel.charAt(userAccessLevel.length() - 1) == &#x27;*&#x27;) {
598  			return userAccessLevel.regionMatches(true, userAccessLevelOffset, fullPermissionName, fullPermissionNameOffset, userAccessLevelLength - userAccessLevelOffset - 1) ? result : PermissionCheckResult.Type.NOTFOUND;
599  		} else {
600  			return userAccessLevel.regionMatches(true, userAccessLevelOffset, fullPermissionName, fullPermissionNameOffset, Math.max(userAccessLevelLength - userAccessLevelOffset, fullPermissionName.length() - fullPermissionNameOffset)) ? result : PermissionCheckResult.Type.NOTFOUND;
601  		}
602  	}
603  	@Override
604  	public String[] getGroups(String userName) {
605  		ArrayList&lt;String&gt; allGroups = listAllGroupsInherited(ph.getUser(userName).getGroup());
606  		for (Group subg : ph.getUser(userName).subGroupListCopy()) {
607  			allGroups.addAll(listAllGroupsInherited(subg));
608  		}
609  		String[] arr = new String[allGroups.size()];
610  		return allGroups.toArray(arr);
611  	}
612  	@SuppressWarnings(&quot;unused&quot;)
613  	private Group breadthFirstSearch(Group start, String targerPermission) {
614  		if (start == null || targerPermission == null) {
615  			return null;
616  		}
617  		LinkedList&lt;Group&gt; stack = new LinkedList&lt;Group&gt;();
618  		ArrayList&lt;Group&gt; alreadyVisited = new ArrayList&lt;Group&gt;();
619  		stack.push(start);
620  		alreadyVisited.add(start);
621  		while (!stack.isEmpty()) {
622  			Group now = stack.pop();
623  			PermissionCheckResult resultNow = checkGroupOnlyPermission(now, targerPermission);
624  			if (resultNow.resultType.equals(PermissionCheckResult.Type.EXCEPTION) || resultNow.resultType.equals(PermissionCheckResult.Type.FOUND)) {
625  				return now;
626  			}
627  			if (resultNow.resultType.equals(PermissionCheckResult.Type.NEGATION)) {
628  				return null;
629  			}
630  			for (String sonName : now.getInherits()) {
631  				Group son = ph.getGroup(sonName);
632  				if (son != null &amp;&amp; !alreadyVisited.contains(son)) {
633  					stack.push(son);
634  					alreadyVisited.add(son);
635  				}
636  			}
637  		}
638  		return null;
639  	}
640  	@Override
641  	public Group getDefaultGroup() {
642  		return ph.getDefaultGroup();
643  	}
644  	@Override
645  	public String getInfoString(String entryName, String path, boolean isGroup) {
646  		if (isGroup) {
647  			Group data = ph.getGroup(entryName);
648  			if (data == null) {
649  				return null;
650  			}
651  			return data.getVariables().getVarString(path);
652  		} else {
653  			User data = ph.getUser(entryName);
654  			if (data == null) {
655  				return null;
656  			}
657  			return data.getVariables().getVarString(path);
658  		}
659  	}
660  	@Override
661  	public int getInfoInteger(String entryName, String path, boolean isGroup) {
662  		if (isGroup) {
663  			Group data = ph.getGroup(entryName);
664  			if (data == null) {
665  				return -1;
666  			}
667  			return data.getVariables().getVarInteger(path);
668  		} else {
669  			User data = ph.getUser(entryName);
670  			if (data == null) {
671  				return -1;
672  			}
673  			return data.getVariables().getVarInteger(path);
674  		}
675  	}
676  	@Override
677  	public double getInfoDouble(String entryName, String path, boolean isGroup) {
678  		if (isGroup) {
679  			Group data = ph.getGroup(entryName);
680  			if (data == null) {
681  				return -1;
682  			}
<span onclick='openModal()' class='match'>683  			return data.getVariables().getVarDouble(path);
684  		} else {
685  			User data = ph.getUser(entryName);
686  			if (data == null) {
687  				return -1;
</span>688  			}
689  			return data.getVariables().getVarDouble(path);
690  		}
691  	}
692  	@Override
693  	public boolean getInfoBoolean(String entryName, String path, boolean isGroup) {
694  		if (isGroup) {
695  			Group data = ph.getGroup(entryName);
696  			if (data == null) {
697  				return false;
698  			}
699  			return data.getVariables().getVarBoolean(path);
700  		} else {
701  			User data = ph.getUser(entryName);
702  			if (data == null) {
703  				return false;
704  			}
705  			return data.getVariables().getVarBoolean(path);
706  		}
707  	}
708  	@Override
709  	public void addUserInfo(String name, String path, Object data) {
710  		ph.getUser(name).getVariables().addVar(path, data);
711  	}
712  	@Override
713  	public void removeUserInfo(String name, String path) {
714  		ph.getUser(name).getVariables().removeVar(path);
715  	}
716  	@Override
717  	public void addGroupInfo(String name, String path, Object data) {
718  		ph.getGroup(name).getVariables().addVar(path, data);
719  	}
720  	@Override
721  	public void removeGroupInfo(String name, String path) {
722  		ph.getGroup(name).getVariables().removeVar(path);
723  	}
724  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-AnjoPermissionsHandler.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from Essentials-MDEwOlJlcG9zaXRvcnkxNzczNzU0-flat-AnjoPermissionsHandler.java</div>
                </div>
                <div class="column column_space"><pre><code>699  			return data.getVariables().getVarBoolean(path);
700  		} else {
701  			User data = ph.getUser(entryName);
702  			if (data == null) {
703  				return false;
</pre></code></div>
                <div class="column column_space"><pre><code>683  			return data.getVariables().getVarDouble(path);
684  		} else {
685  			User data = ph.getUser(entryName);
686  			if (data == null) {
687  				return -1;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    