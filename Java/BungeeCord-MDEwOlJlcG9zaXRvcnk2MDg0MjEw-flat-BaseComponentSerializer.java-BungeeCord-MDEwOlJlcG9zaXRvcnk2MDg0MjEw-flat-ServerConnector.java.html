
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 18.181818181818183%, Tokens: 17</h2>
        <div class="column">
            <h3>BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-BaseComponentSerializer.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package net.md_5.bungee.chat;
2  import com.google.common.base.Preconditions;
3  import com.google.gson.JsonDeserializationContext;
4  import com.google.gson.JsonElement;
5  import com.google.gson.JsonObject;
6  import com.google.gson.JsonParseException;
7  import com.google.gson.JsonSerializationContext;
8  import java.util.ArrayList;
9  import java.util.Arrays;
10  import java.util.Collections;
11  import java.util.IdentityHashMap;
12  import java.util.Locale;
13  import net.md_5.bungee.api.ChatColor;
14  import net.md_5.bungee.api.chat.BaseComponent;
15  import net.md_5.bungee.api.chat.ClickEvent;
16  import net.md_5.bungee.api.chat.HoverEvent;
17  import net.md_5.bungee.api.chat.hover.content.Content;
</span>18  public class BaseComponentSerializer
19  {
20      protected void deserialize(JsonObject object, BaseComponent component, JsonDeserializationContext context)
21      {
22          if ( object.has( "bold" ) )
23          {
24              component.setBold( object.get( "bold" ).getAsBoolean() );
25          }
26          if ( object.has( "italic" ) )
27          {
28              component.setItalic( object.get( "italic" ).getAsBoolean() );
29          }
30          if ( object.has( "underlined" ) )
31          {
32              component.setUnderlined( object.get( "underlined" ).getAsBoolean() );
33          }
34          if ( object.has( "strikethrough" ) )
35          {
36              component.setStrikethrough( object.get( "strikethrough" ).getAsBoolean() );
37          }
38          if ( object.has( "obfuscated" ) )
39          {
40              component.setObfuscated( object.get( "obfuscated" ).getAsBoolean() );
41          }
42          if ( object.has( "color" ) )
43          {
44              component.setColor( ChatColor.of( object.get( "color" ).getAsString() ) );
45          }
46          if ( object.has( "insertion" ) )
47          {
48              component.setInsertion( object.get( "insertion" ).getAsString() );
49          }
50          if ( object.has( "clickEvent" ) )
51          {
52              JsonObject event = object.getAsJsonObject( "clickEvent" );
53              component.setClickEvent( new ClickEvent(
54                      ClickEvent.Action.valueOf( event.get( "action" ).getAsString().toUpperCase( Locale.ROOT ) ),
55                      ( event.has( "value" ) ) ? event.get( "value" ).getAsString() : "" ) );
56          }
57          if ( object.has( "hoverEvent" ) )
58          {
59              JsonObject event = object.getAsJsonObject( "hoverEvent" );
60              HoverEvent hoverEvent = null;
61              HoverEvent.Action action = HoverEvent.Action.valueOf( event.get( "action" ).getAsString().toUpperCase( Locale.ROOT ) );
62              for ( String type : Arrays.asList( "value", "contents" ) )
63              {
64                  if ( !event.has( type ) )
65                  {
66                      continue;
67                  }
68                  JsonElement contents = event.get( type );
69                  try
70                  {
71                      BaseComponent[] components;
72                      if ( contents.isJsonArray() )
73                      {
74                          components = context.deserialize( contents, BaseComponent[].class );
75                      } else
76                      {
77                          components = new BaseComponent[]
78                          {
79                              context.deserialize( contents, BaseComponent.class )
80                          };
81                      }
82                      hoverEvent = new HoverEvent( action, components );
83                  } catch ( JsonParseException ex )
84                  {
85                      Content[] list;
86                      if ( contents.isJsonArray() )
87                      {
88                          list = context.deserialize( contents, HoverEvent.getClass( action, true ) );
89                      } else
90                      {
91                          list = new Content[]
92                          {
93                              context.deserialize( contents, HoverEvent.getClass( action, false ) )
94                          };
95                      }
96                      hoverEvent = new HoverEvent( action, new ArrayList<>( Arrays.asList( list ) ) );
97                  }
98                  break;
99              }
100              if ( hoverEvent != null )
101              {
102                  component.setHoverEvent( hoverEvent );
103              }
104          }
105          if ( object.has( "font" ) )
106          {
107              component.setFont( object.get( "font" ).getAsString() );
108          }
109          if ( object.has( "extra" ) )
110          {
111              component.setExtra( Arrays.asList( context.<BaseComponent[]>deserialize( object.get( "extra" ), BaseComponent[].class ) ) );
112          }
113      }
114      protected void serialize(JsonObject object, BaseComponent component, JsonSerializationContext context)
115      {
116          boolean first = false;
117          if ( ComponentSerializer.serializedComponents.get() == null )
118          {
119              first = true;
120              ComponentSerializer.serializedComponents.set( Collections.newSetFromMap( new IdentityHashMap<BaseComponent, Boolean>() ) );
121          }
122          try
123          {
124              Preconditions.checkArgument( !ComponentSerializer.serializedComponents.get().contains( component ), "Component loop" );
125              ComponentSerializer.serializedComponents.get().add( component );
126              if ( component.isBoldRaw() != null )
127              {
128                  object.addProperty( "bold", component.isBoldRaw() );
129              }
130              if ( component.isItalicRaw() != null )
131              {
132                  object.addProperty( "italic", component.isItalicRaw() );
133              }
134              if ( component.isUnderlinedRaw() != null )
135              {
136                  object.addProperty( "underlined", component.isUnderlinedRaw() );
137              }
138              if ( component.isStrikethroughRaw() != null )
139              {
140                  object.addProperty( "strikethrough", component.isStrikethroughRaw() );
141              }
142              if ( component.isObfuscatedRaw() != null )
143              {
144                  object.addProperty( "obfuscated", component.isObfuscatedRaw() );
145              }
146              if ( component.getColorRaw() != null )
147              {
148                  object.addProperty( "color", component.getColorRaw().getName() );
149              }
150              if ( component.getInsertion() != null )
151              {
152                  object.addProperty( "insertion", component.getInsertion() );
153              }
154              if ( component.getClickEvent() != null )
155              {
156                  JsonObject clickEvent = new JsonObject();
157                  clickEvent.addProperty( "action", component.getClickEvent().getAction().toString().toLowerCase( Locale.ROOT ) );
158                  clickEvent.addProperty( "value", component.getClickEvent().getValue() );
159                  object.add( "clickEvent", clickEvent );
160              }
161              if ( component.getHoverEvent() != null )
162              {
163                  JsonObject hoverEvent = new JsonObject();
164                  hoverEvent.addProperty( "action", component.getHoverEvent().getAction().toString().toLowerCase( Locale.ROOT ) );
165                  if ( component.getHoverEvent().isLegacy() )
166                  {
167                      hoverEvent.add( "value", context.serialize( component.getHoverEvent().getContents().get( 0 ) ) );
168                  } else
169                  {
170                      hoverEvent.add( "contents", context.serialize( ( component.getHoverEvent().getContents().size() == 1 )
171                              ? component.getHoverEvent().getContents().get( 0 ) : component.getHoverEvent().getContents() ) );
172                  }
173                  object.add( "hoverEvent", hoverEvent );
174              }
175              if ( component.getFontRaw() != null )
176              {
177                  object.addProperty( "font", component.getFontRaw() );
178              }
179              if ( component.getExtra() != null )
180              {
181                  object.add( "extra", context.serialize( component.getExtra() ) );
182              }
183          } finally
184          {
185              ComponentSerializer.serializedComponents.get().remove( component );
186              if ( first )
187              {
188                  ComponentSerializer.serializedComponents.set( null );
189              }
190          }
191      }
192  }
</code></pre>
        </div>
        <div class="column">
            <h3>BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-ServerConnector.java</h3>
            <pre><code><span onclick='openModal()' class='match'>1  package net.md_5.bungee;
2  import com.google.common.base.Joiner;
3  import com.google.common.base.Preconditions;
4  import io.netty.buffer.ByteBuf;
5  import io.netty.buffer.ByteBufAllocator;
6  import java.net.InetSocketAddress;
7  import java.nio.charset.StandardCharsets;
8  import java.util.Locale;
9  import java.util.Queue;
10  import java.util.Set;
11  import java.util.UUID;
12  import lombok.Getter;
13  import lombok.RequiredArgsConstructor;
14  import net.md_5.bungee.api.ChatColor;
15  import net.md_5.bungee.api.ProxyServer;
16  import net.md_5.bungee.api.config.ServerInfo;
17  import net.md_5.bungee.api.event.ServerConnectEvent;
</span>18  import net.md_5.bungee.api.event.ServerConnectedEvent;
19  import net.md_5.bungee.api.event.ServerKickEvent;
20  import net.md_5.bungee.api.event.ServerSwitchEvent;
21  import net.md_5.bungee.api.score.Objective;
22  import net.md_5.bungee.api.score.Score;
23  import net.md_5.bungee.api.score.Scoreboard;
24  import net.md_5.bungee.api.score.Team;
25  import net.md_5.bungee.chat.ComponentSerializer;
26  import net.md_5.bungee.connection.CancelSendSignal;
27  import net.md_5.bungee.connection.DownstreamBridge;
28  import net.md_5.bungee.connection.LoginResult;
29  import net.md_5.bungee.forge.ForgeConstants;
30  import net.md_5.bungee.forge.ForgeServerHandler;
31  import net.md_5.bungee.forge.ForgeUtils;
32  import net.md_5.bungee.netty.ChannelWrapper;
33  import net.md_5.bungee.netty.HandlerBoss;
34  import net.md_5.bungee.netty.PacketHandler;
35  import net.md_5.bungee.protocol.DefinedPacket;
36  import net.md_5.bungee.protocol.PacketWrapper;
37  import net.md_5.bungee.protocol.Protocol;
38  import net.md_5.bungee.protocol.ProtocolConstants;
39  import net.md_5.bungee.protocol.packet.EncryptionRequest;
40  import net.md_5.bungee.protocol.packet.EntityStatus;
41  import net.md_5.bungee.protocol.packet.GameState;
42  import net.md_5.bungee.protocol.packet.Handshake;
43  import net.md_5.bungee.protocol.packet.Kick;
44  import net.md_5.bungee.protocol.packet.Login;
45  import net.md_5.bungee.protocol.packet.LoginPayloadRequest;
46  import net.md_5.bungee.protocol.packet.LoginPayloadResponse;
47  import net.md_5.bungee.protocol.packet.LoginRequest;
48  import net.md_5.bungee.protocol.packet.LoginSuccess;
49  import net.md_5.bungee.protocol.packet.PluginMessage;
50  import net.md_5.bungee.protocol.packet.Respawn;
51  import net.md_5.bungee.protocol.packet.ScoreboardObjective;
52  import net.md_5.bungee.protocol.packet.ScoreboardScore;
53  import net.md_5.bungee.protocol.packet.SetCompression;
54  import net.md_5.bungee.protocol.packet.ViewDistance;
55  import net.md_5.bungee.util.AddressUtil;
56  import net.md_5.bungee.util.BufUtil;
57  import net.md_5.bungee.util.QuietException;
58  @RequiredArgsConstructor
59  public class ServerConnector extends PacketHandler
60  {
61      private final ProxyServer bungee;
62      private ChannelWrapper ch;
63      private final UserConnection user;
64      private final BungeeServerInfo target;
65      private State thisState = State.LOGIN_SUCCESS;
66      @Getter
67      private ForgeServerHandler handshakeHandler;
68      private boolean obsolete;
69      private enum State
70      {
71          LOGIN_SUCCESS, ENCRYPT_RESPONSE, LOGIN, FINISHED;
72      }
73      @Override
74      public void exception(Throwable t) throws Exception
75      {
76          if ( obsolete )
77          {
78              return;
79          }
80          String message = "Exception Connecting:" + Util.exception( t );
81          if ( user.getServer() == null )
82          {
83              user.disconnect( message );
84          } else
85          {
86              user.sendMessage( ChatColor.RED + message );
87          }
88      }
89      @Override
90      public void connected(ChannelWrapper channel) throws Exception
91      {
92          this.ch = channel;
93          this.handshakeHandler = new ForgeServerHandler( user, ch, target );
94          Handshake originalHandshake = user.getPendingConnection().getHandshake();
95          Handshake copiedHandshake = new Handshake( originalHandshake.getProtocolVersion(), originalHandshake.getHost(), originalHandshake.getPort(), 2 );
96          if ( BungeeCord.getInstance().config.isIpForward() && user.getSocketAddress() instanceof InetSocketAddress )
97          {
98              String newHost = copiedHandshake.getHost() + "\00" + AddressUtil.sanitizeAddress( user.getAddress() ) + "\00" + user.getUUID();
99              LoginResult profile = user.getPendingConnection().getLoginProfile();
100              if ( profile != null && profile.getProperties() != null && profile.getProperties().length > 0 )
101              {
102                  newHost += "\00" + BungeeCord.getInstance().gson.toJson( profile.getProperties() );
103              }
104              copiedHandshake.setHost( newHost );
105          } else if ( !user.getExtraDataInHandshake().isEmpty() )
106          {
107              copiedHandshake.setHost( copiedHandshake.getHost() + user.getExtraDataInHandshake() );
108          }
109          channel.write( copiedHandshake );
110          channel.setProtocol( Protocol.LOGIN );
111          channel.write( new LoginRequest( user.getName(), null, user.getUniqueId() ) );
112      }
113      @Override
114      public void disconnected(ChannelWrapper channel) throws Exception
115      {
116          user.getPendingConnects().remove( target );
117      }
118      @Override
119      public void handle(PacketWrapper packet) throws Exception
120      {
121          if ( packet.packet == null )
122          {
123              throw new QuietException( "Unexpected packet received during server login process!\n" + BufUtil.dump( packet.buf, 16 ) );
124          }
125      }
126      @Override
127      public void handle(LoginSuccess loginSuccess) throws Exception
128      {
129          Preconditions.checkState( thisState == State.LOGIN_SUCCESS, "Not expecting LOGIN_SUCCESS" );
130          ch.setProtocol( Protocol.GAME );
131          thisState = State.LOGIN;
132          if ( user.getServer() != null && user.getForgeClientHandler().isHandshakeComplete()
133                  && user.getServer().isForgeServer() )
134          {
135              user.getForgeClientHandler().resetHandshake();
136          }
137          throw CancelSendSignal.INSTANCE;
138      }
139      @Override
140      public void handle(SetCompression setCompression) throws Exception
141      {
142          ch.setCompressionThreshold( setCompression.getThreshold() );
143      }
144      @Override
145      public void handle(Login login) throws Exception
146      {
147          Preconditions.checkState( thisState == State.LOGIN, "Not expecting LOGIN" );
148          ServerConnection server = new ServerConnection( ch, target );
149          ServerConnectedEvent event = new ServerConnectedEvent( user, server );
150          bungee.getPluginManager().callEvent( event );
151          ch.write( BungeeCord.getInstance().registerChannels( user.getPendingConnection().getVersion() ) );
152          Queue<DefinedPacket> packetQueue = target.getPacketQueue();
153          synchronized ( packetQueue )
154          {
155              while ( !packetQueue.isEmpty() )
156              {
157                  ch.write( packetQueue.poll() );
158              }
159          }
160          PluginMessage brandMessage = user.getPendingConnection().getBrandMessage();
161          if ( brandMessage != null )
162          {
163              ch.write( brandMessage );
164          }
165          Set<String> registeredChannels = user.getPendingConnection().getRegisteredChannels();
166          if ( !registeredChannels.isEmpty() )
167          {
168              ch.write( new PluginMessage( user.getPendingConnection().getVersion() >= ProtocolConstants.MINECRAFT_1_13 ? "minecraft:register" : "REGISTER", Joiner.on( "\0" ).join( registeredChannels ).getBytes( StandardCharsets.UTF_8 ), false ) );
169          }
170          if ( user.getSettings() != null )
171          {
172              ch.write( user.getSettings() );
173          }
174          if ( user.getForgeClientHandler().getClientModList() == null && !user.getForgeClientHandler().isHandshakeComplete() ) 
175          {
176              user.getForgeClientHandler().setHandshakeComplete();
177          }
178          if ( user.getServer() == null || !( login.getDimension() instanceof Integer ) )
179          {
180              user.setClientEntityId( login.getEntityId() );
181              user.setServerEntityId( login.getEntityId() );
182              Login modLogin = new Login( login.getEntityId(), login.isHardcore(), login.getGameMode(), login.getPreviousGameMode(), login.getWorldNames(), login.getDimensions(), login.getDimension(), login.getWorldName(), login.getSeed(), login.getDifficulty(),
183                      (byte) user.getPendingConnection().getListener().getTabListSize(), login.getLevelType(), login.getViewDistance(), login.getSimulationDistance(), login.isReducedDebugInfo(), login.isNormalRespawn(), login.isDebug(), login.isFlat(), login.getDeathLocation() );
184              user.unsafe().sendPacket( modLogin );
185              if ( user.getServer() != null )
186              {
187                  user.getServer().setObsolete( true );
188                  user.getTabListHandler().onServerChange();
189                  user.getServerSentScoreboard().clear();
190                  for ( UUID bossbar : user.getSentBossBars() )
191                  {
192                      user.unsafe().sendPacket( new net.md_5.bungee.protocol.packet.BossBar( bossbar, 1 ) );
193                  }
194                  user.getSentBossBars().clear();
195                  user.unsafe().sendPacket( new Respawn( login.getDimension(), login.getWorldName(), login.getSeed(), login.getDifficulty(), login.getGameMode(), login.getPreviousGameMode(), login.getLevelType(), login.isDebug(), login.isFlat(), false, login.getDeathLocation() ) );
196                  user.getServer().disconnect( "Quitting" );
197              } else
198              {
199                  ByteBuf brand = ByteBufAllocator.DEFAULT.heapBuffer();
200                  DefinedPacket.writeString( bungee.getName() + " (" + bungee.getVersion() + ")", brand );
201                  user.unsafe().sendPacket( new PluginMessage( user.getPendingConnection().getVersion() >= ProtocolConstants.MINECRAFT_1_13 ? "minecraft:brand" : "MC|Brand", DefinedPacket.toArray( brand ), handshakeHandler.isServerForge() ) );
202                  brand.release();
203              }
204              user.setDimension( login.getDimension() );
205          } else
206          {
207              user.getServer().setObsolete( true );
208              user.getTabListHandler().onServerChange();
209              Scoreboard serverScoreboard = user.getServerSentScoreboard();
210              for ( Objective objective : serverScoreboard.getObjectives() )
211              {
212                  user.unsafe().sendPacket( new ScoreboardObjective( objective.getName(), objective.getValue(), ScoreboardObjective.HealthDisplay.fromString( objective.getType() ), (byte) 1 ) );
213              }
214              for ( Score score : serverScoreboard.getScores() )
215              {
216                  user.unsafe().sendPacket( new ScoreboardScore( score.getItemName(), (byte) 1, score.getScoreName(), score.getValue() ) );
217              }
218              for ( Team team : serverScoreboard.getTeams() )
219              {
220                  user.unsafe().sendPacket( new net.md_5.bungee.protocol.packet.Team( team.getName() ) );
221              }
222              serverScoreboard.clear();
223              for ( UUID bossbar : user.getSentBossBars() )
224              {
225                  user.unsafe().sendPacket( new net.md_5.bungee.protocol.packet.BossBar( bossbar, 1 ) );
226              }
227              user.getSentBossBars().clear();
228              user.unsafe().sendPacket( new EntityStatus( user.getClientEntityId(), login.isReducedDebugInfo() ? EntityStatus.DEBUG_INFO_REDUCED : EntityStatus.DEBUG_INFO_NORMAL ) );
229              if ( user.getPendingConnection().getVersion() >= ProtocolConstants.MINECRAFT_1_15 )
230              {
231                  user.unsafe().sendPacket( new GameState( GameState.IMMEDIATE_RESPAWN, login.isNormalRespawn() ? 0 : 1 ) );
232              }
233              user.setDimensionChange( true );
234              if ( login.getDimension() == user.getDimension() )
235              {
236                  user.unsafe().sendPacket( new Respawn( (Integer) login.getDimension() >= 0 ? -1 : 0, login.getWorldName(), login.getSeed(), login.getDifficulty(), login.getGameMode(), login.getPreviousGameMode(), login.getLevelType(), login.isDebug(), login.isFlat(), false, login.getDeathLocation() ) );
237              }
238              user.setServerEntityId( login.getEntityId() );
239              user.unsafe().sendPacket( new Respawn( login.getDimension(), login.getWorldName(), login.getSeed(), login.getDifficulty(), login.getGameMode(), login.getPreviousGameMode(), login.getLevelType(), login.isDebug(), login.isFlat(), false, login.getDeathLocation() ) );
240              if ( user.getPendingConnection().getVersion() >= ProtocolConstants.MINECRAFT_1_14 )
241              {
242                  user.unsafe().sendPacket( new ViewDistance( login.getViewDistance() ) );
243              }
244              user.setDimension( login.getDimension() );
245              user.getServer().disconnect( "Quitting" );
246          }
247          if ( !user.isActive() )
248          {
249              server.disconnect( "Quitting" );
250              bungee.getLogger().warning( "No client connected for pending server!" );
251              return;
252          }
253          target.addPlayer( user );
254          user.getPendingConnects().remove( target );
255          user.setServerJoinQueue( null );
256          user.setDimensionChange( false );
257          ServerInfo from = ( user.getServer() == null ) ? null : user.getServer().getInfo();
258          user.setServer( server );
259          ch.getHandle().pipeline().get( HandlerBoss.class ).setHandler( new DownstreamBridge( bungee, user, server ) );
260          bungee.getPluginManager().callEvent( new ServerSwitchEvent( user, from ) );
261          thisState = State.FINISHED;
262          throw CancelSendSignal.INSTANCE;
263      }
264      @Override
265      public void handle(EncryptionRequest encryptionRequest) throws Exception
266      {
267          throw new QuietException( "Server is online mode!" );
268      }
269      @Override
270      public void handle(Kick kick) throws Exception
271      {
272          ServerInfo def = user.updateAndGetNextServer( target );
273          ServerKickEvent event = new ServerKickEvent( user, target, ComponentSerializer.parse( kick.getMessage() ), def, ServerKickEvent.State.CONNECTING );
274          if ( event.getKickReason().toLowerCase( Locale.ROOT ).contains( "outdated" ) && def != null )
275          {
276              event.setCancelled( true );
277          }
278          bungee.getPluginManager().callEvent( event );
279          if ( event.isCancelled() && event.getCancelServer() != null )
280          {
281              obsolete = true;
282              user.connect( event.getCancelServer(), ServerConnectEvent.Reason.KICK_REDIRECT );
283              throw CancelSendSignal.INSTANCE;
284          }
285          String message = bungee.getTranslation( "connect_kick", target.getName(), event.getKickReason() );
286          if ( user.isDimensionChange() )
287          {
288              user.disconnect( message );
289          } else
290          {
291              user.sendMessage( message );
292          }
293          throw CancelSendSignal.INSTANCE;
294      }
295      @Override
296      public void handle(PluginMessage pluginMessage) throws Exception
297      {
298          if ( BungeeCord.getInstance().config.isForgeSupport() )
299          {
300              if ( pluginMessage.getTag().equals( ForgeConstants.FML_REGISTER ) )
301              {
302                  Set<String> channels = ForgeUtils.readRegisteredChannels( pluginMessage );
303                  boolean isForgeServer = false;
304                  for ( String channel : channels )
305                  {
306                      if ( channel.equals( ForgeConstants.FML_HANDSHAKE_TAG ) )
307                      {
308                          if ( user.getServer() != null && user.getForgeClientHandler().isHandshakeComplete() )
309                          {
310                              user.getForgeClientHandler().resetHandshake();
311                          }
312                          isForgeServer = true;
313                          break;
314                      }
315                  }
316                  if ( isForgeServer && !this.handshakeHandler.isServerForge() )
317                  {
318                      handshakeHandler.setServerAsForgeServer();
319                      user.setForgeServerHandler( handshakeHandler );
320                  }
321              }
322              if ( pluginMessage.getTag().equals( ForgeConstants.FML_HANDSHAKE_TAG ) || pluginMessage.getTag().equals( ForgeConstants.FORGE_REGISTER ) )
323              {
324                  this.handshakeHandler.handle( pluginMessage );
325                  throw CancelSendSignal.INSTANCE;
326              }
327          }
328          user.unsafe().sendPacket( pluginMessage );
329      }
330      @Override
331      public void handle(LoginPayloadRequest loginPayloadRequest)
332      {
333          ch.write( new LoginPayloadResponse( loginPayloadRequest.getId(), null ) );
334      }
335      @Override
336      public String toString()
337      {
338          return "[" + user.getName() + "] <-> ServerConnector [" + target.getName() + "]";
339      }
340  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-BaseComponentSerializer.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-ServerConnector.java</div>
                <div class="column column_space"><pre><code>1  package net.md_5.bungee.chat;
2  import com.google.common.base.Preconditions;
3  import com.google.gson.JsonDeserializationContext;
4  import com.google.gson.JsonElement;
5  import com.google.gson.JsonObject;
6  import com.google.gson.JsonParseException;
7  import com.google.gson.JsonSerializationContext;
8  import java.util.ArrayList;
9  import java.util.Arrays;
10  import java.util.Collections;
11  import java.util.IdentityHashMap;
12  import java.util.Locale;
13  import net.md_5.bungee.api.ChatColor;
14  import net.md_5.bungee.api.chat.BaseComponent;
15  import net.md_5.bungee.api.chat.ClickEvent;
16  import net.md_5.bungee.api.chat.HoverEvent;
17  import net.md_5.bungee.api.chat.hover.content.Content;
</pre></code></div>
                <div class="column column_space"><pre><code>1  package net.md_5.bungee;
2  import com.google.common.base.Joiner;
3  import com.google.common.base.Preconditions;
4  import io.netty.buffer.ByteBuf;
5  import io.netty.buffer.ByteBufAllocator;
6  import java.net.InetSocketAddress;
7  import java.nio.charset.StandardCharsets;
8  import java.util.Locale;
9  import java.util.Queue;
10  import java.util.Set;
11  import java.util.UUID;
12  import lombok.Getter;
13  import lombok.RequiredArgsConstructor;
14  import net.md_5.bungee.api.ChatColor;
15  import net.md_5.bungee.api.ProxyServer;
16  import net.md_5.bungee.api.config.ServerInfo;
17  import net.md_5.bungee.api.event.ServerConnectEvent;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    