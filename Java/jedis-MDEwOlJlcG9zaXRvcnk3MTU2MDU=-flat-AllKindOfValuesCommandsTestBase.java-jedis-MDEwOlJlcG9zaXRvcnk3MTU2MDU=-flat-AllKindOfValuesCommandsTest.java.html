
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 429, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTestBase.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.unified;
2  import static org.hamcrest.MatcherAssert.assertThat;
3  import static org.junit.Assert.assertArrayEquals;
4  import static org.junit.Assert.assertEquals;
5  import static org.junit.Assert.assertFalse;
6  import static org.junit.Assert.assertTrue;
7  import static org.junit.Assert.assertNotNull;
8  import static org.junit.Assert.assertNull;
9  import static org.junit.Assert.fail;
10  import static redis.clients.jedis.Protocol.Command.BLPOP;
11  import static redis.clients.jedis.Protocol.Command.GET;
12  import static redis.clients.jedis.Protocol.Command.HGETALL;
13  import static redis.clients.jedis.Protocol.Command.LRANGE;
14  import static redis.clients.jedis.Protocol.Command.PING;
15  import static redis.clients.jedis.Protocol.Command.RPUSH;
16  import static redis.clients.jedis.Protocol.Command.SET;
17  import static redis.clients.jedis.Protocol.Command.XINFO;
18  import static redis.clients.jedis.util.SafeEncoder.encode;
19  import static redis.clients.jedis.util.SafeEncoder.encodeObject;
20  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
21  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
22  import java.util.ArrayList;
23  import java.util.Arrays;
24  import java.util.Collections;
25  import java.util.HashMap;
26  import java.util.HashSet;
27  import java.util.List;
28  import java.util.Set;
29  import org.hamcrest.Matchers;
30  import org.junit.Assume;
31  import org.junit.Test;
32  import redis.clients.jedis.RedisProtocol;
33  import redis.clients.jedis.ScanIteration;
34  import redis.clients.jedis.StreamEntryID;
35  import redis.clients.jedis.args.ExpiryOption;
36  import redis.clients.jedis.params.ScanParams;
37  import redis.clients.jedis.resps.ScanResult;
38  import redis.clients.jedis.params.RestoreParams;
39  import redis.clients.jedis.exceptions.JedisDataException;
40  import redis.clients.jedis.params.SetParams;
41  import redis.clients.jedis.util.AssertUtil;
42  import redis.clients.jedis.util.KeyValue;
43  import redis.clients.jedis.util.RedisProtocolUtil;
44  import redis.clients.jedis.util.SafeEncoder;
45  public abstract class AllKindOfValuesCommandsTestBase extends UnifiedJedisCommandsTestBase {
46    protected final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
47    protected final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x0A };
48    protected final byte[] bfoo2 = { 0x01, 0x02, 0x03, 0x04, 0x0B };
49    protected final byte[] bfoo3 = { 0x01, 0x02, 0x03, 0x04, 0x0C };
50    protected final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
51    protected final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
52    protected final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
53    protected final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
54    protected final byte[] bfoobar = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 };
55    protected final byte[] bfoostar = { 0x01, 0x02, 0x03, 0x04, '*' };
56    protected final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
57    protected final byte[] bnx = { 0x6E, 0x78 };
58    protected final byte[] bex = { 0x65, 0x78 };
59    final int expireSeconds = 2;
60    @Test
61    public void exists() {
62      String status = jedis.set("foo", "bar");
63      assertEquals("OK", status);
64      status = jedis.set(bfoo, bbar);
65      assertEquals("OK", status);
66      assertTrue(jedis.exists("foo"));
67      assertTrue(jedis.exists(bfoo));
68      assertEquals(1L, jedis.del("foo"));
69      assertEquals(1L, jedis.del(bfoo));
70      assertFalse(jedis.exists("foo"));
71      assertFalse(jedis.exists(bfoo));
72    }
73    @Test
74    public void existsMany() {
75      String status = jedis.set("foo1", "bar1");
76      assertEquals("OK", status);
77      status = jedis.set("foo2", "bar2");
78      assertEquals("OK", status);
79      assertEquals(2L, jedis.exists("foo1", "foo2"));
80      assertEquals(1L, jedis.del("foo1"));
81      assertEquals(1L, jedis.exists("foo1", "foo2"));
82    }
83    @Test
84    public void del() {
85      jedis.set("foo1", "bar1");
86      jedis.set("foo2", "bar2");
87      jedis.set("foo3", "bar3");
88      assertEquals(3L, jedis.del("foo1", "foo2", "foo3"));
89      assertFalse(jedis.exists("foo1"));
90      assertFalse(jedis.exists("foo2"));
91      assertFalse(jedis.exists("foo3"));
92      jedis.set("foo1", "bar1");
93      assertEquals(1L, jedis.del("foo1", "foo2"));
94      assertEquals(0L, jedis.del("foo1", "foo2"));
95      jedis.set(bfoo1, bbar1);
96      jedis.set(bfoo2, bbar2);
97      jedis.set(bfoo3, bbar3);
98      assertEquals(3L, jedis.del(bfoo1, bfoo2, bfoo3));
99      assertFalse(jedis.exists(bfoo1));
100      assertFalse(jedis.exists(bfoo2));
101      assertFalse(jedis.exists(bfoo3));
102      jedis.set(bfoo1, bbar1);
103      assertEquals(1, jedis.del(bfoo1, bfoo2));
104      assertEquals(0, jedis.del(bfoo1, bfoo2));
105    }
106    @Test
107    public void unlink() {
108      jedis.set("foo1", "bar1");
109      jedis.set("foo2", "bar2");
110      jedis.set("foo3", "bar3");
111      assertEquals(3, jedis.unlink("foo1", "foo2", "foo3"));
112      assertEquals(0, jedis.exists("foo1", "foo2", "foo3"));
113      jedis.set("foo1", "bar1");
114      assertEquals(1, jedis.unlink("foo1", "foo2"));
115      assertEquals(0, jedis.unlink("foo1", "foo2"));
116      jedis.set("foo", "bar");
117      assertEquals(1, jedis.unlink("foo"));
118      assertFalse(jedis.exists("foo"));
119      jedis.set(bfoo1, bbar1);
120      jedis.set(bfoo2, bbar2);
121      jedis.set(bfoo3, bbar3);
122      assertEquals(3, jedis.unlink(bfoo1, bfoo2, bfoo3));
123      assertEquals(0, jedis.exists(bfoo1, bfoo2, bfoo3));
124      jedis.set(bfoo1, bbar1);
125      assertEquals(1, jedis.unlink(bfoo1, bfoo2));
126      assertEquals(0, jedis.unlink(bfoo1, bfoo2));
127      jedis.set(bfoo, bbar);
128      assertEquals(1, jedis.unlink(bfoo));
129      assertFalse(jedis.exists(bfoo));
130    }
131    @Test
132    public void type() {
133      jedis.set("foo", "bar");
134      assertEquals("string", jedis.type("foo"));
135      jedis.set(bfoo, bbar);
136      assertEquals("string", jedis.type(bfoo));
137    }
138    @Test
139    public void keys() {
140      jedis.set("foo", "bar");
141      jedis.set("foobar", "bar");
142      Set<String> keys = jedis.keys("foo*");
143      AssertUtil.assertCollectionContains(keys, "foo");
144      AssertUtil.assertCollectionContains(keys, "foobar");
145      assertEquals(Collections.emptySet(), jedis.keys("bar*"));
146      jedis.set(bfoo, bbar);
147      jedis.set(bfoobar, bbar);
148      Set<byte[]> bkeys = jedis.keys(bfoostar);
149      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoo);
150      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoobar);
151      assertEquals(Collections.emptySet(), jedis.keys(bbarstar));
152    }
153    @Test
154    public void randomKey() {
155      assertNull(jedis.randomKey());
156      for (int i = 0; i < 100; i++) {
157        jedis.set("foo" + i, "bar"+i);
158      }
159      String key = jedis.randomKey();
160      assertNotNull(key);
161      assertTrue(key.startsWith("foo"));
162      assertEquals(key.replace("foo", "bar"), jedis.get(key));
163    }
164    @Test
165    public void rename() {
166      jedis.set("foo", "bar");
167      String status = jedis.rename("foo", "bar");
168      assertEquals("OK", status);
169      assertNull(jedis.get("foo"));
170      assertEquals("bar", jedis.get("bar"));
171      jedis.set(bfoo, bbar);
172      String bstatus = jedis.rename(bfoo, bbar);
173      assertEquals("OK", bstatus);
174      assertNull(jedis.get(bfoo));
175      assertArrayEquals(bbar, jedis.get(bbar));
176    }
177    @Test
178    public void renameOldAndNewAreTheSame() {
179      assertEquals("OK", jedis.set("foo", "bar"));
180      assertEquals("OK", jedis.rename("foo", "foo"));
181      assertEquals("OK", jedis.set(bfoo, bbar));
182      assertEquals("OK", jedis.rename(bfoo, bfoo));
183    }
184    @Test
185    public void renamenx() {
186      jedis.set("foo", "bar");
187      assertEquals(1, jedis.renamenx("foo", "bar"));
188      jedis.set("foo", "bar");
189      assertEquals(0, jedis.renamenx("foo", "bar"));
190      jedis.set(bfoo, bbar);
191      assertEquals(1, jedis.renamenx(bfoo, bbar));
192      jedis.set(bfoo, bbar);
193      assertEquals(0, jedis.renamenx(bfoo, bbar));
194    }
195    @Test
196    public void dbSize() {
197      assertEquals(0, jedis.dbSize());
198      jedis.set("foo", "bar");
199      assertEquals(1, jedis.dbSize());
200      jedis.set(bfoo, bbar);
201      assertEquals(2, jedis.dbSize());
202    }
203    @Test
204    public void expire() {
205      assertEquals(0, jedis.expire("foo", 20L));
206      jedis.set("foo", "bar");
207      assertEquals(1, jedis.expire("foo", 20L));
208      assertEquals(0, jedis.expire("foo", 20L, ExpiryOption.NX));
209      assertEquals(0, jedis.expire(bfoo, 20L));
210      jedis.set(bfoo, bbar);
211      assertEquals(1, jedis.expire(bfoo, 20L));
212      assertEquals(0, jedis.expire(bfoo, 20L, ExpiryOption.NX));
213    }
214    @Test
215    public void expireAt() {
216      long unixTime = (System.currentTimeMillis() / 1000L) + 20;
217      assertEquals(0, jedis.expireAt("foo", unixTime));
218      jedis.set("foo", "bar");
219      unixTime = (System.currentTimeMillis() / 1000L) + 20;
220      assertEquals(1, jedis.expireAt("foo", unixTime));
221      assertEquals(1, jedis.expireAt("foo", unixTime, ExpiryOption.XX));
222      assertEquals(0, jedis.expireAt(bfoo, unixTime));
223      jedis.set(bfoo, bbar);
224      unixTime = (System.currentTimeMillis() / 1000L) + 20;
225      assertEquals(1, jedis.expireAt(bfoo, unixTime));
226      assertEquals(1, jedis.expireAt(bfoo, unixTime, ExpiryOption.XX));
227    }
228    @Test
229    public void expireTime() {
230      long unixTime;
231      jedis.set("foo", "bar");
232      unixTime = (System.currentTimeMillis() / 1000L) + 20;
233      jedis.expireAt("foo", unixTime);
234      assertEquals(unixTime, jedis.expireTime("foo"), 0.0001);
235      jedis.set(bfoo, bbar);
236      unixTime = (System.currentTimeMillis() / 1000L) + 20;
237      jedis.expireAt(bfoo, unixTime);
238      assertEquals(unixTime, jedis.expireTime(bfoo), 0.0001);
239    }
240    @Test
241    public void ttl() {
242      assertEquals(-2, jedis.ttl("foo"));
243      jedis.set("foo", "bar");
244      assertEquals(-1, jedis.ttl("foo"));
245      jedis.expire("foo", 20);
246      long ttl = jedis.ttl("foo");
247      assertTrue(ttl >= 0 && ttl <= 20);
248      assertEquals(-2, jedis.ttl(bfoo));
249      jedis.set(bfoo, bbar);
250      assertEquals(-1, jedis.ttl(bfoo));
251      jedis.expire(bfoo, 20);
252      long bttl = jedis.ttl(bfoo);
253      assertTrue(bttl >= 0 && bttl <= 20);
254    }
255    @Test
256    public void touch() throws Exception {
257      assertEquals(0, jedis.touch("foo1", "foo2", "foo3"));
258      jedis.set("foo1", "bar1");
259      Thread.sleep(1100); 
260      assertTrue(jedis.objectIdletime("foo1") > 0);
261      assertEquals(1, jedis.touch("foo1"));
262      assertEquals(0L, jedis.objectIdletime("foo1").longValue());
263      assertEquals(1, jedis.touch("foo1", "foo2", "foo3"));
264      jedis.set("foo2", "bar2");
265      jedis.set("foo3", "bar3");
266      assertEquals(3, jedis.touch("foo1", "foo2", "foo3"));
267      assertEquals(0, jedis.touch(bfoo1, bfoo2, bfoo3));
268      jedis.set(bfoo1, bbar1);
269      Thread.sleep(1100); 
270      assertTrue(jedis.objectIdletime(bfoo1) > 0);
271      assertEquals(1, jedis.touch(bfoo1));
272      assertEquals(0L, jedis.objectIdletime(bfoo1).longValue());
273      assertEquals(1, jedis.touch(bfoo1, bfoo2, bfoo3));
274      jedis.set(bfoo2, bbar2);
275      jedis.set(bfoo3, bbar3);
276      assertEquals(3, jedis.touch(bfoo1, bfoo2, bfoo3));
277    }
278    @Test
279    public void persist() {
280      jedis.setex("foo", 60 * 60, "bar");
281      assertTrue(jedis.ttl("foo") > 0);
282      assertEquals(1, jedis.persist("foo"));
283      assertEquals(-1, jedis.ttl("foo"));
284      jedis.setex(bfoo, 60 * 60, bbar);
285      assertTrue(jedis.ttl(bfoo) > 0);
286      assertEquals(1, jedis.persist(bfoo));
287      assertEquals(-1, jedis.ttl(bfoo));
288    }
289    @Test
290    public void dumpAndRestore() {
291      jedis.set("foo1", "bar");
292      byte[] sv = jedis.dump("foo1");
293      jedis.restore("foo2", 0, sv);
294      assertEquals("bar", jedis.get("foo2"));
295      jedis.set(bfoo1, bbar);
296      sv = jedis.dump(bfoo1);
297      jedis.restore(bfoo2, 0, sv);
298      assertArrayEquals(bbar, jedis.get(bfoo2));
299    }
300    @Test
301    public void restoreParams() {
302      jedis.set("foo", "bar");
303      jedis.set("from", "a");
304      byte[] serialized = jedis.dump("from");
305      try {
306        jedis.restore("foo", 0, serialized);
307        fail("Simple restore on a existing key should fail");
308      } catch (JedisDataException e) {
309      }
310      try {
311        jedis.restore("foo", 0, serialized, RestoreParams.restoreParams());
312        fail("Simple restore on a existing key should fail");
313      } catch (JedisDataException e) {
314      }
315      assertEquals("bar", jedis.get("foo"));
316      jedis.restore("foo", 1000, serialized, RestoreParams.restoreParams().replace());
317      assertEquals("a", jedis.get("foo"));
318      assertTrue(jedis.pttl("foo") <= 1000);
319      jedis.restore("bar", System.currentTimeMillis() + 1000, serialized, RestoreParams.restoreParams().replace().absTtl());
320      assertTrue(jedis.pttl("bar") <= 1000);
321      jedis.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().idleTime(1000));
322      assertEquals(1000, jedis.objectIdletime("bar1").longValue());
323    }
324    @Test
325    public void pexpire() {
326      assertEquals(0, jedis.pexpire("foo", 10000));
327      jedis.set("foo1", "bar1");
328      assertEquals(1, jedis.pexpire("foo1", 10000));
329      jedis.set("foo2", "bar2");
330      assertEquals(1, jedis.pexpire("foo2", 200000000000L));
331      assertEquals(0, jedis.pexpire("foo2", 10000000, ExpiryOption.NX));
332      assertEquals(1, jedis.pexpire("foo2", 10000000, ExpiryOption.XX));
333      assertEquals(0, jedis.pexpire("foo2", 10000, ExpiryOption.GT));
334      assertEquals(1, jedis.pexpire("foo2", 10000, ExpiryOption.LT));
335      long pttl = jedis.pttl("foo2");
336      assertTrue(pttl > 100L);
337      assertEquals(0, jedis.pexpire(bfoo, 10000));
338      jedis.set(bfoo, bbar);
339      assertEquals(1, jedis.pexpire(bfoo, 10000));
340      assertEquals(0, jedis.pexpire(bfoo, 10000, ExpiryOption.NX));
341    }
342    @Test
343    public void pexpireAt() {
344      long unixTime = (System.currentTimeMillis()) + 10000;
345      assertEquals(0, jedis.pexpireAt("foo", unixTime));
346      jedis.set("foo", "bar");
347      assertEquals(1, jedis.pexpireAt("foo", unixTime));
348      assertEquals(0, jedis.pexpireAt(bfoo, unixTime));
349      jedis.set(bfoo, bbar);
350      assertEquals(1, jedis.pexpireAt(bfoo, unixTime));
351    }
352    @Test
353    public void pexpireTime() {
354      long unixTime = (System.currentTimeMillis()) + 10000;
355      jedis.set("foo", "bar");
356      jedis.pexpireAt("foo", unixTime);
357      assertEquals(unixTime, jedis.pexpireTime("foo"), 0.0001);
358      jedis.set(bfoo, bbar);
359      jedis.pexpireAt(bfoo, unixTime);
360      assertEquals(unixTime, jedis.pexpireTime(bfoo), 0.0001);
361    }
362    @Test
363    public void pttl() {
364      assertEquals(-2, jedis.pttl("foo"));
365      jedis.set("foo", "bar");
366      assertEquals(-1, jedis.pttl("foo"));
367      jedis.pexpire("foo", 20000);
368      long pttl = jedis.pttl("foo");
369      assertTrue(pttl >= 0 && pttl <= 20000);
370      assertEquals(-2, jedis.pttl(bfoo));
371      jedis.set(bfoo, bbar);
372      assertEquals(-1, jedis.pttl(bfoo));
373      jedis.pexpire(bfoo, 20000);
374      pttl = jedis.pttl(bfoo);
375      assertTrue(pttl >= 0 && pttl <= 20000);
376    }
377    @Test
378    public void psetex() {
379      long pttl;
380      jedis.psetex("foo", 200000000000L, "bar");
381      pttl = jedis.pttl("foo");
382      assertTrue(pttl > 100000000000L);
383      jedis.psetex(bfoo, 200000000000L, bbar);
384      pttl = jedis.pttl(bfoo);
385      assertTrue(pttl > 100000000000L);
386    }
387    @Test
388    public void scan() {
389      jedis.set("b", "b");
390      jedis.set("a", "a");
391      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
392      assertEquals(SCAN_POINTER_START, result.getCursor());
393      assertFalse(result.getResult().isEmpty());
394      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY);
395      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
396      assertFalse(bResult.getResult().isEmpty());
397    }
398    @Test
399    public void scanMatch() {
400      ScanParams params = new ScanParams();
401      params.match("a*");
402      jedis.set("b", "b");
403      jedis.set("a", "a");
404      jedis.set("aa", "aa");
405      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
406      assertEquals(SCAN_POINTER_START, result.getCursor());
407      assertFalse(result.getResult().isEmpty());
408      params = new ScanParams();
409      params.match(bfoostar);
410      jedis.set(bfoo1, bbar);
411      jedis.set(bfoo2, bbar);
412      jedis.set(bfoo3, bbar);
413      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
414      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
415      assertFalse(bResult.getResult().isEmpty());
416    }
417    @Test
418    public void scanCount() {
419      ScanParams params = new ScanParams();
420      params.count(2);
421      for (int i = 0; i < 10; i++) {
422        jedis.set("a" + i, "a" + i);
423      }
424      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
425      assertFalse(result.getResult().isEmpty());
426      params = new ScanParams();
427      params.count(2);
428      jedis.set(bfoo1, bbar);
429      jedis.set(bfoo2, bbar);
430      jedis.set(bfoo3, bbar);
431      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
432      assertFalse(bResult.getResult().isEmpty());
433    }
434    @Test
435    public void scanType() {
436      ScanParams noParams = new ScanParams();
437      ScanParams pagingParams = new ScanParams().count(4);
438      jedis.set("a", "a");
439      jedis.hset("b", "b", "b");
440      jedis.set("c", "c");
441      jedis.sadd("d", "d");
442      jedis.set("e", "e");
443      jedis.zadd("f", 0d, "f");
444      jedis.set("g", "g");
445      ScanResult<String> scanResult;
446      scanResult = jedis.scan(SCAN_POINTER_START, pagingParams, "string");
447      assertFalse(scanResult.isCompleteIteration());
448      int page1Count = scanResult.getResult().size();
449      scanResult = jedis.scan(scanResult.getCursor(), pagingParams, "string");
450      assertTrue(scanResult.isCompleteIteration());
451      int page2Count = scanResult.getResult().size();
452      assertEquals(4, page1Count + page2Count);
453      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "hash");
454      assertEquals(Collections.singletonList("b"), scanResult.getResult());
455      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "set");
456      assertEquals(Collections.singletonList("d"), scanResult.getResult());
457      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "zset");
458      assertEquals(Collections.singletonList("f"), scanResult.getResult());
459      final byte[] string = "string".getBytes();
460      final byte[] hash = "hash".getBytes();
461      final byte[] set = "set".getBytes();
462      final byte[] zset = "zset".getBytes();
463      ScanResult<byte[]> binaryResult;
464      jedis.set("a", "a");
465      jedis.hset("b", "b", "b");
466      jedis.set("c", "c");
467      jedis.sadd("d", "d");
468      jedis.set("e", "e");
469      jedis.zadd("f", 0d, "f");
470      jedis.set("g", "g");
471      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, pagingParams, string);
472      assertFalse(binaryResult.isCompleteIteration());
473      page1Count = binaryResult.getResult().size();
474      binaryResult = jedis.scan(binaryResult.getCursorAsBytes(), pagingParams, string);
475      assertTrue(binaryResult.isCompleteIteration());
476      page2Count = binaryResult.getResult().size();
477      assertEquals(4, page1Count + page2Count);
478      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, hash);
479      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{98}), binaryResult.getResult());
480      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, set);
481      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{100}), binaryResult.getResult());
482      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, zset);
483      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{102}), binaryResult.getResult());
484    }
485    @Test
486    public void scanIsCompleteIteration() {
487      for (int i = 0; i < 100; i++) {
488        jedis.set("a" + i, "a" + i);
489      }
490      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
491      assertFalse(result.isCompleteIteration());
492      result = scanCompletely(result.getCursor());
493      assertNotNull(result);
494      assertTrue(result.isCompleteIteration());
495    }
496    private ScanResult<String> scanCompletely(String cursor) {
497      ScanResult<String> scanResult;
498      do {
499        scanResult = jedis.scan(cursor);
<span onclick='openModal()' class='match'>500        cursor = scanResult.getCursor();
501      } while (!SCAN_POINTER_START.equals(scanResult.getCursor()));
502      return scanResult;
503    }
504    @Test
505    public void setNxExAndGet() {
506      assertEquals("OK", jedis.set("hello", "world", SetParams.setParams().nx().ex(expireSeconds)));
507      assertEquals("world", jedis.get("hello"));
508      assertNull(jedis.set("hello", "bar", SetParams.setParams().nx().ex(expireSeconds)));
509      assertEquals("world", jedis.get("hello"));
510      long ttl = jedis.ttl("hello");
511      assertTrue(ttl > 0 && ttl <= expireSeconds);
512      byte[] bworld = { 0x77, 0x6F, 0x72, 0x6C, 0x64 };
513      byte[] bhello = { 0x68, 0x65, 0x6C, 0x6C, 0x6F };
514      assertEquals("OK", jedis.set(bworld, bhello, SetParams.setParams().nx().ex(expireSeconds)));
515      assertArrayEquals(bhello, jedis.get(bworld));
516      assertNull(jedis.set(bworld, bbar, SetParams.setParams().nx().ex(expireSeconds)));
517      assertArrayEquals(bhello, jedis.get(bworld));
518      long bttl = jedis.ttl(bworld);
519      assertTrue(bttl > 0 && bttl <= expireSeconds);
520    }
521    @Test
522    public void setGetOptionTest() {
523      assertEquals("OK", jedis.set("hello", "world"));
524      assertEquals("world", jedis.setGet("hello", "jedis"));
525      assertEquals("jedis", jedis.get("hello"));
526      assertNull(jedis.setGet("key", "value"));
527    }
528    @Test
529    public void setGet() {
530      assertEquals("OK", jedis.set("hello", "world"));
531      assertEquals("world", jedis.setGet("hello", "jedis", SetParams.setParams()));
532      assertEquals("jedis", jedis.get("hello"));
533      assertNull(jedis.setGet("key", "value", SetParams.setParams()));
534    }
535    @Test
536    public void sendCommandTest() {
537      Object obj = jedis.sendCommand(SET, "x", "1");
538      String returnValue = encode((byte[]) obj);
</span>539      assertEquals("OK", returnValue);
540      obj = jedis.sendCommand(GET, "x");
541      returnValue = encode((byte[]) obj);
542      assertEquals("1", returnValue);
543      jedis.sendCommand(RPUSH, "foo", "a");
544      jedis.sendCommand(RPUSH, "foo", "b");
545      jedis.sendCommand(RPUSH, "foo", "c");
546      obj = jedis.sendCommand(LRANGE, "foo", "0", "2");
547      List<byte[]> list = (List<byte[]>) obj;
548      List<byte[]> expected = new ArrayList<>(3);
549      expected.add("a".getBytes());
550      expected.add("b".getBytes());
551      expected.add("c".getBytes());
552      for (int i = 0; i < 3; i++)
553        assertArrayEquals(expected.get(i), list.get(i));
554      assertEquals("PONG", encode((byte[]) jedis.sendCommand(PING)));
555    }
556    @Test
557    public void sendBlockingCommandTest() {
558      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
559      jedis.sendCommand(RPUSH, "foo", "bar");
560      assertEquals(Arrays.asList("foo", "bar"),
561        encodeObject(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L))));
562      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
563    }
564    @Test
565    public void encodeCompleteResponsePing() {
566      assertEquals("PONG", SafeEncoder.encodeObject(jedis.sendCommand(PING)));
567    }
568    @Test
569    public void encodeCompleteResponseHgetall() {
570      Assume.assumeFalse(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
571      HashMap<String, String> entries = new HashMap<>();
572      entries.put("foo", "bar");
573      entries.put("foo2", "bar2");
574      jedis.hset("hash:test:encode", entries);
575      List encodeObj = (List) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
576      assertEquals(4, encodeObj.size());
577      entries.forEach((k, v) -> {
578        assertThat((Iterable<String>) encodeObj, Matchers.hasItem(k));
579        assertEquals(v, findValueFromMapAsList(encodeObj, k));
580      });
581    }
582    @Test
583    public void encodeCompleteResponseHgetallResp3() {
584      Assume.assumeTrue(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
585      HashMap<String, String> entries = new HashMap<>();
586      entries.put("foo", "bar");
587      entries.put("foo2", "bar2");
588      jedis.hset("hash:test:encode", entries);
589      List<KeyValue> encodeObj = (List<KeyValue>) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
590      assertEquals(2, encodeObj.size());
591      encodeObj.forEach(kv -> {
592        assertThat(entries, Matchers.hasEntry(kv.getKey(), kv.getValue()));
593      });
594    }
595    @Test
596    public void encodeCompleteResponseXinfoStream() {
597      Assume.assumeFalse(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
598      HashMap<String, String> entry = new HashMap<>();
599      entry.put("foo", "bar");
600      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
601      jedis.xgroupCreate("mystream", "mygroup", null, false);
602      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
603      List encodeObj = (List) SafeEncoder.encodeObject(obj);
604      assertThat(encodeObj.size(), Matchers.greaterThanOrEqualTo(14));
605      assertEquals("must have even number of elements", 0, encodeObj.size() % 2); 
606      assertEquals(1L, findValueFromMapAsList(encodeObj, "length"));
607      assertEquals(entryID.toString(), findValueFromMapAsList(encodeObj, "last-generated-id"));
608      List<String> entryAsList = new ArrayList<>(2);
609      entryAsList.add("foo");
610      entryAsList.add("bar");
611      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "first-entry")).get(1));
612      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "last-entry")).get(1));
613    }
614    @Test
615    public void encodeCompleteResponseXinfoStreamResp3() {
616      Assume.assumeTrue(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
617      HashMap<String, String> entry = new HashMap<>();
618      entry.put("foo", "bar");
619      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
620      jedis.xgroupCreate("mystream", "mygroup", null, false);
621      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
622      List<KeyValue> encodeObj = (List<KeyValue>) SafeEncoder.encodeObject(obj);
623      assertThat(encodeObj.size(), Matchers.greaterThanOrEqualTo(7));
624      assertEquals(1L, findValueFromMapAsKeyValueList(encodeObj, "length"));
625      assertEquals(entryID.toString(), findValueFromMapAsKeyValueList(encodeObj, "last-generated-id"));
626      List<String> entryAsList = new ArrayList<>(2);
627      entryAsList.add("foo");
628      entryAsList.add("bar");
629      assertEquals(entryAsList, ((List) findValueFromMapAsKeyValueList(encodeObj, "first-entry")).get(1));
630      assertEquals(entryAsList, ((List) findValueFromMapAsKeyValueList(encodeObj, "last-entry")).get(1));
631    }
632    private Object findValueFromMapAsList(List list, Object key) {
633      for (int i = 0; i < list.size(); i += 2) {
634        if (key.equals(list.get(i))) {
635          return list.get(i + 1);
636        }
637      }
638      return null;
639    }
640    private Object findValueFromMapAsKeyValueList(List<KeyValue> list, Object key) {
641      for (KeyValue kv : list) {
642        if (key.equals(kv.getKey())) {
643          return kv.getValue();
644        }
645      }
646      return null;
647    }
648    @Test
649    public void copy() {
650      assertFalse(jedis.copy("unknown", "foo", false));
651      jedis.set("foo1", "bar");
652      assertTrue(jedis.copy("foo1", "foo2", false));
653      assertEquals("bar", jedis.get("foo2"));
654      jedis.set("foo1", "bar1");
655      assertTrue(jedis.copy("foo1", "foo2", true));
656      assertEquals("bar1", jedis.get("foo2"));
657      assertFalse(jedis.copy(bfoobar, bfoo, false));
658      jedis.set(bfoo1, bbar);
659      assertTrue(jedis.copy(bfoo1, bfoo2, false));
660      assertArrayEquals(bbar, jedis.get(bfoo2));
661      jedis.set(bfoo1, bbar1);
662      assertTrue(jedis.copy(bfoo1, bfoo2, true));
663      assertArrayEquals(bbar1, jedis.get(bfoo2));
664    }
665    @Test
666    public void scanIteration() {
667      Set<String> allIn = new HashSet<>(26 * 26);
668      char[] arr = new char[2];
669      for (int i = 0; i < 26; i++) {
670        arr[0] = (char) ('a' + i);
671        for (int j = 0; j < 26; j++) {
672          arr[1] = (char) ('a' + j);
673          String str = new String(arr);
674          jedis.incr(str);
675          allIn.add(str);
676        }
677      }
678      Set<String> allScan = new HashSet<>();
679      ScanIteration scan = jedis.scanIteration(10, "*");
680      while (!scan.isIterationCompleted()) {
681        ScanResult<String> batch = scan.nextBatch();
682        allScan.addAll(batch.getResult());
683      }
684      assertEquals(allIn, allScan);
685    }
686  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.hamcrest.MatcherAssert.assertThat;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.Protocol.Command.BLPOP;
5  import static redis.clients.jedis.Protocol.Command.HGETALL;
6  import static redis.clients.jedis.Protocol.Command.GET;
7  import static redis.clients.jedis.Protocol.Command.LRANGE;
8  import static redis.clients.jedis.Protocol.Command.PING;
9  import static redis.clients.jedis.Protocol.Command.RPUSH;
10  import static redis.clients.jedis.Protocol.Command.SET;
11  import static redis.clients.jedis.Protocol.Command.XINFO;
12  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
13  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
14  import java.util.*;
15  import org.hamcrest.Matchers;
16  import org.junit.Assume;
17  import org.junit.Test;
18  import redis.clients.jedis.HostAndPort;
19  import redis.clients.jedis.Jedis;
20  import redis.clients.jedis.args.ExpiryOption;
21  import redis.clients.jedis.params.ScanParams;
22  import redis.clients.jedis.resps.ScanResult;
23  import redis.clients.jedis.StreamEntryID;
24  import redis.clients.jedis.args.FlushMode;
25  import redis.clients.jedis.params.RestoreParams;
26  import redis.clients.jedis.HostAndPorts;
27  import redis.clients.jedis.RedisProtocol;
28  import redis.clients.jedis.util.SafeEncoder;
29  import redis.clients.jedis.exceptions.JedisDataException;
30  import redis.clients.jedis.params.SetParams;
31  import redis.clients.jedis.util.AssertUtil;
32  import redis.clients.jedis.util.KeyValue;
33  import redis.clients.jedis.util.RedisProtocolUtil;
34  public class AllKindOfValuesCommandsTest extends JedisCommandsTestBase {
35    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
36    final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x0A };
37    final byte[] bfoo2 = { 0x01, 0x02, 0x03, 0x04, 0x0B };
38    final byte[] bfoo3 = { 0x01, 0x02, 0x03, 0x04, 0x0C };
39    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
40    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
41    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
42    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
43    final byte[] bfoobar = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 };
44    final byte[] bfoostar = { 0x01, 0x02, 0x03, 0x04, '*' };
45    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
46    final byte[] bnx = { 0x6E, 0x78 };
47    final byte[] bex = { 0x65, 0x78 };
48    final int expireSeconds = 2;
49    private static final HostAndPort lfuHnp = HostAndPorts.getRedisServers().get(7);
50    @Test
51    public void ping() {
52      String status = jedis.ping();
53      assertEquals("PONG", status);
54    }
55    @Test
56    public void pingWithMessage() {
57      String argument = "message";
58      assertEquals(argument, jedis.ping(argument));
59      assertArrayEquals(bfoobar, jedis.ping(bfoobar));
60    }
61    @Test
62    public void exists() {
63      String status = jedis.set("foo", "bar");
64      assertEquals("OK", status);
65      status = jedis.set(bfoo, bbar);
66      assertEquals("OK", status);
67      assertTrue(jedis.exists("foo"));
68      assertTrue(jedis.exists(bfoo));
69      assertEquals(1L, jedis.del("foo"));
70      assertEquals(1L, jedis.del(bfoo));
71      assertFalse(jedis.exists("foo"));
72      assertFalse(jedis.exists(bfoo));
73    }
74    @Test
75    public void existsMany() {
76      String status = jedis.set("foo1", "bar1");
77      assertEquals("OK", status);
78      status = jedis.set("foo2", "bar2");
79      assertEquals("OK", status);
80      assertEquals(2L, jedis.exists("foo1", "foo2"));
81      assertEquals(1L, jedis.del("foo1"));
82      assertEquals(1L, jedis.exists("foo1", "foo2"));
83    }
84    @Test
85    public void del() {
86      jedis.set("foo1", "bar1");
87      jedis.set("foo2", "bar2");
88      jedis.set("foo3", "bar3");
89      assertEquals(3L, jedis.del("foo1", "foo2", "foo3"));
90      assertFalse(jedis.exists("foo1"));
91      assertFalse(jedis.exists("foo2"));
92      assertFalse(jedis.exists("foo3"));
93      jedis.set("foo1", "bar1");
94      assertEquals(1L, jedis.del("foo1", "foo2"));
95      assertEquals(0L, jedis.del("foo1", "foo2"));
96      jedis.set(bfoo1, bbar1);
97      jedis.set(bfoo2, bbar2);
98      jedis.set(bfoo3, bbar3);
99      assertEquals(3L, jedis.del(bfoo1, bfoo2, bfoo3));
100      assertFalse(jedis.exists(bfoo1));
101      assertFalse(jedis.exists(bfoo2));
102      assertFalse(jedis.exists(bfoo3));
103      jedis.set(bfoo1, bbar1);
104      assertEquals(1, jedis.del(bfoo1, bfoo2));
105      assertEquals(0, jedis.del(bfoo1, bfoo2));
106    }
107    @Test
108    public void unlink() {
109      jedis.set("foo1", "bar1");
110      jedis.set("foo2", "bar2");
111      jedis.set("foo3", "bar3");
112      assertEquals(3, jedis.unlink("foo1", "foo2", "foo3"));
113      assertEquals(0, jedis.exists("foo1", "foo2", "foo3"));
114      jedis.set("foo1", "bar1");
115      assertEquals(1, jedis.unlink("foo1", "foo2"));
116      assertEquals(0, jedis.unlink("foo1", "foo2"));
117      jedis.set("foo", "bar");
118      assertEquals(1, jedis.unlink("foo"));
119      assertFalse(jedis.exists("foo"));
120      jedis.set(bfoo1, bbar1);
121      jedis.set(bfoo2, bbar2);
122      jedis.set(bfoo3, bbar3);
123      assertEquals(3, jedis.unlink(bfoo1, bfoo2, bfoo3));
124      assertEquals(0, jedis.exists(bfoo1, bfoo2, bfoo3));
125      jedis.set(bfoo1, bbar1);
126      assertEquals(1, jedis.unlink(bfoo1, bfoo2));
127      assertEquals(0, jedis.unlink(bfoo1, bfoo2));
128      jedis.set(bfoo, bbar);
129      assertEquals(1, jedis.unlink(bfoo));
130      assertFalse(jedis.exists(bfoo));
131    }
132    @Test
133    public void type() {
134      jedis.set("foo", "bar");
135      assertEquals("string", jedis.type("foo"));
136      jedis.set(bfoo, bbar);
137      assertEquals("string", jedis.type(bfoo));
138    }
139    @Test
140    public void keys() {
141      jedis.set("foo", "bar");
142      jedis.set("foobar", "bar");
143      Set<String> keys = jedis.keys("foo*");
144      AssertUtil.assertCollectionContains(keys, "foo");
145      AssertUtil.assertCollectionContains(keys, "foobar");
146      assertEquals(Collections.emptySet(), jedis.keys("bar*"));
147      jedis.set(bfoo, bbar);
148      jedis.set(bfoobar, bbar);
149      Set<byte[]> bkeys = jedis.keys(bfoostar);
150      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoo);
151      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoobar);
152      assertEquals(Collections.emptySet(), jedis.keys(bbarstar));
153    }
154    @Test
155    public void randomKey() {
156      assertNull(jedis.randomKey());
157      jedis.set("foo", "bar");
158      assertEquals("foo", jedis.randomKey());
159      jedis.set("bar", "foo");
160      String randomkey = jedis.randomKey();
161      assertTrue(randomkey.equals("foo") || randomkey.equals("bar"));
162      jedis.del("foo");
163      jedis.del("bar");
164      assertNull(jedis.randomKey());
165      jedis.set(bfoo, bbar);
166      assertArrayEquals(bfoo, jedis.randomBinaryKey());
167      jedis.set(bbar, bfoo);
168      byte[] randomBkey = jedis.randomBinaryKey();
169      assertTrue(Arrays.equals(randomBkey, bfoo) || Arrays.equals(randomBkey, bbar));
170    }
171    @Test
172    public void rename() {
173      jedis.set("foo", "bar");
174      String status = jedis.rename("foo", "bar");
175      assertEquals("OK", status);
176      assertNull(jedis.get("foo"));
177      assertEquals("bar", jedis.get("bar"));
178      jedis.set(bfoo, bbar);
179      String bstatus = jedis.rename(bfoo, bbar);
180      assertEquals("OK", bstatus);
181      assertNull(jedis.get(bfoo));
182      assertArrayEquals(bbar, jedis.get(bbar));
183    }
184    @Test
185    public void renameOldAndNewAreTheSame() {
186      assertEquals("OK", jedis.set("foo", "bar"));
187      assertEquals("OK", jedis.rename("foo", "foo"));
188      assertEquals("OK", jedis.set(bfoo, bbar));
189      assertEquals("OK", jedis.rename(bfoo, bfoo));
190    }
191    @Test
192    public void renamenx() {
193      jedis.set("foo", "bar");
194      assertEquals(1, jedis.renamenx("foo", "bar"));
195      jedis.set("foo", "bar");
196      assertEquals(0, jedis.renamenx("foo", "bar"));
197      jedis.set(bfoo, bbar);
198      assertEquals(1, jedis.renamenx(bfoo, bbar));
199      jedis.set(bfoo, bbar);
200      assertEquals(0, jedis.renamenx(bfoo, bbar));
201    }
202    @Test
203    public void dbSize() {
204      assertEquals(0, jedis.dbSize());
205      jedis.set("foo", "bar");
206      assertEquals(1, jedis.dbSize());
207      jedis.set(bfoo, bbar);
208      assertEquals(2, jedis.dbSize());
209    }
210    @Test
211    public void expire() {
212      assertEquals(0, jedis.expire("foo", 20L));
213      jedis.set("foo", "bar");
214      assertEquals(1, jedis.expire("foo", 20L));
215      assertEquals(0, jedis.expire("foo", 20L, ExpiryOption.NX));
216      assertEquals(0, jedis.expire(bfoo, 20L));
217      jedis.set(bfoo, bbar);
218      assertEquals(1, jedis.expire(bfoo, 20L));
219      assertEquals(0, jedis.expire(bfoo, 20L, ExpiryOption.NX));
220    }
221    @Test
222    public void expireAt() {
223      long unixTime = (System.currentTimeMillis() / 1000L) + 20;
224      assertEquals(0, jedis.expireAt("foo", unixTime));
225      jedis.set("foo", "bar");
226      unixTime = (System.currentTimeMillis() / 1000L) + 20;
227      assertEquals(1, jedis.expireAt("foo", unixTime));
228      assertEquals(1, jedis.expireAt("foo", unixTime, ExpiryOption.XX));
229      assertEquals(0, jedis.expireAt(bfoo, unixTime));
230      jedis.set(bfoo, bbar);
231      unixTime = (System.currentTimeMillis() / 1000L) + 20;
232      assertEquals(1, jedis.expireAt(bfoo, unixTime));
233      assertEquals(1, jedis.expireAt(bfoo, unixTime, ExpiryOption.XX));
234    }
235    @Test
236    public void expireTime() {
237      long unixTime;
238      jedis.set("foo", "bar");
239      unixTime = (System.currentTimeMillis() / 1000L) + 20;
240      jedis.expireAt("foo", unixTime);
241      assertEquals(unixTime, jedis.expireTime("foo"), 0.0001);
242      jedis.set(bfoo, bbar);
243      unixTime = (System.currentTimeMillis() / 1000L) + 20;
244      jedis.expireAt(bfoo, unixTime);
245      assertEquals(unixTime, jedis.expireTime(bfoo), 0.0001);
246    }
247    @Test
248    public void ttl() {
249      assertEquals(-2, jedis.ttl("foo"));
250      jedis.set("foo", "bar");
251      assertEquals(-1, jedis.ttl("foo"));
252      jedis.expire("foo", 20);
253      long ttl = jedis.ttl("foo");
254      assertTrue(ttl >= 0 && ttl <= 20);
255      assertEquals(-2, jedis.ttl(bfoo));
256      jedis.set(bfoo, bbar);
257      assertEquals(-1, jedis.ttl(bfoo));
258      jedis.expire(bfoo, 20);
259      long bttl = jedis.ttl(bfoo);
260      assertTrue(bttl >= 0 && bttl <= 20);
261    }
262    @Test
263    public void touch() throws Exception {
264      assertEquals(0, jedis.touch("foo1", "foo2", "foo3"));
265      jedis.set("foo1", "bar1");
266      Thread.sleep(1100); 
267      assertTrue(jedis.objectIdletime("foo1") > 0);
268      assertEquals(1, jedis.touch("foo1"));
269      assertEquals(0L, jedis.objectIdletime("foo1").longValue());
270      assertEquals(1, jedis.touch("foo1", "foo2", "foo3"));
271      jedis.set("foo2", "bar2");
272      jedis.set("foo3", "bar3");
273      assertEquals(3, jedis.touch("foo1", "foo2", "foo3"));
274      assertEquals(0, jedis.touch(bfoo1, bfoo2, bfoo3));
275      jedis.set(bfoo1, bbar1);
276      Thread.sleep(1100); 
277      assertTrue(jedis.objectIdletime(bfoo1) > 0);
278      assertEquals(1, jedis.touch(bfoo1));
279      assertEquals(0L, jedis.objectIdletime(bfoo1).longValue());
280      assertEquals(1, jedis.touch(bfoo1, bfoo2, bfoo3));
281      jedis.set(bfoo2, bbar2);
282      jedis.set(bfoo3, bbar3);
283      assertEquals(3, jedis.touch(bfoo1, bfoo2, bfoo3));
284    }
285    @Test
286    public void select() {
287      jedis.set("foo", "bar");
288      String status = jedis.select(1);
289      assertEquals("OK", status);
290      assertNull(jedis.get("foo"));
291      status = jedis.select(0);
292      assertEquals("OK", status);
293      assertEquals("bar", jedis.get("foo"));
294      jedis.set(bfoo, bbar);
295      String bstatus = jedis.select(1);
296      assertEquals("OK", bstatus);
297      assertNull(jedis.get(bfoo));
298      bstatus = jedis.select(0);
299      assertEquals("OK", bstatus);
300      assertArrayEquals(bbar, jedis.get(bfoo));
301    }
302    @Test
303    public void getDB() {
304      assertEquals(0, jedis.getDB());
305      jedis.select(1);
306      assertEquals(1, jedis.getDB());
307    }
308    @Test
309    public void move() {
310      assertEquals(0, jedis.move("foo", 1));
311      jedis.set("foo", "bar");
312      assertEquals(1, jedis.move("foo", 1));
313      assertNull(jedis.get("foo"));
314      jedis.select(1);
315      assertEquals("bar", jedis.get("foo"));
316      jedis.select(0);
317      assertEquals(0, jedis.move(bfoo, 1));
318      jedis.set(bfoo, bbar);
319      assertEquals(1, jedis.move(bfoo, 1));
320      assertNull(jedis.get(bfoo));
321      jedis.select(1);
322      assertArrayEquals(bbar, jedis.get(bfoo));
323    }
324    @Test
325    public void swapDB() {
326      jedis.set("foo1", "bar1");
327      jedis.select(1);
328      assertNull(jedis.get("foo1"));
329      jedis.set("foo2", "bar2");
330      String status = jedis.swapDB(0, 1);
331      assertEquals("OK", status);
332      assertEquals("bar1", jedis.get("foo1"));
333      assertNull(jedis.get("foo2"));
334      jedis.select(0);
335      assertNull(jedis.get("foo1"));
336      assertEquals("bar2", jedis.get("foo2"));
337      jedis.set(bfoo1, bbar1);
338      jedis.select(1);
339      assertArrayEquals(null, jedis.get(bfoo1));
340      jedis.set(bfoo2, bbar2);
341      status = jedis.swapDB(0, 1);
342      assertEquals("OK", status);
343      assertArrayEquals(bbar1, jedis.get(bfoo1));
344      assertArrayEquals(null, jedis.get(bfoo2));
345      jedis.select(0);
346      assertArrayEquals(null, jedis.get(bfoo1));
347      assertArrayEquals(bbar2, jedis.get(bfoo2));
348    }
349    @Test
350    public void flushDB() {
351      jedis.set("foo", "bar");
352      assertEquals(1, jedis.dbSize());
353      jedis.set("bar", "foo");
354      jedis.move("bar", 1);
355      String status = jedis.flushDB();
356      assertEquals("OK", status);
357      assertEquals(0, jedis.dbSize());
358      jedis.select(1);
359      assertEquals(1, jedis.dbSize());
360      assertEquals("OK", jedis.flushDB(FlushMode.SYNC));
361      assertEquals(0, jedis.dbSize());
362      jedis.select(0);
363      jedis.set(bfoo, bbar);
364      assertEquals(1, jedis.dbSize());
365      jedis.set(bbar, bfoo);
366      jedis.move(bbar, 1);
367      String bstatus = jedis.flushDB();
368      assertEquals("OK", bstatus);
369      assertEquals(0, jedis.dbSize());
370      jedis.select(1);
371      assertEquals(1, jedis.dbSize());
372      assertEquals("OK", jedis.flushDB(FlushMode.ASYNC));
373      assertEquals(0, jedis.dbSize());
374    }
375    @Test
376    public void flushAll() {
377      jedis.set("foo", "bar");
378      assertEquals(1, jedis.dbSize());
379      jedis.set("bar", "foo");
380      jedis.move("bar", 1);
381      String status = jedis.flushAll();
382      assertEquals("OK", status);
383      assertEquals(0, jedis.dbSize());
384      jedis.select(1);
385      assertEquals(0, jedis.dbSize());
386      jedis.set("foo", "bar");
387      assertEquals(1, jedis.dbSize());
388      assertEquals("OK", jedis.flushAll(FlushMode.SYNC));
389      assertEquals(0, jedis.dbSize());
390      jedis.select(0);
391      jedis.set(bfoo, bbar);
392      assertEquals(1, jedis.dbSize());
393      jedis.set(bbar, bfoo);
394      jedis.move(bbar, 1);
395      String bstatus = jedis.flushAll();
396      assertEquals("OK", bstatus);
397      assertEquals(0, jedis.dbSize());
398      jedis.select(1);
399      assertEquals(0, jedis.dbSize());
400      jedis.set(bfoo, bbar);
401      assertEquals(1, jedis.dbSize());
402      assertEquals("OK", jedis.flushAll(FlushMode.ASYNC));
403      assertEquals(0, jedis.dbSize());
404    }
405    @Test
406    public void persist() {
407      jedis.setex("foo", 60 * 60, "bar");
408      assertTrue(jedis.ttl("foo") > 0);
409      assertEquals(1, jedis.persist("foo"));
410      assertEquals(-1, jedis.ttl("foo"));
411      jedis.setex(bfoo, 60 * 60, bbar);
412      assertTrue(jedis.ttl(bfoo) > 0);
413      assertEquals(1, jedis.persist(bfoo));
414      assertEquals(-1, jedis.ttl(bfoo));
415    }
416    @Test
417    public void echo() {
418      String result = jedis.echo("hello world");
419      assertEquals("hello world", result);
420      byte[] bresult = jedis.echo(SafeEncoder.encode("hello world"));
421      assertArrayEquals(SafeEncoder.encode("hello world"), bresult);
422    }
423    @Test
424    public void dumpAndRestore() {
425      jedis.set("foo1", "bar");
426      byte[] sv = jedis.dump("foo1");
427      jedis.restore("foo2", 0, sv);
428      assertEquals("bar", jedis.get("foo2"));
429      jedis.set(bfoo1, bbar);
430      sv = jedis.dump(bfoo1);
431      jedis.restore(bfoo2, 0, sv);
432      assertArrayEquals(bbar, jedis.get(bfoo2));
433    }
434    @Test
435    public void restoreParams() {
436      Jedis jedis2 = new Jedis(hnp.getHost(), 6380, 500);
437      jedis2.auth("foobared");
438      jedis2.flushAll();
439      jedis2.set("foo", "bar");
440      jedis.set("from", "a");
441      byte[] serialized = jedis.dump("from");
442      try {
443        jedis2.restore("foo", 0, serialized);
444        fail("Simple restore on a existing key should fail");
445      } catch (JedisDataException e) {
446      }
447      try {
448        jedis2.restore("foo", 0, serialized, RestoreParams.restoreParams());
449        fail("Simple restore on a existing key should fail");
450      } catch (JedisDataException e) {
451      }
452      assertEquals("bar", jedis2.get("foo"));
453      jedis2.restore("foo", 1000, serialized, RestoreParams.restoreParams().replace());
454      assertEquals("a", jedis2.get("foo"));
455      assertTrue(jedis2.pttl("foo") <= 1000);
456      jedis2.restore("bar", System.currentTimeMillis() + 1000, serialized, RestoreParams.restoreParams().replace().absTtl());
457      assertTrue(jedis2.pttl("bar") <= 1000);
458      jedis2.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().idleTime(1000));
459      assertEquals(1000, jedis2.objectIdletime("bar1").longValue());
460      jedis2.close();
461      Jedis lfuJedis = new Jedis(lfuHnp.getHost(), lfuHnp.getPort(), 500);
462      lfuJedis.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().frequency(90));
463      assertEquals(90, lfuJedis.objectFreq("bar1").longValue());
464      lfuJedis.close();
465    }
466    @Test
467    public void pexpire() {
468      assertEquals(0, jedis.pexpire("foo", 10000));
469      jedis.set("foo1", "bar1");
470      assertEquals(1, jedis.pexpire("foo1", 10000));
471      jedis.set("foo2", "bar2");
472      assertEquals(1, jedis.pexpire("foo2", 200000000000L));
473      assertEquals(0, jedis.pexpire("foo2", 10000000, ExpiryOption.NX));
474      assertEquals(1, jedis.pexpire("foo2", 10000000, ExpiryOption.XX));
475      assertEquals(0, jedis.pexpire("foo2", 10000, ExpiryOption.GT));
476      assertEquals(1, jedis.pexpire("foo2", 10000, ExpiryOption.LT));
477      long pttl = jedis.pttl("foo2");
478      assertTrue(pttl > 100L);
479      assertEquals(0, jedis.pexpire(bfoo, 10000));
480      jedis.set(bfoo, bbar);
481      assertEquals(1, jedis.pexpire(bfoo, 10000));
482      assertEquals(0, jedis.pexpire(bfoo, 10000, ExpiryOption.NX));
483    }
484    @Test
485    public void pexpireAt() {
486      long unixTime = (System.currentTimeMillis()) + 10000;
487      assertEquals(0, jedis.pexpireAt("foo", unixTime));
488      jedis.set("foo", "bar");
489      assertEquals(1, jedis.pexpireAt("foo", unixTime));
490      assertEquals(0, jedis.pexpireAt(bfoo, unixTime));
491      jedis.set(bfoo, bbar);
492      assertEquals(1, jedis.pexpireAt(bfoo, unixTime));
493    }
494    @Test
495    public void pexpireTime() {
496      long unixTime = (System.currentTimeMillis()) + 10000;
497      jedis.set("foo", "bar");
498      jedis.pexpireAt("foo", unixTime);
499      assertEquals(unixTime, jedis.pexpireTime("foo"), 0.0001);
500      jedis.set(bfoo, bbar);
501      jedis.pexpireAt(bfoo, unixTime);
502      assertEquals(unixTime, jedis.pexpireTime(bfoo), 0.0001);
503    }
504    @Test
505    public void pttl() {
506      assertEquals(-2, jedis.pttl("foo"));
507      jedis.set("foo", "bar");
508      assertEquals(-1, jedis.pttl("foo"));
509      jedis.pexpire("foo", 20000);
510      long pttl = jedis.pttl("foo");
511      assertTrue(pttl >= 0 && pttl <= 20000);
512      assertEquals(-2, jedis.pttl(bfoo));
513      jedis.set(bfoo, bbar);
514      assertEquals(-1, jedis.pttl(bfoo));
515      jedis.pexpire(bfoo, 20000);
516      pttl = jedis.pttl(bfoo);
517      assertTrue(pttl >= 0 && pttl <= 20000);
518    }
519    @Test
520    public void psetex() {
521      long pttl;
522      jedis.psetex("foo", 200000000000L, "bar");
523      pttl = jedis.pttl("foo");
524      assertTrue(pttl > 100000000000L);
525      jedis.psetex(bfoo, 200000000000L, bbar);
526      pttl = jedis.pttl(bfoo);
527      assertTrue(pttl > 100000000000L);
528    }
529    @Test
530    public void scan() {
531      jedis.set("b", "b");
532      jedis.set("a", "a");
533      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
534      assertEquals(SCAN_POINTER_START, result.getCursor());
535      assertFalse(result.getResult().isEmpty());
536      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY);
537      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
538      assertFalse(bResult.getResult().isEmpty());
539    }
540    @Test
541    public void scanMatch() {
542      ScanParams params = new ScanParams();
543      params.match("a*");
544      jedis.set("b", "b");
545      jedis.set("a", "a");
546      jedis.set("aa", "aa");
547      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
548      assertEquals(SCAN_POINTER_START, result.getCursor());
549      assertFalse(result.getResult().isEmpty());
550      params = new ScanParams();
551      params.match(bfoostar);
552      jedis.set(bfoo1, bbar);
553      jedis.set(bfoo2, bbar);
554      jedis.set(bfoo3, bbar);
555      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
556      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
557      assertFalse(bResult.getResult().isEmpty());
558    }
559    @Test
560    public void scanCount() {
561      ScanParams params = new ScanParams();
562      params.count(2);
563      for (int i = 0; i < 10; i++) {
564        jedis.set("a" + i, "a" + i);
565      }
566      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
567      assertFalse(result.getResult().isEmpty());
568      params = new ScanParams();
569      params.count(2);
570      jedis.set(bfoo1, bbar);
571      jedis.set(bfoo2, bbar);
572      jedis.set(bfoo3, bbar);
573      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
574      assertFalse(bResult.getResult().isEmpty());
575    }
576    @Test
577    public void scanType() {
578      ScanParams noParams = new ScanParams();
579      ScanParams pagingParams = new ScanParams().count(4);
580      jedis.set("a", "a");
581      jedis.hset("b", "b", "b");
582      jedis.set("c", "c");
583      jedis.sadd("d", "d");
584      jedis.set("e", "e");
585      jedis.zadd("f", 0d, "f");
586      jedis.set("g", "g");
587      ScanResult<String> scanResult;
588      scanResult = jedis.scan(SCAN_POINTER_START, pagingParams, "string");
589      assertFalse(scanResult.isCompleteIteration());
590      int page1Count = scanResult.getResult().size();
591      scanResult = jedis.scan(scanResult.getCursor(), pagingParams, "string");
592      assertTrue(scanResult.isCompleteIteration());
593      int page2Count = scanResult.getResult().size();
594      assertEquals(4, page1Count + page2Count);
595      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "hash");
596      assertEquals(Collections.singletonList("b"), scanResult.getResult());
597      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "set");
598      assertEquals(Collections.singletonList("d"), scanResult.getResult());
599      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "zset");
600      assertEquals(Collections.singletonList("f"), scanResult.getResult());
601      final byte[] string = "string".getBytes();
602      final byte[] hash = "hash".getBytes();
603      final byte[] set = "set".getBytes();
604      final byte[] zset = "zset".getBytes();
605      ScanResult<byte[]> binaryResult;
606      jedis.set("a", "a");
607      jedis.hset("b", "b", "b");
608      jedis.set("c", "c");
609      jedis.sadd("d", "d");
610      jedis.set("e", "e");
611      jedis.zadd("f", 0d, "f");
612      jedis.set("g", "g");
613      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, pagingParams, string);
614      assertFalse(binaryResult.isCompleteIteration());
615      page1Count = binaryResult.getResult().size();
616      binaryResult = jedis.scan(binaryResult.getCursorAsBytes(), pagingParams, string);
617      assertTrue(binaryResult.isCompleteIteration());
618      page2Count = binaryResult.getResult().size();
619      assertEquals(4, page1Count + page2Count);
620      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, hash);
621      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{98}), binaryResult.getResult());
622      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, set);
623      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{100}), binaryResult.getResult());
624      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, zset);
625      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{102}), binaryResult.getResult());
626    }
627    @Test
628    public void scanIsCompleteIteration() {
629      for (int i = 0; i < 100; i++) {
630        jedis.set("a" + i, "a" + i);
631      }
632      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
633      assertFalse(result.isCompleteIteration());
634      result = scanCompletely(result.getCursor());
635      assertNotNull(result);
636      assertTrue(result.isCompleteIteration());
637    }
638    private ScanResult<String> scanCompletely(String cursor) {
639      ScanResult<String> scanResult;
640      do {
641        scanResult = jedis.scan(cursor);
<span onclick='openModal()' class='match'>642        cursor = scanResult.getCursor();
643      } while (!SCAN_POINTER_START.equals(scanResult.getCursor()));
644      return scanResult;
645    }
646    @Test
647    public void setNxExAndGet() {
648      assertEquals("OK", jedis.set("hello", "world", SetParams.setParams().nx().ex(expireSeconds)));
649      assertEquals("world", jedis.get("hello"));
650      assertNull(jedis.set("hello", "bar", SetParams.setParams().nx().ex(expireSeconds)));
651      assertEquals("world", jedis.get("hello"));
652      long ttl = jedis.ttl("hello");
653      assertTrue(ttl > 0 && ttl <= expireSeconds);
654      byte[] bworld = { 0x77, 0x6F, 0x72, 0x6C, 0x64 };
655      byte[] bhello = { 0x68, 0x65, 0x6C, 0x6C, 0x6F };
656      assertEquals("OK", jedis.set(bworld, bhello, SetParams.setParams().nx().ex(expireSeconds)));
657      assertArrayEquals(bhello, jedis.get(bworld));
658      assertNull(jedis.set(bworld, bbar, SetParams.setParams().nx().ex(expireSeconds)));
659      assertArrayEquals(bhello, jedis.get(bworld));
660      long bttl = jedis.ttl(bworld);
661      assertTrue(bttl > 0 && bttl <= expireSeconds);
662    }
663    @Test
664    public void setGetOptionTest() {
665      assertEquals("OK", jedis.set("hello", "world"));
666      assertEquals("world", jedis.setGet("hello", "jedis"));
667      assertEquals("jedis", jedis.get("hello"));
668      assertNull(jedis.setGet("key", "value"));
669    }
670    @Test
671    public void setGet() {
672      assertEquals("OK", jedis.set("hello", "world"));
673      assertEquals("world", jedis.setGet("hello", "jedis", SetParams.setParams()));
674      assertEquals("jedis", jedis.get("hello"));
675      assertNull(jedis.setGet("key", "value", SetParams.setParams()));
676    }
677    @Test
678    public void sendCommandTest() {
679      Object obj = jedis.sendCommand(SET, "x", "1");
680      String returnValue = SafeEncoder.encode((byte[]) obj);
</span>681      assertEquals("OK", returnValue);
682      obj = jedis.sendCommand(GET, "x");
683      returnValue = SafeEncoder.encode((byte[]) obj);
684      assertEquals("1", returnValue);
685      jedis.sendCommand(RPUSH, "foo", "a");
686      jedis.sendCommand(RPUSH, "foo", "b");
687      jedis.sendCommand(RPUSH, "foo", "c");
688      obj = jedis.sendCommand(LRANGE, "foo", "0", "2");
689      List<byte[]> list = (List<byte[]>) obj;
690      List<byte[]> expected = new ArrayList<>(3);
691      expected.add("a".getBytes());
692      expected.add("b".getBytes());
693      expected.add("c".getBytes());
694      for (int i = 0; i < 3; i++)
695        assertArrayEquals(expected.get(i), list.get(i));
696      assertEquals("PONG", SafeEncoder.encode((byte[]) jedis.sendCommand(PING)));
697    }
698    @Test
699    public void sendBlockingCommandTest() {
700      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
701      jedis.sendCommand(RPUSH, "foo", "bar");
702      assertEquals(Arrays.asList("foo", "bar"),
703        SafeEncoder.encodeObject(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L))));
704      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
705    }
706    @Test
707    public void encodeCompleteResponsePing() {
708      assertEquals("PONG", SafeEncoder.encodeObject(jedis.sendCommand(PING)));
709    }
710    @Test
711    public void encodeCompleteResponseHgetall() {
712      Assume.assumeFalse(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
713      HashMap<String, String> entries = new HashMap<>();
714      entries.put("foo", "bar");
715      entries.put("foo2", "bar2");
716      jedis.hset("hash:test:encode", entries);
717      List encodeObj = (List) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
718      assertEquals(4, encodeObj.size());
719      entries.forEach((k, v) -> {
720        assertThat((Iterable<String>) encodeObj, Matchers.hasItem(k));
721        assertEquals(v, findValueFromMapAsList(encodeObj, k));
722      });
723    }
724    @Test
725    public void encodeCompleteResponseHgetallResp3() {
726      Assume.assumeTrue(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
727      HashMap<String, String> entries = new HashMap<>();
728      entries.put("foo", "bar");
729      entries.put("foo2", "bar2");
730      jedis.hset("hash:test:encode", entries);
731      List<KeyValue> encodeObj = (List<KeyValue>) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
732      assertEquals(2, encodeObj.size());
733      encodeObj.forEach(kv -> {
734        assertThat(entries, Matchers.hasEntry(kv.getKey(), kv.getValue()));
735      });
736    }
737    @Test
738    public void encodeCompleteResponseXinfoStream() {
739      Assume.assumeFalse(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
740      HashMap<String, String> entry = new HashMap<>();
741      entry.put("foo", "bar");
742      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
743      jedis.xgroupCreate("mystream", "mygroup", null, false);
744      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
745      List encodeObj = (List) SafeEncoder.encodeObject(obj);
746      assertThat(encodeObj.size(), Matchers.greaterThanOrEqualTo(14));
747      assertEquals("must have even number of elements", 0, encodeObj.size() % 2); 
748      assertEquals(1L, findValueFromMapAsList(encodeObj, "length"));
749      assertEquals(entryID.toString(), findValueFromMapAsList(encodeObj, "last-generated-id"));
750      List<String> entryAsList = new ArrayList<>(2);
751      entryAsList.add("foo");
752      entryAsList.add("bar");
753      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "first-entry")).get(1));
754      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "last-entry")).get(1));
755    }
756    @Test
757    public void encodeCompleteResponseXinfoStreamResp3() {
758      Assume.assumeTrue(RedisProtocolUtil.getRedisProtocol() == RedisProtocol.RESP3);
759      HashMap<String, String> entry = new HashMap<>();
760      entry.put("foo", "bar");
761      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
762      jedis.xgroupCreate("mystream", "mygroup", null, false);
763      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
764      List<KeyValue> encodeObj = (List<KeyValue>) SafeEncoder.encodeObject(obj);
765      assertThat(encodeObj.size(), Matchers.greaterThanOrEqualTo(7));
766      assertEquals(1L, findValueFromMapAsKeyValueList(encodeObj, "length"));
767      assertEquals(entryID.toString(), findValueFromMapAsKeyValueList(encodeObj, "last-generated-id"));
768      List<String> entryAsList = new ArrayList<>(2);
769      entryAsList.add("foo");
770      entryAsList.add("bar");
771      assertEquals(entryAsList, ((List) findValueFromMapAsKeyValueList(encodeObj, "first-entry")).get(1));
772      assertEquals(entryAsList, ((List) findValueFromMapAsKeyValueList(encodeObj, "last-entry")).get(1));
773    }
774    private Object findValueFromMapAsList(List list, Object key) {
775      for (int i = 0; i < list.size(); i += 2) {
776        if (key.equals(list.get(i))) {
777          return list.get(i + 1);
778        }
779      }
780      return null;
781    }
782    private Object findValueFromMapAsKeyValueList(List<KeyValue> list, Object key) {
783      for (KeyValue kv : list) {
784        if (key.equals(kv.getKey())) {
785          return kv.getValue();
786        }
787      }
788      return null;
789    }
790    @Test
791    public void copy() {
792      assertFalse(jedis.copy("unknown", "foo", false));
793      jedis.set("foo1", "bar");
794      assertTrue(jedis.copy("foo1", "foo2", false));
795      assertEquals("bar", jedis.get("foo2"));
796      assertTrue(jedis.copy("foo1", "foo3", 2, false));
797      jedis.select(2);
798      assertEquals("bar", jedis.get("foo3"));
799      jedis.select(0); 
800      jedis.set("foo1", "bar1");
801      assertTrue(jedis.copy("foo1", "foo2", true));
802      assertEquals("bar1", jedis.get("foo2"));
803      assertFalse(jedis.copy(bfoobar, bfoo, false));
804      jedis.set(bfoo1, bbar);
805      assertTrue(jedis.copy(bfoo1, bfoo2, false));
806      assertArrayEquals(bbar, jedis.get(bfoo2));
807      assertTrue(jedis.copy(bfoo1, bfoo3, 3, false));
808      jedis.select(3);
809      assertArrayEquals(bbar, jedis.get(bfoo3));
810      jedis.select(0); 
811      jedis.set(bfoo1, bbar1);
812      assertTrue(jedis.copy(bfoo1, bfoo2, true));
813      assertArrayEquals(bbar1, jedis.get(bfoo2));
814    }
815  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTestBase.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>500        cursor = scanResult.getCursor();
501      } while (!SCAN_POINTER_START.equals(scanResult.getCursor()));
502      return scanResult;
503    }
504    @Test
505    public void setNxExAndGet() {
506      assertEquals("OK", jedis.set("hello", "world", SetParams.setParams().nx().ex(expireSeconds)));
507      assertEquals("world", jedis.get("hello"));
508      assertNull(jedis.set("hello", "bar", SetParams.setParams().nx().ex(expireSeconds)));
509      assertEquals("world", jedis.get("hello"));
510      long ttl = jedis.ttl("hello");
511      assertTrue(ttl > 0 && ttl <= expireSeconds);
512      byte[] bworld = { 0x77, 0x6F, 0x72, 0x6C, 0x64 };
513      byte[] bhello = { 0x68, 0x65, 0x6C, 0x6C, 0x6F };
514      assertEquals("OK", jedis.set(bworld, bhello, SetParams.setParams().nx().ex(expireSeconds)));
515      assertArrayEquals(bhello, jedis.get(bworld));
516      assertNull(jedis.set(bworld, bbar, SetParams.setParams().nx().ex(expireSeconds)));
517      assertArrayEquals(bhello, jedis.get(bworld));
518      long bttl = jedis.ttl(bworld);
519      assertTrue(bttl > 0 && bttl <= expireSeconds);
520    }
521    @Test
522    public void setGetOptionTest() {
523      assertEquals("OK", jedis.set("hello", "world"));
524      assertEquals("world", jedis.setGet("hello", "jedis"));
525      assertEquals("jedis", jedis.get("hello"));
526      assertNull(jedis.setGet("key", "value"));
527    }
528    @Test
529    public void setGet() {
530      assertEquals("OK", jedis.set("hello", "world"));
531      assertEquals("world", jedis.setGet("hello", "jedis", SetParams.setParams()));
532      assertEquals("jedis", jedis.get("hello"));
533      assertNull(jedis.setGet("key", "value", SetParams.setParams()));
534    }
535    @Test
536    public void sendCommandTest() {
537      Object obj = jedis.sendCommand(SET, "x", "1");
538      String returnValue = encode((byte[]) obj);
</pre></code></div>
                <div class="column column_space"><pre><code>642        cursor = scanResult.getCursor();
643      } while (!SCAN_POINTER_START.equals(scanResult.getCursor()));
644      return scanResult;
645    }
646    @Test
647    public void setNxExAndGet() {
648      assertEquals("OK", jedis.set("hello", "world", SetParams.setParams().nx().ex(expireSeconds)));
649      assertEquals("world", jedis.get("hello"));
650      assertNull(jedis.set("hello", "bar", SetParams.setParams().nx().ex(expireSeconds)));
651      assertEquals("world", jedis.get("hello"));
652      long ttl = jedis.ttl("hello");
653      assertTrue(ttl > 0 && ttl <= expireSeconds);
654      byte[] bworld = { 0x77, 0x6F, 0x72, 0x6C, 0x64 };
655      byte[] bhello = { 0x68, 0x65, 0x6C, 0x6C, 0x6F };
656      assertEquals("OK", jedis.set(bworld, bhello, SetParams.setParams().nx().ex(expireSeconds)));
657      assertArrayEquals(bhello, jedis.get(bworld));
658      assertNull(jedis.set(bworld, bbar, SetParams.setParams().nx().ex(expireSeconds)));
659      assertArrayEquals(bhello, jedis.get(bworld));
660      long bttl = jedis.ttl(bworld);
661      assertTrue(bttl > 0 && bttl <= expireSeconds);
662    }
663    @Test
664    public void setGetOptionTest() {
665      assertEquals("OK", jedis.set("hello", "world"));
666      assertEquals("world", jedis.setGet("hello", "jedis"));
667      assertEquals("jedis", jedis.get("hello"));
668      assertNull(jedis.setGet("key", "value"));
669    }
670    @Test
671    public void setGet() {
672      assertEquals("OK", jedis.set("hello", "world"));
673      assertEquals("world", jedis.setGet("hello", "jedis", SetParams.setParams()));
674      assertEquals("jedis", jedis.get("hello"));
675      assertNull(jedis.setGet("key", "value", SetParams.setParams()));
676    }
677    @Test
678    public void sendCommandTest() {
679      Object obj = jedis.sendCommand(SET, "x", "1");
680      String returnValue = SafeEncoder.encode((byte[]) obj);
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    