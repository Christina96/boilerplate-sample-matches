
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 8.799999999999999%, Tokens: 11</h2>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-AbstractConfig.java</h3>
            <pre><code>1  package com.weibo.api.motan.config;
2  import com.weibo.api.motan.common.MotanConstants;
3  import com.weibo.api.motan.config.annotation.ConfigDesc;
4  import com.weibo.api.motan.exception.MotanErrorMsgConstant;
5  import com.weibo.api.motan.exception.MotanFrameworkException;
6  import com.weibo.api.motan.util.LoggerUtil;
7  import org.apache.commons.lang3.StringUtils;
8  import java.io.Serializable;
9  import java.lang.reflect.Method;
10  import java.lang.reflect.Modifier;
11  import java.util.List;
12  import java.util.Map;
13  public abstract class AbstractConfig implements Serializable {
14      private static final long serialVersionUID = 5736580957909744603L;
15      protected String id;
16      public String getId() {
17          return id;
18      }
19      public void setId(String id) {
20          this.id = id;
21      }
22      protected static void collectConfigParams(Map<String, String> parameters, AbstractConfig... configs) {
23          for (AbstractConfig config : configs) {
24              if (config != null) {
25                  config.appendConfigParams(parameters);
26              }
27          }
28      }
29      protected static void collectMethodConfigParams(Map<String, String> parameters, List<MethodConfig> methods) {
30          if (methods == null || methods.isEmpty()) {
31              return;
32          }
33          for (MethodConfig mc : methods) {
34              if (mc != null) {
35                  mc.appendConfigParams(parameters, MotanConstants.METHOD_CONFIG_PREFIX + mc.getName() + "(" + mc.getArgumentTypes() + ")");
36              }
37          }
38      }
39      protected void appendConfigParams(Map<String, String> parameters) {
40          appendConfigParams(parameters, null);
41      }
42      @SuppressWarnings("unchecked")
43      protected void appendConfigParams(Map<String, String> parameters, String prefix) {
44          Method[] methods = this.getClass().getMethods();
45          for (Method method : methods) {
46              try {
47                  String name = method.getName();
48                  if (isConfigMethod(method)) {
49                      int idx = name.startsWith("get") ? 3 : 2;
50                      String key = name.substring(idx, idx + 1).toLowerCase() + name.substring(idx + 1);
51                      ConfigDesc configDesc = method.getAnnotation(ConfigDesc.class);
52                      if (configDesc != null && !StringUtils.isBlank(configDesc.key())) {
53                          key = configDesc.key();
54                      }
55                      Object value = method.invoke(this);
56                      if (value == null || StringUtils.isBlank(String.valueOf(value))) {
57                          if (configDesc != null && configDesc.required()) {
58                              throw new MotanFrameworkException(String.format("%s.%s should not be null or empty", this.getClass()
59                                      .getSimpleName(), key), MotanErrorMsgConstant.FRAMEWORK_INIT_ERROR);
60                          }
61                          continue;
62                      }
63                      if (prefix != null && prefix.length() > 0) {
64                          key = prefix + "." + key;
65                      }
66                      parameters.put(key, String.valueOf(value).trim());
67                  } else if ("getParameters".equals(name) && Modifier.isPublic(method.getModifiers())
68                          && method.getParameterTypes().length == 0 && method.getReturnType() == Map.class) {
69                      Map<String, String> map = (Map<String, String>) method.invoke(this);
70                      if (map != null && map.size() > 0) {
71                          String pre = prefix != null && prefix.length() > 0 ? prefix + "." : "";
72                          for (Map.Entry<String, String> entry : map.entrySet()) {
73                              parameters.put(pre + entry.getKey(), entry.getValue());
74                          }
75                      }
76                  }
77              } catch (Exception e) {
78                  throw new MotanFrameworkException(String.format("Error when append params for config: %s.%s", this.getClass()
79                          .getSimpleName(), method.getName()), e, MotanErrorMsgConstant.FRAMEWORK_INIT_ERROR);
80              }
81          }
82      }
83      private boolean isConfigMethod(Method method) {
84          boolean checkMethod =
85                  (method.getName().startsWith("get") || method.getName().startsWith("is")) && !"isDefault".equals(method.getName())
86                          && Modifier.isPublic(method.getModifiers()) && method.getParameterTypes().length == 0
87                          && isPrimitive(method.getReturnType());
88          if (checkMethod) {
89              ConfigDesc configDesc = method.getAnnotation(ConfigDesc.class);
90              if (configDesc != null && configDesc.excluded()) {
91                  return false;
92              }
93          }
94          return checkMethod;
95      }
96      private boolean isPrimitive(Class<?> type) {
97          return type.isPrimitive() || type == String.class || type == Character.class || type == Boolean.class || type == Byte.class
98                  || type == Short.class || type == Integer.class || type == Long.class || type == Float.class || type == Double.class;
99      }
100      @Override
101      public String toString() {
102          try {
103              StringBuilder buf = new StringBuilder();
104              buf.append("<motan:");
105              buf.append(getTagName(getClass()));
106              Method[] methods = getClass().getMethods();
107              for (Method method : methods) {
108                  try {
109                      String name = method.getName();
110                      if ((name.startsWith("get") || name.startsWith("is")) && !"getClass".equals(name) && !"get".equals(name)
111                              && !"is".equals(name) && Modifier.isPublic(method.getModifiers()) && method.getParameterTypes().length == 0
112                              && isPrimitive(method.getReturnType())) {
<span onclick='openModal()' class='match'>113                          int i = name.startsWith("get") ? 3 : 2;
114                          String key = name.substring(i, i + 1).toLowerCase() + name.substring(i + 1);
115                          Object value = method.invoke(this);
116                          if (value != null) {
117                              buf.append(" ");
118                              buf.append(key);
119                              buf.append("=\"");
</span>120                              buf.append(value);
121                              buf.append("\"");
122                          }
123                      }
124                  } catch (Exception e) {
125                      LoggerUtil.warn(e.getMessage(), e);
126                  }
127              }
128              buf.append(" />");
129              return buf.toString();
130          } catch (Throwable t) { 
131              LoggerUtil.warn(t.getMessage(), t);
132              return super.toString();
133          }
134      }
135      private static final String[] SUFFIXS = new String[] {"Config", "Bean"};
136      private static String getTagName(Class<?> cls) {
137          String tag = cls.getSimpleName();
138          for (String suffix : SUFFIXS) {
139              if (tag.endsWith(suffix)) {
140                  tag = tag.substring(0, tag.length() - suffix.length());
141                  break;
142              }
143          }
144          tag = tag.toLowerCase();
145          return tag;
146      }
147  }
</code></pre>
        </div>
        <div class="column">
            <h3>BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-PluginManager.java</h3>
            <pre><code>1  package net.md_5.bungee.api.plugin;
2  import com.google.common.base.Preconditions;
3  import com.google.common.collect.ArrayListMultimap;
4  import com.google.common.collect.Multimap;
5  import com.google.common.eventbus.Subscribe;
6  import com.google.common.graph.GraphBuilder;
7  import com.google.common.graph.Graphs;
8  import com.google.common.graph.MutableGraph;
9  import java.io.File;
10  import java.io.InputStream;
11  import java.lang.reflect.Method;
12  import java.net.URLClassLoader;
13  import java.util.Arrays;
14  import java.util.Collection;
15  import java.util.Collections;
16  import java.util.HashMap;
17  import java.util.HashSet;
18  import java.util.Iterator;
19  import java.util.LinkedHashMap;
20  import java.util.List;
21  import java.util.Locale;
22  import java.util.Map;
23  import java.util.Set;
24  import java.util.Stack;
25  import java.util.jar.JarEntry;
26  import java.util.jar.JarFile;
27  import java.util.logging.Level;
28  import lombok.RequiredArgsConstructor;
29  import net.md_5.bungee.api.ChatColor;
30  import net.md_5.bungee.api.CommandSender;
31  import net.md_5.bungee.api.ProxyServer;
32  import net.md_5.bungee.api.connection.ProxiedPlayer;
33  import net.md_5.bungee.event.EventBus;
34  import net.md_5.bungee.event.EventHandler;
35  import org.yaml.snakeyaml.LoaderOptions;
36  import org.yaml.snakeyaml.Yaml;
37  import org.yaml.snakeyaml.constructor.Constructor;
38  import org.yaml.snakeyaml.introspector.PropertyUtils;
39  @RequiredArgsConstructor
40  public final class PluginManager
41  {
42      private final ProxyServer proxy;
43      private final Yaml yaml;
44      private final EventBus eventBus;
45      private final Map<String, Plugin> plugins = new LinkedHashMap<>();
46      private final MutableGraph<String> dependencyGraph = GraphBuilder.directed().build();
47      private final LibraryLoader libraryLoader;
48      private final Map<String, Command> commandMap = new HashMap<>();
49      private Map<String, PluginDescription> toLoad = new HashMap<>();
50      private final Multimap<Plugin, Command> commandsByPlugin = ArrayListMultimap.create();
51      private final Multimap<Plugin, Listener> listenersByPlugin = ArrayListMultimap.create();
52      @SuppressWarnings("unchecked")
53      public PluginManager(ProxyServer proxy)
54      {
55          this.proxy = proxy;
56          Constructor yamlConstructor = new Constructor( new LoaderOptions() );
57          PropertyUtils propertyUtils = yamlConstructor.getPropertyUtils();
58          propertyUtils.setSkipMissingProperties( true );
59          yamlConstructor.setPropertyUtils( propertyUtils );
60          yaml = new Yaml( yamlConstructor );
61          eventBus = new EventBus( proxy.getLogger() );
62          LibraryLoader libraryLoader = null;
63          try
64          {
65              libraryLoader = new LibraryLoader( proxy.getLogger() );
66          } catch ( NoClassDefFoundError ex )
67          {
68              proxy.getLogger().warning( "Could not initialize LibraryLoader (missing dependencies?)" );
69          }
70          this.libraryLoader = libraryLoader;
71      }
72      public void registerCommand(Plugin plugin, Command command)
73      {
74          commandMap.put( command.getName().toLowerCase( Locale.ROOT ), command );
75          for ( String alias : command.getAliases() )
76          {
77              commandMap.put( alias.toLowerCase( Locale.ROOT ), command );
78          }
79          commandsByPlugin.put( plugin, command );
80      }
81      public void unregisterCommand(Command command)
82      {
83          while ( commandMap.values().remove( command ) );
84          commandsByPlugin.values().remove( command );
85      }
86      public void unregisterCommands(Plugin plugin)
87      {
88          for ( Iterator<Command> it = commandsByPlugin.get( plugin ).iterator(); it.hasNext(); )
89          {
90              Command command = it.next();
91              while ( commandMap.values().remove( command ) );
92              it.remove();
93          }
94      }
95      private Command getCommandIfEnabled(String commandName, CommandSender sender)
96      {
97          String commandLower = commandName.toLowerCase( Locale.ROOT );
98          if ( ( sender instanceof ProxiedPlayer ) && proxy.getDisabledCommands().contains( commandLower ) )
99          {
100              return null;
101          }
102          return commandMap.get( commandLower );
103      }
104      public boolean isExecutableCommand(String commandName, CommandSender sender)
105      {
106          return getCommandIfEnabled( commandName, sender ) != null;
107      }
108      public boolean dispatchCommand(CommandSender sender, String commandLine)
109      {
110          return dispatchCommand( sender, commandLine, null );
111      }
112      public boolean dispatchCommand(CommandSender sender, String commandLine, List<String> tabResults)
113      {
114          String[] split = commandLine.split( " ", -1 );
115          if ( split.length == 0 || split[0].isEmpty() )
116          {
117              return false;
118          }
119          Command command = getCommandIfEnabled( split[0], sender );
120          if ( command == null )
121          {
122              return false;
123          }
124          if ( !command.hasPermission( sender ) )
125          {
126              if ( tabResults == null )
127              {
128                  sender.sendMessage( ( command.getPermissionMessage() == null ) ? proxy.getTranslation( "no_permission" ) : command.getPermissionMessage() );
129              }
130              return true;
131          }
132          String[] args = Arrays.copyOfRange( split, 1, split.length );
133          try
134          {
135              if ( tabResults == null )
136              {
137                  if ( proxy.getConfig().isLogCommands() )
138                  {
139                      proxy.getLogger().log( Level.INFO, "{0} executed command: /{1}", new Object[]
140                      {
141                          sender.getName(), commandLine
142                      } );
143                  }
144                  command.execute( sender, args );
145              } else if ( commandLine.contains( " " ) && command instanceof TabExecutor )
146              {
147                  for ( String s : ( (TabExecutor) command ).onTabComplete( sender, args ) )
148                  {
149                      tabResults.add( s );
150                  }
151              }
152          } catch ( Exception ex )
153          {
154              sender.sendMessage( ChatColor.RED + "An internal error occurred whilst executing this command, please check the console log for details." );
155              ProxyServer.getInstance().getLogger().log( Level.WARNING, "Error in dispatching command", ex );
156          }
157          return true;
158      }
159      public Collection<Plugin> getPlugins()
160      {
161          return plugins.values();
162      }
163      public Plugin getPlugin(String name)
164      {
165          return plugins.get( name );
166      }
167      public void loadPlugins()
168      {
169          Map<PluginDescription, Boolean> pluginStatuses = new HashMap<>();
170          for ( Map.Entry<String, PluginDescription> entry : toLoad.entrySet() )
171          {
172              PluginDescription plugin = entry.getValue();
173              if ( !enablePlugin( pluginStatuses, new Stack<PluginDescription>(), plugin ) )
174              {
175                  ProxyServer.getInstance().getLogger().log( Level.WARNING, "Failed to enable {0}", entry.getKey() );
176              }
177          }
178          toLoad.clear();
179          toLoad = null;
180      }
181      public void enablePlugins()
182      {
183          for ( Plugin plugin : plugins.values() )
184          {
185              try
186              {
187                  plugin.onEnable();
188                  ProxyServer.getInstance().getLogger().log( Level.INFO, "Enabled plugin {0} version {1} by {2}", new Object[]
189                  {
190                      plugin.getDescription().getName(), plugin.getDescription().getVersion(), plugin.getDescription().getAuthor()
191                  } );
192              } catch ( Throwable t )
193              {
194                  ProxyServer.getInstance().getLogger().log( Level.WARNING, "Exception encountered when loading plugin: " + plugin.getDescription().getName(), t );
195              }
196          }
197      }
198      private boolean enablePlugin(Map<PluginDescription, Boolean> pluginStatuses, Stack<PluginDescription> dependStack, PluginDescription plugin)
199      {
200          if ( pluginStatuses.containsKey( plugin ) )
201          {
202              return pluginStatuses.get( plugin );
203          }
204          Set<String> dependencies = new HashSet<>();
205          dependencies.addAll( plugin.getDepends() );
206          dependencies.addAll( plugin.getSoftDepends() );
207          boolean status = true;
208          for ( String dependName : dependencies )
209          {
210              PluginDescription depend = toLoad.get( dependName );
211              Boolean dependStatus = ( depend != null ) ? pluginStatuses.get( depend ) : Boolean.FALSE;
212              if ( dependStatus == null )
213              {
214                  if ( dependStack.contains( depend ) )
215                  {
216                      StringBuilder dependencyGraph = new StringBuilder();
217                      for ( PluginDescription element : dependStack )
218                      {
219                          dependencyGraph.append( element.getName() ).append( " -> " );
220                      }
221                      dependencyGraph.append( plugin.getName() ).append( " -> " ).append( dependName );
222                      ProxyServer.getInstance().getLogger().log( Level.WARNING, "Circular dependency detected: {0}", dependencyGraph );
223                      status = false;
224                  } else
225                  {
226                      dependStack.push( plugin );
227                      dependStatus = this.enablePlugin( pluginStatuses, dependStack, depend );
228                      dependStack.pop();
229                  }
230              }
231              if ( dependStatus == Boolean.FALSE && plugin.getDepends().contains( dependName ) ) 
232              {
233                  ProxyServer.getInstance().getLogger().log( Level.WARNING, "{0} (required by {1}) is unavailable", new Object[]
234                  {
235                      String.valueOf( dependName ), plugin.getName()
236                  } );
237                  status = false;
238              }
239              dependencyGraph.putEdge( plugin.getName(), dependName );
240              if ( !status )
241              {
242                  break;
243              }
244          }
245          if ( status )
246          {
247              try
248              {
249                  URLClassLoader loader = new PluginClassloader( proxy, plugin, plugin.getFile(), ( libraryLoader != null ) ? libraryLoader.createLoader( plugin ) : null );
250                  Class<?> main = loader.loadClass( plugin.getMain() );
251                  Plugin clazz = (Plugin) main.getDeclaredConstructor().newInstance();
252                  plugins.put( plugin.getName(), clazz );
253                  clazz.onLoad();
254                  ProxyServer.getInstance().getLogger().log( Level.INFO, "Loaded plugin {0} version {1} by {2}", new Object[]
255                  {
256                      plugin.getName(), plugin.getVersion(), plugin.getAuthor()
257                  } );
258              } catch ( Throwable t )
259              {
260                  proxy.getLogger().log( Level.WARNING, "Error loading plugin " + plugin.getName(), t );
261              }
262          }
263          pluginStatuses.put( plugin, status );
264          return status;
265      }
266      public void detectPlugins(File folder)
267      {
268          Preconditions.checkNotNull( folder, "folder" );
269          Preconditions.checkArgument( folder.isDirectory(), "Must load from a directory" );
270          for ( File file : folder.listFiles() )
271          {
272              if ( file.isFile() && file.getName().endsWith( ".jar" ) )
273              {
274                  try ( JarFile jar = new JarFile( file ) )
275                  {
276                      JarEntry pdf = jar.getJarEntry( "bungee.yml" );
277                      if ( pdf == null )
278                      {
279                          pdf = jar.getJarEntry( "plugin.yml" );
280                      }
281                      Preconditions.checkNotNull( pdf, "Plugin must have a plugin.yml or bungee.yml" );
282                      try ( InputStream in = jar.getInputStream( pdf ) )
283                      {
284                          PluginDescription desc = yaml.loadAs( in, PluginDescription.class );
285                          Preconditions.checkNotNull( desc.getName(), "Plugin from %s has no name", file );
286                          Preconditions.checkNotNull( desc.getMain(), "Plugin from %s has no main", file );
287                          desc.setFile( file );
288                          toLoad.put( desc.getName(), desc );
289                      }
290                  } catch ( Exception ex )
291                  {
292                      ProxyServer.getInstance().getLogger().log( Level.WARNING, "Could not load plugin from file " + file, ex );
293                  }
294              }
295          }
296      }
297      public <T extends Event> T callEvent(T event)
298      {
<span onclick='openModal()' class='match'>299          Preconditions.checkNotNull( event, "event" );
300          long start = System.nanoTime();
301          eventBus.post( event );
302          event.postCall();
303          long elapsed = System.nanoTime() - start;
304          if ( elapsed > 250000000 )
305          {
306              ProxyServer.getInstance().getLogger().log( Level.WARNING, "Event {0} took {1}ms to process!", new Object[]
</span>307              {
308                  event, elapsed / 1000000
309              } );
310          }
311          return event;
312      }
313      public void registerListener(Plugin plugin, Listener listener)
314      {
315          for ( Method method : listener.getClass().getDeclaredMethods() )
316          {
317              Preconditions.checkArgument( !method.isAnnotationPresent( Subscribe.class ),
318                      "Listener %s has registered using deprecated subscribe annotation! Please update to @EventHandler.", listener );
319          }
320          eventBus.register( listener );
321          listenersByPlugin.put( plugin, listener );
322      }
323      public void unregisterListener(Listener listener)
324      {
325          eventBus.unregister( listener );
326          listenersByPlugin.values().remove( listener );
327      }
328      public void unregisterListeners(Plugin plugin)
329      {
330          for ( Iterator<Listener> it = listenersByPlugin.get( plugin ).iterator(); it.hasNext(); )
331          {
332              eventBus.unregister( it.next() );
333              it.remove();
334          }
335      }
336      public Collection<Map.Entry<String, Command>> getCommands()
337      {
338          return Collections.unmodifiableCollection( commandMap.entrySet() );
339      }
340      boolean isTransitiveDepend(PluginDescription plugin, PluginDescription depend)
341      {
342          Preconditions.checkArgument( plugin != null, "plugin" );
343          Preconditions.checkArgument( depend != null, "depend" );
344          if ( dependencyGraph.nodes().contains( plugin.getName() ) )
345          {
346              if ( Graphs.reachableNodes( dependencyGraph, plugin.getName() ).contains( depend.getName() ) )
347              {
348                  return true;
349              }
350          }
351          return false;
352      }
353  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-AbstractConfig.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from BungeeCord-MDEwOlJlcG9zaXRvcnk2MDg0MjEw-flat-PluginManager.java</div>
                </div>
                <div class="column column_space"><pre><code>113                          int i = name.startsWith("get") ? 3 : 2;
114                          String key = name.substring(i, i + 1).toLowerCase() + name.substring(i + 1);
115                          Object value = method.invoke(this);
116                          if (value != null) {
117                              buf.append(" ");
118                              buf.append(key);
119                              buf.append("=\"");
</pre></code></div>
                <div class="column column_space"><pre><code>299          Preconditions.checkNotNull( event, "event" );
300          long start = System.nanoTime();
301          eventBus.post( event );
302          event.postCall();
303          long elapsed = System.nanoTime() - start;
304          if ( elapsed > 250000000 )
305          {
306              ProxyServer.getInstance().getLogger().log( Level.WARNING, "Event {0} took {1}ms to process!", new Object[]
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    