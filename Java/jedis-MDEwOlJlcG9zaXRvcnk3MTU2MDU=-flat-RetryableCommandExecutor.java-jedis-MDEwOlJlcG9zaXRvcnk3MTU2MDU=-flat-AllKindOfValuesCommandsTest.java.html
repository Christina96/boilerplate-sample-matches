
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 1.908957415565345%, Tokens: 13, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RetryableCommandExecutor.java</h3>
            <pre><code>1  package redis.clients.jedis.executors;
<span onclick='openModal()' class='match'>2  import java.time.Duration;
3  import java.time.Instant;
4  import java.util.concurrent.TimeUnit;
5  import org.slf4j.Logger;
6  import org.slf4j.LoggerFactory;
7  import redis.clients.jedis.CommandObject;
8  import redis.clients.jedis.Connection;
9  import redis.clients.jedis.exceptions.JedisConnectionException;
10  import redis.clients.jedis.exceptions.JedisException;
11  import redis.clients.jedis.util.IOUtils;
12  import redis.clients.jedis.providers.ConnectionProvider;
13  public class RetryableCommandExecutor implements CommandExecutor {
14    private final Logger log = LoggerFactory.getLogger(getClass());
</span>15    protected final ConnectionProvider provider;
16    protected final int maxAttempts;
17    protected final Duration maxTotalRetriesDuration;
18    public RetryableCommandExecutor(ConnectionProvider provider, int maxAttempts,
19        Duration maxTotalRetriesDuration) {
20      this.provider = provider;
21      this.maxAttempts = maxAttempts;
22      this.maxTotalRetriesDuration = maxTotalRetriesDuration;
23    }
24    @Override
25    public void close() {
26      IOUtils.closeQuietly(this.provider);
27    }
28    @Override
29    public final <T> T executeCommand(CommandObject<T> commandObject) {
30      Instant deadline = Instant.now().plus(maxTotalRetriesDuration);
31      int consecutiveConnectionFailures = 0;
32      JedisException lastException = null;
33      for (int attemptsLeft = this.maxAttempts; attemptsLeft > 0; attemptsLeft--) {
34        Connection connection = null;
35        try {
36          connection = provider.getConnection(commandObject.getArguments());
37          return execute(connection, commandObject);
38        } catch (JedisConnectionException jce) {
39          lastException = jce;
40          ++consecutiveConnectionFailures;
41          log.debug("Failed connecting to Redis: {}", connection, jce);
42          boolean reset = handleConnectionProblem(attemptsLeft - 1, consecutiveConnectionFailures, deadline);
43          if (reset) {
44            consecutiveConnectionFailures = 0;
45          }
46        } finally {
47          if (connection != null) {
48            connection.close();
49          }
50        }
51        if (Instant.now().isAfter(deadline)) {
52          throw new JedisException("Retry deadline exceeded.");
53        }
54      }
55      JedisException maxAttemptsException = new JedisException("No more attempts left.");
56      maxAttemptsException.addSuppressed(lastException);
57      throw maxAttemptsException;
58    }
59    protected <T> T execute(Connection connection, CommandObject<T> commandObject) {
60      return connection.executeCommand(commandObject);
61    }
62    private boolean handleConnectionProblem(int attemptsLeft, int consecutiveConnectionFailures, Instant doneDeadline) {
63      if (consecutiveConnectionFailures < 2) {
64        return false;
65      }
66      sleep(getBackoffSleepMillis(attemptsLeft, doneDeadline));
67      return true;
68    }
69    private static long getBackoffSleepMillis(int attemptsLeft, Instant deadline) {
70      if (attemptsLeft <= 0) {
71        return 0;
72      }
73      long millisLeft = Duration.between(Instant.now(), deadline).toMillis();
74      if (millisLeft < 0) {
75        throw new JedisException("Retry deadline exceeded.");
76      }
77      return millisLeft / (attemptsLeft * (attemptsLeft + 1));
78    }
79    protected void sleep(long sleepMillis) {
80      try {
81        TimeUnit.MILLISECONDS.sleep(sleepMillis);
82      } catch (InterruptedException e) {
83        throw new JedisException(e);
84      }
85    }
86  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.junit.Assert.*;
3  import static redis.clients.jedis.Protocol.Command.BLPOP;
4  import static redis.clients.jedis.Protocol.Command.HGETALL;
5  import static redis.clients.jedis.Protocol.Command.GET;
6  import static redis.clients.jedis.Protocol.Command.LRANGE;
7  import static redis.clients.jedis.Protocol.Command.PING;
8  import static redis.clients.jedis.Protocol.Command.RPUSH;
9  import static redis.clients.jedis.Protocol.Command.SET;
10  import static redis.clients.jedis.Protocol.Command.XINFO;
11  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
12  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
13  import java.util.*;
14  import org.junit.Test;
15  import redis.clients.jedis.HostAndPort;
16  import redis.clients.jedis.Jedis;
<span onclick='openModal()' class='match'>17  import redis.clients.jedis.args.ExpiryOption;
18  import redis.clients.jedis.params.ScanParams;
19  import redis.clients.jedis.resps.ScanResult;
20  import redis.clients.jedis.StreamEntryID;
21  import redis.clients.jedis.args.FlushMode;
22  import redis.clients.jedis.params.RestoreParams;
23  import redis.clients.jedis.HostAndPorts;
24  import redis.clients.jedis.util.SafeEncoder;
25  import redis.clients.jedis.exceptions.JedisDataException;
26  import redis.clients.jedis.params.SetParams;
27  import redis.clients.jedis.util.AssertUtil;
28  public class AllKindOfValuesCommandsTest extends JedisCommandsTestBase {
29    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
</span>30    final byte[] bfoo1 = { 0x01, 0x02, 0x03, 0x04, 0x0A };
31    final byte[] bfoo2 = { 0x01, 0x02, 0x03, 0x04, 0x0B };
32    final byte[] bfoo3 = { 0x01, 0x02, 0x03, 0x04, 0x0C };
33    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
34    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
35    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
36    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
37    final byte[] bfoobar = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08 };
38    final byte[] bfoostar = { 0x01, 0x02, 0x03, 0x04, '*' };
39    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
40    final byte[] bnx = { 0x6E, 0x78 };
41    final byte[] bex = { 0x65, 0x78 };
42    final int expireSeconds = 2;
43    private static final HostAndPort lfuHnp = HostAndPorts.getRedisServers().get(7);
44    @Test
45    public void ping() {
46      String status = jedis.ping();
47      assertEquals("PONG", status);
48    }
49    @Test
50    public void pingWithMessage() {
51      String argument = "message";
52      assertEquals(argument, jedis.ping(argument));
53      assertArrayEquals(bfoobar, jedis.ping(bfoobar));
54    }
55    @Test
56    public void exists() {
57      String status = jedis.set("foo", "bar");
58      assertEquals("OK", status);
59      status = jedis.set(bfoo, bbar);
60      assertEquals("OK", status);
61      assertTrue(jedis.exists("foo"));
62      assertTrue(jedis.exists(bfoo));
63      assertEquals(1L, jedis.del("foo"));
64      assertEquals(1L, jedis.del(bfoo));
65      assertFalse(jedis.exists("foo"));
66      assertFalse(jedis.exists(bfoo));
67    }
68    @Test
69    public void existsMany() {
70      String status = jedis.set("foo1", "bar1");
71      assertEquals("OK", status);
72      status = jedis.set("foo2", "bar2");
73      assertEquals("OK", status);
74      assertEquals(2L, jedis.exists("foo1", "foo2"));
75      assertEquals(1L, jedis.del("foo1"));
76      assertEquals(1L, jedis.exists("foo1", "foo2"));
77    }
78    @Test
79    public void del() {
80      jedis.set("foo1", "bar1");
81      jedis.set("foo2", "bar2");
82      jedis.set("foo3", "bar3");
83      assertEquals(3L, jedis.del("foo1", "foo2", "foo3"));
84      assertFalse(jedis.exists("foo1"));
85      assertFalse(jedis.exists("foo2"));
86      assertFalse(jedis.exists("foo3"));
87      jedis.set("foo1", "bar1");
88      assertEquals(1L, jedis.del("foo1", "foo2"));
89      assertEquals(0L, jedis.del("foo1", "foo2"));
90      jedis.set(bfoo1, bbar1);
91      jedis.set(bfoo2, bbar2);
92      jedis.set(bfoo3, bbar3);
93      assertEquals(3L, jedis.del(bfoo1, bfoo2, bfoo3));
94      assertFalse(jedis.exists(bfoo1));
95      assertFalse(jedis.exists(bfoo2));
96      assertFalse(jedis.exists(bfoo3));
97      jedis.set(bfoo1, bbar1);
98      assertEquals(1, jedis.del(bfoo1, bfoo2));
99      assertEquals(0, jedis.del(bfoo1, bfoo2));
100    }
101    @Test
102    public void unlink() {
103      jedis.set("foo1", "bar1");
104      jedis.set("foo2", "bar2");
105      jedis.set("foo3", "bar3");
106      assertEquals(3, jedis.unlink("foo1", "foo2", "foo3"));
107      assertEquals(0, jedis.exists("foo1", "foo2", "foo3"));
108      jedis.set("foo1", "bar1");
109      assertEquals(1, jedis.unlink("foo1", "foo2"));
110      assertEquals(0, jedis.unlink("foo1", "foo2"));
111      jedis.set("foo", "bar");
112      assertEquals(1, jedis.unlink("foo"));
113      assertFalse(jedis.exists("foo"));
114      jedis.set(bfoo1, bbar1);
115      jedis.set(bfoo2, bbar2);
116      jedis.set(bfoo3, bbar3);
117      assertEquals(3, jedis.unlink(bfoo1, bfoo2, bfoo3));
118      assertEquals(0, jedis.exists(bfoo1, bfoo2, bfoo3));
119      jedis.set(bfoo1, bbar1);
120      assertEquals(1, jedis.unlink(bfoo1, bfoo2));
121      assertEquals(0, jedis.unlink(bfoo1, bfoo2));
122      jedis.set(bfoo, bbar);
123      assertEquals(1, jedis.unlink(bfoo));
124      assertFalse(jedis.exists(bfoo));
125    }
126    @Test
127    public void type() {
128      jedis.set("foo", "bar");
129      assertEquals("string", jedis.type("foo"));
130      jedis.set(bfoo, bbar);
131      assertEquals("string", jedis.type(bfoo));
132    }
133    @Test
134    public void keys() {
135      jedis.set("foo", "bar");
136      jedis.set("foobar", "bar");
137      Set<String> keys = jedis.keys("foo*");
138      AssertUtil.assertCollectionContains(keys, "foo");
139      AssertUtil.assertCollectionContains(keys, "foobar");
140      assertEquals(Collections.emptySet(), jedis.keys("bar*"));
141      jedis.set(bfoo, bbar);
142      jedis.set(bfoobar, bbar);
143      Set<byte[]> bkeys = jedis.keys(bfoostar);
144      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoo);
145      AssertUtil.assertByteArrayCollectionContains(bkeys, bfoobar);
146      assertEquals(Collections.emptySet(), jedis.keys(bbarstar));
147    }
148    @Test
149    public void randomKey() {
150      assertNull(jedis.randomKey());
151      jedis.set("foo", "bar");
152      assertEquals("foo", jedis.randomKey());
153      jedis.set("bar", "foo");
154      String randomkey = jedis.randomKey();
155      assertTrue(randomkey.equals("foo") || randomkey.equals("bar"));
156      jedis.del("foo");
157      jedis.del("bar");
158      assertNull(jedis.randomKey());
159      jedis.set(bfoo, bbar);
160      assertArrayEquals(bfoo, jedis.randomBinaryKey());
161      jedis.set(bbar, bfoo);
162      byte[] randomBkey = jedis.randomBinaryKey();
163      assertTrue(Arrays.equals(randomBkey, bfoo) || Arrays.equals(randomBkey, bbar));
164    }
165    @Test
166    public void rename() {
167      jedis.set("foo", "bar");
168      String status = jedis.rename("foo", "bar");
169      assertEquals("OK", status);
170      assertNull(jedis.get("foo"));
171      assertEquals("bar", jedis.get("bar"));
172      jedis.set(bfoo, bbar);
173      String bstatus = jedis.rename(bfoo, bbar);
174      assertEquals("OK", bstatus);
175      assertNull(jedis.get(bfoo));
176      assertArrayEquals(bbar, jedis.get(bbar));
177    }
178    @Test
179    public void renameOldAndNewAreTheSame() {
180      assertEquals("OK", jedis.set("foo", "bar"));
181      assertEquals("OK", jedis.rename("foo", "foo"));
182      assertEquals("OK", jedis.set(bfoo, bbar));
183      assertEquals("OK", jedis.rename(bfoo, bfoo));
184    }
185    @Test
186    public void renamenx() {
187      jedis.set("foo", "bar");
188      assertEquals(1, jedis.renamenx("foo", "bar"));
189      jedis.set("foo", "bar");
190      assertEquals(0, jedis.renamenx("foo", "bar"));
191      jedis.set(bfoo, bbar);
192      assertEquals(1, jedis.renamenx(bfoo, bbar));
193      jedis.set(bfoo, bbar);
194      assertEquals(0, jedis.renamenx(bfoo, bbar));
195    }
196    @Test
197    public void dbSize() {
198      assertEquals(0, jedis.dbSize());
199      jedis.set("foo", "bar");
200      assertEquals(1, jedis.dbSize());
201      jedis.set(bfoo, bbar);
202      assertEquals(2, jedis.dbSize());
203    }
204    @Test
205    public void expire() {
206      assertEquals(0, jedis.expire("foo", 20L));
207      jedis.set("foo", "bar");
208      assertEquals(1, jedis.expire("foo", 20L));
209      assertEquals(0, jedis.expire("foo", 20L, ExpiryOption.NX));
210      assertEquals(0, jedis.expire(bfoo, 20L));
211      jedis.set(bfoo, bbar);
212      assertEquals(1, jedis.expire(bfoo, 20L));
213      assertEquals(0, jedis.expire(bfoo, 20L, ExpiryOption.NX));
214    }
215    @Test
216    public void expireAt() {
217      long unixTime = (System.currentTimeMillis() / 1000L) + 20;
218      assertEquals(0, jedis.expireAt("foo", unixTime));
219      jedis.set("foo", "bar");
220      unixTime = (System.currentTimeMillis() / 1000L) + 20;
221      assertEquals(1, jedis.expireAt("foo", unixTime));
222      assertEquals(1, jedis.expireAt("foo", unixTime, ExpiryOption.XX));
223      assertEquals(0, jedis.expireAt(bfoo, unixTime));
224      jedis.set(bfoo, bbar);
225      unixTime = (System.currentTimeMillis() / 1000L) + 20;
226      assertEquals(1, jedis.expireAt(bfoo, unixTime));
227      assertEquals(1, jedis.expireAt(bfoo, unixTime, ExpiryOption.XX));
228    }
229    @Test
230    public void expireTime() {
231      long unixTime;
232      jedis.set("foo", "bar");
233      unixTime = (System.currentTimeMillis() / 1000L) + 20;
234      jedis.expireAt("foo", unixTime);
235      assertEquals(unixTime, jedis.expireTime("foo"), 0.0001);
236      jedis.set(bfoo, bbar);
237      unixTime = (System.currentTimeMillis() / 1000L) + 20;
238      jedis.expireAt(bfoo, unixTime);
239      assertEquals(unixTime, jedis.expireTime(bfoo), 0.0001);
240    }
241    @Test
242    public void ttl() {
243      assertEquals(-2, jedis.ttl("foo"));
244      jedis.set("foo", "bar");
245      assertEquals(-1, jedis.ttl("foo"));
246      jedis.expire("foo", 20);
247      long ttl = jedis.ttl("foo");
248      assertTrue(ttl >= 0 && ttl <= 20);
249      assertEquals(-2, jedis.ttl(bfoo));
250      jedis.set(bfoo, bbar);
251      assertEquals(-1, jedis.ttl(bfoo));
252      jedis.expire(bfoo, 20);
253      long bttl = jedis.ttl(bfoo);
254      assertTrue(bttl >= 0 && bttl <= 20);
255    }
256    @Test
257    public void touch() throws Exception {
258      assertEquals(0, jedis.touch("foo1", "foo2", "foo3"));
259      jedis.set("foo1", "bar1");
260      Thread.sleep(1100); 
261      assertTrue(jedis.objectIdletime("foo1") > 0);
262      assertEquals(1, jedis.touch("foo1"));
263      assertEquals(0L, jedis.objectIdletime("foo1").longValue());
264      assertEquals(1, jedis.touch("foo1", "foo2", "foo3"));
265      jedis.set("foo2", "bar2");
266      jedis.set("foo3", "bar3");
267      assertEquals(3, jedis.touch("foo1", "foo2", "foo3"));
268      assertEquals(0, jedis.touch(bfoo1, bfoo2, bfoo3));
269      jedis.set(bfoo1, bbar1);
270      Thread.sleep(1100); 
271      assertTrue(jedis.objectIdletime(bfoo1) > 0);
272      assertEquals(1, jedis.touch(bfoo1));
273      assertEquals(0L, jedis.objectIdletime(bfoo1).longValue());
274      assertEquals(1, jedis.touch(bfoo1, bfoo2, bfoo3));
275      jedis.set(bfoo2, bbar2);
276      jedis.set(bfoo3, bbar3);
277      assertEquals(3, jedis.touch(bfoo1, bfoo2, bfoo3));
278    }
279    @Test
280    public void select() {
281      jedis.set("foo", "bar");
282      String status = jedis.select(1);
283      assertEquals("OK", status);
284      assertNull(jedis.get("foo"));
285      status = jedis.select(0);
286      assertEquals("OK", status);
287      assertEquals("bar", jedis.get("foo"));
288      jedis.set(bfoo, bbar);
289      String bstatus = jedis.select(1);
290      assertEquals("OK", bstatus);
291      assertNull(jedis.get(bfoo));
292      bstatus = jedis.select(0);
293      assertEquals("OK", bstatus);
294      assertArrayEquals(bbar, jedis.get(bfoo));
295    }
296    @Test
297    public void getDB() {
298      assertEquals(0, jedis.getDB());
299      jedis.select(1);
300      assertEquals(1, jedis.getDB());
301    }
302    @Test
303    public void move() {
304      assertEquals(0, jedis.move("foo", 1));
305      jedis.set("foo", "bar");
306      assertEquals(1, jedis.move("foo", 1));
307      assertNull(jedis.get("foo"));
308      jedis.select(1);
309      assertEquals("bar", jedis.get("foo"));
310      jedis.select(0);
311      assertEquals(0, jedis.move(bfoo, 1));
312      jedis.set(bfoo, bbar);
313      assertEquals(1, jedis.move(bfoo, 1));
314      assertNull(jedis.get(bfoo));
315      jedis.select(1);
316      assertArrayEquals(bbar, jedis.get(bfoo));
317    }
318    @Test
319    public void swapDB() {
320      jedis.set("foo1", "bar1");
321      jedis.select(1);
322      assertNull(jedis.get("foo1"));
323      jedis.set("foo2", "bar2");
324      String status = jedis.swapDB(0, 1);
325      assertEquals("OK", status);
326      assertEquals("bar1", jedis.get("foo1"));
327      assertNull(jedis.get("foo2"));
328      jedis.select(0);
329      assertNull(jedis.get("foo1"));
330      assertEquals("bar2", jedis.get("foo2"));
331      jedis.set(bfoo1, bbar1);
332      jedis.select(1);
333      assertArrayEquals(null, jedis.get(bfoo1));
334      jedis.set(bfoo2, bbar2);
335      status = jedis.swapDB(0, 1);
336      assertEquals("OK", status);
337      assertArrayEquals(bbar1, jedis.get(bfoo1));
338      assertArrayEquals(null, jedis.get(bfoo2));
339      jedis.select(0);
340      assertArrayEquals(null, jedis.get(bfoo1));
341      assertArrayEquals(bbar2, jedis.get(bfoo2));
342    }
343    @Test
344    public void flushDB() {
345      jedis.set("foo", "bar");
346      assertEquals(1, jedis.dbSize());
347      jedis.set("bar", "foo");
348      jedis.move("bar", 1);
349      String status = jedis.flushDB();
350      assertEquals("OK", status);
351      assertEquals(0, jedis.dbSize());
352      jedis.select(1);
353      assertEquals(1, jedis.dbSize());
354      assertEquals("OK", jedis.flushDB(FlushMode.SYNC));
355      assertEquals(0, jedis.dbSize());
356      jedis.select(0);
357      jedis.set(bfoo, bbar);
358      assertEquals(1, jedis.dbSize());
359      jedis.set(bbar, bfoo);
360      jedis.move(bbar, 1);
361      String bstatus = jedis.flushDB();
362      assertEquals("OK", bstatus);
363      assertEquals(0, jedis.dbSize());
364      jedis.select(1);
365      assertEquals(1, jedis.dbSize());
366      assertEquals("OK", jedis.flushDB(FlushMode.ASYNC));
367      assertEquals(0, jedis.dbSize());
368    }
369    @Test
370    public void flushAll() {
371      jedis.set("foo", "bar");
372      assertEquals(1, jedis.dbSize());
373      jedis.set("bar", "foo");
374      jedis.move("bar", 1);
375      String status = jedis.flushAll();
376      assertEquals("OK", status);
377      assertEquals(0, jedis.dbSize());
378      jedis.select(1);
379      assertEquals(0, jedis.dbSize());
380      jedis.set("foo", "bar");
381      assertEquals(1, jedis.dbSize());
382      assertEquals("OK", jedis.flushAll(FlushMode.SYNC));
383      assertEquals(0, jedis.dbSize());
384      jedis.select(0);
385      jedis.set(bfoo, bbar);
386      assertEquals(1, jedis.dbSize());
387      jedis.set(bbar, bfoo);
388      jedis.move(bbar, 1);
389      String bstatus = jedis.flushAll();
390      assertEquals("OK", bstatus);
391      assertEquals(0, jedis.dbSize());
392      jedis.select(1);
393      assertEquals(0, jedis.dbSize());
394      jedis.set(bfoo, bbar);
395      assertEquals(1, jedis.dbSize());
396      assertEquals("OK", jedis.flushAll(FlushMode.ASYNC));
397      assertEquals(0, jedis.dbSize());
398    }
399    @Test
400    public void persist() {
401      jedis.setex("foo", 60 * 60, "bar");
402      assertTrue(jedis.ttl("foo") > 0);
403      assertEquals(1, jedis.persist("foo"));
404      assertEquals(-1, jedis.ttl("foo"));
405      jedis.setex(bfoo, 60 * 60, bbar);
406      assertTrue(jedis.ttl(bfoo) > 0);
407      assertEquals(1, jedis.persist(bfoo));
408      assertEquals(-1, jedis.ttl(bfoo));
409    }
410    @Test
411    public void echo() {
412      String result = jedis.echo("hello world");
413      assertEquals("hello world", result);
414      byte[] bresult = jedis.echo(SafeEncoder.encode("hello world"));
415      assertArrayEquals(SafeEncoder.encode("hello world"), bresult);
416    }
417    @Test
418    public void dumpAndRestore() {
419      jedis.set("foo1", "bar");
420      byte[] sv = jedis.dump("foo1");
421      jedis.restore("foo2", 0, sv);
422      assertEquals("bar", jedis.get("foo2"));
423      jedis.set(bfoo1, bbar);
424      sv = jedis.dump(bfoo1);
425      jedis.restore(bfoo2, 0, sv);
426      assertArrayEquals(bbar, jedis.get(bfoo2));
427    }
428    @Test
429    public void restoreParams() {
430      Jedis jedis2 = new Jedis(hnp.getHost(), 6380, 500);
431      jedis2.auth("foobared");
432      jedis2.flushAll();
433      jedis2.set("foo", "bar");
434      jedis.set("from", "a");
435      byte[] serialized = jedis.dump("from");
436      try {
437        jedis2.restore("foo", 0, serialized);
438        fail("Simple restore on a existing key should fail");
439      } catch (JedisDataException e) {
440      }
441      try {
442        jedis2.restore("foo", 0, serialized, RestoreParams.restoreParams());
443        fail("Simple restore on a existing key should fail");
444      } catch (JedisDataException e) {
445      }
446      assertEquals("bar", jedis2.get("foo"));
447      jedis2.restore("foo", 1000, serialized, RestoreParams.restoreParams().replace());
448      assertEquals("a", jedis2.get("foo"));
449      assertTrue(jedis2.pttl("foo") <= 1000);
450      jedis2.restore("bar", System.currentTimeMillis() + 1000, serialized, RestoreParams.restoreParams().replace().absTtl());
451      assertTrue(jedis2.pttl("bar") <= 1000);
452      jedis2.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().idleTime(1000));
453      assertEquals(1000, jedis2.objectIdletime("bar1").longValue());
454      jedis2.close();
455      Jedis lfuJedis = new Jedis(lfuHnp.getHost(), lfuHnp.getPort(), 500);
456      lfuJedis.restore("bar1", 1000, serialized, RestoreParams.restoreParams().replace().frequency(90));
457      assertEquals(90, lfuJedis.objectFreq("bar1").longValue());
458      lfuJedis.close();
459    }
460    @Test
461    public void pexpire() {
462      assertEquals(0, jedis.pexpire("foo", 10000));
463      jedis.set("foo1", "bar1");
464      assertEquals(1, jedis.pexpire("foo1", 10000));
465      jedis.set("foo2", "bar2");
466      assertEquals(1, jedis.pexpire("foo2", 200000000000L));
467      assertEquals(0, jedis.pexpire("foo2", 10000000, ExpiryOption.NX));
468      assertEquals(1, jedis.pexpire("foo2", 10000000, ExpiryOption.XX));
469      assertEquals(0, jedis.pexpire("foo2", 10000, ExpiryOption.GT));
470      assertEquals(1, jedis.pexpire("foo2", 10000, ExpiryOption.LT));
471      long pttl = jedis.pttl("foo2");
472      assertTrue(pttl > 100L);
473      assertEquals(0, jedis.pexpire(bfoo, 10000));
474      jedis.set(bfoo, bbar);
475      assertEquals(1, jedis.pexpire(bfoo, 10000));
476      assertEquals(0, jedis.pexpire(bfoo, 10000, ExpiryOption.NX));
477    }
478    @Test
479    public void pexpireAt() {
480      long unixTime = (System.currentTimeMillis()) + 10000;
481      assertEquals(0, jedis.pexpireAt("foo", unixTime));
482      jedis.set("foo", "bar");
483      assertEquals(1, jedis.pexpireAt("foo", unixTime));
484      assertEquals(0, jedis.pexpireAt(bfoo, unixTime));
485      jedis.set(bfoo, bbar);
486      assertEquals(1, jedis.pexpireAt(bfoo, unixTime));
487    }
488    @Test
489    public void pexpireTime() {
490      long unixTime = (System.currentTimeMillis()) + 10000;
491      jedis.set("foo", "bar");
492      jedis.pexpireAt("foo", unixTime);
493      assertEquals(unixTime, jedis.pexpireTime("foo"), 0.0001);
494      jedis.set(bfoo, bbar);
495      jedis.pexpireAt(bfoo, unixTime);
496      assertEquals(unixTime, jedis.pexpireTime(bfoo), 0.0001);
497    }
498    @Test
499    public void pttl() {
500      assertEquals(-2, jedis.pttl("foo"));
501      jedis.set("foo", "bar");
502      assertEquals(-1, jedis.pttl("foo"));
503      jedis.pexpire("foo", 20000);
504      long pttl = jedis.pttl("foo");
505      assertTrue(pttl >= 0 && pttl <= 20000);
506      assertEquals(-2, jedis.pttl(bfoo));
507      jedis.set(bfoo, bbar);
508      assertEquals(-1, jedis.pttl(bfoo));
509      jedis.pexpire(bfoo, 20000);
510      pttl = jedis.pttl(bfoo);
511      assertTrue(pttl >= 0 && pttl <= 20000);
512    }
513    @Test
514    public void psetex() {
515      long pttl;
516      jedis.psetex("foo", 200000000000L, "bar");
517      pttl = jedis.pttl("foo");
518      assertTrue(pttl > 100000000000L);
519      jedis.psetex(bfoo, 200000000000L, bbar);
520      pttl = jedis.pttl(bfoo);
521      assertTrue(pttl > 100000000000L);
522    }
523    @Test
524    public void scan() {
525      jedis.set("b", "b");
526      jedis.set("a", "a");
527      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
528      assertEquals(SCAN_POINTER_START, result.getCursor());
529      assertFalse(result.getResult().isEmpty());
530      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY);
531      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
532      assertFalse(bResult.getResult().isEmpty());
533    }
534    @Test
535    public void scanMatch() {
536      ScanParams params = new ScanParams();
537      params.match("a*");
538      jedis.set("b", "b");
539      jedis.set("a", "a");
540      jedis.set("aa", "aa");
541      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
542      assertEquals(SCAN_POINTER_START, result.getCursor());
543      assertFalse(result.getResult().isEmpty());
544      params = new ScanParams();
545      params.match(bfoostar);
546      jedis.set(bfoo1, bbar);
547      jedis.set(bfoo2, bbar);
548      jedis.set(bfoo3, bbar);
549      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
550      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
551      assertFalse(bResult.getResult().isEmpty());
552    }
553    @Test
554    public void scanCount() {
555      ScanParams params = new ScanParams();
556      params.count(2);
557      for (int i = 0; i < 10; i++) {
558        jedis.set("a" + i, "a" + i);
559      }
560      ScanResult<String> result = jedis.scan(SCAN_POINTER_START, params);
561      assertFalse(result.getResult().isEmpty());
562      params = new ScanParams();
563      params.count(2);
564      jedis.set(bfoo1, bbar);
565      jedis.set(bfoo2, bbar);
566      jedis.set(bfoo3, bbar);
567      ScanResult<byte[]> bResult = jedis.scan(SCAN_POINTER_START_BINARY, params);
568      assertFalse(bResult.getResult().isEmpty());
569    }
570    @Test
571    public void scanType() {
572      ScanParams noParams = new ScanParams();
573      ScanParams pagingParams = new ScanParams().count(4);
574      jedis.set("a", "a");
575      jedis.hset("b", "b", "b");
576      jedis.set("c", "c");
577      jedis.sadd("d", "d");
578      jedis.set("e", "e");
579      jedis.zadd("f", 0d, "f");
580      jedis.set("g", "g");
581      ScanResult<String> scanResult;
582      scanResult = jedis.scan(SCAN_POINTER_START, pagingParams, "string");
583      assertFalse(scanResult.isCompleteIteration());
584      int page1Count = scanResult.getResult().size();
585      scanResult = jedis.scan(scanResult.getCursor(), pagingParams, "string");
586      assertTrue(scanResult.isCompleteIteration());
587      int page2Count = scanResult.getResult().size();
588      assertEquals(4, page1Count + page2Count);
589      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "hash");
590      assertEquals(Collections.singletonList("b"), scanResult.getResult());
591      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "set");
592      assertEquals(Collections.singletonList("d"), scanResult.getResult());
593      scanResult = jedis.scan(SCAN_POINTER_START, noParams, "zset");
594      assertEquals(Collections.singletonList("f"), scanResult.getResult());
595      final byte[] string = "string".getBytes();
596      final byte[] hash = "hash".getBytes();
597      final byte[] set = "set".getBytes();
598      final byte[] zset = "zset".getBytes();
599      ScanResult<byte[]> binaryResult;
600      jedis.set("a", "a");
601      jedis.hset("b", "b", "b");
602      jedis.set("c", "c");
603      jedis.sadd("d", "d");
604      jedis.set("e", "e");
605      jedis.zadd("f", 0d, "f");
606      jedis.set("g", "g");
607      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, pagingParams, string);
608      assertFalse(binaryResult.isCompleteIteration());
609      page1Count = binaryResult.getResult().size();
610      binaryResult = jedis.scan(binaryResult.getCursorAsBytes(), pagingParams, string);
611      assertTrue(binaryResult.isCompleteIteration());
612      page2Count = binaryResult.getResult().size();
613      assertEquals(4, page1Count + page2Count);
614      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, hash);
615      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{98}), binaryResult.getResult());
616      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, set);
617      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{100}), binaryResult.getResult());
618      binaryResult = jedis.scan(SCAN_POINTER_START_BINARY, noParams, zset);
619      AssertUtil.assertByteArrayListEquals(Collections.singletonList(new byte[]{102}), binaryResult.getResult());
620    }
621    @Test
622    public void scanIsCompleteIteration() {
623      for (int i = 0; i < 100; i++) {
624        jedis.set("a" + i, "a" + i);
625      }
626      ScanResult<String> result = jedis.scan(SCAN_POINTER_START);
627      assertFalse(result.isCompleteIteration());
628      result = scanCompletely(result.getCursor());
629      assertNotNull(result);
630      assertTrue(result.isCompleteIteration());
631    }
632    private ScanResult<String> scanCompletely(String cursor) {
633      ScanResult<String> scanResult;
634      do {
635        scanResult = jedis.scan(cursor);
636        cursor = scanResult.getCursor();
637      } while (!SCAN_POINTER_START.equals(scanResult.getCursor()));
638      return scanResult;
639    }
640    @Test
641    public void setNxExAndGet() {
642      assertEquals("OK", jedis.set("hello", "world", SetParams.setParams().nx().ex(expireSeconds)));
643      assertEquals("world", jedis.get("hello"));
644      assertNull(jedis.set("hello", "bar", SetParams.setParams().nx().ex(expireSeconds)));
645      assertEquals("world", jedis.get("hello"));
646      long ttl = jedis.ttl("hello");
647      assertTrue(ttl > 0 && ttl <= expireSeconds);
648      byte[] bworld = { 0x77, 0x6F, 0x72, 0x6C, 0x64 };
649      byte[] bhello = { 0x68, 0x65, 0x6C, 0x6C, 0x6F };
650      assertEquals("OK", jedis.set(bworld, bhello, SetParams.setParams().nx().ex(expireSeconds)));
651      assertArrayEquals(bhello, jedis.get(bworld));
652      assertNull(jedis.set(bworld, bbar, SetParams.setParams().nx().ex(expireSeconds)));
653      assertArrayEquals(bhello, jedis.get(bworld));
654      long bttl = jedis.ttl(bworld);
655      assertTrue(bttl > 0 && bttl <= expireSeconds);
656    }
657    @Test
658    public void setGetOptionTest() {
659      assertEquals("OK", jedis.set("hello", "world"));
660      assertEquals("world", jedis.setGet("hello", "jedis"));
661      assertEquals("jedis", jedis.get("hello"));
662      assertNull(jedis.setGet("key", "value"));
663    }
664    @Test
665    public void setGet() {
666      assertEquals("OK", jedis.set("hello", "world"));
667      assertEquals("world", jedis.setGet("hello", "jedis", SetParams.setParams()));
668      assertEquals("jedis", jedis.get("hello"));
669      assertNull(jedis.setGet("key", "value", SetParams.setParams()));
670    }
671    @Test
672    public void sendCommandTest() {
673      Object obj = jedis.sendCommand(SET, "x", "1");
674      String returnValue = SafeEncoder.encode((byte[]) obj);
675      assertEquals("OK", returnValue);
676      obj = jedis.sendCommand(GET, "x");
677      returnValue = SafeEncoder.encode((byte[]) obj);
678      assertEquals("1", returnValue);
679      jedis.sendCommand(RPUSH, "foo", "a");
680      jedis.sendCommand(RPUSH, "foo", "b");
681      jedis.sendCommand(RPUSH, "foo", "c");
682      obj = jedis.sendCommand(LRANGE, "foo", "0", "2");
683      List<byte[]> list = (List<byte[]>) obj;
684      List<byte[]> expected = new ArrayList<>(3);
685      expected.add("a".getBytes());
686      expected.add("b".getBytes());
687      expected.add("c".getBytes());
688      for (int i = 0; i < 3; i++)
689        assertArrayEquals(expected.get(i), list.get(i));
690      assertEquals("PONG", SafeEncoder.encode((byte[]) jedis.sendCommand(PING)));
691    }
692    @Test
693    public void sendBlockingCommandTest() {
694      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
695      jedis.sendCommand(RPUSH, "foo", "bar");
696      assertEquals(Arrays.asList("foo", "bar"),
697        SafeEncoder.encodeObject(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L))));
698      assertNull(jedis.sendBlockingCommand(BLPOP, "foo", Long.toString(1L)));
699    }
700    @Test
701    public void encodeCompleteResponse() {
702      HashMap<String, String> entry = new HashMap<>();
703      entry.put("foo", "bar");
704      StreamEntryID entryID = jedis.xadd("mystream", StreamEntryID.NEW_ENTRY, entry);
705      jedis.xgroupCreate("mystream", "mygroup", null, false);
706      Object obj = jedis.sendCommand(XINFO, "STREAM", "mystream");
707      List encodeObj = (List) SafeEncoder.encodeObject(obj);
708      assertTrue(encodeObj.size() >= 14);
709      assertEquals(0, encodeObj.size() % 2); 
710      assertEquals(1L, findValueFromMapAsList(encodeObj, "length"));
711      assertEquals(entryID.toString(), findValueFromMapAsList(encodeObj, "last-generated-id"));
712      List<String> entryAsList = new ArrayList<>(2);
713      entryAsList.add("foo");
714      entryAsList.add("bar");
715      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "first-entry")).get(1));
716      assertEquals(entryAsList, ((List) findValueFromMapAsList(encodeObj, "last-entry")).get(1));
717      assertEquals("PONG", SafeEncoder.encodeObject(jedis.sendCommand(PING)));
718      entry.put("foo2", "bar2");
719      jedis.hset("hash:test:encode", entry);
720      encodeObj = (List) SafeEncoder.encodeObject(jedis.sendCommand(HGETALL, "hash:test:encode"));
721      assertEquals(4, encodeObj.size());
722      assertTrue(encodeObj.contains("foo"));
723      assertTrue(encodeObj.contains("foo2"));
724    }
725    private Object findValueFromMapAsList(List list, Object key) {
726      for (int i = 0; i < list.size(); i += 2) {
727        if (key.equals(list.get(i))) {
728          return list.get(i + 1);
729        }
730      }
731      return null;
732    }
733    @Test
734    public void copy() {
735      assertFalse(jedis.copy("unknown", "foo", false));
736      jedis.set("foo1", "bar");
737      assertTrue(jedis.copy("foo1", "foo2", false));
738      assertEquals("bar", jedis.get("foo2"));
739      assertTrue(jedis.copy("foo1", "foo3", 2, false));
740      jedis.select(2);
741      assertEquals("bar", jedis.get("foo3"));
742      jedis.select(0); 
743      jedis.set("foo1", "bar1");
744      assertTrue(jedis.copy("foo1", "foo2", true));
745      assertEquals("bar1", jedis.get("foo2"));
746      assertFalse(jedis.copy(bfoobar, bfoo, false));
747      jedis.set(bfoo1, bbar);
748      assertTrue(jedis.copy(bfoo1, bfoo2, false));
749      assertArrayEquals(bbar, jedis.get(bfoo2));
750      assertTrue(jedis.copy(bfoo1, bfoo3, 3, false));
751      jedis.select(3);
752      assertArrayEquals(bbar, jedis.get(bfoo3));
753      jedis.select(0); 
754      jedis.set(bfoo1, bbar1);
755      assertTrue(jedis.copy(bfoo1, bfoo2, true));
756      assertArrayEquals(bbar1, jedis.get(bfoo2));
757    }
758  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RetryableCommandExecutor.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-AllKindOfValuesCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>2  import java.time.Duration;
3  import java.time.Instant;
4  import java.util.concurrent.TimeUnit;
5  import org.slf4j.Logger;
6  import org.slf4j.LoggerFactory;
7  import redis.clients.jedis.CommandObject;
8  import redis.clients.jedis.Connection;
9  import redis.clients.jedis.exceptions.JedisConnectionException;
10  import redis.clients.jedis.exceptions.JedisException;
11  import redis.clients.jedis.util.IOUtils;
12  import redis.clients.jedis.providers.ConnectionProvider;
13  public class RetryableCommandExecutor implements CommandExecutor {
14    private final Logger log = LoggerFactory.getLogger(getClass());
</pre></code></div>
                <div class="column column_space"><pre><code>17  import redis.clients.jedis.args.ExpiryOption;
18  import redis.clients.jedis.params.ScanParams;
19  import redis.clients.jedis.resps.ScanResult;
20  import redis.clients.jedis.StreamEntryID;
21  import redis.clients.jedis.args.FlushMode;
22  import redis.clients.jedis.params.RestoreParams;
23  import redis.clients.jedis.HostAndPorts;
24  import redis.clients.jedis.util.SafeEncoder;
25  import redis.clients.jedis.exceptions.JedisDataException;
26  import redis.clients.jedis.params.SetParams;
27  import redis.clients.jedis.util.AssertUtil;
28  public class AllKindOfValuesCommandsTest extends JedisCommandsTestBase {
29    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    