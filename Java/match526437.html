<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for AtomicDoubleTest.java & ClassPathTest.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for AtomicDoubleTest.java & ClassPathTest.java
      </h3>
      <h1 align="center">
        12.0%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>AtomicDoubleTest.java (18.73805%)<TH>ClassPathTest.java (8.876812%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#0',2,'match526437-1.html#0',3)" NAME="0">(341-349)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#0',2,'match526437-1.html#0',3)" NAME="0">(433-439)</A><TD ALIGN=center><FONT COLOR="#ff0000">16</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#1',2,'match526437-1.html#1',3)" NAME="1">(275-282)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#1',2,'match526437-1.html#1',3)" NAME="1">(213-220)</A><TD ALIGN=center><FONT COLOR="#bf0000">12</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#2',2,'match526437-1.html#2',3)" NAME="2">(285-291)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#2',2,'match526437-1.html#2',3)" NAME="2">(467-473)</A><TD ALIGN=center><FONT COLOR="#af0000">11</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#3',2,'match526437-1.html#3',3)" NAME="3">(43-47)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#3',2,'match526437-1.html#3',3)" NAME="3">(557-561)</A><TD ALIGN=center><FONT COLOR="#af0000">11</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#4',2,'match526437-1.html#4',3)" NAME="4">(114-121)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#4',2,'match526437-1.html#4',3)" NAME="4">(315-321)</A><TD ALIGN=center><FONT COLOR="#9f0000">10</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#5',2,'match526437-1.html#5',3)" NAME="5">(90-95)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#5',2,'match526437-1.html#5',3)" NAME="5">(387-390)</A><TD ALIGN=center><FONT COLOR="#9f0000">10</FONT>
<TR><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#6',2,'match526437-1.html#6',3)" NAME="6">(62-68)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#6',2,'match526437-1.html#6',3)" NAME="6">(299-304)</A><TD ALIGN=center><FONT COLOR="#9f0000">10</FONT>
<TR><TD BGCOLOR="#38a4a5"><FONT COLOR="#38a4a5">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#7',2,'match526437-1.html#7',3)" NAME="7">(149-154)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#7',2,'match526437-1.html#7',3)" NAME="7">(307-311)</A><TD ALIGN=center><FONT COLOR="#8f0000">9</FONT>
<TR><TD BGCOLOR="#c58917"><FONT COLOR="#c58917">-</FONT><TD><A HREF="javascript:ZweiFrames('match526437-0.html#8',2,'match526437-1.html#8',3)" NAME="8">(69-76)<TD><A HREF="javascript:ZweiFrames('match526437-0.html#8',2,'match526437-1.html#8',3)" NAME="8">(536-541)</A><TD ALIGN=center><FONT COLOR="#8f0000">9</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>AtomicDoubleTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Written by Doug Lea and Martin Buchholz with assistance from
 * members of JCP JSR-166 Expert Group and released to the public
 * domain, as explained at
 * http://creativecommons.org/publicdomain/zero/1.0/
 */

/*
 * Source:
 * http://gee.cs.oswego.edu/cgi-bin/viewcvs.cgi/jsr166/src/test/tck-jsr166e/AtomicDoubleTest.java?revision=1.8
 * (Modified to adapt to guava coding conventions)
 */

package com.google.common.util.concurrent;

import static java.lang.Math.max;

/** Unit test for {@link AtomicDouble}. */
public class AtomicDoubleTest extends JSR166TestCase {

  private static final double[] VALUES = {
    Double.NEGATIVE_INFINITY,
    -Double.MAX_VALUE,
    (double) Long.MIN_VALUE,
    (double) Integer.MIN_VALUE,
    -Math.PI,
    -1.0,
    -Double.MIN_VALUE,
    -0.0,
    +0.0,
    Double.MIN_VALUE,
    1.0,
    Math.PI,
    (double) Integer.MAX_VALUE,
    (double) Long.MAX_VALUE,
    Double.MAX_VALUE,
    Double.POSITIVE_INFINITY,
    Double.NaN,
    Float.MAX_VALUE,
<A NAME="3"></A>  };

  /** The notion of equality used by AtomicDouble */
  static boolean bitEquals(double x, <FONT color="#53858b"><A HREF="javascript:ZweiFrames('match526437-1.html#3',3,'match526437-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>double y) {
    return Double.doubleToRawLongBits(x) == Double.doubleToRawLongBits(y);
  }

  static void assertBitEquals(double x, double y) {</B></FONT>
    assertEquals(Double.doubleToRawLongBits(x), Double.doubleToRawLongBits(y));
  }

  /** constructor initializes to given value */
  public void testConstructor() {
    for (double x : VALUES) {
      AtomicDouble a = new AtomicDouble(x);
      assertBitEquals(x, a.get());
    }
  }

<A NAME="6"></A>  /** default constructed initializes to zero */
  public void testConstructor2() {
    AtomicDouble a = new AtomicDouble();
    <FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match526437-1.html#6',3,'match526437-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertBitEquals(0.0, a.get());
  }

  /** get returns the last value set */
<A NAME="8"></A>  public void testGetSet() {
    AtomicDouble at = new AtomicDouble(1.0);
    assertBitEquals(1.0, at.get</B></FONT>());
    for (double x : VALUES) <FONT color="#c58917"><A HREF="javascript:ZweiFrames('match526437-1.html#8',3,'match526437-top.html#8',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
      at.set(x);
      assertBitEquals(x, at.get());
    }
  }

  /** get returns the last value lazySet in same thread */
  public void te</B></FONT>stGetLazySet() {
    AtomicDouble at = new AtomicDouble(1.0);
    assertBitEquals(1.0, at.get());
    for (double x : VALUES) {
      at.lazySet(x);
      assertBitEquals(x, at.get());
    }
  }

  /** compareAndSet succeeds in changing value if equal to expected else fails */
  public void testCompareAndSet() {
<A NAME="5"></A>    double prev = Math.E;
    double unused = Math.E + Math.PI;
    AtomicDouble at = new AtomicDouble(prev);
    for (double x : VALUES) <FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match526437-1.html#5',3,'match526437-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
      assertBitEquals(prev, at.get());
      assertFalse(at.compareAndSet(unused, x));
      assertBitEquals(prev, at.get());
      assertTrue(at.compareAndSet(prev, x));
      assertBitEquals</B></FONT>(x, at.get());
      prev = x;
    }
  }

  /** compareAndSet in one thread enables another waiting for value to succeed */
  public void testCompareAndSetInMultipleThreads() throws Exception {
    final AtomicDouble at = new AtomicDouble(1.0);
    Thread t =
        newStartedThread(
            new CheckedRunnable() {
              @Override
              public void realRun() {
                while (!at.compareAndSet(2.0, 3.0)) {
                  Thread.yield();
                }
<A NAME="4"></A>              }
            });

    <FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match526437-1.html#4',3,'match526437-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertTrue(at.compareAndSet(1.0, 2.0));
    awaitTermination(t);
    assertBitEquals(3.0, at.get());
  }

  /** repeated weakCompareAndSet succeeds in changing value when equal to expected */
  public void testWeakCompareAndSet() {
    double prev = Math.E</B></FONT>;
    double unused = Math.E + Math.PI;
    AtomicDouble at = new AtomicDouble(prev);
    for (double x : VALUES) {
      assertBitEquals(prev, at.get());
      assertFalse(at.weakCompareAndSet(unused, x));
      assertBitEquals(prev, at.get());
      while (!at.weakCompareAndSet(prev, x)) {
        ;
      }
      assertBitEquals(x, at.get());
      prev = x;
    }
  }

  /** getAndSet returns previous value and sets to given value */
  public void testGetAndSet() {
    double prev = Math.E;
    AtomicDouble at = new AtomicDouble(prev);
    for (double x : VALUES) {
      assertBitEquals(prev, at.getAndSet(x));
      prev = x;
    }
  }

<A NAME="7"></A>  /** getAndAdd returns previous value and adds given value */
  public void testGetAndAdd() {
    for (double x : VALUES) {
      for (double y : VALUES) <FONT color="#38a4a5"><A HREF="javascript:ZweiFrames('match526437-1.html#7',3,'match526437-top.html#7',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
        AtomicDouble a = new AtomicDouble(x);
        double z = a.getAndAdd(y);
        assertBitEquals(x, z);
        assertBitEquals(x + y, a.get());
      }</B></FONT>
    }
  }

  /** addAndGet adds given value to current, and returns current value */
  public void testAddAndGet() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.addAndGet(y);
        assertBitEquals(x + y, z);
        assertBitEquals(x + y, a.get());
      }
    }
  }

  /** getAndAccumulate with sum adds given value to current, and returns previous value */
  public void testGetAndAccumulateWithSum() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.getAndAccumulate(y, Double::sum);
        assertBitEquals(x, z);
        assertBitEquals(x + y, a.get());
      }
    }
  }

  /** getAndAccumulate with max stores max of given value to current, and returns previous value */
  public void testGetAndAccumulateWithMax() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.getAndAccumulate(y, Double::max);
        double expectedMax = max(x, y);
        assertBitEquals(x, z);
        assertBitEquals(expectedMax, a.get());
      }
    }
  }

  /** accumulateAndGet with sum adds given value to current, and returns current value */
  public void testAccumulateAndGetWithSum() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.accumulateAndGet(y, Double::sum);
        assertBitEquals(x + y, z);
        assertBitEquals(x + y, a.get());
      }
    }
  }

  /** accumulateAndGet with max stores max of given value to current, and returns current value */
  public void testAccumulateAndGetWithMax() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.accumulateAndGet(y, Double::max);
        double expectedMax = max(x, y);
        assertBitEquals(expectedMax, z);
        assertBitEquals(expectedMax, a.get());
      }
    }
  }

  /** getAndUpdate with sum stores sum of given value to current, and returns previous value */
  public void testGetAndUpdateWithSum() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.getAndUpdate(value -&gt; value + y);
        assertBitEquals(x, z);
        assertBitEquals(x + y, a.get());
      }
    }
  }

  /**
   * getAndUpdate with subtract stores subtraction of value from current, and returns previous value
   */
  public void testGetAndUpdateWithSubtract() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.getAndUpdate(value -&gt; value - y);
        assertBitEquals(x, z);
        assertBitEquals(x - y, a.get());
      }
    }
  }

  /** updateAndGet with sum stores sum of given value to current, and returns current value */
  public void testUpdateAndGetWithSum() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.updateAndGet(value -&gt; value + y);
        assertBitEquals(x + y, z);
        assertBitEquals(x + y, a.get());
      }
    }
  }

  /**
   * updateAndGet with subtract stores subtraction of value from current, and returns current value
   */
  public void testUpdateAndGetWithSubtract() {
    for (double x : VALUES) {
      for (double y : VALUES) {
        AtomicDouble a = new AtomicDouble(x);
        double z = a.updateAndGet(value -&gt; value - y);
        assertBitEquals(x - y, z);
        assertBitEquals(x - y, a.get());
      }
    }
  }

<A NAME="1"></A>  /** a deserialized serialized atomic holds same value */
  public void testSerialization() throws Exception {
    AtomicDouble a = new AtomicDouble();
    AtomicDouble b = <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match526437-1.html#1',3,'match526437-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>serialClone(a);
    assertNotSame(a, b);
    a.set(-22.0);
    AtomicDouble c = serialClone(a);
    assertNotSame(b, c);
    assertBitEquals(-22.0, a.get());
    assertBitEquals(0.0, b.get());
<A NAME="2"></A>    assertBitEquals(-22.0, c.get</B></FONT>());
    for (double x : VALUES) {
      AtomicDouble d = new AtomicDouble(x);
      <FONT color="#980517"><A HREF="javascript:ZweiFrames('match526437-1.html#2',3,'match526437-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertBitEquals(serialClone(d).get(), d.get());
    }
  }

  /** toString returns current value */
  public void testToString() {
    AtomicDouble at = new AtomicDouble()</B></FONT>;
    assertEquals(&quot;0.0&quot;, at.toString());
    for (double x : VALUES) {
      at.set(x);
      assertEquals(Double.toString(x), at.toString());
    }
  }

  /** intValue returns current value. */
  public void testIntValue() {
    AtomicDouble at = new AtomicDouble();
    assertEquals(0, at.intValue());
    for (double x : VALUES) {
      at.set(x);
      assertEquals((int) x, at.intValue());
    }
  }

  /** longValue returns current value. */
  public void testLongValue() {
    AtomicDouble at = new AtomicDouble();
    assertEquals(0L, at.longValue());
    for (double x : VALUES) {
      at.set(x);
      assertEquals((long) x, at.longValue());
    }
  }

  /** floatValue returns current value. */
  public void testFloatValue() {
    AtomicDouble at = new AtomicDouble();
    assertEquals(0.0f, at.floatValue());
    for (double x : VALUES) {
      at.set(x);
      assertEquals((float) x, at.floatValue());
    }
  }

  /** doubleValue returns current value. */
  public void testDoubleValue() {
    AtomicDouble at = new AtomicDouble();
    assertEquals(0.0d, at.doubleValue());
    for (double x : VALUES) {
      at.set(x);
      assertBitEquals(x, at.doubleValue());
    }
  }
<A NAME="0"></A>
  /** compareAndSet treats +0.0 and -0.0 as distinct values */
  public void testDistinctZeros() {
    AtomicDouble at = <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match526437-1.html#0',3,'match526437-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>new AtomicDouble(+0.0);
    assertFalse(at.compareAndSet(-0.0, 7.0));
    assertFalse(at.weakCompareAndSet(-0.0, 7.0));
    assertBitEquals(+0.0, at.get());
    assertTrue(at.compareAndSet(+0.0, -0.0));
    assertBitEquals(-0.0, at.get());
    assertFalse(at.compareAndSet(+0.0, 7.0));
    assertFalse(at.weakCompareAndSet(+0.0, 7.0));
    assertBitEquals</B></FONT>(-0.0, at.get());
  }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>ClassPathTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2012 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.google.common.reflect;

import static com.google.common.base.Charsets.US_ASCII;
import static com.google.common.base.StandardSystemProperty.JAVA_CLASS_PATH;
import static com.google.common.base.StandardSystemProperty.PATH_SEPARATOR;
import static com.google.common.io.MoreFiles.deleteRecursively;
import static com.google.common.truth.Truth.assertThat;
import static java.nio.file.Files.createDirectory;
import static java.nio.file.Files.createFile;
import static java.nio.file.Files.createSymbolicLink;
import static java.nio.file.Files.createTempDirectory;
import static java.util.logging.Level.WARNING;

import com.google.common.base.Joiner;
import com.google.common.collect.ImmutableList;
import com.google.common.collect.ImmutableSet;
import com.google.common.io.Closer;
import com.google.common.io.Files;
import com.google.common.io.Resources;
import com.google.common.reflect.ClassPath.ClassInfo;
import com.google.common.reflect.ClassPath.ResourceInfo;
import com.google.common.testing.EqualsTester;
import com.google.common.testing.NullPointerTester;
import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.FilePermission;
import java.io.IOException;
import java.io.InputStream;
import java.net.MalformedURLException;
import java.net.URISyntaxException;
import java.net.URL;
import java.net.URLClassLoader;
import java.security.Permission;
import java.security.PermissionCollection;
import java.util.jar.Attributes;
import java.util.jar.JarOutputStream;
import java.util.jar.Manifest;
import java.util.logging.Logger;
import java.util.zip.ZipEntry;
import junit.framework.TestCase;
import org.junit.Test;

/** Functional tests of {@link ClassPath}. */
public class ClassPathTest extends TestCase {
  private static final Logger log = Logger.getLogger(ClassPathTest.class.getName());
  private static final File FILE = new File(&quot;.&quot;);

  public void testEquals() {
    new EqualsTester()
        .addEqualityGroup(classInfo(ClassPathTest.class), classInfo(ClassPathTest.class))
        .addEqualityGroup(classInfo(Test.class), classInfo(Test.class, getClass().getClassLoader()))
        .addEqualityGroup(
            new ResourceInfo(FILE, &quot;a/b/c.txt&quot;, getClass().getClassLoader()),
            new ResourceInfo(FILE, &quot;a/b/c.txt&quot;, getClass().getClassLoader()))
        .addEqualityGroup(new ResourceInfo(FILE, &quot;x.txt&quot;, getClass().getClassLoader()))
        .testEquals();
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  public void testClassPathEntries_emptyURLClassLoader_noParent() {
    assertThat(ClassPath.getClassPathEntries(new URLClassLoader(new URL[0], null)).keySet())
        .isEmpty();
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  public void testClassPathEntries_URLClassLoader_noParent() throws Exception {
    URL url1 = new URL(&quot;file:/a&quot;);
    URL url2 = new URL(&quot;file:/b&quot;);
    URLClassLoader classloader = new URLClassLoader(new URL[] {url1, url2}, null);
    assertThat(ClassPath.getClassPathEntries(classloader))
        .containsExactly(new File(&quot;/a&quot;), classloader, new File(&quot;/b&quot;), classloader);
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  public void testClassPathEntries_URLClassLoader_withParent() throws Exception {
    URL url1 = new URL(&quot;file:/a&quot;);
    URL url2 = new URL(&quot;file:/b&quot;);
    URLClassLoader parent = new URLClassLoader(new URL[] {url1}, null);
    URLClassLoader child = new URLClassLoader(new URL[] {url2}, parent) {};
    assertThat(ClassPath.getClassPathEntries(child))
        .containsExactly(new File(&quot;/a&quot;), parent, new File(&quot;/b&quot;), child)
        .inOrder();
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  public void testClassPathEntries_duplicateUri_parentWins() throws Exception {
    URL url = new URL(&quot;file:/a&quot;);
    URLClassLoader parent = new URLClassLoader(new URL[] {url}, null);
    URLClassLoader child = new URLClassLoader(new URL[] {url}, parent) {};
    assertThat(ClassPath.getClassPathEntries(child)).containsExactly(new File(&quot;/a&quot;), parent);
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  public void testClassPathEntries_notURLClassLoader_noParent() {
    assertThat(ClassPath.getClassPathEntries(new ClassLoader(null) {})).isEmpty();
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  public void testClassPathEntries_notURLClassLoader_withParent() throws Exception {
    URL url = new URL(&quot;file:/a&quot;);
    URLClassLoader parent = new URLClassLoader(new URL[] {url}, null);
    assertThat(ClassPath.getClassPathEntries(new ClassLoader(parent) {}))
        .containsExactly(new File(&quot;/a&quot;), parent);
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  public void testClassPathEntries_notURLClassLoader_withParentAndGrandParent() throws Exception {
    URL url1 = new URL(&quot;file:/a&quot;);
    URL url2 = new URL(&quot;file:/b&quot;);
    URLClassLoader grandParent = new URLClassLoader(new URL[] {url1}, null);
    URLClassLoader parent = new URLClassLoader(new URL[] {url2}, grandParent);
    assertThat(ClassPath.getClassPathEntries(new ClassLoader(parent) {}))
        .containsExactly(new File(&quot;/a&quot;), grandParent, new File(&quot;/b&quot;), parent);
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  public void testClassPathEntries_notURLClassLoader_withGrandParent() throws Exception {
    URL url = new URL(&quot;file:/a&quot;);
    URLClassLoader grandParent = new URLClassLoader(new URL[] {url}, null);
    ClassLoader parent = new ClassLoader(grandParent) {};
    assertThat(ClassPath.getClassPathEntries(new ClassLoader(parent) {}))
        .containsExactly(new File(&quot;/a&quot;), grandParent);
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  // https://github.com/google/guava/issues/2152
  public void testClassPathEntries_URLClassLoader_pathWithSpace() throws Exception {
    URL url = new URL(&quot;file:///c:/Documents and Settings/&quot;);
    URLClassLoader classloader = new URLClassLoader(new URL[] {url}, null);
    assertThat(ClassPath.getClassPathEntries(classloader))
        .containsExactly(new File(&quot;/c:/Documents and Settings/&quot;), classloader);
  }

  @AndroidIncompatible // Android forbids null parent ClassLoader
  // https://github.com/google/guava/issues/2152
  public void testClassPathEntries_URLClassLoader_pathWithEscapedSpace() throws Exception {
    URL url = new URL(&quot;file:///c:/Documents%20and%20Settings/&quot;);
    URLClassLoader classloader = new URLClassLoader(new URL[] {url}, null);
    assertThat(ClassPath.getClassPathEntries(classloader))
        .containsExactly(new File(&quot;/c:/Documents and Settings/&quot;), classloader);
  }

  // https://github.com/google/guava/issues/2152
  public void testToFile() throws Exception {
    assertThat(ClassPath.toFile(new URL(&quot;file:///c:/Documents%20and%20Settings/&quot;)))
        .isEqualTo(new File(&quot;/c:/Documents and Settings/&quot;));
    assertThat(ClassPath.toFile(new URL(&quot;file:///c:/Documents ~ Settings, or not/11-12 12:05&quot;)))
        .isEqualTo(new File(&quot;/c:/Documents ~ Settings, or not/11-12 12:05&quot;));
  }

  // https://github.com/google/guava/issues/2152
  @AndroidIncompatible // works in newer Android versions but fails at the version we test with
  public void testToFile_AndroidIncompatible() throws Exception {
    assertThat(ClassPath.toFile(new URL(&quot;file:///c:\\Documents ~ Settings, or not\\11-12 12:05&quot;)))
        .isEqualTo(new File(&quot;/c:\\Documents ~ Settings, or not\\11-12 12:05&quot;));
    assertThat(ClassPath.toFile(new URL(&quot;file:///C:\\Program Files\\Apache Software Foundation&quot;)))
        .isEqualTo(new File(&quot;/C:\\Program Files\\Apache Software Foundation/&quot;));
    assertThat(ClassPath.toFile(new URL(&quot;file:///C:\\\u20320 \u22909&quot;))) // Chinese Ni Hao
        .isEqualTo(new File(&quot;/C:\\\u20320 \u22909&quot;));
  }


  @AndroidIncompatible // Android forbids null parent ClassLoader
  // https://github.com/google/guava/issues/2152
  public void testJarFileWithSpaces() throws Exception {
    URL url = makeJarUrlWithName(&quot;To test unescaped spaces in jar file name.jar&quot;);
    URLClassLoader classloader = new URLClassLoader(new URL[] {url}, null);
    assertThat(ClassPath.from(classloader).getTopLevelClasses()).isNotEmpty();
  }


  public void testScan_classPathCycle() throws IOException {
    File jarFile = File.createTempFile(&quot;with_circular_class_path&quot;, &quot;.jar&quot;);
    try {
      writeSelfReferencingJarFile(jarFile, &quot;test.txt&quot;);
      assertThat(
              new ClassPath.LocationInfo(jarFile, ClassPathTest.class.getClassLoader())
                  .scanResources())
          .hasSize(1);
    } finally {
      jarFile.delete();
    }
  }

  @AndroidIncompatible // Path (for symlink creation)

  public void testScanDirectory_symlinkCycle() throws IOException {
    ClassLoader loader = ClassPathTest.class.getClassLoader();
    // directory with a cycle,
    // /root
    //    /left
    //       /[sibling -&gt; right]
    //    /right
<A NAME="1"></A>    //       /[sibling -&gt; left]
    java.nio.file.Path root = createTempDirectory(&quot;ClassPathTest&quot;);
    try {
      java.nio.file.Path left = createDirectory(<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#1',2,'match526437-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>root.resolve(&quot;left&quot;));
      createFile(left.resolve(&quot;some.txt&quot;));

      java.nio.file.Path right = createDirectory(root.resolve(&quot;right&quot;));
      createFile(right.resolve(&quot;another.txt&quot;));

      createSymbolicLink(left.resolve(&quot;sibling&quot;), right);
      createSymbolicLink(right.resolve</B></FONT>(&quot;sibling&quot;), left);
      assertEquals(
          ImmutableSet.of(
              new ResourceInfo(FILE, &quot;left/some.txt&quot;, loader),
              new ResourceInfo(FILE, &quot;left/sibling/another.txt&quot;, loader),
              new ResourceInfo(FILE, &quot;right/another.txt&quot;, loader),
              new ResourceInfo(FILE, &quot;right/sibling/some.txt&quot;, loader)),
          new ClassPath.LocationInfo(root.toFile(), loader).scanResources());
    } finally {
      deleteRecursivelyOrLog(root);
    }
  }

  @AndroidIncompatible // Path (for symlink creation)

  public void testScanDirectory_symlinkToRootCycle() throws IOException {
    ClassLoader loader = ClassPathTest.class.getClassLoader();
    // directory with a cycle,
    // /root
    //    /child
    //       /[grandchild -&gt; root]
    java.nio.file.Path root = createTempDirectory(&quot;ClassPathTest&quot;);
    try {
      createFile(root.resolve(&quot;some.txt&quot;));
      java.nio.file.Path child = createDirectory(root.resolve(&quot;child&quot;));
      createSymbolicLink(child.resolve(&quot;grandchild&quot;), root);
      assertEquals(
          ImmutableSet.of(new ResourceInfo(FILE, &quot;some.txt&quot;, loader)),
          new ClassPath.LocationInfo(root.toFile(), loader).scanResources());
    } finally {
      deleteRecursivelyOrLog(root);
    }
  }


  public void testScanFromFile_fileNotExists() throws IOException {
    ClassLoader classLoader = ClassPathTest.class.getClassLoader();
    assertThat(
            new ClassPath.LocationInfo(new File(&quot;no/such/file/anywhere&quot;), classLoader)
                .scanResources())
        .isEmpty();
  }


  public void testScanFromFile_notJarFile() throws IOException {
    ClassLoader classLoader = ClassPathTest.class.getClassLoader();
    File notJar = File.createTempFile(&quot;not_a_jar&quot;, &quot;txt&quot;);
    try {
      assertThat(new ClassPath.LocationInfo(notJar, classLoader).scanResources()).isEmpty();
    } finally {
      notJar.delete();
    }
  }

  public void testGetClassPathEntry() throws MalformedURLException, URISyntaxException {
    assertEquals(
        new File(&quot;/usr/test/dep.jar&quot;).toURI(),
        ClassPath.getClassPathEntry(new File(&quot;/home/build/outer.jar&quot;), &quot;file:/usr/test/dep.jar&quot;)
            .toURI());
    assertEquals(
        new File(&quot;/home/build/a.jar&quot;).toURI(),
        ClassPath.getClassPathEntry(new File(&quot;/home/build/outer.jar&quot;), &quot;a.jar&quot;).toURI());
    assertEquals(
        new File(&quot;/home/build/x/y/z&quot;).toURI(),
        ClassPath.getClassPathEntry(new File(&quot;/home/build/outer.jar&quot;), &quot;x/y/z&quot;).toURI());
    assertEquals(
        new File(&quot;/home/build/x/y/z.jar&quot;).toURI(),
        ClassPath.getClassPathEntry(new File(&quot;/home/build/outer.jar&quot;), &quot;x/y/z.jar&quot;).toURI());
    assertEquals(
        &quot;/home/build/x y.jar&quot;,
        ClassPath.getClassPathEntry(new File(&quot;/home/build/outer.jar&quot;), &quot;x y.jar&quot;).getFile());
  }

  public void testGetClassPathFromManifest_nullManifest() {
    assertThat(ClassPath.getClassPathFromManifest(new File(&quot;some.jar&quot;), null)).isEmpty();
  }
<A NAME="6"></A>
  public void testGetClassPathFromManifest_noClassPath() throws IOException {
    File jarFile = new File(&quot;base.jar&quot;);
    assertThat(<FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#6',2,'match526437-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>ClassPath.getClassPathFromManifest(jarFile, manifest(&quot;&quot;))).isEmpty();
  }

  public void testGetClassPathFromManifest_emptyClassPath() throws IOException {
    File jarFile = new File(&quot;base.jar&quot;);
<A NAME="7"></A>    assertThat</B></FONT>(ClassPath.getClassPathFromManifest(jarFile, manifestClasspath(&quot;&quot;))).isEmpty();
  }

  public void testGetClassPathFromManifest_badClassPath() throws IOException <FONT color="#38a4a5"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#7',2,'match526437-top.html#7',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{
    File jarFile = new File(&quot;base.jar&quot;);
    Manifest manifest = manifestClasspath(&quot;nosuchscheme:an_invalid^path&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest)).isEmpty();
  }</B></FONT>
<A NAME="4"></A>
  public void testGetClassPathFromManifest_pathWithStrangeCharacter() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;);
    Manifest manifest = <FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#4',2,'match526437-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>manifestClasspath(&quot;file:the^file.jar&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(fullpath(&quot;base/the^file.jar&quot;));
  }

  public void testGetClassPathFromManifest_relativeDirectory() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;)</B></FONT>;
    // with/relative/directory is the Class-Path value in the mf file.
    Manifest manifest = manifestClasspath(&quot;with/relative/dir&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(fullpath(&quot;base/with/relative/dir&quot;));
  }

  public void testGetClassPathFromManifest_relativeJar() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;);
    // with/relative/directory is the Class-Path value in the mf file.
    Manifest manifest = manifestClasspath(&quot;with/relative.jar&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(fullpath(&quot;base/with/relative.jar&quot;));
  }

  public void testGetClassPathFromManifest_jarInCurrentDirectory() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;);
    // with/relative/directory is the Class-Path value in the mf file.
    Manifest manifest = manifestClasspath(&quot;current.jar&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(fullpath(&quot;base/current.jar&quot;));
  }

  public void testGetClassPathFromManifest_absoluteDirectory() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;);
    Manifest manifest = manifestClasspath(&quot;file:/with/absolute/dir&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(fullpath(&quot;/with/absolute/dir&quot;));
  }

  public void testGetClassPathFromManifest_absoluteJar() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;);
    Manifest manifest = manifestClasspath(&quot;file:/with/absolute.jar&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(fullpath(&quot;/with/absolute.jar&quot;));
  }

  public void testGetClassPathFromManifest_multiplePaths() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;);
    Manifest manifest = manifestClasspath(&quot;file:/with/absolute.jar relative.jar  relative/dir&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(
            fullpath(&quot;/with/absolute.jar&quot;),
            fullpath(&quot;base/relative.jar&quot;),
            fullpath(&quot;base/relative/dir&quot;))
        .inOrder();
  }

  public void testGetClassPathFromManifest_leadingBlanks() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;);
    Manifest manifest = manifestClasspath(&quot; relative.jar&quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(fullpath(&quot;base/relative.jar&quot;));
  }

  public void testGetClassPathFromManifest_trailingBlanks() throws IOException {
    File jarFile = new File(&quot;base/some.jar&quot;);
    Manifest manifest = manifestClasspath(&quot;relative.jar &quot;);
    assertThat(ClassPath.getClassPathFromManifest(jarFile, manifest))
        .containsExactly(fullpath(&quot;base/relative.jar&quot;));
  }

  public void testGetClassName() {
<A NAME="5"></A>    assertEquals(&quot;abc.d.Abc&quot;, ClassPath.getClassName(&quot;abc/d/Abc.class&quot;));
  }

  public void testResourceInfo_of() <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#5',2,'match526437-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{
    assertEquals(ClassInfo.class, resourceInfo(ClassPathTest.class).getClass());
    assertEquals(ClassInfo.class, resourceInfo(ClassPath.class).getClass());
    assertEquals(ClassInfo.class, resourceInfo</B></FONT>(Nested.class).getClass());
  }

  public void testGetSimpleName() {
    ClassLoader classLoader = getClass().getClassLoader();
    assertEquals(&quot;Foo&quot;, new ClassInfo(FILE, &quot;Foo.class&quot;, classLoader).getSimpleName());
    assertEquals(&quot;Foo&quot;, new ClassInfo(FILE, &quot;a/b/Foo.class&quot;, classLoader).getSimpleName());
    assertEquals(&quot;Foo&quot;, new ClassInfo(FILE, &quot;a/b/Bar$Foo.class&quot;, classLoader).getSimpleName());
    assertEquals(&quot;&quot;, new ClassInfo(FILE, &quot;a/b/Bar$1.class&quot;, classLoader).getSimpleName());
    assertEquals(&quot;Foo&quot;, new ClassInfo(FILE, &quot;a/b/Bar$Foo.class&quot;, classLoader).getSimpleName());
    assertEquals(&quot;&quot;, new ClassInfo(FILE, &quot;a/b/Bar$1.class&quot;, classLoader).getSimpleName());
    assertEquals(&quot;Local&quot;, new ClassInfo(FILE, &quot;a/b/Bar$1Local.class&quot;, classLoader).getSimpleName());
  }

  public void testGetPackageName() {
    assertEquals(
        &quot;&quot;, new ClassInfo(FILE, &quot;Foo.class&quot;, getClass().getClassLoader()).getPackageName());
    assertEquals(
        &quot;a.b&quot;, new ClassInfo(FILE, &quot;a/b/Foo.class&quot;, getClass().getClassLoader()).getPackageName());
  }

  // Test that ResourceInfo.urls() returns identical content to ClassLoader.getResources()


  public void testGetClassPathUrls() throws Exception {
    String oldPathSeparator = PATH_SEPARATOR.value();
    String oldClassPath = JAVA_CLASS_PATH.value();
    System.setProperty(PATH_SEPARATOR.key(), &quot;:&quot;);
    System.setProperty(
        JAVA_CLASS_PATH.key(),
        Joiner.on(&quot;:&quot;)
            .join(
                &quot;relative/path/to/some.jar&quot;,
                &quot;/absolute/path/to/some.jar&quot;,
                &quot;relative/path/to/class/root&quot;,
                &quot;/absolute/path/to/class/root&quot;));
    try {
      ImmutableList&lt;URL&gt; urls = ClassPath.parseJavaClassPath();

      assertThat(urls.get(0).getProtocol()).isEqualTo(&quot;file&quot;);
<A NAME="0"></A>      assertThat(urls.get(0).getAuthority()).isNull();
      assertThat(urls.get(0).getPath()).endsWith(&quot;/relative/path/to/some.jar&quot;);

      assertThat(urls.get(1)).isEqualTo(<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#0',2,'match526437-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>new URL(&quot;file:///absolute/path/to/some.jar&quot;));

      assertThat(urls.get(2).getProtocol()).isEqualTo(&quot;file&quot;);
      assertThat(urls.get(2).getAuthority()).isNull();
      assertThat(urls.get(2).getPath()).endsWith(&quot;/relative/path/to/class/root&quot;);

      assertThat(urls.get</B></FONT>(3)).isEqualTo(new URL(&quot;file:///absolute/path/to/class/root&quot;));

      assertThat(urls).hasSize(4);
    } finally {
      System.setProperty(PATH_SEPARATOR.key(), oldPathSeparator);
      System.setProperty(JAVA_CLASS_PATH.key(), oldClassPath);
    }
  }

  private static boolean contentEquals(URL left, URL right) throws IOException {
    return Resources.asByteSource(left).contentEquals(Resources.asByteSource(right));
  }

  private static class Nested {}


  public void testNulls() throws IOException {
    new NullPointerTester().testAllPublicStaticMethods(ClassPath.class);
    new NullPointerTester()
        .testAllPublicInstanceMethods(ClassPath.from(getClass().getClassLoader()));
  }


  public void testLocationsFrom_idempotentScan() throws IOException {
    ImmutableSet&lt;ClassPath.LocationInfo&gt; locations =
<A NAME="2"></A>        ClassPath.locationsFrom(getClass().getClassLoader());
    assertThat(locations).isNotEmpty();
    for (ClassPath.LocationInfo location : locations) {
      ImmutableSet&lt;ResourceInfo&gt; resources = <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#2',2,'match526437-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>location.scanResources();
      assertThat(location.scanResources()).containsExactlyElementsIn(resources);
    }
  }

  public void testLocationsFrom_idempotentLocations() {
    ImmutableSet&lt;ClassPath.LocationInfo&gt; locations =</B></FONT>
        ClassPath.locationsFrom(getClass().getClassLoader());
    assertThat(ClassPath.locationsFrom(getClass().getClassLoader()))
        .containsExactlyElementsIn(locations);
  }

  public void testLocationEquals() {
    ClassLoader child = getClass().getClassLoader();
    ClassLoader parent = child.getParent();
    new EqualsTester()
        .addEqualityGroup(
            new ClassPath.LocationInfo(new File(&quot;foo.jar&quot;), child),
            new ClassPath.LocationInfo(new File(&quot;foo.jar&quot;), child))
        .addEqualityGroup(new ClassPath.LocationInfo(new File(&quot;foo.jar&quot;), parent))
        .addEqualityGroup(new ClassPath.LocationInfo(new File(&quot;foo&quot;), child))
        .testEquals();
  }


  public void testScanAllResources() throws IOException {
    assertThat(scanResourceNames(ClassLoader.getSystemClassLoader()))
        .contains(&quot;com/google/common/reflect/ClassPathTest.class&quot;);
  }


  public void testExistsThrowsSecurityException() throws IOException, URISyntaxException {
    SecurityManager oldSecurityManager = System.getSecurityManager();
    try {
      doTestExistsThrowsSecurityException();
    } finally {
      System.setSecurityManager(oldSecurityManager);
    }
  }

  private void doTestExistsThrowsSecurityException() throws IOException, URISyntaxException {
    File file = null;
    // In Java 9, Logger may read the TZ database. Only disallow reading the class path URLs.
    final PermissionCollection readClassPathFiles =
        new FilePermission(&quot;&quot;, &quot;read&quot;).newPermissionCollection();
    for (URL url : ClassPath.parseJavaClassPath()) {
      if (url.getProtocol().equalsIgnoreCase(&quot;file&quot;)) {
        file = new File(url.toURI());
        readClassPathFiles.add(new FilePermission(file.getAbsolutePath(), &quot;read&quot;));
      }
    }
    assertThat(file).isNotNull();
    SecurityManager disallowFilesSecurityManager =
        new SecurityManager() {
          @Override
          public void checkPermission(Permission p) {
            if (readClassPathFiles.implies(p)) {
              throw new SecurityException(&quot;Disallowed: &quot; + p);
            }
          }
        };
    System.setSecurityManager(disallowFilesSecurityManager);
    try {
      file.exists();
      fail(&quot;Did not get expected SecurityException&quot;);
    } catch (SecurityException expected) {
<A NAME="8"></A>    }
    ClassPath classPath = ClassPath.from(getClass().getClassLoader());
    // ClassPath may contain resources from the boot class loader; just not from the class path.
    for (ResourceInfo resource : classPath.getResources()) <FONT color="#c58917"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#8',2,'match526437-top.html#8',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{
      assertThat(resource.getResourceName()).doesNotContain(&quot;com/google/common/reflect/&quot;);
    }
  }

  private s</B></FONT>tatic ClassPath.ClassInfo findClass(
      Iterable&lt;ClassPath.ClassInfo&gt; classes, Class&lt;?&gt; cls) {
    for (ClassPath.ClassInfo classInfo : classes) {
      if (classInfo.getName().equals(cls.getName())) {
        return classInfo;
      }
    }
    throw new AssertionError(&quot;failed to find &quot; + cls);
  }

  private static ResourceInfo resourceInfo(Class&lt;?&gt; cls) {
    String resource = cls.getName().replace('.', '/') + &quot;.class&quot;;
    ClassLoader loader = cls.getClassLoader();
<A NAME="3"></A>    return ResourceInfo.of(FILE, resource, loader);
  }

  private static ClassInfo classInfo(<FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match526437-0.html#3',2,'match526437-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Class&lt;?&gt; cls) {
    return classInfo(cls, cls.getClassLoader());
  }

  private static ClassInfo classInfo(Class&lt;?&gt; cls, ClassLoader classLoader) {</B></FONT>
    String resource = cls.getName().replace('.', '/') + &quot;.class&quot;;
    return new ClassInfo(FILE, resource, classLoader);
  }

  private static Manifest manifestClasspath(String classpath) throws IOException {
    return manifest(&quot;Class-Path: &quot; + classpath + &quot;\n&quot;);
  }

  private static void writeSelfReferencingJarFile(File jarFile, String... entries)
      throws IOException {
    Manifest manifest = new Manifest();
    // Without version, the manifest is silently ignored. Ugh!
    manifest.getMainAttributes().put(Attributes.Name.MANIFEST_VERSION, &quot;1.0&quot;);
    manifest.getMainAttributes().put(Attributes.Name.CLASS_PATH, jarFile.getName());

    Closer closer = Closer.create();
    try {
      FileOutputStream fileOut = closer.register(new FileOutputStream(jarFile));
      JarOutputStream jarOut = closer.register(new JarOutputStream(fileOut));
      for (String entry : entries) {
        jarOut.putNextEntry(new ZipEntry(entry));
        Resources.copy(ClassPathTest.class.getResource(entry), jarOut);
        jarOut.closeEntry();
      }
    } catch (Throwable e) {
      throw closer.rethrow(e);
    } finally {
      closer.close();
    }
  }

  private static Manifest manifest(String content) throws IOException {
    InputStream in = new ByteArrayInputStream(content.getBytes(US_ASCII));
    Manifest manifest = new Manifest();
    manifest.read(in);
    return manifest;
  }

  private static File fullpath(String path) {
    return new File(new File(path).toURI());
  }

  private static URL makeJarUrlWithName(String name) throws IOException {
    File fullPath = new File(Files.createTempDir(), name);
    File jarFile = pickAnyJarFile();
    Files.copy(jarFile, fullPath);
    return fullPath.toURI().toURL();
  }

  private static File pickAnyJarFile() throws IOException {
    for (ClassPath.LocationInfo location :
        ClassPath.locationsFrom(ClassPathTest.class.getClassLoader())) {
      if (!location.file().isDirectory() &amp;&amp; location.file().exists()) {
        return location.file();
      }
    }
    throw new AssertionError(&quot;Failed to find a jar file&quot;);
  }

  @AndroidIncompatible // Path (for symlink creation)
  private static void deleteRecursivelyOrLog(java.nio.file.Path path) {
    try {
      deleteRecursively(path);
    } catch (IOException e) {
      log.log(WARNING, &quot;Failure cleaning up test directory&quot;, e);
    }
  }

  private static ImmutableSet&lt;String&gt; scanResourceNames(ClassLoader loader) throws IOException {
    ImmutableSet.Builder&lt;String&gt; builder = ImmutableSet.builder();
    for (ClassPath.LocationInfo location : ClassPath.locationsFrom(loader)) {
      for (ResourceInfo resource : location.scanResources()) {
        builder.add(resource.getResourceName());
      }
    }
    return builder.build();
  }
}
</PRE>
</div>
  </div>
</body>
</html>
