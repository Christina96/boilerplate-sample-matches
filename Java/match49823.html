<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for LinkedHashMultimapTest_1.java & ListsTest.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for LinkedHashMultimapTest_1.java & ListsTest.java
      </h3>
      <h1 align="center">
        34.5%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>LinkedHashMultimapTest_1.java (56.651016%)<TH>ListsTest.java (24.828533%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#0',2,'match49823-1.html#0',3)" NAME="0">(194-224)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#0',2,'match49823-1.html#0',3)" NAME="0">(621-638)</A><TD ALIGN=center><FONT COLOR="#ff0000">46</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#1',2,'match49823-1.html#1',3)" NAME="1">(19-52)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#1',2,'match49823-1.html#1',3)" NAME="1">(27-61)</A><TD ALIGN=center><FONT COLOR="#a00000">29</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#2',2,'match49823-1.html#2',3)" NAME="2">(120-138)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#2',2,'match49823-1.html#2',3)" NAME="2">(367-386)</A><TD ALIGN=center><FONT COLOR="#9b0000">28</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#3',2,'match49823-1.html#3',3)" NAME="3">(265-279)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#3',2,'match49823-1.html#3',3)" NAME="3">(430-445)</A><TD ALIGN=center><FONT COLOR="#8a0000">25</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#4',2,'match49823-1.html#4',3)" NAME="4">(225-239)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#4',2,'match49823-1.html#4',3)" NAME="4">(665-678)</A><TD ALIGN=center><FONT COLOR="#850000">24</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#5',2,'match49823-1.html#5',3)" NAME="5">(161-167)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#5',2,'match49823-1.html#5',3)" NAME="5">(543-558)</A><TD ALIGN=center><FONT COLOR="#740000">21</FONT>
<TR><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#6',2,'match49823-1.html#6',3)" NAME="6">(57-65)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#6',2,'match49823-1.html#6',3)" NAME="6">(141-150)</A><TD ALIGN=center><FONT COLOR="#6e0000">20</FONT>
<TR><TD BGCOLOR="#38a4a5"><FONT COLOR="#38a4a5">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#7',2,'match49823-1.html#7',3)" NAME="7">(184-193)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#7',2,'match49823-1.html#7',3)" NAME="7">(981-993)</A><TD ALIGN=center><FONT COLOR="#630000">18</FONT>
<TR><TD BGCOLOR="#c58917"><FONT COLOR="#c58917">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#8',2,'match49823-1.html#8',3)" NAME="8">(169-174)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#8',2,'match49823-1.html#8',3)" NAME="8">(612-617)</A><TD ALIGN=center><FONT COLOR="#630000">18</FONT>
<TR><TD BGCOLOR="#83a33a"><FONT COLOR="#83a33a">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#9',2,'match49823-1.html#9',3)" NAME="9">(428-435)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#9',2,'match49823-1.html#9',3)" NAME="9">(597-606)</A><TD ALIGN=center><FONT COLOR="#530000">15</FONT>
<TR><TD BGCOLOR="#ad5910"><FONT COLOR="#ad5910">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#10',2,'match49823-1.html#10',3)" NAME="10">(393-400)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#10',2,'match49823-1.html#10',3)" NAME="10">(559-568)</A><TD ALIGN=center><FONT COLOR="#530000">15</FONT>
<TR><TD BGCOLOR="#b041ff"><FONT COLOR="#b041ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#11',2,'match49823-1.html#11',3)" NAME="11">(153-161)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#11',2,'match49823-1.html#11',3)" NAME="11">(461-470)</A><TD ALIGN=center><FONT COLOR="#530000">15</FONT>
<TR><TD BGCOLOR="#571b7e"><FONT COLOR="#571b7e">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#12',2,'match49823-1.html#12',3)" NAME="12">(415-422)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#12',2,'match49823-1.html#12',3)" NAME="12">(505-514)</A><TD ALIGN=center><FONT COLOR="#4d0000">14</FONT>
<TR><TD BGCOLOR="#3b9c9c"><FONT COLOR="#3b9c9c">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#13',2,'match49823-1.html#13',3)" NAME="13">(240-249)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#13',2,'match49823-1.html#13',3)" NAME="13">(310-318)</A><TD ALIGN=center><FONT COLOR="#4d0000">14</FONT>
<TR><TD BGCOLOR="#842dce"><FONT COLOR="#842dce">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#14',2,'match49823-1.html#14',3)" NAME="14">(141-149)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#14',2,'match49823-1.html#14',3)" NAME="14">(392-399)</A><TD ALIGN=center><FONT COLOR="#420000">12</FONT>
<TR><TD BGCOLOR="#f52887"><FONT COLOR="#f52887">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#15',2,'match49823-1.html#15',3)" NAME="15">(257-264)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#15',2,'match49823-1.html#15',3)" NAME="15">(360-366)</A><TD ALIGN=center><FONT COLOR="#3c0000">11</FONT>
<TR><TD BGCOLOR="#2981b2"><FONT COLOR="#2981b2">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#16',2,'match49823-1.html#16',3)" NAME="16">(113-119)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#16',2,'match49823-1.html#16',3)" NAME="16">(779-784)</A><TD ALIGN=center><FONT COLOR="#370000">10</FONT>
<TR><TD BGCOLOR="#3090c7"><FONT COLOR="#3090c7">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#17',2,'match49823-1.html#17',3)" NAME="17">(307-315)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#17',2,'match49823-1.html#17',3)" NAME="17">(473-479)</A><TD ALIGN=center><FONT COLOR="#310000">9</FONT>
<TR><TD BGCOLOR="#800517"><FONT COLOR="#800517">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#18',2,'match49823-1.html#18',3)" NAME="18">(299-305)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#18',2,'match49823-1.html#18',3)" NAME="18">(498-504)</A><TD ALIGN=center><FONT COLOR="#310000">9</FONT>
<TR><TD BGCOLOR="#f62817"><FONT COLOR="#f62817">-</FONT><TD><A HREF="javascript:ZweiFrames('match49823-0.html#19',2,'match49823-1.html#19',3)" NAME="19">(177-180)<TD><A HREF="javascript:ZweiFrames('match49823-0.html#19',2,'match49823-1.html#19',3)" NAME="19">(957-961)</A><TD ALIGN=center><FONT COLOR="#310000">9</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>LinkedHashMultimapTest_1.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2007 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
<A NAME="1"></A>
package com.google.common.collect;

<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match49823-1.html#1',3,'match49823-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>import static com.google.common.collect.Lists.newArrayList;
import static com.google.common.collect.Sets.newHashSet;
import static com.google.common.collect.Sets.newLinkedHashSet;
import static com.google.common.collect.testing.Helpers.mapEntry;
import static com.google.common.collect.testing.IteratorFeature.MODIFIABLE;
import static com.google.common.truth.Truth.assertThat;
import static java.util.Arrays.asList;

import com.google.common.annotations.GwtCompatible;
import com.google.common.annotations.GwtIncompatible;
import com.google.common.collect.testing.IteratorTester;
import com.google.common.collect.testing.features.CollectionFeature;
import com.google.common.collect.testing.features.CollectionSize;
import com.google.common.collect.testing.features.MapFeature;
import com.google.common.collect.testing.google.SetMultimapTestSuiteBuilder;
import com.google.common.collect.testing.google.TestStringSetMultimapGenerator;
import com.google.common.testing.EqualsTester;
import com.google.common.testing.SerializableTester;
import java.util.Arrays;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;
import java.util.Map.Entry;
import java.util.Set;
import junit.framework.Test;
import junit.framework.TestCase;
import junit.framework.TestSuite;

/**
 * Unit tests for {@code LinkedHashMultimap}.
 *
 * @author Jared Levy
 */
@GwtCompatible(e</B></FONT>mulated = true)
public class LinkedHashMultimapTest extends TestCase {
<A NAME="6"></A>
  @GwtIncompatible // suite
  public static Test suite() {
    <FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match49823-1.html#6',3,'match49823-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>TestSuite suite = new TestSuite();
    suite.addTest(
        SetMultimapTestSuiteBuilder.using(
                new TestStringSetMultimapGenerator() {
                  @Override
                  protected SetMultimap&lt;String, String&gt; create(Entry&lt;String, String&gt;[] entries) {
                    SetMultimap&lt;String, String&gt; multimap = LinkedHashMultimap.create();
                    for (Entry&lt;String, String&gt; entry : entries) {
                      multimap.put(entry.getKey</B></FONT>(), entry.getValue());
                    }
                    return multimap;
                  }
                })
            .named(&quot;LinkedHashMultimap&quot;)
            .withFeatures(
                MapFeature.ALLOWS_NULL_KEYS,
                MapFeature.ALLOWS_NULL_VALUES,
                MapFeature.ALLOWS_ANY_NULL_QUERIES,
                MapFeature.GENERAL_PURPOSE,
                MapFeature.FAILS_FAST_ON_CONCURRENT_MODIFICATION,
                CollectionFeature.SUPPORTS_ITERATOR_REMOVE,
                CollectionFeature.KNOWN_ORDER,
                CollectionFeature.SERIALIZABLE,
                CollectionSize.ANY)
            .createTestSuite());
    suite.addTestSuite(LinkedHashMultimapTest.class);
    return suite;
  }

  public void testValueSetHashTableExpansion() {
    LinkedHashMultimap&lt;String, Integer&gt; multimap = LinkedHashMultimap.create();
    for (int z = 1; z &lt;= 100; z++) {
      multimap.put(&quot;a&quot;, z);
      // The Eclipse compiler (and hence GWT) rejects a parameterized cast.
      @SuppressWarnings(&quot;unchecked&quot;)
      LinkedHashMultimap&lt;String, Integer&gt;.ValueSet valueSet =
          (LinkedHashMultimap.ValueSet) multimap.backingMap().get(&quot;a&quot;);
      assertEquals(z, valueSet.size());
      assertFalse(
          Hashing.needsResizing(
              valueSet.size(),
              valueSet.hashTable.length,
              LinkedHashMultimap.VALUE_SET_LOAD_FACTOR));
    }
  }

  private Multimap&lt;String, Integer&gt; initializeMultimap5() {
    Multimap&lt;String, Integer&gt; multimap = LinkedHashMultimap.create();
    multimap.put(&quot;foo&quot;, 5);
    multimap.put(&quot;bar&quot;, 4);
    multimap.put(&quot;foo&quot;, 3);
    multimap.put(&quot;cow&quot;, 2);
    multimap.put(&quot;bar&quot;, 1);
<A NAME="16"></A>    return multimap;
  }

  public void testToString() <FONT color="#2981b2"><A HREF="javascript:ZweiFrames('match49823-1.html#16',3,'match49823-top.html#16',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
    Multimap&lt;String, Integer&gt; multimap = LinkedHashMultimap.create();
    multimap.put(&quot;foo&quot;, 3);
    multimap.put(&quot;bar&quot;, 1);
<A NAME="2"></A>    multimap.putAll(&quot;foo&quot;, Arrays.asList(-1, 2, 4));
    multimap.putAll(&quot;bar&quot;, Arrays.asList(2, 3));
    multimap.put</B></FONT>(&quot;foo&quot;, 1);
    <FONT color="#980517"><A HREF="javascript:ZweiFrames('match49823-1.html#2',3,'match49823-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertEquals(&quot;{foo=[3, -1, 2, 4, 1], bar=[1, 2, 3]}&quot;, multimap.toString());
  }

  public void testOrderingReadOnly() {
    Multimap&lt;String, Integer&gt; multimap = initializeMultimap5();
    assertOrderingReadOnly(multimap);
  }

  public void testOrderingUnmodifiable() {
    Multimap&lt;String, Integer&gt; multimap = initializeMultimap5();
    assertOrderingReadOnly(Multimaps.unmodifiableMultimap(multimap));
  }

  public void testOrderingSynchronized() {
    Multimap&lt;String, Integer&gt; multimap = initializeMultimap5();
    assertOrderingReadOnly(Multimaps.synchronizedMultimap(multimap));
  }

<A NAME="14"></A>  @GwtIncompatible // Seria</B></FONT>zableTester
  public void testSerializationOrdering() {
    Multimap&lt;String, Integer&gt; multimap = initializeMultimap5();
    <FONT color="#842dce"><A HREF="javascript:ZweiFrames('match49823-1.html#14',3,'match49823-top.html#14',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Multimap&lt;String, Integer&gt; copy = SerializableTester.reserializeAndAssert(multimap);
    assertOrderingReadOnly(copy);
  }

  @GwtIncompatible // SeriazableTester
  public void testSerializationOrderingKeysAndEntries() {
    Multimap&lt;String, Integer&gt; multimap = LinkedHashMultimap.create();
    multimap.put(&quot;a&quot;, 1);
    multimap.put</B></FONT>(&quot;b&quot;, 2);
<A NAME="11"></A>    multimap.put(&quot;a&quot;, 3);
    multimap.put(&quot;c&quot;, 4);
    multimap.remove(&quot;a&quot;, 1);
    multimap = <FONT color="#b041ff"><A HREF="javascript:ZweiFrames('match49823-1.html#11',3,'match49823-top.html#11',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>SerializableTester.reserializeAndAssert(multimap);
    assertThat(multimap.keySet()).containsExactly(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;).inOrder();
    assertThat(multimap.entries())
        .containsExactly(mapEntry(&quot;b&quot;, 2), mapEntry(&quot;a&quot;, 3), mapEntry(&quot;c&quot;, 4))
        .inOrder();
<A NAME="5"></A>    // note that the keys and entries are in different orders
  }

  private void assertOrd</B></FONT>eringReadOnly(<FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match49823-1.html#5',3,'match49823-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Multimap&lt;String, Integer&gt; multimap) {
    assertThat(multimap.get(&quot;foo&quot;)).containsExactly(5, 3).inOrder();
    assertThat(multimap.get(&quot;bar&quot;)).containsExactly(4, 1).inOrder();
    assertThat(multimap.get(&quot;cow&quot;)).contains(2);

<A NAME="8"></A>    assertThat(multimap.keySet()).containsExactly(&quot;foo&quot;, &quot;bar&quot;, &quot;cow&quot;).inOrder();
    assertThat(multimap.values</B></FONT>()).containsExactly(5, 4, 3, 2, 1).inOrder();

    <FONT color="#c58917"><A HREF="javascript:ZweiFrames('match49823-1.html#8',3,'match49823-top.html#8',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Iterator&lt;Entry&lt;String, Integer&gt;&gt; entryIterator = multimap.entries().iterator();
    assertEquals(Maps.immutableEntry(&quot;foo&quot;, 5), entryIterator.next());
    assertEquals(Maps.immutableEntry(&quot;bar&quot;, 4), entryIterator.next());
    assertEquals(Maps.immutableEntry(&quot;foo&quot;, 3), entryIterator.next());
    assertEquals(Maps.immutableEntry(&quot;cow&quot;, 2), entryIterator.next());
<A NAME="19"></A>    assertEquals(Maps.immutableEntry(&quot;bar&quot;, 1), entryIterator.next</B></FONT>());

    Iterator&lt;Entry&lt;String, Collection&lt;Integer&gt;&gt;&gt; collectionIterator =
        <FONT color="#f62817"><A HREF="javascript:ZweiFrames('match49823-1.html#19',3,'match49823-top.html#19',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>multimap.asMap().entrySet().iterator();
    Entry&lt;String, Collection&lt;Integer&gt;&gt; entry = collectionIterator.next();
    assertEquals(&quot;foo&quot;, entry.getKey());
    assertThat</B></FONT>(entry.getValue()).containsExactly(5, 3).inOrder();
<A NAME="7"></A>    entry = collectionIterator.next();
    assertEquals(&quot;bar&quot;, entry.getKey());
    assertThat(entry.getValue()).containsExactly(4, 1).inOrder();
    entry = <FONT color="#38a4a5"><A HREF="javascript:ZweiFrames('match49823-1.html#7',3,'match49823-top.html#7',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>collectionIterator.next();
    assertEquals(&quot;cow&quot;, entry.getKey());
    assertThat(entry.getValue()).contains(2);
  }

  public void testOrderingUpdates() {
    Multimap&lt;String, Integer&gt; multimap = initializeMultimap5();
<A NAME="0"></A>
    assertThat(multimap.replaceValues(&quot;foo&quot;, asList(6, 7))).containsExactly(5, 3).inOrder();
    assertThat(multimap.keySet()).containsExactly(&quot;foo&quot;, &quot;bar&quot;, &quot;cow&quot;).inOrder</B></FONT>();
    <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match49823-1.html#0',3,'match49823-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertThat(multimap.removeAll(&quot;foo&quot;)).containsExactly(6, 7).inOrder();
    assertThat(multimap.keySet()).containsExactly(&quot;bar&quot;, &quot;cow&quot;).inOrder();
    assertTrue(multimap.remove(&quot;bar&quot;, 4));
    assertThat(multimap.keySet()).containsExactly(&quot;bar&quot;, &quot;cow&quot;).inOrder();
    assertTrue(multimap.remove(&quot;bar&quot;, 1));
    assertThat(multimap.keySet()).contains(&quot;cow&quot;);
    multimap.put(&quot;bar&quot;, 9);
    assertThat(multimap.keySet()).containsExactly(&quot;cow&quot;, &quot;bar&quot;).inOrder();
  }

  public void testToStringNullExact() {
    Multimap&lt;String, Integer&gt; multimap = LinkedHashMultimap.create();

    multimap.put(&quot;foo&quot;, 3);
    multimap.put(&quot;foo&quot;, -1);
    multimap.put(null, null);
    multimap.put(&quot;bar&quot;, 1);
    multimap.put(&quot;foo&quot;, 2);
    multimap.put(null, 0);
    multimap.put(&quot;bar&quot;, 2);
    multimap.put(&quot;bar&quot;, null);
    multimap.put(&quot;foo&quot;, null);
    multimap.put(&quot;foo&quot;, 4);
    multimap.put(null, -1);
    multimap.put(&quot;bar&quot;, 3);
    multimap.put(&quot;bar&quot;, 1);
    multimap.put(&quot;foo&quot;, 1);

<A NAME="4"></A>    assertEquals(
        &quot;{foo=[3, -1, 2, null, 4, 1], null=[null, 0, -1], bar=[1, 2, null, 3]}&quot;,
        multimap.toString</B></FONT>());
  <FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match49823-1.html#4',3,'match49823-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}

  public void testPutMultimapOrdered() {
    Multimap&lt;String, Integer&gt; multimap = LinkedHashMultimap.create();
    multimap.putAll(initializeMultimap5());
    assertOrderingReadOnly(multimap);
  }

  public void testKeysToString_ordering() {
    Multimap&lt;String, Integer&gt; multimap = initializeMultimap5();
    assertEquals(&quot;[foo x 2, bar x 2, cow]&quot;, multimap.keys().toString());
  }
<A NAME="13"></A>
  public void testCreate() {
    LinkedHashMultimap&lt;String, Integer&gt; multimap = LinkedHashMultimap.create</B></FONT>();
    <FONT color="#3b9c9c"><A HREF="javascript:ZweiFrames('match49823-1.html#13',3,'match49823-top.html#13',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>multimap.put(&quot;foo&quot;, 1);
    multimap.put(&quot;bar&quot;, 2);
    multimap.put(&quot;foo&quot;, 3);
    assertEquals(ImmutableSet.of(1, 3), multimap.get(&quot;foo&quot;));
  }

  public void testCreateFromMultimap() {
    Multimap&lt;String, Integer&gt; multimap = LinkedHashMultimap.create();
    multimap.put(&quot;a&quot;, 1);
    multimap.put</B></FONT>(&quot;b&quot;, 2);
    multimap.put(&quot;a&quot;, 3);
    multimap.put(&quot;c&quot;, 4);
    LinkedHashMultimap&lt;String, Integer&gt; copy = LinkedHashMultimap.create(multimap);
    new EqualsTester().addEqualityGroup(multimap, copy).testEquals();
<A NAME="15"></A>  }

  public void testCreateFromSizes() {
    LinkedHashMultimap&lt;String, Integer&gt; multimap = <FONT color="#f52887"><A HREF="javascript:ZweiFrames('match49823-1.html#15',3,'match49823-top.html#15',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>LinkedHashMultimap.create(20, 15);
    multimap.put(&quot;foo&quot;, 1);
    multimap.put(&quot;bar&quot;, 2);
    multimap.put(&quot;foo&quot;, 3);
    assertEquals(ImmutableSet.of(1, 3), multimap.get(&quot;foo&quot;));
<A NAME="3"></A>  }

  public void testCreateFromIllegalSizes() {</B></FONT>
    <FONT color="#53858b"><A HREF="javascript:ZweiFrames('match49823-1.html#3',3,'match49823-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>try {
      LinkedHashMultimap.create(-20, 15);
      fail();
    } catch (IllegalArgumentException expected) {
    }

    try {
      LinkedHashMultimap.create(20, -15);
      fail();
    } catch (IllegalArgumentException expected) {
    }
  }

  @GwtIncompatible // unreasonably slow
  public void testGetIteration() {</B></FONT>
    new IteratorTester&lt;Integer&gt;(
        6,
        MODIFIABLE,
        newLinkedHashSet(asList(2, 3, 4, 7, 8)),
        IteratorTester.KnownOrder.KNOWN_ORDER) {
      private Multimap&lt;String, Integer&gt; multimap;

      @Override
      protected Iterator&lt;Integer&gt; newTargetIterator() {
        multimap = LinkedHashMultimap.create();
        multimap.putAll(&quot;foo&quot;, asList(2, 3, 4));
        multimap.putAll(&quot;bar&quot;, asList(5, 6));
        multimap.putAll(&quot;foo&quot;, asList(7, 8));
        return multimap.get(&quot;foo&quot;).iterator();
      }

<A NAME="18"></A>      @Override
      protected void verify(List&lt;Integer&gt; elements) {
        assertEquals(newHashSet(elements), multimap.get(&quot;foo&quot;));
      <FONT color="#800517"><A HREF="javascript:ZweiFrames('match49823-1.html#18',3,'match49823-top.html#18',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}
    }.test();
  }

  @GwtIncompatible // unreasonably slow
<A NAME="17"></A>  public void testEntriesIteration() {
    @SuppressWarnings(&quot;unchecked&quot;)</B></FONT>
    Set&lt;Entry&lt;String, Integer&gt;&gt; set =
        <FONT color="#3090c7"><A HREF="javascript:ZweiFrames('match49823-1.html#17',3,'match49823-top.html#17',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>Sets.newLinkedHashSet(
            asList(
                Maps.immutableEntry(&quot;foo&quot;, 2),
                Maps.immutableEntry(&quot;foo&quot;, 3),
                Maps.immutableEntry(&quot;bar&quot;, 4),
                Maps.immutableEntry(&quot;bar&quot;, 5),
                Maps.immutableEntry(&quot;foo&quot;, 6)));

    new</B></FONT> IteratorTester&lt;Entry&lt;String, Integer&gt;&gt;(
        6, MODIFIABLE, set, IteratorTester.KnownOrder.KNOWN_ORDER) {
      private Multimap&lt;String, Integer&gt; multimap;

      @Override
      protected Iterator&lt;Entry&lt;String, Integer&gt;&gt; newTargetIterator() {
        multimap = LinkedHashMultimap.create();
        multimap.putAll(&quot;foo&quot;, asList(2, 3));
        multimap.putAll(&quot;bar&quot;, asList(4, 5));
        multimap.putAll(&quot;foo&quot;, asList(6));
        return multimap.entries().iterator();
      }

      @Override
      protected void verify(List&lt;Entry&lt;String, Integer&gt;&gt; elements) {
        assertEquals(newHashSet(elements), multimap.entries());
      }
    }.test();
  }

  @GwtIncompatible // unreasonably slow
  public void testKeysIteration() {
    new IteratorTester&lt;String&gt;(
        6,
        MODIFIABLE,
        newArrayList(&quot;foo&quot;, &quot;foo&quot;, &quot;bar&quot;, &quot;bar&quot;, &quot;foo&quot;),
        IteratorTester.KnownOrder.KNOWN_ORDER) {
      private Multimap&lt;String, Integer&gt; multimap;

      @Override
      protected Iterator&lt;String&gt; newTargetIterator() {
        multimap = LinkedHashMultimap.create();
        multimap.putAll(&quot;foo&quot;, asList(2, 3));
        multimap.putAll(&quot;bar&quot;, asList(4, 5));
        multimap.putAll(&quot;foo&quot;, asList(6));
        return multimap.keys().iterator();
      }

      @Override
      protected void verify(List&lt;String&gt; elements) {
        assertEquals(elements, Lists.newArrayList(multimap.keys()));
      }
    }.test();
  }

  @GwtIncompatible // unreasonably slow
  public void testValuesIteration() {
    new IteratorTester&lt;Integer&gt;(
        6, MODIFIABLE, newArrayList(2, 3, 4, 5, 6), IteratorTester.KnownOrder.KNOWN_ORDER) {
      private Multimap&lt;String, Integer&gt; multimap;

      @Override
      protected Iterator&lt;Integer&gt; newTargetIterator() {
        multimap = LinkedHashMultimap.create();
        multimap.putAll(&quot;foo&quot;, asList(2, 3));
        multimap.putAll(&quot;bar&quot;, asList(4, 5));
        multimap.putAll(&quot;foo&quot;, asList(6));
        return multimap.values().iterator();
      }

      @Override
      protected void verify(List&lt;Integer&gt; elements) {
        assertEquals(elements, Lists.newArrayList(multimap.values()));
      }
    }.test();
  }

  @GwtIncompatible // unreasonably slow
  public void testKeySetIteration() {
    new IteratorTester&lt;String&gt;(
        6,
        MODIFIABLE,
        newLinkedHashSet(asList(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;, &quot;dog&quot;, &quot;cat&quot;)),
        IteratorTester.KnownOrder.KNOWN_ORDER) {
      private Multimap&lt;String, Integer&gt; multimap;
<A NAME="10"></A>
      @Override
      protected Iterator&lt;String&gt; newTargetIterator() {
        multimap = <FONT color="#ad5910"><A HREF="javascript:ZweiFrames('match49823-1.html#10',3,'match49823-top.html#10',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>LinkedHashMultimap.create();
        multimap.putAll(&quot;foo&quot;, asList(2, 3));
        multimap.putAll(&quot;bar&quot;, asList(4, 5));
        multimap.putAll(&quot;foo&quot;, asList(6));
        multimap.putAll(&quot;baz&quot;, asList(7, 8));
        multimap.putAll(&quot;dog&quot;, asList(9));
        multimap.putAll(&quot;bar&quot;, asList(10, 11));
        multimap.putAll(&quot;cat&quot;, asList</B></FONT>(12, 13, 14));
        return multimap.keySet().iterator();
      }

      @Override
      protected void verify(List&lt;String&gt; elements) {
        assertEquals(newHashSet(elements), multimap.keySet());
      }
    }.test();
  }

  @GwtIncompatible // unreasonably slow
<A NAME="12"></A>  public void testAsSetIteration() {
    @SuppressWarnings(&quot;unchecked&quot;)
    Set&lt;Entry&lt;String, Collection&lt;Integer&gt;&gt;&gt; set =
        <FONT color="#571b7e"><A HREF="javascript:ZweiFrames('match49823-1.html#12',3,'match49823-top.html#12',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>newLinkedHashSet(
            asList(
                Maps.immutableEntry(&quot;foo&quot;, (Collection&lt;Integer&gt;) Sets.newHashSet(2, 3, 6)),
                Maps.immutableEntry(&quot;bar&quot;, (Collection&lt;Integer&gt;) Sets.newHashSet(4, 5, 10, 11)),
                Maps.immutableEntry(&quot;baz&quot;, (Collection&lt;Integer&gt;) Sets.newHashSet(7, 8)),
                Maps.immutableEntry(&quot;dog&quot;, (Collection&lt;Integer&gt;) Sets.newHashSet(9)),
                Maps.immutableEntry(&quot;cat&quot;, (Collection&lt;Integer&gt;) Sets.newHashSet(12, 13, 14))));
    new</B></FONT> IteratorTester&lt;Entry&lt;String, Collection&lt;Integer&gt;&gt;&gt;(
        6, MODIFIABLE, set, IteratorTester.KnownOrder.KNOWN_ORDER) {
      private Multimap&lt;String, Integer&gt; multimap;
<A NAME="9"></A>
      @Override
      protected Iterator&lt;Entry&lt;String, Collection&lt;Integer&gt;&gt;&gt; newTargetIterator() {
        multimap = <FONT color="#83a33a"><A HREF="javascript:ZweiFrames('match49823-1.html#9',3,'match49823-top.html#9',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>LinkedHashMultimap.create();
        multimap.putAll(&quot;foo&quot;, asList(2, 3));
        multimap.putAll(&quot;bar&quot;, asList(4, 5));
        multimap.putAll(&quot;foo&quot;, asList(6));
        multimap.putAll(&quot;baz&quot;, asList(7, 8));
        multimap.putAll(&quot;dog&quot;, asList(9));
        multimap.putAll(&quot;bar&quot;, asList(10, 11));
        multimap.putAll(&quot;cat&quot;, asList</B></FONT>(12, 13, 14));
        return multimap.asMap().entrySet().iterator();
      }

      @Override
      protected void verify(List&lt;Entry&lt;String, Collection&lt;Integer&gt;&gt;&gt; elements) {
        assertEquals(newHashSet(elements), multimap.asMap().entrySet());
      }
    }.test();
  }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>ListsTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2007 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.google.common.collect;

import static com.google.common.base.Preconditions.checkNotNull;
import static com.google.common.collect.testing.IteratorFeature.UNMODIFIABLE;
import static com.google.common.truth.Truth.assertThat;
import static java.util.Arrays.asList;
import static java.util.Collections.singletonList;
<A NAME="1"></A>
import com.google.common.annotations.GwtCompatible;
import com.google.common.annotations.GwtIncompatible;
<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#1',2,'match49823-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>import com.google.common.base.Function;
import com.google.common.base.Functions;
import com.google.common.collect.testing.IteratorTester;
import com.google.common.collect.testing.ListTestSuiteBuilder;
import com.google.common.collect.testing.TestStringListGenerator;
import com.google.common.collect.testing.features.CollectionFeature;
import com.google.common.collect.testing.features.CollectionSize;
import com.google.common.collect.testing.features.ListFeature;
import com.google.common.collect.testing.google.ListGenerators.CharactersOfCharSequenceGenerator;
import com.google.common.collect.testing.google.ListGenerators.CharactersOfStringGenerator;
import com.google.common.testing.NullPointerTester;
import com.google.common.testing.SerializableTester;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;
import java.util.ListIterator;
import java.util.NoSuchElementException;
import java.util.RandomAccess;
import java.util.concurrent.CopyOnWriteArrayList;
import junit.framework.Test;
import junit.framework.TestCase;
import junit.framework.TestSuite;

/**
 * Unit test for {@code Lists}.
 *
 * @author Kevin Bourrillion
 * @author Mike Bostock
 * @author Jared Levy
 */
@GwtCompatible(e</B></FONT>mulated = true)
public class ListsTest extends TestCase {

  private static final Collection&lt;Integer&gt; SOME_COLLECTION = asList(0, 1, 1);

  private static final Iterable&lt;Integer&gt; SOME_ITERABLE = new SomeIterable();

  private static final class RemoveFirstFunction implements Function&lt;String, String&gt;, Serializable {
    @Override
    public String apply(String from) {
      return (from.length() == 0) ? from : from.substring(1);
    }
  }

  private static class SomeIterable implements Iterable&lt;Integer&gt;, Serializable {
    @Override
    public Iterator&lt;Integer&gt; iterator() {
      return SOME_COLLECTION.iterator();
    }

    private static final long serialVersionUID = 0;
  }

  private static final List&lt;Integer&gt; SOME_LIST = Lists.newArrayList(1, 2, 3, 4);

  private static final List&lt;Integer&gt; SOME_SEQUENTIAL_LIST = Lists.newLinkedList(asList(1, 2, 3, 4));

  private static final List&lt;String&gt; SOME_STRING_LIST = asList(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;);

  private static final Function&lt;Number, String&gt; SOME_FUNCTION = new SomeFunction();

  private static class SomeFunction implements Function&lt;Number, String&gt;, Serializable {
    @Override
    public String apply(Number n) {
      return String.valueOf(n);
    }

    private static final long serialVersionUID = 0;
  }

  @GwtIncompatible // suite
  public static Test suite() {
    TestSuite suite = new TestSuite();
    suite.addTestSuite(ListsTest.class);

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    String[] rest = new String[elements.length - 1];
                    System.arraycopy(elements, 1, rest, 0, elements.length - 1);
                    return Lists.asList(elements[0], rest);
                  }
                })
            .named(&quot;Lists.asList, 2 parameter&quot;)
            .withFeatures(
                CollectionSize.SEVERAL,
                CollectionSize.ONE,
                CollectionFeature.SERIALIZABLE,
                CollectionFeature.ALLOWS_NULL_VALUES)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    String[] rest = new String[elements.length - 2];
                    System.arraycopy(elements, 2, rest, 0, elements.length - 2);
                    return Lists.asList(elements[0], elements[1], rest);
                  }
                })
            .named(&quot;Lists.asList, 3 parameter&quot;)
            .withFeatures(
                CollectionSize.SEVERAL,
                CollectionFeature.SERIALIZABLE,
<A NAME="6"></A>                CollectionFeature.ALLOWS_NULL_VALUES)
            .createTestSuite());

    <FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#6',2,'match49823-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>final Function&lt;String, String&gt; removeFirst = new RemoveFirstFunction();

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    List&lt;String&gt; fromList = Lists.newArrayList();
                    for (String element : elements) {
                      fromList.add(&quot;q&quot; + checkNotNull</B></FONT>(element));
                    }
                    return Lists.transform(fromList, removeFirst);
                  }
                })
            .named(&quot;Lists.transform, random access, no nulls&quot;)
            .withFeatures(
                CollectionSize.ANY,
                ListFeature.REMOVE_OPERATIONS,
                CollectionFeature.SERIALIZABLE,
                CollectionFeature.ALLOWS_NULL_QUERIES)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    List&lt;String&gt; fromList = Lists.newLinkedList();
                    for (String element : elements) {
                      fromList.add(&quot;q&quot; + checkNotNull(element));
                    }
                    return Lists.transform(fromList, removeFirst);
                  }
                })
            .named(&quot;Lists.transform, sequential access, no nulls&quot;)
            .withFeatures(
                CollectionSize.ANY,
                ListFeature.REMOVE_OPERATIONS,
                CollectionFeature.SERIALIZABLE,
                CollectionFeature.ALLOWS_NULL_QUERIES)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    List&lt;String&gt; fromList = Lists.newArrayList(elements);
                    return Lists.transform(fromList, Functions.&lt;String&gt;identity());
                  }
                })
            .named(&quot;Lists.transform, random access, nulls&quot;)
            .withFeatures(
                CollectionSize.ANY,
                ListFeature.REMOVE_OPERATIONS,
                CollectionFeature.SERIALIZABLE,
                CollectionFeature.ALLOWS_NULL_VALUES)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    List&lt;String&gt; fromList = Lists.newLinkedList(asList(elements));
                    return Lists.transform(fromList, Functions.&lt;String&gt;identity());
                  }
                })
            .named(&quot;Lists.transform, sequential access, nulls&quot;)
            .withFeatures(
                CollectionSize.ANY,
                ListFeature.REMOVE_OPERATIONS,
                CollectionFeature.SERIALIZABLE,
                CollectionFeature.ALLOWS_NULL_VALUES)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    List&lt;String&gt; list = Lists.newArrayList();
                    for (int i = elements.length - 1; i &gt;= 0; i--) {
                      list.add(elements[i]);
                    }
                    return Lists.reverse(list);
                  }
                })
            .named(&quot;Lists.reverse[ArrayList]&quot;)
            .withFeatures(
                CollectionSize.ANY,
                CollectionFeature.ALLOWS_NULL_VALUES,
                ListFeature.GENERAL_PURPOSE)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    String[] reverseElements = new String[elements.length];
                    for (int i = elements.length - 1, j = 0; i &gt;= 0; i--, j++) {
                      reverseElements[j] = elements[i];
                    }
                    return Lists.reverse(asList(reverseElements));
                  }
                })
            .named(&quot;Lists.reverse[Arrays.asList]&quot;)
            .withFeatures(
                CollectionSize.ANY, CollectionFeature.ALLOWS_NULL_VALUES, ListFeature.SUPPORTS_SET)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    List&lt;String&gt; list = Lists.newLinkedList();
                    for (int i = elements.length - 1; i &gt;= 0; i--) {
                      list.add(elements[i]);
                    }
                    return Lists.reverse(list);
                  }
                })
            .named(&quot;Lists.reverse[LinkedList]&quot;)
            .withFeatures(
                CollectionSize.ANY,
                CollectionFeature.ALLOWS_NULL_VALUES,
                ListFeature.GENERAL_PURPOSE)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(
                new TestStringListGenerator() {
                  @Override
                  protected List&lt;String&gt; create(String[] elements) {
                    ImmutableList.Builder&lt;String&gt; builder = ImmutableList.builder();
                    for (int i = elements.length - 1; i &gt;= 0; i--) {
                      builder.add(elements[i]);
                    }
                    return Lists.reverse(builder.build());
                  }
                })
            .named(&quot;Lists.reverse[ImmutableList]&quot;)
            .withFeatures(CollectionSize.ANY, CollectionFeature.ALLOWS_NULL_QUERIES)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(new CharactersOfStringGenerator())
            .named(&quot;Lists.charactersOf[String]&quot;)
            .withFeatures(
                CollectionSize.ANY,
                CollectionFeature.SERIALIZABLE,
                CollectionFeature.ALLOWS_NULL_QUERIES)
            .createTestSuite());

    suite.addTest(
        ListTestSuiteBuilder.using(new CharactersOfCharSequenceGenerator())
            .named(&quot;Lists.charactersOf[CharSequence]&quot;)
            .withFeatures(CollectionSize.ANY, CollectionFeature.ALLOWS_NULL_QUERIES)
            .createTestSuite());

    return suite;
  }

  public void testCharactersOfIsView() {
<A NAME="13"></A>    StringBuilder builder = new StringBuilder(&quot;abc&quot;);
    List&lt;Character&gt; chars = Lists.charactersOf(builder);
    assertEquals(asList('a', 'b', 'c'), chars);
    <FONT color="#3b9c9c"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#13',2,'match49823-top.html#13',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>builder.append(&quot;def&quot;);
    assertEquals(asList('a', 'b', 'c', 'd', 'e', 'f'), chars);
    builder.deleteCharAt(5);
    assertEquals(asList('a', 'b', 'c', 'd', 'e'), chars);
  }

  public void testNewArrayListEmpty() {
    ArrayList&lt;Integer&gt; list = Lists.newArrayList();
    assertEquals(Collections.emptyList</B></FONT>(), list);
  }

  public void testNewArrayListWithCapacity() {
    ArrayList&lt;Integer&gt; list = Lists.newArrayListWithCapacity(0);
    assertEquals(Collections.emptyList(), list);

    ArrayList&lt;Integer&gt; bigger = Lists.newArrayListWithCapacity(256);
    assertEquals(Collections.emptyList(), bigger);
  }

  public void testNewArrayListWithCapacity_negative() {
    try {
      Lists.newArrayListWithCapacity(-1);
      fail();
    } catch (IllegalArgumentException expected) {
    }
  }

  public void testNewArrayListWithExpectedSize() {
    ArrayList&lt;Integer&gt; list = Lists.newArrayListWithExpectedSize(0);
    assertEquals(Collections.emptyList(), list);

    ArrayList&lt;Integer&gt; bigger = Lists.newArrayListWithExpectedSize(256);
    assertEquals(Collections.emptyList(), bigger);
  }

  public void testNewArrayListWithExpectedSize_negative() {
    try {
      Lists.newArrayListWithExpectedSize(-1);
      fail();
    } catch (IllegalArgumentException expected) {
    }
  }

  public void testNewArrayListVarArgs() {
    ArrayList&lt;Integer&gt; list = Lists.newArrayList(0, 1, 1);
    assertEquals(SOME_COLLECTION, list);
  }
<A NAME="15"></A>
  public void testComputeArrayListCapacity() {
    assertEquals(5, Lists.computeArrayListCapacity(0));
    assertEquals(13, <FONT color="#f52887"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#15',2,'match49823-top.html#15',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Lists.computeArrayListCapacity(8));
    assertEquals(89, Lists.computeArrayListCapacity(77));
    assertEquals(22000005, Lists.computeArrayListCapacity(20000000));
    assertEquals(Integer.MAX_VALUE, Lists.computeArrayListCapacity(Integer.MAX_VALUE - 1000));
<A NAME="2"></A>  }

  public void testNewArrayListFromCollection() {</B></FONT>
    ArrayList&lt;Integer&gt; list = <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#2',2,'match49823-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Lists.newArrayList(SOME_COLLECTION);
    assertEquals(SOME_COLLECTION, list);
  }

  public void testNewArrayListFromIterable() {
    ArrayList&lt;Integer&gt; list = Lists.newArrayList(SOME_ITERABLE);
    assertEquals(SOME_COLLECTION, list);
  }

  public void testNewArrayListFromIterator() {
    ArrayList&lt;Integer&gt; list = Lists.newArrayList(SOME_COLLECTION.iterator());
    assertEquals(SOME_COLLECTION, list);
  }

  public void testNewLinkedListEmpty() {
    LinkedList&lt;Integer&gt; list = Lists.newLinkedList();
    assertEquals(Collections.emptyList(), list);
  }

  public void testNewLinkedListFr</B></FONT>omCollection() {
    LinkedList&lt;Integer&gt; list = Lists.newLinkedList(SOME_COLLECTION);
    assertEquals(SOME_COLLECTION, list);
<A NAME="14"></A>  }

  public void testNewLinkedListFromIterable() {
    <FONT color="#842dce"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#14',2,'match49823-top.html#14',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>LinkedList&lt;Integer&gt; list = Lists.newLinkedList(SOME_ITERABLE);
    assertEquals(SOME_COLLECTION, list);
  }

  @GwtIncompatible // CopyOnWriteArrayList
  public void testNewCOWALEmpty() {
    CopyOnWriteArrayList&lt;Integer&gt; list = Lists.newCopyOnWriteArrayList();
    assertEquals(Collections.emptyList</B></FONT>(), list);
  }

  @GwtIncompatible // CopyOnWriteArrayList
  public void testNewCOWALFromIterable() {
    CopyOnWriteArrayList&lt;Integer&gt; list = Lists.newCopyOnWriteArrayList(SOME_ITERABLE);
    assertEquals(SOME_COLLECTION, list);
  }

  @GwtIncompatible // NullPointerTester
  public void testNullPointerExceptions() {
    NullPointerTester tester = new NullPointerTester();
    tester.testAllPublicStaticMethods(Lists.class);
  }

  /**
   * This is just here to illustrate how {@code Arrays#asList} differs from {@code
   * Lists#newArrayList}.
   */
  public void testArraysAsList() {
    List&lt;String&gt; ourWay = Lists.newArrayList(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;);
    List&lt;String&gt; otherWay = asList(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;);

    // They're logically equal
    assertEquals(ourWay, otherWay);

    // The result of Arrays.asList() is mutable
    otherWay.set(0, &quot;FOO&quot;);
<A NAME="3"></A>    assertEquals(&quot;FOO&quot;, otherWay.get(0));

    // But it can't grow
    <FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#3',2,'match49823-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>try {
      otherWay.add(&quot;nope&quot;);
      fail(&quot;no exception thrown&quot;);
    } catch (UnsupportedOperationException expected) {
    }

    // And it can't shrink
    try {
      otherWay.remove(2);
      fail(&quot;no exception thrown&quot;);
    } catch (UnsupportedOperationException expected) {
    }
  }

  @GwtIncompatible // SerializableTester
  public void testAsList1() {</B></FONT>
    List&lt;String&gt; list = Lists.asList(&quot;foo&quot;, new String[] {&quot;bar&quot;, &quot;baz&quot;});
    checkFooBarBazList(list);
    SerializableTester.reserializeAndAssert(list);
    assertTrue(list instanceof RandomAccess);

    new IteratorTester&lt;String&gt;(
        5, UNMODIFIABLE, asList(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;), IteratorTester.KnownOrder.KNOWN_ORDER) {
      @Override
      protected Iterator&lt;String&gt; newTargetIterator() {
        return Lists.asList(&quot;foo&quot;, new String[] {&quot;bar&quot;, &quot;baz&quot;}).iterator();
      }
    }.test();
<A NAME="11"></A>  }

  private void checkFooBarBazList(List&lt;String&gt; list) {
    <FONT color="#b041ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#11',2,'match49823-top.html#11',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertThat(list).containsExactly(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;).inOrder();
    assertEquals(3, list.size());
    assertIndexIsOutOfBounds(list, -1);
    assertEquals(&quot;foo&quot;, list.get(0));
    assertEquals(&quot;bar&quot;, list.get(1));
    assertEquals(&quot;baz&quot;, list.get(2));
    assertIndexIsOutOfBounds(list, 3);
  }

<A NAME="17"></A>  public void test</B></FONT>AsList1Small() {
    List&lt;String&gt; list = Lists.asList(&quot;foo&quot;, new String[0]);
    assertThat(list).contains(&quot;foo&quot;);
    <FONT color="#3090c7"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#17',2,'match49823-top.html#17',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertEquals(1, list.size());
    assertIndexIsOutOfBounds(list, -1);
    assertEquals(&quot;foo&quot;, list.get(0));
    assertIndexIsOutOfBounds(list, 1);
    assertTrue(list instanceof RandomAccess);

    new</B></FONT> IteratorTester&lt;String&gt;(
        3, UNMODIFIABLE, singletonList(&quot;foo&quot;), IteratorTester.KnownOrder.KNOWN_ORDER) {
      @Override
      protected Iterator&lt;String&gt; newTargetIterator() {
        return Lists.asList(&quot;foo&quot;, new String[0]).iterator();
      }
    }.test();
  }

  public void testAsList2() {
    List&lt;String&gt; list = Lists.asList(&quot;foo&quot;, &quot;bar&quot;, new String[] {&quot;baz&quot;});
    checkFooBarBazList(list);
    assertTrue(list instanceof RandomAccess);

    new IteratorTester&lt;String&gt;(
        5, UNMODIFIABLE, asList(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;), IteratorTester.KnownOrder.KNOWN_ORDER) {
<A NAME="18"></A>      @Override
      protected Iterator&lt;String&gt; newTargetIterator() {
        return Lists.asList(&quot;foo&quot;, &quot;bar&quot;, new String[] {&quot;baz&quot;}).iterator();
      <FONT color="#800517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#18',2,'match49823-top.html#18',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}
    }.test();
  }

<A NAME="12"></A>  @GwtIncompatible // SerializableTester
  public void testAsList2Small() {
    List&lt;String&gt; list = Lists.asList(&quot;foo&quot;, &quot;bar&quot;, new String[0])</B></FONT>;
    <FONT color="#571b7e"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#12',2,'match49823-top.html#12',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertThat(list).containsExactly(&quot;foo&quot;, &quot;bar&quot;).inOrder();
    assertEquals(2, list.size());
    assertIndexIsOutOfBounds(list, -1);
    assertEquals(&quot;foo&quot;, list.get(0));
    assertEquals(&quot;bar&quot;, list.get(1));
    assertIndexIsOutOfBounds(list, 2);
    SerializableTester.reserializeAndAssert(list);
    assertTrue(list instanceof RandomAccess);

    new</B></FONT> IteratorTester&lt;String&gt;(
        5, UNMODIFIABLE, asList(&quot;foo&quot;, &quot;bar&quot;), IteratorTester.KnownOrder.KNOWN_ORDER) {
      @Override
      protected Iterator&lt;String&gt; newTargetIterator() {
        return Lists.asList(&quot;foo&quot;, &quot;bar&quot;, new String[0]).iterator();
      }
    }.test();
  }

  private static void assertIndexIsOutOfBounds(List&lt;String&gt; list, int index) {
    try {
      list.get(index);
      fail();
    } catch (IndexOutOfBoundsException expected) {
    }
  }

  public void testReverseViewRandomAccess() {
    List&lt;Integer&gt; fromList = Lists.newArrayList(SOME_LIST);
    List&lt;Integer&gt; toList = Lists.reverse(fromList);
    assertReverseView(fromList, toList);
  }

  public void testReverseViewSequential() {
    List&lt;Integer&gt; fromList = Lists.newLinkedList(SOME_SEQUENTIAL_LIST);
    List&lt;Integer&gt; toList = Lists.reverse(fromList);
<A NAME="5"></A>    assertReverseView(fromList, toList);
  }

  private static void assertReverseView(List&lt;Integer&gt; fromList, <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#5',2,'match49823-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>List&lt;Integer&gt; toList) {
    /* fromList modifications reflected in toList */
    fromList.set(0, 5);
    assertEquals(asList(4, 3, 2, 5), toList);
    fromList.add(6);
    assertEquals(asList(6, 4, 3, 2, 5), toList);
    fromList.add(2, 9);
    assertEquals(asList(6, 4, 3, 9, 2, 5), toList);
    fromList.remove(Integer.valueOf(2));
    assertEquals(asList(6, 4, 3, 9, 5), toList);
    fromList.remove(3);
    assertEquals(asList(6, 3, 9, 5), toList);

<A NAME="10"></A>    /* toList modifications reflected in fromList */
    toList.remove(0);
    assertEquals(asList</B></FONT>(5, 9, 3), fromList);
    <FONT color="#ad5910"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#10',2,'match49823-top.html#10',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>toList.add(7);
    assertEquals(asList(7, 5, 9, 3), fromList);
    toList.add(5);
    assertEquals(asList(5, 7, 5, 9, 3), fromList);
    toList.remove(Integer.valueOf(5));
    assertEquals(asList(5, 7, 9, 3), fromList);
    toList.set(1, 8);
    assertEquals(asList(5, 7, 8, 3), fromList);
    toList.clear();
    assertEquals</B></FONT>(Collections.emptyList(), fromList);
  }

  @SafeVarargs
  private static &lt;E&gt; List&lt;E&gt; list(E... elements) {
    return ImmutableList.copyOf(elements);
  }

  @SuppressWarnings(&quot;unchecked&quot;) // varargs!
  public void testCartesianProduct_binary1x1() {
    assertThat(Lists.cartesianProduct(list(1), list(2))).contains(list(1, 2));
  }

  @SuppressWarnings(&quot;unchecked&quot;) // varargs!
  public void testCartesianProduct_binary1x2() {
    assertThat(Lists.cartesianProduct(list(1), list(2, 3)))
        .containsExactly(list(1, 2), list(1, 3))
        .inOrder();
  }

  @SuppressWarnings(&quot;unchecked&quot;) // varargs!
  public void testCartesianProduct_binary2x2() {
    assertThat(Lists.cartesianProduct(list(1, 2), list(3, 4)))
        .containsExactly(list(1, 3), list(1, 4), list(2, 3), list(2, 4))
        .inOrder();
  }
<A NAME="9"></A>
  @SuppressWarnings(&quot;unchecked&quot;) // varargs!
  public void testCartesianProduct_2x2x2() {
    <FONT color="#83a33a"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#9',2,'match49823-top.html#9',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertThat(Lists.cartesianProduct(list(0, 1), list(0, 1), list(0, 1)))
        .containsExactly(
            list(0, 0, 0),
            list(0, 0, 1),
            list(0, 1, 0),
            list(0, 1, 1),
            list(1, 0, 0),
            list(1, 0, 1),
            list(1, 1, 0),
            list</B></FONT>(1, 1, 1))
        .inOrder();
  }
<A NAME="8"></A>
  @SuppressWarnings(&quot;unchecked&quot;) // varargs!
  public void testCartesianProduct_contains() {
    <FONT color="#c58917"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#8',2,'match49823-top.html#8',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>List&lt;List&lt;Integer&gt;&gt; actual = Lists.cartesianProduct(list(1, 2), list(3, 4));
    assertTrue(actual.contains(list(1, 3)));
    assertTrue(actual.contains(list(1, 4)));
    assertTrue(actual.contains(list(2, 3)));
    assertTrue(actual.contains(list(2, 4)));
    assertFalse(actual.contains</B></FONT>(list(3, 1)));
<A NAME="0"></A>  }

  public void testCartesianProduct_indexOf() {
    List&lt;List&lt;Integer&gt;&gt; actual = <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#0',2,'match49823-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Lists.cartesianProduct(list(1, 2), list(3, 4));
    assertEquals(0, actual.indexOf(list(1, 3)));
    assertEquals(1, actual.indexOf(list(1, 4)));
    assertEquals(2, actual.indexOf(list(2, 3)));
    assertEquals(3, actual.indexOf(list(2, 4)));
    assertEquals(-1, actual.indexOf(list(3, 1)));

    assertEquals(-1, actual.indexOf(list(1)));
    assertEquals(-1, actual.indexOf(list(1, 1, 1)));
  }

  public void testCartesianProduct_lastIndexOf() {
    List&lt;List&lt;Integer&gt;&gt; actual = Lists.cartesianProduct(list(1, 1), list(2, 3));
    assertThat(actual.lastIndexOf(list(1, 2))).isEqualTo(2);
    assertThat(actual.lastIndexOf(list(1, 3))).isEqualTo(3);
    assertThat(actual.lastIndexOf(list(1, 1))).isEqualTo(-1);

    assertThat</B></FONT>(actual.lastIndexOf(list(1))).isEqualTo(-1);
    assertThat(actual.lastIndexOf(list(1, 1, 1))).isEqualTo(-1);
  }

  @SuppressWarnings(&quot;unchecked&quot;) // varargs!
  public void testCartesianProduct_unrelatedTypes() {
    List&lt;Integer&gt; x = list(1, 2);
    List&lt;String&gt; y = list(&quot;3&quot;, &quot;4&quot;);

    List&lt;Object&gt; exp1 = list((Object) 1, &quot;3&quot;);
    List&lt;Object&gt; exp2 = list((Object) 1, &quot;4&quot;);
    List&lt;Object&gt; exp3 = list((Object) 2, &quot;3&quot;);
    List&lt;Object&gt; exp4 = list((Object) 2, &quot;4&quot;);

    assertThat(Lists.&lt;Object&gt;cartesianProduct(x, y))
        .containsExactly(exp1, exp2, exp3, exp4)
        .inOrder();
  }

  @SuppressWarnings(&quot;unchecked&quot;) // varargs!
  public void testCartesianProductTooBig() {
    List&lt;String&gt; list = Collections.nCopies(10000, &quot;foo&quot;);
    try {
      Lists.cartesianProduct(list, list, list, list, list);
<A NAME="4"></A>      fail(&quot;Expected IAE&quot;);
    } catch (IllegalArgumentException expected) {
    }
  <FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#4',2,'match49823-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}

  public void testTransformHashCodeRandomAccess() {
    List&lt;String&gt; list = Lists.transform(SOME_LIST, SOME_FUNCTION);
    assertEquals(SOME_STRING_LIST.hashCode(), list.hashCode());
  }

  public void testTransformHashCodeSequential() {
    List&lt;String&gt; list = Lists.transform(SOME_SEQUENTIAL_LIST, SOME_FUNCTION);
    assertEquals(SOME_STRING_LIST.hashCode(), list.hashCode());
  }

  public void testTransformModifiableRandomAccess() {
    List&lt;Integer&gt; fromList = Lists.newArrayList</B></FONT>(SOME_LIST);
    List&lt;String&gt; list = Lists.transform(fromList, SOME_FUNCTION);
    assertTransformModifiable(list);
  }

  public void testTransformModifiableSequential() {
    List&lt;Integer&gt; fromList = Lists.newLinkedList(SOME_SEQUENTIAL_LIST);
    List&lt;String&gt; list = Lists.transform(fromList, SOME_FUNCTION);
    assertTransformModifiable(list);
  }

  private static void assertTransformModifiable(List&lt;String&gt; list) {
    try {
      list.add(&quot;5&quot;);
      fail(&quot;transformed list is addable&quot;);
    } catch (UnsupportedOperationException expected) {
    }
    list.remove(0);
    assertEquals(asList(&quot;2&quot;, &quot;3&quot;, &quot;4&quot;), list);
    list.remove(&quot;3&quot;);
    assertEquals(asList(&quot;2&quot;, &quot;4&quot;), list);
    try {
      list.set(0, &quot;5&quot;);
      fail(&quot;transformed list is setable&quot;);
    } catch (UnsupportedOperationException expected) {
    }
    list.clear();
    assertEquals(Collections.emptyList(), list);
  }

  public void testTransformViewRandomAccess() {
    List&lt;Integer&gt; fromList = Lists.newArrayList(SOME_LIST);
    List&lt;String&gt; toList = Lists.transform(fromList, SOME_FUNCTION);
    assertTransformView(fromList, toList);
  }

  public void testTransformViewSequential() {
    List&lt;Integer&gt; fromList = Lists.newLinkedList(SOME_SEQUENTIAL_LIST);
    List&lt;String&gt; toList = Lists.transform(fromList, SOME_FUNCTION);
    assertTransformView(fromList, toList);
  }

  private static void assertTransformView(List&lt;Integer&gt; fromList, List&lt;String&gt; toList) {
    /* fromList modifications reflected in toList */
    fromList.set(0, 5);
    assertEquals(asList(&quot;5&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;), toList);
    fromList.add(6);
    assertEquals(asList(&quot;5&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;6&quot;), toList);
    fromList.remove(Integer.valueOf(2));
    assertEquals(asList(&quot;5&quot;, &quot;3&quot;, &quot;4&quot;, &quot;6&quot;), toList);
    fromList.remove(2);
    assertEquals(asList(&quot;5&quot;, &quot;3&quot;, &quot;6&quot;), toList);

    /* toList modifications reflected in fromList */
    toList.remove(2);
    assertEquals(asList(5, 3), fromList);
    toList.remove(&quot;5&quot;);
    assertEquals(asList(3), fromList);
    toList.clear();
    assertEquals(Collections.emptyList(), fromList);
  }

  public void testTransformRandomAccess() {
    List&lt;String&gt; list = Lists.transform(SOME_LIST, SOME_FUNCTION);
    assertTrue(list instanceof RandomAccess);
  }

  public void testTransformSequential() {
    List&lt;String&gt; list = Lists.transform(SOME_SEQUENTIAL_LIST, SOME_FUNCTION);
    assertFalse(list instanceof RandomAccess);
  }

  public void testTransformListIteratorRandomAccess() {
    List&lt;Integer&gt; fromList = Lists.newArrayList(SOME_LIST);
    List&lt;String&gt; list = Lists.transform(fromList, SOME_FUNCTION);
    assertTransformListIterator(list);
  }

  public void testTransformListIteratorSequential() {
    List&lt;Integer&gt; fromList = Lists.newLinkedList(SOME_SEQUENTIAL_LIST);
    List&lt;String&gt; list = Lists.transform(fromList, SOME_FUNCTION);
    assertTransformListIterator(list);
  }

  public void testTransformPreservesIOOBEsThrownByFunction() {
    try {
      Lists.transform(
              ImmutableList.of(&quot;foo&quot;, &quot;bar&quot;),
              new Function&lt;String, String&gt;() {
                @Override
                public String apply(String input) {
                  throw new IndexOutOfBoundsException();
                }
              })
          .toArray();
      fail();
    } catch (IndexOutOfBoundsException expected) {
      // success
<A NAME="16"></A>    }
  }

  private static void assertTransformListIterator(List&lt;String&gt; list) <FONT color="#2981b2"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#16',2,'match49823-top.html#16',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{
    ListIterator&lt;String&gt; iterator = list.listIterator(1);
    assertEquals(1, iterator.nextIndex());
    assertEquals(&quot;2&quot;, iterator.next());
    assertEquals(&quot;3&quot;, iterator.next());
    assertEquals</B></FONT>(&quot;4&quot;, iterator.next());
    assertEquals(4, iterator.nextIndex());
    try {
      iterator.next();
      fail(&quot;did not detect end of list&quot;);
    } catch (NoSuchElementException expected) {
    }
    assertEquals(3, iterator.previousIndex());
    assertEquals(&quot;4&quot;, iterator.previous());
    assertEquals(&quot;3&quot;, iterator.previous());
    assertEquals(&quot;2&quot;, iterator.previous());
    assertTrue(iterator.hasPrevious());
    assertEquals(&quot;1&quot;, iterator.previous());
    assertFalse(iterator.hasPrevious());
    assertEquals(-1, iterator.previousIndex());
    try {
      iterator.previous();
      fail(&quot;did not detect beginning of list&quot;);
    } catch (NoSuchElementException expected) {
    }
    iterator.remove();
    assertEquals(asList(&quot;2&quot;, &quot;3&quot;, &quot;4&quot;), list);
    assertFalse(list.isEmpty());

    // An UnsupportedOperationException or IllegalStateException may occur.
    try {
      iterator.add(&quot;1&quot;);
      fail(&quot;transformed list iterator is addable&quot;);
    } catch (UnsupportedOperationException expected) {
    } catch (IllegalStateException expected) {
    }
    try {
      iterator.set(&quot;1&quot;);
      fail(&quot;transformed list iterator is settable&quot;);
    } catch (UnsupportedOperationException expected) {
    } catch (IllegalStateException expected) {
    }
  }

  public void testTransformIteratorRandomAccess() {
    List&lt;Integer&gt; fromList = Lists.newArrayList(SOME_LIST);
    List&lt;String&gt; list = Lists.transform(fromList, SOME_FUNCTION);
    assertTransformIterator(list);
  }

  public void testTransformIteratorSequential() {
    List&lt;Integer&gt; fromList = Lists.newLinkedList(SOME_SEQUENTIAL_LIST);
    List&lt;String&gt; list = Lists.transform(fromList, SOME_FUNCTION);
    assertTransformIterator(list);
  }

  /**
   * This test depends on the fact that {@code AbstractSequentialList.iterator} transforms the
   * {@code iterator()} call into a call on {@code listIterator(int)}. This is fine because the
   * behavior is clearly documented so it's not expected to change.
   */
  public void testTransformedSequentialIterationUsesBackingListIterationOnly() {
    List&lt;Integer&gt; randomAccessList = Lists.newArrayList(SOME_SEQUENTIAL_LIST);
    List&lt;Integer&gt; listIteratorOnlyList = new ListIterationOnlyList&lt;&gt;(randomAccessList);
    List&lt;String&gt; transform = Lists.transform(listIteratorOnlyList, SOME_FUNCTION);
    assertTrue(
        Iterables.elementsEqual(transform, Lists.transform(randomAccessList, SOME_FUNCTION)));
  }

  private static class ListIterationOnlyList&lt;E&gt; extends ForwardingList&lt;E&gt; {
    private final List&lt;E&gt; realDelegate;

    private ListIterationOnlyList(List&lt;E&gt; realDelegate) {
      this.realDelegate = realDelegate;
    }

    @Override
    public int size() {
      return realDelegate.size();
    }

    @Override
    public ListIterator&lt;E&gt; listIterator(int index) {
      return realDelegate.listIterator(index);
    }

    @Override
    protected List&lt;E&gt; delegate() {
      throw new UnsupportedOperationException(&quot;This list only supports ListIterator&quot;);
    }
  }

  private static void assertTransformIterator(List&lt;String&gt; list) {
    Iterator&lt;String&gt; iterator = list.iterator();
    assertTrue(iterator.hasNext());
    assertEquals(&quot;1&quot;, iterator.next());
    assertTrue(iterator.hasNext());
    assertEquals(&quot;2&quot;, iterator.next());
    assertTrue(iterator.hasNext());
    assertEquals(&quot;3&quot;, iterator.next());
    assertTrue(iterator.hasNext());
    assertEquals(&quot;4&quot;, iterator.next());
    assertFalse(iterator.hasNext());
    try {
      iterator.next();
      fail(&quot;did not detect end of list&quot;);
    } catch (NoSuchElementException expected) {
    }
    iterator.remove();
    assertEquals(asList(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;), list);
    assertFalse(iterator.hasNext());
  }

  public void testPartition_badSize() {
    List&lt;Integer&gt; source = Collections.singletonList(1);
    try {
      Lists.partition(source, 0);
      fail();
    } catch (IllegalArgumentException expected) {
    }
  }

  public void testPartition_empty() {
    List&lt;Integer&gt; source = Collections.emptyList();
    List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(source, 1);
    assertTrue(partitions.isEmpty());
    assertEquals(0, partitions.size());
  }

  public void testPartition_1_1() {
    List&lt;Integer&gt; source = Collections.singletonList(1);
    List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(source, 1);
    assertEquals(1, partitions.size());
    assertEquals(Collections.singletonList(1), partitions.get(0));
  }

  public void testPartition_1_2() {
    List&lt;Integer&gt; source = Collections.singletonList(1);
    List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(source, 2);
    assertEquals(1, partitions.size());
    assertEquals(Collections.singletonList(1), partitions.get(0));
  }

  public void testPartition_2_1() {
    List&lt;Integer&gt; source = asList(1, 2);
    List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(source, 1);
    assertEquals(2, partitions.size());
    assertEquals(Collections.singletonList(1), partitions.get(0));
    assertEquals(Collections.singletonList(2), partitions.get(1));
  }

  public void testPartition_3_2() {
    List&lt;Integer&gt; source = asList(1, 2, 3);
    List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(source, 2);
    assertEquals(2, partitions.size());
    assertEquals(asList(1, 2), partitions.get(0));
    assertEquals(asList(3), partitions.get(1));
  }

  @GwtIncompatible // ArrayList.subList doesn't implement RandomAccess in GWT.
  public void testPartitionRandomAccessTrue() {
    List&lt;Integer&gt; source = asList(1, 2, 3);
    List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(source, 2);

    assertTrue(
        &quot;partition should be RandomAccess, but not: &quot; + partitions.getClass(),
        partitions instanceof RandomAccess);

    assertTrue(
        &quot;partition[0] should be RandomAccess, but not: &quot; + partitions.get(0).getClass(),
        partitions.get(0) instanceof RandomAccess);

    assertTrue(
        &quot;partition[1] should be RandomAccess, but not: &quot; + partitions.get(1).getClass(),
        partitions.get(1) instanceof RandomAccess);
<A NAME="19"></A>  }

  public void testPartitionRandomAccessFalse() {
    List&lt;Integer&gt; source = <FONT color="#f62817"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#19',2,'match49823-top.html#19',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Lists.newLinkedList(asList(1, 2, 3));
    List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(source, 2);
    assertFalse(partitions instanceof RandomAccess);
    assertFalse(partitions.get(0) instanceof RandomAccess);
    assertFalse(partitions.get</B></FONT>(1) instanceof RandomAccess);
  }

  // TODO: use the ListTestSuiteBuilder

  public void testPartition_view() {
    List&lt;Integer&gt; list = asList(1, 2, 3);
    List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(list, 3);

    // Changes before the partition is retrieved are reflected
    list.set(0, 3);

    Iterator&lt;List&lt;Integer&gt;&gt; iterator = partitions.iterator();

    // Changes before the partition is retrieved are reflected
    list.set(1, 4);

<A NAME="7"></A>    List&lt;Integer&gt; first = iterator.next();

    // Changes after are too (unlike Iterables.partition)
    <FONT color="#38a4a5"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49823-0.html#7',2,'match49823-top.html#7',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>list.set(2, 5);

    assertEquals(asList(3, 4, 5), first);

    // Changes to a sublist also write through to the original list
    first.set(1, 6);
    assertEquals(asList(3, 6, 5), list);
  }

  public void testPartitionSize_1() {
    List&lt;Integer&gt; list = asList(1, 2, 3);
    assertEquals(1, Lists.partition(list, Integer.MAX_VALUE).size());
    assertEquals(1, Lists.partition</B></FONT>(list, Integer.MAX_VALUE - 1).size());
  }

  @GwtIncompatible // cannot do such a big explicit copy
  public void testPartitionSize_2() {
    assertEquals(2, Lists.partition(Collections.nCopies(0x40000001, 1), 0x40000000).size());
  }
}
</PRE>
</div>
  </div>
</body>
</html>
