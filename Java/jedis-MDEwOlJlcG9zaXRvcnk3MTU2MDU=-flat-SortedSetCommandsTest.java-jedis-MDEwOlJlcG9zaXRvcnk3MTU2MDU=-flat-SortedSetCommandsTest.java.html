
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 16, <button onclick='openModal()' class='match'></button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SortedSetCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static java.util.Collections.singletonList;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
5  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
6  import static redis.clients.jedis.util.AssertUtil.assertByteArrayListEquals;
7  import java.util.*;
8  import org.junit.Test;
9  import redis.clients.jedis.args.SortedSetOption;
10  import redis.clients.jedis.params.*;
11  import redis.clients.jedis.resps.ScanResult;
12  import redis.clients.jedis.resps.Tuple;
13  import redis.clients.jedis.util.AssertUtil;
14  import redis.clients.jedis.util.KeyValue;
15  import redis.clients.jedis.util.SafeEncoder;
16  public class SortedSetCommandsTest extends JedisCommandsTestBase {
17    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
18    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
19    final byte[] bcar = { 0x09, 0x0A, 0x0B, 0x0C };
20    final byte[] ba = { 0x0A };
21    final byte[] bb = { 0x0B };
22    final byte[] bc = { 0x0C };
23    final byte[] bInclusiveB = { 0x5B, 0x0B };
24    final byte[] bExclusiveC = { 0x28, 0x0C };
25    final byte[] bLexMinusInf = { 0x2D };
26    final byte[] bLexPlusInf = { 0x2B };
27    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
28    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
29    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
30    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
31    @Test
32    public void zadd() {
33      assertEquals(1, jedis.zadd("foo", 1d, "a"));
34      assertEquals(1, jedis.zadd("foo", 10d, "b"));
35      assertEquals(1, jedis.zadd("foo", 0.1d, "c"));
36      assertEquals(0, jedis.zadd("foo", 2d, "a"));
37      assertEquals(1, jedis.zadd(bfoo, 1d, ba));
38      assertEquals(1, jedis.zadd(bfoo, 10d, bb));
39      assertEquals(1, jedis.zadd(bfoo, 0.1d, bc));
40      assertEquals(0, jedis.zadd(bfoo, 2d, ba));
41    }
42    @Test
43    public void zaddWithParams() {
44      jedis.del("foo");
45      assertEquals(0L, jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().xx()));
46      jedis.zadd("foo", 1d, "a");
47      assertEquals(0L, jedis.zadd("foo", 2d, "a", ZAddParams.zAddParams().nx()));
48      assertEquals(Double.valueOf(1d), jedis.zscore("foo", "a"));
49      Map<String, Double> scoreMembers = new HashMap<String, Double>();
50      scoreMembers.put("a", 2d);
51      scoreMembers.put("b", 1d);
52      assertEquals(2L, jedis.zadd("foo", scoreMembers, ZAddParams.zAddParams().ch()));
53      jedis.zadd("foo", 3d, "a", ZAddParams.zAddParams().lt());
54      assertEquals(Double.valueOf(2d), jedis.zscore("foo", "a"));
55      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().lt());
56      assertEquals(Double.valueOf(1d), jedis.zscore("foo", "a"));
57      jedis.zadd("foo", 0d, "b", ZAddParams.zAddParams().gt());
58      assertEquals(Double.valueOf(1d), jedis.zscore("foo", "b"));
59      jedis.zadd("foo", 2d, "b", ZAddParams.zAddParams().gt());
60      assertEquals(Double.valueOf(2d), jedis.zscore("foo", "b"));
61      assertNull(jedis.zaddIncr("foo", 1d, "b", ZAddParams.zAddParams().nx()));
62      assertEquals(Double.valueOf(2d), jedis.zscore("foo", "b"));
63      assertEquals(Double.valueOf(3d), jedis.zaddIncr("foo", 1d,"b", ZAddParams.zAddParams().xx()));
64      assertEquals(Double.valueOf(3d), jedis.zscore("foo", "b"));
65      jedis.del(bfoo);
66      assertEquals(0L, jedis.zadd(bfoo, 1d, ba, ZAddParams.zAddParams().xx()));
67      jedis.zadd(bfoo, 1d, ba);
68      assertEquals(0L, jedis.zadd(bfoo, 2d, ba, ZAddParams.zAddParams().nx()));
69      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, ba));
70      Map<byte[], Double> binaryScoreMembers = new HashMap<byte[], Double>();
71      binaryScoreMembers.put(ba, 2d);
72      binaryScoreMembers.put(bb, 1d);
73      assertEquals(2L, jedis.zadd(bfoo, binaryScoreMembers, ZAddParams.zAddParams().ch()));
74      jedis.zadd(bfoo, 3d, ba, ZAddParams.zAddParams().lt());
75      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, ba));
76      jedis.zadd(bfoo, 1d, ba, ZAddParams.zAddParams().lt());
77      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, ba));
78      jedis.zadd(bfoo, 0d, bb, ZAddParams.zAddParams().gt());
79      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, bb));
80      jedis.zadd(bfoo, 2d, bb, ZAddParams.zAddParams().gt());
81      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, bb));
82      assertNull(jedis.zaddIncr(bfoo, 1d, bb, ZAddParams.zAddParams().nx()));
83      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, bb));
84      assertEquals(Double.valueOf(3d), jedis.zaddIncr(bfoo, 1d, bb, ZAddParams.zAddParams().xx()));
85      assertEquals(Double.valueOf(3d), jedis.zscore(bfoo, bb));
86    }
87    @Test
88    public void zrange() {
89      jedis.zadd("foo", 1d, "a");
90      jedis.zadd("foo", 10d, "b");
91      jedis.zadd("foo", 0.1d, "c");
92      jedis.zadd("foo", 2d, "a");
93      List<String> expected = new ArrayList<String>();
94      expected.add("c");
95      expected.add("a");
96      List<String> range = jedis.zrange("foo", 0, 1);
97      assertEquals(expected, range);
98      expected.add("b");
99      range = jedis.zrange("foo", 0, 100);
100      assertEquals(expected, range);
101      jedis.zadd(bfoo, 1d, ba);
102      jedis.zadd(bfoo, 10d, bb);
103      jedis.zadd(bfoo, 0.1d, bc);
104      jedis.zadd(bfoo, 2d, ba);
105      List<byte[]> bexpected = new ArrayList<byte[]>();
106      bexpected.add(bc);
107      bexpected.add(ba);
108      List<byte[]> brange = jedis.zrange(bfoo, 0, 1);
109      assertByteArrayListEquals(bexpected, brange);
110      bexpected.add(bb);
111      brange = jedis.zrange(bfoo, 0, 100);
112      assertByteArrayListEquals(bexpected, brange);
113    }
114    @Test
115    public void zrangeByLex() {
116      jedis.zadd("foo", 1, "aa");
117      jedis.zadd("foo", 1, "c");
118      jedis.zadd("foo", 1, "bb");
119      jedis.zadd("foo", 1, "d");
120      List<String> expected = new ArrayList<String>();
121      expected.add("bb");
122      expected.add("c");
123      assertEquals(expected, jedis.zrangeByLex("foo", "(aa", "[c"));
124      expected.clear();
125      expected.add("bb");
126      expected.add("c");
127      assertEquals(expected, jedis.zrangeByLex("foo", "-", "+", 1, 2));
128    }
129    @Test
130    public void zrangeByLexBinary() {
131      jedis.zadd(bfoo, 1, ba);
132      jedis.zadd(bfoo, 1, bc);
133      jedis.zadd(bfoo, 1, bb);
134      List<byte[]> bExpected = new ArrayList<byte[]>();
135      bExpected.add(bb);
136      assertByteArrayListEquals(bExpected, jedis.zrangeByLex(bfoo, bInclusiveB, bExclusiveC));
137      bExpected.clear();
138      bExpected.add(ba);
139      bExpected.add(bb);
140      assertByteArrayListEquals(bExpected, jedis.zrangeByLex(bfoo, bLexMinusInf, bLexPlusInf, 0, 2));
141    }
142    @Test
143    public void zrevrangeByLex() {
144      jedis.zadd("foo", 1, "aa");
145      jedis.zadd("foo", 1, "c");
146      jedis.zadd("foo", 1, "bb");
147      jedis.zadd("foo", 1, "d");
148      List<String> expected = new ArrayList<String>();
149      expected.add("c");
150      expected.add("bb");
151      assertEquals(expected, jedis.zrevrangeByLex("foo", "[c", "(aa"));
152      expected.clear();
153      expected.add("c");
154      expected.add("bb");
155      assertEquals(expected, jedis.zrevrangeByLex("foo", "+", "-", 1, 2));
156    }
157    @Test
158    public void zrevrangeByLexBinary() {
159      jedis.zadd(bfoo, 1, ba);
160      jedis.zadd(bfoo, 1, bc);
161      jedis.zadd(bfoo, 1, bb);
162      List<byte[]> bExpected = new ArrayList<byte[]>();
163      bExpected.add(bb);
164      assertByteArrayListEquals(bExpected, jedis.zrevrangeByLex(bfoo, bExclusiveC, bInclusiveB));
165      bExpected.clear();
166      bExpected.add(bc);
167      bExpected.add(bb);
168      assertByteArrayListEquals(bExpected, jedis.zrevrangeByLex(bfoo, bLexPlusInf, bLexMinusInf, 0, 2));
169    }
170    @Test
171    public void zrevrange() {
172      jedis.zadd("foo", 1d, "a");
173      jedis.zadd("foo", 10d, "b");
174      jedis.zadd("foo", 0.1d, "c");
175      jedis.zadd("foo", 2d, "a");
176      List<String> expected = new ArrayList<String>();
177      expected.add("b");
178      expected.add("a");
179      List<String> range = jedis.zrevrange("foo", 0, 1);
180      assertEquals(expected, range);
181      expected.add("c");
182      range = jedis.zrevrange("foo", 0, 100);
183      assertEquals(expected, range);
184      jedis.zadd(bfoo, 1d, ba);
185      jedis.zadd(bfoo, 10d, bb);
186      jedis.zadd(bfoo, 0.1d, bc);
187      jedis.zadd(bfoo, 2d, ba);
188      List<byte[]> bexpected = new ArrayList<byte[]>();
189      bexpected.add(bb);
190      bexpected.add(ba);
191      List<byte[]> brange = jedis.zrevrange(bfoo, 0, 1);
192      assertByteArrayListEquals(bexpected, brange);
193      bexpected.add(bc);
194      brange = jedis.zrevrange(bfoo, 0, 100);
195      assertByteArrayListEquals(bexpected, brange);
196    }
197    @Test
198    public void zrem() {
199      jedis.zadd("foo", 1d, "a");
200      jedis.zadd("foo", 2d, "b");
201      assertEquals(1, jedis.zrem("foo", "a"));
202      List<String> expected = new ArrayList<String>();
203      expected.add("b");
204      assertEquals(expected, jedis.zrange("foo", 0, 100));
205      assertEquals(0, jedis.zrem("foo", "bar"));
206      jedis.zadd(bfoo, 1d, ba);
207      jedis.zadd(bfoo, 2d, bb);
208      assertEquals(1, jedis.zrem(bfoo, ba));
209      List<byte[]> bexpected = new ArrayList<byte[]>();
210      bexpected.add(bb);
211      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
212      assertEquals(0, jedis.zrem(bfoo, bbar));
213    }
214    @Test
215    public void zincrby() {
216      jedis.zadd("foo", 1d, "a");
217      jedis.zadd("foo", 2d, "b");
218      assertEquals(3d, jedis.zincrby("foo", 2d, "a"), 0);
219      List<String> expected = new ArrayList<String>();
220      expected.add("b");
221      expected.add("a");
222      assertEquals(expected, jedis.zrange("foo", 0, 100));
223      jedis.zadd(bfoo, 1d, ba);
224      jedis.zadd(bfoo, 2d, bb);
225      assertEquals(3d, jedis.zincrby(bfoo, 2d, ba), 0);
226      List<byte[]> bexpected = new ArrayList<byte[]>();
227      bexpected.add(bb);
228      bexpected.add(ba);
229      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
230    }
231    @Test
232    public void zincrbyWithParams() {
233      jedis.del("foo");
234      assertNull(jedis.zincrby("foo", 2d, "a", ZIncrByParams.zIncrByParams().xx()));
235      jedis.zadd("foo", 2d, "a");
236      assertNull(jedis.zincrby("foo", 1d, "a", ZIncrByParams.zIncrByParams().nx()));
237      assertEquals(Double.valueOf(2d), jedis.zscore("foo", "a"));
238      jedis.del(bfoo);
239      assertNull(jedis.zincrby(bfoo, 2d, ba, ZIncrByParams.zIncrByParams().xx()));
240      jedis.zadd(bfoo, 2d, ba);
241      assertNull(jedis.zincrby(bfoo, 1d, ba, ZIncrByParams.zIncrByParams().nx()));
242      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, ba));
243    }
244    @Test
245    public void zrank() {
246      jedis.zadd("foo", 1d, "a");
247      jedis.zadd("foo", 2d, "b");
248      long rank = jedis.zrank("foo", "a");
249      assertEquals(0, rank);
250      rank = jedis.zrank("foo", "b");
251      assertEquals(1, rank);
252      assertNull(jedis.zrank("car", "b"));
253      jedis.zadd(bfoo, 1d, ba);
254      jedis.zadd(bfoo, 2d, bb);
255      long brank = jedis.zrank(bfoo, ba);
256      assertEquals(0, brank);
257      brank = jedis.zrank(bfoo, bb);
258      assertEquals(1, brank);
259      assertNull(jedis.zrank(bcar, bb));
260    }
261    @Test
262    public void zrankWithScore() {
263      jedis.zadd("foo", 1d, "a");
264      jedis.zadd("foo", 2d, "b");
265      KeyValue<Long, Double> keyValue = jedis.zrankWithScore("foo", "a");
266      assertEquals(Long.valueOf(0), keyValue.getKey());
267      assertEquals(Double.valueOf(1d), keyValue.getValue());
268      keyValue = jedis.zrankWithScore("foo", "b");
269      assertEquals(Long.valueOf(1), keyValue.getKey());
270      assertEquals(Double.valueOf(2d), keyValue.getValue());
271      assertNull(jedis.zrankWithScore("car", "b"));
272      jedis.zadd(bfoo, 1d, ba);
273      jedis.zadd(bfoo, 2d, bb);
274      keyValue = jedis.zrankWithScore(bfoo, ba);
275      assertEquals(Long.valueOf(0), keyValue.getKey());
276      assertEquals(Double.valueOf(1d), keyValue.getValue());
277      keyValue = jedis.zrankWithScore(bfoo, bb);
278      assertEquals(Long.valueOf(1), keyValue.getKey());
279      assertEquals(Double.valueOf(2d), keyValue.getValue());
280      assertNull(jedis.zrankWithScore(bcar, bb));
281    }
282    @Test
283    public void zrevrank() {
284      jedis.zadd("foo", 1d, "a");
285      jedis.zadd("foo", 2d, "b");
286      long rank = jedis.zrevrank("foo", "a");
287      assertEquals(1, rank);
288      rank = jedis.zrevrank("foo", "b");
289      assertEquals(0, rank);
290      jedis.zadd(bfoo, 1d, ba);
291      jedis.zadd(bfoo, 2d, bb);
292      long brank = jedis.zrevrank(bfoo, ba);
293      assertEquals(1, brank);
294      brank = jedis.zrevrank(bfoo, bb);
295      assertEquals(0, brank);
296    }
297    @Test
298    public void zrangeWithScores() {
299      jedis.zadd("foo", 1d, "a");
300      jedis.zadd("foo", 10d, "b");
301      jedis.zadd("foo", 0.1d, "c");
302      jedis.zadd("foo", 2d, "a");
303      List<Tuple> expected = new ArrayList<Tuple>();
304      expected.add(new Tuple("c", 0.1d));
305      expected.add(new Tuple("a", 2d));
306      List<Tuple> range = jedis.zrangeWithScores("foo", 0, 1);
307      assertEquals(expected, range);
308      expected.add(new Tuple("b", 10d));
309      range = jedis.zrangeWithScores("foo", 0, 100);
310      assertEquals(expected, range);
311      jedis.zadd(bfoo, 1d, ba);
312      jedis.zadd(bfoo, 10d, bb);
313      jedis.zadd(bfoo, 0.1d, bc);
314      jedis.zadd(bfoo, 2d, ba);
315      List<Tuple> bexpected = new ArrayList<Tuple>();
316      bexpected.add(new Tuple(bc, 0.1d));
317      bexpected.add(new Tuple(ba, 2d));
318      List<Tuple> brange = jedis.zrangeWithScores(bfoo, 0, 1);
319      assertEquals(bexpected, brange);
320      bexpected.add(new Tuple(bb, 10d));
321      brange = jedis.zrangeWithScores(bfoo, 0, 100);
<span onclick='openModal()' class='match'>322      assertEquals(bexpected, brange);
323    }
324    @Test
325    public void zrevrangeWithScores() {
326      jedis.zadd("foo", 1d, "a");
</span>327      jedis.zadd("foo", 10d, "b");
328      jedis.zadd("foo", 0.1d, "c");
329      jedis.zadd("foo", 2d, "a");
330      List<Tuple> expected = new ArrayList<Tuple>();
331      expected.add(new Tuple("b", 10d));
332      expected.add(new Tuple("a", 2d));
333      List<Tuple> range = jedis.zrevrangeWithScores("foo", 0, 1);
334      assertEquals(expected, range);
335      expected.add(new Tuple("c", 0.1d));
336      range = jedis.zrevrangeWithScores("foo", 0, 100);
337      assertEquals(expected, range);
338      jedis.zadd(bfoo, 1d, ba);
339      jedis.zadd(bfoo, 10d, bb);
340      jedis.zadd(bfoo, 0.1d, bc);
341      jedis.zadd(bfoo, 2d, ba);
342      List<Tuple> bexpected = new ArrayList<Tuple>();
343      bexpected.add(new Tuple(bb, 10d));
344      bexpected.add(new Tuple(ba, 2d));
345      List<Tuple> brange = jedis.zrevrangeWithScores(bfoo, 0, 1);
346      assertEquals(bexpected, brange);
347      bexpected.add(new Tuple(bc, 0.1d));
348      brange = jedis.zrevrangeWithScores(bfoo, 0, 100);
349      assertEquals(bexpected, brange);
350    }
351    @Test
352    public void zcard() {
353      jedis.zadd("foo", 1d, "a");
354      jedis.zadd("foo", 10d, "b");
355      jedis.zadd("foo", 0.1d, "c");
356      jedis.zadd("foo", 2d, "a");
357      assertEquals(3, jedis.zcard("foo"));
358      jedis.zadd(bfoo, 1d, ba);
359      jedis.zadd(bfoo, 10d, bb);
360      jedis.zadd(bfoo, 0.1d, bc);
361      jedis.zadd(bfoo, 2d, ba);
362      assertEquals(3, jedis.zcard(bfoo));
363    }
364    @Test
365    public void zscore() {
366      jedis.zadd("foo", 1d, "a");
367      jedis.zadd("foo", 10d, "b");
368      jedis.zadd("foo", 0.1d, "c");
369      jedis.zadd("foo", 2d, "a");
370      assertEquals((Double) 10d, jedis.zscore("foo", "b"));
371      assertEquals((Double) 0.1d, jedis.zscore("foo", "c"));
372      assertNull(jedis.zscore("foo", "s"));
373      jedis.zadd(bfoo, 1d, ba);
374      jedis.zadd(bfoo, 10d, bb);
375      jedis.zadd(bfoo, 0.1d, bc);
376      jedis.zadd(bfoo, 2d, ba);
377      assertEquals((Double) 10d, jedis.zscore(bfoo, bb));
378      assertEquals((Double) 0.1d, jedis.zscore(bfoo, bc));
379      assertNull(jedis.zscore(bfoo, SafeEncoder.encode("s")));
380    }
381    @Test
382    public void zmscore() {
383      jedis.zadd("foo", 1d, "a");
384      jedis.zadd("foo", 10d, "b");
385      jedis.zadd("foo", 0.1d, "c");
386      jedis.zadd("foo", 2d, "a");
387      assertEquals(Arrays.asList(10d, 0.1d, null), jedis.zmscore("foo", "b", "c", "s"));
388      jedis.zadd(bfoo, 1d, ba);
389      jedis.zadd(bfoo, 10d, bb);
390      jedis.zadd(bfoo, 0.1d, bc);
391      jedis.zadd(bfoo, 2d, ba);
392      assertEquals(Arrays.asList(10d, 0.1d, null),
393        jedis.zmscore(bfoo, bb, bc, SafeEncoder.encode("s")));
394    }
395    @Test
396    public void zpopmax() {
397      jedis.zadd("foo", 1d, "a");
398      jedis.zadd("foo", 10d, "b");
399      jedis.zadd("foo", 0.1d, "c");
400      jedis.zadd("foo", 2d, "d");
401      Tuple actual = jedis.zpopmax("foo");
402      Tuple expected = new Tuple("b", 10d);
403      assertEquals(expected, actual);
404      actual = jedis.zpopmax("foo");
405      expected = new Tuple("d", 2d);
406      assertEquals(expected, actual);
407      actual = jedis.zpopmax("foo");
408      expected = new Tuple("a", 1d);
409      assertEquals(expected, actual);
410      actual = jedis.zpopmax("foo");
411      expected = new Tuple("c", 0.1d);
412      assertEquals(expected, actual);
413      actual = jedis.zpopmax("foo");
414      assertNull(actual);
415      jedis.zadd(bfoo, 1d, ba);
416      jedis.zadd(bfoo, 10d, bb);
417      jedis.zadd(bfoo, 0.1d, bc);
418      jedis.zadd(bfoo, 2d, ba);
419      actual = jedis.zpopmax(bfoo);
420      expected = new Tuple(bb, 10d);
421      assertEquals(expected, actual);
422      actual = jedis.zpopmax(bfoo);
423      expected = new Tuple(ba, 2d);
424      assertEquals(expected, actual);
425      actual = jedis.zpopmax(bfoo);
426      expected = new Tuple(bc, 0.1d);
427      assertEquals(expected, actual);
428      actual = jedis.zpopmax(bfoo);
429      assertNull(actual);
430    }
431    @Test
432    public void zpopmaxWithCount() {
433      jedis.zadd("foo", 1d, "a");
434      jedis.zadd("foo", 10d, "b");
435      jedis.zadd("foo", 0.1d, "c");
436      jedis.zadd("foo", 2d, "d");
437      jedis.zadd("foo", 0.03, "e");
438      List<Tuple> actual = jedis.zpopmax("foo", 2);
439      assertEquals(2, actual.size());
440      List<Tuple> expected = new ArrayList<Tuple>();
441      expected.add(new Tuple("b", 10d));
442      expected.add(new Tuple("d", 2d));
443      assertEquals(expected, actual);
444      actual = jedis.zpopmax("foo", 3);
445      assertEquals(3, actual.size());
446      expected.clear();
447      expected.add(new Tuple("a", 1d));
448      expected.add(new Tuple("c", 0.1d));
449      expected.add(new Tuple("e", 0.03d));
450      assertEquals(expected, actual);
451      actual = jedis.zpopmax("foo", 1);
452      expected.clear();
453      assertEquals(expected, actual);
454      jedis.zadd(bfoo, 1d, ba);
455      jedis.zadd(bfoo, 10d, bb);
456      jedis.zadd(bfoo, 0.1d, bc);
457      jedis.zadd(bfoo, 2d, ba);
458      actual = jedis.zpopmax(bfoo, 1);
459      expected.clear();
460      expected.add(new Tuple(bb, 10d));
461      assertEquals(expected, actual);
462      actual = jedis.zpopmax(bfoo, 1);
463      expected.clear();
464      expected.add(new Tuple(ba, 2d));
465      assertEquals(expected, actual);
466      actual = jedis.zpopmax(bfoo, 1);
467      expected.clear();
468      expected.add(new Tuple(bc, 0.1d));
469      assertEquals(expected, actual);
470      actual = jedis.zpopmax(bfoo, 1);
471      expected.clear();
472      assertEquals(expected, actual);
473    }
474    @Test
475    public void zpopmin() {
476      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
477      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
478      jedis.zadd("foo", 0.1d, "c", ZAddParams.zAddParams().nx());
479      jedis.zadd("foo", 2d, "a", ZAddParams.zAddParams().nx());
480      List<Tuple> range = jedis.zpopmin("foo", 2);
481      List<Tuple> expected = new ArrayList<Tuple>();
482      expected.add(new Tuple("c", 0.1d));
483      expected.add(new Tuple("a", 1d));
484      assertEquals(expected, range);
485      assertEquals(new Tuple("b", 10d), jedis.zpopmin("foo"));
486      jedis.zadd(bfoo, 1d, ba);
487      jedis.zadd(bfoo, 10d, bb);
488      jedis.zadd(bfoo, 0.1d, bc);
489      jedis.zadd(bfoo, 2d, ba);
490      List<Tuple> brange = jedis.zpopmin(bfoo, 2);
491      List<Tuple> bexpected = new ArrayList<Tuple>();
492      bexpected.add(new Tuple(bc, 0.1d));
493      bexpected.add(new Tuple(ba, 2d));
494      assertEquals(bexpected, brange);
495      assertEquals(new Tuple(bb, 10d), jedis.zpopmin(bfoo));
496    }
497    @Test
498    public void zcount() {
499      jedis.zadd("foo", 1d, "a");
500      jedis.zadd("foo", 10d, "b");
501      jedis.zadd("foo", 0.1d, "c");
502      jedis.zadd("foo", 2d, "a");
503      assertEquals(2, jedis.zcount("foo", 0.01d, 2.1d));
504      assertEquals(3, jedis.zcount("foo", "(0.01", "+inf"));
505      jedis.zadd(bfoo, 1d, ba);
506      jedis.zadd(bfoo, 10d, bb);
507      jedis.zadd(bfoo, 0.1d, bc);
508      jedis.zadd(bfoo, 2d, ba);
509      assertEquals(2, jedis.zcount(bfoo, 0.01d, 2.1d));
510      assertEquals(3, jedis.zcount(bfoo, SafeEncoder.encode("(0.01"), SafeEncoder.encode("+inf")));
511    }
512    @Test
513    public void zlexcount() {
514      jedis.zadd("foo", 1, "a");
515      jedis.zadd("foo", 1, "b");
516      jedis.zadd("foo", 1, "c");
517      jedis.zadd("foo", 1, "aa");
518      assertEquals(2, jedis.zlexcount("foo", "[aa", "(c"));
519      assertEquals(4, jedis.zlexcount("foo", "-", "+"));
520      assertEquals(3, jedis.zlexcount("foo", "-", "(c"));
521      assertEquals(3, jedis.zlexcount("foo", "[aa", "+"));
522    }
523    @Test
524    public void zlexcountBinary() {
525      jedis.zadd(bfoo, 1, ba);
526      jedis.zadd(bfoo, 1, bc);
527      jedis.zadd(bfoo, 1, bb);
528      assertEquals(1, jedis.zlexcount(bfoo, bInclusiveB, bExclusiveC));
529      assertEquals(3, jedis.zlexcount(bfoo, bLexMinusInf, bLexPlusInf));
530    }
531    @Test
532    public void zrangebyscore() {
533      jedis.zadd("foo", 1d, "a");
534      jedis.zadd("foo", 10d, "b");
535      jedis.zadd("foo", 0.1d, "c");
536      jedis.zadd("foo", 2d, "a");
537      List<String> range = jedis.zrangeByScore("foo", 0d, 2d);
538      List<String> expected = new ArrayList<String>();
539      expected.add("c");
540      expected.add("a");
541      assertEquals(expected, range);
542      range = jedis.zrangeByScore("foo", 0d, 2d, 0, 1);
543      expected = new ArrayList<String>();
544      expected.add("c");
545      assertEquals(expected, range);
546      range = jedis.zrangeByScore("foo", 0d, 2d, 1, 1);
547      List<String> range2 = jedis.zrangeByScore("foo", "-inf", "(2");
548      assertEquals(expected, range2);
549      expected = new ArrayList<String>();
550      expected.add("a");
551      assertEquals(expected, range);
552      jedis.zadd(bfoo, 1d, ba);
553      jedis.zadd(bfoo, 10d, bb);
554      jedis.zadd(bfoo, 0.1d, bc);
555      jedis.zadd(bfoo, 2d, ba);
556      List<byte[]> brange = jedis.zrangeByScore(bfoo, 0d, 2d);
557      List<byte[]> bexpected = new ArrayList<byte[]>();
558      bexpected.add(bc);
559      bexpected.add(ba);
560      assertByteArrayListEquals(bexpected, brange);
561      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 0, 1);
562      bexpected = new ArrayList<byte[]>();
563      bexpected.add(bc);
564      assertByteArrayListEquals(bexpected, brange);
565      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 1, 1);
566      List<byte[]> brange2 = jedis.zrangeByScore(bfoo, SafeEncoder.encode("-inf"),
567        SafeEncoder.encode("(2"));
568      assertByteArrayListEquals(bexpected, brange2);
569      bexpected = new ArrayList<byte[]>();
570      bexpected.add(ba);
571      assertByteArrayListEquals(bexpected, brange);
572    }
573    @Test
574    public void zrevrangebyscore() {
575      jedis.zadd("foo", 1.0d, "a");
576      jedis.zadd("foo", 2.0d, "b");
577      jedis.zadd("foo", 3.0d, "c");
578      jedis.zadd("foo", 4.0d, "d");
579      jedis.zadd("foo", 5.0d, "e");
580      List<String> range = jedis.zrevrangeByScore("foo", 3d, Double.NEGATIVE_INFINITY, 0, 1);
581      List<String> expected = new ArrayList<String>();
582      expected.add("c");
583      assertEquals(expected, range);
584      range = jedis.zrevrangeByScore("foo", 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
585      expected = new ArrayList<String>();
586      expected.add("c");
587      expected.add("b");
588      assertEquals(expected, range);
589      range = jedis.zrevrangeByScore("foo", 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
590      expected = new ArrayList<String>();
591      expected.add("b");
592      assertEquals(expected, range);
593      range = jedis.zrevrangeByScore("foo", 4d, 2d);
594      expected = new ArrayList<String>();
595      expected.add("d");
596      expected.add("c");
597      expected.add("b");
598      assertEquals(expected, range);
599      range = jedis.zrevrangeByScore("foo", "4", "2", 0, 2);
600      expected = new ArrayList<String>();
601      expected.add("d");
602      expected.add("c");
603      assertEquals(expected, range);
604      range = jedis.zrevrangeByScore("foo", "+inf", "(4");
605      expected = new ArrayList<String>();
606      expected.add("e");
607      assertEquals(expected, range);
608      jedis.zadd(bfoo, 1d, ba);
609      jedis.zadd(bfoo, 10d, bb);
610      jedis.zadd(bfoo, 0.1d, bc);
611      jedis.zadd(bfoo, 2d, ba);
612      List<byte[]> brange = jedis.zrevrangeByScore(bfoo, 2d, 0d);
613      List<byte[]> bexpected = new ArrayList<byte[]>();
614      bexpected.add(ba);
615      bexpected.add(bc);
616      assertByteArrayListEquals(bexpected, brange);
617      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 0, 1);
618      bexpected = new ArrayList<byte[]>();
619      bexpected.add(ba);
620      assertByteArrayListEquals(bexpected, brange);
621      List<byte[]> brange2 = jedis.zrevrangeByScore(bfoo, SafeEncoder.encode("+inf"),
622        SafeEncoder.encode("(2"));
623      bexpected = new ArrayList<byte[]>();
624      bexpected.add(bb);
625      assertByteArrayListEquals(bexpected, brange2);
626      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 1, 1);
627      bexpected = new ArrayList<byte[]>();
628      bexpected.add(bc);
629      assertByteArrayListEquals(bexpected, brange);
630    }
631    @Test
632    public void zrangebyscoreWithScores() {
633      jedis.zadd("foo", 1d, "a");
634      jedis.zadd("foo", 10d, "b");
635      jedis.zadd("foo", 0.1d, "c");
636      jedis.zadd("foo", 2d, "a");
637      List<Tuple> range = jedis.zrangeByScoreWithScores("foo", 0d, 2d);
638      List<Tuple> expected = new ArrayList<Tuple>();
639      expected.add(new Tuple("c", 0.1d));
640      expected.add(new Tuple("a", 2d));
641      assertEquals(expected, range);
642      range = jedis.zrangeByScoreWithScores("foo", 0d, 2d, 0, 1);
643      expected = new ArrayList<Tuple>();
644      expected.add(new Tuple("c", 0.1d));
645      assertEquals(expected, range);
646      range = jedis.zrangeByScoreWithScores("foo", 0d, 2d, 1, 1);
647      expected = new ArrayList<Tuple>();
648      expected.add(new Tuple("a", 2d));
649      assertEquals(expected, range);
650      jedis.zadd(bfoo, 1d, ba);
651      jedis.zadd(bfoo, 10d, bb);
652      jedis.zadd(bfoo, 0.1d, bc);
653      jedis.zadd(bfoo, 2d, ba);
654      List<Tuple> brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d);
655      List<Tuple> bexpected = new ArrayList<Tuple>();
656      bexpected.add(new Tuple(bc, 0.1d));
657      bexpected.add(new Tuple(ba, 2d));
658      assertEquals(bexpected, brange);
659      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 0, 1);
660      bexpected = new ArrayList<Tuple>();
661      bexpected.add(new Tuple(bc, 0.1d));
662      assertEquals(bexpected, brange);
663      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 1, 1);
664      bexpected = new ArrayList<Tuple>();
665      bexpected.add(new Tuple(ba, 2d));
666      assertEquals(bexpected, brange);
667    }
668    @Test
669    public void zrangeParams() {
670      jedis.zadd("foo", 1, "aa");
671      jedis.zadd("foo", 1, "c");
672      jedis.zadd("foo", 1, "bb");
673      jedis.zadd("foo", 1, "d");
674      List<String> expected = new ArrayList<String>();
675      expected.add("c");
676      expected.add("bb");
677      assertEquals(expected, jedis.zrange("foo", ZRangeParams.zrangeByLexParams("[c", "(aa").rev()));
678      assertNotNull(jedis.zrangeWithScores("foo", ZRangeParams.zrangeByScoreParams(0, 1)));
679      jedis.zadd(bfoo, 1, ba);
680      jedis.zadd(bfoo, 1, bc);
681      jedis.zadd(bfoo, 1, bb);
682      List<byte[]> bExpected = new ArrayList<byte[]>();
683      bExpected.add(bb);
684      assertByteArrayListEquals(bExpected, jedis.zrange(bfoo, ZRangeParams.zrangeByLexParams(bExclusiveC, bInclusiveB).rev()));
685      assertNotNull(jedis.zrangeWithScores(bfoo, ZRangeParams.zrangeByScoreParams(0, 1).limit(0, 3)));
686    }
687    @Test
688    public void zrangestore() {
689      jedis.zadd("foo", 1, "aa");
690      jedis.zadd("foo", 2, "c");
691      jedis.zadd("foo", 3, "bb");
692      long stored = jedis.zrangestore("bar", "foo", ZRangeParams.zrangeByScoreParams(1, 2));
693      assertEquals(2, stored);
694      List<String> range = jedis.zrange("bar", 0, -1);
695      List<String> expected = new ArrayList<>();
696      expected.add("aa");
697      expected.add("c");
698      assertEquals(expected, range);
699      jedis.zadd(bfoo, 1d, ba);
700      jedis.zadd(bfoo, 10d, bb);
701      jedis.zadd(bfoo, 0.1d, bc);
702      jedis.zadd(bfoo, 2d, ba);
703      long bstored = jedis.zrangestore(bbar, bfoo, ZRangeParams.zrangeParams(0, 1).rev());
704      assertEquals(2, bstored);
705      List<byte[]> brange = jedis.zrevrange(bbar, 0, 1);
706      List<byte[]> bexpected = new ArrayList<>();
707      bexpected.add(bb);
708      bexpected.add(ba);
709      assertByteArrayListEquals(bexpected, brange);
710    }
711    @Test
712    public void zrevrangebyscoreWithScores() {
713      jedis.zadd("foo", 1.0d, "a");
714      jedis.zadd("foo", 2.0d, "b");
715      jedis.zadd("foo", 3.0d, "c");
716      jedis.zadd("foo", 4.0d, "d");
717      jedis.zadd("foo", 5.0d, "e");
718      List<Tuple> range = jedis.zrevrangeByScoreWithScores("foo", 3d, Double.NEGATIVE_INFINITY, 0, 1);
719      List<Tuple> expected = new ArrayList<Tuple>();
720      expected.add(new Tuple("c", 3.0d));
721      assertEquals(expected, range);
722      range = jedis.zrevrangeByScoreWithScores("foo", 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
723      expected = new ArrayList<Tuple>();
724      expected.add(new Tuple("c", 3.0d));
725      expected.add(new Tuple("b", 2.0d));
726      assertEquals(expected, range);
727      range = jedis.zrevrangeByScoreWithScores("foo", 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
728      expected = new ArrayList<Tuple>();
729      expected.add(new Tuple("b", 2.0d));
730      assertEquals(expected, range);
731      range = jedis.zrevrangeByScoreWithScores("foo", 4d, 2d);
732      expected = new ArrayList<Tuple>();
733      expected.add(new Tuple("d", 4.0d));
734      expected.add(new Tuple("c", 3.0d));
735      expected.add(new Tuple("b", 2.0d));
736      assertEquals(expected, range);
737      jedis.zadd(bfoo, 1d, ba);
738      jedis.zadd(bfoo, 10d, bb);
739      jedis.zadd(bfoo, 0.1d, bc);
740      jedis.zadd(bfoo, 2d, ba);
741      List<Tuple> brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d);
742      List<Tuple> bexpected = new ArrayList<Tuple>();
743      bexpected.add(new Tuple(ba, 2d));
744      bexpected.add(new Tuple(bc, 0.1d));
745      assertEquals(bexpected, brange);
746      brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d, 0, 1);
747      bexpected = new ArrayList<Tuple>();
748      bexpected.add(new Tuple(ba, 2d));
749      assertEquals(bexpected, brange);
750      brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d, 1, 1);
751      bexpected = new ArrayList<Tuple>();
752      bexpected.add(new Tuple(bc, 0.1d));
753      assertEquals(bexpected, brange);
754    }
755    @Test
756    public void zremrangeByRank() {
757      jedis.zadd("foo", 1d, "a");
758      jedis.zadd("foo", 10d, "b");
759      jedis.zadd("foo", 0.1d, "c");
760      jedis.zadd("foo", 2d, "a");
761      assertEquals(1, jedis.zremrangeByRank("foo", 0, 0));
762      List<String> expected = new ArrayList<String>();
763      expected.add("a");
764      expected.add("b");
765      assertEquals(expected, jedis.zrange("foo", 0, 100));
766      jedis.zadd(bfoo, 1d, ba);
767      jedis.zadd(bfoo, 10d, bb);
768      jedis.zadd(bfoo, 0.1d, bc);
769      jedis.zadd(bfoo, 2d, ba);
770      assertEquals(1, jedis.zremrangeByRank(bfoo, 0, 0));
771      List<byte[]> bexpected = new ArrayList<byte[]>();
772      bexpected.add(ba);
773      bexpected.add(bb);
774      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
775    }
776    @Test
777    public void zremrangeByScore() {
778      jedis.zadd("foo", 1d, "a");
779      jedis.zadd("foo", 10d, "b");
780      jedis.zadd("foo", 0.1d, "c");
781      jedis.zadd("foo", 2d, "a");
782      assertEquals(2, jedis.zremrangeByScore("foo", 0, 2));
783      List<String> expected = new ArrayList<String>();
784      expected.add("b");
785      assertEquals(expected, jedis.zrange("foo", 0, 100));
786      jedis.zadd(bfoo, 1d, ba);
787      jedis.zadd(bfoo, 10d, bb);
788      jedis.zadd(bfoo, 0.1d, bc);
789      jedis.zadd(bfoo, 2d, ba);
790      assertEquals(2, jedis.zremrangeByScore(bfoo, 0, 2));
791      List<byte[]> bexpected = new ArrayList<byte[]>();
792      bexpected.add(bb);
793      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
794    }
795    @Test
796    public void zremrangeByScoreExclusive() {
797      jedis.zadd("foo", 1d, "a");
798      jedis.zadd("foo", 0d, "c");
799      jedis.zadd("foo", 2d, "b");
800      assertEquals(1, jedis.zremrangeByScore("foo", "(0", "(2"));
801      jedis.zadd(bfoo, 1d, ba);
802      jedis.zadd(bfoo, 0d, bc);
803      jedis.zadd(bfoo, 2d, bb);
804      assertEquals(1, jedis.zremrangeByScore(bfoo, "(0".getBytes(), "(2".getBytes()));
805    }
806    @Test
807    public void zremrangeByLex() {
808      jedis.zadd("foo", 1, "a");
809      jedis.zadd("foo", 1, "b");
810      jedis.zadd("foo", 1, "c");
811      jedis.zadd("foo", 1, "aa");
812      assertEquals(2, jedis.zremrangeByLex("foo", "[aa", "(c"));
813      List<String> expected = new ArrayList<String>();
814      expected.add("a");
815      expected.add("c");
816      assertEquals(expected, jedis.zrangeByLex("foo", "-", "+"));
817    }
818    @Test
819    public void zremrangeByLexBinary() {
820      jedis.zadd(bfoo, 1, ba);
821      jedis.zadd(bfoo, 1, bc);
822      jedis.zadd(bfoo, 1, bb);
823      assertEquals(1, jedis.zremrangeByLex(bfoo, bInclusiveB, bExclusiveC));
824      List<byte[]> bexpected = new ArrayList<byte[]>();
825      bexpected.add(ba);
826      bexpected.add(bc);
827      assertByteArrayListEquals(bexpected, jedis.zrangeByLex(bfoo, bLexMinusInf, bLexPlusInf));
828    }
829    @Test
830    public void zunion() {
831      jedis.zadd("foo", 1, "a");
832      jedis.zadd("foo", 2, "b");
833      jedis.zadd("bar", 2, "a");
834      jedis.zadd("bar", 2, "b");
835      ZParams params = new ZParams();
836      params.weights(2, 2.5);
837      params.aggregate(ZParams.Aggregate.SUM);
838      List<String> expected = new ArrayList<>();
839      expected.add("a");
840      expected.add("b");
841      assertEquals(expected, jedis.zunion(params, "foo", "bar"));
842      List<Tuple> expectedTuple = new ArrayList<>();
843      expectedTuple.add(new Tuple("a", new Double(7)));
844      expectedTuple.add(new Tuple("b", new Double(9)));
845      assertEquals(expectedTuple, jedis.zunionWithScores(params, "foo", "bar"));
846      jedis.zadd(bfoo, 1, ba);
847      jedis.zadd(bfoo, 2, bb);
848      jedis.zadd(bbar, 2, ba);
849      jedis.zadd(bbar, 2, bb);
850      List<byte[]> bexpected = new ArrayList<>();
851      bexpected.add(ba);
852      bexpected.add(bb);
853      AssertUtil.assertByteArrayListEquals(bexpected, jedis.zunion(params, bfoo, bbar));
854      List<Tuple> bexpectedTuple = new ArrayList<>();
855      bexpectedTuple.add(new Tuple(ba, new Double(7)));
856      bexpectedTuple.add(new Tuple(bb, new Double(9)));
857      assertEquals(bexpectedTuple, jedis.zunionWithScores(params, bfoo, bbar));
858    }
859    @Test
860    public void zunionstore() {
861      jedis.zadd("foo", 1, "a");
862      jedis.zadd("foo", 2, "b");
863      jedis.zadd("bar", 2, "a");
864      jedis.zadd("bar", 2, "b");
865      assertEquals(2, jedis.zunionstore("dst", "foo", "bar"));
866      List<Tuple> expected = new ArrayList<Tuple>();
867      expected.add(new Tuple("a", new Double(3)));
868      expected.add(new Tuple("b", new Double(4)));
869      assertEquals(expected, jedis.zrangeWithScores("dst", 0, 100));
870      jedis.zadd(bfoo, 1, ba);
871      jedis.zadd(bfoo, 2, bb);
872      jedis.zadd(bbar, 2, ba);
873      jedis.zadd(bbar, 2, bb);
874      assertEquals(2, jedis.zunionstore(SafeEncoder.encode("dst"), bfoo, bbar));
875      List<Tuple> bexpected = new ArrayList<Tuple>();
876      bexpected.add(new Tuple(ba, new Double(3)));
877      bexpected.add(new Tuple(bb, new Double(4)));
878      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode("dst"), 0, 100));
879    }
880    @Test
881    public void zunionstoreParams() {
882      jedis.zadd("foo", 1, "a");
883      jedis.zadd("foo", 2, "b");
884      jedis.zadd("bar", 2, "a");
885      jedis.zadd("bar", 2, "b");
886      ZParams params = new ZParams();
887      params.weights(2, 2.5);
888      params.aggregate(ZParams.Aggregate.SUM);
889      assertEquals(2, jedis.zunionstore("dst", params, "foo", "bar"));
890      List<Tuple> expected = new ArrayList<Tuple>();
891      expected.add(new Tuple("a", new Double(7)));
892      expected.add(new Tuple("b", new Double(9)));
893      assertEquals(expected, jedis.zrangeWithScores("dst", 0, 100));
894      jedis.zadd(bfoo, 1, ba);
895      jedis.zadd(bfoo, 2, bb);
896      jedis.zadd(bbar, 2, ba);
897      jedis.zadd(bbar, 2, bb);
898      ZParams bparams = new ZParams();
899      bparams.weights(2, 2.5);
900      bparams.aggregate(ZParams.Aggregate.SUM);
901      assertEquals(2, jedis.zunionstore(SafeEncoder.encode("dst"), bparams, bfoo, bbar));
902      List<Tuple> bexpected = new ArrayList<Tuple>();
903      bexpected.add(new Tuple(ba, new Double(7)));
904      bexpected.add(new Tuple(bb, new Double(9)));
905      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode("dst"), 0, 100));
906    }
907    @Test
908    public void zinter() {
909      jedis.zadd("foo", 1, "a");
910      jedis.zadd("foo", 2, "b");
911      jedis.zadd("bar", 2, "a");
912      ZParams params = new ZParams();
913      params.weights(2, 2.5);
914      params.aggregate(ZParams.Aggregate.SUM);
915      assertEquals(singletonList("a"), jedis.zinter(params, "foo", "bar"));
916      assertEquals(singletonList(new Tuple("a", new Double(7))),
917        jedis.zinterWithScores(params, "foo", "bar"));
918      jedis.zadd(bfoo, 1, ba);
919      jedis.zadd(bfoo, 2, bb);
920      jedis.zadd(bbar, 2, ba);
921      ZParams bparams = new ZParams();
922      bparams.weights(2, 2.5);
923      bparams.aggregate(ZParams.Aggregate.SUM);
924      AssertUtil.assertByteArrayListEquals(singletonList(ba), jedis.zinter(params, bfoo, bbar));
925      assertEquals(singletonList(new Tuple(ba, new Double(7))),
926        jedis.zinterWithScores(bparams, bfoo, bbar));
927    }
928    @Test
929    public void zinterstore() {
930      jedis.zadd("foo", 1, "a");
931      jedis.zadd("foo", 2, "b");
932      jedis.zadd("bar", 2, "a");
933      assertEquals(1, jedis.zinterstore("dst", "foo", "bar"));
934      List<Tuple> expected = new ArrayList<Tuple>();
935      expected.add(new Tuple("a", new Double(3)));
936      assertEquals(expected, jedis.zrangeWithScores("dst", 0, 100));
937      jedis.zadd(bfoo, 1, ba);
938      jedis.zadd(bfoo, 2, bb);
939      jedis.zadd(bbar, 2, ba);
940      assertEquals(1, jedis.zinterstore(SafeEncoder.encode("dst"), bfoo, bbar));
941      List<Tuple> bexpected = new ArrayList<Tuple>();
942      bexpected.add(new Tuple(ba, new Double(3)));
943      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode("dst"), 0, 100));
944    }
945    @Test
946    public void zintertoreParams() {
947      jedis.zadd("foo", 1, "a");
948      jedis.zadd("foo", 2, "b");
949      jedis.zadd("bar", 2, "a");
950      ZParams params = new ZParams();
951      params.weights(2, 2.5);
952      params.aggregate(ZParams.Aggregate.SUM);
953      assertEquals(1, jedis.zinterstore("dst", params, "foo", "bar"));
954      List<Tuple> expected = new ArrayList<Tuple>();
955      expected.add(new Tuple("a", new Double(7)));
956      assertEquals(expected, jedis.zrangeWithScores("dst", 0, 100));
957      jedis.zadd(bfoo, 1, ba);
958      jedis.zadd(bfoo, 2, bb);
959      jedis.zadd(bbar, 2, ba);
960      ZParams bparams = new ZParams();
961      bparams.weights(2, 2.5);
962      bparams.aggregate(ZParams.Aggregate.SUM);
963      assertEquals(1, jedis.zinterstore(SafeEncoder.encode("dst"), bparams, bfoo, bbar));
964      List<Tuple> bexpected = new ArrayList<Tuple>();
965      bexpected.add(new Tuple(ba, new Double(7)));
966      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode("dst"), 0, 100));
967    }
968    @Test
969    public void zintercard() {
970      jedis.zadd("foo", 1, "a");
971      jedis.zadd("foo", 2, "b");
972      jedis.zadd("bar", 2, "a");
973      jedis.zadd("bar", 1, "b");
974      assertEquals(2, jedis.zintercard("foo", "bar"));
975      assertEquals(1, jedis.zintercard(1, "foo", "bar"));
976      jedis.zadd(bfoo, 1, ba);
977      jedis.zadd(bfoo, 2, bb);
978      jedis.zadd(bbar, 2, ba);
979      jedis.zadd(bbar, 2, bb);
980      assertEquals(2, jedis.zintercard(bfoo, bbar));
981      assertEquals(1, jedis.zintercard(1, bfoo, bbar));
982    }
983    @Test
984    public void zscan() {
985      jedis.zadd("foo", 1, "a");
986      jedis.zadd("foo", 2, "b");
987      ScanResult<Tuple> result = jedis.zscan("foo", SCAN_POINTER_START);
988      assertEquals(SCAN_POINTER_START, result.getCursor());
989      assertFalse(result.getResult().isEmpty());
990      jedis.zadd(bfoo, 1, ba);
991      jedis.zadd(bfoo, 1, bb);
992      ScanResult<Tuple> bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY);
993      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
994      assertFalse(bResult.getResult().isEmpty());
995    }
996    @Test
997    public void zscanMatch() {
998      ScanParams params = new ScanParams();
999      params.match("a*");
1000      jedis.zadd("foo", 2, "b");
1001      jedis.zadd("foo", 1, "a");
1002      jedis.zadd("foo", 11, "aa");
1003      ScanResult<Tuple> result = jedis.zscan("foo", SCAN_POINTER_START, params);
1004      assertEquals(SCAN_POINTER_START, result.getCursor());
1005      assertFalse(result.getResult().isEmpty());
1006      params = new ScanParams();
1007      params.match(bbarstar);
1008      jedis.zadd(bfoo, 2, bbar1);
1009      jedis.zadd(bfoo, 1, bbar2);
1010      jedis.zadd(bfoo, 11, bbar3);
1011      ScanResult<Tuple> bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY, params);
1012      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
1013      assertFalse(bResult.getResult().isEmpty());
1014    }
1015    @Test
1016    public void zscanCount() {
1017      ScanParams params = new ScanParams();
1018      params.count(2);
1019      jedis.zadd("foo", 1, "a1");
1020      jedis.zadd("foo", 2, "a2");
1021      jedis.zadd("foo", 3, "a3");
1022      jedis.zadd("foo", 4, "a4");
1023      jedis.zadd("foo", 5, "a5");
1024      ScanResult<Tuple> result = jedis.zscan("foo", SCAN_POINTER_START, params);
1025      assertFalse(result.getResult().isEmpty());
1026      params = new ScanParams();
1027      params.count(2);
1028      jedis.zadd(bfoo, 2, bbar1);
1029      jedis.zadd(bfoo, 1, bbar2);
1030      jedis.zadd(bfoo, 11, bbar3);
1031      ScanResult<Tuple> bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY, params);
1032      assertFalse(bResult.getResult().isEmpty());
1033    }
1034    @Test
1035    public void infinity() {
1036      jedis.zadd("key", Double.POSITIVE_INFINITY, "pos");
1037      assertEquals(Double.POSITIVE_INFINITY, jedis.zscore("key", "pos"), 0d);
1038      jedis.zadd("key", Double.NEGATIVE_INFINITY, "neg");
1039      assertEquals(Double.NEGATIVE_INFINITY, jedis.zscore("key", "neg"), 0d);
1040      jedis.zadd("key", 0d, "zero");
1041      List<Tuple> set = jedis.zrangeWithScores("key", 0, -1);
1042      Iterator<Tuple> itr = set.iterator();
1043      assertEquals(Double.NEGATIVE_INFINITY, itr.next().getScore(), 0d);
1044      assertEquals(0d, itr.next().getScore(), 0d);
1045      assertEquals(Double.POSITIVE_INFINITY, itr.next().getScore(), 0d);
1046    }
1047    @Test
1048    public void bzpopmax() {
1049      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
1050      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
1051      jedis.zadd("bar", 0.1d, "c", ZAddParams.zAddParams().nx());
1052      assertEquals(new KeyValue<>("foo", new Tuple("b", 10d)), jedis.bzpopmax(0, "foo", "bar"));
1053      jedis.zadd(bfoo, 1d, ba);
1054      jedis.zadd(bfoo, 10d, bb);
1055      jedis.zadd(bbar, 0.1d, bc);
1056      KeyValue<byte[], Tuple> actual = jedis.bzpopmax(0, bfoo, bbar);
1057      assertArrayEquals(bfoo, actual.getKey());
1058      assertEquals(new Tuple(bb, 10d), actual.getValue());
1059    }
1060    @Test
1061    public void bzpopmin() {
1062      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
1063      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
1064      jedis.zadd("bar", 0.1d, "c", ZAddParams.zAddParams().nx());
1065      assertEquals(new KeyValue<>("bar", new Tuple("c", 0.1)), jedis.bzpopmin(0, "bar", "foo"));
1066      jedis.zadd(bfoo, 1d, ba);
1067      jedis.zadd(bfoo, 10d, bb);
1068      jedis.zadd(bbar, 0.1d, bc);
1069      KeyValue<byte[], Tuple> actual = jedis.bzpopmin(0, bbar, bfoo);
1070      assertArrayEquals(bbar, (byte[]) actual.getKey());
1071      assertEquals(new Tuple(bc, 0.1), actual.getValue());
1072    }
1073    @Test
1074    public void zdiff() {
1075      jedis.zadd("foo", 1.0, "a");
1076      jedis.zadd("foo", 2.0, "b");
1077      jedis.zadd("bar", 1.0, "a");
1078      assertEquals(0, jedis.zdiff("bar1", "bar2").size());
1079      assertEquals(singletonList("b"), jedis.zdiff("foo", "bar"));
1080      assertEquals(singletonList(new Tuple("b", 2.0d)), jedis.zdiffWithScores("foo", "bar"));
1081      jedis.zadd(bfoo, 1.0, ba);
1082      jedis.zadd(bfoo, 2.0, bb);
1083      jedis.zadd(bbar, 1.0, ba);
1084      assertEquals(0, jedis.zdiff(bbar1, bbar2).size());
1085      List<byte[]> bactual = jedis.zdiff(bfoo, bbar);
1086      assertEquals(1, bactual.size());
1087      assertArrayEquals(bb, bactual.iterator().next());
1088      assertEquals(singletonList(new Tuple(bb, 2.0d)), jedis.zdiffWithScores(bfoo, bbar));
1089    }
1090    @Test
1091    public void zdiffstore() {
1092      jedis.zadd("foo", 1.0, "a");
1093      jedis.zadd("foo", 2.0, "b");
1094      jedis.zadd("bar", 1.0, "a");
1095      assertEquals(0, jedis.zdiffstore("bar3", "bar1", "bar2"));
1096      assertEquals(1, jedis.zdiffstore("bar3", "foo", "bar"));
1097      assertEquals(singletonList("b"), jedis.zrange("bar3", 0, -1));
1098      jedis.zadd(bfoo, 1.0, ba);
1099      jedis.zadd(bfoo, 2.0, bb);
1100      jedis.zadd(bbar, 1.0, ba);
1101      assertEquals(0, jedis.zdiffstore(bbar3, bbar1, bbar2));
1102      assertEquals(1, jedis.zdiffstore(bbar3, bfoo, bbar));
1103      List<byte[]> bactual = jedis.zrange(bbar3, 0, -1);
1104      assertArrayEquals(bb, bactual.iterator().next());
1105    }
1106    @Test
1107    public void zrandmember() {
1108      assertNull(jedis.zrandmember("foo"));
1109      assertEquals(Collections.emptyList(), jedis.zrandmember("foo", 1));
1110      assertEquals(Collections.emptyList(), jedis.zrandmemberWithScores("foo", 1));
1111      Map<String, Double> hash = new HashMap<>();
1112      hash.put("bar1", 1d);
1113      hash.put("bar2", 10d);
1114      hash.put("bar3", 0.1d);
1115      jedis.zadd("foo", hash);
1116      AssertUtil.assertCollectionContains(hash.keySet(), jedis.zrandmember("foo"));
1117      assertEquals(2, jedis.zrandmember("foo", 2).size());
1118      List<Tuple> actual = jedis.zrandmemberWithScores("foo", 2);
1119      assertEquals(2, actual.size());
1120      actual.forEach(t -> assertEquals(hash.get(t.getElement()), t.getScore(), 0d));
1121      assertNull(jedis.zrandmember(bfoo));
1122      assertEquals(Collections.emptyList(), jedis.zrandmember(bfoo, 1));
1123      assertEquals(Collections.emptyList(), jedis.zrandmemberWithScores(bfoo, 1));
1124      Map<byte[], Double> bhash = new HashMap<>();
1125      bhash.put(bbar1, 1d);
1126      bhash.put(bbar2, 10d);
1127      bhash.put(bbar3, 0.1d);
1128      jedis.zadd(bfoo, bhash);
1129      AssertUtil.assertByteArrayCollectionContains(bhash.keySet(), jedis.zrandmember(bfoo));
1130      assertEquals(2, jedis.zrandmember(bfoo, 2).size());
1131      List<Tuple> bactual = jedis.zrandmemberWithScores(bfoo, 2);
1132      assertEquals(2, bactual.size());
1133      bactual.forEach(t -> assertEquals(getScoreFromByteMap(bhash, t.getBinaryElement()), t.getScore(), 0d));
1134    }
1135    private Double getScoreFromByteMap(Map<byte[], Double> bhash, byte[] key) {
1136      for (Map.Entry<byte[], Double> en : bhash.entrySet()) {
1137        if (Arrays.equals(en.getKey(), key)) {
1138          return en.getValue();
1139        }
1140      }
1141      return null;
1142    }
1143    @Test
1144    public void zmpop() {
1145      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
1146      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
1147      jedis.zadd("foo", 0.1d, "c", ZAddParams.zAddParams().nx());
1148      jedis.zadd("foo", 2d, "a", ZAddParams.zAddParams().nx());
1149      KeyValue<String, List<Tuple>> single = jedis.zmpop(SortedSetOption.MAX, "foo");
1150      KeyValue<String, List<Tuple>> range = jedis.zmpop(SortedSetOption.MIN, 2, "foo");
1151      assertEquals(new Tuple("b", 10d), single.getValue().get(0));
1152      assertEquals(2, range.getValue().size());
1153      assertNull(jedis.zmpop(SortedSetOption.MAX, "foo"));
1154    }
1155    @Test
1156    public void bzmpopSimple() {
1157      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
1158      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
1159      jedis.zadd("foo", 0.1d, "c", ZAddParams.zAddParams().nx());
1160      jedis.zadd("foo", 2d, "a", ZAddParams.zAddParams().nx());
1161      KeyValue<String, List<Tuple>> single = jedis.bzmpop(1L, SortedSetOption.MAX, "foo");
1162      KeyValue<String, List<Tuple>> range = jedis.bzmpop(1L, SortedSetOption.MIN, 2, "foo");
1163      assertEquals(new Tuple("b", 10d), single.getValue().get(0));
1164      assertEquals(2, range.getValue().size());
1165      assertNull(jedis.bzmpop(1L, SortedSetOption.MAX, "foo"));
1166    }
1167  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SortedSetCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static java.util.Collections.singletonList;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START;
5  import static redis.clients.jedis.params.ScanParams.SCAN_POINTER_START_BINARY;
6  import static redis.clients.jedis.util.AssertUtil.assertByteArrayListEquals;
7  import java.util.*;
8  import org.junit.Test;
9  import redis.clients.jedis.args.SortedSetOption;
10  import redis.clients.jedis.params.*;
11  import redis.clients.jedis.resps.ScanResult;
12  import redis.clients.jedis.resps.Tuple;
13  import redis.clients.jedis.util.AssertUtil;
14  import redis.clients.jedis.util.KeyValue;
15  import redis.clients.jedis.util.SafeEncoder;
16  public class SortedSetCommandsTest extends JedisCommandsTestBase {
17    final byte[] bfoo = { 0x01, 0x02, 0x03, 0x04 };
18    final byte[] bbar = { 0x05, 0x06, 0x07, 0x08 };
19    final byte[] bcar = { 0x09, 0x0A, 0x0B, 0x0C };
20    final byte[] ba = { 0x0A };
21    final byte[] bb = { 0x0B };
22    final byte[] bc = { 0x0C };
23    final byte[] bInclusiveB = { 0x5B, 0x0B };
24    final byte[] bExclusiveC = { 0x28, 0x0C };
25    final byte[] bLexMinusInf = { 0x2D };
26    final byte[] bLexPlusInf = { 0x2B };
27    final byte[] bbar1 = { 0x05, 0x06, 0x07, 0x08, 0x0A };
28    final byte[] bbar2 = { 0x05, 0x06, 0x07, 0x08, 0x0B };
29    final byte[] bbar3 = { 0x05, 0x06, 0x07, 0x08, 0x0C };
30    final byte[] bbarstar = { 0x05, 0x06, 0x07, 0x08, '*' };
31    @Test
32    public void zadd() {
33      assertEquals(1, jedis.zadd("foo", 1d, "a"));
34      assertEquals(1, jedis.zadd("foo", 10d, "b"));
35      assertEquals(1, jedis.zadd("foo", 0.1d, "c"));
36      assertEquals(0, jedis.zadd("foo", 2d, "a"));
37      assertEquals(1, jedis.zadd(bfoo, 1d, ba));
38      assertEquals(1, jedis.zadd(bfoo, 10d, bb));
39      assertEquals(1, jedis.zadd(bfoo, 0.1d, bc));
40      assertEquals(0, jedis.zadd(bfoo, 2d, ba));
41    }
42    @Test
43    public void zaddWithParams() {
44      jedis.del("foo");
45      assertEquals(0L, jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().xx()));
46      jedis.zadd("foo", 1d, "a");
47      assertEquals(0L, jedis.zadd("foo", 2d, "a", ZAddParams.zAddParams().nx()));
48      assertEquals(Double.valueOf(1d), jedis.zscore("foo", "a"));
49      Map<String, Double> scoreMembers = new HashMap<String, Double>();
50      scoreMembers.put("a", 2d);
51      scoreMembers.put("b", 1d);
52      assertEquals(2L, jedis.zadd("foo", scoreMembers, ZAddParams.zAddParams().ch()));
53      jedis.zadd("foo", 3d, "a", ZAddParams.zAddParams().lt());
54      assertEquals(Double.valueOf(2d), jedis.zscore("foo", "a"));
55      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().lt());
56      assertEquals(Double.valueOf(1d), jedis.zscore("foo", "a"));
57      jedis.zadd("foo", 0d, "b", ZAddParams.zAddParams().gt());
58      assertEquals(Double.valueOf(1d), jedis.zscore("foo", "b"));
59      jedis.zadd("foo", 2d, "b", ZAddParams.zAddParams().gt());
60      assertEquals(Double.valueOf(2d), jedis.zscore("foo", "b"));
61      assertNull(jedis.zaddIncr("foo", 1d, "b", ZAddParams.zAddParams().nx()));
62      assertEquals(Double.valueOf(2d), jedis.zscore("foo", "b"));
63      assertEquals(Double.valueOf(3d), jedis.zaddIncr("foo", 1d,"b", ZAddParams.zAddParams().xx()));
64      assertEquals(Double.valueOf(3d), jedis.zscore("foo", "b"));
65      jedis.del(bfoo);
66      assertEquals(0L, jedis.zadd(bfoo, 1d, ba, ZAddParams.zAddParams().xx()));
67      jedis.zadd(bfoo, 1d, ba);
68      assertEquals(0L, jedis.zadd(bfoo, 2d, ba, ZAddParams.zAddParams().nx()));
69      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, ba));
70      Map<byte[], Double> binaryScoreMembers = new HashMap<byte[], Double>();
71      binaryScoreMembers.put(ba, 2d);
72      binaryScoreMembers.put(bb, 1d);
73      assertEquals(2L, jedis.zadd(bfoo, binaryScoreMembers, ZAddParams.zAddParams().ch()));
74      jedis.zadd(bfoo, 3d, ba, ZAddParams.zAddParams().lt());
75      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, ba));
76      jedis.zadd(bfoo, 1d, ba, ZAddParams.zAddParams().lt());
77      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, ba));
78      jedis.zadd(bfoo, 0d, bb, ZAddParams.zAddParams().gt());
79      assertEquals(Double.valueOf(1d), jedis.zscore(bfoo, bb));
80      jedis.zadd(bfoo, 2d, bb, ZAddParams.zAddParams().gt());
81      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, bb));
82      assertNull(jedis.zaddIncr(bfoo, 1d, bb, ZAddParams.zAddParams().nx()));
83      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, bb));
84      assertEquals(Double.valueOf(3d), jedis.zaddIncr(bfoo, 1d, bb, ZAddParams.zAddParams().xx()));
85      assertEquals(Double.valueOf(3d), jedis.zscore(bfoo, bb));
86    }
87    @Test
88    public void zrange() {
89      jedis.zadd("foo", 1d, "a");
90      jedis.zadd("foo", 10d, "b");
91      jedis.zadd("foo", 0.1d, "c");
92      jedis.zadd("foo", 2d, "a");
93      List<String> expected = new ArrayList<String>();
94      expected.add("c");
95      expected.add("a");
96      List<String> range = jedis.zrange("foo", 0, 1);
97      assertEquals(expected, range);
98      expected.add("b");
99      range = jedis.zrange("foo", 0, 100);
100      assertEquals(expected, range);
101      jedis.zadd(bfoo, 1d, ba);
102      jedis.zadd(bfoo, 10d, bb);
103      jedis.zadd(bfoo, 0.1d, bc);
104      jedis.zadd(bfoo, 2d, ba);
105      List<byte[]> bexpected = new ArrayList<byte[]>();
106      bexpected.add(bc);
107      bexpected.add(ba);
108      List<byte[]> brange = jedis.zrange(bfoo, 0, 1);
109      assertByteArrayListEquals(bexpected, brange);
110      bexpected.add(bb);
111      brange = jedis.zrange(bfoo, 0, 100);
112      assertByteArrayListEquals(bexpected, brange);
113    }
114    @Test
115    public void zrangeByLex() {
116      jedis.zadd("foo", 1, "aa");
117      jedis.zadd("foo", 1, "c");
118      jedis.zadd("foo", 1, "bb");
119      jedis.zadd("foo", 1, "d");
120      List<String> expected = new ArrayList<String>();
121      expected.add("bb");
122      expected.add("c");
123      assertEquals(expected, jedis.zrangeByLex("foo", "(aa", "[c"));
124      expected.clear();
125      expected.add("bb");
126      expected.add("c");
127      assertEquals(expected, jedis.zrangeByLex("foo", "-", "+", 1, 2));
128    }
129    @Test
130    public void zrangeByLexBinary() {
131      jedis.zadd(bfoo, 1, ba);
132      jedis.zadd(bfoo, 1, bc);
133      jedis.zadd(bfoo, 1, bb);
134      List<byte[]> bExpected = new ArrayList<byte[]>();
135      bExpected.add(bb);
136      assertByteArrayListEquals(bExpected, jedis.zrangeByLex(bfoo, bInclusiveB, bExclusiveC));
137      bExpected.clear();
138      bExpected.add(ba);
139      bExpected.add(bb);
140      assertByteArrayListEquals(bExpected, jedis.zrangeByLex(bfoo, bLexMinusInf, bLexPlusInf, 0, 2));
141    }
142    @Test
143    public void zrevrangeByLex() {
144      jedis.zadd("foo", 1, "aa");
145      jedis.zadd("foo", 1, "c");
146      jedis.zadd("foo", 1, "bb");
147      jedis.zadd("foo", 1, "d");
148      List<String> expected = new ArrayList<String>();
149      expected.add("c");
150      expected.add("bb");
151      assertEquals(expected, jedis.zrevrangeByLex("foo", "[c", "(aa"));
152      expected.clear();
153      expected.add("c");
154      expected.add("bb");
155      assertEquals(expected, jedis.zrevrangeByLex("foo", "+", "-", 1, 2));
156    }
157    @Test
158    public void zrevrangeByLexBinary() {
159      jedis.zadd(bfoo, 1, ba);
160      jedis.zadd(bfoo, 1, bc);
161      jedis.zadd(bfoo, 1, bb);
162      List<byte[]> bExpected = new ArrayList<byte[]>();
163      bExpected.add(bb);
164      assertByteArrayListEquals(bExpected, jedis.zrevrangeByLex(bfoo, bExclusiveC, bInclusiveB));
165      bExpected.clear();
166      bExpected.add(bc);
167      bExpected.add(bb);
168      assertByteArrayListEquals(bExpected, jedis.zrevrangeByLex(bfoo, bLexPlusInf, bLexMinusInf, 0, 2));
169    }
170    @Test
171    public void zrevrange() {
172      jedis.zadd("foo", 1d, "a");
173      jedis.zadd("foo", 10d, "b");
174      jedis.zadd("foo", 0.1d, "c");
175      jedis.zadd("foo", 2d, "a");
176      List<String> expected = new ArrayList<String>();
177      expected.add("b");
178      expected.add("a");
179      List<String> range = jedis.zrevrange("foo", 0, 1);
180      assertEquals(expected, range);
181      expected.add("c");
182      range = jedis.zrevrange("foo", 0, 100);
183      assertEquals(expected, range);
184      jedis.zadd(bfoo, 1d, ba);
185      jedis.zadd(bfoo, 10d, bb);
186      jedis.zadd(bfoo, 0.1d, bc);
187      jedis.zadd(bfoo, 2d, ba);
188      List<byte[]> bexpected = new ArrayList<byte[]>();
189      bexpected.add(bb);
190      bexpected.add(ba);
191      List<byte[]> brange = jedis.zrevrange(bfoo, 0, 1);
192      assertByteArrayListEquals(bexpected, brange);
193      bexpected.add(bc);
194      brange = jedis.zrevrange(bfoo, 0, 100);
195      assertByteArrayListEquals(bexpected, brange);
196    }
197    @Test
198    public void zrem() {
199      jedis.zadd("foo", 1d, "a");
200      jedis.zadd("foo", 2d, "b");
201      assertEquals(1, jedis.zrem("foo", "a"));
202      List<String> expected = new ArrayList<String>();
203      expected.add("b");
204      assertEquals(expected, jedis.zrange("foo", 0, 100));
205      assertEquals(0, jedis.zrem("foo", "bar"));
206      jedis.zadd(bfoo, 1d, ba);
207      jedis.zadd(bfoo, 2d, bb);
208      assertEquals(1, jedis.zrem(bfoo, ba));
209      List<byte[]> bexpected = new ArrayList<byte[]>();
210      bexpected.add(bb);
211      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
212      assertEquals(0, jedis.zrem(bfoo, bbar));
213    }
214    @Test
215    public void zincrby() {
216      jedis.zadd("foo", 1d, "a");
217      jedis.zadd("foo", 2d, "b");
218      assertEquals(3d, jedis.zincrby("foo", 2d, "a"), 0);
219      List<String> expected = new ArrayList<String>();
220      expected.add("b");
221      expected.add("a");
222      assertEquals(expected, jedis.zrange("foo", 0, 100));
223      jedis.zadd(bfoo, 1d, ba);
224      jedis.zadd(bfoo, 2d, bb);
225      assertEquals(3d, jedis.zincrby(bfoo, 2d, ba), 0);
226      List<byte[]> bexpected = new ArrayList<byte[]>();
227      bexpected.add(bb);
228      bexpected.add(ba);
229      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
230    }
231    @Test
232    public void zincrbyWithParams() {
233      jedis.del("foo");
234      assertNull(jedis.zincrby("foo", 2d, "a", ZIncrByParams.zIncrByParams().xx()));
235      jedis.zadd("foo", 2d, "a");
236      assertNull(jedis.zincrby("foo", 1d, "a", ZIncrByParams.zIncrByParams().nx()));
237      assertEquals(Double.valueOf(2d), jedis.zscore("foo", "a"));
238      jedis.del(bfoo);
239      assertNull(jedis.zincrby(bfoo, 2d, ba, ZIncrByParams.zIncrByParams().xx()));
240      jedis.zadd(bfoo, 2d, ba);
241      assertNull(jedis.zincrby(bfoo, 1d, ba, ZIncrByParams.zIncrByParams().nx()));
242      assertEquals(Double.valueOf(2d), jedis.zscore(bfoo, ba));
243    }
244    @Test
245    public void zrank() {
246      jedis.zadd("foo", 1d, "a");
247      jedis.zadd("foo", 2d, "b");
248      long rank = jedis.zrank("foo", "a");
249      assertEquals(0, rank);
250      rank = jedis.zrank("foo", "b");
251      assertEquals(1, rank);
252      assertNull(jedis.zrank("car", "b"));
253      jedis.zadd(bfoo, 1d, ba);
254      jedis.zadd(bfoo, 2d, bb);
255      long brank = jedis.zrank(bfoo, ba);
256      assertEquals(0, brank);
257      brank = jedis.zrank(bfoo, bb);
258      assertEquals(1, brank);
259      assertNull(jedis.zrank(bcar, bb));
260    }
261    @Test
262    public void zrankWithScore() {
263      jedis.zadd("foo", 1d, "a");
264      jedis.zadd("foo", 2d, "b");
265      KeyValue<Long, Double> keyValue = jedis.zrankWithScore("foo", "a");
266      assertEquals(Long.valueOf(0), keyValue.getKey());
267      assertEquals(Double.valueOf(1d), keyValue.getValue());
268      keyValue = jedis.zrankWithScore("foo", "b");
269      assertEquals(Long.valueOf(1), keyValue.getKey());
270      assertEquals(Double.valueOf(2d), keyValue.getValue());
271      assertNull(jedis.zrankWithScore("car", "b"));
272      jedis.zadd(bfoo, 1d, ba);
273      jedis.zadd(bfoo, 2d, bb);
274      keyValue = jedis.zrankWithScore(bfoo, ba);
275      assertEquals(Long.valueOf(0), keyValue.getKey());
276      assertEquals(Double.valueOf(1d), keyValue.getValue());
277      keyValue = jedis.zrankWithScore(bfoo, bb);
278      assertEquals(Long.valueOf(1), keyValue.getKey());
279      assertEquals(Double.valueOf(2d), keyValue.getValue());
280      assertNull(jedis.zrankWithScore(bcar, bb));
281    }
282    @Test
283    public void zrevrank() {
284      jedis.zadd("foo", 1d, "a");
285      jedis.zadd("foo", 2d, "b");
286      long rank = jedis.zrevrank("foo", "a");
287      assertEquals(1, rank);
288      rank = jedis.zrevrank("foo", "b");
289      assertEquals(0, rank);
290      jedis.zadd(bfoo, 1d, ba);
291      jedis.zadd(bfoo, 2d, bb);
292      long brank = jedis.zrevrank(bfoo, ba);
293      assertEquals(1, brank);
294      brank = jedis.zrevrank(bfoo, bb);
295      assertEquals(0, brank);
296    }
297    @Test
298    public void zrangeWithScores() {
299      jedis.zadd("foo", 1d, "a");
300      jedis.zadd("foo", 10d, "b");
301      jedis.zadd("foo", 0.1d, "c");
302      jedis.zadd("foo", 2d, "a");
303      List<Tuple> expected = new ArrayList<Tuple>();
304      expected.add(new Tuple("c", 0.1d));
305      expected.add(new Tuple("a", 2d));
306      List<Tuple> range = jedis.zrangeWithScores("foo", 0, 1);
307      assertEquals(expected, range);
308      expected.add(new Tuple("b", 10d));
309      range = jedis.zrangeWithScores("foo", 0, 100);
310      assertEquals(expected, range);
311      jedis.zadd(bfoo, 1d, ba);
312      jedis.zadd(bfoo, 10d, bb);
313      jedis.zadd(bfoo, 0.1d, bc);
314      jedis.zadd(bfoo, 2d, ba);
315      List<Tuple> bexpected = new ArrayList<Tuple>();
316      bexpected.add(new Tuple(bc, 0.1d));
317      bexpected.add(new Tuple(ba, 2d));
318      List<Tuple> brange = jedis.zrangeWithScores(bfoo, 0, 1);
319      assertEquals(bexpected, brange);
320      bexpected.add(new Tuple(bb, 10d));
321      brange = jedis.zrangeWithScores(bfoo, 0, 100);
322      assertEquals(bexpected, brange);
323    }
324    @Test
325    public void zrevrangeWithScores() {
326      jedis.zadd("foo", 1d, "a");
327      jedis.zadd("foo", 10d, "b");
328      jedis.zadd("foo", 0.1d, "c");
329      jedis.zadd("foo", 2d, "a");
330      List<Tuple> expected = new ArrayList<Tuple>();
331      expected.add(new Tuple("b", 10d));
332      expected.add(new Tuple("a", 2d));
333      List<Tuple> range = jedis.zrevrangeWithScores("foo", 0, 1);
334      assertEquals(expected, range);
335      expected.add(new Tuple("c", 0.1d));
336      range = jedis.zrevrangeWithScores("foo", 0, 100);
337      assertEquals(expected, range);
338      jedis.zadd(bfoo, 1d, ba);
339      jedis.zadd(bfoo, 10d, bb);
340      jedis.zadd(bfoo, 0.1d, bc);
341      jedis.zadd(bfoo, 2d, ba);
342      List<Tuple> bexpected = new ArrayList<Tuple>();
343      bexpected.add(new Tuple(bb, 10d));
344      bexpected.add(new Tuple(ba, 2d));
345      List<Tuple> brange = jedis.zrevrangeWithScores(bfoo, 0, 1);
346      assertEquals(bexpected, brange);
347      bexpected.add(new Tuple(bc, 0.1d));
348      brange = jedis.zrevrangeWithScores(bfoo, 0, 100);
349      assertEquals(bexpected, brange);
350    }
351    @Test
352    public void zcard() {
353      jedis.zadd("foo", 1d, "a");
354      jedis.zadd("foo", 10d, "b");
355      jedis.zadd("foo", 0.1d, "c");
356      jedis.zadd("foo", 2d, "a");
357      assertEquals(3, jedis.zcard("foo"));
358      jedis.zadd(bfoo, 1d, ba);
359      jedis.zadd(bfoo, 10d, bb);
360      jedis.zadd(bfoo, 0.1d, bc);
361      jedis.zadd(bfoo, 2d, ba);
362      assertEquals(3, jedis.zcard(bfoo));
363    }
364    @Test
365    public void zscore() {
366      jedis.zadd("foo", 1d, "a");
367      jedis.zadd("foo", 10d, "b");
368      jedis.zadd("foo", 0.1d, "c");
369      jedis.zadd("foo", 2d, "a");
370      assertEquals((Double) 10d, jedis.zscore("foo", "b"));
371      assertEquals((Double) 0.1d, jedis.zscore("foo", "c"));
372      assertNull(jedis.zscore("foo", "s"));
373      jedis.zadd(bfoo, 1d, ba);
374      jedis.zadd(bfoo, 10d, bb);
375      jedis.zadd(bfoo, 0.1d, bc);
376      jedis.zadd(bfoo, 2d, ba);
377      assertEquals((Double) 10d, jedis.zscore(bfoo, bb));
378      assertEquals((Double) 0.1d, jedis.zscore(bfoo, bc));
379      assertNull(jedis.zscore(bfoo, SafeEncoder.encode("s")));
380    }
381    @Test
382    public void zmscore() {
383      jedis.zadd("foo", 1d, "a");
384      jedis.zadd("foo", 10d, "b");
385      jedis.zadd("foo", 0.1d, "c");
386      jedis.zadd("foo", 2d, "a");
387      assertEquals(Arrays.asList(10d, 0.1d, null), jedis.zmscore("foo", "b", "c", "s"));
388      jedis.zadd(bfoo, 1d, ba);
389      jedis.zadd(bfoo, 10d, bb);
390      jedis.zadd(bfoo, 0.1d, bc);
391      jedis.zadd(bfoo, 2d, ba);
392      assertEquals(Arrays.asList(10d, 0.1d, null),
393        jedis.zmscore(bfoo, bb, bc, SafeEncoder.encode("s")));
394    }
395    @Test
396    public void zpopmax() {
397      jedis.zadd("foo", 1d, "a");
398      jedis.zadd("foo", 10d, "b");
399      jedis.zadd("foo", 0.1d, "c");
400      jedis.zadd("foo", 2d, "d");
401      Tuple actual = jedis.zpopmax("foo");
402      Tuple expected = new Tuple("b", 10d);
403      assertEquals(expected, actual);
404      actual = jedis.zpopmax("foo");
405      expected = new Tuple("d", 2d);
406      assertEquals(expected, actual);
407      actual = jedis.zpopmax("foo");
408      expected = new Tuple("a", 1d);
409      assertEquals(expected, actual);
410      actual = jedis.zpopmax("foo");
411      expected = new Tuple("c", 0.1d);
412      assertEquals(expected, actual);
413      actual = jedis.zpopmax("foo");
414      assertNull(actual);
415      jedis.zadd(bfoo, 1d, ba);
416      jedis.zadd(bfoo, 10d, bb);
417      jedis.zadd(bfoo, 0.1d, bc);
418      jedis.zadd(bfoo, 2d, ba);
419      actual = jedis.zpopmax(bfoo);
420      expected = new Tuple(bb, 10d);
421      assertEquals(expected, actual);
422      actual = jedis.zpopmax(bfoo);
423      expected = new Tuple(ba, 2d);
424      assertEquals(expected, actual);
425      actual = jedis.zpopmax(bfoo);
426      expected = new Tuple(bc, 0.1d);
427      assertEquals(expected, actual);
428      actual = jedis.zpopmax(bfoo);
429      assertNull(actual);
430    }
431    @Test
432    public void zpopmaxWithCount() {
433      jedis.zadd("foo", 1d, "a");
434      jedis.zadd("foo", 10d, "b");
435      jedis.zadd("foo", 0.1d, "c");
436      jedis.zadd("foo", 2d, "d");
437      jedis.zadd("foo", 0.03, "e");
438      List<Tuple> actual = jedis.zpopmax("foo", 2);
439      assertEquals(2, actual.size());
440      List<Tuple> expected = new ArrayList<Tuple>();
441      expected.add(new Tuple("b", 10d));
442      expected.add(new Tuple("d", 2d));
443      assertEquals(expected, actual);
444      actual = jedis.zpopmax("foo", 3);
445      assertEquals(3, actual.size());
446      expected.clear();
447      expected.add(new Tuple("a", 1d));
448      expected.add(new Tuple("c", 0.1d));
449      expected.add(new Tuple("e", 0.03d));
450      assertEquals(expected, actual);
451      actual = jedis.zpopmax("foo", 1);
452      expected.clear();
453      assertEquals(expected, actual);
454      jedis.zadd(bfoo, 1d, ba);
455      jedis.zadd(bfoo, 10d, bb);
456      jedis.zadd(bfoo, 0.1d, bc);
457      jedis.zadd(bfoo, 2d, ba);
458      actual = jedis.zpopmax(bfoo, 1);
459      expected.clear();
460      expected.add(new Tuple(bb, 10d));
461      assertEquals(expected, actual);
462      actual = jedis.zpopmax(bfoo, 1);
463      expected.clear();
464      expected.add(new Tuple(ba, 2d));
465      assertEquals(expected, actual);
466      actual = jedis.zpopmax(bfoo, 1);
467      expected.clear();
468      expected.add(new Tuple(bc, 0.1d));
469      assertEquals(expected, actual);
470      actual = jedis.zpopmax(bfoo, 1);
471      expected.clear();
472      assertEquals(expected, actual);
473    }
474    @Test
475    public void zpopmin() {
476      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
477      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
478      jedis.zadd("foo", 0.1d, "c", ZAddParams.zAddParams().nx());
479      jedis.zadd("foo", 2d, "a", ZAddParams.zAddParams().nx());
480      List<Tuple> range = jedis.zpopmin("foo", 2);
481      List<Tuple> expected = new ArrayList<Tuple>();
482      expected.add(new Tuple("c", 0.1d));
483      expected.add(new Tuple("a", 1d));
484      assertEquals(expected, range);
485      assertEquals(new Tuple("b", 10d), jedis.zpopmin("foo"));
486      jedis.zadd(bfoo, 1d, ba);
487      jedis.zadd(bfoo, 10d, bb);
488      jedis.zadd(bfoo, 0.1d, bc);
489      jedis.zadd(bfoo, 2d, ba);
490      List<Tuple> brange = jedis.zpopmin(bfoo, 2);
491      List<Tuple> bexpected = new ArrayList<Tuple>();
492      bexpected.add(new Tuple(bc, 0.1d));
493      bexpected.add(new Tuple(ba, 2d));
494      assertEquals(bexpected, brange);
495      assertEquals(new Tuple(bb, 10d), jedis.zpopmin(bfoo));
496    }
497    @Test
498    public void zcount() {
499      jedis.zadd("foo", 1d, "a");
500      jedis.zadd("foo", 10d, "b");
501      jedis.zadd("foo", 0.1d, "c");
502      jedis.zadd("foo", 2d, "a");
503      assertEquals(2, jedis.zcount("foo", 0.01d, 2.1d));
504      assertEquals(3, jedis.zcount("foo", "(0.01", "+inf"));
505      jedis.zadd(bfoo, 1d, ba);
506      jedis.zadd(bfoo, 10d, bb);
507      jedis.zadd(bfoo, 0.1d, bc);
508      jedis.zadd(bfoo, 2d, ba);
509      assertEquals(2, jedis.zcount(bfoo, 0.01d, 2.1d));
510      assertEquals(3, jedis.zcount(bfoo, SafeEncoder.encode("(0.01"), SafeEncoder.encode("+inf")));
511    }
512    @Test
513    public void zlexcount() {
514      jedis.zadd("foo", 1, "a");
515      jedis.zadd("foo", 1, "b");
516      jedis.zadd("foo", 1, "c");
517      jedis.zadd("foo", 1, "aa");
518      assertEquals(2, jedis.zlexcount("foo", "[aa", "(c"));
519      assertEquals(4, jedis.zlexcount("foo", "-", "+"));
520      assertEquals(3, jedis.zlexcount("foo", "-", "(c"));
521      assertEquals(3, jedis.zlexcount("foo", "[aa", "+"));
522    }
523    @Test
524    public void zlexcountBinary() {
525      jedis.zadd(bfoo, 1, ba);
526      jedis.zadd(bfoo, 1, bc);
527      jedis.zadd(bfoo, 1, bb);
528      assertEquals(1, jedis.zlexcount(bfoo, bInclusiveB, bExclusiveC));
529      assertEquals(3, jedis.zlexcount(bfoo, bLexMinusInf, bLexPlusInf));
530    }
531    @Test
532    public void zrangebyscore() {
533      jedis.zadd("foo", 1d, "a");
534      jedis.zadd("foo", 10d, "b");
535      jedis.zadd("foo", 0.1d, "c");
536      jedis.zadd("foo", 2d, "a");
537      List<String> range = jedis.zrangeByScore("foo", 0d, 2d);
538      List<String> expected = new ArrayList<String>();
539      expected.add("c");
540      expected.add("a");
541      assertEquals(expected, range);
542      range = jedis.zrangeByScore("foo", 0d, 2d, 0, 1);
543      expected = new ArrayList<String>();
544      expected.add("c");
545      assertEquals(expected, range);
546      range = jedis.zrangeByScore("foo", 0d, 2d, 1, 1);
547      List<String> range2 = jedis.zrangeByScore("foo", "-inf", "(2");
548      assertEquals(expected, range2);
549      expected = new ArrayList<String>();
550      expected.add("a");
551      assertEquals(expected, range);
552      jedis.zadd(bfoo, 1d, ba);
553      jedis.zadd(bfoo, 10d, bb);
554      jedis.zadd(bfoo, 0.1d, bc);
555      jedis.zadd(bfoo, 2d, ba);
556      List<byte[]> brange = jedis.zrangeByScore(bfoo, 0d, 2d);
557      List<byte[]> bexpected = new ArrayList<byte[]>();
558      bexpected.add(bc);
559      bexpected.add(ba);
560      assertByteArrayListEquals(bexpected, brange);
561      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 0, 1);
562      bexpected = new ArrayList<byte[]>();
563      bexpected.add(bc);
564      assertByteArrayListEquals(bexpected, brange);
565      brange = jedis.zrangeByScore(bfoo, 0d, 2d, 1, 1);
566      List<byte[]> brange2 = jedis.zrangeByScore(bfoo, SafeEncoder.encode("-inf"),
567        SafeEncoder.encode("(2"));
568      assertByteArrayListEquals(bexpected, brange2);
569      bexpected = new ArrayList<byte[]>();
570      bexpected.add(ba);
<span onclick='openModal()' class='match'>571      assertByteArrayListEquals(bexpected, brange);
572    }
573    @Test
574    public void zrevrangebyscore() {
575      jedis.zadd("foo", 1.0d, "a");
</span>576      jedis.zadd("foo", 2.0d, "b");
577      jedis.zadd("foo", 3.0d, "c");
578      jedis.zadd("foo", 4.0d, "d");
579      jedis.zadd("foo", 5.0d, "e");
580      List<String> range = jedis.zrevrangeByScore("foo", 3d, Double.NEGATIVE_INFINITY, 0, 1);
581      List<String> expected = new ArrayList<String>();
582      expected.add("c");
583      assertEquals(expected, range);
584      range = jedis.zrevrangeByScore("foo", 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
585      expected = new ArrayList<String>();
586      expected.add("c");
587      expected.add("b");
588      assertEquals(expected, range);
589      range = jedis.zrevrangeByScore("foo", 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
590      expected = new ArrayList<String>();
591      expected.add("b");
592      assertEquals(expected, range);
593      range = jedis.zrevrangeByScore("foo", 4d, 2d);
594      expected = new ArrayList<String>();
595      expected.add("d");
596      expected.add("c");
597      expected.add("b");
598      assertEquals(expected, range);
599      range = jedis.zrevrangeByScore("foo", "4", "2", 0, 2);
600      expected = new ArrayList<String>();
601      expected.add("d");
602      expected.add("c");
603      assertEquals(expected, range);
604      range = jedis.zrevrangeByScore("foo", "+inf", "(4");
605      expected = new ArrayList<String>();
606      expected.add("e");
607      assertEquals(expected, range);
608      jedis.zadd(bfoo, 1d, ba);
609      jedis.zadd(bfoo, 10d, bb);
610      jedis.zadd(bfoo, 0.1d, bc);
611      jedis.zadd(bfoo, 2d, ba);
612      List<byte[]> brange = jedis.zrevrangeByScore(bfoo, 2d, 0d);
613      List<byte[]> bexpected = new ArrayList<byte[]>();
614      bexpected.add(ba);
615      bexpected.add(bc);
616      assertByteArrayListEquals(bexpected, brange);
617      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 0, 1);
618      bexpected = new ArrayList<byte[]>();
619      bexpected.add(ba);
620      assertByteArrayListEquals(bexpected, brange);
621      List<byte[]> brange2 = jedis.zrevrangeByScore(bfoo, SafeEncoder.encode("+inf"),
622        SafeEncoder.encode("(2"));
623      bexpected = new ArrayList<byte[]>();
624      bexpected.add(bb);
625      assertByteArrayListEquals(bexpected, brange2);
626      brange = jedis.zrevrangeByScore(bfoo, 2d, 0d, 1, 1);
627      bexpected = new ArrayList<byte[]>();
628      bexpected.add(bc);
629      assertByteArrayListEquals(bexpected, brange);
630    }
631    @Test
632    public void zrangebyscoreWithScores() {
633      jedis.zadd("foo", 1d, "a");
634      jedis.zadd("foo", 10d, "b");
635      jedis.zadd("foo", 0.1d, "c");
636      jedis.zadd("foo", 2d, "a");
637      List<Tuple> range = jedis.zrangeByScoreWithScores("foo", 0d, 2d);
638      List<Tuple> expected = new ArrayList<Tuple>();
639      expected.add(new Tuple("c", 0.1d));
640      expected.add(new Tuple("a", 2d));
641      assertEquals(expected, range);
642      range = jedis.zrangeByScoreWithScores("foo", 0d, 2d, 0, 1);
643      expected = new ArrayList<Tuple>();
644      expected.add(new Tuple("c", 0.1d));
645      assertEquals(expected, range);
646      range = jedis.zrangeByScoreWithScores("foo", 0d, 2d, 1, 1);
647      expected = new ArrayList<Tuple>();
648      expected.add(new Tuple("a", 2d));
649      assertEquals(expected, range);
650      jedis.zadd(bfoo, 1d, ba);
651      jedis.zadd(bfoo, 10d, bb);
652      jedis.zadd(bfoo, 0.1d, bc);
653      jedis.zadd(bfoo, 2d, ba);
654      List<Tuple> brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d);
655      List<Tuple> bexpected = new ArrayList<Tuple>();
656      bexpected.add(new Tuple(bc, 0.1d));
657      bexpected.add(new Tuple(ba, 2d));
658      assertEquals(bexpected, brange);
659      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 0, 1);
660      bexpected = new ArrayList<Tuple>();
661      bexpected.add(new Tuple(bc, 0.1d));
662      assertEquals(bexpected, brange);
663      brange = jedis.zrangeByScoreWithScores(bfoo, 0d, 2d, 1, 1);
664      bexpected = new ArrayList<Tuple>();
665      bexpected.add(new Tuple(ba, 2d));
666      assertEquals(bexpected, brange);
667    }
668    @Test
669    public void zrangeParams() {
670      jedis.zadd("foo", 1, "aa");
671      jedis.zadd("foo", 1, "c");
672      jedis.zadd("foo", 1, "bb");
673      jedis.zadd("foo", 1, "d");
674      List<String> expected = new ArrayList<String>();
675      expected.add("c");
676      expected.add("bb");
677      assertEquals(expected, jedis.zrange("foo", ZRangeParams.zrangeByLexParams("[c", "(aa").rev()));
678      assertNotNull(jedis.zrangeWithScores("foo", ZRangeParams.zrangeByScoreParams(0, 1)));
679      jedis.zadd(bfoo, 1, ba);
680      jedis.zadd(bfoo, 1, bc);
681      jedis.zadd(bfoo, 1, bb);
682      List<byte[]> bExpected = new ArrayList<byte[]>();
683      bExpected.add(bb);
684      assertByteArrayListEquals(bExpected, jedis.zrange(bfoo, ZRangeParams.zrangeByLexParams(bExclusiveC, bInclusiveB).rev()));
685      assertNotNull(jedis.zrangeWithScores(bfoo, ZRangeParams.zrangeByScoreParams(0, 1).limit(0, 3)));
686    }
687    @Test
688    public void zrangestore() {
689      jedis.zadd("foo", 1, "aa");
690      jedis.zadd("foo", 2, "c");
691      jedis.zadd("foo", 3, "bb");
692      long stored = jedis.zrangestore("bar", "foo", ZRangeParams.zrangeByScoreParams(1, 2));
693      assertEquals(2, stored);
694      List<String> range = jedis.zrange("bar", 0, -1);
695      List<String> expected = new ArrayList<>();
696      expected.add("aa");
697      expected.add("c");
698      assertEquals(expected, range);
699      jedis.zadd(bfoo, 1d, ba);
700      jedis.zadd(bfoo, 10d, bb);
701      jedis.zadd(bfoo, 0.1d, bc);
702      jedis.zadd(bfoo, 2d, ba);
703      long bstored = jedis.zrangestore(bbar, bfoo, ZRangeParams.zrangeParams(0, 1).rev());
704      assertEquals(2, bstored);
705      List<byte[]> brange = jedis.zrevrange(bbar, 0, 1);
706      List<byte[]> bexpected = new ArrayList<>();
707      bexpected.add(bb);
708      bexpected.add(ba);
709      assertByteArrayListEquals(bexpected, brange);
710    }
711    @Test
712    public void zrevrangebyscoreWithScores() {
713      jedis.zadd("foo", 1.0d, "a");
714      jedis.zadd("foo", 2.0d, "b");
715      jedis.zadd("foo", 3.0d, "c");
716      jedis.zadd("foo", 4.0d, "d");
717      jedis.zadd("foo", 5.0d, "e");
718      List<Tuple> range = jedis.zrevrangeByScoreWithScores("foo", 3d, Double.NEGATIVE_INFINITY, 0, 1);
719      List<Tuple> expected = new ArrayList<Tuple>();
720      expected.add(new Tuple("c", 3.0d));
721      assertEquals(expected, range);
722      range = jedis.zrevrangeByScoreWithScores("foo", 3.5d, Double.NEGATIVE_INFINITY, 0, 2);
723      expected = new ArrayList<Tuple>();
724      expected.add(new Tuple("c", 3.0d));
725      expected.add(new Tuple("b", 2.0d));
726      assertEquals(expected, range);
727      range = jedis.zrevrangeByScoreWithScores("foo", 3.5d, Double.NEGATIVE_INFINITY, 1, 1);
728      expected = new ArrayList<Tuple>();
729      expected.add(new Tuple("b", 2.0d));
730      assertEquals(expected, range);
731      range = jedis.zrevrangeByScoreWithScores("foo", 4d, 2d);
732      expected = new ArrayList<Tuple>();
733      expected.add(new Tuple("d", 4.0d));
734      expected.add(new Tuple("c", 3.0d));
735      expected.add(new Tuple("b", 2.0d));
736      assertEquals(expected, range);
737      jedis.zadd(bfoo, 1d, ba);
738      jedis.zadd(bfoo, 10d, bb);
739      jedis.zadd(bfoo, 0.1d, bc);
740      jedis.zadd(bfoo, 2d, ba);
741      List<Tuple> brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d);
742      List<Tuple> bexpected = new ArrayList<Tuple>();
743      bexpected.add(new Tuple(ba, 2d));
744      bexpected.add(new Tuple(bc, 0.1d));
745      assertEquals(bexpected, brange);
746      brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d, 0, 1);
747      bexpected = new ArrayList<Tuple>();
748      bexpected.add(new Tuple(ba, 2d));
749      assertEquals(bexpected, brange);
750      brange = jedis.zrevrangeByScoreWithScores(bfoo, 2d, 0d, 1, 1);
751      bexpected = new ArrayList<Tuple>();
752      bexpected.add(new Tuple(bc, 0.1d));
753      assertEquals(bexpected, brange);
754    }
755    @Test
756    public void zremrangeByRank() {
757      jedis.zadd("foo", 1d, "a");
758      jedis.zadd("foo", 10d, "b");
759      jedis.zadd("foo", 0.1d, "c");
760      jedis.zadd("foo", 2d, "a");
761      assertEquals(1, jedis.zremrangeByRank("foo", 0, 0));
762      List<String> expected = new ArrayList<String>();
763      expected.add("a");
764      expected.add("b");
765      assertEquals(expected, jedis.zrange("foo", 0, 100));
766      jedis.zadd(bfoo, 1d, ba);
767      jedis.zadd(bfoo, 10d, bb);
768      jedis.zadd(bfoo, 0.1d, bc);
769      jedis.zadd(bfoo, 2d, ba);
770      assertEquals(1, jedis.zremrangeByRank(bfoo, 0, 0));
771      List<byte[]> bexpected = new ArrayList<byte[]>();
772      bexpected.add(ba);
773      bexpected.add(bb);
774      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
775    }
776    @Test
777    public void zremrangeByScore() {
778      jedis.zadd("foo", 1d, "a");
779      jedis.zadd("foo", 10d, "b");
780      jedis.zadd("foo", 0.1d, "c");
781      jedis.zadd("foo", 2d, "a");
782      assertEquals(2, jedis.zremrangeByScore("foo", 0, 2));
783      List<String> expected = new ArrayList<String>();
784      expected.add("b");
785      assertEquals(expected, jedis.zrange("foo", 0, 100));
786      jedis.zadd(bfoo, 1d, ba);
787      jedis.zadd(bfoo, 10d, bb);
788      jedis.zadd(bfoo, 0.1d, bc);
789      jedis.zadd(bfoo, 2d, ba);
790      assertEquals(2, jedis.zremrangeByScore(bfoo, 0, 2));
791      List<byte[]> bexpected = new ArrayList<byte[]>();
792      bexpected.add(bb);
793      assertByteArrayListEquals(bexpected, jedis.zrange(bfoo, 0, 100));
794    }
795    @Test
796    public void zremrangeByScoreExclusive() {
797      jedis.zadd("foo", 1d, "a");
798      jedis.zadd("foo", 0d, "c");
799      jedis.zadd("foo", 2d, "b");
800      assertEquals(1, jedis.zremrangeByScore("foo", "(0", "(2"));
801      jedis.zadd(bfoo, 1d, ba);
802      jedis.zadd(bfoo, 0d, bc);
803      jedis.zadd(bfoo, 2d, bb);
804      assertEquals(1, jedis.zremrangeByScore(bfoo, "(0".getBytes(), "(2".getBytes()));
805    }
806    @Test
807    public void zremrangeByLex() {
808      jedis.zadd("foo", 1, "a");
809      jedis.zadd("foo", 1, "b");
810      jedis.zadd("foo", 1, "c");
811      jedis.zadd("foo", 1, "aa");
812      assertEquals(2, jedis.zremrangeByLex("foo", "[aa", "(c"));
813      List<String> expected = new ArrayList<String>();
814      expected.add("a");
815      expected.add("c");
816      assertEquals(expected, jedis.zrangeByLex("foo", "-", "+"));
817    }
818    @Test
819    public void zremrangeByLexBinary() {
820      jedis.zadd(bfoo, 1, ba);
821      jedis.zadd(bfoo, 1, bc);
822      jedis.zadd(bfoo, 1, bb);
823      assertEquals(1, jedis.zremrangeByLex(bfoo, bInclusiveB, bExclusiveC));
824      List<byte[]> bexpected = new ArrayList<byte[]>();
825      bexpected.add(ba);
826      bexpected.add(bc);
827      assertByteArrayListEquals(bexpected, jedis.zrangeByLex(bfoo, bLexMinusInf, bLexPlusInf));
828    }
829    @Test
830    public void zunion() {
831      jedis.zadd("foo", 1, "a");
832      jedis.zadd("foo", 2, "b");
833      jedis.zadd("bar", 2, "a");
834      jedis.zadd("bar", 2, "b");
835      ZParams params = new ZParams();
836      params.weights(2, 2.5);
837      params.aggregate(ZParams.Aggregate.SUM);
838      List<String> expected = new ArrayList<>();
839      expected.add("a");
840      expected.add("b");
841      assertEquals(expected, jedis.zunion(params, "foo", "bar"));
842      List<Tuple> expectedTuple = new ArrayList<>();
843      expectedTuple.add(new Tuple("a", new Double(7)));
844      expectedTuple.add(new Tuple("b", new Double(9)));
845      assertEquals(expectedTuple, jedis.zunionWithScores(params, "foo", "bar"));
846      jedis.zadd(bfoo, 1, ba);
847      jedis.zadd(bfoo, 2, bb);
848      jedis.zadd(bbar, 2, ba);
849      jedis.zadd(bbar, 2, bb);
850      List<byte[]> bexpected = new ArrayList<>();
851      bexpected.add(ba);
852      bexpected.add(bb);
853      AssertUtil.assertByteArrayListEquals(bexpected, jedis.zunion(params, bfoo, bbar));
854      List<Tuple> bexpectedTuple = new ArrayList<>();
855      bexpectedTuple.add(new Tuple(ba, new Double(7)));
856      bexpectedTuple.add(new Tuple(bb, new Double(9)));
857      assertEquals(bexpectedTuple, jedis.zunionWithScores(params, bfoo, bbar));
858    }
859    @Test
860    public void zunionstore() {
861      jedis.zadd("foo", 1, "a");
862      jedis.zadd("foo", 2, "b");
863      jedis.zadd("bar", 2, "a");
864      jedis.zadd("bar", 2, "b");
865      assertEquals(2, jedis.zunionstore("dst", "foo", "bar"));
866      List<Tuple> expected = new ArrayList<Tuple>();
867      expected.add(new Tuple("a", new Double(3)));
868      expected.add(new Tuple("b", new Double(4)));
869      assertEquals(expected, jedis.zrangeWithScores("dst", 0, 100));
870      jedis.zadd(bfoo, 1, ba);
871      jedis.zadd(bfoo, 2, bb);
872      jedis.zadd(bbar, 2, ba);
873      jedis.zadd(bbar, 2, bb);
874      assertEquals(2, jedis.zunionstore(SafeEncoder.encode("dst"), bfoo, bbar));
875      List<Tuple> bexpected = new ArrayList<Tuple>();
876      bexpected.add(new Tuple(ba, new Double(3)));
877      bexpected.add(new Tuple(bb, new Double(4)));
878      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode("dst"), 0, 100));
879    }
880    @Test
881    public void zunionstoreParams() {
882      jedis.zadd("foo", 1, "a");
883      jedis.zadd("foo", 2, "b");
884      jedis.zadd("bar", 2, "a");
885      jedis.zadd("bar", 2, "b");
886      ZParams params = new ZParams();
887      params.weights(2, 2.5);
888      params.aggregate(ZParams.Aggregate.SUM);
889      assertEquals(2, jedis.zunionstore("dst", params, "foo", "bar"));
890      List<Tuple> expected = new ArrayList<Tuple>();
891      expected.add(new Tuple("a", new Double(7)));
892      expected.add(new Tuple("b", new Double(9)));
893      assertEquals(expected, jedis.zrangeWithScores("dst", 0, 100));
894      jedis.zadd(bfoo, 1, ba);
895      jedis.zadd(bfoo, 2, bb);
896      jedis.zadd(bbar, 2, ba);
897      jedis.zadd(bbar, 2, bb);
898      ZParams bparams = new ZParams();
899      bparams.weights(2, 2.5);
900      bparams.aggregate(ZParams.Aggregate.SUM);
901      assertEquals(2, jedis.zunionstore(SafeEncoder.encode("dst"), bparams, bfoo, bbar));
902      List<Tuple> bexpected = new ArrayList<Tuple>();
903      bexpected.add(new Tuple(ba, new Double(7)));
904      bexpected.add(new Tuple(bb, new Double(9)));
905      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode("dst"), 0, 100));
906    }
907    @Test
908    public void zinter() {
909      jedis.zadd("foo", 1, "a");
910      jedis.zadd("foo", 2, "b");
911      jedis.zadd("bar", 2, "a");
912      ZParams params = new ZParams();
913      params.weights(2, 2.5);
914      params.aggregate(ZParams.Aggregate.SUM);
915      assertEquals(singletonList("a"), jedis.zinter(params, "foo", "bar"));
916      assertEquals(singletonList(new Tuple("a", new Double(7))),
917        jedis.zinterWithScores(params, "foo", "bar"));
918      jedis.zadd(bfoo, 1, ba);
919      jedis.zadd(bfoo, 2, bb);
920      jedis.zadd(bbar, 2, ba);
921      ZParams bparams = new ZParams();
922      bparams.weights(2, 2.5);
923      bparams.aggregate(ZParams.Aggregate.SUM);
924      AssertUtil.assertByteArrayListEquals(singletonList(ba), jedis.zinter(params, bfoo, bbar));
925      assertEquals(singletonList(new Tuple(ba, new Double(7))),
926        jedis.zinterWithScores(bparams, bfoo, bbar));
927    }
928    @Test
929    public void zinterstore() {
930      jedis.zadd("foo", 1, "a");
931      jedis.zadd("foo", 2, "b");
932      jedis.zadd("bar", 2, "a");
933      assertEquals(1, jedis.zinterstore("dst", "foo", "bar"));
934      List<Tuple> expected = new ArrayList<Tuple>();
935      expected.add(new Tuple("a", new Double(3)));
936      assertEquals(expected, jedis.zrangeWithScores("dst", 0, 100));
937      jedis.zadd(bfoo, 1, ba);
938      jedis.zadd(bfoo, 2, bb);
939      jedis.zadd(bbar, 2, ba);
940      assertEquals(1, jedis.zinterstore(SafeEncoder.encode("dst"), bfoo, bbar));
941      List<Tuple> bexpected = new ArrayList<Tuple>();
942      bexpected.add(new Tuple(ba, new Double(3)));
943      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode("dst"), 0, 100));
944    }
945    @Test
946    public void zintertoreParams() {
947      jedis.zadd("foo", 1, "a");
948      jedis.zadd("foo", 2, "b");
949      jedis.zadd("bar", 2, "a");
950      ZParams params = new ZParams();
951      params.weights(2, 2.5);
952      params.aggregate(ZParams.Aggregate.SUM);
953      assertEquals(1, jedis.zinterstore("dst", params, "foo", "bar"));
954      List<Tuple> expected = new ArrayList<Tuple>();
955      expected.add(new Tuple("a", new Double(7)));
956      assertEquals(expected, jedis.zrangeWithScores("dst", 0, 100));
957      jedis.zadd(bfoo, 1, ba);
958      jedis.zadd(bfoo, 2, bb);
959      jedis.zadd(bbar, 2, ba);
960      ZParams bparams = new ZParams();
961      bparams.weights(2, 2.5);
962      bparams.aggregate(ZParams.Aggregate.SUM);
963      assertEquals(1, jedis.zinterstore(SafeEncoder.encode("dst"), bparams, bfoo, bbar));
964      List<Tuple> bexpected = new ArrayList<Tuple>();
965      bexpected.add(new Tuple(ba, new Double(7)));
966      assertEquals(bexpected, jedis.zrangeWithScores(SafeEncoder.encode("dst"), 0, 100));
967    }
968    @Test
969    public void zintercard() {
970      jedis.zadd("foo", 1, "a");
971      jedis.zadd("foo", 2, "b");
972      jedis.zadd("bar", 2, "a");
973      jedis.zadd("bar", 1, "b");
974      assertEquals(2, jedis.zintercard("foo", "bar"));
975      assertEquals(1, jedis.zintercard(1, "foo", "bar"));
976      jedis.zadd(bfoo, 1, ba);
977      jedis.zadd(bfoo, 2, bb);
978      jedis.zadd(bbar, 2, ba);
979      jedis.zadd(bbar, 2, bb);
980      assertEquals(2, jedis.zintercard(bfoo, bbar));
981      assertEquals(1, jedis.zintercard(1, bfoo, bbar));
982    }
983    @Test
984    public void zscan() {
985      jedis.zadd("foo", 1, "a");
986      jedis.zadd("foo", 2, "b");
987      ScanResult<Tuple> result = jedis.zscan("foo", SCAN_POINTER_START);
988      assertEquals(SCAN_POINTER_START, result.getCursor());
989      assertFalse(result.getResult().isEmpty());
990      jedis.zadd(bfoo, 1, ba);
991      jedis.zadd(bfoo, 1, bb);
992      ScanResult<Tuple> bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY);
993      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
994      assertFalse(bResult.getResult().isEmpty());
995    }
996    @Test
997    public void zscanMatch() {
998      ScanParams params = new ScanParams();
999      params.match("a*");
1000      jedis.zadd("foo", 2, "b");
1001      jedis.zadd("foo", 1, "a");
1002      jedis.zadd("foo", 11, "aa");
1003      ScanResult<Tuple> result = jedis.zscan("foo", SCAN_POINTER_START, params);
1004      assertEquals(SCAN_POINTER_START, result.getCursor());
1005      assertFalse(result.getResult().isEmpty());
1006      params = new ScanParams();
1007      params.match(bbarstar);
1008      jedis.zadd(bfoo, 2, bbar1);
1009      jedis.zadd(bfoo, 1, bbar2);
1010      jedis.zadd(bfoo, 11, bbar3);
1011      ScanResult<Tuple> bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY, params);
1012      assertArrayEquals(SCAN_POINTER_START_BINARY, bResult.getCursorAsBytes());
1013      assertFalse(bResult.getResult().isEmpty());
1014    }
1015    @Test
1016    public void zscanCount() {
1017      ScanParams params = new ScanParams();
1018      params.count(2);
1019      jedis.zadd("foo", 1, "a1");
1020      jedis.zadd("foo", 2, "a2");
1021      jedis.zadd("foo", 3, "a3");
1022      jedis.zadd("foo", 4, "a4");
1023      jedis.zadd("foo", 5, "a5");
1024      ScanResult<Tuple> result = jedis.zscan("foo", SCAN_POINTER_START, params);
1025      assertFalse(result.getResult().isEmpty());
1026      params = new ScanParams();
1027      params.count(2);
1028      jedis.zadd(bfoo, 2, bbar1);
1029      jedis.zadd(bfoo, 1, bbar2);
1030      jedis.zadd(bfoo, 11, bbar3);
1031      ScanResult<Tuple> bResult = jedis.zscan(bfoo, SCAN_POINTER_START_BINARY, params);
1032      assertFalse(bResult.getResult().isEmpty());
1033    }
1034    @Test
1035    public void infinity() {
1036      jedis.zadd("key", Double.POSITIVE_INFINITY, "pos");
1037      assertEquals(Double.POSITIVE_INFINITY, jedis.zscore("key", "pos"), 0d);
1038      jedis.zadd("key", Double.NEGATIVE_INFINITY, "neg");
1039      assertEquals(Double.NEGATIVE_INFINITY, jedis.zscore("key", "neg"), 0d);
1040      jedis.zadd("key", 0d, "zero");
1041      List<Tuple> set = jedis.zrangeWithScores("key", 0, -1);
1042      Iterator<Tuple> itr = set.iterator();
1043      assertEquals(Double.NEGATIVE_INFINITY, itr.next().getScore(), 0d);
1044      assertEquals(0d, itr.next().getScore(), 0d);
1045      assertEquals(Double.POSITIVE_INFINITY, itr.next().getScore(), 0d);
1046    }
1047    @Test
1048    public void bzpopmax() {
1049      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
1050      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
1051      jedis.zadd("bar", 0.1d, "c", ZAddParams.zAddParams().nx());
1052      assertEquals(new KeyValue<>("foo", new Tuple("b", 10d)), jedis.bzpopmax(0, "foo", "bar"));
1053      jedis.zadd(bfoo, 1d, ba);
1054      jedis.zadd(bfoo, 10d, bb);
1055      jedis.zadd(bbar, 0.1d, bc);
1056      KeyValue<byte[], Tuple> actual = jedis.bzpopmax(0, bfoo, bbar);
1057      assertArrayEquals(bfoo, actual.getKey());
1058      assertEquals(new Tuple(bb, 10d), actual.getValue());
1059    }
1060    @Test
1061    public void bzpopmin() {
1062      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
1063      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
1064      jedis.zadd("bar", 0.1d, "c", ZAddParams.zAddParams().nx());
1065      assertEquals(new KeyValue<>("bar", new Tuple("c", 0.1)), jedis.bzpopmin(0, "bar", "foo"));
1066      jedis.zadd(bfoo, 1d, ba);
1067      jedis.zadd(bfoo, 10d, bb);
1068      jedis.zadd(bbar, 0.1d, bc);
1069      KeyValue<byte[], Tuple> actual = jedis.bzpopmin(0, bbar, bfoo);
1070      assertArrayEquals(bbar, (byte[]) actual.getKey());
1071      assertEquals(new Tuple(bc, 0.1), actual.getValue());
1072    }
1073    @Test
1074    public void zdiff() {
1075      jedis.zadd("foo", 1.0, "a");
1076      jedis.zadd("foo", 2.0, "b");
1077      jedis.zadd("bar", 1.0, "a");
1078      assertEquals(0, jedis.zdiff("bar1", "bar2").size());
1079      assertEquals(singletonList("b"), jedis.zdiff("foo", "bar"));
1080      assertEquals(singletonList(new Tuple("b", 2.0d)), jedis.zdiffWithScores("foo", "bar"));
1081      jedis.zadd(bfoo, 1.0, ba);
1082      jedis.zadd(bfoo, 2.0, bb);
1083      jedis.zadd(bbar, 1.0, ba);
1084      assertEquals(0, jedis.zdiff(bbar1, bbar2).size());
1085      List<byte[]> bactual = jedis.zdiff(bfoo, bbar);
1086      assertEquals(1, bactual.size());
1087      assertArrayEquals(bb, bactual.iterator().next());
1088      assertEquals(singletonList(new Tuple(bb, 2.0d)), jedis.zdiffWithScores(bfoo, bbar));
1089    }
1090    @Test
1091    public void zdiffstore() {
1092      jedis.zadd("foo", 1.0, "a");
1093      jedis.zadd("foo", 2.0, "b");
1094      jedis.zadd("bar", 1.0, "a");
1095      assertEquals(0, jedis.zdiffstore("bar3", "bar1", "bar2"));
1096      assertEquals(1, jedis.zdiffstore("bar3", "foo", "bar"));
1097      assertEquals(singletonList("b"), jedis.zrange("bar3", 0, -1));
1098      jedis.zadd(bfoo, 1.0, ba);
1099      jedis.zadd(bfoo, 2.0, bb);
1100      jedis.zadd(bbar, 1.0, ba);
1101      assertEquals(0, jedis.zdiffstore(bbar3, bbar1, bbar2));
1102      assertEquals(1, jedis.zdiffstore(bbar3, bfoo, bbar));
1103      List<byte[]> bactual = jedis.zrange(bbar3, 0, -1);
1104      assertArrayEquals(bb, bactual.iterator().next());
1105    }
1106    @Test
1107    public void zrandmember() {
1108      assertNull(jedis.zrandmember("foo"));
1109      assertEquals(Collections.emptyList(), jedis.zrandmember("foo", 1));
1110      assertEquals(Collections.emptyList(), jedis.zrandmemberWithScores("foo", 1));
1111      Map<String, Double> hash = new HashMap<>();
1112      hash.put("bar1", 1d);
1113      hash.put("bar2", 10d);
1114      hash.put("bar3", 0.1d);
1115      jedis.zadd("foo", hash);
1116      AssertUtil.assertCollectionContains(hash.keySet(), jedis.zrandmember("foo"));
1117      assertEquals(2, jedis.zrandmember("foo", 2).size());
1118      List<Tuple> actual = jedis.zrandmemberWithScores("foo", 2);
1119      assertEquals(2, actual.size());
1120      actual.forEach(t -> assertEquals(hash.get(t.getElement()), t.getScore(), 0d));
1121      assertNull(jedis.zrandmember(bfoo));
1122      assertEquals(Collections.emptyList(), jedis.zrandmember(bfoo, 1));
1123      assertEquals(Collections.emptyList(), jedis.zrandmemberWithScores(bfoo, 1));
1124      Map<byte[], Double> bhash = new HashMap<>();
1125      bhash.put(bbar1, 1d);
1126      bhash.put(bbar2, 10d);
1127      bhash.put(bbar3, 0.1d);
1128      jedis.zadd(bfoo, bhash);
1129      AssertUtil.assertByteArrayCollectionContains(bhash.keySet(), jedis.zrandmember(bfoo));
1130      assertEquals(2, jedis.zrandmember(bfoo, 2).size());
1131      List<Tuple> bactual = jedis.zrandmemberWithScores(bfoo, 2);
1132      assertEquals(2, bactual.size());
1133      bactual.forEach(t -> assertEquals(getScoreFromByteMap(bhash, t.getBinaryElement()), t.getScore(), 0d));
1134    }
1135    private Double getScoreFromByteMap(Map<byte[], Double> bhash, byte[] key) {
1136      for (Map.Entry<byte[], Double> en : bhash.entrySet()) {
1137        if (Arrays.equals(en.getKey(), key)) {
1138          return en.getValue();
1139        }
1140      }
1141      return null;
1142    }
1143    @Test
1144    public void zmpop() {
1145      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
1146      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
1147      jedis.zadd("foo", 0.1d, "c", ZAddParams.zAddParams().nx());
1148      jedis.zadd("foo", 2d, "a", ZAddParams.zAddParams().nx());
1149      KeyValue<String, List<Tuple>> single = jedis.zmpop(SortedSetOption.MAX, "foo");
1150      KeyValue<String, List<Tuple>> range = jedis.zmpop(SortedSetOption.MIN, 2, "foo");
1151      assertEquals(new Tuple("b", 10d), single.getValue().get(0));
1152      assertEquals(2, range.getValue().size());
1153      assertNull(jedis.zmpop(SortedSetOption.MAX, "foo"));
1154    }
1155    @Test
1156    public void bzmpopSimple() {
1157      jedis.zadd("foo", 1d, "a", ZAddParams.zAddParams().nx());
1158      jedis.zadd("foo", 10d, "b", ZAddParams.zAddParams().nx());
1159      jedis.zadd("foo", 0.1d, "c", ZAddParams.zAddParams().nx());
1160      jedis.zadd("foo", 2d, "a", ZAddParams.zAddParams().nx());
1161      KeyValue<String, List<Tuple>> single = jedis.bzmpop(1L, SortedSetOption.MAX, "foo");
1162      KeyValue<String, List<Tuple>> range = jedis.bzmpop(1L, SortedSetOption.MIN, 2, "foo");
1163      assertEquals(new Tuple("b", 10d), single.getValue().get(0));
1164      assertEquals(2, range.getValue().size());
1165      assertNull(jedis.bzmpop(1L, SortedSetOption.MAX, "foo"));
1166    }
1167  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SortedSetCommandsTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-SortedSetCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>322      assertEquals(bexpected, brange);
323    }
324    @Test
325    public void zrevrangeWithScores() {
326      jedis.zadd("foo", 1d, "a");
</pre></code></div>
                <div class="column column_space"><pre><code>571      assertByteArrayListEquals(bexpected, brange);
572    }
573    @Test
574    public void zrevrangebyscore() {
575      jedis.zadd("foo", 1.0d, "a");
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    