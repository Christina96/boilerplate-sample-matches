<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for GeoPointTypeTest.java & JoinGroupByIntegrationTests.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for GeoPointTypeTest.java & JoinGroupByIntegrationTests.java
      </h3>
      <h1 align="center">
        46.0%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>GeoPointTypeTest.java (51.8797%)<TH>JoinGroupByIntegrationTests.java (41.317364%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match49532-0.html#0',2,'match49532-1.html#0',3)" NAME="0">(62-71)<TD><A HREF="javascript:ZweiFrames('match49532-0.html#0',2,'match49532-1.html#0',3)" NAME="0">(46-63)</A><TD ALIGN=center><FONT COLOR="#ff0000">14</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match49532-0.html#1',2,'match49532-1.html#1',3)" NAME="1">(91-100)<TD><A HREF="javascript:ZweiFrames('match49532-0.html#1',2,'match49532-1.html#1',3)" NAME="1">(68-87)</A><TD ALIGN=center><FONT COLOR="#ec0000">13</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match49532-0.html#2',2,'match49532-1.html#2',3)" NAME="2">(26-40)<TD><A HREF="javascript:ZweiFrames('match49532-0.html#2',2,'match49532-1.html#2',3)" NAME="2">(24-38)</A><TD ALIGN=center><FONT COLOR="#da0000">12</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match49532-0.html#3',2,'match49532-1.html#3',3)" NAME="3">(84-89)<TD><A HREF="javascript:ZweiFrames('match49532-0.html#3',2,'match49532-1.html#3',3)" NAME="3">(119-136)</A><TD ALIGN=center><FONT COLOR="#b60000">10</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match49532-0.html#4',2,'match49532-1.html#4',3)" NAME="4">(77-82)<TD><A HREF="javascript:ZweiFrames('match49532-0.html#4',2,'match49532-1.html#4',3)" NAME="4">(103-118)</A><TD ALIGN=center><FONT COLOR="#b60000">10</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match49532-0.html#5',2,'match49532-1.html#5',3)" NAME="5">(55-60)<TD><A HREF="javascript:ZweiFrames('match49532-0.html#5',2,'match49532-1.html#5',3)" NAME="5">(92-102)</A><TD ALIGN=center><FONT COLOR="#b60000">10</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>GeoPointTypeTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Licensed to Crate.io GmbH (&quot;Crate&quot;) under one or more contributor
 * license agreements.  See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.  Crate licenses
 * this file to you under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.  You may
 * obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations
 * under the License.
 *
 * However, if you have executed another commercial license agreement
 * with Crate these terms will supersede the license and you may use the
 * software solely pursuant to the terms of the relevant commercial agreement.
 */

package io.crate.types;
<A NAME="2"></A>
import org.elasticsearch.test.ESTestCase;
import org.elasticsearch.common.io.stream.BytesStreamOutput;
<FONT color="#980517"><A HREF="javascript:ZweiFrames('match49532-1.html#2',3,'match49532-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>import org.elasticsearch.common.io.stream.StreamInput;
import org.junit.Test;
import org.locationtech.spatial4j.context.jts.JtsSpatialContext;
import org.locationtech.spatial4j.shape.Point;
import org.locationtech.spatial4j.shape.impl.PointImpl;

import java.util.List;

import static org.hamcrest.Matchers.equalTo;
import static org.hamcrest.Matchers.is;

public class GeoPointTypeTest extends ESTestCase {

    @Test
    public void testStreaming() throws Throwable {</B></FONT>
        Point p1 = new PointImpl(41.2, -37.4, JtsSpatialContext.GEO);

        BytesStreamOutput out = new BytesStreamOutput();
        DataTypes.GEO_POINT.writeValueTo(out, p1);

        StreamInput in = out.bytes().streamInput();
        Point p2 = DataTypes.GEO_POINT.readValueFrom(in);

        assertThat(p1, equalTo(p2));
    }

<A NAME="5"></A>    @Test
    public void test_sanitize_list_of_doubles_value() {
        Point value = DataTypes.GEO_POINT.sanitizeValue(List.of(1d, 2d));
        assertThat(<FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match49532-1.html#5',3,'match49532-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>value.getX(), is(1.0d));
        assertThat(value.getY(), is(2.0d));
    }

<A NAME="0"></A>    @Test
    public void testWktToGeoPointValue() throws Exception {</B></FONT>
        Point value = DataTypes.GEO_POINT.implicitCast(&quot;POINT(1 2)&quot;);
        <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match49532-1.html#0',3,'match49532-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>assertThat(value.getX(), is(1.0d));
        assertThat(value.getY(), is(2.0d));
    }

    @Test
    public void testInvalidWktToGeoPointValue() throws Exception {
        expectedException.expect(IllegalArgumentException.class);
        expectedException.expectMessage(&quot;Cannot convert \&quot;POINT(54.321 -123.456)\&quot; to geo_point.&quot; +
            &quot; Bad Y value -123.456 is not in boundary Rect(minX=-180.0,maxX=180.0,minY=-90.0,maxY=90.0)&quot;);
        DataTypes.GEO_POINT.implicitCast</B></FONT>(&quot;POINT(54.321 -123.456)&quot;);
    }

<A NAME="4"></A>    @Test
    public void testValueConversionFromList() throws Exception {
        Point value = DataTypes.GEO_POINT.implicitCast(List.of(10.0, 20.2));
        assertThat(<FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match49532-1.html#4',3,'match49532-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>value.getX(), is(10.0d));
        assertThat(value.getY(), is(20.2d));
    }

<A NAME="3"></A>    @Test
    public void testConversionFromObjectArrayOfIntegers() throws Exception {</B></FONT>
        Point value = DataTypes.GEO_POINT.implicitCast(new Object[]{1, 2});
        assertThat(<FONT color="#53858b"><A HREF="javascript:ZweiFrames('match49532-1.html#3',3,'match49532-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>value.getX(), is(1.0));
        assertThat(value.getY(), is(2.0));
    }

<A NAME="1"></A>    @Test
    public void testConversionFromIntegerArray() throws Exception {</B></FONT>
        Point value = DataTypes.GEO_POINT.implicitCast(new Integer[]{1, 2});
        assertThat(<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match49532-1.html#1',3,'match49532-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>value.getX(), is(1.0));
        assertThat(value.getY(), is(2.0));
    }

    @Test
    public void test_cast_double_geo_point_value_with_invalid_latitude_throws_exception() {
        expectedException.expect(IllegalArgumentException.class);
        expectedException.expectMessage(
            &quot;Failed to validate geo point [lon=54.321000, lat=-123.456000], not a valid location.&quot;);
        DataTypes.GEO_POINT.implicitCast</B></FONT>(new Double[]{54.321, -123.456});
    }

    @Test
    public void test_cast_double_geo_point_value_with_invalid_longitude_throws_exception() {
        expectedException.expect(IllegalArgumentException.class);
        expectedException.expectMessage(
            &quot;Failed to validate geo point [lon=-187.654000, lat=123.456000], not a valid location.&quot;);
        DataTypes.GEO_POINT.implicitCast(new Double[]{-187.654, 123.456});
    }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>JoinGroupByIntegrationTests.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Licensed to Crate.io GmbH (&quot;Crate&quot;) under one or more contributor
 * license agreements.  See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.  Crate licenses
 * this file to you under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.  You may
 * obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations
 * under the License.
 *
 * However, if you have executed another commercial license agreement
 * with Crate these terms will supersede the license and you may use the
 * software solely pursuant to the terms of the relevant commercial agreement.
 */
<A NAME="2"></A>
package io.crate.integrationtests;

<FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49532-0.html#2',2,'match49532-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>import io.crate.data.CollectionBucket;
import io.crate.execution.engine.sort.OrderingByPosition;
import io.crate.testing.TestingHelpers;
import org.junit.Before;
import org.junit.Test;

import java.util.Arrays;
import java.util.List;

import static org.hamcrest.core.Is.is;

public class JoinGroupByIntegrationTests extends SQLIntegrationTestCase {

    @Before
    public void initTestData() throws Exception {</B></FONT>
        createColorsAndFruits();
    }

    /**
<A NAME="0"></A>     * Create some sample data.
     */
    private void createColorsAndFruits() {
        <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49532-0.html#0',2,'match49532-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>execute(&quot;create table colors (id integer, name string)&quot;);
        execute(&quot;create table fruits (id integer, price float, name string)&quot;);
        ensureYellow();

        execute(&quot;insert into colors (id, name) values (1, 'red'), (2, 'yellow')&quot;);
        execute(&quot;insert into fruits (id, price, name) values (1, 1.9, 'apple'), (2, 0.8, 'banana'), (2, 0.5, 'lemon')&quot;);
        execute(&quot;refresh table colors, fruits&quot;);
    }

    @Test
    public void testJoinWithAggregationGroupBy() throws Exception {
        execute(
            &quot;select colors.name, count(colors.name) &quot; +
            &quot;from colors, fruits &quot; +
            &quot;group by colors.name &quot; +
            &quot;order by colors.name DESC&quot;
        );
        assertThat(TestingHelpers.printedTable</B></FONT>(response.rows()), is(&quot;yellow| 3\nred| 3\n&quot;));
    }
<A NAME="1"></A>
    @Test
    public void testJoinWithGroupByLimitAndOffset() throws Exception {
        <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49532-0.html#1',2,'match49532-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>execute(
            &quot;select colors.name &quot; +
            &quot;from colors, fruits &quot; +
            &quot;group by colors.name &quot; +
            &quot;order by colors.name DESC &quot; +
            &quot;limit 1 offset 1&quot;
        );
        assertThat(TestingHelpers.printedTable(response.rows()), is(&quot;red\n&quot;));
    }

    @Test
    public void testJoinWithGroupByAndHaving() throws Exception {
        execute(
            &quot;select count(fruits.name), colors.name &quot; +
            &quot;from colors, fruits &quot; +
            &quot;where colors.id = fruits.id &quot; +
            &quot;group by colors.name &quot; +
            &quot;having count(colors.name) = 1&quot;
        );
        assertThat(TestingHelpers.printedTable</B></FONT>(response.rows()), is(&quot;1| red\n&quot;));
    }
<A NAME="5"></A>
    @Test
    public void testJoinWithGroupByAndWhere() throws Exception {
        <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49532-0.html#5',2,'match49532-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>execute(
            &quot;select colors.name &quot; +
            &quot;from colors, fruits &quot; +
            &quot;where colors.name='red' &quot; +
            &quot;group by colors.name&quot;
        );
        assertThat(TestingHelpers.printedTable(response.rows()), is(&quot;red\n&quot;));
    }
<A NAME="4"></A>
    @Test
    public void testJoinWithAggregationScalarFunctionWithGroupBy() throws Exception {</B></FONT>
        <FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49532-0.html#4',2,'match49532-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>execute(
            &quot;select fruits.name, max(colors.name), max(fruits.price * fruits.price + 10) + 10, max(fruits.name), count(colors.name) &quot; +
            &quot;from colors, fruits &quot; +
            &quot;group by fruits.name &quot; +
            &quot;order by name &quot; +
            &quot;limit 1 offset 1&quot;
        );

        assertThat(
            TestingHelpers.printedTable(response.rows()),
            is(&quot;banana| yellow| 20.64| banana| 2\n&quot;)
        );
    }
<A NAME="3"></A>
    @Test
    public void testDistributedJoinWithAggregationScalarFunctionWithGroupBy() throws Exception {</B></FONT>
        <FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match49532-0.html#3',2,'match49532-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>execute(
            &quot;select fruits.name, max(colors.name), max(fruits.price * fruits.price + 10) + 10, max(fruits.name), count(colors.name) &quot; +
            &quot;from colors, fruits &quot; +
            &quot;where colors.id = fruits.id &quot; +
            &quot;group by fruits.name &quot; +
            &quot;having count(colors.id) &gt; 0 &quot; +
            &quot;order by fruits.name &quot; +
            &quot;limit 1 offset 1&quot;
        );

        assertThat(
            TestingHelpers.printedTable(response.rows()),
            is(&quot;banana| yellow| 20.64| banana| 1\n&quot;)
        );
    }

    @Test
    public void testHavingWithGroupBy() throws Exception {</B></FONT>
        execute(
            &quot;select fruits.name as name, price &quot; +
            &quot;from colors, fruits &quot; +
            &quot;group by fruits.name, price &quot; +
            &quot;having count(colors.name) &gt; 0 &quot; +
            &quot;order by name, price&quot;
        );

        assertThat(
            TestingHelpers.printedTable(response.rows()),
            is(&quot;apple| 1.9\n&quot; +
               &quot;banana| 0.8\n&quot; +
               &quot;lemon| 0.5\n&quot;)
        );
    }

    @Test
    public void testHavingWithGroupByAndFunction() throws Exception {
        execute(
            &quot;select fruits.name as fruit_name, count(colors.name) as color_name_count, price &quot; +
            &quot;from colors, fruits &quot; +
            &quot;group by fruit_name, price &quot; +
            &quot;having abs(price) &gt; 0.5 &quot; +
            &quot;order by fruit_name, price&quot;
        );

        assertThat(
            TestingHelpers.printedTable(response.rows()),
            is(&quot;apple| 2| 1.9\n&quot; +
               &quot;banana| 2| 0.8\n&quot;)
        );
    }

    @Test
    public void testSelectWithJoinGroupByAndHaving() throws Exception {
        execute(
            &quot;select fruits.name &quot; +
            &quot;from colors, fruits &quot; +
            &quot;where colors.id = fruits.id &quot; +
            &quot;group by fruits.name &quot; +
            &quot;having count(colors.id) &gt; 0 &quot; +
            &quot;order by fruits.name &quot; +
            &quot;limit 1 offset 1&quot;
        );

        assertThat(
            TestingHelpers.printedTable(response.rows()),
            is(&quot;banana\n&quot;)
        );
    }

    @Test
    public void testSelectWithAggregationJoinGroupByAndHaving() throws Exception {
        execute(
            &quot;select fruits.name, max(colors.name), max(fruits.price * fruits.price + 10) + 10 &quot; +
            &quot;from colors, fruits &quot; +
            &quot;where colors.id = fruits.id &quot; +
            &quot;group by fruits.name &quot; +
            &quot;having count(colors.id) &gt; 0 &quot; +
            &quot;order by fruits.name &quot; +
            &quot;limit 1 offset 1&quot;
        );

        assertThat(
            TestingHelpers.printedTable(response.rows()),
            is(&quot;banana| yellow| 20.64\n&quot;)
        );
    }

    @Test
    public void testDistributedSelectWithJoinAndGroupBy() throws Exception {
        execute(
            &quot;select max(colors.name), fruits.price * 10 &quot; +
            &quot;from colors, fruits &quot; +
            &quot;where colors.id = fruits.id &quot; +
            &quot;group by fruits.price * 10&quot;
        );

        List&lt;Object[]&gt; rows = Arrays.asList(response.rows());
        rows.sort(OrderingByPosition.arrayOrdering(1, false, false));
        assertThat(
            TestingHelpers.printedTable(new CollectionBucket(rows)),
            is(&quot;yellow| 5.0\n&quot; +
               &quot;yellow| 8.0\n&quot; +
               &quot;red| 19.0\n&quot;)
        );
    }

    @Test
    public void testSelectWithJoinAndGroupBy() throws Exception {
        execute(
            &quot;select max(colors.name), fruits.price * 10 &quot; +
            &quot;from colors, fruits &quot; +
            &quot;group by fruits.price * 10 &quot;
        );

        List&lt;Object[]&gt; rows = Arrays.asList(response.rows());
        rows.sort(OrderingByPosition.arrayOrdering(1, false, false));

        assertThat(
            TestingHelpers.printedTable(new CollectionBucket(rows)),
            is(&quot;yellow| 5.0\n&quot; +
               &quot;yellow| 8.0\n&quot; +
               &quot;yellow| 19.0\n&quot;)
        );
    }

    @Test
    public void testSelectWithJoinGroupByAndOrderBy() throws Exception {
        execute(
            &quot;select max(colors.name), fruits.price * 10 &quot; +
            &quot;from colors, fruits &quot; +
            &quot;group by fruits.price * 10 &quot; +
            &quot;order by fruits.price * 10&quot;
        );

        assertThat(
            TestingHelpers.printedTable(response.rows()),
            is(&quot;yellow| 5.0\n&quot; +
               &quot;yellow| 8.0\n&quot; +
               &quot;yellow| 19.0\n&quot;)
        );
    }
}
</PRE>
</div>
  </div>
</body>
</html>
