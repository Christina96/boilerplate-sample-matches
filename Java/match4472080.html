<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>Matches for RecoveryFilesInfoRequest.java &amp; BigArrays.java</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<style>.modal {display: none;position: fixed;z-index: 1;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0, 0, 0);background-color: rgba(0, 0, 0, 0.4);}  .modal-content {height: 250%;background-color: #fefefe;margin: 5% auto;padding: 20px;border: 1px solid #888;width: 80%;}  .close {color: #aaa;float: right;font-size: 20px;font-weight: bold;}  .close:hover, .close:focus {color: black;text-decoration: none;cursor: pointer;}  .column {float: left;width: 50%;}  .row:after {content: ;display: table;clear: both;}  #column1, #column2 {white-space: pre-wrap;}</style></head>
<body>
<div style="align-items: center; display: flex; justify-content: space-around;">
<div>
<h3 align="center">
Matches for RecoveryFilesInfoRequest.java &amp; BigArrays.java
      </h3>
<h1 align="center">
        2.1%
      </h1>
<center>
<a href="#" target="_top">
          INDEX
        </a>
<span>-</span>
<a href="#" target="_top">
          HELP
        </a>
</center>
</div>
<div>
<table bgcolor="#d0d0d0" border="1" cellspacing="0">
<tr><th><th>RecoveryFilesInfoRequest.java (6.2937064%)<th>BigArrays.java (1.3043479%)<th>Tokens
<tr onclick='openModal("#0000ff")' onmouseleave='this.style.backgroundColor = "#D0D0D0"' onmouseover='this.style.backgroundColor = "yellow"' style="cursor:pointer"><td bgcolor="#0000ff"><font color="#0000ff">-</font><td><a href="#" name="0">(22-33)<td><a href="#" name="0">(26-38)</a><td align="center"><font color="#ff0000">9</font>
</td></td></a></td></td></tr></th></th></th></th></tr></table>
</div>
</div>
<hr/>
<div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>RecoveryFilesInfoRequest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 <a name="0"></a>
2 package org.elasticsearch.indices.recovery;
3 <font color="#0000ff"><a href="#"><img align="right" alt="other" border="0" src="forward.gif"/></a><b>import org.elasticsearch.common.io.stream.StreamInput;
4 import org.elasticsearch.common.io.stream.StreamOutput;
5 import org.elasticsearch.index.shard.ShardId;
6 import org.elasticsearch.transport.TransportRequest;
7 import java.io.IOException;
8 import java.util.ArrayList;
9 import java.util.List;
10 public class RecoveryFilesInfoRequest extends TransportRequest {
11     private final long recoveryId</b></font>;
12     private final ShardId shardId;
13     final List&lt;String&gt; phase1FileNames;
14     final List&lt;Long&gt; phase1FileSizes;
15     final List&lt;String&gt; phase1ExistingFileNames;
16     final List&lt;Long&gt; phase1ExistingFileSizes;
17     int totalTranslogOps;
18     RecoveryFilesInfoRequest(long recoveryId,
19                              ShardId shardId,
20                              List&lt;String&gt; phase1FileNames,
21                              List&lt;Long&gt; phase1FileSizes,
22                              List&lt;String&gt; phase1ExistingFileNames,
23                              List&lt;Long&gt; phase1ExistingFileSizes,
24                              int totalTranslogOps) {
25         this.recoveryId = recoveryId;
26         this.shardId = shardId;
27         this.phase1FileNames = phase1FileNames;
28         this.phase1FileSizes = phase1FileSizes;
29         this.phase1ExistingFileNames = phase1ExistingFileNames;
30         this.phase1ExistingFileSizes = phase1ExistingFileSizes;
31         this.totalTranslogOps = totalTranslogOps;
32     }
33     public long recoveryId() {
34         return this.recoveryId;
35     }
36     public ShardId shardId() {
37         return shardId;
38     }
39     public RecoveryFilesInfoRequest(StreamInput in) throws IOException {
40         super(in);
41         recoveryId = in.readLong();
42         shardId = new ShardId(in);
43         int size = in.readVInt();
44         phase1FileNames = new ArrayList&lt;&gt;(size);
45         for (int i = 0; i &lt; size; i++) {
46             phase1FileNames.add(in.readString());
47         }
48         size = in.readVInt();
49         phase1FileSizes = new ArrayList&lt;&gt;(size);
50         for (int i = 0; i &lt; size; i++) {
51             phase1FileSizes.add(in.readVLong());
52         }
53         size = in.readVInt();
54         phase1ExistingFileNames = new ArrayList&lt;&gt;(size);
55         for (int i = 0; i &lt; size; i++) {
56             phase1ExistingFileNames.add(in.readString());
57         }
58         size = in.readVInt();
59         phase1ExistingFileSizes = new ArrayList&lt;&gt;(size);
60         for (int i = 0; i &lt; size; i++) {
61             phase1ExistingFileSizes.add(in.readVLong());
62         }
63         totalTranslogOps = in.readVInt();
64     }
65     @Override
66     public void writeTo(StreamOutput out) throws IOException {
67         super.writeTo(out);
68         out.writeLong(recoveryId);
69         shardId.writeTo(out);
70         out.writeVInt(phase1FileNames.size());
71         for (String phase1FileName : phase1FileNames) {
72             out.writeString(phase1FileName);
73         }
74         out.writeVInt(phase1FileSizes.size());
75         for (Long phase1FileSize : phase1FileSizes) {
76             out.writeVLong(phase1FileSize);
77         }
78         out.writeVInt(phase1ExistingFileNames.size());
79         for (String phase1ExistingFileName : phase1ExistingFileNames) {
80             out.writeString(phase1ExistingFileName);
81         }
82         out.writeVInt(phase1ExistingFileSizes.size());
83         for (Long phase1ExistingFileSize : phase1ExistingFileSizes) {
84             out.writeVLong(phase1ExistingFileSize);
85         }
86         out.writeVInt(totalTranslogOps);
87     }
88 }
</pre>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>BigArrays.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<hr/>
<pre>
1 package org.elasticsearch.common.util;
2 import org.apache.lucene.util.ArrayUtil;
3 <a name="0"></a>import org.apache.lucene.util.BytesRef;
4 import org.apache.lucene.util.RamUsageEstimator;
5 import javax.annotation.Nullable;
6 <font color="#0000ff"><div style="position:absolute;left:0"><a href="#"><img align="left" alt="other" border="0" src="back.gif"/></a></div><b>import org.elasticsearch.common.breaker.CircuitBreaker;
7 import org.elasticsearch.common.breaker.CircuitBreakingException;
8 import org.elasticsearch.common.lease.Releasable;
9 import org.elasticsearch.common.lease.Releasables;
10 import org.elasticsearch.common.recycler.Recycler;
11 import org.elasticsearch.indices.breaker.CircuitBreakerService;
12 import java.util.Arrays;
13 public class BigArrays {
14     public static final BigArrays NON_RECYCLING_INSTANCE = new BigArrays(null, null, CircuitBreaker.REQUEST)</b></font>;
15     public static long overSize(long minTargetSize, int pageSize, int bytesPerElement) {
16         if (minTargetSize &lt; 0) {
17             throw new IllegalArgumentException("minTargetSize must be &gt;= 0");
18         }
19         if (pageSize &lt; 0) {
20             throw new IllegalArgumentException("pageSize must be &gt; 0");
21         }
22         if (bytesPerElement &lt;= 0) {
23             throw new IllegalArgumentException("bytesPerElement must be &gt; 0");
24         }
25         long newSize;
26         if (minTargetSize &lt; pageSize) {
27             newSize = ArrayUtil.oversize((int)minTargetSize, bytesPerElement);
28         } else {
29             newSize = minTargetSize + (minTargetSize &gt;&gt;&gt; 3);
30         }
31         if (newSize &gt; pageSize) {
32             newSize = newSize - (newSize % pageSize) + pageSize;
33             assert newSize % pageSize == 0;
34         }
35         return newSize;
36     }
37     static boolean indexIsInt(long index) {
38         return index == (int) index;
39     }
40     private abstract static class AbstractArrayWrapper extends AbstractArray implements BigArray {
41         static final long SHALLOW_SIZE = RamUsageEstimator.shallowSizeOfInstance(ByteArrayWrapper.class);
42         private final Releasable releasable;
43         private final long size;
44         AbstractArrayWrapper(BigArrays bigArrays, long size, Releasable releasable, boolean clearOnResize) {
45             super(bigArrays, clearOnResize);
46             this.releasable = releasable;
47             this.size = size;
48         }
49         @Override
50         public final long size() {
51             return size;
52         }
53         @Override
54         protected final void doClose() {
55             Releasables.close(releasable);
56         }
57     }
58     private static class ByteArrayWrapper extends AbstractArrayWrapper implements ByteArray {
59         private final byte[] array;
60         ByteArrayWrapper(BigArrays bigArrays, byte[] array, long size, Recycler.V&lt;byte[]&gt; releasable, boolean clearOnResize) {
61             super(bigArrays, size, releasable, clearOnResize);
62             this.array = array;
63         }
64         @Override
65         public long ramBytesUsed() {
66             return SHALLOW_SIZE + RamUsageEstimator.sizeOf(array);
67         }
68         @Override
69         public byte get(long index) {
70             assert indexIsInt(index);
71             return array[(int) index];
72         }
73         @Override
74         public byte set(long index, byte value) {
75             assert indexIsInt(index);
76             final byte ret = array[(int) index];
77             array[(int) index] = value;
78             return ret;
79         }
80         @Override
81         public boolean get(long index, int len, BytesRef ref) {
82             assert indexIsInt(index);
83             ref.bytes = array;
84             ref.offset = (int) index;
85             ref.length = len;
86             return false;
87         }
88         @Override
89         public void set(long index, byte[] buf, int offset, int len) {
90             assert indexIsInt(index);
91             System.arraycopy(buf, offset, array, (int) index, len);
92         }
93         @Override
94         public void fill(long fromIndex, long toIndex, byte value) {
95             assert indexIsInt(fromIndex);
96             assert indexIsInt(toIndex);
97             Arrays.fill(array, (int) fromIndex, (int) toIndex, value);
98         }
99     }
100     private static class IntArrayWrapper extends AbstractArrayWrapper implements IntArray {
101         private final int[] array;
102         IntArrayWrapper(BigArrays bigArrays, int[] array, long size, Recycler.V&lt;int[]&gt; releasable, boolean clearOnResize) {
103             super(bigArrays, size, releasable, clearOnResize);
104             this.array = array;
105         }
106         @Override
107         public long ramBytesUsed() {
108             return SHALLOW_SIZE + RamUsageEstimator.sizeOf(array);
109         }
110         @Override
111         public int get(long index) {
112             assert indexIsInt(index);
113             return array[(int) index];
114         }
115         @Override
116         public int set(long index, int value) {
117             assert indexIsInt(index);
118             final int ret = array[(int) index];
119             array[(int) index] = value;
120             return ret;
121         }
122         @Override
123         public int increment(long index, int inc) {
124             assert indexIsInt(index);
125             return array[(int) index] += inc;
126         }
127         @Override
128         public void fill(long fromIndex, long toIndex, int value) {
129             assert indexIsInt(fromIndex);
130             assert indexIsInt(toIndex);
131             Arrays.fill(array, (int) fromIndex, (int) toIndex, value);
132         }
133     }
134     private static class ObjectArrayWrapper&lt;T&gt; extends AbstractArrayWrapper implements ObjectArray&lt;T&gt; {
135         private final Object[] array;
136         ObjectArrayWrapper(BigArrays bigArrays, Object[] array, long size, Recycler.V&lt;Object[]&gt; releasable) {
137             super(bigArrays, size, releasable, true);
138             this.array = array;
139         }
140         @Override
141         public long ramBytesUsed() {
142             return SHALLOW_SIZE + RamUsageEstimator.alignObjectSize(RamUsageEstimator.NUM_BYTES_ARRAY_HEADER +
143                 RamUsageEstimator.NUM_BYTES_OBJECT_REF * size());
144         }
145         @SuppressWarnings("unchecked")
146         @Override
147         public T get(long index) {
148             assert indexIsInt(index);
149             return (T) array[(int) index];
150         }
151         @Override
152         public T set(long index, T value) {
153             assert indexIsInt(index);
154             @SuppressWarnings("unchecked")
155             T ret = (T) array[(int) index];
156             array[(int) index] = value;
157             return ret;
158         }
159     }
160     final PageCacheRecycler recycler;
161     private final CircuitBreakerService breakerService;
162     private final boolean checkBreaker;
163     private final String breakerName;
164     public BigArrays(PageCacheRecycler recycler, @Nullable final CircuitBreakerService breakerService, String breakerName) {
165         this(recycler, breakerService, breakerName, false);
166     }
167     public BigArrays(PageCacheRecycler recycler,
168                      @Nullable final CircuitBreakerService breakerService,
169                      String breakerName,
170                      boolean checkBreaker) {
171         this.checkBreaker = checkBreaker;
172         this.recycler = recycler;
173         this.breakerService = breakerService;
174         this.breakerName = breakerName;
175     }
176     void adjustBreaker(final long delta, final boolean isDataAlreadyCreated) {
177         if (this.breakerService != null) {
178             CircuitBreaker breaker = this.breakerService.getBreaker(breakerName);
179             if (this.checkBreaker) {
180                 if (delta &gt; 0) {
181                     try {
182                         breaker.addEstimateBytesAndMaybeBreak(delta, "&lt;reused_arrays&gt;");
183                     } catch (CircuitBreakingException e) {
184                         if (isDataAlreadyCreated) {
185                             breaker.addWithoutBreaking(delta);
186                         }
187                         throw e;
188                     }
189                 } else {
190                     breaker.addWithoutBreaking(delta);
191                 }
192             } else {
193                 breaker.addWithoutBreaking(delta);
194             }
195         }
196     }
197     private &lt;T extends AbstractBigArray&gt; T resizeInPlace(T array, long newSize) {
198         final long oldMemSize = array.ramBytesUsed();
199         final long oldSize = array.size();
200         assert oldMemSize == array.ramBytesEstimated(oldSize) :
201             "ram bytes used should equal that which was previously estimated: ramBytesUsed=" +
202             oldMemSize + ", ramBytesEstimated=" + array.ramBytesEstimated(oldSize);
203         final long estimatedIncreaseInBytes = array.ramBytesEstimated(newSize) - oldMemSize;
204         adjustBreaker(estimatedIncreaseInBytes, false);
205         array.resize(newSize);
206         return array;
207     }
208     private &lt;T extends BigArray&gt; T validate(T array) {
209         boolean success = false;
210         try {
211             adjustBreaker(array.ramBytesUsed(), true);
212             success = true;
213         } finally {
214             if (!success) {
215                 Releasables.closeWhileHandlingException(array);
216             }
217         }
218         return array;
219     }
220     public ByteArray newByteArray(long size, boolean clearOnResize) {
221         if (size &gt; PageCacheRecycler.BYTE_PAGE_SIZE) {
222             adjustBreaker(BigByteArray.estimateRamBytes(size), false);
223             return new BigByteArray(size, this, clearOnResize);
224         } else if (size &gt;= PageCacheRecycler.BYTE_PAGE_SIZE / 2 &amp;&amp; recycler != null) {
225             final Recycler.V&lt;byte[]&gt; page = recycler.bytePage(clearOnResize);
226             return validate(new ByteArrayWrapper(this, page.v(), size, page, clearOnResize));
227         } else {
228             return validate(new ByteArrayWrapper(this, new byte[(int) size], size, null, clearOnResize));
229         }
230     }
231     public ByteArray newByteArray(long size) {
232         return newByteArray(size, true);
233     }
234     public ByteArray resize(ByteArray array, long size) {
235         if (array instanceof BigByteArray) {
236             return resizeInPlace((BigByteArray) array, size);
237         } else {
238             AbstractArray arr = (AbstractArray) array;
239             final ByteArray newArray = newByteArray(size, arr.clearOnResize);
240             final byte[] rawArray = ((ByteArrayWrapper) array).array;
241             newArray.set(0, rawArray, 0, (int) Math.min(rawArray.length, newArray.size()));
242             arr.close();
243             return newArray;
244         }
245     }
246     public ByteArray grow(ByteArray array, long minSize) {
247         if (minSize &lt;= array.size()) {
248             return array;
249         }
250         final long newSize = overSize(minSize, PageCacheRecycler.BYTE_PAGE_SIZE, 1);
251         return resize(array, newSize);
252     }
253     public int hashCode(ByteArray array) {
254         if (array == null) {
255             return 0;
256         }
257         int hash = 1;
258         for (long i = 0; i &lt; array.size(); i++) {
259             hash = 31 * hash + array.get(i);
260         }
261         return hash;
262     }
263     public boolean equals(ByteArray array, ByteArray other) {
264         if (array == other) {
265             return true;
266         }
267         if (array.size() != other.size()) {
268             return false;
269         }
270         for (long i = 0; i &lt; array.size(); i++) {
271             if (array.get(i) != other.get(i)) {
272                 return false;
273             }
274         }
275         return true;
276     }
277     public IntArray newIntArray(long size, boolean clearOnResize) {
278         if (size &gt; PageCacheRecycler.INT_PAGE_SIZE) {
279             adjustBreaker(BigIntArray.estimateRamBytes(size), false);
280             return new BigIntArray(size, this, clearOnResize);
281         } else if (size &gt;= PageCacheRecycler.INT_PAGE_SIZE / 2 &amp;&amp; recycler != null) {
282             final Recycler.V&lt;int[]&gt; page = recycler.intPage(clearOnResize);
283             return validate(new IntArrayWrapper(this, page.v(), size, page, clearOnResize));
284         } else {
285             return validate(new IntArrayWrapper(this, new int[(int) size], size, null, clearOnResize));
286         }
287     }
288     public IntArray newIntArray(long size) {
289         return newIntArray(size, true);
290     }
291     public IntArray resize(IntArray array, long size) {
292         if (array instanceof BigIntArray) {
293             return resizeInPlace((BigIntArray) array, size);
294         } else {
295             AbstractArray arr = (AbstractArray) array;
296             final IntArray newArray = newIntArray(size, arr.clearOnResize);
297             for (long i = 0, end = Math.min(size, array.size()); i &lt; end; ++i) {
298                 newArray.set(i, array.get(i));
299             }
300             array.close();
301             return newArray;
302         }
303     }
304     public IntArray grow(IntArray array, long minSize) {
305         if (minSize &lt;= array.size()) {
306             return array;
307         }
308         final long newSize = overSize(minSize, PageCacheRecycler.INT_PAGE_SIZE, Integer.BYTES);
309         return resize(array, newSize);
310     }
311     public &lt;T&gt; ObjectArray&lt;T&gt; newObjectArray(long size) {
312         if (size &gt; PageCacheRecycler.OBJECT_PAGE_SIZE) {
313             adjustBreaker(BigObjectArray.estimateRamBytes(size), false);
314             return new BigObjectArray&lt;&gt;(size, this);
315         } else if (size &gt;= PageCacheRecycler.OBJECT_PAGE_SIZE / 2 &amp;&amp; recycler != null) {
316             final Recycler.V&lt;Object[]&gt; page = recycler.objectPage();
317             return validate(new ObjectArrayWrapper&lt;&gt;(this, page.v(), size, page));
318         } else {
319             return validate(new ObjectArrayWrapper&lt;&gt;(this, new Object[(int) size], size, null));
320         }
321     }
322     public &lt;T&gt; ObjectArray&lt;T&gt; resize(ObjectArray&lt;T&gt; array, long size) {
323         if (array instanceof BigObjectArray) {
324             return resizeInPlace((BigObjectArray&lt;T&gt;) array, size);
325         } else {
326             final ObjectArray&lt;T&gt; newArray = newObjectArray(size);
327             for (long i = 0, end = Math.min(size, array.size()); i &lt; end; ++i) {
328                 newArray.set(i, array.get(i));
329             }
330             array.close();
331             return newArray;
332         }
333     }
334     public &lt;T&gt; ObjectArray&lt;T&gt; grow(ObjectArray&lt;T&gt; array, long minSize) {
335         if (minSize &lt;= array.size()) {
336             return array;
337         }
338         final long newSize = overSize(minSize, PageCacheRecycler.OBJECT_PAGE_SIZE, RamUsageEstimator.NUM_BYTES_OBJECT_REF);
339         return resize(array, newSize);
340     }
341 }
</pre>
</div>
</div>
<div class="modal" id="myModal" style="display:none;"><div class="modal-content"><span class="close">x</span><p></p><div class="row"><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 1</div><div class="column" style="font-weight: bold;text-decoration: underline">Fragment from File 2</div></div><div class="row"><div class="column" id="column1">Column 1</div><div class="column" id="column2">Column 2</div></div></div></div><script>var modal=document.getElementById("myModal"),span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none"};window.onclick=function(a){a.target==modal&&(modal.style.display="none")};function openModal(a){console.log("the color is "+a);let b=getCodes(a);console.log(b);var c=document.getElementById("column1");c.innerText=b[0];var d=document.getElementById("column2");d.innerText=b[1];c.style.color=a;c.style.fontWeight="bold";d.style.fontWeight="bold";d.style.color=a;var e=document.getElementById("myModal");e.style.display="block"}function getCodes(a){for(var b=document.getElementsByTagName("font"),c=[],d=0;d<b.length;d++)b[d].attributes.color.nodeValue===a&&"-"!==b[d].innerText&&c.push(b[d].innerText);return c}</script><script>const params=window.location.search;const urlParams=new URLSearchParams(params);const searchText=urlParams.get('lines');let lines=searchText.split(',');for(let line of lines){const elements=document.getElementsByTagName('td');for(let i=0;i<elements.length;i++){if(elements[i].innerText.includes(line)){elements[i].style.background='green';break;}}}</script></body>
</html>
