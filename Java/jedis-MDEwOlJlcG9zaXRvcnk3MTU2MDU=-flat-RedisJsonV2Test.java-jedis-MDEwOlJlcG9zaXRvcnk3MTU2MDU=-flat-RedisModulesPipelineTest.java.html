
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Tokens: 17, <button onclick='openModal()' class='match'>CODE CLONE</button></h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RedisJsonV2Test.java</h3>
            <pre><code>1  package redis.clients.jedis.modules.json;
2  import static java.util.Collections.singletonList;
3  import static org.junit.Assert.*;
4  import static redis.clients.jedis.json.Path2.ROOT_PATH;
5  import static redis.clients.jedis.modules.json.JsonObjects.*;
6  import com.google.gson.Gson;
7  import java.util.Arrays;
8  import java.util.Collections;
9  import java.util.List;
10  import org.hamcrest.MatcherAssert;
11  import org.hamcrest.Matchers;
12  import org.json.JSONArray;
13  import org.json.JSONObject;
14  import org.junit.Before;
15  import org.junit.BeforeClass;
16  import org.junit.Test;
17  import redis.clients.jedis.exceptions.JedisDataException;
18  import redis.clients.jedis.json.JsonSetParams;
19  import redis.clients.jedis.json.Path2;
20  import redis.clients.jedis.json.commands.RedisJsonV2Commands;
21  import redis.clients.jedis.modules.RedisModuleCommandsTestBase;
<span onclick='openModal()' class='match'>22  public class RedisJsonV2Test extends RedisModuleCommandsTestBase {
23    private static final Gson gson = new Gson();
24    private RedisJsonV2Commands jsonClient;
</span>25    @BeforeClass
26    public static void prepare() {
27      RedisModuleCommandsTestBase.prepare();
28    }
29    @Before
30    @Override
31    public void setUp() {
32      super.setUp();
33      this.jsonClient = super.client;
34    }
35    @Test
36    public void basicSetGetShouldSucceed() {
37      jsonClient.jsonSetWithEscape(&quot;null&quot;, ROOT_PATH, (Object) null);
38      assertJsonArrayEquals(jsonArray((Object) null), jsonClient.jsonGet(&quot;null&quot;, ROOT_PATH));
39      jsonClient.jsonSetWithEscape(&quot;str&quot;, &quot;strong&quot;);
40      assertEquals(&quot;strong&quot;, jsonClient.jsonGet(&quot;str&quot;));
41      IRLObject obj = new IRLObject();
42      jsonClient.jsonSetWithEscape(&quot;obj&quot;, obj);
43      Object expected = gson.fromJson(gson.toJson(obj), Object.class);
44      assertTrue(expected.equals(jsonClient.jsonGet(&quot;obj&quot;)));
45      Path2 p = Path2.of(&quot;.str&quot;);
46      jsonClient.jsonSet(&quot;obj&quot;, p, gson.toJson(&quot;strung&quot;));
47      assertJsonArrayEquals(jsonArray(&quot;strung&quot;), jsonClient.jsonGet(&quot;obj&quot;, p));
48    }
49    @Test
50    public void setExistingPathOnlyIfExistsShouldSucceed() {
51      jsonClient.jsonSetWithEscape(&quot;obj&quot;, new IRLObject());
52      Path2 p = Path2.of(&quot;.str&quot;);
53      jsonClient.jsonSetWithEscape(&quot;obj&quot;, p, &quot;strangle&quot;, JsonSetParams.jsonSetParams().xx());
54      assertJsonArrayEquals(jsonArray(&quot;strangle&quot;), jsonClient.jsonGet(&quot;obj&quot;, p));
55    }
56    @Test
57    public void setNonExistingOnlyIfNotExistsShouldSucceed() {
58      jsonClient.jsonSet(&quot;obj&quot;, gson.toJson(new IRLObject()));
59      Path2 p = Path2.of(&quot;.none&quot;);
60      jsonClient.jsonSet(&quot;obj&quot;, p, gson.toJson(&quot;strangle&quot;), JsonSetParams.jsonSetParams().nx());
61      assertJsonArrayEquals(jsonArray(&quot;strangle&quot;), jsonClient.jsonGet(&quot;obj&quot;, p));
62    }
63    @Test
64    public void setWithoutAPathDefaultsToRootPath() {
65      String objStr = gson.toJson(new IRLObject());
66      jsonClient.jsonSet(&quot;obj1&quot;, new JSONObject(objStr));
67      jsonClient.jsonSetWithEscape(&quot;obj1&quot;, (Object) &quot;strangle&quot;, JsonSetParams.jsonSetParams().xx());
68      assertJsonArrayEquals(jsonArray(&quot;strangle&quot;), jsonClient.jsonGet(&quot;obj1&quot;, ROOT_PATH));
69    }
70    @Test
71    public void setExistingPathOnlyIfNotExistsShouldFail() {
72      jsonClient.jsonSetWithEscape(&quot;obj&quot;, new IRLObject());
73      Path2 p = Path2.of(&quot;.str&quot;);
74      assertNull(jsonClient.jsonSetWithEscape(&quot;obj&quot;, p, &quot;strangle&quot;, JsonSetParams.jsonSetParams().nx()));
75    }
76    @Test
77    public void setNonExistingPathOnlyIfExistsShouldFail() {
78      jsonClient.jsonSetWithEscape(&quot;obj&quot;, new IRLObject());
79      Path2 p = Path2.of(&quot;.none&quot;);
80      assertNull(jsonClient.jsonSetWithEscape(&quot;obj&quot;, p, &quot;strangle&quot;, JsonSetParams.jsonSetParams().xx()));
81    }
82    @Test(expected = JedisDataException.class)
83    public void setException() {
84      jsonClient.jsonSet(&quot;test&quot;, Path2.of(&quot;.foo&quot;), &quot;bar&quot;);
85    }
86    @Test
87    public void getMultiplePathsShouldSucceed() {
88      IRLObject obj = new IRLObject();
89      jsonClient.jsonSetWithEscape(&quot;obj&quot;, obj);
90      JSONObject result = (JSONObject) jsonClient.jsonGet(&quot;obj&quot;, Path2.of(&quot;bool&quot;), Path2.of(&quot;str&quot;));
91      assertJsonArrayEquals(jsonArray(true), result.get(&quot;$.bool&quot;));
92      assertJsonArrayEquals(jsonArray(&quot;string&quot;), result.get(&quot;$.str&quot;));
93    }
94    @Test
95    public void getMultiLevels() {
96      JSONObject obj = new JSONObject();
97      obj.put(&quot;foo&quot;, &quot;John&quot;);
98      JSONObject inner = new JSONObject();
99      inner.put(&quot;foo&quot;, &quot;Jane&quot;);
100      obj.put(&quot;bar&quot;, inner);
101      jsonClient.jsonSet(&quot;multi&quot;, obj);
102      assertJsonArrayEquals(jsonArray(&quot;John&quot;, &quot;Jane&quot;), jsonClient.jsonGet(&quot;multi&quot;, new Path2(&quot;..foo&quot;)));
103    }
104    @Test
105    public void toggle() {
106      IRLObject obj = new IRLObject();
107      jsonClient.jsonSetWithEscape(&quot;obj&quot;, obj);
108      Path2 pbool = Path2.of(&quot;.bool&quot;);
109      assertJsonArrayEquals(jsonArray(true), jsonClient.jsonGet(&quot;obj&quot;, pbool));
110      jsonClient.jsonToggle(&quot;obj&quot;, pbool);
111      assertJsonArrayEquals(jsonArray(false), jsonClient.jsonGet(&quot;obj&quot;, pbool));
112      jsonClient.jsonToggle(&quot;obj&quot;, pbool);
113      assertJsonArrayEquals(jsonArray(true), jsonClient.jsonGet(&quot;obj&quot;, pbool));
114      Path2 pstr = Path2.of(&quot;.str&quot;);
115      assertEquals(singletonList(null), jsonClient.jsonToggle(&quot;obj&quot;, pstr));
116      assertJsonArrayEquals(jsonArray(&quot;string&quot;), jsonClient.jsonGet(&quot;obj&quot;, pstr));
117    }
118    @Test
119    public void getAbsent() {
120      jsonClient.jsonSetWithEscape(&quot;test&quot;, ROOT_PATH, &quot;foo&quot;);
121      assertJsonArrayEquals(jsonArray(), jsonClient.jsonGet(&quot;test&quot;, Path2.of(&quot;.bar&quot;)));
122    }
123    @Test
124    public void delValidShouldSucceed() {
125      jsonClient.jsonSetWithEscape(&quot;obj&quot;, ROOT_PATH, new IRLObject());
126      assertEquals(1L, jsonClient.jsonDel(&quot;obj&quot;, Path2.of(&quot;.str&quot;)));
127      assertTrue(client.exists(&quot;obj&quot;));
128      assertEquals(1L, jsonClient.jsonDel(&quot;obj&quot;));
129      assertFalse(client.exists(&quot;obj&quot;));
130    }
131    @Test
132    public void delNonExistingPathsAreIgnored() {
133      jsonClient.jsonSetWithEscape(&quot;foobar&quot;, ROOT_PATH, new FooBarObject());
134      assertEquals(0L, jsonClient.jsonDel(&quot;foobar&quot;, Path2.of(&quot;.foo[1]&quot;)));
135    }
136    @Test
137    public void typeChecksShouldSucceed() {
138      jsonClient.jsonSet(&quot;foobar&quot;, ROOT_PATH, new JSONObject(gson.toJson(new FooBarObject())));
139      assertEquals(singletonList(Object.class), jsonClient.jsonType(&quot;foobar&quot;, ROOT_PATH));
140      assertEquals(singletonList(String.class), jsonClient.jsonType(&quot;foobar&quot;, Path2.of(&quot;.foo&quot;)));
141      assertEquals(singletonList(int.class), jsonClient.jsonType(&quot;foobar&quot;, Path2.of(&quot;.fooI&quot;)));
142      assertEquals(singletonList(float.class), jsonClient.jsonType(&quot;foobar&quot;, Path2.of(&quot;.fooF&quot;)));
143      assertEquals(singletonList(List.class), jsonClient.jsonType(&quot;foobar&quot;, Path2.of(&quot;.fooArr&quot;)));
144      assertEquals(singletonList(boolean.class), jsonClient.jsonType(&quot;foobar&quot;, Path2.of(&quot;.fooB&quot;)));
145      assertEquals(Collections.emptyList(), jsonClient.jsonType(&quot;foobar&quot;, Path2.of(&quot;.fooErr&quot;)));
146    }
147    @Test
148    public void testJsonMerge() {
149      JSONObject json = new JSONObject(&quot;{\&quot;person\&quot;:{\&quot;name\&quot;:\&quot;John Doe\&quot;,\&quot;age\&quot;:25,\&quot;address\&quot;:{\&quot;home\&quot;:\&quot;123 Main Street\&quot;},\&quot;phone\&quot;:\&quot;123-456-7890\&quot;}}&quot;);
150      assertEquals(&quot;OK&quot;, jsonClient.jsonSet(&quot;test_merge&quot;, json));
151      json = new JSONObject(&quot;{\&quot;person\&quot;:{\&quot;name\&quot;:\&quot;John Doe\&quot;,\&quot;age\&quot;:30,\&quot;address\&quot;:{\&quot;home\&quot;:\&quot;123 Main Street\&quot;},\&quot;phone\&quot;:\&quot;123-456-7890\&quot;}}&quot;);
152      assertEquals(&quot;OK&quot;, jsonClient.jsonMerge(&quot;test_merge&quot;, Path2.of(&quot;$&quot;), &quot;{\&quot;person\&quot;:{\&quot;age\&quot;:30}}&quot;));
153      assertJsonArrayEquals(jsonArray(json), jsonClient.jsonGet(&quot;test_merge&quot;, Path2.of(&quot;$&quot;)));
154      assertEquals(&quot;OK&quot;, jsonClient.jsonMerge(&quot;test_merge&quot;, Path2.of(&quot;$.person.address&quot;), &quot;{\&quot;work\&quot;:\&quot;Redis office\&quot;}&quot;));
155      json = new JSONObject(&quot;{\&quot;person\&quot;:{\&quot;name\&quot;:\&quot;John Doe\&quot;,\&quot;age\&quot;:30,\&quot;address\&quot;:{\&quot;home\&quot;:\&quot;123 Main Street\&quot;,\&quot;work\&quot;:\&quot;Redis office\&quot;},\&quot;phone\&quot;:\&quot;123-456-7890\&quot;}}&quot;);
156      assertJsonArrayEquals(jsonArray(json), jsonClient.jsonGet(&quot;test_merge&quot;, Path2.of(&quot;$&quot;)));
157      assertEquals(&quot;OK&quot;, jsonClient.jsonMerge(&quot;test_merge&quot;, Path2.of(&quot;$.person&quot;), &quot;{\&quot;age\&quot;:null}&quot;));
158      json = new JSONObject(&quot;{\&quot;person\&quot;:{\&quot;name\&quot;:\&quot;John Doe\&quot;,\&quot;address\&quot;:{\&quot;home\&quot;:\&quot;123 Main Street\&quot;,\&quot;work\&quot;:\&quot;Redis office\&quot;},\&quot;phone\&quot;:\&quot;123-456-7890\&quot;}}&quot;);
159      assertJsonArrayEquals(jsonArray(json), jsonClient.jsonGet(&quot;test_merge&quot;, Path2.of(&quot;$&quot;)));
160      assertEquals(1L, client.del(&quot;test_merge&quot;));
161    }
162    @Test
163    public void testJsonMergeArray()
164    {
165      JSONObject json = new JSONObject(&quot;{\&quot;a\&quot;:{\&quot;b\&quot;:{\&quot;c\&quot;:[\&quot;d\&quot;,\&quot;e\&quot;]}}}&quot;);
166      assertEquals(&quot;OK&quot;, jsonClient.jsonSet(&quot;test_merge_array&quot;, Path2.of(&quot;$&quot;), json));
167      assertEquals(&quot;OK&quot;, jsonClient.jsonMerge(&quot;test_merge_array&quot;, Path2.of(&quot;$.a.b.c&quot;), &quot;[\&quot;f\&quot;]&quot;));
168      json = new JSONObject(&quot;{\&quot;a\&quot;:{\&quot;b\&quot;:{\&quot;c\&quot;:[\&quot;f\&quot;]}}}&quot;);
169      assertJsonArrayEquals(jsonArray(json), jsonClient.jsonGet(&quot;test_merge_array&quot;, Path2.of(&quot;$&quot;)));
170      assertEquals(&quot;OK&quot;, jsonClient.jsonSet(&quot;test_merge_array&quot;, Path2.of(&quot;$&quot;), &quot;{\&quot;a\&quot;:{\&quot;b\&quot;:{\&quot;c\&quot;:\&quot;d\&quot;}}}&quot;));
171      assertEquals(&quot;OK&quot;, jsonClient.jsonMerge(&quot;test_merge_array&quot;, Path2.of(&quot;$.a.b.c&quot;), &quot;[\&quot;f\&quot;]&quot;));
172      json = new JSONObject(&quot;{\&quot;a\&quot;:{\&quot;b\&quot;:{\&quot;c\&quot;:[\&quot;f\&quot;]}}}&quot;);
173      assertJsonArrayEquals(jsonArray(json), jsonClient.jsonGet(&quot;test_merge_array&quot;, Path2.of(&quot;$&quot;)));
174      assertEquals(&quot;OK&quot;, jsonClient.jsonSet(&quot;test_merge_array&quot;, Path2.of(&quot;$&quot;), &quot;{\&quot;a\&quot;:{\&quot;b\&quot;:{\&quot;c\&quot;:[\&quot;d\&quot;,\&quot;e\&quot;]}}}&quot;));
175      assertEquals(&quot;OK&quot;, jsonClient.jsonMerge(&quot;test_merge_array&quot;, Path2.of(&quot;$.a.b&quot;), &quot;{\&quot;c\&quot;:null}&quot;));
176      json = new JSONObject(&quot;{\&quot;a\&quot;:{\&quot;b\&quot;:{}}}&quot;);
177      assertJsonArrayEquals(jsonArray(json), jsonClient.jsonGet(&quot;test_merge_array&quot;, Path2.of(&quot;$&quot;)));
178    }
179    @Test
180    public void mgetWithPathWithAllKeysExist() {
181      Baz baz1 = new Baz(&quot;quuz1&quot;, &quot;grault1&quot;, &quot;waldo1&quot;);
182      Baz baz2 = new Baz(&quot;quuz2&quot;, &quot;grault2&quot;, &quot;waldo2&quot;);
183      Qux qux1 = new Qux(&quot;quux1&quot;, &quot;corge1&quot;, &quot;garply1&quot;, baz1);
184      Qux qux2 = new Qux(&quot;quux2&quot;, &quot;corge2&quot;, &quot;garply2&quot;, baz2);
185      jsonClient.jsonSet(&quot;qux1&quot;, new JSONObject(gson.toJson(qux1)));
186      jsonClient.jsonSet(&quot;qux2&quot;, new JSONObject(gson.toJson(qux2)));
187      List&lt;JSONArray&gt; list = jsonClient.jsonMGet(Path2.of(&quot;baz&quot;), &quot;qux1&quot;, &quot;qux2&quot;);
188      assertEquals(2, list.size());
189      assertJsonArrayEquals(jsonArray(new JSONObject(gson.toJson(baz1))), list.get(0));
190      assertJsonArrayEquals(jsonArray(new JSONObject(gson.toJson(baz2))), list.get(1));
191    }
192    @Test
193    public void mgetAtRootPathWithMissingKeys() {
194      Baz baz1 = new Baz(&quot;quuz1&quot;, &quot;grault1&quot;, &quot;waldo1&quot;);
195      Baz baz2 = new Baz(&quot;quuz2&quot;, &quot;grault2&quot;, &quot;waldo2&quot;);
196      Qux qux1 = new Qux(&quot;quux1&quot;, &quot;corge1&quot;, &quot;garply1&quot;, baz1);
197      Qux qux2 = new Qux(&quot;quux2&quot;, &quot;corge2&quot;, &quot;garply2&quot;, baz2);
198      jsonClient.jsonSetWithEscape(&quot;qux1&quot;, qux1);
199      jsonClient.jsonSetWithEscape(&quot;qux2&quot;, qux2);
200      List&lt;JSONArray&gt; list = jsonClient.jsonMGet(&quot;qux1&quot;, &quot;qux2&quot;, &quot;qux3&quot;);
201      assertEquals(3, list.size());
202      assertNull(list.get(2));
203      list.removeAll(singletonList(null));
204      assertEquals(2, list.size());
205    }
206    @Test
207    public void arrLen() {
208      jsonClient.jsonSet(&quot;arr&quot;, ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
209      assertEquals(singletonList(5L), jsonClient.jsonArrLen(&quot;arr&quot;, ROOT_PATH));
210    }
211    @Test
212    public void clearArray() {
213      jsonClient.jsonSet(&quot;foobar&quot;, ROOT_PATH, gson.toJson(new FooBarObject()));
214      Path2 arrPath = Path2.of(&quot;.fooArr&quot;);
215      assertEquals(singletonList(3L), jsonClient.jsonArrLen(&quot;foobar&quot;, arrPath));
216      assertEquals(1L, jsonClient.jsonClear(&quot;foobar&quot;, arrPath));
217      assertEquals(singletonList(0L), jsonClient.jsonArrLen(&quot;foobar&quot;, arrPath));
218      Path2 strPath = Path2.of(&quot;.foo&quot;);
219      assertEquals(0L, jsonClient.jsonClear(&quot;foobar&quot;, strPath));
220      assertJsonArrayEquals(jsonArray(&quot;bar&quot;), jsonClient.jsonGet(&quot;foobar&quot;, strPath));
221    }
222    @Test
223    public void clearObject() {
224      Baz baz = new Baz(&quot;quuz&quot;, &quot;grault&quot;, &quot;waldo&quot;);
225      Qux qux = new Qux(&quot;quux&quot;, &quot;corge&quot;, &quot;garply&quot;, baz);
226      jsonClient.jsonSet(&quot;qux&quot;, gson.toJson(qux));
227      Path2 objPath = Path2.of(&quot;.baz&quot;);
228      assertEquals(1L, jsonClient.jsonClear(&quot;qux&quot;, objPath));
229      assertJsonArrayEquals(jsonArray(new JSONObject()), jsonClient.jsonGet(&quot;qux&quot;, objPath));
230    }
231    @Test
232    public void arrAppendSameType() {
233      String json = &quot;{ a: &#x27;hello&#x27;, b: [1, 2, 3], c: { d: [&#x27;ello&#x27;] }}&quot;;
234      jsonClient.jsonSet(&quot;test_arrappend&quot;, ROOT_PATH, new JSONObject(json));
235      assertEquals(singletonList(6L), jsonClient.jsonArrAppend(&quot;test_arrappend&quot;, Path2.of(&quot;.b&quot;), 4, 5, 6));
236      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3, 4, 5, 6)), jsonClient.jsonGet(&quot;test_arrappend&quot;, Path2.of(&quot;.b&quot;)));
237    }
238    @Test
239    public void arrAppendMultipleTypes() {
240      Object fooObject = gson.toJson(&quot;foo&quot;);
241      Object trueObject = gson.toJson(true);
242      Object nullObject = gson.toJson(null);
243      String json = &quot;{ a: &#x27;hello&#x27;, b: [1, 2, 3], c: { d: [&#x27;ello&#x27;] }}&quot;;
244      jsonClient.jsonSet(&quot;test_arrappend&quot;, ROOT_PATH, new JSONObject(json));
245      assertEquals(singletonList(6L), jsonClient.jsonArrAppend(&quot;test_arrappend&quot;, Path2.of(&quot;.b&quot;), fooObject, trueObject, nullObject));
246      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3, &quot;foo&quot;, true, null)), jsonClient.jsonGet(&quot;test_arrappend&quot;, Path2.of(&quot;.b&quot;)));
247    }
248    @Test
249    public void arrAppendMultipleTypesWithDeepPath() {
250      String json = &quot;{ a: &#x27;hello&#x27;, b: [1, 2, 3], c: { d: [&#x27;ello&#x27;] }}&quot;;
251      jsonClient.jsonSet(&quot;test_arrappend&quot;, ROOT_PATH, new JSONObject(json));
252      assertEquals(singletonList(4L), jsonClient.jsonArrAppendWithEscape(&quot;test_arrappend&quot;, Path2.of(&quot;.c.d&quot;), &quot;foo&quot;, true, null));
253      assertJsonArrayEquals(jsonArray(jsonArray(&quot;ello&quot;, &quot;foo&quot;, true, null)), jsonClient.jsonGet(&quot;test_arrappend&quot;, Path2.of(&quot;.c.d&quot;)));
254    }
255    @Test
256    public void arrAppendAgaintsEmptyArray() {
257      String json = &quot;{ a: &#x27;hello&#x27;, b: [1, 2, 3], c: { d: [] }}&quot;;
258      jsonClient.jsonSet(&quot;test_arrappend&quot;, ROOT_PATH, new JSONObject(json));
259      assertEquals(singletonList(3L), jsonClient.jsonArrAppendWithEscape(&quot;test_arrappend&quot;, Path2.of(&quot;.c.d&quot;), &quot;a&quot;, &quot;b&quot;, &quot;c&quot;));
260      assertJsonArrayEquals(jsonArray(jsonArray(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)), jsonClient.jsonGet(&quot;test_arrappend&quot;, Path2.of(&quot;.c.d&quot;)));
261    }
262    @Test
263    public void arrAppendPathIsNotArray() {
264      String json = &quot;{ a: &#x27;hello&#x27;, b: [1, 2, 3], c: { d: [&#x27;ello&#x27;] }}&quot;;
265      jsonClient.jsonSet(&quot;test_arrappend&quot;, ROOT_PATH, new JSONObject(json));
266      assertEquals(singletonList(null), jsonClient.jsonArrAppend(&quot;test_arrappend&quot;, Path2.of(&quot;.a&quot;), 1));
267      assertEquals(singletonList(null), jsonClient.jsonArrAppend(&quot;test_arrappend&quot;, Path2.of(&quot;.a&quot;), gson.toJson(1)));
268      assertEquals(singletonList(null), jsonClient.jsonArrAppendWithEscape(&quot;test_arrappend&quot;, Path2.of(&quot;.a&quot;), 1));
269    }
270    @Test(expected = JedisDataException.class)
271    public void arrIndexAbsentKey() {
272      jsonClient.jsonArrIndexWithEscape(&quot;quxquux&quot;, ROOT_PATH, new JSONObject());
273    }
274    @Test
275    public void arrIndexWithInts() {
276      jsonClient.jsonSetWithEscape(&quot;quxquux&quot;, ROOT_PATH, new int[]{8, 6, 7, 5, 3, 0, 9});
277      assertEquals(singletonList(2L), jsonClient.jsonArrIndexWithEscape(&quot;quxquux&quot;, ROOT_PATH, 7));
278      assertEquals(singletonList(-1L), jsonClient.jsonArrIndexWithEscape(&quot;quxquux&quot;, ROOT_PATH, &quot;7&quot;));
279    }
280    @Test
281    public void arrIndexWithStrings() {
282      jsonClient.jsonSetWithEscape(&quot;quxquux&quot;, ROOT_PATH, new String[]{&quot;8&quot;, &quot;6&quot;, &quot;7&quot;, &quot;5&quot;, &quot;3&quot;, &quot;0&quot;, &quot;9&quot;});
283      assertEquals(singletonList(2L), jsonClient.jsonArrIndexWithEscape(&quot;quxquux&quot;, ROOT_PATH, &quot;7&quot;));
284    }
285    @Test
286    public void arrIndexWithStringsAndPath() {
287      jsonClient.jsonSetWithEscape(&quot;foobar&quot;, ROOT_PATH, new FooBarObject());
288      assertEquals(singletonList(1L), jsonClient.jsonArrIndexWithEscape(&quot;foobar&quot;, Path2.of(&quot;.fooArr&quot;), &quot;b&quot;));
289    }
290    @Test
291    public void arrIndexNonExistentPath() {
292      jsonClient.jsonSet(&quot;foobar&quot;, ROOT_PATH, gson.toJson(new FooBarObject()));
293      assertEquals(Collections.emptyList(), jsonClient.jsonArrIndex(&quot;foobar&quot;, Path2.of(&quot;.barArr&quot;), gson.toJson(&quot;x&quot;)));
294    }
295    @Test
296    public void arrInsert() {
297      String json = &quot;[&#x27;hello&#x27;, &#x27;world&#x27;, true, 1, 3, null, false]&quot;;
298      jsonClient.jsonSet(&quot;test_arrinsert&quot;, ROOT_PATH, new JSONArray(json));
299      assertEquals(singletonList(8L), jsonClient.jsonArrInsertWithEscape(&quot;test_arrinsert&quot;, ROOT_PATH, 1, &quot;foo&quot;));
300      assertJsonArrayEquals(jsonArray(jsonArray(&quot;hello&quot;, &quot;foo&quot;, &quot;world&quot;, true, 1, 3, null, false)),
301          jsonClient.jsonGet(&quot;test_arrinsert&quot;, ROOT_PATH));
302    }
303    @Test
304    public void arrInsertWithNegativeIndex() {
305      String json = &quot;[&#x27;hello&#x27;, &#x27;world&#x27;, true, 1, 3, null, false]&quot;;
306      jsonClient.jsonSet(&quot;test_arrinsert&quot;, ROOT_PATH, new JSONArray(json));
307      assertEquals(singletonList(8L), jsonClient.jsonArrInsertWithEscape(&quot;test_arrinsert&quot;, ROOT_PATH, -1, &quot;foo&quot;));
308      assertJsonArrayEquals(jsonArray(jsonArray(&quot;hello&quot;, &quot;world&quot;, true, 1, 3, null, &quot;foo&quot;, false)),
309          jsonClient.jsonGet(&quot;test_arrinsert&quot;, ROOT_PATH));
310    }
311    @Test
312    public void arrPop() {
313      jsonClient.jsonSet(&quot;arr&quot;, ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
314      assertEquals(singletonList(4d), jsonClient.jsonArrPop(&quot;arr&quot;, ROOT_PATH));
315      assertEquals(singletonList(3d), jsonClient.jsonArrPop(&quot;arr&quot;, ROOT_PATH, -1));
316      assertEquals(singletonList(0d), jsonClient.jsonArrPop(&quot;arr&quot;, ROOT_PATH, 0));
317    }
318    @Test
319    public void arrTrim() {
320      jsonClient.jsonSet(&quot;arr&quot;, ROOT_PATH, new JSONArray(new int[]{0, 1, 2, 3, 4}));
321      assertEquals(singletonList(3L), jsonClient.jsonArrTrim(&quot;arr&quot;, ROOT_PATH, 1, 3));
322      assertJsonArrayEquals(jsonArray(jsonArray(1, 2, 3)), jsonClient.jsonGet(&quot;arr&quot;, ROOT_PATH));
323    }
324    @Test
325    public void strAppend() {
326      jsonClient.jsonSet(&quot;str&quot;, ROOT_PATH, gson.toJson(&quot;foo&quot;));
327      assertEquals(singletonList(6L), jsonClient.jsonStrAppend(&quot;str&quot;, ROOT_PATH, &quot;bar&quot;));
328      assertEquals(&quot;foobar&quot;, jsonClient.jsonGet(&quot;str&quot;));
329    }
330    @Test
331    public void strLen() {
332      jsonClient.jsonSetWithEscape(&quot;str&quot;, &quot;foobar&quot;);
333      assertEquals(singletonList(6L), jsonClient.jsonStrLen(&quot;str&quot;, ROOT_PATH));
334    }
335    @Test
336    public void numIncrBy() {
337      jsonClient.jsonSet(&quot;doc&quot;, &quot;{\&quot;a\&quot;:\&quot;b\&quot;,\&quot;b\&quot;:[{\&quot;a\&quot;:2}, {\&quot;a\&quot;:5}, {\&quot;a\&quot;:\&quot;c\&quot;}]}&quot;);
338      assertJsonArrayEquals(jsonArray((Object) null), jsonClient.jsonNumIncrBy(&quot;doc&quot;, Path2.of(&quot;.a&quot;), 1d));
339      assertJsonArrayEquals(jsonArray(null, 4, 7, null), jsonClient.jsonNumIncrBy(&quot;doc&quot;, Path2.of(&quot;..a&quot;), 2d));
340      assertJsonArrayEquals(jsonArray((Object) null), jsonClient.jsonNumIncrBy(&quot;doc&quot;, Path2.of(&quot;..b&quot;), 0d));
341      assertJsonArrayEquals(jsonArray(), jsonClient.jsonNumIncrBy(&quot;doc&quot;, Path2.of(&quot;..c&quot;), 0d));
342    }
343    @Test
344    public void obj() {
345      String json = &quot;{\&quot;a\&quot;:[3], \&quot;nested\&quot;: {\&quot;a\&quot;: {\&quot;b\&quot;:2, \&quot;c\&quot;: 1}}}&quot;;
346      jsonClient.jsonSet(&quot;doc&quot;, ROOT_PATH, json);
347      assertEquals(Arrays.asList(2L), jsonClient.jsonObjLen(&quot;doc&quot;, ROOT_PATH));
348      assertEquals(Arrays.asList(Arrays.asList(&quot;a&quot;, &quot;nested&quot;)), jsonClient.jsonObjKeys(&quot;doc&quot;, ROOT_PATH));
349      assertEquals(Arrays.asList(null, 2L), jsonClient.jsonObjLen(&quot;doc&quot;, Path2.of(&quot;..a&quot;)));
350      assertEquals(Arrays.asList(null, Arrays.asList(&quot;b&quot;, &quot;c&quot;)), jsonClient.jsonObjKeys(&quot;doc&quot;, Path2.of(&quot;..a&quot;)));
351    }
352    @Test
353    public void debugMemory() {
354      assertEquals(Collections.emptyList(), jsonClient.jsonDebugMemory(&quot;json&quot;, ROOT_PATH));
355      jsonClient.jsonSet(&quot;json&quot;, new JSONObject(&quot;{ foo: &#x27;bar&#x27;, bar: { foo: 10 }}&quot;));
356      assertEquals(1, jsonClient.jsonDebugMemory(&quot;json&quot;, ROOT_PATH).size());
357      assertEquals(2, jsonClient.jsonDebugMemory(&quot;json&quot;, Path2.of(&quot;$..foo&quot;)).size());
358      assertEquals(1, jsonClient.jsonDebugMemory(&quot;json&quot;, Path2.of(&quot;$..bar&quot;)).size());
359    }
360    @Test
361    public void resp() {
362      assertNull(jsonClient.jsonResp(&quot;resp&quot;, ROOT_PATH));
363      String json = &quot;{\&quot;foo\&quot;: {\&quot;hello\&quot;:\&quot;world\&quot;}, \&quot;bar\&quot;: [null, 3, 2.5, true]}&quot;;
364      jsonClient.jsonSet(&quot;resp&quot;, ROOT_PATH, json);
365      List&lt;List&lt;Object&gt;&gt; fullResp = jsonClient.jsonResp(&quot;resp&quot;, ROOT_PATH);
366      assertEquals(1, fullResp.size());
367      List&lt;Object&gt; resp = fullResp.get(0);
368      assertEquals(&quot;{&quot;, resp.get(0));
369      assertEquals(&quot;foo&quot;, resp.get(1));
370      assertEquals(Arrays.asList(&quot;{&quot;, &quot;hello&quot;, &quot;world&quot;), resp.get(2));
371      assertEquals(&quot;bar&quot;, resp.get(3));
372      List&lt;Object&gt; arr = (List&lt;Object&gt;) resp.get(4);
373      assertEquals(&quot;[&quot;, arr.get(0));
374      assertNull(arr.get(1));
375      assertEquals(Long.valueOf(3), arr.get(2));
376      MatcherAssert.assertThat(arr.get(3), Matchers.isOneOf(&quot;2.5&quot;, 2.5));
377      assertEquals(&quot;true&quot;, arr.get(4));
378    }
379    private void assertJsonArrayEquals(JSONArray a, Object _b) {
380      if (!(_b instanceof JSONArray)) {
381        fail(&quot;Actual value is not JSONArray.&quot;);
382      }
383      JSONArray b = (JSONArray) _b;
384      assertEquals(&quot;JSONArray length mismatch&quot;, a.length(), b.length());
385      int length = a.length();
386      for (int index = 0; index &lt; length; index++) {
387        if (a.isNull(index)) {
388          assertTrue(index + &quot;&#x27;th element is not null&quot;, b.isNull(index));
389          continue;
390        }
391        Object ia = a.get(index);
392        Object ib = b.get(index);
393        if (ia instanceof JSONArray) {
394          assertJsonArrayEquals((JSONArray) ia, ib);
395        } else if (ia instanceof JSONObject) {
396          assertJsonObjectEquals((JSONObject) ia, ib);
397        } else if (ia instanceof Number &amp;&amp; ib instanceof Number) {
398          assertEquals(index + &quot;&#x27;th element mismatch&quot;, ((Number) ia).doubleValue(), ((Number) ib).doubleValue(), 0d);
399        } else {
400          assertEquals(index + &quot;&#x27;th element mismatch&quot;, ia, ib);
401        }
402      }
403    }
404    private void assertJsonObjectEquals(JSONObject a, Object _b) {
405      if (!(_b instanceof JSONObject)) {
406        fail(&quot;Actual value is not JSONObject.&quot;);
407      }
408      JSONObject b = (JSONObject) _b;
409      assertEquals(&quot;JSONObject length mismatch&quot;, a.length(), b.length());
410      assertEquals(a.keySet(), b.keySet());
411      for (String key : a.keySet()) {
412        if (a.isNull(key)) {
413          assertTrue(key + &quot;&#x27;s value is not null&quot;, b.isNull(key));
414          continue;
415        }
416        Object oa = a.get(key);
417        Object ob = b.get(key);
418        if (oa instanceof JSONArray) {
419          assertJsonArrayEquals((JSONArray) oa, ob);
420        } else if (oa instanceof JSONObject) {
421          assertJsonObjectEquals((JSONObject) oa, ob);
422        } else {
423          assertEquals(key + &quot;&#x27;s value mismatch&quot;, oa, ob);
424        }
425      }
426    }
427    private static JSONArray jsonArray(Object... objects) {
428      JSONArray arr = new JSONArray();
429      for (Object o : objects) {
430        arr.put(o);
431      }
432      return arr;
433    }
434  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RedisModulesPipelineTest.java</h3>
            <pre><code>1  package redis.clients.jedis.modules;
2  import static org.junit.Assert.assertEquals;
3  import static org.junit.Assert.assertNotNull;
4  import static redis.clients.jedis.json.Path.ROOT_PATH;
5  import static redis.clients.jedis.modules.json.JsonObjects.Baz;
6  import static redis.clients.jedis.modules.json.JsonObjects.IRLObject;
7  import static redis.clients.jedis.search.RediSearchUtil.toStringMap;
8  import com.google.gson.Gson;
9  import java.util.HashMap;
10  import java.util.List;
11  import java.util.Map;
12  import java.util.Collections;
13  import org.json.JSONArray;
14  import org.json.JSONObject;
15  import org.junit.BeforeClass;
16  import org.junit.Test;
17  import redis.clients.jedis.Pipeline;
18  import redis.clients.jedis.Response;
19  import redis.clients.jedis.json.JsonSetParams;
20  import redis.clients.jedis.json.Path;
21  import redis.clients.jedis.json.Path2;
22  import redis.clients.jedis.search.*;
23  import redis.clients.jedis.search.aggr.*;
<span onclick='openModal()' class='match'>24  public class RedisModulesPipelineTest extends RedisModuleCommandsTestBase {
25    private static final Gson gson = new Gson();
26    @BeforeClass
</span>27    public static void prepare() {
28      RedisModuleCommandsTestBase.prepare();
29    }
30    @Test
31    public void search() {
32      Schema sc = new Schema().addTextField(&quot;title&quot;, 1.0).addTextField(&quot;body&quot;, 1.0);
33      String index = &quot;testindex&quot;;
34      Map&lt;String, Object&gt; fields = new HashMap&lt;&gt;();
35      fields.put(&quot;title&quot;, &quot;hello world&quot;);
36      fields.put(&quot;body&quot;, &quot;lorem ipsum&quot;);
37      Pipeline p = (Pipeline) client.pipelined();
38      Response&lt;String&gt; create = p.ftCreate(index, IndexOptions.defaultOptions(), sc);
39      Response&lt;String&gt; alter = p.ftAlter(index, new Schema().addTextField(&quot;foo&quot;, 1.0));
40      p.hset(&quot;doc1&quot;, toStringMap(fields));
41      p.hset(&quot;doc2&quot;, toStringMap(fields));
42      Response&lt;SearchResult&gt; searchResult = p.ftSearch(index, new Query(&quot;hello world&quot;));
43      Response&lt;SearchResult&gt; searchBytesResult = p.ftSearch(index.getBytes(), new Query(&quot;hello world&quot;));
44      Response&lt;AggregationResult&gt; aggregateResult = p.ftAggregate(index, new AggregationBuilder().groupBy(&quot;@title&quot;));
45      Response&lt;String&gt; explain = p.ftExplain(index, new Query(&quot;@title:title_val&quot;));
46      Response&lt;List&lt;String&gt;&gt; explainCLI = p.ftExplainCLI(index, new Query(&quot;@title:title_val&quot;));
47      Response&lt;Map&lt;String, Object&gt;&gt; info = p.ftInfo(index);
48      Response&lt;String&gt; configSet = p.ftConfigSet(&quot;timeout&quot;, &quot;100&quot;);
49      Response&lt;Map&lt;String, String&gt;&gt; configGet = p.ftConfigGet(&quot;*&quot;);
50      Response&lt;String&gt; configSetIndex = p.ftConfigSet(index, &quot;timeout&quot;, &quot;100&quot;);
51      Response&lt;Map&lt;String, String&gt;&gt; configGetIndex = p.ftConfigGet(index, &quot;*&quot;);
52      Response&lt;String&gt; synUpdate = p.ftSynUpdate(index, &quot;foo&quot;, &quot;bar&quot;);
53      Response&lt;Map&lt;String, List&lt;String&gt;&gt;&gt; synDump = p.ftSynDump(index);
54      p.sync();
55      assertEquals(&quot;OK&quot;, create.get());
56      assertEquals(&quot;OK&quot;, alter.get());
57      assertEquals(&quot;OK&quot;, alter.get());
58      assertEquals(2, searchResult.get().getTotalResults());
59      assertEquals(2, searchBytesResult.get().getTotalResults());
60      assertEquals(1, aggregateResult.get().getTotalResults());
61      assertNotNull(explain.get());
62      assertNotNull(explainCLI.get().get(0));
63      assertEquals(index, info.get().get(&quot;index_name&quot;));
64      assertEquals(&quot;OK&quot;, configSet.get());
65      assertEquals(&quot;100&quot;, configGet.get().get(&quot;TIMEOUT&quot;));
66      assertEquals(&quot;OK&quot;, configSetIndex.get());
67      assertEquals(&quot;100&quot;, configGetIndex.get().get(&quot;TIMEOUT&quot;));
68      assertEquals(&quot;OK&quot;, synUpdate.get());
69      Map&lt;String, List&lt;String&gt;&gt; expected = new HashMap&lt;&gt;();
70      expected.put(&quot;bar&quot;, Collections.singletonList(&quot;foo&quot;));
71      assertEquals(expected, synDump.get());
72    }
73    @Test
74    public void jsonV1() {
75      Map&lt;String, String&gt; hm1 = new HashMap&lt;&gt;();
76      hm1.put(&quot;hello&quot;, &quot;world&quot;);
77      hm1.put(&quot;oh&quot;, &quot;snap&quot;);
78      Map&lt;String, Object&gt; hm2 = new HashMap&lt;&gt;();
79      hm2.put(&quot;array&quot;, new String[]{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;});
80      hm2.put(&quot;boolean&quot;, true);
81      hm2.put(&quot;number&quot;, 3);
82      Baz baz1 = new Baz(&quot;quuz1&quot;, &quot;grault1&quot;, &quot;waldo1&quot;);
83      Baz baz2 = new Baz(&quot;quuz2&quot;, &quot;grault2&quot;, &quot;waldo2&quot;);
84      Baz baz3 = new Baz(&quot;quuz3&quot;, &quot;grault3&quot;, &quot;waldo3&quot;);
85      Pipeline p = (Pipeline) client.pipelined();
86      Response&lt;String&gt; set1 = p.jsonSet(&quot;foo&quot;, Path.ROOT_PATH, hm1);
87      Response&lt;Object&gt; get = p.jsonGet(&quot;foo&quot;);
88      Response&lt;Map&gt; getObject = p.jsonGet(&quot;foo&quot;, Map.class);
89      Response&lt;Object&gt; getWithPath = p.jsonGet(&quot;foo&quot;, Path.ROOT_PATH);
90      Response&lt;Map&gt; getObjectWithPath = p.jsonGet(&quot;foo&quot;, Map.class, Path.ROOT_PATH);
91      Response&lt;List&lt;JSONArray&gt;&gt; mget = p.jsonMGet(&quot;foo&quot;);
92      p.jsonSet(&quot;baz&quot;, new JSONObject(gson.toJson(baz1)));
93      Response&lt;List&lt;Baz&gt;&gt; mgetClass = p.jsonMGet(Path.ROOT_PATH, Baz.class, &quot;baz&quot;);
94      Response&lt;Long&gt; strLenPath = p.jsonStrLen(&quot;foo&quot;, new Path(&quot;hello&quot;));
95      Response&lt;Long&gt; strAppPath = p.jsonStrAppend(&quot;foo&quot;, new Path(&quot;hello&quot;), &quot;!&quot;);
96      Response&lt;Long&gt; delPath = p.jsonDel(&quot;foo&quot;, new Path(&quot;hello&quot;));
97      Response&lt;Long&gt; delKey = p.jsonDel(&quot;foo&quot;);
98      Response&lt;String&gt; set2 = p.jsonSet(&quot;foo&quot;, Path.ROOT_PATH, hm2, new JsonSetParams().nx());
99      Response&lt;Object&gt; popPath = p.jsonArrPop(&quot;foo&quot;, new Path(&quot;array&quot;));
100      Response&lt;Object&gt; indexPop = p.jsonArrPop(&quot;foo&quot;, new Path(&quot;array&quot;), 2);
101      Response&lt;Long&gt; append = p.jsonArrAppend(&quot;foo&quot;, new Path(&quot;array&quot;), &quot;b&quot;, &quot;c&quot;, &quot;d&quot;);
102      Response&lt;Long&gt; index = p.jsonArrIndex(&quot;foo&quot;, new Path(&quot;array&quot;), &quot;c&quot;);
103      Response&lt;Long&gt; insert = p.jsonArrInsert(&quot;foo&quot;, new Path(&quot;array&quot;), 0, &quot;x&quot;);
104      Response&lt;Long&gt; arrLenWithPath = p.jsonArrLen(&quot;foo&quot;, new Path(&quot;array&quot;));
105      Response&lt;Long&gt; trim = p.jsonArrTrim(&quot;foo&quot;, new Path(&quot;array&quot;), 1, 4);
106      Response&lt;String&gt; toggle = p.jsonToggle(&quot;foo&quot;, new Path(&quot;boolean&quot;));
107      Response&lt;Class&lt;?&gt;&gt; type = p.jsonType(&quot;foo&quot;, new Path(&quot;boolean&quot;));
108      Response&lt;Class&lt;?&gt;&gt; keyType = p.jsonType(&quot;foo&quot;);
109      Response&lt;Long&gt; clearPath = p.jsonClear(&quot;foo&quot;, new Path(&quot;boolean&quot;));
110      Response&lt;Long&gt; clearKey = p.jsonClear(&quot;foo&quot;);
111      Response&lt;String&gt; set3 = p.jsonSet(&quot;foo&quot;, Path.ROOT_PATH, &quot;newStr&quot;);
112      Response&lt;Long&gt; strLen = p.jsonStrLen(&quot;foo&quot;);
113      Response&lt;Long&gt; strApp = p.jsonStrAppend(&quot;foo&quot;, &quot;?&quot;);
114      Response&lt;String&gt; set4 = p.jsonSetWithEscape(&quot;obj&quot;, new IRLObject());
115      p.jsonSet(&quot;arr&quot;, ROOT_PATH, new int[]{ 0, 1, 2, 3 });
116      Response&lt;Object&gt; pop = p.jsonArrPop(&quot;arr&quot;);
117      Response&lt;Long&gt; arrLen = p.jsonArrLen(&quot;arr&quot;);
118      p.jsonSet(&quot;baz&quot;, ROOT_PATH, new Baz[]{ baz1, baz2, baz3 });
119      Response&lt;Baz&gt; popClass = p.jsonArrPop(&quot;baz&quot;, Baz.class);
120      Response&lt;Baz&gt; popClassWithPath = p.jsonArrPop(&quot;baz&quot;, Baz.class, Path.ROOT_PATH);
121      Response&lt;Baz&gt; popClassWithIndex = p.jsonArrPop(&quot;baz&quot;, Baz.class, Path.ROOT_PATH, 0);
122      p.sync();
123      assertEquals(&quot;OK&quot;, set1.get());
124      assertEquals(hm1, get.get());
125      assertEquals(hm1, getObject.get());
126      assertEquals(hm1, getWithPath.get());
127      assertEquals(hm1, getObjectWithPath.get());
128      assertEquals(1, mget.get().size());
129      assertEquals(baz1, mgetClass.get().get(0));
130      assertEquals(Long.valueOf(5), strLenPath.get());
131      assertEquals(Long.valueOf(6), strAppPath.get());
132      assertEquals(Long.valueOf(1), delPath.get());
133      assertEquals(Long.valueOf(1), delKey.get());
134      assertEquals(&quot;OK&quot;, set2.get());
135      assertEquals(&quot;c&quot;, popPath.get());
136      assertEquals(&quot;b&quot;, indexPop.get());
137      assertEquals(Long.valueOf(4), append.get());
138      assertEquals(Long.valueOf(2), index.get());
139      assertEquals(Long.valueOf(5), insert.get());
140      assertEquals(Long.valueOf(5), arrLenWithPath.get());
141      assertEquals(Long.valueOf(4), trim.get());
142      assertEquals(&quot;false&quot;, toggle.get());
143      assertEquals(boolean.class, type.get());
144      assertEquals(Object.class, keyType.get());
145      assertEquals(Long.valueOf(0), clearPath.get());
146      assertEquals(Long.valueOf(1), clearKey.get());
147      assertEquals(&quot;OK&quot;, set3.get());
148      assertEquals(Long.valueOf(6), strLen.get());
149      assertEquals(Long.valueOf(7), strApp.get());
150      assertEquals(&quot;OK&quot;, set4.get());
151      assertEquals(3.0, pop.get());
152      assertEquals(Long.valueOf(3), arrLen.get());
153      assertEquals(baz3, popClass.get());
154      assertEquals(baz2, popClassWithPath.get());
155      assertEquals(baz1, popClassWithIndex.get());
156    }
157    @Test
158    public void jsonV2() {
159      Map&lt;String, String&gt; hm1 = new HashMap&lt;&gt;();
160      hm1.put(&quot;hello&quot;, &quot;world&quot;);
161      hm1.put(&quot;oh&quot;, &quot;snap&quot;);
162      Map&lt;String, Object&gt; hm2 = new HashMap&lt;&gt;();
163      hm2.put(&quot;array&quot;, new String[]{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;});
164      hm2.put(&quot;boolean&quot;, true);
165      hm2.put(&quot;number&quot;, 3);
166      Pipeline p = (Pipeline) client.pipelined();
167      Response&lt;String&gt; setWithEscape = p.jsonSetWithEscape(&quot;foo&quot;, Path2.ROOT_PATH, hm1);
168      Response&lt;Object&gt; get = p.jsonGet(&quot;foo&quot;,  Path2.ROOT_PATH);
169      Response&lt;List&lt;JSONArray&gt;&gt; mget = p.jsonMGet(Path2.ROOT_PATH, &quot;foo&quot;);
170      Response&lt;List&lt;Long&gt;&gt; strLen = p.jsonStrLen(&quot;foo&quot;, new Path2(&quot;hello&quot;));
171      Response&lt;List&lt;Long&gt;&gt; strApp = p.jsonStrAppend(&quot;foo&quot;, new Path2(&quot;hello&quot;), &quot;!&quot;);
172      Response&lt;Long&gt; del = p.jsonDel(&quot;foo&quot;, new Path2(&quot;hello&quot;));
173      Response&lt;String&gt; set = p.jsonSet(&quot;bar&quot;, Path2.ROOT_PATH, gson.toJson(&quot;strung&quot;));
174      Response&lt;String&gt; setWithParams = p.jsonSet(&quot;foo&quot;, Path2.ROOT_PATH, gson.toJson(hm2), new JsonSetParams().xx());
175      Response&lt;String&gt; setWithEscapeWithParams = p.jsonSetWithEscape(&quot;foo&quot;, Path2.ROOT_PATH, hm2, new JsonSetParams().xx());
176      Response&lt;List&lt;Object&gt;&gt; pop = p.jsonArrPop(&quot;foo&quot;, new Path2(&quot;array&quot;));
177      Response&lt;List&lt;Object&gt;&gt; popWithIndex = p.jsonArrPop(&quot;foo&quot;, new Path2(&quot;array&quot;), 2);
178      Response&lt;List&lt;Long&gt;&gt; append = p.jsonArrAppend(&quot;foo&quot;, Path2.of(&quot;$.array&quot;), gson.toJson(&quot;b&quot;), gson.toJson(&quot;d&quot;));
179      Response&lt;List&lt;Long&gt;&gt; appendWithEscape = p.jsonArrAppendWithEscape(&quot;foo&quot;, Path2.of(&quot;$.array&quot;), &quot;e&quot;);
180      Response&lt;List&lt;Long&gt;&gt; index = p.jsonArrIndex(&quot;foo&quot;, Path2.of(&quot;$.array&quot;), gson.toJson(&quot;b&quot;));
181      Response&lt;List&lt;Long&gt;&gt; indexWithEscape = p.jsonArrIndexWithEscape(&quot;foo&quot;, Path2.of(&quot;$.array&quot;), &quot;b&quot;);
182      Response&lt;List&lt;Long&gt;&gt; insert = p.jsonArrInsert(&quot;foo&quot;, new Path2(&quot;array&quot;), 0, gson.toJson(&quot;x&quot;));
183      Response&lt;List&lt;Long&gt;&gt; insertWithEscape = p.jsonArrInsertWithEscape(&quot;foo&quot;, new Path2(&quot;array&quot;), 0, &quot;x&quot;);
184      Response&lt;List&lt;Long&gt;&gt; arrLen = p.jsonArrLen(&quot;foo&quot;, new Path2(&quot;array&quot;));
185      Response&lt;List&lt;Long&gt;&gt; trim = p.jsonArrTrim(&quot;foo&quot;, new Path2(&quot;array&quot;), 1, 2);
186      Response&lt;List&lt;Boolean&gt;&gt; toggle = p.jsonToggle(&quot;foo&quot;, new Path2(&quot;boolean&quot;));
187      Response&lt;List&lt;Class&lt;?&gt;&gt;&gt; type = p.jsonType(&quot;foo&quot;, new Path2(&quot;boolean&quot;));
188      Response&lt;Long&gt; clear = p.jsonClear(&quot;foo&quot;, new Path2(&quot;array&quot;));
189      p.sync();
190      assertEquals(&quot;OK&quot;, setWithEscape.get());
191      assertNotNull(get.get());
192      assertEquals(1, mget.get().size());
193      assertEquals(Long.valueOf(5), strLen.get().get(0));
194      assertEquals(1, strApp.get().size());
195      assertEquals(Long.valueOf(1), del.get());
196      assertEquals(&quot;OK&quot;, set.get());
197      assertEquals(&quot;OK&quot;, setWithParams.get());
198      assertEquals(&quot;OK&quot;, setWithEscapeWithParams.get());
199      assertEquals(&quot;c&quot;, pop.get().get(0));
200      assertEquals(&quot;b&quot;, popWithIndex.get().get(0));
201      assertEquals(Long.valueOf(3), append.get().get(0));
202      assertEquals(Long.valueOf(4), appendWithEscape.get().get(0));
203      assertEquals(Long.valueOf(1), index.get().get(0));
204      assertEquals(Long.valueOf(1), indexWithEscape.get().get(0));
205      assertEquals(Long.valueOf(5), insert.get().get(0));
206      assertEquals(Long.valueOf(6), insertWithEscape.get().get(0));
207      assertEquals(Long.valueOf(6), arrLen.get().get(0));
208      assertEquals(Long.valueOf(2), trim.get().get(0));
209      assertEquals(false, toggle.get().get(0));
210      assertEquals(boolean.class, type.get().get(0));
211      assertEquals(Long.valueOf(1), clear.get());
212    }
213  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RedisJsonV2Test.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-RedisModulesPipelineTest.java</div>
                </div>
                <div class="column column_space"><pre><code>22  public class RedisJsonV2Test extends RedisModuleCommandsTestBase {
23    private static final Gson gson = new Gson();
24    private RedisJsonV2Commands jsonClient;
</pre></code></div>
                <div class="column column_space"><pre><code>24  public class RedisModulesPipelineTest extends RedisModuleCommandsTestBase {
25    private static final Gson gson = new Gson();
26    @BeforeClass
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    