
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 13.15345699831366%, Tokens: 10</h2>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-JedisSentinelTest.java</h3>
            <pre><code>1  package redis.clients.jedis;
2  import static org.junit.Assert.assertEquals;
3  import static org.junit.Assert.assertNotEquals;
4  import static org.junit.Assert.assertTrue;
5  import static org.junit.Assert.fail;
6  import java.util.HashMap;
7  import java.util.List;
8  import java.util.Map;
9  import org.junit.After;
10  import org.junit.Before;
11  import org.junit.Test;
12  import redis.clients.jedis.exceptions.JedisDataException;
13  import redis.clients.jedis.util.JedisSentinelTestUtil;
14  public class JedisSentinelTest {
15    private static final String MASTER_NAME = "mymaster";
16    private static final String MONITOR_MASTER_NAME = "mymastermonitor";
17    private static final String REMOVE_MASTER_NAME = "mymasterremove";
18    private static final String FAILOVER_MASTER_NAME = "mymasterfailover";
19    private static final String MASTER_IP = "127.0.0.1";
20    protected static HostAndPort master = HostAndPorts.getRedisServers().get(0);
21    protected static HostAndPort slave = HostAndPorts.getRedisServers().get(4);
22    protected static HostAndPort sentinel = HostAndPorts.getSentinelServers().get(0);
23    protected static HostAndPort sentinelForFailover = HostAndPorts.getSentinelServers().get(2);
24    protected static HostAndPort masterForFailover = HostAndPorts.getRedisServers().get(5);
25    @Before
26    public void setup() throws InterruptedException {
27    }
28    @After
29    public void clear() throws InterruptedException {
30      ensureRemoved(MONITOR_MASTER_NAME);
31      ensureRemoved(REMOVE_MASTER_NAME);
32    }
33    @Test
34    public void sentinel() {
35      Jedis j = new Jedis(sentinel);
36      try {
37        List<Map<String, String>> masters = j.sentinelMasters();
38        boolean inMasters = false;
39        for (Map<String, String> master : masters)
40          if (MASTER_NAME.equals(master.get("name"))) inMasters = true;
41        assertTrue(inMasters);
42        List<String> masterHostAndPort = j.sentinelGetMasterAddrByName(MASTER_NAME);
43        HostAndPort masterFromSentinel = new HostAndPort(masterHostAndPort.get(0),
44            Integer.parseInt(masterHostAndPort.get(1)));
45        assertEquals(master.getPort(), masterFromSentinel.getPort());
46        List<Map<String, String>> slaves = j.sentinelReplicas(MASTER_NAME);
47        assertTrue(!slaves.isEmpty());
48        assertEquals(master.getPort(), Integer.parseInt(slaves.get(0).get("master-port")));
49        assertEquals(Long.valueOf(1), j.sentinelReset(MASTER_NAME));
50        assertEquals(Long.valueOf(0), j.sentinelReset("woof" + MASTER_NAME));
51      } finally {
52        j.close();
53      }
54    }
55    @Test
56    public void sentinelFailover() throws InterruptedException {
57      Jedis j = new Jedis(sentinelForFailover);
58      Jedis j2 = new Jedis(sentinelForFailover);
59      try {
60        List<String> masterHostAndPort = j.sentinelGetMasterAddrByName(FAILOVER_MASTER_NAME);
61        HostAndPort currentMaster = new HostAndPort(masterHostAndPort.get(0),
62            Integer.parseInt(masterHostAndPort.get(1)));
63        JedisSentinelTestUtil.waitForNewPromotedMaster(FAILOVER_MASTER_NAME, j, j2);
64        masterHostAndPort = j.sentinelGetMasterAddrByName(FAILOVER_MASTER_NAME);
65        HostAndPort newMaster = new HostAndPort(masterHostAndPort.get(0),
66            Integer.parseInt(masterHostAndPort.get(1)));
67        assertNotEquals(newMaster, currentMaster);
68      } finally {
69        j.close();
70        j2.close();
71      }
72    }
73    @Test
74    public void sentinelMonitor() {
75      Jedis j = new Jedis(sentinel);
76      try {
77        String result = j.sentinelMonitor(MONITOR_MASTER_NAME, MASTER_IP, master.getPort(), 1);
78        assertEquals("OK", result);
79        try {
80          j.sentinelMonitor(MONITOR_MASTER_NAME, MASTER_IP, master.getPort(), 1);
81          fail();
82        } catch (JedisDataException e) {
83        }
84      } finally {
85        j.close();
86      }
87    }
88    @Test
89    public void sentinelRemove() {
90      Jedis j = new Jedis(sentinel);
91      try {
92        ensureMonitored(sentinel, REMOVE_MASTER_NAME, MASTER_IP, master.getPort(), 1);
93        String result = j.sentinelRemove(REMOVE_MASTER_NAME);
94        assertEquals("OK", result);
95        try {
96          result = j.sentinelRemove(REMOVE_MASTER_NAME);
97          assertNotEquals("OK", result);
98          fail();
99        } catch (JedisDataException e) {
100        }
101      } finally {
102        j.close();
103      }
104    }
105    @Test
106    public void sentinelSet() {
107      Jedis j = new Jedis(sentinel);
<span onclick='openModal()' class='match'>108      try {
109        Map<String, String> parameterMap = new HashMap<String, String>();
110        parameterMap.put("down-after-milliseconds", String.valueOf(1234));
111        parameterMap.put("parallel-syncs", String.valueOf(3));
112        parameterMap.put("quorum", String.valueOf(2));
113        j.sentinelSet(MASTER_NAME, parameterMap);
</span>114        List<Map<String, String>> masters = j.sentinelMasters();
115        for (Map<String, String> master : masters) {
116          if (master.get("name").equals(MASTER_NAME)) {
117            assertEquals(1234, Integer.parseInt(master.get("down-after-milliseconds")));
118            assertEquals(3, Integer.parseInt(master.get("parallel-syncs")));
119            assertEquals(2, Integer.parseInt(master.get("quorum")));
120          }
121        }
122        parameterMap.put("quorum", String.valueOf(1));
123        j.sentinelSet(MASTER_NAME, parameterMap);
124      } finally {
125        j.close();
126      }
127    }
128    private void ensureMonitored(HostAndPort sentinel, String masterName, String ip, int port,
129        int quorum) {
130      Jedis j = new Jedis(sentinel);
131      try {
132        j.sentinelMonitor(masterName, ip, port, quorum);
133      } catch (JedisDataException e) {
134      } finally {
135        j.close();
136      }
137    }
138    private void ensureRemoved(String masterName) {
139      Jedis j = new Jedis(sentinel);
140      try {
141        j.sentinelRemove(masterName);
142      } catch (JedisDataException e) {
143      } finally {
144        j.close();
145      }
146    }
147  }
</code></pre>
        </div>
        <div class="column">
            <h3>jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ClientCommandsTest.java</h3>
            <pre><code>1  package redis.clients.jedis.commands.jedis;
2  import static org.junit.Assert.assertArrayEquals;
3  import static org.junit.Assert.assertEquals;
4  import static org.junit.Assert.assertNotNull;
5  import static org.junit.Assert.assertTrue;
6  import static org.junit.Assert.fail;
7  import static redis.clients.jedis.params.ClientKillParams.SkipMe;
8  import java.util.concurrent.ExecutionException;
9  import java.util.concurrent.Executors;
10  import java.util.concurrent.Future;
11  import java.util.concurrent.TimeUnit;
12  import java.util.concurrent.TimeoutException;
13  import java.util.regex.Matcher;
14  import java.util.regex.Pattern;
15  import org.junit.After;
16  import org.junit.Before;
17  import org.junit.Test;
18  import redis.clients.jedis.Jedis;
19  import redis.clients.jedis.args.ClientAttributeOption;
20  import redis.clients.jedis.args.ClientType;
21  import redis.clients.jedis.args.UnblockType;
22  import redis.clients.jedis.exceptions.JedisConnectionException;
23  import redis.clients.jedis.params.ClientKillParams;
24  public class ClientCommandsTest extends JedisCommandsTestBase {
25    private final String clientName = "fancy_jedis_name";
26    private final Pattern pattern = Pattern.compile("\\bname=" + clientName + "\\b");
27    private Jedis client;
28    @Before
29    @Override
30    public void setUp() throws Exception {
31      super.setUp();
32      client = new Jedis(hnp.getHost(), hnp.getPort(), 500);
33      client.auth("foobared");
34      client.clientSetname(clientName);
35    }
36    @After
37    @Override
38    public void tearDown() throws Exception {
39      client.close();
40      super.tearDown();
41    }
42    @Test
43    public void nameString() {
44      String name = "string";
45      client.clientSetname(name);
46      assertEquals(name, client.clientGetname());
47    }
48    @Test
49    public void nameBinary() {
50      byte[] name = "binary".getBytes();
51      client.clientSetname(name);
52      assertArrayEquals(name, client.clientGetnameBinary());
53    }
54    @Test
55    public void clientSetInfoDefault() {
56      String libName = "jedis";
57      String libVersion = "999.999.999";
58      assertEquals("OK", client.clientSetInfo(ClientAttributeOption.LIB_NAME, libName));
59      assertEquals("OK", client.clientSetInfo(ClientAttributeOption.LIB_VER, libVersion));
60      String info = client.clientInfo();
61      assertTrue(info.contains("lib-name=jedis"));
62      assertTrue(info.contains("lib-ver=999.999.999"));
63    }
64    @Test
65    public void clientId() {
66      long clientId = client.clientId();
67      String info = findInClientList();
68      Matcher matcher = Pattern.compile("\\bid=(\\d+)\\b").matcher(info);
69      matcher.find();
70      assertEquals(clientId, Long.parseLong(matcher.group(1)));
71    }
72    @Test
73    public void clientIdmultipleConnection() {
<span onclick='openModal()' class='match'>74      try (Jedis client2 = new Jedis(hnp.getHost(), hnp.getPort(), 500)) {
75        client2.auth("foobared");
76        client2.clientSetname("fancy_jedis_another_name");
77        assertTrue(client.clientId() < client2.clientId());
</span>78      }
79    }
80    @Test
81    public void clientIdReconnect() {
82      long clientIdInitial = client.clientId();
83      client.disconnect();
84      client.connect();
85      client.auth("foobared");
86      long clientIdAfterReconnect = client.clientId();
87      assertTrue(clientIdInitial < clientIdAfterReconnect);
88    }
89    @Test
90    public void clientUnblock() throws InterruptedException, TimeoutException {
91      long clientId = client.clientId();
92      assertEquals(0, jedis.clientUnblock(clientId, UnblockType.ERROR));
93      Future<?> future = Executors.newSingleThreadExecutor().submit(() -> client.brpop(100000, "foo"));
94      try {
95        TimeUnit.MILLISECONDS.sleep(500);
96        assertEquals(1, jedis.clientUnblock(clientId, UnblockType.ERROR));
97        future.get(1, TimeUnit.SECONDS);
98      } catch (ExecutionException e) {
99        assertEquals("redis.clients.jedis.exceptions.JedisDataException: UNBLOCKED client unblocked via CLIENT UNBLOCK", e.getMessage());
100      }
101    }
102    @Test
103    public void killIdString() {
104      String info = findInClientList();
105      Matcher matcher = Pattern.compile("\\bid=(\\d+)\\b").matcher(info);
106      matcher.find();
107      String id = matcher.group(1);
108      assertEquals(1, jedis.clientKill(new ClientKillParams().id(id)));
109      assertDisconnected(client);
110    }
111    @Test
112    public void killIdBinary() {
113      String info = findInClientList();
114      Matcher matcher = Pattern.compile("\\bid=(\\d+)\\b").matcher(info);
115      matcher.find();
116      byte[] id = matcher.group(1).getBytes();
117      assertEquals(1, jedis.clientKill(new ClientKillParams().id(id)));
118      assertDisconnected(client);
119    }
120    @Test
121    public void killTypeNormal() {
122      long clients = jedis.clientKill(new ClientKillParams().type(ClientType.NORMAL));
123      assertTrue(clients > 0);
124      assertDisconnected(client);
125    }
126    @Test
127    public void killSkipmeNo() {
128      jedis.clientKill(new ClientKillParams().type(ClientType.NORMAL).skipMe(SkipMe.NO));
129      assertDisconnected(client);
130      assertDisconnected(jedis);
131    }
132    @Test
133    public void killSkipmeYesNo() {
134      jedis.clientKill(new ClientKillParams().type(ClientType.NORMAL).skipMe(SkipMe.YES));
135      assertDisconnected(client);
136      assertEquals(1, jedis.clientKill(new ClientKillParams().type(ClientType.NORMAL).skipMe(SkipMe.NO)));
137      assertDisconnected(jedis);
138    }
139    @Test
140    public void killAddrString() {
141      String info = findInClientList();
142      Matcher matcher = Pattern.compile("\\baddr=(\\S+)\\b").matcher(info);
143      matcher.find();
144      String addr = matcher.group(1);
145      assertEquals(1, jedis.clientKill(new ClientKillParams().addr(addr)));
146      assertDisconnected(client);
147    }
148    @Test
149    public void killAddrBinary() {
150      String info = findInClientList();
151      Matcher matcher = Pattern.compile("\\baddr=(\\S+)\\b").matcher(info);
152      matcher.find();
153      String addr = matcher.group(1);
154      assertEquals(1, jedis.clientKill(new ClientKillParams().addr(addr)));
155      assertDisconnected(client);
156    }
157    @Test
158    public void killLAddr() {
159      String info = findInClientList();
160      Matcher matcher = Pattern.compile("\\bladdr=(\\S+)\\b").matcher(info);
161      matcher.find();
162      String laddr = matcher.group(1);
163      long clients = jedis.clientKill(new ClientKillParams().laddr(laddr));
164      assertTrue(clients >= 1);
165      assertDisconnected(client);
166    }
167    @Test
168    public void killAddrIpPort() {
169      String info = findInClientList();
170      Matcher matcher = Pattern.compile("\\baddr=(\\S+)\\b").matcher(info);
171      matcher.find();
172      String addr = matcher.group(1);
173      int lastColon = addr.lastIndexOf(":");
174      String[] hp = new String[]{addr.substring(0, lastColon), addr.substring(lastColon + 1)};
175      assertEquals(1, jedis.clientKill(new ClientKillParams().addr(hp[0], Integer.parseInt(hp[1]))));
176      assertDisconnected(client);
177    }
178    @Test
179    public void killUser() {
180      Jedis client2 = new Jedis(hnp.getHost(), hnp.getPort(), 500);
181      client.aclSetUser("test_kill", "on", "+acl", ">password1");
182      try {
183        client2.auth("test_kill", "password1");
184        assertEquals(1, jedis.clientKill(new ClientKillParams().user("test_kill")));
185        assertDisconnected(client2);
186      } finally {
187        jedis.aclDelUser("test_kill");
188      }
189    }
190    @Test
191    public void clientInfo() {
192      String info = client.clientInfo();
193      assertNotNull(info);
194      assertEquals(1, info.split("\n").length);
195      assertTrue(info.contains(clientName));
196    }
197    @Test
198    public void clientListWithClientId() {
199      long id = client.clientId();
200      String listInfo = jedis.clientList(id);
201      assertNotNull(listInfo);
202      assertTrue(listInfo.contains(clientName));
203    }
204    @Test
205    public void listWithType() {
206      assertTrue(client.clientList(ClientType.NORMAL).split("\\n").length > 1);
207      assertEquals(0, client.clientList(ClientType.MASTER).length());
208      assertEquals(1, client.clientList(ClientType.SLAVE).split("\\n").length);
209      assertEquals(1, client.clientList(ClientType.REPLICA).split("\\n").length);
210      assertEquals(1, client.clientList(ClientType.PUBSUB).split("\\n").length);
211    }
212    private void assertDisconnected(Jedis j) {
213      try {
214        j.ping();
215        fail("Jedis connection should be disconnected");
216      } catch (JedisConnectionException jce) {
217      }
218    }
219    private String findInClientList() {
220      for (String clientInfo : jedis.clientList().split("\n")) {
221        if (pattern.matcher(clientInfo).find()) {
222          return clientInfo;
223        }
224      }
225      return null;
226    }
227  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class='row'>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-JedisSentinelTest.java</div>
                    <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from jedis-MDEwOlJlcG9zaXRvcnk3MTU2MDU=-flat-ClientCommandsTest.java</div>
                </div>
                <div class="column column_space"><pre><code>108      try {
109        Map<String, String> parameterMap = new HashMap<String, String>();
110        parameterMap.put("down-after-milliseconds", String.valueOf(1234));
111        parameterMap.put("parallel-syncs", String.valueOf(3));
112        parameterMap.put("quorum", String.valueOf(2));
113        j.sentinelSet(MASTER_NAME, parameterMap);
</pre></code></div>
                <div class="column column_space"><pre><code>74      try (Jedis client2 = new Jedis(hnp.getHost(), hnp.getPort(), 500)) {
75        client2.auth("foobared");
76        client2.clientSetname("fancy_jedis_another_name");
77        assertTrue(client.clientId() < client2.clientId());
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    