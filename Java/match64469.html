<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Matches for UnsignedLongTest.java & TreeRangeMapTest_1.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<body>
  <div style="align-items: center; display: flex; justify-content: space-around;">
    <div>
      <h3 align="center">
Matches for UnsignedLongTest.java & TreeRangeMapTest_1.java
      </h3>
      <h1 align="center">
        31.8%
      </h1>
      <center>
        <a href="index.html" target="_top">
          INDEX
        </a>
        <span>-</span>
        <a href="help-en.html" target="_top">
          HELP
        </a>
      </center>
    </div>
    <div>
<TABLE BORDER="1" CELLSPACING="0" BGCOLOR="#d0d0d0">
<TR><TH><TH>UnsignedLongTest.java (53.09381%)<TH>TreeRangeMapTest_1.java (22.773973%)<TH>Tokens
<TR><TD BGCOLOR="#0000ff"><FONT COLOR="#0000ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#0',2,'match64469-1.html#0',3)" NAME="0">(48-64)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#0',2,'match64469-1.html#0',3)" NAME="0">(596-614)</A><TD ALIGN=center><FONT COLOR="#ff0000">28</FONT>
<TR><TD BGCOLOR="#f63526"><FONT COLOR="#f63526">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#1',2,'match64469-1.html#1',3)" NAME="1">(185-193)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#1',2,'match64469-1.html#1',3)" NAME="1">(424-433)</A><TD ALIGN=center><FONT COLOR="#9a0000">17</FONT>
<TR><TD BGCOLOR="#980517"><FONT COLOR="#980517">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#2',2,'match64469-1.html#2',3)" NAME="2">(172-180)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#2',2,'match64469-1.html#2',3)" NAME="2">(371-380)</A><TD ALIGN=center><FONT COLOR="#9a0000">17</FONT>
<TR><TD BGCOLOR="#53858b"><FONT COLOR="#53858b">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#3',2,'match64469-1.html#3',3)" NAME="3">(160-169)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#3',2,'match64469-1.html#3',3)" NAME="3">(358-367)</A><TD ALIGN=center><FONT COLOR="#9a0000">17</FONT>
<TR><TD BGCOLOR="#6cc417"><FONT COLOR="#6cc417">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#4',2,'match64469-1.html#4',3)" NAME="4">(105-111)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#4',2,'match64469-1.html#4',3)" NAME="4">(309-317)</A><TD ALIGN=center><FONT COLOR="#9a0000">17</FONT>
<TR><TD BGCOLOR="#151b8d"><FONT COLOR="#151b8d">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#5',2,'match64469-1.html#5',3)" NAME="5">(250-257)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#5',2,'match64469-1.html#5',3)" NAME="5">(318-325)</A><TD ALIGN=center><FONT COLOR="#910000">16</FONT>
<TR><TD BGCOLOR="#8c8774"><FONT COLOR="#8c8774">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#6',2,'match64469-1.html#6',3)" NAME="6">(200-206)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#6',2,'match64469-1.html#6',3)" NAME="6">(392-398)</A><TD ALIGN=center><FONT COLOR="#7f0000">14</FONT>
<TR><TD BGCOLOR="#38a4a5"><FONT COLOR="#38a4a5">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#7',2,'match64469-1.html#7',3)" NAME="7">(94-100)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#7',2,'match64469-1.html#7',3)" NAME="7">(345-351)</A><TD ALIGN=center><FONT COLOR="#760000">13</FONT>
<TR><TD BGCOLOR="#c58917"><FONT COLOR="#c58917">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#8',2,'match64469-1.html#8',3)" NAME="8">(271-277)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#8',2,'match64469-1.html#8',3)" NAME="8">(472-478)</A><TD ALIGN=center><FONT COLOR="#6d0000">12</FONT>
<TR><TD BGCOLOR="#83a33a"><FONT COLOR="#83a33a">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#9',2,'match64469-1.html#9',3)" NAME="9">(258-264)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#9',2,'match64469-1.html#9',3)" NAME="9">(405-414)</A><TD ALIGN=center><FONT COLOR="#6d0000">12</FONT>
<TR><TD BGCOLOR="#ad5910"><FONT COLOR="#ad5910">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#10',2,'match64469-1.html#10',3)" NAME="10">(221-226)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#10',2,'match64469-1.html#10',3)" NAME="10">(671-676)</A><TD ALIGN=center><FONT COLOR="#6d0000">12</FONT>
<TR><TD BGCOLOR="#b041ff"><FONT COLOR="#b041ff">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#11',2,'match64469-1.html#11',3)" NAME="11">(124-128)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#11',2,'match64469-1.html#11',3)" NAME="11">(452-458)</A><TD ALIGN=center><FONT COLOR="#6d0000">12</FONT>
<TR><TD BGCOLOR="#571b7e"><FONT COLOR="#571b7e">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#12',2,'match64469-1.html#12',3)" NAME="12">(226-231)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#12',2,'match64469-1.html#12',3)" NAME="12">(414-419)</A><TD ALIGN=center><FONT COLOR="#640000">11</FONT>
<TR><TD BGCOLOR="#3b9c9c"><FONT COLOR="#3b9c9c">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#13',2,'match64469-1.html#13',3)" NAME="13">(137-141)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#13',2,'match64469-1.html#13',3)" NAME="13">(439-446)</A><TD ALIGN=center><FONT COLOR="#640000">11</FONT>
<TR><TD BGCOLOR="#842dce"><FONT COLOR="#842dce">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#14',2,'match64469-1.html#14',3)" NAME="14">(113-119)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#14',2,'match64469-1.html#14',3)" NAME="14">(351-357)</A><TD ALIGN=center><FONT COLOR="#640000">11</FONT>
<TR><TD BGCOLOR="#f52887"><FONT COLOR="#f52887">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#15',2,'match64469-1.html#15',3)" NAME="15">(17-31)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#15',2,'match64469-1.html#15',3)" NAME="15">(26-40)</A><TD ALIGN=center><FONT COLOR="#5b0000">10</FONT>
<TR><TD BGCOLOR="#2981b2"><FONT COLOR="#2981b2">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#16',2,'match64469-1.html#16',3)" NAME="16">(246-249)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#16',2,'match64469-1.html#16',3)" NAME="16">(620-623)</A><TD ALIGN=center><FONT COLOR="#510000">9</FONT>
<TR><TD BGCOLOR="#3090c7"><FONT COLOR="#3090c7">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#17',2,'match64469-1.html#17',3)" NAME="17">(196-199)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#17',2,'match64469-1.html#17',3)" NAME="17">(382-388)</A><TD ALIGN=center><FONT COLOR="#510000">9</FONT>
<TR><TD BGCOLOR="#800517"><FONT COLOR="#800517">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#18',2,'match64469-1.html#18',3)" NAME="18">(129-134)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#18',2,'match64469-1.html#18',3)" NAME="18">(465-471)</A><TD ALIGN=center><FONT COLOR="#510000">9</FONT>
<TR><TD BGCOLOR="#f62817"><FONT COLOR="#f62817">-</FONT><TD><A HREF="javascript:ZweiFrames('match64469-0.html#19',2,'match64469-1.html#19',3)" NAME="19">(81-87)<TD><A HREF="javascript:ZweiFrames('match64469-0.html#19',2,'match64469-1.html#19',3)" NAME="19">(52-56)</A><TD ALIGN=center><FONT COLOR="#510000">9</FONT>
</TABLE>
    </div>
  </div>
  <hr>
  <div style="display: flex;">
<div style="flex-grow: 1;">
<h3>
<center>
<span>UnsignedLongTest.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2011 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the
 * License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing permissions and
 * limitations under the License.
 */
<A NAME="15"></A>
package com.google.common.primitives;

<FONT color="#f52887"><A HREF="javascript:ZweiFrames('match64469-1.html#15',3,'match64469-top.html#15',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>import com.google.common.annotations.GwtCompatible;
import com.google.common.annotations.GwtIncompatible;
import com.google.common.collect.ImmutableSet;
import com.google.common.testing.EqualsTester;
import com.google.common.testing.NullPointerTester;
import com.google.common.testing.SerializableTester;
import java.math.BigInteger;
import junit.framework.TestCase;

/**
 * Tests for {@code UnsignedLong}.
 *
 * @author Louis Wasserman
 */
@</B></FONT>GwtCompatible(emulated = true)
public class UnsignedLongTest extends TestCase {
  private static final ImmutableSet&lt;Long&gt; TEST_LONGS;
  private static final ImmutableSet&lt;BigInteger&gt; TEST_BIG_INTEGERS;

  static {
    ImmutableSet.Builder&lt;Long&gt; testLongsBuilder = ImmutableSet.builder();
    ImmutableSet.Builder&lt;BigInteger&gt; testBigIntegersBuilder = ImmutableSet.builder();

    // The values here look like 111...11101...010 in binary, where the initial 111...1110 takes
    // up exactly as many bits as can be represented in the significand (24 for float, 53 for
    // double). That final 0 should be rounded up to 1 because the remaining bits make that number
    // slightly nearer.
    long floatConversionTest = 0xfffffe8000000002L;
<A NAME="0"></A>    long doubleConversionTest = 0xfffffffffffff402L;

    for (long i = -3; i &lt;= 3; i++) {
      <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match64469-1.html#0',3,'match64469-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>testLongsBuilder
          .add(i)
          .add(Long.MAX_VALUE + i)
          .add(Long.MIN_VALUE + i)
          .add(Integer.MIN_VALUE + i)
          .add(Integer.MAX_VALUE + i)
          .add(floatConversionTest + i)
          .add(doubleConversionTest + i);
      BigInteger bigI = BigInteger.valueOf(i);
      testBigIntegersBuilder
          .add(bigI)
          .add(BigInteger.valueOf(Long.MAX_VALUE).add(bigI))
          .add(BigInteger.valueOf(Long.MIN_VALUE).add(bigI))
          .add(BigInteger.valueOf(Integer.MAX_VALUE).add(bigI))
          .add(BigInteger.valueOf(Integer.MIN_VALUE).add(bigI))
          .add(BigInteger.ONE.shiftLeft(63).add(bigI))
          .add(BigInteger.ONE.shiftLeft</B></FONT>(64).add(bigI));
    }
    TEST_LONGS = testLongsBuilder.build();
    TEST_BIG_INTEGERS = testBigIntegersBuilder.build();
  }

  public void testAsUnsignedAndLongValueAreInverses() {
    for (long value : TEST_LONGS) {
      assertEquals(
          UnsignedLongs.toString(value), value, UnsignedLong.fromLongBits(value).longValue());
    }
  }

  public void testAsUnsignedBigIntegerValue() {
<A NAME="19"></A>    for (long value : TEST_LONGS) {
      BigInteger expected =
          (value &gt;= 0)
              ? <FONT color="#f62817"><A HREF="javascript:ZweiFrames('match64469-1.html#19',3,'match64469-top.html#19',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>BigInteger.valueOf(value)
              : BigInteger.valueOf(value).add(BigInteger.ZERO.setBit(64));
      assertEquals(
          UnsignedLongs.toString(value),
          expected,
          UnsignedLong.fromLongBits(value).bigIntegerValue());
    }</B></FONT>
  }

  public void testValueOfLong() {
<A NAME="7"></A>    for (long value : TEST_LONGS) {
      boolean expectSuccess = value &gt;= 0;
      try {
        assertEquals(value, <FONT color="#38a4a5"><A HREF="javascript:ZweiFrames('match64469-1.html#7',3,'match64469-top.html#7',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>UnsignedLong.valueOf(value).longValue());
        assertTrue(expectSuccess);
      } catch (IllegalArgumentException e) {
        assertFalse(expectSuccess);
      }
    }
  }</B></FONT>

<A NAME="4"></A>  public void testValueOfBigInteger() {
    BigInteger min = BigInteger.ZERO;
    BigInteger max = UnsignedLong.MAX_VALUE.bigIntegerValue();
    <FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match64469-1.html#4',3,'match64469-top.html#4',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>for (BigInteger big : TEST_BIG_INTEGERS) {
      boolean expectSuccess = big.compareTo(min) &gt;= 0 &amp;&amp; big.compareTo(max) &lt;= 0;
      try {
        assertEquals(big, UnsignedLong.valueOf(big).bigIntegerValue());
        assertTrue(expectSuccess);
<A NAME="14"></A>      } catch (IllegalArgumentException e) {
        assertFalse</B></FONT>(expectSuccess);
      }
    <FONT color="#842dce"><A HREF="javascript:ZweiFrames('match64469-1.html#14',3,'match64469-top.html#14',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}
  }

  public void testToString() {
    for (long value : TEST_LONGS) {
      UnsignedLong unsignedValue = UnsignedLong.fromLongBits(value);
      assertEquals</B></FONT>(unsignedValue.bigIntegerValue().toString(), unsignedValue.toString());
    }
<A NAME="11"></A>  }

  @GwtIncompatible // too slow
  public void testToStringRadix() <FONT color="#b041ff"><A HREF="javascript:ZweiFrames('match64469-1.html#11',3,'match64469-top.html#11',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
    for (int radix = Character.MIN_RADIX; radix &lt;= Character.MAX_RADIX; radix++) {
<A NAME="18"></A>      for (long l : TEST_LONGS) {
        UnsignedLong value = UnsignedLong.fromLongBits(l);
        assertEquals(value.bigIntegerValue</B></FONT>().toString(radix), value.toString(radix));
      <FONT color="#800517"><A HREF="javascript:ZweiFrames('match64469-1.html#18',3,'match64469-top.html#18',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}
    }
  }

  public void testToStringRadixQuick() {
<A NAME="13"></A>    int[] radices = {2, 3, 5, 7, 10, 12, 16, 21, 31, 36}</B></FONT>;
    for (int radix : radices) {
      for (long l : TEST_LONGS) {
        <FONT color="#3b9c9c"><A HREF="javascript:ZweiFrames('match64469-1.html#13',3,'match64469-top.html#13',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>UnsignedLong value = UnsignedLong.fromLongBits(l);
        assertEquals(value.bigIntegerValue().toString(radix), value.toString(radix));
      }
    }
  }</B></FONT>

  @AndroidIncompatible // b/28251030, re-enable when the fix is everywhere we run this test
  public void testFloatValue() {
    for (long value : TEST_LONGS) {
      UnsignedLong unsignedValue = UnsignedLong.fromLongBits(value);
      assertEquals(
          &quot;Float value of &quot; + unsignedValue,
          unsignedValue.bigIntegerValue().floatValue(),
          unsignedValue.floatValue(),
          0.0f);
    }
  }

  public void testDoubleValue() {
    for (long value : TEST_LONGS) {
<A NAME="3"></A>      UnsignedLong unsignedValue = UnsignedLong.fromLongBits(value);
      assertEquals(
          &quot;Double value of &quot; + unsignedValue,
          <FONT color="#53858b"><A HREF="javascript:ZweiFrames('match64469-1.html#3',3,'match64469-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>unsignedValue.bigIntegerValue().doubleValue(),
          unsignedValue.doubleValue(),
          0.0);
    }
  }

  public void testPlus() {
    for (long a : TEST_LONGS) {
      for (long b : TEST_LONGS) {
<A NAME="2"></A>        UnsignedLong aUnsigned = UnsignedLong.fromLongBits</B></FONT>(a);
        UnsignedLong bUnsigned = UnsignedLong.fromLongBits(b);
        long expected = aUnsigned.bigIntegerValue().add(bUnsigned.bigIntegerValue()).longValue();
        UnsignedLong unsignedSum = <FONT color="#980517"><A HREF="javascript:ZweiFrames('match64469-1.html#2',3,'match64469-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>aUnsigned.plus(bUnsigned);
        assertEquals(expected, unsignedSum.longValue());
      }
    }
  }

  public void testMinus() {
    for (long a : TEST_LONGS) {
      for (long b : TEST_LONGS) {</B></FONT>
        UnsignedLong aUnsigned = UnsignedLong.fromLongBits(a);
<A NAME="1"></A>        UnsignedLong bUnsigned = UnsignedLong.fromLongBits(b);
        long expected =
            aUnsigned.bigIntegerValue().subtract(bUnsigned.bigIntegerValue()).longValue();
        UnsignedLong unsignedSub = <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match64469-1.html#1',3,'match64469-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>aUnsigned.minus(bUnsigned);
        assertEquals(expected, unsignedSub.longValue());
      }
    }
  }

  public void testTimes() {
    for (long a : TEST_LONGS) {
<A NAME="17"></A>      for (long b : TEST_LONGS) {</B></FONT>
        UnsignedLong aUnsigned = UnsignedLong.fromLongBits(a);
        UnsignedLong bUnsigned = UnsignedLong.fromLongBits(b);
        <FONT color="#3090c7"><A HREF="javascript:ZweiFrames('match64469-1.html#17',3,'match64469-top.html#17',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>long expected =
<A NAME="6"></A>            aUnsigned.bigIntegerValue().multiply(bUnsigned.bigIntegerValue()).longValue();
        UnsignedLong unsignedMul = aUnsigned.times(bUnsigned);
        assertEquals(expected, unsignedMul.longValue</B></FONT>());
      <FONT color="#8c8774"><A HREF="javascript:ZweiFrames('match64469-1.html#6',3,'match64469-top.html#6',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}
    }
  }

  public void testDividedBy() {
    for (long a : TEST_LONGS) {
      for (long b : TEST_LONGS) {</B></FONT>
        if (b != 0) {
          UnsignedLong aUnsigned = UnsignedLong.fromLongBits(a);
          UnsignedLong bUnsigned = UnsignedLong.fromLongBits(b);
          long expected =
              aUnsigned.bigIntegerValue().divide(bUnsigned.bigIntegerValue()).longValue();
          UnsignedLong unsignedDiv = aUnsigned.dividedBy(bUnsigned);
          assertEquals(expected, unsignedDiv.longValue());
        }
      }
    }
  }
<A NAME="10"></A>
  public void testDivideByZeroThrows() {
    for (long a : TEST_LONGS) {
      <FONT color="#ad5910"><A HREF="javascript:ZweiFrames('match64469-1.html#10',3,'match64469-top.html#10',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>try {
        UnsignedLong.fromLongBits(a).dividedBy(UnsignedLong.ZERO);
<A NAME="12"></A>        fail(&quot;Expected ArithmeticException&quot;);
      } catch (ArithmeticException expected) {
      }
    <FONT color="#571b7e"><A HREF="javascript:ZweiFrames('match64469-1.html#12',3,'match64469-top.html#12',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}</B></FONT>
  }

  public void testMod() {
    for (long a : TEST_LONGS) {
      for (long b : TEST_LONGS) {</B></FONT>
        if (b != 0) {
          UnsignedLong aUnsigned = UnsignedLong.fromLongBits(a);
          UnsignedLong bUnsigned = UnsignedLong.fromLongBits(b);
          long expected =
              aUnsigned.bigIntegerValue().remainder(bUnsigned.bigIntegerValue()).longValue();
          UnsignedLong unsignedRem = aUnsigned.mod(bUnsigned);
          assertEquals(expected, unsignedRem.longValue());
        }
      }
    }
  }
<A NAME="16"></A>
  public void testModByZero() {
    for (long a : TEST_LONGS) {
      <FONT color="#2981b2"><A HREF="javascript:ZweiFrames('match64469-1.html#16',3,'match64469-top.html#16',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>try {
<A NAME="5"></A>        UnsignedLong.fromLongBits(a).mod(UnsignedLong.ZERO);
        fail(&quot;Expected ArithmeticException&quot;);
      } catch (ArithmeticException expected) {</B></FONT>
      <FONT color="#151b8d"><A HREF="javascript:ZweiFrames('match64469-1.html#5',3,'match64469-top.html#5',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}
    }
  }

  public void testCompare() {
<A NAME="9"></A>    for (long a : TEST_LONGS) {
      for (long b : TEST_LONGS) {
        UnsignedLong aUnsigned = UnsignedLong.fromLongBits</B></FONT>(a);
        <FONT color="#83a33a"><A HREF="javascript:ZweiFrames('match64469-1.html#9',3,'match64469-top.html#9',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>UnsignedLong bUnsigned = UnsignedLong.fromLongBits(b);
        assertEquals(
            aUnsigned.bigIntegerValue().compareTo(bUnsigned.bigIntegerValue()),
            aUnsigned.compareTo(bUnsigned));
      }
    }
  }</B></FONT>

  @GwtIncompatible // too slow
  public void testEquals() {
<A NAME="8"></A>    EqualsTester equalsTester = new EqualsTester();
    for (long a : TEST_LONGS) {
      BigInteger big =
          (a &gt;= 0) ? <FONT color="#c58917"><A HREF="javascript:ZweiFrames('match64469-1.html#8',3,'match64469-top.html#8',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>BigInteger.valueOf(a) : BigInteger.valueOf(a).add(BigInteger.ZERO.setBit(64));
      equalsTester.addEqualityGroup(
          UnsignedLong.fromLongBits(a),
          UnsignedLong.valueOf(big),
          UnsignedLong.valueOf(big.toString()),
          UnsignedLong.valueOf(big.toString(16), 16));
    }</B></FONT>
    equalsTester.testEquals();
  }

  public void testIntValue() {
    for (long a : TEST_LONGS) {
      UnsignedLong aUnsigned = UnsignedLong.fromLongBits(a);
      int intValue = aUnsigned.bigIntegerValue().intValue();
      assertEquals(intValue, aUnsigned.intValue());
    }
  }

  @GwtIncompatible // serialization
  public void testSerialization() {
    for (long a : TEST_LONGS) {
      SerializableTester.reserializeAndAssert(UnsignedLong.fromLongBits(a));
    }
  }

  @GwtIncompatible // NullPointerTester
  public void testNulls() {
    new NullPointerTester().testAllPublicStaticMethods(UnsignedLong.class);
  }
}
</PRE>
</div>
<div style="flex-grow: 1;">
<h3>
<center>
<span>TreeRangeMapTest_1.java</span>
<span> - </span>
<span></span>
</center>
</h3>
<HR>
<PRE>
/*
 * Copyright (C) 2011 The Guava Authors
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */

package com.google.common.collect;

import static com.google.common.collect.BoundType.OPEN;
import static com.google.common.collect.testing.Helpers.mapEntry;

import com.google.common.annotations.GwtIncompatible;
import com.google.common.collect.testing.MapTestSuiteBuilder;
import com.google.common.collect.testing.SampleElements;
<A NAME="15"></A>import com.google.common.collect.testing.TestMapGenerator;
import com.google.common.collect.testing.features.CollectionFeature;
import com.google.common.collect.testing.features.CollectionSize;
<FONT color="#f52887"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#15',2,'match64469-top.html#15',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>import com.google.common.collect.testing.features.MapFeature;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.NoSuchElementException;
import junit.framework.Test;
import junit.framework.TestCase;
import junit.framework.TestSuite;

/**
 * Tests for {@code TreeRangeMap}.
 *
 * @author Louis Wasserman
 */
@</B></FONT>GwtIncompatible // NavigableMap
public class TreeRangeMapTest extends TestCase {
  public static Test suite() {
    TestSuite suite = new TestSuite();
    suite.addTestSuite(TreeRangeMapTest.class);
    suite.addTest(
        MapTestSuiteBuilder.using(
                new TestMapGenerator&lt;Range&lt;Integer&gt;, String&gt;() {
                  @Override
<A NAME="19"></A>                  public SampleElements&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; samples() {
                    return new SampleElements&lt;&gt;(
                        mapEntry(Range.singleton(0), &quot;banana&quot;),
                        <FONT color="#f62817"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#19',2,'match64469-top.html#19',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>mapEntry(Range.closedOpen(3, 5), &quot;frisbee&quot;),
                        mapEntry(Range.atMost(-1), &quot;fruitcake&quot;),
                        mapEntry(Range.open(10, 15), &quot;elephant&quot;),
                        mapEntry(Range.closed(20, 22), &quot;umbrella&quot;));
                  }</B></FONT>

                  @Override
                  public Map&lt;Range&lt;Integer&gt;, String&gt; create(Object... elements) {
                    RangeMap&lt;Integer, String&gt; rangeMap = TreeRangeMap.create();
                    for (Object o : elements) {
                      @SuppressWarnings(&quot;unchecked&quot;)
                      Entry&lt;Range&lt;Integer&gt;, String&gt; entry = (Entry&lt;Range&lt;Integer&gt;, String&gt;) o;
                      rangeMap.put(entry.getKey(), entry.getValue());
                    }
                    return rangeMap.asMapOfRanges();
                  }

                  @SuppressWarnings(&quot;unchecked&quot;)
                  @Override
                  public Entry&lt;Range&lt;Integer&gt;, String&gt;[] createArray(int length) {
                    return new Entry[length];
                  }

                  @Override
                  public Iterable&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; order(
                      List&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; insertionOrder) {
                    return Range.&lt;Integer&gt;rangeLexOrdering().onKeys().sortedCopy(insertionOrder);
                  }

                  @SuppressWarnings(&quot;unchecked&quot;)
                  @Override
                  public Range&lt;Integer&gt;[] createKeyArray(int length) {
                    return new Range[length];
                  }

                  @Override
                  public String[] createValueArray(int length) {
                    return new String[length];
                  }
                })
            .named(&quot;TreeRangeMap.asMapOfRanges&quot;)
            .withFeatures(
                CollectionSize.ANY,
                MapFeature.SUPPORTS_REMOVE,
                MapFeature.ALLOWS_ANY_NULL_QUERIES,
                CollectionFeature.KNOWN_ORDER,
                CollectionFeature.SUPPORTS_ITERATOR_REMOVE)
            .createTestSuite());

    suite.addTest(
        MapTestSuiteBuilder.using(
                new TestMapGenerator&lt;Range&lt;Integer&gt;, String&gt;() {
                  @Override
                  public SampleElements&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; samples() {
                    return new SampleElements&lt;&gt;(
                        mapEntry(Range.singleton(0), &quot;banana&quot;),
                        mapEntry(Range.closedOpen(3, 5), &quot;frisbee&quot;),
                        mapEntry(Range.atMost(-1), &quot;fruitcake&quot;),
                        mapEntry(Range.open(10, 15), &quot;elephant&quot;),
                        mapEntry(Range.closed(20, 22), &quot;umbrella&quot;));
                  }

                  @Override
                  public Map&lt;Range&lt;Integer&gt;, String&gt; create(Object... elements) {
                    RangeMap&lt;Integer, String&gt; rangeMap = TreeRangeMap.create();
                    for (Object o : elements) {
                      @SuppressWarnings(&quot;unchecked&quot;)
                      Entry&lt;Range&lt;Integer&gt;, String&gt; entry = (Entry&lt;Range&lt;Integer&gt;, String&gt;) o;
                      rangeMap.put(entry.getKey(), entry.getValue());
                    }
                    return rangeMap.subRangeMap(Range.atMost(22)).asMapOfRanges();
                  }

                  @SuppressWarnings(&quot;unchecked&quot;)
                  @Override
                  public Entry&lt;Range&lt;Integer&gt;, String&gt;[] createArray(int length) {
                    return new Entry[length];
                  }

                  @Override
                  public Iterable&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; order(
                      List&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; insertionOrder) {
                    return Range.&lt;Integer&gt;rangeLexOrdering().onKeys().sortedCopy(insertionOrder);
                  }

                  @SuppressWarnings(&quot;unchecked&quot;)
                  @Override
                  public Range&lt;Integer&gt;[] createKeyArray(int length) {
                    return new Range[length];
                  }

                  @Override
                  public String[] createValueArray(int length) {
                    return new String[length];
                  }
                })
            .named(&quot;TreeRangeMap.subRangeMap.asMapOfRanges&quot;)
            .withFeatures(
                CollectionSize.ANY,
                MapFeature.SUPPORTS_REMOVE,
                MapFeature.ALLOWS_ANY_NULL_QUERIES,
                CollectionFeature.KNOWN_ORDER)
            .createTestSuite());

    suite.addTest(
        MapTestSuiteBuilder.using(
                new TestMapGenerator&lt;Range&lt;Integer&gt;, String&gt;() {
                  @Override
                  public SampleElements&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; samples() {
                    return new SampleElements&lt;&gt;(
                        mapEntry(Range.singleton(0), &quot;banana&quot;),
                        mapEntry(Range.closedOpen(3, 5), &quot;frisbee&quot;),
                        mapEntry(Range.atMost(-1), &quot;fruitcake&quot;),
                        mapEntry(Range.open(10, 15), &quot;elephant&quot;),
                        mapEntry(Range.closed(20, 22), &quot;umbrella&quot;));
                  }

                  @Override
                  public Map&lt;Range&lt;Integer&gt;, String&gt; create(Object... elements) {
                    RangeMap&lt;Integer, String&gt; rangeMap = TreeRangeMap.create();
                    for (Object o : elements) {
                      @SuppressWarnings(&quot;unchecked&quot;)
                      Entry&lt;Range&lt;Integer&gt;, String&gt; entry = (Entry&lt;Range&lt;Integer&gt;, String&gt;) o;
                      rangeMap.put(entry.getKey(), entry.getValue());
                    }
                    return rangeMap.asDescendingMapOfRanges();
                  }

                  @SuppressWarnings(&quot;unchecked&quot;)
                  @Override
                  public Entry&lt;Range&lt;Integer&gt;, String&gt;[] createArray(int length) {
                    return new Entry[length];
                  }

                  @Override
                  public Iterable&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; order(
                      List&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; insertionOrder) {
                    return Range.&lt;Integer&gt;rangeLexOrdering()
                        .reverse()
                        .onKeys()
                        .sortedCopy(insertionOrder);
                  }

                  @SuppressWarnings(&quot;unchecked&quot;)
                  @Override
                  public Range&lt;Integer&gt;[] createKeyArray(int length) {
                    return new Range[length];
                  }

                  @Override
                  public String[] createValueArray(int length) {
                    return new String[length];
                  }
                })
            .named(&quot;TreeRangeMap.asDescendingMapOfRanges&quot;)
            .withFeatures(
                CollectionSize.ANY,
                MapFeature.SUPPORTS_REMOVE,
                MapFeature.ALLOWS_ANY_NULL_QUERIES,
                CollectionFeature.KNOWN_ORDER,
                CollectionFeature.SUPPORTS_ITERATOR_REMOVE)
            .createTestSuite());

    suite.addTest(
        MapTestSuiteBuilder.using(
                new TestMapGenerator&lt;Range&lt;Integer&gt;, String&gt;() {
                  @Override
                  public SampleElements&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; samples() {
                    return new SampleElements&lt;&gt;(
                        mapEntry(Range.singleton(0), &quot;banana&quot;),
                        mapEntry(Range.closedOpen(3, 5), &quot;frisbee&quot;),
                        mapEntry(Range.atMost(-1), &quot;fruitcake&quot;),
                        mapEntry(Range.open(10, 15), &quot;elephant&quot;),
                        mapEntry(Range.closed(20, 22), &quot;umbrella&quot;));
                  }

                  @Override
                  public Map&lt;Range&lt;Integer&gt;, String&gt; create(Object... elements) {
                    RangeMap&lt;Integer, String&gt; rangeMap = TreeRangeMap.create();
                    for (Object o : elements) {
                      @SuppressWarnings(&quot;unchecked&quot;)
                      Entry&lt;Range&lt;Integer&gt;, String&gt; entry = (Entry&lt;Range&lt;Integer&gt;, String&gt;) o;
                      rangeMap.put(entry.getKey(), entry.getValue());
                    }
                    return rangeMap.subRangeMap(Range.atMost(22)).asDescendingMapOfRanges();
                  }

                  @SuppressWarnings(&quot;unchecked&quot;)
                  @Override
                  public Entry&lt;Range&lt;Integer&gt;, String&gt;[] createArray(int length) {
                    return new Entry[length];
                  }

                  @Override
                  public Iterable&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; order(
                      List&lt;Entry&lt;Range&lt;Integer&gt;, String&gt;&gt; insertionOrder) {
                    return Range.&lt;Integer&gt;rangeLexOrdering()
                        .reverse()
                        .onKeys()
                        .sortedCopy(insertionOrder);
                  }

                  @SuppressWarnings(&quot;unchecked&quot;)
                  @Override
                  public Range&lt;Integer&gt;[] createKeyArray(int length) {
                    return new Range[length];
                  }

                  @Override
                  public String[] createValueArray(int length) {
                    return new String[length];
                  }
                })
            .named(&quot;TreeRangeMap.subRangeMap.asDescendingMapOfRanges&quot;)
            .withFeatures(
                CollectionSize.ANY,
                MapFeature.SUPPORTS_REMOVE,
                MapFeature.ALLOWS_ANY_NULL_QUERIES,
                CollectionFeature.KNOWN_ORDER)
            .createTestSuite());
    return suite;
  }

  private static final ImmutableList&lt;Range&lt;Integer&gt;&gt; RANGES;
  private static final int MIN_BOUND = -1;
  private static final int MAX_BOUND = 1;

  static {
    ImmutableList.Builder&lt;Range&lt;Integer&gt;&gt; builder = ImmutableList.builder();

    builder.add(Range.&lt;Integer&gt;all());

    // Add one-ended ranges
    for (int i = MIN_BOUND; i &lt;= MAX_BOUND; i++) {
      for (BoundType type : BoundType.values()) {
        builder.add(Range.upTo(i, type));
        builder.add(Range.downTo(i, type));
      }
    }

    // Add two-ended ranges
    for (int i = MIN_BOUND; i &lt;= MAX_BOUND; i++) {
      for (int j = i; j &lt;= MAX_BOUND; j++) {
        for (BoundType lowerType : BoundType.values()) {
          for (BoundType upperType : BoundType.values()) {
            if (i == j &amp; lowerType == OPEN &amp; upperType == OPEN) {
              continue;
            }
            builder.add(Range.range(i, lowerType, j, upperType));
          }
        }
      }
    }
    RANGES = builder.build();
<A NAME="4"></A>  }

  public void testSpanSingleRange() {
    <FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#4',2,'match64469-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>for (Range&lt;Integer&gt; range : RANGES) {
      RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
      rangeMap.put(range, 1);

      try {
        assertEquals(range, rangeMap.span());
<A NAME="5"></A>        assertFalse(range.isEmpty());
      } catch (NoSuchElementException e) {
        assertTrue</B></FONT>(range.isEmpty());
      <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#5',2,'match64469-top.html#5',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}
    }
  }

  public void testSpanTwoRanges() {
    for (Range&lt;Integer&gt; range1 : RANGES) {
      for (Range&lt;Integer&gt; range2 : RANGES) {
        RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create</B></FONT>();
        rangeMap.put(range1, 1);
        rangeMap.put(range2, 2);

        Range&lt;Integer&gt; expected;
        if (range1.isEmpty()) {
          if (range2.isEmpty()) {
            expected = null;
          } else {
            expected = range2;
          }
        } else {
          if (range2.isEmpty()) {
            expected = range1;
          } else {
            expected = range1.span(range2);
          }
<A NAME="7"></A>        }

        try {
          <FONT color="#38a4a5"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#7',2,'match64469-top.html#7',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>assertEquals(expected, rangeMap.span());
          assertNotNull(expected);
        } catch (NoSuchElementException e) {
<A NAME="14"></A>          assertNull(expected);
        }
      }
    <FONT color="#842dce"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#14',2,'match64469-top.html#14',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}</B></FONT>
  }

  public void testAllRangesAlone() {
<A NAME="3"></A>    for (Range&lt;Integer&gt; range : RANGES) {
      Map&lt;Integer, Integer&gt; model = Maps.newHashMap();
      putModel</B></FONT>(model, range, 1);
      RangeMap&lt;Integer, Integer&gt; test = <FONT color="#53858b"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#3',2,'match64469-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>TreeRangeMap.create();
      test.put(range, 1);
      verify(model, test);
    }
  }

  public void testAllRangePairs() {
    for (Range&lt;Integer&gt; range1 : RANGES) {
      for (Range&lt;Integer&gt; range2 : RANGES) {
        Map&lt;Integer, Integer&gt; model = Maps.newHashMap</B></FONT>();
<A NAME="2"></A>        putModel(model, range1, 1);
        putModel(model, range2, 2);
        RangeMap&lt;Integer, Integer&gt; test = TreeRangeMap.create();
        <FONT color="#980517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#2',2,'match64469-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>test.put(range1, 1);
        test.put(range2, 2);
        verify(model, test);
      }
    }
  }

  public void testAllRangeTriples() {
<A NAME="17"></A>    for (Range&lt;Integer&gt; range1 : RANGES) {
      for (Range&lt;Integer&gt; range2 : RANGES) {</B></FONT>
        for (Range&lt;Integer&gt; range3 : RANGES) {
          <FONT color="#3090c7"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#17',2,'match64469-top.html#17',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>Map&lt;Integer, Integer&gt; model = Maps.newHashMap();
          putModel(model, range1, 1);
          putModel(model, range2, 2);
          putModel(model, range3, 3);
          RangeMap&lt;Integer, Integer&gt; test = TreeRangeMap.create();
          test.put(range1, 1);
          test.put</B></FONT>(range2, 2);
<A NAME="6"></A>          test.put(range3, 3);
          verify(model, test);
        }
      <FONT color="#8c8774"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#6',2,'match64469-top.html#6',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}
    }
  }

  public void testPutAll() {
    for (Range&lt;Integer&gt; range1 : RANGES) {
      for (Range&lt;Integer&gt; range2 : RANGES) {</B></FONT>
        for (Range&lt;Integer&gt; range3 : RANGES) {
          Map&lt;Integer, Integer&gt; model = Maps.newHashMap();
          putModel(model, range1, 1);
<A NAME="9"></A>          putModel(model, range2, 2);
          putModel(model, range3, 3);
          RangeMap&lt;Integer, Integer&gt; test = TreeRangeMap.create();
          <FONT color="#83a33a"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#9',2,'match64469-top.html#9',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>RangeMap&lt;Integer, Integer&gt; test2 = TreeRangeMap.create();
          // put range2 and range3 into test2, and then put test2 into test
          test.put(range1, 1);
          test2.put(range2, 2);
          test2.put(range3, 3);
          test.putAll(test2);
<A NAME="12"></A>          verify(model, test);
        }
      }
    <FONT color="#571b7e"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#12',2,'match64469-top.html#12',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}</B></FONT>
  }

  public void testPutAndRemove() {
    for (Range&lt;Integer&gt; rangeToPut : RANGES) {
      for (Range&lt;Integer&gt; rangeToRemove : RANGES) {</B></FONT>
        Map&lt;Integer, Integer&gt; model = Maps.newHashMap();
<A NAME="1"></A>        putModel(model, rangeToPut, 1);
        removeModel(model, rangeToRemove);
        RangeMap&lt;Integer, Integer&gt; test = TreeRangeMap.create();
        <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#1',2,'match64469-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>test.put(rangeToPut, 1);
        test.remove(rangeToRemove);
        verify(model, test);
      }
    }
  }

  public void testPutTwoAndRemove() {
    for (Range&lt;Integer&gt; rangeToPut1 : RANGES) {
      for (Range&lt;Integer&gt; rangeToPut2 : RANGES) {</B></FONT>
        for (Range&lt;Integer&gt; rangeToRemove : RANGES) {
          Map&lt;Integer, Integer&gt; model = Maps.newHashMap();
<A NAME="13"></A>          putModel(model, rangeToPut1, 1);
          putModel(model, rangeToPut2, 2);
          removeModel(model, rangeToRemove);
          <FONT color="#3b9c9c"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#13',2,'match64469-top.html#13',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>RangeMap&lt;Integer, Integer&gt; test = TreeRangeMap.create();
          test.put(rangeToPut1, 1);
          test.put(rangeToPut2, 2);
          test.remove(rangeToRemove);
          verify(model, test);
        }
      }
    }</B></FONT>
  }

<A NAME="11"></A>  // identical to testPutTwoAndRemove,
  // verifies that putCoalescing() doesn't cause any mappings to change relative to put()
  public void testPutCoalescingTwoAndRemove() {
    for (Range&lt;Integer&gt; rangeToPut1 : RANGES) <FONT color="#b041ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#11',2,'match64469-top.html#11',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>{
      for (Range&lt;Integer&gt; rangeToPut2 : RANGES) {
        for (Range&lt;Integer&gt; rangeToRemove : RANGES) {
          Map&lt;Integer, Integer&gt; model = Maps.newHashMap();
          putModel(model, rangeToPut1, 1);
          putModel(model, rangeToPut2, 2);
          removeModel</B></FONT>(model, rangeToRemove);
          RangeMap&lt;Integer, Integer&gt; test = TreeRangeMap.create();
          test.putCoalescing(rangeToPut1, 1);
          test.putCoalescing(rangeToPut2, 2);
<A NAME="18"></A>          test.remove(rangeToRemove);
          verify(model, test);
        }
      <FONT color="#800517"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#18',2,'match64469-top.html#18',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}
    }
  }

<A NAME="8"></A>  public void testPutCoalescing() {
    // {[0..1): 1, [1..2): 1, [2..3): 2} -&gt; {[0..2): 1, [2..3): 2}
    RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create()</B></FONT>;
    <FONT color="#c58917"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#8',2,'match64469-top.html#8',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>rangeMap.putCoalescing(Range.closedOpen(0, 1), 1);
    rangeMap.putCoalescing(Range.closedOpen(1, 2), 1);
    rangeMap.putCoalescing(Range.closedOpen(2, 3), 2);
    assertEquals(
        ImmutableMap.of(Range.closedOpen(0, 2), 1, Range.closedOpen(2, 3), 2),
        rangeMap.asMapOfRanges());
  }</B></FONT>

  public void testPutCoalescingEmpty() {
    RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
    rangeMap.put(Range.closedOpen(0, 1), 1);
    rangeMap.put(Range.closedOpen(1, 2), 1);
    assertEquals(
        ImmutableMap.of(Range.closedOpen(0, 1), 1, Range.closedOpen(1, 2), 1),
        rangeMap.asMapOfRanges());

    rangeMap.putCoalescing(Range.closedOpen(1, 1), 1); // empty range coalesces connected ranges
    assertEquals(ImmutableMap.of(Range.closedOpen(0, 2), 1), rangeMap.asMapOfRanges());
  }

  public void testPutCoalescingSubmapEmpty() {
    RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
    rangeMap.put(Range.closedOpen(0, 1), 1);
    rangeMap.put(Range.closedOpen(1, 2), 1);
    assertEquals(
        ImmutableMap.of(Range.closedOpen(0, 1), 1, Range.closedOpen(1, 2), 1),
        rangeMap.asMapOfRanges());

    RangeMap&lt;Integer, Integer&gt; subRangeMap = rangeMap.subRangeMap(Range.closedOpen(0, 2));
    subRangeMap.putCoalescing(Range.closedOpen(1, 1), 1); // empty range coalesces connected ranges
    assertEquals(ImmutableMap.of(Range.closedOpen(0, 2), 1), subRangeMap.asMapOfRanges());
    assertEquals(ImmutableMap.of(Range.closedOpen(0, 2), 1), rangeMap.asMapOfRanges());
  }

  public void testPutCoalescingComplex() {
    // {[0..1): 1, [1..3): 1, [3..5): 1, [7..10): 2, [12..15): 2, [18..19): 3}
    RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
    rangeMap.put(Range.closedOpen(0, 1), 1);
    rangeMap.put(Range.closedOpen(1, 3), 1);
    rangeMap.put(Range.closedOpen(3, 5), 1);
    rangeMap.put(Range.closedOpen(7, 10), 2);
    rangeMap.put(Range.closedOpen(12, 15), 2);
    rangeMap.put(Range.closedOpen(18, 19), 3);

    rangeMap.putCoalescing(Range.closedOpen(-5, -4), 0); // disconnected
    rangeMap.putCoalescing(Range.closedOpen(-6, -5), 0); // lower than minimum

    rangeMap.putCoalescing(Range.closedOpen(2, 4), 1); // between
    rangeMap.putCoalescing(Range.closedOpen(9, 14), 0); // different value
    rangeMap.putCoalescing(Range.closedOpen(17, 20), 3); // enclosing

    rangeMap.putCoalescing(Range.closedOpen(22, 23), 4); // disconnected
    rangeMap.putCoalescing(Range.closedOpen(23, 25), 4); // greater than minimum

    // {[-6..-4): 0, [0..1): 1, [1..5): 1, [7..9): 2,
    //  [9..14): 0, [14..15): 2, [17..20): 3, [22..25): 4}
    assertEquals(
        new ImmutableMap.Builder&lt;&gt;()
            .put(Range.closedOpen(-6, -4), 0)
            .put(Range.closedOpen(0, 1), 1) // not coalesced
            .put(Range.closedOpen(1, 5), 1)
            .put(Range.closedOpen(7, 9), 2)
            .put(Range.closedOpen(9, 14), 0)
            .put(Range.closedOpen(14, 15), 2)
            .put(Range.closedOpen(17, 20), 3)
            .put(Range.closedOpen(22, 25), 4)
            .build(),
        rangeMap.asMapOfRanges());
  }


  public void testSubRangeMapExhaustive() {
    for (Range&lt;Integer&gt; range1 : RANGES) {
      for (Range&lt;Integer&gt; range2 : RANGES) {
        RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
        rangeMap.put(range1, 1);
        rangeMap.put(range2, 2);

        for (Range&lt;Integer&gt; subRange : RANGES) {
          RangeMap&lt;Integer, Integer&gt; expected = TreeRangeMap.create();
          for (Entry&lt;Range&lt;Integer&gt;, Integer&gt; entry : rangeMap.asMapOfRanges().entrySet()) {
            if (entry.getKey().isConnected(subRange)) {
              expected.put(entry.getKey().intersection(subRange), entry.getValue());
            }
          }
          RangeMap&lt;Integer, Integer&gt; subRangeMap = rangeMap.subRangeMap(subRange);
          assertEquals(expected, subRangeMap);
          assertEquals(expected.asMapOfRanges(), subRangeMap.asMapOfRanges());
          assertEquals(expected.asDescendingMapOfRanges(), subRangeMap.asDescendingMapOfRanges());
          assertEquals(
              ImmutableList.copyOf(subRangeMap.asMapOfRanges().entrySet()).reverse(),
              ImmutableList.copyOf(subRangeMap.asDescendingMapOfRanges().entrySet()));

          if (!expected.asMapOfRanges().isEmpty()) {
            assertEquals(expected.span(), subRangeMap.span());
          }

          for (int i = MIN_BOUND; i &lt;= MAX_BOUND; i++) {
            assertEquals(expected.get(i), subRangeMap.get(i));
          }

          for (Range&lt;Integer&gt; query : RANGES) {
            assertEquals(
                expected.asMapOfRanges().get(query), subRangeMap.asMapOfRanges().get(query));
          }
        }
      }
    }
  }

  public void testSubSubRangeMap() {
    RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
    rangeMap.put(Range.open(3, 7), 1);
    rangeMap.put(Range.closed(9, 10), 2);
    rangeMap.put(Range.closed(12, 16), 3);
    RangeMap&lt;Integer, Integer&gt; sub1 = rangeMap.subRangeMap(Range.closed(5, 11));
    assertEquals(
        ImmutableMap.of(Range.closedOpen(5, 7), 1, Range.closed(9, 10), 2), sub1.asMapOfRanges());
    RangeMap&lt;Integer, Integer&gt; sub2 = sub1.subRangeMap(Range.open(6, 15));
    assertEquals(
        ImmutableMap.of(Range.open(6, 7), 1, Range.closed(9, 10), 2), sub2.asMapOfRanges());
<A NAME="0"></A>  }

  public void testSubRangeMapPut() {
    RangeMap&lt;Integer, Integer&gt; rangeMap = <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#0',2,'match64469-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>TreeRangeMap.create();
    rangeMap.put(Range.open(3, 7), 1);
    rangeMap.put(Range.closed(9, 10), 2);
    rangeMap.put(Range.closed(12, 16), 3);
    RangeMap&lt;Integer, Integer&gt; sub = rangeMap.subRangeMap(Range.closed(5, 11));
    assertEquals(
        ImmutableMap.of(Range.closedOpen(5, 7), 1, Range.closed(9, 10), 2), sub.asMapOfRanges());
    sub.put(Range.closed(7, 9), 4);
    assertEquals(
        ImmutableMap.of(
            Range.closedOpen(5, 7), 1, Range.closed(7, 9), 4, Range.openClosed(9, 10), 2),
        sub.asMapOfRanges());
    assertEquals(
        ImmutableMap.of(
            Range.open(3, 7),
            1,
            Range.closed(7, 9),
            4,
            Range.openClosed</B></FONT>(9, 10),
            2,
            Range.closed(12, 16),
<A NAME="16"></A>            3),
        rangeMap.asMapOfRanges());

    <FONT color="#2981b2"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#16',2,'match64469-top.html#16',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>try {
      sub.put(Range.open(9, 12), 5);
      fail(&quot;Expected IllegalArgumentException&quot;);
    } catch (IllegalArgumentException expected) {</B></FONT>
    }

    sub = sub.subRangeMap(Range.closedOpen(5, 5));
    sub.put(Range.closedOpen(5, 5), 6); // should be a no-op
    assertEquals(
        ImmutableMap.of(
            Range.open(3, 7),
            1,
            Range.closed(7, 9),
            4,
            Range.openClosed(9, 10),
            2,
            Range.closed(12, 16),
            3),
        rangeMap.asMapOfRanges());
  }

  public void testSubRangeMapPutCoalescing() {
    RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
    rangeMap.put(Range.open(3, 7), 1);
    rangeMap.put(Range.closed(9, 10), 2);
    rangeMap.put(Range.closed(12, 16), 3);
    RangeMap&lt;Integer, Integer&gt; sub = rangeMap.subRangeMap(Range.closed(5, 11));
    assertEquals(
        ImmutableMap.of(Range.closedOpen(5, 7), 1, Range.closed(9, 10), 2), sub.asMapOfRanges());
    sub.putCoalescing(Range.closed(7, 9), 2);
    assertEquals(
        ImmutableMap.of(Range.closedOpen(5, 7), 1, Range.closed(7, 10), 2), sub.asMapOfRanges());
    assertEquals(
        ImmutableMap.of(Range.open(3, 7), 1, Range.closed(7, 10), 2, Range.closed(12, 16), 3),
        rangeMap.asMapOfRanges());

    sub.putCoalescing(Range.singleton(7), 1);
    assertEquals(
        ImmutableMap.of(Range.closed(5, 7), 1, Range.openClosed(7, 10), 2), sub.asMapOfRanges());
    assertEquals(
        ImmutableMap.of(
            Range.open(3, 5),
            1,
            Range.closed(5, 7),
            1,
            Range.openClosed(7, 10),
            2,
            Range.closed(12, 16),
<A NAME="10"></A>            3),
        rangeMap.asMapOfRanges());

    <FONT color="#ad5910"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match64469-0.html#10',2,'match64469-top.html#10',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>try {
      sub.putCoalescing(Range.open(9, 12), 5);
      fail(&quot;Expected IllegalArgumentException&quot;);
    } catch (IllegalArgumentException expected) {
    }
  }</B></FONT>

  public void testSubRangeMapRemove() {
    RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
    rangeMap.put(Range.open(3, 7), 1);
    rangeMap.put(Range.closed(9, 10), 2);
    rangeMap.put(Range.closed(12, 16), 3);
    RangeMap&lt;Integer, Integer&gt; sub = rangeMap.subRangeMap(Range.closed(5, 11));
    assertEquals(
        ImmutableMap.of(Range.closedOpen(5, 7), 1, Range.closed(9, 10), 2), sub.asMapOfRanges());
    sub.remove(Range.closed(7, 9));
    assertEquals(
        ImmutableMap.of(Range.closedOpen(5, 7), 1, Range.openClosed(9, 10), 2),
        sub.asMapOfRanges());
    assertEquals(
        ImmutableMap.of(Range.open(3, 7), 1, Range.openClosed(9, 10), 2, Range.closed(12, 16), 3),
        rangeMap.asMapOfRanges());

    sub.remove(Range.closed(3, 9));
    assertEquals(ImmutableMap.of(Range.openClosed(9, 10), 2), sub.asMapOfRanges());
    assertEquals(
        ImmutableMap.of(Range.open(3, 5), 1, Range.openClosed(9, 10), 2, Range.closed(12, 16), 3),
        rangeMap.asMapOfRanges());
  }

  public void testSubRangeMapClear() {
    RangeMap&lt;Integer, Integer&gt; rangeMap = TreeRangeMap.create();
    rangeMap.put(Range.open(3, 7), 1);
    rangeMap.put(Range.closed(9, 10), 2);
    rangeMap.put(Range.closed(12, 16), 3);
    RangeMap&lt;Integer, Integer&gt; sub = rangeMap.subRangeMap(Range.closed(5, 11));
    sub.clear();
    assertEquals(
        ImmutableMap.of(Range.open(3, 5), 1, Range.closed(12, 16), 3), rangeMap.asMapOfRanges());
  }

  private void verify(Map&lt;Integer, Integer&gt; model, RangeMap&lt;Integer, Integer&gt; test) {
    for (int i = MIN_BOUND - 1; i &lt;= MAX_BOUND + 1; i++) {
      assertEquals(model.get(i), test.get(i));

      Entry&lt;Range&lt;Integer&gt;, Integer&gt; entry = test.getEntry(i);
      assertEquals(model.containsKey(i), entry != null);
      if (entry != null) {
        assertTrue(test.asMapOfRanges().entrySet().contains(entry));
      }
    }
    for (Range&lt;Integer&gt; range : test.asMapOfRanges().keySet()) {
      assertFalse(range.isEmpty());
    }
  }

  private static void putModel(Map&lt;Integer, Integer&gt; model, Range&lt;Integer&gt; range, int value) {
    for (int i = MIN_BOUND - 1; i &lt;= MAX_BOUND + 1; i++) {
      if (range.contains(i)) {
        model.put(i, value);
      }
    }
  }

  private static void removeModel(Map&lt;Integer, Integer&gt; model, Range&lt;Integer&gt; range) {
    for (int i = MIN_BOUND - 1; i &lt;= MAX_BOUND + 1; i++) {
      if (range.contains(i)) {
        model.remove(i);
      }
    }
  }
}
</PRE>
</div>
  </div>
</body>
</html>
