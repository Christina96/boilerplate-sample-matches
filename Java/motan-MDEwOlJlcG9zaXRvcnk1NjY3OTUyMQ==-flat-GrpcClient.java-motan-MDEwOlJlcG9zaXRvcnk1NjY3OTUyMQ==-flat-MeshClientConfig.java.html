
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Code Files</title>
            <style>
                .column {
                    width: 47%;
                    float: left;
                    padding: 12px;
                    border: 2px solid #ffd0d0;
                }
        
                .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    overflow: auto;
                    background-color: rgb(0, 0, 0);
                    background-color: rgba(0, 0, 0, 0.4);
                }
    
                .modal-content {
                    height: 250%;
                    background-color: #fefefe;
                    margin: 5% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 80%;
                }
    
                .close {
                    color: #aaa;
                    float: right;
                    font-size: 20px;
                    font-weight: bold;
                    text-align: right;
                }
    
                .close:hover, .close:focus {
                    color: black;
                    text-decoration: none;
                    cursor: pointer;
                }
    
                .row {
                    float: right;
                    width: 100%;
                }
    
                .column_space  {
                    white - space: pre-wrap;
                }
                 
                pre {
                    width: 100%;
                    overflow-y: auto;
                    background: #f8fef2;
                }
                
                .match {
                    cursor:pointer; 
                    background-color:#00ffbb;
                }
        </style>
    </head>
    <body>
        <h2>Similarity: 8.211143695014663%, Tokens: 14</h2>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-GrpcClient.java</h3>
            <pre><code>1  package com.weibo.api.motan.protocol.grpc;
2  import com.weibo.api.motan.common.URLParamType;
3  import com.weibo.api.motan.exception.MotanServiceException;
4  import com.weibo.api.motan.rpc.Request;
5  import com.weibo.api.motan.rpc.Response;
6  import com.weibo.api.motan.rpc.URL;
7  import io.grpc.*;
<span onclick='openModal()' class='match'>8  import io.grpc.ForwardingClientCall.SimpleForwardingClientCall;
9  import io.grpc.MethodDescriptor.MethodType;
10  import io.grpc.stub.ClientCalls;
11  import io.grpc.stub.StreamObserver;
12  import java.util.HashMap;
13  import java.util.Map;
14  import java.util.Map.Entry;
15  import java.util.concurrent.TimeUnit;
16  public class GrpcClient {
17      private URL url;
18      private Class<?> interfaceClazz;
19      private ManagedChannel channel;
20      private CallOptions callOption = CallOptions.DEFAULT; 
21      @SuppressWarnings("rawtypes")
</span>22      private HashMap<String, MethodDescriptor> methodDescMap;
23      public GrpcClient(URL url, Class<?> interfaceClazz) {
24          this.url = url;
25          this.interfaceClazz = interfaceClazz;
26      }
27      @SuppressWarnings({"unchecked", "rawtypes"})
28      public <ReqT, RespT> Response request(final Request request) {
29          MethodDescriptor<ReqT, RespT> methodDesc = methodDescMap.get(request.getMethodName());
30          if (methodDesc == null) {
31              throw new MotanServiceException("request method grpc descriptornot found.method:" + request.getMethodName());
32          }
33          int timeout =
34                  url.getMethodParameter(request.getMethodName(), request.getParamtersDesc(), URLParamType.requestTimeout.getName(),
35                          URLParamType.requestTimeout.getIntValue());
36          if (timeout < 0) {
37              throw new MotanServiceException("request timeout invalid.method timeout:" + timeout);
38          }
39          ClientCall<ReqT, RespT> call =
40                  new SimpleForwardingClientCall(channel.newCall(methodDesc, callOption.withDeadlineAfter(timeout, TimeUnit.MILLISECONDS))) {
41                      public void start(Listener responseListener, Metadata headers) {
42                          Map<String, String> attachments = request.getAttachments();
43                          if (attachments != null && !attachments.isEmpty()) {
44                              for (Entry<String, String> entry : attachments.entrySet()) {
45                                  headers.put(Metadata.Key.of(entry.getKey(), Metadata.ASCII_STRING_MARSHALLER), entry.getValue());
46                              }
47                          }
48                          super.start(responseListener, headers);
49                      }
50                  };
51          GrpcResponseFuture<RespT> responseFuture = new GrpcResponseFuture<RespT>(request, timeout, url, call);
52          MethodType methodType = methodDesc.getType();
53          switch (methodType) {
54              case UNARY:
55                  ClientCalls.asyncUnaryCall(call, (ReqT) request.getArguments()[0], responseFuture);
56                  break;
57              case SERVER_STREAMING:
58                  ClientCalls.asyncServerStreamingCall(call, (ReqT) request.getArguments()[0],
59                          (io.grpc.stub.StreamObserver<RespT>) request.getArguments()[1]);
60                  responseFuture.onCompleted();
61                  break;
62              case CLIENT_STREAMING:
63                  StreamObserver<ReqT> clientObserver =
64                          ClientCalls.asyncClientStreamingCall(call, (io.grpc.stub.StreamObserver<RespT>) request.getArguments()[0]);
65                  responseFuture.onNext(clientObserver);
66                  responseFuture.onCompleted();
67                  break;
68              case BIDI_STREAMING:
69                  StreamObserver<ReqT> biObserver =
70                          ClientCalls.asyncBidiStreamingCall(call, (io.grpc.stub.StreamObserver<RespT>) request.getArguments()[0]);
71                  responseFuture.onNext(biObserver);
72                  responseFuture.onCompleted();
73                  break;
74              default:
75                  throw new MotanServiceException("unknown grpc method type:" + methodType);
76          }
77          return responseFuture;
78      }
79      public boolean init() throws Exception {
80          methodDescMap = GrpcUtil.getMethodDescriptorByAnnotation(interfaceClazz, url.getParameter(URLParamType.serialize.getName()));
81          channel = ManagedChannelBuilder.forAddress(url.getHost(), url.getPort()).usePlaintext(true).build();
82          return true;
83      }
84      public void destroy() {
85          channel.shutdownNow();
86      }
87  }
</code></pre>
        </div>
        <div class="column">
            <h3>motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-MeshClientConfig.java</h3>
            <pre><code>1  package com.weibo.api.motan.config;
<span onclick='openModal()' class='match'>2  import com.weibo.api.motan.common.MotanConstants;
3  import com.weibo.api.motan.common.URLParamType;
4  import com.weibo.api.motan.rpc.URL;
5  import com.weibo.api.motan.transport.DefaultMeshClient;
6  import com.weibo.api.motan.transport.MeshClient;
7  import com.weibo.api.motan.util.LoggerUtil;
8  import java.util.Map;
9  import java.util.concurrent.atomic.AtomicBoolean;
10  public class MeshClientConfig extends AbstractConfig {
11      protected Integer port;
12      protected Integer mport;
13      protected String host;
14      protected String application;
15      protected Integer minClientConnection;
</span>16      protected Integer maxClientConnection;
17      protected String serialization;
18      protected Integer connectTimeout;
19      protected Integer requestTimeout;
20      protected Integer maxContentLength;
21      protected String filter;
22      protected String accessLog;
23      protected Integer mingzSize;
24      protected String endpointFactory;
25      protected String codec;
26      protected String check;
27      protected Boolean asyncInitConnection;
28      protected Integer fusingThreshold;
29      protected MeshClient meshClient;
30      protected URL url;
31      protected AtomicBoolean initialized = new AtomicBoolean(false);
32      public MeshClient getMeshClient() {
33          if (meshClient == null) {
34              initMeshClient();
35          }
36          return meshClient;
37      }
38      protected synchronized void initMeshClient() {
39          if (initialized.get()) {
40              return;
41          }
42          buildMeshClientUrl();
43          DefaultMeshClient defaultMeshClient = new DefaultMeshClient(url);
44          try {
45              defaultMeshClient.init();
46          } catch (Exception e) {
47              LoggerUtil.error("mesh client init fail. url:" + url.toFullStr(), e);
48              boolean check = Boolean.parseBoolean(url.getParameter(URLParamType.check.getName(), URLParamType.check.getValue()));
49              if (check) {
50                  throw e;
51              }
52          }
53          meshClient = defaultMeshClient;
54          initialized.set(true);
55      }
56      protected synchronized void destroy() throws Exception {
57          if (meshClient != null) {
58              meshClient.destroy();
59              meshClient = null;
60          }
61          initialized.set(false);
62      }
63      private void buildMeshClientUrl() {
64          Map<String, String> params = DefaultMeshClient.getDefaultParams();
65          appendConfigParams(params);
66          url = new URL(params.get(URLParamType.protocol.getName()),
67                  host == null ? MotanConstants.MESH_DEFAULT_HOST : host,
68                  port == null ? MotanConstants.MESH_DEFAULT_PORT : port,
69                  MeshClient.class.getName(), params);
70      }
71      public Integer getPort() {
72          return port;
73      }
74      public void setPort(Integer port) {
75          this.port = port;
76      }
77      public Integer getMport() {
78          return mport;
79      }
80      public void setMport(Integer mport) {
81          this.mport = mport;
82      }
83      public String getHost() {
84          return host;
85      }
86      public void setHost(String host) {
87          this.host = host;
88      }
89      public String getApplication() {
90          return application;
91      }
92      public void setApplication(String application) {
93          this.application = application;
94      }
95      public Integer getMinClientConnection() {
96          return minClientConnection;
97      }
98      public void setMinClientConnection(Integer minClientConnection) {
99          this.minClientConnection = minClientConnection;
100      }
101      public Integer getMaxClientConnection() {
102          return maxClientConnection;
103      }
104      public void setMaxClientConnection(Integer maxClientConnection) {
105          this.maxClientConnection = maxClientConnection;
106      }
107      public String getSerialization() {
108          return serialization;
109      }
110      public void setSerialization(String serialization) {
111          this.serialization = serialization;
112      }
113      public Integer getConnectTimeout() {
114          return connectTimeout;
115      }
116      public void setConnectTimeout(Integer connectTimeout) {
117          this.connectTimeout = connectTimeout;
118      }
119      public Integer getRequestTimeout() {
120          return requestTimeout;
121      }
122      public void setRequestTimeout(Integer requestTimeout) {
123          this.requestTimeout = requestTimeout;
124      }
125      public Integer getMaxContentLength() {
126          return maxContentLength;
127      }
128      public void setMaxContentLength(Integer maxContentLength) {
129          this.maxContentLength = maxContentLength;
130      }
131      public String getFilter() {
132          return filter;
133      }
134      public void setFilter(String filter) {
135          this.filter = filter;
136      }
137      public String getAccessLog() {
138          return accessLog;
139      }
140      public void setAccessLog(String accessLog) {
141          this.accessLog = accessLog;
142      }
143      public Integer getMingzSize() {
144          return mingzSize;
145      }
146      public void setMingzSize(Integer mingzSize) {
147          this.mingzSize = mingzSize;
148      }
149      public String getEndpointFactory() {
150          return endpointFactory;
151      }
152      public void setEndpointFactory(String endpointFactory) {
153          this.endpointFactory = endpointFactory;
154      }
155      public String getCodec() {
156          return codec;
157      }
158      public void setCodec(String codec) {
159          this.codec = codec;
160      }
161      public String getCheck() {
162          return check;
163      }
164      public void setCheck(String check) {
165          this.check = check;
166      }
167      public Boolean getAsyncInitConnection() {
168          return asyncInitConnection;
169      }
170      public void setAsyncInitConnection(Boolean asyncInitConnection) {
171          this.asyncInitConnection = asyncInitConnection;
172      }
173      public Integer getFusingThreshold() {
174          return fusingThreshold;
175      }
176      public void setFusingThreshold(Integer fusingThreshold) {
177          this.fusingThreshold = fusingThreshold;
178      }
179  }
</code></pre>
        </div>
    
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="row close">&times;</span>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-GrpcClient.java</div>
                <div class="column" style="font-weight: bold;text-decoration: underline">Fragment from motan-MDEwOlJlcG9zaXRvcnk1NjY3OTUyMQ==-flat-MeshClientConfig.java</div>
                <div class="column column_space"><pre><code>8  import io.grpc.ForwardingClientCall.SimpleForwardingClientCall;
9  import io.grpc.MethodDescriptor.MethodType;
10  import io.grpc.stub.ClientCalls;
11  import io.grpc.stub.StreamObserver;
12  import java.util.HashMap;
13  import java.util.Map;
14  import java.util.Map.Entry;
15  import java.util.concurrent.TimeUnit;
16  public class GrpcClient {
17      private URL url;
18      private Class<?> interfaceClazz;
19      private ManagedChannel channel;
20      private CallOptions callOption = CallOptions.DEFAULT; 
21      @SuppressWarnings("rawtypes")
</pre></code></div>
                <div class="column column_space"><pre><code>2  import com.weibo.api.motan.common.MotanConstants;
3  import com.weibo.api.motan.common.URLParamType;
4  import com.weibo.api.motan.rpc.URL;
5  import com.weibo.api.motan.transport.DefaultMeshClient;
6  import com.weibo.api.motan.transport.MeshClient;
7  import com.weibo.api.motan.util.LoggerUtil;
8  import java.util.Map;
9  import java.util.concurrent.atomic.AtomicBoolean;
10  public class MeshClientConfig extends AbstractConfig {
11      protected Integer port;
12      protected Integer mport;
13      protected String host;
14      protected String application;
15      protected Integer minClientConnection;
</pre></code></div>
            </div>
        </div>
        <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks the button, open the modal
        function openModal(){
          modal.style.display = "block";
        }
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
        modal.style.display = "none";
        } }
        
        </script>
    </body>
    </html>
    